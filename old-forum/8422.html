<html><header><title>Child_Fetch executing on client and not on server</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child_Fetch executing on client and not on server</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8422.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shawndewet posted on Thursday, January 28, 2010</h2>I use lazy loading on my header class to retrieve its associated lines only when the header's MyLines property is accessed. The code in MyLines is this: <br />Public Overridable ReadOnly Property MyIndentSaleDetailCollection() As IndentSaleDetailCollection <br />    Get <br />        If Not FieldManager.FieldExists(_myIndentSaleDetailCollection) Then <br />            LoadProperty(Of IndentSaleDetailCollection)(_myIndentSaleDetailCollection, _ <br />            IndentSaleDetailCollection.FetchByParent(Me)) <br />        End If <br />        Return GetProperty(Of IndentSaleDetailCollection)(_myIndentSaleDetailCollection) <br />    End Get <br />End Property <br /><br />Now on IndentSaleDetailCollection, the FetchByParent factory method looks like this... <br /><br />Public Shared Function FetchByParent(ByVal parent As IndentSaleHeader) As IndentSaleDetailCollection <br />    Return DataPortal.FetchChild(Of IndentSaleDetailCollection)(New CriteriaByParent(parent)) <br />End Function <br /><br />This DataPortal.FetchChild method translates into a call to Child_Fetch, which looks like this... <br /><br />Private Overloads Sub Child_Fetch(ByVal oCriteria As CriteriaByParent) <br />    _MyIndentSaleHeader = oCriteria.cparent <br />    Using ctx = ConnectionManager(Of SqlConnection).GetManager(oCriteria.strEnvironmentDatabaseKey) <br />        Using cmd = ctx.Connection.CreateCommand <br />            cmd.CommandType = CommandType.Text <br />            cmd.CommandText = "EXEC sp_executesql " + oCriteria.FullSelectStatement <br />            DoDataReader(cmd, oCriteria.strEnvironmentDatabaseKey) <br />        End Using <br />    End Using <br />End Sub <br /><br />Right, now you have the whole context. Can anyone please help me figure out why the Child_Fetch method is being executed on the client and not on the server. <br /><br />All other calls via the Dataportal correctly execute on the server. From what I can figure out in looking at the DataPortal code, it seems that the FetchChild method does not concern itself with checking on which side of the DataPortal it should execute. If my finding here is correct, I must ask why this is so? Is my scenario for lazy loading child collections not a valid one? Or am I doing something wrong? <br /><br />Please help<br /><br />btw, I'm using CSLA 3.7</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, January 28, 2010</h2><P>All of the xzyChild dataportal methods execute where ever they are called; they assume they are already running on the server.&nbsp; Call the&nbsp;non-child fetch, and implement a DataPortal_Fetch.&nbsp; You'll have to remember to call MarkAsChild on your own.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, January 28, 2010</h2>Hi Andy,<br /><br />Well, I have never coded a lazy loaded collection so I have no real experience here but my gut feeling would be to basically go ahead and create some kind of CSLA command object that returned the data that I needed to populate my lazy loaded collection. I would execute my CSLA command from within the “Child_Fetch” function.<br /><br />Why would I want to go into all that trouble when I could achieve (much more easily) the exact same thing they way you are proposing it?<br /><br />I don’t know, I guess I rather don’t mess around with calling functions such as the MarkAsChild() one. I much prefer letting the CSLA handle that for me and let the CSLA command object be the one that goes to the server.<br /><br />Just a thought. Whats your opinion?<br /><br />Thanks.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 28, 2010</h2>This command object approach is probably the more elegant solution, but it does require more code, so it is a trade-off.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, January 28, 2010</h2><P>Either way will work, but its easier to change the call, the method name, and then add a single line of code than it would be to create a command object.</P>
<P>The child data portal concept is relatively new as well; it wasn't that long ago that you had no choice but to call it yourself.&nbsp; Its nice because it does take care of the details for you, and makes coding child objects similar to coding root objects, but you don't need to use it (and in this case it's not an option).</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
