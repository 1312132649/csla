<html><header><title>CSLA4: Windows .Net</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA4: Windows .Net</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11175.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit posted on Sunday, February 19, 2012</h2><p>OK, I&#39;ve managed to successfully write a quick EditPerson form for Windows Forms using CSLA4.2.2 - so I&#39;m now making progress.</p>
<p>I&#39;m using the EncapInvoke model.</p>
<p>My first test was using a MockDb and I am able to list, edit and add new records in my person &quot;table&quot;.</p>
<p>So, my next step was to create the DataAccess layer for a SQL Server Express implementation - as this is my core development background.</p>
<p>Everything works - until I try to Save a changed, or new record. I get an exception;</p>
<p>System.InvalidOperationException = {&quot;Object is still being edited and can not be saved&quot;} StackTrace = &quot;&nbsp;&nbsp; at Csla.BusinessBase`1.Save() in C:\Visual Studio Projects\csla\40\Source\Csla\BusinessBase.cs:line 126&nbsp;&nbsp;&nbsp;&nbsp; at Intro.EditPerson.SaveRecord(Boolean rebind)&quot;</p>
<p>Any ideas? The code in the client is exactly the same regardless of the Dal I&#39;m using, so I&#39;m thinking the issue lies within CSLA rather than my code... but I&#39;m sure someone would have heard of it by now?</p>
<p>This is my &quot;SaveRecord&quot; code:</p>
<p>Private Sub SaveRecord(ByVal rebind As Boolean)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using busy As New StatusBusy(&quot;Saving...&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39; stop the flow of events<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.PersonEditBindingSource.RaiseListChangedEvents = False</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39; do the save<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim temp As PersonEdit = mPERSONEDIT.Clone<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp.ApplyEdit()</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mPERSONEDIT = temp.Save &#39;&lt;------------- error&#39;s at this point<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PersonEdit.BeginEdit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rebind Then</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39; rebind the UI<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With Me.PersonEditBindingSource</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .DataSource = Nothing<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .RaiseListChangedEvents = True &#39; this is the key to updating children</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .DataSource = mPERSONEDIT</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Csla.DataPortalException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Error saving&quot;, MessageBoxButtons.OK, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Error saving&quot;, MessageBoxButtons.OK, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.PersonEditBindingSource.RaiseListChangedEvents = True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using</p>
<p>&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;</p>
<p>Feedback would be appreciated.</p>
<p>&nbsp;</p>
<p>Thanks,</p>
<p>Graham</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, February 19, 2012</h2><p>You must unbind the object completely from the UI. This is described in Rocky&#39;s books. </p>
<p>And you do not have to make a clone in your code - this is done automatically by CSLA DataPortal. </p>
<p>These extensions is translated from CslaContrib to vb.net: </p>
<p>Public NotInheritable Class BindingSourceExtensions<br />&nbsp;&nbsp;&nbsp; Private Sub New()<br />&nbsp;&nbsp;&nbsp; End Sub<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Unbind the binding source and the Data object. Use this Method to safely disconnect the data object from a BindingSource before saving data.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;source&quot;&gt;The source.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;cancel&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; then call CancelEdit else call EndEdit.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;isRoot&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; this BindingSource contains the Root object. Set to &lt;c&gt;false&lt;/c&gt; for nested BindingSources&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension&gt; _<br />&nbsp;&nbsp;&nbsp; Public Shared Sub Unbind(source As BindingSource, cancel As Boolean, isRoot As Boolean)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim current As IEditableObject = Nothing<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; position may be -1 when bindigsource is already unbound<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; and accessing source.Current will then throw Exception.<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If (source.DataSource IsNot Nothing) AndAlso (source.Position &gt; -1) Then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; current = TryCast(source.Current, IEditableObject)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; set Raise list changed to True<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.RaiseListChangedEvents = False<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; tell currency manager to suspend binding<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.SuspendBinding()<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If isRoot Then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.DataSource = Nothing<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If current Is Nothing Then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If cancel Then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; current.CancelEdit()<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; current.EndEdit()<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Rebind the binding source and business object.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;source&quot;&gt;The source.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;data&quot;&gt;The data object.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension&gt; _<br />&nbsp;&nbsp;&nbsp; Public Shared Sub Rebind(source As BindingSource, data As Object)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.Rebind(data, False)<br />&nbsp;&nbsp;&nbsp; End Sub<br /><br /><br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Rebind the binding source and business object.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;source&quot;&gt;The source.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;data&quot;&gt;The data object.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;param name=&quot;metadataChanged&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; then metadata (type) was changed.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension&gt; _<br />&nbsp;&nbsp;&nbsp; Public Shared Sub Rebind(source As BindingSource, data As Object, metadataChanged As Boolean)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.RaiseListChangedEvents = True<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.SuspendBinding()<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If data IsNot Nothing Then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.DataSource = data<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; set Raise list changed to True<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.RaiseListChangedEvents = True<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; tell currency manager to resume binding <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.ResumeBinding()<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#39; Notify UI controls that the dataobject/list was reset - but metadata was not changed <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; source.ResetBindings(metadataChanged)<br />&nbsp;&nbsp;&nbsp; End Sub<br />End Class</p>
<p>&nbsp;</p>
<p>So you save code should be something like this: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using busy As New StatusBusy(&quot;Saving...&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39; unbind from bindingsource<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.PersonEditBindingSource.Unbind(False, True)
</p>
<p>&nbsp;</p>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mPERSONEDIT = mPERSONEDIT .Save</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .......<br />&nbsp;and make sure to rebind your bo before you leave the method:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.PersonEditBindingSource.Rebind(mPERSONEDIT)
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Sunday, February 19, 2012</h2><p>Just when I thought I was getting to grips...... that&#39;s confused me completely.</p>
<p>My code was working code for CSLA2.1 - and now it&#39;s breaking code? You&#39;ll excuse me if I missed whatever reference was made to unbinding an object - but there was no WindowsForms book - and as this code previously worked, you&#39;ll understand why I&#39;m not clear that it no longer works.</p>
<p>There is no Unbind method for the .Net BindingSource - how is that implemented in my .Net code?</p>
<p>I don&#39;t understand why it would be worrking code for one Dal and not another...</p>
<p>My form currently inherits from what was previously WinPart in the CSLA implemetation. Are you saying there is a new helper control that I should be inheriting from?</p>
<p>Graham</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, February 19, 2012</h2><p>Unbind/Rebind is implemented in the BindingSourceExtensions in my previous post. </p>
<p>Binding/Unbinding is described in the Using <b>CSLA 3.0 ebook - also available for VB.</b></p>
<p>I also have a blog post on Bind/Rebind here: <br /><a href="http://jonnybekkum.wordpress.com/2009/10/20/forms-databinding-the-magic-sequence-of-binduiunbindui/">http://jonnybekkum.wordpress.com/2009/10/20/forms-databinding-the-magic-sequence-of-binduiunbindui/ </a></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Sunday, February 19, 2012</h2><p>Thanks Jonny.</p>
<p>I downloaded the WfUI from SVN as discussed in a previous post and it shows clearly the implementation - thanks.</p>
<p>I do have an issue with Closing a Winpart...</p>
<p>In say my PersonEdit (Winpart) form, I close The form,</p>
<p>But when the Mainform tries to close the Winpart, it blows up on:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; Private Sub CloseWinPart(ByVal sender As Object, ByVal e As EventArgs)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim part As WinPart = DirectCast(sender, WinPart)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveHandler part.CloseWinPart, AddressOf CloseWinPart<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; part.Visible = False<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SplitContainer1.Panel2.Controls.Remove(part) &#39;&lt;----- Blows up here</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;part.Dispose()</p>
<p>&quot;Cannot bind to the property or column Id on the DataSource.<br />Parameter name: dataMember&quot;</p>
<p>&nbsp;</p>
<p>I can alleviate that issue by Rebinding after all events - such as Save and Close - which I would normally just close the&nbsp;form - that&#39;s what I used to do in CSLA2.x. </p>
<p>Is this normal or is there something I need to do before Closing the form, without rebinding?</p>
<p>Thanks,</p>
<p>Graham&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, February 20, 2012</h2><p>Most likely caused by the Items collection being active in databinding on a ComboBox. </p>
<p>I recommend&nbsp; to unbind combobox items after &lt;bo&gt; i unbound and rebind items before rebind of&nbsp; &lt;bo&gt; . </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Monday, February 20, 2012</h2><p>I wish it was tjhat simple.</p>
<p>The form comprises 2 textboxes and some buttons...</p>
<p>&nbsp;</p>
<p>G.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 20, 2012</h2><p><div style='padding-left: 50px;background-color:silver'><b>gajit<br></b>
<p>I can alleviate that issue by Rebinding after all events - such as Save and Close - which I would normally just close the&nbsp;form - that&#39;s what I used to do in CSLA2.x. </p>
</div></p>
<p>I think the challenges you are facing are due to changes made in 3.0 (2006 or so) designed to highlight bugs in Windows Forms UI code around binding and unbinding.</p>
<p>I made those changes because without them, most UI code was wrong, and nobody knew it was wrong other than many people&#39;s programs would &quot;randomly&quot; fail.</p>
<p>I fully appreciate your frustration. A whole lot of people have hit these same challenging issues over the past several years since 3.0 came out.</p>
<p>The core rule is simple: you must unbind your object graph from the UI before manipulating it in code.</p>
<p>Windows Forms data binding assumes <em>total ownership</em> of the object graph as long as it is bound. I fought that, and fought that, but ultimately just couldn&#39;t win. So all we can do is live with the reality.</p>
<p>Sadly, unbinding isn&#39;t trivial (unless you have just a single object). This is because you must understand and accommodate the way Windows Forms data binding handles currency. Every binding source has <em>currency</em>, and whatever object is current will have an elevated edit level. It is up to you to lower that edit level after unbinding.</p>
<p>To make that more &quot;fun&quot;, there are differences between parent and child binding source objects.</p>
<p>All this is detailed in the <em>Using CSLA .NET 3.0</em> ebook in some detail.</p>
<p>The <em>Expert 2008 Business Objects</em> book has some content that discusses some helper types we added to the framework around the year 2008 to help ease this unbinding process.</p>
<p>I do plan to update the WfUI project to use those helpers when I get time, but I haven&#39;t done WinForms work for a few years, so I need to relearn how all that stuff works myself...</p>
<p>Just at the moment I&#39;m in the middle of a bunch of travel for work, the 4.3 release, and some potentially very serious family health issues. If the health issues take a bad turn (which sadly seems likely) I may go dark for some time to deal with everything involved.</p>
<p>In other words, don&#39;t hold your breath for the WfUI changes - the existing code may have to suffice.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Tuesday, February 21, 2012</h2><p>Thanks Rocky - I appreciate you taking the time to explain.</p>
<p>I have the 2008 book so I&#39;ll have a quick scan over that. I think my UI code probably originated from the 2005 book, so it could probably do with freshening up anyway.</p>
<p>It is frustrating, but I&#39;m sure I&#39;ll get there - I&#39;ve made significant progress in the last week with your help and Jonny&#39;s, so I&#39;m confident I&#39;ll be &quot;off to the races&quot; very soon.</p>
<p>I wish you well with the family health issues - I don&#39;t think anyway would expect you to do anything else.</p>
<p>Thanks again,</p>
<p>Graham</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
