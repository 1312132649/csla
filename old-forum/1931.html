<html><header><title>IsDirty question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsDirty question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1931.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan posted on Friday, December 08, 2006</h2>I have a UserRole object that I want to add to my collection of UserRoles if there currently isn't an instance of the UserRole object for a particular UserID.&nbsp; If there is an instance for a UserID, I want to simply update the UserRole object and persist it to the database.&nbsp; Straightforward stuff.&nbsp; The problem I'm having is that the BusinessListBase doesn't recognize the object as having been changed; consequently, it doesn't get persisted to the database.&nbsp; How can I "force" the object to be dirty in order for me to save the change?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Friday, December 08, 2006</h2>If the object does not exist call MarkNew, if the object does exist you
can call MarkDirty or modify one of the Public Properties that
implements PropertyHasChanged.<br>
<br>
There is also an overloaded method of of Save that allows you to force
an update to the database.&nbsp; I am assuming you are using 2.1<br>
<br>
Mike<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Friday, December 08, 2006</h2><P>My UserRoles object inherits from the BusinessListBase class and the UserRole objects from BusinessBase.</P>
<P>I noticed the overloaded method of Save in the BusinessBase class, but can't find anything similar to it in the BusinessListBase class.&nbsp; Merely copying it over won't work since IsNew, MarkOld and MarkDirty aren't defined in the BusinessListBase class context either.&nbsp; Since they aren't available there, I'm unable to call them from the UI code.</P>
<P>Any other suggestions?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Friday, December 08, 2006</h2>In the IsDirty method of the BusinessListBase it checks to see if any children are dirty, if they are it returns true.&nbsp; So it should be enough to mark the UserRole object as dirty for the list to be dirty.&nbsp; <br>In addition, when you call save on the BusinessListBase it checks to see if the IsDirty flag is set to true.&nbsp; If the flag is set to true then the DataPortal.Update of the BusinessListBase class is called.&nbsp; In this method you should cycle through each child in the list and save the records if necessary.<br><br>Hope that helps.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Friday, December 08, 2006</h2>I must be dense today or it's the pressure I'm under, but I can't set the IsDirty flag to true from the UI code nor is MarkDirty available in it for me to use.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 08, 2006</h2>That's how it should be.<br><br>An object marks itself as dirty, the UI should not be able to directly modify that part of the state.<br><br>IsDirty is typically set in the property setters, via a call to PropertyHasChanged, which, besides raising a PropertyChanged event, updates the IsDirty flag and causes rules for that property to be run.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Friday, December 08, 2006</h2><P>The new value is getting set in the property setter, but it still doesn't get persisted to the database.&nbsp; First thing I do is check if the UserID already exists in the UserRoles object; if it doesn't, I perform an AddNew, set the values and Save.&nbsp; If the UserID does exist, I return the UserRole object, modify the RoleID for it, and try to update the object.&nbsp; Still, the UserRules object doesn't recognize that UserRole object is now dirty so the check for IsDirty in Update returns without doing anything.</P>
<P>I don't know why this is giving me so much trouble.&nbsp; I have other updates throughout my application, but none of them inherit from the BusinessListBase class.&nbsp; Maybe if I revert to inheriting from BusinessBase...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Friday, December 08, 2006</h2><P>Have you set the business list to check the children's dirty status and have you set the child to MarkOld&nbsp; in the fetch command ?</P>
<P>Just to clarify, is the new UserID being save to the database or is it the updated one saving correctly&nbsp; or neither</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Friday, December 08, 2006</h2><P>New user roles are being persisted to the database; updated user roles weren't, but you got me pointed in the right direction.&nbsp; As is the case so many times, and especially when time is tight, I couldn't see the tree for the forest.&nbsp; In this case, I neglected to override the Fetch command so I could pass in the User ID.&nbsp; Anyway, I have it working correctly now.&nbsp; Thanks!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Sunday, December 10, 2006</h2>Pleasure to be of assistance.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
