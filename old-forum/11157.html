<html><header><title>&quot;SecurityException&quot; when trying to log in to a Windows Phone application</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>&quot;SecurityException&quot; when trying to log in to a Windows Phone application</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11157.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>itogroup posted on Tuesday, February 14, 2012</h2><p>I think this is stemming from a WCF config error, as I vaugely recall having similar issues when setting up my Windows Forms project. As I recall, WCF won&#39;t let you send a password across the wire unless the wire is secured. I&#39;m hoping someone out there has experience with WCF/WP7 and can spot/point out an error.</p>
<p>The exception is raised when I call DataPortal.BeginFetch on my custom Identity type. The stack trace is below:</p>
<p>&nbsp;&nbsp; at System.Runtime.Serialization.DataContract.DataContractCriticalHelper.CreateDataContract(Int32 id, RuntimeTypeHandle typeHandle, Type type)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContract.DataContractCriticalHelper.GetDataContractSkipValidation(Int32 id, RuntimeTypeHandle typeHandle, Type type)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContract.GetDataContractSkipValidation(Int32 id, RuntimeTypeHandle typeHandle, Type type)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContract.GetDataContract(RuntimeTypeHandle typeHandle, Type type, SerializationMode mode)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerContext.GetDataContract(RuntimeTypeHandle typeHandle, Type type)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiType(XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle objectTypeHandle, Type objectType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle, Type declaredType)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerializeReference(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Reflection.RuntimeMethodInfo.InternalInvoke(RuntimeMethodInfo rtmi, Object obj, BindingFlags invokeAttr, Binder binder, Object parameters, CultureInfo culture, Boolean isBinderDefault, Assembly caller, Boolean verifyAccess, StackCrawlMark&amp; stackMark)<br />&nbsp;&nbsp; at System.Reflection.RuntimeMethodInfo.InternalInvoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, StackCrawlMark&amp; stackMark)<br />&nbsp;&nbsp; at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.InternalSerialize(MethodInfo methodInfo, Object memberValue, Type memberType, Boolean writeXsiType, XmlObjectSerializerWriteContext context, XmlWriterDelegator xmlWriter)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.WriteValue(Type memberType, Object memberValue, Boolean writeXsiType, XmlObjectSerializerWriteContext context, XmlWriterDelegator xmlWriter)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.WriteMember(SerializingObject serObj, Int32 memberIndex, ClassDataContract derivedMostClassContract)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.WriteClass(CallStackElement`1 callStackElement)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.Serialize(XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlFormatWriter.InitializeCallStack(XmlWriterDelegator xmlWriterDel, Object obj, XmlObjectSerializerWriteContext writeContext, DataContract contract)<br />&nbsp;&nbsp; at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContractSerializer.WriteObject(XmlWriter writer, Object graph)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(XmlWriter writer, Object graph)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(Stream serializationStream, Object graph)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(Object obj)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.BeginFetch(Object criteria, Object userState)<br />&nbsp;&nbsp; at Csla.DataPortal`1.BeginFetch(Object criteria, Object userState)<br />&nbsp;&nbsp; at Csla.DataPortal.BeginFetch[T](Object criteria, EventHandler`1 callback, Object userState)<br />&nbsp;&nbsp; at Csla.DataPortal.BeginFetch[T](Object criteria, EventHandler`1 callback)<br />&nbsp;&nbsp; at Harld.Data.HarldIdentity.BeginGetStaff(String username, String password, EventHandler`1 callback)<br />&nbsp;&nbsp; at Harld.Data.HarldPrincipal.BeginLogin(String username, String password, Action`1 completed)<br />&nbsp;&nbsp; at Harld.Client.Mobile.v4.ViewModels.Login.LoginUser()<br />&nbsp;&nbsp; at Harld.Client.Mobile.v4.Views.Login.LoginButton_Click(Object sender, EventArgs e)<br />&nbsp;&nbsp; at Microsoft.Phone.Shell.ApplicationBarItemContainer.FireEventHandler(EventHandler handler, Object sender, EventArgs args)<br />&nbsp;&nbsp; at Microsoft.Phone.Shell.ApplicationBarIconButton.ClickEvent()<br />&nbsp;&nbsp; at Microsoft.Phone.Shell.ApplicationBarIconButtonContainer.ClickEvent()<br />&nbsp;&nbsp; at Microsoft.Phone.Shell.ApplicationBar.OnCommand(UInt32 idCommand)<br />&nbsp;&nbsp; at Microsoft.Phone.Shell.Interop.NativeCallbackInteropWrapper.OnCommand(UInt32 idCommand)</p>
<p>&nbsp;</p>
<p>Here&#39;s the service model chunk of the app.config from my Windows Forms project (this configuration works with our server config):</p>
<p>&nbsp;&nbsp;&nbsp; &lt;system.serviceModel&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;client&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;endpoint name=&quot;HarldWcfDataPortal&quot; address=&quot;https://saservices.case.edu:4443/WcfPortal.svc&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; bindingConfiguration=&quot;BasicSslBinding&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/client&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;bindings&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;basicHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;binding name=&quot;BasicSslBinding&quot; maxReceivedMessageSize=&quot;2147483647&quot; maxBufferPoolSize=&quot;2147483647&quot; receiveTimeout=&quot;00:01:00&quot; sendTimeout=&quot;00:01:00&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;security mode=&quot;Transport&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;message clientCredentialType=&quot;UserName&quot; algorithmSuite=&quot;Default&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/security&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;readerQuotas maxDepth=&quot;2147483647&quot; maxStringContentLength=&quot;2147483647&quot; maxArrayLength=&quot;2147483647&quot; maxBytesPerRead=&quot;2147483647&quot; maxNameTableCharCount=&quot;2147483647&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/binding&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/basicHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/bindings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/system.serviceModel&gt;</p>
<p>And here&#39;s the code I&#39;ve created in the ctor of App.xaml for my Windows Phone application:</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Csla.DataPortal.ProxyTypeName = typeof(Csla.DataPortalClient.WcfProxy&lt;&gt;).AssemblyQualifiedName;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Csla.DataPortalClient.WcfProxy.DefaultUrl = &quot;https://server:5443/SlPortal.svc&quot;;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BasicHttpBinding binding = new BasicHttpBinding(BasicHttpSecurityMode.Transport);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; binding.Name = &quot;BasicSslBinding&quot;;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; binding.MaxReceivedMessageSize = 2147483647;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; binding.MaxBufferSize = 2147483647;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; binding.ReceiveTimeout = new TimeSpan(0, 1, 0);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; binding.SendTimeout = new TimeSpan(0, 1, 0);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Csla.DataPortalClient.WcfProxy.DefaultBinding = binding;</p>
<p>NOTE: My windows form project includes a custom subclass of WcfProxy. If I try to link the proxy class into the Silverlight business objects library, I can&#39;t subclass WcfProxy (it&#39;s static) </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 14, 2012</h2><p>In Silverlight you subclass WcfProxy&lt;T&gt; to get the same result as in .NET.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>itogroup replied on Wednesday, February 15, 2012</h2><p>If I do </p>
<p>public class HarldWcfProxy : WcfProxy&lt;HarldWcfProxy&gt; </p>
<p>I get &quot;The type &#39;Harld.Data.HarldWcfProxy&#39; cannot be used as type parameter &#39;T&#39; in the generic type or method &#39;Csla.DataPortalClient.WcfProxy&lt;T&gt;&#39;. There is no implicit reference conversion from &#39;Harld.Data.HarldWcfProxy&#39; to &#39;Csla.Serialization.Mobile.IMobileObject&#39;.&quot; </p>
<p>If I try to have HarldWcfProxy implement IMobileObject, I have no idea what to do in GetChildren, GetState, SetChildren, and SetState.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, February 15, 2012</h2><p>The <em>Using CSLA 4: Data Portal Configuration</em> book covers this scenario, including examples.</p>
<p>Your subclass also needs to be generic - HarldWcfProxy&lt;T&gt;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>itogroup replied on Thursday, February 23, 2012</h2><p>I was able to get my proxy working and am making some progress. I believe the SecurityException was due to the fact that I was trying to serialize a nested class. I unnested the class and am able to get past that exception. Now I&#39;m getting:</p>
<p>&nbsp;</p>
<p>Could not load type &#39;Csla.Serialization.SerializableAttribute&#39; from assembly &#39;Csla, Version=4.2.2.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&#39;.</p>
<p>&nbsp;&nbsp; at Harld.Data.Mobile.HarldIdentity.&lt;&gt;c__DisplayClassf.&lt;BeginGetStaff&gt;b__e(Object o, DataPortalResult`1 e)<br />&nbsp;&nbsp; at Csla.DataPortal`1.OnFetchCompleted(DataPortalResult`1 e)<br />&nbsp;&nbsp; at Csla.DataPortal`1.proxy_FetchCompleted(Object sender, DataPortalResult`1 e)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.OnFetchCompleted(DataPortalResult`1 e)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnFetchCompleted(Object state)<br />&nbsp;&nbsp; at System.Reflection.RuntimeMethodInfo.InternalInvoke(RuntimeMethodInfo rtmi, Object obj, BindingFlags invokeAttr, Binder binder, Object parameters, CultureInfo culture, Boolean isBinderDefault, Assembly caller, Boolean verifyAccess, StackCrawlMark&amp; stackMark)<br />&nbsp;&nbsp; at System.Reflection.RuntimeMethodInfo.InternalInvoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, StackCrawlMark&amp; stackMark)<br />&nbsp;&nbsp; at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)<br />&nbsp;&nbsp; at System.Delegate.DynamicInvokeOne(Object[] args)<br />&nbsp;&nbsp; at System.MulticastDelegate.DynamicInvokeImpl(Object[] args)<br />&nbsp;&nbsp; at System.Delegate.DynamicInvoke(Object[] args)<br />&nbsp;&nbsp; at System.Windows.Threading.DispatcherOperation.Invoke()<br />&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.Dispatch(DispatcherPriority priority)<br />&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.OnInvoke(Object context)<br />&nbsp;&nbsp; at System.Windows.Hosting.CallbackCookie.Invoke(Object[] args)<br />&nbsp;&nbsp; at System.Windows.Hosting.DelegateWrapper.InternalInvoke(Object[] args)<br />&nbsp;&nbsp; at System.Windows.RuntimeHost.ManagedHost.InvokeDelegate(IntPtr pHandle, Int32 nParamCount, ScriptParam[] pParams, ScriptParam&amp; pResult)<br /></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, February 23, 2012</h2><p>It is really important to understand how we do serialization in Silverlight, on the phone, and soon in WinRT.</p>
<p>Because those platforms don&#39;t allow full use of reflection, Microsoft was unable to create BinaryFormatter or NetDataContractSerializer for those platforms.</p>
<p>So we ended up creating a rough equivalent that doesn&#39;t require reflection. To do this, we impose certain constraints on the types that can be serialized. Specifically, all types must be primitive .NET types, or must implement IMobileObject (or inherit from one of our base classes).</p>
<p>This is true for all objects in the object graph. All of them. No exceptions.</p>
<p>If you define a class that doesn&#39;t inherit from a CSLA base class, one of the MobileXYZ types in Csla.Core, or directly implement IMobileObject, then you can&#39;t serialize that type through the data portal.</p>
<p>I discuss this in the <em>Using CSLA 4: Data Portal Configuration</em> book, because it is quite important.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
