<html><header><title>Possible breaking change in 3.8.1 for Silverlight - MethodAccessException for AddObjectAuthorizationRules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible breaking change in 3.8.1 for Silverlight - MethodAccessException for AddObjectAuthorizationRules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8027.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Saturday, November 21, 2009</h2>Disclaimer: I'm still trying to piece it all together, so I could be wrong on this. <br /><br />I possibly found an issue which did not exist / happen with 3.7.x, but as soon as I moved to 3.8.0/3.8.1, the runtime issue (described below) started to happen.<br /><br />I'm getting a "System.MethodAccessException" for my Silverlight (Client-side) business objects, specifically on the :<br />"private static void AddObjectAuthorizationRules()" method during deserialisation triggered upon the fetch completed.<br /><br />This only happens once and initially (probably because the method is static). It's not about the code inside that method, since I also get the sam issue with an empty method.<br /><br />If I change the method access to be public, the problem goes away - but that is highly undersireable and not encapsulated.<br /><br />Unless I'm wrong, this method is supposed to be private for object authorization rules.<br /><br />The issue also doesn't happen if there isn't such a method present.<br /><br />What's changed regarding this? It seems like a change in the serialization code.<br /><br />Here is the stack trace:<br />StackTrace:<br />       at System.Reflection.MethodBase.PerformSecurityCheck(Object obj, RuntimeMethodHandle method, IntPtr parent, UInt32 invocationFlags)<br />       at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)<br />       at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)<br />       at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)<br />       at Csla.Security.ObjectAuthorizationRules.GetRoles(Type objectType)<br />       at Csla.Security.AuthorizationRules.GetAllowEditRoles(Type objectType)<br />       at Csla.Security.AuthorizationRules.CanEditObject(Type objectType)<br />       at Csla.Silverlight.CslaDataProvider.RefreshCanOperationsValues()<br />       at Csla.Silverlight.CslaDataProvider.set_IsBusy(Boolean value)<br />       at Csla.Silverlight.CslaDataProvider.SetError(Exception value)<br />       at Csla.Silverlight.CslaDataProvider.RaiseDataChangedEvents()<br />       at Csla.Silverlight.CslaDataProvider.b__0(DependencyObject o, DependencyPropertyChangedEventArgs e)<br />       at System.Windows.DependencyObject.RaisePropertyChangeNotifications(DependencyProperty dp, Object newValue, Object oldValue)<br />       at System.Windows.DependencyObject.SetValueInternal(DependencyProperty dp, Object value, Boolean allowReadOnlySet, Boolean isSetByStyle, Boolean isSetByBuiltInStyle, PropertyInvalidationReason reason)<br />       at System.Windows.DependencyObject.SetValueInternal(DependencyProperty dp, Object value)<br />       at System.Windows.DependencyObject.SetValue(DependencyProperty dp, Object value)<br />       at Csla.Silverlight.CslaDataProvider.set_ObjectInstance(Object value)<br />       at Pragma.OnKey.Express.Silverlight.UI.WorkOrder.Feedback.<>c__DisplayClass4.b__1(Object workOrderSender, DataPortalResult`1 workOrderFetchCallback)<br />       at Csla.DataPortal`1.OnFetchCompleted(DataPortalResult`1 e)<br />       at Csla.DataPortal`1.proxy_FetchCompleted(Object sender, DataPortalResult`1 e)<br />       at Csla.DataPortalClient.WcfProxy`1.OnFetchCompleted(DataPortalResult`1 e)<br />       at Csla.DataPortalClient.WcfProxy`1.proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Sunday, November 22, 2009</h2>I am pretty certain this existed in 3.7 as well.  This is not a bug though.  The reason for this behavior is that reflection in Silverlight is limited to public method calls, so in Silverlight you have to make this method public.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br /><br />-----Original Message-----<br />From: Jaans [mailto:cslanet@lhotka.net] <br />Sent: Sunday, November 22, 2009 12:47 AM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] Possible breaking change in 3.8.1 for Silverlight - MethodAccessException for AddObjectAuthorizationRules<br /><br />Disclaimer: I'm still trying to piece it all together, so I could be wrong on this. <br /><br />I possibly found an issue which did not exist / happen with 3.7.x, but as soon as I moved to 3.8.0/3.8.1, the runtime issue (described below) started to happen.<br /><br />I'm getting a "System.MethodAccessException" for my Silverlight (Client-side) business objects, specifically on the :<br />"private static void AddObjectAuthorizationRules()" method during deserialisation triggered upon the fetch completed.<br /><br />This only happens once and initially (probably because the method is static). It's not about the code inside that method, since I also get the sam issue with an empty method.<br /><br />If I change the method access to be public, the problem goes away - but that is highly undersireable and not encapsulated.<br /><br />Unless I'm wrong, this method is supposed to be private for object authorization rules.<br /><br />The issue also doesn't happen if there isn't such a method present.<br /><br />What's changed regarding this? It seems like a change in the serialization code.<br /><br />Here is the stack trace:<br />StackTrace:<br />       at System.Reflection.MethodBase.PerformSecurityCheck(Object obj, RuntimeMethodHandle method, IntPtr parent, UInt32 invocationFlags)<br />       at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)<br />       at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)<br />       at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)<br />       at Csla.Security.ObjectAuthorizationRules.GetRoles(Type objectType)<br />       at Csla.Security.AuthorizationRules.GetAllowEditRoles(Type objectType)<br />       at Csla.Security.AuthorizationRules.CanEditObject(Type objectType)<br />       at Csla.Silverlight.CslaDataProvider.RefreshCanOperationsValues()<br />       at Csla.Silverlight.CslaDataProvider.set_IsBusy(Boolean value)<br />       at Csla.Silverlight.CslaDataProvider.SetError(Exception value)<br />       at Csla.Silverlight.CslaDataProvider.RaiseDataChangedEvents()<br />       at Csla.Silverlight.CslaDataProvider.b__0(DependencyObject o, DependencyPropertyChangedEventArgs e)<br />       at System.Windows.DependencyObject.RaisePropertyChangeNotifications(DependencyProperty dp, Object newValue, Object oldValue)<br />       at System.Windows.DependencyObject.SetValueInternal(DependencyProperty dp, Object value, Boolean allowReadOnlySet, Boolean isSetByStyle, Boolean isSetByBuiltInStyle, PropertyInvalidationReason reason)<br />       at System.Windows.DependencyObject.SetValueInternal(DependencyProperty dp, Object value)<br />       at System.Windows.DependencyObject.SetValue(DependencyProperty dp, Object value)<br />       at Csla.Silverlight.CslaDataProvider.set_ObjectInstance(Object value)<br />       at Pragma.OnKey.Express.Silverlight.UI.WorkOrder.Feedback.<>c__DisplayClass4.b__1(Object workOrderSender, DataPortalResult`1 workOrderFetchCallback)<br />       at Csla.DataPortal`1.OnFetchCompleted(DataPortalResult`1 e)<br />       at Csla.DataPortal`1.proxy_FetchCompleted(Object sender, DataPortalResult`1 e)<br />       at Csla.DataPortalClient.WcfProxy`1.OnFetchCompleted(DataPortalResult`1 e)<br />       at Csla.DataPortalClient.WcfProxy`1.proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Sunday, November 22, 2009</h2>Thanks Sergey<br /><br />I forgot that reflection of private members isn't allowed in Silverlight - so the exception makes sense and seems legitimate.<br /><br />What is strange is that I have had the exact same code running on CSLA 3.7.2 and 3.8.0 Alpha and Alpha 2 which didn't give me the exception.<br /><br />I guess it could be that it's been there since before and that the exception didn't get thrown or didn't bubble to the client as it does now.<br /><br />Perhaps the exception was masked somewhere and recent changes to the serialization code fixed it??<br /><br />Or perhaps the previous code didn't actually call the AddObjectAuthorizationRules() method on the Silverlight client, never causing the exception to begin with.<br /><br />Anyway... the bottom line is that CSLA 3.8.1 looks to be working as should and that's the important bit.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
