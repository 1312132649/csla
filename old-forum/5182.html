<html><header><title>RunLocal vs. custom data portal proxy</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>RunLocal vs. custom data portal proxy</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5182.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner posted on Thursday, July 31, 2008</h2><P>Greetings,</P>
<P>I'm running into&nbsp;the situation where some objects need to use remoting, and others need to run locally. Reading the threads on this, it seems it can be done either with the RunLocal attribute or creating your own custom data portal proxy.</P>
<P>Is there much of a difference between the two approaches? I'm trying to decide the best route to take.</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 31, 2008</h2>Well I'd say go with the RunLocal attribute.&nbsp; It's easy, and that's all you have to do it remember to add it in.&nbsp; The custom proxy is going to require you to build some code, which may not be difficult, but is almost re-inventing the wheel.&nbsp; Also, it's more for your to maintain and test.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2>Thanks for the reply. That's what I was leaning towards too, like you said, it's easy. Just wasn't sure if I was missing something with the custom proxy. I guess my needs just don't warrant that.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, July 31, 2008</h2><P><FONT face=Tahoma size=2>If you have control over all your object's code, using the "RunLocal" attribute is the technically easier option, since you're leveraging already-written-and-supported code.&nbsp; But depending on the number of objects that have to run locally,&nbsp;it may be&nbsp;more code to deal with - after all, you have to add that attribute to every DP_ method in&nbsp;every class that runs locally.</FONT></P>
<P><FONT face=Tahoma size=2>The custom DataPortal proxy is a more centralized solution, and can make your BO's cleaner, as you don't have to sprinkle attributes all over.&nbsp; But it also adds to your code base, and to your configuration overhead.&nbsp; Since all you want to do is route to a pre-defined proxy, your custom proxy code is pretty simple.&nbsp; If you write the custom proxy, you have to maintain it as you migrate through versions of CSLA.&nbsp; But like I said, the code is fairly simple, and I don't see Rocky changing the DataPortal design to a point where the code you have to write goes up substantially.</FONT></P>
<P><FONT face=Tahoma size=2>So the difference is really between writing code and not writing code.&nbsp; I don't know if we can give a "best route" recommendation.&nbsp; To me, it's&nbsp;a kind of&nbsp;apples-and-oranges comparison.&nbsp; I'd look more at your comfort level for writing and maintaining "infrastructure code" - even relatively simple stuff like this - versus using what the framework already gives you.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2><P>Thanks Scott, that's some good info there. Always trade-offs. At least we have options, which is great. And I do have control over all of the objects.</P>
<P>Allow me a follow up question. Should we decide to go the custom proxy route, the proxy would have to determine somehow whether to use remoting or go local. I know I need to re-read chapter 4 before getting into that. But how do people actually implement that? Wouldn't we need an attribute on the methods (or something similar) so the proxy would know which one to use?</P>
<P>I guess I'm a little concerned that it would be easy to forget to put the RunLocal attribute on a method, although testing would find that pretty quickly.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, July 31, 2008</h2><FONT size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Michael Hildner:</strong></div><div></FONT> 
<P><FONT size=2>Thanks Scott, that's some good info there. Always trade-offs. At least we have options, which is great. And I do have control over all of the objects.</FONT></P>
<P><FONT size=2>Allow me a follow up question. Should we decide to go the custom proxy route, the proxy would have to determine somehow whether to use remoting or go local. I know I need to re-read chapter 4 before getting into that. But how do people actually implement that? Wouldn't we need an attribute on the methods (or something similar) so the proxy would know which one to use?</FONT></P>
<P><FONT size=2>I guess I'm a little concerned that it would be easy to forget to put the RunLocal attribute on a method, although testing would find that pretty quickly.</FONT></P>
<P><FONT size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>Well... I haven't seen anyone list a specific implementation, but I can think of a couple.&nbsp; The concept is the same,&nbsp;with the choice&nbsp;of whether you want to decorate your objects with attributes or enter configuration information.&nbsp; Note that I'm going off your original description about entire objects being local or remote, and not just individual DP_ methods.&nbsp; If it's individual methods, you might as well use RunLocal().</FONT></P>
<P><FONT face=Tahoma size=2>First off, your custom proxy would be a local one - after all, there's no reason to go to the server just to find out you have to try and come back and launch the local process.&nbsp; I'm not even sure how you'd do that...</FONT></P>
<P><FONT face=Tahoma size=2>In any event, one option would be to create a custom attribute that you decorate your BO's with.&nbsp; The DP methods either receive an object type or the object itself, from which the type can be retrieved.&nbsp; You then reflect across the type and see whether it's decorated with that attribute.&nbsp; Whether you mark the local objects or the remote objects is up to you, but you then create a proxy of the correct type based on that attribute and delegate the call.&nbsp; Since it's your own attribute, you can make it inheritable if you want, thus avoiding the need to put it on subclasses.&nbsp; But you still should be able to override the inherited attribute on specific subclasses if you want.</FONT></P>
<P><FONT face=Tahoma size=2>Another option is to create a configuration file (or put configuration entries into your existing configuration file) and house the information there.&nbsp; Again, you're storing by type, and you can either create a complete catalog of types, or only the types of one category.&nbsp; Conceptually, the code for this solution is the same as the attribute-based one - it's just the source for the decision tree that's different.&nbsp; Inherited behavior&nbsp;is a little trickier here, as you don't really have facilities for .NET to walk the inheritance tree for you.&nbsp; But you can certainly walk the inheritance tree manually.</FONT></P>
<P><FONT face=Tahoma size=2>You also could create your delegated proxies in your proxy constructor and cache them, thus saving you the overhead of creating a proxy each time.&nbsp; I believe CSLA caches the proxy object that it uses, and you really do only need one of each.</FONT></P>
<P><FONT face=Tahoma size=2>Obviously, choosing the configuration-based route means you have to distribute that information to the machines, whereas an attribute is baked into your code.&nbsp; But the configuration file allows for changes without needing a re-deployment.</FONT></P>
<P><FONT face=Tahoma size=2>One thing to consider is that this scheme wouldn't work if you have objects that could run in either location.&nbsp; However, managing something like that&nbsp;would be non-trivial, and perhaps not possible, within the context of a DataPortal proxy.&nbsp; But I also can't think of a situation where you'd want to do that outside of using RunLocal() on specific DP methods.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tmg4340:</strong></div><div>
<P><FONT face=Tahoma size=2>One thing to consider is that this scheme wouldn't work if you have objects that could run in either location.&nbsp; However, managing something like that&nbsp;would be non-trivial, and perhaps not possible, within the context of a DataPortal proxy.&nbsp; But I also can't think of a situation where you'd want to do that outside of using RunLocal() on specific DP methods.</FONT></P>
<P>
<P><FONT face=Tahoma size=2></FONT></P></div></BLOCKQUOTE></P>
<P>Scott, are you saying that&nbsp;the configuration-based route wouldn't work if you have objects that could run in either location?</P>
<P>One thing we may need to support, and this would be decided per installation, &nbsp;is our libraries need to run either locally or remotely.</P>
<P>I can see where the RunLocal is baked into the code, so we'd need two copies of our libraries. This is why I'm looking into creating a custom proxy.</P>
<P>I really appreciate your information. I'm sure I'll be reading that post a few times as I try to create a custom proxy :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 31, 2008</h2>Hmm... I know this was discussed before, but I can't remember how it worked.&nbsp; I wonder if it would be possible to put the attribute on a base class override of all the DP_ methods.&nbsp; Will the DP look "up" the inheritance chain if it doesn't find an attribute on the direct sub class?&nbsp; Something else to look into.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2>I couldn't find any discussion on the actual implementation, so if anyone knows, or could provide a link, that would be appreciated.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 31, 2008</h2>Fortunately, this was bugging me, and I have some down time.&nbsp; Here's the thread I was refering to:<br><br><a href="/forums/thread/5530.aspx">http://forums.lhotka.net/forums/thread/5530.aspx</a><br><br>So, if you're using 2.1 or higher, it looks like my subclass idea won't work without modifying Csla, which presents its own risks.&nbsp; It's kind of a shame though.. inheriting the attribute would allow the behavior you want (usually runlocal) if accompanied by a RunRemote attribute.&nbsp; Which you could probably add into Csla... but I hesitate to modify Csla too much myself.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan replied on Thursday, July 31, 2008</h2><P>Michael,</P>
<P>You don't say what version of the CSLA you are using, but I just went through this with v2 and it is not possible to use a custom proxy, as the proxy does not know what object it is being run on in the IsServerRemote method, so you cannot return the correct information.&nbsp; You must modify the CSLA code or use the RunLocal attribute.&nbsp; I don't know anything about other versions of the CSLA unfortunately.</P>
<P>For the modifications, I created a RunRemote attribute (copy of RunLocal renamed).&nbsp; I then changed GetDataPortalProxy in DataPortal\Client\DataPortal.vb as follows:</P>
<P><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mLocalPortal </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> DataPortalClient.IDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mRemotePortal </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> DataPortalClient.IDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mPortal </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> DataPortalClient.IDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetDataPortalProxy( _</P>
<P></FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> forceLocal </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> forceRemote </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> DataPortalClient.IDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> forceLocal </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mLocalPortal </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>mLocalPortal = </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DataPortalClient.LocalProxy</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mLocalPortal</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> forceRemote </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mRemotePortal </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>mRemotePortal = </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DataPortalClient.RemotingProxy</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mRemotePortal</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mPortal </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> proxyTypeName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = ApplicationContext.DataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> proxyTypeName = </FONT><FONT color=#a31515 size=2>"Local"</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>mPortal = </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DataPortalClient.LocalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> typeName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = _</P>
<P>proxyTypeName.Substring(0, proxyTypeName.IndexOf(</FONT><FONT color=#a31515 size=2>","</FONT><FONT size=2>)).Trim</P>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> assemblyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = _</P>
<P>proxyTypeName.Substring(proxyTypeName.IndexOf(</FONT><FONT color=#a31515 size=2>","</FONT><FONT size=2>) + 1).Trim</P>
<P>mPortal = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(Activator.CreateInstance(assemblyName, _</P>
<P>typeName).Unwrap, DataPortalClient.IDataPortalProxy)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mPortal</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>I then added a RunRemote method:</FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#000000 size=3><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> RunRemote(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> method </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> MethodInfo) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> Attribute.IsDefined(method, </FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>(RunRemoteAttribute), </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT></FONT></FONT>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>The final code change was to update calls to GetDataPortalProxy:</FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#000000 size=3><FONT size=2>
<P>proxy = GetDataPortalProxy(RunLocal(method), RunRemote(method))</P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Finally, just add the CslaDataPortalUrl entry in your app.config/web.config.&nbsp; Do not put in the CslaDataPortalProxy line.</FONT></FONT></P>
<P><FONT size=3>Jason</FONT></P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Jason Berkan:</strong></div><div>
<P>You don't say what version of the CSLA you are using, but I just went through this with v2 and it is not possible to use a custom proxy, as the proxy does not know what object it is being run on in the IsServerRemote method, so you cannot return the correct information.&nbsp; You must modify the CSLA code or use the RunLocal attribute.&nbsp; I don't know anything about other versions of the CSLA unfortunately.<FONT color=#0000ff size=2><FONT color=#000000 size=3><FONT size=2></P>
<P></FONT></FONT></FONT></div></BLOCKQUOTE></P>
<P>This project is on 2.1.4. I wonder what's the minimum version to be able to use a custom proxy? It's starting to look like we'll have to do this, although it's not an immediate need.</P>
<P>Thanks for posting your code - I may need it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, July 31, 2008</h2><FONT size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Jason Berkan:</strong></div><div></FONT>
<P><FONT size=2>You don't say what version of the CSLA you are using, but I just went through this with v2 and it is not possible to use a custom proxy, as the proxy does not know what object it is being run on in the IsServerRemote method, so you cannot return the correct information.&nbsp; You must modify the CSLA code or use the RunLocal attribute.&nbsp; I don't know anything about other versions of the CSLA unfortunately.</FONT></P><FONT color=#0000ff><FONT color=#000000>
<P><FONT size=2></FONT></P>
<P></FONT></FONT><FONT size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>I would have to test it out, but there actually might be a way to make this work.</FONT></P>
<P><FONT face=Tahoma size=2>"IsServerRemote" is used by the DataPortal's Create, Fetch, Update, and Delete methods.&nbsp; But it's only&nbsp;used once before the proxy methods are called, and that's to create the DataPortalContext.&nbsp; That context is then passed into your proxy routines, which would pass it along to your delegated proxy classes (which finally pass it to the server DataPortal).&nbsp; There shouldn't be anything stopping you from discarding that DataPortalContext in the proxy routines, creating your own to pass to your delegated proxy object using the proper "IsServerRemote" value, and updating the "IsServerRemote" property so that the DataPortal code after your call has correct info to work with.&nbsp; It's a slight duplication of the code in the client DataPortal object, but it shouldn't hurt anything, and it's not very labor-intensive code.</FONT></P>
<P><FONT face=Tahoma size=2>There are two monkey wrenches to this.&nbsp; One, the "DataPortalInvoke" and "DataPortalInvokeComplete" events would not have the correct DataPortalContext objects to provide to event consumers.&nbsp; Two, in version 3.0+, you would potentially lose the auto-cloning code in the Update method, or possibly invoke it when you don't&nbsp;want it.</FONT></P>
<P><FONT face=Tahoma size=2>I'm certainly not going to call this a "recommended practice".&nbsp; But if you can live with the consequences of this technique, this should work.&nbsp; That may be a big "if".</FONT></P>
<P><FONT size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Michael Hildner:</strong></div><div></FONT></P>
<P></P>
<P><FONT size=2>Scott, are you saying that&nbsp;the configuration-based route wouldn't work if you have objects that could run in either location?</FONT></P>
<P><FONT size=2>One thing we may need to support, and this would be decided per installation, &nbsp;is our libraries need to run either locally or remotely.</FONT></P>
<P><FONT size=2>I can see where the RunLocal is baked into the code, so we'd need two copies of our libraries. This is why I'm looking into creating a custom proxy.</FONT></P>
<P><FONT size=2>I really appreciate your information. I'm sure I'll be reading that post a few times as I try to create a custom proxy :)</FONT></P>
<P><FONT size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>The configuration-based solution would work so long as you don't have to mix locations <EM>within the same installation.</EM>&nbsp; If the location is the same throughout the application installation, but different installations have different requirements, then the configuration-based solution should work just fine - and it's the one I'd go with.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan replied on Thursday, July 31, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tmg4340:</strong></div><div>
<P><FONT face=Tahoma size=2>"IsServerRemote" is used by the DataPortal's Create, Fetch, Update, and Delete methods.&nbsp; But it's only&nbsp;used once before the proxy methods are called, and that's to create the DataPortalContext.&nbsp; That context is then passed into your proxy routines, which would pass it along to your delegated proxy classes (which finally pass it to the server DataPortal).&nbsp; There shouldn't be anything stopping you from discarding that DataPortalContext in the proxy routines, creating your own to pass to your delegated proxy object using the proper "IsServerRemote" value, and updating the "IsServerRemote" property so that the DataPortal code after your call has correct info to work with.&nbsp; It's a slight duplication of the code in the client DataPortal object, but it shouldn't hurt anything, and it's not very labor-intensive code.</FONT></P>
<P>
<P><FONT face=Tahoma size=2></FONT></P></div></BLOCKQUOTE></P>
<P>Where were you two days ago?&nbsp; :)</P>
<P>This definitely does work, with the small concerns that you pointed out.&nbsp; I currently do not have any code executing in the events, so it does not matter that the DataPortalContext is wrong.&nbsp; The proxy I created is posted below - it's nothing earth shattering.&nbsp; I had to copy in a couple of CSLA methods to make the code work, and I could not get my RunRemote attribute to work, but that may just be an assembly issue.&nbsp; For testing, I hardcoded in the name of my library that should be run remotely.</P>
<P><FONT color=#0000ff size=2>Imports</FONT><FONT size=2> Csla</P></FONT><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MyDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> DataPortalClient.IDataPortalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mLocalProxy </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DataPortalClient.LocalProxy</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mRemotingProxy </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DataPortalClient.RemotingProxy</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> IsServerRemote() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> Csla.DataPortalClient.IDataPortalProxy.IsServerRemote</P>
<P></FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' Default to running locally, and we will create a new DataPortalContext if we</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' need to run the method remotely.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> Create(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> objectType </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Type, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> context </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalContext) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalResult </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> Csla.Server.IDataPortalServer.Create</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> RunRemote(objectType) = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dpContext </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Server.DataPortalContext(GetPrincipal, </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mRemotingProxy.Create(objectType, criteria, dpContext)</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mLocalProxy.Create(objectType, criteria, context)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> Delete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> context </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalContext) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalResult </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> Csla.Server.IDataPortalServer.Delete</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> RunRemote(GetObjectType(criteria)) = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dpContext </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Server.DataPortalContext(GetPrincipal, </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mRemotingProxy.Delete(criteria, dpContext)</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mLocalProxy.Delete(criteria, context)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> objectType </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Type, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> context </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalContext) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalResult </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> Csla.Server.IDataPortalServer.Fetch</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> RunRemote(objectType) = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dpContext </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Server.DataPortalContext(GetPrincipal, </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mRemotingProxy.Fetch(objectType, criteria, dpContext)</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mLocalProxy.Fetch(objectType, criteria, context)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> Update(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> obj </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> context </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalContext) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Server.DataPortalResult </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> Csla.Server.IDataPortalServer.Update</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> RunRemote(obj.GetType) = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dpContext </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Server.DataPortalContext(GetPrincipal, </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mRemotingProxy.Update(obj, dpContext)</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mLocalProxy.Update(obj, context)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> RunRemote(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> objectType </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Type) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> objectType.FullName.StartsWith(</FONT><FONT color=#a31515 size=2>"RemotingLibrary"</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#008000 size=2>'Return Attribute.IsDefined(objectType, GetType(RunRemoteAttribute), False)</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetObjectType(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> criteria.GetType.IsSubclassOf(</FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>(CriteriaBase)) </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' get the type of the actual business object</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' from CriteriaBase </P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(criteria, CriteriaBase).ObjectType</P>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' get the type of the actua. l business object</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' based on the nested class scheme in the book</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> criteria.GetType.DeclaringType</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetPrincipal() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Security.Principal.IPrincipal</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> ApplicationContext.AuthenticationType = </FONT><FONT color=#a31515 size=2>"Windows"</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' Windows integrated security </P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' we assume using the CSLA framework security</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> ApplicationContext.User</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT></P>
<P>Jason<FONT color=#0000ff size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, July 31, 2008</h2><P><FONT face=Tahoma size=2>Well... a couple of days ago, I was figuring that Rocky knew best about his framework.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P>
<P><FONT face=Tahoma size=2>I'm still not guaranteeing that this concept doesn't have any unforeseen hiccups.&nbsp; Fortunately, the two issues I mentioned aren't a problem for you, but they very well could be for other folks.&nbsp; And without modifying CSLA code, I don't see any way around them.</FONT></P>
<P><FONT face=Tahoma size=2>I didn't take&nbsp;a hard look at your code, but I did notice one thing that you really should change.&nbsp; Your default value of "False" for IsServerRemote is fine, but if you do end up using the RemotingProxy, you should change that property value to "True".&nbsp; There is code after the DP methods that relies on that property, and you want that to work like it's supposed to.&nbsp; If you just add a backing field for IsServerRemote, you can easily take care of this.&nbsp; That way, the context objects flow correctly when you do make a remote call.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan replied on Friday, August 01, 2008</h2><P>Good catch.&nbsp; I was throwing the code together pretty fast yesterday, as I wanted to see if it would work or not, and my simple tests didn't rely on IsServerRemote being correct after the dataportal call.</P>
<P>Thanks for your help.</P>
<P>Jason</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jeff replied on Thursday, July 31, 2008</h2>Here's a very simple "switchable" data portal proxy that I'm using. Just drop it in your project and change your config file to reference SwitchableDataPortalProxy rather then RemotingProxy. If certain classes are always local vs remote then definitely use the attributes, but this class here will work for arbitrarily switching at runtime (I didn't read the whole thread but FWIW this might be useful):<br><br>&nbsp;&nbsp;&nbsp; public class SwitchableDataPortalProxy : IDataPortalProxy<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static bool UseLocalDataPortal = false;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Fetch(Type objectType, object criteria, DataPortalContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Fetch(objectType, criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Fetch(objectType, criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Create(Type objectType, object criteria, DataPortalContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Create(objectType, criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Create(objectType, criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Update(object obj, DataPortalContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Update(obj, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Update(obj, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Delete(object criteria, DataPortalContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Delete(criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Delete(criteria, context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, July 31, 2008</h2>Hey, thanks Jeff. I was just about to start writing one of these, so you saved me some time.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, November 12, 2010</h2><p>.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, November 12, 2010</h2><p>&nbsp;</p>
<p><div style='padding-left: 50px;background-color:silver'><b>jeff<br></b>Here&#39;s a very simple &quot;switchable&quot; data portal proxy that I&#39;m using. Just drop it in your project and change your config file to reference SwitchableDataPortalProxy rather then RemotingProxy. If certain classes are always local vs remote then definitely use the attributes, but this class here will work for arbitrarily switching at runtime (I didn&#39;t read the whole thread but FWIW this might be useful):<br /><br />&nbsp;&nbsp;&nbsp; public class SwitchableDataPortalProxy : IDataPortalProxy<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static bool UseLocalDataPortal = false;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Fetch(Type objectType, object criteria, DataPortalContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Fetch(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Fetch(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Create(Type objectType, object criteria, DataPortalContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Create(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Create(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Update(object obj, DataPortalContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Update(obj, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Update(obj, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DataPortalResult Delete(object criteria, DataPortalContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (UseLocalDataPortal)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new LocalProxy().Delete(criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new RemotingProxy().Delete(criteria, context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; } </p>
<div style="CLEAR:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p>I&nbsp;know this post is really old, but I&#39;ve run into the same requirement: switching remote vs local at runtime. </p>
<p>It seems to me that the above code would cause threading issues with the UseLocalDataPortal field being static. Plus, Isn&#39;t the proxy cached for performance? How bad of a performance cost would ctoring a new proxy for each dataportal request cause?&nbsp;I suppose I could just&nbsp;ctor a member variable like the VB code above&nbsp;does for that...</p>
<p>Also, I see the caveats that tmg4340 notes. If the dataportalcontext thinks it&#39;s local, but the proxy then executes fetch remotely, what are the consequences to that? </p>
<p>From the looks of it, it seems that I will have to make sure to set the dataportalcontext isremote based on the objecttype when passed to IDataPortalProxy methods - otherwise, the application context wiill not get set once on the remote server, correct? But wait...&nbsp;that property is readonly on the dataportal context....&nbsp;Also, it seems that any dataportalinvoke events might not have the correct isremote value... am I on the right track here to understanding this? Is there something I&#39;m missing?</p>
<p>I thought about creating my own RunRemote attribute, but it would seem silly to duplicate the caching efforts of the DataPortalMethodInfo cache that csla does for me, and I don&#39;t want to mess with customizing the framework for sure... </p>
<p>Besides all that, is there a newer, better way than to just create a custom proxy like this?</p>
<p>btw, I&#39;m using csla 3.8.3</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, November 12, 2010</h2><p>Well the more I analyze the csla framework source, the more dissappointed I&#39;m getting. As to my feable knowledge, it appears there&#39;s simply not a way to do tell Csla to run remote for a single class&nbsp;without sacraficing the loss of the ApplicationContext once passed to the server. I would love to be proven wrong on that because the ApplicationContext is essential for me.</p>
<p>I&#39;ll keep pecking at this, but I&#39;m two steps away from sprinkling RunLocal attributes throughout my project. And I have about 50 objects, so that really sucks. Bummer too, this was the&nbsp;main reason I chose Csla for this particular project (we didn&#39;t know if we&#39;d need remote resources or not for&nbsp;a small handful of&nbsp;items).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, November 12, 2010</h2><p>A custom proxy should solve your problem.</p>
<p>The only trick with a custom proxy like this, is that you need to determine what conditions trigger the use of local vs remote calls. That could be a custom attribute you define, a config lookup based on the type of business object, or anything else you can imagine.</p>
<p>Sure, the default data portal proxies are simple - they are designed to support direct n-tier models. But a custom proxy isn&#39;t that hard to build, and you can do anything you want in that proxy - the possibilities are nearly limitless.</p>
<p>So don&#39;t be discouraged, this isn&#39;t that hard of a problem to solve.</p>
<p>Again, the first and most important question you need to answer, is how will your custom proxy determine which object(s) should be remote vs local.</p>
<p>And a very easy way to do this is with a custom attribute you define that is attached to the business class itself - that&#39;s easy to find.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, November 12, 2010</h2><p>Thanks Rocky, yes, that&#39;s precisely what I&#39;ve built, a custom attribute - I&#39;m just concerned about the dataportalcontext getting messed up like tmg4340 mentions, and in looking at the way the source flows, I do see what he&#39;s getting at... I&#39;ll admit I don&#39;t have a full grasp on some of the inner workings of the framework, but it appears that changing the IsServerRemote on the fly in IDataPortal&#39;s methods may cause breif inconsistancies in the DataportalContext&#39;s IsRemote property. Should I not worry about this?</p>
<p><span style="font-size:x-small;">using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br />using Csla.DataPortalClient;<br />using Csla.Server;</span></p>
<p><span style="font-size:x-small;">namespace Apac.Library.CustomProxy<br />{<br />&nbsp;public class SwitchableDataPortalProxy : IDataPortalProxy<br />&nbsp;{<br />&nbsp;&nbsp;private RemotingProxy _remote = new RemotingProxy();<br />&nbsp;&nbsp;private LocalProxy _local = new LocalProxy();</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public DataPortalResult Fetch(Type objectType, object criteria, DataPortalContext context)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;if (!IsRemote(objectType)) return _local.Fetch(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;else return _remote.Fetch(objectType, criteria, context);<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public DataPortalResult Create(Type objectType, object criteria, DataPortalContext context)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;if (!IsRemote(objectType)) return _local.Create(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;else return _remote.Create(objectType, criteria, context);<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public DataPortalResult Update(object obj, DataPortalContext context)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;if (!IsRemote(obj.GetType())) return _local.Update(obj, context);<br />&nbsp;&nbsp;&nbsp;else return _remote.Update(obj, context);<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public DataPortalResult Delete(Type objectType, object criteria, DataPortalContext context)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;if (!IsRemote(objectType)) return _local.Delete(objectType, criteria, context);<br />&nbsp;&nbsp;&nbsp;else return _remote.Delete(objectType, criteria, context);<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public bool IsRemote(Type objectType)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;if (Env.ApacEnv == EnvSetting.Prod &amp;&amp; Attribute.IsDefined(objectType, typeof(RunRemoteAttribute), false))<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;IsServerRemote = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;return true;<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;return false;<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;public bool IsServerRemote<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;get { return false; }<br />&nbsp;&nbsp;&nbsp;protected set { IsServerRemote = value; }<br />&nbsp;&nbsp;}</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;/// &lt;summary&gt;<br />&nbsp;&nbsp;/// Marks a DataPortal_XYZ method to<br />&nbsp;&nbsp;/// be run on the server for the switchable proxy<br />&nbsp;&nbsp;/// &lt;/summary&gt;<br />&nbsp;&nbsp;[AttributeUsage(AttributeTargets.Class)]<br />&nbsp;&nbsp;public sealed class RunRemoteAttribute: Attribute<br />&nbsp;&nbsp;{</span></p>
<p><span style="font-size:x-small;">&nbsp;&nbsp;}<br />&nbsp;}<br />}<br /></span></p>
<p><span style="font-size:x-small;">
<p>&nbsp;</p>
</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, November 12, 2010</h2><p>If you build your own proxy that looks at your attribute,&nbsp; you should be able to simply call one of the other Csla proxies to do the work.&nbsp; after all, the Simple proxy and the wcf do what you want... your proxy just needs to pick the right one at the right time.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
