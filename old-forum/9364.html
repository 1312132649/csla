<html><header><title>Proper way to validate multiple required properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Proper way to validate multiple required properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9364.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic posted on Wednesday, August 11, 2010</h2><p>I have a class &quot;Conversation&quot; that has a fromMemberId and toMemberId.</p>
<p>What I need to do is make sure that toMemberId has not previously blocked fromMemberId. This means that I need to have BOTH fields before I can check to see if the interaction is valid (member has not blocked the other member).</p>
<p>The way Csla does the validation is once a property has been set. So this means, that when I validate fromMemberId, I have to check if toMemberId also exists and if it does, check if it is blocked.&nbsp; I have to again do this when I validate toMemberId.<br /><br />The problem with this approach is that if the toMemberId is never set, validation will never occur and Save will be allowed.</p>
<p>How are people dealing with dependent properties?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, August 11, 2010</h2><p>It sounds like you have two rules?</p>
<p>The first rule is that both fields are required - which is a pretty simple dual property rule.</p>
<p>Then you have a validation rule that should run if the required rule succeeds. You can use rule priorities for this - just have this rule run at a higher priority than the required rule.</p>
<p>That&#39;ll block saving - because either the required rule will fail, or the validation rule might fail - so the object will only be valid if both values are present and the validation succeeds.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Wednesday, August 11, 2010</h2><p>Rocky,<br /><br />Just want to make sure that when say &quot;dual property rule&quot; you are referring to the AddDependentProperty?</p>
<p>Also, I have never been able to get the short-circuiting to work (been using Csla since 2.1).&nbsp; I have reviewed the 3.8 video on validation and according to it, by default, anything &lt; 0 will always run, but anything &gt;=0 will only run if no previous errors.<br /><br />I have set up my rules as:<br />fromMemberId with priority 10<br />toMemberId with priority 20<br />isBlocked with priority 30<br /><br />Even with an error in validation with priority 10 or 20 and setting e.StopProcessing = true, isBlocked is still executed. Should I set these as negative and have isBlocked be the only positive one?</p>
<p>Edit: When I add a new Conversation, I use BeginBatchLoad which suppresses rule checking and once all properties have been set, I turn rule checking back on and run CheckRules. Not sure if this would have an impact.</p>
<p>&nbsp;- Andy</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 11, 2010</h2><p>Yes, what I mean by dual is that the rule is attached to both properties, and the properties are interdependent. Like the start/end date properties in the Project class in ProjectTracker. They go into and out of valid state together.</p>
<p>Short-circuiting is <i>per-property</i>, which might be the source of confusion. When short-circuiting occurs, it stops processing further rules <i>for the specific property</i>, but not for other properties.</p>
<p>If you have a dual rule at pri 0, that should stop processing of pri 1+ rules on both properties.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Thursday, August 12, 2010</h2><p>Thank you for clearing that up.&nbsp; I had assumed it would stop all validation that had a higher number, regardless of the property.</p>
<p>One final question about validation...</p>
<p>When setting the IsBlocked validation rule on one of the properties, the two ways to get the validation to trigger is by having the value change, or running CheckRules. When adding a new Conversation, I use EndBatchLoad which calls CheckRules to run all my validation. </p>
<p>However, when updating the object, I do not like to run CheckRules and have it run all the validation methods. Instead, I like having it validate only the properties that changed.<br /><br />Now since I am tying IsBlocked to a property, I have to make sure that whenever I update my object, that property gets set with a new value.&nbsp; This works, but I&#39;m afraid of sometimes forgetting to set that property, which would not run the IsBlocked validation method.</p>
<p>Is there any way around that?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 12, 2010</h2><p>You can call CheckRules() for a specific property, otherwise I&#39;m not sure what to suggest.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
