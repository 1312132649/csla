<html><header><title>Principal and custom writable Identity</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Principal and custom writable Identity</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9754.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lazaroms posted on Friday, November 12, 2010</h2><p>Hi all:<br /><br />Please I need help one more time.<br /><br />I needed to make some changes and additions to my Identity class and I thought everything was ok.<br /><br />I need to add 2 properties to the identity and those properties will be set by the UI during login process. So I changed from ReadOnlyBase to BussinessBase class. Also I added some readonly properties.<br /><br />Following are some details of my Identity class, in italics my additions or changes:<br /><br />Imports System.Security.Principal<br />Namespace Security<br />&lt;Serializable()&gt; _<br />Public Class GTIdentity<br />&nbsp;Inherits <i>BusinessBase</i>(Of GTIdentity)<br />&nbsp;Implements IIdentity<br /><br />#Region &quot; Bussines Methods &quot;<br /><br />Protected Overrides Function GetIdValue() As Object<br />&nbsp;&nbsp; Return _name<br />End Function<br /><br /><i>Private _id As Guid = Guid.Empty<br />Public ReadOnly Property Id() As Guid<br />&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp; Return _id<br />&nbsp; End Get<br />End Property</i><br /><br /><i>Private _lastname As String = &quot;&quot;<br />Public ReadOnly Property Lastname() As String<br />&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp; Return _lastname<br />&nbsp;&nbsp; End Get<br />End Property</i><br /><br /><i>Private Shared pIdOffice As PropertyInfo(Of Guid) = RegisterProperty(New PropertyInfo(Of Guid)(&quot;IdOffice&quot;, My.Resources.GTIdentity.pOfficeName))<br /><br />&#39;some code here to declare GET&amp;SET</i><br /><br />#Region &quot; IsInRole &quot;<br /><br />Private _roles As New List(Of String)<br /><br />Friend Function IsInRole (ByVal role As String) As Boolean<br />&nbsp; Return _roles.Contains(role)<br />End Function<br /><br /><i>Public Sub LoadRoles()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&#39;some code here because I load the roles and fill the role list after knowing in which office the user is going to log in.<br /><br />For Each p In roles<br />&nbsp;&nbsp;&nbsp; _roles.Add(p.perm_Codi)<br />Next<br />End Sub</i><br /><br />#End Region<br /><br /><br /><i>&#39; Office list to provide the UI developer<br /><br />Private Structure OfficeDetails<br />&nbsp; Dim _id As Guid<br />&nbsp; Dim _name As String<br />End Structure<br /><br />Private _Offices As New List(Of OfficeDetails)</i><br /><br />#End Region<br /><br />#Region &quot; Data access &quot;<br /><br />Private Sub Fetch(ByVal user As IMultipleResults)<br /><br /><i>&#39;here I fetch the user details and his list of office he can log in. This is a sub wich is called from both DataPortal_Fetch methods.&nbsp;&nbsp;&nbsp; </i><br /><br />End Sub<br /><br />#End Region<br /><br />End Class<br /><br />End Namespace<br /><br /><br />My Principal class has no changes and when I tried to run VS threw a TypeInitializationException of type &#39;GT.Library.Security.GTIdentity&#39;&nbsp; was unhandled by the user. It was in the Principal.Logout, exactly in this line:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim identity As GTIdentity = GTIdentity.UnauthenticatedIdentity()<br /><br /><br />Could somebody explain that to me?<br /><br />Thanks in advance,<br /><br /><br />Lazaro Manuel<br /><br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lazaroms replied on Friday, November 12, 2010</h2><p>Hi all:</p>
<p>I have some news about this problem. I got into the error window and took a look to error message and it said something about the resources and culture.</p>
<p>Know what? I was using a resx file in the Identity class, in that file I had just text. I removed the reference to theese texts and the problem went away.</p>
<p>&nbsp;</p>
<p>Does anybody know why those references to the resources caused that unhandled exception?</p>
<p>Which make the Identity class different from the others?</p>
<p>&nbsp;</p>
<p>Thanks,</p>
<p>&nbsp;</p>
<p>Lazaro Manuel</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
