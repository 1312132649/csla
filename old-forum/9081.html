<html><header><title>CSLA Silverlight 4 app works in VS2010 but not when deployed to IIS</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA Silverlight 4 app works in VS2010 but not when deployed to IIS</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9081.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ posted on Monday, June 14, 2010</h2><p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">I just opened a Silverlight 3 CSLA application in VS2010 and converted it to CSLA 4 and Silverlight 4. The conversion process regenerated the web.config file with a default blank one. I have pasted Rocky&#39;s code directly from his Collective sample for the WcfSlPortal.svc, Web.config and ServiceReferences.ClientConfig files. The WcfSlPortal.svc file is unchanged. The Web.config file connection string section changed and I commented out the compilation assemblies section and the authentication mode=&quot;Windows&quot;. The only change to the ServiceReferences.ClientConfig file is the port on the endpoint address. The conversion also removed the &quot;</span><span style="line-height:115%;font-family:Consolas;font-size:9.5pt;">Csla.<span style="color:#2b91af;">DataPortal</span>.ProxyTypeName = <span style="color:blue;">typeof</span>(Business.Compression.<span style="color:#2b91af;">CompressedProxy</span>&lt;&gt;).AssemblyQualifiedName;&quot; </span><span style="font-family:Calibri;font-size:small;">From the App.Xaml.cs file so I re-added it.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">After fixing all the references and changing the syntax, such as Business Rules, it compiles and works perfectly on my development system. The problem is that it refuses to work when deployed to my IIS6 or IIS7 servers. I already have other Silverlight 4 apps running on both IIS servers so I know that I have properly installed .Net framework 4.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">When I point my browser at the website it downloads the xap file and runs it correctly. It prompts me for login credentials and when I enter them and press Login Fiddler2 show a request being sent to the WcfSlPortal.svc. A SQL Server trace shows that the login request never makes it to the SQL database.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Nothing appears in the IIS machine event logs to help me diagnose this. </span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Fiddler2 shows a FetchResult containing the following error data:</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">&lt;a:ErrorData i:nil=&quot;true&quot; xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:a=&quot;http://schemas.datacontract.org/2004/07/Csla.Server.Hosts.Silverlight&quot; /&gt;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Not much to go on.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Does anyone have any suggestions?</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tgddev replied on Tuesday, June 15, 2010</h2><p>Have you checked the address location for the SOAP operations of you WCF service? (<a href="http://...../WcfSlPortal.svc?wsdl">http://...../WcfSlPortal.svc?wsdl</a>)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Tuesday, June 15, 2010</h2><p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks <span style="mso-bidi-font-weight:bold;">tgddev, while trying to write my response to your post I was able to make some progress on the problem.</span></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">I tried a number of different addresses. The endpoint from Rocky&#39;s Collective sample is:</span></p>
<p><span style="font-family:Consolas;color:blue;font-size:10pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:10pt;">endpoint</span><span style="font-family:Consolas;color:blue;font-size:10pt;"> </span><span style="font-family:Consolas;color:red;font-size:10pt;">address</span><span style="font-family:Consolas;color:blue;font-size:10pt;">=</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;"> </span><span style="font-family:Consolas;color:red;font-size:10pt;">binding</span><span style="font-family:Consolas;color:blue;font-size:10pt;">=</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;">basicHttpBinding</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;"> </span><span style="font-family:Consolas;color:red;font-size:10pt;">contract</span><span style="font-family:Consolas;color:blue;font-size:10pt;">=</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;">Csla.Server.Hosts.Silverlight.IWcfPortal</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;"> </span><span style="font-family:Consolas;color:red;font-size:10pt;">bindingConfiguration</span><span style="font-family:Consolas;color:blue;font-size:10pt;">=</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;">BasicHttpBinding_IWcfPortal</span><span style="font-family:Consolas;color:black;font-size:10pt;">&quot;</span><span style="font-family:Consolas;color:blue;font-size:10pt;">&gt;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">When I try using this endpoint Fiddler2 reports a result 200 with the correct host IP and a body of 1702 bytes which contains the error message in my first post. When I change the endpoint address I get the following results:</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">1) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://localhost/App_folder/WcfSlPortal.svc</span></a></b> returns result HTTP/1.1 200 OK. This behaves the same as address=&quot;&quot;.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">2) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://localhost/App_folder/WcfSlPortal.svc</span></a>?wsdl</b> returns result HTTP/1.1 500 System.ServiceModel.ServiceActivationException.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">3) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://1.2.3.4/App_folder/WcfSlPortal.svc</span></a></b> where 1.2.3.4 = IP Address of IIS server returns result HTTP/1.1 200 OK. This behaves the same as address=&quot;&quot;.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">4) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://1.2.3.4/App_folder/WcfSlPortal.svc</span></a>?wsdl</b> where 1.2.3.4 = IP Address of IIS server returns result HTTP/1.1 500 System.ServiceModel.ServiceActivationException</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">If I type http://localhost.App_Folder/WcfSlPortal.svc into IE on the IIS server I get the following:</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Server Error in &#39;/App_folder&#39; Application.</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">--------------------------------------------------------------------------------</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">A base address cannot contain a Uri query string.</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Parameter name: baseAddress </span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Exception Details: System.ArgumentException: A base address cannot contain a Uri query string.</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Parameter name: baseAddress</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Source Error: </span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.<span style="mso-spacerun:yes;">&nbsp; </span></span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Stack Trace: </span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">[ArgumentException: A base address cannot contain a Uri query string.</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Parameter name: baseAddress]</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">...</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">--------------------------------------------------------------------------------</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">Version Information: Microsoft .NET Framework Version:4.0.30319; ASP.NET Version:4.0.30319.1</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;mso-bidi-font-size:11.0pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">This is a strange error given the URL that was entered. Turns out that the underscore character was the cause! I changed the location from App_folder to Appfolder and it works! I now get the proper Compressed Host Service page.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Running through the testing again I get:</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">0) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">address=&quot;&quot;</span></a></b> returns result HTTP/1.1 200 OK, the correct host IP and a body of 1702 bytes which contains the error message in my first post</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">1) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://localhost/Appfolder/WcfSlPortal.svc</span></a></b> returns result HTTP/1.1 200 OK. This behaves the same as address=&quot;&quot;.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">2) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://localhost/Appfolder/WcfSlPortal.svc</span></a>?wsdl</b> returns result HTTP/1.1 500 System.ServiceModel.ServiceActivationException.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">3) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://1.2.3.4/Appfolder/WcfSlPortal.svc</span></a></b> where 1.2.3.4 = IP Address of IIS server returns result HTTP/1.1 200 OK. This behaves the same as address=&quot;&quot;.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">4) <b style="mso-bidi-font-weight:normal;"><a href="http://servername/Appfolder/WcfSlPortal.svc"><span style="color:windowtext;text-decoration:none;text-underline:none;">http://1.2.3.4/Appfolder/WcfSlPortal.svc</span></a>?wsdl</b> where 1.2.3.4 = IP Address of IIS server returns result HTTP/1.1 500 System.ServiceModel.ServiceActivationException</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">So now I&#39;m closer but still no joy. </span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Any other thoughts?</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tgddev replied on Wednesday, June 16, 2010</h2><p>Sorry,&nbsp;I&#39;ve never suffered the activation exception.</p>
<p>Good luck.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rnb replied on Wednesday, June 16, 2010</h2><p>One WCF activation I had to do is in Control Panel | Program and Features | Turn Windows features on or off, mine is under .NET Framework 3.5.1 it might apply to 4.0 as well.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
