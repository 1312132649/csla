<html><header><title>OnPropertyChanged strange performance problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OnPropertyChanged strange performance problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9624.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael posted on Monday, October 11, 2010</h2><p>I have a &quot;Parent&quot; BB object with a &quot;Children&quot; BLB of &quot;Child&quot;. Each Child has an &quot;InnerChild&quot; BB. The Child exposes some of the InnerChild properties as pass-throughs, e.g.</p>
<p>public double Something<br />{<br />&nbsp;&nbsp;&nbsp; get { return InnerChild.Something; }<br />}</p>
<p>InnerChild notifies Child when these properties change, and then Child raises OnPropertyChanged(propertyName);</p>
<p>This forces a grid bound to the Children collection to refresh immediately when the InnerChild is changed in a master-detail edit dialog. This works fine.</p>
<p>However, the Parent has a property which modifies the properties of InnerChild. There is no binding source for Children/Child/InnerChild at this point. Each time the InnerChild property is modified, the OnPropertyChanged call takes about 25ms longer. So, simply typing 1, 0, 0, 0, 0 in the Parent field results in the OnPropertyChanged call taking 69, 95, 121, 148, 173ms respectively. This only happens when the Children are not in binding edit.</p>
<p>If I raise OnPropertyChanged only when Child&#39;s BindingEdit == true, is this safe? (BindingEdit says FOR INTERNAL CSLA .NET USE ONLY!)</p>
<p>Is there another fix or workaround?</p>
<p>Thanks in advance.<br />Michael</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Monday, October 11, 2010</h2><p>Hmmm, it&#39;s not the whole story. Conditionally raising OnPropertyChanged does <i>hides</i> the performance problem in the Parent edit screen; it actually still exists in the Children edit dialog. If I&#39;ve made changes in the Parent fields that alter the InnerChild objects, the same performance degradation is displayed when the Children dialog is used. Commenting out the OnPropertyChanged calls makes everything run fast again.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Monday, October 11, 2010</h2><p>A friend mentioned a bug with CSLA&#39;s LINQ implementation where it hangs onto objects and stops them being garbage collected, and amazingly, that is the problem here. I never would have found this on my own. Changing the following function reduced the OnPropertyChanged calls to 1ms consistently.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CushionHeadSpigot GetCushionHeadSpigot(Guid openingId)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var item in this)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (item.OpeningId == openingId)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return item;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //return this.Where(s =&gt; s.OpeningId == openingId).FirstOrDefault();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>I can&#39;t see this in the change logs, or known bugs. Rocky?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 11, 2010</h2><p>CSLA 4 addresses this problem by entirely discarding the 3.x LINQ implementation in favor of an explicit step to get a LinqObservableCollection. So I rather suspect this is fixed, because CSLA no longer does any custom LINQ processing.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Monday, October 11, 2010</h2><p>Excellent, thanks.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
