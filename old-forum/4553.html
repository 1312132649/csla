<html><header><title>Command Objects and No FileLoadException?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Command Objects and No FileLoadException?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4553.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>GlennMiller posted on Tuesday, March 25, 2008</h2>It was our understanding that the BinaryFormater will throw a FileLoadException if your Client side DLL did not match the Assembly Version of the Server side .NET Remoting Host (we are using CSLA 3.0).<br><br>Our CSLA Business Objects do. But our Command Objects don't do that. Infact they will still execute fine and return data back to the Client regardless of Assembly Versions (unless we change method signitures).<br><br>So, our question is why Command Objects don't throw FileLoadException? I would of assumed that they use the BinaryFormater as well.<br><br>The reason we are asking is if our code throws this we kick on some fancy update logic. So, if for some reason the user is in a middle of something and we do a publish... We gracefully update our ClickOnce App on the Client.<br><br>Thanks!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, March 25, 2008</h2>Well, I'm not sure as to your problem, but how do you gracefully update your ClickOnce app while they are running?&nbsp; I've had to make sure everyone is out before I can update otherwise the app stops working.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GlennMiller replied on Tuesday, March 25, 2008</h2>Well maybe gracefull is not exactly what I would call it. Technically you could dynamically update it by unloading and reloading dlls... Our solution for now is on every Factory method in a fetch we catch FileLoadException and re-throw our own Exception. Then we do this code:<br><br>Do this in a Background worker thread (so you can have a cool UI throbber stating a new version is downloading.<br>try<br>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; if (ApplicationDeployment.IsNetworkDeployed)<br>&nbsp;&nbsp; {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ApplicationDeployment updateCheck = ApplicationDeployment.CurrentDeployment;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UpdateCheckInfo info = updateCheck.CheckForDetailedUpdate();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (info.UpdateAvailable)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateCheck.Update();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; }<br>}<br>catch (Exception e)<br>{<br>&nbsp;&nbsp; return false;<br>&nbsp;}<br>&nbsp;&nbsp;&nbsp; return true;<br><br>After that background worker thread is completed do this:<br><br>&nbsp;if (!(bool)e.Result)<br>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Show a Message box that the update failed<br>&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mouse.OverrideCursor = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Windows.Forms.Application.Restart();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Diagnostics.Process.GetCurrentProcess().Kill();&nbsp; <br><br>We tried Application.Current.Shutdown();&nbsp; But there were so many cases in our code where we were calling remoting portal stuff on closings of windows...<br><br>Ok, so it's not 'graceful'... But it's better than having your App have a scary crash message that the user won't understand. This is our first pass. Later we would like to do dynamic updating of DLL's and reloading them.<br><br>Anyway for this to work we are reling on CSLA to throw a FileLoadException. However, Command Objects don't do that... So we might have to throw a version number that is set on Login within the Principle Object. But the problem with that is it junks code up and we will have to Extend base classes... So, if anyone knows of a tweak to get FileLoadException to throw in Command Objects that would be great.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, March 25, 2008</h2>Well, I currently kick them all out knowing I'm doing an update.&nbsp; But your code could help me get around that.&nbsp; Thanks for posting it!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GlennMiller replied on Tuesday, March 25, 2008</h2>Just one note... We restarted our IIS process and FileLoadExceptions magically started to be thrown in our Command Objects... Go figure... I hope that stays that way... But... At least we were able to give a tip out in the process!<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
