<html><header><title>OT: Database design with inheritance</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT: Database design with inheritance</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1252.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Monday, September 18, 2006</h2><P>There are a few ways to accomodate reflecting inheritance in DBs. I'll use the example that Organizations and Individuals are both types of Contacts. </P>
<P>1) Contact Table (containing common fields), Organization Table (containing organization specific fields), Individual Table (containing individual specific fields). FKs from Organizations and Individuals to Contact. </P>
<P>2) Contact Table (containing all common fields, all organization fields, and all individual fields). No Organization or Individual table. </P>
<P>3) Organization Table (containing common fields and organization fields) and Individual Table (containing common fields and individual fields). No contact table. </P>
<P>There are +s &amp; -s to each, though for my purpose #1 is the right way to go in this situation. </P>
<P>My problem right now has to do with the concept that everything in my system in the end shares a common base class - "Entity". Entity contains at this point created and modified datetime/user fields along with a System Guid key. Much of me is leaning towards solution #3 for this, storing the created and modified datetime and user on each table pertaining to a Csla class&nbsp;(and eliminating the foreign key to the Entity table which will no longer be there). </P>
<P>I would be doing this because I think the managibility is better without the entity table and all of the foreign keys and all the instances where the stored procedures would need to accomodate the entity table. The Entity base class in the system will be consistently exposing these fields but I'm not convinced I want a separate Entity table in the database. </P>
<P>Has someone else broached this question? What avenue did you take and were you happy with the direction you took? </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 18, 2006</h2><P>Yes, I am in the middle of designing this type of system myself.&nbsp; I have done a prototype system to my satisfaction and I am moving into the final coding on my BOs.&nbsp; My post at the bottom of this thread explains generally how I laid out my tables and how they map to my BOs.</P>
<P><A HREF="/forums/thread/6189.aspx">http://forums.lhotka.net/forums/thread/6189.aspx</A></P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, September 18, 2006</h2><P>Thanks for your reply - I guess this subject may be a little different than what is on that thread.</P>
<P>A lot of us have a base class derived from BusinessBase&lt;T&gt; that we derive all of our base classes from, and mine happens to have a unique system Id of Guid along with some common properties for all objects. </P>
<P>Seeing that virtually all of my classes will inherit through this scheme and have need to persist these properties, I am just struggling on whether the best route is to keep these properties in a parent "Entity" table in the database or in individual places throughout the database to negate the need for bucketloads of foreign keys to this "entity" table and the slightly more complex stored procedures, etc. </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 18, 2006</h2><P>Ah ok.....sorry I misunderstood.&nbsp; I am not using Guids</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, September 19, 2006</h2><P>If I understand your issue correctly, you are looking at finding a way to follow an object-oriented, normalized approach to the database design.&nbsp; And, the pattern you are describing is not uncommon.&nbsp; We have a similar situation where users can occupy different "roles" (not security roles) and, as a result, have different information stored.</P>
<P>For instance, we have an extra-net application where employees, contractors, customers and vendors can all log-in and gain access to their profile information as well as site feature designed for them.&nbsp; The latter is handled by the security model via roles; but, obviously, the profile information for each will be different.&nbsp; E.g., an employee won't have a billing&nbsp;account.</P>
<P>However, there is much in common between them such as username and password, name, e-mail address, mailing address, etc.&nbsp; So, the question is, and I believe yours is as well, do you create a common Contacts table containing these fields and have your Employees, Contractors, Customers and Vendors table relate to this "parent" table, duplicate the columns in each of the individual tables or have a single table for all with some potentially null columns depending on the type of user.</P>
<P>I have heard many arguments for and against each approach and long ago stopped listening to the DBA's because I believe that even though you marked this as an off-topic post, it really isn't because this decision has to be based on your BO design.&nbsp; What works from the code's point-of-view because you can make all three work at the DB level.</P>
<P>In an object-oriented world, it makes perfect sense to create a Contact base class (or Actor as in our case) and derive Employee, Contractor, Customer and Vendor objects.&nbsp; It's creating the hook into the database that presents the issue.&nbsp; How best to do this?</P>
<P>Unfortunately, I don't have a quick answer for you because we've run into the same problem.&nbsp; And while we've implemented an approach, I don't like it.&nbsp; It's not intuitive and is quite cumbersome.&nbsp; So, with this clarification in mind, I'd like to throw open the discussion to others for input.</P>
<P>What is basically boils down to is how to create a hierarchy of business objects within the CSLA framework?&nbsp; When you have a base class that has its own unique identifier derived by another class with its own unique identifier, how do you handle that?</P>
<P>I've posted a new topic to discuss this point in more detail (<A HREF="/forums/thread/6449.aspx">http://forums.lhotka.net/forums/thread/6449.aspx</A>).</P>
<P>Hope this helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 19, 2006</h2><P>Thanks for your post. </P>
<P>I must not be asking my question very clearly because my question isn't so much about the business related inheritance - I think it makes a lot of sense to have, for instance, a base Contact class and subclasses of Organization and Individual. And I think it makes a lot of sense to have a contact table in the database and two "subclass tables" for Individual and Organization. </P>
<P>The one I can't quite justify necessarily is the inserted class between Contact and BusinessBase&lt;T&gt; - that is, Entity&lt;T&gt;, which will be where I put my special logic for BusinessBase&lt;T&gt; as well as maintain some information about changed and modified information for that business object. (Both children and roots have modified and changed information).</P>
<P>In my database, this isn't a question of adding the contact table and having two foreign keys to contact from Organization and Individual. This is a question of adding an Entity table and having literally 10, 20, 30...+ tables foreign key to Entity for their modified and changed information. </P>
<P>i.e., do I have:</P>
<P>Contact: Id, Status,&nbsp;..., ModifiedUser&amp;DateTime, CreatedUser&amp;DateTime</P>
<P>ContactName: Id, Name, SortName, ..., ModifiedUser &amp; DateTime, CreatedUser&amp;DateTime</P>
<P>EmailAddress: Id, Description, EmailAddress, ModifiedUser &amp; DateTime, CreatedUser&amp;DateTime </P>
<P>Or do I have one Entity table with:</P>
<P>Id, ModifiedUser&amp;DateTime, CreatedUser&amp;DateTime </P>
<P>Along with the tables that foreign key to entity:</P>
<P>Contact: Id, Status</P>
<P>ContactName: Id, Name, SortName</P>
<P>EmailAddress: Id, Description, EmailAddress</P>
<P>---</P>
<P>It's clear what seems "clean" is the separate entity table, but I am not convinced that's what I want to do - all BO fetches need to join an extra table, have to be more attentive in my stored procedures to the foreign key to Entity (&amp; make sure I don't orphan Entity records when deleting BOs), etc. </P>
<P>---</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, September 19, 2006</h2><P>Ah, got you.</P>
<P>In our case, we have a design&nbsp;&amp; development standard in place that works with our framework in this regard.&nbsp; Each and every table is to have columns for the UniqueID, CreatedOn, CreatedBy, LastModifiedOn, LastModifiedBy and Deleted values.&nbsp; To support this, all of our business objects are derived from our base class which implements these properties.&nbsp; So, using your terminology, we do have an Entity&lt;T&gt; class and is does reside between BusinessBase and our BO's - this allows for deviations from the standards if necessary (the BO can derive directly from BusinessBase in that case).</P>
<P>We do not have a separate table to track these fields as that would get too complicated (identifying which record goes to which table, etc.).</P>
<P>This is where the question of inheriting business objects comes into play.&nbsp; When you have an object that is created by joining two of these tables - which UniqueID, CreatedOn, etc. applies?&nbsp; It also applies to complex many-to-many relationships where the relationship is an entity of its own with properties such as AddressType or whatever.</P>
<P>Hope that's more inline with what you were looking for.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 19, 2006</h2><P>Yes, this is more along the lines of what I was talking about. </P>
<P>"We do not have a separate table to track these fields as that would get too complicated (identifying which record goes to which table, etc.)."</P>
<P>I think what you're saying is that your "Entity" table wouldn't know exactly what type it referred to. I definitely understand you here, but in this instance I'm not sure if the Entity table would need to know which type it referred to. It's kind of this "consistent bucket" for the changed &amp; modified information. </P>
<P>"When you have an object that is created by joining two of these tables - which UniqueID, CreatedOn, etc. applies?"</P>
<P>Not every table would link to Entity. For instance, Profile &amp; Individual are two tables that combined comprise the base attributes and properties of an Individual, and Profile &amp; Organization are two tables that combined comprise the base attributes and properties of an Organization. </P>
<P>So in the case of classes that result with subclassed tables and so forth, only the "parent" table would contain the modified and changed information. </P>
<P>With a case where, for instance, a profile has multiple alternative names, each alternative name would have a modified/changed information too (subclass of Entity).</P>
<P>&nbsp;----</P>
<P>I would really like to understand more about why you don't have a separate table - which aspects get too complicated in your opinion?</P>
<P>Thanks for taking the time. </P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
