<html><header><title>DataPortal.Fetch failed (Property load or set failed for property PostalCode</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal.Fetch failed (Property load or set failed for property PostalCode</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6105.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>koen@skn.be posted on Thursday, January 08, 2009</h2>DataPortal.Fetch failed (Property load or set failed for property PostalCode (Unable to cast object of type 'Csla.SmartDate' to type 'System.String'.))<br /><br />I have an application with 2 bo's (Country, Customer).<br />The app works with objectfactory.<br /><br />When I do GetCountries and fill the grid all works fine, when now I execute GetCustomers I get the error.<br /><br />// Base BusObject <br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class BusObjectEdit : BusinessBase<br />    {<br />        private static int _forceinit;<br /><br />        protected BusObjectEdit()<br />        {<br />            _forceinit = 0;<br />        }<br /><br />        protected override void OnDeserialized(StreamingContext context)<br />        {<br />            _forceinit = 0;<br />            base.OnDeserialized(context);<br />        }<br /><br />        public static readonly PropertyInfo ActiveProperty =<br />            RegisterProperty(new PropertyInfo("Active", "Active", true));<br /><br />        public static readonly PropertyInfo ClassProperty =<br />            RegisterProperty(new PropertyInfo("Class", "Class"));<br /><br />        public static readonly PropertyInfo CreateDateProperty =<br />            RegisterProperty(new PropertyInfo("CreateDate", "CreateDate", DateTime.Now));<br /><br />        public static readonly PropertyInfo IdProperty =<br />            RegisterProperty(new PropertyInfo("Id", "Id", Guid.NewGuid().ToString().Replace("-", "")));<br /><br />        public static readonly PropertyInfo UpdateDateProperty =<br />            RegisterProperty(new PropertyInfo("UpdateDate", "UpdateDate", DateTime.Now));<br /><br />        public string Class<br />        {<br />            get { return GetProperty(ClassProperty); }<br />            set { SetProperty(ClassProperty, value); }<br />        }<br />        public string Id<br />        {<br />            get { return GetProperty(IdProperty); }<br />            set { SetProperty(IdProperty, value); }<br />        }<br />        public SmartDate CreateDate<br />        {<br />            get { return GetProperty(CreateDateProperty); }<br />            set { SetProperty(CreateDateProperty, value); }<br />        }<br />        public SmartDate UpdateDate<br />        {<br />            get { return GetProperty(UpdateDateProperty); }<br />            set { SetProperty(UpdateDateProperty, value); }<br />        }<br />        public Boolean Active<br />        {<br />            get { return GetProperty(ActiveProperty); }<br />            set { SetProperty(ActiveProperty, value); }<br />        }<br /><br />        public static BusObjectEdit NewBusObject()<br />        {<br />            return DataPortal.Create();<br />        }<br /><br />        public void MapEntityToObject(BusObjectDTO pBusObjectDTO)<br />        {<br />            LoadProperty(IdProperty, pBusObjectDTO.Id);<br />            LoadProperty(ClassProperty, pBusObjectDTO.Class);<br />            LoadProperty(CreateDateProperty, pBusObjectDTO.CreateDate);<br />            LoadProperty(UpdateDateProperty, pBusObjectDTO.UpdateDate);<br />            LoadProperty(ActiveProperty, pBusObjectDTO.Active);<br />        }<br /><br />        public void MapObjectoEntity(BusObjectDTO pBusObjectDTO)<br />        {<br />            pBusObjectDTO.Class = GetProperty(ClassProperty);<br />            pBusObjectDTO.Id = GetProperty(IdProperty);<br />            pBusObjectDTO.CreateDate = GetProperty(CreateDateProperty);<br />            pBusObjectDTO.UpdateDate = GetProperty(UpdateDateProperty);<br />        }<br />    }<br />}<br /><br />// Country BO<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br />using Csla.Server;<br />using DataPortal = Csla.DataPortal;<br /><br />namespace SKN.Library<br />{<br />    [ObjectFactory("SKN.ObjectFactory.CountryFactory, SKN.ObjectFactory")]<br />    [Serializable]<br />    public class CountryEdit : BusObjectEdit<br />    {<br />        private static readonly PropertyInfo CountryIdProperty =<br />            RegisterProperty(new PropertyInfo("CountryId", "CountryId"));<br /><br />        private static readonly PropertyInfo NameProperty =<br />            RegisterProperty(new PropertyInfo("Name", "Name"));<br /><br />        public string CountryId<br />        {<br />            get { return GetProperty(CountryIdProperty); }<br />            set { SetProperty(CountryIdProperty, value); }<br />        }<br />        public string Name<br />        {<br />            get { return GetProperty(NameProperty); }<br />            set { SetProperty(NameProperty, value); }<br />        }<br /><br />        public void MapEntityToObject(CountryDTO pCountryDTO)<br />        {<br />            LoadProperty(CountryIdProperty, pCountryDTO.CountryId);<br />            LoadProperty(NameProperty, pCountryDTO.Name);<br />        }<br /><br />        public void MapObjectoEntity(CountryDTO pCountryDTO)<br />        {<br />            pCountryDTO.CountryId = GetProperty(CountryIdProperty);<br />            pCountryDTO.Name = GetProperty(NameProperty);<br />        }<br /><br />        public static CountryEdit NewCountry()<br />        {<br />            return DataPortal.Create();<br />        }<br /><br />        public static CountryEdit GetCountryById(SingleCriteria pCountryId)         {<br />            return DataPortal.Fetch(pCountryId);<br />SingleCriteria(pCountryId));<br />        }<br /><br />        public static void UpdateCountry(CountryEdit pCountryEdit)<br />        {<br />            DataPortal.Update(pCountryEdit);<br />        }<br /><br />        public static void DeleteCountry(SingleCriteria pCountryId)<br />        {<br />            DataPortal.Delete(pCountryId); SingleCriteria(pCountryId));<br />        }<br /><br /><br />    }<br />}<br /><br />// BusObjectInfo<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class BusObjectInfo : ReadOnlyBase<br />    {<br />        private static int _forceInit;<br /><br />        public static readonly PropertyInfo ActiveProperty =<br />            RegisterProperty(new PropertyInfo("Active", "Active"));<br /><br />        private static readonly PropertyInfo ClassProperty =<br />            RegisterProperty(new PropertyInfo("Class", "Class"));<br /><br />        public static readonly PropertyInfo CreateDateProperty =<br />            RegisterProperty(new PropertyInfo("CreateDate", "CreateDate"));<br /><br />        private static readonly PropertyInfo IdProperty =<br />            RegisterProperty(new PropertyInfo("Id", "Id"));<br /><br />        public static readonly PropertyInfo UpdateDateProperty =<br />            RegisterProperty(new PropertyInfo("UpdateDate", "UpdateDate"));<br /><br />        public BusObjectInfo(BusObjectDTO pBusobjectDTO)<br />        {<br />            LoadProperty(ClassProperty, pBusobjectDTO.Class);<br />            LoadProperty(IdProperty, pBusobjectDTO.Id);<br />            LoadProperty(CreateDateProperty, pBusobjectDTO.CreateDate);<br />            LoadProperty(UpdateDateProperty, pBusobjectDTO.UpdateDate);<br />            LoadProperty(ActiveProperty, pBusobjectDTO.Active);<br />        }<br /><br />        protected BusObjectInfo()<br />        {<br />            // 08/01/2009 this is needed else you get errors like<br />            // csla one or more properties are not registered for this type<br />            _forceInit = 0;<br />        }<br /><br />        protected override void OnDeserialized(StreamingContext context)<br />        {<br />            // 08/01/2009 this is needed else you get errors like<br />            // csla one or more properties are not registered for this type<br />            _forceInit = 0;<br />            base.OnDeserialized(context);<br />        }<br /><br />        public string Class<br />        {<br />            get { return GetProperty(ClassProperty); }<br />        }<br /><br />        public string Id<br />        {<br />            get { return GetProperty(IdProperty); }<br />        }<br /><br />        public DateTime CreateDate<br />        {<br />            get { return GetProperty(CreateDateProperty); }<br />        }<br /><br />        public DateTime UpdateDate<br />        {<br />            get { return GetProperty(UpdateDateProperty); }<br />        }<br /><br />        public Boolean Active<br />        {<br />            get { return GetProperty(ActiveProperty); }<br />        }<br />    }<br />}<br /><br />// CountryInfo<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class CountryInfo : BusObjectInfo<br />    {<br />        private static readonly PropertyInfo CountryIdProperty =<br />            RegisterProperty(new PropertyInfo("CountryId", "CountryId"));<br /><br />        private static readonly PropertyInfo NameProperty =<br />            RegisterProperty(new PropertyInfo("Name", "Name"));<br /><br />        public CountryInfo(BusObjectDTO pBusobjectDTO) : base(pBusobjectDTO)<br />        {<br />            LoadProperty(CountryIdProperty, pBusobjectDTO.Id);<br />            LoadProperty(NameProperty, ((CountryDTO)pBusobjectDTO).Name);<br />        }<br /><br />        public string CountryId<br />        {<br />            get { return GetProperty(CountryIdProperty); }<br />        }<br /><br />        public string Name<br />        {<br />            get { return GetProperty(NameProperty); }<br />        }<br /><br />        protected override object GetIdValue()<br />        {<br />            return CountryIdProperty;<br />        }<br /><br />        public override string ToString()<br />        {<br />            return NameProperty.ToString();<br />        }<br />    }<br />}<br /><br />// Country DTO<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [DataContract(Namespace = Namespaces.SKN, Name = "CountryDTO")]<br />    [Serializable]<br />    public class CountryDTO : BusObjectDTO<br />    {<br />        public CountryDTO(string pClass, string pId, SmartDate pCreateDate, SmartDate pUpdateDate, bool pActive,<br />                          string pCountryId, string pName) : base(pClass, pId, pCreateDate, pUpdateDate, pActive)<br />        {<br />            CountryId = pCountryId;<br />            Name = pName;<br />        }<br /><br />        [DataMember(Order = 20)]<br />        public string CountryId { get; set; }<br /><br />        [DataMember(Order = 21)]<br />        public string Name { get; set; }<br />    }<br />}<br /><br />// CountryInfoList<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br />using Csla.Server;<br />using DataPortal = Csla.DataPortal;<br /><br />namespace SKN.Library<br />{<br />    [ObjectFactory("SKN.ObjectFactory.CountryListFactory, SKN.ObjectFactory")]<br /> <br />    [Serializable]<br />    public class CountryInfoList : ReadOnlyListBase<br />    {<br />        public void LoadData(CountryInfoDTOList pCountryListDTO)<br />        {<br />            RaiseListChangedEvents = false;<br />            IsReadOnly = false;<br />            foreach (CountryDTO countryDTO in pCountryListDTO)<br />            {<br />                Add(new CountryInfo(countryDTO));<br />            }<br />            IsReadOnly = true;<br />            RaiseListChangedEvents = true;<br />        }<br /><br />        public static CountryInfoList GetAllCountries()<br />        {<br />            return DataPortal.Fetch();<br />        }<br /><br />        public static CountryInfoList GetCountriesByName(SingleCriteria pName)<br />        {<br />            return DataPortal.Fetch(pName);<br />SingleCriteria(name));<br />        }<br />    }<br />}<br /><br />// CountryInfoDTOList<br />using System;<br />using System.Collections.Generic;<br />using System.Runtime.Serialization;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class CountryInfoDTOList : List<br />    {<br />        public CountryInfoDTOList()<br />        {<br />        }<br /><br />        public CountryInfoDTOList(IEnumerable collection) : base(collection)<br />        {<br />        }<br />    }<br />}<br /><br />// county DAL<br />using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Runtime.Serialization;<br />using Csla.Data;<br />using Natural.EL;<br />using SKN.DAL;<br />using SKN.Library;<br /><br />namespace Natural.EAL<br />{<br />    [Serializable]<br />    public class CountryEAL : ICountryDAL<br />    {<br />        #region ICountryDAL Members<br /><br />        public CountryInfoDTOList GetAllCountries()<br />        {<br />            using (ObjectContextManager ctx =<br />                ObjectContextManager.GetManager("NaturalEntities"))<br />            {<br />                IQueryable countries = from p in ctx.ObjectContext.Land<br />                                        orderby p.Basic.Naam<br />                                        select p;<br /><br />                return LoadCountryList(countries); <br />            }<br />        }<br /><br />        #endregion<br /><br />        private static CountryInfoDTOList LoadCountryList(IQueryable pCountries)<br />        {<br />            var countryInfoDTOList = new CountryInfoDTOList();<br />            foreach (Land c in pCountries)<br />            {<br />                if (!c.BasicReference.IsLoaded)<br />                    c.BasicReference.Load();<br />                              countryInfoDTOList.Add(<br />                    new CountryDTO(<br />                        c.Class,<br />                        c.Id,<br />                        c.Basic.CreateDate,<br />                        c.Basic.UpdateDate,<br />                        true,<br />                        c.Id,<br />                        c.Basic.Naam));<br />            }<br />            return countryInfoDTOList;<br />        }<br />    }<br />}<br /><br />I got the same for Customer what could be going wrong ?<br />I am a newbie and testing CSLA, I hope this is a bit clear.<br /><br />Is this a good way of working ?<br /><br />Thx</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Thursday, January 08, 2009</h2>Sounds like properties in DTO are strings.  It this is the case, you would need to use LoadPropertyConvert and ReadPropertyConvert probably.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: koen@skn.be [mailto:cslanet@lhotka.net] <br />Sent: Thursday, January 08, 2009 12:16 PM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] DataPortal.Fetch failed (Property load or set failed for property PostalCode<br /><br />DataPortal.Fetch failed (Property load or set failed for property PostalCode (Unable to cast object of type 'Csla.SmartDate' to type 'System.String'.))<br /><br />I have an application with 2 bo's (Country, Customer).<br />The app works with objectfactory.<br /><br />When I do GetCountries and fill the grid all works fine, when now I execute GetCustomers I get the error.<br /><br />// Base BusObject <br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class BusObjectEdit : BusinessBase<br />    {<br />        private static int _forceinit;<br /><br />        protected BusObjectEdit()<br />        {<br />            _forceinit = 0;<br />        }<br /><br />        protected override void OnDeserialized(StreamingContext context)<br />        {<br />            _forceinit = 0;<br />            base.OnDeserialized(context);<br />        }<br /><br />        public static readonly PropertyInfo ActiveProperty =<br />            RegisterProperty(new PropertyInfo("Active", "Active", true));<br /><br />        public static readonly PropertyInfo ClassProperty =<br />            RegisterProperty(new PropertyInfo("Class", "Class"));<br /><br />        public static readonly PropertyInfo CreateDateProperty =<br />            RegisterProperty(new PropertyInfo("CreateDate", "CreateDate", DateTime.Now));<br /><br />        public static readonly PropertyInfo IdProperty =<br />            RegisterProperty(new PropertyInfo("Id", "Id", Guid.NewGuid().ToString().Replace("-", "")));<br /><br />        public static readonly PropertyInfo UpdateDateProperty =<br />            RegisterProperty(new PropertyInfo("UpdateDate", "UpdateDate", DateTime.Now));<br /><br />        public string Class<br />        {<br />            get { return GetProperty(ClassProperty); }<br />            set { SetProperty(ClassProperty, value); }<br />        }<br />        public string Id<br />        {<br />            get { return GetProperty(IdProperty); }<br />            set { SetProperty(IdProperty, value); }<br />        }<br />        public SmartDate CreateDate<br />        {<br />            get { return GetProperty(CreateDateProperty); }<br />            set { SetProperty(CreateDateProperty, value); }<br />        }<br />        public SmartDate UpdateDate<br />        {<br />            get { return GetProperty(UpdateDateProperty); }<br />            set { SetProperty(UpdateDateProperty, value); }<br />        }<br />        public Boolean Active<br />        {<br />            get { return GetProperty(ActiveProperty); }<br />            set { SetProperty(ActiveProperty, value); }<br />        }<br /><br />        public static BusObjectEdit NewBusObject()<br />        {<br />            return DataPortal.Create();<br />        }<br /><br />        public void MapEntityToObject(BusObjectDTO pBusObjectDTO)<br />        {<br />            LoadProperty(IdProperty, pBusObjectDTO.Id);<br />            LoadProperty(ClassProperty, pBusObjectDTO.Class);<br />            LoadProperty(CreateDateProperty, pBusObjectDTO.CreateDate);<br />            LoadProperty(UpdateDateProperty, pBusObjectDTO.UpdateDate);<br />            LoadProperty(ActiveProperty, pBusObjectDTO.Active);<br />        }<br /><br />        public void MapObjectoEntity(BusObjectDTO pBusObjectDTO)<br />        {<br />            pBusObjectDTO.Class = GetProperty(ClassProperty);<br />            pBusObjectDTO.Id = GetProperty(IdProperty);<br />            pBusObjectDTO.CreateDate = GetProperty(CreateDateProperty);<br />            pBusObjectDTO.UpdateDate = GetProperty(UpdateDateProperty);<br />        }<br />    }<br />}<br /><br />// Country BO<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br />using Csla.Server;<br />using DataPortal = Csla.DataPortal;<br /><br />namespace SKN.Library<br />{<br />    [ObjectFactory("SKN.ObjectFactory.CountryFactory, SKN.ObjectFactory")]<br />    [Serializable]<br />    public class CountryEdit : BusObjectEdit<br />    {<br />        private static readonly PropertyInfo CountryIdProperty =<br />            RegisterProperty(new PropertyInfo("CountryId", "CountryId"));<br /><br />        private static readonly PropertyInfo NameProperty =<br />            RegisterProperty(new PropertyInfo("Name", "Name"));<br /><br />        public string CountryId<br />        {<br />            get { return GetProperty(CountryIdProperty); }<br />            set { SetProperty(CountryIdProperty, value); }<br />        }<br />        public string Name<br />        {<br />            get { return GetProperty(NameProperty); }<br />            set { SetProperty(NameProperty, value); }<br />        }<br /><br />        public void MapEntityToObject(CountryDTO pCountryDTO)<br />        {<br />            LoadProperty(CountryIdProperty, pCountryDTO.CountryId);<br />            LoadProperty(NameProperty, pCountryDTO.Name);<br />        }<br /><br />        public void MapObjectoEntity(CountryDTO pCountryDTO)<br />        {<br />            pCountryDTO.CountryId = GetProperty(CountryIdProperty);<br />            pCountryDTO.Name = GetProperty(NameProperty);<br />        }<br /><br />        public static CountryEdit NewCountry()<br />        {<br />            return DataPortal.Create();<br />        }<br /><br />        public static CountryEdit GetCountryById(SingleCriteria pCountryId) //String pCountryId)<br />        {<br />            return DataPortal.Fetch(pCountryId);<br />SingleCriteria(pCountryId));<br />        }<br /><br />        public static void UpdateCountry(CountryEdit pCountryEdit)<br />        {<br />            DataPortal.Update(pCountryEdit);<br />        }<br /><br />        public static void DeleteCountry(SingleCriteria pCountryId)//String pCountryId)<br />        {<br />            DataPortal.Delete(pCountryId);//new SingleCriteria(pCountryId));<br />        }<br /><br /><br />    }<br />}<br /><br />// BusObjectInfo<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class BusObjectInfo : ReadOnlyBase<br />    {<br />        private static int _forceInit;<br /><br />        public static readonly PropertyInfo ActiveProperty =<br />            RegisterProperty(new PropertyInfo("Active", "Active"));<br /><br />        private static readonly PropertyInfo ClassProperty =<br />            RegisterProperty(new PropertyInfo("Class", "Class"));<br /><br />        public static readonly PropertyInfo CreateDateProperty =<br />            RegisterProperty(new PropertyInfo("CreateDate", "CreateDate"));<br /><br />        private static readonly PropertyInfo IdProperty =<br />            RegisterProperty(new PropertyInfo("Id", "Id"));<br /><br />        public static readonly PropertyInfo UpdateDateProperty =<br />            RegisterProperty(new PropertyInfo("UpdateDate", "UpdateDate"));<br /><br />        public BusObjectInfo(BusObjectDTO pBusobjectDTO)<br />        {<br />            LoadProperty(ClassProperty, pBusobjectDTO.Class);<br />            LoadProperty(IdProperty, pBusobjectDTO.Id);<br />            LoadProperty(CreateDateProperty, pBusobjectDTO.CreateDate);<br />            LoadProperty(UpdateDateProperty, pBusobjectDTO.UpdateDate);<br />            LoadProperty(ActiveProperty, pBusobjectDTO.Active);<br />        }<br /><br />        protected BusObjectInfo()<br />        {<br />            // 08/01/2009 this is needed else you get errors like<br />            // csla one or more properties are not registered for this type<br />            _forceInit = 0;<br />        }<br /><br />        protected override void OnDeserialized(StreamingContext context)<br />        {<br />            // 08/01/2009 this is needed else you get errors like<br />            // csla one or more properties are not registered for this type<br />            _forceInit = 0;<br />            base.OnDeserialized(context);<br />        }<br /><br />        public string Class<br />        {<br />            get { return GetProperty(ClassProperty); }<br />        }<br /><br />        public string Id<br />        {<br />            get { return GetProperty(IdProperty); }<br />        }<br /><br />        public DateTime CreateDate<br />        {<br />            get { return GetProperty(CreateDateProperty); }<br />        }<br /><br />        public DateTime UpdateDate<br />        {<br />            get { return GetProperty(UpdateDateProperty); }<br />        }<br /><br />        public Boolean Active<br />        {<br />            get { return GetProperty(ActiveProperty); }<br />        }<br />    }<br />}<br /><br />// CountryInfo<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class CountryInfo : BusObjectInfo//ReadOnlyBase<br />    {<br />        private static readonly PropertyInfo CountryIdProperty =<br />            RegisterProperty(new PropertyInfo("CountryId", "CountryId"));<br /><br />        private static readonly PropertyInfo NameProperty =<br />            RegisterProperty(new PropertyInfo("Name", "Name"));<br /><br />        public CountryInfo(BusObjectDTO pBusobjectDTO) : base(pBusobjectDTO)<br />        {<br />            LoadProperty(CountryIdProperty, pBusobjectDTO.Id);<br />            LoadProperty(NameProperty, ((CountryDTO)pBusobjectDTO).Name);<br />        }<br /><br />        public string CountryId<br />        {<br />            get { return GetProperty(CountryIdProperty); }<br />        }<br /><br />        public string Name<br />        {<br />            get { return GetProperty(NameProperty); }<br />        }<br /><br />        protected override object GetIdValue()<br />        {<br />            return CountryIdProperty;<br />        }<br /><br />        public override string ToString()<br />        {<br />            return NameProperty.ToString();<br />        }<br />    }<br />}<br /><br />// Country DTO<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br /><br />namespace SKN.Library<br />{<br />    [DataContract(Namespace = Namespaces.SKN, Name = "CountryDTO")]<br />    [Serializable]<br />    public class CountryDTO : BusObjectDTO<br />    {<br />        public CountryDTO(string pClass, string pId, SmartDate pCreateDate, SmartDate pUpdateDate, bool pActive,<br />                          string pCountryId, string pName) : base(pClass, pId, pCreateDate, pUpdateDate, pActive)<br />        {<br />            CountryId = pCountryId;<br />            Name = pName;<br />        }<br /><br />        [DataMember(Order = 20)]<br />        public string CountryId { get; set; }<br /><br />        [DataMember(Order = 21)]<br />        public string Name { get; set; }<br />    }<br />}<br /><br />// CountryInfoList<br />using System;<br />using System.Runtime.Serialization;<br />using Csla;<br />using Csla.Server;<br />using DataPortal = Csla.DataPortal;<br /><br />namespace SKN.Library<br />{<br />    [ObjectFactory("SKN.ObjectFactory.CountryListFactory, SKN.ObjectFactory")]<br />    //[DataContract(Namespace = Namespaces.SKN, Name = "CountryInfoList")]<br />    [Serializable]<br />    public class CountryInfoList : ReadOnlyListBase<br />    {<br />        public void LoadData(CountryInfoDTOList pCountryListDTO)<br />        {<br />            RaiseListChangedEvents = false;<br />            IsReadOnly = false;<br />            foreach (CountryDTO countryDTO in pCountryListDTO)<br />            {<br />                Add(new CountryInfo(countryDTO));<br />            }<br />            IsReadOnly = true;<br />            RaiseListChangedEvents = true;<br />        }<br /><br />        public static CountryInfoList GetAllCountries()<br />        {<br />            return DataPortal.Fetch();<br />        }<br /><br />        public static CountryInfoList GetCountriesByName(SingleCriteria pName)//string name)<br />        {<br />            return DataPortal.Fetch(pName);//new SingleCriteria(name));<br />        }<br />    }<br />}<br /><br />// CountryInfoDTO<br />using System;<br />using System.Collections.Generic;<br />using System.Runtime.Serialization;<br /><br />namespace SKN.Library<br />{<br />    [Serializable]<br />    public class CountryInfoDTOList : List<br />    {<br />        public CountryInfoDTOList()<br />        {<br />        }<br /><br />        public CountryInfoDTOList(IEnumerable collection) : base(collection)<br />        {<br />        }<br />    }<br />}<br /><br />// county DAL<br />using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Runtime.Serialization;<br />using Csla.Data;<br />using Natural.EL;<br />using SKN.DAL;<br />using SKN.Library;<br /><br />namespace Natural.EAL<br />{<br />    [Serializable]<br />    public class CountryEAL : ICountryDAL<br />    {<br />        #region ICountryDAL Members<br /><br />        public CountryInfoDTOList GetAllCountries()<br />        {<br />            using (ObjectContextManager ctx =<br />                ObjectContextManager.GetManager("NaturalEntities"))<br />            {<br />                IQueryable countries = from p in ctx.ObjectContext.Land<br />                                        orderby p.Basic.Naam<br />                                        select p;<br /><br />                return LoadCountryList(countries); //customerListDTO;<br />            }<br />        }<br /><br />        #endregion<br /><br />        private static CountryInfoDTOList LoadCountryList(IQueryable pCountries)<br />        {<br />            var countryInfoDTOList = new CountryInfoDTOList();<br />            foreach (Land c in pCountries)<br />            {<br />                //c.GemeenteReference.Load();<br />                //c.Gemeente.BasicReference.Load();<br />                //c.Gemeente.LandReference.Load();<br />                //c.Gemeente.Land.BasicReference.Load();<br />                if (!c.BasicReference.IsLoaded)<br />                    c.BasicReference.Load();<br />                //bool active = (c.aktief.ToUpper().Trim() == "TRUE");<br />                countryInfoDTOList.Add(<br />                    new CountryDTO(<br />                        c.Class,<br />                        c.Id,<br />                        c.Basic.CreateDate,<br />                        c.Basic.UpdateDate,<br />                        true,<br />                        c.Id,<br />                        c.Basic.Naam));<br />            }<br />            return countryInfoDTOList;<br />        }<br />    }<br />}<br /><br />I got the same for Customer what could be going wrong ?<br />I am a newbie and testing CSLA, I hope this is a bit clear.<br /><br />Is this a good way of working ?<br /><br />Thx<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>koen@skn.be replied on Thursday, January 08, 2009</h2>Ok, but when do the GetCustomers first and then the GetCountries everything works fine ?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Thursday, January 08, 2009</h2>Puzzle.  I would just put a breakpoint in and see what is breaking.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br /><br />-----Original Message-----<br />From: koen@skn.be [mailto:cslanet@lhotka.net] <br />Sent: Thursday, January 08, 2009 1:27 PM<br />To: Sergey Barskiy<br />Subject: Re: [CSLA .NET] RE: DataPortal.Fetch failed (Property load or set failed for property PostalCode<br /><br />Ok, but when do the GetCustomers first and then the GetCountries everything works fine ?<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, January 08, 2009</h2>Does he need the _forceInit trick his Country class?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>koen@skn.be replied on Friday, January 09, 2009</h2>The forceinit is needed see<br />http://forums.lhotka.net/forums/thread/28883.aspx<br /><br />The app breakse when reaching the constructor of CustomerInfo where its trying to do<br /><br />LoadProperty(PostalCodeProperty, ((CustomerDTO) pBusobjectDTO).PostalCode);<br /><br />The pBusobjectDTO is containing the correct info and the postalcode is a string?<br /><br />But as I said only when first getting the countries and after that getting the customers ?? When gettiing the customers first everything works fine ??</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>koen@skn.be replied on Friday, January 09, 2009</h2>I did some further debugging and find out that it is actually in the constructor of the busobjectinfo so I changed all the properties to string (in busobjectinfo and customerinfo) and now the app does no longer crash but in my updatedate property i do not have the date but the postalcode instead in createdate i have the id and ...?<br /><br />public BusObjectInfo(BusObjectDTO pBusobjectDTO)<br />        {<br />            LoadProperty(ClassProperty, pBusobjectDTO.Class);<br />            LoadProperty(IdProperty, pBusobjectDTO.Id);<br />            LoadProperty(CreateDateProperty, pBusobjectDTO.CreateDate);<br />            LoadProperty(UpdateDateProperty, pBusobjectDTO.UpdateDate);<br />            LoadProperty(ActiveProperty, pBusobjectDTO.Active);<br />        }<br /><br />when doing the LoadProperty(CreateDateProperty, pBusobjectDTO.CreateDate);<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, January 09, 2009</h2>I'm not sure you should be doing LoadProperty calls in your constructor.&nbsp; Those probably belong in a Child_Fetch or DataPortal_Fetch operation.. or a separate method called by one of those if this is one the base class.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
