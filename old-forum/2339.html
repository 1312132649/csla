<html><header><title>SmartDate validation - want broken rule for invalid date rather than exception</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SmartDate validation - want broken rule for invalid date rather than exception</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2339.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JustinThirkell posted on Tuesday, February 13, 2007</h2><P>I'm sure someone has overcome this but I can't find anything in the forums (except for the same problem - no solution though).</P>
<P>I've got a SmartDate&nbsp;and when I set the .Text to an invalid date it throws an ArgumentException.&nbsp; I understand that this is documented and by design.&nbsp; </P>
<P>But... if someone sets an invalid date, surely it would be better to add a broken rule rather than throw an exception?!&nbsp; Because I'm exposing my business objects through some services I'm just dealing with string as a transport type and I can't trust that the service consumer is going to constrain the UI to only allow valid date formats.&nbsp; </P>
<P>Because&nbsp;an exception is being thrown I get none of the goodness with the broken rules functionality - no property name, no invalid value, etc&nbsp;to tell the client what really went wrong.&nbsp; At the moment I have to parse the exception message just to get the name of the property to send back to the service consumer... yuch.</P>
<P>My thinking is that I need to extend SmartDate so that any invalid cast in the .Text setter causes the storage of the invalid value (for later use in error messages) and creates a new broken rule.&nbsp; Is this the best way to handle it?</P>
<P>Thanks</P>
<P>Justin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, February 14, 2007</h2><P>Rather than deal with all of that I decided to just set invalid dates to blank. I also check for SQL Server smalldattime dates.</P>
<P>Here is the modified code:</P>
<P><FONT color=#008000 size=2>'JF 10/12/06 - The SmartDate Structure cannot be inherited so we need to change CSLA2 itself.<BR></FONT><FONT color=#008000 size=2>'If Value is not a date then set it to Date.MinValue so that "" will be returned. <BR></FONT><FONT color=#008000 size=2>'Effectively this blanks out invalid values in the UI. <BR></FONT><FONT color=#008000 size=2>'Also, ensure that Value is in the range 1/1/1900 to 6/6/2079 else SQL Server smalldatetime value is violated.</P></FONT><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> StringToDate( _<BR>&nbsp; </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> emptyValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> EmptyValue) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Date</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> Len(value) = 0 </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> emptyValue = SmartDate.EmptyValue.MinDate </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Date</FONT><FONT size=2>.MinValue<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Date</FONT><FONT size=2>.MaxValue<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>ElseIf</FONT><FONT size=2> IsDate(value) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp; </FONT><FONT color=#008000 size=2>'JF 10/12/06 - </FONT><FONT color=#008000 size=2>This is the change:<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CDate</FONT><FONT size=2>(value) &gt;= </FONT><FONT color=#0000ff size=2>CDate</FONT><FONT size=2>(</FONT><FONT color=#ff00ff size=2>"1/1/1900"</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CDate</FONT><FONT size=2>(value) &lt;= </FONT><FONT color=#0000ff size=2>CDate</FONT><FONT size=2>(</FONT><FONT color=#ff00ff size=2>"6/6/2079 11:59 PM"</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CDate</FONT><FONT size=2>(value)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Date</FONT><FONT size=2>.MinValue<BR>&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>Else<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Select</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> LCase(Trim(value))<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateT, </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateToday, </FONT><FONT color=#ff00ff size=2>"."<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> Now<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateY, </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateYesterday, </FONT><FONT color=#ff00ff size=2>"-"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> DateAdd(DateInterval.Day, -1, Now)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateTom, </FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.SmartDateTomorrow, </FONT><FONT color=#ff00ff size=2>"+"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> DateAdd(DateInterval.Day, 1, Now)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<FONT color=#008000 size=2>'JF 10/12/06 - </FONT><FONT color=#008000 size=2>This is the change:</FONT></FONT><FONT color=#0000ff size=2><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#0000ff size=2>If</FONT><FONT color=#000000 size=2> emptyValue = SmartDate.EmptyValue.MinDate </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>Date</FONT><FONT color=#000000 size=2>.MinValue<BR>&nbsp;&nbsp;&nbsp; &nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>Date</FONT><FONT color=#000000 size=2>.MaxValue<BR>&nbsp;&nbsp;&nbsp; &nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>If<BR><BR></FONT></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' <FONT color=#008000>'Throw</FONT></FONT><FONT color=#008000><FONT size=2> </FONT><FONT size=2>New</FONT><FONT size=2> ArgumentException(</FONT><FONT size=2>My</FONT></FONT><FONT size=2><FONT color=#008000>.Resources.StringToDateException)<BR></FONT>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Select<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kenb replied on Wednesday, September 30, 2009</h2><P>I want my business objects to behave the way Justin describes them.&nbsp; I'm using CSLA 3.0.4.</P>
<P>I'm looking for advice on my approach.&nbsp; I've already created a SmartNullable(T) which is&nbsp;based on Nullable(T) with the addition of allowing string-value assignment and tracking invalid values/state.</P>
<P>A validation rule will be able to ask the structure if it has an invalid value and provide an appropriate description (e.g. 'hello world' is not a valid date.)</P>
<P>Does this seem like a well-designed solution?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
