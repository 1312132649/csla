<html><header><title>Custom Data Portal Proxy</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Data Portal Proxy</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5168.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan posted on Tuesday, July 29, 2008</h2><P>I have&nbsp;a couple of CSLA&nbsp;classes that must be run remotely.&nbsp; My project also includes a number of other CSLA classes that must be run locally.&nbsp; While I could add the RunLocal attribute to all the local class methods, there are far more of them than remote classes, and some of the local classes&nbsp;exist in a class library I am not in control of, so I would love to create a way to tag the&nbsp;classes that should be run remotely.</P>
<P>I have started down that path by creating a custom data portal proxy class and a custom attribute which I've added to the remote classes.&nbsp; My data portal proxy class looks for this attribute and calls the regular RemotingProxy or LocalProxy as necessary.</P>
<P>However, I have run into a problem with the IsServerRemote method, as I have no way of determining&nbsp;the object type&nbsp;in order to return true or false.&nbsp; The DataPortal functions know that information, but it doesn't look like I can pass it along without modifying the CSLA code.</P>
<P>Am I working on the correct solution to my problem?&nbsp; Is there a way for IsServerRemote to return the correct value?</P>
<P>Jason</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 29, 2008</h2><P>That's a tough problem, and I don't have&nbsp;a good solution offhand.</P>
<P>If you can see a way I could refactor the data portal client code to better help you, I am certainly willing to consider suggestions.</P>
<P>It isn't something I have time to research right now though, as the 2008 book and CSLA Light and 3.5.1 are more than consuming my available time.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan replied on Tuesday, July 29, 2008</h2><P>Thanks for the response.&nbsp; I'm afraid I don't know enough about the framework to suggest any refactoring - is it possible to pass the objectType into the constructor for the IDataPortalProxy?</P>
<P>I had thought having some classes run remotely while others run locally would have been something commonly implemented, but I guess I was mistaken.&nbsp; Does anyone have any other options for implementing partial remoting?&nbsp; I have the remoting classes in a separate class library.</P>
<P>Currently I have come up with the following two options:</P>
<P>1. Change the remote code to a full fledged web service.</P>
<P>2. Create a custom version of the CSLA framework.</P>
<P>Jason</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 29, 2008</h2><P>Maybe I don't completely understand what you want. In 3.5 and earlier you can't create an instance of the DataPortal object, and the proxy object is cached. So your custom proxy is cached by the data portal.</P>
<P>In other words, the DataPortal methods call your proxy instance over and over again.</P>
<P>Your proxy must know whether (on a per-call basis) it is calling the local or a remote proxy?</P>
<P>So you should be able to alter your IsServerRemote property value accordingly? You should be able to delegate the call to the last proxy you used - to the LocalProxy or WcfProxy (or whatever) and just return the value provided by that underlying proxy.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jason Berkan replied on Tuesday, July 29, 2008</h2><P>(I'm using CSLA 2.0 - forgot to mention that.)&nbsp; In simple terms, I have&nbsp;class A, which must run remotely and&nbsp;class B, which must run locally.&nbsp; If I put the remoting entries in my web.config, both&nbsp;class A and&nbsp;class B run remotely, causing the DataPortal_Fetch on&nbsp;class B to fail.&nbsp; The simple solution is to&nbsp;add RunLocal to&nbsp;class B, but I also have&nbsp;class C (which exists in a DLL written by someone else) that must also run locally.&nbsp; Changing&nbsp;class C is a bit more difficult.</P>
<P>So, I was looking for a way to tag&nbsp;class A as a remote&nbsp;class and have the framework know that it should be run remotely, while all the other&nbsp;classes should run locally.&nbsp; Various searches through this forum lead me to the custom proxy, though I missed the fact that it is cached.</P>
<P>I thought of returning the last proxy used through IsServerRemote, but that doesn't work because IsServerRemote is queried when creating the DataPortalContext, which occurs before any data access, meaning that it&nbsp;will return the wrong value whenever you call a local object and then a remote object (or vice versa).</P>
<P>Jason</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
