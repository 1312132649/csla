<html><header><title>OnDeserialized is missing</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OnDeserialized is missing</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7953.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Thursday, November 05, 2009</h2><P>Hi Rocky.</P>
<P>As you might know (well... maybe you don't) CslaGen relies on events to extend the base functionality of the generated code. Those events are setup on an overriden <FONT face="Courier New">Initialize()</FONT>&nbsp;method.&nbsp;There is no problem if <FONT face="Courier New">CslaAutoCloneOnUpdate</FONT> is <FONT face="Courier New">false</FONT>.</P>
<P>In future releases of Csla, the standard will be <FONT face="Courier New">CslaAutoCloneOnUpdate</FONT>&nbsp;is <FONT face="Courier New">true</FONT>. This means that the event handlers we setup in the <FONT face="Courier New">Initialize()</FONT>&nbsp;method will be gone when we update/save/clone the object - the object is cloned but the non-serializable part will be lost.</P>
<P>The solution is to override <FONT face="Courier New">OnDeserialized (System.Runtime.Serialization.StreamingContext context)</FONT>.</P>
<P>The problem is some object stereotypes don't support <FONT face="Courier New">OnDeserialized</FONT> so there is nothing to override. How can we be sure to re-setup the event handlers on update/clone? </P>
<P>On Csla 3.0.5 the problems affects <FONT face="Courier New">ReadOnlyList</FONT> and <FONT face="Courier New">NameValueList</FONT>. <BR>On Csla 3.7.1 besides the above lists, it also affects <FONT face="Courier New">BusinessListBase</FONT>! <BR></P>
<P>Any directions?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 05, 2009</h2><P>I just looked at the BLB code, and OnDeserialized() is a protected virtual method. It only shows up in Intellisense if you have show advanced members turned in on Visual Studio, but it is there.</P>
<P>For the other two types you can do the following:</P>
<BLOCKQUOTE dir=ltr>
<P>[System.Runtime.Serialization.OnDeserialized]<BR>private void OnDeserializedHandler(System.Runtime.Serialization.StreamingContext context)<BR>{<BR>&nbsp; OnDeserialized(context);<BR>}<BR><BR>protected virtual void OnDeserialized(System.Runtime.Serialization.StreamingContext context)<BR>{ <BR>&nbsp; // put your code here<BR>}</P></BLOCKQUOTE>
<P>Since you are doing code-gen, you can just gen this entire block of code - putting your event handling stuff in the "your code here" location.</P>
<P>I'll add this to the wish list for a future fix - but I'm now working on version 4.0, so that's where the fix will come in.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Friday, November 06, 2009</h2><P>Thanks.</P>
<P>If you don't mind, I'll quote you on CslaGen group.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper replied on Friday, January 15, 2010</h2>Just to follow up on this...<br><br>CommandBase is one of these stereotypes that doesn't have an extension point for handling OnDeserialized correct? <br><br>Since I have my own set of base classes, I will need to use the _forceInit trick (pg 249-250 C# 2008), which means I need to include...<br><br><font face="Verdana" size="1">[System.Runtime.Serialization.OnDeserialized]<br>private void OnDeserializedHandler(System.Runtime.Serialization.StreamingContext context)<br>{<br>&nbsp; OnDeserialized(context);<br>}<br><br>protected virtual void OnDeserialized(System.Runtime.Serialization.StreamingContext context)<br>{ <br>&nbsp; // put your code here<br>}</font><br><br>... in my base class. Did I miss anything?<br><br>Edit:<br><br>Just to add a little bit of context to this, I am using v3.8 for silverlight, and my property declarations use the syntax:<br><br><font face="Verdana" size="1">public virtual string Username<br>{<br>&nbsp; get { return ReadProperty(UsernameProperty); }<br>&nbsp; private set { LoadProperty(UsernameProperty, value); }<br>}<br>private static readonly PropertyInfo&lt;string&gt; UsernameProperty = RegisterProperty&lt;string&gt;(x =&gt; x.Username);</font><br><br>Maybe this hack isn't needed anymore?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 15, 2010</h2><P>Current versions of CSLA .NET include a "force init" routine that normally solves the static field init problem.</P>
<P>On Silverlight however, this routine is only reliable if you declare your PropertyInfo&lt;T&gt; fields as public.</P>
<P>The reason is that the routine uses reflection to "touch" a static member on each class in the inheritance hierarchy, thus forcing static initialization of all fields in that class. In Silverlight however, reflection only works against public members, so any class having zero public static fields won't be automatically initialized.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
