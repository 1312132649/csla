<html><header><title>Changes in Editable Child List not reflected in DataGrid</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Changes in Editable Child List not reflected in DataGrid</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11752.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pegesaka posted on Monday, December 17, 2012</h2><p>I have an Editable Root List (Jobs) that contains an Editable Child List (Assignments). I have one data grid that displays details of the job (in the left most column) and all the jobs assignments in a row. The DataGrid has SelectionUnit = Cell and SelectionMode=Single. The assignments cells are build with a DataTemplate -<br /><br />&nbsp;&nbsp;&nbsp; &lt;DataTemplate x:Key=&quot;ShiftsTemplate&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;StackPanel&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;TextBlock&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;TextBlock.Text&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;MultiBinding Converter=&quot;{StaticResource ShiftConverter}&quot; Mode=&quot;TwoWay&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Binding Path=&quot;Job&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Binding RelativeSource=&quot;{RelativeSource FindAncestor, AncestorType=DataGridCell}&quot; Path=&quot;Column.DisplayIndex&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Binding Path=&quot;Assignments&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/MultiBinding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/TextBlock.Text&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/TextBlock&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/StackPanel&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br /><br />and the columns for these are added to the grid dynamically when the window opens (1 for each day in the PayPeriod) -<br /><br /><br />&nbsp;&nbsp;&nbsp; private void Window_Loaded(object sender, RoutedEventArgs e) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PayPeriod oPP = (PayPeriod)(from oPayP in EnvSettings.EnvObject.CurrPPs where oPayP.Key == 67 select oPayP).Single();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DateTime dtFrom = oPP.ScheduledDate;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; (oPP.NumberOfWeeks * 7); i++)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddRunDayColumn(dtFrom.AddDays(i));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FoRJobs = RosteredJobs.GetRosteredJobs(1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dataGrid5.ItemsSource = FoRJobs;<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; private void AddRunDayColumn(DateTime dtHeader) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataGridTemplateColumn oCol = new DataGridTemplateColumn();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oCol.Header = dtHeader.ToString(&quot;ddd\nd/M&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oCol.CellTemplate = (DataTemplate)Resources[&quot;ShiftsTemplate&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dataGrid5.Columns.Add(oCol);<br />&nbsp;&nbsp;&nbsp; }<br /><br />The DisplayIndex of the column corresponds to the RunDay of the Assignment so the assignments appear in the correct day as a single descriptive string using the converter -<br /><br />&nbsp; public class ShiftConverter1 : IMultiValueConverter {<br /><br />&nbsp;&nbsp;&nbsp; public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string sResult = string.Empty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JobAssignments oAssignments = (JobAssignments)values[2];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (JobAssignment oAssign in (from oJA in oAssignments<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where oJA.RunDay == (int)values[1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select oJA).ToSyncList(oAssignments)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (sResult != string.Empty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sResult = sResult + &quot;\n&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sResult = sResult + oAssign.Start.ToString(&quot;hh:mm&quot;) + &quot;-&quot; + oAssign.Finish.ToString(&quot;hh:mm&quot;) + &quot; &quot; + oAssign.WorkedHrs + &quot;hrs&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sResult;<br />&nbsp;&nbsp;&nbsp; }<br /><br />All works fine, displaying the job and its assignments in each row.<br /><br />I have a button on the form which simply deletes the first assignment from the first job -<br /><br />&nbsp;&nbsp;&nbsp; private void button1_Click(object sender, RoutedEventArgs e) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FoRJobs[0].Assignments.RemoveAt(0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //dataGrid5.ItemsSource = null;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //dataGrid5.ItemsSource = FoRJobs;<br />&nbsp;&nbsp;&nbsp; }<br /><br />but the Datagrid is not updated. The object definitly has the assignment removed from the collection. I have another button that removes the first job from the root collection and the grid displays the job being deleted. If I uncomment the 2 lines above the grid is redrawn and the assignment is deleted, but I was hoping for a more dynamic, automatic binding than this.<br /><br />Is there something extra I have to do with nested child collections to get the Datagrid to display the assignment being deleted dynamically? The converter code is not being run with each assignment deletion, but is with each job deletion which suggests that some change notification is not being relayed to the bindings of the grid?<br /><br />Any help would be greatly appreciated.<br /><br />Cheers,<br /><br />Perry<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pegesaka replied on Monday, December 17, 2012</h2><p>Im trying to determine if bindings like this (multibinding, using a converter to render the display, on an object that is not the ItemsSource of the grid) are not possible to be dynamically displayed. </p>
<p>I have put handlers on the PropertyChanged and ChildChanged on both the Jobs list and the contained Assignments list. Interestingly deleting an Assignment fires both PropertyChanged of Assignments list and ChildChanged of the Jobs list. Changing a text property of the Job object (at the same level as the Assignments and Job properties used in the multibinding) just fires the Job&#39;s ChildChanged but is updated in the grid immediately.</p>
<p>Cheers,</p>
<p>Perry</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
