<html><header><title>CSLA 3.6:  AsyncLoadManager / SerializationException</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.6:  AsyncLoadManager / SerializationException</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5407.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>PaulCoetser posted on Tuesday, September 16, 2008</h2><P>Hi there, </P>
<P>I'am new to CSLA and I'am getting the following error:</P>
<P>Type 'Csla.Core.LoadManager.AsyncLoadManager' in Assembly 'Csla, Version=3.6.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30' is not marked as serializable.</P>
<P>this error get thrown from : <FONT color=#2b91af size=2>BinaryFormatterWrapper&nbsp; <FONT size=2>Serialize method.</P></FONT></FONT>
<P>I've got a simple screen with a grid on.&nbsp; I have a simple table with 5 columns that I bind to the grid via a bindingsource.&nbsp; The grid as well as my CSLA object is editable.&nbsp; As soon as I change data within the grid I receive the above error.</P>
<P>&nbsp;</P>
<P>code:</P>
<P>&nbsp;</P><FONT size=2><FONT color=#008000 size=2>
<P><FONT color=#0000ff>//retrieve all the account types from the database.</FONT></P>
<P><FONT color=#0000ff>AccountTypes accountTypes = AccountTypes.SelectAll();</FONT></P>
<P><FONT color=#0000ff>//accountTypeDS is a Bindingsource</FONT></P>
<P></FONT><FONT color=#0000ff>accountTypeDS.Datasource&nbsp;&nbsp;= accountTypes;</FONT></P>
<P><FONT color=#0000ff>//assign the datasource to the grid control<FONT size=2></P>
<P>gridControlResults.DataSource = accountTypeDS;</P></FONT></FONT></FONT>
<P>&nbsp;</P>
<P>This is currently running as a 2-tier model.</P>
<P>As you can see it is very straight forward.&nbsp; What am I missing?</P>
<P>&nbsp;</P>
<P>Kind regards</P>
<P>Paul Coetser</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 16, 2008</h2><P>Is this the pre-release version or directly from subversion?</P>
<P>The current code in subversion appears to be correct - all the fields using that type are marked as NonSerialized. It is possible that an older pre-release was missing that attribute.</P>
<P>Or it is possible we're missing something else - but my test apps are running, including some data bound grids - so I'm hoping you are using one of the pre-releases?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>detritus replied on Saturday, September 27, 2008</h2>I also got this message yesterday but cannot reproduce it (Before the error, I updated by working copy from SVN). Saved stack trace at the time. I'm very new to CSLA so, could be something I did wrong but may be stack trace helps tracking down the reason. For me it started when RebindUI calls BeginEdit in the UI (the method is copied from Project.cs):<br><br><br>&nbsp;&nbsp; at System.Runtime.Serialization.FormatterServices.InternalGetSerializableMembers(RuntimeType type)<br>&nbsp;&nbsp; at System.Runtime.Serialization.FormatterServices.GetSerializableMembers(Type type, StreamingContext context)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.WriteObjectInfo.InitMemberInfo()<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.WriteObjectInfo.InitSerialize(Object obj, ISurrogateSelector surrogateSelector, StreamingContext context, SerObjectInfoInit serObjectInfoInit, IFormatterConverter converter, ObjectWriter objectWriter)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.WriteObjectInfo.Serialize(Object obj, ISurrogateSelector surrogateSelector, StreamingContext context, SerObjectInfoInit serObjectInfoInit, IFormatterConverter converter, ObjectWriter objectWriter)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Write(WriteObjectInfo objectInfo, NameInfo memberNameInfo, NameInfo typeNameInfo)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Serialize(Object graph, Header[] inHeaders, __BinaryWriter serWriter, Boolean fCheck)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream serializationStream, Object graph, Header[] headers, Boolean fCheck)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream serializationStream, Object graph)<br>&nbsp;&nbsp; at Csla.Serialization.BinaryFormatterWrapper.Serialize(Stream serializationStream, Object graph) in E:\comps\csla\trunk\cslacs\Csla\Serialization\BinaryFormatterWrapper.cs:line 40<br>&nbsp;&nbsp; at Csla.Core.UndoableBase.CopyState(Int32 parentEditLevel) in E:\comps\csla\trunk\cslacs\Csla\Core\UndoableBase.cs:line 157<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.BeginEdit() in E:\comps\csla\trunk\cslacs\Csla\Core\BusinessBase.cs:line 947<br>&nbsp;&nbsp; at PortalGrup.Rep2Doc.Win.CardEditForm.BindUI() in D:\PortalGrup\Rep2Doc\app\source\Win\MasterData\CardEditForm.cs:line 82<br>&nbsp;&nbsp; at PortalGrup.Rep2Doc.Win.CardEditForm.RebindUI(Boolean saveObject, Boolean rebind) in D:\PortalGrup\Rep2Doc\app\source\Win\MasterData\CardEditForm.cs:line 108<br>&nbsp;&nbsp; at PortalGrup.Rep2Doc.Win.CardEditForm.btnApply_Click(Object sender, EventArgs e) in D:\PortalGrup\Rep2Doc\app\source\Win\MasterData\CardEditForm.cs:line 68<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tim.offermann replied on Tuesday, September 30, 2008</h2><P>I experienced the same issue with the current 3.6.0 Beta release (080926). After an inspection of the involved code I would think that the reason for this exception can be found in the context of Csla.Core.UndoableBase : void CopyState(int parentEditLevel).</P>
<P>My observations so far:</P>
<UL>
<LI>A HybridDictionary (named state) is created</LI>
<LI>A loop travesals the business object tree and adds Name/Value pairs to this dictionary</LI>
<LI>After collecting the state the HybridDictionary is serialized into a MemoryStream</LI></UL>
<P>The problem is, that on collecting the state the "NonSerilizable" attribute&nbsp;of the AsyncLoadManager in BusinessBase is ignored and the _loadManager is included int the state dictionary.&nbsp;Upon serialization of the (HybridDictionary!) state the exception is thrown as the AsyncLoadManager class&nbsp;is not marked as serilizable.</P>
<P>Best Regards</P>
<P>Tim</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, September 30, 2008</h2><P>There was an issue with AsyncLoadManager field in BB not marked as NotUndoable.&nbsp; The issue was corrected.</P>
<P>Thank you.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
