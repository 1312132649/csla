<html><header><title>Transactional Fetch with Update</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Transactional Fetch with Update</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12422.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>andrew123 posted on Tuesday, March 04, 2014</h2><p>I have a BusinessListBase class which I want to fetch a number of children, and at the same time update a status property and commit this transactionally.</p>
<p>Essentially I am fetching a batch and ensuring that no-one else will fetch these same items.</p>
<p>How would I go about doing this?</p>
<p>Inside the DataPortal_Fetch I can open a new SqlConnection and create a new Transaction to fetch and populate the children. &nbsp;Then within that I need to change a property on each of the children and Save the whole list. &nbsp;But won&#39;t calling Save on the BusinessListBase from within the DataPortal_Fetch cause problems?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, March 04, 2014</h2><p>Although you could do this, I highly recommend that you do not. What you are describing can lead to deadlocks. &nbsp;In general pattern of fetching with transaction isolation level of serializable, which you will need to issue exclusive locks, while also updating some data, is prone to deadlocks. &nbsp;You probably want to just issue transnational update only, then close connection, the close new connection and fetch. &nbsp;Really, the best way is to do this in a store procedure that would issue an update with the OUTPUT clause you can fetch from. &nbsp;This will virtually guarantee no deadlocks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andrew123 replied on Tuesday, March 04, 2014</h2><p>Yes, I could do it in a Stored Procedure, but it&#39;s exactly what I was trying to avoid.</p>
<p>Assuming the Fetch query I issued was using the&nbsp;<span>UPDLOCK hint to avoid deadlocks, what would the process be from within the DataPortal_Fetch to issue the updates?</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Wednesday, March 05, 2014</h2><p>I think the same as in any other DP_Fetch, you would talk to the database to issue the updates, then fetch the same data?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
