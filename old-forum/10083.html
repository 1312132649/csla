<html><header><title>Readonly List and Delete</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Readonly List and Delete</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10083.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby posted on Wednesday, February 16, 2011</h2><p>Hi,</p>
<p>I&#39;m quite new to CSLA and at my first steps I stumbled over some basic concepts. Lets explain that in a little example:</p>
<p>Let&#39;s assume I have a simple list of customers (a large list) diplayed in a kind of search form. And lets imagine further I do not want to edit those customers, I only want to list them. So the <span style="font-family:Consolas;color:#2b91af;">BusinessListBase&lt;CustomerList,CustomerInfo&gt;</span> where <span style="font-family:Consolas;color:#2b91af;">CustomerInfo</span> is a <span style="font-family:Consolas;color:#2b91af;">ReadOnlyBase&lt;CustomerInfo&gt;</span> would certainly the way to go. With this concept the user could view the customers in the list and double click to view a read only form with more customer data. So far so good....</p>
<p>Now I want to add a feature &quot;DeleteCustomer&quot;. The user should be able to delete the customers either from the form or directly in the list. I assume I would call <span style="font-family:Consolas;color:#2b91af;">customerInfo.Delete()</span> somewhere in the code. But i have a readonly list and a readonly BO! Do I really have to switch to a BusinessList instead of ROL? That seems odd... Even if I would decide to switch to a BusinessList then I had to call <span style="font-family:Consolas;color:#2b91af;">customerList.Remove(currentCustomer)</span>. Remember the customer list is huge. Should I then iterate thru all customers in order to check which one is deleted? I would prefer to call <span style="font-family:Consolas;color:#2b91af;">customer.Delete()</span> and have the (readonly list) notified about the change (I do not want to reload the huge list). I have read the article <a href="http://www.lhotka.net/weblog/IAmWorkingOnMyUsingCSLANET30EbookAndWroteSomeContentThatIDontThinkImGoingToUseInTheBook.aspx">http://www.lhotka.net/weblog/IAmWorkingOnMyUsingCSLANET30EbookAndWroteSomeContentThatIDontThinkImGoingToUseInTheBook.aspx</a> and that seems a good solution (for updating). But does it work for delete as well?</p>
<p>I mean, in my list of customers I do not need undo or tracking nor business rules. Its simple a result list but it should have delete capabilities...</p>
<div></div>
<p>Any hints?</p>
<p>Regards</p>
<p>Kirby</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, February 16, 2011</h2><p>Hi,</p>
<p>With ReadOnly objects you should also use ReadOnlyListBase (and not BusinessListBase which is for Editable objects). </p>
<p>As the name indicates - a ReadOnly object is just that - ReadOnly. So to add a &quot;delete&quot; method i would implement as:</p>
<p>* a CommandObject that does the Delete on a given &quot;customerId&quot;.<br />* a method in the ReadOnlyList that will first call the CommandObject for delete and the remove the Item from the list. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby replied on Thursday, February 17, 2011</h2><p>Hi JonnyBee,</p>
<p>thank you for your answer, but I&#39;m still confused. From the documentation:</p>
<p><em>&quot;A command object represents some server-side command or action, and it is used to encapsulate processing <span style="text-decoration:underline;">other than</span> simple create, read, update, and <span style="text-decoration:underline;">delete operations</span>.&quot;</em></p>
<p>For sure I want to delete but I want to do this on a ReadOnlyList. I think, what I need is something like a &quot;ImmutableObjectsList&quot;. I do not want to change the objects itself but I want to delete them (if nessecary). I trust you that your suggestion will work out (I have not tried it so far) but it seems still odd that I have (for such a basic operation like delete) to code something &quot;special&quot;. I want to stick with the CSLA concept, that&#39;s why I want to know how to solve this&nbsp;very common scenario with CSLA (the CSLA way and not something special).</p>
<p>With best regards</p>
<p>Dirk</p>
<p>&nbsp;</p>
<p><span style="font-size:small;">
<p>&nbsp;</p>
</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, February 17, 2011</h2><p>First - a ReadOnly object should be readonly. This means: NO Delete, NO Edit, NO Save.</p>
<p>CommandObject is typically used in EditableObjects for data access that is not a typical CRUD operation. A ReadOnly object should only have Create/Read abd Update/Delete so if you wish to have a Delete method AND use the DataPortal on a readonly list you cannot do this a part of a normal DataAccess and should then use the CommandObject.</p>
<p>A ReadOnly list has no means for marking one or more objects for Delete and than perform the delete as part of a Save operation on the entire list.&nbsp;</p>
<p>IMO: It is NOT a common scenario to load ReadOnly objects into a list and then delete objects. </p>
<p>Remember: If you were to load a readonly list as a child of BO object - how should you hande N-Level Undo and Deletes in the readOnly list. There&#39;s no intention to a Delete mechanism on ReadOnly objects in Csla.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby replied on Thursday, February 17, 2011</h2><p>Thank you for your explanation. I would accept the solution with the CommandObject but (please forgive me) it just <em>feels wrong</em>.</p>
<p>Maybe I&#39;m completely on the wrong way. I don&#39;t <span style="text-decoration:underline;">have to</span> use the ReadOnlyList - I just thought it would be the right way to do so.</p>
<p>May I come back to the sample scenario? When I want to display a (huge) list of customers and when I want to be able to delete customers, is then the ReadOnlyList together with the CommandObject you described&nbsp;the right way? Or would it be better to implement an editable list (e.g. BusinessList)? I mean there is no need for editing the customers but maybe this is a &quot;cleaner&quot; or simple better way to do this?</p>
<p>Just loading a big list of &quot;objects&quot; (e.g. customers) and be able to delete those objects must be a common scenario in a lot of business applications. Outlook has a list of emails, a CD-Collection management application has a list of CDs, a CRM application has a list of customers...&nbsp;That&#39;s why I think it should be supported &quot;out of the box&quot;. Please correct me if I&#39;m wrong.</p>
<p>Sorry for the questions but I just try to understand what is best way to go according to CSLA.</p>
<p>Thank you so much for your patient!</p>
<p>Regards </p>
<p>Dirk</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, February 17, 2011</h2><p>Csla implements the &quot;mobile object&quot; pattern by using the DataPortal and a number of restrictions in terms of Data Access.</p>
<p>This can be a great challenge for large lists and hence the DiffGram sample to only send modified rows back to the server. By default, the entire object graph is sent back to the server, including unchanged and modified rows and deleted rows. </p>
<p>The advantage of using the command object is that only the necessary data is sent back to the server - not the entire list. But you must encapsulate the code in the ReadOnly list to be able to turn off IsReadOnly and remove the item if delete is successful. </p>
<p>Comparably - If you loaded a large list of EditableObjects and wanted to delete an item you would typicalle us &quot;deferred deletion&quot;, ie mark the item for deletion (moved to DeletedList) and send the entire list (ALL items) to the server for update/delete.</p>
<p><b>Rethinking&nbsp; - you should create an editable object (CustomerEdit) with a static Delete method for Immediate deletion. The CustomerEdit object would&nbsp; be used similar to a command object for immediate deletion of the Customer. The same object may also be used for loading customer data and edit the selected customer from the readonly list.<br /></b></p>
<p><b>Wrap the Delete code in the ReadOnly list so you can turn off IsReadOnly, remove item from readonly list and reset IsReadOnly. </b></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 17, 2011</h2><p>Hi Dirk,</p>
<p>So you have a search, of which you get back a list of customers.&nbsp; This is standard readonly / readonlylist behavior.</p>
<p>If you wish to enable deleting from the search results, a command object to do the delete is totally an appropriate way to go.&nbsp; You already have everything you need to know to enable a delete, so why not?</p>
<p>Where you&#39;d want Delete on a BusinessBase subclass would be more appropriate to enable delete while the user is already editing the customer object.&nbsp; </p>
<p>Note that you have a lot of options here; you can do the command and have it do the delete, you can have an editable object on which you can call delete, or you can do both.&nbsp; </p>
<p>It all boils down to your use case.&nbsp; </p>
<p>So think of your various use cases; typically the search result object (CustomerInfo, a ReadOnlyBase subclass) will have a subset of the data you could find in the full customer edit screen.&nbsp; Sometimes that will be enough information for the user to make a decision to delete the customer.&nbsp; Sometimes not, and so the user will double click at which point you&#39;d go through the expense of loading up the editable object (Customer, as BusinessBase root subclass).&nbsp; The user checks out some stuff, then decides on the full information that they want to delete (and I assume you alway have a way to undo the delete as well, the defered delete).</p>
<p>Now, if you need to enable both use cases, behind the scenes you&#39;d want to have a way to reuse logic, if there are some conditions which will prevent a user from actually deleting, then you&#39;d encapulate that logic into another class which both methods can use to actually do the delete.</p>
<p>Hopefully this post gives you some ideas about where to go from here.&nbsp; As I said, you have a lot of options, and which ones you chose depend on what you need to do.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby replied on Friday, February 18, 2011</h2><p>Thank You all for your contribution.</p>
<p>I thjink I have a solution. It was so easy but for me as a newbie not so obvious... The concept of making a ReadOnlyList not ReadOnly (for a while) and then turn back to ReadOnly that was the missing link.</p>
<p>I implemented on the CustomerList Business object:</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span>
<p>&nbsp;</p>
<span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CustomerDelete(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">int id</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">)<br />{<br /></span></span><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">&nbsp;&nbsp; //Delete the customer<br />&nbsp;&nbsp;&nbsp;</span></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Customer</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&nbsp;customer = </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Customer</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.GetCustomer(id);<br />&nbsp;&nbsp; customer.Delete();<br />&nbsp;&nbsp; customer.Save();<font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">&nbsp;&nbsp; //remove&nbsp;customer from list<br />&nbsp;&nbsp; </span></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CustomerInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> customerInfo = </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CustomerInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.GetCustomerInfo(id);<br />&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.IsReadOnly = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">false</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">;<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp;&nbsp; this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.Remove(customerInfo);<br />&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.IsReadOnly = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">true</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">;<br /></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">}</span></span></p>
</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">So I end up with having a ReadOnly list having ReadOnly customers. I can on request load an editable customer object (where I also implemented a Delete). The ReadOnlyList itself implements a Delete (see above), so now I can delete objects from a ReadOnly list - perfect! </span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Together with the link above I will be able to synchronize a ReadOnly list with information coming from editable objects and I will later implement the suggestion with the CommandObject (sounds like a perfect solution for large lists).</span></span></p>
<p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">All of your information was very helpful!</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Thank You so much!</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Regards</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Dirk</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, February 19, 2011</h2><p>You could even create a static factory method on Customer for &quot;immediate deletion&quot; and avoid one round trip to the server: </p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this metohod will call DataPortal_Delete<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void DeleteCustomer(int id)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.Delete&lt;Customer&gt;(id);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">// and on your readonly list<br /></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CustomerDelete(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">int id</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">)<br />{<br /></span></span><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">&nbsp;&nbsp; //Delete the customer<br />&nbsp;&nbsp; </span></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"></span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Customer</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.DeleteCustomer(id);<br /></span><span style="font-family:Consolas;font-size:x-small;">
</span></span>
</p>
<p><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">&nbsp;&nbsp; //remove&nbsp;customer from list<br />&nbsp;&nbsp; var </span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">customerInfo = this.First(</span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">p =&gt; p.Id == </span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">id)</span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">;<br />&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.IsReadOnly = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">false</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">;<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp;&nbsp; this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.Remove(customerInfo);<br />&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.IsReadOnly = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">true</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">;<br /></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">}</span></span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
