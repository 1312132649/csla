<html><header><title>ASP.Net Edit Child Collection with DataList</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ASP.Net Edit Child Collection with DataList</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8305.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmbRedGetta posted on Thursday, January 07, 2010</h2><P>I'm trying to edit a child collection using a DataList (so that the child collection is saved when the parent is saved), but I'm not sure how to get the information out of the DataList and back into my child collection.</P>
<P>I'm using a CSLADataSource to bind the List, and during the DataSource_SelectObject event I'm linking the BusinessObject up to the child collection object.&nbsp; That works and the list is rendered with the rest of the information on the page.</P>
<P>I'm probably over-thinking it, but I can't figure out how to get the information out of the DataList to push into the child collection.&nbsp; The UpdateObject event on that DataSource is never called since I'm not updating one row at a time, so do I need to loop the DataList rows and copy the information from there back into the child collection during the root object's Update event?</P>
<P>On a Windows Forms app I did a while back, it was simply a matter of setting the BindingSource to link up with the appropriate DataMember of the root object.<FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmbRedGetta replied on Thursday, January 07, 2010</h2><P>Sorry, I guess I've been a little too deep in this...</P>
<P>I tried it out, and looping the DataList items and pulling the values out of the DataList controls and pushing those values back into my child list worked perfectly.</P>
<P>I was concered about how to identify a new list item (that didn't yet have an ID value since that is assigned in the database), but keeping the same order and using the DataListItem's ItemIndex property to identify the index of the item in the child collection worked just fine.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fark replied on Saturday, March 06, 2010</h2><p>Would you mind posting a sample of how you did this.&nbsp; I&#39;ve been trying to do something similar and need some guidance.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmbRedGetta replied on Tuesday, March 16, 2010</h2><p>Add an additional&nbsp;CSLA Data Source to the page that will bind your child collection, and code that data source&#39;s SelectObject method to link up with the child collection:</p>
<p>
<div><span style="font-size:x-small;"><span style="font-size:x-small;">
<p>e.BusinessObject = DirectCast(GetOrderForm(), OrderForm).Fields</p>
<p><span style="font-size:x-small;">Then, during your main data source&#39;s insert and update events, call a method that loops through the DataList and rebuilds the child collection before saving the main object:</span></p>
</span></span></div>
</p>
<p><span style="font-size:x-small;"><span style="font-size:x-small;">
<p>
<div><span style="font-size:x-small;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">
<p>Private Sub UpdateFields()<br /><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp; Dim</span></span><span style="font-size:x-small;"> obj </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">As</span></span><span style="font-size:x-small;"> OrderForm = GetOrderForm()<br />&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size:x-small;"></span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">For</span></span><span style="font-size:x-small;"> </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">Each</span></span><span style="font-size:x-small;"> item </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">As</span></span><span style="font-size:x-small;"> DataListItem </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">In</span></span><span style="font-size:x-small;"> FieldsDataList.Items<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.Fields(item.ItemIndex).Label = </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">CType</span></span><span style="font-size:x-small;">(item.FindControl(</span><span style="font-size:x-small;color:#a31515;"><span style="font-size:x-small;color:#a31515;">&quot;FieldLabelTextBox&quot;</span></span><span style="font-size:x-small;">), TextBox).Text<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.Fields(item.ItemIndex).Type = </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">CType</span></span><span style="font-size:x-small;">(item.FindControl(</span><span style="font-size:x-small;color:#a31515;"><span style="font-size:x-small;color:#a31515;">&quot;FieldTypeDropDownList&quot;</span></span><span style="font-size:x-small;">), DropDownList).SelectedValue</span><span style="font-size:x-small;"><br />&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">Next<br /></span></span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">End</span></span><span style="font-size:x-small;"> </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">Sub</span></span></p>
</span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">
<p>Protected Sub OrderFormDataSource_UpdateObject(ByVal sender As Object, ByVal e As Csla.Web.UpdateObjectArgs) Handles OrderFormDataSource.UpdateObject<br /><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp; Dim</span></span><span style="font-size:x-small;"> obj </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">As</span></span><span style="font-size:x-small;"> OrderForm = GetOrderForm()<br />&nbsp;&nbsp;&nbsp;&nbsp; Csla.Data.DataMapper.Map(e.Values, obj, </span><span style="font-size:x-small;color:#a31515;"><span style="font-size:x-small;color:#a31515;">&quot;ID&quot;</span></span><span style="font-size:x-small;">)<br />&nbsp;&nbsp;&nbsp;&nbsp; UpdateFields()<br />&nbsp;&nbsp;&nbsp;&nbsp; SaveOrderForm(obj)<br /></span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">End</span></span><span style="font-size:x-small;"> </span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">Sub<span style="font-size:x-small;"><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;"> </span></span><span style="font-size:x-small;color:#0000ff;"><span style="font-size:x-small;color:#0000ff;">Hope this helps!</span></span></span></span></span></p>
</span></span></span></span></span></span></span></span></div>
</p>
<span style="font-size:x-small;"></span></span></span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
