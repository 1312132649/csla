<html><header><title>Inheritance Woes.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Inheritance Woes.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5039.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lwmorris posted on Monday, June 30, 2008</h2><P>Has anyone experience problems when inheriting from another custom class? Specifically, I have two classes&nbsp;(Customer and Person) that work when each is directly inheriting from BusinessBase. However, if I change Customer to inherit from Person then I&nbsp;loose all the properties when the object is back on the server.</P>
<P>Any help would be appreciated!</P>
<P>&nbsp;</P><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>Serializable</FONT><FONT size=2>()]<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>:</FONT><FONT color=#2b91af size=2>Person<BR></FONT><FONT size=2>{</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Factory Methods</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2> NewCustomer(){</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>DataPortal</FONT><FONT size=2>.Create&lt;</FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>&gt;();}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> Customer() : </FONT><FONT color=#0000ff size=2>base</FONT><FONT size=2>()</P>
<P>{ </FONT><FONT color=#008000 size=2>/* Require use of factory methods */</FONT><FONT size=2> }</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> GetIdValue(){</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Id;}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt; IdProperty = RegisterProperty&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(</FONT><FONT color=#a31515 size=2>"Id"</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"Id"</FONT><FONT size=2>));</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2> Id<BR>{<BR></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2>{</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> GetProperty&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(IdProperty);}<BR></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2>{SetProperty&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(IdProperty, </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>);}<BR>}</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Data Access</P>
<P>[</FONT><FONT color=#2b91af size=2>RunLocal</FONT><FONT size=2>()]<BR></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Create(){}</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Insert()<BR>{<BR></FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2> c = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>;<BR></FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2> id = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Id;<BR>}<BR></FONT><FONT color=#0000ff size=2>#endregion<BR></FONT><FONT size=2>}</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2></FONT>&nbsp;</P><FONT size=2><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>Serializable</FONT><FONT size=2>()]<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>abstract</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>:</FONT><FONT color=#2b91af size=2>BusinessBase</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>&gt;<BR>{</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt; NameProperty = RegisterProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(</FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>));</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> Name<BR>{<BR></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2>{</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> GetProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(NameProperty);}<BR></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2>{SetProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(NameProperty, </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>);}<BR>}<BR>}</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lwmorris replied on Monday, June 30, 2008</h2><P>WOW! Found two solution.</P>
<P>1.&nbsp;Override OnDeserialized in my base class OR</P>
<P>2. Replace the ManagedProperties&nbsp;with local variables (on the base class only)<FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 01, 2008</h2><P>Or</P>
<P>3. Implement a pattern to force the static fields of the base class to initialize. There are several techniques, I like this one the best (put this code in your base class):</P>
<BLOCKQUOTE dir=ltr>
<P>private static int _dummy;<BR><BR>private BaseClassConstructor()<BR>{<BR>&nbsp; _dummy = 0;<BR>}</P></BLOCKQUOTE>
<P>This ensures that the static fields of the base class (the RegisterProperty() calls) are executed before any properties are manipulated on the business object.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lwmorris replied on Wednesday, July 02, 2008</h2><P>I tried the static dummy method&nbsp;and it didn't work. After my object is sent to the Webservice/WcfService, my properties all return an Invalid cast exception. Uncommenting the OnDeserialized fixes the problem.</P>
<P>Here's my updated base class:</P>
<P><FONT size=2>[</FONT><FONT color=#2b91af size=2>Serializable</FONT><FONT size=2>()]<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>abstract</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Person<BR></FONT><FONT size=2>:</FONT><FONT color=#2b91af size=2>BusinessBase</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>&gt;<BR>{</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Factory Methods<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2> NewPerson()<BR>{<BR></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>DataPortal</FONT><FONT size=2>.Create&lt;</FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>&gt;();<BR>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _dummy;<BR></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> Person(): </FONT><FONT color=#0000ff size=2>base</FONT><FONT size=2>()<BR>{<BR>_dummy = 0;<BR>}</P>
<P></FONT><FONT color=#008000 size=2>//protected override void OnDeserialized(System.Runtime.Serialization.StreamingContext context)<BR></FONT><FONT color=#008000 size=2>//{<BR></FONT><FONT color=#008000 size=2>// base.OnDeserialized(context);<BR></FONT><FONT color=#008000 size=2>//}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> GetIdValue(){</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Name;}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt; NameProperty = RegisterProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>Person</FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(</FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>));</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> Name{<BR></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2>{</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> GetProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(NameProperty);}<BR></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2>{SetProperty&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;(NameProperty, </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>);}<BR>}</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Data Access</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Insert()<BR>{<BR></FONT><FONT size=2>}<BR></FONT><FONT color=#0000ff size=2>#endregion<BR></FONT><FONT size=2>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 02, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>Oh yeah, I forgot about that part &#8211; you need to set _dummy
in the OnDeserialized() override too.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky</span><b><span><o:p></o:p></span></b></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Annesh replied on Friday, August 22, 2008</h2>Eish, after many hours - this solved all my problems. Thanks :-)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, August 22, 2008</h2><P>I didn't know this would work at all, since the Customer type isn't known to BusinessBase&lt;T&gt; and if you fetch using a Person.Criteria, you'll get a Person, not a Customer. (Of course, I suspose you could implement Customer.Criteria, etc.) </P>
<P>Is inheriting from BusinessBase&lt;T&gt; derived classes considered an OK/recommended practice?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, August 22, 2008</h2>I think the workaround would be in any subclass of BusinessBase that is also subclassed.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Boris replied on Monday, October 06, 2008</h2>&gt;I think the workaround would be in any subclass of BusinessBase that is also subclassed.<br><br>Is that a guess?<br><br>I'm afraid, I'll have to put the fix pretty much in every class inheriting from MyBusinessBase (including MyBusinessBase) as long as they have some children (no backing fields)...or Not?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 06, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>That is not a guess. If you inherit from BusinessBase&lt;T&gt;
more than 1 level (in other words, you have your own custom base class) then
you MUST put the _forceInit code in every one of your classes.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky</span><b><span><o:p></o:p></span></b></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Boris replied on Monday, October 06, 2008</h2>Yes...Many thanks for the quick reply!!<br><br>BusinessBase-&gt;MyBusinessBase-&gt;MyBoThatIsNotInheritedButHasChildren<br><br>For a second there I thought that one of last suggestions was: <br>putting the fix only in MyBusinessBase would be sufficient...<br>(Sorry if I misunderstood)<br><br>And, now if I understand correctly it needs to go to both: <br>MyBusinessBase &amp; BOThatIsNotInheritedButHasChildren<br><br>&nbsp;</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
