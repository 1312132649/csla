<html><header><title>why not hold reference to Root object in the child object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>why not hold reference to Root object in the child object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1071.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jason2000 posted on Wednesday, August 30, 2006</h2><P>During my research on CSLA, I found a problem which confused me these days:<BR>A business Object has a member field named _parent that is a reference to the Collection Object which contain it. But, during many business applications, the validation rules and authorization rules of a child object usually utilize the information of its root object rather than the collection object which containing it.<BR>&nbsp;I will take ProjectTracker as an example. I assumed that there is a validation rule such as :"if days between started date and Ended date is no more than 10 days, then the total number of resource needed should be less than 4 ". When this rule is established in the ProjectResource class, started date and ended date should be achieved from the Root Object(that's Project) while the total number can be achieved from the collection object, but it seemed that ProjectResource object doesnâ€™t having the referrence to a Project object. <BR>&nbsp;To solve this problem, I do the following work. <BR>&nbsp;1.Firstly declare a private filed in the ProjectResource class and establish corresponding attribute and set method<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [NotUndoable()]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [NonSerialized()]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Project _parent;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public PriceSuite Parent<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _parent; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; internal void SetParent(Project project)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _parent = project;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;2.Secondly override OnDeserialized in the Project calsss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void&nbsp; OnDeserialized(StreamingContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this._resources.SetParent(this);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;3.add this sencentence in&nbsp; method DataPortal_Create of Projectclass to cope with locally creating project object<BR>&nbsp;&nbsp;&nbsp; protected override void DataPortal_Create(object criteria)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _id = Guid.NewGuid();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _started.Date = DateTime.Today;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this._resources.(this);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules();<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; Then in every ProjectResource object, the reference of Project object can be achieved through ((ProjectResource)this.Parent).Parent.<BR>&nbsp; I don't know whether it is a satisfied solution. Because I think ProjectResource class doesn't hold the reference of its root object in CSLA.NET architecture. Does it mean that these business rules&nbsp;should be implemented in the Project class. If it is,how to appropriate to implemente it?</P>
<P>thks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Wednesday, August 30, 2006</h2>There has been some discussion of this in the past - you may want to search. <br><br>The upshot is that maintaining a reference to the parent couples the behavior of the two objects too tightly. The child then has to "know" about the fields in the parent. Instead have the parent implement an interface that expresses the data you need to share. In your case it would be ResourceCount and you could have an iProject interface that implements this. <br><br>Dean<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Wednesday, August 30, 2006</h2>I sometimes do something similar to what you've described Jason for the same reasons, ie, rules in my child objects depend on the state of the parent.<br><br>Rather than keep a reference to the parent in each child, I put a reference to the parent in the collection, probably expose it as internal and then use the existing parent property of BusinessBase. To get a parent property from within the child it then needs something like:<br><br>((ProjectList) this.Parent).ParentProject.MyProperty<br><br>Ross<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DanEssin replied on Wednesday, August 30, 2006</h2>I guess this is a question for Rocky. Why not provide every base object with the Parent property so we don't have to add it by hand each time we need it?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jason2000 replied on Thursday, August 31, 2006</h2>i suppose that Rocky'original intention is to implement&nbsp; rules like&nbsp;"if days between started date and Ended date is no more than 10 days, then the total number of resource needed should be less than 4 " in the Project Class,but i wander how to implement it appropriately and effectively.i&nbsp; hope rocky could give his opinion</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Thursday, August 31, 2006</h2><p class="MsoNormal"><span>One of the
basic OOP principles to keep in mind is program to an interface and not an
implementation.<span>&nbsp; </span>A child should not have
a reference to its concrete parent.<span>&nbsp; </span>A
child should know as little about its parent as possible.<span>&nbsp; </span>It is not a good idea for the child to have a
reference to its parent because it becomes tightly-coupled with its parent.<span>&nbsp; </span>This creates a rigid design and does not make
your child reusable.<span>&nbsp; </span>The most common way
to solve your problem is to abstract out what your child needs into an
interface or abstract class.<span>&nbsp; </span>The parent
should implement this interface and the child should only reference the parent
through this interface.<o:p></o:p></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jason2000 replied on Friday, September 01, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>malloc1024:</strong></div><div>
<P class=MsoNormal><SPAN>One of the basic OOP principles to keep in mind is program to an interface and not an implementation.<SPAN>&nbsp; </SPAN>A child should not have a reference to its concrete parent.<SPAN>&nbsp; </SPAN>A child should know as little about its parent as possible.<SPAN>&nbsp; </SPAN>It is not a good idea for the child to have a reference to its parent because it becomes tightly-coupled with its parent.<SPAN>&nbsp; </SPAN>This creates a rigid design and does not make your child reusable.<SPAN>&nbsp; </SPAN>The most common way to solve your problem is to abstract out what your child needs into an interface or abstract class.<SPAN>&nbsp; </SPAN>The parent should implement this interface and the child should only reference the parent through this interface.<o:p></o:p></SPAN></P>
<P></div></BLOCKQUOTE></P>
<P>validation rules like "if days between started date and Ended date is no more than 10 days, then the total number of&nbsp; resource needed should be less than 4 " contains information from the root object <FONT color=#0000ff>Prjoect</FONT> and the child Object <FONT color=#0000ff>ProjectResource</FONT>,at last, i implement this in the Project Class like this:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void OnDeserialized(System.Runtime.Serialization.StreamingContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _resources.ListChanged += new System.ComponentModel.ListChangedEventHandler(Resources_ListChanged);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and if the DataPortal_Create Method is RunLocal(),add the sentence before ValidationRules.CheckRules();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [RunLocal()]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Create(object criteria)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _id = Guid.NewGuid();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _started.Date = DateTime.Today;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _resources.ListChanged += new System.ComponentModel.ListChangedEventHandler(Resources_ListChanged);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; then we could do complex rule validation in the method Resources_ListChanged<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void Resources_ListChanged(object sender, System.ComponentModel.ListChangedEventArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //do complex validation things;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } </P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
