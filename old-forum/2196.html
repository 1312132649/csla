<html><header><title>Changing line focus in my grid make the item being saved</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Changing line focus in my grid make the item being saved</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2196.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albator posted on Tuesday, January 23, 2007</h2><P>Hi, <o:p></o:p></P>
<P>My application contains multiple root objects that must be saved in a same transaction.&nbsp; We made a command object that make this possible.<o:p></o:p></P>
<P>The problem is that we must only save by using this command object.&nbsp; GUI must never call directly a root object save method.<o:p></o:p></P>
<P>We have a problem with <SPAN>EditableRootListBase</SPAN><SPAN>&lt;T&gt;&nbsp; </SPAN>, we bind a collection that inherits from <SPAN>EditableRootListBase</SPAN><SPAN>&lt;T&gt; </SPAN>and the apply edit event raised by the grid when changing grid focus make the object being saved.<o:p></o:p></P>
<P>I'm not sure but maybe it is related to this code that I found in <SPAN>EditableRootListBase</SPAN><SPAN>&lt;T&gt; :</SPAN><o:p></o:p></P>
<P><SPAN>#region</SPAN><SPAN> IParent Members <o:p></o:p></SPAN></P>
<P><SPAN>void</SPAN><SPAN> Csla.Core.<SPAN>IParent</SPAN>.ApplyEditChild(Core.<SPAN>IEditableBusinessObject</SPAN> child)<o:p></o:p></SPAN></P>
<P><SPAN>{<o:p></o:p></SPAN></P>
<P><SPAN>if</SPAN><SPAN> (!_activelySaving &amp;&amp; child.EditLevel==0)<o:p></o:p></SPAN></P>
<P><SPAN>SaveItem((T)child);<o:p></o:p></SPAN></P>
<P><SPAN>}<o:p></o:p></SPAN></P>
<P><SPAN>&nbsp;<o:p></o:p></SPAN></P>
<P><SPAN>Is there a way to avoid object being saved when grid line lost focus?<o:p></o:p></SPAN></P>
<P><SPAN>Thanks<o:p></o:p></SPAN></P>
<P><FONT size=2><FONT size=3><FONT size=2><FONT size=2>&nbsp;</P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 23, 2007</h2>Your design would seem to be flawed.&nbsp; By definition, if you need something to be saved withing a single transaction, you have one root object which controls the other objects.&nbsp; <br><br>It sounds like you're trying to reuse existing objects for another use case.&nbsp; Instead, build a new set of objects specifically for your use case.<br><br>Also, ERLB is designed to save the changes immedately after the row 'commits' the changes.&nbsp; If you don't want that behavior, you should not be using ERLB.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albator replied on Tuesday, January 23, 2007</h2><P>Nothing says that good object design must use only one object for a use case.<SPAN>&nbsp; </SPAN>Multiple objects should interact to make the Job done.</P>
<P>We are using collection of root object for performance purpose; our application is managing big sets of data.&nbsp; Using <SPAN>EditableRootListBase</SPAN><SPAN>&lt;T&gt; allow us to build changeset easyly, this way we avoid passing big collection of data to the second tier.<o:p></o:p></SPAN></P>
<P>So is there a way to avoid root object being saved by the apply edit ?</P>
<P>One way could be to override SaveItem but Iâ€™m realy not sure it is the best choice.</P>
<P>Thanks<o:p></o:p></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 23, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>albator:</strong></div><div>Nothing says that good object design must use only one object for a use case.<span>&nbsp; </span>Multiple objects should interact to make the Job done.</div></BLOCKQUOTE><br><br>I think you misunderstood.&nbsp; I didn't mean one object per use case, I meant one set of objects per use&nbsp; case.&nbsp; But you shouldn't be reusing objects from other use cases unless the behavior is <b><i>identical</i></b> in both use cases.&nbsp; Since you have a problem where you have a few root objects which need to be saved as one transaction, that's a pretty good sign that you're attempting to reuse objects from other uses cases whose behavior is not identicatal (by definition, since the existing objects function within their own transaction isolation).<br>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>albator:</strong></div><div>We are using collection of root object for performance purpose; our application is managing big sets of data.&nbsp; Using EditableRootListBase&lt;T&gt; allow us to build changeset easyly, this way we avoid passing big collection of data to the second tier.</div></BLOCKQUOTE></p><p>You should be designed objects to fulfill use cases.&nbsp; Only after you have done so should you look at performance, and you should strive not to sacrafice design for performance.<br><span><o:p></o:p></span></p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>albator:</strong></div><div>So is there a way to avoid root object being saved by the apply edit ?</div></BLOCKQUOTE></p><p>The behavior ERLB doesn't seem to fit your requirements, so I wouldn't suggest using it for this use case.&nbsp; That class was added recently specifically to allow editing of root objects in a collection, whose changes should be saved after the grid commits the row.&nbsp; <br></p><p>What you probably want is a BusinessListBase root object, but then all the items contained in the list would have to become children.&nbsp; Since the objects should now be children, they should probably be different objects in their own right.&nbsp; You might be able to create a switchable object (one that can be a child or root), but this usually indicates a design problem, and you should proceed with caution.<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albator replied on Wednesday, January 24, 2007</h2><P class=MsoNormal><FONT face=Verdana size=2>Thanks for helping ajj3085,</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>I was trying to be succinct and bypass lots of business and design issues and used the performance aspect as a shortcut to explain the design which is of course wrong. Those root objects must indeed be root objects but while there is a performance benefit this is not the main reason. Those objects are used/refered by other objects but they do not "belong". They can be on their own or, if you prefer, "switch parent". And we are not reusing objects at all.</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>I think there are legitimate reasons to save multiple root objects in the same transaction although I admit it is the first time we have to deal with an ERLB. We are doing it with a command object that wraps the entire transaction from Rocky's recommendation (we met him before the ERLB issue and ERLB was not discussed at the time). </FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>We may have goofed, but those objects are root objects because of their designed behaviors and we need a collection (in fact collections) of them and we must save them (the roots, not the collections) in a common batch transaction. This is working fine (we may not see the train ahead and this is also why we are posting) and the only issue is with the grid that is calling apply edit and bypassing transaction logic.</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>It seems to me that ERLB is assuming too much in this case by allowing the UI to take too much control.</FONT></P>
<P class=MsoNormal><FONT face=Verdana size=2></FONT>&nbsp;</P><FONT face=Calibri size=3>
<P class=MsoNormal>I think that a switch for disabling save on apply edit could be a good solution.</P>
<P class=MsoNormal>Thanks</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, January 24, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>albator:</strong></div><div>I think there are legitimate reasons to save multiple root objects in the same transaction although I admit it is the first time we have to deal with an ERLB. </div></BLOCKQUOTE><br><br>By definition (the definition the framwork is built around) a root object can be saved by itself, independately of other root objects.&nbsp; It may be a parent object as well.&nbsp; Check out page 120 of the C# 2005 edition of Rocky's book. <br><br>Also from the definition of a root object is that a root object defines the scope of a transaction; that is, the root, and any children will be updated within their own transaction.&nbsp; Rocky has posted here about that before.&nbsp; <br><br>That's the reason you're not getting the behavior you desire with ERLB.&nbsp; The framework, because it is built on the concept that a root object updates in its own isolated transaction, won't support what you want.&nbsp; You'll either have to redesign your objects so that there is one root, and the other's become children which can participate in the root objects transaction, or modify the framework by making the changes to ERLB to remove the behavior you find undesirable.<br><br>In the long run the first option is probably the best, unless you're willing to spend more time maintaining&nbsp; your own version of Csla.&nbsp; While you certainly can do that, the more customization you do of the framework, the more effort you'll spend moving to newer versions of the framework.&nbsp; <br><br>It depends on how you see Csla.&nbsp; Is it a starting point for you to modify and tweak to get your own custom framework, or is it more like a component library you'd purchase and cannot modify?&nbsp; If Csla were a commercial project, option 2 wouldn't even likely be available, because you wouldn't have the source at all.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 24, 2007</h2><P>You are trying to do something outside the design parameters for ERLB.</P>
<P>It seems that you have at least two options. </P>
<P>One is to override SaveItem(). I made this method virtual/Overridable primarily with the idea that you could add validation logic, but there's no reason you couldn't entirely override it to do some other type of update operation.</P>
<P>Another is to copy ERLB and use it as a base to make your own, where the save operation isn't handled by the collection itself, but perhaps the collection raises an event so the UI can initiate the save as it sees fit.</P>
<P>Of the two, I think I'd do the first option. Just make sure you handle the edit level properly - which probably means copying the existing SaveItem() code from ERLB and replacing the call to the Save() method with your alternate code.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
