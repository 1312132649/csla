<html><header><title>cslalight, demo001 as vb</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>cslalight, demo001 as vb</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7020.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie posted on Thursday, May 28, 2009</h2><P>i am trying to rewrite demo001 in vb. within the data access region there is a lambda expression <FONT>"</FONT><FONT color=#ffffff><FONT color=#ffffff><FONT color=#000000><FONT>svc.GetDataCompleted += (o, e) =&gt;"</FONT> . i have read that vb does not allow multi-lined lambda&nbsp;expressions. how do i&nbsp;make this work&nbsp;in vb?</FONT></P></FONT></FONT>var svc = new DataService.WebServiceSoapClient();<BR><FONT>svc.GetDataCompleted += (o, e) =&gt;<BR>{<BR>&nbsp;if (e.Error == null)<BR>&nbsp;{<BR>&nbsp;&nbsp; using (BypassPropertyChecks)<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp; Id = e.Result.Id;<BR>&nbsp;&nbsp;&nbsp;&nbsp; Name = e.Result.Name;<BR>&nbsp;&nbsp;&nbsp;&nbsp; City = e.Result.City;<BR>&nbsp;&nbsp; }<BR>&nbsp;}<BR>&nbsp;handler(this, e.Error);<BR></FONT>};<BR>svc.GetDataAsync(criteria.Value);<BR>}<BR></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 28, 2009</h2><P>You start to see why I shifted away from VB over the past few months. Until VB 10 comes out, developing software for Silverlight is really painful. As is developing anything for async .NET models.</P>
<P>The solution is complex. You need to define a message class to emulate the work the C# compiler does for you with a concept called a 'closure'.</P>
<P>I don't have time to translate the code - it is 2-3 times longer than the C# code, because you need to define a message class, create an instance of that class and pass it as a 'userstate' parameter to the GetDataAsync() method, so it comes into your GetDataCompleted event handler.</P>
<P>Psuedocode is:</P>
<P>Public Class Message<BR>&nbsp; Public Property Handler As &lt;whatever type handler is&gt;<BR>End Class</P>
<P>...</P>
<P>Dim svc = New DataService...<BR>Dim msg = New Message<BR>msg.Handler = handler<BR>AddHandler svc.GetDataCompleted, MyEventHandler<BR>svc.GetDataAsync(criteria.Value, msg)</P>
<P>...</P>
<P>Private Sub MyEventHandler(o As Object, e As SomeEventArgsType)<BR>&nbsp; Dim msg = DirectCast(e.UserState, Message)<BR>&nbsp; If e.Error Is Nothing Then<BR>&nbsp;&nbsp;&nbsp; Using BypassPropertyChecks<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Id = e.Result.Id<BR>...<BR>&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp; End If<BR>&nbsp; msg.Handler(Me, e.Error)<BR>End Sub</P>
<P>That's all from memory, and obviously I made up a bunch of type names - you'll have to sort those out - but hopefully this makes some sense.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Monday, June 01, 2009</h2><P>thanx rocky for your help and quick responce! the only thing i had to do a little different was with in the "MyEventHandler" where msg.Handler(Me. eError) is declared i first had to </P>
<P>Dim hdl as &lt;whatever type handler is&gt; = msg.Handler</P>
<P>then</P>
<P>hdl(Me, e.Error)</P>
<P>my next hurdle will be getting the save and cancel buttons working correctly. the cancel button does nothing and the save button throws an Invalid operation - update not allowed. i will investigate further and try and narrow it down as best i can and keep you updated.</P>
<P>germie</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Thursday, June 04, 2009</h2><P>thanx once again, ive been working more on the DataPortal_Fetch and got the code as concise as i could. this is what i came up with.</P>
<P>&nbsp;<FONT size=1>&nbsp; &lt;System.ComponentModel.EditorBrowsable(ComponentModel.EditorBrowsableState.Never)&gt; _<BR>&nbsp;&nbsp; Public Sub DataPortal_Fetch(ByVal criteria As SingleCriteria(Of TestObject, Integer), ByVal handler As&nbsp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.DataPortalClient.LocalProxy(Of TestObject).CompletedHandler)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim svc = New DataService.WebServiceSoapClient<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim msg = New GetDataAsycMessage<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; msg.Handler = handler<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler svc.GetDataCompleted, AddressOf GetDataHandler<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; svc.GetDataAsync(criteria.Value, msg)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler(Me, ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<BR>&nbsp;&nbsp; End Sub</FONT></P>
<P><FONT size=1>&nbsp;&nbsp; Private Sub GetDataHandler(ByVal o As Object, ByVal e As DataService.GetDataCompletedEventArgs)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.Error Is Nothing Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using BypassPropertyChecks<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Id = e.Result.Id<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = e.Result.Name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; City = e.Result.City<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectCast(e.UserState, GetDataAsycMessage).Handler(Me, e.Error)<BR>&nbsp;&nbsp; End Sub</FONT></P>
<P><FONT size=1>&nbsp;&nbsp; Public Class GetDataAsycMessage<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Handler As Csla.DataPortalClient.LocalProxy(Of TestObject).CompletedHandler<BR>&nbsp;&nbsp; End Class</FONT></P>
<P>this code works fine. the problem i am having is with the save and cancel buttons. i belive its the same problem. it seems that when i click the save button it creates a new TestObject instead of referencing the original one. here is the code for the DataPortal_Update that i created.</P>
<P><FONT size=1>&nbsp;&nbsp; &lt;System.ComponentModel.EditorBrowsable(ComponentModel.EditorBrowsableState.Never)&gt; _<BR>&nbsp;&nbsp; Public Overrides Sub DataPortal_Update(ByVal handler As Csla.DataPortalClient.LocalProxy(Of TestObject).CompletedHandler)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim svc = New DataService.WebServiceSoapClient<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim msg = New GetDataAsycMessage<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; msg.Handler = handler<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler svc.UpdateDataCompleted, AddressOf UpdateDataHandler<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim Data As New DataService.Data<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using (BypassPropertyChecks)<BR><FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT>Data.Id = Me.Id<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT>Data.Name = Me.Name</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT>Data.City = Me.City</FONT><BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; svc.UpdateDataAsync(Data, msg)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler(Me, ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<BR>&nbsp;&nbsp; End Sub</FONT></P>
<P><FONT size=1>&nbsp;&nbsp; Private Sub UpdateDataHandler(ByVal o As Object, ByVal e As DataService.UpdateDataCompletedEventArgs)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.Error Is Nothing Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using (BypassPropertyChecks)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Id = e.Result.Id<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = e.Result.Name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; City = e.Result.City<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectCast(e.UserState, GetDataAsycMessage).Handler(Me, e.Error)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp; End Sub</FONT></P>
<P>when i put a stop within the try catch block, me.id, etc.&nbsp;is empty. the xaml code i am using is identical to what is shown in your Demo001 code.&nbsp; i even tried naming the TextBox in xaml to "txtName" etc. and hard codeing it in and it still doesnt work.&nbsp;intellisense does not know "txtName".the problem with&nbsp;the cancel button is nothing happens. im all out of ideas here.</P>
<P>germie</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 04, 2009</h2>Is the code getting to your UpdateDataHandler() method? Or is it calling the handler in the Catch block of the DataPortal_Update() method?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Thursday, June 04, 2009</h2><P>wow, such a quick responce.&nbsp;u beat me to it. &nbsp;i solved it just now and came to post what my problem was. i was declaring my properties wrong. i wrote them up trying to use a private variable like this as described in "Expert VB 2008 Business Objects"</P>
<P><FONT size=1>&nbsp;&nbsp; Private Shared IdProperty As PropertyInfo(Of Integer) = RegisterProperty(New PropertyInfo(Of Integer)("Id"))<BR>&nbsp;&nbsp; <FONT>Private mId As Integer = IdProperty.DefaultValue<BR></FONT>&nbsp;&nbsp; Public Property Id() As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(IdProperty, mId)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Set(ByVal value As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(IdProperty, mId, value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp; End Property</FONT></P>
<P>when i changed it to this, not using the private, both the save and the cancel buttons worked!</P>
<P><FONT size=1>&nbsp;&nbsp; Private Shared IdProperty As PropertyInfo(Of Integer) = RegisterProperty(New PropertyInfo(Of Integer)("Id"))<BR>&nbsp;&nbsp; Public Property Id() As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(IdProperty)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Set(ByVal value As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(IdProperty, value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp; End Property</FONT></P>
<P>dont know why, maybe u have an idea. thanx</P>
<P>germie</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
