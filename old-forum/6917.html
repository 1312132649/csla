<html><header><title>Multiple Connections and DTC</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Multiple Connections and DTC</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6917.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 posted on Thursday, May 07, 2009</h2>I know that this problem has been asked many times in the past, but can't remember this specific scenario and I wanted to throw it out there for the communities input.<br /><br />If I open two connections within a single transaction to two seperate databases, <br />with the following process:<br /><br /> - Open connection to DB1<br /> - Do some stuff on DB1<br /> - Close connection on DB1<br /><br /> - Open conneciton on DB2<br /> - Do some stuff and then close DB2<br /><br />Will this cause the dreaded MS-DTC issue to popup?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 07, 2009</h2><P>Yes, I think that triggers the use of the DTC.</P>
<P>In this case it isn't even <EM>dreaded</EM>, because you are interacting with two different databases, so the only way your data access can be transactionally protected is by using the DTC. That's the only technology that can transactionally protect any operations that span 2+ databases.</P>
<P>The dreaded problem with DTC is where you open two connections <EM>to the same database</EM>, because there are less expensive ways to transactionally protect the single database scenario.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, May 07, 2009</h2>Maybe I'm missing/misunderstanding something, but wouldn't closing the first database connection without completing the transaction cause the DB1 activity to roll back?  If so, I would think that would also potentially eliminate the DTC.<br /><br />- Scott</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 07, 2009</h2>If this entire bit of work is enclosed in a single TransactionScope then<br />both connections should be managed by that same transaction, regardless of<br />whether the connections are closed or not prior to the transaction<br />committing or rolling back.<br /><br />Remember, all the data portal does is wraps your code in this basic<br />structure:<br /><br />using (var tr = new TransactionScope())<br />{<br />  // call your data method (DataPortal_XYZ)<br />  tr.Commit();<br />}<br /><br />Nothing fancy, and nothing you couldn't do yourself. So the normal rules<br />associated with a TransactionScope apply.<br /><br />Rocky</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Friday, May 08, 2009</h2>Thanks for the fast response Rocky, greatly appreciated.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
