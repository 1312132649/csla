<html><header><title>Value manilpulation using validation rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Value manilpulation using validation rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6037.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, December 22, 2008</h2>Hi,<br><br>I had a BO that I was upgrading from the 1.0 version of Csla.&nbsp; One of the the property setters for a Password property would hash the password before storing it in the field.<br><br>In upgrading it, I changed this manipulation to occur in a validation rule.&nbsp; This worked fine, it generated a new salt value, then hashed the password, and set the property value to the generated hash... until..<br><br>I have other rules, string required, on other properties.&nbsp; So I need to call ValidationRules.CheckRules just before DataPortal_Create / Fetch.&nbsp; The fetch is the problem; since the value from the database is already hashed, and the rules are run, it would re-hash the value and update the salt.&nbsp; Not what I wanted.<br><br>So, I added a flag to detect if the value was changed via the property setter, and the rule only operates if that flag is true.&nbsp; The rule sets it back after it runs.&nbsp; Of course, I now have code again in my property setter, and the whole point was to get rid of code there!&nbsp; Just one line, but it's critical that it not be lost if I regenerate properties..<br><br>Any ideas?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>McManus replied on Monday, December 22, 2008</h2><P>Hey Andy,</P>
<P>Isn't it possible to check the IsDirty flag of the business object in the validation rule. If it's false, you must not rehash the password, otherwise you should.</P>
<P>Cheers,<BR>Herman</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 23, 2008</h2>Hmm, I hadn't thought of that.&nbsp; I'll need to double check though when IsDirty is set to true.&nbsp; I thought it was after the rules had been run, during the PropertyHasChanged, but I'm not sure.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Monday, December 22, 2008</h2><P>Checking IsDirty might be helpful, but I'd think that somehow to make this foolproof you would need to know the original value that you last computed a hash for and not recompute it as long as it matches. </P>
<P>I have a similar use case and have two properties - the hash value is a separate property from what the user has keyed, which perhaps simplifies this. </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
