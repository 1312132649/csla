<html><header><title>Required string property validation not working</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Required string property validation not working</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8925.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lloydm posted on Thursday, May 13, 2010</h2><p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">I&rsquo;m having trouble getting CSLA to pick up a required string property validation failure.<span style="mso-spacerun:yes;">&nbsp; </span>I have&nbsp;attempted to implement validation using both the declarative approach with Data Annotations and imperatively by overriding the AddBusinessRules() method, but neither method works so far.<span style="mso-spacerun:yes;">&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;</span>In this case, the object&rsquo;s property contains an empty string just prior to saving (in a winforms app test harness), yet the object has no broken rules and is still marked valid.<span style="mso-spacerun:yes;">&nbsp; </span></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">What&rsquo;s really baffling is that CSLA does properly flag a String Max Length validation failure on the same property! </span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">My business object derives from BusinessBase and implements the Object Factory design for CRUD operations using Entity Framework v.3.5 and the DevArt EF provider for Oracle.<span style="mso-spacerun:yes;">&nbsp; </span>I&rsquo;m also using CSLA v3.8.2.</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">The property declaration in my business object looks like this:</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">[Required(ErrorMessage = &quot; Widget Name is required.&quot;)] &ndash; Passes validation when property is set to an empty string.</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">[StringLength(25, ErrorMessage = &quot;The maximum length for Widget Name has been exceeded.&quot;)] &ndash; Validation fails as expected when property contains &gt; 25 characters.</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">public string WidgetName</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>get { return GetProperty(WidgetName NameProperty); }</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;</span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>set { SetProperty(WidgetName NameProperty, value); }</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">Validation also passes for an empty string value if I apply an imperative rule like this:</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">protected override void AddBusinessRules()</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">{</span></p>
<p class="MsoNormal" style="text-indent:0.5in;margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">ValidationRules.AddRule(Csla.Validation.CommonRules.StringMinLength,</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new Csla.Validation.CommonRules.MinLengthRuleArgs(WidgetNameProperty, 1));</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">}</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">but fails as expected if the property contains a single character with this imperative rule applied:</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">protected override void AddBusinessRules()</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">{</span></p>
<p class="MsoNormal" style="text-indent:0.5in;margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">ValidationRules.AddRule(Csla.Validation.CommonRules.StringMinLength,</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new Csla.Validation.CommonRules.MinLengthRuleArgs(WidgetNameProperty, 2));</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">}</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">Any ideas about what I&rsquo;m doing wrong?</span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>lloydm replied on Thursday, May 13, 2010</h2><p>I found the answer: I needed to explcitly call the CheckRules method in the ObjectFactory&#39;s create method.&nbsp; </p>
<p>I left out a small but very important detail: I was attempting to save an object imediately after creation without touching the required property&#39;s value, but that meant validation logic did not get invoked since&nbsp; the property changed event wasn&#39;t firing. DOH!&nbsp; I also noticed that the required string validation did work as expected if I blanked out the property of an existing object.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
