<html><header><title>Binding BOs to custom controls</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Binding BOs to custom controls</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7499.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>OpticTygre posted on Monday, August 24, 2009</h2>Hey all.  I have a winform app that contains a bindingsource hooked up to one of my BOs.  I also have a custom user control that contains a label and a textbox (for simplicity's sake).  What I'd like to be able to do is bind a custom property of my user control to a property on my BO (done), so I can display the property name on the label (done), and allow the textbox to act as if were bound directly to the bindingsource (not done) as well as have errorprovider capability (not done).<br /><br />I have the label text of my user control hooked up properly so that when the binding on my control changes, the text of the label is updated.<br /><br />I seem to be having issue with setting the databinding on my text property of my textbox control, as well as hooking up an errorprovider to display any validation issues.<br /><br />I hope this isn't too confusing to understand what I'm trying to do.  Can anyone give any pointers as to how to implement this?<br /><br />Thanks!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 24, 2009</h2><P>It has been many years since I did anything like this, but I seem to recall that there was some obscure attribute you had to put on the Text property of a control to make it bindable. Normally this attribute isn't required, but the Text property is defined by the base class and is missing the attribute or something like that.</P>
<P>Of course I could be entirely off base, my memory of this is foggy...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jemmer replied on Monday, August 24, 2009</h2>BindableAttribute ??</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>OpticTygre replied on Tuesday, August 25, 2009</h2>Right.  In my user control, I have declared a public property: MyProperty.<br /><br />I have placed 3 attributes on that property:<br />System.ComponentModel.Browsable(True)<br />System.ComponentModel.Description("Some description.")<br />System.ComponentModel.Bindable(True)<br /><br />In the designer, I set the "MyProperty" binding equal to a Property of my BO through my BindingSource on the main form.<br /><br />I am also capturing the DataBindings_CollectionChanged event in my User Control.  Inside of that method, I set my label's text to the BindingField of the Me.DataBindings("MyProperty").BindingMemberInfo object.<br /><br />My issue is that everything I do from this point to get the textbox's "Text" property databound to the same binding as the exposed "MyProperty" is throwing me design-time errors.<br /><br />Am I being difficult?  Is there an easier way to bind the internal label and text?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Tuesday, August 25, 2009</h2>I saw your post yesterday and almost replied. I don't quite follow what you're trying to do which is unusual. I've used plenty of custom user controls on forms with databinding and never had a problem.<br><br>Putting that aside for a moment, have you implemented INotifyPropertyChanged in your user control?&nbsp; You need that for changes to flow from the control to the BO.<br><br>It's very simple. This sort of thing (C# sorry)<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public event PropertyChangedEventHandler PropertyChanged;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private void OnPropertyChanged(string propertyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (PropertyChanged != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PropertyChanged(this, new PropertyChangedEventArgs(propertyName);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>Code in MyProperty's setter would set the textbox.Text.<br>Code in MyProperty's getter would get the textbox.Text.<br>
<br>In the textbox's TextChanged event you would call OnPropertyChanged("TextboxName") so that databinding knows that MyProperty has changed.<br><br>In some more complex controls where one inner control affects another, I have had to use flags to make things work smoothly and avoid getting into infinite loops. <br><br>The one thing that this won't do for you is make the error icons appear within the control beside the appropriate inner control. Your BO will have a rule on MyProperty so if that is broken then the error appears beside the user control. I have once or twice done something klugy to give the illusion of what you're trying to do by having an zero size checkbox positioned on top of the user control and bind that to a BO property with a rule.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>OpticTygre replied on Tuesday, August 25, 2009</h2>Actually, I finally got it, and took a little bit of a different route.<br /><br />In my user control, "MyProperty" contains the NotifyParent and Bindable attributes.  The getter exposes textbox.text and the setter sets textbox.text.<br /><br />The user control class itself contains the DefaultBindingProperty("MyProperty") attribute.<br /><br />With those things in place, as well as detecting when my databindings change via the Me.Databindings.CollectionChanged event so I can update the label, everything automatically bubbles up to the parent without having to deal with the PropertyChanged event.<br /><br />Now, if there were only an easy way to databind to the actual PropertyInfo object to get the FriendlyName out for my label usage, we'd be all set.  ;)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>OpticTygre replied on Tuesday, August 25, 2009</h2>Oh, and FYI, you can also place an ErrorProvider on your form, and in the DataBindings.CollectionChanged event, set the datasource of the ErrorProvider = Me.Bindings("MyProperty").DataSource, and viola, you have an error provider displaying CSLA validation errors for each control in your user control.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
