<html><header><title>Authorization capability in 4.0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authorization capability in 4.0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9846.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bmmathe posted on Thursday, December 09, 2010</h2><p>I&#39;m currently developing a Csla solution using 3.8.2 and was wondering if authorization was more flexible/customizable in Csla 4.0.x.&nbsp; I have to work with complex auth/validation logic and the line between what&nbsp;is considered authorization&nbsp;or validation is blurry.</p>
<p>I started by reading this post <a href="http://forums.lhotka.net/forums/p/8011/38573.aspx#38573">http://forums.lhotka.net/forums/p/8011/38573.aspx#38573</a>&nbsp;but I don&#39;t think my scenario was addressed very well.</p>
<p>The basic scenario is that we have multiple levels of authorization to manipulate this one particular business entity.&nbsp; All levels can view the object but varying levels can edit varying properties.&nbsp; What makes it more complex is that certain levels can edit a property up to a certain range and another level can edit the same property a different range.&nbsp; So at which point is editing the property an authorization issue or validation issue.&nbsp; I would like to be able to display a validation error if the user changes the property outside her range (so that&#39;s validation right???).&nbsp; </p>
<p>Has anyone ever written authorization rules in validation rules?&nbsp; It can be done but is this an &quot;ideal&quot; solution?</p>
<p>On top of that, after the object is instantiated, the application should be able to &quot;promote&quot; credentials which should reset the authorization for each property.&nbsp; How can you do&nbsp;that after the AddAuth method has been called?&nbsp; </p>
<p>I&#39;m starting to think that I will need a custom solution to meet my needs.&nbsp; I was thinking about creating or hooking into an event that would fire if the principal changed.&nbsp; The business object would handle that event and then call a method to resync the auth rules based on the new roles.&nbsp; We expose public properties to the UI that define the before mentioned allowable ranges for the current user (MaxValue, MinValue) and these properties are bound on the UI which would need to update automatically.</p>
<p>Before creating a solution that accomplished this I was curious if someone else out there has a similar need and solved it using the existing framework.&nbsp; </p>
<p>Thanks,</p>
<p>Brett</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Thursday, December 09, 2010</h2><p>We are using CSLA 4 on my current project.&nbsp; Our requirements are very similar to yours.&nbsp; To illustrate these requirements, let&#39;s say that I have business objects for Widgets.&nbsp; Each Widget has several properties.&nbsp; The data for a given Widget may come from different sources.&nbsp; We have a process, WidgetCrunch, that needs all of this data to perform its calculations, but we want to restrict the access to the data.&nbsp; Data about Widgets that originates from local sources may be edited fully.&nbsp; Data that comes from some external sources may be viewed in a read only mode.&nbsp; Other data may come from sources that, although the data is stored locally, we never want the user to see.&nbsp; To make things more interesting, the local application may have different user logins that each have a authorization that allows different types of access.&nbsp; </p>
<p>For example, Abe may be able to edit his own data, see the data from Private Stuff, Inc. but not see the data supplied by Secrets, Inc.&nbsp; Bill might be allowed to edit the data from Private Stuff, Inc. and to see the data from Secrets, Inc. but not make any changes to it.&nbsp; Carl may be allowed to edit the data from Secrets, Inc. but only see the data from all other sources. &nbsp;</p>
<p>To make this work, we have created a desktop application that contains what we call the &quot;execution context&quot;.&nbsp; This holds a variety of indicators and values that come from the login and from actions taken within the application.&nbsp; We have also created an authorization rule that supports the &quot;can read property&quot; and &quot;can write property&quot; functions.&nbsp; We apply this rule to each property in AddBusinessRules method.&nbsp; We also override the CanReadProperties and CanWriteProperties; this is needed prevent CSLA from caching the status for the class as a whole (something that we do not want to happen).&nbsp; In the rule, we examine the target Widget object that is passed into the rule and the state of the execution context to determine if the user can read or write the individual property value.&nbsp; </p>
<p>A similar tack can be taken for the validation rules.&nbsp; I would argue that the validation rules should be wholly separate from the authorization rules.&nbsp; The validation rules can also be applied to the properties of the object and can take into account the &quot;execution context&quot;.</p>
<p>While this is not trivial, CSLA 4 will definitely allow you to handle this situation, given the approach that I have outlined.</p>
<p>Jon Stonecash</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bmmathe replied on Thursday, December 09, 2010</h2><p>It sounds like your scenario is slightly different in that if the user can edit a property they can edit it to anything they want as long as it doesn&#39;t break a generic validation rule.</p>
<p>My problem is that the user can edit the property however their role determines&nbsp; what they can edit the value to.</p>
<p>For example Abe can edit the property Price but can only set it to values that his role allows ($1 - $100), if he tries to change it over $100 then the system will prompt for an override user to login, that user should be able to edit the property from ($1 - $500) and so on.&nbsp; So it&#39;s not as simple as &quot;this role can edit this property&quot; which is why it&#39;s hard for us to clearly separate validation logic and authorization logic.&nbsp; </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Thursday, December 09, 2010</h2><p>The validation rules can certainly take into account data about the user to determine what is valid and what is not.&nbsp; That is, a user at one level can do something that would be invalid done by a user at another level.&nbsp; We are doing something similar.&nbsp; </p>
<p>The one place that you might have some problems is that CSLA takes the approach is that the user can store anything they want into the object.&nbsp; At any point in time, the object is either valid or not valid.&nbsp; That is, the contents of the object satisfy the validation rules or they do not.&nbsp; An object that is not valid cannot be saved.&nbsp;</p>
<p> There are a number of ways that you could handle the invalid state.&nbsp; The most common is to return an error message as a part of the rule evaluation.&nbsp; This message can be presented to the user as a part of the UI.&nbsp; That message could alert the user that a different login (or whatever) was needed.&nbsp; You could add a property to the business object that indicated that the object was not valid because the user level was wrong.&nbsp; The UI could detect this problem and bring up an appropriate dialogue.&nbsp; If the user then changed the execution context (additional log in, magic incantation, etc.), the validation logic would then return a (possibly) different result. </p>
<p>Note that the CheckRules would have to be re-run for each object in question.&nbsp; This does not happen automatically.</p>
<p>I think that you will find that CSLA 4 can handle your situation.</p>
<p>Jon Stonecash</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
