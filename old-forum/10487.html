<html><header><title>Dynamic Root List and Dynamic Root - where's the &quot;Parent&quot;?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic Root List and Dynamic Root - where's the &quot;Parent&quot;?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10487.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Saturday, July 02, 2011</h2><p>Dynamic Root List is a stereotype on its own while Dynamic Root is just a special Editable Root. Of course the later is part of a collection... sort of. Take the Parent property. You would expect every collection member to hold a reference to its parent collection on the Parent property. This doesn&#39;t happen&nbsp;on Dynamic Root. Quoting the documentation</p>
<p><strong>public Csla.Core.IParent Parent { get; }<br />&nbsp;&nbsp;&nbsp; Member of Csla.Core.BusinessBase</strong></p>
<p><strong>Summary:<br />Provide access to the parent reference for use in child object code.</strong></p>
<p><strong>Remarks:<br />This value will be Nothing [null for you and me] for root objects.</strong></p>
<p>When I want to implement a rule like NoDuplicates - a pretty standard rule for data you edit in a grid - I have to implement my own ParentCollection property and take great care to make sure it is filled in all the right places.</p>
<p>Is&#39;s done and CslaGenFork will have an option to do it for you.</p>
<p>Rocky,</p>
<p>is there some smart way&nbsp;of Csla doing it for us?</p>
<p>After all this is a special case and the Editable Root object is clearly defined as an iitem of a DynamicBindingList</p>
<pre style="font-size:13px;background:white;color:black;font-family:Consolas;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:darkblue;">DocClassEditColl</span>&nbsp;:&nbsp;<span style="color:darkblue;">DynamicBindingListBase</span>&lt;<span style="color:darkblue;">DocClassEdit</span>&gt;
</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, July 05, 2011</h2><p>I think you&#39;re misunderstanding what DynanicRootList is meant to be used for.&nbsp; Its sole use case is to support editing in a grid, where edits are saved as each row&#39;s changes is committed by databinding.</p>
<p>The root objects contained within the list are competely unaware they are in a list, as editing one has no bearing on editing the other. </p>
<p>If you want that concept, use a normal BusinessListBase and change your roots to child objects.</p>
<p>Alternately, you can check the rule by hitting the db in the rule (say by executing a CheckForDupsCommand objet), or just throwing an exception on in the DP methods.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Tuesday, July 05, 2011</h2><p>On further investigation, the &quot;child&quot; EditableRoot objects are indeed aware of the parent. And the rule works ncely.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Tuesday, July 05, 2011</h2><p>In fact, the &quot;child&quot; EditableRoot objects are aware of the Parent only after they are loaded. So the NoDuplicates rule won&#39;t comnplain about duplicates just after loading. When you start editing them, they know about the parent allright. Can you fix this Rocky?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Thursday, July 07, 2011</h2><p>Rocky,</p>
<p>Is there any chance of fixing the &quot;null parent on fecth&quot; issue?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Saturday, July 16, 2011</h2><p>So you have a child, and its parent is null until after its created?&nbsp; The parent won&#39;t (and can&#39;t) be set until after its added to the collection, so I don&#39;t think this will change.</p>
<p>If you have a rule that requires a parent, what I would do is on the BO that contains the collection object, in your DP_F (or child_fetch) after the entire collection is loaded, loop and ask each child to check its rules.&nbsp; You can add an internal method to the child which will call CheckRules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, July 16, 2011</h2><p>Hi Andy,</p>
<p>That&#39;s exactly what am asking Rocky: set the Parent when the object is added to the collection - kind&#39;a overrite the Add() method.</p>
<p>CslaGenFork has an option to set a property ParentList that works beautifuly and allows me to mark to apply the rule NoDuplicates as soon as I load (fetch) the collection.</p>
<p>Using the Parent property only marks duplicates as errors when I try to change them, after fetching.</p>
<p>BTW this is a special kind of collection DynamicRootList that is made of EditableRoot objects. According to the documentation,, as objects are root objects, I was&nbsp;expecting the object to have a NULL Parent property. Then I found out that, after all the collection is fetched, they have a proper Parent property. Either their Parent property should always be null or it should be set from the momemt the object is added to the collection. Like it is, it&#39;s non-sense (or a bug).</p>
<p>Regards</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, July 17, 2011</h2><p>In terms of a NoDuplicate rule I&#39;d rather recommend to do a lookup in the database. </p>
<p>Would you always &quot;assume&quot; to have ALL items from that table loaded into memory? </p>
<p>I&#39;m not sure of what it is that is the real bug here:</p>
<ol>
<li>Should the EditableRoot obects have a Parent at all in the DynamicRootList?&nbsp;</li>
<li>Should Parent be set when new items are added to the DynamicRootList?</li>
</ol>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Monday, July 18, 2011</h2><p>Hi Jonny,</p>
<p>1) The NoDuplicates rule is very interesting because you can use on all of the elements of a given collection. That collection&nbsp; may be not the same &quot;collection&quot; you find in a database table. Say Brands &amp; Models. You cannot repeat a model for a given brand but nothings stops Philips and Siemens to name a model with the same name.&nbsp;Here the collection is the brands of a model. On the other hand, on the collection of brands, there can be no duplicates - no two Siemens brands. In this case, the collection is the database table.</p>
<p>BTW I made a version the follows the errormessagedelegate just like the othe rule of CslaContrib I&#39; like to publish there</p>
<p>2) The issue... you can choose the issue, according to the chosen rule :)</p>
<p>A) If the CSLA rule is <strong>root objects always have a NULL Parent property</strong>, then that rule should apply to EditableRoot objects created by a DynamicRootList and EditableRoot object should always have a NULL Parent property, no matter they are child of a DynamicRootList.</p>
<p>B) If the CSLA rule is <strong>objects created by other object should have a properly filled&nbsp;Parent propery</strong>, then the paretn property should be set as soon as the object is created. Right now what is happening is that the Parent property is set only after&nbsp;the creation of&nbsp;all&nbsp;EditableRoot objects child of a DyamicRootList.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
