<html><header><title>N-level undo in CSLA 3.0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>N-level undo in CSLA 3.0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3103.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DamReev posted on Wednesday, June 27, 2007</h2>We are having problems with N-Level undo now that we have switched our project to use CSLA.NET 3.0. I can't figure out what to do to prevent us from getting an EditLevel mismatch when attempting to Cancel/Apply Edits in a dialog.<br><br>I have an editable Meeting root object which has a child list of Participants. We bind the meeting object via a BindingSource control to various controls on the UI. If you click a button "Invite Participants" we launch a modal dialog which shows all your participants bound to a grid (without using a BindingSource) (Infragistics grid if that matters). <br><br>Here's what we do.<br>1. We call BeginEdit() on the Meeting BEFORE we bind it to the BindingSource.<br>2. We set the BindingSource.DataSource = the Meeting.<br>3. User clicks "Invite Participants".<br>4. We do Meeting.BeginEdit()<br>5. User makes edits in modal dialog (which binds list of Participants to a grid, details about the participants are not editable, at least not at the moment but Participant derives from Businessbase, ParticipantList derives from BusinessListBase)<br>6. User presses OK/Cancel and we do EndEdit()/CancelEdit() on the Meeting.<br><br>This doesn't work, can anyone give some guidance in what to do. I've read the other posts on N-Level undo and unfortunately I'm stilling not having that "AhhHa moment".<br><br>Thanks<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 27, 2007</h2><P>You should look at the ProjectTracker sample - specifically ProjectEdit or ResourceEdit in PTWin.</P>
<P>You <EM>must not</EM> call BeginEdit, CancelEdit or ApplyEdit on the object <EM>ever</EM>.</P>
<P>Instead you must call the methods on the bindingsource - and even then you <EM>never</EM> call BeginEdit yourself, as it is automatic.</P>
<P>&nbsp;</P>
<P>The alternative is to turn off IEditableObject processing. That is a new 3.0 property you can set on each business object (probably in the constructor, though you could also do it before binding the object to your UI. If you set that property then the rules are reversed: you <EM>must</EM> call BeginEdit, CancelEdit and ApplyEdit yourself.</P>
<P>The drawback to this manual approach, however, is that you lose in-place editing capabilities in grid controls, because you can't get into the process deep enough to call the edit methods at the right points (at least not in my experience).</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
