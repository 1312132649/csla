<html><header><title>Totals and collections</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Totals and collections</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1605.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 posted on Thursday, October 26, 2006</h2><P>Hi,</P>
<P>I have Pay object with a collection of line items which in turn has line items contained within. Now my question is this (in VB.NET with the 2.03 CSLA) how do I get the totals recalculated when a line item's property changes.</P>
<P>ie. If the hours change etc.</P>
<P>and please feel free to be precise because I have looked a few examples and the theory makes sense but I don't know how to implement it</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo replied on Thursday, October 26, 2006</h2>I would imagine you'd want to raise an event when the cost of the line item changes, I'm rusty on my VB so I won't demonstrate the code but basically (and this all in MSDN) your going to want a delegate for the event and the event itself and then just fire it from your child object and your parent object should consume it (have a handler wired up for the event).&nbsp; <br><br>A simpler answer hower (and one that won't show how rusty my VB is) may be the fact that children objects have access to their parent object, so you could simply have a method call (internal or Friend in VB) called CalculateTotal in your parent object, so then in your child object when a total was changed you would call it like:<br><br>DirectCast(Parent, Pay).CalucalateTotal()<br><br>Not a glamourous solution and I think the event model is a better solution, but this has the KISS principal covered and if your not familiar with creating delegates and events it might be a better solution for you, but then I'm also not sure if this how Parent was intended to be used...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Friday, October 27, 2006</h2><P>If all of your objects are CSLA-type BO's, then the child objects (line items) should already expose a PropertyChanged type event that can be handled by the parent collection - and should already be in order to implement IsDirty.&nbsp; Simply add the call to recalculate your total to the existing event handler.</P>
<P>Or, to save yourself from having to iterate over all of the child items each time in order to recalculate, create a new event, something like AmountChanged with the previous amount and new amount as eventarg parameters.&nbsp; Then add a handler to each child object as it is added to the collection.&nbsp; In the event handler, simply calculate the adjustment you need to make to the total by finding the difference in the child item's amount: _total = _total - (e.OldAmount - e.NewAmount).</P>
<P>You can clean it up and make the symantics a bit more appealing but those are two of the easiest ways to go and maintain a more decoupled relationship between the child objects and their parents.</P>
<P>Going with the previous suggestion where you call a method in the parent object from the child directly couples the child objects to their parent meaning that you can only use the LineItem (child object) within your Pay object.&nbsp; If you wanted to reuse the object elsewhere, you'd have problems.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Friday, October 27, 2006</h2><P>Conceptuually yes, practically no.</P>
<P>I don't know what the code would be, could you please give me an example ie. Which event handler ?</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Saturday, October 28, 2006</h2>Still needing help desperately&nbsp;thanks</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pelinville replied on Saturday, October 28, 2006</h2><DIV><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Wal972:</strong></div><div>Still needing help desperately&nbsp;thanks</div></BLOCKQUOTE></DIV>
<DIV>&nbsp;</DIV>
<DIV>Anther thing you could do is create another class who totals the lineItems.&nbsp; This gives you alot a flexability and you don't have to worry about capturing events and what not.</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Saturday, October 28, 2006</h2><P>Thanks for the ideas, howver i repeat i don't know what code to write. I have a lineitem collection which has the required calculating code, but i don't know how to activate it when a particular line item changes. CAN SOMEONE PLEASE PROVIDE A SAMPLE CODE OF WHAT IS REQUIRED </P>
<P>UEGENT</P>
<P>THANKS</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Saturday, October 28, 2006</h2>I define a new event so that we don't run the totalling code on every property change. Otherwise skip step 1 and in your collection trap PropertyHasChanged() event.<br><br><br>1. Define an event in your child property (event is safe for serializing)<br><br>#Region " Price Changed event "<br><br>&nbsp;&nbsp;&nbsp; &lt;NonSerialized()&gt; _<br>&nbsp;&nbsp;&nbsp; Private mNonSerializableHandlers As EventHandler(Of System.ComponentModel.PropertyChangedEventArgs)<br>&nbsp;&nbsp;&nbsp; Private mSerializableHandlers As EventHandler(Of System.ComponentModel.PropertyChangedEventArgs)<br><br>&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' Implements a serialization-safe RemovingItem event.<br>&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp; Public Custom Event PriceChanged As EventHandler(Of System.ComponentModel.PropertyChangedEventArgs)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler(ByVal value As EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Method.IsPublic AndAlso (value.Method.DeclaringType.IsSerializable OrElse value.Method.IsStatic) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializableHandlers = CType(System.Delegate.Combine(mSerializableHandlers, value), EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializableHandlers = CType(System.Delegate.Combine(mNonSerializableHandlers, value), EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End AddHandler<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveHandler(ByVal value As EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Method.IsPublic AndAlso (value.Method.DeclaringType.IsSerializable OrElse value.Method.IsStatic) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializableHandlers = CType(System.Delegate.Remove(mSerializableHandlers, value), EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializableHandlers = CType(System.Delegate.Remove(mNonSerializableHandlers, value), EventHandler(Of System.ComponentModel.PropertyChangedEventArgs))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RemoveHandler<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent(ByVal sender As System.Object, ByVal e As System.ComponentModel.PropertyChangedEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mNonSerializableHandlers IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializableHandlers.Invoke(sender, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mSerializableHandlers IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializableHandlers.Invoke(sender, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RaiseEvent<br>&nbsp;&nbsp;&nbsp; End Event<br><br><br>#End Region<br><br><br><br>2. call the event In your child property that changes the totals<br><br><br>&nbsp;&nbsp;&nbsp; Public Property Amount() As Decimal Implements iInvoiceDetail.Amount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mTotal<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal Value As Decimal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mTotal &lt;&gt; Value Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mTotal = Value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged("Amount")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent PriceChanged(Me, New System.ComponentModel.PropertyChangedEventArgs("Amount"))<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br>&nbsp;&nbsp;&nbsp; End Property<br><br>3.In your collection :<br><br>' add a handler to each item<br>&nbsp;Protected Overrides Sub OnListChanged(ByVal e As System.ComponentModel.ListChangedEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.ListChangedType = ListChangedType.ItemAdded Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler Item(e.NewIndex).PriceChanged, AddressOf OnPriceChanged<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf e.ListChangedType = ListChangedType.ItemDeleted Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPriceChanged(Me, New System.ComponentModel.PropertyChangedEventArgs("OrderDetails-ListChanged"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.OnListChanged(e)<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>' Define OnPRicechanged<br><br>Protected Sub OnPriceChanged(ByVal sender As Object, ByVal e As System.ComponentModel.PropertyChangedEventArgs)<br><br>' do your totalling here<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>Let me know if something isn't working - I can clarify.<br><br>Dean<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Saturday, October 28, 2006</h2><P>Thanks Dean</P>
<P>Ok I can implement step 1 and 2 but three is confusing me.</P>
<P>I'm using an interface for&nbsp;my line items in the collection&nbsp;its affecting the code help</P>
<P>Thanks</P>
<P>Ellie</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Saturday, October 28, 2006</h2>in your line item interface declare<br><br>Event PropertyChanged(ByVal sender As Object, ByVal e As System.ComponentModel.PropertyChangedEventArgs)<br><br>and implement in each line item class. Does that do it?<br><br>Dean<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Saturday, October 28, 2006</h2><P>Sorry for being so ignorant, but against what do I implement in each line item class </P>
<P>secondly if I need just the quick version for another problem, how do I trap the Propertyhaschanged event in the Collection</P>
<P>Thanks Heaps Dean</P>
<P>Ellie</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Saturday, October 28, 2006</h2>1.&nbsp; in each line item class declare declare the code in step 1 from my earlier post but add the implements iLineITem.PriceHasChanged after public custom event PriceChanged... Haven't tried this actually but hopefully it will work - I can test tomorrow.<br><br>2. You still need the code from step 3 to add the handler to each line item just change PriceChanged to PropertyChanged.<br><br>Dean<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Sunday, October 29, 2006</h2><P>The delegate types are different ?</P>
<P>I'm after the changes to an existing line as well new ones will the approach capture that as well</P>
<P>What is the quick way too, because I don't know&nbsp;that either</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Sunday, October 29, 2006</h2>Sorry - It was a little late last night when I made that last reply.<br><br>To use the current PropertyHasChanged event to do the totalling you need to add a handler to each item in the collection. Since this event is already in the line item class you won't need to add any code to the line item class.<br><br>' add a handler to each item<br>&nbsp;Protected Overrides Sub OnListChanged(ByVal e As System.ComponentModel.ListChangedEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.ListChangedType = ListChangedType.ItemAdded Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler Item(e.NewIndex).PropertyHasChanged, AddressOf OnPriceChanged<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf e.ListChangedType = ListChangedType.ItemDeleted Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPriceChanged(Me, New System.ComponentModel.PropertyChangedEventArgs("OrderDetails-ListChanged"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.OnListChanged(e)<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>And add the OnPriceChanged sub to the collection do the totalling:<br>' Define OnPRicechanged<br><br>Protected Sub OnPriceChanged(ByVal sender As Object, ByVal e As System.ComponentModel.PropertyChangedEventArgs)<br><br>' do your totalling here<br><br>&nbsp;end sub<br><br>That should do it for using the existing event. When I get a chance I will work on the custom event with items implementing an interface.<br><br>Dean<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Sunday, October 29, 2006</h2><P>Much appreciated</P>
<P>But it doesn't work when there's the interface inbetween, can you please suggest something and also&nbsp;how I get the root object to listen to the collection listening to the propertychanged</P>
<P>Thanks Dean</P>
<P>Ellie</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Monday, October 30, 2006</h2>Still needing help badly</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 30, 2006</h2>Can you not just listen to the ListChanged event on the list?&nbsp; The ListChangedEventArgs contains a property for which property of the item changed.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Monday, October 30, 2006</h2><P>True but how&nbsp;and from where, this is new to me, so I need&nbsp;code examples. Also&nbsp;the inteface I have on the children of the collection is acting as inteferance.&nbsp; I can it work some of the time, like add and delete but not when a change has occured</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 30, 2006</h2>Your list inherits from BusinessListBase so it will have a ListChanged event.&nbsp; In your parent object, add an event handler to _myList.ListChanged.&nbsp; The ListChangedEventArg ("e" by default) will have a property called ListChangedType.&nbsp; When the ListChangedType is ItemChanged, the PropertyDescriptor property will tell you which property on that item changed.&nbsp; If the property is the amount property, recalculate the total.&nbsp; There are hundreds of examples of handling the ListChanged property on the internet.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Monday, October 30, 2006</h2><P>OK with the collection to child problem I can't get a lock on the PropertyChanged event because of the interface i am using to define the collection items. The interface doesn't have the propertychanged event and when I try to get around this it doesn't work. How do I access a child's propertychanged via an interface.</P>
<P>If I add the handler in the list its looking for the same signature as it. I can match that in the interface, but I can't link the interface back to the child propertychanged which is a sub not an event </P>
<P>Help</P>
<P>Also do&nbsp;I need to add a itemchanged as well as add and deleted. Because it does activate on the change only the add and delete.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 30, 2006</h2>Have your interface inherit System.ComponentModel.INotifyPropertyChanged.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Monday, October 30, 2006</h2>Thanks Brian I will try this tonight.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Tuesday, October 31, 2006</h2><P>Firstly the interface code resolved one problem but</P>
<P>I have added the following code&nbsp;yet&nbsp;the Calculating Code is not being called WHY ? and&nbsp;I need to move this to the Pay parent as well&nbsp;because it need properties from it. Specific code required for&nbsp;the parent object. &nbsp;HELP :) Thanks</P>
<P><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> OnListChanged(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.ComponentModel.ListChangedEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> e.ListChangedType = ComponentModel.ListChangedType.ItemAdded </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>AddHandler</FONT><FONT size=2> Item(e.NewIndex).PropertyChanged, </FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> OnPayChanged</FONT></P><FONT size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>ElseIf</FONT><FONT size=2> e.ListChangedType = ComponentModel.ListChangedType.ItemChanged </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>AddHandler</FONT><FONT size=2> Item(e.NewIndex).PropertyChanged, </FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> OnPayChanged</P></FONT>
<P></FONT><FONT color=#0000ff size=2>ElseIf</FONT><FONT size=2> e.ListChangedType = ComponentModel.ListChangedType.ItemDeleted </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>OnPayChanged(</FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> System.ComponentModel.PropertyChangedEventArgs(</FONT><FONT color=#800000 size=2>"PayDetails-ListChanged"</FONT><FONT size=2>))</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.OnListChanged(e)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> OnPayChanged(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.ComponentModel.PropertyChangedEventArgs)</FONT></P>
<P><FONT size=2>Calculating code</FONT></P>
<P><FONT size=2><FONT color=#0000ff>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></FONT></P><FONT size=2><FONT color=#000000 size=3>
<P>Not sure if this is correct please advise</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Tuesday, October 31, 2006</h2>Still need help, please be patient</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wal972 replied on Wednesday, November 01, 2006</h2><P>THANKS HEAPS EVERYONE</P>
<P>Its working</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>demwa replied on Wednesday, October 01, 2008</h2>I have a similar problem,How did you solve yours.I have a parent BO called cheque Requisition which contains the child collection object called chequerequisitionlineitems which in turn contains chequerequisitionlineitem BO.The parent BO has the TotalAmount property which totals the sum of the Amount property of the child BO's.Now when I change the Amount property of the Child BO the Parent BO TotalAmount is not being updated to reflect the changes.Anyone who can help?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Wednesday, October 01, 2008</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>The way I solved this in the past is as follows.<o:p></o:p></span></p>

<p class=MsoNormal><span>Req object has readonly property Total (sum of child objects in
child list amount property).&nbsp; In the getter of it I would run through collection
and compute the sum.&nbsp; I would also have friend (internal) method RefreshTotal
that would only raise PropertyChange event for Total property.<o:p></o:p></span></p>

<p class=MsoNormal><span>I would carry parent property in child list and from each child&#8217;s
setter of the amount call this.Parent.Parent.RefreshTotal().&nbsp; This way you
do not need to rely on events and you have explicit call to refresh the
total.&nbsp; Also, if total is not bound to the UI, you will also avoid the
overhead of actually computing it.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Principal Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><img width=119 height=26 id="Picture_x0020_1" alt="cid:_2_0648EA840648E85C001BBCB886257279"><br>
</span><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> demwa
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Wednesday, October 01, 2008 12:15 PM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] Totals and collections<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>I have a similar problem,How did you solve yours.I have a
parent BO called cheque Requisition which contains the child collection object
called chequerequisitionlineitems which in turn contains
chequerequisitionlineitem BO.The parent BO has the TotalAmount property which
totals the sum of the Amount property of the child BO's.Now when I change the
Amount property of the Child BO the Parent BO TotalAmount is not being updated
to reflect the changes.Anyone who can help?<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>demwa replied on Thursday, October 02, 2008</h2><P>Sorry for being so ignorant,plse show me the sample code for refreshTotal.</P>
<P>&nbsp;</P>
<P>Many thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Thursday, October 02, 2008</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>RefreshTotal is very simple &#8211; one line of code<o:p></o:p></span></p>

<p class=MsoNormal><span>OnPropertyChanged(<span>&quot;Total&quot;</span>)</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Principal Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><img width=119 height=26 id="Picture_x0020_1" alt="cid:_2_0648EA840648E85C001BBCB886257279"><br>
</span><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> demwa
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Thursday, October 02, 2008 8:07 AM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] RE: Totals and collections<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Sorry for being so ignorant,plse show me the sample code for refreshTotal.<o:p></o:p></p>

<p>&nbsp;<o:p></o:p></p>

<p>Many thanks<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>demwa replied on Sunday, October 05, 2008</h2><P>Thanks for the help,but I seem to be missing something</P>
<P>Here is the code snipnet in the Cheque Requisition object</P><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Amount() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> Format(mChequeRequisitionLineItems.Amount, </FONT><FONT color=#800000 size=2>"#,##0.00"</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Friend</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> RefreshTotal()</P>
<P>OnPropertyChanged(</FONT><FONT color=#800000 size=2>"Amount"</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>in the Collection I have the following code</P><FONT color=#0000ff size=2>
<P>Friend</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Amount() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Decimal</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P>mAmount = 0</P>
<P></FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> child </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ChequeRequisitionLineItem </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</P></FONT><FONT size=2>
<P>mAmount += child.Amount</P>
<P></FONT><FONT color=#0000ff size=2>Next</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mAmount</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT>
<P>In the child object I have the following code</P><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Amount() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Decimal</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P>CanReadProperty(</FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mAmount</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Decimal</FONT><FONT size=2>)</P>
<P>CanWriteProperty(</FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mAmount &lt;&gt; value </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>mAmount = value</P>
<P>PropertyHasChanged(</FONT><FONT color=#800000 size=2>"Amount"</FONT><FONT size=2>)</P>
<P>&nbsp;</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT>
<P>My problem is I don't to access the me.Parent.Parent.RefreshTotal in the child object.Where I have I gone wrong?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Sunday, October 05, 2008</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>You should have access Parent (child list) in child
object.&nbsp; In child list you will need to add read only property for parent because
Parent property in BB and BLB is protected thus not accessible outside of the
object.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>So your list will have<o:p></o:p></span></p>

<p class=MsoNormal><span>Friend ReadonlYproperty MyParent as Root<o:p></o:p></span></p>

<p class=MsoNormal><span>Return Ctype(My.Parent, Root)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Then in child&#8217;s Set Amount you will have<o:p></o:p></span></p>

<p class=MsoNormal><span>Ctype(Me.Parent, ChildList).MyParent.RefreshTotal()<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Principal Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><img width=119 height=26 id="Picture_x0020_1" alt="cid:_2_0648EA840648E85C001BBCB886257279"><br>
</span><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> demwa
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Sunday, October 05, 2008 5:28 AM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] RE: Totals and collections<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Thanks for the help,but I seem to be missing something<o:p></o:p></p>

<p>Here is the code snipnet in the Cheque Requisition object<o:p></o:p></p>

<p><span>Public</span><span> <span>ReadOnly</span> <span>Property</span> Amount() <span>As</span> <span>String<o:p></o:p></span></span></p>

<p><span>Get<o:p></o:p></span></p>

<p><span>Return</span><span> Format(mChequeRequisitionLineItems.Amount, <span>&quot;#,##0.00&quot;</span>)<o:p></o:p></span></p>

<p><span>End</span><span> <span>Get<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Property<o:p></o:p></span></span></p>

<p><span>Friend</span><span> <span>Sub</span> RefreshTotal()<o:p></o:p></span></p>

<p><span>OnPropertyChanged(<span>&quot;Amount&quot;</span>)<o:p></o:p></span></p>

<p><span>End</span><span> <span>Sub<o:p></o:p></span></span></p>

<p>in the Collection I have the following code<o:p></o:p></p>

<p><span>Friend</span><span> <span>ReadOnly</span> <span>Property</span> Amount() <span>As</span> <span>Decimal<o:p></o:p></span></span></p>

<p><span>Get<o:p></o:p></span></p>

<p><span>mAmount = 0<o:p></o:p></span></p>

<p><span>For</span><span> <span>Each</span> child <span>As</span>
ChequeRequisitionLineItem <span>In</span> <span>Me<o:p></o:p></span></span></p>

<p><span>mAmount += child.Amount<o:p></o:p></span></p>

<p><span>Next<o:p></o:p></span></p>

<p><span>Return</span><span> mAmount<o:p></o:p></span></p>

<p><span>End</span><span> <span>Get<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Property<o:p></o:p></span></span></p>

<p>In the child object I have the following code<o:p></o:p></p>

<p><span>Public</span><span> <span>Property</span> Amount() <span>As</span> <span>Decimal<o:p></o:p></span></span></p>

<p><span>Get<o:p></o:p></span></p>

<p><span>CanReadProperty(<span>True</span>)<o:p></o:p></span></p>

<p><span>Return</span><span> mAmount<o:p></o:p></span></p>

<p><span>End</span><span> <span>Get<o:p></o:p></span></span></p>

<p><span>Set</span><span>(<span>ByVal</span> value <span>As</span>
<span>Decimal</span>)<o:p></o:p></span></p>

<p><span>CanWriteProperty(<span>True</span>)<o:p></o:p></span></p>

<p><span>If</span><span> mAmount &lt;&gt; value <span>Then<o:p></o:p></span></span></p>

<p><span>mAmount = value<o:p></o:p></span></p>

<p><span>PropertyHasChanged(<span>&quot;Amount&quot;</span>)<o:p></o:p></span></p>

<p><span>&nbsp;<o:p></o:p></span></p>

<p><span>End</span><span> <span>If<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Set<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Property<o:p></o:p></span></span></p>

<p>My problem is I don't to access the me.Parent.Parent.RefreshTotal in the
child object.Where I have I gone wrong?<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mwaped replied on Tuesday, October 07, 2008</h2><P>Thanks for being patient with me.I still seem to have the problem when I write the code you proposed&nbsp;&nbsp;&nbsp;in the BLB </P>
<P>Public readonly property MyParent()as ChequeRequisition</P>
<P>&nbsp;&nbsp;&nbsp;get</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cytpe(my.Parent,ChequeRequisition)</P>
<P>&nbsp;&nbsp;&nbsp;End get</P>
<P>End property</P>
<P>But I am getting a syntax error because the my object does not have the parent propperty/method I have also tried the me.Parent it also does not work.Where am I going wrong.</P>
<P>&nbsp;</P>
<P>Many thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mwaped replied on Sunday, October 12, 2008</h2><P>Sergey,</P>
<P>I still need your help</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Sunday, October 12, 2008</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Could you post your classes (or at least parts that are pertinent
to the solution) if sample below is not clear?&nbsp; I am not a big fan though
of custom events in CSLA.&nbsp; I would personally prefer direct (explicit)
interaction between objects in a graph rather than events based (implicit)
interaction.&nbsp; It does introduce tight coupling between objects in a graph,
but technically should not re-use objects in multiple graphs bases on single responsibility
principal.&nbsp; I will let you make a decision which route you would like to
go, because I am in a minority I think with my approach on this forum.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Here is how I implement my approach in 2.0 (because lists do not
have parent property in 2.0, like in 3.6/3.5)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public Class Pay<o:p></o:p></span></p>

<p class=MsoNormal><span>Friend Sub UpdateTotal<o:p></o:p></span></p>

<p class=MsoNormal><span>OnPropertyChanged(&#8220;Total&#8221;)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>When new and Fetch<o:p></o:p></span></p>

<p class=MsoNormal><span>_payItemsList.Parent = Me<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Protected Overrides OnDesiralized<o:p></o:p></span></p>

<p class=MsoNormal><span>MyBase. OnDesiralized<o:p></o:p></span></p>

<p class=MsoNormal><span>_payItemsList.Parent = Me<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public class PayItem<o:p></o:p></span></p>

<p class=MsoNormal><span>Pretty much the same code as pay to maintain a parent for
PayLineItemsList<o:p></o:p></span></p>

<p class=MsoNormal><span>Friend Sub UpdateTotal<o:p></o:p></span></p>

<p class=MsoNormal><span>OnPropertyChanged(&#8220;Total&#8221;)<o:p></o:p></span></p>

<p class=MsoNormal><span>Ctype(Me.Parent, PayItemList).Parent.UpdateTotal()<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public class PayItemList<o:p></o:p></span></p>

<p class=MsoNormal><span>Friend Property Parent as Pay<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public Class PayIteLineItem<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public Property Total<o:p></o:p></span></p>

<p class=MsoNormal><span>Ctype(Me.parent, PayIteLineItemList).Parent.UpdateTotal()<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Public Class PayIteLineItemList<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Principal Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><img width=119 height=26 id="Picture_x0020_1" alt="cid:_2_0648EA840648E85C001BBCB886257279"><br>
</span><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> mwaped
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Sunday, October 12, 2008 7:38 AM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: Totals and collections<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Sergey,<o:p></o:p></p>

<p>I still need your help<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Monday, October 30, 2006</h2>Define doesn't work - compile error or is the sub doing the totalling not getting called?<br><br>Does the OnListChanged event get called when you add an item to your collection?<br><br>When/if it is called do you see the handler getting added to that item? <br><br>Dean<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Thursday, November 02, 2006</h2><font face="Arial" size="2"><font face="Tahoma">Sharing my solution.. don't know if this is efficient enough...<br><br>Ok.. i dont know if I can help you.. but i'll try...<br>In your child object the line items.. <br><br>' Declare the event to be fired into the parent object of line items<br>Friend Event TotalsChanged(ByVal totQty As Integer, ByVal totAmnt As Single)<br><br><br>'actual calcuation of goes here<br>Protected Overrides Sub OnListChanged(ByVal e As System.ComponentModel.ListChangedEventArgs)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.PropertyDescriptor IsNot Nothing AndAlso _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (e.PropertyDescriptor.Name = "Qty" OrElse e.PropertyDescriptor.Name = "Price") Then<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim qty As Integer = 0, amnt As Single = 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For i As Integer = 0 To Me.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; qty += Me.Item(i).Qty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amnt += (Me.Item(i).Qty * Me.Item(i).Price)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next i<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent TotalsChanged(qty, amnt)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.OnListChanged(e)<br>&nbsp; End Sub<br><br><br>In your parent object where the line items is the child.. declare withEvents for the line items<br><br>&nbsp;&nbsp; Private WithEvents _items As LineItems = Nothing<br><br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property Items() As DeliveryItems<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If _items Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Me.IsNew Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _items = LineItems.NewLineItems()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _items = InvoiceItems.GetInvoiceItems(Me._invno)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _items<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property<br><br>Assigned the total amount and total qty property variables to the events TotalsChanged<br><br>Private Sub _items_TotalsChanged(ByVal TotQty As Integer, ByVal TotAmnt As Single) Handles _items.TotalsChanged<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me._totAmnt = TotAmnt<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged("TotAmnt")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me._totQty = TotQty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged("TotQty")<br>&nbsp;&nbsp;&nbsp; End Sub<br><br><br><br></font></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
