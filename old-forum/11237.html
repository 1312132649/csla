<html><header><title>Implementing business (validation) rules by calling a rules object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Implementing business (validation) rules by calling a rules object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11237.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit posted on Sunday, March 18, 2012</h2><p>Hi Guys,</p>
<p>I am progressing quite well with the 4.2.2 developing a new Windows forms application and I need to pick some brains out there.</p>
<p>I have a need to implement some field validation based on RegularExpression values. The siomplest way for mwe to do this, is to store them in the database and retrieve them as needed.</p>
<p>In my old CSLA2 application, I did this type of thing, within my BO code:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim ruleList As RulesList = Nothing</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not mCUSTOMERNO Is Nothing Then</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ruleList = RulesList.GetRulesList(&quot;CONTACT&quot;, mCUSTOMERNO)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each rule As RulesInfo In ruleList</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select Case rule.TYPE<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Case Is = &quot;StringRequired&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rule.VALUE = &quot;Y&quot; Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf Validation.CommonRules.StringRequired, rule.PROPERTYNAME)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Case Is = &quot;RegExMatch&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf Validation.CommonRules.RegExMatch, New CommonRules.RegExRuleArgs(rule.PROPERTYNAME, rule.VALUE))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Case Is = &quot;Phone&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf Validation.CommonRules.RegExMatch, New CommonRules.RegExRuleArgs(rule.PROPERTYNAME, rule.VALUE))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Case Is = &quot;Email&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf EmailIsValid, rule.PROPERTYNAME)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Select</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</p>
<p>&nbsp;&nbsp;&nbsp; End Sub</p>
<p>Which worked - and quite nicely. I was able to apply custom validation, based on passed values.</p>
<p>My question is, is this a recommended approach? Do I lose anything by iomplementing this way - and will it ultimately port to another development platform if I go in that direction? (E.g. Silverlight, WP7).</p>
<p>I have yet&nbsp;to implement this in my CSLA4.2.2 objects, but want to be sure I&#39;m not creating many problems for myself before I do so.</p>
<p>I await any advice or suggestions you may have.</p>
<p>Thanks,</p>
<p>Graham</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Sunday, March 18, 2012</h2><p>No more instance rules in CSLA&nbsp; - only type rules.&nbsp; </p>
<p>Which means that you may register on ore more rules for each property and process these by either &quot;metainfo in the object&quot; or a &quot;rule meta cache&quot; to execute the rule or call inner rules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Sunday, March 18, 2012</h2><p>I realize the rules implementation has changed - hence saying I did this type of thing in CSLA2.</p>
<p>My focus is on whether it is reasonable to invoke data access via another business object during the creation of the business object.</p>
<p>I am not familiar with &quot;metainfo in the object&quot; or &quot;rule meta cache&quot;. I would just like to be able to retrieve the list of rule objects from the datasource at BO create time.</p>
<p>Thanks,</p>
<p>Graham</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, March 18, 2012</h2><p>&nbsp;<div style='padding-left: 50px;background-color:silver'><b>gajit<br></b>I would just like to be able to retrieve the list of rule objects from the datasource at BO create time.</div></p>
<p>That must be done as &quot;metadata&quot; - properties/values in the business object. Rules is only registered once - on each type/computer. <br />Take f.ex a Silverlight object with a .NET ApplicationServer. Rule instances will exist on both computers - and must be registered when the first instance is created locally.&nbsp; </p>
<p>How the rules behave must be controlled by &quot;metadata&quot; in the BO to make the rules perform the correct rule handling. &quot;metadata&quot; will typically be internal/private properties in the BO to instruct the rules on how to validate fields.</p>
<p>IE: Add the rules for all validation fields in AddBusinessRules. <br />Load &quot;metadata&quot; into business object for rules to check how to validate fields. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>gajit replied on Sunday, March 18, 2012</h2><p>Do you have an example?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, March 20, 2012</h2><p>Hi Graham,</p>
<p>Sorry, I do not have an example for that ready.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Tuesday, March 20, 2012</h2><p>OK.</p>
<p>I find it much more efficient to store validation rules in the database, so that&#39;s why I&#39;ve done this in the past.</p>
<p>If you consider a new contact record for a customer, I need to, based on a number of qualifying fields, how that data is validated for data-entry. E.g. If my customer is north american, my phone format is likely (999) 999-9999. If however, he is a UK customer, the format might be different. Similarly Postal/Zip code formats would be different.</p>
<p>I can&#39;t for the life of me think how I can&nbsp;implement this&nbsp;without having to create a &quot;ValidateThisField&quot; command on each property. Which, would involve repetitive and expensive calls to the database. </p>
<p>I think you&#39;ve answered my question here Jonny. But I&#39;m probably going to post another question in the forums to see if anyone else has found a workable solution to this, that allows a single database call to load validation rules.</p>
<p>Thanks,</p>
<p>Graham</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, March 20, 2012</h2><p>Well, that would imply that your rule for validation of PhoneNumber would know that it should rerun the rule(s) when Country is changed. (Dependency or InputProperty). </p>
<p><b>You can do a database call in AddBusinessRules</b> (and this has indeed been discussed on the forum) <b>to load the type rules</b>. Just be aware that ALL rules for the type must be loaded in that method. And if there is an Exception the builtin Exception handler in the base class will clear the TypeRules and try to reload the rules the next time an instance is created to avoid an incomplete set of rules being stuck for the type.</p>
<p>&nbsp;</p>
<p><img style="position:absolute;visibility:visible;color:transparent;margin:0px;border:medium none;z-index:2147483647;left:180px;top:16px;" alt="" /></p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
