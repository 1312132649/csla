<html><header><title>Linq to SQL performance</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Linq to SQL performance</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5713.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones posted on Friday, October 31, 2008</h2><P>While upgrading to csla 3.5.1&nbsp;I've run into the following problem.</P>
<P>The original code, Method 1 below, takes less than 1 second to load 249 records, and the new code, Method 2 below, takes approximately 8 seconds to load the same 249 records using the same stored procedure.<BR>Anyone have any suggestions as to why the Linq to SQL approach would perform so much slower.<BR><FONT color=#0000ff size=2><STRONG><U>Method 1: CSLA 3.0</U><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (dr.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Add(MyObject&lt;C&gt;.GetMyObject(dr));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><BR><FONT color=#0000ff size=2><STRONG><U>Method 2: CSLA 3.5 Using Linq to SQL<BR></U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.AddRange(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from row in mgr.DataContext.spGetMyObject(criteria.Value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select MyObject.GetMyObject(row)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</STRONG></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 31, 2008</h2>Linq is built on top of Ado.Net; it's not going to perform better, it will always add some overhead.&nbsp; That said, it could be how you're building your linq statement.<br><br>What is the .Net type of row?&nbsp; There's probably something going on there..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones replied on Friday, October 31, 2008</h2><P>row is the result of <STRONG><FONT color=#0000ff size=2>mgr.DataContext.spGetMyObject(criteria.Value)</FONT></STRONG>, which is a stored procedure call from the database.</P>
<P><STRONG><FONT color=#0000ff size=2>spGetMyObject</FONT></STRONG>&nbsp;was&nbsp;auto generated&nbsp;via the designer as&nbsp;follows:</P>
<P><FONT color=#0000ff size=2><STRONG>[Function(Name="dbo.spGetMyObject")]<BR>&nbsp;&nbsp;public ISingleResult&lt;spGetMyObjectResult&gt; spGetMyObject([Parameter(Name="ID", DbType="BigInt")] System.Nullable&lt;long&gt; iD)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), iD);<BR>&nbsp;&nbsp;&nbsp;return ((ISingleResult&lt;spGetMyObjectResult&gt;)(result.ReturnValue));<BR>&nbsp;&nbsp;}</STRONG></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 31, 2008</h2>So, Linq might be constructing a type on the fly to deal with the result... that would likely take some resources.&nbsp; If you define an L2S class matching your table, and do the select from that, you might have better performance.<br><br>var rows =<br>&nbsp; &nbsp;&nbsp; &nbsp; from rowSet in mgr.DataContext.MyObject // MyObject is TableSet&lt;MyObject&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where rowSet.ID == criteria.Value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select rowSet;<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones replied on Friday, October 31, 2008</h2><P>After some research, it appears that the slow down is a result of the repeated calls to <FONT color=#0000ff size=2><STRONG>LoadProperty&lt; , &gt;</STRONG></FONT>&nbsp;in <STRONG><FONT color=#0000ff size=2>MyObject.GetMyObject(...)</FONT></STRONG> in the templates I'm using.<FONT size=3></P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
