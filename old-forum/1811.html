<html><header><title>Null Reference Exception in SortedBindingList</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Null Reference Exception in SortedBindingList</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1811.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds posted on Tuesday, November 21, 2006</h2><P>Hi</P>
<P>I'm using nullable types extensively in my BOs and when I use a SortedBindingList on a property that can be null, it blows up on the null value. I can fix it by changing the CompareTo method as follows (bolded lines are added code)</P>
<P>public int CompareTo(ListItem other)<BR>{<BR>object target = other.Key;</P>
<P>if (Key is IComparable)<BR>&nbsp; return ((IComparable)Key).CompareTo(target);</P>
<P>else<BR>{<BR><STRONG>&nbsp;&nbsp;&nbsp; if (Key == null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<BR></STRONG>&nbsp;&nbsp;&nbsp; <BR>&nbsp; if (Key.Equals(target))<BR>&nbsp;&nbsp;&nbsp; return 0;<BR>&nbsp; else<BR>&nbsp;&nbsp;&nbsp; return Key.ToString().CompareTo(target.ToString());<BR>}<BR>}</P>
<P>Thanks for an awesome framework!</P>
<P>Craig</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, November 21, 2006</h2>Thanks for letting me know, I've made the change in the code in cvs, so it will be in the next release.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>KGy replied on Tuesday, April 05, 2011</h2><p>ListItem.CompareTo still may throw exceptions when the original list contains null elements (in 3.8.4). Occurs when only other.Key is null (this.Key is not null).</p>
<p>Correction is bold:</p>
<p>public int CompareTo(ListItem other)<br />{<br />&nbsp;&nbsp;&nbsp; object target = other.Key;<br /><br />&nbsp;&nbsp;&nbsp; if (Key is IComparable)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ((IComparable)Key).CompareTo(target);<br /><br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Key == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (target == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (Key.Equals(target))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>else if (target == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;</b></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Key.ToString().CompareTo(target.ToString());<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, April 05, 2011</h2><p>Added to bug list, thanks.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
