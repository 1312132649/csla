<html><header><title>Csla 4 authorization rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csla 4 authorization rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9410.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Thursday, August 19, 2010</h2><p>Hi,</p>
<p>So the standard IsInRole stuff seems pretty obvious.&nbsp; But is it possible to have two authorization rules, and both must pass?&nbsp; I&#39;d like to combine an IsInRole test with a test of the Targets state (if the object is not in a certain state, most properties must become read-only.&nbsp; Otherwise, all properties can be changed.</p>
<p>It looks like though when getting the auth rules, a FirstOrDefault rules out this scenario.</p>
<p>Would the correct path be to create a rule which does both checks in one Execute?</p>
<p>Thanks</p>
<p>Andy</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Friday, August 20, 2010</h2><p>Hi Andy,</p>
<p>Sure you can. Add as many separate rules as you want.. It works as you said: all rules must pass in order for the user to have authorization. The point is to &quot;modularize&quot;: each rule is a module and you combine modules differently according to your needs.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, August 20, 2010</h2><p>Well the reason I posted the question is because looking at the code for CanWriteProperty, if fiters things to a list of rules which apply to writing the property, then does a FirstOrDefault.&nbsp; So that looks to me like while I can add as many as I want, only one will actually get run... unless I have a &quot;master rule&quot; or can use chaining.&nbsp; </p>
<p>So, either I&#39;m reading the code wrong, in which case I&#39;ll add multiples, or only one in fact will be run, in which case I&#39;d like to know what&#39;s considered &quot;best practice.&quot;</p>
<p>Thanks!</p>
<p>Andy</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, August 21, 2010</h2><p>There can be only one authz rule per element per action. So only one rule for property read, one for property write, etc.</p>
<p>I could have tried to allow multiple rules - but then there&#39;d be the whole question of whether they should be AND or OR or whatever. And this particular stuff is pretty performance sensitive, since the authz rules get run a lot.</p>
<p>So I kept things simple - one rule per.</p>
<p>That means if you want something more complex than IsInRole or IsNotInRole you need to write a rule. But writing a rule is just not hard - so I don&#39;t see that as much of a barrier either.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Sunday, August 22, 2010</h2><p>Hi Rocky,</p>
<p>In fact that&#39;s what I&#39;ve done in my tests: one rule per element per action. I agree the performance is paramount.</p>
<p>I was mxing it up with business rules where you can add several business rules to the same property. If the behaviour is so different, there is no point in using the same class. Or is it?</p>
<p>&nbsp;</p>
<p>As a side note, I confirmed my VS2010 (is completely nuts).</p>
<p>When I look at my <br /><strong>BusinessRules.AddRule();</strong><br />I find it hard to understand because the same apparent code points to 2 different places (it&#39;s also coloured differently).</p>
<p>When adding a business rule (those that inherit from BusinessRule), <strong>BusinessRules</strong> refers to a protected&nbsp;property of Csla.Core.BusinessBase (!!!)</p>
<p>When adding a business authorization rule (those that inherit from AuthorizationRule), <strong>BusinessRules</strong> refers to a class of Csla.Rules</p>
<p>in both cases AddRule is a method of Csla.Rules.BusinessRules.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, August 22, 2010</h2><p>It isn&#39;t that Visual Studio is nuts, it is that there are two ways to use Csla.Rules.BusinessRules.</p>
<p>BusinessBase does expose a protected property named BusinessRules that refers to an instance of BusinessRules, which is responsible for managing most of the business rules behaviors.</p>
<p>However, there are also some <i>static </i>methods on Csla.Core.BusinessRules itself that are used to associate per-type authorization rules with a type. This is what you are invoking within the AddObjectAuthorizationRules() method - it has to be this way because no instance of any object can be created to find out if the user is even authorized to create an instance of the object.</p>
<p>This is really no different from 3.x, which had the same concept with the Csla.Security.AuthorizationRules class.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
