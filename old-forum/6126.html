<html><header><title>Parent Class for Business Layer</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent Class for Business Layer</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6126.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bpb2221 posted on Monday, January 12, 2009</h2>I want to be able to call my Data Layer from my CSLA business layer.&nbsp; My data layer classes are passed business objects instead of values.&nbsp; I cannot create an instance of my business class inside of itself to pass to the data layer (maybe I just don't know how).&nbsp; <b>How can I create an instance of my business class and pass it to the data layer, without calling the data layer directly from the UI?&nbsp; </b>&nbsp; Someone suggested that I use a parent class for all of my business classes. Does anyone have any experience with this issue. <br><br>Here is how I am doing it now on the form<br><br><font size="2" face="Courier New">&nbsp;Private Sub btn_Save_Click _<br>&nbsp;&nbsp;&nbsp; (ByVal sender As System.Object, ByVal e As System.EventArgs) _<br>&nbsp;&nbsp;&nbsp; Handles btn_Save.Click<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try</font><br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'new instance of DAL</i><br><font size="2" face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim auditRecord As New DataLayer.AuditBusinessObject()<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Save or Update</i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(True, True)<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Add Audit Record</i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; auditRecord.AddHistoryRecord(mBusinessObject)<br><i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Set rules to form</i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '<i>Run some exception handling <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i>End Try<br>&nbsp;End Sub<br><br></font>The <font size="2" face="Courier New">auditRecord.AddHistoryRecord</font> is actually inside of the RebindUI. Obviously the record has to be updated before I add a history record. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 12, 2009</h2><P>As a general rule the UI should never interact directly with the DAL. Doing that will prevent you from ever using the data portal, which means you can't switch to an n-tier model.</P>
<P>In other words, you can call the DAL from the UI, but you'll block the use of one entire feature area of CSLA. If you are OK with losing those features, then have at it :)</P>
<P>But if you want to stick with the supported CSLA architectural model, you have two options (in version 3.6):</P>
<OL>
<LI>Call the DAL from your DataPortal_XYZ methods, keeping in mind that DataPortal_Fetch() is actually running <EM>inside an instance of your object</EM>, so you can always pass Me (this in C#) to your DAL as a parameter</LI>
<LI>Use the new ObjectFactory feature to have the data portal invoke an object factory object that is responsible for coordinating the interaction between the data portal, your DAL and your business objects</LI></OL>
<P>These options are discussed in Chapter 18 of the <EM>Expert 2008 Business Objects </EM>book.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, January 12, 2009</h2><P>The other thing I would caution you about is that it sounds like you are designing around your data and not behavior.&nbsp; I've seen the type of architecture you are describing before and it is typically some sort of entity model where AuditBusinessObject is simply a data transfer object (DTO) containing properties that match the underlying data source.&nbsp; While this is fine, AuditBusinessObject is not a CSLA business object in this case.</P>
<P>As Rocky says, with CSLA, your business objects purposely sit between your UI and DAL.&nbsp; You can still use the factory approach to instantiate your business objects but how they interact with the DAL is hidden internal to the business object (or externalized using an ObjectFactory as Rocky explains).</P>
<P>Definitely take some time with the book and ProjectTracker sample application.&nbsp; I think they will answer your questions.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
