<html><header><title>Preferred way of adding a child to a collection object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Preferred way of adding a child to a collection object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8649.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kyle posted on Thursday, March 11, 2010</h2><p>This is related to post <a href="http://forums.lhotka.net/forums/p/4056/19883.aspx#19883">http://forums.lhotka.net/forums/p/4056/19883.aspx#19883</a><br /><br />The book (Expert C# 2008 BOs, page 150) under Child Object Creation, says<br /><br />&quot;Child objects are usually created when the UI code calls an Add() method on the collection object<br />that contains the child object. Ideally, the child class and the collection class will be in the same<br />assembly, so the static factory methods on a child object can be scoped as internal, rather than<br />public. This way, the UI can&rsquo;t directly create the object, but the collection object can create the child<br />when the UI calls the collection&rsquo;s Add() method.<br />The CSLA .NET framework doesn&rsquo;t actually dictate this approach. Rather, it&rsquo;s a design choice on<br />my part because I feel that it makes the use of the business objects more intuitive from the UI developer&rsquo;s<br />perspective. It&rsquo;s quite possible to allow the UI code to create child objects directly by making the child<br />factory methods public; the collection&rsquo;s Add() method would then accept a prebuilt child object as<br />a parameter. I think that&rsquo;s less intuitive, but it&rsquo;s perfectly valid, and you can implement your objects<br />that way if you choose.&quot;<br /><br />(Note: in this discussion, I&#39;m not worried about databinding so I don&#39;t need to do anything with AddNewCore())<br /><br />So, it seems that the preferred way of creating a child object is to implement an AddSomething() method<br />on the child collection object. It seems that the place to put that method would be in the <br />Business Methods region. However, neither the VS templates nor the book (pages 190-191) show the collection templates as having a Business Methods region which seems to suggest that it isn&#39;t necessary or preferred.<br /><br />Obviously it&#39;s easy to add a new region and implement whatever I want but this seems to be a contradiction, especially for one just learning the framework and trying to figure out how do things the &#39;Rocky&#39; way as much as possible. <br /><br />So, if implementing an Add() method on the collection object is preferred, why is there no Business Methods region in the template? Or, if you should avoid putting Business Methods in collection objects, then what is the preferred way of adding a child to a collection? <br /><br />Or am I missing something?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, March 11, 2010</h2><p>I don&#39;t know if there&#39;s a &quot;preferred&quot; way.</p>
<p>I have <i>my preference</i>, but other people have their preferences.</p>
<p>If you look at .NET, you can see examples where the caller is expected to create the item and add it to the list:</p>
<p>var child = new Child();<br />myList.Add(child);</p>
<p>There&#39;s nothing wrong with that - though in a CSLA setting you&#39;d do this:</p>
<p>var child = Child.NewChild();<br />
myList.Add(child);</p>
<p>This works great if the newly created child doesn&#39;t need any contextual information from the parent in order to be created, and that&#39;s often the case.</p>
<p>Another variation on this theme, that works with Windows Forms datagrid controls, is auto-adding of items to a collection by overriding AddNewCore() and setting AllowNew=true in your collection. Then the caller (often data binding) just calls myList.AddNew() and a new item appears at the end of the list. Very smooth, especially when using in-place editing in a datagrid.</p>
<p>I use the AddNewCore() quite a lot - it is a nice technique.</p>
<p>Finally, you can do what I tend to do frequently, which is to create an Add() method in the list that creates the child, adds it to the list and returns a reference to the new child. I only really like this because it simplifies the UI code - the caller doesn&#39;t need to know about the child object&#39;s factory method, and in fact the child object doesn&#39;t need a public factory at all.</p>
<p>I just think it makes the overall API simpler and easier to consume.</p>
<p>But not everyone agrees, and that&#39;s fine - all three of these techniques are fine, and they aren&#39;t mutually exclusive.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kyle replied on Thursday, March 11, 2010</h2><p>Thanks Rocky for the quick response. I suspect the post will get hit a lot by people trying to figure this stuff out as it concisely provides three examples of ways to create child objects.<br /><br />When I say &#39;preferred&#39; in a CSLA context, I <b><i>do</i></b> mean Rocky&#39;s preference. Anybody who is willingly using CSLA has already accepted that Rocky&#39;s decisions are usually good decisions and so the newbie CSLA programmer will often accept his preferences on faith (even if he/she doesn&#39;t understand it completely) in order to avoid having to spend a bunch of time researching all the various ways of doing things. In my limited experience doing CSLA work in a team environment, pretty much any time there is a design decision to be made the first thing we ask ourselves is, &quot;What would Rocky do?&quot;. If we can figure out what Rocky would do we usually end up deciding that it is the right (or best) thing to do.<br /><br />Usually (pretty much always), my child objects have a foreign key that points back to the parent object in the database. The foreign key could be set by the UI but my preference is that the UI shouldn&#39;t have to know anything about foreign keys (and they certainly should not be writable) so it should get set automatically when the child is created. With this decision in mind, creating a rogue child and then adding it to the collection (using the default .Add(ChildObject item) method) doesn&#39;t seem very clean. I think the same holds true for using AddNewCore() although since you have to override it anyway, it wouldn&#39;t be too hard to add the foreign key property in there.<br /><br />I guess then, that I too prefer to create custom Add() method(s) in the collection object which will ensure that the foreign key (and any other parental context information) is automatically set when the child is created. The question is still open then...<br /><br />&quot;Why don&#39;t the collection templates have a Business Methods region?&quot;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, March 12, 2010</h2><p>For your specific problem, I would think the root object would have the key needed by the child objects.&nbsp; It would hold that value until a DataPortal_Insert or Update, and then pass it as one of the parameters to update the children.</p>
<p>The child doesn&#39;t need the key at all until that point, and it would just accept whatever its given.&nbsp; If the root is the collection though, you have to figure out where to store the key, but I think it would be unusual that a collection like that would be designed.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, March 12, 2010</h2><p>^^^^^</p>
<p>This seems very reasonable, except that the child&nbsp;object is switchable.&nbsp; It also opens the possibility that the root might write the child object out without the required data. It was interesting how many bugs I found in our legacy code by virtual of the translation when all the child objects started enforcing their own rules in the new software... :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonG replied on Monday, June 27, 2011</h2><p>Hello, I know this is an old topic, but could someone(Rocky) post an example of how&nbsp;to implement the&nbsp;ItemList.Add() method. </p>
<p>thanks,</p>
<p>Jason</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 27, 2011</h2><p>As I mentioned earlier in the thread, there are several ways to add a child item to a collection. I cover the three most commonly used techniques in the <em>Using CSLA 4: Creating Business Objects</em> ebook.</p>
<p>To answer your specific question - one technique does use the Add method that exists on all collections. No implementation in the collection is necessary, because the Microsoft base classes already implement an Add method. You just need to create a child object to add. I often use a unit of work command object for this purpose, so your code (assuming you have the uow object) looks like this:</p>
<p>
<p><span style="font-size:xx-small;">
<p>var child = EditableChildCreator.CreateChild(); <br />_list.Add(child); </p>
<font size="1">
<p>&nbsp;</p>
</font></span>
<p>The EditableChildCreator type is the uow command object that correctly creates and initializes the child, then you just use the pre-existing Add method on the collection.</p>
</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, March 12, 2010</h2><p>I use both methods, but since I do edit collections in grids and want the grids to be able properly add objects, I&#39;ve made sure that AddNewCore() cooperates and have implemented overrides where necessary. </p>
<p>The&nbsp;main situation that prompted this is that it is very often the case that child objects in a collection have foreign key references to the parent of the collection. The child objects are actually broken in my case unless these values are provided.</p>
<p>Another thing I have found to be the case is that some grids are *very* finicky about list changed events&nbsp;being fired while they are initially adding a brand new item to a list, so I&#39;m sure to do any property initialization before the item is actually added to the list. </p>
<p>So, I usually let the collection do the adding unless I have lots of my own initialization to do afterwards.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
