<html><header><title>Parent is null!</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent is null!</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/562.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram posted on Friday, July 07, 2006</h2><FONT color=#ff0000 size=2>
<P><FONT color=#000000>Hi!</FONT></P>
<P><FONT color=#000000>When I create a new child object I eant it to read a id property from parent object</FONT></P>
<P><FONT color=#000000>so I do like this</FONT></FONT><FONT size=2></P>
<P><FONT color=#000000>[</FONT></FONT><FONT color=#000000 size=2>RunLocal</FONT><FONT size=2><FONT color=#000000>]</FONT></P>
<P></FONT><FONT color=#000000><FONT size=2>protected</FONT><FONT size=2> </FONT><FONT size=2>override</FONT><FONT size=2> </FONT><FONT size=2>void</FONT><FONT size=2> DataPortal_Create(</FONT><FONT size=2>Object</FONT></FONT><FONT size=2><FONT color=#000000> criteria)</FONT></P>
<P><FONT color=#000000>{</FONT></P>
<P><FONT color=#000000>MarkAsChild();</FONT></P>
<P><FONT color=#000000></FONT></P>
<P></FONT><FONT size=2><FONT color=#000000>this.ClientID = ((Client)this.parent).ClientID;</FONT></P></FONT><FONT color=#000000 size=2>
<P>}</P></FONT><FONT size=2>
<P><FONT color=#000000>but the result is a exception because parent is null!</FONT></P>
<P>Any idea?</P>
<P>Regards</FONT><FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>odie replied on Friday, July 07, 2006</h2><P>The parent is not set until the child has been added to the collection, which means you can't obtain the parent reference when you first create the child. Secondly, if I am not mistaken the parent refers to the childs collection class not the parent it was created under.</P>
<P>eg.<BR>Client.Childs.Child - the parent to child would be Childs not Client</P>
<P>If you are requiring the ClientID from client it us usually passed as a reference when you persist the data.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram replied on Friday, July 07, 2006</h2><P>Thank you for your answer.</P>
<P>But I must ask about this:</P>
<P><FONT color=#ff0000>"parent refers to the childs collection class not the parent it was created under"</FONT></P>
<P><FONT color=#ff0000>"Client.Childs.Child - the parent to child would be Childs not Client"</FONT></P>
<P>I have a Root editable object called Client now this Client has a child editable list called ContactCollection which is a collection of child object Contact</P>
<P>now which one is correct:</P>
<P>1-Client is parent for boyh ContactCollection and Contact</P>
<P>2-Client is parent for ContactCollection and ContactCollection is parent to Contact</P>
<P>Because I am using the codesmith to generate CSLA code and when you create a clid collection or child object it aslks for type of parent and I always have given Client as parent for both Contact and contactcollection and the generated code has worked correct!</P>
<P>Regards</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, July 07, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>shahram:</strong></div><div>I have a Root editable object called Client now this Client has a child editable list called ContactCollection which is a collection of child object Contact
<p>now which one is correct:</p>
<p>1-Client is parent for boyh ContactCollection and Contact</p>
<p>2-Client is parent for ContactCollection and ContactCollection is parent to Contact</p>
<p>Because I am using the codesmith to generate CSLA code and when you create a clid collection or child object it aslks for type of parent and I always have given Client as parent for both Contact and contactcollection and the generated code has worked correct!</div></BLOCKQUOTE></p>I don't know what your CodeSmith templates are doing but if Contact is derived from BusinessBase then it will have a protected property called Parent. That is a reference to ContactCollection. You need to do something extra if you want a reference to Client. As I suggested in my previous post, I pass a reference to Client into ContactCollection, expose that Client as a property and then within Contact, I can get Client with something like.<br><p>Client client = ((ContactCollection) this.Parent).Client</p><p>Ross<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, July 07, 2006</h2>Hi shahram<br><br>I think the problem here is that in DataPortal_Create, the child has not yet been added to the collection so therefore its parent is null. If you need to do things that involves the parent, you need to do this after the child has been added to the collection.<br><br>I hit this problem when I have some validation rules that depend on knowing the parent. I solve it by having an AddNewItem() method on my collection something like this:<br><br>public MyChild AddNewChild()<br>{<br>&nbsp;&nbsp;&nbsp; MyChild newChild = MyChild.NewMyChild();<br>&nbsp;&nbsp;&nbsp; this.Add(newChild);<br><br>// the child now knows its parent so do stuff here<br>&nbsp;&nbsp;&nbsp; newChild.DoStuff();<br>
<br>&nbsp;&nbsp;&nbsp; return newChild;&nbsp;&nbsp;  &nbsp;&nbsp;  // maybe useful to return reference to new child.<br>}<br><br>I just saw Odie's post. That's correct, the parent is the collection. I usually pass the real parent into the collection and expose it as a property so inside the child I need to do something like this to get the real parent.<br><br>MyParent myParent = ((MyCollection) this.parent).ParentObject<br>Its a bit messy but ...<br><br>Ross<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, July 07, 2006</h2>Just a reminder. If you give your collection a reference to its parent, be sure to mark it as [NotUndoable()] otherwise you'll end up with an infinite loop when you do a BeginEdit(). I lost some hair&nbsp; after a few hours chasing that one <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
