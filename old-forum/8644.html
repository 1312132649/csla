<html><header><title>issue with static authorizations after data portal serialization</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>issue with static authorizations after data portal serialization</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8644.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Chaz4Code posted on Wednesday, March 10, 2010</h2><p>I&#39;m having an issue where authorizations are applied in the standard csla way and are fine until I serialize it through the data portal.&nbsp; After serialization the rights are lost as if they were never loaded.&nbsp; My scenario is&nbsp;that the parent object loads rights for certain roles to the child collection item objects.&nbsp; Imagine a parent object with a child collection of categories.&nbsp; If you have full rights to the parent object we grant you rights to the child collection.&nbsp; We then check for this right before loading the child collection.&nbsp; After the object is serialized and we check the CanEdit right in the fetch method it is returning false.</p>
<p>Is this expected?&nbsp; Any ideas would be appreciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, March 10, 2010</h2><p>Authorization rules are stored per AppDomain. They don&#39;t serialize over the wire, because they are created on either end of the wire.</p>
<p>In a client/server setting, you have two AppDomains - the client one and the server one. The first time any code tries to interact with an instance of your business object type in each AppDomain, that AppDomain will be initialized with the authz rules.</p>
<p>To put it another way, your AddAuthorizationRules() and AddObjectAuthorizationRules() methods in your business object class are invoked twice - once on the client and once on the server.</p>
<p>So the behavior you are seeing is unexpected. Try putting a breakpoint in your AddAuthorizationRules() method and run your app with the debugger attached to client and server. You should see the method invoked twice for each business type in your app.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Chaz4Code replied on Thursday, March 11, 2010</h2><p>Thanks Rocky.&nbsp; What I think is happening in this case is I am loading the child collections with an asyncronous call (if the user has rights) and as a result the child object is the first object to move across the wire after a fresh build.&nbsp; As a result the the parent object hasn&#39;t yet instantiated the rights to the child object based the rights it has to itself and CanEdit is returning false for the child object.&nbsp; However if I run this without the extra physical tier the unit tests run successfully; I&#39;m assuming this is because the parent object instaniated first and added roles to the child objects in the AppDomain.&nbsp; I either have to remove the async call or have the child object give rights to the parents the way the parents give rights to the children.</p>
<p>thanks again.&nbsp; I think it&#39;s great you how quickly you respond!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
