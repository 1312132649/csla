<html><header><title>How do i get the PK Id value during/after insert?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How do i get the PK Id value during/after insert?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7232.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton posted on Monday, July 06, 2009</h2>How do i get the PK Id value during/after insert?<br><br><br>I have a Student  (Parent) Object and a ContactAddress (Child) Object.<br><br>After creating and saving the Student Object, the user will then create a ContactAddress Object, passing in the StudentID (int, PK, identity field). <br><br>In the UI, I have implement the ostudent = ostudent.save() method.<br><br>But the Student Object is not updated with the StudentID assigned by the db.<br><br>I cant; follow the book example because the Project object uses GUID.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Monday, July 06, 2009</h2><P>It really is up to you how you want to achieve this. Are you using straight ADO Connection/Commands? If so are you using stored procs or just straight SQL. In any case you manually need to get the PK value back from the database (usually an output parameter on a stored proc or a select IDENTITY_SCOPE() ) and populate the Id field of your root BO. </P>
<P>I only have the 3.0.5 ProjectTracker example but even if you use later versions of CSLA the principal is the same. Check the Resource class because there an int is used as the Id and the example is clear.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton replied on Monday, July 06, 2009</h2>I am using LINQ to CSLA as DAC, and I am using sprocs to insert, update and delete both the Student and the Contact Address Objects.<br><br>I am new to CSLA and I am studying the 3.5 ProjectTracker. The Resource class has the following code:<br><br>&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br>&nbsp; Protected Overrides Sub DataPortal_Insert()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using ctx = ContextManager(Of ProjectTracker.DalLinq.PTrackerDataContext).GetManager(ProjectTracker.DalLinq.Database.PTracker)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim newId As Integer?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim newLastChanged As System.Data.Linq.Binary = Nothing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.DataContext.addResource(_lastName, _firstName, newId, newLastChanged)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>_id = CInt(newId)</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _timestamp = newLastChanged.ToArray<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.UpdateChildren(Me)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br><br>&nbsp; End Sub<br><br><br>where is it getting the newId? How do i get my StudentID?<br>Thanks.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 06, 2009</h2><P>You should read chapters 17 and 18 of <EM>Expert 2008 Business Objects</EM>, as they should help quite a lot.</P>
<P>The code you are looking at uses LINQ to SQL. And L2S is being used to invoke a stored procedure in the database. One of the really cool features of L2S is that it can "wrap" a stored procedure with a .NET method, and so this code is calling a .NET method that wraps a call to a stored procedure.</P>
<P>The stored procedure does the insert, and returns the new id and timestamp values as output parameters. Those output parameters are ByRef parameters in the .NET method call, and so they come back out through the parameters of the method call and into the variables used in the code you listed.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton replied on Monday, July 06, 2009</h2>Thanks, Rocky.<br><br>I am finally getting the new PK Id.<br><br>Thanks for CSLA.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
