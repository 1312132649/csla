<html><header><title>AddDependentProperty doesn't check for duplicates</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>AddDependentProperty doesn't check for duplicates</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8340.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis posted on Wednesday, January 13, 2010</h2><P>Subject says it all.</P>
<P>I am trying to resolve dependencies from an Expression (which is pretty easy) but that may result in adding the same dependency multiple times. It doesn't have any effect on the business logic but CheckRules is called multiple times (which is an unnecessary waste of CPU)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 13, 2010</h2>So you'd rather have CSLA throw an exception to help you debug the problem? I'll add that to the wish list.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, January 13, 2010</h2>If you are going to be making changes on that area perhaps you may also want to consider throwing an exception if the user is creating circular dependencies such as:<br /><br />ValidationRules.AddDependentProperty(StartedProperty, StartedProperty);<br /><br />I know its unlikely that someone would be doing something like that but just throwing it out there.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, January 13, 2010</h2>Hi, <br><br>I once ran into this one too: <br><br>ValidationRules.AddDependentProperty(StartedProperty, EndedProperty);
<br>ValidationRules.AddDependentProperty(EndedProperty, StartedProperty);
<br><br>creates a circular reference and code should actually be <br>ValidationRules.AddDependentProperty(StartedProperty, EndedProperty, true);
<br><br>So if Csla is going to do a better check (or update dependency to be bidirectional internally)&nbsp; it would also help. <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis replied on Thursday, January 14, 2010</h2><P>I wasn't thinking of an exception. Just a list.Contains check before the list.Add in </P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> AddDependentProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> propertyName, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> dependentPropertyName)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// get the list of rules for the property</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>List</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2>&gt; list = GetRulesForProperty(propertyName, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>).GetDependancyList(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>);</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// we have the list, add the dependency</P></FONT></FONT><FONT size=2>
<P>list.Add(dependentPropertyName);</P>
<P>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 14, 2010</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>nelis:</strong></div><div>
<P>I wasn't thinking of an exception. Just a list.Contains check before the list.Add in </P>
<P></div></BLOCKQUOTE></P>
<P>Allow the bug and just smooth it over? :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis replied on Friday, January 15, 2010</h2>Why would you consider calling AddDependentProperty twice or more with the same arguments a bug? 'Redundant' I can live with ;-)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, January 15, 2010</h2>Depends.&nbsp; Maybe its happening because intellisense kicked in and picked the wrong value.&nbsp; </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 15, 2010</h2><P>And having the your code duplicated is messy at best.</P>
<P>Suppose you want to remove the dependency, so you remove the line of code <EM>that you see</EM> which sets up the dependency. Of course the dependency remains, because <EM>some other line of code</EM> is also setting up the dependency.</P>
<P>While perhaps not a "bug", this is the kind of poor coding that leads to bugs later.</P>
<P>The responsible thing for CSLA to do (if anything) is to help you locate scenarios where your code is incorrect so you can fix it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis replied on Friday, January 15, 2010</h2>Let me explain how duplicate registrations may occur in my case.<br />I created extension methods for ValidationRules:<br />public static void AddConditionalRule(this ValidationRules validationRules, Expression> condition, RuleHandler handler, ...)<br />The idea is that the rule is only applied when the condition evaluates to true. You could of course include the condition in a custom rule but usually it is much more convenient to use a common rule in combination with a dedicated condition (e.g. StringRequired when a certain flag is set).<br />The condition is analyzed for dependencies that are added using AddDependentProperty. However a dependency may occur more than once:<br />c => c.Code == "A" || c.Code == "B"<br />As far as I can see there is no way for me to get a list of already registered dependencies. Doing my own duplicate bookkeeping also seems a bit odd.<br /><br />I do agree on your 'poor coding' remark. The alternative would be to have access to the list of registered dependencies.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 13, 2010</h2><P>Actually Jonny, your examples are identical.</P>
<P>The only reason the method takes that bool parameter is as a shortcut so you can do in one line of code what you had to do in two lines of code.</P>
<P>There's absolutely nothing wrong with bi-directional dependent properties, and I don't plan to change how that works at all.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
