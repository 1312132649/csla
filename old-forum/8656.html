<html><header><title>Encrypt BusinessBase objects???</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Encrypt BusinessBase objects???</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8656.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 posted on Saturday, March 13, 2010</h2><p>Everyone,<br />Has anyone tried to encrypt a business object before persisting it?&nbsp; We have a WinForms app using CSLA 3.7 and we have a customer who likes to play in the database. (Yes, I know this is bad, but we aren&#39;t allowed to lock them out of it).</p>
<p>I&#39;m not too familiar with encryption and was wondering if anyone has done this and if it is easy.</p>
<p>Thanks for any insight,</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stuart.bale replied on Saturday, March 13, 2010</h2><p>Hi Reagan,</p>
<p>Do you read property values and updated these straight into table columns (fields)?&nbsp;</p>
<p>or</p>
<p>Are you serializing the data object into a &#39;BLOB&#39; that then gets stored in a table?</p>
<p>The answer to your question really depends on your architecture.</p>
<p>Let me know what you&#39;re doing in a little more detail, and perhaps I can help out.</p>
<p>Regards,</p>
<p>Stuart</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Saturday, March 13, 2010</h2><p>The first scenario.&nbsp; We are updating them straight into the table columns.</p>
<p>Appreciate the quick response :)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>stuart.bale replied on Saturday, March 13, 2010</h2><p>Ok.</p>
<p>Obviously, you need to be able to store the actual values into the fields in the table, as you want to be able to use SQL queries to filter/group/join, etc.&nbsp; So encrypting the actual data in the table would not be sensible, as you couldn&#39;t then use the database engine to get back the data you want. (Well this isn&#39;t entirely true - but if my suggestion below isnt any good - i can tell you how to do it).</p>
<p>Of course, if there is data that you don&#39;t <b>ever</b> need to be able to filter/group/join on, then you could encrypt that before writing it to the field.&nbsp; You&#39;d typically do this with any security related data, such as user passwords.</p>
<p>But i think you are looking at a situation where a client/user has direct access to the tables and is messing up the data, so another option is to add another field to each table called something like &#39;checksum&#39;.&nbsp; Then, whenever you update data into the table from your business object (DataPortal_Update/DataPortal_Insert), you can update this checksum field at the same time.&nbsp; The checksum should be derived from critical data in your business object, and can be easily created using standard .Net cryptography, such as an MD5 hash.&nbsp; Depending on the size of your object, you could serialize the object (in memory) and run a checksum over the entire object.&nbsp; Or, if the object writes to multiple tables, then you&#39;ll need to checksum the row of data - you can do this the same way.</p>
<p>Then, when you read the object back from the table (DataPortal_Fetch) and have populated all the fields, run the checksum again and compare it against the checksum from the table.&nbsp; If they differ, then the data has been modified externally, in which case you can handle that as an exception and/or invalidate the data and/or pop a message box to the user telling them not to mess with data otherwise this kind of thing happens.</p>
<p>Does that help?</p>
<p>Stuart</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Saturday, March 13, 2010</h2><p>Actually I think this does help and may work.</p>
<p>I would be interested in knowing how you would approach the first scenario that actually stored the encrypted value in the database.&nbsp;&nbsp;&nbsp;</p>
<p>Thank you so much for the detailed response.&nbsp; It really helps.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stuart.bale replied on Saturday, March 13, 2010</h2><p>HI,</p>
<p>Before deciding to encrypt data in the database, you need to think of the consequences of doing so.&nbsp; </p>
<p>Since 2005, Microsoft SQL Server has built in cell level encryption - but you lose all query optimisations on encrypted cells, and performance will degrade significantly as more data is added, and with any joins.&nbsp; MS SQL Server 2008 has introduced database encryption, but that has drawbacks too - and if your user/client has administrative access, then either of these options might be able to be worked around.&nbsp; If you want more info on this, check out this (extensive) MS article:<br />http://msdn.microsoft.com/en-us/library/cc278098.aspx</p>
<p>Alternatively, you could implement your own encryption in your data layer - but that will certainly mean that you can&#39;t use traditional SQL queries - for example, if you wanted to find all records with the letter x in the field, you would have to load the entire table of data into memory, decrypt it, then run an in-memory query across the data (perhaps using LINQ), to then populate your business objects with the results.&nbsp; Unless you have very small amounts of data, this is just not feasible.</p>
<p>MySQL has a variety of ENCRYPT/ENCODE options that you can use in your insert/update/select queries, however I&#39;ve never used these.&nbsp; Your database would still suffer performance issues with this approach.</p>
<p>As a last thought - perhaps you could ask your client/user why they are playing in the database.&nbsp; Maybe there is an opportunity for some additional features that you could add to your product that would mean they don&#39;t need to do that anymore?</p>
<p>Regards,</p>
<p>Stuart</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Saturday, March 13, 2010</h2><p>That all makes sense.&nbsp; Thanks again.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
