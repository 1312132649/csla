<html><header><title>Windows Service with CSLA</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Windows Service with CSLA</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1569.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rbellow posted on Monday, October 23, 2006</h2><P><FONT face=Verdana size=2>Are there any known issues when using CSLA in a Windows Service? I created a new Windows Service and made a project reference to my existing&nbsp;CSLA business objects. I continue to get a DataPortal.Fetch error. I hard coded the connection string in the object just to verify it was not an issue with the app.config. Am I missing something obvious? Any help would be greatly appreciated.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, October 24, 2006</h2>What kind of Exception do you get? What message?<br><br>My guess is that it is a security issue. I believe that by default Windows services are run with the permissions of the LOCAL SERVICE account, which most probably has no access rights to your database.<br><br>If this is the case, then your can resolve this:<br>- alter the rights on your DB to allow access for LOCAL SERVICE user (this is NOT recommended)<br>- the recommended approach would to make your service run under a dedicated account name and grant DB access for this particular account.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rbellow replied on Tuesday, October 24, 2006</h2><P>As you know debugging a windows service is not easy. I wrapped the script in a try catch and had it email me the exception. The exception is the basic DataPortal.Fetch Failed error. I have tested the object in other projects and it works as expected.</P>
<P>The service is using the same connection string as the web project, so I am not sure how the permissions would be denied from the service.</P>
<P>I have tried LOCAL SERVICE and LOCAL SYSTEM as the Account and both have the same result. I also tried USER and supplied the Administrator login information, but it failed to install. At this point I don't know what else to try. Any ideas?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Tuesday, October 24, 2006</h2><P>Check out the details of the DataPortalException. The DataPortalException.BusinessException will give you more details.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rbellow replied on Tuesday, October 24, 2006</h2><P>Thanks that was very helpful. It appears that my service is attempting to reference my business object from the development server. When I made the references in the Windows Service project to my BO class library I set Copy :Local = True. Do I need to make each DLL an Embedded Resource for this to work?</P>
<P>It would seem to me that if Copy Local = True that this would be incorporated into the service. Am I missing something here?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, October 24, 2006</h2>My guess is that copylocal=true should do the trick, but trial-and-error will give you the definite answer ...<br><br>Otherwise, the exceptions thrown will give you clues on how to proceed. Make sure you not only email yourself details about the top-most exception, but also (recursively) all inner-exceptions.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rbellow replied on Tuesday, October 24, 2006</h2><P><FONT face=Verdana size=2>Ok. Thanks for your help. After a half day of trial and error and a little research I found the problem. I will explain in case any other novice windows service developers have the same problem.</FONT></P>
<P><FONT face=Verdana size=2>1. By default the Windows Service does not include System.Configuration. Make a reference and you should be good. CSLA uses the following as a function to return the database name from your app.config file:</FONT></P>
<P><FONT face=Verdana size=2>ConfigurationManager.AppSettings(<FONT color=#800000>"DB:"</FONT> &amp; DatabaseName)</FONT></P>
<P><FONT face=Verdana size=2>And this function&nbsp;requires System.Configuration. Make sure you have all the other necessary references as well.</FONT></P>
<P><FONT face=Verdana size=2>2. You need to copy your app.config file and place it in the bin directory. You should rename it XXXXX.exe.config where XXXXX is the name of your service.</FONT></P>
<P><FONT face=Verdana size=2></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Friday, October 27, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rbellow:</strong></div><div> 
<P>As you know debugging a windows service is not easy.</P>
<P></div></BLOCKQUOTE></P>
<P>It's actually not that hard.&nbsp; You just start the service and use Debug -&gt; Attach to process from the menu.&nbsp; The only challenge really&nbsp;is having enough delay in the service so you can attach to&nbsp;it fast enough to catch the bug.&nbsp; :)</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
