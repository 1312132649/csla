<html><header><title>Exception on opening Connection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Exception on opening Connection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1397.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger Smith posted on Thursday, October 05, 2006</h2><P>Hello,</P>
<P>I am in the process of writing my first app using CSLA (so please bare with me).</P>
<P>I have no problem retreiving data from a SQL DB. However when I try to perform an update, an exception is thrown.</P>
<P>The code is as follows:</P><FONT size=2>
<P>[</FONT><FONT color=#008080 size=2>Transactional</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>TransactionalTypes</FONT><FONT size=2>.TransactionScope)]</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Update()</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// if we're not dirty then don't update the database</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.IsDirty) </FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> cn = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2>(<FONT color=#008000 size=2>Database.BridgeBearingConnection</FONT></FONT><FONT size=2>))</P>
<P>{</P>
<P>cn.Open();</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlCommand</FONT><FONT size=2> cm = cn.CreateCommand())</P>
<P>{</P>
<P>cm.CommandText = </FONT><FONT color=#800000 size=2>"updateDeliveryDateUpdate"</FONT><FONT size=2>;</P>
<P>cm.CommandType = </FONT><FONT color=#008080 size=2>CommandType</FONT><FONT size=2>.StoredProcedure;</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@intDeliveryDateUpdateId"</FONT><FONT size=2>, _intDeliveryDateUpdateId);</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@dteRevisedDate"</FONT><FONT size=2>, _dteRevisedDate);</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@strRevisionReason"</FONT><FONT size=2>, _strRevisionReason);</P>
<P>cm.ExecuteNonQuery();</P>
<P>}</P>
<P>MarkOld();</P>
<P>}</P>
<P>}</P>
<P>The error occurs at cn.Open(). I know my connection string is OK as I can retrieve data OK.</P>
<P>The error message is:</P>
<P>{"The partner transaction manager has disabled its support for remote/network transactions. (Exception from HRESULT: 0x8004D025)"}</P>
<P>Any help greatly appreciated.</P>
<P>Roger Smith</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Thursday, October 05, 2006</h2>My first guess would be that you are running on Windows XP service pack 2 and have not enabled the distributed transaction controller.&nbsp; Try a Google search for getting it up and running.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, October 05, 2006</h2><P>Try removing the attribute:<BR>[<FONT color=#008080 size=2>Transactional</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>TransactionalTypes</FONT><FONT size=2>.TransactionScope)]</FONT></P>
<P><FONT size=2>as a test to see if your code works correctly.</P>
<P></FONT></P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger Smith replied on Friday, October 06, 2006</h2><P>Good guess Brian.</P>
<P>DTC was enabled on both the Client and Server. However, it was not configured correctly. I found the following link useful in resolving this:</P>
<P><A href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=230390&amp;SiteID=1">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=230390&amp;SiteID=1</A></P>
<P>Joe: I originally had no Transaction Attribute but still got the error. Not sure why as I understand having no attribute defaults to Manual Transactions.</P>
<P>&nbsp;</P>
<P>Thanks for the help!</P>
<P>Roger.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
