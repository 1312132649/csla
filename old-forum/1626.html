<html><header><title>Conditional AuthorizationRules ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Conditional AuthorizationRules ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1626.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch posted on Monday, October 30, 2006</h2><P><FONT size=2>Is there a way to have an AuthorizationRule depend on the value of another property.&nbsp; I have a use case where a 'Descriptor' property cannot be&nbsp;modified&nbsp;(DenyWrite)&nbsp;only when the value of another&nbsp;property (bool) value is 'true'.&nbsp; Both properties are from the same BO, so I have access to its value.</FONT></P><FONT size=2><FONT color=#0000ff><FONT size=2>
<P>AuthorizationRules.DenyWrite(<FONT color=#008000>"</FONT></FONT><FONT size=2><FONT color=#008000>Descriptor"</FONT>, </FONT><FONT color=#800000 size=2>"SomeRole"</FONT><FONT size=2>);</FONT></P>
<P><FONT color=#000000>The above will have the DenyWrite rule execute all the time, I need it to validate only the another property is true.</FONT></P>
<P></FONT><FONT color=#000000>Thanks</FONT></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Monday, October 30, 2006</h2>I haven't found a way to do this through the authorization rules. We have tried two ways to enforce these kinds of changes.<br><br>1) Put the logicin the setter method of the property and throw an exception.<br><br>2) Use a different object for the read-only state.<br><br>Option 1 is usually our first choice. Option 2 is used when there are several properties that become read-only. This is typically done with a "new" object vs. an "existing" object, if the existing object has lots of read-only properties.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, October 30, 2006</h2><P>Is the second condition really an authorization rule or a business rule?&nbsp; What I mean is, granting access to the method or property is the role of the authorization rule.&nbsp; If you are saying that someone in role 'x' is generally allowed to perform the operation but only if the object is in a certain state, then you are authorizing that user but have a business rule that may or may not prohibit use of the particular method or property given the current state of the object.</P>
<P>I tend to use the "Can I...", "May I..." approach to differentiating authorization and business rules.&nbsp; authorization rules answer the question, "May I...", while business rules answer, "Can I...".</P>
<P>For example:</P>
<P>"May I write a value to property 'x'?"&nbsp; If you are authorized, you may; otherwise, you may not.&nbsp; It doesn't really matter whether the current state of the object would allow you to or not at this point.</P>
<P>"Can I write a value to property 'x'?"&nbsp; This depends not only on your authorization but on the current state of the object and the business rules you have in place.&nbsp; So, the answer will be something like "if 'this' and 'that' are true, then you can; otherwise, you cannot."</P>
<P>It's kind of like having a screener outside the enterance to a night club.&nbsp; Whether you may or may not enter is up to the screener, whether you can or can't depends on if the door is locked or the place is so full there is no more room for you, etc.&nbsp; The state of the door or the capacity of the club don't matter until you get past the screener (authorized) and the screener really doesn't care if the door is locked or the joint is full because that's not his job.</P>
<P>I know it's all just semantics, but sometimes that helps.&nbsp; Sounds to me like you are trying to mix authorization and business rules together.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, October 30, 2006</h2><P><STRONG>SonOfPirate</STRONG>, I have it setup as a business rule currently but the user interaction is a bit clunky in that the BO let's the user modify the descriptor property only to throw an exception when the BO gets saved.&nbsp; The more 'user friendly' approach would be to prevent the user to&nbsp;'set' the property to any value in the first place.</P>
<P>In my case I'll always get pass the entrance of the&nbsp;night club.&nbsp; However, there is a _special_ table in the night club.&nbsp; Anybody that sits at that _special_ table cannot order a drink (DenyWrite).&nbsp; Sit anywhere else&nbsp;and you can order whatever you want (AllowWrite).</P>
<P>I agree in principal in that this is a business rule and has nothing to do with your AuthorizationRules - but its all about user interaction in this case.</P>
<P><STRONG>Brian Criswell</STRONG>,&nbsp;...Just override CanWriteProperty()... Doh, you're right, I'll look into this.&nbsp; Thanks</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 30, 2006</h2>Just override CanWriteProperty()<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, October 30, 2006</h2>In your property setter for the bool, is it possible to just call DenyWrite or AllowWrite, depending on the value to which the property is being changed?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 30, 2006</h2>I find that it is better to override CanWriteProperty to handle the special cases.&nbsp; Then all of your property setters look the same.&nbsp; It then also integrates with the ReadWriteAuthorizationComponent.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, October 30, 2006</h2>Yes, that's the way I have done it as well.&nbsp; The method I suggested would integrate as well, since canread / canwrite look at the authrules.<br><br>Atlhough it might be good that the property setter is different; it more closely matches what is actually happening.&nbsp; I guess it depends on where most people would look first; at the override, or the property setter.<br><br>Either way he'll have to call the reset method on the RWAuth component.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, October 30, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Brian Criswell:</strong></div><div>I find that it is better to override CanWriteProperty to handle the special cases.&nbsp; Then all of your property setters look the same.&nbsp; It then also integrates with the ReadWriteAuthorizationComponent.<BR></div></BLOCKQUOTE></P>
<P>I'm using code generation (thank god for partial class) to generate my BO's, so overriding seems to be the best approach as I can still generate as-is code for&nbsp;getters and setters&nbsp;and then override the method in my custom partial class.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, October 30, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>In your property setter for the bool, is it possible to just call DenyWrite or AllowWrite, depending on the value to which the property is being changed?<BR></div></BLOCKQUOTE></P>
<P>Great idea, but the bool property is a readonly property :(</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, October 30, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>In your property setter for the bool, is it possible to just call DenyWrite or AllowWrite, depending on the value to which the property is being changed?<BR></div></BLOCKQUOTE></P>
<P>Ummm... now you got me thinking.&nbsp; Would it work if I was to either call the DenyWrite or AllowWrite from within my dp_fetch method once I know the value of the bool property?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, October 30, 2006</h2>It sounds like it should work... but I think you'll have to try and see.<br><br><br>I think your method would work, but if you allow that bool to change while the object is being used, then you'll likely have problems.&nbsp; The roles which are allowed or denied are just lists... and you have no one to remove an entry once its on the list.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, October 30, 2006</h2>Thank you ajj3085.&nbsp; I did just that, I set the DenyWrite or AllowWrite in my dp_fetch method and it works like a charm.&nbsp; Well almost like a charm, using the DenyWrite or AllowWrite directly will _SHARE_ the authorization rule between instances of the same object so would work the first time but could not guaranty it would work on&nbsp;subsequent instances of the object.&nbsp; Luckily for me&nbsp;Rocky provided&nbsp;the InstanceDenyWrite and InstanceAllowWrite.&nbsp; Ohhhh, now it works like a charm.&nbsp; Thanks to everybody who participated in this thread.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
