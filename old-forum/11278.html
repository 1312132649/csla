<html><header><title>Silverlight DAL selection IObjectFactoryLoader??</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight DAL selection IObjectFactoryLoader??</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11278.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>csmith1 posted on Tuesday, April 03, 2012</h2><p>For Silverlight unit testing I am thinking I would like to compile my Mock DAL and object factories in Silverlight.</p>
<p>I do not see how to implement an&nbsp;<span>Csla.Server.</span><span>IObjectFactoryLoader in Silverlight.</span></p>
<p><span>The alternative would be to generate factory name that link to my Silverlight Mock DAL.</span></p>
<p><span>I&#39;d like to be able to unit test Silverlight viewmodels and model.&nbsp;</span></p>
<p><span><br /></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>csmith1 replied on Tuesday, April 03, 2012</h2><p>So I used some compiler option to get the MOCK DAL to to be referenced . I can see the fetch calls are getting to the factory but the FetchCompleted is not firing. So I can not test async functions.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>csmith1 replied on Tuesday, April 03, 2012</h2><p>I made this change to CSLA.Silverlight4.DataPortalClient.FactoryProxy.</p>
<p>
<pre>&nbsp;<span>public</span>&nbsp;<span>void</span>&nbsp;BeginFetch(<span>object</span>&nbsp;criteria,&nbsp;<span>object</span>&nbsp;userState)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_userState&nbsp;=&nbsp;userState;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span>&nbsp;obj&nbsp;=&nbsp;<span>Activator</span>.CreateInstance(Csla.Reflection.<span>MethodCaller</span>.GetType(_attribute.FactoryTypeName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span>&nbsp;handler&nbsp;=&nbsp;<span>new</span>&nbsp;<span>CompletedHandler</span>(OnFetchCompleted);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span>&nbsp;result&nbsp;=&nbsp;&nbsp;<span>MethodCaller</span>.CallMethod(obj,&nbsp;_attribute.FetchMethodName,&nbsp;criteria,&nbsp;handler);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if</span>&nbsp;(result&nbsp;!=&nbsp;<span>null</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler((T)result,&nbsp;<span>null</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre>Looks like this should wrapped in a try catch as well to throw the error to the&nbsp;<span>OnFetchCompleted</span></pre>
<pre> event as well.</pre>
<pre>It would be nice if someone could confirm this is a good fix. It pass my test now. Calling the Mock DB DAL and a real DB DAL.</pre>
</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
