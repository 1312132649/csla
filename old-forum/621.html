<html><header><title>Design Question?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design Question?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/621.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy posted on Friday, July 14, 2006</h2><P>Hi everybody, I know this is not a CSLA question but everybody always offers such great advice on this board I just had to ask here as well :) If you don't mind offering some suggestions on the following we'd really appreciate it.</P>
<P>We're having trouble relating these tables in a diagram because of the keys. <BR>Is it necesary to have the references setup?&nbsp; <BR>I would assume yes so the forign keys can be setup. </P>
<P>If you look at this link, you'll see our diagram.&nbsp; <BR>In Red are the relationships that we would like to make for referential integrity, but cannot because of the keys.<BR><A href="http://rullo.ca/linktome/QuestionsDB.jpg">http://rullo.ca/linktome/QuestionsDB.jpg</A></P>
<P><BR>Our goal in all of this is to have a facility wherin we can store a question, that has multiple names over multiple Languages.&nbsp; For instance:<BR>&nbsp;-Q1| QNameID = 1 |&nbsp;"Do you have a dog in your appartment?" &nbsp;| LangID = 1(eng)<BR>&nbsp;-Q1| QNameID = 2 |&nbsp;"Do you have a dog in your house?"&nbsp;&nbsp;&nbsp;| LangID = 1(eng)<BR>&nbsp;-Q1| QNameID = 1 |&nbsp;"-French - Do you have a chien in your appartment?" &nbsp;| LangID = 2(fr)<BR>&nbsp;-Q1| QNameID = 2 |&nbsp;"-French - Do you have a chien in your house?"&nbsp;&nbsp;&nbsp;| LangID = 2(fr)</P>
<P>The difficulty is when we try and put this in the group details table.&nbsp; We don't want to outline the Language, we'd just pass the language into a proc to retreive a specific group with a specific language.&nbsp;&nbsp;</P>
<P>CREATE TABLE [Question] (<BR>&nbsp;[QuestionID] [int] NOT NULL ,<BR>&nbsp;[SystemName] [varchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,<BR>&nbsp;CONSTRAINT [PK_Question] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionID]<BR>&nbsp;)&nbsp; ON [PRIMARY]<BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>CREATE TABLE [QuestionAnswer] (<BR>&nbsp;[QuestionID] [int] NOT NULL ,<BR>&nbsp;[QuestionAnswerID] [int] NOT NULL ,<BR>&nbsp;[SystemName] [varchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,<BR>&nbsp;CONSTRAINT [PK_QuestionAnswer] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionID],<BR>&nbsp;&nbsp;[QuestionAnswerID]<BR>&nbsp;)&nbsp; ON [PRIMARY] ,<BR>&nbsp;CONSTRAINT [FK_QuestionAnswer_Question] FOREIGN KEY <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionID]<BR>&nbsp;) REFERENCES [Question] (<BR>&nbsp;&nbsp;[QuestionID]<BR>&nbsp;)<BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>CREATE TABLE [QuestionAnswerName] (<BR>&nbsp;[QuestionAnswerID] [int] NOT NULL ,<BR>&nbsp;[QuestionAnswerNameID] [int] NOT NULL ,<BR>&nbsp;[LanguageID] [int] NOT NULL ,<BR>&nbsp;[Name] [varchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL ,<BR>&nbsp;CONSTRAINT [PK_QuestionAnswerName] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionAnswerID],<BR>&nbsp;&nbsp;[QuestionAnswerNameID],<BR>&nbsp;&nbsp;[LanguageID]<BR>&nbsp;)&nbsp; ON [PRIMARY] <BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>CREATE TABLE [QuestionGroup] (<BR>&nbsp;[QuestionGroupID] [int] NOT NULL ,<BR>&nbsp;[Name] [varchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,<BR>&nbsp;CONSTRAINT [PK_QuestionGroup] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionGroupID]<BR>&nbsp;)&nbsp; ON [PRIMARY] <BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>CREATE TABLE [QuestionGroupDetails] (<BR>&nbsp;[QuestionGroupID] [int] NOT NULL ,<BR>&nbsp;[QuestionNameID] [int] NOT NULL ,<BR>&nbsp;[QuestionAnswerNameID] [int] NOT NULL ,<BR>&nbsp;[QuestionSortOrder] [int] NULL ,<BR>&nbsp;[AnswerSortOrder] [nchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL ,<BR>&nbsp;[DisplayLevel] [int] NULL ,<BR>&nbsp;CONSTRAINT [PK_QuestionGroupDetails] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionGroupID],<BR>&nbsp;&nbsp;[QuestionNameID],<BR>&nbsp;&nbsp;[QuestionAnswerNameID]<BR>&nbsp;)&nbsp; ON [PRIMARY] ,<BR>&nbsp;CONSTRAINT [FK_QuestionGroupDetails_QuestionGroup1] FOREIGN KEY <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionGroupID]<BR>&nbsp;) REFERENCES [QuestionGroup] (<BR>&nbsp;&nbsp;[QuestionGroupID]<BR>&nbsp;)<BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>CREATE TABLE [QuestionNames] (<BR>&nbsp;[QuestionID] [int] NOT NULL ,<BR>&nbsp;[QuestionNameID] [int] NOT NULL ,<BR>&nbsp;[LanguageID] [int] NOT NULL ,<BR>&nbsp;[Name] [varchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,<BR>&nbsp;[Desciption] [nchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL ,<BR>&nbsp;[ControlTypeID] [uniqueidentifier] NOT NULL ,<BR>&nbsp;CONSTRAINT [PK_QuestionNames] PRIMARY KEY&nbsp; CLUSTERED <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionID],<BR>&nbsp;&nbsp;[QuestionNameID],<BR>&nbsp;&nbsp;[LanguageID]<BR>&nbsp;)&nbsp; ON [PRIMARY] ,<BR>&nbsp;CONSTRAINT [FK_QuestionNames_Question] FOREIGN KEY <BR>&nbsp;(<BR>&nbsp;&nbsp;[QuestionID]<BR>&nbsp;) REFERENCES [Question] (<BR>&nbsp;&nbsp;[QuestionID]<BR>&nbsp;)<BR>) ON [PRIMARY]<BR>GO</P>
<P><BR>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, July 14, 2006</h2>Just by looking at your diagram (jpg), I believe that you are making your foreign keys part of your primary keys...<br>I suggest removing your fks from your primary keys when appropiate... for example, QuestionAnswerId could be the primary key in QuestionAnswer and QuestionId would just be a regular field...<br>Another thing: The QuestionAnswerName appears to be just a localization table for QuestionAnswer.<br>If that is the case, then there's no point in creating a relation between QuestionAnswerName and QuestionGroupDetails. I'd create a relation between QuestionAnswer and QuestionGroupDetails directly.<br>Now, being like that, you don't really need a relation between QuestionNames (because it's a localization table) and QuesionGroupDetails. But there's also no need for creating one between QuestionGroupDetails and Question because QuestionGroupDetails already has a relation to QuestionAnswer and that has a relation to Question.<br><br>So, your QuestionGroupDetails could look like:<br>@QuestionGroupId<br>@QuestionAnswerId<br>QuestionSortOrder<br>AnswerSortOrder<br>DisplayLevel<br><br>And it would only relate to QuestionAnswer and QuestionGroup<br><br>Andrés<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Friday, July 14, 2006</h2><P>Thank you very much for the suggestion. I think that maybe my above definition of our desired out come is a little confusing. Here is a little clear explanation of what we want.</P>
<P>Our goal is to have a facility wherin we can store questions and the associated answers. We need to have multiple names for these questions and answers over multiple Languages. <BR><BR>For each question ID (one question) we want to be able to ask it or display it differently(n ways) <BR>The same requirement goes for each answer. We want to have multiple "names" for one answer over multiple languages. For instance <BR><BR>QueAnsID = 1 | AnsNameID = 1 | LangID = 1(en) | "Yes" <BR>QueAnsID = 1 | AnsNameID = 2 | LangID = 1(en) | "Y" <BR>QueAnsID = 1 | AnsNameID = 1 | LangID = 2(fr) | "Oui" <BR>QueAnsID = 1 | AnsNameID = 2 | LangID = 2(fr) | "O" <BR><BR>QueAnsID = 2 | AnsNameID = 3 | LangID = 1(en) | "No" <BR>QueAnsID = 2 | AnsNameID = 4 | LangID = 1(en) | "N" <BR>QueAnsID = 2 | AnsNameID = 3 | LangID = 2(fr) | "Non" <BR>QueAnsID = 2 | AnsNameID = 4 | LangID = 2(fr) | "N" <BR><BR>This is so that when it comes together from teh above example, we'd pass in a groupID and a LanguageID into a select statementand the result would be: <BR><BR>Do you have a dog in your appartment? <BR>Yes <BR>No <BR><BR>Or, if the group were different: <BR><BR>Do you have a dog in your house? <BR>Y <BR>N <BR><BR>Were having some problems normalizing this data. Here is a link to an image of the table structure we came up with. <BR>We are trying to leave the LanguageID out of the group details so that we don't have data duplicated that doesn't need to be. <BR><BR>So we can have 1 group of Questions/Answers but have a choice to display it in mulitiple languages AND so that a report could have abbreviated question name and answers but still have the same value in the database. <BR><BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, July 14, 2006</h2>RangerGuy,<br><br>So, let's see if I got it straight:<br><br>You're going to have 1 row in QuestionAnswerName for combination between QuestionAnswer and LanguageId, right? <br><br>If that is the case, then I understood correctly and you need not join QuestionAnswerName and QuestionGroupDetails and my recommendation still applies.<br><br>Now, if what you're saying is that one combination of QuestionAnswer and LanguageId can exist more than once ( !!! ) then you'll need to create a new table to have the languageId and questionanswernameid and the actual text. But I don't want to dive into a more thorough explanation because I don't think that's what you want...<br><br>If you are only going to show one language at a time, then think about what I said in my first post, because I think that is the appropiate way to handle it. The way I see it, the xxxxName tables are only there to provide localization for Question and QuestionAnswer, so you should only join QuestionGroupDetails to QuestionGroup and QuestionAnswer. I've worked in two projects of the same characteristics and that's the way it was handled in both.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, July 14, 2006</h2><P>I like to start with the true definition of things.&nbsp; Once I understand that, the model I need is usually pretty obvious (or the model I have is usually pretty obviously wrong :).</P>
<P>I'm not trying to model this for you, I'm trying to identify concepts you may want to consider in your model.&nbsp; You'll have to evaluate them against your business needs.</P>
<P>I'm doing this because the meanings behind some of your tables seem a bit jumbled to me.&nbsp; Doesn't mean that they are, it could be that I don't have the context to understand your intent.</P>
<P>I'm guessing that QuestionGroup serves the purpose of grouping questions into a survey of some sort.&nbsp; Change the lingo as needed. :)</P>
<P>I've chosen to supply a sample model using the following definitions using mostly composite primary keys rather than identity columns for each table.&nbsp; Why?&nbsp; Because I'm leaving the office early and it saves on typing!&nbsp; Convert to identity columns if that's your style. :)</P>
<P>Hope this helps!</P>
<P><STRONG>Question:</STRONG>&nbsp; </P>
<P>A record of the&nbsp;existence of a question of interest to the organization.&nbsp; </P>
<P><STRONG>CultureLanguage:</STRONG></P>
<P>A language / culture combination that would affect how questions are asked, and in which we want to ask (or have asked) questions.&nbsp; I.e., French is used by French nationals and French-Canadians.We might want to phrase the question differently to the two groups due to dialect differences.&nbsp; (Technical note: one could argue this is two things, but I suspect that's overkill for your purposes.)&nbsp; </P>
<P><STRONG>QuestionText:</STRONG></P>
<P>The actual text of a question in a specific language aimed at a specific culture.</P>
<P><STRONG>Allowable Answer:</STRONG></P>
<P>A record of the existence of a pre-defined answer to a question, as in&nbsp;a choice in a multiple choice question.&nbsp; This is used to provide a list of choices to the question.</P>
<P><STRONG>Allowable Answer Text:</STRONG></P>
<P>The actual text for an allowable answer in a specific language aimed at a specific culture.</P>
<P><STRONG>Survey&nbsp; </STRONG></P>
<P>The existence of a set of questions that have been grouped together.<BR>(This and Survey Question below are my guesstimate of what your QuestionGroup is about.)<BR><BR><STRONG>Survey Question</STRONG></P>
<P>The assignment of a question to&nbsp;a survey.&nbsp; (It is possible that we might want to ask the same question more than once in a given survey.)</P>
<P><STRONG>Respondent<BR></STRONG>A person we will ask (or have asked) questions of.</P>
<P><STRONG>SurveyResponse<BR></STRONG>A survey posed to a respondent at a specific point in time.&nbsp; (We might ask them the same set of questions more than once, and need to distinquish between the different sets of answers.)</P>
<P><STRONG>Survey Question Answer</STRONG></P>
<P>The actual answer given by a respondent to a survey question, in a specific language and an assumed cultural group.&nbsp; </P>
<P>(Answers to the same question may be very different, even from the same person answering it, depending upon the questions that were posed before.&nbsp; Thus, I have modeled a Survey Question answer and not a Question Answer.)</P>
<P>(Example: I've identified a cultural/language group called German.&nbsp; I record&nbsp;the question text for a question using the German cultural/language.&nbsp; I ask a man on the street in Germany a question in German, and he answers me in German,&nbsp;so I record his answer as being&nbsp;German.&nbsp; But he might have been a Turkish guest worker who speaks German.&nbsp; That's probably beyond your project scope... :)</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>========</P>
<P><STRONG>Question:</STRONG>&nbsp; </P>
<P>QuestionId&nbsp;&nbsp;&nbsp; (primary key)<BR>SystemName (unique key)</P>
<P><STRONG>CultureLanguage:</STRONG></P>
<P>LanguageId&nbsp; (primary key)<BR>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (unique key)</P>
<P><STRONG>QuestionText:<BR></STRONG>QuestionId&nbsp;&nbsp;&nbsp;&nbsp; (primary key)<BR>LanguageId&nbsp;&nbsp;&nbsp; (primary key)<BR>QuestionText</P>
<P><STRONG>Allowable Answer:<BR></STRONG>AllowableAnswerId (primary key)<BR>Question Id<BR>SystemName (unique key)</P>
<P><STRONG>Allowable Answer Text:<BR></STRONG>AllowableAnswerId&nbsp;(primary key)<BR>LanguageId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (primary key)<BR>AllowableAnswerText (unique key)<BR><STRONG>Survey&nbsp; <BR></STRONG>SurveyId (primary key)<BR>SystemName (unique key)<BR><STRONG><BR>Survey Question<BR></STRONG>SurveyId&nbsp;&nbsp;&nbsp;&nbsp; (primary key)<BR>QuestionId&nbsp; (primary key)<BR>PresentationOrder (primary key)</P>
<P><STRONG>Respondent<BR></STRONG>RespondentId (primary key)<BR>Name <BR>CurrentPreferredLanguageId<BR><STRONG><BR>SurveyResponse<BR></STRONG>SurveyResponseId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (primary key)<BR>SurveyId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (unique key 1)<BR>RespondentId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (unique key 1)<BR>DateTimeOfResponse&nbsp; (unique key 1)<BR>LanguageId&nbsp;&nbsp; <BR><BR>(Note: Assumes same language for all questions - if you are doing work with immigrants, they might want to be asked in one language first, and only revert to their native language if they don't understand that particular question.&nbsp; If so, LanguageId needs to be recorded in SurveyQuestionAnswer instead.)<BR><BR><STRONG>Survey Question Answer<BR></STRONG>SurveyResponseId (primary key)<BR>QuestionId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (primary key)<BR>AnswerText<BR></P>
<P><STRONG></STRONG>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
