<html><header><title>Best approach to set connectionstring per Object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best approach to set connectionstring per Object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11082.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nj609eagle posted on Tuesday, January 24, 2012</h2><p>We are about change our multi-year database application and would like to eliminate a simple step.&nbsp; The winApp is a membership and billing database.&nbsp; Each year of the membership and billing is in a different database all&nbsp;hosted on a single SQL server.</p>
<p>Right now each time the application launches, the user is asked what year they want to look at.&nbsp; If they need to look at two years at the same time, they need to open a second instance of the winApp, and choose the other year.&nbsp; We store this selection in the UserObject corrently, and have been able to modify the DataAccess and Fetch to use what is in the UserObject.</p>
<p>ThHe users of the system, no longer want to open up a seperate instance each time.&nbsp; So we would like to place this year selection on each search screen.&nbsp; Then pass the connection string to each object before it tries to connect.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, January 24, 2012</h2><p>Well, </p>
<p>I guess you would have to set that as a &quot;context&quot; property on each &quot;root&quot; object (like &quot;year&quot;) and let the serverside code control which database to use. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Curelom replied on Tuesday, January 24, 2012</h2><p>The &quot;Best Approach&quot; would likely be re-writing the database to accomodate a multiyear design in a single database.&nbsp; However, since that would likely take a lot of effort, you can change the context as Johnny suggested or you could union your queries across the databases.&nbsp; Reference each database with double dot notation.&nbsp; The user of course would need access to all databases referenced this way.</p>
<p>Example</p>
<p><span style="font-family:Verdana,Arial,Helvetica;"><span style="font-family:Verdana,Arial,Helvetica;color:midnightblue;font-size:x-small;"><span class="spnMessageText" id="msg">
<pre id="code"><span style="font-family:courier;font-size:x-small;">Select Name, Data, &#39;2010&#39; year
From SCHEMAYEAR2010..MyTable<br />union</span><span style="font-family:courier;font-size:x-small;"><br />Select Name, Data, &#39;2011&#39; year
From SCHEMAYEAR2011..MyTable</span><span style="font-family:Verdana,Arial,Helvetica;"><span style="font-family:Verdana,Arial,Helvetica;color:midnightblue;font-size:x-small;"><span class="spnMessageText" id="msg"></span></span></span><br /></pre>
</span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 24, 2012</h2><p>Agreed. If the connection string varies based on the state of the object, then the object obviously needs to have a property with that state, so the DAL code can use that property value to find the right connection string for the object.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nj609eagle replied on Tuesday, January 24, 2012</h2><p>I wish that we would planned better 10 years ago for the multi years Curelow, but such is life.</p>
<p>ok, i&#39;m feeling really dumb right now, but how can i set the property of the object so that the DAL code is aware? outside of passing the &quot;key&quot; to each factory method?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 25, 2012</h2><p>Here&#39;s the thing. You need to decide on some specific criteria by which the data access code selects the right connection string.</p>
<p>You have told us that this is per-object. Therefore the criteria <em>must be a property of every object</em>, or the DAL must be able to infer the criteria based on existing properties of the object.</p>
<p>For fetch operations, it sounds like you now always have a compound key that includes the actual key value, plus a Year value (or whatever this other criteria might be). I discuss compound keys in the <em>Using CSLA 4</em> ebook series. The short version is that you can inherit from CriteriaBase to create a compound criteria class that you use to do fetch (and immediate delete) operations.</p>
<p>If all your objects have a common primary key type (like int or long or Guid) then you can create one compound criteria type and use it all over. If your objects have different primary key types, then you&#39;ll have to create different criteria types.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
