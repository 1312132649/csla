<html><header><title>Grandchild doesn’t get saved</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Grandchild doesn’t get saved</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1248.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan posted on Monday, September 18, 2006</h2><P class=MsoNormal><SPAN>In my application, I have a Project object that contains a collection of Department objects.<SPAN>&nbsp; </SPAN>I don’t encounter any problems saving any additions or modifications to a Department object as long as I don’t add/modify a Department’s children.<SPAN>&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Each Department object contains a collection of Drawing objects. <SPAN>&nbsp;</SPAN>If I add a new Drawing object, it shows up in the Drawings collection for the Department in which the Drawing object is being added; however, the new Drawing object doesn’t get persisted to the database in this case because the IsDirty property for the Department isn’t recognized as being true.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I’ve tried instantiating a new Drawing object two ways, but it doesn’t have any effect.<SPAN>&nbsp; </SPAN>In the first case, I instantiated it with the following code:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><FONT face=Tahoma>Library.Drawing aDwg = aProj.Department[1].Drawings.AddNew();<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN>In the second case, I instantiated it by first instantiating a Department object and then performing an AddNew as follows:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><FONT face=Tahoma><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Library.Department aDept = aProj.Department[1];<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><FONT face=Tahoma><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Library.Drawing aDwg = aDept.Drawings.AddNew();<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN>In both cases, I instantiate the proj object as follows:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><FONT face=Tahoma><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Library.Project aProj = Library.Project.GetProject{<SPAN>&nbsp; </SPAN>Guid for the project<SPAN>&nbsp; </SPAN>};<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>After adding the data for the new Drawing object, I attempt to save the whole thing by calling aProj.Save(), but it won’t save the changes since, as I mentioned, the aProj and aDept objects aren't recognized as being dirty.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>My question is why doesn’t the application recognize the Department object as being dirty when a child object is added to a collection contained within the Department object?<o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 18, 2006</h2>Did you override the IsDirty property in your parent object as described in Chapters 7 and 8? That is a requirement for any parent object.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Monday, September 18, 2006</h2><P><FONT face=Arial>I overrode it in the Project object thusly:</FONT></P>
<P><FONT face=Arial>public override bool IsDirty<BR>{<BR>&nbsp;&nbsp;&nbsp;get { return base.IsDirty || _department.IsDirty; }<BR>}</FONT></P>
<P><FONT face=Arial>and overrode it in the Department object thusly:</FONT></P>
<P><FONT face=Arial>public override bool IsDirty<BR>{<BR>&nbsp;&nbsp;&nbsp;get { return base.IsDirty || _drawing.IsDirty; }<BR>}</FONT></P>
<P><FONT face=Arial>While iterating through the child objects in the BusinessListBase class, it returns true for IsDirty when it gets to the new Drawing object, but it returns false for IsDirty the last time through and that's what gets passed back to the overridden IsDirty property in the parent Project object.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 18, 2006</h2>I don't have a good picture of your object relationships. But BLB returns IsDirty=true if any of its child objects are dirty. A parent should use a BLB to manage its children, so the parent should ask the collection if any of the children are dirty.<br><br>In other words, your code is "right", except it doesn't look like you are asking the child collection if it is dirty - you are asking some singular object - and that seems like a bug.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
