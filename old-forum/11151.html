<html><header><title>WCF Web API and Csla.ApplicationContextUser</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WCF Web API and Csla.ApplicationContextUser</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11151.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mattruma posted on Monday, February 13, 2012</h2><p>I am in the process of creating a RESTful service layer leveraging the WCF Web API and I just need some clarification and/or confirmation that the Csla.ApplicationContextUser will not change during the method call. </p>
<p>An example of one of my methods looks like:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [WebInvoke(UriTemplate = &quot;workspace?token={token}&quot;, Method = &quot;PUT&quot;)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public HttpResponseMessage&lt;WorkspaceEditData&gt; UpdateWorkspace(string token, WorkspaceEditData data)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthenticationHelper.ValidateToken(token);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthenticationHelper.Login(token);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var workspaceEdit = WorkspaceEdit.FetchWorkspaceEdit(data.WorkspaceId);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; workspaceEdit.Description = data.Description;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; workspaceEdit.Name = data.Name;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (workspaceEdit.IsValid)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; workspaceEdit = workspaceEdit.Save();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var workspaceData = new WorkspaceEditData(workspaceEdit);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthenticationHelper.Logout();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new HttpResponseMessage&lt;WorkspaceEditData&gt;(workspaceData);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Will the user that is logged in via my method that does a LoadPrincipal based on the token/username ... be the same throughout the method call?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, February 13, 2012</h2><p>Once the User property is set it won&#39;t change unless your code changes it.</p>
<p>On a web server, the User property value is actually stored in HttpContext, and ASP.NET manages the context object to ensure it is consistent throughout the life of the web request.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 13, 2012</h2><p>I should say, however, that WCF does have its own pipeline. In the <em>Using CSLA 3.0</em> ebook I have a chapter discussing some of the deeper behaviors that occur if you get fully into the WCF authentication process.</p>
<p>Your code doesn&#39;t appear to be running inside their authn process though - it appears to be running in the service implementation. Once <em>your</em> method has been invoked all the complex/nasty stuff has already occurred :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mattruma replied on Monday, February 13, 2012</h2><p>Thanks Rocky! Appreciate the feedback!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
