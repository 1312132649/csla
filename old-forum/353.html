<html><header><title>Question About Undoing A Child Object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Question About Undoing A Child Object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/353.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay posted on Monday, June 12, 2006</h2><P>Sorry for plastering this board with questions.&nbsp; I am trying to learn this stuff and don't know anyone who has worked with CSLA.</P>
<P>I am having trouble getting the undo functionality to work with a child object, everything else works fine.&nbsp; I wondering if this this not supported, or if I am screwing up the implementation, or if I am just doing it totally wrong.</P>
<P>I have a Driver object who has a Car object as a child.&nbsp; The situation I am working through now is where someone is editing the Driver (they can change his Car to be a different Car from a list of cars).</P>
<P class=MsoNormal><SPAN>Dim</SPAN><SPAN> carlist <SPAN>As</SPAN> Cars = Cars.GetCarsList()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>'*** test some undo stuff<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>Dim</SPAN><SPAN> d <SPAN>As</SPAN> Driver = Driver.GetDriver(3)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>MsgBox(d.Car.ToString)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>d.BeginEdit()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>d.Car = carlist.item(10) <SPAN>'*** change to a new car<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN>d.CancelEdit()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>MsgBox(d.Car.ToString) <SPAN>'*** should be the same as earlier</SPAN></SPAN></P>
<P>
<P>The 2 msgboxs should show the same value right?&nbsp; But the second one shows the name of the new car.</P>
<P>&nbsp;</P></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, June 13, 2006</h2>Is car a child object of driver? what is Cars? a name value list? a readonly collection?<br><br>By the looks of it it seems as if Car where a child object of Driver. All Child objects or child collections should be exposed as readonly... replacing them with another object could shield unexpected results such as what you're seeing right now. You should be changing a value inside the property that indicates a change of car. This will mark the child object dirty and thus it'll be saved. With your approach you're replacing a child object and noone knows that there was a change.<br>Also, Undo doesn't work because internally, the object that you set as car was never part of the undo, so it doesn't contain undo information.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Tuesday, June 13, 2006</h2><P>Xal, thanks for writing back.</P>
<P>I'm getting closer, but maybe I am still designing it wrong.</P>
<P>To answer your question: the way I had it was Car was a child of Driver accessible through a property (read/write).&nbsp; Cars was a BusinessListBase inherited collection of "Car".</P>
<P>Because Car didn't inherited from BusinessBase and not ReadOnlyBase, it implemented IUndoableObject, so when the Driver was taking a snapshot of itself it wouldn't include the Car, instead it would tell the Car to take a snapshot of itself at that moment, which doesn't matter if I later replace that Car object with another Car.</P>
<P>So I changed my code to use a CarInfo class that is a ReadOnlyBase and things seem to be working, but based on your comments I am wondering if my Driver should have a read/write Car child object at all.</P>
<P>Right now, the way it is working is, Driver has a child Car object of type CarInfo.&nbsp; To edit the Driver I databind CarList, a collectoin of CarInfo, to a dropdown and bind the dropdown to my Driver.Car object based on Car.ToString = combobox.text.</P>
<P>When creating the drive I debated on if I should have a child Car object or just have CarId, CarModelName, CarBrandName properties on the Driver.</P>
<P>If I would have done that, I think databinding would have been easier b/c I could have used a combobox bound to a NameValueList instead of a ReadOnlyList.&nbsp; What do you think?</P>
<P>You also said that child objects should be exposed as readonly and that I should be changing another value that indicates a change in car?</P>
<P>I could do this by having a readonly Car property and a read/write CarId property, and do all my databinding on CarId.&nbsp; The only problem with this is that I would need to fetch a new Car every time CarId was changed right, because if someone changed the dropdown and CarId went from 10 to 11, then the Car child object would be incorrect at that moment, as it would be the Car with an Id of 10, not 11, so I would need to hit the database again to get the correct car.</P>
<P>Is this the approach I should be following?&nbsp; Or should I not even bother carrying around a Car object, and just carry the CarId, CarModelName, and CarBrandName on my Driver object?</P>
<P>This is the other post I have talking about this which might give more insight into what I am trying to do.&nbsp; <A HREF="/forums/thread/1634.aspx">http://forums.lhotka.net/forums/thread/1634.aspx</A></P>
<P>Again thanks so much!</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, June 13, 2006</h2>It is very important that child objects are exposed as readonly.<br>One of the main reasons is the way you're handling persistance.<br>For starters, if you have a Car property that is actually of type CarInfo (your readonly object), then your child is not handling it's own update. So you're breaking a rule:<br>Child objects should handle their own persistance. Otherwise the parent acquires the responsability to persist the child and then you get into an ugly mess.<br>So, if you expose the child as read write, and then replace it, you can't rely on your child's IsNew and IsDirty, because you can't really know when and where the object was created.<br>So, you can:<br>-Expose just car properties in the root<br>-Have a child and bind your controls to yourBo.Child.Child_Value. You'll need to be able to update the other properties of your child when you update the value (which can be a name or an id, or whatever you use). So you can:<br>1) Have a cached list of cars that you can use to refresh the children's readonly properties (like car name, type, whatever).<br>2) Have a Public Sub ChangeCar(ByVal newCar as CarInfo). Inside it you can update the whole child by absorving the values exposed in CarInfo.<br><br>The most important thing is that you clearly define the responsability of each object. If you still want to update the driver's car data in the root's update, then there's no point in having a child object... which by the sound of it, is probably where you want to go because the car child only needs to persist the relation between car and driver. <br>If the child also has other responsabilities, like setting the colour and the type of seats and wheels and whatever, then having a child is probably best because otherwise the root will have a very large responsability.<br><br>I hope this clarifies matters for you. <br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Tuesday, June 13, 2006</h2><P>Thanks Xal!</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
