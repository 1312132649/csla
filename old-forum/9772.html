<html><header><title>Child object INSERT fails with Foreign Key Constraint violation, but why?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child object INSERT fails with Foreign Key Constraint violation, but why?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9772.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>loch006 posted on Tuesday, November 16, 2010</h2><p>I have an object structure that looks like this (using CSLA 4.0.1)</p>
<p>Entity<br />--- ProcessList (of Process objects)<br />------ProcessAccountList (list of ProcessAccount objects)<br />----------SystemData object (single child, all ProcessAccount objects have one instance of SystemData)</p>
<p>&nbsp;</p>
<p>The Entity insert goes fine, FieldManager.UpdateChildren() is called on Entity which causes the &nbsp;the list (currently with one Process object) to fire off Child_Insert(), which succeeds and then calls its own FieldManager.UpdateChildren(). That in turn triggers a Child_Insert on the list of ProcessAccount objects (currently only one in the list) and that insert succeeds as well.</p>
<p>I call FieldManager.UpdateChildren() on the ProcessAccount&#39;s Child_Insert() method which triggers Child_Insert() on the SystemData object. That INSERT fails saying the ProcessAccountId from the parent object (ProccessAccount) does not yet exist.</p>
<p>&nbsp;</p>
<p>I&#39;ve checked my parameters and verified the constraints on relationships in the database are ok. Why would this be failing?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>xAvailx replied on Tuesday, November 16, 2010</h2><p>Setup a sql profile trace and find out what is getting sent over to the db. That may help you narrow down the issue..</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>loch006 replied on Tuesday, November 16, 2010</h2><p>i am setting up the trace now and will post back with my findings</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>loch006 replied on Tuesday, November 16, 2010</h2><p>thanks Avail, the trace actually helped a lot</p>
<p>after running it and watching the error codes come back after a certain SP executes i went back and checked out the way the foreign key was setup and sure enough,&nbsp;a relationship was pointing to the wrong key, which at that point wouldn&#39;t yet exist and is not part of the standard update chain based on the object graph</p>
<p>thanks again!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
