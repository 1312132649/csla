<html><header><title>How do you bind your combo boxes?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How do you bind your combo boxes?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8653.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Friday, March 12, 2010</h2><p>Part I</p>
<p>In the begining I did what I suppose is the usual.</p>
<p>My business objects exposed a StatusID property and a StatusNVL decoded the ID into a proper name.</p>
<p>In the .Designer.cs</p>
<p>this.StatusComboBox.DataBindings.Add(new System.Windows.Forms.Binding(&quot;SelectedValue&quot;, this.ObjBindingSource, &quot;StatusID&quot;, true));<br />this.StatusComboBox.DataSource = this.StatusNVLBindingSource;<br />this.StatusComboBox.DisplayMember = &quot;Value&quot;;<br />this.StatusComboBox.ValueMember = &quot;Key&quot;;</p>
<p>and also</p>
<p>this.StatusNVLBindingSource.DataSource = typeof(Store.BO.StatusNVL);<br />this.BindingSourceRefresh.SetReadValuesOnChange(this.StatusNVLBindingSource, true);</p>
<p>and in the code file</p>
<p>public ObjEdit(Obj obj)<br />{<br />&nbsp;&nbsp;&nbsp; InitializeComponent();<br />&nbsp;&nbsp;&nbsp; // store object reference<br />&nbsp;&nbsp;&nbsp; ThisObj = obj; // obj is the business object<br />&nbsp;&nbsp;&nbsp; StatusNVLBindingSource.DataSource = StatusNVL.GetNVL();<br />&nbsp;&nbsp;&nbsp; ...<br />}</p>
<p>private void BindUI(bool rebinding)<br />{<br />&nbsp;&nbsp;&nbsp; ThisObj.BeginEdit();<br />&nbsp;&nbsp;&nbsp; ObjBindingSource.DataSource = ThisObj;<br />&nbsp;&nbsp;&nbsp; StatusComboBox.SelectedValue = ThisObj.StatusID;<br />&nbsp;&nbsp;&nbsp; ...<br />}</p>
<p>and that was it.</p>
<p>This solution is just fine. Your users drop down a list and click on one of the items of the drop down. Just like the combo box example you can see on PTracker.</p>
<p>Now let&#39;s add auto complete. And add also an ErrorProvider so you can tell your users what&#39;s wrong.</p>
<p>In the .Designer.cs file add</p>
<p>this.StatusComboBox.AutoCompleteMode = System.Windows.Forms.AutoCompleteMode.SuggestAppend;<br />this.StatusComboBox.AutoCompleteSource = System.Windows.Forms.AutoCompleteSource.ListItems;</p>
<p>Now your troubles begin... as your users insist on doing the wrong things:<br />- they type whatever they want and that doesn&#39;t match any name in the NameValueList<br />- they leave the combo box empty and that doesn&#39;t match any name in the NVL for sure</p>
<p>Worst: the ErrorProvider doesn&#39;t show any error at all. Of course you can handle a couple of combobox events and trigger some error to show up with the nice red mark. Or you can create an extra Binding that handles Format and Parse events. But then again, wasn&#39;t this all about keeping it simple and writing less code?</p>
<p>Part II</p>
<p>So I went the other road. Although storing a private _statusID fields, my business object no longer exposes the status ID but just a Status property that is the decoded status name.</p>
<p>So the .Designer.cs file looks like this</p>
<p>this.StatusComboBox.AutoCompleteMode = System.Windows.Forms.AutoCompleteMode.SuggestAppend;<br />this.StatusComboBox.AutoCompleteSource = System.Windows.Forms.AutoCompleteSource.ListItems;<br />// notice &quot;Text&quot; instead of &quot;SelectedValue&quot; and &quot;Status&quot; instead of &quot;StatusID&quot;<br />this.StatusComboBox.DataBindings.Add(new System.Windows.Forms.Binding(&quot;Text&quot;, this.ObjBindingSource, &quot;Status&quot;, true));<br />this.StatusComboBox.DataSource = this.StatusNVLBindingSource;<br />this.StatusComboBox.DisplayMember = &quot;Value&quot;;<br />this.StatusComboBox.ValueMember = &quot;Key&quot;;</p>
<p>and also</p>
<p>this.StatusNVLBindingSource.DataSource = typeof(Store.BO.StatusNVL);<br />this.BindingSourceRefresh.SetReadValuesOnChange(this.StatusNVLBindingSource, true);</p>
<p>and the code file looks like this</p>
<p>public ObjEdit(Obj obj)<br />{<br />&nbsp;&nbsp;&nbsp; InitializeComponent();<br />&nbsp;&nbsp;&nbsp; // store object reference<br />&nbsp;&nbsp;&nbsp; ThisObj = obj; // obj is the business object<br />&nbsp;&nbsp;&nbsp; StatusNVLBindingSource.DataSource = StatusNVL.GetNVL();<br />&nbsp;&nbsp;&nbsp; ...<br />}</p>
<p>private void BindUI(bool rebinding)<br />{<br />&nbsp;&nbsp;&nbsp; ThisObj.BeginEdit();<br />&nbsp;&nbsp;&nbsp; ObjBindingSource.DataSource = ThisObj;<br />&nbsp;&nbsp;&nbsp; // notice Text instead of SelectedValue and Status instead of StatusID<br />&nbsp;&nbsp;&nbsp; StatusComboBox.Text = ThisObj.Status;<br />&nbsp;&nbsp;&nbsp; ...<br />}</p>
<p>But what about the red thing of the error provider? The question is all about validation. And that&#39;s a BO thing. So let&#39;s write a NameValueList validator that checks if the Status name converts to an existing StatusID. If it doesn&#39;t, just return false with the appropriate message and your ErrorProvider will show the red bullet.</p>
<p>using System;<br />using Csla;<br />using Csla.Core;<br />using Csla.Validation;</p>
<p>namespace Store.BO<br />{<br />&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Implements NameValueList business rules.<br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; public static class NameValueListRules<br />&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Rule ensuring a name exists on a NameValueList.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;target&quot;&gt;Object containing the data to validate&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;e&quot;&gt;Arguments parameter specifying the name of the <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// property and the Value name to validates.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;returns&gt;&lt;see langword=&quot;false&quot; /&gt; if the rule is broken&lt;/returns&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;remarks&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// This implementation uses late binding, and will only work<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// against a NameValueList where Key is of type int and Value is of type string.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// The property to validate must be the Value member of the NameValueList.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/remarks&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static bool NameValidation(object target, RuleArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var args = (DecoratedRuleArgs)e;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var nameValueList = (NameValueListBase&lt;Int32, String&gt;)args[&quot;NameValueList&quot;];</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var value = (string)Utilities.CallByName(target, e.PropertyName, CallType.Get);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (nameValueList.Key(value) &gt; 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = String.Format(Properties.Resources.ValidNameRequired, RuleArgs.GetPropertyName(e));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Custom &lt;see cref=&quot;RuleArgs&quot; /&gt; object required by the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;see cref=&quot;NameValidation&quot; /&gt; rule method.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public class NameRuleArgs : DecoratedRuleArgs<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Get the NameValueList to be used on the validation..<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public NameValueListBase&lt;Int32, String&gt; NameValueList<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return (NameValueListBase&lt;Int32, String&gt;) this[&quot;NameValueList&quot;]; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Create a new object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;propertyName&quot;&gt;Name of the property to validate.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;nameValueList&quot;&gt;NameValueList to be used on the validation.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public NameRuleArgs(string propertyName, NameValueListBase&lt;Int32, String&gt; nameValueList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(propertyName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this[&quot;NameValueList&quot;] = nameValueList;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Create a new object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;propertyInfo&quot;&gt;PropertyInfo for the property to validate.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;nameValueList&quot;&gt;NameValueList to be used on the validation.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public NameRuleArgs(IPropertyInfo propertyInfo, NameValueListBase&lt;Int32, String&gt; nameValueList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(propertyInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this[&quot;NameValueList&quot;] = nameValueList;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Create a new object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;propertyName&quot;&gt;Name of the property to validate.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;friendlyName&quot;&gt;A friendly name for the property, which<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// will be used in place of the property name when<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// creating the broken rule description string.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;nameValueList&quot;&gt;NameValueList to be used on the validation.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public NameRuleArgs(string propertyName, string friendlyName, NameValueListBase&lt;Int32, String&gt; nameValueList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(propertyName, friendlyName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this[&quot;NameValueList&quot;] = nameValueList;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p>Using this validator goes like this:</p>
<p>protected override void AddBusinessRules()<br />{<br />&nbsp;&nbsp;&nbsp; ValidationRules.AddRule&lt;Obj&gt;(NameValueListRules.NameValidation,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new NameValueListRules.NameRuleArgs(StatusIDProperty, StatusNVL.GetNVL()));<br />}</p>
<p>And the part where the BO converts the Status property into a _statusID private field (that is stored in the database)?</p>
<p>It goes like this:</p>
<p>a) in the old CSLA 3.0.5 syntax</p>
<p>private int _statusID;<br />public string Status<br />{<br />&nbsp;&nbsp;&nbsp; get<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(&quot;Status&quot;, true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return StatusNVL.GetNVL().Value(_statusID);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; set<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanWriteProperty(&quot;Status&quot;, true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var convertedValue = StatusNVL.GetNVL().Key(value);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_statusID != convertedValue)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _statusID = convertedValue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged(&quot;Status&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p>b) using the latest syntax</p>
<p>private static readonly PropertyInfo&lt;int&gt; StatusIDProperty = RegisterProperty(new PropertyInfo&lt;int&gt;(&quot;Status&quot;, &quot;status&quot;, -1));<br />public string Status<br />{<br />&nbsp;&nbsp;&nbsp; get { return StatusNVL.GetNVL().Value(GetProperty(StatusIDProperty)); }<br />&nbsp;&nbsp;&nbsp; set { SetPropertyConvert(StatusIDProperty, StatusNVL.GetNVL().Key(value)); }<br />}</p>
<p>Note - You can use the included code as you want -.copy, sell, resell, lend or even rent.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
