<html><header><title>Newbie - Foreign key, combox and databinding</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Newbie - Foreign key, combox and databinding</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/373.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner posted on Wednesday, June 14, 2006</h2><P>Hi,</P>
<P>I'm not sure if this CSLA related or not, apologies if it's nothing CSLA specific. I did search this and the old forum.</P>
<P>Can someone either explain, or point me to a link that shows how to use comboboxes when binding to business objects? My main BO has a foreign key and I'd like to show the description of the FK in a combobox for the user to choose.</P>
<P>I think I'm thinking data-centric, but not sure how to properly set this up. Right now I'm thinking of iterating through a NameValueListBase class I have and populating the combobox like that.</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, June 14, 2006</h2>Michael,<br>You can fill the combobox with a namevaluelist like:<br>cbo.DataSource=yourNVL<br>cbo.DisplayMember = "Value"<br>cbo.ValueMember = "Key"<br><br>You can then bind your bo's property to cbo.SelectedValue<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, June 14, 2006</h2><P>Ok, I don't think I follow. I guess I don't know how to bind my bo's property to cbo.SelectedValue.</P>
<P>I created a data source that is bound to a BusinessListBase class. So this holds the collection of my BusinessBase&nbsp;objects I want to edit. I changed the data source from DataGridView to Details, then drug that onto the form. Now I have a bunch of labels and text boxes on my form.</P>
<P>I tried to do this:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.defaultGalleryFKTextBox.DataBindings.Clear();</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.defaultGalleryFKTextBox.DataBindings.Add(</FONT><FONT color=#800000 size=2>"Text"</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.galleryNameValueListComboBox, </FONT><FONT color=#800000 size=2>"SelectedValue"</FONT><FONT size=2>);</FONT></P>
<P><FONT size=2>When I change the combobox value, I can see the value in my text box change, but it's not behaving as I'd like. Specifically, it's not saving the changes when I do .Save, and it doesn't remember the values as I navigate through the child records. The second issue makes sense to me, but not sure what to do about it yet.</FONT></P>
<P><FONT size=2>Do you mind explaining how to bind my bo's property to cbo.SelectedValue?</FONT></P>
<P><FONT size=2>Thanks,</FONT></P>
<P><FONT size=2>Mike</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, June 14, 2006</h2>I see. The first problem is that you dragged the Navigation control to the form directly. This isn't the actual problem, the problem is that you left all your exposed properties (in the datasources window) marked as if they should use a textbox.<br>What you should do is select a combobox for that specific property we're talking about. Thus, you get rid of the intermediate textbox. This will also automatically add bindings for SelectedValue.<br>What you can do now is remove that specific textbox, change the property to use a combobox and drag that combobox to the form.<br><br>At this point all you need to do is attach the namevaluelist to your combo box.<br><br><br>About your seccond issue: Do you see your property set being called? did you set a breakpoint there? Did you tab off the combobox?<br>How exactly are you saving your object?<br>.Save doesn't save the actual object, it rather returns a new object with a saved state.<br><br>We usually approach save like (I don't actually do this for every object, I have a base form that handles this for me):<br><br>Dim mClone As YourType = yourObject.Clone<br>Try<br>&nbsp;&nbsp;&nbsp; mClone = mClone.Save<br>&nbsp;&nbsp;&nbsp; yourObject = mClone<br>Catch<br>&nbsp;&nbsp;&nbsp; do whatever... like show a messagebox<br>End<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, June 14, 2006</h2><P>Andrés,</P>
<P>I'm laughing at myself. Maybe it's just one of those days. When you say "all you need to do is attach the namevaluelist to your combo box", what do you mean? Not sure if I should populate it manually from the NVL&nbsp;or if there's some data binding thing I don't get.</P>
<P>I understand what you're saying about the saving, thinking I should wait on that one.</P>
<P>Once again, thanks.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, June 14, 2006</h2>Oh, sorry.<br>I'm assumed you had that working from the previous post.<br><br>I suppose you already created a NameValueList that contains the IDs and descriptions (or names) for your allowed values (that will be foreign key). Btw, I wish you posted your object's name and the same for the property and namevaluelist. But i'll make you an example.<br><br>Suppose you have a person object. It exposes a Documentation type property.<br>The possible values are 1 and 2. <br>1 being the value for Passport and 2 for driver's license.<br>So you create a name value list (we'll name it "DocumentTypeNVL") that contains:<br>Key&nbsp;&nbsp;&nbsp;&nbsp; Value<br>1&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  Passport<br>2&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  Driver's license<br><br><br>Your person object exposes a DocumentTypeId property which should be assigned either 1 or 2.<br><br>Create an instance of the name value list and bind it to your combobox like:<br>Dim mDocTypes as DocumentTypeNVL = DocumentTypeNVL.GetDocumentTypeNVL()<br><br>Fill your combobox like this:<br>cboDocType.DataSource = mDocTypes<br>cboDocType.DisplayMember = "Value"<br>cboDocType.ValueMember = "Key"<br><br>Note: This can be done with binding sources too, so you can also create a binding source for your namevaluelist and handle all this binding in the forms designer.<br><br>Now:<br>If you dragged the combo from the datasources list, it's SelectedValue property should already be bound to your object's DocumentTypeId property. That should be it.<br><br>I hope it's a little more clear...<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, June 14, 2006</h2><P>Interesting, when I drag the combo box over from the data sources, the .SelectedValue is set to "(none)" - this is under the (DataBindings) node. When I click on the down arrow to try to select something, I get a VS message box that says "Object reference not set to an instance of an object." I wonder if something is up with my VS.</P>
<P>I tried to add it via code like:</P><FONT color=#0000ff size=2>
<P>this</FONT><FONT size=2>.defaultGalleryFKComboBox.DataBindings.Add(</FONT><FONT color=#800000 size=2>"SelectedValue"</FONT><FONT size=2>, employeeEditableRootListBindingSource, </FONT><FONT color=#800000 size=2>"DefaultGalleryFK"</FONT><FONT size=2>);</P></FONT>
<P>I guess that's the right syntax, as it runs. However, I can't tab off my combo box. It will only accept a valid Guid (which is my foreign key type), so when there's a string in there, it doesn't like it.</P>
<P>Do you see something obvious I'm missing? I might try to reinstall VS.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdubious replied on Wednesday, June 14, 2006</h2><P>This is a painful issue, but easy to solve.</P>
<P>Dragging the field from the DataSources window by default binds the TEXT property of the combobox to the Property of your object.&nbsp; In your NameValue list situation, you 'd want to bind the SelectedValue of the combobox to the Value property of your NameValue List.&nbsp; In the designer, clear out the TEXT property under databindings, and set the SelectedValue property.&nbsp; If the designer isn't allowing that, I'd try it from scratch on a new form.</P>
<P>Then, use XAL's code below to populate the ComboBox with data</P>
<P>I assume your familiar with DisplayMember and ValueMember properties of a combobox.&nbsp; You set the DisplayMember equal to the string name of the&nbsp;property of the object in the list that is used as the ComboBoxes datasource.&nbsp; If you don't set this, the ComboBox calls .ToString on the item in the list.&nbsp; Then, the ValueMember is set to the&nbsp;string name of the property to use as the Value of each item.</P>
<P>cbo.DataSource=yourNVL<BR>cbo.DisplayMember = "Value"<BR>cbo.ValueMember = "Key"<BR></P>
<P>Then, after the box is populated, set the BindingSource's DataSource property to the Editable business object you're binding to in the first place.</P>
<P>&nbsp;</P>
<P>Kevin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Thursday, June 15, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>kdubious:</strong></div><div>
<P>Dragging the field from the DataSources window by default binds the TEXT property of the combobox to the Property of your object.&nbsp; In your NameValue list situation, you 'd want to bind the SelectedValue of the combobox to the Value property of your NameValue List.&nbsp; In the designer, clear out the TEXT property under databindings, and set the SelectedValue property.</P>
<P></div></BLOCKQUOTE></P>
<P>Thanks Kevin! Spot on. I searched all over the place yesterday and couldn't find anywhere that said that.</P>
<P>Regards,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Friday, June 16, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Michael Hildner:</strong></div><div>
<P>Interesting, when I drag the combo box over from the data sources, the .SelectedValue is set to "(none)" - this is under the (DataBindings) node. When I click on the down arrow to try to select something, I get a VS message box that says "Object reference not set to an instance of an object." I wonder if something is up with my VS.</P>
<P></div></BLOCKQUOTE></P>
<P>Just in case this happens to anyone else. You'll get this error if you have an invalid data source. For example, if you set up a data source off of you BO, then change the namespace of your BO. Whoops. Deleting the invalid data source fixes the problem.</P>
<P>Mike</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
