<html><header><title>Silverlight MVVM with multiple regions, windows, tabs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight MVVM with multiple regions, windows, tabs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9420.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnFry posted on Monday, August 23, 2010</h2><div><span style="font-size:x-small;">
<p>After spending a couple of months playing with MVVM and thinking that what I wanted to do was combine CSLA with an MVVM framework, I have come to the conclusion that:</p>
<p>1. Many available MVVM Frameworks require more plumbing code to make them work than is needed to implement the Models (Business Objects) - they are just too complex; </p>
<p>2. The CSLA ViewModel/Model makes the development of MVVM-Ready business objects easy, and provides so much functionalilty that it makes a lot of that provided by MVVM Frameworks redundant;</p>
<p>3. CSLA combined with BXF is just beautiful in its simplicity, and works a treat at least for simple scenarios;</p>
<p>That is not to say that the various MVVM Frameworks don&#39;t incorporate some neat stuff that&#39;s worth stealing - they do.However, I&#39;ve decided that CSLA/BXF is for me and it saves learning yet another complicated Framework.</p>
<p>Where I am struggling a little with my decision is in handling more complex UI scenarios, particlarly those involving multiple regions on the Main Page, Child Windows or Tabs. Getting these to display is simple using a &quot;MainPagePresenter&quot; (as in BXF sample) - the problem comes when I want to close/clear a Window or Tab. Conventional wisdom (as expressed in this forum) is that the UI triggers a Close Method of the ViewModel along the lines of:</p>
<p>public void Close()</p>
<p>{</p>
<p>Presenter.Instance.ShowView(null, null, null, &quot;Content&quot;);</p>
<p>}</p>
<p>That&#39;s fine if there is only one display region (&quot;Content&quot;), but as the ViewModel has no knowledge of the View or where/how it is displayed this clearly can&#39;t work for a complex scenario. Additionally, it may be that the ViewModel or the Application decides that the View(Model) should be closed - perhaps as part of a clean shutdown - and I need to cater for that.</p>
<p>My thought is that this issue is primarily a shortcoming of ViewModel&lt;T&gt;. I say shortcoming only after a lot of thought, because ViewModel&lt;T&gt; should obviously be Framework independent. However, I don&#39;t think that this independence would be compromised by adding as standard to ViewModel&lt;T&gt;:</p>
<ul>
<li>A &quot;Close&quot; method that fires an event;</li>
<li>An interface defining a method that can be called to ask the View Model to clean itself up (e.g. ask User via pop-up if changes should be saved) and then &quot;Close&quot;. This is similar to the MVVM Light ICleanup.</li>
</ul>
<p>I&#39;ve tried &quot;hardcoding&quot; this into a couple of ViewModels and implementing a crude StateManager in &quot;MainPagePresenter&quot; that keeps track of what is displayed where and handles the &quot;Close&quot; event. It seems to work, but not being an accomplished .NET programmer I&#39;m worried that this is too simplistic to be robust in real life - ot even whether it is the best approach. (So wouldn&#39;t it be great if Rocky solved it for me?).</p>
<p>Would appreciate hearing any thoughts that others may have about this.</p>
</span></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 23, 2010</h2><p>My approach has been to create a subclass of ViewModel&lt;T&gt; in my projects, so I can add UI-specific behaviors that are still generalized across all my viewmodels.</p>
<p>For example, I almost always override OnError/OnRefreshed/OnSaved/Save in order to do status updates. There&#39;s no sense doing this in every viewmodel class, so I move it to this project-specific base class.</p>
<p>Your Close concept seems like something that would be comparable and should go in the same place.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Tuesday, August 24, 2010</h2><p>I&#39;ve still been having troubles with window closing.&nbsp; I&#39;ve been able to call a Closing Method on a ViewModel using a trigger such as below, but I&#39;m not able to Cancel the close.&nbsp; How can I get into the Windows Closing method to change the cancel event arg?</p>
<p><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">csla</span><span style="COLOR:blue;">:</span><span style="COLOR:#a31515;">TriggerAction</span>&nbsp;<span style="COLOR:red;">&nbsp;Name</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;trgWindowClosing&quot;</span><span style="COLOR:red;">&nbsp;TriggerEvent</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;Closing&quot;</span>&nbsp;<span style="COLOR:red;">&nbsp;Height</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;0&quot;</span><span style="COLOR:red;">&nbsp;Width</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;0&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:red;">&nbsp;TargetControl</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">Binding</span><span style="COLOR:red;">&nbsp;RelativeSource</span><span style="COLOR:blue;">={</span><span style="COLOR:#a31515;">RelativeSource</span><span style="COLOR:red;">&nbsp;FindAncestor</span><span style="COLOR:blue;">,</span><span style="COLOR:red;">&nbsp;AncestorType</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">Window</span><span style="COLOR:blue;">,</span><span style="COLOR:red;">&nbsp;AncestorLevel</span><span style="COLOR:blue;">=</span>1<span style="COLOR:blue;">}}</span><span style="COLOR:blue;">&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:red;">&nbsp;MethodName</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;WindowClosing&quot;</span><span style="COLOR:blue;">/&gt;</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 24, 2010</h2><p>So you are talking about an actual Window? Not a usercontrol in a region?</p>
<p>Hmm, not something I typically do, or have thought of a whole lot.</p>
<p><i>BUT</i>, consider that TriggerAction invokes a method, and that method can have 0 or 2 parameters. If it has 2 parameters, the second parameter is an ExecuteArgs parameter, and <i>that</i> has a property which should give you a reference to the original EventArgs object generated by the event.</p>
<p>That EventArgs object should have a Cancel property (if you cast it correctly), and it is the same object instance, so if you set Cancel = true that should work?</p>
<p>All speculation on my part...</p>
<p>And note that this technically violates the purity of your MVVM model because your viewmodel becomes aware of a UI-specific type (the eventargs sublcass). However, the only options I can think of right now involve either code-behind (bad) or what I&#39;m suggesting here (not quite as bad).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Tuesday, August 24, 2010</h2><p>I threw together a quick test.&nbsp; I&#39;m able to get the arg and set it, but to no effect, the window still closes even if I set the arg to true <img src="http://forums.lhotka.net/emoticons/emotion-6.gif" alt="Sad" />.&nbsp; I&#39;ve stepped through and verified that it is setting the property correctly.&nbsp; I then added an actual WindowClosing method to the window.&nbsp; It looks like the WindowClosing method of the window runs and completes before the WindowClosing in the Model, so I&#39;m changing the property after the fact.</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;WindowClosing(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;Csla.Xaml.<span style="color:#2b91af;">ExecuteEventArgs</span>&nbsp;e)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.ComponentModel.<span style="color:#2b91af;">CancelEventArgs</span>&nbsp;arg&nbsp;=&nbsp;e.TriggerParameter&nbsp;<span style="color:blue;">as</span>&nbsp;System.ComponentModel.<span style="color:#2b91af;">CancelEventArgs</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(arg&nbsp;!=&nbsp;<span style="color:blue;">null</span>&nbsp;&amp;&amp;&nbsp;Model.IsDirty)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//setting&nbsp;to&nbsp;true&nbsp;for&nbsp;testing</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg.Cancel&nbsp;=&nbsp;<span style="color:blue;">true</span>;<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">MessageBoxResult</span>&nbsp;results&nbsp;=&nbsp;<span style="color:#2b91af;">MessageBox</span>.Show(<span style="color:#a31515;">&quot;You&nbsp;have&nbsp;changes&nbsp;that&nbsp;you&nbsp;haven&#39;t&nbsp;saved.&nbsp;&nbsp;Do&nbsp;you&nbsp;wish&nbsp;to&nbsp;continue&nbsp;and&nbsp;lose&nbsp;them?&quot;</span>,&nbsp;<span style="color:#a31515;">&quot;Lose&nbsp;Changes&quot;</span>,&nbsp;<span style="color:#2b91af;">MessageBoxButton</span>.YesNo);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(results&nbsp;==&nbsp;<span style="color:#2b91af;">MessageBoxResult</span>.No)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg.Cancel&nbsp;=&nbsp;<span style="color:blue;">true</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, August 25, 2010</h2><p>This is a head scratcher.&nbsp; I run it today and it&#39;s working now without changing any code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 25, 2010</h2><p>Beats me, but it sure should work - that args object is the same one that&#39;s being provided and handled by the event.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
