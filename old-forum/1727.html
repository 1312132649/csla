<html><header><title>Binding Source EndEdit calls Dataportal_Update</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Binding Source EndEdit calls Dataportal_Update</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1727.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>billa1972 posted on Thursday, November 09, 2006</h2><P>Hi,</P>
<P>First, I have an EditableRootCollection of users.&nbsp; I show that on a readonly grid and when i double click a row a modal form opens up to edit the specific user.</P>
<P>i think have read all the correct ways to save if you are using windows data binding...IE: apply changes via the binding source object.&nbsp; But when i call EndEdit, and i have a break point on my user dataportal_update&nbsp;method, and that get's called...This is before i hit the clone line of code.</P>
<P>Any one else experiencing this?&nbsp; Am i doing this correctly with EditRootCollection?</P>
<P>Thanks for any help</P>
<P><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Save()</P>
<P></FONT><FONT size=2>bindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>False<BR></FONT><FONT size=2>bindingSource</FONT><FONT size=2>.EndEdit()&nbsp; &lt;- - this calls the Save on the object, and&nbsp;thus the&nbsp;dataportal_update method</P>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> temp </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> User = m</FONT><FONT size=2>User.Clone</P>
<P></FONT><FONT color=#0000ff size=2>Try</FONT></P>
<P><FONT color=#0000ff size=2>m</FONT><FONT size=2>User = temp.Save</P>
<P></FONT><FONT color=#0000ff size=2>Catch</FONT><FONT size=2> ex </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Exception</P>
<P></FONT><FONT color=#0000ff size=2>Throw</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Finally</P></FONT><FONT size=2>
<P></FONT><FONT size=2>bindingSource</FONT><FONT size=2>.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>True<BR></FONT><FONT size=2>bindingSource</FONT><FONT size=2>.ResetBindings(</FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Try</P></FONT><FONT size=2>
<P></P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>billa1972 replied on Thursday, November 09, 2006</h2><P>Update:</P>
<P>Ok, after stepping through the code, this is&nbsp;what happens:</P>
<P>1) When you call EndEdit on binding source, that ends up calling AcceptChangesComplete on the businessbase (core) </P>
<P>2) This ends up doing a check to see if parent is something and if so calls parent.ApplyEditChild.&nbsp; </P>
<P>3) So if parent is EditableRootListBase, then SaveItem is called from ApplyEditChild.&nbsp; </P>
<P>4) SaveItem calls this code: Me.Item(index) = DirectCast(item.Save, T).&nbsp; Note the Save. This calls dataportal_update.</P>
<P>So, the question is:&nbsp; Am I doing this correctly?&nbsp; How should I present the EditableRootListBase collection in the UI?&nbsp; Or should I?</P>
<P>Thanks again.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, November 09, 2006</h2>That behavior is pretty much by design.&nbsp; If you don't want it, subclasss BusinessListBase.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, November 09, 2006</h2>Hey billa1972,<br><br>Unfortunately I don't have a EditableRootList in my current project, but the following is the save routine that is inherited by all my views:<br><br><br>&nbsp;&nbsp;&nbsp; Protected Overridable Function SaveObject(ByVal rebind As Boolean) As Boolean<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.View.SuspendEvents()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim success As Boolean = False<br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim temp As TObject = Me.BusinessObject.Clone<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp.ApplyEdit()<br></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me._BusinessObject = temp.Save<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rebind Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.View.Rebind()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success = True<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Csla.DataPortalException<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error saving", MessageBoxButtons.OK, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error saving", MessageBoxButtons.OK, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.View.ResumeEvents()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return success<br><br>&nbsp;&nbsp;&nbsp; End Function<br><br><br><br>Notice that I apply the edit _on the clone_, in contrast to your snippet where you apply the edit (EndEdit) on the bindingsource. I really have no clue if this would resolve your issue, but in a way it looks just as if it might.<br><br>Regards,<br>Bayu<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
