<html><header><title>Error in CslaQueryProvider when getting max date from a businesslistbase?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Error in CslaQueryProvider when getting max date from a businesslistbase?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5576.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shawndewet posted on Monday, October 13, 2008</h2><P>Hi I'm using the following line of code to get the maximum date from a businesslistbase collection:</P><FONT size=2>
<P>dtMaxJobStartDate = oJob.MyWipJobAllMatCollection.Max(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Function</FONT></FONT><FONT size=2>(m) (m.SupplyDate))</P></FONT>
<P>But I get the following exception at runtime:</P>
<P>System.ArgumentException: The type or method has 2 generic parameter(s), but 1 generic argument(s) were provided. A generic argument must be provided for each generic parameter..</P>
<P>This is the Stack Trace:</P>
<P>System.RuntimeType.SanityCheckGenericArguments(Type[] genericArguments, Type[] genericParamters)<BR><STRONG>System.Reflection.RuntimeMethodInfo.MakeGenericMethod(Type[] methodInstantiation)<BR>Execute(Expression expression) in D:\PI Custom\CSLA\CSLA35\cslavb-3.5.1-080804\cslavb\Csla\Linq\CslaQueryProvider.vb: line 261<BR>Execute[TResult](Expression expression) in D:\PI Custom\CSLA\CSLA35\cslavb-3.5.1-080804\cslavb\Csla\Linq\CslaQueryProvider.vb: line 198<BR>TResult](IQueryable`1 source, Expression`1 selector)<BR></STRONG>TestSetJobStartAndEndDate(WipMaster&amp; oJob, InvWarehouseCollection oATPQueriedInvWarehouseRecords) in ...</P>
<P>Can anyone advise where I should look? Am I doing something wrong?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Tuesday, October 14, 2008</h2>This might have been fixed with the latest CSLA patch.  There was an issue where we were not carrying over the right number of generic parameters in our call to Queryable.Max inside the CslaQueryProvider, that has been fixed as of 3.5.2.<br /><br />I have added the following unit test to my private build (should hit prod in a week), which passes:<br /><br />    [TestMethod]<br />    public void TestMaxWithParameter()<br />    {<br />      CollectionExtendingIQueryable random = new CollectionExtendingIQueryable();<br /><br />      random.Add(new RandomThing(45));<br />      random.Add(new RandomThing(65));<br /><br />      var max = random.Max(x => x.SomeVal);<br /><br />      Assert.IsTrue(max == 65);<br />    }<br /><br />This is C#, but as far as I know, it is roughly equivalent to what you are doing.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shawndewet replied on Monday, October 20, 2008</h2><P>And so I immediately downloaded v3.5.2 and cleaned and rebuilt my solution, but the test still fails with the same error:</P>
<P>Test method TestUIP.SupportingServicesTest.TestUpdateJobDatesFromATPNonStockedJob threw exception:&nbsp; System.ArgumentException: The type or method has 2 generic parameter(s), but 1 generic argument(s) were provided. A generic argument must be provided for each generic parameter..</P>
<P>The stack trace has changed slightly to indicate the file paths to the v3.5.2 csla files...</P>
<P>System.RuntimeType.SanityCheckGenericArguments(Type[] genericArguments, Type[] genericParamters)<BR><STRONG>System.Reflection.RuntimeMethodInfo.MakeGenericMethod(Type[] methodInstantiation)<BR>Execute(Expression expression) in D:\PI Custom\CSLA\CSLA35\cslavb-3.5.2-081009\cslavb\Csla\Linq\CslaQueryProvider.vb: line 261<BR>Execute[TResult](Expression expression) in D:\PI Custom\CSLA\CSLA35\cslavb-3.5.2-081009\cslavb\Csla\Linq\CslaQueryProvider.vb: line 198<BR></STRONG>TResult](IQueryable`1 source, Expression`1 selector)<BR>UIP.SupportingServices.SetJobStartAndEndDate(WipMaster&amp; oJob, InvWarehouseCollection oATPQueriedInvWarehouseRecords) in d:\PI Custom\UIP\Services\UpdateJobDates.vb: line 65<BR>UIP.SupportingServices.UpdateJobDeliveryDatesFromATPQuery(WipMasterCollection&amp; oJobs, InvWarehouseCollection oATPQueriedInvWarehouseRecords, Boolean blnPostToSyspro) in d:\PI Custom\UIP\Services\UpdateJobDates.vb: line 16<BR>TestUIP.SupportingServicesTest.TestUpdateJobDatesFromATPNonStockedJob() in D:\PI Custom\TestUIP\UpdateJobDateFromATPQueryTest.vb: line 88</P>
<P>&nbsp;</P>
<P>Any other ideas? Is there perhaps something wrong with the line of code I'm using to extract the max date value?<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Monday, October 20, 2008</h2>I will take a look at this first thing in the morning.&nbsp; Wondering if VB (horror of horrors) is causing a difference.<br><br>Will also make double sure there isn't some other overload of Max involved here.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Monday, October 20, 2008</h2>Real quick question - SupplyDate does not happen to be Nullable, does it?<br><br>Not that it should matter, but I noticed that there are special nullable&lt;T&gt; overloads of Max that may be involved here.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Tuesday, October 21, 2008</h2>Ok, I was able to recreate the issue with a date.  Found a subtle problem with the generic parameterizing in LINQ to CSLA.  Issue is fixed in the latest bits for the CSLA 3.6 branch.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
