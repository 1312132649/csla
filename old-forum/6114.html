<html><header><title>Saving a single record using DataPortal_Update</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Saving a single record using DataPortal_Update</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6114.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brownpa1 posted on Friday, January 09, 2009</h2><P>Using DataPortal_Update on a BusinessListBase,&nbsp;how can I save and close&nbsp;just a single&nbsp;child object&nbsp;that is within the collection without saving all other records?</P>
<P>I want the user to be able to save and close a single child in the collection without effecting the other members of the collection.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, January 09, 2009</h2><P>I'd argue that CSLA was not really intended to work this way and you should ask yourself why you want to do this, especially if this list is itself&nbsp;a child of another object. </P>
<P>That being said, I'm sure it's possible, especially if you have derived your own BusinessListBase class and have written your own save code. One possibility would be to somehow clone the object to be saved (and have it not be a child), and just explicitly save the clone and then update list object afterwards. </P>
<P>A list which does allow saving of individual members is the EditableRootListBase. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames replied on Saturday, January 10, 2009</h2><P>This is an example on how I do it:</P>
<P>I have a public class KontoList : BusinessListBase&lt;KontoList, KontoChild&gt;</P>
<P>containing the following methods:</P>
<P><FONT face="Courier New" size=2>#region SaveUpdated</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp; public void SaveUpdated(KontoList kontoList)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp; // Get a list of the child object which needs to be created/updated/deleted<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT face="Courier New" size=2>BusinessObjects.Finans.KontoList KontoplanSave = kontoList.GetListToSave();</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; // Create, update and delete&nbsp;objects<BR>&nbsp;&nbsp;&nbsp; KontoplanSave = KontoplanSave.Save();</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; // Update List with&nbsp;created/updated/deleted objects<BR>&nbsp;&nbsp;&nbsp; kontoList.SetListAfterSave(KontoplanSave);</FONT><FONT face="Courier New" size=2><BR>&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;private KontoList GetListToSave()<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp; // Create Empty KontoList object to contain created/updated/deleted child objects<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT face="Courier New" size=2>KontoList SaveKontoList = NewKontoList();</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; //&nbsp;Add created/updated child objects<BR>&nbsp;&nbsp;&nbsp; foreach (KontoChild child in this)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child.IsSavable)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SaveKontoList.Add(child);</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; //&nbsp;Add deleted child objects<BR>&nbsp;&nbsp;&nbsp; foreach (KontoChild deletedChild in DeletedList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SaveKontoList.DeletedList.Add(deletedChild);</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; return SaveKontoList;<BR>&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;private void SetListAfterSave(KontoList savedList)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp; // Delete deleted child objects from the original List<BR>&nbsp;&nbsp;&nbsp; //&nbsp;Should be done first (can't remember why)<BR>&nbsp;&nbsp;&nbsp; foreach (KontoChild deletedChild in DeletedList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Remove(deletedChild);</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; // Update the original list with the saved child objects<BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT face="Courier New" size=2>foreach (KontoChild savedChild in savedList)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // KontoGuid is the unique child key&nbsp;property<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Index = IndexOf(GetChildByGuid(savedChild.KontoGuid));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this[Index] = savedChild.Clone();<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; // Delete the list containing the objects to be deleted as they have been deletd now<BR>&nbsp;&nbsp;&nbsp;&nbsp;DeletedList.Clear();<BR>&nbsp;&nbsp;}<BR><BR>&nbsp; public KontoChild GetChildByGuid(Guid kontoGuid)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp; // KontoGuid is the unique child key&nbsp;property&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; foreach(KontoChild child in this)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child.KontoGuid == kontoGuid)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return child;</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; return null;<BR>&nbsp;&nbsp;}<BR></FONT><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;#endregion // SaveUpdated</FONT></P>
<P>I then simply call <FONT face="Courier New" size=2>myKontoList.SaveUpdated(myKontoList); </FONT>to&nbsp;save the updated children.</P>
<P>At the moment I have the same code in all my List classes. <STRONG>If anyone knows if it's possible (and how) to move the code into a class derived from BusinessListBase I would be really happy.</STRONG> I have not yet succeeded in getting it to work.</P>
<P>Thanks,<BR>Jimmy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Saturday, January 10, 2009</h2><P>Wow!&nbsp; Seems pretty complicated for something that CSLA tries to manage for you.</P>
<P>The first question I'd ask is whether the item you are trying to save is the only one in the collection that is dirty.&nbsp; If it is, then no worries.&nbsp; The normal process used by the CSLA framework will only save/update items that are dirty.&nbsp; If not, then I'd ask why you are committing only one item when the collection contains others that are dirty?&nbsp; Perhaps you should be using editable child objects so that you can call Save directly on the item rather than saving the list.</P>
<P>For what it's worth,&nbsp;EditableRootListBase contains a SaveItem method that will allow you to save a specific item within the collection by index.&nbsp; You can also look at how this class uses the IsSavable flag to determine which items to save when the list is saved if you need an example.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames replied on Sunday, January 11, 2009</h2><P>I'm using the DataPortal and I want to avoid sending 10.000 rows over the wire when only updating 1-3 rows. My users need the data saved often&nbsp;(almost every row being updated)&nbsp;and not just when they leave the (Windows) form.</P>
<P>I do loop the whole collection looking for .IsSavable items which I add to a new collection which is the one being saved.</P>
<P>I actually haven't looked at EditableRootListBase which could be what I need. In the case of 2 or 3 rows needed update, I don't want to call the DataPortal 2-3 times.</P>
<P>Thanks,<BR>Jimmy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Sunday, January 11, 2009</h2><P>Yep, you're absolutely right.&nbsp; The two limitations I've found with the CSLA implementations are exactly as you described: you are either sending the entire collection of hundreds or thousands of rows of data acrosse the wire to the Data Portal Server where it is enumerated and changes applied; or, you end up with multiple calls through the data portal.</P>
<P>If you are looking for an immediate save when the changes are committed to each row, then I think either having an editable child so that you can Save the individual item or using the EditableRootListBase where you can tell the list to save the item works best.&nbsp; If your users are making changes to multiple items then saving the batch at once, I agree that working with a subset is totally applicable.</P>
<P>I think LINQ could be used to simplify your code, though.&nbsp; I recently had a similar use case and implemented a GetChanges() method that used a LINQ statement to return all items that were marked as dirty.&nbsp; You could easily extend this with an additional Where statement checking that the items are savable.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, January 12, 2009</h2>You may be interested in this <a HREF="/forums/thread/25777.aspx">thread</a>, specifically this <a HREF="/forums/post/25777.aspx">post</a> from Rocky.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
