<html><header><title>Custom Identity with Validation...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Identity with Validation...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2181.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic posted on Friday, January 19, 2007</h2><P>Am working on a site where members will need to activate their account before they can log in.<BR><BR>I've created my own custom identity (based on PTIdentity) by adding a new property: DateActivate.<BR><BR>I know I can just add a 'where' clause to check if the member is active in the db, but I would like to inform them that their account is inactive.<BR><BR>From what I've read, I need to make my Identity class inherit from BusinessBase instead of ReadOnlyBase, and add a rule to check that DateActive is not empty.&nbsp; <BR><BR>Since the private fields in my custom identity class would be populated in the fetch method, how would I trigger the error checking?<BR><BR>I'm hoping I'm going about it the right way.&nbsp; Would appreciate someone's input.<BR><BR>Thanks,<BR><BR>- Andy<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, January 20, 2007</h2>In your DP_Fetch() method, after you've loaded your fields you can just call ValidationRules.CheckRules() to check all the rules for the object.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Sunday, January 28, 2007</h2><P><FONT face=Verdana size=2>Rocky,</FONT></P>
<P><FONT face=Verdana size=2>Did like you suggested and my validation methods get called, but I do not get any exceptions raised even after my methods return false.</FONT></P>
<P><FONT face=Verdana size=2>As fas as I know, I do not need to raise the exception myself, but I might be wrong.</FONT></P>
<P><FONT face=Verdana size=2>Here is what I have:<BR></FONT><BR><FONT face=Verdana size=2>&nbsp;&nbsp;&nbsp; Public Class CommunityIdentity<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Inherits ReadOnlyBase(Of CommunityIdentity)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of CommunityIdentity)</FONT></P>
<P><BR><FONT face=Verdana size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub AddBusinessRules()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule(Of CommunityIdentity)(AddressOf AccountNotDeleted, "DateDeleted", 10)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</FONT></P>
<P><FONT face=Verdana size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Shared Function AccountNotDeleted(Of T As CommunityIdentity)(ByVal target As T, ByVal e As Validation.RuleArgs) As Boolean<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not (target.DateDeleted.IsEmpty) Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = My.Resources.MemberAccount_Deleted<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<BR></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 29, 2007</h2><P>Where are you expecting an exception? CheckRules() doesn't throw exceptions, it just puts the object into an invalid state if any rules are broken. You'd only get an exception when calling Save() on your root object. Save() throws a ValidationException if the object is in an invalid state.</P>
<P>Review Chapter 3 for more details on how this works. Or Chapters 9 and 10 to see how the validation rules are used in Windows and Web UIs.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Monday, January 29, 2007</h2><P>Rocky,</P>
<P>I will review chapter 3, but based on your explanation and examples I think I understand how it works.</P>
<P>What I would like to happen is that when I set the values from the db to my object if the member has been marked as deleted in the db, that I would get an exception, which I can then pass up to the principal class and then to the gui.&nbsp; Would I need the Get method to check the object that was fetched and raise an exception if is invalid???<BR><BR>On a similiar note, there will be several times when I need to validate input information (the username) before I query a member.&nbsp; I would like to call a Get factory method and get an exception raised if the username is not of valid format.&nbsp; Would I need to raise my own exception since I would not be calling Save()?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 29, 2007</h2>




<DIV align=left><SPAN class=084041817-29012007><FONT face=Arial color=#0000ff size=2>In both your examples you'll need to throw your own 
exceptions.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=084041817-29012007><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=084041817-29012007><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Monday, January 29, 2007</h2>Thank you very much!!!<BR><BR>In the factory methods where I check the validity of input parameters I'll simply check their format and throw my own exception if invalid.<BR><BR>In the case of the Identity, where the values from the database tell me if the member is invalid, I will populate my object then call ValidationRules.CheckRules() to make the object invalid.&nbsp; <BR><BR>I can then check in the calling GetIdentity factory method to see if it is invalid.&nbsp; I can then throw an exception if invalid and check its BrokenRulesCollection for the exact reason why it's not valid.<BR><BR>Thank you!<BR><BR>- Andy</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
