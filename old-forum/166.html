<html><header><title>Binding errors disposing forms?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Binding errors disposing forms?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/166.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, May 22, 2006</h2>Hi all,<br><br>I'm having a weird problem.<br><br>I have two NameValueList classes, and each list is accessed as a Singleton.<br><br>I bind each list to the DataSource of a ComboBox.&nbsp; I also bind the ComboBox's text property to a BO string property.<br><br>When the BO is saved, my data code checks the list.&nbsp; If the value the user typed in the combo box does not exist in the singleton list, some data code fires to insert the new item and get the new id back for the item.&nbsp; The data code then calls an internal method to add this new item to the static list.<br><br>Everything works fine.&nbsp; The save returns, I check the Singleton lists and the new values are there.&nbsp; the problem is when the form closes, and starts Disposing controls.&nbsp; I get this message:<br><br>Message: ArgumentException: Cannot bind to the property or column State on the DataSource.<br>Parameter name: dataMember<br><br>State is the name of the propery on my BO.&nbsp; The DataSource is bound to a BindingSource, who's datasource is the singleton list.<br><br>Here's a stack trace:<br>tack trace:&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindToObject.CheckBinding()<br>&nbsp;&nbsp; at System.Windows.Forms.BindToObject.SetBindingManagerBase(BindingManagerBase lManager)<br>&nbsp;&nbsp; at System.Windows.Forms.Binding.SetListManager(BindingManagerBase bindingManagerBase)<br>&nbsp;&nbsp; at System.Windows.Forms.ListManagerBindingsCollection.AddCore(Binding dataBinding)<br>&nbsp;&nbsp; at System.Windows.Forms.BindingsCollection.Add(Binding binding)<br>&nbsp;&nbsp; at System.Windows.Forms.BindingContext.UpdateBinding(BindingContext newBindingContext, Binding binding)<br>&nbsp;&nbsp; at System.Windows.Forms.Control.UpdateBindings()<br>&nbsp;&nbsp; at System.Windows.Forms.Control.OnBindingContextChanged(EventArgs e)<br>&nbsp;&nbsp; at System.Windows.Forms.ListControl.OnBindingContextChanged(EventArgs e)<br>&nbsp;&nbsp; at System.Windows.Forms.Control.CreateControl()<br>&nbsp;&nbsp; at System.Windows.Forms.Control.RecreateHandleCore()<br>&nbsp;&nbsp; at System.Windows.Forms.ComboBox.RecreateHandleCore()<br>&nbsp;&nbsp; at System.Windows.Forms.ComboBox.SetAutoComplete(Boolean reset, Boolean recreate)<br>&nbsp;&nbsp; at System.Windows.Forms.ComboBox.ObjectCollection.ClearInternal()<br>&nbsp;&nbsp; at System.Windows.Forms.ComboBox.OnDataSourceChanged(EventArgs e)<br>&nbsp;&nbsp; at System.Windows.Forms.ListControl.SetDataConnection(Object newDataSource, BindingMemberInfo newDisplayMember, Boolean force)<br>&nbsp;&nbsp; at System.Windows.Forms.ListControl.DataSourceDisposed(Object sender, EventArgs e)<br>&nbsp;&nbsp; at System.ComponentModel.Component.Dispose(Boolean disposing)<br>&nbsp;&nbsp; at System.Windows.Forms.BindingSource.Dispose(Boolean disposing)<br>&nbsp;&nbsp; at System.ComponentModel.Component.Dispose()<br>&nbsp;&nbsp; at System.ComponentModel.Container.Dispose(Boolean disposing)<br>&nbsp;&nbsp; at System.ComponentModel.Container.Dispose()<br>&nbsp;&nbsp; at MedAssociates.MedSales.ContactEditForm.Dispose(Boolean disposing) in C:\source\MedSales\MedSales\ContactEditForm.Designer.cs:line 14<br>&nbsp;&nbsp; at System.ComponentModel.Component.Dispose()<br>&nbsp;&nbsp; at System.Windows.Forms.Form.WmClose(Message&amp; m)<br>&nbsp;&nbsp; at System.Windows.Forms.Form.WndProc(Message&amp; m)<br>&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br>&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br>&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br>Source: System.Windows.Forms<br><br>Any ideas?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, May 22, 2006</h2><span id="lblHTML">In CSLA 1.52 I inherited SWF.Form and SWF.UserControl and added this:<br><br>		protected override void <font class="BackLite">Dispose</font>(bool disposing)<br>		{<br>&nbsp;&nbsp;&nbsp; if(disposing)<br>			&nbsp;&nbsp;&nbsp; {<br>				&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Release managed resources<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Utilities.ClearBindings(this);<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; base.<font class="BackLite">Dispose</font> (disposing);<br>		}<br><br>which calls this:<br><br><br>		/// <br>		/// Clears all databindings from the control and all child controls.<br>		/// <br>		/// The control from which to clear the databindings.<br>		public static void ClearBindings(Control control)<br>		{<br>&nbsp;&nbsp;&nbsp; Binding[] bindings = new Binding[control.DataBindings.Count];<br>&nbsp;&nbsp;&nbsp; control.DataBindings.CopyTo(bindings, 0);<br>&nbsp;&nbsp;&nbsp; control.DataBindings.Clear();<br><br>&nbsp;&nbsp;&nbsp; foreach(Binding binding in bindings)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; TypeDescriptor.Refresh(binding.DataSource);<br><br>&nbsp;&nbsp;&nbsp; PropertyInfo dataSourceProperty = control.GetType().GetProperty("DataSource");<br>&nbsp;&nbsp;&nbsp; if(dataSourceProperty != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; dataSourceProperty.SetValue(control, null, new object[] {});<br><br>&nbsp;&nbsp;&nbsp; foreach(Control child in control.Controls)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ClearBindings(child);<br>		}<br><br>You may want to do something similar (basically clearing all databinding on Dispose()).<br></span></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, May 23, 2006</h2>Hey,<br><br>That seems to have worked.<br><br>I added this to the Dispose override:<br><br>// .Net 2.0<br>CountryComboBox.DataBindings.Clear();<br>StateComboBox.DataBindings.Clear();<br><br>Thanks for the tip; this is an odd error though.&nbsp; It only seems to affects the ComboBoxes bound to the NameValueLists AND the Text property is databound.<br><br>Anyway, thanks for the tip!<br><br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
