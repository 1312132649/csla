<html><header><title>Exception catches in CSLA</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Exception catches in CSLA</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5242.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sixeyes posted on Thursday, August 14, 2008</h2>Rocky,<br><br>My boss has just spent several hours trying to track down the source of an exception which only occurs on his machine. The exception stacktrace didn't report the location of the initial exception. If this error had occurred at a customer we've not got much to go on in the reported exception<br><br>I would like to know why CSLA doesn't wrap the caught exception. <br><br>I thought wrapping the caught exception was standard .NET behaviour?<br><br>Iain<br><font face="Courier New" size="2"><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, August 14, 2008</h2><P>Out of curiosity, what type of exception was thrown? And are you sure you didn't rethrow it yourself(s) somewhere along the process and accidently loosing the stack trace?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sixeyes replied on Monday, August 18, 2008</h2>In the default CSLA v3.5.1 code I catch the following exception<br><br>--------------------------------------------------------------------------------<br><font face="Courier New" size="1">Exception Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.PropertyLoadException<br>Exception message:&nbsp;&nbsp;&nbsp; Property load or set failed for property Id (Validation rule rule://DoesDatabaseExistAndIsCorrectVersion/Id failed in property Id)<br>Exception stacktrace:<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.SetProperty[P](PropertyInfo`1 propertyInfo, P newValue, NoAccessBehavior noAccess) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Core\BusinessBase.cs:line 2152<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.SetProperty[P](PropertyInfo`1 propertyInfo, P newValue) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Core\BusinessBase.cs:line 2049<br>&nbsp;&nbsp; at Centurion.Marsc.Business.Data.Master.CurrentChildDatabase.set_Id(Int32 value) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Business\Data\Master\CurrentChildDatabase.cs:line 25<br>&nbsp;&nbsp; at Centurion.Marsc.Business.Data.Master.CurrentChildDatabase.DataPortal_Fetch(SingleCriteria`2 criteria) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Business\Data\Master\CurrentChildDatabase.cs:line 152<br>&nbsp;&nbsp; at dm(Object , Object[] )<br>&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Reflection\MethodCaller.cs:line 221<br></font>--------------------------------------------------------------------------------<br><br><br>However if I make sure that the exception caught in Csla\Core\BusinessBase:2152 actually wraps the caught exception I get the following exceptions reported<br><font face="Courier New" size="1"><br>--------------------------------------------------------------------------------<br>Exception Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.PropertyLoadException<br>Exception message:&nbsp;&nbsp;&nbsp; Property load or set failed for property Id (Validation rule rule://DoesDatabaseExistAndIsCorrectVersion/Id failed in property Id)<br>Exception stacktrace:<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.SetProperty[P](PropertyInfo`1 propertyInfo, P newValue, NoAccessBehavior noAccess) in g:\centurion\projects\marketing\3rdparty\cslacs\csla\core\BusinessBase.cs:line 2152<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.SetProperty[P](PropertyInfo`1 propertyInfo, P newValue) in g:\centurion\projects\marketing\3rdparty\cslacs\csla\core\BusinessBase.cs:line 2049<br>&nbsp;&nbsp; at Centurion.Marsc.Business.Data.Master.CurrentChildDatabase.set_Id(Int32 value) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Business\Data\Master\CurrentChildDatabase.cs:line 25<br>&nbsp;&nbsp; at Centurion.Marsc.Business.Data.Master.CurrentChildDatabase.DataPortal_Fetch(SingleCriteria`2 criteria) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Business\Data\Master\CurrentChildDatabase.cs:line 152<br>&nbsp;&nbsp; at dm(Object , Object[] )<br>&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Reflection\MethodCaller.cs:line 221<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ----------------------------------------<br><br>Exception Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Validation.ValidationException<br>Exception message:&nbsp;&nbsp;&nbsp; Validation rule rule://DoesDatabaseExistAndIsCorrectVersion/Id failed in property Id<br>Exception stacktrace:<br>&nbsp;&nbsp; at Csla.Validation.ValidationRules.CheckRules(List`1 list) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Validation\ValidationRules.cs:line 1011<br>&nbsp;&nbsp; at Csla.Validation.ValidationRules.CheckRules(String propertyName) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Validation\ValidationRules.cs:line 926<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.PropertyHasChanged(String propertyName) in g:\centurion\projects\marketing\3rdparty\cslacs\csla\core\BusinessBase.cs:line 285<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.LoadPropertyValue[P](PropertyInfo`1 propertyInfo, P oldValue, P newValue, Boolean markDirty) in g:\centurion\projects\marketing\3rdparty\cslacs\csla\core\BusinessBase.cs:line 2345<br>&nbsp;&nbsp; at Csla.Core.BusinessBase.SetProperty[P](PropertyInfo`1 propertyInfo, P newValue, NoAccessBehavior noAccess) in g:\centurion\projects\marketing\3rdparty\cslacs\csla\core\BusinessBase.cs:line 2148<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ----------------------------------------<br><br>Exception Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.ArgumentException<br>Exception message:&nbsp;&nbsp;&nbsp; Keyword not supported: 'fireflash\sql2005;user'.<br>Exception stacktrace:<br>&nbsp;&nbsp; at System.Data.Common.DbConnectionOptions.ParseInternal(Hashtable parsetable, String connectionString, Boolean buildChain, Hashtable synonyms, Boolean firstKey)<br>&nbsp;&nbsp; at System.Data.Common.DbConnectionOptions..ctor(String connectionString, Hashtable synonyms, Boolean useOdbcRules)<br>&nbsp;&nbsp; at System.Data.SqlClient.SqlConnectionString..ctor(String connectionString)<br>&nbsp;&nbsp; at System.Data.SqlClient.SqlConnectionFactory.CreateConnectionOptions(String connectionString, DbConnectionOptions previous)<br>&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionFactory.GetConnectionPoolGroup(String connectionString, DbConnectionPoolGroupOptions poolOptions, DbConnectionOptions&amp; userConnectionOptions)<br>&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ConnectionString_Set(String value)<br>&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.set_ConnectionString(String value)<br>&nbsp;&nbsp; at Centurion.Marsc.Data.DataAccess.MarscDataAccessBase..ctor(MarscConnectionInfo connectionInfo) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Data\DataAccess\MarscDataAccessBase.cs:line 26<br>&nbsp;&nbsp; at Centurion.Marsc.Data.DataAccess.MarscDataAccessSQL..ctor(MarscConnectionInfo dbConnectionInfo) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Data\DataAccess\MarscDataAccessSQL.cs:line 11<br>&nbsp;&nbsp; at Centurion.Marsc.Data.DataAccess.MarscDataAccessFactory.GetDataAccess(MarscConnectionInfo connectionInfo) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Data\MarscDataAccessFactory.cs:line 16<br>&nbsp;&nbsp; at Centurion.Marsc.Data.MarscDataLayer.SetChildConnectionInfo(Int32 databaseId) in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Data\MarscDataLayer.cs:line 430<br>&nbsp;&nbsp; at Centurion.Marsc.Business.Data.Master.ChildDatabaseVersion.DataPortal_Execute() in G:\Centurion\Projects\Marketing\Trunk\Centurion\Marsc\Business\Data\Master\ChildDatabaseVersion.cs:line 36<br>&nbsp;&nbsp; at dm(Object , Object[] )<br>&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in G:\Centurion\Projects\Marketing\3rdParty\cslacs\Csla\Reflection\MethodCaller.cs:line 221<br>--------------------------------------------------------------------------------<br><font face="Arial"><font size="3"><br>Fixing the problem was easy once the last exception was seen:<br><br></font></font></font><font face="Courier New" size="1">Exception Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.ArgumentException<br>
Exception message:&nbsp;&nbsp;&nbsp; Keyword not supported: 'fireflash\sql2005;user'.<br><br><font face="Arial"><font size="3">However this information is lost because it's not wrapped by the exception in Csla\Core\BusinessBase<br><br>Iain<br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 18, 2008</h2>Good catch.&nbsp; It looks like this is done on some other lines as well.&nbsp; The only issue I could see with wrapping the exception though is if it crosses the dataportal boundary.. if it's a remote server and the wrapped exception isn't Serializable, you won't get the exception.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sixeyes replied on Monday, August 18, 2008</h2>Good point. All my exceptions are marked Serializable as I had assumed they were being wrapped.<br><br>Perhaps we could have some handy code to check and only wrap remote exceptions if they're Serializable?<br><br>Iain<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 18, 2008</h2>Ya, I mark all of mine as well, but I think some in the .Net framework itself aren't marked as such.&nbsp; But it may not be an issue at all anyway, since SetProperty runs on the client AFAICT.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 19, 2008</h2><P>Added to list of bugs</P>
<P><A href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=90">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=90</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
