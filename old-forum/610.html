<html><header><title>OT: Database design question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT: Database design question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/610.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan posted on Thursday, July 13, 2006</h2><P>I received a signed contract today to rewrite an old dBase III/IV application that has been in use since 1991 at a large consulting engineering/project management firm.&nbsp; Having gone through the logic and the data tables in the existing product, I'm ready to begin design work using&nbsp;SQL Server 2005 for the back-end.&nbsp; The problem is I'm not really sure which is the best approach to take with it.</P>
<P>Currently, when a new project is entered into the system, an entry is made into a Projects table and four table templates are copied and renamed according to the Project ID.&nbsp; One table contains information pertaining to drawings for the project ; another one contains text describing the scope of the work to be done; a third table contains area descriptions for areas within the disciplines (Architectural, Foundation, Structural, Piping, etc.) involved in performing the work; and the fourth table contains departmental- and drawing-specific qualifications for the drawings.&nbsp; As new drawings are entered into the system, data is written to a&nbsp;system-wide Drawing table&nbsp;and at least three of the four copied tables.&nbsp; After a certain amount of time...just guessing here, but I believe it would be shortly after completion and final sign-off on the project...they can elect to archive the data for the project.&nbsp; This involves copying those four tables that were created from the templates onto a floppy disk, setting the Archived field for that project to True in the Projects table, and deleting the tables from the directory on the file server; the project can be restored by reversing the operation.</P>
<P>My first thought was to keep the database down to five or six tables and using the&nbsp;DwgInfo, Scope, Areas and Qualifications&nbsp;tables for all the projects; I quickly rejected that due to the enormous task in removing data from those tables when a project is archived.&nbsp; I&nbsp;next thought about approaching this by simply adding additional tables to the Projects database as new projects were created and then using SQL Server's bcopy function to copy the data in/out of the tables when the project was being archived/restored.&nbsp; My third option is to create an entirely new database for each project entered into the system and using the TransactionalDataPortal to keep everything in sync; in that case, I could tell SQL Server to detach the database when it's to be archived and make calls to the System.Io namespace to handle copying the database to another location.&nbsp; The only problem I see with the third option is having to write all the SQL code to handle creating a new database, creating the tables and indices for it, and creating all the stored procs to operate on the data within the new database.</P>
<P>Any opinions on which would be the best option?</P>
<P>Allen B. Anderson</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, July 13, 2006</h2><P>Archiving the data in an MDF file may be a bad idea, because it's tied to a specific version of SqlServer.&nbsp; Depending upon when they need to restore it, it may not be possible.&nbsp; They may have lost their SqlServer 2005 CD and SqlServer 2011 may not be able to read it...</P>
<P>Using separate MDF files for the live system is also problematic when it comes to cross-project reporting.&nbsp; </P>
<P>From your comments, I'm guessing that each project may have LOTS of data?&nbsp; Have you looked into using the&nbsp;partitioning tables option in the database?&nbsp; It's like having separate tables in the same table.&nbsp; I've used it very handily in an Oracle environment and SqlServer 2005 appears to have implemented the core functionality.&nbsp; Will be testing it in the next month, but can't say for sure whether it's up to snuff or not.&nbsp; Of course, you would need to automate the creation of the table partitions, but that shouldn't be too hard.</P>
<P>Other than the volume of data (which is what I'm guessing your comment about archiving being an enormous task refers to), what's the big deal about archiving out the data into xml or comma-delimited files?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Thursday, July 13, 2006</h2><P>David,</P>
<P>Thanks for your response.&nbsp; I hadn't thought of partitioning the tables until I read your post.&nbsp; It sounds like a super idea except that it can only be performed in the Developer Edition or the Enterprise Edition.&nbsp; I seriously doubt I can get them to spring for&nbsp;a minimum of USD $24,000+/- for a copy of the Enterprise Edition and I don't want to recommend using the Developer Edition as that would be a violation of Microsoft's licensing for the product.&nbsp; My choice of database for them is the Express Edition as it should be able to easily handle all the data the dBase system has been handling.&nbsp; Perhaps I could use MySQL as it has the ability to partition tables; the only question there is whether or not MySQL Connector works with .NET 2.0.</P>
<P>I did some more delving into using bcopy with SQL Server as mentioned in my original post and see that MS added a SqlBulkCopy class to .NET 2.0.&nbsp; Unfortunately, it only permits bulk copying of data INTO SQL Server and not from SQL Server to other formats.</P>
<P>Maybe the best thing to do is revisit my first option and keeping the database down to five or six tables.&nbsp; That thought occurred to me after reading your last sentence...simply execute a "SELECT ...&nbsp;USING XML AUTO", writing the results out to a disk file, and then executing another SQL command to delete the records for that particular project.&nbsp; I'll have to do some exploring, but it may be that I can then use the new SqlBulkCopy class to restore the project data into the database should the need arise.</P>
<P>Thanks again for your response!&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>Allen B. Anderson</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 13, 2006</h2>I think you'll find that 'archiving' would be best achevied by creating a flag column on the relevent tables (project level, i'd think) and simply filtered on 'unarchived' projects by default.&nbsp;&nbsp; Be sure to put an index on that column as well as any others which would be appropriate.<br><br>Sql server can handle quite a bit of data in its tables before you need to physically seperate the data for performance reasons.&nbsp; I don't think I've come across any project which required me to do so.<br><br>Just my $0.02.<br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
