<html><header><title>BrokenRules Problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BrokenRules Problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/811.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mking posted on Thursday, August 03, 2006</h2><P>I have a problem where the validation rules are not being inforced when inserting a new record.&nbsp; They are being enforced properly when I update an existing record.</P>
<P>I'm using the CslaDataSource, a DetailsView control, and the Csla.Data.DataMapper object.&nbsp; My business object is an EditableRoot (within an EditableRootList).&nbsp; I'm using CodeSmith and the templates someone on this forum (thanks!) created.</P>
<P>When I put a breakpoint in in the IsValid function within BusinessBase.cs, I see that the ValidationRules collection is present with the right number of rules, and I see all the property values in my object as empty strings (violations of&nbsp;my rules) but the BrokenRulesCollection is empty and IsValid is true.&nbsp; What do I need to do to force it to re-check the rules?</P>
<P>Another question I have is:&nbsp;can I get the Validation rules to contain error messages that are more meaningful to the user?&nbsp; I'm using a function that was in the sample code I downloaded.&nbsp; It loops through the broken rules and populates the red ErrorLabel.&nbsp; I'd like to be able to specify a better message when I create the rule.&nbsp; Instead of "<FONT color=#ff0000>* VenID: VenID can not be less than 1".&nbsp; </FONT><FONT color=#000000>I'd like it to say "Please choose a Venue".&nbsp; (Maybe the wording of error messages isn't meant to be in the BO layer?)</FONT></P>
<P>Thanks in advance for any help with this.&nbsp; -Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, August 03, 2006</h2>For your first problem, just call ValidationRules.CheckRules() inside DataPortal_Create().<br>For your second problem, just write your own rule that handles that...<br><br>Public Function ValidateID(Byval target as Object, ByVal e as RuleArgs) As Boolean<br>If VenID = 0 Then<br>e.Description = "Please choose a value"<br>Return False<br>End If<br>Return True<br>End Function<br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mking replied on Friday, August 04, 2006</h2><P>Thanks Andrés.&nbsp; You pointed me in the right direction and saved me a lot of time.</P>
<P>I caused&nbsp;my first problem by&nbsp;changing a line of&nbsp;code in NewEvent() (my business object is called Event) from </P><FONT color=#0000ff size=2>
<P>return</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>DataPortal</FONT><FONT size=2>.Create&lt;</FONT><FONT color=#008080 size=2>Event</FONT><FONT size=2>&gt;(</FONT><FONT size=2>);</FONT></P>
<P><FONT size=2>to</FONT></P><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>return</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>new</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>Event</FONT><FONT size=2><FONT color=#000000>();</FONT></FONT></P>
<P><FONT color=#000000><FONT size=3>I made this change because I was getting the error "Invalid Operation - create not allowed" and I wasn't really understanding what that error meant.&nbsp; I see now that my CodeSmith generated code was not passing the Criteria object to DataPortal_Create, which was expecting it.&nbsp; Now, the line of code looks like this (and it seems to work)</FONT></FONT></P><FONT color=#000000 size=3><FONT color=#0000ff size=2>
<P>return</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>DataPortal</FONT><FONT size=2>.Create&lt;</FONT><FONT color=#008080 size=2>Event</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Criteria</FONT><FONT size=2>(0, 0));</FONT></P>
<P><FONT size=2>------------------------</FONT></P>
<P><FONT size=2><FONT size=3>For my second problem, I'm assuming I can add the ValidateID rule you&nbsp;posted&nbsp;to the ValidationsRules collection in the BO?</FONT></FONT></FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, August 04, 2006</h2>Yes, that's the standard way for creating rules...<br>You'd then have to override the AddBusinessRules() method and call:<br><br>ValidationRules.AddRule(AddressOf methodName, "PropertyName")<br><br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mking replied on Friday, August 04, 2006</h2><P>Got it working.&nbsp; Thanks for explaining that to me.</P>
<P>-Mike</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
