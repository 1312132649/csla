<html><header><title>CSLA 4.0 Beta 2 BusinessBase Error Handling Problem?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4.0 Beta 2 BusinessBase Error Handling Problem?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9079.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SWITCH posted on Monday, June 14, 2010</h2><p>Hi there!</p>
<p>I recently came across a problem (which I admit that I caused by accidentally binding the PropertyStatus control to an unregistered property on my Business Object)&nbsp;which has exposed some questionable error handling logic&nbsp;in the changes introduced in the <em>BusinessBase.cs</em> class in the new CSLA 4.0 Beta 2 Framework (in Silverlight). </p>
<p>In the <em>CanReadProperty(...) methods (</em>and<em> CanWriteProperty(...)&nbsp; methods) </em>in the <em>BusinessBase </em>class, if the <em>propertyName</em> is not found in the collection of registered properties, calling <em>First() </em>will throw an exception and the next line of code (the null reference check) will never be evaluated. The calling method <em>HandleTarget() </em>in the <em>PropertyStatus.cs </em>class also doesn&#39;t catch this exception which makes it a bit tricky to diagnose so I thought I would point it out. I haven&#39;t dug into this very deep but perhaps calling <em>FirstOrDefault()</em> would be a better way to attempt to retrieve the <em>PropertyInfo</em> object from the <em>FieldManager</em>?<br /><br /><strong>Example:<br /><br /></strong><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">bool</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CanReadProperty(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">string</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> propertyName)<br />{<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp; var</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> prop = FieldManager.GetRegisteredProperties().Where(c =&gt; c.Name ==&nbsp;propertyName).<strong><span style="text-decoration:underline;">First()</span></strong>; <strong>// Throws an exception!<br /></strong></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp; if</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> (prop == </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">null</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">)<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp; &nbsp; throw</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ArgumentOutOfRangeException</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">&quot;propertyName&quot;</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">);<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&nbsp; return</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CanReadProperty(prop);<br />}</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 14, 2010</h2><p>Thank you - that is clearly a mistake, and it was intended to be FirstOrDefault.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>bniemyjski replied on Monday, June 14, 2010</h2><p>
<p>Hello,</p>
<p>This has been fixed in the latest nightly build.</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SWITCH replied on Friday, June 18, 2010</h2><p>Glad I could help! Keep up the great work! I&#39;m just getting into CSLA 4.0 but I&#39;m loving the new changes!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
