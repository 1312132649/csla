<html><header><title>Generics, shared factory methods, mustinherit base classes and constructors</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Generics, shared factory methods, mustinherit base classes and constructors</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3616.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian posted on Friday, September 28, 2007</h2>Hi all. I've been using csla for a little bit now and I feel I'm getting better at it. I still have a hard time wrapping my head around "behavior centric" thinking. I'm still not sure I completely get it. It never seems quite right. I continue to read and push on in the mean time.<br><br>Anyway I have a bunch of read only lookup type classes with exactly the same fields and behaviors. Basically the only things different are the names of the objects and the sprocs used to populate them. I'm trying to move all that code into a base class because right now it's all just repeated a bunch of times with different names.<br><br>I'm trying to create&nbsp; a read only base, read only collection and read only list for each of them. So here's what I've done. Be warned that this is very long because I want you to have all of the relevant code. I apologize for the length.<br><br>I don't think highlighting is going to work like I want it to so if this comes out a bit difficult to read I apologize for that as well.<br><br>I've made some base classes that work great, such as:<br><font size="1"><br></font><font color="#000080" size="3"><font size="1">Namespace Base<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public MustInherit Class LookupListBase(Of T As LookupListBase(Of T))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits NameValueListBase(Of Integer, String)<br><br>#Region " Declarations "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected mCommandText As String<br><br>#End Region<br><br>#Region " Business Methods "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Shared Function DefaultLookup() As Integer<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim list As T = GetList()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If list.Count &gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return list.Items(0).Key<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New NullReferenceException( _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "No lookups available; default lookup can not be returned")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>#End Region<br><br>#Region " Factory Methods "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Shared mList As T<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Shared Function GetList() As T<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mList Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mList = DataPortal.Fetch(Of T) _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (New Criteria(GetType(T)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mList<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' Clears the in-memory SampleTypeList cache<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' so the list of sample types is reloaded on<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' next request.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Shared Sub InvalidateCache()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mList = Nothing<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Sub New()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' require use of factory methods<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>#Region " Data Access "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New SqlConnection(Database.Connection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = mCommandText<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New SafeDataReader(cm.ExecuteReader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; While .Read()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Add(New NameValuePair( _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .GetInt32("Id"), .GetString("Name")))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End While<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = True<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace</font><br></font><br>This one seems like it's going to work just great.<br><br>Then there's this one:<br><br><font size="1">Namespace Base<br><br>&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' This is the base class from which basic cached readonly lookup collections<br>&nbsp;&nbsp;&nbsp; ''' of readonly objects should be derived.<br>&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' &lt;typeparam name="T"&gt;Type of the list class.&lt;/typeparam&gt;<br>&nbsp;&nbsp;&nbsp; ''' &lt;typeparam name="C"&gt;Type of child objects contained in the list.&lt;/typeparam&gt;<br>&nbsp;&nbsp;&nbsp; &lt;System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Naming", "CA1710:IdentifiersShouldHaveCorrectSuffix")&gt; _<br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public MustInherit Class LookupsBase(Of T As LookupsBase(Of T, C, L), C As LookupBase(Of C), L As LookupListBase(Of L))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits CachedReadOnlyListBase(Of T, C)<br><br>#Region " Declarations "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected mCommandText As String<br><br>#End Region<br><br>#Region " Business Methods "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' Remove a record based on the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' record's id value.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;param name="id"&gt;Id value of the record to remove.&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Overloads Sub Remove(ByVal id As Integer)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each item As C In Me<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If item.Id = id Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Remove(item)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit For<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' Get a record based on its id value.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;param name="id"&gt;Id value of the record to return.&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Function GetTypeById(ByVal id As Integer) As C<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each item As C In Me<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If item.Id = id Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return item<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return Nothing<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>#End Region<br><br>#Region " Authorization Rules "<br><br>#Region " Factory Methods "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Shared Function GetLookups() As T<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not CheckCache() Then mList = DataPortal.Fetch(Of T)(New Criteria)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mList<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Sub New()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.AllowNew = False<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>#Region " Data Access "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Class Criteria<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' no criteria<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Class<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_OnDataPortalInvokeComplete( _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As Csla.DataPortalEventArgs)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If ApplicationContext.ExecutionLocation = _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.ExecutionLocations.Server Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' this runs on the server and invalidates<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' the LienTypeList cache<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LookupListBase(Of L).InvalidateCache()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New SqlConnection(Database.OPASConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = mCommandText<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New SafeDataReader(cm.ExecuteReader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; While .Read()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Add(LookupBase(Of C).GetLookup(dr))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End While<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = True<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace<br></font><br> This one seems like it's going to work just great as well.<br><br>But then we come to this one...<br><br><font size="1">Imports System.Data.SqlClient<br><br>Namespace Base<br><br>&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' This is a base class from which lookup classes<br>&nbsp;&nbsp;&nbsp; ''' can be derived.<br>&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' &lt;remarks&gt;<br>&nbsp;&nbsp;&nbsp; ''' This base class only supports data retrieve, not updating or<br>&nbsp;&nbsp;&nbsp; ''' deleting. Any lookup classes derived from this base class<br>&nbsp;&nbsp;&nbsp; ''' should only implement readonly properties. This lookup base<br>&nbsp;&nbsp;&nbsp; ''' class is cached.<br>&nbsp;&nbsp;&nbsp; ''' &lt;/remarks&gt;<br>&nbsp;&nbsp;&nbsp; ''' &lt;typeparam name="T"&gt;Type of the lookup class.&lt;/typeparam&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public MustInherit Class LookupBase(Of T As LookupBase(Of T))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits ReadOnlyBase(Of T)<br><br>#Region " Factory Methods "<br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mId = .GetInt32("Id")</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mName = .GetString("Name")</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mDescription = .GetString("Description")</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Shared Function GetLookup(ByVal dr As Csla.Data.SafeDataReader) As T</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New LookupBase(Of T)(dr)</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function</span><br><br>#End Region<br><br>#Region " Business Methods "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private mId As Integer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private mName As String = ""<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private mDescription As String = ""<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public ReadOnly Property Id() As Integer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)&gt; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mId<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public ReadOnly Property Name() As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)&gt; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public ReadOnly Property Description() As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)&gt; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mDescription<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Function GetIdValue() As Object<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mId<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>#End Region<br><br>#Region " Authorization Rules "<br><br>#Region " Overrides "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Overrides Function ToString() As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace<br></font><br>ALMOST everything seems great with this one as well but then you come to a sticking point. As you can see these classes are built almost exactly as a normal class in csla is built. Only difference for the most part is that I've used the generics for everything in order to facilitate all of this being inherited by derived classes. I've also added a protected variable in which the derived classes will store their sproc name.<br><br>The derived classes look something like this:<br><br><font size="1">Namespace Admin.Type<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public Class SampleTypeList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits Base.LookupListBase(Of SampleTypeList)<br><br>#Region " Constructors "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub New()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' require use of factory methods<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mCommandText = "getSampleTypeList"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace<br><br>Namespace Admin.Type<br><br>&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp; ''' Used to maintain the list of sample types<br>&nbsp;&nbsp;&nbsp; ''' in the system.<br>&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public Class SampleTypes<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits Base.LookupsBase(Of SampleTypes, SampleType, SampleTypeList)<br><br>#Region " Constructors "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub New()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mCommandText = "getSampleTypes"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace<br><br>Imports System.Data.SqlClient, OPAS.Library.Base<br><br>Namespace Admin.Type<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Public Class SampleType<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inherits LookupBase(Of SampleType)<br><br>#Region " Factory Methods "<br><font size="4"><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Shared Function GetSampleType(ByVal dr As Csla.Data.SafeDataReader) As SampleType</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New SampleType(dr)</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New(dr)</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</span></font><br><font size="4"><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></font><br>#End Region<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br>End Namespace<br></font><br>So basically my problem is this. I can't put the shared factory method for the main read only object into the derived object because I can't declare a shared method as mustoverride or overrides. If I could do that it would be easy. I also can't put it in the base object because then I can't create a new instance of the object in the factory method, which is the whole point of the method.<br><br>You can't do this in the base class:<br><font size="2"><br></font><font size="2">#Region " Factory Methods "<br>
<br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mId = .GetInt32("Id")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mName = .GetString("Name")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mDescription = .GetString("Description")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br></span>
</font><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Shared Function GetLookup(ByVal dr As Csla.Data.SafeDataReader) As T<br>
<font size="4"><span><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New LookupBase(Of T)(dr)</span></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function</font><font size="1"><font size="2"><span></span><br><br><span></span><span></span>#End Region</font>

<br><br><font size="3"><span>and this in the derived class:<br><br></span></font></font><font size="2">#Region " Factory Methods "<br>
<br><span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Shared Function GetSampleType(ByVal dr As Csla.Data.SafeDataReader) As SampleType<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New SampleType(dr)</span><br>

<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New(dr)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</span><br>
<br>
#End Region</font><br><font size="1"><font size="3"><span><br>because you can't use "New" on a mustinherit class.<br><br>You can't do this on the base class:<br><br></span></font></font><font size="2">#Region " Factory Methods "<br><br>
</font><font size="2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mId = .GetInt32("Id")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mName = .GetString("Name")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mDescription = .GetString("Description")</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</span></font><br><font size="2">
<span><br><font size="4"><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend MustOverride Shared Function GetLookup(ByVal dr As Csla.Data.SafeDataReader) As T</font></span><br>
<span></span><br>
#End Region</font><br><font size="1"><font size="3"><span><br>and this on the derived class:<br><br></span></font></font><font size="2">#Region " Factory Methods "<br>
<br><span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Shared Function GetLookup(ByVal dr As Csla.Data.SafeDataReader) As SampleType</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New SampleType(dr)</span><br>

<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub New(ByVal dr As Csla.Data.SafeDataReader)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New(dr)</span><br>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</span><br>
<br>
#End Region</font><br><font size="1"><font size="3"><span><br></span></font></font><font size="1"><font size="3"><span>because you can't use Mustoverride or Overrides on a shared method.<br><br>I figured I should stop banging my head against the wall and ask.<br><br>The other two classes only work because the factory methods don't try to instantiate the object themselves. They let the data portal do that for them and I'm pretty sure the trick may be that the data portal uses reflection to overcome this obstacle but I'm not sure. This is my next avenue of investigation but I thought I should take the time to ask the community for advice before I go much further.<br><br>I will have to wonder if it's worth it to use reflection rather than just duplicating the code. I'm not real concerned about performance but still it seems like a dangerous road.<br><br>Thanks for your help,<br><br>Tory<br></span></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Friday, September 28, 2007</h2>Ya most of the highlighting I did, doesn't show up in the finished product. It's there still when I go to edit it, but it doesn't show up in the post. The font size changes do though, so at least there's that.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Friday, September 28, 2007</h2>Well I changed my highlighting to big fonts and smiley faces and that seems to work.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jhw replied on Saturday, September 29, 2007</h2><P>I went down this same road not long ago. The advice I got from Rocky was don't do it. Keep your object inheritance based only on behavior. In this day and age of code generators, snippets and templates, don't bother with inheritance for data. I followed his advice and I totally agree with him now.</P>
<P>Heath</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Monday, October 01, 2007</h2>Ya, I've read that advice from Rocky. Since all of the behavior is the same across these objects, I'm pretty sure that's exactly what I'm doing. If you look at how simple the end result objects become I think you'll see what I mean.<br><br>That said. I really am still not sure when I'm getting those concepts and when I'm not so maybe I'm wrong.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SethSpearman replied on Monday, October 08, 2007</h2><P>I was looking at this post because I was also trying to create base classes for my biz objects.&nbsp; I too am just learning CSLA.</P>
<P>My question is this.&nbsp; My interest in this lies in the fact that if I use base classes I can gen the source at will using CodeSmith.&nbsp; (In fact, I plan to use active code generation so the source will be built every time I build if the template or metadata has changed).&nbsp; But, of course, I don't want to overwrite the custom user code when that happens.&nbsp; So I thought I could solve this problem&nbsp;using base classes.&nbsp; </P>
<P>&nbsp;</P>
<P>If base classes are not recommended then what is the best method for achieving this goal?&nbsp; I thought I would prefer base classes over partial classes but I am willing to be convinced otherwise.</P>
<P>&nbsp;</P>
<P>Thanks in advance for you help.</P>
<P>&nbsp;</P>
<P>Seth B Spearman</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, October 09, 2007</h2><P>@Seth:&nbsp; From a code generation perspective partial classes are the way to go.&nbsp;&nbsp; But this can be used in conjunction with abstract base classes if needed to provide common functionality/behaviour.</P>
<P>I had this thought the other day about inheritance which&nbsp;I will put up for debate/comment.</P>
<P><FONT size=4>"Inheritance is essentially a technical concept, <STRONG>not</STRONG> a business concept.&nbsp; It can be a very&nbsp;useful tool when building technical things like application frameworks.&nbsp; It proves to be a lot less useful as a tool when building a&nbsp;specific business application."</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 09, 2007</h2><P>I have Base classes which inherit from Csla and all of my BOs then inherit from MY base classes.</P>
<P>I also use Codesmith to Generate the first level of a BO and then I inherit that and write manual code for the rest of the BO. So I do NOT use partial classes - I use an inheritance chain.</P>
<P>I have not had any issue with it in the 4 years I have been doing it.</P>
<P>I believe if you use partial classes you run into a different set of problems that need to be overcome. Like the inability to override a method. I think you have to provide lots of hooks in your code gen partial class in order to overcome this limitation. It has been discussed before on this forum so a Search should help. But since I don't use it I don't really recall all the details.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Wednesday, October 10, 2007</h2><P>Joe,</P>
<P>Not sure if this is necessarily the right thread, but here goes anyway.</P>
<P>So what do you codegen in your "first level" BO?&nbsp; I'm guessing maybe it's data related stuff taken from your DB schema (like fields, properties etc).</P>
<P>If that's the case, then that's v.similar to what we do, except that our CodeSmith generation produces a partial class and we then hand code the rest of the class to finish the BO (i.e. complex object graphs, additional functionality etc).</P>
<P>We also have our own base classes that we inherit from, not from the CSLA ones.</P>
<P>I'm guessing the end result might be similar, we just arrive at it a different way.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, October 10, 2007</h2><P>Apologies for hijacking the thread.</P>
<P>David,</P>
<P>I code gen "everything" in the first level BO that I can get from the DB schema. Fields, Properties, Validation Rules, Factory Methods, DataPortal_XYZ methods.</P>
<P>When I inherit from the gen level I almost always have an empty class (initially.) Then I can add functionality as needed.</P>
<P>I tend to agree - we get to the same end using different techniques.</P>
<P>Maybe you can comment on the overriding of&nbsp; a method issue for partial classes and how you resolved it with hooks?</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Wednesday, October 10, 2007</h2><P>I assume you mean overriding a method from an abstract base class to implement a piece of functionality that is common across all BOs.</P>
<P>I guess we've taken the view that there's kind of a black and white situation.&nbsp; You either codegen the method, or you hand craft it.</P>
<P>So if we "know" what the implementation is going to be then it goes in the codegen partial.&nbsp; If we don't then we leave it for the hand crafted partial.&nbsp; But&nbsp;that only works up to a point.</P>
<P>So the next step we took was to add some extra metadata into the DB schema.&nbsp; What we did is add some flags in our metadata that can be used to turn off/on certain parts of the code generation process.&nbsp; For example, don't generate a property getter/setter for a column in the schema that is a foreign key column (because you can't tell if it's mapping a one-to-many or many-to-one).</P>
<P>This does have the obvious impact of making the templates more complex, but we solved that by writing the "metadata logic" handling code in a C# DLL and we call that from the templates.&nbsp; That way the templates look less cluttered and the logic is done in a programming language where we find it easier to code the kind of relationships we are modelling.</P>
<P>We've had some more time to expand our BOs into an application and we understand better now the relationships we typically require.&nbsp; We just need to spend a bit of time going back to our metadata concept and improve it so that we could in theory generate more of the code automatically.</P>
<P>Looking at it another way, we would try and move code that we repeatedly hand craft into the code-generated partial class instead.</P>
<P>It's trying to get the balance between investing time&nbsp;in improving the code generation versus knowing that we can easily cut-and-paste/snippet the bits of code we hand craft.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, October 10, 2007</h2><P>Interesting.You basically decided to avoid the issue. And then built a solution that meets your needs. I get it.Bottom line for me is that it is standard inheritance works more clearly (in my mind) than partial classes where you need to worry about code generating a method and then can't override it so you either have to provide hooks or avoid the issue.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Tuesday, October 09, 2007</h2>I feel I should point out that I am using inheritance here in order to consolidate behavior. Yes I end up consolidating some data handling along the way but that's not really the point. These classes do everything exactly the same way.<br><br>Seth,<br><br>I see nothing wrong with subclassing the csla objects into your own base objects if you have some universal behavior you would like to add to them. It doesn't show in the code that I've posted because they are read only objects, but I have done exactly that in order to add auditing to my business objects. They all keep track of who changed them and when. This seems perfectly proper to me. It's not something that has to be done with code generation or partial classes.<br><br>Partial classes do seem like a great way to keep your generated code separate from your individual customizations. I have to admit that it seems strange to me to use inheritance for keeping generated code separate from your custom code.  It seems like it would introduce a lot more problems. That said, I don't do code gen and know little about it so don't listen to me.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Tuesday, October 09, 2007</h2>By the way... Does anyone actually know the answer to my question? I've had a lot of people talking about whether or not I should be using inheritance. Not a lot of answers to the question.<br><br>Maybe I should make a more succinct thread...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SethSpearman replied on Wednesday, October 10, 2007</h2><P>Joe and Tel et al,</P>
<P>For the record, I have decide to do what you say and continue with my plan 'A' and gen base classes and custom code the inherited classes.&nbsp; There is a lot of evidence that this is very common and is a recommended approach by many code-gen experts including Kathleen Dollard and is also recommended in the CodeSmith help file.</P>
<P>Tel, since I feel I 'hijacked' your question, and you didn't get the answer you wanted, and after reviewing the code, I was wondering why you just don't exclude the shared factory methods altogether from the base classes and implement them in the inherited classes only.&nbsp; That way you don't declare them as must override or overrides etc and it should work.&nbsp; </P>
<P>That is what I am having to do with my CSLA bases classes per this thread and what was recommended in several code snippets I found on google.</P>
<P>Just a thought.&nbsp; I realize that I may not understand your question completely.</P>
<P>Thank you all for your help.</P>
<P>Seth</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Wednesday, October 10, 2007</h2>ah No problem. Actually you've probably brought more exposure to my question which is a good thing.<br><br>Actually the reason I don't do that is because then I can't use the one object from within the other. I would have to use the more specific derived classes which I can't do because I'm working in an abstract class.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Wednesday, October 10, 2007</h2>How very disappointing. The first time I find something that stumps me and apparently I'm not alone. I tried shadowing the Shared factory method rather than overriding it (this is allowed with a shared method where override is not). That gives the strangest error. Visual Studio doesn't really show me what it's talking about but when it goes into the debugger it does list a null reference exception and Me as being equal to nothing. That can't be good.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telarian replied on Friday, October 12, 2007</h2>What if I were to offer magic charms in return for some sound advice?<br><br>err... Beans! Yes beans. It must be beans. I shall offer 3 magic beans in return for help on this issue.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, October 13, 2007</h2><P>Here is one piece of advice:</P>
<P>I think the original question got lost in this thread. Try re-wording it and posting a new thread.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, October 15, 2007</h2><P>Magic charms!&nbsp; Beans!&nbsp; I like the sound of that! Gimme, gimme, gimme!!!</P>
<P>Joe makes a good point about starting a new thread - sorry we kind of hijacked this one and took it down a slightly different route.</P>
<P>However, FWIW, here's my thoughts on the original question.&nbsp; I think you have absolutely found a crossroads point where you need to make a decision for yourself.</P>
<P>You either:</P>
<P>(1) Accept the fact you can't do what you really want to do with a shared (static) method and just accept the fact that you "know" you have to write a specific factory method in each derived class.&nbsp; It's a project design decision to follow the factory pattern and you can write concrete code where needed.</P>
<P>(2) Go down the reflection route and write the code in the abstract base base that "knows" there will be a specific method signature that can be called dynamically.&nbsp; You then write abstract code and must use reflection techniques.</P>
<P>You are correct in your assumption that Rocky went down route (2) as fundamentally that is how the Data Portal works. There are specific method signatures (i.e. DataPortal_xyz) that are expected in the derived class.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
