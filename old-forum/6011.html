<html><header><title>OT: LINQ to SQL help</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT: LINQ to SQL help</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6011.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MBursill posted on Wednesday, December 17, 2008</h2>Slightly off topic post, but I hope somebody can help me with this.<br><br>I'm using the CSLA framework to do something similar to what Rocky described in a recent blog post: http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx<br><br>Instead of calling them permissions, I call them tasks, but same thing.<br><br>I have three tables, Users, Roles, and Tasks. A user belongs to one or many roles, and a role belongs to one or many tasks. This of course results in many to many relationships between users and roles, plus roles and tasks. I used the tables UserRoles and RoleTasks to resolve the Many to Many's.<br><br>I'm using LINQ to SQL, and I want to avoid T-SQL (long story as to why, but it's not an option).<br><br>The SQL to grab a task when you know of the user is:<br><br>SELECT Tasks.TaskName<br>FROM Users INNER JOIN (Tasks INNER JOIN ((Roles INNER JOIN RoleTasks ON Roles.RoleName = RoleTasks.RoleName)<br>INNER JOIN UserRoles ON Roles.RoleName = UserRoles.RoleName) ON Tasks.TaskName = RoleTasks.TaskName) ON Users.Username = UserRoles.UserName<br>WHERE (((Users.Username)="admin"));<br><br>I'm absolutely lost as to how to do the equivalent LINQ expression against my LINQ to SQL entities. Can somebody point me in the right direction?<br><br>Thanks.<br><br>-Mike.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>KJosh replied on Thursday, December 18, 2008</h2>Hi,<br>&nbsp;Write Linq query like the below:<br>DatabaseContext ctx = new DatabaseContext();<br>var q = (from u in ctx.Users<br>&nbsp;&nbsp;&nbsp; Join t in Tasks on (your join conditions)<br>&nbsp;&nbsp;&nbsp; Join r in ctx.Roles on (your join conditions like t.col1 equals r.col1)<br>&nbsp;&nbsp;&nbsp; Join ur in ctx.UserRoles on new { ur.RoleName, ur.UserName} equals new { ur.RoleName, &nbsp;&nbsp;&nbsp; U.UserName}<br>&nbsp;&nbsp;&nbsp; Join rt in ctx.RoleTasks on t.TaskName equals rt.TaskName<br>&nbsp;&nbsp;&nbsp; Where u.UserName.Contains("admin")<br>&nbsp;&nbsp;&nbsp; select new { u.columnname, .... })<br>Hope this helps<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MBursill replied on Monday, December 22, 2008</h2>Thanks, I was able to figure it out from this. :-)<br><br>For anyone who's interested:<br><br>var data = from t in ctx.DataContext.Tasks<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join rt in ctx.DataContext.RoleTasks on t.TaskName equals rt.TaskName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join r in ctx.DataContext.Roles on rt.RoleName equals r.RoleName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join ur in ctx.DataContext.UserRoles on r.RoleName equals ur.RoleName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join u in ctx.DataContext.Users on ur.Username equals u.Username<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where u.Username == "admin"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select t;<br><br>-Mike.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
