<html><header><title>Multi threading issue in CanReadProperty </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Multi threading issue in CanReadProperty </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8456.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Andreas posted on Tuesday, February 02, 2010</h2>Hi,<br />we ran into a multi threading problem in BusinessBase.CanReadProperty with WPF. Two threads tried to insert the same key into the _readResultCache dictionary. I think the _readResultCache variable needs to be locked (?) <br /><br />Andreas<br /><br />Original code of Csla381:<br /><br />   [EditorBrowsable(EditorBrowsableState.Advanced)]<br />    public virtual bool CanReadProperty(string propertyName)<br />    {<br />      bool result = true;<br />      VerifyAuthorizationCache();<br />      if (!_readResultCache.TryGetValue(propertyName, out result))<br />      {<br />        result = true;<br />        if (AuthorizationRules.HasReadAllowedRoles(propertyName))<br />        {<br />          // some users are explicitly granted read access<br />          // in which case all other users are denied<br />          if (!AuthorizationRules.IsReadAllowed(propertyName))<br />            result = false;<br />        }<br />        else if (AuthorizationRules.HasReadDeniedRoles(propertyName))<br />        {<br />          // some users are explicitly denied read access<br />          if (AuthorizationRules.IsReadDenied(propertyName))<br />            result = false;<br />        }<br />        // store value in cache<br />        _readResultCache.Add(propertyName, result);<br />      }<br />      <br />      return result;<br />    }<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Tuesday, February 02, 2010</h2>I may be wrong about this but I believe that the CSLA is not thread safe by designâ€¦.. at least not on instance members.<br /><br />Making it thread safe would probably incur in a big performance hit and not everyone needs thread safe so I believe is up to you to decide to implement thread safety if you really need it.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Andreas replied on Wednesday, February 03, 2010</h2>Youre right. I was not sure about it because some pieces of csla uses the lock key word.<br /><br />Thanks,<br />Andreas<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
