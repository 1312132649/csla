<html><header><title>Issue with object state using ISerializable...?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Issue with object state using ISerializable...?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4924.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 posted on Monday, June 02, 2008</h2>It's me again... Quick question.&nbsp; We are currently implementing ISerializable in our business objects to only take our member variables.&nbsp; We are having a problem when we clone the object.&nbsp; All of the member variables that we have in our classes show up, but we no longer have the correct state for "isDirty", "isValid" etc... How can we include these properties during our serialization?<br><br>Hope this makes some sense.<br><br>Thanks for any insight!<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Tuesday, June 03, 2008</h2>Still haven't gotten anywhere on this... Here is the snippet of code i'm using at the moment... Any ideas :)<br><br>Public Sub New(ByVal info As SerializationInfo, ByVal context As StreamingContext)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _GUID = (CType(info.GetValue("guid", GetType(Guid)), Guid))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _firstName = CType(info.GetValue("firstname", GetType(String)), String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _lastName = CType(info.GetValue("lastname", GetType(String)), String)<br>End Sub<br><br>Public Sub GetObjectData(ByVal info As SerializationInfo, ByVal context As StreamingContext) _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Implements System.Runtime.Serialization.ISerializable.GetObjectData<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.AddValue("guid", _GUID)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.AddValue("firstname", _firstName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.AddValue("lastname", _lastName)<br>End Sub<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bwatson replied on Friday, June 06, 2008</h2><P>I'm having a very similar issue when&nbsp;attempting to use ISerializable to "lighten" some objects; we're wanting the IsDirty, IsValid, etc. to try and keep our validation intact. Cloning the object and not including these properties renders the validation useless. Maybe using ValidationRules.CheckRules() after deserializing is an acceptable solution, just wanted some input from the forum...</P>
<P>Any help would be greatly appreciated.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Monday, June 09, 2008</h2><P><FONT face=Tahoma size=2>I'll start by saying that my info relates to pre-3.5 versions of CSLA, as I haven't had time to look at that.&nbsp; I would imagine&nbsp;that&nbsp;3.5&nbsp;works similarly, but that's just a guess.</FONT></P>
<P><FONT face=Tahoma size=2>It's a little tough to answer your questions, because I'm not sure why you're choosing this route.&nbsp; If you want to "lighten" your objects, why not simply apply a "NonSerialized" (and probably "NotUndoable" as well)&nbsp;attribute to those properties that you don't want to serialize?&nbsp; The OP doesn't say why he's implementing ISerializable, so I can't speak to that, but I'm wondering if this won't get you where you want to go.</FONT></P>
<P><FONT face=Tahoma size=2>In a more general sense, you're going to have issues if you try to apply any sort of custom serialization, for exactly the reasons you're running into.&nbsp; CSLA just wasn't built to handle ISerializable out of the box - that's why there is "NotUndoable" and "NonSerialized".&nbsp; Unless all the base&nbsp;properties are serialized, CSLA-based objects won't work properly.&nbsp; Calling "CheckRules" might help with IsDirty/IsValid, but it won't help with IsNew, IsDeleted, etc.&nbsp; And you need those for the DP_ code to work.&nbsp; Plus, you'll have issues with things like DeletedList as well, if you have collections you need to deal with.</FONT></P>
<P><FONT face=Tahoma size=2>You can certainly use reflection to get at what you need,&nbsp;and you could use the "Mark" routines in your deserialization code to help with the listed properties.&nbsp; But you would still need to include those base properties in your serialization code, along with all the other base CSLA data&nbsp;- if you implement ISerializable, you're pretty much on your own.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 09, 2008</h2><P>Scott is right, you would be far better off using the NonSerialized attribute.</P>
<P>When you implement ISerializable, you hijack the normal serialization process, and it becomes your responsibility to serialize the fields of your object. Typically this means using reflection to get/set the values (which is what the serializer would have done for you automatically).</P>
<P>This can get <EM>very</EM> messy if you end up reflecting against any fields that contain other objects that implement ISerializable, because you need to participate in the serializer's "fix-up" processing stage. I don't know how you actually do that, I just know that's what's required - and it is rather arcane...</P>
<P>If you have fields you don't want serialized - that's what NonSerialized is for, and I <EM>strongly</EM> recommend you take that approach.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
