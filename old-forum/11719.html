<html><header><title>AddOutValue not working in 4.5 if objects are equal</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>AddOutValue not working in 4.5 if objects are equal</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11719.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mesh posted on Thursday, November 22, 2012</h2><p>Hi, I have a problem with new rule engine 4.5 of CSLA. </p>
<p>While returning object (not value!) from asynchronus validation rule with using RuleContext.AddOutValue, property is not being set if value from rule and the one that is currently present on property are equal (Object.Equals). </p>
<p>I was wondering do you have any advice on how to force setting of property despite the comparison that is made in Equals method. </p>
<p>Kind regards,<br />mesh</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, November 22, 2012</h2><p>Well, that is basically how LoadProperty/SetProperty works - to update the field only when the value differs. </p>
<p><b>I would take new look at the code and try to avoid this. </b></p>
<p><b>BusinessRules should NOT be used for data access and load new child objects (if I understand correctly). </b><br />I would rather prefer to do Async LazyLoad on the &lt;bo&gt;.&lt;Property&gt;</p>
<p>The only &quot;safe&quot; workaround is in the callback method to call LoadProperty(context.Target, PropertyInfo, null) so the values will differ when the rule engine processes the OutputValues. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mesh replied on Thursday, November 22, 2012</h2><p>Thanks.<br /><br />Yes, it would be great if I can choose to &quot;force&quot; Load/SetProperty.<br /><br />ProvideTargetWhenAsync/LoadProperty(context.Target, PropertyInfo, null)&nbsp; workaround is allowed when BusinessRule is async?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, November 22, 2012</h2><p>Yes, they are. </p>
<p>But remember - BusinessRules should NOT be used as Data Access to load business objects. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mesh replied on Friday, November 23, 2012</h2><p>I am only using BusinessRule to fetch/replace readonly child object (key/value implementation of foreign key concept), for example, UI code can set only &quot;key&quot; part of foreign key property. Business rule then kick in, it fetch and replace that foreign key child object with key AND value (value can be string or&nbsp;read only &quot;info&quot; object)&nbsp;from database.</p>
<p>That way I&#39;m keeping BO properties clean, can reuse rules and I can unit test business rules.</p>
<p>I hope I&#39;m doing the right thing?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, November 23, 2012</h2><p>My preference is to have the key and value as separate properties in the BO. <br />ReadOnly objects may work with this - but editable must NEVER be used like this. </p>
<p>In terms of Undo and Serialization/Deserialization this is the best solution (IMO).</p>
<p>So I prefer to only use the key and then the async business rule will update the value in the BO. </p>
<p>Unit test and reuse of rules works just as good.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
