<html><header><title>TriggerAction w/ TargetControl of a ViewModel</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>TriggerAction w/ TargetControl of a ViewModel</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10743.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Thursday, October 06, 2011</h2><p>We have a pretty good sized application that we are moving from 3.8.3 to 4.1.</p>
<p>One of the things that created more work than anticipated (overall the upgrade wasn&#39;t too bad) was the change for ViewModelBase to inherit from DependencyObject instead of FrameworkElement.</p>
<p>It involved adjusting some SetBinding calls in codebehind of the viewmodel to use BindingOperations.SetBinding, and that obviously wasn&#39;t too bad (it wasn&#39;t clear whether Silverlight 4 supports this - in the documentation, it suggests an exception will be thrown if it isn&#39;t a FrameworkElement or other DependencyObject descendant that I can&#39;t recall).&nbsp;</p>
<p>One thing we did, for good or for bad, is to have a triggeraction against the save of a viewmodel (which has a view via FloatableWindow) and the overall datacontext for the floatable window ends up being a separate ViewModel that we end up making a method call against when the second viewmodel saves.</p>
<p>Of course, TargetControl in triggeraction is typed to be a FrameworkElement, so a viewmodel cannot be a TargetControl.</p>
<p>Is our use of triggeraction in this way something we need to get away from, or is this acceptable and could triggeraction&#39;s targetcontrol be typed to be dependencyobject? I looked at the code very briefly and it looked like it might work.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, October 06, 2011</h2><p>It did work, adjusting the TriggerAction to use DependencyObject instead of FrameworkElement - it did introduce the need to cast the TargetControl in TriggerAction event handlers, though, in cases where we looked @ datacontext &amp; such.</p>
<p>In the end, we temporarily decided to make our only adjustment to CSLA, retaining the inheritence of FrameworkElement for ViewModelBase.&nbsp; It seems like that inheritance gives you a little more flexibility, even if it&#39;s not consistent with WPF (apparently a collegue of mine said that was in the notes).</p>
<p>I suspect we&#39;ll address this issue on our end later on to get back to being fully standard; if there&#39;s anything &quot;future-thinking&quot; that would say &quot;you want to get away from using FrameworkElement for viewmodels&quot;, that would be good to know.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 06, 2011</h2><p>There are two reasons for being a DependencyObject (rather than a simple class implementing INotifyPropertyChanged):</p>
<ol>
<li>You can write code in the viewmodel to detect if you are in design mode</li>
<li>You can bind to the Model property to create cascading&nbsp;(parent-child) viewmodels</li>
</ol>
<p>The second one is the primary driver for using the DO base type. This is important for some MVVM scenarios where you don&#39;t use a CollectionViewSource, and want to have a set of XAML resources that expose a hierarchy of parent-child viewmodels.</p>
<p>The design mode thing can be solved in other ways, so it isn&#39;t a requirement as much as a convenience.</p>
<p>fwiw, I pretty much always use CollectionViewSource objects now, so I am open to arguments that ViewModelBase should become a simple class and not inherit from anything. That&#39;d obviously be a breaking change though, and there&#39;s no strong motivation (that I&#39;m aware of) to make this change.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, October 06, 2011</h2><p>So the notion of hooking up to a trigger action to a view model&#39;s event doesn&#39;t make any sense? (I&#39;m not sure if I rambled too much to be unclear... it was mainly about losing the ability to use the viewmodel as a target control in a trigger action.)</p>
<p>My guess is that&nbsp; you were saying that the only two reasons why it&#39;s a dependency object at all is to support the two items you listed, and that having a trigger action on a viewmodel event wasn&#39;t an option you necessarily feel makes a lot of sense.</p>
<p>Doesn&#39;t seem impractical to want to do that, but maybe I&#39;m overlooking a reason why it&#39;s a bad idea.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TygreWolf replied on Monday, July 01, 2013</h2><p>I hate to bring up an old issue, but I&#39;m having a similar problem myself.&nbsp; I have one view with two view models - one view model is a read-only list (UserList containing UserInfo objects), and the other view model is an editable instance of an item in the list (User).<br /><br />I&#39;d like to be able to use the TriggerAction and define my XAML in such a way that when a User object is saved (in my UserEditViewModel), it will call a RefreshList() method on my UserListViewModel object, which will refresh the list.<br /><br />Currently, I believe I&#39;m breaking the MVVM pattern by passing my UserListViewModel as a resource in the MethodParameter of my &quot;save&quot; button, and then calling refresh in my Save routine of my UserEditViewModel:<br /><br /><span style="font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">&lt;</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">Button</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> x</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">:</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">Name</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;BtnSaveUser&quot;</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> IsEnabled</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">Binding</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> Path</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=IsSavable}&quot;&gt;</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">Save User</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">&lt;/</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">Button</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">&gt;<br /></span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">&lt;</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">csla</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">:</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">TriggerAction</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> x</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">:</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">Name</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;BtnSaveUserTrigger&quot; </span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">DataContext</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">Binding</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> Source</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">={</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">StaticResource</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> UserEditViewModel</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">}}&quot;<br /></span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">TargetControl</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">Binding</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> ElementName</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=BtnSaveUser}&quot;<br /></span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">MethodParameter</span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;"><span style="font-family:Consolas;color:#a31515;">StaticResource</span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"> UserListViewModel</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">}&quot;<br /></span></span></span><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;"><span style="font-family:Consolas;color:#ff0000;">MethodName</span></span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;">=&quot;SaveUser&quot;/&gt;<br /><br /><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">public</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">void</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> SaveUser(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">object</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> sender, </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">ExecuteEventArgs</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"> e)<br />{<br />BeginSave();<br /></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">var</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> ulvm = (</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">UserListViewModel</span></span></span></span><span style="font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">) e.MethodParameter;<br />ulvm.RefreshList();<br />}<br /><br /><span style="font-family:Arial;color:#000000;">I really don&#39;t like doing it this way, but I just don&#39;t know how I can tell my User List to refresh <strong>after</strong> my single user is saved, since each are defined in two different view models.&nbsp; Can you define the CSLA TriggerAction to listen to an event directly on a view model?</span></span></span></span></span></span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
