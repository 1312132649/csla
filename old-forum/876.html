<html><header><title>Program won't retrieve all child rows from sproc</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Program won't retrieve all child rows from sproc</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/876.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan posted on Friday, August 11, 2006</h2><P>I have a sproc that retrieves department information based on the department chosen and then, through a separate Select statement, retrieves all drawings for that department.&nbsp; It's a really simple sproc,&nbsp;similar to&nbsp;that used for authentication and authorization:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New">SELECT * FROM Departments<BR>WHERE DeptName = @Name<BR><BR>SELECT * FROM Drawings dr, Departments de<BR>WHERE (dr.DeptID = de.ID) AND (de.DeptName = @Name)</FONT></P></BLOCKQUOTE>
<P dir=ltr>The sproc runs great in SQL Server Management Studio...returns the Department data and all three rows of test Drawing data having a DeptID equal to the Department ID.&nbsp; If I try executing it from Server Explorer in the VS IDE, it returns nothing for either Select statement.&nbsp; If I execute it from inside my application, it populates the Department object with the appropriate data, but it only populates one Drawing object in my Drawings collection; in other words, the SafeDataReader passed to the child Fetch method says there's only one row returned from the second Select statement.</P>
<P dir=ltr>What gives?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Friday, August 11, 2006</h2><P>Much as I hated having to do it, I went back and made a few changes to the data tables and regenerated my Department, Drawings and Drawing objects...sooooo, I'm able to retrieve all the child rows.</P>
<P>My problem now is creating a new Drawing object; to test the Fetch methods, I fat-fingered data into the Drawings table.&nbsp; The Department object gets created and populated, but I can't for the life of me figure out how to add a Drawing object.&nbsp; I thought maybe something like </P>
<BLOCKQUOTE dir=ltr>
<P>Dept.Drawing dwg = Library.Drawing.NewDrawing();</P></BLOCKQUOTE>
<P dir=ltr>but that doesn't work since the NewDrawing method isn't exposed.&nbsp; So, I tried Dept.Drawing.NewDrawing(); to the right of the equal sign...again, no such luck.&nbsp; I didn't seem to have this much difficulty using 1.5x of CSLA, so why am I having it now?&nbsp; *sigh*</P>
<P dir=ltr>Allen</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, August 11, 2006</h2>Well, I have not seen your code, but my guess is that Drawing is part of a child list in Department.&nbsp; I am also guessing that Drawing.NewDrawing() is internally scoped.&nbsp; So you would need Department.Drawings.AddNew() to get a new Drawing.&nbsp; You would override DrawingList.AddNewCore() to do the following:<br><br>protected override Drawing AddNewCore()<br>{<br>&nbsp;&nbsp;&nbsp; Drawing obj = Drawing.NewDrawing();<br>&nbsp;&nbsp;&nbsp; this.Add(obj);<br>&nbsp;&nbsp;&nbsp; return obj;<br>}<br><br>You might also need to set this.AllowNew = true; in DrawingList's constructor.<br><br>BusinessListBase inherits from BindingList&lt;T&gt;.&nbsp; Implementing AddNewCore() (and maybe AllowNew = true, I forget the default value) will enable the AddNew() method.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
