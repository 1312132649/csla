<html><header><title>CslaDataSource issues a double call to DataSource_SelectObject </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataSource issues a double call to DataSource_SelectObject </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1505.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CLoris posted on Monday, October 16, 2006</h2><P>I have been banging my head on this one for a while and would appreciate some input.&nbsp; In a nutshell, I have a business object that I am binding to a CslaDataSource after a date is selected from a calendar control, I get my Business object and bind it to the data source.&nbsp; I then implement a caching scheme like Rocky did in the project tracker.&nbsp; Code below:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> calEditDate_SelectionChanged(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.EventArgs)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> curForecast </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Forecast<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> SurfMSG.Library.Forecast.Exists(1, calEditDate.SelectedDate) = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curForecast = Forecast.GetEditableRoot(1, calEditDate.SelectedDate)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetForecast(curForecast)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetailsView1.DataBind()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetailsView1.DefaultMode = DetailsViewMode.Edit<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>curForecast = Forecast.NewEditableRoot(1, calEditDate.SelectedDate)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetForecast(curForecast)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetailsView1.DataBind()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetailsView1.DefaultMode = DetailsViewMode.Insert<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> DetailsView1.Visible = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>DetailsView1.Visible = </FONT><FONT color=#0000ff size=2>True<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> ForecastDataSource_SelectObject(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> <SPAN id=google-navclient-hilite><SPAN id=google-navclient-hilite><SPAN id=google-navclient-hilite>Csla</SPAN></SPAN></SPAN>.Web.SelectObjectArgs) </FONT><FONT color=#0000ff size=2>Handles</FONT><FONT size=2> ForecastDataSource.SelectObject<BR>&nbsp;&nbsp;&nbsp;e.BusinessObject = GetForecast()<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> SetForecast(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> myForecast </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Forecast)<BR>&nbsp;&nbsp;&nbsp;Session(</FONT><FONT color=#800000 size=2>"currentObject"</FONT><FONT size=2>) = myForecast<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetForecast() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Forecast<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> businessObject </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2> = Session(</FONT><FONT color=#800000 size=2>"currentObject"</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(businessObject, Forecast)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT></P>
<P><FONT color=#0000ff size=2>Everything works as expected except that <FONT color=#000000>ForecastDataSource_SelectObject is fired twice.</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000>Any thoughts?</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 16, 2006</h2>Someone emailed me with an issue along this line weeks ago. I was unable to replicate it in the debugger with my code - and I think it ended up being some issue with their code.<br><br>It may be that you have multiple controls bound to that same data control - and each one would data bind independantly, triggering multiple events.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CLoris replied on Monday, October 16, 2006</h2>Thank you for the response.&nbsp; Can you give me any of the specifics of the other problem report.&nbsp; Did it involve the DetailsView control?&nbsp; Rebinding the data source?&nbsp; I have very few controls on this page as it was part of some preliminary UI ideas.&nbsp; Two Labels, Calendar Control and DataView.&nbsp; One CslaDataSource.&nbsp; Going to try and dig deeper.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 17, 2006</h2>It has been a few weeks since this came up, and I don't recall the specifics, no, sorry.<br><br>I strongly suggest running your code in the debugger, with a breakpoint in your event handler. Then you can examine the stack trace to see what triggered the data binding process. It is most likely the case that you have an explicit DataBind() call in your code, in a case where ASP.NET is also automatically making the call on your behalf (like in Page_Load).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CLoris replied on Tuesday, October 17, 2006</h2><P>I will do that.&nbsp; A couple of interesting observations:</P>
<OL>
<LI>There is a difference in behvaior if I add my SelectObject eventhandler for the CslaDataSource property window in the Form Designer versus when I simply add a Handles statement to the event handler in code.&nbsp; When doing the later, the SelectObject event only fires once.&nbsp; So - I go to the malfuncitoning form in form designer and remove the&nbsp;event handler from the CslaDatSource&nbsp;Event - SelectObject.&nbsp; I go into the code behind file&nbsp;and&nbsp;add:&nbsp;Handles <FONT size=2>ForeastDataSource.SelectObject to <FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> ForecastDataSource_SelectObject(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Web.SelectObjectArgs).&nbsp; And then it works fine.</FONT></FONT></LI>
<LI>Drilling down to the invocationList on the SelectObject event, I see two items registered for the event and they appear to be identical.</LI></OL>
<P>Is there an easy way to see what is being generated in the partial class for an ASPX page?&nbsp; I thought this might be insightful.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CLoris replied on Thursday, November 16, 2006</h2><P>Okay.&nbsp; I figured out why this is happening.&nbsp; In my CslaDataSource property sheet (In ASP.Net VB) I was double clicking on the SelectObject event to create the event handler:</P>
<P>ForecastDataSource_SelectObject</P>
<P>I noticed that the event handler was registered in two places/ways:</P>
<P>1. In the ASP CslaDataSource Control: OnSelectObject="ForecastDataSource_SelectObject"</P>
<P>2. In the codebehind I had a: Handles ForecastDataSource.SelectObject on the ForecastDataSource_SelectObject method</P>
<P>A few weeks ago when I was struggling with this, I swear that I could duplicate it.&nbsp; I could not duplictae this double registering this morning.</P>
<P>So in a nutshell - double firing event handlers in ASP.Net VB - Look for both a Handles clause on the event handler and look for an event handler registration in the ASP control in the ASPX file.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 16, 2006</h2>




<DIV align=left><SPAN class=628332216-16112006><FONT face=Arial color=#0000ff size=2>Interesting!</FONT></SPAN></DIV>
<DIV align=left><SPAN class=628332216-16112006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=628332216-16112006><FONT face=Arial color=#0000ff size=2>I have a guess - there's an attribute on the page (aspx) 
that indicates whether automatic event hookups should occur. It is typically set 
one way in VB and the other in C# due to the lack of WithEvents in C#. Is it 
possible that this attribute got set backwards in your page? That could have 
triggered the C# style event hookup, and of course VS knows you are in VB and 
did the "right" thing for VB too?</FONT></SPAN></DIV>
<DIV align=left><SPAN class=628332216-16112006></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=628332216-16112006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV>
<DIV align=left>&nbsp;</DIV></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
