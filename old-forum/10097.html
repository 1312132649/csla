<html><header><title>Async &amp; Sync Rules with Same Priority</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Async &amp; Sync Rules with Same Priority</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10097.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mosgath posted on Tuesday, February 22, 2011</h2><p>I ran into a strange situation yesterday.&nbsp; I have a business object that is a BusinessBase child.&nbsp; It is four levels deep in the object hierarchy.&nbsp; It uses the business rulesets depending on the type of material.&nbsp; In each of the rulesets, I have an async&nbsp;rule to validate the model number in a backend system and retrieve description, price, etc.&nbsp; I also have a rule that validates if the model number is allowed on the type of order.&nbsp; I had the following in the AfterAddBusinessRules method:</p>
<pre style="FONT-FAMILY:consolas;"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule(<span style="COLOR:blue;">new</span>&nbsp;Model.BusinessRules.<span style="COLOR:#2b91af;">ModelNumberValidationRule</span>(ModelNumberProperty)&nbsp;{&nbsp;Priority&nbsp;=&nbsp;3&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule(<span style="COLOR:blue;">new</span>&nbsp;Model.BusinessRules.<span style="COLOR:#2b91af;">ModelTypeOrderTypeValidationRule</span>(ModelNumberProperty)&nbsp;{&nbsp;Priority&nbsp;=&nbsp;3&nbsp;});</pre>
<pre style="FONT-FAMILY:consolas;">&nbsp;</pre>
<pre style="FONT-FAMILY:consolas;">&nbsp;</pre>
<p>Note that the priorities are the same.&nbsp; The ModelNumberValidation is the async rule.&nbsp; What is odd is that we were not getting the updates to the Model object from this rule unless I updated the context.Target referenced object directly.&nbsp; The Return types of Error, Warning, or Information&nbsp;would not come back at all.&nbsp; If I used the AffectedProperties and AddOutValue, nothing would return.&nbsp; When I added the CSLA projects to my debugging session, I found that when this rule completed and was firing the Completed Event handler, it was passing in the rule information for the ModelTypeOrderTypeValidationRule and processed incorrectly.&nbsp; I changed the priority levels so that ModelNumberValidation had a priority of 4 and everything worked.&nbsp; I haven&#39;t been able to find any documentation that shows that Async and Sync rules cannot be part of the same priority level or that they need to be added in a specific order.&nbsp; Did I miss this somewhere or is it a bug with the csla framework?&nbsp; We are referencing the 4.0.1 framework.</p>
<p>Model Hierarchy:</p>
<p>Order<br />-&gt;Lines<br />--&gt;Line<br />----&gt;Material</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 22, 2011</h2><p>This is a bug that was resolved in version 4.1.</p>
<p>4.0.1 was an early&nbsp;beta (or pre-beta) release, I don&#39;t recommend its continued use.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mosgath replied on Tuesday, February 22, 2011</h2><p>Thanks Rocky.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
