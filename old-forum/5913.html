<html><header><title>.NET Remoting and CustomErrors</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>.NET Remoting and CustomErrors</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5913.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Monday, December 01, 2008</h2><P><FONT face=Arial size=2>Hi, </FONT></P>
<P><FONT face=Arial size=2>I'm working with Csla 3.0.5 and am struggling with a concept here.&nbsp; It seems that if I throw an exception in my BO's DataPortal_XYZ, and try to catch it on the client, CustomErrors has to be set to "Off" or else I get:</FONT></P><FONT face=Courier size=2>
<P><FONT face=Verdana><STRONG>System.Runtime.Remoting.RemotingException: Server encountered an internal error. For more information, turn off customErrors in the server's .config file.</STRONG></FONT></P>
<P><FONT face=Arial>It seems that the tag in the &lt;system.web&gt; part of the web.config file is being read by the <SPAN class=searchword>remoting</SPAN> infrastructure&nbsp;to determine whether or not to flow remote exceptions to the caller. I find this very bizarre... why microsoft? why?</FONT></P>
<P><FONT face=Arial>I can't use "RemoteOnly" because my client doesn't sit on the same physical box as the RemotingHost.</FONT></P>
<P><FONT face=Arial>Is it typical to turn this off when using Csla's .NET Remoting?&nbsp; Isn't that bad practice?&nbsp; </FONT></P>
<P><FONT face=Arial></FONT>&nbsp;</P>
<P>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Tuesday, December 02, 2008</h2><P>Does anyone have any useful advice on this?&nbsp; I'd really like to know what other's have been doing to deal with this.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, December 02, 2008</h2><P><FONT face=Tahoma size=2>Well... I don't think this is an issue specific to CSLA.&nbsp;&nbsp;<FONT face=Tahoma size=2>I will say that I'm pretty sure&nbsp;it's not the remoting infrastructure that's reading the tag - it's the ASP.NET IIS process that's reading the tag.&nbsp; Given that, I suspect it has something to do with IIS parsing the request.&nbsp; There's really no difference between a "normal" HTTP request and a remoting HTTP request...</FONT></P></FONT>
<P><FONT face=Tahoma size=2>Plus, there's probably a somewhat-reasonable argument that says since this is a service, setting "CustomErrors" to "Off" doesn't really hurt.&nbsp; There's no UI to expose the ugly details to.&nbsp; So what does it hurt to turn it off?&nbsp; If someone happens upon your service from a browser, they are probably going to have a hard time actually getting the service to do anything.&nbsp; And if they want to write a program to access it, then you have to fall back on whatever security you've coded into your service - which, if it's externally accessible, should be pretty robust.</FONT></P>
<P><FONT face=Tahoma size=2>Ultimately, to get what you want, I don't see any other solution than the one you've found.&nbsp; But I'll admit my experience with remoting via IIS is limited.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Monday, December 08, 2008</h2>Thank you for your response.&nbsp; And yes, I didn't mean to phrase that in a way to blame Csla, it has to do with the core .NET components when using remoting.&nbsp; Your response helped me confirm my thoughts about this.&nbsp; Thanks!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 08, 2008</h2>I have in my web.config custom errors set to off, and the exceptions do flow back to the client.&nbsp; I didn't really muck around too much with configuration though.. I basically just took what the PTracker sample does and copied it line for line.<br><br>I'm not sure if that helps you or not though.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, December 08, 2008</h2><P>The ASP.NET custom errors setting shouldn't impact the data portal (much).</P>
<P>There are three categories of problem you can encounter using remoting (or WCF, or asmx, etc) with the data portal.</P>
<OL>
<LI>The connection from client to server can't be established or breaks</LI>
<LI>The ASP.NET server is unable to load Csla.dll</LI>
<LI>A problem occurs once the data portal is actually running on the server (note that 1 and 2 occur <EM>before the data portal starts running</EM>)</LI></OL>
<P>Issue 1 is purely a client-side exception handling thing.</P>
<P>Issue 2 may be affected by the ASP.NET custom errors setting, because this would be an ASP.NET failure. This should really only occur as you get your server set up - once it is running this should never happen.</P>
<P>Issue 3 is entirely handled by the data portal, and the ASP.NET custom errors setting should have absolutely no impact. When an exception occurs in the data portal, or in your server-side code, no "failure" is reported to ASP.NET. Instead, ASP.NET sees a successful result passed back to the client. That "successful result" actually contains a serialized exception, but ASP.NET and remoting are entirely unaware of that fact. Those technologies just see a binary blob, like they would for complete success.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AzStan replied on Thursday, December 02, 2010</h2><p>Here&#39;s some information regarding getting remote server&nbsp;dataportal exceptions&nbsp;when using the data portal with the remoting chanel.</p>
<p>If I understand Rocky&#39;s message, the dataportal should gracefully trap remote server exceptions and deliver them to the client wrapped in a DataPortalException.</p>
<p>I was getting the desired result on my developement workstation, but the exceptions were not being passed from my remote production server.&nbsp; When using the remote server, I would get&nbsp;a remoting exception, with the message: &quot;<span style="font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;font-size:11pt;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-hansi-theme-font:minor-latin;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;">Server encountered an internal error. For more information, turn off customErrors in the server&#39;s .config file.&quot;</span>&nbsp; The &#39;custom errors&#39; setting didn&#39;t seem to matter... until I noticed that there is another &#39;custom errors&#39; element available for configuring <span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">&lt;</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">system.runtime.remoting</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">&gt; </span></span>(different from the one in &lt;system.web&gt;. see: <a href="http://msdn.microsoft.com/en-us/library/z415cf9a(v=VS.71).aspx">http://msdn.microsoft.com/en-us/library/z415cf9a(v=VS.71).aspx</a>&nbsp;(or search for remoting settings schema).</p>
<p>When I set the <span style="font-size:x-small;"><span style="color:#0000ff;">&lt;</span><span style="color:#a31515;"><span style="color:#a31515;">system.runtime.remoting</span></span><span style="color:#0000ff;"><span style="color:#0000ff;">&gt; ...</span></span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">&lt;</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">customErrors</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"> </span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;">mode</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">=</span></span><span style="font-size:x-small;">&quot;</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">on</span></span><span style="font-size:x-small;">&quot;</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"> /&gt; &lt;/<span style="color:#a31515;"><span style="color:#a31515;">system.runtime.remoting</span></span><span style="color:#0000ff;"><span style="color:#0000ff;">&gt; </span></span></span></span>(psudo) element on my development machine, it acts like my production machine and won&#39;t pass any error information from the server data portal to the client. </p>
<p>When I set customErrors mode=&quot;off&quot; on my production machine, it passes exception information just as advertised.</p>
<p>i&#39;m a bit reluctant to set customErrors off on the production machine, even if it is just for the remoting channel, so this will probably spur&nbsp;me to configure WCF.&nbsp; Hopefully this information will help somebody still using remoting.</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
