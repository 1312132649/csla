<html><header><title>Business objects in inheritance tree don't serialize/deserialize correctly.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business objects in inheritance tree don't serialize/deserialize correctly.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6768.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jeremy.wiebe posted on Wednesday, April 08, 2009</h2>I got bit by an interesting problem the other day which may not be entirely a CSLA bug.  In our domain model we have a few instances where we have business objects that inherit from other business objects, which then inherit from BusinessBase(Of T).  In the base class we have defined some properties using the newer-style managed properties.  These properties are registered using a Shared initializer (ie. Private MyProp as PropertyInfo(Of String) = RegisterProperty(...))<br /><br />What I found is that after one of the inherited objects crosses a process boundary (we're using CSLA with the WCF portal) the property info cache in the PropertyInfoManager is not re-created properly.   What happens is that the Shared PropertyInfo()'s in the base class are not created prior to the OnDeserialized handler being called, which means that all of the PropertyInfo's in the base class are not indexed (they all remain with an INdex of -1).<br /><br />My solution is that in these few instances where we have inheritance in our business objects we create a Shared Sub New in the inherited class which accesses one of the shared PropertyInfo()'s in the base class.  This forces all of the Shared initializers in the base class to run and ends up happening prior to the re-indexing of properties.<br /><br />So, finally, to my questions.  <br />   Are we doing something wrong?  <br />   Is anybody else using inheritance in their business objects?<br /><br />One other solution I thought might work (but haven't tried) is to put all of the RegisterPRoperty calls into a Shared Sub New.  This would mean alot of changes to our existing code so I haven't investigated it.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 08, 2009</h2>What version of Csla are you using?&nbsp; If you're using 3.6.2, I think this shouldn't be a problem.&nbsp; If you're using anything prior, I think you'll need to search the forum for the _forceInit trick.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jeremy.wiebe replied on Wednesday, April 08, 2009</h2>We're using 3.6.0.   We'd been thinking of upgrading to the most recent release anyways, but if we don't at least I have an idea where to look. <br /><br />Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, April 08, 2009</h2>Andy is right.<br />Rocky finally addressed the issue in 3.6.2. So it really pays to upgrade - since you are on 3.6.0 the upgrade is extremely easy. I highly recommend you do so.<br /><br />The flip side is implementing the forceInit trick *in every class* in your entire hierarchy! <br /><br />Much easier to upgrade!!<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jeremy.wiebe replied on Thursday, April 09, 2009</h2>I've had to implement my fix I described above twice already and that's once to many!  :-)<br /><br />We'll probably upgrade shortly.  <br /><br />Thanks for the info.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Tuesday, May 12, 2009</h2><P>Joe, Andy, et al:</P>
<P>I am glad I saw this post before following the advice in Expert C# 2008 (page 248) and adding _forceinit to all my classes!</P>
<P>I didn't notice on the 3.6.2 change logs that Rocky had fixed this or how.&nbsp; So to confirm, you are saying I can now inherit from my own IRBBusinessBase&lt;T&gt; which itself inherits from BusinessBase&lt;T&gt; without any special stuff to do?</P>
<P>This is good news if it is the case because it made me nervous not having a place where I could put custom business logic that applied to all my classes.&nbsp; My old company edited the CSLA objects directly.&nbsp; UGH I was kicking myself for&nbsp;having done that&nbsp;because it made upgrading to newer CSLA releases too costly.</P>
<P>There are probably a&nbsp;bunch of people out there that bit the bullet and edited all of their classes to&nbsp;implement the _forceinit trick from&nbsp;the book.&nbsp; Was there a blog or something that lets them know this is no longer the case?</P>
<P>Thanks a million guys for your work!</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, May 13, 2009</h2>As I recall there were a few threads about it. I was always opposed to it. Luckily I was a bit behind on the "upgrade path" so I got to complain enough times that Rocky finally decided to address it. <br /><br />But I am sure there are some caveats to his fix. I can't recall them off the top of my head though. Maybe having to use Managed Properties was one of them so that Silverlight would work correctly. But that is just a guess.<br /><br />My big objection to the forceInit trick was that I have a deep hierarchy and I would have to implement it on every level of the hierarchy in every class. That was just unacceptable.<br /><br />Joe</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
