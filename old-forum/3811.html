<html><header><title>Non pumping wait error?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Non pumping wait error?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3811.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken posted on Tuesday, October 30, 2007</h2><P>What does this error message mean?&nbsp; Is it a CSLA issue? Or a windows one?&nbsp; What can I do?</P>
<P>I have a windows program that is a code generator, it builds classes, web pages, etc.&nbsp; But when I run it against a database with lots of tables, I get this error:</P>
<P>Managed Debugging Assistant 'ContextSwitchDeadlock' has detected a problem in 'D:\Source\ABCD\CodeGenerator\bin\Debug\Codegenerator.vshost.exe'.<BR>Additional Information: The CLR has been unable to transition from COM context 0x1b1c88 to COM context 0x1b1df8 for 60 seconds. The thread that owns the destination context/apartment is most likely either doing a non pumping wait or processing a very long running operation without pumping Windows messages. This situation generally has a negative performance impact and may even lead to the application becoming non responsive or memory usage accumulating continually over time. To avoid this problem, all single threaded apartment (STA) threads should use pumping wait primitives (such as CoWaitForMultipleHandles) and routinely pump messages during long running operations.<BR></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 30, 2007</h2>Hmm.. sounds like your log running operation should be put into a BackgroundWorker_DoWork method.&nbsp; Or manually create another thread to do the long running process.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, October 30, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Hmm.. sounds like your log running operation should be put into a BackgroundWorker_DoWork method.&nbsp; Or manually create another thread to do the long running process.<BR></div></BLOCKQUOTE></P>
<P>I'm guessing that BackgroundWorker is a class?&nbsp; I am <STRONG><EM>really</EM></STRONG> new to windows stuff.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 30, 2007</h2>Oh sorry.&nbsp; BackgroundWorker is a Forms component (its in the Components tab of your toolbox).&nbsp; So whatever form has the code that is long running you'll add this component to.&nbsp; Then you'll wire the BW's DoWork and RunWorkerCompleted; in DoWork, you'll perform the long running operation.&nbsp; In RWC (or something along those lines) you'll re-enable the form.&nbsp;&nbsp;&nbsp; The typical pattern is this:<br><br>private void button_click( object sender, EventArgs e ){<br>&nbsp; this.Enabled = false; // don't disable the whole form, but this is an exampel..<br>&nbsp; myBackgroundWorker.RunWorkerAsyn(); // or you can pass an object if you need arguments in DoWork<br>}<br><br>private void myBW_DoWork( object sender, DoWorkEventArgs e ) {<br>&nbsp;&nbsp; e.Result = DoLongRunningTask(); // Result is an object; so pass whatever you need to<br>}<br><br><br>private void myBW_RunWorkerAsyncComplete( object sender, RWAC e ) { // forget the exact name..<br>
&nbsp;&nbsp; string result = (string)e.Result; // Will throw an Exception if an exception was thrown in DoWork event<br>&nbsp;&nbsp; this.Enabled = true;<br>&nbsp;&nbsp; MessageBox.Show( "Done!" );<br>
}<br>
<br>
<br>That's the basics; check out the MSDN help topic for BackgroundWorker component, you'll find all the info you need.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, October 30, 2007</h2>Thanks!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
