<html><header><title>Extending EncapsulatedInvoke Example</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Extending EncapsulatedInvoke Example</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10126.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Harry posted on Friday, March 04, 2011</h2><p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">I am trying to extent the EncapsulatedInvoke example to us a MS SQL database rather than the Mock and SqlCe examples that are provided. <br />I have created a new project called DataAccess.Sql and have pretty much coped the code from the SqlCe project making what <br />I thought where suitable adjustments.</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">My AppConfig now looks like this:<br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; <br />&lt;configuration&gt; <br />&lt;appSettings&gt; <br />&lt;!--&lt;add key=&quot;DalManagerType&quot; value=&quot;DataAccess.Mock.DalManager,DataAccess.Mock&quot; /&gt;--&gt; <br />&lt;!--&lt;add key=&quot;DalManagerType&quot; value=&quot;DataAccess.SqlCe.DalManager,DataAccess.SqlCe&quot; /&gt;--&gt; <br />&lt;add key=&quot;DalManagerType&quot; value=&quot;DataAccess.Sql.DalManager,DataAccess.Sql&quot; /&gt; <br />&lt;/appSettings&gt; <br />&lt;connectionStrings&gt; <br />&lt;add name=&quot;LocalDb&quot; connectionString=&quot;Data Source=C:\Dev\csla\csla4\03-DataAccess-110221\EncapsulatedInvoke\WpfUI\LocalDb.sdf&quot; providerName=&quot;System.Data.SqlServerCe.3.5&quot; /&gt; <br />&lt;add name=&quot;MSSQL&quot; connectionString=&quot;Server=sunpharr;Database=SUN426;Trusted_Connection=True;&quot; /&gt; <br />&lt;/connectionStrings&gt; <br />&lt;/configuration&gt;</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">However the DalFactory.cs in the DataAccess project returns null for the _dalType when executing this line:</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">_dalType = Type.GetType(dalTypeName);</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Any suggestions where I may have gone wrong.<br />This is the code for my DataAccess.Sql-&gt;DalManager.cs</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br />using Csla.Data;<br />using System.Data.SqlClient;</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">namespace DataAccess.Sql <br />{<br />public class DalManager : DataAccess.IDalManager<br />{<br />private static string _typeMask = typeof(DalManager).FullName.Replace(&quot;DalManager&quot;, @&quot;{0}&quot;); <br />public T GetProvider&lt;T&gt;() where T : class<br />{<br />var typeName = string.Format(_typeMask, typeof(T).Name.Substring(1)); <br />var type = Type.GetType(typeName); <br />if (type != null) <br />return Activator.CreateInstance(type) as T; <br />else<br />throw new NotImplementedException(typeName); <br />}</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">public ConnectionManager&lt;SqlConnection&gt; ConnectionManager { get; private set; } <br />public DalManager() <br />{<br />ConnectionManager = ConnectionManager&lt;SqlConnection&gt;.GetManager(&quot;MSSQL&quot;); <br />}</span></span></span></span></span></span></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">public void Dispose() <br />{<br />ConnectionManager.Dispose();<br />ConnectionManager = null; <br />}<br />}<br />}</span></span></span></span></span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Harry replied on Saturday, March 05, 2011</h2><p>Well if you look long enough you can usually answer your own question :-)</p>
<p>The answer is I needed to copy the new DLL DataAccess.Sql.dll into the wpfUI\debug\bin directory. Somehow in Rocky&#39;s example he seems to do this automatically, anyone know how this is done?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Saturday, March 05, 2011</h2><p>There&#39;s a few ways; one is to reference the assembly.&nbsp; The other would be a post build event which manually copies the files.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, March 05, 2011</h2><p>In the sample solutions for the Data Access ebook I am referencing the projects, so Visual Studio copies the files into the right location.</p>
<p>Technically there&#39;s no need to reference the projects - assuming you have some <em>other</em> mechanism by which the DLL files get copied to the right folder. But (at least for demo purposes) the simplest solution is to add the reference.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
