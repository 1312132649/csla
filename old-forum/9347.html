<html><header><title>[Transactional(TransactionalTypes.TransactionScope)]</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>[Transactional(TransactionalTypes.TransactionScope)]</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9347.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly posted on Tuesday, August 10, 2010</h2><p>I just noticed that <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>[</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Transactional</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">TransactionalTypes</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.TransactionScope)] has stopped working.. It is saving parent even if the child is throwing error (custom error)..</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">My methods are marked with proper attribute i.e.</span></span></p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>[</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span>
<p><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Transactional</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">TransactionalTypes</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.TransactionScope)]<font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">protected</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">override</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void&nbsp;</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">DataPortal_Update()</span></span></p>
</p>
<p>and child is updated via :- <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>FieldManager.UpdateChildren(</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">this</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">);</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">with nothing mentioned in child collection...</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Is it anything to do with the way connection is created bcos i&#39;m not using csla connection facility..</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Wednesday, August 11, 2010</h2><p>can anybody help on this..</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 11, 2010</h2><p>I just made sure the TransactionScope unit test code is working, and it runs fine.</p>
<p>It doesn&#39;t matter if you use the Csla.Data helpers. If you have the Transactional attribute on your root object&#39;s data methods, all data access in that root or its child objects will be wrapped in a TransactionScope.</p>
<p>If an exception bubbles up from any of that code, that&#39;ll cause a rollback. The exception needs to flow back to the client of course.</p>
<p>TransactionScope only works with SQL Server (2005 and higher iirc).</p>
<p>If you open more than one connection to the database that&#39;ll cause .NET to use the Distributed Transaction Coordinator (DTC) to manage a distributed transaction. This usually causes an exception because the DTC is turned off by default. I&#39;ve never tested to see if TransactionScope does the correct thing when it hits this condition (fails to access DTC) - but I assume Microsoft has tested that scenario.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Thursday, August 12, 2010</h2><p>server is 2005 only. and there are no err msgs from DTC..</p>
<p>unfortunately the problem is still there.. can you guide me on what other things i can check to rectify this issue. </p>
<p>FYI.. i&#39;m using following in my connection string to ensure that dtc is not turned on.. do u think this makes any difference..<span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">
<p>Enlist=false</p>
</span></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, August 12, 2010</h2><p>I suspect you are telling the connection to enlist in no transactions, so yes, I think that makes a difference <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>You can&#39;t have transactional protection if you are explicitly not in a transaction.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Friday, August 13, 2010</h2><p>although my question is answered.. i hv a similar query on the same line, which is actually not related with csla..</p>
<p>i made this setting thinking that it will stop the connection from going in DTC mode.. can you pls advs on how we can do that..</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, August 13, 2010</h2><p>The DTC kicks in whenever you enlist more than one resource in a transaction.&nbsp; From a database perspective, that&#39;s any time you&nbsp;open more than one connection to the database and associate it with your TransactionScope&nbsp;- <em>even if you use the same connection string</em>.&nbsp; That&#39;s the main purpose of the&nbsp;database connection manager in CSLA -&nbsp;it lets you re-use an existing (and already open) connection so that the DTC doesn&#39;t kick in.</p>
<p>HTH</p>
<p>- Scott</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
