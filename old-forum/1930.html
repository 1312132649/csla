<html><header><title>CSLA Filtering but over multiple Properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA Filtering but over multiple Properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1930.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>krtek posted on Friday, December 08, 2006</h2>First of all, sorry about my english. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>I have a little problem. In ASP.NET application using CSLA I need to filter data before binding<br>them to the grid. For this puprose I find FilteredBindingList class. <br>But this class only allow me to filter using one property. Is there any way how to filter over <br>more properities.<br><br>Thanks Petr<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, December 08, 2006</h2><P>Brian Criswell has built a great control named ObjectListView which can do this.</P>
<P>I use it for sorting and filtering. He did a great job with it - I recommend it highly.</P>
<P>I think if you go to this page and download the latest file it is included as part of the overall project.</P>
<P>I split it out into a separate project on my C: drive and compiled it and then added the .dll as a reference to my main project. </P>
<P><A href="http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx">http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx</A></P>
<P>&nbsp;</P>
<P>I added some code to my project to make calling the ObjectListView simple:</P><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetObjectListView(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> list </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IList, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> props() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> directions() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ListSortDirection) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ObjectListView<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> list </FONT><FONT color=#0000ff size=2>IsNot</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> list.Count &gt; 0 </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> sort </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> System.Text.StringBuilder<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> i </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = 0 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> props.GetUpperBound(0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> sort.Length &gt; 0 </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>sort.Append(</FONT><FONT color=#ff00ff size=2>", "</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>sort.Append(props(i))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> directions(i) = ListSortDirection.Descending </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>sort.Append(</FONT><FONT color=#ff00ff size=2>" DESC"</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Next<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> ObjectListView(list, sort.ToString())<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetObjectListView(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> list </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IList, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> prop </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> direction </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ListSortDirection) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ObjectListView<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> list </FONT><FONT color=#0000ff size=2>IsNot</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> list.Count &gt; 0 </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dir </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>""<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> direction = ListSortDirection.Descending </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>dir = </FONT><FONT color=#ff00ff size=2>" DESC"<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> ObjectListView(list, prop &amp; dir)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>&nbsp;</P>
<P>You can then call it like this from the UI:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mSortedList </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ObjectListView</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'Using the ObjectListView, single Property sorting is 1 line of code: <BR></FONT><FONT size=2>mSortedList = ePayUtil.GetObjectListView(mSomeList, mSort, mSortDirection)<BR>dgAcct.DataSource = mSortedList<BR>dgAcct.CurrentPageIndex = </FONT><FONT color=#0000ff size=2>CInt</FONT><FONT size=2>(ViewState(</FONT><FONT color=#ff00ff size=2>"pageIndex"</FONT><FONT size=2>))<BR>DataBind()</P>
<P></FONT><FONT color=#008000 size=2>'multiple property sorting requires 3 lines of code - you need to build 2 arrays and call a function:<BR></FONT><FONT color=#008000 size=2>'Dim props() As String = {"fname", "lname"}<BR></FONT><FONT color=#008000 size=2>'Dim directions() As ListSortDirection = {ListSortDirection.Ascending, ListSortDirection.Descending}<BR></FONT><FONT color=#008000 size=2>'mSortedList = ePayUtil.GetObjectListView(mSomeList, props, directions)</P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, December 08, 2006</h2>I should probably add that filtering with the ObjectListView is basically the same as the System.Data.DataView in that it has a Filter property that takes SQL syntax.&nbsp; For example:<br><br>MyList list = MyList.GetMyList();<br>ObjectListView view = new ObjectListView(list);<br>view.Filter = "StartDate &gt; '20030401' or Id in (5, 6, 8) or Active = True";<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brembot replied on Tuesday, December 19, 2006</h2><font face="Tahoma"><font size="2">I haven't&nbsp; use <font color="#000080"><b>ObjectListView</b></font> before and it is highly recommended to some users in this forum if you have complex filtering in your application. Right now, i used <font color="#000080"><b>Csla.FilteredBindingList</b></font> and it works great. The changes i made to the filtered collection is also reflected to the source collection and i find it cool. Until the time i need to filter multiple properties and i find it difficult to implement it. I have some Q below.<br><br>1. Is ObjectListView works the same as DataView? What I mean is that if you have modification to the filtered collection it will be reflected also to the source collection?<br>2. I wonder why ObjectListView is not incorporate to the Csla Framework so that we can have one assembly? I think Rocky would appreciate you guys in helping Csla Framework.<br><br>Thanks and Merry Christmas<br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Tuesday, December 19, 2006</h2>This is my point of view in #2 and its quiet OT, leave Csla Framework *as-is*, it would be much better to have another framework/library that contains all the extended features for Csla (like ObjectListView) and for sure this framework/library are efforts made by the community/people using Csla. :-) <br><br>Again it all depends on Rocky and the author of ObjectListView if they agreed to incorporate it. <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Thursday, December 21, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>brembot:</strong></div><div><font face="Tahoma"><font size="2">I haven't&nbsp; use <font color="#000080"><b>ObjectListView</b></font> before and it is highly recommended to some users in this forum if you have complex filtering in your application. Right now, i used <font color="#000080"><b>Csla.FilteredBindingList</b></font> and it works great. The changes i made to the filtered collection is also reflected to the source collection and i find it cool. Until the time i need to filter multiple properties and i find it difficult to implement it. I have some Q below.<br><br>1. Is ObjectListView works the same as DataView? What I mean is that if you have modification to the filtered collection it will be reflected also to the source collection?<br>2. I wonder why ObjectListView is not incorporate to the Csla Framework so that we can have one assembly? I think Rocky would appreciate you guys in helping Csla Framework.<br><br>Thanks and Merry Christmas<br></font></font></div></BLOCKQUOTE><br>I have made the ObjectListView behave like the DataView as much as possible.&nbsp; If you make a modification, it will pass that change down to the underlying list item.&nbsp; It also has two methods of modifying sorting.&nbsp; The business object in the list can implement an interface or the user of the ObjectListView can listen to an event and modifying sorting comparisons from there.&nbsp; This means that you can have your business objects expose dates as strings for simple databinding, but it will sort properly as a date instead of as a string.<br><br>As for 2, this question comes up periodically.&nbsp; I personally would have no problem with it being in the CSLA framework as this is my way of giving back to the community, but Rocky has stated in the past that CSLA is not an open source project with multiple contributors.&nbsp; Instead, he has provided a place to share our modifications in CSLAcontrib, which may grow and evolve over time.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kayakheaven replied on Thursday, January 11, 2007</h2><div>Brian when you say "have your business objects expose dates as strings for simple 
databinding, but it will sort properly as a date instead of as a string." Does 
that apply to both or one or other of the two methods of sorting (interface and 
event)? This is a really important point, can you summarize how this works? <br><br>Moving to object-oriented programming from data-centric programming (e.g. ADO.NET Datasets and DataTables) means we lose the behaviour associated with DB nullable values displaying as blank, which is quite useful so I'm very curious to know how this is supported.<br></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Thursday, January 11, 2007</h2>There are two ways of extending the sort to change how a property is sorted by the ObjectListView, the IExtendSort interface and the ExtendSort event.<br><br>IExtendSort is used by objects that know that one of their properties should be sorted by a different manner than the property's IComparable implementation.&nbsp; An object implements the interface, and when the interface's method is called, the object's implementation of the method checks to see if the property being sorted is one that it needs to modify. An example would be for a StartDate property exposed as a string but internally a SmartDate.<br><br>object IExtendSort.GetSortValue(PropertyDescriptor property, object value)<br>{<br>&nbsp;&nbsp;&nbsp; switch (property.PropertyName)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  case "StartDate":<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  return _startDate.Date;<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; return value;<br>}<br><br>So if the list of this object was sorting by StartDate, the method would return an actual date instead.&nbsp; This would then sort properly by date.&nbsp; Sorting by any other property would just return the value passed in to the method.<br><br>The ExtendSort event is for modifying the sorting of lists that you do not have control over.&nbsp; So a list of objects from a third party library or an enumeration could be sorted in this manner.&nbsp; In this case the event handler would modify a property on the event arg instead of returning a value.<br><br>With these methods you can return any value (including "null" values) when a specific property is sorted.&nbsp; The only restriction is that for any property you modify the sort of, you should make sure that the type does not change.&nbsp; In the example the StartDate sort always returns a DateTime.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, December 08, 2006</h2>I believe you could pass an array with all the values you need to the filter method and handle that in your filter provider. You could even pass an object that has properties with values that you want to use for filtering.<br><br>Andrés<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
