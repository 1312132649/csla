<html><header><title>CSLA n-tier with Enterprise Library Logging to DB</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA n-tier with Enterprise Library Logging to DB</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9027.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so posted on Thursday, June 03, 2010</h2><p>We have Enterprise Library logging set up to log our CSLA objects. We want to capture some of the errors to the database. This works fine when we are running everything local.</p>
<p>Once we enable the CSLA WCF data portal to switch to a 3-tiers model, the logging to database no longer works on the client side, because in the Enterprise Library config, it simply specifies a stored procedure name that saves the log entry, but now the client has no more direct access to the database.</p>
<p>I am wondering if anyone encountered the same problem and had a workaround for it.</p>
<p>&nbsp;</p>
<p>All I can think of now, is to wrap the Enterprise Library LogEntry and Logger as CSLA object, and do a call to the same CSLA WCF data portal whenever we need to save to a database. Any comments on this approach?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, June 03, 2010</h2><p>What I have done is create a specific database for logging.&nbsp; I then setup a connectionstring on the client side &amp; server side&nbsp;that only has rights to execute the log entry stored procedure.&nbsp; If the user was able to figure out the password, all they would be able to do is add more logs.&nbsp; I don&#39;t know if this is the best approach, but it works.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so replied on Friday, June 04, 2010</h2><p>Thx, that&#39;s a simple working solution. <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>Some of these logs will be for audit purposes, hence although unlikely, users being able to insert more logs is not a preferred outcome.</p>
<p>I have read that we can create a custom TraceListener that logs to service instead of the DB, has anyone had experience implementing this or can give me some references to look to?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>k2so replied on Thursday, July 15, 2010</h2><p>Just want to post the solution I implemented if for others to find useful.</p>
<p>I ended up implementing the custom TraceListener (WcfDbTraceListener), which is contains a CSLA business object (WcfLogEntry). All WcfDbTraceListener is doing is to instantiate the WcfLogEntry, then call a save whenever the Write is called. By doing it this way, all logs would be logged to whichever app server and database we decide to switch to and all existing logging code can remain, all that we need to do is to switch (specified in the app.config) from DBTraceListener to WcfDbTraceListener on the client side.</p>
<p>The WcfLogEntry is a wrapper to the original LogEntry, with all properties defined in the CSLA way.</p>
<p>Creating a Custom Trace Listener: <a href="http://msdn.microsoft.com/en-us/library/ff648533.aspx">http://msdn.microsoft.com/en-us/library/ff648533.aspx</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
