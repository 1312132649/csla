<html><header><title>Dynamic List vs Editable Root List</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic List vs Editable Root List</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11468.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 posted on Wednesday, July 11, 2012</h2><p>Our project is using CSLA 4 and CodeSmith to generate.&nbsp;&nbsp;The task I have to solve is for a list of editable objects that can be used in a multi user situation.&nbsp; Each user will see the same list; however any one item will only be edited by one user.&nbsp; i.e. list of tasks to complete and each user of the system will only update his/her task.&nbsp; BUT, the UI will not do auto-saves on exit of the row.&nbsp; There will be a specific save button.</p>
<p>Somewhere on this forum, I thought I read that I should use a Dynamic List/ Dynamic Root if auto save is expected as a user leaves a row and otherwise to use the EditableRootList/EditableChild, but I can&#39;t seem to find that again.</p>
<p>So I created an EditableRootList with EditableChild items.&nbsp; But when the save is called on the EditableRootList, the code fails in the DataPortal_Update() method of the list&nbsp;in the For index As Integer = 0 to Items.Count -1 block on the .Save() call.&nbsp; It states that a child cannot be directly saved.</p>
<p>So, the real question is what CSLA object set do I use if I want to save individual objects in a list but not necessarily as a user leaves the focus of a row.&nbsp; Of course, the other users in the system will need to update their lists too without concurrency check failures (unless they do actually change a child object someone else is working on). </p>
<p>Thanks</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 11, 2012</h2><p>I ran into the first time I&#39;ve ever needed to use an editable root list just recently (using a dynamiclistbase descendent).&nbsp; I may be wrong but you might be mixing concepts - you refer to an EditableRootList but it almost sounds like you&#39;re using child objects (you refer to EditableChild).</p>
<p>When fetching an editablerootlist, my understanding is that you&#39;re wanting the root list to basically do the fetch for the entire list - so you&#39;re either passing dto&#39;s or a datareader into a factory method of the editable roots in the list and then adding the editable roots to the collection.&nbsp; You don&#39;t want to do a FetchChild in the factory method for the editable roots, as that will mark them as children - it sounds like your items in your collection are children and you&#39;re trying to save them individually.</p>
<p>Child objects get saved through a child update that occurs when you save their parent, you can&#39;t call Save() on them directly.&nbsp; Root objects, of course, you do call save on them.</p>
<p>Hopefully I didn&#39;t misunderstand your question and state things you already knew.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 11, 2012</h2><p>A dynamic list contains root objects, not child objects. Each root object is saved automatically as the user changes focus off the row in the datagrid. The dynamic list base class detects the data binding notification telling it that the user has moved off the row and it updates that specific root object. Each individual root object is saved individually, not as a batch.</p>
<p>A normal business list contains child objects, not root objects. The items in a list are saved when the list is saved with an explicit call to Save on the list. The child objects are saved as a batch - all at once.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Thursday, July 12, 2012</h2><p>Skagen00</p>
<p>You did not misunderstand and when I first read the post that indicated that I needed to mix Editable Root List and Editable Child, I was surprised, but I have learned that CSLA sometimes has surprising things and have mostly stopped questioning &quot;why&quot; and just try to understand &quot;How&quot;.</p>
<p>I know there is a post on this forum (saw it 2 days ago) that said that if you want to update as you leave a grid row, you use Dynamic List and its partner (whatever that is).&nbsp; The post went on to say that if you don&#39;t want the grid to auto post to the database as you leave the UI Grid Row, that you use Editable Root List and an Editable Child.&nbsp; While it baffled me, I wasn&#39;t having success doing what I was doing so I gave it a try.&nbsp; It doesn&#39;t work -- as you stated, its a mix match of types.</p>
<p>&nbsp;</p>
<p>Rocky</p>
<p>I still don&#39;t really get what I need to use.&nbsp; Our UI, for nearly all screens of a similar nature, use a Save button and thus we want to stay consistent.&nbsp; However, I cannot have a EditableRoot and an EditableChildList/EditableChild collection on it&nbsp;becaue the Editable Root save will change the concurrency flag and mess up the multi-user situation.&nbsp; </p>
<p>As stated above, the situation is that I have a list of tasks that multiple users on multiple machines need to edit.&nbsp; Each user will only operate on tasks they have started and others will work on other tasks.&nbsp; Each machine needs to be able to save the list and update all tasks that have changed on that machine.&nbsp; On another machine, their save needs to update all the tasks that changed there.&nbsp; Is there a set of CSLA objects that can support this?</p>
<p>As an aside, it seems odd to me (here I&nbsp;am asking Why again)&nbsp;that the CSLA framework is somewhat tightly coupled to the UI implementation with regards to Dynamic types.&nbsp; OUR patterns and pratices are, to every extent possible, decouple the implementation of the UI from the business and its data.&nbsp; We are using MEF, WPF, CSLA, DAL&#39;s and other technologies and patterns to avoid the business layer from needing to be aware of UI implementation and here is CSLA having the business layer respond to specific UI events.&nbsp; Not meaning to be critical only seems like a departure.</p>
<p>&nbsp;</p>
<p>Oh, thank you for allowing me to edit my post!&nbsp; :)&nbsp; Is there a summary of the CSLA types, and what they work on/with?&nbsp; I know the book exists and have been through it a great deal, but a &quot;site map&quot; of the various CSLA objects all together (similar to the .NET library wall&nbsp;map that occasionally gets published).&nbsp; While the book can be great, there are somethings that I cannot find.&nbsp; I have seen in the book Dynamic Root List and Dynamic Root; however, on the forum there are mention of other Dynamic ... Base that I haven&#39;t found in the book.&nbsp; Just looking for a quick reference.&nbsp; Thanks</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 12, 2012</h2><p>CSLA is designed to support the creation of business objects that match the user scenarios (stories, use cases - whatever you want to call them) necessary for the application to meet the needs of the user. This is behavioral responsibility-driven object design.</p>
<p>Of course the UI is also designed to support the user scenarios. So it shouldn&#39;t be surprising to find that the object model and the UX are similar - they are both designed around the user scenario.</p>
<p>This is _unlike_ a typical ORM or data model, which isn&#39;t designed around user scenarios, but instead is designed around data integrity and the ability to use data effeciently across _many_ user scenarios. Totally different design priorities.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 12, 2012</h2><p>To your concurrency question - that is a challenge in _any_ modern platform. This is because all modern platforms assume n-tier or SOA architectures, and so don&#39;t lock data in the database while it is used by a user. Additionally, modern platforms (for the past 17+ years) assume stateless servers, and exist in a networking environment where servers can&#39;t arbitrarily contact clients (because clients often have non-routable IP addresses).</p>
<p>The problem isn&#39;t unique to CSLA, nor are the array of solutions. Sadly, none of the solutions are particularly easy to implement.</p>
<p>The &#39;Using CSLA 4: Data Access&#39; book shows how to implement optimistic concurrency using timestamp values. This is the most common, and usually most efficient, solution for concurrency.</p>
<p>But it sounds like you also want change notification across clients. That&#39;s a harder problem to solve, because the .NET platform doesn&#39;t provide a built-in solution for all the networking issues you&#39;ll face. What you need is a publish/subscribe technology that can communicate with non-routable IP addresses. Microsoft _does_ have one solution - the Azure Service Bus. But to use that you need to use Azure (fwiw, the service bus is _really_ cool, and if you are open to using Azure you should look at it!!).</p>
<p>The most common solution is to implement what&#39;s called &quot;long polling&quot; from the client. You can do this by using one of the WCF HTTP dual channels (not with the data portal - but with your own service), because they implement long polling to achieve efficient bi-directional communication between a client and server.</p>
<p>You can implement it yourself too&nbsp;- it isn&#39;t that terribly hard. Basically the client makes a service call with a long timeout (90 seconds or so). If the service has data for the client it returns it, and the client immediately re-calls the service. If the service doesn&#39;t have data, it doesn&#39;t return, allowing the client to timeout after 90 seconds. The client then re-calls the service.</p>
<p>This keeps the polling volume low (little overhead), and results in essentially instant transmission of data from the server to the client.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Thursday, July 12, 2012</h2><p>Thanks Rocky,</p>
<p>The UI guys are handling the freshness of the loaded objects and that sort of thing.&nbsp; I am only baffled by which meta-types (Editable Root List/Editable Root, Dynamic Root List/Dynamic Root, etc) that I should use to support the UI developers.&nbsp; I just need a list/object pair that I can load and save where it only saves the dirty objects from the list and where it doesn&#39;t update a concurrency flag on some parent object that causes issue with the other lists on the system.&nbsp; This is also not a web app.&nbsp; We actually use the timestamp of SQL Server for our concurrency and not a datetime stamp.&nbsp; The timestamp is handled by SQL Server vs our having to manually handle datetime and throw errors.</p>
<p>In earlier versions of CSLA, I recall the &quot;Update&quot; call of an Editable Root List to check for &quot;is dirty&quot; when saving the parent object and thus not breaking concurrency; I suppose we could use that approach.&nbsp; Thus the root object doesn&#39;t get updated but its child objects that are dirty could get updated?&nbsp; </p>
<p>I dunno!&nbsp; This seems like an outlier scenario.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 12, 2012</h2><p>If you are following the techniques shown in the samples and in the &#39;Using CSLA 4&#39; books, when you save an editable root list, only the child objects that are dirty will be saved to the database. If the list itself saves any data to the database, that would be becuase your DAL did it - clearly your choice.</p>
<p>The way editable root list and editable child objects work hasn&#39;t changed in any meaningful way since 2001.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Thursday, July 12, 2012</h2><p>Well, that goes back to my original post then.&nbsp; It indicated that I was using an Editable Root List with Editable Child objects and the save fails because I &quot;cant save a child object directly&quot;.&nbsp; I am calling save on my Editable Root List which itterates over the child objects and calls save on them.&nbsp; </p>
<p>Another poster indicated that I was mixing types and probably shouldn&#39;t.&nbsp; </p>
<p>I will dive back into the book(s), but my book search thus far has not proven helpful - thus I am on the forums.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 12, 2012</h2><p>It is true, you can&#39;t save a child directly. But when you save the list, only the changed child objects (new, dirty, or deleted) will be updated by the DAL. All changed child objects are saved as a batch, normally within a transaction on the server.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Thursday, July 12, 2012</h2><p>AH HAH!&nbsp; I was in the wrong book</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
