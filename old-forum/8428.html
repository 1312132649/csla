<html><header><title>edit level mismatch in UndoChanges issue (parent/child)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>edit level mismatch in UndoChanges issue (parent/child)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8428.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cptcrash80 posted on Thursday, January 28, 2010</h2>I'm currently having a problem getting the n-level undo working properly on one of our windows forms. We have a business object that is set up in the following manner:<br><br>&lt;Item&gt; (inherits Csla.BuisnessBase)<br>&nbsp;&nbsp;&nbsp; &lt;DrillItemCollection&gt; (inherits Csla.BusinessListBase)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DrillItem&gt; (inherits Csla.BusinessBase, uses MarkAsChild())<br><br>Our initial edit form takes an instance of the Item object. When the form is loaded we set up some simple databinding for some text values on the object, mapping the properties to a couple textboxes. We do not however use databinding for the child collection. It is just assigned to a listbox as the data source. Our secondary edit form takes an instance of DrillItem. The 2 properties of DrillItem are databound to a couple textboxes. NOTE: We are not using a Csla bindingSource, we are doing our databinding in the following fashion:<br><br>textBoxLabel.DataBindings.Add(new Binding("Text", PluginModel, "Label") { DataSourceUpdateMode = DataSourceUpdateMode.OnPropertyChanged });<br><br>The creation methods look similar to this:<br><br>private Item _item;<br>public InitialForm(Item item)<br>{<br><div>_item = item;<br>_item.BeginEdit();<br></div>}<br><br>void okButtonClick(object sender, EventArgs e)<br>{<br><div>_item.ApplyEdit();<br></div>}<br><br>void cancelButtonClick(object sender, EventArgs e)<br>{<br><div>_item.CancelEdit();<br></div>}<br><br>and the secondary form:<br><br>private DrillItem _drill;<br>public SecondForm(DrillItem drill)<br>{<br><div>_drill = drill;<br>_drill.BeginEdit();<br></div>}<br><br>void okButtonClick(object sender, EventArgs e)<br>
{<br>
<div>_drill.ApplyEdit();<br></div>
}<br>
<br>
void cancelButtonClick(object sender, EventArgs e)<br>
{<br>
<div>_drill.CancelEdit();<br></div>
}<br><br>I have tried the following configurations:<br><ul><li>Called BeginEdit(), CancelEdit(), and ApplyEdit() on only the Item object</li><li>Called BeginEdit(), CancelEdit(), and ApplyEdit() on only the DrillItem 
object</li><li>Called BeginEdit(), CancelEdit(), and ApplyEdit() on both objects</li></ul><br>The issue that I'm running into is any time the cancel button is used on the InitialForm after a DrillItem has been modified and the changes have been accepted a "edit level mismatch in UndoChanges" error is thrown. Am I implementing the edit functions properly, or is there something else that needs to be done?<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
