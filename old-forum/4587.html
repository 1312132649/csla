<html><header><title>Adding new child to collection property without setting property?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Adding new child to collection property without setting property?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4587.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>preludecrazy posted on Sunday, March 30, 2008</h2><FONT color=#008080 size=2>
<P><FONT face=Arial color=#000000>Hi.</FONT></P>
<P><FONT face=Arial color=#000000>My CompanyCollection (BusinessListBase) class contains Company children which derives from LiteCompany (BusinessBase).&nbsp; My Company child class has a&nbsp;member/property of type WebsiteCollection (BusinessListBase).&nbsp; The WebsiteCollection member/property looks like this in my Company class:</FONT></P><FONT color=#0000ff size=2>
<P><FONT face="Courier New">private</FONT></FONT><FONT face="Courier New"><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>WebsiteCollection</FONT><FONT color=#000000 size=2> mobjWebsiteCollection = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2><FONT color=#000000>;</FONT></P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New" color=#000000>[</FONT></FONT><FONT face="Courier New"><FONT color=#008080 size=2>MyDataMemberAttribute</FONT><FONT color=#000000 size=2>(</FONT><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>)</FONT><FONT color=#000000>]</FONT><BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>WebsiteCollection</FONT></FONT><FONT size=2><FONT face="Courier New"> <FONT color=#000000>WebsiteCollection</FONT><BR></FONT><FONT face="Courier New">{<BR></FONT><FONT face="Courier New">&nbsp;<FONT color=#000000>[System.Runtime.CompilerServices.</FONT></FONT></FONT><FONT face="Courier New"><FONT color=#008080 size=2>MethodImpl</FONT><FONT color=#000000 size=2>(System.Runtime.CompilerServices.</FONT><FONT color=#008080 size=2>MethodImplOptions</FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>.NoInlining)]</FONT><BR></FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;get<BR></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>&nbsp;{</FONT><BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>CanReadProperty(</FONT></FONT></FONT><FONT face="Courier New" color=#0000ff size=2>true</FONT><FONT size=2><FONT face="Courier New" color=#000000>);<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp; return</FONT><FONT size=2> <FONT color=#000000>(mobjWebsiteCollection ==</FONT> </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2><FONT color=#000000>)</FONT> <FONT color=#000000>?</FONT></FONT><FONT color=#008080 size=2><FONT color=#000000>&nbsp;</FONT>WebsiteCollection</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>.NewWebsiteCollection() : mobjWebsiteCollection;<BR>&nbsp;</FONT></FONT><FONT color=#000000><FONT size=2><FONT face="Courier New">}<BR>&nbsp;</FONT></FONT><FONT size=2><FONT face="Courier New">[System.Runtime.CompilerServices.</FONT></FONT></FONT><FONT face="Courier New"><FONT color=#008080 size=2>MethodImpl</FONT><FONT color=#000000 size=2>(System.Runtime.CompilerServices.</FONT><FONT color=#008080 size=2>MethodImplOptions</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>.NoInlining)]<BR></FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;set<BR></FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>&nbsp;{<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp; if</FONT><FONT size=2> <FONT color=#000000>(mobjWebsiteCollection !=</FONT> </FONT><FONT color=#0000ff size=2>value</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>)<BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>{<BR></FONT></FONT><FONT face="Courier New" color=#000000>&nbsp;&nbsp; mobjWebsiteCollection = </FONT></FONT><FONT face="Courier New" color=#0000ff size=2>value</FONT><FONT size=2><FONT face="Courier New" color=#000000>;<BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>&nbsp;PropertyHasChanged();<BR></FONT></FONT><FONT face="Courier New" color=#000000>&nbsp; }<BR></FONT><FONT color=#000000><FONT face="Courier New">&nbsp;}<BR></FONT><FONT face="Courier New">}</FONT></FONT></P></FONT>
<P><FONT face=Arial color=#000000><FONT color=#000000>The DataPortal</FONT>_Fetch method in Company contains the following, which populates the WebsiteCollection:</FONT></P>
<P><FONT face="Courier New">WebsiteCollection</FONT></FONT><FONT face="Courier New"><FONT size=2> objWebsiteCollection = </FONT><FONT color=#008080 size=2>WebsiteCollection</FONT><FONT size=2>.GetWebsiteCollection(criteria.CompanyID, criteria.WebsiteID);<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>for</FONT><FONT color=#000000 size=2> (</FONT><FONT color=#0000ff size=2>int</FONT><FONT color=#000000 size=2>&nbsp;ii = 0;&nbsp;ii &lt;= </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2><FONT color=#000000>.Count; ii++)<BR></FONT><FONT color=#000000>{<BR></FONT></FONT><FONT color=#0000ff size=2>&nbsp;foreach</FONT><FONT size=2> <FONT color=#000000>(</FONT></FONT><FONT color=#008080 size=2>Website</FONT><FONT size=2> <FONT color=#000000>objWebsite </FONT></FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> <FONT color=#000000>objWebsiteCollection)<BR></FONT>&nbsp;<FONT color=#000000>{</FONT><BR></FONT><FONT color=#0000ff size=2>&nbsp; if</FONT><FONT size=2> <FONT color=#000000>(objWebsite.CompanyID == </FONT></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2><FONT color=#000000>[ii].CompanyID)<BR></FONT>&nbsp;<FONT color=#000000> {</FONT><BR></FONT><FONT color=#008080 size=2>&nbsp;&nbsp; WebsiteCollection</FONT><FONT size=2> <FONT color=#000000>objWC =</FONT> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2><FONT color=#000000>[ii].WebsiteCollection;<BR></FONT>&nbsp;&nbsp;<FONT color=#000000> objWC.Add(objWebsite);<BR></FONT></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp; <FONT color=#ff0000>this</FONT></FONT><FONT size=2><FONT color=#ff0000>[ii].WebsiteCollection = objWC</FONT><FONT color=#ff0000>;</FONT><BR><FONT color=#000000>&nbsp; }<BR>&nbsp;}<BR>}</FONT></P>
<P></FONT></FONT></FONT><FONT face=Arial color=#000000 size=2>This works fine, except, due to the line&nbsp;above in red;&nbsp;the child's&nbsp;IsDirty flag is set to true in WebsiteCollection, this is because I'm setting the Company.WebsiteCollection property.&nbsp; How can I add to the current Company child's WebsiteCollection without setting the property?&nbsp; I was hoping I could do something like <FONT face="Courier New"><FONT face=Arial>'</FONT><FONT color=#0000ff>this</FONT>[ii].<FONT color=#008080>WebsiteCollection</FONT>.Add(objWebsite);</FONT>', but that doesn't work.</FONT></P>
<P><FONT face=Arial size=2>Please can somebody tell me where I'm going wrong?</FONT></P>
<P><FONT face=Arial size=2>Thanks.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, March 30, 2008</h2><P>Normally the property for a child object is read-only. You don't want the UI developer to accidentally alter your child out from under you! CSLA doesn't support that by itself - you'd have to make <EM>very sure</EM> to handle that event properly!!!</P>
<P>If the property is read-only as recommended, then your data portal code won't compile - which is good - you shouldn't be setting the property. Instead, you should be setting the <EM>backing</EM> <EM>field</EM> for the property. Look at Chapters 7/8 and ProjectTracker.Library for numerous examples.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Sunday, March 30, 2008</h2><P><FONT face=Tahoma size=2>Using something like this:</FONT></P>
<P><FONT face="Courier New"><FONT size=2><FONT color=#0000ff>return</FONT> <FONT color=#000000>(mobjWebsiteCollection ==</FONT> <FONT color=#0000ff>null</FONT><FONT color=#000000>)</FONT> <FONT color=#000000>?</FONT><FONT color=#008080><FONT color=#000000>&nbsp;</FONT>WebsiteCollection</FONT><FONT color=#000000>.NewWebsiteCollection() : mobjWebsiteCollection;</FONT></FONT></FONT></P>
<P><FONT face=Tahoma size=2>presents a problem, since you create a new collection but never assign it to "mobjWebsiteCollection".&nbsp; Thus, every time you try to "get" your collection, you're potentially getting a new one.&nbsp; I'm guessing that's why your original code doesn't work.</FONT></P>
<P><FONT face=Tahoma size=2>On another note, you're using an old property construct that you shouldn't be using anymore.&nbsp; The "NoInlining" method of property coding has proven to be too quirky and unstable for general use, so Rocky has deprecated its use in newer versions of the framework.&nbsp; The recommended practice is to not use the "NoInlining" attribute and use the method overloads of&nbsp;"CanReadProperty" and "PropertyHasChanged" that take a property name.</FONT></P>
<P><FONT face=Tahoma size=2>However, I'm wondering why you have a "set" for this property anyway.&nbsp; It's pretty unusual to have one for collection properties.&nbsp; If you have it because of your issue, then I'd suggest you get rid of it once we get your "get" routine cleaned up.&nbsp; If you do need to keep it, then you should add a call to "CanWriteProperty" in there as well, so that your security is maintained.&nbsp; Again, that call should have your property name in it.</FONT></P>
<P><FONT face=Tahoma size=2>So - assuming you don't need the "set", your property should look something like this:</FONT><FONT color=#008080 size=2> </FONT></P>
<P><FONT face="Courier New" color=#000000>[</FONT><FONT face="Courier New"><FONT color=#008080 size=2>MyDataMemberAttribute</FONT><FONT color=#000000 size=2>(</FONT><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>)</FONT><FONT color=#000000>]</FONT><BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>WebsiteCollection</FONT></FONT><FONT size=2><FONT face="Courier New"> <FONT color=#000000>WebsiteCollection</FONT><BR></FONT><FONT face="Courier New">{<BR></FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;get<BR></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>&nbsp;{</FONT><BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>CanReadProperty("WebsiteCollection", </FONT></FONT></FONT><FONT face="Courier New" color=#0000ff size=2>true</FONT><FONT size=2><FONT face="Courier New" color=#000000>);</FONT></FONT></P>
<P><FONT face="Courier New" size=2>&nbsp; if (mobjWebsiteCollection == <FONT color=#0000ff size=2>null</FONT><FONT size=2><FONT color=#000000>)</FONT></FONT></FONT><FONT face="Courier New" color=#000000><BR></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>mobjWebsiteCollection</FONT> = </FONT><FONT color=#008080 size=2>WebsiteCollection</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>.NewWebsiteCollection();</FONT></FONT></P>
<P><FONT size=2><FONT face="Courier New" color=#000000>&nbsp; return mobjWebsiteCollection;<BR>&nbsp;</FONT></FONT><FONT color=#000000><FONT size=2><FONT face="Courier New">}<BR></FONT></FONT></FONT><FONT size=2><FONT color=#000000><FONT face="Courier New">}</FONT></FONT></FONT></P>
<P><FONT size=2><FONT face=Tahoma>And if you do need the "set", it should look something like this:</FONT></FONT></P>
<P><FONT size=2><FONT face="Courier New" color=#0000ff>&nbsp;set<BR></FONT><FONT face="Courier New"><FONT size=2>&nbsp;{<BR></FONT><FONT color=#0000ff size=2><FONT color=#000000>&nbsp; CanWriteProperty("WebsiteCollection", </FONT><FONT face="Courier New" color=#0000ff size=2>true</FONT><FONT size=2><FONT face="Courier New" color=#000000>);</FONT></FONT></FONT></FONT></FONT></P>
<P><FONT size=2><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp; if</FONT><FONT size=2> <FONT color=#000000>(mobjWebsiteCollection !=</FONT> </FONT><FONT color=#0000ff size=2>value</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>)<BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>{<BR></FONT></FONT><FONT face="Courier New" color=#000000>&nbsp;&nbsp; mobjWebsiteCollection = </FONT></FONT><FONT face="Courier New" color=#0000ff size=2>value</FONT><FONT size=2><FONT face="Courier New" color=#000000>;<BR></FONT><FONT face="Courier New">&nbsp; <FONT color=#000000>&nbsp;PropertyHasChanged("WebsiteCollection");<BR></FONT></FONT><FONT face="Courier New" color=#000000>&nbsp; }<BR></FONT><FONT color=#000000><FONT face="Courier New">&nbsp;}<BR></FONT></FONT></FONT></FONT><FONT size=2><FONT size=2><FONT color=#000000><FONT face="Courier New"></FONT></FONT></FONT></FONT></P>
<P><FONT size=2><FONT size=2><FONT color=#000000><FONT face="Courier New"><FONT face=Tahoma>All your BO properties should be constructed similarly.</FONT></FONT></FONT></FONT></FONT></P>
<P><FONT size=2><FONT size=2><FONT color=#000000><FONT face="Courier New"><FONT face=Tahoma>HTH</FONT></FONT></FONT></FONT></FONT></P>
<P><FONT size=2><FONT size=2><FONT color=#000000><FONT face="Courier New"><FONT face=Tahoma>- Scott</FONT></P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>preludecrazy replied on Monday, March 31, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tmg4340:</strong></div><div>
<P><FONT face=Tahoma size=2>Using something like this:</FONT></P>
<P><FONT face="Courier New"><FONT size=2><FONT color=#0000ff>return</FONT> <FONT color=#000000>(mobjWebsiteCollection ==</FONT> <FONT color=#0000ff>null</FONT><FONT color=#000000>)</FONT> <FONT color=#000000>?</FONT><FONT color=#008080><FONT color=#000000>&nbsp;</FONT>WebsiteCollection</FONT><FONT color=#000000>.NewWebsiteCollection() : mobjWebsiteCollection;</FONT></FONT></FONT></P>
<P><FONT face=Tahoma size=2>presents a problem, since you create a new collection but never assign it to "mobjWebsiteCollection".</FONT></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P><FONT face=Arial>LOL.&nbsp; What an idiot I am! :)</FONT></P>
<P><FONT face=Arial>Cheers, Scott.</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
