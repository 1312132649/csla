<html><header><title>any way to make deny... stronger than allow... Permissions?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>any way to make deny... stronger than allow... Permissions?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8379.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak posted on Tuesday, January 19, 2010</h2>Hi,<br /><br />in my security model, which is permission-based (but somehow "wrapped" in a role-based manner, so IsInRole retrieves whether a user has certain permsissions), I manage allow AND deny permissions.<br />So one can assign a user to certain roles (which have defined permissions), but deny a certain permission explicitly. By that my app-admins have a high level of flexibility.<br />Now I'm struggling with making the denyGet stronger than allowGet. Unfortunalty CSLA seems to favour allow over deny in CanGetObject. Is this right?<br />So, what to do?<br /><br />Thanks for any hints.<br /><br />Greetings<br /><br />Volker</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Tuesday, January 19, 2010</h2><P>Hi</P>
<P>In one of my quite large apps I had similar requirements (I think). I mainly wanted everything to be denied (CanRead/Insert etc as well as edit properties). The steps i took were:</P>
<P>1. Use custom Identity with a <FONT face="Courier New" color=#0000ff size=2>bool HasPermission(string permissionName)</FONT> method (although you can use IsInRole or extension methods as explained by Rocky and other forum members respectively).<BR>2. In all my objects I have placed my hooks (e.g. Customer.CanRead() would just return the result of passing the parameter "ReadCustomer" to the above method).<BR>3. Any logic of what the user can read is implimented in the custom identity (or rather a seperate class injected to my custom identity).</P>
<P>I am not sure what your question is though. Are you not sure how to implement the deny/allow conflicts or do you want to avoid placing calls to your security model on all your objects? Or something else?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Tuesday, January 19, 2010</h2>Hi,<br /><br />thx for answering.<br />Let me explain it a bit more:<br />My Identity-object has a list of roles, which is in fact a list of permissions. In that list a specific Identity can have the 'roles' denyViewThis AND ViewThis, which allows/denies the user to view(get) objects of a certain type (This). As long as users only have DenyGetThis OR GetThis all works as expected. But if a user has both of them, I just want the deny-permission to take effect, not the allow-permission.<br /><br />The reason is that my security model allows admins to assign users to certain roles, but also to drop certain permissions (otherweise granted mainly by the role assignment) by adding deny-permissions.<br />In other words: all functionality that could be granted could also be denied. And no grant should take effect on a specific user if there is a deny-assignment for that functionality.<br />AllowGet and DenyGet (in conjunction with CangetObject) work that way in both cases , but only until not BOTH apply to the same user. In that case it seems that allways the Allow-permission takes effect.<br /><br />Hope I made my case somewhat more transparent!?<br /><br />Thanks for your time<br /><br />Volker</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Tuesday, January 19, 2010</h2><P>Assuming that&nbsp;it is possible to distinguish that&nbsp;permissions <FONT face="Courier New" color=#0000ff size=2>DenyViewThis</FONT> and <FONT face="Courier New" color=#0000ff size=2>ViewThis</FONT> are related (opposites in fact) isn't the solution to your problem as doing the following:</P>
<OL>
<LI>Load your permissions (presumably from a database, XML or whatever)</LI>
<LI>Load all allowing permissions (including <FONT face="Courier New" color=#0000ff size=2>ViewThis</FONT>)</LI>
<LI>Loop through the denying permissions (including <FONT face="Courier New" color=#0000ff size=2>DenyViewThis</FONT>). For each one of these, remove the opposite (e.g. when encountering <FONT face="Courier New" color=#0000ff size=2>DenyViewThis </FONT>in your loop, remove <FONT face="Courier New" color=#0000ff size=2>ViewThis</FONT>).&nbsp;</LI></OL>
<P>The bottom line is that if someone should be allowed or not to view something is just business logic. You can implement all this logic in your custom identity/identity provider.</P>
<P>Also, take a look at this: <A href="http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx">http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx</A></P>
<P>Might be of help.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Tuesday, January 19, 2010</h2>Hi,<br /><br />indeed your approach would be a solution. It could be done in the DP.fetch method. Another one could be to load only the "not-denied" permissions from the DB, which would cause some refinement to the sprocs...<br /><br />I read the blog entry and yes it was of some help!<br /><br />Thanks again<br /><br />Volker</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
