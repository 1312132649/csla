<html><header><title>Data Abstraction Question Regarding Multiple Recordsets</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Data Abstraction Question Regarding Multiple Recordsets</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9261.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar posted on Friday, July 23, 2010</h2><p>Hi All,</p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">Originally our DataPortal_Fetch routine would query the DB and return multiple resultsets to generate our object model.&nbsp; We have moved our data access to a more abstract model where we have DA, DA.SQL, DA.EF, DA.DTO projects.</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">Where/how do we process the additional resultsets without creating a circular reference?<span style="mso-spacerun:yes;">&nbsp; </span>For example, if our original DataPortal_Fetch called a stored procedure and then executed something like:</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">While (dr.Read())</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">{</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&hellip; Populate first object</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If (dr.NextResult())</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-tab-count:2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>FirstObject.Child = ChildObject.GetItems(dr);</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">}</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">A good example would be Users and Roles.<span style="mso-spacerun:yes;">&nbsp; </span>If we retrieve both as two resultsets and populated the DTO.Users object in the DA.SQL and DA.EF where/how would we populate the DTO.Roles object?</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;"><span style="font-family:Calibri;">I&rsquo;m thinking we either do it within the DTO.Users Fetch routine which means we would have to instantiate the DTO.Roles object and then populate it.<span style="mso-spacerun:yes;">&nbsp; </span>Or, we could return back to the DataPortal_Fetch and call the Roles.GetRoles() method.<span style="mso-spacerun:yes;">&nbsp; </span></span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">The second option means we would ignore (or remove) the second resultset and query the DB again (a second round trip to the DB).<span style="mso-spacerun:yes;">&nbsp; </span>The first option means we do not have encapsulation as the DTO.User&rsquo;s object would have knowledge of the DTO.Roles object.</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">The circular reference happens since the User class/project references the DA project.<span style="mso-spacerun:yes;">&nbsp; </span>In the DA project if we wanted to call the Roles.GetRoles() method we would have to create a reference to the project that contains the Users/Roles object.</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNoSpacing"><span style="font-size:small;font-family:Calibri;">Any suggestions or have I made this overly complex?</span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Tuesday, July 27, 2010</h2><p><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">I am not sure if the solution we&#39;ve implement is the most correct (in terms of encapsulation, functionality, etc...) but it works.<span style="mso-spacerun:yes;">&nbsp; </span>In our DA.EF and DA.SQL we continue to retrieve our multiple result sets.<span style="mso-spacerun:yes;">&nbsp; </span>Then we populate our Parent.DTO and Child.DTO objects and pass the DTO object graph back to the DataPortal_Fetch routines.</span></p>
<p><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">In the DataPortal_Fetch routine we populate the parent object and call the corresponding Child.GetChild() factory object passing the child DTO.</span></p>
<p><span style="font-size:9pt;color:black;line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;">If there is a better way to do this, let me know.</span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, July 27, 2010</h2><p>That sounds correct. Everything references the DTO assembly, and it references nothing. And no other assemblies reference each other either - that&#39;s the normal way of approaching this scenario.</p>
<p>The only exception is that I usually also have a &quot;DAL manager&quot; assembly that is the gateway into the different DAL implementations. So the business library and DAL components all reference the DAL manager, and it references nothing (except maybe the DTO assembly).</p>
<p>This DAL manager can be implemented using a provider model, IoC/DI or any other indirection pattern of your choice.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Wednesday, July 28, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>
<p>That sounds correct. Everything references the DTO assembly, and it references nothing. And no other assemblies reference each other either - that&#39;s the normal way of approaching this scenario.</p>
<p>The only exception is that I usually also have a &quot;DAL manager&quot; assembly that is the gateway into the different DAL implementations. So the business library and DAL components all reference the DAL manager, and it references nothing (except maybe the DTO assembly).</p>
<p>This DAL manager can be implemented using a provider model, IoC/DI or any other indirection pattern of your choice.</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>Thanks for the confirmation as we could have chosen another way to solve this issue.</p>
<p>We are utilizing a DAL manager but I omitted those details as not to cloud the question with extra details that may not be relevant.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Wednesday, July 28, 2010</h2><p>
<p>Hello,</p>
<p>I tried to solve this using code generation but it became a really tall order really fast. How many levels deep are you going?</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
