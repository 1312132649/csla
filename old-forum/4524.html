<html><header><title>Suggestion : GenericDataReader</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Suggestion : GenericDataReader</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4524.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RubensFarias posted on Wednesday, March 19, 2008</h2><P>Hi All,</P>
<P>I'm trying to use SafeDataReader concept into a non CSLA project, basically due lack of GetXXX(string) methods in SqlDataReader. Currently I have a generic implementation I think could specially useful to CSLA:</P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// main load</FONT><BR>using(<FONT color=#0000ff>GenericDataReader</FONT> reader = new GenericDataReader(cm.ExecuteReader()))<BR>{<BR>&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#ff0000>orders.Add(reader.Get&lt;Order&gt;());&nbsp;// "GetList" pattern<BR></FONT><FONT color=#008000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //return new Order(reader);&nbsp;&nbsp;&nbsp;&nbsp;// "Get" pattern</FONT><BR>&nbsp;&nbsp;&nbsp; }<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// generic reader; interface implementation removed</FONT><BR>public class <FONT color=#0000ff>GenericDataReader</FONT> : <FONT color=#0000ff>IDataReader</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; // ... \\</FONT></P>
<P><FONT face="Courier New" color=#ff0000 size=2>&nbsp;&nbsp;&nbsp; public T Get&lt;T&gt;(string name)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i = _dataReader.GetOrdinal(name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_dataReader.IsDBNull(i))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return default(T);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T)_dataReader.GetValue(i);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#ff0000>&nbsp;&nbsp;&nbsp; public T Get&lt;T&gt;() where T : ILoadable, new()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T entity = new T();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entity.Load(this, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return entity;<BR>&nbsp;&nbsp;&nbsp; }<BR></FONT>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// All business objects must inherits this interface (@BusinessBase?)</FONT><BR>public interface <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; void Load(GenericDataReader reader, bool deep);<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// Sample BO 1</FONT><BR>class Order : <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; int id;<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp; Customer customer;&nbsp;// Note</FONT><BR>&nbsp;&nbsp;&nbsp; DateTime orderDate;<BR>&nbsp;&nbsp;&nbsp; DateTime requiredDate;<BR>&nbsp;&nbsp;&nbsp; DateTime? shippedDate;<BR>&nbsp;&nbsp;&nbsp; List&lt;OrderDetail&gt; orderDetails;</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Order(){ }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Order(GenericDataReader reader)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Load(reader, true);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #region ILoadable Members</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public void Load(GenericDataReader reader, bool deep)<BR>&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id = reader.Get&lt;int&gt;("OrderID");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer = reader.Get&lt;Customer&gt;();&nbsp;// Note</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDate = reader.Get&lt;DateTime&gt;("OrderDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requiredDate = reader.Get&lt;DateTime&gt;("OrderRequiredDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; shippedDate = reader.Get&lt;DateTime?&gt;("OrderShippedDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (deep &amp;&amp; reader.NextResult())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDetails = new List&lt;OrderDetail&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDetails.Add(reader.Get&lt;OrderDetail&gt;());</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #endregion<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// Sample BO 2</FONT><BR>class Customer : <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; string customerID;<BR>&nbsp;&nbsp;&nbsp; List&lt;Order&gt; orders;</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Customer(){ }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; internal Customer(GenericDataReader reader)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Load(reader, true);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #region ILoadable Members</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public void Load(GenericDataReader reader, bool deep)<BR>&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customerID = reader.Get&lt;string&gt;("CustomerID");</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (deep &amp;&amp; reader.NextResult())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orders = new List&lt;Order&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orders.Add(reader.Get&lt;Order&gt;());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #endregion<BR>}</FONT></P>
<P>What do you think? Are there any major drawback with this model I'm missing? </P>
<P>Best regards,</P>
<P>Rubens</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nermin replied on Wednesday, March 19, 2008</h2><P>Hi Rubens,</P>
<P>On a first look it looks like an elegant solution.&nbsp; And this is completely OK if you are sure that this app is going to be built only with ADO.NET.</P>
<P>However if this is going to be an ongoing project, that perhaps in the future might migrate the Data Acces Layer code to some ORM Technology, like NHiberbate, Linq or Entity Framework, then the tight coupling of your business objects with the IDataReader (or GenericDataReader) might prove as a migration bottleneck.&nbsp; In other words you have to change the signature of each of your BOs to migrate to another storage technology.</P>
<P>There is a reason why Rocky has not implemented something like that in Csla as much as it appears more readable and simpler than what we have now.</P>
<P>Those are my 2c</P>
<P>Nermin</P>
<P><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>RubensFarias:</strong></div><div></P>
<P>Hi All,</P>
<P>I'm trying to use SafeDataReader concept into a non CSLA project, basically due lack of GetXXX(string) methods in SqlDataReader. Currently I have a generic implementation I think could specially useful to CSLA:</P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// main load</FONT><BR>using(<FONT color=#0000ff>GenericDataReader</FONT> reader = new GenericDataReader(cm.ExecuteReader()))<BR>{<BR>&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#ff0000>orders.Add(reader.Get&lt;Order&gt;());&nbsp;// "GetList" pattern<BR></FONT><FONT color=#008000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //return new Order(reader);&nbsp;&nbsp;&nbsp;&nbsp;// "Get" pattern</FONT><BR>&nbsp;&nbsp;&nbsp; }<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// generic reader; interface implementation removed</FONT><BR>public class <FONT color=#0000ff>GenericDataReader</FONT> : <FONT color=#0000ff>IDataReader</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; // ... \\</FONT></P>
<P><FONT face="Courier New" color=#ff0000 size=2>&nbsp;&nbsp;&nbsp; public T Get&lt;T&gt;(string name)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i = _dataReader.GetOrdinal(name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_dataReader.IsDBNull(i))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return default(T);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T)_dataReader.GetValue(i);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#ff0000>&nbsp;&nbsp;&nbsp; public T Get&lt;T&gt;() where T : ILoadable, new()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T entity = new T();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entity.Load(this, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return entity;<BR>&nbsp;&nbsp;&nbsp; }<BR></FONT>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// All business objects must inherits this interface (@BusinessBase?)</FONT><BR>public interface <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; void Load(GenericDataReader reader, bool deep);<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// Sample BO 1</FONT><BR>class Order : <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; int id;<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp; Customer customer;&nbsp;// Note</FONT><BR>&nbsp;&nbsp;&nbsp; DateTime orderDate;<BR>&nbsp;&nbsp;&nbsp; DateTime requiredDate;<BR>&nbsp;&nbsp;&nbsp; DateTime? shippedDate;<BR>&nbsp;&nbsp;&nbsp; List&lt;OrderDetail&gt; orderDetails;</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Order(){ }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Order(GenericDataReader reader)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Load(reader, true);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #region ILoadable Members</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public void Load(GenericDataReader reader, bool deep)<BR>&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id = reader.Get&lt;int&gt;("OrderID");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer = reader.Get&lt;Customer&gt;();&nbsp;// Note</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDate = reader.Get&lt;DateTime&gt;("OrderDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requiredDate = reader.Get&lt;DateTime&gt;("OrderRequiredDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; shippedDate = reader.Get&lt;DateTime?&gt;("OrderShippedDate");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (deep &amp;&amp; reader.NextResult())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDetails = new List&lt;OrderDetail&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDetails.Add(reader.Get&lt;OrderDetail&gt;());</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #endregion<BR>}</FONT></P>
<P><FONT face="Courier New" size=2><FONT color=#008000>// Sample BO 2</FONT><BR>class Customer : <FONT color=#0000ff>ILoadable</FONT><BR>{<BR>&nbsp;&nbsp;&nbsp; string customerID;<BR>&nbsp;&nbsp;&nbsp; List&lt;Order&gt; orders;</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public Customer(){ }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; internal Customer(GenericDataReader reader)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Load(reader, true);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #region ILoadable Members</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; public void Load(GenericDataReader reader, bool deep)<BR>&nbsp;&nbsp;&nbsp; {<BR><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customerID = reader.Get&lt;string&gt;("CustomerID");</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (deep &amp;&amp; reader.NextResult())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orders = new List&lt;Order&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (reader.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orders.Add(reader.Get&lt;Order&gt;());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; #endregion<BR>}</FONT></P>
<P>What do you think? Are there any major drawback with this model I'm missing? </P>
<P>Best regards,</P>
<P>Rubens</P></div></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RubensFarias replied on Thursday, March 20, 2008</h2><P>Hi Nermin,</P>
<P>In my specific case, there are no signal about ORM mapping in a closer future.</P>
<P>But you're right. I'll think about that and try to work around it.</P>
<P>Thank you for your time,</P>
<P>Rubens</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
