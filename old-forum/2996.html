<html><header><title>Problems with setting up WebServiceHosting</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problems with setting up WebServiceHosting</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2996.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gartnerj posted on Thursday, June 07, 2007</h2><P>Folks,</P>
<P>this is my first time through with using CSLA, and I have a bunch of BO's working when running locally using a DAL/DTO layer to connect to a db.</P>
<P>I now want to use a Web Service Host (or maybe a remoting host) to serve the BO's for an application.</P>
<P>&nbsp;</P>
<P>I built the WebServiceHost as per the example ProjectTracker and installed on a dev IIS server.</P>
<P>I updated the app.config of the client to have this:</P>
<P>&lt;add key="CslaAuthentication" value="Csla" /&gt;<BR>&nbsp;&lt;add key="CslaDataPortalProxy" <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value="Csla.DataPortalClient.WebServicesProxy, Csla"/&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalUrl" <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value="<A href='http://deviismachine/Moodys.Epi2.BO.WebServicesHost/BOWebServicePortal.asmx"/'>http://DEVIISMACHINE/Moodys.Epi2.BO.WebServicesHost/BOWebServicePortal.asmx"/</A>&gt; </P>
<P>The app first gets this when trying to connect at this line in the WebServicesProxy:</P><FONT size=2>
<P>result = Deserialize(wsvc.Fetch(Serialize(request)));</P></FONT>
<P>I get:</P>
<P>Principal must be of type BusinessPrincipal, not System.Security.Principal.GenericPrincipal</P>
<P>&nbsp;</P>
<P>I added this to the client:</P>
<P>&nbsp;</P><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>PTPrincipal</FONT><FONT size=2>.Logout();</FONT></P><FONT size=2><FONT color=#2b91af size=2>
<P>PTPrincipal</FONT><FONT size=2>.Login(</FONT><FONT color=#a31515 size=2>"user"</FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2>String</FONT><FONT size=2>.Empty);</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>This PtPrincipal is an exact copy from ProductTracker, except I just return true and a default role -- I don't actually authenticate anything at this point.</FONT></P>
<P><FONT size=2>Once I add that, I now get this as an error (remember, the Serialize is on the PTPricipal class):</FONT></P>
<P><FONT size=2>&nbsp;Object of type 'System.Runtime.Serialization.TypeLoadExceptionHolder' cannot be converted to type 'System.Security.Principal.IPrincipal'.</FONT></P>
<P><FONT size=2>It looks like it is complaining about the PTPricipal passed to the webservicehost, but I'm not sure what to do at this point.&nbsp; The WebServiceHost Web.Config also has :</FONT></P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#a31515 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>CslaAuthentication</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Csla</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P></FONT>
<P><FONT size=2>and i have tried authentication="Windows" (with impersonate true), and authentication="none", but these don't change the problem (I didn't really expect it would).</FONT></P>
<P><FONT size=2>Any help would be greatly appreciated!!</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gartnerj replied on Friday, June 08, 2007</h2><P>OK folks, I found out the issue (just adding this in case other beginners run into the same issues).</P>
<P>The actual error returned as :&nbsp;&nbsp;Object of type 'System.Runtime.Serialization.TypeLoadExceptionHolder' cannot be converted to type 'System.Security.Principal.IPrincipal'</P>
<P>Had nothing to do with the PTPrincipal or the login id at all.&nbsp; It was a different class (buried deep in my DAL/DTO Layer that I use instead of coding the SQL directly in the BO's) that had a deserialization problem -- it's just that it showed up with THIS error message -- somewhat misleading, but that's how it goes.</P>
<P>Anyway, just completing this post for anyone else having the issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joe replied on Monday, December 17, 2007</h2>I know this is an old thread, but I'm getting the exact same error message while doing some unit testing in VS 2008.&nbsp; I'm trying to track down the exception; any suggestions where to look?<br><br>Is the exception actually related to Principal/Identity/Login issues?&nbsp; Does it occur somewhere in the CSLA framework or was it elsewhere?&nbsp; Was it simply a matter of a BO not being marked as serializable, or perhaps it had unserializable member variables?<br><br>Any help would be appreciated.&nbsp; Thanks!<br><br>~Joe<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, December 17, 2007</h2><P>This exception does come from CSLA - from the data portal. The server-side data portal will only run if a valid (though it could be unauthenticated) principal object is provided from the client.</P>
<P>Both client and server <EM>must</EM> use the same CslaAuthentication setting in their config files. And the client <EM>must</EM> set its principal to a valid (if unauthenticated) principal before <EM>any data portal call</EM> - including one to set up the principal.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
