<html><header><title>Best practice for implementing a GridView with Sorting/Filtering enabled with CSLA DataSource.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best practice for implementing a GridView with Sorting/Filtering enabled with CSLA DataSource.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8710.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf posted on Wednesday, March 24, 2010</h2><p>Dear All,</p>
<p>I have implemented a GridView Control which can be sorted by clicking the Header Colom, with a Filter, which is bound to a CSLA DataSource. I have followed same basic idea Proejct Tracker Application, but since there is no implementation for sorting in the sample applicaiton, I had to do it on my own.</p>
<p>Here is the Filter Parameter/GridView Source:
<div style="font-size:80%;"><blockquote style="overflow-x: scroll;"><pre style="margin: 0px;"><br />&lt;fieldset class=&quot;ParameterList&quot; &gt;<br />&lt;legend&gt;&lt;asp:Label ID=&quot;lblTitleText&quot; runat=&quot;server&quot; Text=&#39;Enter Search Parameters (Partial Match &quot;%&quot; Supported)&#39; &gt;&lt;/asp:Label&gt;&lt;/legend&gt;<br />&nbsp;&nbsp;&nbsp; &lt;asp:Panel ID=&quot;FilterPanel&quot;&nbsp; runat=&quot;server&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblRequestID&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtRequestID&quot; Text=&quot;Request ID:&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtRequestID&quot; CssClass=&quot;ParameterItemInput&quot;&nbsp; runat=&quot;server&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot;&nbsp; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblPatientID&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtPatientID&quot; Text=&quot;Patient ID:&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtPatientID&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblTechnicanID&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtTechnicanID&quot; Text=&quot;Technician ID:&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtTechnicanID&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot;&nbsp; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblDoctorID&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtDoctorID&quot; Text=&quot;Doctor ID:&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtDoctorID&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot;&nbsp; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblPatientName&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtPatientName&quot; Text=&quot;Patient Name:&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtPatientName&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblTechnicianName&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtTechnicianName&quot; Text=&quot;Technician Name:&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtTechnicianName&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblDoctorName&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtDoctorName&quot; Text=&quot;Doctor Name:&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtDoctorName&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ParameterItem&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Label ID=&quot;lblSinceMonthsBack&quot; CssClass=&quot;ParameterItemLabel&quot; runat=&quot;server&quot; AssociatedControlID=&quot;txtSinceMonthsBack&quot; Text=&quot;Since Months Back:&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID=&quot;txtSinceMonthsBack&quot; CssClass=&quot;ParameterItemInput&quot; runat=&quot;server&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;div class=&quot;ButtonList&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Button ID=&quot;btnFilterActivate&quot; CssClass=&quot;FilterActivate&quot; runat=&quot;server&quot; Text=&quot;Activate Filter&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:Button ID=&quot;btnFilterClear&quot; CssClass=&quot;FilterClear&quot; runat=&quot;server&quot; Text=&quot;Clear Filter&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/asp:Panel&gt;<br />&lt;/fieldset&gt;<br />&lt;asp:GridView ID=&quot;gvLabRequestList&quot; CssClass=&quot;GridView&quot;&nbsp; runat=&quot;server&quot; AutoGenerateColumns=&quot;False&quot; DataSourceID=&quot;dtaLabRequestList&quot; AllowPaging=&quot;True&quot; PageSize=&quot;15&quot; AllowSorting=&quot;True&quot; BackColor=&quot;LightGoldenrodYellow&quot; BorderColor=&quot;Tan&quot; BorderWidth=&quot;1px&quot; CellPadding=&quot;2&quot; ForeColor=&quot;Black&quot; GridLines=&quot;None&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Columns&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:BoundField DataField=&quot;LabRequestID&quot; HeaderText=&quot;Request ID&quot; ReadOnly=&quot;True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SortExpression=&quot;Id&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:BoundField DataField=&quot;LabRequestDateDMYStr&quot; HeaderText=&quot;Request Date (DMY)&quot; ReadOnly=&quot;True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SortExpression=&quot;LabRequestDate&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:BoundField DataField=&quot;PateintNameID&quot; HeaderText=&quot;Pateint ID-Name&quot; ReadOnly=&quot;True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SortExpression=&quot;PateintNameID&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:BoundField DataField=&quot;DiagnosisDescEng&quot; HeaderText=&quot;Diagnosis&quot; ReadOnly=&quot;True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SortExpression=&quot;DiagnosisDescEng&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;asp:CheckBoxField DataField=&quot;CompletedFlag&quot; HeaderText=&quot;Completed?&quot; SortExpression=&quot;CompletedFlag&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/Columns&gt;<br />&nbsp;&nbsp;&nbsp; &lt;AlternatingRowStyle CssClass=&quot;AlternateRowStyle&quot;&nbsp; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;RowStyle CssClass=&quot;RowStyle&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;HeaderStyle CssClass=&quot;HeaderStyle&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;FooterStyle cssclass=&quot;FooterStyle&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;PagerStyle cssclass=&quot;PagerStyle&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;SelectedRowStyle BackColor=&quot;DarkSlateBlue&quot; ForeColor=&quot;GhostWhite&quot; /&gt;<br />&lt;/asp:GridView&gt;</pre></blockquote></div>
</p>
<p>Here is the code-behind: </p>
<div style="font-size:80%;"><blockquote style="overflow-x: scroll;"><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Private Function GetLabRequestList(ByVal e As Csla.Web.SelectObjectArgs) As Csla.SortedBindingList(Of MyOrg.Library.Clinic.LabRequestInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim myObjSorted As Csla.SortedBindingList(Of MyOrg.Library.Clinic.LabRequestInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim objList As Clinic.LabRequestList<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim ObjSortProperty As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myObjSorted = Session(&quot;BusinessObject&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If myObjSorted Is Nothing OrElse Not TypeOf myObjSorted Is Csla.SortedBindingList(Of Clinic.LabRequestInfo) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objList = _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Clinic.LabRequestList.GetLabRequestList( _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txtRequestID.Text, txtPatientID.Text, txtTechnicanID.Text, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txtDoctorID.Text, txtPatientName.Text, txtTechnicianName.Text, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txtDoctorName.Text, txtSinceMonthsBack.Text _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myObjSorted = New SortedBindingList(Of Clinic.LabRequestInfo)(objList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not e.SortProperty Is Nothing Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myObjSorted.ApplySort(e.SortProperty, e.SortDirection)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session(&quot;BusinessObject&quot;) = myObjSorted<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If myObjSorted.SortProperty Is Nothing Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjSortProperty = &quot;&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjSortProperty = myObjSorted.SortProperty.Name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not String.IsNullOrEmpty(e.SortProperty) AndAlso _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (e.SortProperty &lt;&gt; ObjSortProperty OrElse e.SortDirection &lt;&gt; myObjSorted.SortDirection) _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myObjSorted.ApplySort(e.SortProperty, e.SortDirection)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session(&quot;BusinessObject&quot;) = myObjSorted<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return myObjSorted<br />&nbsp;&nbsp;&nbsp; End Function<br /><br />&nbsp;&nbsp;&nbsp; Protected Sub dtaLabRequestList_SelectObject(ByVal sender As System.Object, ByVal e As Csla.Web.SelectObjectArgs) Handles dtaLabRequestList.SelectObject<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim myObj As Csla.SortedBindingList(Of MyOrg.Library.Clinic.LabRequestInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myObj = GetLabRequestList(e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.BusinessObject = myObj<br />&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp; Protected Sub btnFilterActivate_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnFilterActivate.Click<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session(&quot;BusinessObject&quot;) = Nothing<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gvLabRequestList.DataBind()<br />&nbsp;&nbsp;&nbsp; End Sub<br /></pre></blockquote>&nbsp;&nbsp;&nbsp; </div>
<p>Appreciate your feedback on the above code sample.</p>
<p>Tarek.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Monday, March 29, 2010</h2><p>I am posting again hoping to get feedback.</p>
<p>Tarek.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
