<html><header><title>Invalid cast from 'System.Boolean' to 'CslaSrd.SmartBool'.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Invalid cast from 'System.Boolean' to 'CslaSrd.SmartBool'.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7191.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AKaplan posted on Monday, June 29, 2009</h2>Using Csla.net 3.5.3 VB with the CslaSRD project. Converting a boolean to a cslasrd.smartbool is not possible. Why?<br /><br />It is crashing here. <br /><br />LoadProperty(Of SmartBool, Boolean)(_allowSitePartnersToContact, data.AllowSitePartnerToContact)<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AKaplan replied on Monday, June 29, 2009</h2>This error crashes in this method when converting a boolean to a smartbool at the specified point.<br /><br />Public Function CoerceValue(ByVal desiredType As Type, ByVal valueType As Type, ByVal oldValue As Object, ByVal value As Object) As Object<br /><br />    If desiredType.Equals(valueType) Then<br />      ' types match, just return value<br />      Return value<br /><br />    Else<br />      If desiredType.IsGenericType Then<br />        If desiredType.GetGenericTypeDefinition() Is GetType(Nullable(Of )) Then<br />          If value Is Nothing Then<br />            Return Nothing<br /><br />          ElseIf valueType.Equals(GetType(String)) AndAlso CStr(value) = String.Empty Then<br />            Return Nothing<br />          End If<br />        End If<br />        desiredType = Utilities.GetPropertyType(desiredType)<br />      End If<br /><br />      If desiredType.IsEnum AndAlso _<br />          (valueType.Equals(GetType(String)) OrElse _<br />           [Enum].GetUnderlyingType(desiredType).Equals(valueType)) Then<br />        Return [Enum].Parse(desiredType, value.ToString())<br />      End If<br /><br />      If desiredType.Equals(GetType(SmartDate)) AndAlso oldValue IsNot Nothing Then<br />        If value Is Nothing Then _<br />          value = String.Empty<br />        Dim tmp = DirectCast(oldValue, SmartDate)<br />        tmp.Text = value.ToString<br />        Return tmp<br />      End If<br /><br />      If (desiredType.IsPrimitive OrElse desiredType.Equals(GetType(Decimal))) _<br />          AndAlso valueType.Equals(GetType(String)) _<br />          AndAlso String.IsNullOrEmpty(CStr(value)) Then<br />        value = 0<br />      End If<br /><br />      Try<br />        If desiredType.Equals(GetType(String)) AndAlso value IsNot Nothing Then<br />          Return value.ToString()<br />        Else<br /><br />'This is where it crashes.<br /><br />          Return Convert.ChangeType(value, desiredType)<br />        End If<br />      Catch<br />        Dim cnv As TypeConverter = TypeDescriptor.GetConverter(desiredType)<br />        If cnv IsNot Nothing AndAlso cnv.CanConvertFrom(valueType) Then<br />          Return cnv.ConvertFrom(value)<br /><br />        Else<br />          Throw<br />        End If<br />      End Try<br />    End If</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 29, 2009</h2><P>CoerceValue() tries every technique I'm aware of to try and convert a value of one type to another. If it fails, there are two possible reasons:</P>
<OL>
<LI>The type can't be converted</LI>
<LI>There's yet another type conversion API built into .NET that I'm unaware of</LI></OL>
<P>At this point I'm reasonably confident that the reason will be number 1 - the type just can't be converted.</P>
<P>If the SmartBool type doesn't have casting operators or a type converter then it won't be convertable. You can look at the SmartBool code to see if it has similar operator code and/or type converter code like you'll see in Csla.SmartDate. Much of the SmartDate code deals with type conversion these days, so it is hard to miss :)</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
