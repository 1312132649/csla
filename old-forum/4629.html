<html><header><title>PropertyInfo in abstract classes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>PropertyInfo in abstract classes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4629.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RealMrTea posted on Monday, April 07, 2008</h2><P>I have run into a snag with the new PropertyInfo objects added in 3.5 when a property info object is added to an inheritance chain.&nbsp; What I want to do is 'base out' all of the common properies for my senario (ID, LastChanged, etc...).&nbsp; If I do this with PropertyInfo objects the first problem I ran into is that you need to include a static constructor on the base class otherwise the order in which the static PropertyInfo objects is created will be out of order and sometimes it will work and sometimes it will not.&nbsp; If you do not create the static constructor you will often times that when you call GetProperty the FieldManager thinks the property does not exist.&nbsp; Add the static constructor and it works fine.</P>
<P>The second problem I have not been able to work around yet. It has to do with deserializing the property object back on the client.&nbsp; I retrieve an objet from the database on the server (using WCF) and everything is fine.&nbsp; Then the object moves to the client and the problems start happening.&nbsp; Inside of the FieldDataManager there is a method called CreateConsolidatedList.&nbsp; This method has some code in the beginning to walk through the inheritance hierarchy and pull the PropertyInfo objects out of those objects.&nbsp; The problem is that if that object has never been used before this point there are not PropertyInfo object registered so it will&nbsp;always return an empty list (count=0).&nbsp; You might get 5 objects in the _fieldData list but only 1 in the _propertyList where 4 objects are in the base class and 1 object is in your child class.&nbsp; This throws the indexes off and the thing crashes and burns pretty quickly.</P>
<P>I have temporarily turned off the PropertyInfo objects in my base classes but I would like to know why this is happenening and if I am doing something wrong here.&nbsp; I modified the Project object from the ProjectTracker example to duplicate this problem.&nbsp; I added the following code and based Project on BaseClass rather than on BusinessBase directly. Also remove the Id Property and anything else you base out from the Project object.</P>
<P><FONT size=2>[</FONT><FONT color=#2b91af size=2>Serializable</FONT><FONT size=2>()]</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>BaseClass</FONT><FONT size=2>&lt;C&gt; : </FONT><FONT color=#2b91af size=2>BusinessBase</FONT><FONT size=2>&lt;C&gt; </FONT><FONT color=#0000ff size=2>where</FONT><FONT size=2> C : </FONT><FONT color=#2b91af size=2>BusinessBase</FONT><FONT size=2>&lt;C&gt;</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> BaseClass()</P>
<P>{</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>internal</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt; IdProperty =</P>
<P>RegisterProperty&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(C), </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PropertyInfo</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(</FONT><FONT color=#a31515 size=2>"Id"</FONT><FONT size=2>));</P>
<P>[</FONT><FONT color=#2b91af size=2>DataObjectField</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>)]</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2> Id</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2> { </FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> GetProperty&lt;</FONT><FONT color=#2b91af size=2>Guid</FONT><FONT size=2>&gt;(IdProperty); }</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToString()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> Id.ToString();</P>
<P>}</P>
<P>}</P>
<P>&nbsp;</P><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Project</FONT><FONT size=2> : </FONT><FONT color=#2b91af size=2>BaseClass</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Project</FONT><FONT size=2>&gt;</FONT></P>
<P><FONT size=2>.</FONT></P>
<P><FONT size=2>.</FONT></P>
<P><FONT size=2>.</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>If anyone has any ideas please let me know.</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>Thanks,</FONT></P>
<P><FONT size=2>Eric</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RealMrTea replied on Friday, April 11, 2008</h2><P class=MsoNormal>I found the following article relating to this issue...after trying it I can not get the stupid thing to work.</P>
<P class=MsoNormal><A href="http://www.lhotka.net/Article.aspx?area=4&amp;id=3bf8411e-8c4a-44b7-9fda-33c0e354aa57"><FONT face=Calibri color=#800080>http://www.lhotka.net/Article.aspx?area=4&amp;id=3bf8411e-8c4a-44b7-9fda-33c0e354aa57</FONT></A></P>
<P class=MsoNormal>&nbsp;</P>
<P class=MsoNormal>Does anyone have an example of how to make this work?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
