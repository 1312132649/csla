<html><header><title>BusinessRules not BrokenRules...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessRules not BrokenRules...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10800.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i posted on Monday, October 24, 2011</h2><p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">I&rsquo;m way behind on using the <i style="mso-bidi-font-style:normal;">new </i><span style="mso-spacerun:yes;">&nbsp;</span>BusinessRules approach introduced, oh, years ago. I&rsquo;m still with the simple <i style="mso-bidi-font-style:normal;">Assert</i> approach that has a simplicity I love.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><b style="mso-bidi-font-weight:normal;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Background:</span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">I have created my own rules management bits and pieces probably&nbsp;7/8 years ago to intro concepts like severity, (efficient) resource management for localization, etc. as well as many shortcut common rules like length, max, min, range, greaterthan, lessthan, etc., etc. This inherits/wrap the clsa implementations so I get all that good stuff too.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">My BusinessBaseEx class is an abstract <i style="mso-bidi-font-style:normal;">switchable</i> (derives some behaviour from usage context) class that implements an IsBroken method (</span></span><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">public</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> <span style="color:blue;">virtual</span> <span style="color:blue;">bool</span> IsBroken()<span style="color:blue;">&nbsp;<span style="font-family:Calibri;color:#000000;font-size:x-small;">/</span><span style="mso-spacerun:yes;">&nbsp;</span>public</span> <span style="color:blue;">override</span> <span style="color:blue;">bool</span> IsBroken(<span style="color:blue;">params</span> <span style="color:blue;">string</span>[] ruleNames)</span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">). This is overridden by inheriting classes to implement their own specific rules using those old-style using Asserts:</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">public</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> <span style="color:blue;">override</span> <span style="color:blue;">bool</span> IsBroken(<span style="color:blue;">params</span> <span style="color:blue;">string</span>[] ruleNames)</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">bool</span> exceptLazyLoad = ContainsRule(<span style="color:#2b91af;">Rules</span>.AllExceptLazyLoads, ruleNames);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">bool</span> allProperties = (ruleNames.Length == 0 || ContainsRule(<span style="color:#2b91af;">Rules</span>.All, ruleNames) || exceptLazyLoad);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">if</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> (allProperties || ContainsRule(<span style="color:#2b91af;">Rules</span>.Name, ruleNames))</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertRequired(<span style="color:#2b91af;">Rules</span>.Name, _name);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertMaxLength(<span style="color:#2b91af;">Rules</span>.Name, _name, 50);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&hellip;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">The property settinger then include what rules to check on setting a new value:</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">[<span style="color:#2b91af;">SmartProperty</span>(Required = <span style="color:blue;">true</span>, MaxLength = 50)]</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">public</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> <span style="color:blue;">string</span> Name</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">get</span> { <span style="color:blue;">return</span> _name; }</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">set</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">this</span>.SetProperty(<span style="color:#a31515;">&quot;Name&quot;</span>, <span style="color:blue;">ref</span> _name, <span style="color:blue;">value</span>, <span style="color:#2b91af;">Rules</span>.Name);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Creating dependencies can be achieved simply by including more rules to check in the setters:<b style="mso-bidi-font-weight:normal;"></b></span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><b style="mso-bidi-font-weight:normal;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">this</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">.SetProperty(<span style="color:#a31515;">&quot;Name&quot;</span>, <span style="color:blue;">ref</span> _name, <span style="color:blue;">value</span>, <span style="color:#2b91af;">Rules</span>.Name, <em><span style="color:#2b91af;">Rules</span>.AvailableSpace</em>);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">And then doing the needful in the IsBroken - silly example here:</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><b style="mso-bidi-font-weight:normal;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">if</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> (allProperties || ContainsRule(<span style="color:#2b91af;">Rules</span>.Name, ruleNames))</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertRequired(<span style="color:#2b91af;">Rules</span>.Name, _name);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertMaxLength(<span style="color:#2b91af;">Rules</span>.Name, _<i>name, _</i>availableSpace<i>.Length</i>);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&hellip;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">if</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> (allProperties || ContainsRule(<span style="color:#2b91af;">Rules</span>.AvailableSpace, ruleNames))</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertRequired(<span style="color:#2b91af;">Rules</span>.AvailableSpace, _availableSpace);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BrokenRules.AssertWithOperator(<span style="color:#2b91af;">Rules</span>.AvailableSpace, <span style="color:#2b91af;">BrokenRules</span>.<span style="color:#2b91af;">Operator</span>.LessThanOrEquals, 50, _availableSpace);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">&hellip;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><b style="mso-bidi-font-weight:normal;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><b style="mso-bidi-font-weight:normal;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Now</span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">As you can see this is all very old-style but it has never been the source of problems so I can conclude that it works pretty ok. However, now I want to bring things back into line with the pure Csla way of doing things and I have a few questions:</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin;"><span style="mso-list:Ignore;"><span style="font-family:Calibri;">1.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">How can I achieve dependency rules where one property needs the value of another to check its validity? When I override AddBusinessRule I cannot do something like: </span></span></p>
<p class="MsoListParagraph" style="margin:0cm 0cm 0pt 72pt;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">BusinessRules.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">MaxLength</span>(NameProperty, <i style="mso-bidi-font-style:normal;">AvailableSpace.Length</i>));</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;"><span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I know about the </span></span><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:8pt;">Dependency</span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;"> but this doesn&rsquo;t help me link the <i style="mso-bidi-font-style:normal;">values</i> of both. It only helps me ensure both are checked. Do I have to create more specific rule implementations that <i style="mso-bidi-font-style:normal;">know</i> about both properties? Hope not! I expect I have lots and lots of rules where properties need values of others to determine validity.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin;"><span style="mso-list:Ignore;"><span style="font-family:Calibri;">2.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">I also have a concept of dealing with LazyLoaded properties in a different manner because I don&rsquo;t want these to signal invalidity if they haven&rsquo;t actually been loaded. There is, of course, a trade-off here but the concept is around rich object graphs whereby an assumption is made that if the <i style="mso-bidi-font-style:normal;">parent</i> (for want of a better word) has a valid <i style="mso-bidi-font-style:normal;">identifier</i> for the child then it can be assumed the child is valid without actually loading that child and checking the IsValid property. The <em>theory </em>comes from the idea that if the child was saved in the first place it must have passed its own validity checks. So the default behaviour for these is to check just that the Identifier value of the child is present (which, for simplicity, you could think of as an identifier field on a database). Once that child <i style="mso-bidi-font-style:normal;">has been</i> loaded then it&rsquo;s own IsBroken will be called to ensure it is entirely valid.</span></span></p>
<p class="MsoListParagraph" style="margin:0cm 0cm 0pt 36pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin;"><span style="mso-list:Ignore;"><span style="font-family:Calibri;">3.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">I hope that was clear because it lead me to the next question: I have always run a rules check when an object is loaded because I never want to trust the state of the underlying data. However, as I mostly deal with grids of data this can be significant overhead especially in circumstances where only my business layer will affect that data (I never trust this premise either btw!). What is the recommendation in this area &ndash; check the rules on load or not? I assume a built-in check on save? Or perhaps it is only on <i style="mso-bidi-font-style:normal;">set</i> which would leave me exposed if I don&rsquo;t check on load.</span></span></p>
<p class="MsoListParagraph" style="margin:0cm 0cm 0pt 36pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin;"><span style="mso-list:Ignore;"><span style="font-family:Calibri;">4.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">On the fly rules&hellip;one of the great things about Assert is that it is easy to build weird rules very quickly. Silly example (ignoring error checking) might be:</span></span></p>
<p class="MsoListParagraph" style="text-indent:36pt;margin:0cm 0cm 0pt 36pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">BrokenRules.Assert(<span style="color:#2b91af;">Rules</span>.Name, <span style="color:blue;">string</span>.Format(<span style="color:#a31515;">&quot;{0} should not start with a lowercase letter&quot;</span>, <span style="color:#2b91af;">Rules</span>.Name), <span style="color:#2b91af;">BrokenRules</span>.<span style="color:#2b91af;">Severity</span>.Warning, <span style="color:#2b91af;">Char</span>.IsLower(_name[0]));</span></p>
<p class="MsoListParagraph" style="margin:0cm 0cm 0pt 36pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Do I seriously have to create new rule classes for all of these kinds of rules? I have seen the </span></span><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:8pt;">Lambda</span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;"> rule but no sample of it in use. Wonder if it helps here?</span></span></p>
<p class="MsoListParagraph" style="margin:0cm 0cm 0pt 36pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin;"><span style="mso-list:Ignore;"><span style="font-family:Calibri;">5.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Finally, had anybody thought about how to use the old-style Assert method to somehow create, attach and apply rules to an object. I&rsquo;m thinking here about refactoring old code without actually changing it. </span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">Sorry if this is too long to read &ndash; I expect it is but I find it easier to give as much info up front rather than drip feed.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-size:10pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;"></span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="mso-bidi-font-size:11.0pt;"><span style="font-size:xx-small;"><em>I just hope the formatting stays intact!! On that note surely with all the combined skills here we could create a better site for this forum. I specifically have problems with 1. formatting and 2. searching - I&#39;d like a far more superior search experience with richer criteria and chained to tree-style results because searching through the results of a query is mess with all the re:xxx, re:xxx, re:xxx entries.</em></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 24, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>jh72i<br></b>
<p class="MsoNormal"><span style="FONT-SIZE:10pt;mso-bidi-font-size:11.0pt;"><span style="FONT-FAMILY:Calibri;"></span></span></p>
<p class="MsoNormal"><span style="mso-bidi-font-size:11.0pt;"><span style="FONT-SIZE:xx-small;"><em>I just hope the formatting stays intact!! On that note surely with all the combined skills here we could create a better site for this forum. I specifically have problems with 1. formatting and 2. searching - I&#39;d like a far more superior search experience with richer criteria and chained to tree-style results because searching through the results of a query is mess with all the re:xxx, re:xxx, re:xxx entries.</em></span></span></p>
<div style="CLEAR:both;"></div>
</div></p>
<p>Yes, this forum software has gotten long in the tooth - which is to say that it has not aged well, and increasingly has issues with various browsers. Worse, a number of the admin features have just quit working (who knows why)...&nbsp; Because I have a free license, I have no support, and I suspect Telligent is on hard times, because they aren&#39;t responsive in any way at all.</p>
<p>So I&#39;d welcome the idea of new forum software - probably something more like stackoverflow.com - I just wish I had time to write it :(</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Tuesday, October 25, 2011</h2><p>&gt;&gt;&nbsp;<span>So I&#39;d welcome the idea of new forum software - probably something more like stackoverflow.com - I just wish I had time to write it :( &lt;&lt;</span></p>
<p>Why not just use StackOverflow? Or more specifically create a stackexchange site?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, October 24, 2011</h2><p>The most comprehensive information on this topic is the <em>Using CSLA 4</em> ebook series.</p>
<p>1) A rule can declare that it needs the values of other properties by setting its input properties in the rule&#39;s constructor. The property info fields can be hardcoded in the constructor, or passed as parameters. The rule engine makes sure that the input property values are available to the rule when Execute is invoked.</p>
<p>2) There are a couple threads on lazy loading of objects and how that interacts with rules. The simplest thing is to put such rules (or at least a gateway rule) in your actual class, so the rule has access to the field manager&nbsp;- that way the rule can easily find out if the field has been loaded.</p>
<p>3) You can suppress rule execution, and then run all the rules manually. This is primarily used for web and service interfaces, where all properties of the object are loaded from postback data, and then the rules are run - that is more efficient. You could probably use rule suppression for loading from the database in the same way.</p>
<p>4) Yes, you do need to create a rule. The Lambda rule is designed to make creating super-simple rules easier.</p>
<p>5) This is why we created the Lambda rule - to make it easier to rewrite old-style delegate rules without the effort of creating a class. The same idea should apply to the older-old-style assert rules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, October 24, 2011</h2><p>Rocky has already answered most. From Csla 4.2 there are some added functions that will help you:</p>
<p>1. Rules will now consider both InputProperties and AffectedProperties as dependencies. </p>
<p>So you could have a rule like this: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:#fafafa;">&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">DependencyFrom</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessRule</span>
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;"> When any of the dependencyProperties i changed recheck rules for </span>PrimaryProperty
&nbsp;&nbsp;&nbsp; <span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp; <span style="color:blue;">public</span>&nbsp;DependencyFrom(Csla.Core.<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:blue;">params</span>&nbsp;Csla.Core.<span style="color:#2baaaf;">IPropertyInfo</span>[]&nbsp;dependencyProperties)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(InputProperties&nbsp;==&nbsp;<span style="color:blue;">null</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties.AddRange(dependencyProperties);
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;"> </span>can add bidirectional
&nbsp;&nbsp;&nbsp; <span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp; <span style="color:blue;">public</span>&nbsp;DependencyFrom(Csla.Core.<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;Csla.Core.<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;dependencyProperty,&nbsp;&nbsp;<span style="color:blue;">bool</span>&nbsp;isBiDirectional)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(InputProperties&nbsp;==&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties.Add(dependencyProperty);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(isBiDirectional)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AffectedProperties.Add(dependencyProperty);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}</pre>
<p>3. In data access code I&#39;d rather prefer to use BypassPropertyChecks - ie: your BO will not check Authorization rules (for write) or BusinessRules. </p>
<p>4. We have added several extension methods for Lambda rules, so you can now f.ex add like this:</p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule&lt;<span style="color:#2b91af;">Root</span>&gt;(Num1Property,&nbsp;o&nbsp;=&gt;&nbsp;o.Num1&nbsp;&gt;&nbsp;3,&nbsp;<span style="color:#a31515;">&quot;{0}&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;3&quot;</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule&lt;<span style="color:#2b91af;">Root</span>&gt;(Num2Property,&nbsp;o&nbsp;=&gt;&nbsp;o.Num2&nbsp;&gt;&nbsp;Num1,&nbsp;()&nbsp;=&gt;&nbsp;<span style="color:#2b91af;">Resources</span>.Num2LargerThanNum1,&nbsp;<span style="color:#2baf9a;">RuleSeverity</span>.Warning);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule(<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">Dependency</span>(Num1Property,&nbsp;Num2Property));</pre>
<p>&nbsp; We have NOT created overloads that accepts input/affected properties to create dependencies - but you can extend these further for your own use. </p>
<p>5.&nbsp; Not focused on the old style of Assert, but I have been working on an article for adding the 3.8.x rule methods in 4.2 with lambda rules to support existing code. Article and code is not quite ready yet for publishing. :-(</p>
<p>For samples/intro on rules look at the \Samples\Net\cs\RuleTutorial project in 4.2 Samples download. Still work in progress but does show the possibilities with the new rule engine.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, October 25, 2011</h2><p>Fantastic. Thank you both so much for 1. taking the time to read that tome and 2. providing such comprehensive answers. I still have things to figure out but with a comfort level now that my issues are addressed.</p>
<p><em>There is no doubt that the content of this forum is excellent so hopefully someone has a suggestion for a worthy presentation!</em></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, October 25, 2011</h2><p>Spent a wee while looking at this now including the BusinessRuleDemo project. Please don&#39;t take this the wrong way but my feedback would be that I really feel you have taken a beautifully simple concept (Assert) and replaced it with something overly complex and less usable.&nbsp;</p>
<p>I&#39;m new to it so&nbsp;am certainly speaking without being fully equipped but I&nbsp;expect many people have&nbsp;or will have struggled with this. And I feel I&#39;m writing code that I really don&#39;t want to write&nbsp;-&nbsp;my goal of concise, simple yet powerful&nbsp;business object classes looks like its going to take a knock!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, October 25, 2011</h2><div class="ForumPostTitle">
<div class="ForumPostTitleInner">
<div class="ForumPostButtons">
<p><div style='padding-left: 50px;background-color:silver'><b>[quote]</b></p>
</div>
<a href="http://forums.lhotka.net/forums/p/9187/43619.aspx#43619"><img src="http://forums.lhotka.net/Themes/hawaii/images/status_SuggestedAnswer.gif" alt="Answered (Not Verified)" style="BORDER-RIGHT-WIDTH:0px;FLOAT:left;BORDER-TOP-WIDTH:0px;BORDER-BOTTOM-WIDTH:0px;BORDER-LEFT-WIDTH:0px;MARGIN-RIGHT:5px;" /><span style="color:#003399;"> </span></a><strong><a href="http://forums.lhotka.net/members/RockfordLhotka/default.aspx"><span style="color:#003399;">RockfordLhotka</span></a></strong> <span class="ForumPostTitleDate"><a href="http://forums.lhotka.net/forums/p/9187/43610.aspx#43610"><span style="color:#3366cc;font-size:xx-small;">replied on</span></a><span style="font-size:xx-small;"> Fri, Jul 9 2010 2:14 AM </span></span>
<div style="CLEAR:both;"><span style="font-size:xx-small;"></span></div>
<div><span style="font-size:xx-small;"></span></div>
</div>
<div class="ForumPostSuggestedBySection">Suggested by <a href="http://forums.lhotka.net/members/RockfordLhotka/default.aspx"><span style="color:#003399;">RockfordLhotka</span></a></div>
</div>
<div style="CLEAR:both;"><span style="color:#003399;"></span></div>
<p>The Lambda rule is really an experiment for implementing the most trivial of custom rules - I&#39;m not entirely sure it is terribly useful to be honest.</p>
<p>For anything beyond the most trivial of rules, I create actual rule types.</p>
<p>The thing about Lambda is that it doesn&#39;t achieve any testability, so it doesn&#39;t really seem all that great to me for anything beyond super-trivial one-liner rules.</p>
<p></div></p>
<p>Rocky, for migration of a large base of code I cannot see any achiveable way other than replacing Asserts with the Lambda &amp; Dependency rules (nice work on those extensions Jonny). Can you illustrate/explain&nbsp;some of those&nbsp;testabilty issues?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, October 25, 2011</h2><p>Hi, </p>
<p>I&nbsp; have another post in progress for unit testing of business rules. If you&#39;re interested in the code then send private message. </p>
<p>I am considering to add unit testing as separate project to RuleTutorial. (Read: I want to propose another way of testing the rule implementation rather than creating integration tests in the samples).</p>
<p>The RuleTutorial is simple console apps to illustrate how the DataBinding interfaces can be used and I also addded Console.WriteLine inside some of the rules to illustrate the context in which the rules run. That would not be so visible with unit tests.</p>
<p>Ex. from TransformationRules: </p>
<p><i><b>.... Rule ToUpper running from CheckRules<br />DataPortal_Create finished<br />.... Rule ToUpper running from Name was changed<br />.... Rule CollapseSpace running from Name was changed<br />set value: &quot;RoCkY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lHoTkA&quot; and actual is &quot;ROCKY LHOTKA&quot;<br /><br />About to set Num1,&nbsp; old value: 0<br />.... Rule CalcSum running from affected property or input property<br />Num1 set to: 8 and Sum is 8<br /><br />About to set Num2, old value: 0<br />.... Rule CalcSum running from affected property or input property<br />set Num2: 14 and Sum is 22<br /><br />Press &lt;ENTER&gt; to continue.</b></i></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 25, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>jh72i<br></b>
<p>Spent a wee while looking at this now including the BusinessRuleDemo project. Please don&#39;t take this the wrong way but my feedback would be that I really feel you have taken a beautifully simple concept (Assert) and replaced it with something overly complex and less usable.&nbsp;</p>
</div></p>
<p>There are problems with Assert.</p>
<ul>
<li>They are hard/impossible to unit test</li>
<li>You need to run rules on object creation and when properties are set - Assert doesn&#39;t allow for this</li>
<li>You sometimes need to run all rules before saving an object - Assert doesn&#39;t allow for this</li>
<li>You sometimes need to run all rules on a postback (like from Silverlight) - Assert doesn&#39;t allow for this</li>
</ul>
<p>Obviously you can overcome these issues, and people wrote what amounts to their own rules engine to make this all work.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Wednesday, October 26, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b> </p>
<p>There are problems with Assert.</p>
<ul>
<li>They are hard/impossible to unit test </li>
<li>You need to run rules on object creation and when properties are set - Assert doesn&#39;t allow for this </li>
<li>You sometimes need to run all rules before saving an object - Assert doesn&#39;t allow for this </li>
<li>You sometimes need to run all rules on a postback (like from Silverlight) - Assert doesn&#39;t allow for this </li>
</ul>
<p>Obviously you can overcome these issues, and people wrote what amounts to their own rules engine to make this all work.</p>
<p></div></p>
<p>I suppose that&#39;s my struggle: I had overcome those&nbsp;last 3 issues so many years ago with my own simple IsBroken() and SetProperty(,,,,, rule1, rule2) that I&#39;m struggling now <em>emotionally</em> dumping that in favour of the new Csla way. I had always accumulated rules in one place/method&nbsp;in each business class but cannot remember now if that if you did that in pure Csla.</p>
<p>With the first I&#39;m still a little in the dark.&nbsp;What is hard about testing the business rules? Ok, again, I&#39;m a little unfamiliar with&nbsp;exactly how Csla does things&nbsp;these days but my own tests might look&nbsp;something like:&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:blue;FONT-SIZE:8pt;">var</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;"> name = <span style="COLOR:#a31515;">&quot;New User&quot;</span>;<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:blue;FONT-SIZE:8pt;">var</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;"> newObj = <span style="COLOR:#2b91af;">User</span>.Create(<span style="COLOR:blue;">new</span> <span style="COLOR:#2b91af;">User</span>.<span style="COLOR:#2b91af;">CriteriaCreate</span>(name));<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.IsNotNull(newObj);<span style="mso-tab-count:7;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:green;">// ** check that it was actually created<br /></span></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.AreEqual(name, newObj.Name);<span style="COLOR:green;">// ** and created with the right name<br /><br /></span></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:blue;FONT-SIZE:8pt;">var</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;"> breakingValue = <span style="COLOR:#a31515;">&quot;name that is too long&quot;</span>;<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">newObj.Name = breakingValue;<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.AreEqual&lt;<span style="COLOR:blue;">string</span>&gt;(breakingValue, newObj.Name); <span style="COLOR:green;">// ** check that the bad name was set<br /></span></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.IsFalse(newObj.IsValid); <span style="COLOR:green;">// ** check that the object is invalid. It&nbsp;should be!</span></span></p>
<p class="MsoNormal"><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;"><span style="COLOR:green;"></span></span>&nbsp;<span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:green;FONT-SIZE:8pt;">// alternative: individual rule check<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.IsFalse(newObj.IsBroken(<span style="COLOR:#2b91af;">User</span>.Rules.Name));</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:green;FONT-SIZE:8pt;">// for illustration: this would fail but kickout the broken rules also<br /></span><span style="FONT-FAMILY:&#39;Courier New&#39;;COLOR:#2b91af;FONT-SIZE:8pt;">Assert</span><span style="FONT-FAMILY:&#39;Courier New&#39;;FONT-SIZE:8pt;">.IsTrue(newObj.IsValid, newObj.BrokenRulesString); <span style="COLOR:green;">// ** check that the object is valid</span></span></p>
<p>There is, of course, the concept of exposing the Rules associated with the class but in reality these are simply shortcut strings referring to the property names. I can easily call <span style="font-family:Courier New;font-size:x-small;">newObj.IsBroken(&quot;Name&quot;)</span>. I chose not to use PropertyInfo at the time because of the overhead and lack of simplicity.</p>
<p>Anyway, in pure Clsa (old versions) could you not just Assert IsValid, set a property, then Assert IsValid again. Is that too simplistic?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Wednesday, October 26, 2011</h2><p>Just to confirm is this how I should be&nbsp;testing for rule breaks in Csla 4.x:&nbsp;</p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:8pt;">var</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;"> br = newObj.BrokenRulesCollection.GetFirstBrokenRule(<span style="color:#2b91af;">UserSetting</span>.ItemKeyProperty);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:8pt;">Assert</span><span style="font-family:&#39;Courier New&#39;;font-size:8pt;">.IsNull(br, br.Description);</span></p>
<p>
<p>&nbsp;</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Wednesday, October 26, 2011</h2><p>I believe the testing issue Rocky refers to is testing the rule logic itself.&nbsp; Under the old system, you&#39;re testing your business rules within the context of the BO itself.&nbsp; This means you have to create a BO, and deal with all the other attendant code that goes along with that, just to make sure your business rule is functioning properly.&nbsp; Making rules &quot;first class citizens&quot; - i.e. objects in and of themselves -&nbsp;means you can test the rule in isolation and confirm that it works regardless of the BO it&#39;s used in.&nbsp; Then, if you have a BO where the rule isn&#39;t functioning properly, but you have rule tests that say it does, you know the problem is in your BO and not the rule.&nbsp; Conversely, it also allows for testing&nbsp;the BO without&nbsp;potentially having&nbsp;the rule logic&nbsp;pollute your tests.</p>
<p>I admit it can be a subtle difference, but it&#39;s an important one from a unit-test perspective.</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Wednesday, October 26, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>tmg4340<br></b>I believe the testing issue Rocky refers to is testing the rule logic itself</div></p>
<p>Thanks guys for the replies. You know what I had actually understood the concept of testing the rule itself in isolation but didn&#39;t mention it. Was going to but as the conversation was in the context of the Assert approach I decided not to confuse things. I have always created common rules (as alluded to before) so testing of these in isolation is obviously a very good idea. But, of course, their usage often give them the context they need to be actually useful so testing the rules associated with a business object in various states is a goal too.</p>
<p>I was particularly interested in why the Assert mechanism is so &quot;hard/impossible to unit test&quot;. </p>
<p>Of course I don&#39;t want to drag anybody off on a tangent of why this or that wasn&#39;t done this or that way. The decisions have been made and, the thing is, the quality of Csla gives me confidence in those decisions - that they are the right road for Csla. Doesn&#39;t necessarily mean I won&#39;t pursue what I perceive to be a simpler approaches throughout&nbsp;the framework if I can maintain the integrity of the code at the same time. </p>
<p>Of course also it would be remiss not to provide feedback to Rocky from the front line. Sometimes we design and code something that we later realize isn&#39;t ideal. Assert obviously&nbsp;being one example albeit I still harbour feelings that it was a great approach.</p>
<p>Thanks again for the feedback and the code snippets. In terms of testing the Validity of a business object I wonder if you could tell me the approach you use - how you test a specific property/rule<img src="http://forums.lhotka.net/emoticons/emotion-56.gif" alt="Sleep" /> relationship?</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 26, 2011</h2><p>Personally I often test rules within the context of the object - just like you have been doing previously.</p>
<p>That is problematic though, for two reasons:</p>
<ol>
<li>More test-focused developers dislike that, because it is an integration test, and I wanted to ensure true unit testing was possible</li>
<li>Properties that have a lot of rules, especially if you add in async rules, are extremely hard to test like this - it is almost always easier to test the rule independent from the property</li>
</ol>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Thursday, October 27, 2011</h2><p>Thanks for this Rocky - that I might be a Csla dinosaur but my ways are not totally extinct yet is good to know. </p>
<p>And, oh yeah, <em>async</em> rules - another area I am looking forward to uncovering :)&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 26, 2011</h2><p>In the pure sense of Unit Testing you&#39;ll want to test the actual rule and that class only - rather than an integration test that involves the actual BO and all linked rules. </p>
<p>Take into consideration:</p>
<ol>
<li>Validation Rules - that only set errror/warn/info.</li>
<li>Transformation rules that changes the value.</li>
<li>Lookup rules that set properties (and trigger new run of validation rules)</li>
<li>Async vs Sync rules. </li>
<li>more ... </li>
</ol>
<p>So as an example for testing a Lookup Rule:</p>
<p>&nbsp;</p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;"> &nbsp;&nbsp; [<span style="color:#2b91af;">TestClass</span>()]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">LookupCustomerTest</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessRuleTestBase</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:#2b91af;">Root</span>&nbsp;_myBO;
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestInitialize</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;InitTests()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_myBO&nbsp;=&nbsp;<span style="color:#2b91af;">Activator</span>.CreateInstance&lt;<span style="color:#2b91af;">Root</span>&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;rule&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">LookupCustomer</span>(<span style="color:#2b91af;">Root</span>.CustomerIdProperty,&nbsp;<span style="color:#2b91af;">Root</span>.NameProperty);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeTest(rule,&nbsp;_myBO);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Rule_MustBeSync()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsFalse(Rule.IsAsync);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Rule_MustHaveCustomerIdAsPrimaryProperty()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsNotNull(Rule.PrimaryProperty);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.AreEqual(<span style="color:#2b91af;">Root</span>.CustomerIdProperty,&nbsp;Rule.PrimaryProperty);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Rule_MustHaveInputProperties_CustomerNumber()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsTrue(Rule.InputProperties.Contains(<span style="color:#2b91af;">Root</span>.CustomerIdProperty));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Rule_MustHaveAffectedProperties_Name()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsTrue(Rule.AffectedProperties.Contains(<span style="color:#2b91af;">Root</span>.NameProperty));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute_MustSetOutputProperty()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;load&nbsp;values&nbsp;into&nbsp;BO</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadProperty(_myBO,&nbsp;<span style="color:#2b91af;">Root</span>.CustomerIdProperty,&nbsp;21164);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExecuteRule();&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;will&nbsp;add&nbsp;values&nbsp;into&nbsp;InputPropertyValues&nbsp;in&nbsp;RuleContext</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsTrue(RuleContext.OutputPropertyValues.ContainsKey(<span style="color:#2b91af;">Root</span>.NameProperty));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.AreEqual(<span style="color:#a31515;">&quot;Name&nbsp;(21164)&quot;</span>,&nbsp;RuleContext.OutputPropertyValues[<span style="color:#2b91af;">Root</span>.NameProperty]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute_MustSetOutputProperty2()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;run&nbsp;rule&nbsp;with&nbsp;supplied&nbsp;InputProperties&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExecuteRule(<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">Dictionary</span>&lt;IPropertyInfo,&nbsp;<span style="color:blue;">object</span>&gt;()&nbsp;{&nbsp;{&nbsp;<span style="color:#2b91af;">Root</span>.CustomerIdProperty,&nbsp;21164&nbsp;}});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.IsTrue(RuleContext.OutputPropertyValues.ContainsKey(<span style="color:#2b91af;">Root</span>.NameProperty));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.AreEqual(<span style="color:#a31515;">&quot;Name&nbsp;(21164)&quot;</span>,&nbsp;RuleContext.OutputPropertyValues[<span style="color:#2b91af;">Root</span>.NameProperty]);
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;in&nbsp;the&nbsp;samme&nbsp;manner&nbsp;I&nbsp;&nbsp;could&nbsp;also&nbsp;test&nbsp;for</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//Assert.IsTrue(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;&nbsp;&nbsp;&nbsp;RuleContext.Results.Any(p&nbsp;=&gt;&nbsp;p.PrimaryProperty&nbsp;==&nbsp;Root.NameProperty&nbsp;&amp;&amp;&nbsp;p.Severity&nbsp;==&nbsp;RuleSeverity.Error));</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 &nbsp;&nbsp;&nbsp; }</pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
