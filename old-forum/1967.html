<html><header><title>base.Save() error messagion:  Invalid operation - update not allowed </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>base.Save() error messagion:  Invalid operation - update not allowed </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1967.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shaase posted on Wednesday, December 13, 2006</h2><P><FONT color=#0000ff>I am using version 1.53 in conjuction with the CodeSmith 3.2 Editable Child Object template.<BR><BR>When I go to 'save' the contents of my object back to the SQL Server 2000 database, I get the error below.&nbsp; This object is not part of a collection.&nbsp; Bascially, it's really simple.&nbsp; I have attached my code to the end of this post (minus the property definitions).<BR><BR></FONT><FONT color=#0000ff>Is there an easy fix for this error???&nbsp; I must be missing something here.</FONT></P>
<P><FONT color=#0000ff>Thanx in advance,</FONT></P>
<P><FONT color=#0000ff>SKH</FONT></P>
<H2><I>Invalid operation - update not allowed</I> </H2>
<P><FONT face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif "><B>Description: </B>An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <BR><BR><B>Exception Details: </B>System.NotSupportedException: Invalid operation - update not allowed<BR><BR><B>Source Error:</B> <BR><BR></P>
<P>
<TABLE bgColor=#ffffcc>

<TR>
<TD><CODE><PRE>Line 399:		//				}
Line 400:		//			}
<FONT color=red>Line 401:			return base.Save();
</FONT>Line 402:		}
Line 403:		#endregion</PRE></CODE></TD></TR></TABLE></P><FONT color=#0000ff size=2>
<P><FONT face=Verdana><STRONG>Source File: </STRONG><FONT face=Arial>c:\inetpub\wwwroot\cap_wf_tfs\data objects\contact_single_obj.cs</FONT><FONT face=Verdana><STRONG> &nbsp;&nbsp; Line: </STRONG></FONT><FONT face=Arial>401 </FONT><BR></FONT><BR><BR>using System;<BR>using System.Data;<BR>using System.Data.SqlClient;<BR>using CSLA;<BR>using CSLA.Data;</P>
<P>namespace Workflows.dataObjects<BR>{ <BR>&nbsp;/// &lt;summary&gt; <BR>&nbsp;/// This business object represents the properties and methods of the dbo.Contacts Table. <BR>&nbsp;/// It corresponds to the EDITABLE CHILD OBJECT as outlined in the Book "Expert One-on-One VB.NET Business Objects" <BR>&nbsp;/// Object was generated on 9/13/2006 10:01:28 PM - By shaase <BR>&nbsp;/// &lt;/summary&gt; <BR>&nbsp;/// &lt;remarks&gt; <BR>&nbsp;/// Parameters used to generate this class.<BR>&nbsp;/// Business Object<BR>&nbsp;///&nbsp;&nbsp;ClassNamespace&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Workflows.dataObjects<BR>&nbsp;///&nbsp;&nbsp;ObjectName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Contact_Single_Obj<BR>&nbsp;///&nbsp;&nbsp;RootTable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = PEOGCSWF.dbo.Contacts<BR>&nbsp;///<BR>&nbsp;/// Child Options<BR>&nbsp;///&nbsp;&nbsp;ChildCollectionName = <BR>&nbsp;///&nbsp;&nbsp;ChildMemberName&nbsp;&nbsp;&nbsp;&nbsp; = <BR>&nbsp;///&nbsp;&nbsp;ParentName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <BR>&nbsp;///&nbsp;&nbsp;ParentType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <BR>&nbsp;///<BR>&nbsp;/// Options<BR>&nbsp;///&nbsp;&nbsp;MemberPrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = m_<BR>&nbsp;///&nbsp;&nbsp;FLCPrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&nbsp;&nbsp;&nbsp; <BR>&nbsp;///&nbsp;&nbsp;Accessibility&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Public<BR>&nbsp;///&nbsp;&nbsp;Serializable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = True<BR>&nbsp;///&nbsp;&nbsp;MustBeInherited&nbsp;&nbsp;&nbsp;&nbsp; = False<BR>&nbsp;///&nbsp;&nbsp;TransactionType&nbsp;&nbsp;&nbsp;&nbsp; = ADO<BR>&nbsp;/// <BR>&nbsp;/// Stored Procedure Style<BR>&nbsp;///&nbsp;&nbsp;GeneralSPPrefix&nbsp;&nbsp;&nbsp;&nbsp; = <BR>&nbsp;///&nbsp;&nbsp;InsertPrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Add<BR>&nbsp;///&nbsp;&nbsp;UpdatePrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Update<BR>&nbsp;///&nbsp;&nbsp;DeletePrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Delete<BR>&nbsp;///&nbsp;&nbsp;SelectPrefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = Get<BR>&nbsp;/// &lt;/remarks&gt;<BR>&nbsp;[Serializable] <BR>&nbsp;public class Contact_Single_Obj : CSLA.BusinessBase<BR>&nbsp;{</P>
<P>&nbsp;&nbsp;#region Class Level Private Variables</P>
<P>&nbsp;&nbsp;private int m_ID = 0;&nbsp;&nbsp;//**PK<BR>&nbsp;&nbsp;private string m_Account = string.Empty; <BR>&nbsp;&nbsp;private string m_FirstName = string.Empty; <BR>&nbsp;&nbsp;private string m_MiddleName = string.Empty; <BR>&nbsp;&nbsp;private string m_LastName = string.Empty; <BR>&nbsp;&nbsp;private string m_Location = string.Empty; <BR>&nbsp;&nbsp;private string m_EmailAddress = string.Empty; <BR>&nbsp;&nbsp;private string m_JobTitle = string.Empty; <BR>&nbsp;&nbsp;private string m_EmailDisplayName = string.Empty; <BR>&nbsp;&nbsp;private string m_BusinessPhone = string.Empty; <BR>&nbsp;&nbsp;private string m_BusinessPhone2 = string.Empty; <BR>&nbsp;&nbsp;private string m_Company = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessStreet = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessStreet2 = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessStreet3 = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessCity = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessState = "MI";<BR>&nbsp;&nbsp;private string m_BusinessPostalCode = string.Empty;<BR>&nbsp;&nbsp;private string m_BusinessCountry = "USA";<BR>&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;#endregion //Class Level Private Variables</P>
<P>&nbsp;&nbsp;#region Constructors<BR>&nbsp;&nbsp;public Contact_Single_Obj() <BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;// prevent direct creation<BR>&nbsp;&nbsp;&nbsp;// Show the framework that this is a child object<BR>//&nbsp;&nbsp;&nbsp;MarkAsChild();<BR>&nbsp;&nbsp;&nbsp;CheckRules("");<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;#endregion //Constructors</P>
<P><BR>&nbsp;&nbsp;public bool IsSaveable<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;//Since you cannot bind a control to multiple properties you need to create a property that combines the ones you need<BR>&nbsp;&nbsp;&nbsp;//In this case, bind the UI Save button Enabled property to IsSaveable. (Why save an object that has not changed?)<BR>&nbsp;&nbsp;&nbsp;get { return IsValid &amp;&amp; IsDirty; }<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;private void CalculateDisplayName()<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;m_EmailDisplayName = m_LastName + ", " + m_FirstName + m_MiddleName.Trim() + " (" + this.m_EmailAddress + ")";</P>
<P>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;#endregion //Business Properties and Methods</P>
<P><BR>&nbsp;&nbsp;public override BusinessBase Save() <BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;return base.Save();<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;#endregion</P>
<P>&nbsp;&nbsp;#region Static Methods<BR>&nbsp;&nbsp;public static Contact_Single_Obj NewContact(int id)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;return (Contact_Single_Obj) DataPortal.Create(new Criteria(id));<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;public static Contact_Single_Obj GetContact(int ID)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;return (Contact_Single_Obj) DataPortal.Fetch(new Criteria(ID));<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;#endregion //Static Methods</P>
<P>&nbsp;&nbsp;#region Criteria (identifies the Individual Object/ Primary Key)<BR>&nbsp;&nbsp;[Serializable]<BR>&nbsp;&nbsp;&nbsp;private class Criteria <BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;public int m_id = 0;&nbsp;&nbsp;//**PK<BR>&nbsp;&nbsp;&nbsp;public Criteria(int ID) <BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;this.m_id = ID;<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;#endregion //Criteria</P>
<P>&nbsp;&nbsp;#region Data Access<BR>&nbsp;&nbsp;protected override void DataPortal_Create(object criteria)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;// Called by DataPortal so that we can set defaults as needed<BR>&nbsp;&nbsp;&nbsp;// Create new object with default stored in the database<BR>&nbsp;&nbsp;&nbsp;Criteria crit = (Criteria) criteria;<BR>&nbsp;&nbsp;&nbsp;m_ID = crit.m_id;<BR>&nbsp;&nbsp;&nbsp;CheckRules("");<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;protected override void DataPortal_Fetch(object criteria)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;//Called by DataPortal to load data from the database<BR>&nbsp;&nbsp;&nbsp;//retrieve data from database<BR>&nbsp;&nbsp;&nbsp;Criteria crit = (Criteria) criteria;<BR>&nbsp;&nbsp;&nbsp;SqlConnection cn = new SqlConnection(DB("CAP_WF"));<BR>&nbsp;&nbsp;&nbsp;SqlCommand cm = new SqlCommand();</P>
<P>&nbsp;&nbsp;&nbsp;cn.Open();<BR>&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Connection = cn;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandType = CommandType.StoredProcedure;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = "contacts_get";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@ID", crit.m_id); // 0 brings back all contacts</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SafeDataReader dr = new SafeDataReader(cm.ExecuteReader());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (dr.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_ID = dr.GetInt32(0);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.LastName = dr.GetString(1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.FirstName = dr.GetString(2);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Account = dr.GetString(3);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Location = dr.GetString(4);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.EmailAddress = dr.GetString(5);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.EmailDisplayName = dr.GetString(6);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessPhone = dr.GetString(7);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessPhone2 = dr.GetString(8);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.MiddleName = dr.GetString(9);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.JobTitle = dr.GetString(10);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Company = dr.GetString(11);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessStreet = dr.GetString(12);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessStreet2 = dr.GetString(13);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessStreet3 = dr.GetString(14);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessCity = dr.GetString(15);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessState = dr.GetString(16);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessPostalCode = dr.GetString(17);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.BusinessCountry = dr.GetString(18);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarkOld();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CheckRules("");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dr.Close();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;catch(Exception ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw(ex);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;finally<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;cn.Close();<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;internal void Update()<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;//Called by DataPortal to delete/add/update data into the database<BR>&nbsp;&nbsp;&nbsp;// This occurs when you use the collection.save() method<BR>&nbsp;&nbsp;&nbsp;SqlConnection cn = new SqlConnection(DB("CAP_WF"));<BR>&nbsp;&nbsp;&nbsp;SqlTransaction tr;<BR>&nbsp;&nbsp;&nbsp;SqlCommand cm = new SqlCommand();<BR>&nbsp;&nbsp;&nbsp;cn.Open();<BR>&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;tr = cn.BeginTransaction(IsolationLevel.Serializable);<BR>&nbsp;&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Connection = cn;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Transaction = tr;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandType = CommandType.StoredProcedure;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(this.IsDeleted)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//is deleted object, check if new<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!this.IsNew)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = "contacts_delete";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@id", m_ID); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.ExecuteNonQuery();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// reset the object status to be new<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarkNew();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (this.IsDirty)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// is not deleted object, check if this is an update or insert<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(this.IsNew)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//perform an insert, object has not been persisted<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = "contacts_insert";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@ID", m_ID); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters["@ID"].Direction = ParameterDirection.Output;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//perform an update, object is not new so object has already been persisted<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = "contacts_update";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@ID", m_ID); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@Account", m_Account); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@FirstName", m_FirstName); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@MiddleName", m_MiddleName); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@LastName", m_LastName); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@Location", m_Location); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@EmailAddress", m_EmailAddress); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@EmailDisplayName", m_EmailDisplayName); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessPhone", m_BusinessPhone); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessPhone2", m_BusinessPhone2); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@Company", m_Company); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessStreet", m_BusinessStreet); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessStreet2", m_BusinessStreet2); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessStreet3", m_BusinessStreet3); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessCity", m_BusinessCity); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessState", m_BusinessState); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessPostalCode", m_BusinessPostalCode); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@BusinessCountry", m_BusinessCountry); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.Add("@JobTitle", m_JobTitle); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.ExecuteNonQuery();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_ID = Convert.ToInt32(cm.Parameters["@ID"].Value); //Grab the new ID from the inserted record.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarkOld();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tr.Commit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;catch(Exception ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tr.Rollback();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw(ex);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;finally<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;cn.Close();<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;#endregion //Data Access</P>
<P>&nbsp;}<BR>}<BR></P>
<P></FONT>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, December 13, 2006</h2>The problem is that you generated your BO as if it where a child object.<br>Then you commented out the MarkAsChild call in the constructor, but the update method is still "Update()". The dataportal is looking for a Dataportal_Update(), but since it's not overriden in your class it's looking for that method and it finds the one in businessbase, which ends up throwing that exception.<br><br><br>I hope that helps!<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shaase replied on Wednesday, December 13, 2006</h2><P><FONT face=Arial color=#000000 size=2>Andres,<BR><BR>Thank you!&nbsp; That did it.&nbsp; I was looking too much at the detail and not enough at the overall picture.<BR><BR>I changed my "</FONT><FONT face=Arial color=#000000 size=2><FONT color=#0000ff>internal void Update()</FONT>" to "<FONT color=#0000ff>protected override void DataPortal_Update()</FONT>" and it works!<BR><BR>I can't thank you enough!<BR><BR>Sometimes, I just have to stand up and take a 5 minute walk and then come back after chilling out.<BR><BR>Have a good one!<BR><BR>SKH</FONT><FONT color=#008000></P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
