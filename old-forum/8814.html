<html><header><title>save issue when moving from csla 2 to csla 3.8</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>save issue when moving from csla 2 to csla 3.8</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8814.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gaustin42 posted on Monday, April 19, 2010</h2><p>We have just moved from csla 2 to 3.8 and are having a strange issue when saving a collection.</p>
<p>We have made no code changes</p>
<p>The BusinessListBase object DataPortal_Update we persist the children as such</p>
<p>&nbsp;&nbsp; foreach (DocumentCommunication child in this)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child.IsNew)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.Insert(cn);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (child.IsDirty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.Update(cn);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>And if you check the IsNew property of each child post insert they are all marked as old.</p>
<p>The collection is held in a windows form. After collection.Save we are finding that with 3.8 the child that has been inserted succesfully is still marked as New when inspecting the collection from the windows form, yet the code processes correctly and the child is marked as old when inspecting from within the collection.</p>
<p>So as we save this collection it consistently continues to insert the new objects even though they have already been inserted and marked as old.</p>
<p>What might we need to change to remove this behaviour?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>rsbaker0 replied on Monday, April 19, 2010</h2><p>I&#39;m not sure what the exact implementations of your Insert() and Update() methods are, but sometime around CSLA 3.0 it became necessary to replace your existing references with the returned value from the data portal. </p>
<p>You have to write:</p>
<p>obj = obj.Save();</p>
<p>After any Save() call on an object, the previous reference is stale and should not be used again.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
