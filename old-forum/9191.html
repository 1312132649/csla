<html><header><title>RegisterProperty for derived classes in 4.0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>RegisterProperty for derived classes in 4.0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9191.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis posted on Friday, July 09, 2010</h2><p>RegisterProperty registers all properties with the type specified by the generic argument T.</p>
<p>Given this example:</p>
<p>&nbsp;public abstract class SomeBase : BusinessBase&lt;SomeBase&gt;<br />{<br />&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;int&gt; BaseIntProperty = RegisterProperty(new PropertyInfo&lt;int&gt;(&quot;BaseInt&quot;));<br />}</p>
<p>public class SomeDerived1 : SomeBase<br />{<br />&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;int&gt; Int1Property = RegisterProperty(new PropertyInfo&lt;int&gt;(&quot;Int1&quot;));<br />}</p>
<p>public class SomeDerived2 : SomeBase<br />{<br />&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;int&gt; Int2Property = RegisterProperty(new PropertyInfo&lt;int&gt;(&quot;Int2&quot;));<br />}</p>
<p>Int1 and Int2 are registered with SomeBase not with SomeDerived1 and SomeDerived2. I didn&#39;t really expect that. Is this as it is supposed to?</p>
<p>Furthermore once you create an instance of SomeDerived1 the property list for SomeBase gets locked. Then instantiating SomeDerived2 will result in the InvalidOperationException:</p>
<p>Can not register property Int2 after containing type (SomeBase) has been instantiated</p>
<p>&nbsp;</p>
<p>Some thoughts:</p>
<p>- Shouldn&#39;t properties be registered with their DeclaringType. For the overloads using the lambda expression that value is available from reflectedPropertyInfo. For the other overloads you could use StackTrace to find out the calling (decalring)&nbsp;type&nbsp;but that might be expensive. An alternative is specifying it as an extra argument to RegisterProperty but that won&#39;t guarantee that the specified type equals the declaring type. That however can be checked from the System.Reflection.PropertyInfo.</p>
<p>- The overloads using lambda expressions can not be used from derived classes. You could however specify an overload like:</p>
<p>protected static TjipPropertyInfo&lt;P&gt; RegisterProperty&lt;C, P&gt;(Expression&lt;Func&lt;C, object&gt;&gt;...<br />&nbsp;&nbsp;&nbsp; where C : T</p>
<p>Not ideal but it provides intellisense assistance</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, July 09, 2010</h2><p>When creating an abstract base type, that type must be generic. Or you can&#39;t use the generic overloads of RegisterProperty() - the choice is yours.</p>
<p>Obviously the type T is frozen at the point where your types become non-generic - that&#39;s the way generics work.</p>
<p>Using things like stack traces and whatnot is not only slow, but unreliable. Look at CSLA 2 and some of the ways it used that technique - then see how those techniques are gone now? That&#39;s because the .NET JIT compilers added optimizations that entirely break that technique. Things that work in debug mode may or may not work in 32 or 64 bit JIT release mode.</p>
<p>In short: your base types must be generic, or you must avoid the generic overloads of RegisterProperty().</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nelis replied on Monday, July 12, 2010</h2><p>I understand, but what I am saying is that you can&#39;t even use the non-generic overloads of RegisterProperty if you have multiple derived classes</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 12, 2010</h2><p>Let me try to be more clear then.</p>
<p>Multiple derived <i>non-generic</i> classes are not supported by BusinessBase&lt;T&gt; or the other generic base classes. You can have multiple derived classes, but they must be generic.</p>
<p>If you want multiple non-generic classes, then you must derive from Csla.Core.BusinessBase. You&#39;ll give up some functionality, but you also avoid the limitations imposed by generics.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
