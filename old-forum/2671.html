<html><header><title>Calling DataPortal_XYZ of unknown class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Calling DataPortal_XYZ of unknown class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2671.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam posted on Tuesday, April 10, 2007</h2><P>Hi all,</P>
<P>I have my base object Document&lt;T&gt;: BusinessBase&lt;T&gt; and some inherited specific document classes. I want in Document&lt;T&gt; to make factory method:</P>
<P>public Document&lt;T&gt; GetDocument(Guid id)</P>
<P>that will instanciate&nbsp; appropriate document and call its DataPortal_Fech method. I can determine type of document out of id, but problem is in calling DataPortal.Fetch&lt;documentType&gt;. Any ideas how to solve this?</P>
<P>Tnx,</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, April 10, 2007</h2>Hi,<br><br>In your base Document(Of T) class you could have this method:<br><br>&nbsp;&nbsp;&nbsp; Public Shared Function Fetch(ByVal id As Guid) As T<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not CanGetObject() Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New System.Security.SecurityException("User not authorized to view this object")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DataPortal.Fetch(Of T)(New GuidCriteria(id))<br>&nbsp;&nbsp;&nbsp; End Function<br><br><br>In the dataport_fetch methods of your concrete document classes (so subclasses of this base document) you recieve the GuidCriteria and populate the fields of the class.<br><br>You said that based on the ID you can determine what type of document should be returned, but since you are using Generics you don't have to perform such a check.<br><br>Bayu<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam replied on Tuesday, April 10, 2007</h2><P>Hi Bayu,</P>
<P>I'm affraid it can't be done that way. That approach mean that when I'm calling procedure I know what type is it, ie.&nbsp;Document&lt;Invoice&gt;.Fetch would return Invoice (it is T in fetch method). Look at Document&lt;T&gt; just as a factory class. It could be&nbsp;some DocumentFactory class, thus not CSLA based. Then I would have: </P>
<P>public static Document&lt;T&gt; DocumentFactory.Fetch(Guid id)</P>
<P>{ ..... }</P>
<P>In this method I get type of object whos&nbsp;ID is provided id parameter. I can do it. But when I get that type, I should call: </P>
<P>return DataPorta.Fetch&lt;<FONT color=#ff0000>ofThatType</FONT>&gt;(SomeCriteria criteria). </P>
<P>Problem is in red part. It just can't be called that way!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, April 10, 2007</h2>Hi,<br><br>Is it perhaps a solution to define your Document class like this:<br><br>&lt;Serializable()&gt; _<br>Public MustInherit Class Document<br>&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of Document)<br><br>End Class<br><br><br>This way you end the chain of Generics at this class. This mean also that you would have to implement all dp_methods in this class, which seems to be exactly what you are after.<br><br>The subclasses of Document simply add properties, validation logic and authorization rules as necessary. In your Document base class you can provide overridable template methods that subclasses can use as a hook to get involved in loading, saving and updating the object.<br><br>Bayu<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam replied on Tuesday, April 10, 2007</h2><DIV>Hi Bayu,</DIV>
<DIV>&nbsp;</DIV>
<DIV>It makes sense. I will consider that approach. </DIV>
<DIV>&nbsp;</DIV>
<DIV>Thanks</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam replied on Tuesday, April 17, 2007</h2><P>I've done it via reflection. Problem was in reflecting all Fetch methods from DataPortal. If someone needs code, contact me.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
