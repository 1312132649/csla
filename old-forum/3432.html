<html><header><title>Question about List.Remove(child)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Question about List.Remove(child)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3432.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper posted on Monday, August 27, 2007</h2><P>I have a root object with a child collection and I am trying to remove an a child element from the child collection. I have been calling the Remove(x) method of the collection, which adds the child 'x' to the deletedlist of the Collection.</P>
<P>Everything up to this point I understand... However, I have 4 levels of nested business objects: Role (Root) -&gt; Tabs (ECL) -&gt; Tab (EC) -&gt; Groups (ECL) -&gt; Group (EC) -&gt; Commands (ECL) -&gt; Command (EC).</P>
<P>My question is: Does calling Remove(tab) on my Tabs child collection automatically mark all groups under tab and all commands under group in the sub-child collections to be deleted as well? I am not seeing the changes trickle down so I am wondering if this needs to be called explicitly.</P>
<P>Thanks in advance.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 27, 2007</h2><P>No, the objects don't get marked for deletion. The assumption is that, during the DP_Update() process, the deleted child will delete itself and its children from the database (or it will call a sproc to do that). Those child objects then just vanish from memory and all is well.</P>
<P>If that's somehow not your model then you'd want/need to cascade the delete call through the child object graph yourself, and have each of those objects delete themselves during DP_Update() - but that'd be a lot less efficient.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper replied on Wednesday, August 29, 2007</h2><P>I am open to suggestions on how to accomplish this in the backend by using sprocs... The part that I am caught up on is how the delete can cascade down the object hierarchy. Using the example I put above, if i delete a Role object then the entire hierarchy should be removed from the database. I can tell a role to remove itself from the Roles table where the primary key matches the Role's object value; I can forward the Role Id into the tab's delete sproc and say delete all Tabs where the foreign key to the role matches the specified role Id parameter; after this I need to delete all groups where the foreign key to the tabs table is one of the many tabs that were deleted...</P>
<P>Do you see where I am getting at? I see 2 possibilities for a fix if i am going to do this in the database alone: 1 would be to replicated the foreign keys down the object hierarchy so I can just keep passing in the parameters down the chain. 2 would be to use a cursor&nbsp;through a result set and then call the object delete sproc for each iteration of the cursor.</P>
<P>Both sound like horrible ideas so if someone can give me some advice I would really appreciate it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Wednesday, August 29, 2007</h2>If you are using SQL server you could always add a cascade on delete constraint onto your foreign keys.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Wednesday, August 29, 2007</h2><P>maybe have a sproc like so:</P>
<P>spDeleteRoleHierarchy(@roleId):</P>
<P>DELETE FROM Command WHERE groupId IN (<BR>&nbsp;&nbsp;&nbsp; SELECT groupId FROM Group WHERE (tabId IN (<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT tabId FROM Tab WHERE (roleId = @roleId) ) ) )</P>
<P>DELETE FROM Group WHERE tabId IN (<BR>&nbsp;&nbsp;&nbsp; SELECT tabId FROM Tab WHERE (roleId = @roleId) ) )</P>
<P>DELETE FROM Tab WHERE roleId = @roleId</P>
<P>DELETE FROM Role WHERE roleId = @roleId</P>
<P>--</P>
<P>some more to handle the inner levels, or logic on one sproc to delete the appropriate tables only depending on another parameter spDeleteRole(@startAt, @id)</P>
<P>saludos!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper replied on Wednesday, August 29, 2007</h2><P>Its always something simple... Thanks for the help.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
