<html><header><title>Silverlight 3, CSLA and a Windows Service</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight 3, CSLA and a Windows Service</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7803.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>walkerstewart posted on Friday, October 16, 2009</h2>Hi All,<br /><br />Have been working with Csla for a while now, however I have gotten to a point where I am about to throw my PC out the window.<br /><br />The issue I'm having is trying to connect a Silverlight 3 app up to a CSLA 3.8.0 backend that is running as a "windows service" using basicHttpBinding.<br /><br />In the debug tracing of the Silverlight app, the attempt to connect to the winservice returns a NotFound error (in the "Csla.WcfPortal.WcfPortalClientChannel" class in the "EndFetch" method (second line) within the CSLA Light library) and when I use Web Dev Helper (akin to Fiddler) to capture the response, is shows what looks to be an IIS 404 html error (below).<br /><br /><br />To show where i'm up to I have performed and tried the following:<br /><br />1. Successful connection of a WPF App to my winservice running the WCF command (so I know that my Server side of things is pretty much right)<br />2. Configured winservice to use the Silverlight Csla DataPortal interface instead of the normal one (Csla.Server.Hosts.Silverlight.WcfPortal) (In code and config)<br />3. Made IIS respond to the same port as my winservice is running on ("http://localhost:8000/RIDService/RIFServerService", IIS also responds to "http://localhost:8000" (right click on website and select "Edit Bindings")) and added "clientaccesspolicy.xml" and "crossdomain.xml" to the root IIS website.<br />4. Enabled "includeExceptionDetailInFaults" on the server side to return errors.<br /><br /><br /><br />My assumption is that item 3 above is causing the problem, with IIS intercepting the http requests to the 8000 port (however I can still browse and see my service at the URL above).<br /><br />Note that I have not used a .svc file as it allowed for a cleaner hosting process for the rest of the application.<br /><br />Could someone let me know if I can even acheive this (and if so what I may be doing wrong) or just tell me I'm stupid and that I should be using an IIS hosted .svc (I have gotten one of these working correctly also so is a possibility)?<br /><br />Thanks In Advance<br /><br /><br /><br /><br />On Start of my Windows Service:<br /><br />	private Uri ServiceUri = new Uri(ConfigurationManager.AppSettings.Get("ServiceAddress"));<br /><br />        protected override void OnStart(string[] args)<br />        {<br />            try<br />            {<br />		// Added to pause start of thread while debugging Silverlight problem<br />                System.Threading.Thread.Sleep(10000);<br /><br />                LogToDatabase("Service Starting: " + DateTime.Now.ToString());<br /><br />                rapServiceHost = new ServiceHost(typeof(Csla.Server.Hosts.Silverlight.WcfPortal), ServiceUri);<br />                //rapServiceHost = new ServiceHost(typeof(WcfPortal), ServiceUri);<br /><br />                rapServiceHost.Open();<br /><br />                LogToDatabase("Service Started: " + DateTime.Now.ToString());<br />            }<br />            catch (Exception ex)<br />            {<br />                LogErrorToDatabase("Cannot start service: " + DateTime.Now.ToString(), ex.ToString());<br />            }<br />        }<br /><br />WinService app config (sections removed for security):<br /><br /><br /><br />  <br />    <br />    <br />    <br />    <br />        <br />    <br />  <br />  <br />    <br />      <br />                         openTimeout="00:05:00"<br />                 sendTimeout="00:30:00"<br />                 receiveTimeout="00:30"<br />                 maxReceivedMessageSize="2147483647"<br />                 maxBufferSize="2147483647"><br />          <br />          <br />        <br />      <br />    <br />    <br />      <br />        <br />          <br />          <br />          <br />        <br />      <br />    <br />    <br />      <br />                   binding="basicHttpBinding"<br />           contract="Csla.Server.Hosts.Silverlight.IWcfPortal"><br />          <br />            <br />          <br />        <br />      <br />    <br />  <br /><br /><br />Silverlight ClientConfig:<br /><br /><br />  <br />    <br />      <br />                         sendTimeout="10"<br />                 receiveTimeout="10"<br />                 maxReceivedMessageSize="2147483647"<br />                 maxBufferSize="2147483647"><br />        <br />      <br />    <br />    <br />                     binding="basicHttpBinding"<br />               bindingConfiguration="BasicHttpBinding_IWcfPortal"<br />               contract="Csla.WcfPortal.IWcfPortal" <br />               name="BasicHttpBinding_IWcfPortal"><br />    <br />  <br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>walkerstewart replied on Friday, October 16, 2009</h2>Additional Screen Shot</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Friday, October 16, 2009</h2>If you can successfully connect to your service from WPF app, then this portal is not going to work for Silverlight.  Silverlight and WPF actually have different portals.  Even if you host a service in IIS and want both WPF and SL clients connect to it, you need to have two svc files and two endpoints - one for each application.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: walkerstewart [mailto:cslanet@lhotka.net] <br />Sent: Friday, October 16, 2009 10:27 AM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] Silverlight 3, CSLA and a Windows Service<br /><br />Hi All,<br /><br />Have been working with Csla for a while now, however I have gotten to a point where I am about to throw my PC out the window.<br /><br />The issue I'm having is trying to connect a Silverlight 3 app up to a CSLA 3.8.0 backend that is running as a "windows service" using basicHttpBinding.<br /><br />In the debug tracing of the Silverlight app, the attempt to connect to the winservice returns a NotFound error (in the "Csla.WcfPortal.WcfPortalClientChannel" class in the "EndFetch" method (second line) within the CSLA Light library) and when I use Web Dev Helper (akin to Fiddler) to capture the response, is shows what looks to be an IIS 404 html error (below).<br /><br /><br />To show where i'm up to I have performed and tried the following:<br /><br />1. Successful connection of a WPF App to my winservice running the WCF command (so I know that my Server side of things is pretty much right)<br />2. Configured winservice to use the Silverlight Csla DataPortal interface instead of the normal one (Csla.Server.Hosts.Silverlight.WcfPortal) (In code and config)<br />3. Made IIS respond to the same port as my winservice is running on ("http://localhost:8000/RIDService/RIFServerService", IIS also responds to "http://localhost:8000" (right click on website and select "Edit Bindings")) and added "clientaccesspolicy.xml" and "crossdomain.xml" to the root IIS website.<br />4. Enabled "includeExceptionDetailInFaults" on the server side to return errors.<br /><br /><br /><br />My assumption is that item 3 above is causing the problem, with IIS intercepting the http requests to the 8000 port (however I can still browse and see my service at the URL above).<br /><br />Note that I have not used a .svc file as it allowed for a cleaner hosting process for the rest of the application.<br /><br />Could someone let me know if I can even acheive this (and if so what I may be doing wrong) or just tell me I'm stupid and that I should be using an IIS hosted .svc (I have gotten one of these working correctly also so is a possibility)?<br /><br />Thanks In Advance<br /><br /><br /><br /><br />On Start of my Windows Service:<br /><br />	private Uri ServiceUri = new Uri(ConfigurationManager.AppSettings.Get("ServiceAddress"));<br /><br />        protected override void OnStart(string[] args)<br />        {<br />            try<br />            {<br />		// Added to pause start of thread while debugging Silverlight problem<br />                System.Threading.Thread.Sleep(10000);<br /><br />                LogToDatabase("Service Starting: " + DateTime.Now.ToString());<br /><br />                rapServiceHost = new ServiceHost(typeof(Csla.Server.Hosts.Silverlight.WcfPortal), ServiceUri);<br />                //rapServiceHost = new ServiceHost(typeof(WcfPortal), ServiceUri);<br /><br />                rapServiceHost.Open();<br /><br />                LogToDatabase("Service Started: " + DateTime.Now.ToString());<br />            }<br />            catch (Exception ex)<br />            {<br />                LogErrorToDatabase("Cannot start service: " + DateTime.Now.ToString(), ex.ToString());<br />            }<br />        }<br /><br />WinService app config (sections removed for security):<br /><br /><br /><br />  <br />    <br />    <br />    <br />    <br />        <br />    <br />  <br />  <br />    <br />      <br />                         openTimeout="00:05:00"<br />                 sendTimeout="00:30:00"<br />                 receiveTimeout="00:30"<br />                 maxReceivedMessageSize="2147483647"<br />                 maxBufferSize="2147483647"><br />          <br />          <br />        <br />      <br />    <br />    <br />      <br />        <br />          <br />          <br />          <br />        <br />      <br />    <br />    <br />      <br />                   binding="basicHttpBinding"<br />           contract="Csla.Server.Hosts.Silverlight.IWcfPortal"><br />          <br />            <br />          <br />        <br />      <br />    <br />  <br /><br /><br />Silverlight ClientConfig:<br /><br /><br />  <br />    <br />      <br />                         sendTimeout="10"<br />                 receiveTimeout="10"<br />                 maxReceivedMessageSize="2147483647"<br />                 maxBufferSize="2147483647"><br />        <br />      <br />    <br />    <br />                     binding="basicHttpBinding"<br />               bindingConfiguration="BasicHttpBinding_IWcfPortal"<br />               contract="Csla.WcfPortal.IWcfPortal" <br />               name="BasicHttpBinding_IWcfPortal"><br />    <br />  <br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>walkerstewart replied on Friday, October 16, 2009</h2>Hi Sergey,<br /><br />I agree with you on that point, however in my service I have two lines of code (just for testing at this stage), one goes to the silverlight dataportal and one to the standard dataportal:<br /><br />rapServiceHost = new ServiceHost(typeof(Csla.Server.Hosts.Silverlight.WcfPortal), ServiceUri); <br />//rapServiceHost = new ServiceHost(typeof(WcfPortal), ServiceUri); <br /><br /><br />When I run the WPF version I change the config and change the commenting. was planning on switching based on a config thing and have the service installed twice with two different end points (Our main ERP integration will be using the NetTCP bindings so this will be the case). <br /><br />As far as I can tell my config and code should work for both, but only does for the WPF side of things.<br /><br />Just want to know if it is possible to integrate silverlight with CSLA with a Windows Service backend on different domains.<br /><br />Thanks Again,<br /><br />Stewy</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Friday, October 16, 2009</h2>OK, I did not see the different lines.  I have not tried to have SL app connecting to windows service, so I am not sure what the answer is.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: walkerstewart [mailto:cslanet@lhotka.net] <br />Sent: Friday, October 16, 2009 11:29 AM<br />To: Sergey Barskiy<br />Subject: Re: [CSLA .NET] RE: Silverlight 3, CSLA and a Windows Service<br /><br />Hi Sergey,<br /><br />I agree with you on that point, however in my service I have two lines of code (just for testing at this stage), one goes to the silverlight dataportal and one to the standard dataportal:<br /><br />rapServiceHost = new ServiceHost(typeof(Csla.Server.Hosts.Silverlight.WcfPortal), ServiceUri); <br />//rapServiceHost = new ServiceHost(typeof(WcfPortal), ServiceUri); <br /><br /><br />When I run the WPF version I change the config and change the commenting. was planning on switching based on a config thing and have the service installed twice with two different end points (Our main ERP integration will be using the NetTCP bindings so this will be the case). <br /><br />As far as I can tell my config and code should work for both, but only does for the WPF side of things.<br /><br />Just want to know if it is possible to integrate silverlight with CSLA with a Windows Service backend on different domains.<br /><br />Thanks Again,<br /><br />Stewy<br /><br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
