<html><header><title>Repository approach using IoC...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Repository approach using IoC...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8419.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic posted on Thursday, January 28, 2010</h2>I am basing my new project on Rocky's DpRepos example from the Csla 3.8 videos. In there, Rocky uses a DalFactory to determine which DalManager to use, based on a setting in the config file.<br><br>Once the DalManager has been found, the DalManager then create the repository using the following code:<br>&nbsp;&nbsp;&nbsp; private void DataPortal_Fetch(SingleCriteria&lt;TestObject, int&gt; criteria)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var dalFactory = DataAccess.DalFactory.GetManager())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dal = dalFactory.GetProvider&lt;DataAccess.ITestObjectDal&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var dr = new SafeDataReader(dal.Fetch(criteria.Value)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>Instead of using the config file to determine which DalManager to create, I would like to use IoC to inject the appropriate repository.&nbsp; However, I would still like to keep the DalManager since it has the ConnectionManager&lt;SqlConnection&gt;, which according to the video, is used to maintain a connection open and avoid opening another connection if one already exists (which would cause us to default to using EnterpriseServices).<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var dalManager = IoC.Resolve&lt;Repository.IDalManager&gt;()) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dal = IoC.Resolve&lt;Repository.Security.ITestObjectDal&gt;();&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var dr = new SafeDataReader(dal.Fetch(criteria)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>I would like to know if my approach is "correct" in the sense that the connections are still being reused.<br><br>Thank you,<br><br>&nbsp;- Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 28, 2010</h2><P>I suspect this will work. You'll of course need to change all your IoC config entries to return the appropriate concrete types.</P>
<P>I personally dislike having a ton of config entries, which is why I prefer the approach I use in the video. Use config to get to the right DAL, and let that DAL manage its own concrete types as it sees fit.</P>
<P>But the IoC use-config-for-everything approach is trendy right now, and it should work fine.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Thursday, January 28, 2010</h2>Hi Rocky:

Will the repository examples be available on the next book or elsewhere?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 28, 2010</h2><P>The samples I created for the video series are part of the video series - they are (I think) a big part of the value of that product.</P>
<P>But as I create content products for CSLA 4 I'll almost certainly use that technique - it is a good technique, yes.</P>
<P>I don't know the form the content products will take for CSLA 4 at this time. They may be ebooks, a paper book or more videos. Probably some combination of those.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Thursday, January 28, 2010</h2>Thank you Rocky.<br><br>I just wanted to make sure I the approach I took did not remove the connection savings that the ConnectionManager provides.<br><br>&nbsp;- Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 28, 2010</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ballistic:</strong></div><div><BR><BR>I just wanted to make sure I the approach I took did not remove the connection savings that the ConnectionManager provides.<BR><BR></div></BLOCKQUOTE></P>
<P>Ultimately that depends on how you implement all this stuff, but on the surface it seems like it should work fine.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
