<html><header><title>Design questions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design questions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/536.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dnebula posted on Tuesday, July 04, 2006</h2><P>I'm creating an application for a real estate business.&nbsp;One of the most important&nbsp;objects is&nbsp;"Property" (in this context property is a house, flat and so on) and I have a few questions on how to design this object.</P>
<P>1)&nbsp;A Property object has certain properties (read: fields) like PropertyType (house, flat etc.), OwnershipType (owned, collective owned etc.) In the database the property table just have foreign keys for these kind of properties (PropertyTypeId, OwnershipTypeId). </P>
<P>One use case is to display all info of a Property including type and ownership type. This implies that I should fetch the accual name of the property type and ownership type as well as id.&nbsp;My solution would be to have&nbsp;a Property object&nbsp;include a (redonly) property TypeName as well as&nbsp;TypeId. I ommit ownership type in the following discussion since I think you get the point =)</P>
<P>Another use case involves changing PropertyType.&nbsp;To handle this i make TypeId read/write.&nbsp;Changing would be as simple as setting the new id and save the object. Obviously I would need to reload the Property object to uptade the TypeName field. This seems a bit akward.</P>
<P>To allow users to se what types they can set I just have a PropertyTypes object derived from NameValueListBase.</P>
<P>Does this seem like the right way of doing this?</P>
<P>2) A Property has a&nbsp;Broker (FK BrokerId in the db). As described above I need to display Property info and that includes info on the broker. This implies that the broker should be a child object of Property. But what if I want to assign another broker to the property? Exposing a BrokerId field in the Property object would be an option (pretty much like the type example above). But I feels wrong to have a Broker child object as&nbsp;well as an BrokerId field.&nbsp;</P>
<P>I must also be able to&nbsp;load and edit just a broker, so it should also be a editable root.&nbsp;Smells like switchable and that feels bad too.</P>
<P>Any idea how to solve that?<FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Tuesday, July 04, 2006</h2>Hi dnebula<br><br>Many objects have this situation, ie they need readonly data from a related object. I've played with various ways of handling it. Here's what I've settled on. Let's consider your Property object (could be an awkward name&nbsp;<img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /> ) which needs info about its related broker but broker is also separately edited. Property and Broker are both editable roots. I assume Property has a variable called _brokerId. <br><br>Inside Property, build a class like this:<br><br>public class BrokerInfo<br>{<br>&nbsp;&nbsp;&nbsp; private int _id<br>&nbsp;&nbsp;&nbsp; public int Id<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  get { return _id; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; private string _name<br>
&nbsp;&nbsp;&nbsp; public string Name<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  get { return _name; }<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>&nbsp;&nbsp;&nbsp; private string _phoneNumber<br>
&nbsp;&nbsp;&nbsp; public string PhoneNumber<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  get { return _phoneNumber; }<br>
&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; private bool _isValid;<br>&nbsp;&nbsp;&nbsp; public bool IsValid<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  get { return _isValid; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public void Clear()<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _id = 0;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _name = String.Empty;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _phoneNumber = String.Empty;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _isValid = false;<br>
&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public Clear(int id)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  Clear();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _id = id;<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public BrokerInfo()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  Clear();<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public void Update(Broker broker)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _id = broker.Id;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; _name = broker.Name;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; _phoneNumber = broker.PhoneNumber;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _isValid = true;<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public void Update(int id, string name, string phoneNumber)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _id = id;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; _name = name;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; _phoneNumber = phoneNumber;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _isValid = true;<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br><br>private BrokerInfo _brokerInfo = new BrokerInfo();<br><br>public BrokeInfo Broker<br>{<br>&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  if (_brokerInfo.Id != _brokerId)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Broker broker = Broker.GetBroker(_brokerId);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (broker == null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  _brokerInfo.Clear(_brokerId);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  _brokerInfo.Update(broker);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  return _brokerInfo;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>That's the key parts of it. The general idea is that its a cache. _brokerInfo remembers the brokerId that its data refers to, or the id of the last fetch attempt if invalid, so you'll only fetch a Broker object when you really need to and not repeatedly get the same one.<br><br>The Update method with separate properties is useful in your DataPortal_Fetch because you can probably get the property and broker data in one joined table SQL query so you load up _brokerInfo without needing to grab a Broker object. <br><br>On your Windows form for editing a Property, you can happily bind readonly fields to _property.Broker.Name and _property.Broker.PhoneNumber. You can't quite do that directly by point and click. When you select DataBindings for the control, you can select Broker from the list of bindingSource members but not the members of Broker. All you need to do then is manually add the .Name or .PhoneNumber.<br><br>I've modified my BO's so that their factory methods return null if the requested item doesn't exist.<br><br>The IsValid field is useful to show if BrokerId relates to a valid Broker. I've found it useful to expose it as a direct property of Property ie<br><br>public bool BrokerIsValid<br>{<br>&nbsp;&nbsp;&nbsp; get { return _brokerInfo.IsValid; }<br>}<br><br>Property can have a business rule saying that BrokerIsValid must be true. Now, BrokerIsValid can be bound to an invisible (size = 0,0) checkbox. If you use an errorProvider then it will provide a nice indication if you haven't selected a valid broker. You can place the checkbox whereever you want the error indicator to appear. I guess you can tie the rule directly to BrokerId but that might be a numeric that you don't want to show on the form. To make error stuff work properly you need the following on the Property.BrokerId property setter just before PropertyHasChanged();<br><br>OnPropertyChanged("BrokerIsValid");<br>ValidationRules.CheckRules("BrokerIsValid");<br><br>I usually put OnPropertyChanged("BrokerInfo"); in there even if I'm not error checking because that means I can change the BrokerId and the Name and PhoneNumber fields will immediately change or go blank if Broker is invalid. That seems to work even without the OnPropertyChanged("BrokerInfo") which I don't fully understand. It seems that databinding refreshes all fields more often than I expect.<br><br>Well... that's about it. You could argue if it okay to use an editable root Broker as a means of just grabbing data. More correct would be have a readonly Broker but if the editable Broker is not loading child objects or doing anything heavy then it seems reasonable to use it and throw it away. Of course in that Get code when you need to read info about a different broker you can do whatever you like to get the data.<br><br>Cheers<br>Ross<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dnebula replied on Tuesday, July 11, 2006</h2><P>Thanks Ross, thats is a nice solution. I'll go with that one.</P>
<P>While I could use the same idea for the TypeId/Name problem, it will result in a lot of objects (I have a lot of those Id/Name pairs in the property object).</P>
<P>For each one I would need&nbsp;a&nbsp;RO SomeTypeInfo and a full SomeType BO to load the data. <BR>I'm thiking I might be better of just exposing a R/W SomeTypeId and a RO SomeTypeName. The RO property would just look up the name in a cached SomeTypeNameValueList. Any thoughts on this?</P>
<P>Thanks,<BR>Jonas</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
