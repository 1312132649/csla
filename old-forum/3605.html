<html><header><title>RuleDescription Class not serializable</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>RuleDescription Class not serializable</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3605.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw posted on Thursday, September 27, 2007</h2><P><FONT face=Tahoma color=#000000>I am creating validation controls on the UI based on rules in the business object.&nbsp; I have everything working, but I getting the rule descriptions and then putting them into the RuleDescription class.&nbsp; I tried to store the RuleDescription class in ViewState, but it tells me that the class is not serializable.&nbsp; </FONT></P>
<P><FONT face=Tahoma color=#000000>I was thinking that ValidationRules.GetRuleDescriptions should return a serializable List&lt;RuleDescription&gt; rather than string().&nbsp; </FONT></P>
<P><FONT size=2><FONT face=Tahoma color=#000000 size=3>I realize this could break other implementations, but it seems silly to populate a string() and then the class.&nbsp; Does anyone else have this desire or need or would be willing to deal with the upgrade issues?</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 28, 2007</h2><P>(Chris and I have been emailing offline as well)</P>
<P>I thought your issue was that the friendly property name needed to be in the URI? Doing that is a breaking change to RuleArgs, because RuleArgs needs to always insert at least one parameter value in the URI, and today it does not - so any subclass would assume IT is adding the first parameter value.</P>
<P>I didn't realize you wanted to serialize a list of RuleDescription objects into ViewState.</P>
<P>I doubt that would be a good idea. Without testing it is hard to say, but I bet that serializing an array or list of string values will result in a smaller byte stream than serializing a list of a custom type.</P>
<P>In the web, the IO speed is typically a more limiting factor than CPU cycles on the web server.</P>
<P>Besides, why would you send this rule info out to the browser and back? It is always available to the server-side code in a relatively inexpensive way, and it can't change over time (the rules are set once for the life of the app).</P>
<P>Or am I missing something?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Friday, September 28, 2007</h2><P>Actually, the problem you describe was another item that I was looking at.&nbsp;&nbsp;First, I would like the friendly name in the argument list.&nbsp; I thought it might be the same change as putting ValueType in the argument list.&nbsp; I thought that we could add an item to the name/value pair argument collection called FriendlyName if the argument was supplied.</P>
<P>The second issue is that I am needing the rule definitions on the UI and want to store them so I don't have to keep pushing them around.&nbsp; I guess it makes sense to put it in Session rather than ViewState since there is no reason to put it on the client.&nbsp; However, I was thinking that regardless, it was a waste to get the rules as a string() and then convert them to a List&lt;RuleDescription&gt; instead of just putting them directly as a List&lt;RuleDescription&gt;.&nbsp; Seems to be a lot of extra work to get the same information.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Friday, September 28, 2007</h2><P>I wanted to add some description about the FriendlyName argument.&nbsp; This is what I was thinking...&nbsp; The constructor looks something like this right now:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;</P></FONT><PRE><FONT size=2><P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> propertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> friendlyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> maxValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)</P><P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.New(propertyName, friendlyName)</P><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"MaxValue"</FONT><FONT size=2>) = maxValue</P><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"Format"</FONT><FONT size=2>) = </FONT><FONT color=#800000 size=2>""</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"ValueType"</FONT><FONT size=2>) = </FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>(T).FullName</P><P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></PRE>Why not make it look like this (and the other constructor with friendlyName in it?<PRE><FONT size=2><P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> propertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> friendlyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> maxValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)</P><P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.New(propertyName, friendlyName)</P><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"MaxValue"</FONT><FONT size=2>) = maxValue</P><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"Format"</FONT><FONT size=2>) = </FONT><FONT color=#800000 size=2>""</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"ValueType"</FONT><FONT size=2>) = </FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>(T).FullName</P><P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"FriendlyName"</FONT><FONT size=2>) = friendlyName</P><P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></PRE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Friday, September 28, 2007</h2><P>Oh, I just realized what you are saying..&nbsp; Changing the base class instead of the specific arg class would mean that the other subclasses may think they are adding the first parameter when they are not...&nbsp; Is this true?&nbsp; I don't quite understand the ramifications, but I am thinking that the ToString method in DecoratedRuleArgs puts that string together.&nbsp; Oh..&nbsp; Except that you are saying people are accessing them by value instead of the name of the argument...&nbsp; See, I was using the name of the argument, but the value is sometimes much easier since we don't know the same all the time.</P>
<P>Interesting...&nbsp; Did I complicate it?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 28, 2007</h2><P><img src="/emoticons/emotion-6.gif" alt="Sad [:(]" />Friendly name is managed by RuleArgs, not DecoratedRuleArgs. Not all RuleArgs subclasses flow from the new DecoratedRuleArgs - though I did change all rules in CommonRules to work that way.</P>
<P>But no existing subclasses work that way of course. They all subclass RuleArgs directly, and that's where the friendly name is implemented.</P>
<P>And it is totally realistic for RuleArgs.ToString() to put the friendly name into the URI - but it would be a breaking change. Right now, any RuleArgs subclass (including DecoratedRuleArgs) is coded to build its ToString() result like:</P>
<BLOCKQUOTE dir=ltr>
<P>?arg1=v2&amp;arg2=v2</P></BLOCKQUOTE>
<P>using code vaguely like:</P>
<BLOCKQUOTE dir=ltr>
<P>Public Overrides Function ToString() As String<BR>&nbsp; Return MyBase.ToString() &amp; "?arg1=v2&amp;arg2=v2"<BR>End Function</P></BLOCKQUOTE>
<P>But if RuleArgs adds the friendly name as an argument, then all subclasses would need to assume that there's <EM>already</EM> a parameter there and the code would need to be more like:</P>
<BLOCKQUOTE dir=ltr>
<P>Public Overrides Function ToString() As String<BR>&nbsp; Return MyBase.ToString() &amp; "&amp;arg1=v2&amp;arg2=v2"<BR>End Function</P></BLOCKQUOTE>
<P>While this is a breaking change, it would also make David W happy, because then the original severity could be included in the URI as well, resulting in stuff like this:</P>
<BLOCKQUOTE dir=ltr>
<P>rule://method/property?PropertyName=A%20name&amp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OriginalSeverity=Error&amp;OriginalStopProcessing=False</P></BLOCKQUOTE>
<P>Though I still resist putting the severity in there at all, because it only knows the _original_ value, not the value that may be set by a rule method at runtime... The same with StopProcessing - the value is intended to be changed by rules at runtime, and so all that can be shown here is the original value.</P>
<P>Heck, even THAT isn't accurate. What you really get is the last value these two fields were set to use by the last execution of the rule method. The whole thing just bugs me...</P>
<P>But putting friendly name in is safe, because it is immutable. Unfortunately doing so is a breaking change </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Friday, September 28, 2007</h2><P>In a slightly different direction,&nbsp;what about making the friendlyname available directly?&nbsp; I don't see anyway of getting the rule list other than GetRuleDescriptions.&nbsp; Before the rules are "broken", can I pass in a "rule" to get the friendly name or some similar method?&nbsp; I guess what I'm saying is how can I get a FriendlyName&nbsp;base on&nbsp;any rule description?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 28, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>chrislw:</strong></div><div>
<P>In a slightly different direction,&nbsp;what about making the friendlyname available directly?&nbsp; I don't see anyway of getting the rule list other than GetRuleDescriptions.&nbsp; Before the rules are "broken", can I pass in a "rule" to get the friendly name or some similar method?&nbsp; I guess what I'm saying is how can I get a FriendlyName&nbsp;base on&nbsp;any rule description?</P>
<P></div></BLOCKQUOTE></P>
<P>I thought about exposing the RuleMethod objects directly. The problem with that sort of move, is that it eliminates data hiding, and reduces the maintainability of CSLA. If that's public, then I can never change it without causing breaking changes. The URI offers at least one level of abstraction/indirection.</P>
<P>So the short answer, is that the details managed by RuleMethod are private, and you can't access them directly. This is the purpose behind GetRuleDescriptions - to expose this information in a useful manner, without breaking encapsulation and data hiding.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>admin replied on Friday, September 28, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>chrislw:</strong></div><div>
<P>The second issue is that I am needing the rule definitions on the UI and want to store them so I don't have to keep pushing them around.&nbsp; I guess it makes sense to put it in Session rather than ViewState since there is no reason to put it on the client.&nbsp; However, I was thinking that regardless, it was a waste to get the rules as a string() and then convert them to a List&lt;RuleDescription&gt; instead of just putting them directly as a List&lt;RuleDescription&gt;.&nbsp; Seems to be a lot of extra work to get the same information.</P>
<P></div></BLOCKQUOTE></P>
<P>A relatively simple solution may be to put a Shared/static method on RuleDescription that parses a list of URIs into a List&lt;RuleDescription&gt;. Seems like a common thing to do, and the method could work like:</P>
<BLOCKQUOTE dir=ltr>
<P>Dim list As List&lt;RuleDescription&gt; = _<BR>&nbsp; RuleDescription.Parse(_customer.GetRuleDescriptions)</P></BLOCKQUOTE>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Friday, September 28, 2007</h2>That makes sense, but what about instead of taking a string() and putting it in the list, maybe do the same as the GetRuleDescriptions, but actually pass back a list instead of string().&nbsp; I'm suggesting this instead of replacing the original just to prevent the breaking change although I'm not sure it is the best idea.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 28, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>chrislw:</strong></div><div>That makes sense, but what about instead of taking a string() and putting it in the list, maybe do the same as the GetRuleDescriptions, but actually pass back a list instead of string().&nbsp; I'm suggesting this instead of replacing the original just to prevent the breaking change although I'm not sure it is the best idea.</div></BLOCKQUOTE></P>
<P>All GetRuleDescriptions() does is loop through the RuleMethod objects and call ToString() on each one. Each RuleMethod object (and the RuleArgs it contains) are responsible for generating the URI that is returned.</P>
<P>The correct answer really is to do the breaking change - it just isn't a happy thing...</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
