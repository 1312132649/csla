<html><header><title>HowTo use LinqToCsla</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>HowTo use LinqToCsla</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6700.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Luzius posted on Monday, March 30, 2009</h2><P><FONT size=2>Hi,</FONT></P>
<P><FONT size=2>for the last couple of hours I've been trying to use LinqToCsla and I'm somehow lost:</FONT></P>
<P><FONT size=2>I have a BO TaskEdit which contains an editable List of&nbsp;other BOs. Now I try&nbsp;to sort the list by a simple&nbsp;DateTime property:</FONT></P><FONT color=#0000ff><FONT color=#0000ff>
<P><FONT size=2>private</FONT></FONT></FONT><FONT size=2> <FONT color=#0000ff><FONT color=#0000ff>static</FONT></FONT> <FONT color=#0000ff><FONT color=#0000ff>readonly</FONT></FONT> <FONT color=#2b91af><FONT color=#2b91af>PropertyInfo</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>UrgencyEditCollection</FONT></FONT>&gt; urgenciesProperty = RegisterProperty&lt;<FONT color=#2b91af><FONT color=#2b91af>UrgencyEditCollection</FONT></FONT>&gt;(c =&gt; c.Urgencies);</FONT></P>
<P><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>public</FONT></FONT> <FONT color=#2b91af><FONT color=#2b91af>LinqBindingList</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>UrgencyEdit</FONT></FONT>&gt; Urgencies<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>get<BR>&nbsp;&nbsp;&nbsp;</FONT></FONT>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#0000ff><FONT color=#0000ff>return</FONT></FONT> <FONT color=#0000ff><FONT color=#0000ff>from</FONT></FONT> urgency <FONT color=#0000ff><FONT color=#0000ff>in</FONT></FONT> GetProperty(urgenciesProperty)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#0000ff><FONT color=#0000ff>orderby</FONT></FONT> urgency.StartDate<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#0000ff><FONT color=#0000ff>select</FONT></FONT> urgency;<BR>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></P>
<P><FONT size=2>VS2008 makes a red line below the Linq Query and the message is:</FONT></P>
<P><FONT size=2>Cannot convert expression type 'System.Linq.IOrderedQueryable&lt;Tasks.Library.UrgencyEdit&gt;' to return type 'Csla.LinqBindingList&lt;Tasks.Library.UrgencyEdit&gt;'</FONT></P>
<P><FONT size=2>Both TaskEdit and UrgencyEdit derive indirectly via 2 additional base classes from BusinessBase. UrgencyEditCollection derives directly from BusinessListBase.</FONT></P>
<P><FONT size=2>Thanks for any hints.<BR>Luzius</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 30, 2009</h2><P>Are you using the 3.6.2 release candidate?</P>
<P>I know there were some issues with orderby not returning a LinqBindingList that have (hopefully) been addressed in 3.6.2.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, March 30, 2009</h2>Your query should be defined as IOrderedQueryable. <br /><br />Then you should be able to cast it to LinqBindingList.<br /><br />Something like this:<br /><br />Dim query As IOrderedQueryable = <br />from urgency in ...<br />orderby ..<br /><br />Return CType(query, LinqBindingList(Of UrgencyEdit)<br /><br />Joe</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Luzius replied on Tuesday, March 31, 2009</h2><P>Thanks,</P>
<P>I somehow thought that no explicit cast was necessary - my fault.</P>
<P>This way it works very well, even with more than one orderby criteria. (I think this was the issue with the 3.6.2 beta).</P>
<P>I still have an issue with binding this list to a WPF ListBox. When I bound the original BusinessListBase Collection to the Listbox, all updates to the list were automatically displayed. Now after binding the LinqBindingList, I have to call Rebind() in the CslaDataProvider. Is this necessary or am I doing something wrong?</P>
<P>Luzius</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, March 31, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Luzius:</strong></div><div><P>Thanks,</P><br /><br /><P>This way it works very well, even with more than one orderby criteria. (I think this was the issue with the 3.6.2 beta).</P><br /><br /></div></BLOCKQUOTE><br /><br />I think standard LINQ queries work with any number of OrderBy criteria in 3.6.2. It is the Dynamic Linq queries that needed fixing for 3 or more columns sorts. The key issues is that std LINQ calls deep into the code differently than dynamic LINQ. Std LINQ passes each part of the orderby expression as separate calls. Dynamic LINQ passes the whole thing in one shot. The fix for 3.6.3 now takes that into account.<br /><br />Joe<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
