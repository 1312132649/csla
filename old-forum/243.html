<html><header><title>Load Balancing Problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Load Balancing Problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/243.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai posted on Thursday, June 01, 2006</h2><P>Hi guys.</P>
<P>Just tried to use a Remoting DataPortal behind a load balancer (Microsoft NLB) and it all works quite nicely except for the slightly annoying server ip cache problem that Rocky mentions in the book.&nbsp; Two Servers sit behind the NLB and both work correctly.&nbsp; However, if I start my test app and disable the server it is using in the Load Balancing software, the next time the app tries to talk to the server it gives out an Exception as below:-</P>
<P>"The underlying connection was closed: A connection that was expected to be kept alive was closed by the server"</P>
<P>I thought that it was supposed to automatically fail over and use the other server in the NLB?</P>
<P>Anyone else using NLB with Csla/Remoting?&nbsp; Any ideas on this one?</P>
<P>TIA.</P>
<P>John.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 01, 2006</h2>This is a known issue with Remoting. It seems to me that someone had come up with a solution, but it has been so very long since I heard about it that I don't remember the specifics. I would bet that google is your friend here <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, June 01, 2006</h2><FONT color=#800000 size=2>
<P>Unfortunately google is not being as helpful as usual.&nbsp; I have not been able to find anything close to a solution so far <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" />&nbsp; Maybe I am searching for the wrong keywords...</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 01, 2006</h2>




<DIV align=left><SPAN class=716265416-01062006><FONT face=Arial color=#0000ff size=2>The first place I always look for remoting answers is Ingo 
Rammer's page <A href="http://www.thinktecture.com/Resources/default.html">http://www.thinktecture.com/Resources/default.html</A></FONT></SPAN></DIV><BR>
<BLOCKQUOTE>
  <DIV class=OutlookMessageHeader align=left>
  <HR>
  <FONT color=#800000 size=2>Unfortunately google is not being as helpful as 
  usual.&nbsp; I have not been able to find anything close to a solution so far 
  <IMG alt="Sad <img src=" />" src="/emoticons/emotion-6.gif">&nbsp; Maybe I am searching 
  for the wrong keywords...</DIV></FONT></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Osword replied on Monday, July 30, 2007</h2><font face="Tahoma">We're having a similar issue with our app.&nbsp; We have a similar setup (.NET Remoting, SingleCall/binary over HTTP on IIS with Microsoft's NLB).&nbsp; IIS fails over fine (static pages failover) but the app produces an "underlying connection closed" exception from mscorlib when we kill the services on one box.<br><br>This thread was started a while ago... did Rocky or Razorkai ever find a solution to this?&nbsp; Any help would be greatly appreciated.<br><br>Oz<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 31, 2007</h2><P>I didn't research it beyond the posts you see here. </P>
<P>This is a known issue with Remoting, because Remoting (behind the scenes) caches the open TCP connection as an optimization.</P>
<P>Years ago, when Remoting was still considered a "good technology", I thought I'd read something (probably on Ingo's web site or in his book) about how to defeat the TCP connection caching. Unfortunately it has been a very long time and I don't remember specifics, sorry.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>marklindell replied on Tuesday, July 31, 2007</h2>We run Binary/HTTP remoting over NLB and BigIP routers just fine.&nbsp; Do not use sticky connections and make sure you turn HTTP keep alives off in your web server.<br><br>I am not aware of a remoting issue surrounding load balancing.&nbsp; We have been running in productions for 6 months just fine.<br><br>Let me know if you have more questions.<br><br>Mark Lindell<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Osword replied on Thursday, August 02, 2007</h2>Thanks, Rocky.<br><br>Mark, we're currently trying a different setup.&nbsp; Glad to hear someone's got it working, though.<br><br>Can you explain why you need the F5 appliance for load balancing in addition to NLB?&nbsp; Is the BigIP box doing something else?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>marklindell replied on Thursday, August 09, 2007</h2>BigIP is just an options for our clients.&nbsp; We also support NLB.<br><br>We have performed two years of extensive load testing our application and never had an issue with CSLA in either environment.<br><br>Hope this helps.<br><br>Cheers,<br><br>Mark Lindell<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
