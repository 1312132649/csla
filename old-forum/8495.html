<html><header><title>Possible bug in CSLA 3.8.2</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible bug in CSLA 3.8.2</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8495.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rhertzberg posted on Monday, February 08, 2010</h2><p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">I&#39;m experiencing a crash condition when processing one of my business lists that I think may be related to some code in BusinessListBase.cs&nbsp; To make a long story short, I was able to fix the problem when I&nbsp;switched the order of the&nbsp;last 2 lines of BusinessListBase.InsertItem() to look like this:</span></p>
<div>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">&nbsp;&nbsp;&nbsp; protected override void InsertItem(int index, C item)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // set parent reference<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.SetParent(this);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // set child edit level<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Core.UndoableBase.ResetChildEditLevel(item, this.EditLevel, false);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // when an object is inserted we assume it is<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // a new object and so the edit level when it was<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // added must be set<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.EditLevelAdded = _editLevel;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InsertIndexItem(item);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InsertIntoMap(item, index);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.InsertItem(index, item);<br />&nbsp;&nbsp;&nbsp; }</span></p>
</div>
<div>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">If base.InsertItem() is performed before InsertIntoMap(), I crash when processing the ListChanged event that fires after base.InsertItem() is called.&nbsp; In my event handling code I call the Linq ToList() operator and it looks like it needs InsertIntoMap() processing for it to work correctly.</span></p>
</div>
<div>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;"></span>&nbsp;<span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">If this doesn&#39;t make any sense, let me know and I&#39;ll write a test app to demonstrate it.&nbsp; Thanks.</span><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">&nbsp;</span></p>
</div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, February 12, 2010</h2><p>I&#39;ve referred this to Aaron, who maintains the LINQ to CSLA behaviors - including indexing.</p>
<p>Can you provide the test app to demonstrate the issue? Clearly there&#39;s something relatively unique in your code, since this hasn&#39;t been reported by others, and so we need to understand the specifics of how your code is interacting with indexing.</p>
<p>fwiw, indexing has been removed in CSLA 4 because it has been a PITA having it embedded in CSLA. If you need indexing you&#39;ll be able to get it by using external libraries such as i4o.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rhertzberg replied on Saturday, February 13, 2010</h2><p>Rocky,</p>
<p>Attached is a test app that demonstrates the failure.&nbsp; It creates a Customer record that contains a list of Order records.&nbsp; The orders are displayed in a ListView.&nbsp; When you click the Add Order button, a new order is created and added to the order list.&nbsp; The OnListChanged member receives the ListChanged event fired by the order list.&nbsp; It does a couple of Linq operations and crashes on the last.</p>
<p>The source for CSLA version 3.8.2 is included as a subsidiary project of the solution so I could see where the failure is occuring in the source code.&nbsp; Let me know if you have any trouble building it or reproducing the problem.</p>
<p>Richard</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
