<html><header><title>Validation modes similar to Enterprise Library?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation modes similar to Enterprise Library?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11131.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rcollette posted on Monday, February 06, 2012</h2><p>Enterprise Library has the concept of&nbsp; default and named validation rule sets.&nbsp; In our environment we have used these to apply validation depending on the role of the user saving the object (ex. Administrator or not).</p>
<p>Objects will have properties that are not viewable or updateable by certain users and therefore the values will be null/nothing.&nbsp; However, when the field is accessible to the user, the value is required.</p>
<p>I am wondering what mechanism in CSLA.NET, if any, allows for specifying the mode or set of rules that apply for a given scenario.&nbsp; Since the rules are added for the Class/Type rather than the instance, I know it is not done when adding rules.&nbsp; Since some rules may be object independent (ex. MinLength, Required, etc.), the rule itself should not be made dependent on the scenario.&nbsp;&nbsp; </p>
<p>I cannot see how I might do this other than creating a completely new class which is overkill if the difference is&nbsp; for just 1 or two fields.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 06, 2012</h2><p>There is no direct implementation of per-role rules. Interestingly enough, you are the first person to bring this up in 16 years. I&#39;m going out on a limb to speculate that it isn&#39;t a super-common requirement :)</p>
<p>The good news is that you can use gateway rules to address the requirement. If you want a rule to execute or not based on the user&#39;s identity/roles you can create a gateway rule to do the role check and chain to the business rule only if appropriate.</p>
<p>I don&#39;t cover your specific scenario in the book, but the <em>Using CSLA 4: Creating Business Objects</em> book covers gateway rules, and I&#39;m pretty sure the RuleTutorial sample has some gateway rule examples as well.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, February 06, 2012</h2><p>Yes, RuleTutorial sample show CanWrite, IsNew and IsNotNew gateway rules. </p>
<p>You can also use ShortCircuitingRules like StopIfNotCanWrite which also included in RuleTutorial. </p>
<p>The CanWrite / StopIfNotCanWrite checks the result of CanWriteProperty - whether this by default checks authorization or if you have an overload.</p>
<p>IE; These rules allow you to create rules that are only validated when user is allowed to edit the field. </p>
<p>StopIfNotCanWrite can also be used together with Data Annotation rules (that always have Priority=0) by setting Priority to -1 or lower.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, February 06, 2012</h2><p>I must also add that CSLA does support the concept of default and named rulesets.</p>
<p>These can be used for both authorization rules and business rules.</p>
<p>For Authz rules you must use ApplicationContext (as tuis is a static method)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.RuleSet = ApplicationContext.DefaultRuleSet;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(typeof(PermissionsRoot2), new IsInRole(AuthorizationActions.DeleteObject, &quot;User&quot;));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.RuleSet = &quot;custom1&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(typeof(PermissionsRoot2), new IsInRole(AuthorizationActions.DeleteObject, &quot;Admin&quot;));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.RuleSet = &quot;custom2&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(typeof(PermissionsRoot2), new IsInRole(AuthorizationActions.DeleteObject, &quot;User&quot;, &quot;Admin&quot;));</p>
<p>For business rules: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.RuleSet = ApplicationContext.DefaultRuleSet;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.ReadProperty, FirstNameProperty, new List&lt;string&gt; { &quot;Admin&quot; }));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.WriteProperty, FirstNameProperty, new List&lt;string&gt; { &quot;Admin&quot; }));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.ExecuteMethod, DoWorkMethod, new List&lt;string&gt; { &quot;Admin&quot; }));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.RuleSet = &quot;custom1&quot;;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.ReadProperty, FirstNameProperty, new List&lt;string&gt; { &quot;Admin, User&quot; }));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.WriteProperty, FirstNameProperty, new List&lt;string&gt; { &quot;Admin&quot; }));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.IsInRole(Rules.AuthorizationActions.ExecuteMethod, DoWorkMethod, new List&lt;string&gt; { &quot;Admin&quot; }));<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rcollette replied on Wednesday, February 08, 2012</h2><p>Johny,&nbsp; thank you for replying.&nbsp;&nbsp; Thank you for pointing out ruleset functionality.&nbsp; This is more like what developers here are familiar with, though the syntax here is a bit verbose.&nbsp; Hopefully we can cut it down with some namespace imports.</p>
<p>Now I just have to figure out how, if at all, this will tie in with dynamicdata fields in asp.net.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rcollette replied on Wednesday, February 08, 2012</h2><p>OK.. Looks like I have to pick up the books as a refresher then.&nbsp; Truthfully, I&#39;ve been avoiding it because I either like printed or kindle formats.&nbsp; PDF on the kindle or computer is&nbsp; a pain to read over a long period, though I love PDFs as references after I&#39;ve read through a whole book.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
