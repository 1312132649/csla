<html><header><title>Business rules - adding InputProperties causes rules to run</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business rules - adding InputProperties causes rules to run</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11424.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>j0552 posted on Friday, June 22, 2012</h2><p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">CSLA version: 4.3.10.0</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">Hi</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">If I create a rule for a property with additional property added to InputProperties in the constructor, when the second property&#39;s value changes the rule for the first property executes. The example below demostrates this behaviour.</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>[TestClass]</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>public class DummyTest</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>[TestMethod]</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public void DummyRuleTest()</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>var obj = Dummy.NewDummy();</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>obj.Bar = 999;</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span></span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>[Serializable]</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>public class Dummy : BusinessBase&lt;Dummy&gt;</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>private Dummy()</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;</span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public static Dummy NewDummy()</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return DataPortal.Create&lt;Dummy&gt;();</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public static readonly PropertyInfo&lt;int&gt; FooProperty = RegisterProperty&lt;int&gt;(c =&gt; c.Foo);</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public int Foo</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>get { return GetProperty(FooProperty); }</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>set { SetProperty(FooProperty, value); }</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public static readonly PropertyInfo&lt;int&gt; BarProperty = RegisterProperty&lt;int&gt;(c =&gt; c.Bar);</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public int Bar</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>get { return GetProperty(BarProperty); }</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>set { SetProperty(BarProperty, value); }</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>protected override void AddBusinessRules()</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>base.AddBusinessRules();</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BusinessRules.AddRule(new FooRule(FooProperty, BarProperty));</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#region Nested type: FooRule</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>private class FooRule : BusinessRule</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>public FooRule(IPropertyInfo primaryProperty, IPropertyInfo barProperty)</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>: base(primaryProperty)</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>// adding barProperty to FooRule InputProperties causes the rule to run when Bar&#39;s value is changed</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>InputProperties = new List&lt;IPropertyInfo&gt; { primaryProperty, barProperty };</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>//InputProperties = new List&lt;IPropertyInfo&gt; { primaryProperty };</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>protected override void Execute(RuleContext context)</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>// Changing the value of Bar causes Foo&#39;s rule to execute.</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#endregion</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>protected override void DataPortal_Create()</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">This doesn&#39;t seem to be expected behaviour and in fact in the real world causes rules to run many more times than is necessary. Is this a bug or can you explain the principle of the described behaviour.</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks</span></span></span></p>
<p class="MsoPlainText" style="MARGIN:0cm 0cm 0pt;"><span style="mso-no-proof:yes;"><span style="font-size:small;"><span style="font-family:Calibri;">Andrew</span></span></span><span style="mso-no-proof:yes;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, June 22, 2012</h2><p>This is intentional - as you use InputProperties to send additional field (typically for comparison) to the Execute method and want to &quot;revalidate&quot; the field whan any of the input properties change. </p>
<p>Take f.ex these rules: </p>
<p><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">GreaterThanOrEqual</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">(Num2Property, Num1Property));<br />BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">LessThan</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">(StartDateProperty, EndDateProperty));<br />BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">GreaterThan</span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">(EndDateProperty, StartDateProperty));<br /><span style="font-family:Consolas;"><span style="font-family:Consolas;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">NotifyChangedWhenInputChanged</span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;font-size:x-small;">(CalculatedProperty, Param1Property, Param2Property));<br /></span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">CalcSum</span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">(SumProperty, Num1Property, Num2Property, Num3Property));<br /><br /><span style="font-family:Arial;">So: <br />When Num1 is changed rerun rule for Num2 <br /></span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;"><span style="font-family:Arial;">When EndDate is changed - rerun rule for StartDate. <br />When Num1 or Num2 or Num3 is changed rerun rule for Sum</span></span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">The alternative (as in 3.x and pre 4.1) would be to add a number of Dependency rules. </span></span></span></p>
<h3><b><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">From my experience this typically is the desired behavior. </span></span></span></b></h3>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">AND - You can avoid this if you don&#39;t want the secondary rue to run:</span></span></span></p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">FooRule</span>&nbsp;:&nbsp;<span style="color:#2b91af;">PropertyRule</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;FooRule(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;barProperty)&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty,&nbsp;barProperty&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">// Tell RuleEngine to NOT run this rule when&nbsp;input&nbsp;property&nbsp;changes&nbsp;or&nbsp;as&nbsp;Dependency/Affected&nbsp;Property</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanRunAsAffectedProperty&nbsp;=&nbsp;<span style="color:blue;">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute(<span style="color:#2b91af;">RuleContext</span>&nbsp;context)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Changing&nbsp;the&nbsp;value&nbsp;of&nbsp;Bar&nbsp;will&nbsp;NOT&nbsp;causes&nbsp;Foo&#39;s&nbsp;rule&nbsp;to&nbsp;execute.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j0552 replied on Friday, June 22, 2012</h2><p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">OK, now I think I get!</span></span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">I think the main problem I&#39;ve been having is misunderstanding the purpose of<span style="mso-spacerun:yes;">&nbsp; </span>AffectedProperties and implemented rules around this misunderstanding. With your explanation I&#39;ve been able to see how I can simplify my rules and avoid executing rules unnecessarily.</span></span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Is it right that we only need to use AffectedProperties when adding a context.Add... to an extra property? </span></span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks to both of you for your detailed explanations.</span></span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoPlainText" style="margin:0cm 0cm 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Andrew</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, June 22, 2012</h2><p>Yes, you need to add other properties to AffectedProperties in order to use context.Add.... to other properties than PrimaryProperty. </p>
<p>Another subtle difference is that InputProperties as Dependency is <b>ALWAYS </b>considered a declarative dependency and always enforced whereas AffectedProperties is aggregated as the rules is executed. </p>
<p>Ex: If you have several rules at different Priority level you would have to add Dependency rules with Priority &lt; 0 in order to be sure the dependency would be&nbsp; enforced. So if you got a broken rule at level 0 the rules with Priority &gt; 0 will not be executed and thus their AffectedProperties will have NO impact!!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Friday, June 22, 2012</h2><p>This is a featuire not a bug.&nbsp; <img src="http://forums.lhotka.net/emoticons/emotion-2.gif" alt="Big Smile" /> In the simple case, the validity of the rule is determined by a single property.&nbsp; For example, a telephone number must have so many numeric digits; any other condition causes the rule to fail.&nbsp; But there are situations where several values must be inspected to establish the validity of the property.&nbsp; The typical example here is a date range in which the start date must be specified and that&nbsp;the end date, if specified, must be greater than or equal the current date and greater than or equal to the start date.&nbsp; I would code this as two separate rules:</p>
<ol>
<li>StartDate must be specified.&nbsp; This rule only needs to inspect the value of the start date.</li>
<li>EndDate, if specified, must be greater than or equal to start date.&nbsp; This rule needs to inspect the values of the start date and the end date.&nbsp; <strong>A change in either value means that the rule must be re-evaluated.</strong></li>
</ol>
<p>Any change to the start date causes rule #1 to be re-evaluated and causes rule #2 to be re-evaluated, because rule #2 depends on the start date.&nbsp; Any change to the end date only causes rule #2 to be re-evaluated.&nbsp; However, note that running rule #2, may make the start date invalid; we cannot know which property is wrong, just that the combination is wrong.</p>
<p>It is not possible to tell from your example code whether the rule actually needs the value of &quot;bar&quot; to determine validity.&nbsp; If it does, the inclusion of &quot;bar&quot; in the input values is exactly what you want to do.&nbsp; If the rule does not need &quot;bar&quot; then you should remove that from the input values.&nbsp; </p>
<p>There are ways to change the values of properties without triggering the evaluation of rules.&nbsp; You can &quot;load&quot; properties (which does not check rules) rather than using &quot;set&quot; (which does check the rules) to change the values.&nbsp; If you are making a lot of changes at the same time (such as might be the case when loading the data from a data source), you can use the BypassPropertyChecks mechanism.&nbsp; Just make sure that you run the &quot;check rules&quot; method to ensure that the state of the business object matches its contents.</p>
<p>Jon Stonecash</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
