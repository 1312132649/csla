<html><header><title>two clients using two services using same port with singleton in service to manage application servers</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>two clients using two services using same port with singleton in service to manage application servers</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9135.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>edreyes77 posted on Friday, June 25, 2010</h2><p>Greetings,</p>
<p>I am hoping someone can assist in this new request involving wcf configuration for a project I am working on.&nbsp; </p>
<p>The current project is using CSLA 3.8.2, has a Silverlight client hosted in an asp.net web server (just regular stuff) that also hosts WCF dataportal service written in a .net assembly - just like the silverlight videos show. The wcf/dataportal service has a singleton that maintains some service information that is required for all clients to talk to an appropriate application server.&nbsp; There is only one singleton object to manage clients talking to the application servers.&nbsp; This was the easy part thanks to the silverlight videos.</p>
<p>Now I have to have a second endpoint for essentially the same service.&nbsp; The second endpoint must go into the&nbsp;service and use the single singleton to manage clients from either endpoint to talk to the various application servers.&nbsp; All the application servers essentially run the same code and have access to the same data.&nbsp; The application servers are identical.</p>
<p>The new endpoint is for third party client software that cannot use CSLA/dataportal.&nbsp; </p>
<p>I believe I am suppose to have 2 svc files.&nbsp; <br />The two service files point to the below servicemodel info in my web.config.</p>
<p>&lt;system.serviceModel&gt; <br />&lt;services&gt;<br />&lt;service behaviorConfiguration=&quot;WcfPortalBehavior&quot; name=&quot;Csla.Server.Hosts.Silverlight.WcfPortal&quot;&gt;<br />&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Csla.Server.Hosts.Silverlight.IWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;<br />&lt;/service&gt;</p>
<p>&lt;service behaviorConfiguration=&quot;WcfPortalBehavior&quot; name=&quot;Demo.Web.OVSDataPortal&quot;&gt;<br />&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;IOWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;<br />&lt;/service&gt;<br />&lt;/services&gt;</p>
<p>&lt;/system.serviceModel&gt;</p>
<p>or should I try to do something like?</p>
<p>&lt;system.serviceModel&gt; <br />&lt;services&gt;<br />&lt;service behaviorConfiguration=&quot;WcfPortalBehavior&quot; name=&quot;Csla.Server.Hosts.Silverlight.WcfPortal&quot;&gt;<br />&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Csla.Server.Hosts.Silverlight.IWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;</p>
<p>&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;IOWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;<br />&lt;/service&gt;<br />&lt;/services&gt;</p>
<p>I am not even sure if the second servicemodel config is even possible.&nbsp; </p>
<p>I currently cannot get the non-csla wcf service to work in iis.&nbsp; I can get them both to work in web development server through VS2008 but i cannot test to see if they will work togeher in VS2008, but when I deploy I can&#39;t get them to work at the same time using the service and the same singleton object to track application servers.</p>
<p>I can get several silverlight clients to work in iis and use the dataportal service and use the singleton object to manage server applications, but I am having trouble getting the new non-csla version to work&nbsp;with the csla version in iis, and I don&#39;t seem to get any error messages.</p>
<p>can someone suggest anything I might try.&nbsp; I think it&#39;s an issue with configuration of maybe even packaging of my services.&nbsp; I am not sure what to think yet.<br />&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, June 25, 2010</h2><p>Architecturally, you need more than just another endpoint. You need a service interface designed for use by external applications. This is the focus of Chapter 21 in the <i>Expert 2008 Business Objects</i> book.</p>
<p>You can build that interface on top of your business objects, because your objects are running on the server as well as in your SL client. So you already have the objects - you just need to define a service contract and implement it.</p>
<p>The data portal service endpoints require that the consumer be a client-side data portal. No third party application will have that capability, so that&#39;s a complete dead-end.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>edreyes77 replied on Friday, June 25, 2010</h2><p>I did as you suggested already.&nbsp;&nbsp;</p>
<p>&nbsp;I have one service with two contracts&nbsp;for a respective&nbsp;endpoint as below:</p>
<p>&lt;system.serviceModel&gt; <br />&lt;services&gt;<br />&lt;service behaviorConfiguration=&quot;WcfPortalBehavior&quot; name=&quot;Csla.Server.Hosts.Silverlight.WcfPortal&quot;&gt;<br />&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Csla.Server.Hosts.Silverlight.IWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;<br />&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;IOWcfPortal&quot; bindingConfiguration=&quot;BasicHttpBinding_IWcfPortal&quot;/&gt;<br />&lt;/service&gt;<br />&lt;/services&gt;</p>
<p>&lt;/system.serviceModel&gt;</p>
<p>the first&nbsp;uses mobile business objects and is using IWcfPortal for it&#39;s contract.&nbsp; </p>
<p>the second does not use any csla nor mobile objects and is using IOWcfPortal for it&#39;s contract.&nbsp;</p>
<p>I would like both contracts to be in one service, so they can share functionality.&nbsp; They need to share a single instance of a resource manager so they can assign resources (application servers) correctly to the silverlight clients. </p>
<p>When I add the second endpoint and run, I get:</p>
<p><span lang="en-US">
System .Reflection.TargetlnvocationException: An exception occurred during the operation, making the result invalid. Check InnerException for exception details.<br />---&gt; System .ServiceModel .Com municationException: The remote server returned an error: NotFound. ---&gt; System .Net.WebException: The remote server returned<br />an error: Nolfound. ---&gt; System .Net.WebException: The remote server returned an error: NoFound.<br />at System .Net.Browser .&szlig;rowserHttpWebRequest. InternalEndGetResponse(IAsyncResult asyncResult)<br />at System .Net.Browser .BrowserHttpWebRequest. &lt; &gt;c_D isplayClass5. &lt;EndSetResponse &gt;b_4(Object sendState)<br />at System .Net.Browser .AsyncHelper. &lt; &gt; c_DisplayClass2. &lt;BeginOnUl &gt;b_O(Object sendState)<br />--- End of inner exception stack trace ---<br />at System .Net.Browser .AsyncHelper .BeginOnUl (SendOrPostCal Iback beg inMethod, Object state)<br />at System .Net.Browser .BrowserHtlp WebRequest.EndGelResponse( JAsyncResult asyncResult)<br />at System .ServiceModel Channels .HttpChannelFactory .HttpRequestChannel .HttpChannelAsyncRequest .Co mpleteGetResponse(IAsyncResul t result)<br />--- End of inner exception stack trace ---<br />at System .ServiceModel .AsyncResult .End[TAsyncResult](IAsyncResult result)<br />at System .ServiceModel Channels .ServiceChannel .EndCal I (String action, Object[] outs, JAsyncResul t result)<br />at System .ServiceModel .Clienl&szlig;ase&rsquo; 1 .ChannelBase&rsquo; 1 .Endlnvoke(String methodName, Object[] args, JAsyncResult result)<br />at Csla .Wcf Portal .WcfPortalCl ient .WcfPortalCl ientChannel . EndFetch(IAsyncResu It result)<br />at Csla .Wcf Portal .WcfPortalCl ient .Cs la .WcfPortal . I Wcf Portal .EndFetch( I AsyncResult result)<br />at Csla .Wcf Portal .WcfPortalCl ient.OnEndFetch(IAsyncResult result)<br />at System .ServiceModel Cl ientBase&rsquo; 1 .OnAsyncCal lCompleted(IAsyncResul t result)<br />--- End of inner exception stack trace ---<br />at System .ComponentModel .AsyncCompletedEventArgs .RaiseExceptionlfNecessary()<br />at Csla .Wcf Portal .FetchCompletedEventArgs .get_Result()<br />at Csla .DataPortalCl ient.WcfProxy&rsquo; 1 ,proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)





<pre></pre>
</span></p>
<p>Rocky,&nbsp; Is it possible to add a second endpoint with a different contract to a service that is using a Csla/DataPortal and mobile objects through the &quot;Csla.Server.Hosts.Silverlight.IWcfPortal&quot; contract?&nbsp; I am doing this because I need to use a single instance of an object in a service with two contracts </p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, June 28, 2010</h2><p>Terminology becomes important here.</p>
<p>A &quot;service&quot; is a unit of functionality running on a server. Typically a service has one contract. In rare cases a service may have multiple contracts - though that is arguably multiple services that share a common implementation behind the contracts.</p>
<p>A single virtual root can host any number of services.</p>
<p>In any case, each service can have one or more endpoints, each defined by a URL to a svc file (or asmx, etc). So you can have http and tcp endpoints exposing the same service - on different ports of course. Each endpoint has its own svc file and config.</p>
<p>You can also have multiple http endpoints for a single service - typically using different WCF bindings. In this case they&#39;d share the same port - but each endpoint has its own svc file and config.</p>
<p>The IWcfPortal interface is a contract, and therefore it is a service. You can expose multiple endpoints for this service - but they&#39;ll all be the <i>same service</i>, just with different protocols.</p>
<p>What you want is different. You want <i>two different services</i>. You want the data portal service (which you already have), and you want a completely new service with a contract you&#39;ve defined for use by external clients.</p>
<p>That&#39;s easily accomplished - you just need a second svc file and config entry for your second service. Again, multiple services can be hosted in one virtual root - each service just has a different URL to get to the appropriate svc file.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
