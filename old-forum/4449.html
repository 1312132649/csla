<html><header><title>DataPortal, Webservers, Large Files in DB</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal, Webservers, Large Files in DB</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4449.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 posted on Monday, March 03, 2008</h2><P>Rocky,</P>
<P>If a large file (say 10MB or so)&nbsp;is stored in the database and you want to let a user download it in their browser, you can do this cleanly in ASP.Net 3.5 by using dr.SequentialAccess and reading chunks in buffers of 8040 bytes each. This kind of code naturally assumes the web server has a direct connection to the DB server. The nice part of this code is that the full file is not loaded into web server memory - it is retrieved in chunks, written out to the browser in the same size chunks and then repeated until the file is completely sent.</P>
<P>I can't see how this can be done with a DataPortal though. (Currently we limit file size to 1 MB to minimize this issue.)</P>
<P>Any ideas?</P>
<P>Joe</P>
<P>PS - actually the same problem occurs (in reverse) when writing the file to the DB. If a direct connection is allowed it is pretty straightforward. ASP.Net 3.5 allows the file to uploaded in 80 KB chunks which are then written to the file system! So the memory pressure on the web server is kept to a minimum. Older versions of ASP.Net forced the entire file into memory. A BinaryReader can then read the uploaded file as a stream and send it to the DB in chunks.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 03, 2008</h2><P>The data portal doesn't support that sort of streaming, and I'm not sure it can.</P>
<P>However, WCF does support that sort of streaming - at least I've seen demos of streaming from Microsoft folks - streaming music, etc. It pretty much works the same way you describe, only at the service level rather than the database level.</P>
<P>So you could create another endpoint in your same app server virtual root (assuming you are using WCF for the data portal anyway) that exposes a streaming interface for upload/download of large file data.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
