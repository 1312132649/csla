<html><header><title>Parent property always null</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent property always null</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7277.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 posted on Wednesday, July 15, 2009</h2>Hi<br /><br />I'm using 3.6.2.0<br /><br />Can you explain why the Parent properties in all my child objects are null? I have an editable root object which contains a managed property for an editable collection. The collection is lazy loaded and the DataPortal_Fetch of the collection calls MarkAsChild. There are grandchild objects too but not called using lazy loading so they should be marked as child automatically.<br /><br />As far as I can tell, any call in any of the objects to the Parent propery always seems to be null. In particular I have found that when a call is made to this validation rule the target.Parent is null.<br /><br />        private static bool NoDuplicateExcludes(T target, RuleArgs e) where T : MyChild<br />        {<br />            var parent = (MyChildList) target.Parent;<br />            if (parent != null)<br />            {<br />                foreach (var item in parent)<br />                {<br />                    if (target.Exclude &amp;&amp; !(ReferenceEquals(item, target)))<br />                    {<br />                        e.Description = "";<br />                        return false;<br />                    }<br />                }<br />            }<br />            return true;<br />        }<br /><br />Is there something I need to do in the root object or the child collection which is lazy loaded? Any other ideas?<br /><br />Many thanks<br />Andrew<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Wednesday, July 15, 2009</h2>Hi<br /><br />Actually, I can see now that the parent isn't always null. I put the debugger in the PTWeb project and found that when AddNew is called <br /><br />Role role = obj.AddNew();<br /><br />the NoDuplicates rule is called and the Parent is null. Then when the DataMapper maps the values NoDuplicates is called again and this time it isn't null.<br /><br />I guess this is by design but I'm struggling to see why. The parent obviously is there for the AddNewCore instance method to be called. <br /><br />Where's the logic?<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 15, 2009</h2>If the role is getting its rules checked before it actually gets added to the collection - and it tries to reference parent, it'll be null. <br /><br />i.e. PersonAddress newAddress = PersonAddress.NewPersonAddress();<br />this.Add(newAddress);<br />return newAddress;<br /><br />if you check rules in address looking for duplicates, parent will be null when DP_Create fires from the NewPersonAddress() sequence and it will check rules before the this.Add.<br /><br />Not sure if that's what you're talking about but thought I'd mention it just in case. </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Wednesday, July 15, 2009</h2><P>Hi</P>
<P>Yes, you're right, that was the problem I was having. I guess it would be useful to know at what point in the ojects life cycle the Parent is available. Is it correct that it's not available after the object is deserialized? I can't quite work out when it's available using just a standard implementation. I'm not sure the book is very clear on the subject.</P>
<P>Thanks</P>
<P>Andrew</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
