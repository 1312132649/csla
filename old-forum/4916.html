<html><header><title>CSLA 3.5: Root subscribing to a child event</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.5: Root subscribing to a child event</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4916.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea posted on Thursday, May 29, 2008</h2><P>I am struggling a bit with this... I have an editable&nbsp;root object say Customer and an editable child Address. I want the root Customer object to be notified when a specific property in its Address changes. But I am not sure when to subscribe the root to the event.</P>
<P>Here is an example (within my root Customer object):</P><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Address</FONT><FONT size=2> CustomerAddress<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>get<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!(FieldManager.FieldExists(CustomerAddressProperty)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetProperty&lt;</FONT><FONT color=#2b91af size=2>Address</FONT><FONT size=2>&gt;(CustomerAddressProperty, </FONT><FONT color=#2b91af size=2>Address</FONT><FONT size=2>.NewAddress());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetProperty&lt;</FONT><FONT color=#2b91af size=2>Address</FONT><FONT size=2>&gt;(CustomerAddressProperty).PostcodeChanged += </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>EventHandler</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>AddressPostcodeChangedEventArgs</FONT><FONT size=2>&gt;(CustomerAddress_PostcodeChanged);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> GetProperty&lt;</FONT><FONT color=#2b91af size=2>Address</FONT><FONT size=2>&gt;(CustomerAddressProperty);<BR>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></P>
<P><FONT size=2><FONT size=3>The event is fired properly but Customer never gets notified. Now the question is twofold:</FONT></FONT></P>
<UL>
<LI><FONT size=2><FONT size=3>It appears I am never getting in the SetProperty&lt;&gt;, GetProperty&lt;&gt; bit of code... I was under the impression that this should happen each time the property is interrogated for its value.</FONT></FONT></LI>
<LI><FONT size=2><FONT size=3>Assuming this is the wrong place to put this code, where should it actualy be?</FONT></FONT></LI></UL>
<P><FONT size=2><FONT size=3>Cheers</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 29, 2008</h2><P>Your event hookup would only ever happen if you were using lazy loading to create the child object. FieldManager.FieldExists() returns false only if you haven't already set the field to some value.</P>
<P>My guess is that you are creating the child object in your DP_Fetch() method - probably calling LoadProperty()? You'd need to hook the event there, and in an OnDeserialized() override too (to handle cloning and data portal serialization).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, May 29, 2008</h2>But in that case I will need to do the event hookup in 2 locations, 1 in the DP_Fetch() when calling LoadProperty() (as indeed is happening) for existing data and 1 in the location I have it for New objects. This seems like a bit of&nbsp;duplication to me unless I missed something out again?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 29, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>Three &#8211; don&#8217;t forget the OnDeserialized() override :)
<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Each time you create a new instance of the object you need to
hook the event from that instance. I don&#8217;t see how you can avoid that, it
is just the way events work.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, May 29, 2008</h2>OK then 3 times, no probs! I just wanted to make sure I wasn't double hooking events or doing anything silly.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
