<html><header><title>CSLA and simple multi-user aspect</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA and simple multi-user aspect</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/843.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pascal Hendriks posted on Tuesday, August 08, 2006</h2><P>Hi all,</P>
<P>I'm kindly new with the CSLA framework and I have a multi-user question.<BR>Imagine we have a table customer&nbsp;containing 10 records (customerA, customerB, etc).<BR>We have 2 client machines.<BR>We don't use any modal forms or whatever, so no reloading by opening a form is possible.<BR>Look at the following situation:</P>
<P>- Client 1 gets the list of customers<BR>- Client 2 gets the list of customers<BR>- Client 1 changes the name of customerA in "CustomerA2"<BR>- Client 2 changes the name of customerB in "CustomerB2"</P>
<P>At this moment the list of client2 is not refreshed, client2 doesn't see the changes of client1.</P>
<P>Can this issue be solved?<BR>Or am I doing something wrong?<BR></P>
<P>Kind regards,</P>
<P>Pascal Hendriks<BR></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Tuesday, August 08, 2006</h2><P>Hi Pascal,</P>
<P>Search the forum for "lock" or "concurrency" to find some good discussion. There was also a lot of discussion in the old forum.</P>
<P>We use a manual locking mechanism where each record has&nbsp;an "IsLocked" and a "LockedByID" field. The users know they cannot change records when they don't have the lock (indicated in the status bar on the form). We've also added refresh functionality to anything with potential to change. In some cases, a quick check for new on the database is needed. It's a rather home-grown methodology, so it's very flexible.</P>
<P>_E</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ruckus77 replied on Tuesday, August 08, 2006</h2><P>Use an observer pattern.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, August 08, 2006</h2><P>The observer pattern works well with Windows apps.&nbsp; Fortunately, web apps make it even simpler if you don't cache the dataset and refresh with each post-back from the database.</P>
<P>Simplest way to implement the observer pattern is to obtain the original collection of objects from factory object.&nbsp; For instance:</P>
<P><CODE>Client1.CustomerList = Server.GetCustomerList();<BR>Client2.CustomerList = Server.GetCustomerList();</CODE></P>
<P>Now, when changes are made to&nbsp;either list, the&nbsp;collection is able to notify all clients that the list has changed.</P>
<P>Of course, this is overly simplified (and not a true implementation of the observer pattern) but it is part of the CSLA framework (via the ListChanged event in collections) and works fairly well with the built-in data-binding processes for WinForms.</P>
<P>The challenge in implementing the observer pattern, and where the above example fails, is when you are dealing with distributed systems and disconnected datasets (as with Web apps).&nbsp; Here, you need some way to communicate the change made on one system to the dataset residing on another.&nbsp; This is much more complicated and I defer to others who have implemented the observer pattern in a distributed environment to chime in with their input on how this could be done.</P>
<P>You may also want to consider some kind of Refresh() method on your collection to manually trigger re-fetching the data from the database as an option.&nbsp; We have utilized this approach before and had some UI's wired up with a timer to automatically refresh periodically - for pseudo-realtime monitoring functions.</P>
<P>Another approach that might suit your needs would be to refresh the collection automatically whenever changes are applied.&nbsp; This would consume a great deal of additional bandwidth, but if you are doing a refresh anyway, there's no loss in doing it when you apply the changes.&nbsp; So, in the example you gave, when the changes made by Client2 are applied to the database, the collection of customers on Client2 would be reloaded from the database thereby retreiving the changes made by Client1.&nbsp; Of course, now Client1 doesn't know anything about the changes made by Client2 until the next time it applies a change.&nbsp; This can cause problems unless you implement some sort of concurrency management such as a LastModified timestamp column to ensure data integrity on the update.</P>
<P>Hope that helps.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
