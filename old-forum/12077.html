<html><header><title>Issue With BindableBase</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Issue With BindableBase</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12077.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>phowatt posted on Thursday, July 18, 2013</h2><p>I am working on a clients application that is using CSLA Assembly Version 2.0.3.0. The error I am getting is</p>
<p>System.ArgumentOutOfRangeException was unhandled by user code<br />&nbsp; HResult=-2146233086<br />&nbsp; Message=Specified argument was out of the range of valid values.<br />Parameter name: rowIndex<br />&nbsp; Source=System.Windows.Forms<br />&nbsp; ParamName=rowIndex<br />&nbsp; StackTrace:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.InvalidateCell(Int32 columnIndex, Int32 rowIndex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.DataGridViewDataConnection.ProcessListChanged(ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.DataGridViewDataConnection.currencyManager_ListChanged(Object sender, ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.OnListChanged(ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.List_ListChanged(Object sender, ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.OnListChanged(ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.InnerList_ListChanged(Object sender, ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ComponentModel.BindingList`1.OnListChanged(ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ComponentModel.BindingList`1.Child_PropertyChanged(Object sender, PropertyChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.BindableBase.OnPropertyChanged(String propertyName) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Csla203\Core\BindableBase.cs:line 99<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.PropertyHasChanged(String propertyName) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Csla203\Core\BusinessBase.cs:line 253<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.PropertyHasChanged() in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Csla203\Core\BusinessBase.cs:line 236<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at JmFamily.Mps.Entities.MPSDYN03.Wmps02900d.set_ClientNbr(String value) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\JMFamily.Entity\MPSDYN03\Wmps02900d.cs:line 665<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at JMFamily.Mps.W_wmps_029.dw_detl_ue_select_ovl() in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Mps\Mpsbe\W_wmps_029.cs:line 11261<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at JMFamily.Mps.W_wmps_029.dw_detl_rowfocuschanged(Object sender, EventArgs e) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Mps\Mpsbe\W_wmps_029.cs:line 13515<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Metex.Core.DataUserControl.OnRowFocusChanged(EventArgs e) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Metex.Core\DataUserControl.cs:line 753<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Metex.Core.DataUserControl.RaiseRowFocusChangedEvent(Object sender, EventArgs e) in C:\WOFCOCollection\MPS\Main\WinApps\GUI\Metex.Core\DataUserControl.cs:line 828<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.OnCurrentChanged(EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.CurrencyManager_CurrentChanged(Object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.OnCurrentChanged(EventArgs e)<br />&nbsp; InnerException: <br />nonSerializableHandlers.Invoke(this,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new PropertyChangedEventArgs(propertyName));</p>
<p>The code that causes this error follows</p>
<p>[EditorBrowsable(EditorBrowsableState.Advanced)]<br />protected virtual void OnPropertyChanged(string propertyName) <br />{<br />&nbsp;PropertyChangedEventHandler&nbsp; nonSerializableHandlers = _nonSerializableHandlers;if (nonSerializableHandlers != null ) <br />&nbsp;nonSerializableHandlers.Invoke(this, new PropertyChangedEventArgs(propertyName)); <br />&nbsp;PropertyChangedEventHandler&nbsp; serializableHandlers = _serializableHandlers;if (serializableHandlers != null) <br />&nbsp;serializableHandlers.Invoke(this, new PropertyChangedEventArgs(propertyName));<br />}</p>
<p>The propertyName parameter happens to be &quot;ClientNbr&quot; and when I look at the object reference by &quot;this&quot; it does contain a property named &quot;ClientNbr&quot;. I cannot figure out why this error is occuring. The object uses a bindingSource.</p>
<p>
<p>Is this a known bug?. The PropertyHasChanged method is working correctly in countless other examples in the application but in this particular case there are three properties that are being changed on this object and they all have the same error.</p>
<p>Thanks</p>
</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, July 19, 2013</h2><p>Hi, </p>
<p>The data binding exceptions can be deceiving. The exception is thrown from the GridView and it has a &quot;foaulty&quot; rowindex for a changed item. So the issue is not with the PropertyChanged event&nbsp; as such. The issue is with the list and the datagrid view. </p>
<p>Is the list wrapped in a Sorted/Filtered binding list. There is quite a few bugfixes done in later years to these classes to send the correct listindex back to the UI control on the ListChanged event. </p>
<p>To debug further I would put a breakpoint into the OnListChanged event on the list and look at which RowIndex is causing the issue. </p>
<p>So just to be clear - this is NOT a bug in PropertyChanged event on the item. </p>
<p>It _may_ be a bug in how the list is determining the ListIndex of the item and use this index for OnListChanged event or a bug in some event code on the UI control/DataGridView.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>phowatt replied on Friday, July 19, 2013</h2><p>JohhyBee,</p>
<p>Apparently you are in Norway. If I were anywhere close I would turn the world upside down to buy you dinner. You were absolutely right about the problem being with the grid. The actual problem was the when the CSLA object property was being changed the current grid row was actually null. This application has all kinds of clever event handling and the code in question was being executed when it should not have been. I surrounded the code in question with an if block testing for a null current grid row and it fixed the problem. The code is being executed twice which points to other issues but the app is functioning without the previous error. &nbsp;They were in staging with a bunch of changes and this bug cropped up on code that had not been modified. Big puzzle. So you my friend are my new hero.</p>
<p>Thanks Loads.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
