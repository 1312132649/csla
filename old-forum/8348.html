<html><header><title>Workaround for IsDirty == false after removing newly added child</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Workaround for IsDirty == false after removing newly added child</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8348.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael posted on Wednesday, January 13, 2010</h2><font size="2">Hi everyone<br><br>We are developing a CAD product with CSLA which saves the business objects to the database when the drawing is saved.<br><br>So, it's possible to edit an object, add a new child object to the object's child collection, accept the changes and have the drawing updated accordingly. Then if you edit the object and delete the child, the parent object becomes not </font><font face="Courier New" size="2">IsSavable</font><font size="2">, as expected, because from the data point of view, there's now nothing to save.<br><br>My problem is, in my edit screens when OK is clicked I use the </font><font face="Courier New" size="2">IsSavable</font><font size="2"> flag to determine whether to </font><font face="Courier New" size="2">ApplyEdit()</font><font size="2"> or </font><font face="Courier New" size="2">CancelEdit()</font><font size="2">. Obviously, this doesn't work in this case, because the object now appears to be not </font><font face="Courier New" size="2">IsDirty</font><font size="2">, the edit is cancelled and the child object comes back.<br><br>One hacky solution is to expose a </font><font face="Courier New" size="2">HasDeletedItems</font><font size="2"> in the BLB and override the parent's </font><font face="Courier New" size="2">IsDirty</font><font size="2">:<br><br></font><font face="Courier New" size="2">public override bool IsDirty<br>{<br>&nbsp;&nbsp;&nbsp; get { return base.IsDirty || Children.HasDeletedItems; }<br>}</font><font size="2"><br><br>But, is there a better way?<br><br>Kind regards<br>Michael<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Wednesday, January 13, 2010</h2>Interesting problem. <br /><br />I think of ISavable as applying more to where or not you should call Save() rather than accept or undo any changes made to the object.<br /><br />My instinct would be to unconditionally ApplyEdit() when OK is pressed. If a user wants to cancel and edit, then they they would push a Cancel button. <br /><br />Incidentally, ApplyEdit() is comparatively more expensive than CancelEdit() since it just discards the top of the Undo state stack while CancelEdit() applies all the values in the state to the object. There seems little harm in ApplyEdit() if the object is not dirty, so perhaps you could just ApplyEdit() if the object was either IsSavable or !IsDirty.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Wednesday, January 13, 2010</h2><font size="2">Thanks for the reply.<br><br>I find that users don't much like hitting Cancel, even if they haven't changed anything. But, the main reason I've approached it this way is because if and only if something really has changed, the object needs to be redrawn in AutoCAD, and that can take up to 500ms for some objects. Draftsmen are very impatient; they already complain that 350ms is too long for a dialog to display (which is mostly the time taken for databinding to complete - I have no idea how to speed this up).</font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, January 14, 2010</h2><P>I think the simpliest solution is to bind your OK button to IsValid.&nbsp; You want to allow users to click OK even if there are no changes, but (I assume) not if the object is valid.</P>
<P>Only if IsSavable is true would you do the apply edit.</P>
<P>If data binding is hurting performance, probably the only thing you can do is not use databinding.&nbsp; It uses reflection, which is slow.&nbsp; But then you'll have to write all the plumbing code yourself.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, January 14, 2010</h2>Hi, <br><br>Which version of Csla are you using and do you use "managed properties" in your root object? <br><br>If you are using "managed properties" this should be handled automatically by fieldmanager. <br><br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, January 14, 2010</h2><P><FONT face=Tahoma size=2>Why not override "IsSavable" to reflect what you need it to be?&nbsp; The method is virtual, so you could pull the code into your subclasses and do what you need to with the "IsDirty" check there.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, January 14, 2010</h2><br />I personally would't override anything, I would simply create my brand new property that would be exclusively used for my your particular need.<br /><br />public override bool CADNeedsRedraw<br />{<br />    get { return base.IsDirty || Children.HasDeletedItems; }<br />}<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, January 14, 2010</h2><P><FONT face=Tahoma size=2>But then I'd argue that if Rocky didn't want the "IsSavable" functionality to be modified, then he wouldn't have made the method virtual.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P>
<P><FONT face=Tahoma size=2>Honestly, it doesn't matter to me.&nbsp; I&nbsp;just see "IsSavable" as a piece of information that may not be 100% the same for every object (which is also why I think Rocky made the method virtual).&nbsp; But if you want to leave that alone and make a different property - or if the concepts are logically different for you - then by all means, make a different property and bind to that.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, January 14, 2010</h2>I am cool with that but really, the only reason I suggested to create a new property was because in my head, I feel that overriding the property the way the OP is doing will give the property a different meaning to it.<br /><br />I mean, I guess that what I am trying to say is that he is coercing that property into being something it was not design to be. He is using the property to determine something it was not design to determine.... did I just repeated myself :)<br /><br />Trying to determine if he should redraw his screen or not using the IsSavable property? Its just feels wrong to me, but this is just my opinion of course.<br /><br />Any way, it really does not matter to me either. Life is good!<br /><br />Thanks.<br /><br />Rene</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Thursday, January 14, 2010</h2><font face="Tahoma" size="2">The OK button is enabled as follows:<br>
OKEnabled = BusinessObject.IsSavable || !BusinessObject.IsDirty;<br><br>Jonny, I'm using 3.7 currently, and I am using managed properties for the child collections. My problem is that IsDirty is false after removing the new child. I just wondered if there was a simpler way to discover this.<br><br>Rene, I see your point about a separate property. I agree it's a better approach than to change the behaviour of IsDirty or IsSavable.<br><br>I'm happy enough with this solution now. Thanks everyone!</font>
<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
