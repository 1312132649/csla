<html><header><title>Confused about EditLevels</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Confused about EditLevels</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6719.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DivisibleByZero posted on Wednesday, April 01, 2009</h2>Ok I have some big confusion with EditLevel in my project. I am unable to call ApplyEdit on my root object because it fails. I created a small project to see if I could duplicate the problem but I was unable to, but it did make me scratch my head on the various EditLevel's my objects had. <br><br>Here is my object model:<br><br>Root : BusinessBase&lt;Root&gt;<br>&nbsp;&nbsp;&nbsp; Id : Int32<br>&nbsp;&nbsp;&nbsp; Children: Children<br><br>Children : BusinessListBase&lt;Children, Chld&gt;<br><br>Child : BusinessBase&lt;Child&gt;<br>&nbsp;&nbsp; Id : Int32<br>&nbsp;&nbsp; Grandchildren : Grandchildren<br><br>Grandchildren : BusinessListBase&lt;Granchildren, Grandchild&gt;<br><br>Grandchild: BusinessBase&lt;Grandchild&gt;<br>&nbsp;&nbsp;&nbsp; Id : Guid<br><br>I then created a simple windows form with a dropdown and a gridview. I have 3 BindingSource objects in my form:<br>rootBindingSource<br>childrenBindingSource&nbsp;&nbsp; - bound to dropdown list<br>grandchildrenBindingSource&nbsp; - bound to data grid<br><br>in the form load I do Root.NewRoot() followed by a call to BindUI(). BindUI can only bind the root and the Children because Grandchildren is a child of a particular Child object.<br><br>BindUI() {<br>&nbsp;&nbsp;&nbsp;&nbsp; root.BeginEdit();<br>&nbsp;&nbsp;&nbsp; childrenBindingSource.DataSource = root.Children;<br>&nbsp;&nbsp;&nbsp; rootBindingSOurce.DataSource = roo;<br>}<br><br>I then handle the CurrentChanged event of the BindingSource so I can bind Grandchildren:<br><br>childrenBindingSource_CurrentChanged(object sender, EventArgs e) {<br>&nbsp;&nbsp;&nbsp; Child c = (Child)childrenBindingSource.Current;<br>&nbsp;&nbsp;&nbsp; grandchildrenBindingSOurce.DataSource = c.Grandchildren;<br>}<br><br>I have a simple save method that will call the RebindUI(true, true) and save the object and Unbind all the data sources. This does the same thing as what the project tracker does...unbinding all 3 sources.&nbsp; I set a breakpoint right before the call to BindUI and this is what the various edit levels are:<br><br>root.EditLevel - 2 // expected<br>root.Children.EditLevel - 1 // expected?<br>root.Children[0].EditLevel - 2 // expected - this is the Current item in the dropdown<br>root.Children[0].Grandchildren.EditLevel - 1 // expected?<br>root.Children[0].Grandchildren[0].EditLevel - 1 <br>// not expected? shouldn't this be 2 since it is the current item in the grid<br><br>In this particular case the object is still savable but for some reason in my larger project I'm having somewhat similar results and it's causing it to have an EditLevel mismatch. Am I doing something wrong with binding the grandchildren? Anything else that jumps out at anyone?<br>&nbsp;&nbsp;&nbsp; <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 01, 2009</h2><P>There are two sets of rules to consider: edit level, and data binding.</P>
<P>The edit level rules are pretty straightforward. For each BeginEdit() on an object, you must call CancelEdit() or ApplyEdit() on that object before calling any of those three methods on the object's parent (or grandparent, etc).</P>
<P>In other words, each level of editing for an object must be resolved before its parents go mucking around with their edit levels.</P>
<P>Similarly, the data binding rules are pretty simple. If an object is bound, it will have an elevated edit level. Period. The BindingSource control ensures that a bound object will have BeginEdit() called at all times, so the object is always in "edit mode".</P>
<P>So the only way to get an object's edit level reduced is to unbind it, and then call CancelEdit() or ApplyEdit(), because as long as it is bound you can't reduce the edit level.</P>
<P>Where this gets tricky is in the interaction between the edit level rules and the data binding rules, and that's where the content in the&nbsp;<EM>Using CSLA .NET 3.0</EM> ebook (or the old threads on this topic) are invaluable.</P>
<P>Or you can use the CslaActionExtender in CSLA .NET 3.6 to do the work for you, which is probably a better option if it is available to you.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
