<html><header><title>Is there a hack to get CSLA working on shared web host...or known web hosts who allow?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Is there a hack to get CSLA working on shared web host...or known web hosts who allow?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1313.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo posted on Sunday, September 24, 2006</h2>So being the genius I am, I started using CSLA for a project that sits on a shared web host - not reading the fine print of 'can't run in partially trusted environment' I wrote quite a bit locally...thankfully not so much as to really hurt myself.&nbsp; Though I'd prefer to use CSLA because it's a powerful tool and a good fit for what I'm doing.<br><br>Maybe someone knows a shared host that is CSLA friendly?&nbsp; Or a hack to get around the security issue? (doubt the latter, but doesn't hurt to ask).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>djjlewis replied on Monday, September 25, 2006</h2><p class="MsoNormal">I managed to do this with some success in CSLA 1.x. The main
problem is with reflection, which CSLA obviously uses a lot of, and there may
be other things such as remoting and serialization.</p>

<p class="MsoNormal"><br>
The two main areas to avoid are n-level undo and the DataPortal, both of which
make heavy use of reflection. <br>
<br>
Avoiding n-level undo is easy, and this is almost never used in web environments
anyway, so just don't call BeginEdit. <br>
<br>
To avoid the DataPortal, I found the easiest thing to do is just call your
DataPortal_XYZ methods directly from the Shared Factory methods. So instead of
:</p><p class="MsoNormal"><br>
</p><p class="MsoNormal">Public Shared Function GetMyBO As BO<br>&nbsp;&nbsp;&nbsp; Return CType(DataPortal.Fetch(New Criteria()),BO) <br>
End Function</p><p class="MsoNormal"><br></p><p class="MsoNormal">
You would do something like:</p><p class="MsoNormal"><br>
</p><p class="MsoNormal">Public Shared Function GetMyBO As BO<br>&nbsp;&nbsp;&nbsp; Dim myBO as New BO ' use of the private constructor is fine as we're in the
class<br>
&nbsp;&nbsp;&nbsp; myBO.DataPortal_Fetch(New Criteria())<br>&nbsp;&nbsp;&nbsp; Return myBO<br>
End Function</p><p class="MsoNormal"><br></p><p class="MsoNormal">
At least I think that's how I did it (writing from memory)<br>
<br>
The other approach would be to go through the framework and remove any of the
n-level undo/ reflection parts, but that just becomes too painful and makes
life really hard to include new updates etc.<br>
<br>
hth,<br>
<br>
Dan.<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo replied on Monday, September 25, 2006</h2>Yes, this does help very much.&nbsp; Thanks!&nbsp; The size of this project, and being on a shared host, it will never be remoted so there's not much need to go through the DataPortal in this light.&nbsp; Will this cause problems though when using the CheckRules() and other validation/authorization methods?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, September 25, 2006</h2>CheckRules is always up to you to call; you either do it after setting the values via the field backers, or you don't need to call it if you set the fields via their properties.&nbsp;&nbsp; <br><br>If you don't use the dataportal, you'll need to call MarkOld / MarkNew on the root objects as well, since the DP usually handles this for you on root objects.<br><br>Check out the SimpleDataPortal to see if it does anything else.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 25, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>boo:</strong></div><div>Yes, this does help very much.&nbsp; Thanks!&nbsp; The size of this project, and being on a shared host, it will never be remoted so there's not much need to go through the DataPortal in this light.&nbsp; Will this cause problems though when using the CheckRules() and other validation/authorization methods?<br></div></BLOCKQUOTE><br><br>The problem wouldn't be CheckRules() itself, but rather the rule methods. The ones in CommonRules use reflection, and you'd have to avoid them. Instead, you'd have to develop rule methods on a per-business-class basis so your code would have access to the private fields without using reflection.<br><br>With PropertyHasChanged(), CanReadProperty() and CanWriteProperty() you need to avoid the overloads that auto-detect the property name, and instead use the string literal overload that supplies the property name. That should avoid any high-priv code there.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo replied on Monday, September 25, 2006</h2>Thanks (everyone) for your help.<br><br>I went in a removed the generic CheckRules() and replaced with a call to CheckRules("PropertyName") for each rule.<br><br>I also replaced all calls of:<br><br><font face="Lucida Console" size="2"><br />return DataPortal.Create&amp;lt;BizObj&amp;gt;.(criteria);<br /></font><br><br>with:<br><br><font face="Lucida Console" size="2"><br />BizObj o = new BizObj();<br />o.DataPortal_Create(criteria);<br />return o;<br /></font><br><br>I'm still getting the security exception; is there anywhere else I could be looking that I'm missing; all I have so far is a EditableCollection and a EditableChild (the object in the collection).<br><br>Rocky, have you ever considered creating a light version build for scenerio's such as this?&nbsp; I know that's extra burden for you...but I got to ask.&nbsp; :)<br><br>Thanks again.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 25, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>boo:</strong></div><div><br>Rocky, have you ever considered creating a light version build for scenerio's such as this?&nbsp; I know that's extra burden for you...but I got to ask.&nbsp; :)<br></div></BLOCKQUOTE><br><br>Ahh, if time were no object... <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><br><br>I already maintain the framework twice, which is a serious PITA. Also, a few people have asked for a CF version of the framework, which would be nice. And then a lightweight version for partial trust.<br><br>So I could end up maintaining 6 versions of the framework? No, I'm afraid I'm just not going down that road. Sorry...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo replied on Tuesday, September 26, 2006</h2><br>Rocky, I understand your reasoning and don't blame you one bit.&nbsp; To offset things have you ever thought about having the basic framework that comes with the book continue to be a package but then charge for these other versions.&nbsp; I know right now I'd pay for single licence for the project I'm currently doing on a shared host, and I got another one in the works that I'd buy another licence for; assuming the price that was set could be consumed by meager rages...<br><br>I'm still stuck on the original problem though, so if anyone has any new ideas I would appreciate them.&nbsp; I hate to re-invent the wheel when there is a very capable wheel right in front of me.&nbsp; Dang these shared web hosts and their lack of trust!&nbsp; I should be given Admin powers so I can do anything I want &nbsp; :)<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Tuesday, September 26, 2006</h2><P>boo,</P>
<P>&gt;&gt;I should be given Admin powers so I can do anything I want &nbsp; :)</P>
<P>I've had similar needs before, albeit not because of CSLA, but because of other stuff we decided to base our architecture on. Although more expensive, you can get folks to host dedicated servers that will do whatever you want. When we looked into the costs, it made more sense to host it ourselves.</P>
<P>Just a thought,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timster replied on Friday, December 10, 2010</h2><p>Rocky</p>
<p>If a lightweight version of CSLA.NET that would work in partial trust environments was produced by contributors to CSLA would you sanction this work and maybe include some of the code that was required in the primary branch(es)?</p>
<p>Would you provide some initial guidance and mentoring regarding this project without actually doing any of the work or subsequent testing yourself?</p>
<p>Could this be done simply with preprocessor directives and a seperate project excluding the files that are not required or am I being a bit simplistic?</p>
<p>Regards</p>
<p>Tim</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 10, 2010</h2><p>I am not interested in having a fork of CSLA, no. The closest I&#39;ve ever come to this, is when Lawerence built the CF version a few years ago, and he donated it to the public (it is in my svn server).</p>
<p>However, I&#39;m perfectly happy to have contributors to the actual CSLA project that work toward this goal within the mainstream codebase. And honestly, it wouldn&#39;t be that hard now, because the SL/WP7 codebase is extremely close to what you&#39;d need - and for the most part it is the mainstream codebase with a few compiler directives.</p>
<p>Or to put it another way, the biggest problem with partial trust is the use of the BinaryFormatter or NetDataContractSerializer. Since we wrote the MobileFormatter to support SL, the solution already exists. Mostly what is needed is to enhance the serializer selector in Csla.Serialization to allow the use of MobileFormatter in .NET too and the single biggest issue for partial trust would go away.</p>
<p>I suspect there are some things in MethodCaller too, where some config-based abstraction would be required - basically allow the efficient fulltrust code to run normally, but via config you could opt to use the same code used on SL.</p>
<p>I guess what I&#39;m saying, is that (thanks to SL) most of the hard work to run outside fulltrust was done about 3 years ago. The effort now would be to make those code paths available to .NET code (optionally - most of them aren&#39;t as efficient as the fulltrust counterparts) so you could opt into that mode when necessary.</p>
<p>We certainly don&#39;t need another project or set of Csla.dll files. There should be no reason that&#39;d be required.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timster replied on Friday, December 10, 2010</h2><p>Rocky</p>
<p>Thanks for response, I don&#39;t envy the task of looking after one version of CSLA let alone three or four so I understand your response and agree completey.&nbsp; </p>
<p>I think that providing this&nbsp;functionality would be an important and popular upgrade to CSLA.NET.&nbsp; It is a shame not to have the same (or nearly the same) features and functionality available to Hosted Web Developers as well as those in fully trusted environments.&nbsp; I think the hit on performance and restrictions&nbsp;in feature set&nbsp;is probably a compromise must of us would be willing to accept for the use of the feature rich, easy to use framework we know and love!</p>
<p>Could this be retrofitted into 3.8.X as well or would it only appear in 4.0.X?</p>
<p>Please let me know if I can assist in testing or development work on this.</p>
<p>Thanks again</p>
<p>Tim</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 10, 2010</h2><p>That depends on how much work someone&nbsp; (you? :) ) is willing to do.</p>
<p>Generally I view 3.8.4 as purely in maintenance mode. I have zero plans to enhance 3.8, or even fix anything but the most important bugs.</p>
<p>I think it would be a&nbsp;little harder to make 3.8 work in partial trust too, because it is one assembly, where as CSLA 4 is split into multiple assemblies. I&#39;m not entirely sure how you&#39;d handle the Windows Forms or WPF code - or maybe that wouldn&#39;t matter because it would never be loaded by the type loader?</p>
<p>In any case, if I ultimately do this it would be only for CSLA 4. If someone else does it, I could be persuaded to allow a 3.8.5 that would include this enhancement to 3.8.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timster replied on Sunday, December 12, 2010</h2><p>Ok Rocky, I will assign some time to take a look at&nbsp;this and get back to you.</p>
<p>Reason why I am looking 3.8.X is that not everyone has upgraded to VS2010 yet (including me) <img src="http://forums.lhotka.net/emoticons/emotion-6.gif" alt="Sad" /></p>
<p>Thanks for your responses.</p>
<p>Regards</p>
<p>Tim</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, December 12, 2010</h2><p>To become a contributor you&#39;ll need to sign a contributor agreement. Email me directly (rocky at lhotka dot net) and I&#39;ll get you the agreement to review, etc.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
