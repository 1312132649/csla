<html><header><title>Simple question with simple answer ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Simple question with simple answer ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/115.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdrianE posted on Tuesday, May 16, 2006</h2>Hello,<br>&nbsp; I'm analyzing the possibility of using CSLA for my development efforts but I'm having some doubts about some simple things.<br>&nbsp; I'm developing only for web platforms but they are not massively accessible (intranet applications with a few hundreds users base) so I'm not very concerned about the object-oriented overhead.<br>&nbsp; The doubts I have might seem very simple (in fact they could be very simple) but I'd like to be sure before embracing CSLA.<br>&nbsp; The example I'd like to talk about is this:<br>&nbsp; 1. I have a Customer that lives in a City which is in a Province which is in a Country.<br><br>&nbsp; The question is how do I implement a business model for this without replicating all the code needed to load the data from the database and without incurring in the performance penalty of having to call 4 stored procedures to display a customer (one to retrieve customer data, and another one for each of the City, Province and Country data).<br><br>&nbsp; The two approaches that come to my mind (that obviously don't address both needs at the same time) are:<br>&nbsp; 1.<br>&nbsp; &nbsp;&nbsp;&nbsp; Have a Customer object that loads it data only and contains a property of type City than when accessed loads its data (lazy initialization) and it has a property of type Province and this has a property of type Country.<br><br>&nbsp; &nbsp;&nbsp;&nbsp; This approach maintains hidden the need to access Customer child properties data but incurs in a performance overhead because of the need to make a stored procedure call for each child data. The need to hide the code needed to access the data may seem unreasonable but if you start analyzing it you may end up with lots of stored procedures having to make the join between the City, Province and Country tables which in other examples could involve many more tables.<br><br>&nbsp; 2.<br>&nbsp;&nbsp;&nbsp; Have a Customer object that loads its data from the database, plus the data needed to load the City, Province and Country, and passes that information through the DataReader or another DataSource-agnostic object (for example a Hashtable or Dictionary).<br><br>&nbsp;&nbsp;&nbsp; This approach is very performant but it starts to replicate JOINS all around the stored procedures. And if the Customer has to load its Contacts, it also has to make the JOINS between the Contacts and the City, Province, Country which gets too complex for loading 4 simple entities.<br><br>&nbsp; Any help would be very appreciated.<br>&nbsp; If something is not very clear, please tell me and I'll try to make it clearer.<br><br>&nbsp; Thanks in advance,<br>&nbsp; Adrian<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CaymanIslandsCarpediem replied on Tuesday, May 16, 2006</h2><P>In cases like this if there are "decode" objects which I know will be used all the time (countries), I will create the objects as static (C# terminology cannot remember VB.NET term off the top of my head).&nbsp; As such, the first time they are needed they make the call to the DB to populate but on any call after that they are already populated in memeory so no additional DB call is needed.</P>
<P>One thing to remember about this is, if another user has added a new "decode" which you have stored in memory you may not have this record so there may be cases when you need to refresh the in-memory decode collection.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MichaelBosch replied on Tuesday, May 16, 2006</h2>Static = Shared in VB<br>
<br>
I'd say it depends on what you're doing with the Customer object.&nbsp;
If it's a read-only object that you don't really need to modify their
city/state/country info, it might be best to have these as simple
string variables that you load from the database with all the inner
joins.&nbsp; This might be more of a CustomerInfo object. You may also
want to have a private variable that gets loaded from the stored
procedure, for example m_CountryID, then another property called
CountryName that returns something like&nbsp;
CountryList.GetCountryList.Item(m_CountryID).CountryName.&nbsp;
CountryList might also have the shared (static) object reference like
Cayman suggested.&nbsp; I guess the point is, you have a few options.<strong></strong><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, May 16, 2006</h2>Adrian,<br><br>I'm not sure I get what you're saying. Yes, you can have one stored proc with all results for the root and the children or you can lazy load them and have one sp for each object. The joins will have to be there anyway...<br>This is something you'll have to face wheather you go with csla (or any object oriented app) or with a non object oriented app.<br>How else would you do it?<br><br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdrianE replied on Tuesday, May 16, 2006</h2>Andrés,<br>&nbsp; The joins are not necessary if you apply the lazy loading since when you load the child object, it receives its Id so it only loads itself from it’s table without joins.<br>Here’s an example:<br>SELECT * FROM Customer WHERE IdCustomer = 4<br>(loads Customer data (without children data))<br>When the City’s name property is accessed it executes:<br>SELECT * FROM City WHERE IdCity = 25<br>(where the IdCity was obtained on the first SELECT because it’s part of the Customer data)<br>In this way I didn’t make any joins as opposed to:<br>SELECT * FROM Customer INNER JOIN City ON …. WHERE IdCustomer = 4<br>Which would have been needed to load the Customer and City data whit only one stored procedure call.<br><br>Adrián<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, May 16, 2006</h2>I see your point, but if you're lazy loading you would probably want to go with the joins anyway, since if the user requests the country information, and you have separate city and province objects, you'd need to load the city first, then the province and finally the country... You will end up writing a lot of code checking for nulls, you will make unnecesary db calls and it will make you wish you've done the joins in the first place <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br>Just my 2 cents<br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdrianE replied on Tuesday, May 16, 2006</h2>Andrés,<br>&nbsp; I understand what you mean and that was my first thought but look how it starts to grow (and just for simple entities)<br><br>[dbo].[Contacto] <br>INNER JOIN [dbo].[TipoContacto] ON [dbo].[TipoContacto].[IdTipoContacto] = [dbo].[Contacto].[IdTipoContacto]<br>INNER JOIN [dbo].[Domicilio] ON [dbo].[Domicilio].[IdDomicilio] = [dbo].[Contacto].[IdDomicilio]<br>INNER JOIN [dbo].[Ciudad] ON [dbo].[Ciudad].[IdCiudad] = [dbo].[Domicilio].[IdCiudad]<br>INNER JOIN [dbo].[Provincia] ON [dbo].[Provincia].[IdProvincia] = [dbo].[Ciudad].[IdProvincia]<br>INNER JOIN [dbo].[Pais] ON [dbo].[Pais].[IdPais] = [dbo].[Provincia].[IdPais]<br><br><br>It starts to be pretty unmanageable, think about an Invoice that has a customer that has a city that has a ...<br><br>Adrián<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, May 16, 2006</h2>I'm not sure if this is an option for you, but perhaps you could create a view, and do your select from that view?<br><br>I've done that when joins would have become too complex, its worked pretty well.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, May 16, 2006</h2>Adrian,<br><br>El problema es que tenés una jerarquía muy profunda! (oops, sorry!)<br><br>You should try flattening your hierarchy. It's usually not a good idea to have such a deep object model and it's generally not even neccesary.<br>Try revising your use cases! It get's hairy when you go further than grandchildren.<br>I usually avoid going further than child objects. Grand children already make it complex.<br><br>Besides you wouldn't want to edit your customer information from withing an invoice. You'd open a customer object.<br>You wouldn't want to edit a city from a customer either, you create a city root...<br>The fact is that you're just displaying information that affects the customer.<br><br>I'd go for a client object that has a child collection of addresses that displays has an address and a city value (it's id and / or description). It doesn't have to know anything about province and country. That's just data you can use to filter the list cities so that the user can pick one and it usually is more of a ui problem (in most cases). Your object only has to worry about taking a valid city. You can also have read only province and country fields if you find it convenient.<br><br>Again, that's just the way _I_ would do it. Some may disagree. <br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Wednesday, May 17, 2006</h2><P><FONT face=Arial size=2>I'm going to agree with Andres and repeat the often quoted mantra "<STRONG><EM>objects are defined by behaviour not data</EM></STRONG>".</FONT></P>
<P><FONT face=Arial size=2>What is it you're trying to do with your Customer object?&nbsp; Just view it?&nbsp; Edit it?</FONT></P>
<P><FONT face=Arial size=2>Perhaps you need two versions of your Customer object, an Editable one and a Read-Only one?</FONT></P>
<P><FONT face=Arial size=2>Do you really trying to embed a whole "Country" object inside your "Customer" object?&nbsp; </FONT></P>
<P><FONT face=Arial size=2>Perhaps you want a Country object for editing the countries in your application.&nbsp; And a Customer object which exposes a CountryName property, which is the name of the country the customer is in.&nbsp; And a NameValueList of Country objects which can be used in your "Edit Customer"&nbsp; form to allow the customer to be linked to the right Country.</FONT></P>
<P><FONT face=Arial size=2>The choice depends on what your business requirements dictate.</FONT></P>
<P><FONT face=Arial size=2>HTH</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
