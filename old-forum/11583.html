<html><header><title>multiple fetches possible?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>multiple fetches possible?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11583.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm posted on Tuesday, September 18, 2012</h2><p>
 
  Normal
  0
  
  
  
  
  false
  false
  false
  
  EN-US
  X-NONE
  X-NONE
  
   
   
   
   
   
   
   
   
   
   
   
  
  MicrosoftInternetExplorer4
  
   
   
   
   
   
   
   
   
   
   
   
  
</p>
<p>
 
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
 



<p class="MsoNormal">Hi all,</p>
<p class="MsoNormal">I am working on a project using CSLA generated by codesmith
and due to project considerations we will be re-generating quite often throughout
the lifetime of the project.</p>
<p class="MsoNormal">Due to these considerations, I am running into a situation
where I want to add my own fetch method in the business object but also want to
keep the generated one.<span style="mso-spacerun:yes;">&nbsp; </span>I would just
like to be able to give my custom written fetch a different name, or optionally
add parameters to change the method signature (I am guessing that wouldn&rsquo;t work
due to serialization concerns), just so I can call multiple implementations of
fetch.</p>
<p class="MsoNormal">It seems like having multiple implementations of fetch side
by side should be something easy to do but I can&rsquo;t find anything on it.<span style="mso-spacerun:yes;">&nbsp; </span>Does anyone have any feedback on this?</p>
<p class="MsoNormal">Just to point out: I do understand you can have multiple implementations
of fetch all with different criteria, but in most of the scenarios we are going
to be handling I don&rsquo;t need/want different criteria and feel that creating
another class just to get a different method signature seems like a very
undesirable way to make a method call.</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, September 18, 2012</h2><p>Why do you need different inplementation of Fetch? UnitTesting/IntegrationTests?&nbsp;</p>
<p>Simplest way is to use DataPortal_Fetch(object criteria) and&nbsp;</p>
<p>
<ul>
<li>check which type of criteria object&nbsp;</li>
<li>extend/subclass criteria object with additional properties&nbsp;</li>
</ul>
</p>
<p>so that your DataPortal_Fetch will know how to handle fetch.</p>
<p>For unit tests/integration tests you could also opt for Repository pattern and inject<br /><span>the actual data access implementation with an IOC container.&nbsp;</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm replied on Tuesday, September 18, 2012</h2><p>Hi Jonny, thanks for the reply.&nbsp; I don&#39;t want multiple fetch methods for unit testing.&nbsp; I want a custom alternative fetch, similar to how many api&#39;s have overloaded method signatures and/or methods named very similarly, and, while they may have the same return type they are used in different circumstances.</p>
<p>Is there no way to implement multiple fetches?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, September 18, 2012</h2><p>My recommendation is to use different Criteria objects.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm replied on Wednesday, September 19, 2012</h2><p>Hi Jonny,</p>
<p>Thanks again for the reply.&nbsp; I went to add some parameters to the criteria, and if I add a List&lt;String&gt; I get a serialization exception.&nbsp; Same if I try to add an object, string array etc.&nbsp; Any ideas on why that may be?&nbsp; Here is the error:</p>
<p>System.Runtime.Serialization.SerializationException: Type &#39;System.String[]&#39; with data contract name &#39;ArrayOfstring:http://schemas.microsoft.com/2003/10/Serialization/Arrays&#39; is not expected. Add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiType(XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle objectTypeHandle, Type objectType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle, Type declaredType)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at WriteSerializationInfo.FieldDataToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )<br />&nbsp;&nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at WriteKeyValueOfstringSerializationInfo.FieldDataOzoZvLrmToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )<br />&nbsp;&nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at WriteArrayOfKeyValueOfstringSerializationInfo.FieldDataOzoZvLrmToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract )<br />&nbsp;&nbsp; at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at WriteSerializationInfoToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )<br />&nbsp;&nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at WriteArrayOfSerializationInfoToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract )<br />&nbsp;&nbsp; at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph)<br />&nbsp;&nbsp; at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.CslaXmlBinaryWriter.Write(Stream serializationStream, List`1 objectData)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(Stream serializationStream, Object graph)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(Object obj)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.BeginFetch(Object criteria, Object userState)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.BeginFetch(Object criteria)<br />&nbsp;&nbsp; at Csla.DataPortal`1.BeginFetch(Object criteria)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>edore replied on Wednesday, September 19, 2012</h2><p>Hi!</p>
<p>I strongly suggest using the &quot;Search this site&quot; textbox at the right hand corner of the forum.&nbsp; As a matter of fact, you&#39;re not the first one to have a probl&egrave;m with serialization.&nbsp; And moreover, buy Rocky&#39;s e-books and read them, they will answer 90% of your questions about basic CSLA usage, you won&#39;t regret it!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm replied on Wednesday, September 19, 2012</h2><p>OK, so I may do a separate post on this since this question has changed a bit, but any help would be much appreciated since right now I am stumped. <br /><br />Edore - yes, I have heard of google and site searches and have the books and have spent quite a bit of time on this issue. If you know something I don&#39;t feel free to help.<br /><br />I figured out by hooking up the CSLA source (4.3.1) that CslaReaderWriterFactory.GetDataContractSerializer adds 4 hardcoded known types into the serializer, allowing WCF to serialize List&lt;int&gt;, byte[], DateTimeOffset and char[] (in addition to primitive types). <br /><br />So if I am understanding this correctly then CSLA can&#39;t serialize anything else other than primitives and those 4 types!? I could add more types to the source and recompile, which I may just do but that seems like the wrong way to do things. Just to test I added string[] and my error went away.<br /><br />I find it hard to believe that what I am understanding is true - can anyone tell me what I am missing? Can you really not use anything other than primitives and the 4 hardcoded types in Criteria objects? I see some web posts about complex criteria and the book even has one, though it uses List&lt;int&gt; (one of the hardcoded KnownTypes) and not List&lt;string&gt;.<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm replied on Wednesday, September 19, 2012</h2><p>Is this problem due to the fact we haven&#39;t gotten around to subclassing the WcfProxy?&nbsp; I just remembered the DataPortal book says you should write your own data portal channel for silverlight.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Thursday, September 20, 2012</h2><p>You should use the lists that CSLA offers. The simplest one is MobileList.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>edore replied on Thursday, September 20, 2012</h2><p>To make it short, the MobileFormatter must already know how to serialize types (which it does for basic types, but List&lt;T&gt; is not one of them).&nbsp; Otherwise, the object must &quot;participate&quot; in the serialization process, as Rocky said in some posts.&nbsp; For the object to participate, you must override some methods on your BO.&nbsp; In the following example I serialize a private backing field :</p>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">protected</span>&nbsp;<span style="COLOR:blue;">override</span>&nbsp;<span style="COLOR:blue;">void</span>&nbsp;OnGetChildren(Csla.Serialization.Mobile.<span style="COLOR:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;Csla.Serialization.Mobile.<span style="COLOR:#2b91af;">MobileFormatter</span>&nbsp;formatter)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">base</span>.OnGetChildren(info,&nbsp;formatter);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serialize(info,&nbsp;formatter,&nbsp;_officeDepartment,&nbsp;OfficeDepartmentPropertyName);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">protected</span>&nbsp;<span style="COLOR:blue;">override</span>&nbsp;<span style="COLOR:blue;">void</span>&nbsp;OnSetChildren(Csla.Serialization.Mobile.<span style="COLOR:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;Csla.Serialization.Mobile.<span style="COLOR:#2b91af;">MobileFormatter</span>&nbsp;formatter)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OfficeDepartment&nbsp;=&nbsp;Deserialize&lt;<span style="COLOR:#2b91af;">OfficeDepartment</span>&gt;(info,&nbsp;formatter,&nbsp;OfficeDepartmentPropertyName);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">base</span>.OnSetChildren(info,&nbsp;formatter);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">where Serialize and Deserialize are implemented as follows, in my own BusinessBase sub-class :</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"><pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;T&nbsp;Deserialize&lt;T&gt;(Csla.Serialization.Mobile.<span style="color:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;Csla.Serialization.Mobile.<span style="color:#2b91af;">MobileFormatter</span>&nbsp;formatter,&nbsp;<span style="color:blue;">string</span>&nbsp;propertyName)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">where</span>&nbsp;T&nbsp;:&nbsp;<span style="color:blue;">class</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(info.Children.ContainsKey(propertyName))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;data&nbsp;=&nbsp;info.Children[propertyName];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;(T)formatter.GetObject(data.ReferenceId);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;T&nbsp;Serialize&lt;T&gt;(Csla.Serialization.Mobile.<span style="color:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;Csla.Serialization.Mobile.<span style="color:#2b91af;">MobileFormatter</span>&nbsp;formatter,&nbsp;T&nbsp;currentValue,&nbsp;<span style="color:blue;">string</span>&nbsp;propertyName)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">where</span>&nbsp;T&nbsp;:&nbsp;<span style="color:blue;">class</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(currentValue&nbsp;!=&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;fieldManager&nbsp;=&nbsp;formatter.SerializeObject(currentValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.AddChild(propertyName,&nbsp;fieldManager.ReferenceId);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>edore replied on Thursday, September 20, 2012</h2><p>You can also declare your property as MobileList&lt;string&gt; as Jonny states, the BO will know how to take care of serialization.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
