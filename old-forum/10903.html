<html><header><title>Clearing dependent property(s) values</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Clearing dependent property(s) values</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10903.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DancesWithBamboo posted on Monday, November 21, 2011</h2><p>I&#39;ve started using 4.2 and am not real familiar yet with the new business rules system. &nbsp;I have a need to &quot;erase&quot; the values in 2 properties when another property changes because they no longer are valid. &nbsp;Is this something that can/should be handled cleanly as a business rule? &nbsp;</p>
<p>Does anyone have an example of setting a dependent property&#39;s value in a rule like this?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>StefanCop replied on Monday, November 21, 2011</h2><p>You cannot clear a property&#39;s value, such that 
FieldManager.FieldExists(p) returns false again. You only can set to a 
&quot;null&quot; value.&nbsp; The post &quot;<a>Is there a way to undefine a field in the FieldManager</a>&quot; explains it. </p>
<p>I found this <a href="http://forums.lhotka.net/forums/p/10843/50598.aspx">http://forums.lhotka.net/forums/p/10843/50598.aspx</a>&nbsp; a nice rule example.&nbsp; The important thing is to add input and output properties in the constructor to the lists:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties.Add(primaryProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties.Add(secondaryProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AffectedProperties.Add(outputProperty);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>and the in the Execute: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var value1 = (decimal)context.InputPropertyValues[primaryProperty];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var value2 = (string)context.InputPropertyValues[secondaryProperty]; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (....)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; context.AddOutValue(outputProperty, null );&nbsp;&nbsp; // raise property changed</p>
<p>or </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  LoadProperty(outputProperty, context.Target, null);&nbsp; // load silently</p>
<p>Here (<a href="http://forums.lhotka.net/forums/p/10308/48295.aspx#48295">http://forums.lhotka.net/forums/p/10308/48295.aspx#48295</a>) is are some facts of AddOutValue, AffectedProperties, and  LoadProperty.</p>
<p>HTH</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, November 21, 2011</h2><p>You should also make sure to set </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanRunAsAffectedProperty = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanRunInCheckRules = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanRunOnServer = false;</p>
<p>So that your rule will only run when either code or user sets the field value. </p>
<p>You cannot clear the entire field value so FieldManager.FieldExistes will return false again (as this would corrupt the Undo / CancelEdit function). </p>
<p>I also recommend the use of AddOutValue as this will notify the UI of changes to the data field. </p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
