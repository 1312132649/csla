<html><header><title>CslaDataSource refresh issue</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataSource refresh issue</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/91.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka posted on Saturday, May 13, 2006</h2><P>As you may have discovered, CslaDataSource (the ASP.NET data source control) doesn't refresh the metadata for business classes when you change your business assembly. At least not without closing and reopening VS 2005.</P>
<P>I've been trying to solve this issue, but I'm stuck. Anyone looking for a seriously geeky challenge? <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P><A href="http://www.lhotka.net/WeBlog/DynamicallyLoadingAssembliesFromShadowDirectories.aspx">http://www.lhotka.net/WeBlog/DynamicallyLoadingAssembliesFromShadowDirectories.aspx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vivus replied on Tuesday, May 16, 2006</h2>this may or may not help you, i know that i was having issues trying to load types from the App_Code folder and i found a bunch of people saying Assembly.Load("App_Code").GetType()... etc.... this didn't work either.&nbsp; <br><br>what i found was a very new but undocumented class&nbsp; BuildManager in the System.Web.Compilation namespace.&nbsp; This guy is supposed to know what is loaded and manages that.&nbsp;&nbsp; <br><br>&nbsp;&nbsp;&nbsp; return BuildManager.GetType(typeName, false, true);&nbsp; <br><br>rather than <br><br>Assembly asm = Assembly.Load(assemblyName);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return asm.GetType(typeName, true, true);<br><br>i'm haven't tested it on other libraries, but i know it helps with using types from the App_Code directory, so it might be smart enough to load the other libraries you need as well.&nbsp; At the the very least, it might get rid of the need to having to name&nbsp; AssemblyName, leaving you to just supplying the full type name.&nbsp; '<br><br>i also added a method to your CslaDataSourceDesigner and tweak some other methods to pass around the base.component which holds the service provider.&nbsp; <br><br>&nbsp;&nbsp;&nbsp; internal static Type GetType(IServiceProvider serviceProvider, string typeName) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ITypeResolutionService service1 = null;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Type type1 = null;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (serviceProvider != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; service1 = (ITypeResolutionService)serviceProvider.GetService(typeof(ITypeResolutionService));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (service1 == null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return null;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; type1 = service1.GetType(typeName, true, true);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } catch (Exception exception1) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; throw new Exception("Can not find type", exception1);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; type1 = null;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return type1;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 18, 2006</h2>




<DIV align=left><SPAN class=073274319-18052006><FONT face=Arial color=#0000ff size=2>Unfortunately the BuildManager doesn't appear to return 
Type objects for referenced assemblies - only those built from App_Code I 
guess.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=073274319-18052006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=073274319-18052006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV>
<DIV align=left>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Friday, May 19, 2006</h2><P>I predict that this problem with CslaDataSource will go away by itself when Microsoft issues the VS2005 SP1.&nbsp; </P>
<P>Rocky, I don't know if you have had to work with Windows Forms Designer much in VS2005, but I am finding it pure hell. To me the etiology of both appears to be the same and both need fixing - soon. </P>
<P>I converted my working app to Csla 2.0 and I can run it and open most of its forms and do useful work in them.&nbsp; But in the Windows Forms Designer, it is a miracle if I can open an existing&nbsp;UserControl without a full screen message with about&nbsp;the same unhelpful language telling me that the designer cannot open the control.&nbsp; Yesterday, the message in every case told me it was looking for one of my assemblies with a version number that I could find nowhere in my Solution. (The version it was seeking was actually higher than any that I have in my solution)&nbsp; It felt like some reference was sticking somewhere like a wad of bubblegum to the shoe.</P>
<P>I removed every one of&nbsp;my project references and everytime the Build proceeded without error and the program ran fine, but there was no way I could get the designer to work.&nbsp; The only way I could make it work was to delete every bin and obj folder from the Solution.&nbsp; And then it worked for about an hour and I was back in the same hell with some different Control.</P>
<P>I am wondering if MS recently hired some programmer from Sun Microsystems - surely somebody's trying to sabotage'm from the inside.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 19, 2006</h2>




<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2>Jav, I've spent a lot of time working with the Windows 
Forms designer and it is far from perfect...</FONT></SPAN></DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2>However, I have found that upgraded forms (from 2003) are 
very unreliable, while new forms created in 2005 work far better. Just this past 
week, while at VS Live, I had to rebuild one of my demos. It had been working 
fine for weeks and then failed for no apparent reason. But it was a 
2003-&gt;2005 upgrade and I think ultimately that was the cause of the 
problem.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2>I agree - hopefully SP1 will fix most of these 
issues!</FONT></SPAN></DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=010290814-19052006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV>
<DIV align=left><FONT face=Arial color=#0000ff size=2></FONT>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Friday, May 19, 2006</h2><P>I posted about my troubles with Windows Forms on MS NewsGroups.&nbsp; Here is a response that I got.&nbsp; I think it is interesting since it also talks about having to restart VS.</P>
<P>&gt;&gt;&gt; ..... Also, if you are using <BR>the new object binding, it may be that you re-built your object store after <BR>the last build of the user control. <EM><STRONG>The winform object binding hard-codes <BR>the version number for the objects. If you rebuild the business layer, the <BR>version number is not updated until you close and re-open VS. (royal pain <BR>at times)</STRONG></EM>.<BR>Jim Wooley<BR><A class=WNAnc href="http://devauthority.com/blogs/jwooley/default.aspx" target=winout>http://devauthority.com/blogs/jwooley/default.aspx</A><BR>&lt;&lt;&lt;</P>
<P>That makes a lot of sense because my problems with WinForms designer also improve a whole lot if I close the VS and then re-open it.&nbsp; Waiting for SP1.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dnorth replied on Tuesday, May 23, 2006</h2><P>Jav,</P>
<P>I don't know if this will help you or not - we were experiencing similar problems in the Form Designer in VS.NET 2005:</P>
<P><FONT color=#333333><A href="http://support.microsoft.com/kb/912019/en-us">http://support.microsoft.com/kb/912019/en-us</A></FONT></P>
<DIV><SPAN>
<DIV class=O><SPAN>4</SPAN></DIV>
<DIV class=O><FONT size=3></FONT>&nbsp;</DIV></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, May 23, 2006</h2><P>Thank you - I would certainly try it.&nbsp; I do hope MS will issue the SP1 soon.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vivus replied on Sunday, May 21, 2006</h2>any referenced assembly in the web.config which is whatever reference you add to your web project through VS 2005.<br><br>though i think the 2nd method is what you are really looking for, its a static GetType method used for designer classes.&nbsp; You'll need to pass&nbsp; around an IComponent that comes from the base.component of your CslaDataSourceDesigner to the object schema.&nbsp; that way you can pass IComponent.Site to the method.&nbsp; <br><br>I'll play around with it more once i have some time to breathe, to verify if this is really what you need<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
