<html><header><title>Calls to update child objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Calls to update child objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7451.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB posted on Thursday, August 13, 2009</h2><font size="2">I have a question regarding the updating of child objects. I've done it a certain way and it's been working fine but while browse some of the old (3.0.4) Project Tracker code I noticed that it was different than what I am doing. Just wanted to get some feedback from the group.<br><br><b>My Current Config:</b><br>- Csla 3.0.4<br>- Ported the connection manager from newer version of Csla<br><br><b>Current Code:</b><br>Protected Overrides Sub DataPortal_Update()<br>&nbsp;&nbsp;&nbsp; If Me.IsDirty Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using pConn As ConnectionManager(Of SqlConnection) = ConnectionManager(Of SqlConnection).GetManager(DSConfiguration.DataConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using pCmd As SqlCommand = pConn.Connection.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With pCmd<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandText = "[Some Proc]"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ExecuteNonQuery()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span> _ChildObject.Update()</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; MarkOld()<br>End Sub<br><br><br><b>Project Tracker Code - Csla 3.0.4<br>Method #1</b><br>Protected Overrides Sub DataPortal_Insert()<br>&nbsp; Using cn As New SqlConnection(Database.PTrackerConnection)<br>&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.LocalContext("cn") = cn<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With cm<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandText = "addResource"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Parameters.AddWithValue("@lastName", mLastName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Parameters.Add(param)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ExecuteNonQuery()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' update child objects<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span> mAssignments.Update(Me)&nbsp;&nbsp; </span>&nbsp;<br>&nbsp; End Using<br>End Sub<br><br><b>Method #2</b><br>Protected Overrides Sub DataPortal_Insert()<br>&nbsp; Using cn As New SqlConnection(Database.PTrackerConnection)<br>&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "addProject"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DoInsertUpdate(cm)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp; End Using<br><br>&nbsp; ' update child objects<br>&nbsp; <span>mResources.Update(Me)</span><br>End Sub<br><br><br>As you can see from the old PT code, calls to the child update are being called both in and outside of the Using block for the connection.<br><br>My question is this. Given my code at the top and using the ConnectionManager, does it matter where I call to update my child objects? My thought process that is if I move the call outside of the Using for the connection then that connection would get disposed and a new connection would be created on the child update. If left where it is now, the ConnectionManager would "reuse" the existing connection.<br><br>Thoughts?</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 13, 2009</h2><P>You are looking at ProjectTracker code that isn't using ConnectionManager, so the coding style is different.</P>
<P>If you are using ConnectionManager, then all data access must be within the root object's using block or you won't get the benefit of the ConnectionManager behavior.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Thursday, August 13, 2009</h2>That makes sense but I just wanted to make sure.<br><br>Thanks<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
