<html><header><title>Validation rules vs read only authorization rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation rules vs read only authorization rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/265.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TEK posted on Sunday, June 04, 2006</h2><P>How do you validate fields that you do not have read access to?</P>
<P>One example (actual) is handling of password fields.<BR>No user should ever be allowed to read a password. However, there is likely to be a business rule that defines that a password must be no longer than 10 characters long, or minimum 5 characters long or some other rules.</P>
<P>However, when the rule tries to gain access to the password string, it's denied access and the whole operation fails.</P>
<P>I guess there is several other situations like it, as salary beeing non readable. However, the business layer needs to check the salary to for example ensure that a given raise is within the range allowed by a special role.</P>
<P>One possible solution would be to check the business rules before the value is actually set, but that would trigger order dependency when setting properties and open up a whole new can of worms that I for sure does not want to look into...</P>
<P>Hope someone has a point of view (and preferrable some really nice solution) for this issue.<BR>I'm pritty sure I'm not the first one hitting this one...</P>
<P>Best regards TEK</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Sunday, June 04, 2006</h2>I think you might need to keep those rules within the business object so they can directly access the local fields.&nbsp; That way you can bypass the read authorization.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Sunday, June 04, 2006</h2>Exactly. Another thing you can do, is create your own validation rules and do something like:<br><br>Public Class StringLengthRuleArgs<br>&nbsp;&nbsp;&nbsp; Inherits Csla.ValidationRules.RuleArgs<br><br>&nbsp;&nbsp;&nbsp; Private mValue as String<br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property Value as String<br>&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return mValue<br>&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; Public Sub New (ByVal propertyName as&nbsp; String, ByVal propertyValue as&nbsp; String)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  MyBase.New(propertyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  mValue = propertyValue<br>&nbsp;&nbsp;&nbsp; End Sub<br>End Property<br>End Class<br><br>And then your rule could look something like this:<br><br>Public Shared Function StringLengthRule(ByVal target as object, _<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; e as RuleArgs) as Boolean<br>If Not TypeOf e Is StringLengthRuleArgs Then<br>&nbsp;&nbsp;&nbsp; Throw New ArgumentException("Argument must be of type StringLengthRuleArgs")<br>End If<br>Dim args as StringLengthRuleArgs = DirectCast(e,StringLengthRuleArgs)<br>If args.Value.Trim.Length() &gt; 20 Then<br>&nbsp;&nbsp;&nbsp; e.Description = "Password can't exceed 20 chars"<br>&nbsp;&nbsp;&nbsp; Return False<br>ElseIf args.Value.Trim.Length() &lt; 5 Then<br>&nbsp;&nbsp;&nbsp; e.Description = "Password must be at least 5 chars long"<br>&nbsp;&nbsp;&nbsp; Return False<br>End If<br>Return True<br>End Function<br><br><br><br>Of course, you can extend your rule args to contain min / max value params so that the rule can be useful in other BOs, but I'll leave that to you....<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Sunday, June 04, 2006</h2>I posted that an hour ago, and I was just having breakfast when I realized how completely wrong that is. Sorry, I shouldn't post until I'm really awake :D.<br><br>Anyway, what you can do is similarily to what I posted, pass along the field name and then use reflection to get it just as you would do with the property name.<br><br><br>Public Class StringLengthRuleArgs<br>&nbsp;&nbsp;&nbsp; Inherits Csla.ValidationRules.RuleArgs<br><br>&nbsp;&nbsp;&nbsp; Private mFieldName as String<br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property FieldName as String<br>&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return mFieldName<br>&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property ' (yeah, this was misplaced, too)<br><br>&nbsp;&nbsp;&nbsp; Public Sub New (ByVal propertyName as&nbsp; String, ByVal fieldName as&nbsp; String)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  MyBase.New(propertyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; mFieldName = fieldName<br>&nbsp;&nbsp;&nbsp; End Sub<br>End Class<br><br><br>Anyway, the validation rule would be somewhat similar, but using reflection to get the field's value...<br>Sorry for posting garbage... i really shouldn't post on sunday mornings.. <img src="/emoticons/emotion-12.gif" alt="Angry [:@]" /><br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TEK replied on Sunday, June 04, 2006</h2><P>Thank your both for your replies.</P>
<P>My current solution is "Don't use read only fields" ;-). Leave it to the UI to hide the password.<BR>However, this is of course not something that I'm able to live with on a long term basic.</P>
<P>I will problably target one of the suggested solutions in my system.</P>
<P>But.. for the sake of discussion and interest in the topic, I would like to comment&nbsp;&nbsp;on the suggested solutions, and to throw on a new alternative approch on the fire.</P>
<P>There is two possible solutions so far:<BR>- Keep the validation inside the classes<BR>- Use reflection to bypass the properties and access the fields directly</P>
<P>I think that both these solutions is acceptable and get the job done, but I also think that they&nbsp;are hacks. I guess that using reflection would be the most general solution of the two, as it would be possible to reuse between different classes.<BR>But this means that:<BR>a) You have to be aware of the internal workings of the class to be able to write the rule<BR>b) You have to know what fields that might be set as read only fields and handle them specially<BR>c) You have to be sure that the get property does not alter the internal field value in any way<BR>Concolution for this is that you will problably get a lot of special cases if you for example want to set non-readable fields from configuration files (as discussed in earlier post)</P>
<P>I can also see this problem reappering if you start to prevent user from getting object (CanGetObject() returns false), and then I do not think that any of the suggested solutions will be able to solve the issue.</P>
<P>The idea that I came up with to solve this is to add a quite advanced feature to the system, and in special to authorization and rules handling.<BR>If some part of the code was able to run either without authorization, or run as a system account that always will have full access to all values. That way, whenever your code should peform operations that is internal in the business layer it could run as SYSTEM (or something) and authorization rules would not apply. Business rules could be a candidate for this type of access.</P>
<P>The trick to do this would be how to in a given context switch the user, peform some work, and then switch the user back to the original user.</P>
<P>What do you folks think? Is this a possible way to go, or am I far, far out there?<BR>To complex, to unmanagable, not doable or an briliant idea?</P>
<P>Regards, TEK</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
