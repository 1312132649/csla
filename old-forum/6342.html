<html><header><title>EditableChildList and Validation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditableChildList and Validation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6342.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Thursday, February 05, 2009</h2><P>I have a parent EditableRoot with a EditableChildList. I don't know how I've not noticed before, but I see that BusinessListBase does not have a BrokenRulesCollection Property, but it has a IsValid Property.</P>
<P>How should make my Object design translate broken rules&nbsp;from the children of EditableChildList all the way to the Parent?&nbsp; How is this typically done?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 05, 2009</h2><P>I'm thinking about doing this with a custom rule in the Parent Object. Does anyone have a better (or more conventional) solution?</P>
<P>&nbsp;</P><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> ChildListRules&lt;T&gt;(T target, Csla.Validation.</FONT><FONT color=#2b91af size=2>RuleArgs</FONT><FONT size=2> e) </FONT><FONT color=#0000ff size=2>where</FONT><FONT size=2> T : </FONT><FONT color=#2b91af size=2>MyParent</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (!target._myChildList.IsValid)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>MyParent</FONT><FONT size=2> info </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> target._myChildList)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>BrokenRule</FONT><FONT size=2> rule </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> info.BrokenRulesCollection)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target.BrokenRulesCollection.Add(rule);</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>&nbsp;</P>
<P>If&nbsp;this was appropriate, I would think BrokenRulesCollection would have been designed with a AddRange()... </P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 05, 2009</h2>I see the problem with that solution.&nbsp; Now the Parent doesn't get notified when the EditbleChild Collection changes and doesn't know to check the rule.&nbsp; Anyone?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 05, 2009</h2><P>Ugh, someone please stop if there's a better way to do this:</P>
<P>In order to notify the parent that the rule needs to be checked, I am going to add a ListChangedEventHandler in my parent.&nbsp; The property accessors of the list's children should prevent superfluous calls to this event I think...&nbsp; And the DAL turns off RaiseChangedEvents for the list....</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>this</FONT><FONT size=2><FONT color=#000000>._myChildList.ListChanged+= </FONT></FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;delegate</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> sender, </FONT><FONT color=#2b91af size=2>ListChangedEventArgs</FONT><FONT size=2> e)</FONT><FONT size=2>{this.PropertyHasChanged(</FONT><FONT color=#a31515 size=2>"MyChildList"</FONT><FONT size=2>);};</P></FONT></FONT><FONT size=2></FONT>
<P>Doesn't something like this already exist in the CSLA framework to provide BO Validation for this scenario? Sorry if an obvious answer exists, I just can't find it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 05, 2009</h2>Well, what are you trying to accomplish?&nbsp; Usually children in a collection are displayed in some kind of grid, and the grid handles showing data errors.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 05, 2009</h2><P>I'm trying to accomplish:</P>
<P>A root object that is valid, only if a child (EditableChildList) is valid.&nbsp; If it's not valid, then I need the Parent's BrokenRulesCollection to contain the rule that is broken.</P>
<P>The point, is to make a BO design that abstracts a lot of the work for the UI developer... so that they don't have to manage mutiple BO's and manage the validation separately, instead all validation can be managed from the Parent...</P>
<P>&nbsp;</P>
<P>In regards to my attempt above, unfortunately, it seems that I cannot make this call because BrokenRulesCollection inherits ReadOnlyListBase and cannot perform the .Add(rule):</P><FONT size=2>
<P>BrokenRulesCollection.Add(rule);</P></FONT>
<P><STRONG>Exception:</STRONG> "Insert is an invalid operation"&nbsp; at Csla.Core.ReadOnlyBindingList`1.InsertItem(Int32 index, C item) in C:\dotnet2005\projects\csla3.0.5cs\cslacs\Csla\Core\ReadOnlyBindingList.cs:line 87&nbsp;&nbsp; at System.Collections.ObjectModel.Collection`1.Add(T item)</P>
<P>I've dealt with CSLA for a while now, and would be surprised is this functionality doesn't exist already somewhere, I just don't know where to look.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 05, 2009</h2><P>The reason CSLA work as it does, is that each object is responsible for itself. One object can't be responsible for another object, as that would break encapsulation. So each object maintains its own list of broken rules.</P>
<P>Consider what would happen if the root had 100 decendents (children, grandchildren, etc). The list of broken rules for a root could be dozens or hundreds of items. None of which are about the root. That'd be a total mess.</P>
<P>However, in CSLA 3.5 and higher (I think it was 3.5) you can create your own BrokenRuleCollection objects, and you can copy the data from existing collections into your collection. Basically I provided the base mechanism by which you could create a "master list" of all the broken rules for all the properties of all the objects in an object graph if that made sense to you.</P>
<P>I don't actually DO this, because I'm not convinced it is a good idea. But several people wanted to do things somewhat similar to what you describe, and so I enabled the scenario. You just have to write an internal method in your collection object to build and return the BrokenRulesCollection that combines all the lists of rules from the children in the list.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 05, 2009</h2><P>Cool, thanks for the incredibly insightful response (as usualy). I'm really interested in the encapsulation philosophy and would love to read more about what you're describing.&nbsp; Might you have any articles that you could point me to on the topic that relate to this situation that you recall? I would greatly appreciate any educating I can get.</P>
<P>Thanks a million Rocky!</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
