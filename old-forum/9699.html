<html><header><title>BusinessRules only when condition is met</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessRules only when condition is met</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9699.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Tuesday, November 02, 2010</h2><p>As i didn&#39;t saw a easy way to add a business rule like:<br />&nbsp;- &quot;Required unless is&nbsp;other property is&nbsp;null&quot;&nbsp;<br />&nbsp;- &quot;Required when other property value equals&quot;</p>
<p>I guess that the most common solution would be writing a new Business Rule inheriting from the&nbsp;Required Rule, having another property as a secondary property which will be read and compared with some other value.Or create a business rule when something is a little bit differend. EnddateIsNullOrNotInThePastRule, EnddateIsInThePastRule</p>
<p>For those little differences i created a wrapper business rule that can be around the actual business rule which behavious like a comparer. If .... then execute the actual rule</p>
<p>Is this something that can be taken into Csla itself, maybe in a better (more complete) implementation ?<br /><br /><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;summary&gt;<br /></span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> Business rule condition wrapper to execute an inner rule when condition is met.<br /></span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/summary&gt;<br /></span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">public</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">class</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">ConditionRule</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;T, V&gt; : </span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">BusinessRule<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">where</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> T : </span></span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IBusinessRule<br /></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">{<br /></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; ///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;summary&gt;<br /></span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; ///</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> Creates an instance of the rule.<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;param name=&quot;rule&quot;&gt;</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Rule to execute when condition is met.</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/param&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;param name=&quot;conditionProperty&quot;&gt;</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Condition value property.</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/param&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;param name=&quot;conditionValue&quot;&gt;</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Condition comparer function.</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/param&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">public</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> ConditionRule(</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">PropertyInfo</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;V&gt; conditionProperty, </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">Func</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;V, </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">bool</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">&gt; conditionFunc, T rule)<br />&nbsp;&nbsp;&nbsp; : </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">base</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">(conditionProperty)<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; ConditionProperty = conditionProperty;</span></span></span></p>
<p><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">&nbsp;&nbsp;&nbsp; PrimaryProperty = rule.PrimaryProperty;<br />&nbsp;&nbsp;&nbsp; this.RuleUri = new RuleUri(rule, PrimaryProperty);<br /></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"><br />&nbsp;&nbsp;&nbsp; <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">InputProperties = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">List</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;Csla.Core.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IPropertyInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt; { conditionProperty };</span></span><br />&nbsp;&nbsp;&nbsp; ConditionFunc = conditionFunc;<br />&nbsp;&nbsp;&nbsp; Rule = rule;<br />&nbsp;&nbsp;&nbsp; InputProperties.AddRange(Rule.InputProperties);<br />&nbsp; }<br /><br /></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> The rule to execute when the condition compared true.<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">private</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">IBusinessRule</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> Rule&nbsp;{ </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">get</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">set</span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;font-size:x-small;">; }<br /></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><br /><span style="font-size:x-small;">&nbsp; ///</span></span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"> </span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">/// </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Condition function to execute the comparisation.<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">private</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">Func</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;V, </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">bool</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&gt; ConditionFunc { </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">get</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">set</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">; }<br /><br /></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; ///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;summary&gt;<br /></span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; /// </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Rule implementation.<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/summary&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">///</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"> </span></span></span><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;param name=&quot;context&quot;&gt;</span></span></span><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">Rule context.</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&lt;/param&gt;<br />&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">protected</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">override</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">void</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> Execute(</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">RuleContext </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">context)<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">var </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">value = (V)context.InputPropertyValues[ConditionProperty];<br />&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">if </span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">(ConditionFunc(value))<br />&nbsp;&nbsp;&nbsp; </span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rule.Execute(context);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br />}<br /><br /><span style="font-family:Arial;">using it like this</span>:<br /></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><br /><span style="font-size:x-small;">protected</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">override</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">void</span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;font-size:x-small;"> AddBusinessRules()<br />{<br />&nbsp; </span></span></span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;"><span style="font-family:Consolas;color:#008000;">// RejectReason is required when IsRejected is true</span></span></span><br />&nbsp; <span style="font-family:Consolas;"><span style="font-family:Consolas;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">ConditionRule</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">Required</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">, </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">bool</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">&gt;(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsRejectedProperty, (p) =&gt; p == </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">true</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">,<br /></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">Required</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">(RejectReasonProperty)));<br /><br />&nbsp; </span></span><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">// When enddate is not null it should not be in the past<br />&nbsp; </span></span></span></span></span></span></span></span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ConditionRule</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsDateNotInThePastRule</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DateTime</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">?&gt;(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EnddateProperty, (p) =&gt; p != </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">null</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsDateNotInThePastRule</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(EinddatumProperty)));<br /></span></span>} </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>t.kehl replied on Tuesday, November 02, 2010</h2><p>Hi rfcdejong</p>
<p>I have tried this. But there is a problem:</p>
<p>In the Execute of the ConditionRule you call Execute of the InnerRule with the Context of the ConditionRule. Now, for example the Required-Rule reads the InputValueProperty out of the Context - but this Property is not in this context. Do you see, what I mean?</p>
<p>Best Regards, Thomas</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, November 02, 2010</h2><p>In all essence - we are here looking at a rule with <b>RuleChaining</b>.</p>
<p>There is a couple of lines missing (bugs)&nbsp; in that code:</p>
<p>1. Code must add InputProperties from the inner rule in constructor. </p>
<p><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">public</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> ConditionRule(</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">PropertyInfo</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;V&gt; conditionProperty, </span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">Func</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;">&lt;V, </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">bool</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">&gt; conditionFunc, T rule)<br />&nbsp;&nbsp;&nbsp; : </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">base</span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">(conditionProperty)<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">InputProperties = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">List</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;Csla.Core.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IPropertyInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt; { conditionProperty };</span></span><br />&nbsp;&nbsp;&nbsp; ConditionFunc = conditionFunc;<br />&nbsp;&nbsp;&nbsp; Rule = rule;<br /><b>&nbsp;&nbsp;&nbsp; InputProperties.AddRange(Rule.InputProperties);</b></span></span></span></p>
<p><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">&nbsp; }</span></span></span></p>
<p>2. Execute must use GetChainedContext:</p>
<p><span style="font-size:x-small;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;"><span style="font-family:Consolas;color:#808080;">&nbsp; </span></span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">protected</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">override</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">void</span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"> Execute(</span></span><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;"><span style="font-family:Consolas;color:#2b91af;">RuleContext </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">context)<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">var </span></span></span></span><span style="font-size:x-small;"><span style="font-family:Consolas;"><span style="font-family:Consolas;">value = (V)context.InputPropertyValues[PrimaryProperty];<br />&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;"><span style="font-family:Consolas;color:#0000ff;">if </span></span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">(ConditionFunc(value))<br />&nbsp;&nbsp;&nbsp; </span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">{<br /><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rule.Execute(context.GetChainedContext(Rule));</b><br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }</span></span></span></span></span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Wednesday, November 03, 2010</h2><p>Thomas, yes, i see what u mean.. It&#39;s one of the reasons i post this here and i see Jhonny saw the bugs.<br />I&#39;m going to adjust my code and impliment it further.</p>
<p>I changed the line of adding inputproperty&#39;s to:<br /><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><br />&nbsp; InputProperties.AddRange(Rule.InputProperties.Where(x =&gt; !InputProperties.Contains(x)));<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span></span></span></p>
<p>This way a duplicate InputProperty won&#39;t cause an exception in method BusinessRules.RunRules at line 520 adding the property item twice in the values dictionary.<br /><br /><br />Jhonny, do u think something like this should be in Csla or perhaps CslaContrib ?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, November 03, 2010</h2><p>Hi, </p>
<p>I&#39;d love to see this kind of contributions going into CslaContrib.&nbsp; We need more activity and contributions going into CslaContrib and Rules is definitely one new area we should be able to share code.</p>
<p>Rocky is in charge for what goes into CSLA or not so that&#39;s his call</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
