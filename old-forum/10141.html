<html><header><title>4.1 rules system, room for improvement?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>4.1 rules system, room for improvement?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10141.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina posted on Tuesday, March 08, 2011</h2><p>I&#39;m migrating a very large commercial app from csla circa 1.x to 4.1.&nbsp; By far and away the biggest time consumer in porting is the new rules system.&nbsp; </p>
<p>I expected that but when all is said and done and unit tested the lengths I&#39;ve had to go to implement what used to be incredibly simple single lines of code is disheartening.&nbsp; It&#39;s now taking many entire classes of custom rules just to replace a line or two of the old rules.</p>
<p>Sadly not just a few lines of simple code but a large swath of completely new code that is a lot of plumbing just to get access to the other properties in the Async rules execute method.</p>
<p>A large commercial, complex app needs a *lot* of rules.&nbsp; There are the simple standard required and maxlength type rules which of course there are thousands and though we can&#39;t use the built in common rules because of the strange decision to include default error messages with no way of specifying our own they are at least simple and straightforward to implement and highly reusable.</p>
<p>But there are also a very large number of highly complex rules that involve multiple properties, possible database calls etc.&nbsp;&nbsp; </p>
<p>Over the years the CSLA powers that be have quite clearly come to see how crucial these are to a large app but I&#39;m not so sure that those same powers have actually had to write a large complex app with hundreds of custom async rules depending on multiple properties in the business object because they are a big hassle to implement.</p>
<p>It wouldn&#39;t be too bad if it were simple to make these custom rules but the tortuous code needed to have access to multiple properties in an async rule is time consuming and error prone.&nbsp; Surely there is a better way?</p>
<p>I&#39;m sure there&#39;s some considerations I&#39;m missing but I hope the rules aren&#39;t considered &quot;done&quot; and can be gone over again to see if there are any areas for improvement in coding time with making custom rules.&nbsp; </p>
<p>Right now I can forsee making a CSLA based app of any complexity is going to be more about writing rules than anything else.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Tuesday, March 08, 2011</h2><p>I&#39;ve also experienced some confusion and frustration in writing rules in 4.1 too - and I have the &quot;Using CSLA 4.1 book&quot;. There is definitely some clarification needed.</p>
<p>However, I wonder if you could provide some code examples - maybe that would help Rocky and others see what you&#39;re talking about and thus find some solution.</p>
<p>Cheers...</p>
<p>Craig</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, March 08, 2011</h2><p>I have the Ebook and all the samples and it&#39;s been a real pain to get to the bottom of it but in some ways that is good as you learn more that way, stepping through with a debugger and seeing what&#39;s actually happening on the call stack.</p>
<p>I thought about giving samples but it would take up so much space in the post I thought it would be too much but you&#39;re right it would help for discussion.</p>
<p>Here&#39;s a good example of a low complexity rule from the old version, this rule lives in the setter on the UserType property in my old app:</p>
<p>&nbsp;BrokenRules.Assert(&quot;ClientIDInvalid&quot;, &quot;Error.Object.RequiredFieldEmpty,O.Client&quot;, &quot;ClientID&quot;, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (mUserType== UserTypes.Client &amp;&amp; mClientID==Guid.Empty));</p>
<p><br />Note that it must reference another property and does so easily and simply.&nbsp;&nbsp;</p>
<p>Here is the same rule ported to 4.1:</p>
<p>//User of type client needs a client ID<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public class SettingUserTypeToClientLoginTypeRequiresAClientIdRule : Csla.Rules.BusinessRule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Csla.Core.IPropertyInfo mUserTypeProperty { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public SettingUserTypeToClientLoginTypeRequiresAClientIdRule(Csla.Core.IPropertyInfo primaryProperty,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Core.IPropertyInfo userTypeProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mUserTypeProperty = userTypeProperty;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;Csla.Core.IPropertyInfo&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties.Add(PrimaryProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties.Add(userTypeProperty);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute(Csla.Rules.RuleContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var usertype = (UserTypes)context.InputPropertyValues[mUserTypeProperty];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var clientid = (Guid)context.InputPropertyValues[PrimaryProperty];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (usertype == UserTypes.Client)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (clientid==Guid.Empty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(&quot;Error.Object.RequiredFieldEmpty&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }//EOC</p>
<p>&nbsp;</p>
<p>It seems simple enough but it&#39;s a custom rule and there are hundreds that depend on certain logic that can&#39;t be made generic.&nbsp; Note the difficulty of accessing the dependent property.&nbsp; This is a simple rule I&#39;ve used to save space here, I have many others with 5 or 6 co properties that are required to make rule decisions and many that have to call other business objects and so need to be Async with it&#39;s added complexity.&nbsp; One thing that would really make life easier is some way to async access the data from other properties without all that redundancy.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, March 08, 2011</h2><p>I guess I should also point out that <em>synchronous</em> rules aren&#39;t subject to nearly the same limitations as async rules. My previous post is all about async, but while I was typing that, you posted a sync rule.</p>
<p>Sync rules <em>can</em> use the same coding structure as async rules. And I usually do use the same structure for consistency. But they surely don&#39;t have to.</p>
<p>Most notably, they can use the context.Target property to directly interact with the business object. </p>
<p>I recommend you use the protected ReadProperty and LoadProperty methods from the BusinessRule base class to safely bypass property checks, but you could also use the BypassPropertyChecks object from Target.</p>
<p>Your original rule implementation doesn&#39;t appear to do this, and that&#39;s a bug in your old code. Your rule could easily run afoul of authorization rules that would cause it to fail...</p>
<p>I guess if you know that you never have authorization rules, you can read property values without fear. But you still can&#39;t update properties in a rule without somehow bypassing rules (and PropertyChanged eventing - or you can get infinite looping).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, March 08, 2011</h2><p>Yeah that rule didn&#39;t need the Async style propery accessors but a great many do, and for consistency I use the Async style and it was a nice short one I could post.</p>
<p>The original rule is from Csla 1.x (I think it was 1.4 or 1.5 when I used it) and that&#39;s how all the rules are done in that app.&nbsp; I don&#39;t recall any other method of doing business rules from csla 1.x unless I missed something big.&nbsp; In any case it hasn&#39;t been a problem in that app.</p>
<p>I realize there are a lot of considerations, I&#39;m not asking you to justify it, I&#39;m just suggesting that it&#39;s very onerous to write those rules by comparison and the actual code to logic being implemented ratio is pretty big which doesn&#39;t pass the sniff test of good practices and after all it really is new business rules method 1.0 so surely there is room for improvement somewhere, maybe outside the box?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, March 08, 2011</h2><p>I think you can write your example rule like this (assuming reuse isn&#39;t possible or desired):</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;[<span style="color:#2b91af;">Serializable</span>]<br />&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">Test</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessBase</span>&lt;<span style="color:#2b91af;">Test</span>&gt;<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:blue;">int</span>&gt;&nbsp;ClientIdProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:blue;">int</span>&gt;(c&nbsp;=&gt;&nbsp;c.ClientId);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">int</span>&nbsp;ClientId<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;GetProperty(ClientIdProperty);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;SetProperty(ClientIdProperty,&nbsp;<span style="color:blue;">value</span>);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:#2b91af;">UserTypes</span>&gt;&nbsp;UserTypeProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:#2b91af;">UserTypes</span>&gt;(c&nbsp;=&gt;&nbsp;c.UserType);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">UserTypes</span>&nbsp;UserType<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;GetProperty(UserTypeProperty);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;SetProperty(UserTypeProperty,&nbsp;<span style="color:blue;">value</span>);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AddBusinessRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.AddBusinessRules();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessRules.AddRule(<span style="color:blue;">new</span>&nbsp;Csla.Rules.CommonRules.<span style="color:#2b91af;">Lambda</span>(ClientIdProperty,&nbsp;(context)&nbsp;=&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;target&nbsp;=&nbsp;(<span style="color:#2b91af;">Test</span>)context.Target;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">using</span>&nbsp;(target.BypassPropertyChecks)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(target.UserType&nbsp;==&nbsp;<span style="color:#2b91af;">UserTypes</span>.Client&nbsp;&amp;&amp;&nbsp;target.ClientId.Equals(<span style="color:#2b91af;">Guid</span>.Empty))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.AddErrorResult(<span style="color:#a31515;">&quot;Error.Object.RequiredFieldEmpty,O.Client&quot;</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">enum</span>&nbsp;<span style="color:#2b91af;">UserTypes</span><br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;None,<br />&nbsp;&nbsp;&nbsp;&nbsp;Client<br />&nbsp;&nbsp;}<br /></pre>
<p>Not quite as concise as the Assert approach, but this uses managed backing fields and so the BypassPropertyChecks is required.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, March 08, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>I think you can write your example rule like this (assuming reuse isn&#39;t possible or desired):</div></p>
<p>Interesting, thanks for posting that I hadn&#39;t thought of doing it that way, perhaps I need to rethink my async style for consistency rule.&nbsp; Maybe it falls under the category of YAGNI.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, March 08, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>JCardina<br></b>Interesting, thanks for posting that I hadn&#39;t thought of doing it that way, perhaps I need to rethink my async style for consistency rule.&nbsp; Maybe it falls under the category of YAGNI.</div></p>
<p>This comes up at my employer too.&nbsp; I think consistency is fine, given all things are equal.&nbsp; Making some tasks harder just for the sake of consistency though is a bad idea.&nbsp; To me, doing the absolute simpliest thing that works will always trump consistency.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, March 08, 2011</h2><p>Consistency in coding has rewarded me so many times over so many years it&#39;s an automatic reaction at this point. :)</p>
<p>However every line of code not written is worth a fair bit of real world money for a small shop like ours.&nbsp; Code not written never breaks and never needs to be maintained, debugged, tested, documented or supported.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, March 08, 2011</h2><p>You did actually miss some intervening behaviors, yes :)</p>
<p>From 2005-2010 there was the model introduced in CSLA .NET 2.1 that was delegate based. I suspect most people used that model over the past 5-6 years because it was actually backed by a rule engine. </p>
<p>The 1.x stuff was really nothing - just a way for you to write entries into the broken rules collection - tons of limitations and drawbacks. We were using an MSN group or something back then, and all the discussion history from 2003-2005 is surely lost. But there were (and are) extremely good reasons why I implemented the 2.1 rule engine.</p>
<p>Likewise, over 5-6 years it became quite clear that the 2.1 model had numerous limitations - not least among them that async and sync rules where entirely different, and that writing a reliable async rule took some serious skill. And the use of delegates was limiting because you can&#39;t inherit, override, compose, or really test those rules.</p>
<p>The CSLA 4 model may require some more code, but its benefits are pretty dramatic - starting with testability, followed by being able to use OOP principles in their implementation, and ending with the high level of consistency between sync and async rule implementations.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, March 08, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>Not quite as concise as the Assert approach, but this uses managed backing fields and so the BypassPropertyChecks is required.</div></p>
<p>No it&#39;s perfect, very elegant solution.&nbsp; I like it and will rethink how I&#39;m going about this.&nbsp; Thanks for taking the time to post that.&nbsp; I knew there were lambda rules but hadn&#39;t considered the implications entirely.</p>
<p>Cheers!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, March 08, 2011</h2><p>Async is complex. Most developers (including me) are unable to casually write async code and get it right.</p>
<p>(btw, the &quot;powers that be&quot; is me - although some awesome contributions have been made by several people over the past few years, the feature set and design decisions in the framework are ultimately my responsibility)</p>
<p>Microsoft created MTS and later COM+ specifically to enable multi-threaded server code, without making normal developers deal with threading.</p>
<p>ASP.NET does the same thing. As does Windows Workflow (WF).</p>
<p>CSLA 4 follows the same conceptual model as WF, though with a very different implementation. When you spin up a workflow in WF, it runs in isolation. It may run on its own thread, but inside the WF there is exactly one thread, and communication between the workflow and anything outside the workflow is serialized (copied) to avoid two threads referencing the same instance of any object.</p>
<p>CSLA 4 does this too, for async rules. CSLA isn&#39;t threadsafe (see this thread: <a href="http://forums.lhotka.net/forums/t/10119.aspx">http://forums.lhotka.net/forums/t/10119.aspx</a>) and can&#39;t do what it does today with data binding and be threadsafe. Because it isn&#39;t threadsafe, you can&#39;t interact with a business object graph with more than one thread at a time. And if the object graph (any part of it) is bound to a UI, you can only interact with it on the UI thread.</p>
<p>At the same time, sometimes rules need to be async. Mostly because they interact with the server asynchronously - at least that is the design goal of the current implementation. Secondarily, they might be async because they implement a long-running algorithm (&quot;long-running&quot; being seconds, not hours or days - that would require a workflow with persistence).</p>
<p>If a rule is running (in whole or part) on a background thread, then it can&#39;t interact with the business object. Or at least I must assume it can&#39;t. The reason I must make this assumption, is that in most cases the object is bound to a UI, so it is <em>absolutely illegal</em> for a background thread to interact with the object. If you try (and you can bypass my protections), you&#39;ll cause cross-thread exceptions from .NET itself.</p>
<p>On the other hand, if you <em>absolutely know for a fact</em> that no other thread will use the object graph while the rule is running, and that the object graph is not bound to a UI, then you can bypass the protections. You can tell the rule to turn on the Target property, and your async rule can interact with the object all it wants - directly reading and setting the object&#39;s properties.</p>
<p>Also, if you <em>absolutely know for a fact</em> that your rule code will only be running in Silverlight, you can bypass the protections. This is because WCF marshals callbacks onto the UI thread for you (in Silverlight). So in reality, even the async callback code is on the UI thread, so it is safe to interact directly with the object&#39;s properties. Clearly, if you go down this road and later use the business classes in WPF or ASP.NET you&#39;d encounter all sorts of nasty cross-threading issues.</p>
<p>The limitations I&#39;m describing here aren&#39;t things I made up for fun. In fact, I wish it could be simpler. But threading and async code is not simple. The best solutions thus far have centered around frameworks or runtimes providing isolation between threads so a developer has a hard time doing the wrong thing. CSLA 4 follows that conceptual model.</p>
<p>We know (based on last year&#39;s Microsoft PDC) that Microsoft intends to provide some nice new threading/async features in the next version of .NET (and the next versions of C# and VB). It is possible (likely) that these new features will simplify the code used to invoke and implement async algorithms.</p>
<p>Even those features don&#39;t eliminate the realities of threading - race conditions, deadlocks, etc. They simplify <em>async</em> quite a lot, by making async code appear to execute in a linear and synchronous manner. So (if the features end up in Silverlight in a timely manner) they&#39;ll be extremely useful for async work. In fact, they&#39;ll fundamentally alter the way things like the async data portal (and therefore async rules) operate.</p>
<p>But they won&#39;t really simplify true threading code. The basic rules of isolation remain intact - multiple threads interacting with any shared object or value must either be avoided, or the object/value must be carefully wrapped with locking structures.</p>
<p>What does all this mean?</p>
<p>It means that somewhere in the next few years, as these new async runtime/language features roll out in .NET, Silverlight, and WP7 (and presumably mono, etc), CSLA version X will be able to take advantage of them. This almost certainly means two things:</p>
<ol>
<li>async code (like the async data portal and rules) will get simpler</li>
<li>async code won&#39;t look or work the way it does today, so you&#39;ll need to update your rules to take advantage of the new capabilties and language keywords</li>
</ol>
<p>I suspect it will have some impact on actual background threading code too - in that it may simplify the invocation and callback handling code. But it is unlikely that it will change the fact that a background thread can&#39;t directly interact with properties on an object bound to a UI.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Tuesday, March 08, 2011</h2><p>I saw your post today, as I saw the post in CslaGenFork forum <a href="http://cslagenfork.codeplex.com/discussions/240643">http://cslagenfork.codeplex.com/discussions/240643</a></p>
<p>I started working on this subject on the spot (it&#39;s Mardi Gras holiday after all). I got back here and found the discussion progressed a lot. Nevertheless I want to have my saying.</p>
<p><div style='padding-left: 50px;background-color:silver'><b>JCardina<br></b> </p>
<p>A large commercial, complex app needs a *lot* of rules.&nbsp; There are the simple standard required and maxlength type rules which of course there are thousands and though we can&#39;t use the built in common rules because of the strange decision to include default error messages with no way of specifying our own they are at least simple and straightforward to implement and highly reusable.</p>
<p></div></p>
<p>&nbsp;</p>
<p>Add your own base CommonBusinessRule abstract class:</p>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Base&nbsp;class&nbsp;used&nbsp;to&nbsp;create&nbsp;common&nbsp;rules.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:blue;">abstract</span>&nbsp;<span style="COLOR:blue;">class</span>&nbsp;<span style="COLOR:darkblue;">CommonBusinessRule</span>&nbsp;:&nbsp;<span style="COLOR:darkblue;">BusinessRule</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Gets&nbsp;or&nbsp;sets&nbsp;the&nbsp;severity&nbsp;for&nbsp;this&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">RuleSeverity</span>&nbsp;<span style="COLOR:purple;">Severity</span>&nbsp;{&nbsp;<span style="COLOR:darkcyan;">get</span>;&nbsp;<span style="COLOR:darkcyan;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Gets&nbsp;or&nbsp;sets&nbsp;the&nbsp;error&nbsp;message&nbsp;for&nbsp;this&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:blue;">string</span>&nbsp;<span style="COLOR:purple;">ErrorMessage</span>&nbsp;{&nbsp;<span style="COLOR:darkcyan;">get</span>;&nbsp;<span style="COLOR:darkcyan;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;primaryProperty&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Primary&nbsp;property.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">CommonBusinessRule</span>(<span style="COLOR:darkblue;">IPropertyInfo</span>&nbsp;primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="COLOR:darkblue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">Severity</span>&nbsp;=&nbsp;<span style="COLOR:darkblue;">RuleSeverity</span>.<span style="COLOR:purple;FONT-WEIGHT:bold;">Error</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;primaryProperty&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Primary&nbsp;property.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;errorMessage&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Error&nbsp;message.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">CommonBusinessRule</span>(<span style="COLOR:darkblue;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="COLOR:blue;">string</span>&nbsp;errorMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="COLOR:darkblue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">ErrorMessage</span>&nbsp;=&nbsp;errorMessage;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">CommonBusinessRule</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">Severity</span>&nbsp;=&nbsp;<span style="COLOR:darkblue;">RuleSeverity</span>.<span style="COLOR:purple;FONT-WEIGHT:bold;">Error</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>Now rewrite some common business rules in order make use the resource string only when you don&#39;t supply an error message.</p>
<p>Example for Required rule</p>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Business&nbsp;rule&nbsp;for&nbsp;a&nbsp;required&nbsp;string.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:blue;">class</span>&nbsp;<span style="COLOR:darkblue;">Required</span>&nbsp;:&nbsp;<span style="COLOR:darkblue;">CommonBusinessRule</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;primaryProperty&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Property&nbsp;to&nbsp;which&nbsp;the&nbsp;rule&nbsp;applies.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">Required</span>(<span style="COLOR:darkblue;">IPropertyInfo</span>&nbsp;primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="COLOR:darkblue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">ErrorMessage</span>&nbsp;=&nbsp;<span style="COLOR:darkblue;">Resources</span>.<span style="COLOR:purple;">StringRequiredRule</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">InputProperties</span>&nbsp;=&nbsp;<span style="COLOR:blue;">new</span>&nbsp;<span style="COLOR:darkblue;">List</span>&lt;<span style="COLOR:darkblue;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;primaryProperty&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Property&nbsp;to&nbsp;which&nbsp;the&nbsp;rule&nbsp;applies.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;errorMessage&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">The&nbsp;error&nbsp;message.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:darkblue;">Required</span>(<span style="COLOR:darkblue;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="COLOR:blue;">string</span>&nbsp;errorMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="COLOR:darkblue;">base</span>(primaryProperty,&nbsp;errorMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:purple;">InputProperties</span>&nbsp;=&nbsp;<span style="COLOR:blue;">new</span>&nbsp;<span style="COLOR:darkblue;">List</span>&lt;<span style="COLOR:darkblue;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;Rule&nbsp;implementation.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:gray;">///</span><span style="COLOR:green;">&nbsp;</span><span style="COLOR:gray;">&lt;param&nbsp;name=</span><span style="COLOR:gray;">&quot;context&quot;</span><span style="COLOR:gray;">&gt;</span><span style="COLOR:green;">Rule&nbsp;context.</span><span style="COLOR:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">protected</span>&nbsp;<span style="COLOR:blue;">override</span>&nbsp;<span style="COLOR:blue;">void</span>&nbsp;<span style="COLOR:darkcyan;">Execute</span>(<span style="COLOR:darkblue;">RuleContext</span>&nbsp;context)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">var</span>&nbsp;value&nbsp;=&nbsp;context.<span style="COLOR:purple;">InputPropertyValues</span>[<span style="COLOR:purple;">PrimaryProperty</span>];
<span style="COLOR:blue;">#if</span>&nbsp;WINDOWS_PHONE
<span style="COLOR:gray;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value&nbsp;==&nbsp;null&nbsp;||&nbsp;string.IsNullOrEmpty(value.ToString()))</span>
<span style="COLOR:blue;">#else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">if</span>&nbsp;(value&nbsp;==&nbsp;<span style="COLOR:blue;">null</span>&nbsp;||&nbsp;<span style="COLOR:blue;">string</span>.<span style="COLOR:darkcyan;">IsNullOrWhiteSpace</span>(value.<span style="COLOR:darkcyan;">ToString</span>()))
<span style="COLOR:blue;">#endif</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">var</span>&nbsp;message&nbsp;=&nbsp;<span style="COLOR:blue;">string</span>.<span style="COLOR:darkcyan;">Format</span>(<span style="COLOR:purple;">ErrorMessage</span>,&nbsp;<span style="COLOR:purple;">PrimaryProperty</span>.<span style="COLOR:purple;">FriendlyName</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.<span style="COLOR:purple;">Results</span>.<span style="COLOR:darkcyan;">Add</span>(<span style="COLOR:blue;">new</span>&nbsp;<span style="COLOR:darkblue;">RuleResult</span>(<span style="COLOR:purple;">RuleName</span>,&nbsp;<span style="COLOR:purple;">PrimaryProperty</span>,&nbsp;message)&nbsp;{&nbsp;<span style="COLOR:purple;">Severity</span>&nbsp;=&nbsp;<span style="COLOR:purple;">Severity</span>&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
</pre>
<p>Example of usage of the new required rule</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">AddBusinessRules</span>()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.<span style="color:darkcyan;">AddBusinessRules</span>();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:purple;">BusinessRules</span>.<span style="color:darkcyan;">AddRule</span>(<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">Required</span>(<span style="color:purple;">DocRefProperty</span>,&nbsp;<span style="color:#a31515;">&quot;I&nbsp;need&nbsp;{0}!&quot;</span>)&nbsp;{<span style="color:purple;">Severity</span>&nbsp;=&nbsp;<span style="color:darkblue;">RuleSeverity</span>.<span style="color:purple;font-weight:bold;">Warning</span>});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:purple;">BusinessRules</span>.<span style="color:darkcyan;">AddRule</span>(<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">Required</span>(<span style="color:purple;">DocDateProperty</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:purple;">BusinessRules</span>.<span style="color:darkcyan;">AddRule</span>(<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">Required</span>(<span style="color:purple;">SubjectProperty</span>));
&nbsp;&nbsp;&nbsp;&nbsp;}
</pre>
<p>Example for an attribute rule</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Business&nbsp;rule&nbsp;for&nbsp;checking&nbsp;a&nbsp;date&nbsp;property&nbsp;is&nbsp;valid&nbsp;and&nbsp;not&nbsp;in&nbsp;the&nbsp;future.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:darkblue;">AttributeUsage</span>(<span style="color:darkblue;">AttributeTargets</span>.<span style="color:purple;font-weight:bold;">Property</span>)]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:darkblue;">DateNotInFutureAttr</span>&nbsp;:&nbsp;<span style="color:darkblue;">ValidationAttribute</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Initializes&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;</span><span style="color:gray;">&lt;see&nbsp;cref=</span><span style="color:gray;">&quot;DateNotInFutureAttr&quot;</span><span style="color:gray;">/&gt;</span><span style="color:green;">&nbsp;class.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:darkblue;">DateNotInFutureAttr</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:darkblue;">base</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:purple;">ErrorMessage</span>&nbsp;=&nbsp;<span style="color:#a31515;">&quot;{0}&nbsp;can&#39;t&nbsp;be&nbsp;in&nbsp;the&nbsp;future.&quot;</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Initializes&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;</span><span style="color:gray;">&lt;see&nbsp;cref=</span><span style="color:gray;">&quot;DateNotInFutureAttr&quot;</span><span style="color:gray;">/&gt;</span><span style="color:green;">&nbsp;class.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;errorMessage&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">The&nbsp;error&nbsp;message.</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:darkblue;">DateNotInFutureAttr</span>(<span style="color:blue;">string</span>&nbsp;errorMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:darkblue;">base</span>(errorMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:purple;">ErrorMessage</span>&nbsp;=&nbsp;errorMessage;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Validation&nbsp;rule&nbsp;implementation.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;value&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">The&nbsp;date&nbsp;to&nbsp;validate.</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;validationContext&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">The&nbsp;context&nbsp;information&nbsp;about&nbsp;the&nbsp;validation&nbsp;operation.</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;returns&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;</span><span style="color:gray;">&lt;see&nbsp;cref=</span><span style="color:gray;">&quot;T:System.ComponentModel.DataAnnotations.ValidationResult&quot;</span><span style="color:gray;">/&gt;</span><span style="color:green;">&nbsp;class.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/returns&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:darkblue;">ValidationResult</span>&nbsp;<span style="color:darkcyan;">IsValid</span>(<span style="color:blue;">object</span>&nbsp;value,&nbsp;<span style="color:darkblue;">ValidationContext</span>&nbsp;validationContext)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;((<span style="color:darkblue;">SmartDate</span>)value&nbsp;<span style="color:darkcyan;">&gt;</span>&nbsp;<span style="color:darkblue;">DateTime</span>.<span style="color:purple;">Now</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;message&nbsp;=&nbsp;(<span style="color:blue;">string</span>.<span style="color:darkcyan;">Format</span>(<span style="color:purple;">ErrorMessage</span>,&nbsp;validationContext.<span style="color:purple;">DisplayName</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">ValidationResult</span>(message);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">try</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;((<span style="color:darkblue;">SmartDate</span>)value&nbsp;<span style="color:darkcyan;">&gt;=</span>&nbsp;<span style="color:darkblue;">DateTime</span>.<span style="color:purple;">MinValue</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">catch</span>&nbsp;(<span style="color:darkblue;">Exception</span>&nbsp;ex)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">ValidationResult</span>(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>.<span style="color:darkcyan;">Format</span>(<span style="color:blue;">string</span>.<span style="color:darkcyan;">Format</span>(<span style="color:#a31515;">&quot;{0}{1}&nbsp;isn&#39;t&nbsp;valid.&quot;</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ex.<span style="color:purple;">Message</span>&nbsp;+&nbsp;<span style="color:darkblue;">Environment</span>.<span style="color:purple;">NewLine</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validationContext.<span style="color:purple;">DisplayName</span>)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>example usage of attribute rule</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Maintains&nbsp;metadata&nbsp;about&nbsp;</span><span style="color:gray;">&lt;see&nbsp;cref=</span><span style="color:gray;">&quot;DocDate&quot;</span><span style="color:gray;">/&gt;</span><span style="color:green;">&nbsp;property.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:darkblue;">PropertyInfo</span>&lt;<span style="color:darkblue;">SmartDate</span>&gt;&nbsp;<span style="color:purple;">DocDateProperty</span>&nbsp;=&nbsp;<span style="color:darkcyan;">RegisterProperty</span>&lt;<span style="color:darkblue;">SmartDate</span>&gt;(p&nbsp;=&gt;&nbsp;p.<span style="color:purple;">DocDate</span>,&nbsp;<span style="color:#a31515;">&quot;Date&nbsp;Doc&quot;</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Gets&nbsp;or&nbsp;sets&nbsp;the&nbsp;Date&nbsp;Doc.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;value&gt;</span><span style="color:green;">The&nbsp;Date&nbsp;Doc.</span><span style="color:gray;">&lt;/value&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:darkblue;">DateNotInFutureAttr</span>(<span style="color:#a31515;">&quot;Please&nbsp;pay&nbsp;attention:&nbsp;{0}&nbsp;can&#39;t&nbsp;be&nbsp;in&nbsp;the&nbsp;future.&quot;</span>)]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;<span style="color:purple;">DocDate</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkcyan;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:darkcyan;">GetPropertyConvert</span>&lt;<span style="color:darkblue;">SmartDate</span>,<span style="color:darkblue;">String</span>&gt;(<span style="color:purple;">DocDateProperty</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkcyan;">set</span>&nbsp;{&nbsp;<span style="color:darkcyan;">SetPropertyConvert</span>&lt;<span style="color:darkblue;">SmartDate</span>,<span style="color:darkblue;">String</span>&gt;(<span style="color:purple;">DocDateProperty</span>,&nbsp;<span style="color:blue;">value</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>&nbsp;</p>
<p>I believe you have a point in that the Csla Rule System 4.1 should include an error message property. As it doesn&#39;t I&#39;m planning&nbsp;to re-write all common rules as for the Required sample above and propose Jonny to include them in CslaContrib</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, March 09, 2011</h2><p>Hi, </p>
<p>You should be aware that your rules as described here will only support one CultureInfo. They will not work properly in a web application that supports several cultures or a Silverlight application that supports several Cultures with at common CSLA serverside DataAccess. </p>
<p>This is because the ErrorString is set in the constructor and that very instance of the rule is common for ALL instances of the class no matter which culture your thread is running. So the current culture when the object is first accessed is the winner. </p>
<p>Consider adding a ErrorMessageDelegate ( a Func&lt;string&gt;) that will be called in ErrorMessage property when the rule executes:</p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;">&nbsp;<br />&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Base&nbsp;class&nbsp;used&nbsp;to&nbsp;create&nbsp;common&nbsp;rules.</span><br />&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">abstract</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">CommonBusinessRule</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessRule</span><br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Gets&nbsp;or&nbsp;sets&nbsp;the&nbsp;severity&nbsp;for&nbsp;this&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2baf9a;">RuleSeverity</span>&nbsp;Severity&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Gets&nbsp;the&nbsp;error&nbsp;message.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;ErrorMessage&nbsp;{&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;ErrorMessageDelegate.Invoke();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Gets&nbsp;or&nbsp;sets&nbsp;the&nbsp;error&nbsp;message&nbsp;function&nbsp;this&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:#2b91af;">Func</span>&lt;<span style="color:blue;">string</span>&gt;&nbsp;ErrorMessageDelegate&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;CommonBusinessRule()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Severity&nbsp;=&nbsp;<span style="color:#2baf9a;">RuleSeverity</span>.Error;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;primaryProperty&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Primary&nbsp;property.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;CommonBusinessRule(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty):&nbsp;<span style="color:blue;">base</span>(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Severity&nbsp;=&nbsp;<span style="color:#2baf9a;">RuleSeverity</span>.Error;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;primaryProperty&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Primary&nbsp;property.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;errorMessageDelegate&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Error&nbsp;message.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;CommonBusinessRule(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:#2b91af;">Func</span>&lt;<span style="color:blue;">string</span>&gt;&nbsp;errorMessageDelegate)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ErrorMessageDelegate&nbsp;=&nbsp;errorMessageDelegate;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />And Required rule like this:<br />&nbsp; <span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Business&nbsp;rule&nbsp;for&nbsp;a&nbsp;required&nbsp;string.</span><br />&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">RequiredRule</span>&nbsp;:&nbsp;<span style="color:#2b91af;">CommonBusinessRule</span><br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;primaryProperty&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Property&nbsp;to&nbsp;which&nbsp;the&nbsp;rule&nbsp;applies.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;RequiredRule(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;set&nbsp;default&nbsp;delegate</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ErrorMessageDelegate&nbsp;=&nbsp;(()&nbsp;=&gt;&nbsp;<span style="color:#2b91af;">Resources</span>.StringRequiredRule);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;rule.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;primaryProperty&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Property&nbsp;to&nbsp;which&nbsp;the&nbsp;rule&nbsp;applies.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;errorMessage&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">The&nbsp;error&nbsp;message.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;RequiredRule(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:#2b91af;">Func</span>&lt;<span style="color:blue;">string</span>&gt;&nbsp;errorMessage)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty,&nbsp;errorMessage)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Rule&nbsp;implementation.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;context&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Rule&nbsp;context.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute(<span style="color:#2b91af;">RuleContext</span>&nbsp;context)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;value&nbsp;=&nbsp;context.InputPropertyValues[PrimaryProperty];<br /><span style="color:#000085;">#if</span>&nbsp;WINDOWS_PHONE<br /><span style="color:gray;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value&nbsp;==&nbsp;null&nbsp;||&nbsp;string.IsNullOrEmpty(value.ToString()))</span><br /><span style="color:#000085;">#else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(value&nbsp;==&nbsp;<span style="color:blue;">null</span>&nbsp;||&nbsp;<span style="color:blue;">string</span>.IsNullOrWhiteSpace(value.ToString()))<br /><span style="color:#000085;">#endif</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;message&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(ErrorMessage,&nbsp;PrimaryProperty.FriendlyName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.Results.Add(<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">RuleResult</span>(RuleName,&nbsp;PrimaryProperty,&nbsp;message)&nbsp;{&nbsp;Severity&nbsp;=&nbsp;Severity&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />Usage of rule: <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">RequiredRule</span>(NameProperty,&nbsp;()&nbsp;=&gt;&nbsp;<span style="color:#2b91af;">Resources</span>.MyRequiredMessage));<br /><br />This will ensure that the proper localized string will always be returned from a resource file. <br /></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Wednesday, March 09, 2011</h2><p>Good point Jonny. Going back to my above example, if I don&#39;t want to use resources and use just a plain string I can use it like this</p>
<pre style="font-size:13px;background:white;color:black;font-family:Consolas;"><span style="color:purple;">BusinessRules</span>.<span style="color:darkcyan;">AddRule</span>(<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">Required</span>(<span style="color:purple;">DocRefProperty</span>,&nbsp;()&nbsp;=&gt;&nbsp;<span style="color:#a31515;">&quot;I&nbsp;need&nbsp;{0}!&quot;</span>)&nbsp;{<span style="color:purple;">Severity</span>&nbsp;=&nbsp;<span style="color:darkblue;">RuleSeverity</span>.<span style="font-weight:bold;color:purple;">Warning</span>});
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Wednesday, March 09, 2011</h2><p>Jonny,</p>
<p>Proposed changes to common rules are on the post.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 02, 2011</h2><p>Hi all,</p>
<p>Just dropping a word to let you know that the changes discussed in this thread were published in <a href="http://cslacontrib.codeplex.com/">CslaContrib</a> changeset #86959 with the comment &quot;Added reimplemented Csla CommonRules that accepts a Func&lt;string&gt; to set a custom ErrorMessage&quot;</p>
<p>Thanks Jonny.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Sunday, June 12, 2011</h2><p>Hey all!</p>
<p>It&#39;s been a while since I posted anything. Anyway, I&#39;m in the process of migrating some old apps, working on some newer code generation, etc, and I found this post while looking for migration topics.</p>
<p>I wanted to share, just for reference, something that&#39;s been really helpful for migrating rules to the new model. I used a lot of lambdas before and I think the ruledelegate approach was pretty good for most cases, and I don&#39;t see why it couldn&#39;t be maintained in a &quot;masked&quot; fashion, such the one shown below, using extension methods (one localizable and one for hard coded strings).</p>
<p>This way, I&#39;ve been migrating rules into a friendlier:</p>
<p>BusinessRules.AddRule(Of
 Invoice)(InvoiceAmountProperty, Function(t) t.InvoiceAmount &gt;= 0, 
&quot;Invoice amount can&#39;t be negative.&quot;)</p>
<p>BusinessRules.AddRule(Of
 Invoice)(InvoiceAmountProperty, Function(t) t.InvoiceAmount &gt;= 0, Function() My.Resources.ruleErrorInvoiceAmount)</p>
<p>&nbsp;</p>
<p>Code:<br />&nbsp;=============================================================<br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension()&gt; _<br />&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal prop As Csla.Core.IPropertyInfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, Boolean),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal description As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim rule As New CommonRules.Lambda(prop,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sub(o)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim target = DirectCast(o.Target, T)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using GetBypassPropertyChecks(target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not ruleHandler(target) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.AddErrorResult(description)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; br.AddRule(rule)<br />&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension()&gt; _<br />&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal prop As Csla.Core.IPropertyInfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, Boolean),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal localizableDescription As Func(Of String))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim rule As New CommonRules.Lambda(prop,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sub(o)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim target = DirectCast(o.Target, T)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using GetBypassPropertyChecks(target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not ruleHandler(target) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.AddErrorResult(localizableDescription())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; br.AddRule(rule)<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp; Private ReadOnly m_BypassPropertyInfo As 
System.Reflection.PropertyInfo = 
GetType(Csla.Core.BusinessBase).GetProperty(&quot;BypassPropertyChecks&quot;, 
BindingFlags.Public Or BindingFlags.NonPublic Or BindingFlags.Instance)<br />
&nbsp;&nbsp;&nbsp; Function GetBypassPropertyChecks(target As Csla.Core.BusinessBase) As IDisposable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DirectCast(m_BypassPropertyInfo.GetValue(target, Nothing), IDisposable)<br />
&nbsp;&nbsp;&nbsp; End Function</p>
<p>=============================================================</p>
<p>&nbsp;</p>
<p>Comments appreciated!</p>
<p>&nbsp;</p>
<p>Cheers!</p>
<p>Andr&eacute;s</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, June 13, 2011</h2><p>Even simpler migration.</p>
<p>Below, there&#39;s an example of how you could write a couple of extension methods that would magically make most of your existing rules work. Of course, this is the most basic example and it could be extended to have severity and the rest of the features, but I think this example will cover the basics and you could extend as needed. All you&#39;d have to do then is run a Find/Replace for Csla.Validation to Csla.Rules. This way you could take your time to port your rules to the new method properly.</p>
<p>I think this should work for most people, but again, comments appreciated.</p>
<p>&nbsp;</p>
<p>First create a Class such as this:</p>
<p>&lt;Serializable()&gt;<br />Public Class RuleArgs<br />&nbsp;&nbsp;&nbsp; Public Property Description() As String<br />End Class</p>
<p>&nbsp;</p>
<p>&lt;System.Runtime.CompilerServices.Extension()&gt; _<br />&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, RuleArgs, Boolean),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal args As RuleArgs,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal prop As Csla.Core.IPropertyInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim rule As New CommonRules.Lambda(prop,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sub(o)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim target = DirectCast(o.Target, T)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using GetBypassPropertyChecks(target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not ruleHandler(target, args) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.AddErrorResult(args.Description) &#39; Select Case for severity here<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; br.AddRule(rule)<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p><br />&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension()&gt; _<br />&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, RuleArgs, Boolean),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal prop As Csla.Core.IPropertyInfo)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddRule(br, ruleHandler, New RuleArgs, prop)<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;</p>
<p>&#39;&#39;&#39;&#39; Overloads for object rules, not that this could take an extra string, for what previously was the &quot;property name&quot;.</p>
<p>&#39;&#39;&#39; This isn&#39;t used anymore, but would make your existing AddRule calls work.</p>
<p>&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension()&gt; _<br />&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, RuleArgs, Boolean),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal args As RuleArgs)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim rule As New CommonRules.Lambda(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sub(o)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim target = DirectCast(o.Target, T)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using GetBypassPropertyChecks(target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not ruleHandler(target, args) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.AddErrorResult(args.Description)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; br.AddRule(rule)<br />&nbsp;&nbsp;&nbsp; End Sub<br /></p>
<p>&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.Extension()&gt; _<br />
&nbsp;&nbsp;&nbsp; Public Sub AddRule(Of T As BusinessBase(Of T))(ByVal br As BusinessRules,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal ruleHandler As Func(Of T, RuleArgs, Boolean))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddRule(br, ruleHandler, New RuleArgs)<br />
&nbsp;&nbsp;&nbsp; End Sub</p>
<p>Private ReadOnly m_BypassPropertyInfo As System.Reflection.PropertyInfo = GetType(Csla.Core.BusinessBase).GetProperty(&quot;BypassPropertyChecks&quot;, BindingFlags.Public Or BindingFlags.NonPublic Or BindingFlags.Instance)<br />&nbsp;&nbsp;&nbsp; Function GetBypassPropertyChecks(target As Csla.Core.BusinessBase) As IDisposable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DirectCast(m_BypassPropertyInfo.GetValue(target, Nothing), IDisposable)<br />&nbsp;&nbsp;&nbsp; End Function</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Andr&eacute;s</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 13, 2011</h2><p>I added this idea to the wish list.</p>
<p><a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=936">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=936</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, June 13, 2011</h2><p>Thank you Rocky. But just to make it clear to others, this could be added into your own project today as it is, without altering Csla.</p>
<p>And even if it is finally added to Csla, it&#39;s unlikely that RuleArgs will get reinstated, so this workaround could still be used to ease the pain of migration (at least partially).</p>
<p>&nbsp;</p>
<p>Andr&eacute;s</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
