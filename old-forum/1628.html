<html><header><title>CSLA and deferred undo</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA and deferred undo</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1628.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>KPrasadKhan posted on Monday, October 30, 2006</h2><P>Hello,</P>
<P>I have been developing business applications for quite a long time. Most of which belong to either the banking industry or insurance industry. Since data security in these applications is of utmost importance, these applications tends to have a maker checker concept to ensure that there is a tight control in master setups. The schem works as follows.</P>
<UL>
<LI>A record when enterd for the first time remains in invalid state. 
<LI>A user can modify it several times and yet the record remains in Invalid state. 
<LI>The checker inspects the data and accepts the changes. Only then the record becomes valid and is made available for use&nbsp;by other masters and or transactions. 
<LI>After a while (say 1 or 2 days, or a week or a month) the user decides to change some data in previously approved master. So he/she edits this record. This forces the record to become Invalid&nbsp;again. Yet the previously approved data remains available for use by rest of the system. The changes made to the data are not visible to rest of the system. 
<LI>The checker agains steps in and accepts the changes. This results in two things. 
<UL>
<LI>Changes being overlayed on to original data and made available to rest of the system. 
<LI>An audit trail gets generated.</LI></UL></LI></UL>
<P>I am not sure whether this kind of requirement is satisfied by the CSLA framework and if yes how.</P>
<P>Regards,</P>
<P><STRONG>Prasad P. Khandekar</STRONG></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Monday, October 30, 2006</h2>Hi,<br><br>The undo capabilities of CSLA or strictly intended for use within the application lifetime. So while users edit an object they can hit escape and 'undo' the edits and revert to the original values.<br><br>The framework does not inherently support undo after an object has been persisted to a DB (at leat not without modification/customization on your part).<br><br>However, giving it a short thought I think it wouldn't be too hard to implement:<br>- create 2 tables in you DB: <br>&nbsp;&nbsp;&nbsp; - one with the yet unchecked modifications that still need to be approved<br>&nbsp;&nbsp;&nbsp; - one with the approved changes<br>- the process of 'making' would create new entries in the former table<br>- the same holds true for modifications made to existing records, this would involve making a copy from the 'approved' table and then storing the modified version in the 'to approve' table<br>- the process of 'checking' would become a specific use-case where a record gets copied to from the former table to the latter<br><br>Disadvantages:<br>- duplicate table structure, thus duplicate maintenance<br>- specific persistency logic (CRUD operations get different interpretations then usual)<br><br>Advantages:<br>- clarity, the not-yet-approved items are isolated in a separate table<br>- the remainder of your relational model will only have relations to the 'approved' table<br><br>Alternative:<br>- add a boolean column which holds the 'checked' (true/false) value. In your CRUD operations you set the value accordingly. The key disadvantage here is that you can never ensure that unchecked records are NOT referenced in relations to other tables.<br><br>Regards,<br>Bayu<br><br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
