<html><header><title>Parent Child Interface Implementation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent Child Interface Implementation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4354.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham posted on Friday, February 15, 2008</h2><P>I&nbsp;submitted this as part of another post thread but I'm thinking maybe I should start my own post thread since I didn't get any feedback/help.&nbsp; Please help!</P>
<P>----------------------------------------------------------------------------------------------</P>
<P>I am trying to do something that seems very similar to this.&nbsp; I am trying to set child authorization (overriding CanWriteProperty) based on parent properties (status).&nbsp; </P>
<P>Here is basic class diagram of my app.</P>
<P><STRONG>Use case one - editing a promotion event</STRONG></P>
<P>Promotional Event (Business Base - Parent)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PromoList (Read-Only Collection)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PromoInfo (Read-Only Child)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PriceList (Business&nbsp;List - Child)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price (Business Base - Child)</P>
<P><STRONG>Use case two - editing a promotion</STRONG></P>
<P>Promo (Business Base - Parent)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PromoProducts (Business List - Child)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PromoProduct (Business Base - Child)</P>
<P>Once my Promotional Event is in submitted or approved status (property of object), I want to set the CanWriteProperty to false for the event and ALL children.&nbsp; How do I implement the interface on the Promotional Event and Price List objects?&nbsp; And, how do I make the Price object see the status?</P>
<P>Further, how do&nbsp;I make the Promo object (from the other use case - but still only exists in the context of a promotional&nbsp;event) see the status and set the CanWriteProperty for itself and it's own children?&nbsp; Is that even possible?</P>
<P>I understand this is also similar to work flow.&nbsp; And, conceptually I understand the theory behind implementing an interface on the parent and the collection and calling a method in the child to use that interface.&nbsp; However, I don't understand how to actually do the code for this.&nbsp; Can somebody please provide a sample of some kind?</P>
<P>Thanks in advance for any help!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SomeGuy replied on Friday, February 15, 2008</h2><P>You could have an internal property on the Child objects that the parent can set when it's status changes. </P>
<P>E</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Friday, February 15, 2008</h2>I realize that.&nbsp; But, I am trying to do proper OO modeling and&nbsp;loose coupling.&nbsp; I am trying not to pass data from object to object when it seems like it can be interfaced.&nbsp; Am I missing something?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 15, 2008</h2>Well, there comes a point IMO when you do need to have some coupling.&nbsp; I think its ok that a set of objects that are to work together to fulfill a use case can be coupled to some extend.&nbsp; So while you could make things more loosely coupled, I think you're just making it more complex than it needs to be.&nbsp; As long as the objects aren't expecting a certain implementation, I don't see anything wrong with collaborating to perform a task.<br><br>Of course, that's just my opinion.. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Friday, February 15, 2008</h2><P>I actually took that approach of passing the event data to the children (collections and objects) and there are alot of children so it got pretty interesting and I'm still not sure I have it right.&nbsp; So, instead, I was hoping all the children could just "ask" the parent it's status to determine there editability.&nbsp; The following comments from Rocky on another post are what I am considering implementing.&nbsp; I just don't understand the specific code implementation.</P>
<P><EM>"I would define an interface that the parent and collection implement, which contains a method the child can call to ask whether the order has been invoiced.<BR><BR>The implementation in the collection would delegate to the root parent, which can answer the question. This does require that your Order object provide the collection with a parent reference upon creation - but that can be easily handled through the collection's Friend/internal factory method.<BR><BR>The end result though, is that the interface provides relative loose coupling, and the child only knows about its immediate parent (the collection), which it already knows about anyway (due to IEditableObject). Note the protected Parent property that already exists for this purpose."</EM></P>
<P>Either way, I can be flexible.&nbsp; I just thought that the interface approach might be considerably simpler.&nbsp; But, since I'm fairly new to OO and especially interfaces, I have no idea how easy or hard it will be and how to actually implement it.</P>
<P>Thoughts?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives replied on Friday, February 15, 2008</h2><P>You can try something like this:</P>
<P>public interface IEventStatus<BR>{<BR>&nbsp;&nbsp;&nbsp; string EventStatus{ get; };<BR>}</P>
<P>In PromotionalEvent, the implementation would be:</P>
<P>public class PromotionalEvent : BusinessBase, IEventStatus<BR>{<BR>&nbsp;&nbsp;&nbsp; private string _status;<BR>&nbsp;&nbsp;&nbsp; public string EventStatus<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _status;<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>In PriceList,</P>
<P>public class PriceList : BusinessListBase, IEventStatus<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp; public string EventStatus<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ((IEventStatus)this.Parent).EventStatus;<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>In Price,</P>
<P>protected override bool CanWriteProperty(string propertyName)<BR>{<BR>&nbsp;&nbsp;&nbsp; if (((IEventStatus)this.Parent).EventStatus == "submitted")<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; return base.CanWriteProperty(propertyName);<BR>}</P>
<P>Does this help?</P>
<P>Tim</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Friday, February 15, 2008</h2><P>Thank you!&nbsp; That is a GREAT start!</P>
<P>Now, a few questions from that.</P>
<P>1)&nbsp; I need to do something to "expose" the parent to the children so that I can use this.Parent, correct?</P>
<P>2)&nbsp; How would I go about using that interface for the Promo object (which in use case two is a parent - but still needs to follow the rules of it's "database" parent, the Promotional Event)?</P>
<P>Thanks again!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives replied on Friday, February 15, 2008</h2><P>1) If you use the managed fields in the 3.5 beta, the parent property is set automatically for you.&nbsp; If you're not using the 3.5 beta, then I think CSLA still sets the Parent property in the Price objects.&nbsp; I think you'll need to set the parent in PriceList programmatically.&nbsp; When you fetch the PriceList collection in&nbsp;PromotionalEvent, you can do something like:</P>
<P>((IEditableCollection)priceList).SetParent(this);</P>
<P>2) Can you load the promotional event status when you fetch the Promo object, or is the status not persisted to the database yet?&nbsp;&nbsp;My guess is that it's not, or you wouldn't be asking this question.&nbsp;&nbsp;If it's a question of passing a value from one&nbsp;object to another where there is no reference between the two, then you might consider using the dictionary exposed by ApplicationContext.LocalContext.&nbsp; That may, however,&nbsp;be inappropriate depending on the circumstances.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Saturday, February 16, 2008</h2><br><blockquote><div><b><span>When you fetch the PriceList collection in&nbsp;PromotionalEvent, you can do something like:</span></b></div><p><b>((IEditableCollection)priceList).SetParent(this);</b></p></blockquote>
<p><span>And besides that, you will need an override of OnDeserialized in PromotionalEvent <br></span></p><p><span>calling ((IEditableCollection)priceList).SetParent(this); as well.</span></p><p><span>Otherwise you won't get the desired behaviour after calling a DataPotal.XYZ method.<br></span></p><p><br><span></span></p><p><span>Stefan</span><br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Monday, February 18, 2008</h2><P>The status is persisted in the database but I was trying to get the value from memory using interfaces (if that's even possible).</P>
<P>What is the dictionary that you refer to?&nbsp; Why would it be inappropriate?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
