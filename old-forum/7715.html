<html><header><title>CSLA for Silverlight - Updating child objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA for Silverlight - Updating child objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7715.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nobby_trussin posted on Thursday, October 01, 2009</h2>Hi, <br /><br />I am developing an 'Edge' application as described in Rocky's CSLA for Silverlight videos whereby my data is retrieved in the local portal (on the Silverlight client).<br /><br />However, due to the asynchronous nature of Silverlight, I am a bit confused as to how child objects are updated when a list is saved. <br /><br />I have a class defined as follows: <br /><br />public class DDList : BusinessListBase<br /><br />I want to be able to call BeginSave() on an instance of the list and have it iterate all its child  objects to save each of them. <br /><br />In CSLA for Windows, the list could just iterate its children one by one and save them individually. How is this done in CSLA for Silverlight? Is there a CSLA pattern for doing this or do I need to manually keep track of which event handlers have fired on the child objects and when all have completed, then fire the completed event on the list?<br /><br />I hope I explained that so it made some kind of sense :)<br /><br />Thanks for your help<br /><br />Dan</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 01, 2009</h2><P>I would hope that the service you are calling accepts all your data in one message - the parent and child data all together. Otherwise the service design seems really flawed - it would perform terribly and could never guarantee any data integrity.</P>
<P>Assuming that's true, then what your client code needs to do is assemble all the data (parent and child) into a single XML document or message object (DTO graph) that you can pass to the service.</P>
<P>The easiest way to do that is to have the DataPortal_Update() method create the root node of the DTO graph, and pass that as a parameter to the child update method.</P>
<P>That way the DTO graph comes into each Child_Insert() and Child_Update() method, and the child object can add its own data to the DTO graph (or XML message).</P>
<P>Once all the objects have had the opportunity to put their data into the DTO graph, the DataPortal_Update() can make one async call to the service to send the data over the wire.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nobby_trussin replied on Friday, October 02, 2009</h2>Hi, <br /><br />Thank you kindly for your reply. Well that's how I started writing the app - passing all the data in one DTO. However, I reached a stumbling block and decided I was doing it wrong - doh!<br /><br />The scenario was as follows:<br /><br />I have a BusinessBase object called Customer which has a child BusinessListBase called DDInfoList which contains DDInfo BusinessBase objects. <br /><br />Lets say I fetched an existing customer from the database and then added 1 new DDInfo item to the DDInfoList and edited one existing DDinfo item. When I assemble a customer DTO, populated with all its child objects, and pass it to the dataservice for persisting, how does the service know which records in the child list to update and which to insert as it has none of the CSLA IsNew functionality?<br /><br />I did consider passing an IsNew flag to the service but then thought that by doing this I was just recreating what CSLA already did and that I was, therefore, going about solving the problem all wrong.<br /><br />Thanks again for your help.<br /><br />Regards<br /><br />Dan</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, October 02, 2009</h2>You are encountering some of the issues that make SOA so darn expensive.<br />I've said for years that the S in SOA is a $, and I wasn't kidding.<br /><br />Defining a good service interface is very important, and if the service<br />allows for batch updates of data (which is what we're talking about here),<br />then the contract needs to somehow incorporate insert/update/delete<br />semantics - or the service must be able to infer which operation to perform<br />(presumably through mystic chants or something?).<br /><br />If you are creating a Silverlight edge app, the architectural model you are<br />using is one where there are (at least) TWO SEPARATE APPS.<br /><br />As you work on the service app, you must NOT THINK ABOUT THE SL CLIENT. You<br />must think about ANY client - the multitude of clients that you'll have over<br />time using your service interface. You need to design the service and the<br />service interface with no specific assumptions about any one client.<br />Instead, remember that you are building an app that just happens to have an<br />XML interface (instead of HTML or whatever). You can't trust any input, and<br />your interface must include enough detail and information so your service<br />can do its job. Which often means including insert/update/delete metadata in<br />the contract.<br /><br />As you work on the client app, you should treat the service much like a set<br />of stored procedures. Ones that are out of your control, and that are<br />maintained by an evil DBA in the basement. Down by the furnace, where you<br />dare not go for fear of being burned. Remember, the service can't change its<br />contract on the whim of any one client, because that'd break all other<br />clients. If the client needs to do more work to overcome a limitation of the<br />service, so be it - that's cheaper than breaking all other clients using the<br />service.<br /><br />Yeah, SOA is pretty complex, and is not cheap. But presumably it has enough<br />long-term benefits that you'll get decent ROI over many years.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
