<html><header><title>Need help with my idea</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need help with my idea</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2266.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele posted on Friday, February 02, 2007</h2><P>As an architect, providing a framework for&nbsp;4 developers at our company, I am ever watchful for&nbsp;code that deviates from the proper patterns...for example, someone trying to access the database without going through the DataPortal.&nbsp; Of course developers mostly develop in the Client/Server all in one environment...so it's easy to be forgetfull and write code that would break in distributed setup.</P>
<P>Testing would catch that...but why not catch it right when it happens on the developer machine?</P>
<P>So this morning I thought "Hey why can't I just check the ApplicationContext.ExecutionLocation in our DataAccessFactory to make sure it says 'Server'".&nbsp; OOPS it is always 'Client' when developing on same machine.&nbsp; Hmmm so I thought "OK if it is 'Client' I will check also check the Application.DataPortalProxy".&nbsp; OOPS it says 'Local' on both sides of the portal.&nbsp; DANGIT!</P>
<P>Can you gents think of a built in way to tell if you are on the other side of the portal regardless of distributed environment or not?</P>
<P>Thanks</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, February 02, 2007</h2><P>Um... change the connection string to point to a database on another machine?</P>
<P>Not as spiff as your original idea, but hey, it's still better than slogging thru the code line by line after the fact!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><P>Interesting idea...something similar would be to force the developers to develop in 3tier mode where they can't hit the database from their machine...but debugging would be horrendous and ultimately hurt production.</P>
<P>What I really need is a flag that says "BeenThroughPortal=True"...this would allow 2 tier development but would catch the bad code right at run-time.</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Friday, February 02, 2007</h2><P>Interesting idea Sean.&nbsp; As you probably know, the whole premise behind Rocky's portal is to <EM>hide</EM> that distinction.</P>
<P>And I'm not sure I fully understand where you'd like to place the check.&nbsp; You could easily enough check to see if there was a DataPortal configured in the app.config,&nbsp; but if I understand correctly you want to make sure some errant developer didn't just write his own ADO.NET code and go to the database directly.&nbsp; That would require having SQL Server be able to check where the&nbsp;connection came from somehow, wouldn't it?&nbsp; What ain't I gettin'?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><P>"but if I understand correctly you want to make sure some errant developer didn't just write his own ADO.NET code and go to the database directly"</P>
<P>Kinda &amp; Kinda Not...Lets see if I can 'splain it better.</P>
<P>If you had a "IHaveBeenThroughThePortal" Property to check then you would know it is safe to make calls that would work in 2 and 3 tier mode.&nbsp; If you think about it, all Rocky's database access code is on one side of the portal because he is careful to write it that way.&nbsp; But if he wasn't you could potentially let code out the door that would have a time bomb set to go off in 3tier mode.</P>
<P>Since&nbsp;my DataAccessFactory is scoped as Friend...it is protected only from public access.&nbsp; But BO developers can too easily&nbsp;forget to go through the portal (Using CommandObject or the like) before calling DAL.&nbsp; Since Friend doesn't protect this from happening at design time...I thought maybe I could devise a way to check at runtime.</P>
<P>So my check for IHaveBeenThroughPortal would happen INSIDE the factory which the BO developers don't touch.&nbsp; All DB access goes through that factory since we use LLBLGen adapter pattern for our DAL.</P>
<P>Sean</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 02, 2007</h2>Sean,<br><br>Is this a problem you are encountering a lot, or just one that concerns you?<br><br>If its the former, I don't think technology is the answer... you have to get your programmers to be more disciplined.&nbsp; Perhaps a code review process, if you don't have one, or you can do random reviews, just to make sure?&nbsp; Going back to technology, perhaps having them start from templates would help?<br><br>If its the latter, I wouldn't worry too much... but you may want to remind&nbsp; your staff on the proper use of the framework occasionally.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>eric.oldre:</strong></div><div>I don't have any experience with code obfuscation, but, what if you marked your dataportal_xxx methods with custom attributes so that you could easily identify them in the stack?<BR><BR>Eric<BR></div></BLOCKQUOTE></P>
<P>That should work Eric.&nbsp; That wouldn't be too hard, although probably with one line in the framework this same thing could be accomplished.&nbsp; I just hate to alter the framework in any way though.&nbsp; So it seems like nobody knows a way that's "Built in" it seems.</P>
<P>&nbsp;</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Sean,<BR><BR>Is this a problem you are encountering a lot, or just one that concerns you?<BR><BR>If its the former, I don't think technology is the answer... you have to get your programmers to be more disciplined.&nbsp; Perhaps a code review process, if you don't have one, or you can do random reviews, just to make sure?&nbsp; Going back to technology, perhaps having them start from templates would help?<BR><BR>If its the latter, I wouldn't worry too much... but you may want to remind&nbsp; your staff on the proper use of the framework occasionally.<BR><BR>HTH<BR>Andy<BR></div></BLOCKQUOTE></P>
<P>Andy,&nbsp; I encountered it once and it scared me because that means it could be elsewhere.&nbsp; I tried to implement code reviews and I was almost burned at the stake!&nbsp; Politics with old-timers who have been here years more than me :-(&nbsp;&nbsp; So, like you suggested, I did as much with templates as possible.&nbsp;&nbsp;But templates cannot generate <EM>all&nbsp;</EM>of your business logic.&nbsp; I tried to lock down as much as possible protecting from the public world...now I am thinking about how to protect from ourselves given the "Real World" limits I am facing politically.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 02, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>swegele:</strong></div><div>Andy,&nbsp; I encountered it once and it scared me because that means it could be elsewhere. </div></BLOCKQUOTE><br><br>A valid concern, for sure.&nbsp; The only way to know for sure is to setup the application from time to time using remoting.&nbsp; You can set this up on a single machine.. perhaps even require each developer machine to operate in remote mode to ensure the code works with a remote dataportal.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>swegele:</strong></div><div>I tried to implement code reviews and I was almost burned at the stake!&nbsp; Politics with old-timers who have been here years more than me :-(&nbsp;&nbsp; </div></BLOCKQUOTE><br><br>That's unfortunate, because its brings some good benefits.&nbsp; Perhaps you can code review with others that believe in the idea, and create some data that shows reviewed code has less bugs or whatnot.&nbsp; <br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>swegele:</strong></div><div>So, like you suggested, I did as much with templates as possible.&nbsp;&nbsp;But templates cannot generate <em>all&nbsp;</em>of your business logic.&nbsp; I tried to lock down as much as possible protecting from the public world...now I am thinking about how to protect from ourselves given the "Real World" limits I am facing politically. </div></BLOCKQUOTE><br><br>No they can't, but the static factory methods on root objects are almost always identical.&nbsp; Unfortunately as you point out, you can't prevent them from putting db code anywhere else.&nbsp;&nbsp; Its too bad that politics is getting in the way of good process.. you'll have to decide if that's a battle you want to fight.<br><br>Good luck!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><P>Rocky's solution of subclassing csla objects and overriding the OnInvoke and OnInvokeComplete methods worked perfectly!</P>
<P>I put the boolean in the Application.Context and test it inside my DataAccessFactory...throws a nice error if they made the mistake.&nbsp; Very smooth.</P>
<P>Here is the subclassed vbcode for anyone coming along later</P><FONT color=#0000ff size=2>
<P>Namespace</FONT><FONT size=2> JTBaseObjects</P>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTBusinessBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> JTBusinessBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T))</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Inherits</FONT><FONT size=2> BusinessBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp; MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P>&nbsp;&nbsp;&nbsp; ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp; MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>&nbsp;&nbsp;&nbsp; ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTBusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> JTBusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T, C), C </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Core.IEditableBusinessObject)</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> BusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T, C)</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTCommandBase</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> Csla.CommandBase</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTReadOnlyBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> JTReadOnlyBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T))</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> ReadOnlyBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTReadOnlyListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> JTReadOnlyListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T, C), C </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.Core.IBusinessObject)</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> ReadOnlyListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T, C)</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' The DataAccessAdapterFactory uses it to not attempt a database hit if someone is accessing it from client side of dataportal</P></FONT><FONT size=2>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> JTEditableRootListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> JTBusinessBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T))</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> EditableRootListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvoke(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvoke(e)</P>
<P></FONT><FONT color=#008000 size=2>'boolean used to track whether the dataportal was called by the client code...this can be used to test</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' whether it is safe to make calls that in 3 tier mode would fail if a businessobject developer didn't follow</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>' design pattern and just called into a friend method and tried to hit the database</P></FONT><FONT size=2>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_OnDataPortalInvokeComplete(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla.DataPortalEventArgs)</P>
<P></FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.DataPortal_OnDataPortalInvokeComplete(e)</P>
<P>ApplicationContext.LocalContext(CONST_THROUGHPORTAL) = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'Chose not to do this one...since I never use it NameValueListBase&lt;K,V&gt;</P></FONT><FONT color=#0000ff size=2>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Namespace</P>
<P>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eric.oldre replied on Friday, February 02, 2007</h2>Ok, I am fairly new to CSLA, so I post my idea here as much so people can correct me if I'm way off. <br><br>Could you do something like Rocky does with the CanReadProperty method and check the stack trace to make sure that there is a DataPortal_XXX method somewhere higher in the trace? This would need to be done in all common functions that would allow a db connection to be created. For instance in the PT Tracker location you would put these checks in the ProjectTracker.Library.Database methods.<br><br>If you check the stack trace and you don't detect that any of the dataportal specific methods are higher in the stack, then throw an Exception.<br><br>I haven't tried this yet myself, but if you get a chance let me know if it solves your issue.<br><br>Eric<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><P>Great "out of the box" thinking...I think that would work in theory</P>
<P>BUT as I understand it that wouldn't work with code obfuscation since the method names would have been changed right?</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eric.oldre replied on Friday, February 02, 2007</h2>I don't have any experience with code obfuscation, but, what if you marked your dataportal_xxx methods with custom attributes so that you could easily identify them in the stack?<br><br>Eric<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, February 02, 2007</h2><P>You can't use obfuscation with CSLA .NET, because it makes use of reflection to do certain operations.</P>
<P>The broader question here, as I understand it, is how to ensure that developers don't make database calls from client-side code. If you follow the CSLA .NET class design patterns this should never be an issue, because <EM>all</EM> the data access code goes in the DataPortal_XYZ methods, or in the internal/Friend data methods of child objects.</P>
<P>Code reviews, potentially even automated ones, can be used to correct anyone putting any data access code in any other method.</P>
<P>It isn't clear to me how having an ApplicationContext.PassedThroughDataPortal would help, because the same code that didn't belong in a client-side method would be written to not do this check. Bad code is bad code. A coder that wants to talk to the database on the client simply won't wrap their data code in the appropriate if..else statement. </P>
<P>Presumably they <EM>know</EM> that they've broken the rules, because their method name isn't DataPortal_XYZ, so they are already conciously cheating.</P>
<P>But here's a quick answer for you, if you want to explore the possibility:</P>
<P>ApplicationContext.LocalContext (version 2.1+) exists purely within the local environment. Also, the data portal calls pre- and post-processing methods before/after calling any DataPortal_XZY method.</P>
<P>If you have your own business base class (which I recommend in any case), you can simply override the pre- and post-processing methods and set something into ApplicationContext.LocalContext to indicate you've "passed through" the data portal. Then just remove it in the post-processing method:</P>
<P>protected override void DataPortal_OnDataPortalInvoke()<BR>{<BR>&nbsp; ApplicationContext.LocalContext["dp_flag"] = true;<BR>}</P>
<P>protected override void DataPortal_OnDataPortalInvokeComplete()<BR>{<BR>&nbsp; ApplicationContext.LocalContext["dp_flag"] = false;<BR>}</P>
<P>You'll want to set this to false as your app starts (on the client) too, so then you can universally check it in your code:</P>
<P>if (ApplicationContext.LocalContext["dp_flag"])<BR>&nbsp; // running inside the data portal</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Friday, February 02, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> 
<P>You can't use obfuscation with CSLA .NET, because it makes use of reflection to do certain operations.</P>
<P></div></BLOCKQUOTE></P>
<P>Good to know the final word on that.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div></P>
<P>The broader question here, as I understand it, is how to ensure that developers don't make database calls from client-side code. If you follow the CSLA .NET class design patterns this should never be an issue, because <EM>all</EM> the data access code goes in the DataPortal_XYZ methods, or in the internal/Friend data methods of child objects.</P>
<P></div></BLOCKQUOTE></P>
<P>Right...it is the Friend methods that concern me.&nbsp; Here is my pattern:</P>
<P><STRONG>On the EditableRoot object here is the DataPortal method</STRONG></P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Criteria)</P>
<P></FONT><FONT color=#0000ff size=2>Using</FONT><FONT size=2> adapter </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDataAccessAdapter = JTDataAccessAdapterFactory.GetNewAdapter</P>
<P>ApplicationContext.LocalContext(CONST_ADAPTER) = adapter</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'do some database stuff here on your parent</FONT><FONT color=#008000 size=2></P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'now call some internal/friend stuff here for children (see below)</FONT></P>
<P><FONT size=2>ApplicationContext.LocalContext.Remove(CONST_ADAPTER)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P><FONT color=#0000ff size=2>
<P><STRONG><FONT color=#000000>Example Code on the&nbsp;Child object</FONT></STRONG></P><FONT size=2></FONT><FONT color=#0000ff size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Friend</FONT><FONT size=2>&nbsp;</FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DoSomehtingHereWithChild()</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> adapter </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDataAccessAdapter = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(ApplicationContext.LocalContext(CONST_ADAPTER), IDataAccessAdapter)</P>
<P>adapter.DoSomething</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></FONT></FONT>
<P>You can see that a developer might inadvertantly call the method not realizing they forgot to call the parents dataportal.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div></P>
<P>Code reviews, potentially even automated ones, can be used to correct anyone putting any data access code in any other method.</P>
<P></div></BLOCKQUOTE></P>
<P>Ugh I agree...but my previous post explains the dillema I find myself in</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div></P>
<P>But here's a quick answer for you, if you want to explore the possibility:</P>
<P>ApplicationContext.LocalContext (version 2.1+) exists purely within the local environment. Also, the data portal calls pre- and post-processing methods before/after calling any DataPortal_XZY method.</P>
<P>If you have your own business base class (which I recommend in any case), you can simply override the pre- and post-processing methods and set something into ApplicationContext.LocalContext to indicate you've "passed through" the data portal. Then just remove it in the post-processing method:</P>
<P>protected override void DataPortal_OnDataPortalInvoke()<BR>{<BR>&nbsp; ApplicationContext.LocalContext["dp_flag"] = true;<BR>}</P>
<P>protected override void DataPortal_OnDataPortalInvokeComplete()<BR>{<BR>&nbsp; ApplicationContext.LocalContext["dp_flag"] = false;<BR>}</P>
<P>You'll want to set this to false as your app starts (on the client) too, so then you can universally check it in your code:</P>
<P>if (ApplicationContext.LocalContext["dp_flag"])<BR>&nbsp; // running inside the data portal</P>
<P></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>BEAUTIFULL!!&nbsp; That is exactly what I need...one code change without changing the framework and then my dataaccess factory will tell them they are an idiot when they go to run their code!!!</P>
<P>THANKS</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Sunday, February 04, 2007</h2>I don't understand the problem here.&nbsp; Can't this be solved with permissions on the database user?&nbsp; Just give them execute rights and disallow them direct select, update, instert, and delete, or is there a reason that won't work?</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
