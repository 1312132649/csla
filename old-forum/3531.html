<html><header><title>Making Criteria Enough</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Making Criteria Enough</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3531.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Javawizard posted on Thursday, September 13, 2007</h2><P>Ok here is the context. Say&nbsp;I have a collection of pets which has 24 exposed, different fetch methods.</P>
<P>Two Examples&nbsp;could be:</P>
<P>static List&lt;Pet&gt; GetPetsLessThanAge(int age) and&nbsp;&nbsp;static List&lt;Pet&gt; GetPetsEqualToAge(int age) </P>
<P>Because the Fetch method is based takes this criteria it loses the context of what I really want.&nbsp; When it gets down to the <SPAN>private</SPAN> <SPAN>void</SPAN> DataPortal_Fetch(<SPAN>Criteria</SPAN> criteria)&nbsp;It just has the data in the ‘criteria.Age’ property but did the caller want? ( &lt; age, &gt; age, &lt;= age or potentially something nasty that would include 'ands' and 'ors' like </P>
<P>public static Pet GetMeThatPetWhenIWasSixButNotTheOneThatStunkWorseThanFlipper(Pet.PetType petType, int smellLimit).</P>
<P>I have thought of passing function pointers, or setting up enums, specifying delegates. In your experience, have you determined a clean way of keeping context intact. So when the UI developer calls Pets.GetPetsByABunchOfComplexJunkThatMakesMyLifeDifficult(int a, int b, guid c, string d....) You can know what was really asked for when it gets to the&nbsp;DataPortal_Fetch method?</P>
<P>(Man I hope that was clear)</P>
<P>
<P>&nbsp;</P></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, September 13, 2007</h2><P><FONT face=Tahoma size=2>Given the complexity of your context, and assuming you can't whittle that down some, about the only way I can see out of this is to turn your criteria object into an equivalent of a query object.&nbsp; You have a couple of options:</FONT></P>
<P><FONT face=Tahoma size=2>1. A mini-object model to... well, model your criteria.&nbsp; This would include separate objects for AND/OR combinations, potentially built to be nested, and all in an ordered list.&nbsp; Not necessarily an easy feat, but doable.&nbsp; If you can simplify the choices, then you may not have to go whole-hog, which means you could maybe get away with a simple comparison object, some enums, and an ordered list.&nbsp; But if you have to support compound (and possibly nested) expressions, your object model gets tougher.</FONT></P>
<P><FONT face=Tahoma size=2>2. A heavy dose of string-building to take your criteria and essentially turn it into a WHERE clause.&nbsp; You'll have to do this either way - their filtering options have to be turned into a WHERE clause somewhere.&nbsp; I'm thinking of something similar to the query builders you see in Access, SQL Server, etc.&nbsp; The question is whether you want to do that within the&nbsp;confines of the query object, or within the confines of the Pet object.&nbsp; If you can rather quickly build this kind of UI, then you can probably get this up and running quicker than a query-object solution.</FONT></P>
<P><FONT face=Tahoma size=2>One other possible idea is to foist the complexity upon your user.&nbsp; It's not necessarily a cop-out - you're really&nbsp;talking about writing a form of a WHERE-clause parser, a not-insignificant feat that may not be worth the time it takes you.&nbsp; Unless your users are pretty tech-phobic, they can be taught the basics of SQL-style filtering without a ton of work - especially if they're used to working with systems that allow the kind of complex filtering criteria you're talking about.&nbsp; Then your criteria object simply passes in what they gave you.</FONT></P>
<P><FONT face=Tahoma size=2>Just my two cents...</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, September 13, 2007</h2><P>I removed all the Criteria classes from my BOs and stuck them in a separate file and namespace.</P>
<P>This way I can build a handful of them and re-use them everywhere.</P>
<P>A sample one would be:</P><FONT size=2>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> CriteriaCode<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> Csla.CriteriaBase<BR><BR>&nbsp; </FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> MethodName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>""<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> Code </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>""<BR><BR>&nbsp; </FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> BOtype </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> methodName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> code </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.New(BOtype)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.MethodName = methodName<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.Code = code<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT>
<P>As you can see, the criteria will pass along a single parameter to the DataPortal (the code value as String). The first parameter is required by CSLA so the framework knows which BO to instantiate. The methodName&nbsp;parameter is used to resolve the issue you are facing.</P>
<P>In the DataPortal you have 2 ways to branch your code. The first is using TypeOf Criteria. If you have 5 Factory methods and use 5 different Criteria classes then this is all you need.</P>
<P>But if you have 5 methods and 3 of them use the exact same Criteria class then you need another way to do the branching. In this case you simply use methodName&nbsp;to tell which factory method passed the criteria.</P>
<P>If methodName = "method1" Then<BR>&nbsp; 'do method1 stuff here</P>
<P>ElseIf methodName = "method2" Then<BR>&nbsp; 'do method2 stuff here<BR><BR>ElseIf methodName = "method3" Then<BR>&nbsp; 'do method3 stuff here</P>
<P>End If<BR></P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
