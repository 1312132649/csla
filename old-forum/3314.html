<html><header><title>Why is SmartDate a struct instead of a class?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Why is SmartDate a struct instead of a class?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3314.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken posted on Thursday, August 02, 2007</h2><FONT size=2>
<P>The following code works with SmartDate</FONT></P>
<P><FONT color=#008000><FONT size=2>SmartDate</FONT><FONT size=2>&nbsp;var = </FONT><FONT size=2>new</FONT><FONT size=2> </FONT><FONT size=2>SmartDate</FONT></FONT><FONT color=#008000><FONT size=2>();<BR>var.Text = </FONT><FONT size=2>"04/01/1983"</FONT><FONT size=2>;</FONT></FONT></P>
<P><FONT size=2>Now, if I take a business object, called "Bo", and give it a SmartDate property like so:</FONT></P>
<P><FONT color=#008000 size=2>private SmartDate _prop = new SmartDate();<BR>public SmartDate Prop { set { _prop = value; } get { return _prop; } }</FONT></P>
<P><FONT size=2>One would think this would work:</FONT></P>
<P><FONT color=#008000 size=2>bo.Prop.Text = "04/01/1983";</FONT></P>
<P><FONT size=2>But it doesn't, we get this error at compile time:</FONT></P>
<P><FONT color=#ff0000 size=2>Cannot modify the return value of 'Bo.Prop' because it is not a variable.</FONT></P>
<P><FONT size=2>After some research, it appears that if SmartDate was a class instead of a struct, the above code would work.</FONT></P>
<P><FONT size=2>What do we gain by having SmartDate be a struct instead of a class, and what would break if it were changed to a class?</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, August 02, 2007</h2><P>I believe Rocky has said many times that SmartDate is not supposed to be exposed directly as a Property - it is the backing field of a String Property.</P>
<P>This allows you to expose Strings to your UI and get and set them into the Smart Date field.</P>
<P>So your code should be:&nbsp; BO.Prop = "04/01/1983"</P>
<P>As for it changing from Class to Structure - when it was first designed a few years ago, a CSLA user pointed out some advantages to the Structure and Rocky commented - "Why didn't I think of that?".</P>
<P>So he finally got around to changing it. (I don't recall what the advantages were though.)</P>
<P>Joe</P>
<P><BR>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 02, 2007</h2><P>No offense David, but <EM>this is really funny!!! <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></EM></P>
<P>SmartDate used to be a class, and I changed it to&nbsp;a value type in CSLA 2.0 because there was a lot of discussion by many people on the forum that pushed the change.</P>
<P>And they were right, btw, because DataTime is a value type, and SmartDate is trying to be as close to DateTime as possible while still providing its unique behaviors.</P>
<P>Ultimately though, Joe is right: SmartDate is designed to be used as a field, not a property, type. The idea is to expose a string property to allow the user to enter anything they want, and to use SmartDate behind the scenes to parse and process that input value.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, August 02, 2007</h2>Glad I could provide some amusement, I know laughs are in short supply in your neck of the woods this week. :(<br><br>I hadn't realized that DateTime is also a struct, and would therefore (presumably!) suffer from the same issues when used as a property.&nbsp; Hmmm..<br><br>I knew you recommended exposing SmartDate variables as string properties.&nbsp; Here's what motivated me to ask.<br><br>I've pretty much finished coding a web control I call DataBox, which is a CompositeControl that includes a TextBox and the ability to hold a collection of Validators.&nbsp; DataBox has a set of custom properties such as Required, MaximumValue, MinimumValue, ValidationExpression, and DataType.&nbsp; As the programmer fills in these properties, the DataBox automatically creates the appropriate validators with appropriate error messages, wires them up, etc.&nbsp; It's a very handy control. :)<br><br>I'm now working on a subclass of DataBox called RuleBox.&nbsp; This is the class I'm really excited about!<br>RuleBox has properties the programmer can set in order to identify which property in which business object the RuleBox represents.&nbsp; If the page the RuleBox is placed on supports a custom interface, the RuleBox can interrogate its business object and get a list of broken rules for that property (for display to the user) along with any validator error messages.&nbsp; What's more pertinent to my question is another capability it has, that of interrogating its business object for rules so that it can automatically set up appropriate validators for rules in the common rules library.&nbsp;&nbsp; Of course, it can't do every rule, but I expect it to be able to handle 80% or more of the rules in an application.&nbsp; If the underlying business object rules for that property change, the next time a user runs the page the RuleBox would automatically conform - at least for the rules it knows how to set up validators for.<br><br>However, if I expose my SmartDate, SmartInt16, SmartInt32, SmartDecimal, etc. variables as string properties, how would a general purpose RuleBox know what datatype to use when setting up the DataType and Range validators?&nbsp; Reflection on the property won't help because it will just say it's a string!<br><br>The four ideas I've come up with are:<br><ol><li>Trust to naming conventions, and assume that a property named "EffectiveDate" will have an underlying private variable called _effectiveDate.&nbsp; Use reflection to find out _effectiveDate's datatype.</li><li>Add a custom DataType Attribute to the properties that RuleBox would use to establish what datatype to validate against.</li><li>Expose SmartDate etc. private variables as SmartDate properties, and live with the limitations.<br></li><li>Ask all of you for a better idea, because I really don't like any of the above.&nbsp; #2 seems the lesser among evils.<br></li></ol>Any other suggestions?<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, August 03, 2007</h2><P>Just thought up option #5, and might as well explore item #6:</P>
<P>5. Add a method to the business object that accepts a propertyName parameter and returns its datatype.&nbsp; </P>
<P>6. Change SmartDate, etc.&nbsp;to a class.</P>
<P>The problem with options 1, 2,and 5 is that the programmer has to do extra work - and if they forget to do it - the RuleBox won't work as intended.&nbsp; The whole idea behind setting up the RuleBox to automatically enforce standard rules on the client&nbsp;is to remove the need to code AND, more importantly, test that code.&nbsp; I lose the "no need to test this, it just works!" beauty of the concept. :(</P>
<P>The problem with #6 is that everyone needs to agree to it or&nbsp;I've got a maverick installation of CSLA, and more to test with each upgrade.&nbsp; Plus, it might break existing code.&nbsp;I don't fully understand the technical implications of changing from a struct to a class yet.&nbsp; If it's just a matter of changing the word struct to class, and recompiling, and everything that used SmartDate works as before...</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Monday, August 06, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>
<P>No offense David, but <EM>this is really funny!!! <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></EM></P>
<P>SmartDate used to be a class, and I changed it to&nbsp;a value type in CSLA 2.0 because there was a lot of discussion by many people on the forum that pushed the change.</P>
<P>And they were right, btw, because DataTime is a value type, and SmartDate is trying to be as close to DateTime as possible while still providing its unique behaviors.</P>
<P>Ultimately though, Joe is right: SmartDate is designed to be used as a field, not a property, type. The idea is to expose a string property to allow the user to enter anything they want, and to use SmartDate behind the scenes to parse and process that input value.</P>
<P></div></BLOCKQUOTE></P>
<P>I've searched the forums, but haven't found the discussions you mention.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, August 06, 2007</h2><P>Did you search the *old* forums?</P>
<P>I just took a quick look and the Search mechanism for th eold forums no longer works.</P>
<P>The thread was started by Paul Tyng in 2004-2005&nbsp;and discussed this topic.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 06, 2007</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>I think they were on the old forums.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>While those forums are technically still available on msn, there&#8217;s
no longer a search capability, so they could be hard to find, sorry.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> david.wendelken
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Monday, August 06, 2007 10:10 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] Why is SmartDate a struct instead of a class?<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<blockquote>

<div>

<p class=MsoNormal><img id="_x0000_i1025" src="/Themes/default/images/icon-quote.gif"><strong>RockfordLhotka:</strong><o:p></o:p></p>

</div>

<div>

<p>No offense David, but <em>this is really funny!!! </em><i><img id="_x0000_i1026" src="/emoticons/emotion-2.gif" alt="Big Smile <img src=" />"></i><o:p></o:p></p>

<p>SmartDate used to be a class, and I changed it to&nbsp;a value type in CSLA
2.0 because there was a lot of discussion by many people on the forum that
pushed the change.<o:p></o:p></p>

<p>And they were right, btw, because DataTime is a value type, and SmartDate is
trying to be as close to DateTime as possible while still providing its unique
behaviors.<o:p></o:p></p>

<p>Ultimately though, Joe is right: SmartDate is designed to be used as a
field, not a property, type. The idea is to expose a string property to allow
the user to enter anything they want, and to use SmartDate behind the scenes to
parse and process that input value.<o:p></o:p></p>

</div>

</blockquote>

<p>I've searched the forums, but haven't found the discussions you mention.<o:p></o:p></p>

<p>&nbsp;<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Monday, August 06, 2007</h2><P>Thanks anyway.&nbsp; I tried googling it but got nothing useful. :(</P>
<P>One of my colleagues just got back from vacation, and immediately added option 7:</P>
<P>7.&nbsp; Create a rule called DataType and pass in the datatype as an argument.&nbsp; The rule doesn't actually have to do anything in the business object, i.e., it always returns true. &nbsp;(Property setters are assumed to take care of datatype checking in the business object, at least the way we've been coding them.)</P>
<P>benefits:</P>
<OL>
<LI>dirt simple to do.</LI>
<LI>fits within the csla framework.&nbsp; In pure rules theory, datatype restrictions <STRONG><EM>are</EM></STRONG> rules.</LI>
<LI>easy to generate.</LI></OL>
<P>drawbacks:</P>
<OL>
<LI>a bit of wasted processing once per object type.&nbsp; (These aren't instance level rules, they are usually going to be object level rules.)&nbsp; Of course, if it turns out to be useful, the datatype rule could actually be coded to check&nbsp;something.</LI></OL>
<P>&nbsp;It's so easy to do this way, I was able to get my&nbsp;RuleBox class up and running.&nbsp; It automagically recognizes the rules necessary to set up these validators to check for required fields, range of values, regular expressions, datatypes, and even sets the max field length.&nbsp; </P>
<P>I suspect that accounts for 80% of the validators I would set up. (If I can get a compare validator setting up for other properties in the same record on the same page, I'll surely hit 80%!)</P>
<P>That means that when I code my business rules in my business objects, 80% of the rules will automagically get enforced on the client, with no effort on my part.&nbsp; No client-side coding, no client-side testing, no client-side maintenance when those business rules change, nada! :)</P>
<P>happy, happy, joy, joy!&nbsp;<img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
