<html><header><title>Type not resolved</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Type not resolved</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3371.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdamTsi posted on Monday, August 13, 2007</h2><P>I have recently updated to CSLA 3.0, as well as changed a bunch of other code in my project (which just makes it even more fun in trying to isolate the problem), and I am now getting random unhanlded exceptions:</P>
<P>System.ServiceModel.Diagnostics.FatalException: Type is not resolved for member 'BOLayer.Security.CustomPrincipal, BOLayer, Version=2.0.0.0, Culture=neutral, PublicKeyToken=23f35140ddce47f3'. ---&gt; System.Runtime.Serialization.SerializationException: Type is not resolved for member 'BOLayer.Security.CustomPrincipal,Biz.BOLayer, Version=2.0.0.0, Culture=neutral, PublicKeyToken=23f35140ddce47f3'. (The rest of the stack trace is below).</P>
<P>This seems closely related <A HREF="/forums/post/12149.aspx">http://forums.lhotka.net/forums/post/12149.aspx</A>, except I'm not running Cassini.</P>
<P>Here is my setup:</P>
<P>Windows Server 2003 SP1, running IIS and .net 3.0 for WCF</P>
<P>I have a WCF application setup for BasicHttpBinding. I am using a custom membership provider to handle authentiation for the WCF service. Inside the membership provider, I am making a call to CustomPrinciple.Login, which is CSLA based. I am not using WCF to make my data portal calls (yet).</P>
<P>As a work around, I tried installing my assemblies (membership provider, BOLayer and CSLA) into the GAC, and the error has gone away. While I wouldn't mind installing into the GAC, I guess I would prefer not to, so any help would be appreciated.</P>
<P>Thanks in advance</P>
<P>&nbsp;</P>
<P>Here is the rest of the stack trace:</P>
<P>at System.Web.Hosting.ApplicationManager.RespondToPingIfNeeded()<BR>&nbsp;&nbsp; at System.Web.Hosting.HostingEnvironment.RespondToPingButNotTooOften()<BR>&nbsp;&nbsp; at System.Web.Hosting.HostingEnvironment.DecrementBusyCountInternal()<BR>&nbsp;&nbsp; at System.Web.Hosting.HostingEnvironment.DecrementBusyCount()<BR>&nbsp;&nbsp; at System.ServiceModel.ServiceHostingEnvironment.DecrementBusyCountNoInline()<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)<BR>&nbsp;&nbsp; --- End of inner exception stack trace ---<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.ChannelHandler.DispatchAndReleasePump(RequestContext request, Boolean cleanThread, OperationContext currentOperationContext)<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.ChannelHandler.HandleRequest(RequestContext request, OperationContext currentOperationContext)<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.ChannelHandler.AsyncMessagePump(IAsyncResult result)<BR>&nbsp;&nbsp; at System.ServiceModel.Dispatcher.ChannelHandler.OnAsyncReceiveComplete(IAsyncResult result)<BR>&nbsp;&nbsp; at System.ServiceModel.Diagnostics.Utility.AsyncThunk.UnhandledExceptionFrame(IAsyncResult result)<BR>&nbsp;&nbsp; at System.ServiceModel.AsyncResult.Complete(Boolean completedSynchronously)<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.SecurityChannelListener`1.ReceiveItemAndVerifySecurityAsyncResult`2.InnerTryReceiveCompletedCallback(IAsyncResult result)<BR>&nbsp;&nbsp; at System.ServiceModel.Diagnostics.Utility.AsyncThunk.UnhandledExceptionFrame(IAsyncResult result)<BR>&nbsp;&nbsp; at System.ServiceModel.AsyncResult.Complete(Boolean completedSynchronously)<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.InputQueue`1.AsyncQueueReader.Set(Item item)<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.InputQueue`1.Dispatch()<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.InputQueue`1.OnDispatchCallback(Object state)<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.IOThreadScheduler.WorkItem.Invoke()<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.IOThreadScheduler.ProcessCallbacks()<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.IOThreadScheduler.CompletionCallback(Object state)<BR>&nbsp;&nbsp; at System.ServiceModel.Channels.IOThreadScheduler.ScheduledOverlapped.IOCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* nativeOverlapped)<BR>&nbsp;&nbsp; at System.ServiceModel.Diagnostics.Utility.IOCompletionThunk.UnhandledExceptionFrame(UInt32 error, UInt32 bytesRead, NativeOverlapped* nativeOverlapped)<BR>&nbsp;&nbsp; at System.Threading._IOCompletionCallback.PerformIOCompletionCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* pOVERLAP)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdamTsi replied on Monday, August 13, 2007</h2><P>So I removed my BOLayer assembly from the GAC to continue trouble shooting. Running File Montior, the last thing that happens (at least that I can understand from the trace), before w3wp.exe invokes DW20 to report the unhandled error, is it looks for the BOLayerin the GAC, and c:\windows\inetsrv, it does not look in the path that corresponds to the virtual directory the WCF service is running in. Looking at other parts of the filemon trace, I see my other assemblies being queried successfully (first check in the GAC, and when not found there, check the local path).</P>
<P>Update:</P>
<P>Upon further googling, I came across a post of MSDN forums where the author talked about a similar problem and thought it was related to hotfix <A href="http://support.microsoft.com/kb/928365">KB928365</A>. In addition to the dev server I was working on, I had another server that still had the older version of all the assemblies on it. Testing against that server, I got the same behavior, indicating that it was not a problem with CSLA, or my code. There was an Add/Remove entry for the 928365, so I uninstalled it on the server that has the newest version of my code to test it's effects, and I no longer have the problem. I don't know where to go from here, except to hope there's a revised hotfix sometime soon.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
