<html><header><title>Merging Data In Place</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Merging Data In Place</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1789.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lotrij posted on Friday, November 17, 2006</h2><P>Hi,</P>
<P>I recently downloaded CSLA and have been playing around with the base classes.&nbsp; I'm only up to Chapter 3 in the book, so I'm not sure how everything works yet, but I wanted to see if something was possible&nbsp;before continuing to read:</P>
<P>Is it possible to merge data into a business object in place (without having to throw out to current business object)?</P>
<P>Here's&nbsp;my scenario:&nbsp;I'm developing various&nbsp;applications where I create hierarchical lists of data to be plugged into grids.&nbsp; I want to set up timers so that the data in the grid is refreshed continuously.&nbsp; If I change the DataSource of&nbsp;a grid to a new object, the row expansion will be lost, so I want to be able to merge the data into the&nbsp;grid's current DataSource object.</P>
<P>Is it possible to add to/remove from/edit the items in the list, and afterwards have everything set to be not dirty?&nbsp; That is, can I force a bunch of changes into the lists of business objects and the business objects and tell them that they are clean (this is assuming that the changes I make will cause the objects to become dirty)?</P>
<P>While I was playing with the base classes I implemented a dummy merge that merged two nearly identical lists of business objects together to see what would happen.&nbsp; I'm guessing using .Save() on the parent list would cause the changes to be applied, but will it do so through the DataPortal?&nbsp; I don't want the changes due to the merge to try to be saved back to the database, since I just got the most recent changes.&nbsp; I want the business object to remove the deleted rows and make any other necessary changes to force itself to be clean after the refresh.</P>
<P>&nbsp;</P>
<P>Thanks,</P>
<P>Jonathan</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, November 17, 2006</h2>CSLA doesn't do this by itself, no. The Save() method returns a new object (or at least you should assume it will).<br><br>However, you could do it yourself, by overriding the Save() method. The complexity depends on how easily you can remap the results back into your object graph, but the concept is like this:<br><br>&lt;Serializable()&gt; _<br>Public Class Customer<br>&nbsp; ' normal fields, properties, etc.<br><br>&nbsp; Public Overrides Function Save() As Customer<br>&nbsp;&nbsp;&nbsp; Dim result As Customer = Me.Save()<br>&nbsp;&nbsp;&nbsp; If Not ReferenceEquals(Me, result) Then<br>&nbsp;&nbsp; &nbsp;&nbsp; ' reload yourself with the data in result<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' _field1 = result._field1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' etc.<br>&nbsp;&nbsp;&nbsp; End If<br>&nbsp; End Function<br><br>End Class<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lotrij replied on Friday, November 17, 2006</h2><P>I'm not sure about all of the details of CSLA&nbsp;yet so I might not be thinking about this correctly.</P>
<P>I figured when my applications run initially, I would get&nbsp;an initial&nbsp;list of business objects.&nbsp; Then on a timer caused&nbsp;refresh I would figure out the changes (perhaps by getting a whole new temporary&nbsp;set of the business objects to compare against)&nbsp;and manually update my current list of business objects (by changing values, adding objects, and removing objects).&nbsp; At this point my list of business objects would be up to date, so I would want to force&nbsp;the list and its objects&nbsp;to consider&nbsp;themselves clean, since any changes they would have&nbsp;would have been&nbsp;done by me in code&nbsp;.</P>
<P>Is it possible to override Save()&nbsp;&nbsp;to confirm the refresh changes (forcing deletes, adds,&nbsp;and edits to actually happen)&nbsp;while not actually trying to do anything about them through the DataPortal ?</P>
<P>&nbsp;</P>
<P>Thanks,</P>
<P>Jonathan</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, November 17, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>lotrij:</strong></div><div><p>Is it possible to override Save()&nbsp;&nbsp;to confirm the refresh changes (forcing deletes, adds,&nbsp;and edits to actually happen)&nbsp;while not actually trying to do anything about them through the DataPortal ?</p></div></BLOCKQUOTE><br><br>Yes, you can completely override Save() and not use the data portal at all if you'd like. People do this sometimes, when they want to use their own persistence mechanism and entirely avoid the data portal.<br><br>There are many other options as well. You could create a "persistence" object in your Save() overload, and put all the data you want to save into that object, and then have it save itself. This can most easily be done using a command object.<br><br>Something like this:<br><br>Public Overrides Function Save() As Customer<br>&nbsp; Dim cmd As New CustomerSaver<br>&nbsp; ' load cmd with data to save<br>&nbsp; cmd = cmd.Execute<br>&nbsp; ' reload your object with data from cmd<br>&nbsp; Return Me<br>End Function<br><br>In this case you don't call the data portal yourself at all. But the CustomerSaver object (derived from CommandBase) would use the data portal to move itself to the server so it could coordinate the saving of your data. It would then return to the client with the results, so you could repopulate your object with the results.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
