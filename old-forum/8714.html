<html><header><title>Handling TimeStamp Columns in SL</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Handling TimeStamp Columns in SL</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8714.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Wednesday, March 24, 2010</h2><p>I have tried :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;byte[]&gt; lastmodifProperty = RegisterProperty&lt;byte[]&gt;(c =&gt; c.lastmodif);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte[] lastmodif<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(lastmodifProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(lastmodifProperty, value); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><br />and in Fetch method:</p>
<p>LoadProperty(lastmodifProperty, dr.GetBytes(&quot;lastmodif&quot;, 0, lastmodif, 0, 8));</p>
<p>This&nbsp; causes the following error on execution:</p>
<p>{&quot;Invalid cast from &#39;System.Int64&#39; to &#39;System.Byte[]&#39;.&quot;}&nbsp;System.InvalidCastException</p>
<p>If I declare the TimeStamp property Int64, I get the opposite error.</p>
<p>I can do this:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private byte[] _lastmodif = new byte<img src="http://forums.lhotka.net/emoticons/emotion-29.gif" alt="Music" /> { 0, 0, 0, 0, 0, 0, 0, 0 };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte[] Lastmodif<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _lastmodif; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>And this<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.GetBytes(&quot;lastmodif&quot;, 0, _lastmodif, 0, 8);<br />But then the _lastmodif never makes it back to the DB in the Save operation because it is not serialized, I suppose - and hence nothing gets updated.</p>
<p>Would appreciate a hint or two.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Jav replied on Wednesday, March 24, 2010</h2><p>Okay.&nbsp; I can&#39;t say that this is the best or the&nbsp;only way to do it, but&nbsp;this will work: (dr is the SafeDataReader)</p>
<p>byte[] _lastmodif = new byte<img src="http://forums.lhotka.net/emoticons/emotion-29.gif" alt="Music" /> { 0, 0, 0, 0, 0, 0, 0, 0 };<br />dr.GetBytes(&quot;lastmodif&quot;, 0, _lastmodif, 0, 8);<br />LoadProperty(lastmodifProperty, _lastmodif);</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Wednesday, March 24, 2010</h2><p>FYI, you can declare byte&nbsp;= new byte<img src="http://forums.lhotka.net/emoticons/emotion-29.gif" alt="Music" />; may make it easier than keep count of the number of 0&#39;s</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Thursday, March 25, 2010</h2><p>I have found it easier to initialize the byte array by setting the default value when registering the property.</p>
<p>private static PropertyInfo&lt;byte[]&gt; TimeStampProperty = RegisterProperty&lt;byte[]&gt;(c =&gt; c.TimeStamp, &quot;TimeStamp&quot;, new byte<img src="http://forums.lhotka.net/emoticons/emotion-29.gif" alt="Music" />);<br />public byte[] TimeStamp<br />{<br />&nbsp;&nbsp;&nbsp;get { return GetProperty(TimeStampProperty); }<br />&nbsp;&nbsp;&nbsp;private set { SetProperty(TimeStampProperty, value); }<br />}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, March 25, 2010</h2><p>Thank you xAvailx and Russ for your suggestions.</p>
<p>Jav</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
