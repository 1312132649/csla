<html><header><title>Custom Security Tables</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Security Tables</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1725.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>white911 posted on Thursday, November 09, 2006</h2><P><FONT face=Arial>I would like to use my own tables for users and security, but I would like to use the </FONT><FONT size=2><FONT face=Arial size=3>Threading.Thread.CurrentPrincipal to check for security. I don't want to use the Security Database and Table Names</FONT></FONT></P>
<P><FONT size=2><FONT face=Arial size=3>How do I go about it?</FONT></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, November 09, 2006</h2>Hello,<br><br>Just have a look at how Csla handles the security and adapt it to your need.<br><br>Looking at the ProjectTracker sample you can trace the following:<br><br>- Project is a BusinessBase derivative, check the CanAddObject member:<br><br>&nbsp; Public Shared Function CanAddObject() As Boolean<br>&nbsp;&nbsp;&nbsp; Return Csla.ApplicationContext.User.IsInRole("ProjectManager")<br>&nbsp; End Function<br><br><br>- this may look as if it does not use the thread's current principal, but in ApplicationContext.vb you will find the following:<br><br>&nbsp; Public Property User() As IPrincipal<br>&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If HttpContext.Current Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return Thread.CurrentPrincipal<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return HttpContext.Current.User<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; Set(ByVal value As IPrincipal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If HttpContext.Current IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HttpContext.Current.User = value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.CurrentPrincipal = value<br>&nbsp;&nbsp;&nbsp; End Set<br>&nbsp; End Property<br><br><br>It's even better than just checking the current thread's principal, as this code can also run in a web-context. ;-)<br><br>So, now you may wonder how the pincipal is ever set. <br>- then you would have to look at DoLogin member of the MainForm in PTWin (if you want to have a sample for Winforms)<br>- or check Global.asax (for a sample that applies to Webforms).<br><br>Either way: the PTPrincipal and PTIdentity classes manage the HttpContext's or current thread's principal, just like you would like to have it. You can implement your own principal/identity pair by implementing the corresponding interfaces. These could be made to fullfill any authentication/authorizaion requirement you have on your plate.<br><br>Good luck!<br>Bayu<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
