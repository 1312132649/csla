<html><header><title>IsValid not updating when property change causes broken rule</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsValid not updating when property change causes broken rule</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10311.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Thursday, April 28, 2011</h2><p>I know the IsDirty / IsValid / IsXXX issue has been discussed before ( <span style="text-decoration:underline;"><span style="color:#0066cc;">http://forums.lhotka.net/forums/t/7143.aspx</span></span>&nbsp;) &nbsp;and the &quot;work around&quot; has changes to the ViewModelBase to &quot;hook&quot; and listen for changes and re-expose them. There is also a pending feature request. </p>
<p><em>The following however is not addressed by the above:</em></p>
<p>The above&nbsp;workaround is fine for when you are dealing with IsValid state at the &quot;root&quot; level of your object tree/graph and you are interested if anything is causing the object to be invalid.</p>
<p>Where I&#39;m running into real frustration is when I need to respond to a change to the IsValid property for a Child Object. Specifically my Business object graph is an Editable Root composing an Editable Child List of Editable Children.<br />ER --&gt; ECL (EC)</p>
<p>In this case, IsValid on the ViewModel (which is bound to the Root object) is updating just fine (thanks to the workaround above). My problem is that I need it for <strong>each individual child</strong>, in order to give visual feedback to the user about the list of children and which of those are invalid.<br /><br />In the Xaml I have a DataGrid that is bound to the Child List property of the root. And inside the grid I have a custom template column that contains some arbitary control that is bound to the IsValid property of the current child in the list:</p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;background:black;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&lt;</span><span style="font-family:&#39;Envy Code R&#39;;color:#cc7832;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">TextBlock</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;Text=</span><span style="font-family:&#39;Envy Code R&#39;;color:#a5c250;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&quot;Invalid&quot;</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;Visibility=&quot;{</span><span style="font-family:&#39;Envy Code R&#39;;color:#ffc66d;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">Binding</span><span style="font-family:&#39;Envy Code R&#39;;color:#cc7832;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;IsValid</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">,</span><span style="font-family:&#39;Envy Code R&#39;;color:#cc7832;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;Converter</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">={</span><span style="font-family:&#39;Envy Code R&#39;;color:#ffc66d;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">StaticResource</span><span style="font-family:&#39;Envy Code R&#39;;color:#cc7832;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;InvisibilityConverter</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">}}</span><span style="font-family:&#39;Envy Code R&#39;;color:#a5c250;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&quot;</span><span style="font-family:&#39;Envy Code R&#39;;color:white;font-size:8pt;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:&#39;Courier New&#39;;mso-fareast-language:EN-AU;mso-bidi-font-size:12.0pt;">&nbsp;/&gt;</span></p>
<p>I&#39;m not sure what the real issue is with the backwards compatibilty with Windows Forms binding, but could we not make the IsXXXX properties work like proper properties and raise property change events for them?</p>
<p>Thanks</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ddredstar replied on Thursday, April 28, 2011</h2><p> have you tried BusinessRules.CheckRules(); when you retrieve you Child object?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, April 28, 2011</h2><p>Not quite relevant.</p>
<p>Perhaps I should have elaborated more. There is a business&nbsp;rule associated with a property, and when that property is changed such that it breaks the validation rule, the particular child is no longer valid. Therefore the IsValid should raise a property changed so that Silverlight XAML binding can repond to it.</p>
<p>Now, if you requery the property IsValid directly it&#39;ll give you the correct value, problem is that the property changed isn&#39;t &quot;triggered&quot; for it and XAML binding doesn&#39;t see it.</p>
<p>Sorry, I hope that clear it up some...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, April 28, 2011</h2><p>Hi Jaans,</p>
<p>I&#39;m not so sure that we should break DataBinding for WindowsForms in Csla yet, so one possible workaround for you is to add:&nbsp;</p>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:#160d03;COLOR:#f6e9c0;FONT-SIZE:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:#e2b155;">protected</span>&nbsp;<span style="COLOR:#e2b155;">override</span>&nbsp;<span style="COLOR:#e2b155;">void</span>&nbsp;OnValidationComplete()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:#e2b155;">base</span>.OnValidationComplete();
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnPropertyChanged(<span style="COLOR:#c9722b;">&quot;IsValid&quot;</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnPropertyChanged(<span style="COLOR:#c9722b;">&quot;IsSelfValid&quot;</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</pre>
<p>&nbsp;to your Child editable object which will make sure to always update the IsValid and IsSelfValid after validation is completed. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, April 28, 2011</h2><p>Thanks Jonny!</p>
<p>Now that&#39;s a nice an simple solution and it works like a bomb (already tested it).<br />It&#39;s so simple, I&#39;m wondering why I couldn&#39;t think of it <img src="http://forums.lhotka.net/emoticons/emotion-7.gif" alt="Tongue Tied" /></p>
<p>I agree, we shoudn&#39;t break WindowsForms (still very current - and we ourselves have quite a few active systems using Windows Forms). I wasn&#39;t proposing that we break it, but wondering whether the Csla AppSetting for <em>PropertyChangeMode</em> (Xaml / Windows) could be leveraged to make sure that for Xaml, it just works.</p>
<p>Looking at your workaround above, might it be something we would like to see added to the CSLA code base? Would that break WindowsForms? If so, we could put it inside an conditional statement that looks at the current <em>ApplicationContext</em>.<em>PropertyChangeMode.</em></p>
<p>Thanks again,<br />Jaans</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, April 28, 2011</h2><p>Hi Jaans, </p>
<p>Yes - it would not be as windows forms databinding expects but adding a conditional statement that looks at ApplicationContext.PropertyChangedMode should work just fine. </p>
<p>For a starter - I&#39;d rather add it to my own intermediate base classes. </p>
<p>We might do this in the csla codebase but that&#39;s really up to Rocky to decide on.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, April 28, 2011</h2><p>Jaans, are you doing MVVM?&nbsp; I had thought that the IsXXX properties behave as you expect if you bind them to the ones exposed in ViewModel&lt;T&gt; from Csla.xaml.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, April 28, 2011</h2><p>@Andy</p>
<p>Yes I&#39;m doing MVVM and yes you are right, the IsXXX properties on the ViewModel (which re-exposes the same properties from the BO) does work. That&#39;s not the issue - the issue is that the ViewModel (can) <strong>only</strong> re-exposes the root parent object&#39;s IsXXX properties and what I needed to &quot;just work&quot;&nbsp;was the IsXXX properties on Child objects.<br /><br />Think: <em>ViewModel.Model.EditbleRoot.ChildList[0].Child.</em><strong>IsValid</strong></p>
<p>@Jonny and @Rocky</p>
<p>Thanks - an intermediate base class is a temporary&nbsp;alternative. </p>
<p>To me if it seems a bit like &quot;broken&quot; behaviour for CSLA to not raise property change events for properties that effectively have&nbsp;changed</p>
<p><em>Ah... Rocky&#39;s post just came though before I finished this reply:&nbsp;</em> </p>
<ul>
<li>OK, so the &quot;proper&quot; behaviour is desired, just a challenge to implement - thanks for that! <br />I presume it&#39;s easier to &quot;calculate&quot; the value for IsDirty / IsValid because it&#39;s harder to ensure that a stored property value is accurate?</li>
<li>Am I to understand that above work around could have performance impact, since there is a cost to calling the getter for IsDirty/IsValid (as a result of receiving a property change notification)?</li>
</ul>
<p>Thanks again gents!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 28, 2011</h2><p>There is a potential perf impact. There&#39;s no harm in you trying the idea in this thread, and if the perf issue doesn&#39;t cause you trouble then life is good :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 28, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>Jaans<br></b>
<p>Looking at your workaround above, might it be something we would like to see added to the CSLA code base? Would that break WindowsForms? If so, we could put it inside an conditional statement that looks at the current <em>ApplicationContext</em>.<em>PropertyChangeMode.</em></p>
</div></p>
<p>Yes, I would like to do this in a future release.</p>
<p>There&#39;s a little more to it, in terms of making things efficient. Right now IsValid and IsDirty are calculated on each get - they aren&#39;t maintained as fields, and so it isn&#39;t practical right now to only raise the changed event when they actually change. Even adding a simple last-value field to solve that wouldn&#39;t be entirely ideal, because each changed event causes the getter to be invoked (possibly multiple times).</p>
<p>Not that all this can&#39;t be addressed - I&#39;m just observing that the <em>correct</em> solution is a bit more complex than a simple on-off solution.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
