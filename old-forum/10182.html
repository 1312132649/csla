<html><header><title>Application fails in 3-tier 'Release' mode but works fine in 3-tier 'Debug' mode</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Application fails in 3-tier 'Release' mode but works fine in 3-tier 'Debug' mode</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10182.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MANOJ posted on Monday, March 21, 2011</h2><p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">We are using CSLA 3.8.3 and VS 2010 (.Net Framework 4.0). </span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">Our application works fine in 3 - tier &lsquo;Debug&rsquo; mode and 2-tier &lsquo;Release&rsquo; mode.</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Times New Roman;">But the same application fails in 3 &ndash; tier &lsquo;Release&rsquo; mode. <span style="mso-spacerun:yes;">&nbsp;</span>Can anyone give some pointers to the issue and the fix? <span style="mso-spacerun:yes;">&nbsp;&nbsp;</span></span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">The error we are getting is below:</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Times New Roman;">Server was unable to process the request -</span><span style="font-family:Wingdings;mso-ascii-font-family:&#39;Times New Roman&#39;;mso-hansi-font-family:&#39;Times New Roman&#39;;mso-char-type:symbol;mso-symbol-font-family:Wingdings;"><span style="mso-char-type:symbol;mso-symbol-font-family:Wingdings;">&agrave;</span></span><span style="font-family:Times New Roman;"> Exception has been thrown by the target of an invocation -</span><span style="font-family:Wingdings;mso-ascii-font-family:&#39;Times New Roman&#39;;mso-hansi-font-family:&#39;Times New Roman&#39;;mso-char-type:symbol;mso-symbol-font-family:Wingdings;"><span style="mso-char-type:symbol;mso-symbol-font-family:Wingdings;">&agrave;</span></span><span style="font-family:Times New Roman;"> The type initializer for &lt;&lt;our class name&gt;&gt; threw an exception. -</span><span style="font-family:Wingdings;mso-ascii-font-family:&#39;Times New Roman&#39;;mso-hansi-font-family:&#39;Times New Roman&#39;;mso-char-type:symbol;mso-symbol-font-family:Wingdings;"><span style="mso-char-type:symbol;mso-symbol-font-family:Wingdings;">&agrave;</span></span><span style="font-family:Times New Roman;"> <span style="mso-spacerun:yes;">&nbsp;</span>Object reference not to set to an instance of an object</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">This error happens while we are retrieving value from the DB.<span style="mso-spacerun:yes;">&nbsp; </span>Before executing the below lines of code which throws this error, we are fetching data from DB and that works fine.<span style="mso-spacerun:yes;">&nbsp; </span>So connection to the DB and fetching data works. </span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">Source code which throws error is below:</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">From the Business Layer:</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">private</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"> <span style="color:blue;">void</span> DataPortal_Fetch(<span style="color:#2b91af;">Criteria</span> criteria)</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#2b91af;">XmlNode</span> customFields = <span style="color:#2b91af;">HelperMethods</span>.GetCustomFieldXML(<span style="color:#2b91af;">HelperMethods</span>.<span style="color:#2b91af;">TableName</span>.TAB_CONTAINER);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#2b91af;">DataFactory</span> df = <span style="color:blue;">new</span> <span style="color:#2b91af;">DataFactory</span>();</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">var</span> dal = df.GetContainerDataObject();</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_containers = dal.GetContainers(criteria.LocationId, criteria.Barcode, customFields, criteria.UserId);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">And the DAL Layer code is </span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span><span style="color:blue;">public</span> <span style="color:blue;">override</span> <span style="color:#2b91af;">DataSet</span> GetContainers(<span style="color:blue;">int</span> locationId, <span style="color:blue;">string</span> barcode, <span style="color:#2b91af;">XmlNode</span> customFieldsXML, <span style="color:blue;">int</span> userId)</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">string</span> methodSignature = <span style="color:#2b91af;">MethodBase</span>.GetCurrentMethod().DeclaringType.Name + <span style="color:#a31515;">&quot;-&gt;&quot;</span> + <span style="color:#2b91af;">MethodBase</span>.GetCurrentMethod().Name.ToUpper() + <span style="color:#a31515;">&quot; &quot;</span>;</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">try</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_coeLog.LogStart(methodSignature);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#2b91af;">DbCommand</span> dbCommand = db.GetStoredProcCommand(BuildStoredProcName(PKG_CONTAINER, SP_GET_CONTAINERS));</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>db.AddInParameter(dbCommand, BuildParameterName(PROP_LOCATION_ID), <span style="color:#2b91af;">DbType</span>.Int32, locationId);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>db.AddParameter(dbCommand, BuildParameterName(PROP_CUSTOM_FIELDS), <span style="color:#2b91af;">DbType</span>.AnsiString, <span style="color:#2b91af;">Int32</span>.MaxValue, <span style="color:#2b91af;">ParameterDirection</span>.Input, <span style="color:blue;">true</span>, 0, 0, <span style="color:blue;">string</span>.Empty, <span style="color:#2b91af;">DataRowVersion</span>.Current, customFieldsXML.OuterXml.ToString());</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>db.AddInParameter(dbCommand, BuildParameterName(PROP_BARCODE), <span style="color:#2b91af;">DbType</span>.String, barcode);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>db.AddInParameter(dbCommand, BuildParameterName(PROP_USER_ID), <span style="color:#2b91af;">DbType</span>.Int32, userId);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">return</span> db.ExecuteDataSet(dbCommand);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">catch</span> (<span style="color:#2b91af;">Exception</span> ex)</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;</span>_coeLog.Log(methodSignature + <span style="color:#a31515;">&quot; - &quot;</span> + ex.Message);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">throw</span> <span style="color:blue;">new</span> <span style="color:#2b91af;">InventoryException</span>(ex);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">finally</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_coeLog.LogEnd(methodSignature);</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Times New Roman;">Since there is no entry for exception message in our log file <span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"></span></span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">, we are assuming the procedure has been executed without exception, but before reaching the result back to Business Layer it fails.</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">Stack trace shows, last lines executed are from</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:10pt;font-family:Verdana;">Csla\Web References\WebServiceHost\Reference.cs:line 124</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:10pt;font-family:Verdana;">Csla\DataPortalClient\WebServicesProxy.cs:line 75</span><span style="font-size:small;font-family:Times New Roman;"> </span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 21, 2011</h2><p>A couple things to consider. </p>
<p>First, 3.8.x was never tested on .NET 4 - that&#39;s what CSLA 4 is all about. There were a few changes that had to be made to 3.8.4 to get it working at the beginning of the CSLA 4 project. I don&#39;t remember the specific changes, and I don&#39;t think any of them were related to the data portal.</p>
<p>Second, the web service data portal channel (that you appear to be using) <em>really</em> was never tested, and in fact was removed from CSLA 4 entirely. That data portal channel was created in 2003 (or so) to combat some specific politically-driven decisions by a couple customers. Those were (imo) poor decisions technically, but some battles you just can&#39;t win based on what is technically correct. So the asmx channel was created to accomodate an application requirement driven by someone in power misunderstanding the technologies being used.</p>
<p>In any case, I&#39;ve viewed the asmx channel as obsolete since 2006 when WCF was integrated into CSLA 2.1.x, because WCF really is a good solution, and it even meets the misguided reasoning that caused the creation of the asmx channel in the first place :)</p>
<p>To make this rambling reply more clear - I&#39;m suggesting that you might want to try the WCF channel instead of the asmx channel. However, I am pretty sure the WCF channel did require some change to make it work with .NET 4 - Microsoft changed something with WCF and we had to recreate the WCF service reference (if I recall correctly) to get it working in .NET 4.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>sg11 replied on Monday, March 21, 2011</h2><p>More on the stack trace:</p>
<p>System.Web.Services.Protocols.SoapException: Server was unable to process request. ---&gt; System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.TypeInitializationException: The type initializer for &#39;CambridgeSoft.COE.Inventory.Library.ContainerList&#39; threw an exception. ---&gt; System.NullReferenceException: Object reference not set to an instance of an object.<br />&nbsp;&nbsp; at CambridgeSoft.COE.Inventory.Library.ContainerList..cctor() in C:\Projects\sunildesk2\People\sgupta\InvMgr\Inventory.NET\Inventory.Library\Container\ContainerList.cs:line 44<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.RuntimeFieldHandle.GetValue(RtFieldInfo field, Object instance, RuntimeType fieldType, RuntimeType declaringType, Boolean&amp; domainInitialized)<br />&nbsp;&nbsp; at System.Reflection.RtFieldInfo.InternalGetValue(Object obj, Boolean doVisibilityCheck, Boolean doCheckConsistency)<br />&nbsp;&nbsp; at System.Runtime.Serialization.FormatterServices.GetObjectData(Object obj, MemberInfo[] members)<br />&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.WriteObjectInfo.InitMemberInfo()<br />&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.WriteObjectInfo.InitSerialize(Object obj, ISurrogateSelector surrogateSelector, StreamingContext context, SerObjectInfoInit serObjectInfoInit, IFormatterConverter converter, ObjectWriter objectWriter, SerializationBinder binder)<br />&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Write(WriteObjectInfo objectInfo, NameInfo memberNameInfo, NameInfo typeNameInfo)<br />&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Serialize(Object graph, Header[] inHeaders, __BinaryWriter serWriter, Boolean fCheck)<br />&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream serializationStream, Object graph, Header[] headers, Boolean fCheck)<br />&nbsp;&nbsp; at Csla.Server.Hosts.WebServicePortal.Serialize(Object obj) in C:\Projects\sunildesk2\People\sgupta\InvMgr\Inventory.NET\Csla\Server\Hosts\WebServicePortal.cs:line 269<br />&nbsp;&nbsp; at Csla.Server.Hosts.WebServicePortal.Fetch(Byte[] requestData) in C:\Projects\sunildesk2\People\sgupta\InvMgr\Inventory.NET\Csla\Server\Hosts\WebServicePortal.cs:line 211<br />&nbsp;&nbsp; --- End of inner exception stack trace ---</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sg11 replied on Monday, March 21, 2011</h2><p>Rocky</p>
<p>How would you explain not seeing this error with Debug goods. Also, are you suggeting trying the WCF channel with CSLA 3.8 (that we are using). Unfortunately we cannot change to CSLA 4 yet, as a library we are internally dependent on still uses CSLA 3.8, and the team responsible for that library is in no position to upgrade yet.</p>
<p>Thanks</p>
<p>SG</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 21, 2011</h2><p>The full stack trace helps a lot. This is an issue with the BinaryFormatter, or at least with serialization.</p>
<p>You may be able to reproduce this by using the Clone method on a business object of that type. Although that won&#39;t solve the issue, it might make it easier to chase down the problem because it will eliminate the data portal and web services infrastructure from the picture.</p>
<p>Also, &quot;cctor&quot; refers to the static constructor.</p>
<p>Hmm. It is quite possible you are hitting an issue with static field initialization - potentially on the client.</p>
<p>So some questions:</p>
<ol>
<li>Are you manually implementing ISerializable? That complicates the heck out of things.</li>
<li>Do you have custom base classes with properties?<ol>
<li>Are you using the _forceInit trick? Is your _forceInit code complex enough that the compiler won&#39;t opimize it away?</li>
<li>Are your PropertyInfo&lt;T&gt; fields public? That&#39;s a more reliable way to ensure proper initialization.</li>
</ol></li>
</ol>
<p>My previous post was pre-coffee, and so was a bit rambling.</p>
<p>It is true that 3.8.3 was never tested on .NET 4 - so there could absolutely be issues due to changes in .NET from 3.5 to 4. I literally didn&#39;t try doing that, so I don&#39;t know.</p>
<p>And I really do recommend avoiding the asmx channel. From day 1 I&#39;ve said it was a sub-optimal channel I created to meet some misguided decisions on the part of some organizations who had irrational issues with Remoting. But since 2006 WCF has been available and makes those misguided people feel good, while also providing a good technical solution.</p>
<p>But given the stack trace you posted later, I doubt WCF will help. I don&#39;t think this is a data portal issue, I think it is a serialization issue. And I don&#39;t think it is &quot;serialization&quot; as much as static field initialization (though I can&#39;t say for sure).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sg11 replied on Monday, March 21, 2011</h2><p>Rocky</p>
<p>Someone will respond to your questions, but I was curious about the effort to switch to WCF. Chapter 21 indicates that for obvious reasons&nbsp;the creation of the service layer is quite involved, and I am not sure we&#39;ve the luxury to do that at this point. The asmx layer has been magically there for us.</p>
<p>Thanks</p>
<p>SG</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 21, 2011</h2><p>Chapter 21 is about creating a service interface using WCF, not about using the WCF data portal channel.</p>
<p>The data portal abstracts the network and uses a channel adapter design pattern. The result is that you can switch between various data portal channels without impacting your code, or having to do all the work described in Chapter 21.</p>
<p>The only catch with using WCF is that you might need to configure WCF somewhat, and that&#39;s harder than configuring asmx (because WCF is so much more powerful/flexible).</p>
<p>In short: none of Chapter 21 applies to the use of the WCF data portal channel.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>MANOJ replied on Tuesday, March 22, 2011</h2><p><span style="font-size:9pt;color:black;font-family:Arial;">
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;">Thanks, will checkout Chapter 21.</span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;"></span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;">The issue has been identified; we have a member in the class to store user_id as below</span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;"></span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:green;font-family:Verdana;">private static readonly int _userId = int.Parse(Csla.ApplicationContext.GlobalContext[&quot;USER_PERSONID&quot;].ToString());</span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:green;font-family:Verdana;"></span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;">this line of code has caused the issue.&nbsp;&nbsp;Application is working in &#39;Release&#39; mode after we had changed our code to get rid of the above line.&nbsp; It seems to be the static member&#39;s value is not getting assigned while coming back from DAL layer.&nbsp; </span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;"></span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal"><span style="font-size:10pt;color:green;font-family:Verdana;mso-bidi-font-family:Arial;">Csla.ApplicationContext.GlobalContext isn&#39;t the appropriate context for storing user_id?&nbsp; </span><span style="font-size:10pt;color:black;font-family:Verdana;mso-bidi-font-family:Arial;"></span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal">&nbsp;</p>
</span></p>
<p style="margin:0in 0in 0pt;mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;" class="MsoNormal">&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, March 22, 2011</h2><p>There are three context dictionaries: LocalContext, ClientContext, and GlobalContext.</p>
<p>I discuss these in detail in the <em>Using CSLA 4</em> ebook series.</p>
<ul>
<li>LocalContext doesn&#39;t flow through the data portal.</li>
<li>ClientContext flows through the data portal from the client to the server, but not back.</li>
<li>GlobalContext flows through the data portal bi-directionally, and is therefore the most expensive.</li>
</ul>
<p>ClientContext and GlobalContext (and their contents) are obviously serialized and deserialized as they flow through the data portal. All standard serialization rules apply - including that static members of types are never serialized.</p>
<p>It is also the case that the async data portal treats GlobalContext differently. The sync data portal replaces the GlobalContext on the client with the one from the server at the end of the data portal call. Because numerous async calls could occur at once, that obviously can&#39;t be done with the async data portal. So the async data portal provides you with access to a GlobalContext property you can use to get at the values as the call completes.</p>
<p>So in your async callback handler code, you can pull out any appropriate GlobalContext values and update the &quot;real&quot; GlobalContext - keeping in mind that there could be multiple outstanding async operations - so it is up to you to figure out how to reconcile any differences.</p>
<p>Generally, no. GlobalContext is not the right place for the user id information. That should go into a principal object - the official .NET location for user identity information.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
