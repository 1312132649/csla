<html><header><title>Code Generation for CSLA and NHibernate</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Code Generation for CSLA and NHibernate</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/615.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven Hawkes posted on Thursday, July 13, 2006</h2><P>Hi,</P>
<P>&nbsp;</P>
<P>Just wondering if anyone has done any work on CLSO code generation using NHibernate for the persisting the business objects.&nbsp;&nbsp; Just done some reading on both CSLA and NHibernate and it seems like a really good combination especially with the&nbsp;properties option in NHibernate.Contrib.&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Friday, July 14, 2006</h2><P>Yes, CSLA and NHibernate is a combination we are using.&nbsp; We are doing some code generation for our BO classes as well using our own in-house CodeSmith templates to fit in with our framework.</P>
<P>I know other people on this forum use different code generation tools as well.</P>
<P>If you've got any ASP.NET experience, then writing CodeSmith templates will seem quite straightforward.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven Hawkes replied on Wednesday, July 19, 2006</h2><P>Hi</P>
<P>Thanks for the response.</P>
<P>I hope I dont upset the CLSA experts by continuing the theme of NHibernate on this forum but my justification is that I am trying to integrate NHibernate into CSLA and appreciate the help of people like yourself who&nbsp;have trodden the same path.&nbsp;&nbsp; It it offends then I am most happy to continue off line.&nbsp;</P>
<P>I have been some playing with NHibernate&nbsp;and CSLA.&nbsp;&nbsp; I have my business object working but am now trying to add the NHibernate to the Data Portal code&nbsp;and have a few further questions which I was hoping you could answer.&nbsp;&nbsp; I tried to&nbsp;use&nbsp;the Attributes Contrib in my business objects, but with not a lot of success.</P>
<P>The first problem is that the examples in the&nbsp;NHibernate doc dont really give a good example&nbsp;of&nbsp;how to decorate the class and associated properties.&nbsp; Do you have an example Business Object class that&nbsp;you would be prepared to share with&nbsp;others on this forum.&nbsp;&nbsp; It complains that my attribute properties are not correct.&nbsp;</P>
<P>The second issue was&nbsp;that when I tried to run cfg.configure() it complains about a missing config file.&nbsp; I guess that&nbsp;uisng the Attribute appriach and the use of reflection to stream the class info into the config I no longer need to&nbsp;make this call or is there another reason why this line was left in the example in the&nbsp;Contrib section of the user manuel.</P>
<P>TIA for any help</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Friday, July 21, 2006</h2><P>Steven,</P>
<P>Have a look at this code fragment on another <A HREF="/forums/permalink/1842/814/ShowThread.aspx#814">thread</A>.&nbsp; That may help you identify the kind of code you should be aiming for inside your Data Portal code.</P>
<P>As for the NHibernate documentation, it is poor compared to the Hibernate documentation.&nbsp; I actually prefer the Hibernate documentation and use that more often.</P>
<P>Use the NHibernate test code and examples, they do have some good stuff in there.</P>
<P>Here's an example of some fields marked up with NHMA attributes:</P>
<P>[Id(0, Name = "RoomId", Column = "room_id")]<BR>[Generator(1, Class = "assigned")]<BR>private int _roomId = 0;</P>
<P>[Property(Name = "RoomName", Column = "room_name")]<BR>private string _roomName = String.Empty;</P>
<P>[Property(Name = "AreaId", Column = "area_id")]<BR>private NullableInt32 _areaId = null;</P>
<P>[Property(Name = "RoomLength", Column = "room_length")]<BR>private NullableDecimal _roomLength = null;</P>
<P>Notice that we're using NHibernate.Nullables here as well.</P>
<P>As for the missing config file, we've set our solution up to use a named configuration file, which can be different for different DBs.&nbsp; So in our singleton NHibernate factory "manager" class we have the following:</P>
<P>Configuration cfg = new Configuration();<BR>cfg.Configure(factoryCfg);<BR>cfg.AddInputStream(stream); // Use the stream here<BR>stream.Close();</P>
<P>where factoryCfg is the name of the physical configuration file (e.g. Nfs.hibernate.cfg.xml) that we want to use to configure this particular instance of a factory.&nbsp; This allows us the flexibility of having different factory configurations via different NHibernate configuration files.</P>
<P>What I really want to do is convert the ProjectTracker example to use NHibernate and submit it to the new CodePlex site for everyone to share.&nbsp; I think that's the best solution going forward.&nbsp; I just need to find the time to do it.</P>
<P>I'm on holiday next week, so that will have to wait a little bit longer.&nbsp; So I won't be posting for a while.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kvleeuw replied on Thursday, August 03, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DavidDilworth:</strong></div><div>
<P>What I really want to do is convert the ProjectTracker example to use NHibernate and submit it to the new CodePlex site for everyone to share.&nbsp; I think that's the best solution going forward.&nbsp; I just need to find the time to do it.</P>
<P></div></BLOCKQUOTE></P>
<P>David,</P>
<P>We are currently evaluting the combination of CSLA and NHibernate and it would surely help to have the ProjectTracker app available in NHibernate format.</P>
<P>Regards,</P>
<P>Koen</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bercht-a replied on Thursday, January 25, 2007</h2>Hi<br><br>Is the ProjectTracker NHibernateVersion available?<br><br>Thanks<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, January 25, 2007</h2><P>The short answer is no.</P>
<P>For a fuller answer see my response on this <A HREF="/forums/thread/11308.aspx">thread</A>.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bercht-a replied on Friday, January 26, 2007</h2>Do you have some example code where i can see the mapping of a collection with nhibernate?<br><br>You wrote something about a second private member for the nhibernate list... do you have a specific example?<br><br>Thanks<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, February 06, 2007</h2><P>As it happens, we've finally got round to doing an NHibernate version of Project Tracker.&nbsp; We're working on it right now.</P>
<P>So I'll post again when the code is available for public viewing.</P>
<P>Fingers crossed, it should be available sometime in the next week or two.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 06, 2007</h2>David,<br><br>I would like to investigate NHibernate more, but I don't like going through online FAQs and samples.&nbsp; I prefer a book to walk though start to end (with online, I usually end up in the middle).<br><br>Do you know of any books that focus on NHibernate?&nbsp; There's plenty on Hibernate, but <a href="http://www.hibernate.org/360.html">'NHibernate 1.0.1 is like version 2.1 of Hibernate, except missing some parts, and some parts of 3 have made it in'</a> which isn't very comforting to me and seems more confusing that what NUnit has done... keep the Java and .Net projects and documentation seperate.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, February 06, 2007</h2><P>The short answer is "no".&nbsp; All the books I've seen are focused on Hibernate, rather than NHibernate.&nbsp; And to be honest, as I've mentioned before, the documentation for Hibernate is actually much better than the NHibernate version.</P>
<P>We've picked up lots of information from the code examples, some blogs and the forums, which are quite well supported.</P>
<P>So, if you're looking for a quick fix - there isn't one.</P>
<P>But....if you wait around just a little bit, then you might just see the ProjectTracker NHibernate example. <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 06, 2007</h2>That's a shame.&nbsp; I've noticed there really isn't any documentation on NHibernate, you just get refered to Hibernate.<br><br>And what would be a problem, except that the version of NHibernate doesn't exactly match any one version of Hiberate... and it would seem you need to remember that feature X of NHibernate is documented under 2.1 of Hibernate, but feature Y is documented under version 3...<br><br>Do you find you need to keep track of that, or is it actually easier than I'm thinking it is?<br><br>Yes, I do intend on looking at the PTracker NHibernate example.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, February 06, 2007</h2><P>We've used a version of NHibernate that hasn't changed (v1.0.2) so all the documentation is in the Hibernate 2.1 documentation.</P>
<P>It is easier than you think it is, once you get your head into it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fellmer Lloyd replied on Wednesday, February 07, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DavidDilworth:</strong></div><div><br />But....if you wait around just a little bit, then you might just see the ProjectTracker NHibernate example. <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /></div></BLOCKQUOTE><br /><br />Hi David<br /><br />Such an example would be great!<br />Thanks for the work in advance.<br /><br />Regards</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, March 12, 2007</h2><P>Ok, for those of you that are interested in NHibernate I have some good news.</P>
<P>We have completed an NHhibernate version of the ProjectTracker example project.</P>
<P>I am currently corresponding with Rocky to see if I can get it released as part of the CSLAContrib project on CodePlex.</P>
<P>Watch this space!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS replied on Monday, March 12, 2007</h2><P class=MsoNormal><SPAN>My question is not maybe related to this thread, but is there an automatic generation of tables from objects, with NHibernate? I mean, do we have to explicitly create the structure of tables? I saw that some DAL tools let the developer works with objects only, and they generate the database without an explicit mapping.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I do not know if I am clear ;) .<o:p></o:p></SPAN></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, March 12, 2007</h2><P>Yes, you can automatically generate a database schema from an NHibernate mapping file.&nbsp; Can I suggest that you watch episode #51 from dnrTV.</P>
<P><A href="http://www.dnrtv.com/default.aspx?showID=51">http://www.dnrtv.com/default.aspx?showID=51</A></P>
<P>Oren Eini demonstates exactly how to do this.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS replied on Monday, March 12, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DavidDilworth:</strong></div><div>Yes, you can automatically generate a database schema from an NHibernate mapping file.&nbsp; </div></BLOCKQUOTE></P>
<P class=MsoNormal><SPAN>Thanks for the link. No easy for me, as English is not my first language, it is easier to read it than to understand it when someone spoke.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Well, I was not clear enough, in fact, it is the mapping I would like to generate automatically. I have classes, and he mapping and the database are generated. Is that possible with NHibernate?<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Thank :)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, March 12, 2007</h2><P>Yes, I think you probably can.</P>
<P>We use the NHibernate.Mapping.Attributes.Dll, which allows you to markup your class with standard Attibutes that describe the mapping you want.</P>
<P>These attributes are reflected from the class code to build a mapping file.&nbsp; This is done in memory as a one-off task.&nbsp; Then as a debugging aid we write out the mapping file to a physical file as well.&nbsp; This technique is demonstrated in our ProjectTracker.NHibernate example code.</P>
<P>If I&nbsp;understand correctly, the schema generation API works off a mapping file.&nbsp; So&nbsp;I guess if you have a mapping file either in memory or on disk, then you might be able to use that to create the schema.</P>
<P>You'll need to go digging into the NHibernate API documentation for some help on that part though - not my area of expertise I'm afraid.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS replied on Monday, March 12, 2007</h2>Ok, thanks for the answer :) Time to stop to ask NHibernate questions on a CSLA forum :)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, May 03, 2007</h2><DIV class=ForumPostContentText id=ctl00_ctl01_bcr_ctl00___PostRepeater_ctl08_PostViewWrapper>
<P>I can (at last) announce that there is now a ProjectTracker.NHibernate example solution on the CSLAcontrib site on CodePlex.</P>
<P>Can I suggest that all future CSLA / NHibernate questions (especially those related to the ProjectTracker.NHibernate solution) are posted on the CslaContrib forum.</P>
<P>Thank you all for your patience&nbsp;and support.</P></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam replied on Monday, March 12, 2007</h2><P>Hey, it's not good ... it's a great news! I'm so excited to see is. </P>
<P>Tnx David</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
