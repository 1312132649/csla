<html><header><title>Data access using interfaces</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Data access using interfaces</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1739.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets posted on Saturday, November 11, 2006</h2><P>Hello,</P>
<P>Is it possible to use interfaces when retreiving from and updating data to the datasource.</P>
<P>In other words:</P>
<P>&nbsp;</P><FONT color=#0000ff size=2>
<P>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#008080 size=2>Criteria</FONT><FONT size=2> criteria)</P>
<P>{</P></FONT><FONT color=#0000ff size=2>
<P>&nbsp;&nbsp;&nbsp;using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>IDbConnection</FONT><FONT size=2> cn = </FONT><FONT color=#008080 size=2>Database</FONT><FONT size=2>.Conn)</FONT></P>
<P><FONT size=2>&nbsp;&nbsp;&nbsp;// Where Database.Conn&nbsp;&nbsp;&nbsp;refers to&nbsp;<FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> conn = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT></FONT><FONT size=2><FONT size=2>&nbsp;&nbsp;&nbsp;(</FONT><FONT color=#008080 size=2>ConfigurationManager</FONT><FONT size=2>.ConnectionStrings[</FONT><FONT color=#800000 size=2>"PTracker"</FONT><FONT size=2>].ConnectionString);</P></FONT>
<P>&nbsp;&nbsp;&nbsp;{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cn.Open();</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>IDbCommand</FONT><FONT size=2> cm = cn.CreateCommand())</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandType = </FONT><FONT color=#008080 size=2>CommandType</FONT><FONT size=2>.StoredProcedure;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = </FONT><FONT color=#800000 size=2>"getProject"</FONT><FONT size=2>;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@id"</FONT><FONT size=2>, criteria.Id);</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SafeDataReader</FONT><FONT size=2> dr = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SafeDataReader</FONT><FONT size=2>(cm.ExecuteReader()))</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dr.Read();</P>
<P>&nbsp;</P>
<P>Else, when I want to change the datasource I need to rewrite all businessclasses to suite the new datasource.</P>
<P>Any Ideas???</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, November 12, 2006</h2>If you get all the functionality you need from IDbConnection and IDbCommand, then there's no reason that wouldn't work. You'd need to create a factory object which can return an instance of the appropriate IDbConnection - thus abstracting that out of your objects and into a central location.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets replied on Sunday, November 12, 2006</h2>Thank you for your response. I will dive in Visual Studio help to find any further answers. Just had to make sure i'm not jamming the dataportal&nbsp;while&nbsp;doing&nbsp;its job.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, November 13, 2006</h2><P>I have used this style of coding for data access for 3 years - no problems. I support Oracle and SQL Server. The bottom line is that you need to be able to identify the correct concrete type to return. I use the appconfig section and set DatabaseType = "SQL Server"&nbsp; (or "Oracle"). I also read the connection string:&nbsp; mConnStr = ConfigurationManager.AppSettings("ConnectionString")</P>
<P>Then in my DAL code (similar to MS-DAAB) I branch on mDBType (which reads the config file).</P>
<P>e.g.</P>
<P>&nbsp;&nbsp; &nbsp;Public Shared Function CreateConnection() As IDbConnection<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mDBType = "SQL Server" Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New SqlConnection(mConnStr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf mDBType = "Oracle" Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New OracleConnection(mConnStr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'If mDBType = "OLEDB" Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New OleDbConnection(mConnStr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>I have overloads for this method that take a string for mDBType (in case I need to change it on the fly for a specific reason) plus another that takes a live connection object to return a 2nd connection of the same type.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jurjen replied on Monday, November 13, 2006</h2><P>You may want to take a look at Petar's implementation of DAL in his ActiveObjects 2.0 wich&nbsp; abstracts it&nbsp;further to commands / parameters&nbsp;etc.&nbsp;<BR></P>
<P>Jurjen.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
