<html><header><title>DataGridView; auto-add rows feature</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataGridView; auto-add rows feature</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/25.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lnk posted on Monday, May 08, 2006</h2><P><SPAN>Hello everyone...</SPAN><o:p></o:p></P>
<P><SPAN>We are trying to make a brand new project based on Rockford's CSLA 2.0 framework. While we study the possibilities of the framework we encountered the following issue:</SPAN><o:p></o:p></P>
<P><SPAN>When using a CSLA child collection bind to a DataGridView, we see in the Project Tracker example that a button is used for adding a new row. We have tried to use the DataGridView capability for adding new rows itself. Since the binding mechanism tries to create a new object itself and our child constructor is private an exception occurs. We could not override or even shadow the method called from the binding infrastructure. </SPAN><o:p></o:p></P>
<P><SPAN>Any idea?</SPAN><o:p></o:p></P>
<P><SPAN>Should we always provide a button for using the factory methods for creating the child objects?</SPAN><o:p></o:p></P>
<P><SPAN>Thanks in advance.</SPAN><o:p></o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, May 08, 2006</h2>Hi,<br><br>I had this problem too.&nbsp; You have to override the AddNewCore method on the list to return a new object.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Igor replied on Monday, May 08, 2006</h2><P class=MsoNormal><SPAN>Not sure whether my remark is relevant or not … but we have had problems with exceptions caused by controls trying to add an item to the bound collection.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>***<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>There is a known issue with binding grids (particularly </SPAN><SPAN>Infragistics </SPAN><SPAN>UltraGrid,</SPAN><SPAN> but probably, other grids as well) to empty collections: <o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>when such a grid is bound to an empty collection it (temporarily) adds a row to discover what the column headings should be; that results in adding an object to the collection. Later the row and the object are removed, but the collection remains dirty. Thanks to its hierarchical capabilities, the grid changes IsDirty not only on the given collection, but on collections of children (and perhaps grandchildren, and so on). See more here:</SPAN> <A href="http://www.searchcsla.com/Details.aspx?msn_id=17162">http://www.searchcsla.com/Details.aspx?msn_id=17162</A> ,<SPAN>&nbsp; </SPAN><SPAN><A href="http://www.searchcsla.com/Details.aspx?msn_id=17603">http://www.searchcsla.com/Details.aspx?msn_id=17603</A> .</SPAN><SPAN><o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>In .Net 1.1 one of possible workarounds was to introduce </SPAN><SPAN>a pair of methods (in our implementation they were called </SPAN><SPAN>AllowNewItem()</SPAN><SPAN> and </SPAN><SPAN>DisallowNewItem()</SPAN><SPAN>) in the collection class, which manipulated the AllowNew flag (the .NET 1.1 data binding infrastructure does not attempt adding new items to the collection if AllowNew = false). <SPAN><o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>But a few days ago we tried to convert an app that uses that workaround to .Net 2.0 (we simply ran the conversion wizard, we did not port the app to CSLA 2.0) and encountered a problem. It looks like t</SPAN><SPAN>he .Net 2.0 data binding infrastructure does not check the AllowNew flag any more and tries to add a new item regardless; if the flag is set to false (and this is how the flag is initialised) the CSLA </SPAN><SPAN>BindableCollectionBase</SPAN><SPAN> class throws an exception. Our tests showed that some of those exceptions were handled by the data binding infrastructure, but some were not; we were not sure which and why. It was possible to get rid of many of the exceptions by calling the </SPAN><SPAN>AllowNewItem()</SPAN><SPAN> method on the collection, but we still had an exception caused by a read-only subcollection in the item object.</SPAN><o:p></o:p></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, May 09, 2006</h2>Thats weird; setting AllowNew to false shouldn't allow the adding of a new row, and I haven't had this problem... perhaps its due to the workaround, or because the code was ported from 1.1?&nbsp; Unfortunatlly all the code I've been doing has started on 2.0.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Igor replied on Tuesday, May 09, 2006</h2><P><STRONG>ajj3085,</STRONG></P>
<P><STRONG>you&nbsp;wrote:&nbsp; "</STRONG>setting AllowNew to false shouldn't allow the adding of a new row<STRONG>"</STRONG></P><FONT color=#000000>
<P><SPAN>It should not, and it did not with .Net 1.1. It looks to me like the .Net 2.0 data binding infrastructure ignores the AllowNew flag and tries adding an item regardless; possibly, that was a conscious decision on MS’ part: this way data binding is more forgiving if the IBindingList is not implemented properly.</SPAN><o:p></o:p></P>
<P class=MsoNormal>No, IMO, the workaround could not cause the problem; to the contrary, it helped to identify the issue. </P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Possibly, it matters that the port from 1.1 to 2.0 was “mechanical” (with the conversion wizard): we did not try to use the new ObjectDataSource.</P>
<P></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lnk replied on Monday, June 12, 2006</h2><P><FONT face=Tahoma color=#000000>Sorry guys for this late response...</FONT></P>
<P><FONT color=#000000><FONT face=Tahoma><STRONG>ajj3085</STRONG>, it's been as easy as overriding AddNewCore on my list object.</FONT></FONT></P>
<P><FONT face=Tahoma color=#000000>Thanks to the rest of responses though they were on a different direction.</FONT><FONT face=Tahoma color=#000000></FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
