<html><header><title>Possible to access business object/exception before it leave the server</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible to access business object/exception before it leave the server</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8254.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>espenrl posted on Friday, January 01, 2010</h2>Hello,<br /><br />This is my first post in this forum. I want to say many thanks to all behind CSLA. It is a fantastic product you are making.<br /><br />Now: I want to log DataPortalExceptions server side, swallow them, and return a more generic exception to the user saying the problem is logged and will be looked into. I think it's good security not to return error information that can reveal secrets of the datalayer.<br /><br />My question is: Is there a central point I can do this? Something corresponding to the IAuthorizeDataPortal, but giving access to the business object/exception before it leaves the server?<br /><br />My alternative so far is to wrap every dataportal method with exception handling. This works fine, but is not optimal with respect to code duplication.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, January 02, 2010</h2>Hi Espen, <br><br>I'd recommend you to buy the Core series of vide from Rocky. The DataPortal video covers a lot of this. <br><br>For my own applications this type of logging/nessage to user is handled in the client. For pure logging purposes you should create your own intermediate base class and implement logging there. Go to CslaContrib.codeplex.com and look at the MyCsla project that shows these hooks. <br><br>Remember - the data access methods are not like an ordinary WebService (where the WS should be considered its own application with authentication/logging/exception handling) but rather a part of your application. You should decide what type of info you want to display to the user in the client. <br><br>I would however like to have the same function in DataPortal mostly for:<br>* transform NonSerializable exceptions to my own exception (could be done standard in Csla)<br>* transform from an NonStandard .Net Exception to my own exception when the exception occurs in a 3rd party assembly that does not exist on the client side (like TdException from the TeraData .Net driver and MqException from MQ assemblies). <br><br>The general recommendation is to have no general exception handling in your DAL and let Csla return the Exception wrapped in a DataPortal exception to the UI layer. <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>espenrl replied on Thursday, January 07, 2010</h2>The idea of making my own subclasses is guite good. But it would have been even nicer too have a solution like this:<br /><br />interface IDataPortalResultHandler<br />{<br />      DataPortalResult HandleResult(DataPortalResult o)<br />}<br /><br />class Logger : IDataPortalResultHandler<br />{<br />     DataPortalResult HandleResult(DataPortalResult object)<br />    {<br />        // alter object and return it<br />        Log(object.Error)<br />        object.Error = new GenericException();<br />        return object;<br />    }<br />}<br /><br />...and then configure the dataportal to actually use the class to handle all DataPortalResults.<br /><br />What do people think of this? Is it only me that wishes this functionality?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Friday, January 08, 2010</h2>You can use Enterprise Library from Microsoft patterns and practices.  It just requires a couple lines of code in the application and some configuration. You can log all or specific errors to a number of datastores such as a database, file, event, email, etc..<br /><br />http://msdn.microsoft.com/en-us/library/cc467894.aspx</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 08, 2010</h2><P>The ability to alter the business exception before it leaves the server is now in the wish list and may be a 4.0 feature.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>espenrl replied on Friday, January 08, 2010</h2>Thanks Rockford!<br /><br />I did implement the compression feature in a project today. I noticed I could alter the ConvertResponse in the custom WcfPortal to do what I wish in this post. From there I have full control over the exceptions returned by the server.<br /><br />This is just theory, but I don't see why it should not work. I will test this when I have time.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, January 10, 2010</h2><P>If you are very careful this could work - but only with the Silverlight data portal, because the .NET data portal doesn't have these hooks.</P>
<P>In general I don't think it is a good general solution, because it requires too much intricate knowledge of how the data portal works and how it expects the data to flow.</P>
<P>And if I encourage people to play with the pipeline data at that level, then I can't change the data portal over time without breaking everyone who writes code in there. The abstraction level is too low, making fragility too high.</P>
<P>But I suspect you can make it work if you try.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
