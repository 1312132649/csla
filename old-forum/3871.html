<html><header><title>Design Question -- Inheritance</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design Question -- Inheritance</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3871.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic posted on Thursday, November 08, 2007</h2><FONT face=Arial size=2>Hello,<BR><BR>I currently have a class called Framing, which <FONT color=#0000ff>Inherits</FONT> BusinessBase(<FONT color=#0000ff>Of</FONT> Frame).&nbsp; This class has a simple Get method:<BR><BR></FONT>
<P><FONT face=Arial><FONT size=2><FONT color=#0000ff>Public</FONT> <FONT color=#0000ff>Shared</FONT> <FONT color=#0000ff>Function</FONT> GetFrame(<FONT color=#0000ff>ByVal</FONT> Id <FONT color=#0000ff>As</FONT> Guid) <FONT color=#0000ff>As</FONT></FONT></FONT><FONT face=Arial><FONT size=2> Frame<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp; Return</FONT> DataPortal.Fetch(<FONT color=#0000ff>Of</FONT> Frame)(<FONT color=#0000ff>New</FONT></FONT></FONT><FONT face=Arial size=2> Id_Criteria(Id))<BR><FONT color=#0000ff>End</FONT> </FONT><FONT color=#0000ff><FONT face=Arial size=2>Function<BR><BR></FONT><FONT color=#000000><FONT face=Arial size=2>I have the Fetch method along with the private Id_Criteria class.<BR><BR>Now I would like to create classes that inherit Frame since there are multiple types of frames.&nbsp; WallFrames, MultiOpeningFrames, CustomFrames, etc.<BR><BR>I would like to be able to say:<BR>Dim objWallFrame as WallFrame = WallFrame.GetWallFrame ( Id)<BR><BR>Since the information in the database is the same for all types of frames I would like to reuse the Get method of the parent instead of defining it in all of the children.&nbsp; Something like:<BR><BR></FONT></P>
<P><FONT face=Arial><FONT size=2><FONT color=#0000ff>Public</FONT> <FONT color=#0000ff>Shared</FONT> <FONT color=#0000ff>Function</FONT> GetWallFrame(<FONT color=#0000ff>ByVal</FONT> Id <FONT color=#0000ff>As</FONT> Guid) <FONT color=#0000ff>As</FONT></FONT></FONT><FONT face=Arial><FONT size=2> WallFrame<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp; Return</FONT> <FONT color=#0000ff>CType</FONT></FONT></FONT><FONT face=Arial><FONT size=2>(Frame.GetFrame(Id), WallFrame)<BR><FONT color=#0000ff>End</FONT> <FONT color=#0000ff>Function</FONT></FONT></FONT></P>
<P><FONT face=Arial color=#000000 size=2>The code above does not work, since I'm not able to convert a parant type into a child type.<BR><BR>I believe Inheritance is the solution for what I want, but without being able to cast the parent to child type, it seems I have to duplicate the code in the parent.<BR><BR>Thank you,<BR><BR>&nbsp;- Andy</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, November 08, 2007</h2><P>When I first started down this road I think I tried to approach it the way you were.</P>
<P>The approach I'm taking now and one I'm very happy with involves the use of a factory class - factory methods on that class return an instance of IFrame (in your circumstance) where IFrame is an interface defined that largely matches what your base class can implement (or minimally define abstractly).</P>
<P>A couple of threads to perhaps look at are this: </P>
<P><A HREF="/forums/post/13759.aspx">http://forums.lhotka.net/forums/post/13759.aspx</A><BR><A HREF="/forums/post/10942.aspx">http://forums.lhotka.net/forums/post/10942.aspx</A></P>
<P>In the end, one can say: FrameFactory.GetFrame(Guid id), which will return an IFrame - and the job of the GetFrame in FrameFactory is determine the necessary type (by perhaps a lightweight fetch using the Id to simply return the type) and then a delegation to the appropriate child class, such as WallFrame.GetWallFrame if the type was WallFrame. </P>
<P>My two cents,</P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Friday, November 09, 2007</h2><P>I would agree that the object factory route is the way to go.</P>
<P>You could, if you prefer, return a reference to an abstract base (ABC) class instead of an interface.&nbsp; That's a pattern we've used in part of our application.&nbsp; The overall object factory pattern is the same though.</P>
<P>Our ABC inherits from a CSLA derived base class and you get all the standard CSLA methods (i.e. Save()) on the resulting instance object.</P>
<P>To maintain the "standard" scope rules associated with our other CSLA objects, the factory has all the public static methods and each individual concrete inherited BO has internal factory methods that are used by the factory.</P>
<P>HTH</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, November 09, 2007</h2><P>Hey David,</P>
<P>How do you return a reference to an abstract base class? I would agree that the interface wouldn't be needed if you could return a reference to the abstract base but with generics you can't just return a type of Frame&lt;T&gt;? Are you just returning type object? </P>
<P>And even if you get an instance to abstract base under an object instance, how can you do anything with it if it's cast as object? That's where I find the interface useful for me. </P>
<P>Just curious!</P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Friday, November 09, 2007</h2><P><FONT face=Arial size=2>The following is based on code in our app.&nbsp; I've snipped out the implementation details, but it illustrates the key points.</FONT></P>
<P><FONT face=Arial size=2>The factory looks like this:</FONT></P>
<P><FONT size=2><FONT face="Courier New"><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>class</FONT> </FONT></FONT><FONT face="Courier New" color=#2b91af size=2>AbstractFactory<BR></FONT><FONT size=2><FONT face="Courier New">{<BR></FONT></FONT><FONT color=#808080><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;///</FONT></FONT><FONT face="Courier New" color=#008000 size=2> </FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;summary&gt;<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> Create a new </FONT><FONT color=#808080>&lt;c&gt;</FONT><FONT color=#008000>Dynamic</FONT><FONT color=#808080>&lt;/c&gt;</FONT><FONT color=#008000> instance object.<BR></FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> </FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;/summary&gt;<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> </FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;param name="name"&gt;<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> The identifying name of the </FONT><FONT color=#808080>&lt;c&gt;</FONT><FONT color=#008000>Dynamic</FONT><FONT color=#808080>&lt;/c&gt;</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#008000> type.<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> </FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;/param&gt;<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> </FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;returns&gt;<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> A reference to an instance derived from the </FONT><FONT color=#808080>&lt;see&nbsp;cref="AbstractBase"/&gt;</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#008000> class.<BR></FONT><FONT color=#808080>&nbsp;&nbsp;&nbsp;///</FONT><FONT color=#008000> </FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#808080>&lt;/returns&gt;<BR></FONT><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>AbstractBase </FONT>NewConcrete(<FONT color=#0000ff>string</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> name)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff></FONT></FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000>//implementation in here creates an instance of a concrete<BR></FONT>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></FONT></P><FONT face="Courier New">
<P><FONT face=Arial size=2>And the class definitions look&nbsp;like this:</FONT></P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>abstract</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>AbstractBase</FONT><FONT size=2> : </FONT><FONT color=#2b91af size=2>BusinessBase</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>AbstractBase</FONT><FONT size=2>&gt; {}</FONT></P><FONT size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ConcreteClass</FONT><FONT size=2> : </FONT><FONT color=#2b91af size=2>AbstractBase<FONT color=#000000> {}</FONT></P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, November 09, 2007</h2><P>Try this in the WallFrame class:</P>
<P><FONT face=Arial><FONT size=2><FONT color=#0000ff>Public</FONT> <FONT color=#0000ff>Shared</FONT> <FONT color=#0000ff>Function</FONT> GetWallFrame(<FONT color=#0000ff>ByVal</FONT> Id <FONT color=#0000ff>As</FONT> Guid) <FONT color=#0000ff>As</FONT></FONT></FONT><FONT face=Arial><FONT size=2> WallFrame<BR><FONT color=#0000ff>&nbsp; Return<FONT color=#000000> DataPortal.Fetch(</FONT><FONT color=#0000ff>Of</FONT><FONT color=#000000> WallFrame)(</FONT><FONT color=#0000ff>New</FONT><FONT face=Arial size=2><FONT color=#000000> Id_Criteria(Id))</FONT><BR></FONT></FONT></FONT></FONT><FONT face=Arial><FONT size=2><FONT color=#0000ff>End</FONT> <FONT color=#0000ff>Function</FONT></FONT></FONT></P>
<P>Because WallFrame Inherits from Frame the DataPortal_Fetch method will be called in the lowest level class that it is implemented in.So if you don't override it in WallFrame it will walk up the chain and use&nbsp;the version in Frame thus giving you the re-use you were looking for.</P>
<P>Your WallFrame class should override GetIdValue. </P>
<P>You can also add any other properties you need that are specific to WallFrame plus any business rules.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> AddBusinessRules()<BR>&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.AddBusinessRules()</FONT></P>
<P><FONT size=2><FONT color=#008000>&nbsp; 'add more rules here</FONT><BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Friday, November 09, 2007</h2>Joe,<br><br>are you sure what you suggets is really usefull?<br>DataPortal_Fetch might be called in the base class, <br>but this way, you would never be able to retrieve any property values specific to the derived class (WallFrame). Even worse, these properties would always show up with their default values, <br>and overwrite what was stored in the db on the next save...<br><br>Not quite useful, I think. Correct me if I am wrong.<br><br>EDIT:<br>Sorry Joe, <br>I just saw that ballistic explicitly said that there was no difference in the persisted data. <br>So there is just different behaviour (-&gt;differing validation rules), <br>and so your suggestion was absolutely useful :-)<br><br>Stefan<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, November 09, 2007</h2><P>Stefan,</P>
<P>No problem.</P>
<P>It is also useful if you simply Override DataPortal_Fetch and then call MyBase.Fetch to grab the "common prorpeties" and then grab the additional properties in the rest of the code block.</P>
<P>I use this pattern a lot. In fact I split out DP_Fetch into a bunch of overridable sub-methods so that I only have to override a small piece to get this effect.</P>
<P>In the example below I could override FetchData and then choose to either grab the base properties or ignore them and build a new SQL statement that fetches all properties. Alternatively, I could override PostFetchData and then just grab the extra properties there too.</P>
<P><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>)<BR><FONT color=#008000>&nbsp; 'other code removed for clarity</FONT></FONT><FONT size=2><BR>&nbsp; </FONT><FONT size=2>DoFetch(criteria)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DoFetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>)<BR>&nbsp; SetDefaults()<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> cn </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDbConnection = </FONT><FONT color=#0000ff size=2>Nothing<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Try<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>cn = DAL.CreateConnection<BR>&nbsp;&nbsp;&nbsp; cn.Open()<BR>&nbsp;&nbsp;&nbsp; FetchData(criteria, cn)<BR>&nbsp;&nbsp;&nbsp; PostFetchData(criteria, cn)<BR>&nbsp;&nbsp;&nbsp; FetchChildren(criteria, cn)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Finally<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>cn.Close()<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Try<BR>&nbsp; </FONT><FONT size=2>MarkOld()<BR>&nbsp; ValidationRules.CheckRules()<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> FetchData(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> cn </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDbConnection)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> dr </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> SafeDataReader<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> crit </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> CriteriaCode = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(criteria, CriteriaCode)<BR>&nbsp; dr = </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> SafeDataReader(DAL.ExecuteReader(cn, CommandType.Text, DAO.Select(crit.Code)))</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Try<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>With</FONT><FONT size=2> dr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> .Read() </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>mCode = Trim(.GetString(</FONT><FONT color=#ff00ff size=2>"code"</FONT><FONT size=2>))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mDesc = Trim(.GetString(</FONT><FONT color=#ff00ff size=2>"desc"</FONT><FONT size=2>))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>With<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Finally<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>dr.Close()<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Try<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> PostFetchData(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> cn </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDbConnection)<BR>&nbsp; <FONT color=#008000 size=2>'marker method that can be overridden in child class<BR></FONT></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> FetchChildren(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> cn </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDbConnection)<BR>&nbsp; </FONT><FONT color=#008000 size=2>'marker method that can be overridden in child class<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P><FONT color=#000000 size=3>
<P>Joe</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, November 12, 2007</h2><P>Joe, a great example of how to extend the base CSLA framework using the&nbsp;<A href="http://en.wikipedia.org/wiki/Open/closed_principle">open-closed principle</A>.&nbsp; </P>
<P>This code is open for extension by many different derived classes, but closed for modification so that the "standard" behaviour of CSLA is kept under your control.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
