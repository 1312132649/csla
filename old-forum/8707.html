<html><header><title>DataPortal_DeleteSelf not being called in remote data portal</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal_DeleteSelf not being called in remote data portal</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8707.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CBoland posted on Tuesday, March 23, 2010</h2><p>I&#39;m using CSLA 2.1.4 and working an issue where DP_DeleteSelf is called when data portal is local, but not remote. My object is a root class (not a child). I&#39;m executing unit tests in the context of MSTest. This is what my test is doing:</p>
<ol>
<li>Create a new Widget object (myWidget).</li>
<li>Save the Widget. (myWidget.Save() )</li>
<li>Delete the Widget (myWidget.Delete(), then myWidget.Save() )</li>
<li>Check that myWidget no longer exists in database.</li>
</ol>
<p>Step 4 is failing because the object still exists. The problem that I can see is that DataPortal_DeleteSelf is not being called when the data portal is remote (hosted in IIS), although it does get called when the data portal is local. Everything else seems to be working correctly in both cases.</p>
<p>Stepping through the final myWidget.Save() in Step 3 and into the CSLA code, I can see a MethodInfo for &quot;DataPortal_DeleteSelf&quot; prepared and called from the client side in RemotingProxy.Update(), which in turn calls Portal.Update(), but Widget.DataPortal_DeleteSelf doesn&#39;t get called on the remote side. On the client side, after the call is made, no exception is apparent,  and a resulting Widget object is deserialized (not sure where this instance comes from).</p>
<p>Since Widget.DataPortal_Insert and Widget.DataPortal_Update are called as expected, I thought there may be a problem with the declaration of Widget.DataPortal_DeleteSelf, but it looks comparable to the other DP methods:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_DeleteSelf()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal_Delete(New CriteriaDelete(Me.ID))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Overloads Sub DataPortal_Delete(ByVal criteria As CriteriaDelete)<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; ...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Insert()<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; ...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Update()<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; ...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br /></p>
<p>Again, this all works correctly when the data portal is local, but when data portal is remote, DataPortal_DeleteSelf isn&#39;t called.</p>
<p>Can anyone offer a suggestion of what to look at next?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
