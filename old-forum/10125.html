<html><header><title>Values not accessable in object after LoadProperty</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Values not accessable in object after LoadProperty</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10125.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr posted on Thursday, March 03, 2011</h2><p>I am just getting started using CSLA and have an issue that I am sure is because I am overlooking something that I need to do when using LoadProperty when performing a data fetch.</p>
<p>I am using CSLA 3.7.1 and am having an issue where the object properties are not updating.<br />I am working in Windows Forms.</p>
<p>This is a sample of what my code lookks like</p>
<p>Public Class Person<br />&nbsp;&nbsp; Inherits BusinessBase(Of Person)</p>
<p>#Region &quot;Business Methods&quot;</p>
<p>&nbsp;&nbsp; Private Shared FirstNameProperty As PropertyInfo(OF System.String) = RegisterProperty(New PropertyInfo(Of System.String)(&quot;FirstName&quot;, &quot;First Name&quot;))<br />&nbsp;&nbsp; Public Property FirstName() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of String)(FirstNameProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(FirstNameProperty, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp; End Property</p>
<p>..Many More Propertys set up like this...<br />#End Region</p>
<p>Then I have code similar to this to fetch and load the data</p>
<p>Private Overloads Sub DataPortall_Fetch(ByVal ToFind as Criteria)<br />&nbsp;&nbsp; Dim _data As Employees = New Employees<br />&nbsp;&nbsp; _data.LoadByPrimaryKey(ToFind.ID)<br />&nbsp;&nbsp; With _data<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(FirstNameProperty, FName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...Load remaining properties this same way....</p>
<p>&nbsp;&nbsp; End With<br />End Sub</p>
<p>The Fetch is called by a method similar to the following</p>
<p>Public Shared Function GetEmployee(ByVal Id as Integer) As Person<br />&nbsp;&nbsp; If Not CanGetObject() Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New System.Security.SecurityException(&quot;Not Authorized&quot;)<br />&nbsp;&nbsp; End If<br />&nbsp;&nbsp; Return DirectCast(DataPortal.Fetch(OF Person)(New Criteria(Id), Person)<br />End Function</p>
<p>In the code I have the following<br />dim thePerson As Person = Person.GetEmployee(HisID)</p>
<p>lblFName.Text = thePerson.FirstName<br />..Set More UI controls</p>
<p>Now what is strange is that When I run in debug If I break after dim thePerson and Check the value of thePerson.FirstName it is a blank string.<br />However If I look at thePerson Object in the Debugger and Scroll down to the FirstName it will be present.<br />I can then check the value of thePerson.FirstName and it will be populated.</p>
<p>This makes me think ther is something I need to call to get the properties to update in the UI or Object.</p>
<p>Any Ideas.....I have been hung up on this for a day now.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, March 03, 2011</h2><p>I&#39;d put a breakpoint at the bottom of the DataPortal_Fetch and see if the properties have their values at that point.</p>
<p>A couple (unrelated) comments:</p>
<ol>
<li>You don&#39;t need the NoInlining directive - that&#39;s counter-productive in your code</li>
<li>You don&#39;t need to cast the result of DataPortal.Fetch(Of T) - the result is already of type T</li>
</ol>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, March 03, 2011</h2><p>And it could also be an issue with Visual Studio. </p>
<p>I have seen that on several occations when the debugger/visualizers misses on which object the variable points to and is unable to show the correct value. </p>
<p>To read more about the inner workings of a visualizer: <a href="http://msdn.microsoft.com/en-us/library/e2zc529c.aspx">http://msdn.microsoft.com/en-us/library/e2zc529c.aspx</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Friday, March 04, 2011</h2><p>I will check the DataPortal Fetch (I have made some changes that provided a work around so that I could continue).</p>
<p>Since most of the data will be read only within the current use I added Local Backing Fields. However, the <span style="color:#008000;font-size:x-small;"><span style="color:#008000;font-size:x-small;">GetProperty(Of String)(FirstNameProperty, _fName)</span></span> was still returning an empty string so I changed the return to return the backing field. I am not happy with this but it allows me to continue while I figure out the problem.</p>
<p>As to your comments - This is what happens when you take over someone elses code. I had already corrected the cast (realized that it was already type correct after my post). I was unsure of the NoInlining directive as I have never used it before and was unsure of when and if it should be used. As per your comments I have removed it from the code.</p>
<p>Could you explain when you would want to use the NoInlining directive?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, March 04, 2011</h2>If you are using private backing fields then your property declaration is wrong, along with the getproperty, setproperty, and loadproperty calls. They all need to make use of that private field.

In 3.7 you should never need noinlining.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Friday, March 04, 2011</h2><p>I guess I should have provided more information.</p>
<p>My property declarations now</p>
<p>&nbsp;Private Shared FirstNameProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(New PropertyInfo(Of String)(&quot;FirstName&quot;, &quot;First Name&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _fName As String = FirstNameProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; Public Property FirstName() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of String)(FirstNameProperty, _fName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(FirstNameProperty, _fName, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>I also changed the DataFetch to use SetProperty instead of LoadProperty.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, March 04, 2011</h2><p>LoadProperty in Csla 3.7 should ONLY be used with managed backing fields. </p>
<p>If you use private backing fields then use the private field in your DataPortal_XYZ methods. </p>
<p>This is the reason we added the RelationshipTypes.PrivateField in Csla 4.x - so we could really check if it is a private field or managed field.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Thursday, March 10, 2011</h2><p>Still having an issue with this after having reinstalled .NET 3.5 SP1 and VS2008 Professional.</p>
<p>Could there be something I am missing?</p>
<p>Some reference or somthing that should have been done with the CSLA installation that was not done?</p>
<p>Grasping at straws since I have another issue that reared its ugly head it my other post.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Thursday, March 10, 2011</h2><p>In your DataPortal_Fetch, don&#39;t call SetProperty or LoadProperty.&nbsp;&nbsp; Just set your _backingField directly.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Friday, March 04, 2011</h2><p>Ok I set a breakpoint at the end of the dataportal fetch.</p>
<p>I had changed to use <span style="font-size:x-small;">SetProperty(FirstNameProperty, _fName, .FNAME) after adding the backing fields instead of LoadProperty. However the same behavior exists. When I checked the Properties after reaching the breakPoint I have&nbsp; the following results</span></p>
<p><span style="font-size:x-small;">FNAME = &quot;KEITH&quot;</span></p>
<p><span style="font-size:x-small;">_fName = &quot;KEITH&quot;</span></p>
<p><span style="font-size:x-small;">FirstNameProperty = &quot;&quot;</span></p>
<p><span style="font-size:x-small;">FirstNameProperty.DefaultValue = &quot;&quot;</span></p>
<p><span style="font-size:x-small;">FirstNameProperty.Index = -1</span></p>
<p><span style="font-size:x-small;">This is really a headache ... I do not think it is within VS since If I run the program externally the values are not returned to the Controls. It may be a case of something is wrong in the Copy of the CSLA I have here....Maybe......Possibly......Perhaps.....</span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
