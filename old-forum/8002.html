<html><header><title>Conditional Validation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Conditional Validation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8002.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb posted on Monday, November 16, 2009</h2>How do you guys choose to implement conditional validation rules?  Are business rules even used as validation rules?<br /><br />Let's say you have a BO with Name, Zipcode, and Status.  Name is required in the DB, so obviously a StringRequired is one rule that is always there.<br /><br />But let's say a business rule is that if you change Status to "X", Zipcode is required.  You can add a custom rule that checks Status and Zipcode and returns true/false accordingly.  <br /><br />Is this appropriate or should there be another method of implementing the rule that is not a "validation rule" ie an Exception or some other catch when they try to set Status to "X" without having a Zipcode?<br /><br />Thanks,<br />Mike</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Monday, November 16, 2009</h2>I think conditional rules are fine (and in fact the ability to have conditions that bypass rules entirely is why instance business rules are almost never needed anymore). <br /><br />Incidentally, you can even call one rule method from another, so (for example) in your dependency between status and zip code above you could conditionaly invoke the StringRequired rule method from within your hypothetical StatusMayRequireZipCode rule.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv replied on Tuesday, November 17, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsbaker0:</strong></div><div>Incidentally, you can even call one rule method from another, so (for example) in your dependency between status and zip code above you could conditionaly invoke the StringRequired rule method from within your hypothetical StatusMayRequireZipCode rule.</div></BLOCKQUOTE></P>
<P>I also use this technique.&nbsp; Works quite nicely.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, November 17, 2009</h2>Hi, <br><br>If these rules can be generalized I like to create my own rule that does a simple shortcut, uses a custom RuleArgs or is based on an interface. <br><br>Ie: If a field should only be validated when the user is allowed to write I have a rule that says StopIfNotCanWrite. In a similar way you could also write a generic rule that says StopIfFieldEquals / StopIfFieldIsNotEqual and create a generic RuleArgs to contain both propertyName and a value. And finally combine this with RulePriority to control the sequence of validation. <br><br>I also override CanReadProperty and CanWriteProperty (AuthorizationRules)&nbsp; to enable/disable properties based on my BusinessRules. This also allows me to make the UI a slave of my BO by using PropertyStatus (WPF/SL) or ReadWriteAuthorzation (WinForms).<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Tuesday, October 30, 2012</h2><p>Hi Jonny,</p>
<p>I&#39;m trying to write code according with your interesting idea of coupling a &quot;<b>StopIfNotCanWrite</b>&quot; rule with <b>CanWriteProperty(..)</b> authorization method.</p>
<p>What gets me confused is that if I declare a <b>StopIfNotCanWrite </b>rule, and AddRule(<b>StopIfNotCanWrite, prop, 0) </b>(with priority 0), and the rest of the rules regarding the same &quot;<b>prop</b>&quot; with priority 1, in order to short circuit the Validation Rules Manager, I must make <b>StopIfNotCanWrite&nbsp; </b>short circuit the Rules Manager and then return &quot;false&quot;. That will leave my BO in an invalid state (exactly the opposite of what I want to accomplish). Or when I short circuit the <b>StopIfNotCanWrite</b> rule, I should also return &quot;true&quot; and inform of the writing capabilities via a custom RuleArgs?</p>
<p>Could you please provide a short example of this behavior?</p>
<p>Thanks!</p>
<p>Troncho</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, October 30, 2012</h2><p>Look at the CSLA 3.x addon rules here: </p>
<p><a href="https://cslacontrib.svn.codeplex.com/svn/branches/2010.11.001/MyCsla/3-6-3-N2/MyCsla/Validation/MyCommonRules.cs">https://cslacontrib.svn.codeplex.com/svn/branches/2010.11.001/MyCsla/3-6-3-N2/MyCsla/Validation/MyCommonRules.cs</a> </p>
<p>The StopIfNotCanWrite rule should look like this (included in the link above): </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:#fafafa;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Rule&nbsp;indicating&nbsp;whether&nbsp;the&nbsp;user&nbsp;is&nbsp;authorized</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;to&nbsp;change&nbsp;the&nbsp;property&nbsp;value.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Will&nbsp;always&nbsp;be&nbsp;silent&nbsp;and&nbsp;never&nbsp;set&nbsp;rule&nbsp;to&nbsp;broken.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;target&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Target&nbsp;object.</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;e&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">Rule&nbsp;arguments.</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;returns&gt;</span><span style="color:green;">true</span><span style="color:gray;">&lt;/returns&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;remarks&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Combine&nbsp;this&nbsp;property&nbsp;with&nbsp;short-circuiting&nbsp;to</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;prevent&nbsp;evaluation&nbsp;of&nbsp;other&nbsp;rules&nbsp;in&nbsp;the&nbsp;case</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;that&nbsp;the&nbsp;user&nbsp;isn&#39;t&nbsp;allowed&nbsp;to&nbsp;change&nbsp;the&nbsp;value.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/remarks&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;StopIfNotCanWrite(<span style="color:blue;">object</span>&nbsp;target,&nbsp;<span style="color:#2b91af;">RuleArgs</span>&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">bool</span>&nbsp;isAuthorized&nbsp;=&nbsp;<span style="color:blue;">true</span>;
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;business&nbsp;=&nbsp;target&nbsp;<span style="color:blue;">as</span>&nbsp;<span style="color:#2b91af;">BusinessBase</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(business&nbsp;!=&nbsp;<span style="color:blue;">null</span>&nbsp;&amp;&amp;&nbsp;!<span style="color:blue;">string</span>.IsNullOrEmpty(e.PropertyName))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isAuthorized&nbsp;=&nbsp;business.CanWriteProperty(e.PropertyName);
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(!isAuthorized)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.StopProcessing&nbsp;=&nbsp;<span style="color:blue;">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;rule&nbsp;should&nbsp;always&nbsp;return&nbsp;true&nbsp;(be&nbsp;silent)&nbsp;but&nbsp;will&nbsp;stop&nbsp;processing</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;if&nbsp;user&nbsp;cannot&nbsp;modify&nbsp;the&nbsp;value.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>And I would typically always add this rule with Priority = -1&nbsp; as this can be combined with DataAnnotationRules that are always added with Priority = 0 and unless specified rules is added with default Priority = 0. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Wednesday, October 31, 2012</h2><p>Ok, now I get it <img src="http://forums.lhotka.net/emoticons/emotion-2.gif" alt="Big Smile" /></p>
<p>It&#39;s the rule that check on the &quot;CanWriteProperty(..)&quot;, not the other way round.</p>
<p>This is much simpler than I was elaborating on my mind. I was thinking about inheriting RuleArgs to send some in/out info &quot;<strong>from</strong>&quot; the &quot;<strong>CanWriteProperty</strong>()&quot; and make the validation rule return some special ResultRuleArgs value to CanWriteProperty() in order to check if the property being evaluated is writeable.</p>
<p>Thanks also on the (-1) priority advice on this special rule hookup. You&#39;re right about DataAnnotations (<em>I completely forgot about them in this case...</em>).</p>
<p>And finally thanks for the link to the codeplex project. I&#39;ll check it out right now.</p>
<p>As usual, Jonny, your contribution is highly appreciated <img src="http://forums.lhotka.net/emoticons/emotion-2.gif" alt="Big Smile" /></p>
<p>Thanks,</p>
<p>Troncho</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Wednesday, October 31, 2012</h2><p>Just took the last whitespace from (%20) from the link you sent me, so it doesnt fail:</p>
<p><a href="https://cslacontrib.svn.codeplex.com/svn/branches/2010.11.001/MyCsla/3-6-3-N2/MyCsla/Validation/MyCommonRules.cs">https://cslacontrib.svn.codeplex.com/svn/branches/2010.11.001/MyCsla/3-6-3-N2/MyCsla/Validation/MyCommonRules.cs</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Friday, November 02, 2012</h2><p>Jonny, can I possibly enter directly to the source Codeplex project?</p>
<p>Thanx,</p>
<p>Troncho</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, November 02, 2012</h2><p>yes, you can download all the source from the Source tab.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Friday, November 02, 2012</h2><p>I&#39;ve downloaded file by file of the &quot;3-6-3-N2&quot; project. But I don&#39;t see a &quot;source tab&quot;.</p>
<p>I entered &quot;www.codeplex.com&quot; with my user and I don&#39;t seem to find the project either. </p>
<p>Is there any special link I should address?</p>
<p>Thanx,</p>
<p>Troncho</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Friday, November 02, 2012</h2><p>BTW, the <b>StopIfNotCanWrite </b>rule works PERFECT! Thanks again!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, November 02, 2012</h2><p>Goto this page and then select the download button: </p>
<p><a href="http://cslacontrib.codeplex.com/SourceControl/changeset/view/100173">http://cslacontrib.codeplex.com/SourceControl/changeset/view/100173</a></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Friday, November 09, 2012</h2><p>Thanks!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
