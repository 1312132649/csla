<html><header><title>DataPortalEvent Type</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortalEvent Type</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/792.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeanG posted on Wednesday, August 02, 2006</h2><P>Rocky / All</P>
<P>I have been working w/ 2.01 of the framework creating business objects based on an existing web&nbsp;app which has a rather&nbsp;'unique' database row locking mechanism. Due to this, I have the need to mark the object 'dirty' if the lock was achieved so that a call back to the database can remove the lock. Since I have created a base class that inherits from BusinessBase that the rest of my business object will descend from, this would be the appropriate place to do this, and I expect I would do this in an override of DataPortal_OnDataPortalInvokeComplete. I only want to do this if the event calling this method is the fetch. (I can also forsee needing to do other work for some of the other methods such as save.) Seems the DataPortalEventArg should include the method type (Fetch, Save, etc). Has there been any consideration to doing this, or am I going about this the wrong way. If this is an appropriate direction but is not implemented, I'd be more than happy to make the change and provide it. </P>
<P>Thanks in advance,</P>
<P>Dean<FONT size=1>.</FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, August 02, 2006</h2>I don't think this is a good approach, because if the user closes the app without saving, the record would be locked forever...<br><br>That said, you could simply call MarkDirty() at the end of your DataPortal_Fetch method and that would be it...<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeanG replied on Thursday, August 03, 2006</h2><P>Andres,</P>
<P>That&nbsp;is the intent, to call MarkDirty at the end of the Fetch. What I do not want to do is have to code that same call in each business object, rather I would like to ensure it is called by delegating it to the base class of my business objects. If the record is not marked dirty, then calling update would have no effect as there are no actual changes to the object, but I need to have it called so&nbsp;at least the lock would be removed.&nbsp;</P>
<P>Since we have the before and after events, I think it makes sense to include notification of what triggered the event.</P>
<P>True, if the user never calls delete (which frees the lock) or update (which saves&nbsp;any changes AND frees the lock) the lock would remain... until our database job that periodically scans for records that are locked but inactive removes said locks. This is the next thing I am intending to address.</P>
<P>Thanks,</P>
<P>Dean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 03, 2006</h2><P>Dean, you are right - it would be better to have more information passed to the pre and post data portal event handlers. I don't know if I'll be able to get that into 2.1 or not, but it is an enhancement that I want to do at some point.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
