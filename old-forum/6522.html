<html><header><title>At Wits End on Clean/Dirty within a Collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>At Wits End on Clean/Dirty within a Collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6522.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell posted on Thursday, February 26, 2009</h2>I've been working for several days on what seems like a basic problem. I have an editable collection of root objects. This collection is bound to a windows form list box. I select an item and in code grab a reference to an instance of the root object type. I then change one of the properties on the object. I have a checkbox bound to the isdirty property which switches on at that point as expected. I then do an applyedit to the object and then save it. At this point the isdirty flag turns off. All good.<br><br>However, when i select another item in the list box and then come back to selecting this original item it shows that it's marked dirty again. In fact, through testing, I've found that the item in the collection turns back to being marked isdirty as soon as I select another item. I feel like i must be missing something really obvious. Does anyone have any ideas on this before I tear the rest of my hair out? Thanks for all of the support.<br><br>Byron Crowell<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 27, 2009</h2>Don't call ApplyEdit on the BO itself. You must call it on the BindingSource to which the List is bound.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell replied on Friday, February 27, 2009</h2>Thanks for your input, but it turns out this has nothing to do with binding sources. After 2 days of experimenting I have observed the following.<br><br>1) I populate a businesslistbase collection with root businessbaseobjects<br>2) I grab a reference to any one of the objects in the collection through a separate instance.<br>3) I change a property on the this instance.<br><br>From this point on, if I apply edit and save the instance, I can turn get IsDirty top be false on the instance object. But the corresponding item in the collection can NEVER be made to turn IsDirty off. Even if I save the entire collection object with apply edit before hand, the item that was changed will remain dirty indefinately. This is true even when I remove all binding sources from the project so I don't think it's a databinding issue.<br><br>Is anyone knows how to change of fix this I would be greatful. I need to be able to get that collection to show the items as clean without a reload of the collection. <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, February 27, 2009</h2><P>BusinessListBase is designed to contain child objects, not root objects. It doesn't surprise me that a root object won't work properly when contained in a BLB.</P>
<P>If you want a collection of root objects, either create your own collection type or use EditableRootListBase (ERLB).</P>
<P>ERLB is designed to act as a container for root objects, where changes to each root object is committed as the user moves off a row in a Windows Forms, WPF or Silverlight data grid control. It may work in other scenarios, but this is the only scenario it is designed to support.</P>
<P>If you have a different scenario, you should consider creating your own collection type to contain the root objects so you can manage those objects according to the requirements of your scenario.</P>
<P>Please remember that the data portal can work on nearly any serializable data type. In other words, you can create a collection of root objects something like this (off the top of my head):</P>
<BLOCKQUOTE dir=ltr>
<P>[Serializable]<BR>public class MyRootList : List&lt;MyRootObjectType&gt;<BR>{<BR>&nbsp; public static MyRootList GetList()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;MyRootList&gt;();<BR>&nbsp; }</P>
<P>&nbsp; public MyRootList Save()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; return DataPortal.Update&lt;MyRootList&gt;(this);<BR>&nbsp; }</P>
<P>&nbsp; private void DataPortal_Fetch()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // load collection with root objects<BR>&nbsp; }</P>
<P>&nbsp; private void DataPortal_Update()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // save all root objects<BR>&nbsp; }<BR>}</P></BLOCKQUOTE>
<P>Obviously this implementation doesn't do anything fancy, but technically it should allow you to retrieve and save a collection of root objects. It won't support n-level undo, or fully support data binding, or pretty much anything else normally supported by BLB or ERLB, but it will support persistence through the data portal.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
