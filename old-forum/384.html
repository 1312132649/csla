<html><header><title>Images in the BO - Reference Path or BLOB ? (Smart Client)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Images in the BO - Reference Path or BLOB ? (Smart Client)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/384.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift posted on Thursday, June 15, 2006</h2>Hi, I just finished reading a couple posts having to do with a Smart Client with support for disconnected data.&nbsp; Sounds interesting - I'm thinking of using SQL Anywhere - so keep this in mind when you make any suggestions to my question please!<br><br>I have a little application where for one BO I need to have the user upload a photograph for the object.&nbsp; I am not sure how I should handle this in my Business model...&nbsp; When I designed the classes I built in a string field called "PhotoPath"&nbsp; which would be a reference to a directory on the server... Now I'm not sure what do do with this..&nbsp; in an ASP.NET page it would be a little simpler, but still, the concept of making your Business Objects manage the uploading and storing of a photograph is kind of interesting. <br><br>I went with a string field to reference a path, because I was trying to think of overhead.&nbsp; Would it be best to store this as a BLOB ? <br><br>Things get more complex in disconnected mode (a mode i still have to figure out - its my first disconnected smart client!) because I'd like to cache the images on the client as well - this may be easier with a BLOB field, because with a reference path I'd have to have a file directory on the users computer as well. <br><br><br>Any thoughts? <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>odie replied on Thursday, June 15, 2006</h2><P>brettswift,</P>
<P>My first app in CSLA a few years ago was document control program, though disconnected data was not really an issue.</P>
<P>I don't know if this was the best way to handle the images but this is what we did: (at least I will try and remember what I did)</P>
<P>All images were saved to an SQL database as a BLOB file as you are thinking of doing. The user selected the path and image file they wanted to attach. Then when the user saved the data I then went out and grabbed the image file(s) and stored them inside the BO as a filestream (before calling mybase.save). This had to be done while the BO is on the current users machine, if you used remoting once you got&nbsp;the server you would not have access to the image&nbsp;file&nbsp;the user wanted to attach.&nbsp;Once this was done I then called the BO's mybase.save as you would normally.</P>
<P>When a user loaded a record from the database I would not return the image, just the metadata. I had a seperate function for retrieving the image and storing it in a temporary directory on the users machine for their referece. The user had the option of viewing the image or signing out the image/record for their use to prevent modifications by someone else.</P>
<P>Once a record had been saved subsequent changes to the record ignored the image unless they wanted to overwrite the existing on on the server. This was to avoind unwanteded network traffic.</P>
<P>We also implemented a function to allow batch uploading of images to the server so the metadata could be entered first. This was due to the fact we were working with over 100,000 records. Each record was automatically assigned a Barcode number then when the image was scanned the file was named the barcode number which was used during the batch upload to know which file to attach the image to.</P>
<P>With .NET 2.0 there is a new feature to allow your images to be compressed prior to uploading to save space on the database.</P>
<P>Hope this helps,</P>
<P>RobO</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 15, 2006</h2>Sounds interesting, and sort of what I thought would have to happen. <br><br>You say you had "a seperate function for retrieving the image and storing it in a temporary directory on the users machine for their referece.".&nbsp; This function I'm assuming is at the GUI level, not on the client side BO correct?&nbsp; I'm guessing each time the BO ran, it would have to check for a local copy of the image, which if exists, would override the one from the DB - which makes things tricky when the user uploads a new image in place of the old one - or if another user does that, and all other users have an old cached version of it that won't update, because the image exists... hmm. . <br><br>Also, you say that changes to the record ignored the image property after it was uploaded.&nbsp; I'm guessing you did something like having a write-only boolean property called "OverwriteImage" so when your save method runs, it hits a condition and knows it has to save the image file as well ? <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>odie replied on Thursday, June 15, 2006</h2><P>The function for retrieving the image I wrote as a seperate kind-of get function within the actual BO that simply went out and grabbed the BLOB and returned it back to the user where it was then converted back into the original file. I had a default location where all images were put for viewing purposes only. Thus the user could not assume the file was the current version, just a reference. Thinking about in now once the program closed it cleaned out this temporary location to keep getting overloaded with un-needed images.</P>
<P>The check-out function was similar except it stored the image in a permanent location in the user's machine. The user who signed out the image had to ability to revise the image/metadata on the server which made a new revision (the old data was never overwritten for history purposes) and in fact the new image was given a new barcode number so you always know what version when with what metadata. BTW the program printed out barcodes that were then stuck onto the document being scanned so any time the image was printed you know what record it related to.</P>
<P>For downloading it was all in the user's hands to initiate the transfer. One other note,&nbsp;once a&nbsp;record was created and an image uploaded&nbsp;it could&nbsp;not be modified without first being checked out. Although we implemented a quick checkout/edit/checkback in option on&nbsp;the form to&nbsp;allow a correction of metadata&nbsp;all in one step, but images could not be modified (reattached) unless they first&nbsp;check them out.&nbsp;</P>
<P>As for your last question, I actually checked the file path field for a value. If the user never selected an image then this was blank and hence no image needed to be uploaded. We really were not interested in keeping track of where the file originally was uploaded from so this information was not stored in the database just it's name and extention.</P>
<P>When it came to viewing the file the program simply used shell (I think) with the path/filename and extension and I let Windows determine which program to use to view the file. This of course was called after the file was saved back to the user's computer.</P>
<P>I might suggest looking at maybe creating a command object for dealing with uploading and downloading of images and I would create a seperate field in your table like IsImageAttached if you need to ever query the database to find records that do/don't have an image attached. If you include the BLOB field you will be waiting a while as you database grows. Only deal with the BLOB field when you&nbsp;absolutely have to.</P>
<P>Regards,</P>
<P>RobO</P>
<P>PS. just noticed your in Calgary as am I.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 15, 2006</h2>Thanks for your tips. <br><br>Haven't noticed any other Calgarians on here.&nbsp; Actually this is just a project I'm working on for a family friend, might get them to give me a chunk of cash for it we'll see haha.&nbsp;&nbsp; Currently looking for work right now, so this is pretty much the first CSLA project I've done.&nbsp;&nbsp; Does your company use CSLA ? Or are you a contractor and use it yourself with clients? <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>odie replied on Thursday, June 15, 2006</h2><P>I've had a several people contact me lately looking for developers maybe I can direct you to them for work.</P>
<P>I sent you my contact info in a private post...</P>
<P>Regards,</P>
<P>RobO</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jwooley replied on Tuesday, June 27, 2006</h2><P>As an answer to your subject line, I would offer None of the above. Here's an overview of the solution I have used:</P>
<P>The business object contains some metadata about the file (who uploaded it, when it&nbsp; was uploaded, file size, etc). It also contains a property which is a Byte Array containing the actual contents of the blob. This array is lazy loaded from some data source which would need to use the same distributed domain boundaries as my application, and thus pumped&nbsp;through the DataPortal.</P>
<P>Originally I wrote it with a blob in the database. Since the files I was pumping into this were 200+ page Mortgage packages, putting 25meg&nbsp; blobs in the database each time got to be a strain on the database server (and was part of the reason why I lazy loaded the byte array). Eventually I decided it would be better to move the contents of the blob data to another location. I decided to extract the files to an FTP store with guid file names on the actual data store. To make the change, I only needed to modify a couple methods in the BO (the lazy loaded command object and the dataportalUpdate).There were no changes to the UI as it just interacted with the same byte array. To display the data back to the user, I just stick it in a temporary file store and launch it with the approprate editor as necessary.</P>
<P>I have had no problems with that implementation since I deployed it while I have added 3 gig to the store. The database hums along now rather than choking on the re-indexing while resizing the database. There is an old demo of the blob method available at <A href="http://avbsg.net/Uploads/FileManCSLA.zip">http://avbsg.net/Uploads/FileManCSLA.zip</A></P>
<P>Jim Wooley<BR><A href="http://devauthority.com/blogs/jwooley/default.aspx">http://devauthority.com/blogs/jwooley/default.aspx</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
