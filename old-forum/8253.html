<html><header><title>No null strings allowed by &quot;SetProperty&lt;P&gt;(PropertyInfo&lt;P&gt;, P, Security.NoAccessBehavior)&quot;</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>No null strings allowed by &quot;SetProperty&lt;P&gt;(PropertyInfo&lt;P&gt;, P, Security.NoAccessBehavior)&quot;</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8253.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Friday, January 01, 2010</h2>Hi<br /><br />I was looking at the:<br /><br />SetProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo, P newValue, Security.NoAccessBehavior noAccess)<br /><br />Method code just now and noticed the following chunk of code in there:<br /><br />if (typeof(P) == typeof(string) &amp;&amp; newValue == null)<br />    newValue = Utilities.CoerceValue&lt;P&gt;(typeof(string), null, string.Empty);<br /><br />Interesting I thought, so I decide to experiment and created a little example, here are the gist of the example:<br /><br />------------------------------------------------------------------<br />private static PropertyInfo&lt;string&gt; XyzProperty = RegisterProperty&lt;string&gt;(c =&gt; c.Xyz, string.Empty, null);<br /><br /><br />public void DoIt()<br />{<br />    SetProperty&lt;string&gt;(XyzProperty, null, NoAccessBehavior.ThrowException);<br />    Console.WriteLine(&quot;Am I null??? &quot; + (ReadProperty(XyzProperty) == null));<br />}<br /><br />------------------------------------------------------------------<br /><br />The console result will be: &quot;Am I null??? False&quot;<br /><br />One would expect that having a string property with a default value of null would be able to accept a null string value but this does not appear to be the case. Turns out, that the end value of the property will be changed empty string.<br /><br />Now I do realize that the CSLA descourages the user of null values for strings in favor of empty string but I though it was up to the user to decide.<br /><br />Thanks.<br /><br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, January 01, 2010</h2><P><FONT size=2 face=Tahoma>I think this was done because most UI controls don't do well with null-string property values.&nbsp; (Most of them don't do well with&nbsp;any type of null-value property...)&nbsp; It also brings up the question of whether a null string is different from an empty string.&nbsp; I know that technically they are, but from a user experience I'm not sure - e.g. what's the difference between no description and an empty description?&nbsp; I think it's a little different from something like a numeric field, where there potentially could be a difference between no value and a 0 value...</FONT></P>
<P><FONT size=2 face=Tahoma>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 01, 2010</h2><P>That is exactly correct. The helper methods in CSLA (like SetProperty()) eliminate null string values because they tend to cause data binding to fail. If CSLA didn't do this, 99% or more of all property getter/setter code would need additional code to remove the null values.</P>
<P>If you really need to reflect a null string as different from an empty string then you won't be able to use the helper methods. That's OK - everything the helper methods do for you, you can do yourself - SetProperty() just calls a bunch of protected methods in the end.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Saturday, January 02, 2010</h2>Well, I am obviously missing something very obvious here.  The problem is that the behavior is exhibited by the SetProperty method, not the GetProperty method.<br /><br />Why would the framework care at all about storing a null string as a string.Empty? The framework could easily store the string as null and don’t have any problems at all correct?<br /> <br />If we were to rewrite the example above and we only executed the:<br /><br />Console.WriteLine("Am I null??? " + (ReadProperty(XyzProperty) == null));<br /><br />The console result will be: "Am I null??? True”<br /><br />Now that would be bad news for the UI since we are returning a null. Would it not make more sense to helper method to return a string.Empty when we are *reading* more than when we are *writing* to the framework? Or if anything, should we not be doing the conversion in both places?<br /><br />And by the way, I don’t have a need to distinguish between null and an empty string, I was just bored and decided to peek inside the CSLA code just for fun and that is when I found this. I am simply curious.<br /><br />Thanks.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
