<html><header><title>need function for &quot;are any in this subset of rules broken&quot;?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>need function for &quot;are any in this subset of rules broken&quot;?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7130.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>matt tag posted on Thursday, June 18, 2009</h2><font size="1" face="Verdana">I have several complex objects that share some common traits:<br><br>ID (primary key in the database, Guid)<br>Name (string property)<br>Category (string property, acts as a grouping mechanism when viewing the names)<br>IsPublic (viewable by only you or everybody)<br><br>I wanted to use a common UI form to edit these properties for all of the object types.&nbsp; Sounds like an Interface, correct?<br><br>Public Interface IPreflistName<br>&nbsp;&nbsp;&nbsp; ReadOnly Property ListID() As Guid<br>&nbsp;&nbsp;&nbsp; Property ListName() As String<br>&nbsp;&nbsp;&nbsp; Property ListCategory() As String<br>&nbsp;&nbsp;&nbsp; Property IsPublicList() As Boolean<br><br>&nbsp;&nbsp;&nbsp; ReadOnly Property IsValid() As Boolean<br>&nbsp;&nbsp;&nbsp; ReadOnly Property IsDirty() As Boolean<br>&nbsp;&nbsp;&nbsp; Sub BeginEdit()<br>&nbsp;&nbsp;&nbsp; Sub ApplyEdit()<br>&nbsp;&nbsp;&nbsp; Sub CancelEdit()<br>End Interface<br><br><br>The only problem I have is the IsValid.&nbsp; I don't actually want this interface to tie to the CSLA IsValid properly, because there may be other broken rules on the object that have nothing to do with the object's name/category.&nbsp; What i need to do is rename this property to something like NameIsValid, and then within the classes, I need to be able to say&nbsp; "if this rule is broken or that rule is broken, return false".<br><br>Can I pick certain rules out of my class in this way?<br><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, June 18, 2009</h2>I needed to do something like this so I added this method to a utility class which all of my BOs can call:<br /><br />===============================<br />Public Shared Sub ClearBrokenRules(ByVal ruleCollection As Csla.Validation.BrokenRulesCollection)<br />      For i As Integer = ruleCollection.Count - 1 To 0 Step -1<br />        Dim brokenRule As Csla.Validation.BrokenRule = ruleCollection.Item(i)<br />        ruleCollection.Remove(brokenRule)<br />      Next<br />    End Sub<br /><br />===============================<br />It required adding a change to CSLA though:<br /><br />//Change to Validation.BrokenRulesCollection class: <br />    //JF 6/28/07 - need a Public way to clear broken rules other than by calling CheckRules.<br />    public void Remove(BrokenRule rule)<br />    {<br />      // we loop through using a numeric counter because removing items in a foreach isn't reliable <br />      IsReadOnly = false;<br />      for (int index = 0; index       {<br />        if (this[index].RuleName == rule.RuleName)<br />        {<br />          DecrementCount(this[index]);<br />          RemoveAt(index);<br />          break; <br />        }<br />      }<br />      IsReadOnly = true;<br />    }<br /><br />===============================<br />Then in a BO that contains other BOs I can use code like this:<br /><br /> Public ReadOnly Property IsSubsetValid() As Boolean<br />      Get<br />        'check all rules<br />        ValidationRules.CheckRules()<br />        Return GetSubsetOfBrokenRules<br />End Property<br /><br />Public Function GetSubsetOfBrokenRules() As String<br /> 'remove broken rules from other objects in the graph<br />      ClearUnrelatedBrokenRules()<br />      Return Me.GetAllBrokenRulesString<br />End Function<br /><br />'clear rules from a contained BO and its children<br />Private Sub ClearUnrelatedBrokenRules()<br />  Util.ClearBrokenRules(mContainedBO.BrokenRulesCollection)<br /><br />For Each obj As SomeBO In mContainedBO.Coll<br />  Util.ClearBrokenRules(obj.BrokenRulesCollection)<br />Next<br />End Sub<br />===============================<br /><br />Joe<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
