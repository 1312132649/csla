<html><header><title>Object.IsSelfValid is always returns True/ Me.ValidationRules.CheckRules()</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Object.IsSelfValid is always returns True/ Me.ValidationRules.CheckRules()</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9591.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ram007 posted on Thursday, September 30, 2010</h2><p>Hi,</p>
<p>I have EditableRootObjectA which has EditableChildObjecB. I am adding an item to EditableChildObjecB and saving the EditableRootObjectA , before saving I am checking object.IsSelefValid it always returns True and executing the DataPotal_Update, I tried to debug this issue and found that if I call Me.ValidationRules.CheckRules() in&nbsp;&nbsp;EditableRootObjectA&nbsp; constructor , then it cheks the validation rules and displaying the brokenrules information and also the IsSelefValid return false. </p>
<p>I just want to see is there any otherway to check the validation rules apart from calling from constructor.</p>
<p>&nbsp;#Region &quot;Contructor(s)&quot;</p>
<p>&nbsp;&nbsp;&nbsp; Private Sub New()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ValidationRules.CheckRules()<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>#End Region</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, September 30, 2010</h2><p>Calling this in the constructor isn&#39;t really safe, because the first instance of your type may not have any rules when this runs in some cases.</p>
<p>You should be using the data portal to create instances of your type, and then you should call CheckRules in the DataPortal_Create/Fetch methods.</p>
<p>In fact, in 3.8 and higher, the default implementation of DataPortal_Create does this for you, so by default when you create a new instance of a type through the data portal the rules are automatically run.</p>
<p>This is why I recommend (in .NET) that all business types have a non-public default constructor - to force the use of the data portal.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ram007 replied on Friday, October 01, 2010</h2><p>Ok, We are using version 3.8.2.0, As you mentioned the DataPortal_Create does this, but DataPortal_Fetch is not calling the CheckRules so I assume we have to call &quot; Me.ValidationRules.CheckRules() &quot; in the DataPoratl_Fetch otherwise while saving RootObject the IsSelfValid always returns true and not cheking the validationrules. </p>
<p>Please confirm.</p>
<p>Private Shadows Sub DataPortal_Fetch(ByVal criteria As SingleCriteria(Of User, System.Int32))<br />&nbsp;Map(reader) &#39;assume reader code is above<br />&nbsp;Me.ValidationRules.CheckRules()<br />End Sub</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Friday, October 01, 2010</h2><p>&gt;&gt;&nbsp;but DataPortal_Fetch is not calling the CheckRules &lt;&lt;</p>
<p>I believe that is correct. I think the assumption is data in the database is valid so don&#39;t need to run validation rules. As you mention you can run the CheckRules when needed.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, October 01, 2010</h2><p>Right, Fetch doesn&#39;t call CheckRules by default, because (I think) most people don&#39;t want to automatically run all their rules when loading data from the database - that&#39;s a very possible perf issue.</p>
<p>But if you need to run the rules, that&#39;s fine - just call CheckRules at the end of Fetch.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ram007 replied on Saturday, October 02, 2010</h2><p>Ok, The reason for calling in the DataPorta_Fetch is when updating the rootobject DataPorta_update is not validationg the rules if I don&#39;t call checkrules in Fetch. Another question the DataPortal_Update should CheckRules by default , right? The DataPortal_Update is not checking rules if there is change in child and updating the root.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, October 02, 2010</h2><p>DataPortal_Update does not call CheckRules by default. Only Create does this.</p>
<p>If you are in an n-tier model running on a corporate LAN, most people wouldn&#39;t recheck the rules on the server, trusting that they were checked on the client and that Save() wouldn&#39;t have even allowed a call to the server if there were any broken rules.</p>
<p>The most typical scenario is one where we trust that if the client checked the rules we don&#39;t need to recheck them on the server. This is because to bypass the normal processing, a would-be hacker would need to either hack into the client side appdomain, or use a packet sniffer to capture, rewrite and replay the data portal service calls. So in no case are we defending against normal users or developers.</p>
<p>If you are actually worried that the client won&#39;t run the rules, then a cheap solution is to call CheckRules at the start of your Insert/Update/Delete methods on the server. But my <i>recommendation</i> is that if you don&#39;t trust the client, then you should switch to an SOA architecture - which is much more expensive, but is the correct solution when dealing with a scenario where you honestly think the client and/or network will be hacked.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
