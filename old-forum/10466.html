<html><header><title>MVC Unit Testing</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>MVC Unit Testing</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10466.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lacota posted on Sunday, June 26, 2011</h2><p>I just finished reading the MVC 3.0 book and was wondering about the best way to Unit Test the MVC controllers. IoC seems to be the recommended way of doing this but how would that work with the business object factory methods? Should we be using&nbsp;a viewmodel to decouple the model from the controller?&nbsp;Ideally it would be as easy to use as the dataaccess unit testing solution. Has anyone tried implementing this?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Sunday, June 26, 2011</h2><p>You can create an IBoFactory interface.&nbsp; An instance of this interface can be mocked for your unit tests, and and real implementation would just be a wrapper to call the static methods.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lacota replied on Sunday, June 26, 2011</h2><p>We already have the IViewModel interface which would likely work well enough for this case. I could override the default constuctor and pass in my business object filled with mock data. But how do I do that? Do I have different assemblies, one for real data and one for mock data that I point to as with the DataAccess approach? Or can I simply use a single ViewModel with the difference being the default parameterless constructor creates a real business object while another contructor accepts a business object as an argument? I am leaning towards this last approach. I&#39;ll be trying it out Monday.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lacota replied on Monday, June 27, 2011</h2><p>I&#39;ve created a ViewModel using the ViewModelBase class and use this to call my business objects static methods or use an&nbsp;injected object, for example. </p>
<p>var controller = new MyObjectController(new MyObjectViewModel(MyObjectItemList.Get()));</p>
<p>The problem I now have is with the following code in the Controller;</p>
<p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff">
<p>return View();</p>
</font></font></font></span></span></span></span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff">
<p>&nbsp;</p>
</font></font></span></span></span></span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><font face="Consolas" size="2" color="#0000ff">
<p>&nbsp;</p>
</font></span></span></span></span></span></span></span>
<p>&nbsp;</p>
<p>I get the following Error:</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Attempt by method &#39;WebApplication.Controllers.MyObjectController.List()&#39; to access method &#39;System.Web.Mvc.Controller.View()&#39; failed.</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">There is no inner exception. Anyone else run into this?</span></span></p>
</span></span></span></span></span></span></span></span></span></p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lacota replied on Monday, June 27, 2011</h2><p>Additional Info:</p>
<p>It appears as though the controller.Model is null. This is true even after setting the model to my business object. I am suspecting that my mock is not properly creating the httpContext of the controller. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lacota replied on Tuesday, June 28, 2011</h2><p>This appears to be a bug in the Csla.Web.Mvc.Controller. When I replace the base class on my controller with the System.Web.Mvc.Controller I am able to assign my business object to the model and the test passes. This only happens during unit testing. </p>
<p>As this is a separate issue from my original post I am going to create a separate thread for it.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
