<html><header><title>Best Criteria practices</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best Criteria practices</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/214.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Aliator posted on Sunday, May 28, 2006</h2>Hi,<br><br>I wonder what is the best method for handling multiple criteria for on object...<br><br>I have a list of items that I want to filter by category in my frontend... So I only have to pass the Id of the category to my list object...<br><br>But in backend, I&nbsp; need to have all the categories in the list... From object view is simple, I overload my GetObjectList to accept an id or to accept nothing... <br><br>But, how do you handle in DataPortal_Fetch ?<br><br>Do you analyze Criteria object and then use SP_WithIdParamater or SP_WithoutParameter ?<br><br>Or do you manage this in the SP itself ?<br><br>TIA<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Sunday, May 28, 2006</h2>If it is as simple as this I would use 1 stored proc but I don't think there is a big difference either way. If you start needing many different criteria for complicated queries there are many posts in the old forum about this with several different strategies.. You may want to search at www.searchcsla.com for "complex" and "criteria" and browse.<br><br>Dean<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Sunday, May 28, 2006</h2><P>I am sure there are many ways to handle this.&nbsp;Here is what I have done, and it has worked well.</P>
<P>In the StoredProc:<BR>Each of the arguments has a default value, like Null or "" or 0 etc.&nbsp; Then in the where clause, I check to see if an argument has default value before using in the expression like:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where ((@ID is Null) or (Person_Id = @ID))</P>
<P>In DataPortal_Fetch:<BR>I check each optional parameter for a default value before calling AddWithValue() for that parameter.&nbsp; This assures that in the SP only the arguments I send will be evaluated against.</P>
<P>In Criteria Class:<BR>Each instance variable is assigned a Default Value which I check against in the DataPortal_Fetch.&nbsp; If no value is assigned in the Criteria Constructor, the default will be automatically sent.</P>
<P>In the Shared GetList method(s):<BR>I create either Overloads or use Optional Arguments to send exactly what the criteria need.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>miroslav replied on Monday, May 29, 2006</h2>I've used a similar approach as Jav. The only difference is that my Where clause looks like this:<br><font face="Courier New">WHERE Person_Id = ISNULL(@ID, Person_Id)</font><br><br>... but the result is the same.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Aliator replied on Tuesday, May 30, 2006</h2>Thank you for the tips...<br><br><a href="http://www.searchcsla.com/">www.searchcsla.com</a> was very helpfull too.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dog Ears replied on Thursday, May 31, 2007</h2><P><FONT size=2>Just stumbled across this old(ish) post, thought i'd add something for completeness.</FONT></P>
<P><FONT size=2>Something like the above SQL would be non-SARGable [on SQL2K&nbsp;at least] I played around with the following and the second SQL took 600 times longer [although they both returned data within a second..! but if you scale up..?!?!]</FONT></P><FONT color=#0000ff>
<P><FONT size=2>declare</FONT></FONT><FONT size=2> @id <FONT color=#0000ff>int</FONT> <BR><FONT color=#0000ff>set</FONT> @id <FONT color=#808080>=</FONT> 254765<BR><FONT color=#0000ff>select</FONT> <FONT color=#808080>*</FONT> <FONT color=#0000ff>from</FONT> tblshiftrecords <FONT color=#0000ff>where</FONT> shiftid <FONT color=#808080>=</FONT> @id <BR><FONT color=#0000ff>select</FONT> <FONT color=#808080>*</FONT> <FONT color=#0000ff>from</FONT> tblshiftrecords <FONT color=#0000ff>where</FONT> shiftid <FONT color=#808080>=</FONT> <FONT color=#ff00ff>isnull</FONT><FONT color=#808080>(</FONT>@id<FONT color=#808080>,</FONT> shiftid<FONT color=#808080>)</FONT> </FONT></P>
<P><FONT size=2>The table here has is quite small only abut 300K records and shiftid is the Clustered primary key.</FONT></P>
<P><FONT size=2>The first SQL performs a SEEK the second a SCAN...!</FONT></P>
<P><FONT size=2>This could be an important consideration when chosing a solution,</FONT></P>
<P><FONT size=2>Regards,</FONT></P>
<P><FONT size=2>Graeme.</FONT><FONT size=1></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Thursday, May 31, 2007</h2><P>Hey Dog Ears, thanks for that post.&nbsp; I didn't realize that the SQL optimizer will never bother looking for an index to use with isnull() or coalesce().</P>
<P>I did know that you also have a similar potential performance problem creating a stored procedure that just creates a dynamic ad hoc query string and executes it, since SQL Server can't cache an execution plan for the sproc.</P>
<P>This is all part of why I've never really bought into the idea of jumping through all these hoops to be able to mandate the use of sprocs for all reading of data, but that's just my opinion.</P>
<P>BTW, does SQL 2005 have any functionality whereby if you change a column name it will tell you all the sprocs you just broke (or change them)?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rdrunner replied on Wednesday, June 06, 2007</h2><P>Hello....</P>
<P>&nbsp;</P>
<P>About the performance issue...</P>
<P>&nbsp;</P>
<P>You should never use a function&nbsp;or calculate with a field from a table. This will void all indexes and every record has to be evaluated so this will result in an index or table scan like already posted.</P>
<P>Example (Showing last weeks orders):</P>
<P>... Where orderdate + 7 &gt; getdate (No index can&nbsp;be used. The calculation needs to be done for every record)</P>
<P>... Where orderdate&nbsp;&gt; getdate -7 &nbsp;(Index can&nbsp;be used.Calculation only needs to be done once)</P>
<P>Or how to solve an "optional" Filter field:</P>
<P>where (myParam is null OR myfield = myParam)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 06, 2007</h2>I wouldn't say "never."&nbsp; I have a few views that are include a function call in the select clause, and the performance is still very fast.<br><br>You do have to be careful though, it depends on what the function does.&nbsp; We did run into a case where a function in the select clause was slow enough to cause problems.<br><br>As for the where clause, I would take your second clause and use a variable there that stores the result of getdate - 7, that way the calcuation is done only once and its just a compare. Also, I'm not sure that if you have a long enough running query that getdate won't start returning different values as the result set is built.&nbsp; If the -7 is the number of days, its not problem, but if its milliseconds you may have a problem..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>yimiqi replied on Saturday, June 02, 2007</h2><P>I also wanted to search some info on <A href="http://www.searchcsla.com">www.searchcsla.com</A> site, but it doesn't have a search feature (or i missed it somehow), instead on the main page it says </P>
<P><STRONG>This site is a tool --- use it in conjunction with your telephone conference calls.</STRONG></P>
<P>How do I do search&nbsp;on this site (I know it sounds a pretty strange question)?&nbsp; Thanks.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Sunday, June 03, 2007</h2>It looks like someone has taken over the domain.&nbsp; I think that site used to search the old msn forum.&nbsp; Just use the search box in the top right corner of any page on this site.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
