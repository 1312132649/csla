<html><header><title>Use a local database is a remote connection is unavailable.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Use a local database is a remote connection is unavailable.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10149.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr posted on Wednesday, March 09, 2011</h2><p>This is a general question as I have not seen an answer anywhere (at least so far) and thought I may get a jump on something that I know will have to be addressed.</p>
<p>We have an situation with the program I am working on where it will normally connect to a remote database (SQL Server). However some users do not have internet access and the program also needs to function if they loose internet connection or the remote server goes down.</p>
<p>What we want to do is&nbsp; attempt to connect to the remote server and if the connection can not be established use the local database (when connected via remote an FTP background thread will download an updated local copy of the companies data if needed). </p>
<p>We will provide an option that if the remote connection fails that the user can select to always use the local database (for those without internet connections) or to use the local database for this session only.</p>
<p>Any ideas on how this can be accomplished would be greatly appriciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>tmg4340 replied on Wednesday, March 09, 2011</h2><p>This has been discussed a few times on the forum...</p>
<p>The easiest model to use is sometimes referred to as &quot;the Outlook model&quot;.&nbsp; Basically, everything is local, as far as your app is concerned.&nbsp; You write everything to a local database, and then you have a background process/thread/separate service that syncs up your local database with your remote one.&nbsp; Microsoft provides an SDK to help manage this if you want - just look for the Sync Framework/Sync Services (one of those names should get you what you want).&nbsp; In CSLA terms, you would use a local DataPortal which would write to a SQLCE database (or SQL Express, if you can get it on the client), and then the Sync Services framework would automatically sync your local database with the remote one.&nbsp; I believe they have even included some code to re-try if a network connection is available.&nbsp; If not, it&#39;s a relatively simple matter to write that.&nbsp; You have to do some setup to your database to make the sync work, but from what I remember it&#39;s pretty minimal.</p>
<p>If Sync Services won&#39;t work, then you do have another option, though you&#39;ll end up replicating a lot of what Sync Services would do.&nbsp; You can treat your app in a SOA-style fashion.&nbsp; You again use a local DataPortal, and in your DP_ methods you determine whether a network connection is available.&nbsp; If so, you call out to a WCF service to update your database/get data/whatever you need.&nbsp; If not, then you deal with it locally, either using a local database or some kind of message serialization scheme.&nbsp; You still have to deal with synchronizing the local data when a connection does become available.&nbsp; You also lose some of what CSLA does for you, since in this scenario you&#39;re responsible for managing the CSLA object state.&nbsp; I think Rocky covers some of this in the Data Access e-book he&#39;s working on (or will if he hasn&#39;t already).</p>
<p>Note that neither of these options use the remote DataPortal.&nbsp; I think that version 4 allows for some kind of &quot;custom pipeline creation&quot; for the DataPortal processing, but I don&#39;t think you can use that to get what you want.&nbsp; But I admit that I haven&#39;t really looked into it, so I might be wrong there.&nbsp; If you can do it entirely within the CSLA DataPortal pipeline, that might make some things easier.</p>
<p>Regardless of how you solve the sync problem, you do have to do some sort of local caching of data, from the basic lookup lists to the actual data the user works with.&nbsp; How you manage that, and how you refresh that data, is a separate question.&nbsp; From a Sync Services perspective, you should be able to let the framework do much of that for you.&nbsp; Anything else requires that you roll your own solution.</p>
<p>HTH</p>
<p>- Scott</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
