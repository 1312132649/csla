<html><header><title>BrokenRulesCollection for Root and Children, ISupportBrokenRules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BrokenRulesCollection for Root and Children, ISupportBrokenRules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5532.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JeroenEikmans posted on Saturday, October 04, 2008</h2>Hi,<br><br>I wanted to create a 'generic' way of accessing the BrokenRulesCollection of an editable root and all of it's children. I'm overriding the BrokenRulesCollection of the root. This is roughly the idea:<br><br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public override BrokenRulesCollection BrokenRulesCollection<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BrokenRulesCollection brokenRules = BrokenRulesCollection.CreateCollection();<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // merge the brokenrules of this<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; brokenRules.Merge("??", base.BrokenRulesCollection);<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // merge the brokenrules of the children<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; List&lt;object&gt; children = this.FieldManager.GetChildren();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; foreach (object child in children)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // child could be an editable object<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (child is IEditableBusinessObject)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ISupportBrokenRules editableBaseEntity = child as ISupportBrokenRules;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (editableBaseEntity != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // recursive call to BrokenRulesCollection<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; brokenRules.Merge("??", editableBaseEntity.BrokenRulesCollection);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // child could be an editable collection<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (child is IEditableCollection)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IList list = child as IList;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; for (int index = 0; index &lt; list.Count; index++)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ISupportBrokenRules editableBaseEntity = list[index] as ISupportBrokenRules;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (editableBaseEntity != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // recursive call to BrokenRulesCollection<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; brokenRules.Merge("{0}.{1}[{2}]".FormatWith("??", "??", index), editableBaseEntity.BrokenRulesCollection);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return brokenRules;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br><br>You see there is a cast to ISupportBrokenRules because the GetChildren returns a list of objects. The definition is:<br><br>&nbsp;&nbsp;&nbsp; public interface ISupportBrokenRules : ITrackStatus<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BrokenRulesCollection BrokenRulesCollection { get; }<br>&nbsp;&nbsp;&nbsp; }<br><br><br>It would be nice to have the ISupportBrokenRules interface defined by the CSLA framework and not by me. Or is there an interface that already does this?<br><br>Maybe there's a smarter way to achieve what I'm doing here alltogether. Any opinions?<br><br>thanks,<br>Jeroen<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, October 04, 2008</h2><P>I have posted a complete working solution to this before:<BR><A HREF="/forums/post/7444.aspx">http://forums.lhotka.net/forums/post/7444.aspx</A></P>
<P>It may be a bit out of date now that CSLA has added so much extensibility. But you can review it for ideas.</P>
<P>HTH</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JeroenEikmans replied on Sunday, October 05, 2008</h2>Thanks for your link to the other post. Your solution builds a complete BrokenRulesCollection for all invalid children, including the ones in editable collections. That's nice, I can use that. <br><br>For now I only want to build a BrokenRulesCollection that is a 'result' of a call to the IsValid property of the root, so including only the invalid children and the first invalid children in editable collections.<br><br>When the root is not valid, I just want to check the BrokenRulesCollection of the root to see why the root is not valid.<br><br>thanks,<br>Jeroen<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrankM replied on Tuesday, October 14, 2008</h2>How about&nbsp; <br><blockquote>foreach ( var child in children)<br>{ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child is BusinessBase)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; brokenRules.Merge("??", ((BusinessBase)child).BrokenRulesCollection);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br></blockquote>I am doing the similar stuff.<br><blockquote><br></blockquote></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Wednesday, October 15, 2008</h2>Jeroen,<br><br>Like Joe, I too posted a workable solution with an example that I did some time ago.<br><br><a>http://forums.lhotka.net/forums/thread/21880.aspx</a><br><br>John<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
