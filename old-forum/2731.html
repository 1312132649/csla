<html><header><title>Undo not working right (and yes I have unique Ids)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Undo not working right (and yes I have unique Ids)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2731.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ABecerra posted on Wednesday, April 18, 2007</h2>Here is the basic scenario... I have a simple form which has a listbox, databound to a SortedBindingList&lt;&gt; of my objects. Each object is my own rule object. The listbox is used to display the rules and there are up/down arrows for the user to move the rules up and down the list (altering the priority order of the rules).<br><br>When the UI first displays, I output some debug info (this is before any edits are made, so I have not called BeginEdit at this point.<br><br>Rule priorities...Initial setup (NO call to BeginEdit yet)<br>Rule Id: 71, Priority: 1<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 3<br><br>Below, the user clicked rule 73, and moved it up. I call BeginEdit to start swapping the priority order...<br>Rule priorities...moved up 1<br>Rule Id: 71, Priority: 1<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 3<br><br>And then call begin edit to finish swapping the priority order.<br>Rule priorities...moved up 2<br>Rule Id: 71, Priority: 1<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 2<br><br>Here, the user moved rule 73 up again. I call BeginEdit to start swapping the priority order...<br>Rule priorities...moved up 1<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 2<br><br>And then call begin edit to finish swapping the priority order.<br>Rule priorities...moved up 2<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 1<br><br>But when the user clicks cancel, I try to cycle through to call CancelEdit the same number of times BeginEdit was called. But the priorities do not get undone properly. As you can see from the debug messages, CancelEdit is not at all doing what it should. What am I doing wrong?<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 3<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 1<br>Rule priorities...Cancel clicked, CancelEdit called<br>Rule Id: 71, Priority: 2<br>Rule Id: 72, Priority: 2<br>Rule Id: 73, Priority: 1<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 18, 2007</h2><P>Remember, Windows Forms data binding <EM>will call BeginEdit/CancelEdit/EndEdit</EM> on your behalf. This happens <EM>whether or not</EM> you call BeginEdit by hand. It is unavoidable.</P>
<P>So if you are <EM>also</EM> calling BeginEdit, etc. without understanding that data binding is calling the methods too - then you are in for a world of confusion and hurt.</P>
<P>You really might need to call BeginEdit yourself, on the collection. But if so, you <EM>must do it before setting up data binding</EM>. Otherwise data binding will have already called BeginEdit on the current row (whichever one that is) and confusion will result.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ABecerra replied on Thursday, April 19, 2007</h2><P>Thank you for the response. I am in a bit of time crunch, so I opted to not use data binding and the sortedBindingList for this simple UI screen and manually add my items to the listbox and manually sort based on the user clicking up/down buttons. I will revisit when I have more time and will add an example here for other people.</P>
<P>Thanks,</P>
<P>Andres</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
