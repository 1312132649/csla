<html><header><title>Clone method &quot;losing&quot; business rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Clone method &quot;losing&quot; business rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7805.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham posted on Friday, October 16, 2009</h2><P>I am using 2005 (Visual Studio, .NET and CSLA).</P>
<P>I have a business object (which is a grandchild but I don't think that matters) that has 8 instance rules added every time it's insantiated (via the AddInstanceBusinessRules override).&nbsp; There is a 9th instance rules that is added sometimes (depending on other data).</P>
<P>The problem occurs when the 9th rule IS part of the business object and it is saved.&nbsp; The Clone method seems to create a clone object that only has the 8 instances rules and not the 9th.</P>
<P>Is this by design?&nbsp; Is there a workaround?</P>
<P>Any info would be greatly appreciated!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Saturday, October 17, 2009</h2><P>CLSA clones by serializing and then deserializing the object. So, nothing marked as [Nonserialized] is cloned except that which is restored in OnDeserializedHandler. This includes the instance business rules.</P>
<P>However, it turns out that OnDeserializedHandler does call AddInstanceBusinessRules again. So, what you'll need to do is handle your "special" data related case in your AddInstanceBusinessRules method. (If you're already adding your 9th rule here, then I'm mistaken somewhere)</P>
<P>The issue I had was that AddInstanceBusinessRules is initially called in the BusinessBase constructor, so it can't do anything special based on the content of a derived class. </P>
<P>However, this is possibly not the case when OnDeserializedHandler is called, as I'd think the derived class properties are in place at that time, so you could test for your special case and add the extra rule. (This would mean AddInstanceBusinessRules would act one way when the object is initially constructed and differently when called from OnDeserializedHandler)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Monday, October 19, 2009</h2>I had wondered if that had something to do with it.&nbsp; Thanks for confirming!&nbsp; I was reading some other posts and went one better and made it a type rule instead of an instance rule.&nbsp; The type rules checks the special data prior to checking the actual rule.&nbsp; Thanks for your guidance!!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
