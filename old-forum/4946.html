<html><header><title>Business Object - Required Fields</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business Object - Required Fields</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4946.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Aver posted on Friday, June 06, 2008</h2>Hello All,<br>&nbsp;&nbsp; This is my first project using CSLA.net and I love this architecture. This is exactly what I needed coming from my CS Object Oriented background into the wonderful relational database business software world.<br><br>My question is in regards to the proper approach to take with business objects that have required fields. I am making a Employee object that has 3 required fields in the database. You can see the table definition below. I created the following methods:<br><br><div>public static Employee NewEmployee(string FirstName, string LastName,string EmployeeNumber)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Create&lt;Employee&gt;(new Criteria(FirstName,LastName,EmployeeNumber));<br>}<br><br>&nbsp;[RunLocal()]<br>protected void DataPortal_Create(object criteria)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FirstName = ((Criteria)criteria).FirstName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LastName = ((Criteria)criteria).LastName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EmployeeNumber = ((Criteria)criteria).EmployeeNumber;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var ctx = ContextManager&lt;DalLinq.ESMDataContext&gt;.GetManager("ESM"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int? newId = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.DataContext.AddEmployee(FirstName,LastName,EmployeeNumber,ref newId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _id = System.Convert.ToInt32(newId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //FieldManager.UpdateChildren(this);<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br><br><span>Employee Table</span><br><font color="#000000">ID int identity(1,1),<br></font>
<font color="#000000">FirstName varchar(50) not null,<br>LastName varchar(50) not null,<br>EmployeeNumber varchar(6) not null</font><br><br><br></div>Is it wrong to even include a NewEmployee method? Should I simply create the object initialize the values and then call the insert/save method to persist the object to the database? My concern is that the ValidationRules are not being checked this going through the NewEmployee method. I could validate the input in the NewEmployee method but I am not sure if that is the ideal approach, since I have validation rules for each field.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 06, 2008</h2>Hi, and welcome.<br><br>Well, if you're use case requires that you have a way to create new employees, then having a NewEmployee method is totally fine.&nbsp; <br><br>A few things though... do you really want to create the new record in the database right away?&nbsp; Normally you'd return the new, empty object for your users to edit.&nbsp; Then decide whether not to save.&nbsp; <br><br>Also, since you're talking to the database, you really shouldn't have the RunLocal attribute.&nbsp; Use that attribute when you DON'T talk to the database in a DataPortal method.&nbsp; The reason is that if you move to three tier, the presense of that attribute will stop that immediately... your BO is talking directly to the DB from the client.<br><br>Regarding rules, you can call ValidationRules.CheckRules before the dataportal create finishes.&nbsp; That will run any rules you have setup for the type.&nbsp; <br><br>Oh, one last thing.. since you're using the Generic version of DataPortal.Create&lt;T&gt; your criteria should be of type Criteria, not "object."<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Aver replied on Friday, June 06, 2008</h2>I guess the reason that I wanted to create the object in the database right away was to generate the ID value for the object. The employee object will have a child collection so I thought it would be important to generate the ID for those objects.&nbsp; How would the child objects know the link between them and the parent if the ID value is null? (I am starting to see the advantages of GUID but I still perfer the ID)<br><br>Thanks for the very fast reply and great help.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Friday, June 06, 2008</h2><P>Apologies for jumping in...</P>
<P>Assuming you're using sprocs and MSSQL, you can use an ouput parameter, and set it to @@IDENTITY (I think it's @@IDENTITY - I don't use IDs much). That way when you save your parent, you get back the ID.</P>
<P>IIRC, the PTracker code uses this approach - I'm sure I've seen it in the book anyway.</P>
<P>If that doesn't make sense I can dig up some code examples.</P>
<P>Regards,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 06, 2008</h2>It looks like you're using Linq, correct?<br><br>If so, something like this in your DataPortal_Insert will work:<br><br>Data.Employee emp = new Data.Employee();<br><br>emp.FirstName = firstName;<br>emp.LastName = lastName;<br>emp.EmployeeSSN = empSSN;<br>emp.PropertyChanged += <br>&nbsp;&nbsp;&nbsp; delegate( object sender, PropertyChangedEventArgs e ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp; if ( e.PropertyName == "EmployeeId" ) {<br>
&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  employeeId = emp.EmployeeId.Value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; };<br>db.Employee.InsertOnSubmit( emp );<br><br>children.Save( emp );<br>db.SubmitChanges();<br>&nbsp;&nbsp;  <br><br>In your child object, you would do this:<br><br>DataPortal_Insert for child<br>Data.ChildData data = new Data.ChildDate();<br>data.Employee = emp;<br>data.SomeField = someField;<br><br>db.ChildData.InsertOnSubmit( data );<br><br><br>That gives you the general idea.. the code is certainly missing in most places, but you should be able to get the idea.<br><br>Also, if you're using Linq, be sure to listen for PropertyChanged events as I did in the parent.. otherwise your BO won't know the generated id.&nbsp; You'll need to do that for children BOs as well.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
