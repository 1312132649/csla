<html><header><title>Misleading reference in ApplyAuthorizationRules() and ProjectTrackercs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Misleading reference in ApplyAuthorizationRules() and ProjectTrackercs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5715.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>marcosaccioly posted on Friday, October 31, 2008</h2>Hello guys,<br /><br />I've been trying to understand the example website that comes with the ProjectTrackercs files and I can't figure out one thing in the RelosEdit.aspx.cs file. In the ApplyAuthorizationRules() method we have one call to Csla.Security.AuthorizationRules.CanEditObject and one call to Csla.Security.AuthorizationRules.CanCreateObject in order to check the authorization of the logged in user and display the controls approprietly. Both are extremely similar and here's the first one, the way I found it:<br /><br /><font face="Lucida Console" size="2"><br />  private void ApplyAuthorizationRules()<br />  {<br />    this.GridView1.Columns[this.GridView1.Columns.Count - 1].Visible = Csla.Security.AuthorizationRules.CanEditObject(typeof(Roles));<br />    this.AddRoleButton.Visible = Csla.Security.AuthorizationRules.CanCreateObject(typeof(Roles));<br />  }<br /></font><br /><br />As far as I can understand, the purpose of the ApplyAuthorizationRules() was made extremely clear by Lhotka in his Expert C# BOs, page 548: <br /><br /><BLOCKQUOTE><div><br />(...) The ApplyAuthorizationRules() method asks the Roles class whether the current user is authorized to edit the object or add new roles. If the user isnâ€™t authorized, then the appropriate controls Visible properties are set to false, and the controls are thereby hidden.<br /></div></BLOCKQUOTE><br /><br />However, when debugging the app and hovering the mouse over the Roles argument in the code above, it says it's of type <b>System.Web.Security.Roles</b> and, therefore, the gridview column is always visible, as the checks to the objects authorization are never effectively done, since the method CanEditObject(Type objectType) in Csla\Security\AuthorizationRules.cs always sets bool result = true;<br /><br />I've changed my code to <br /><br /><font face="Lucida Console" size="2"><br />  private void ApplyAuthorizationRules()<br />  {<br />    this.GridView1.Columns[this.GridView1.Columns.Count - 1].Visible = Csla.Security.AuthorizationRules.CanEditObject(typeof(ProjectTracker.Library.Admin.Roles));<br />    this.AddRoleButton.Visible = Csla.Security.AuthorizationRules.CanCreateObject(typeof(ProjectTracker.Library.Admin.Roles));<br />  }<br /></font><br /><br />so it meets the real purpose. Now it works as expected, allowing only users assinged to the Administrator role to view the Edit and Delete columns of the gridview, as well as the "Add Role" button. <br /><br />I have browsed the forums for it but found nothing and thought it would be nice to post it here. Sorry if it is of any inconvenience.<br /><br />Thank you all for the time and effort,</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>marcosaccioly replied on Friday, October 31, 2008</h2>I know it's just a reference problem. You may agree it's misleading, though. 

=)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, October 31, 2008</h2><P>I do agree it is misleading. &lt;g&gt;</P>
<P>I always thought it was a poor choice of words for that feature of the app due to the possible confusion in the mind of the reader. Turns out the compiler is confused by it too.</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
