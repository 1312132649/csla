<html><header><title>Problem with Csla.Wpf.PropertyStatus and &quot;DisconnectedItem&quot;</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with Csla.Wpf.PropertyStatus and &quot;DisconnectedItem&quot;</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11010.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan posted on Friday, December 23, 2011</h2><p>Hi,</p>
<p>I am developing a WPF application using VS2010 SP1 and a local version of csla 3.8.4 compiled under .NET4.</p>
<p>In one of my views displaying a list, I just replaced a ListBox using an ItemTemplate with a ListView using a GridView as the View. Both the ListBox and the ListView have VirtualizingStackPanel.IsVirtualizing=&quot;True&quot;.</p>
<p>I had no Problems with the implementation using a ListBox. I changed to using the ListView just to get sortable columns... </p>
<p>But as soon as I begin to scroll the ListView vertically, I get a NullReferenceException resulting from something called &quot;DisconnectedItem&quot;,which seems to be new in WPF under .NET4, and the PropertyStatus control should deal with correctly. At least until they fix an issue in WPF itself...</p>
<p>A quick solution would be to disable virtualization on the ListView. But I want to take advantage of the performance gain I get using it!</p>
<p>Maybe I just need to adjust the PropertyStatus source, but where exactly?</p>
<p>Anybody else already ran into this issue?</p>
<p>Here is the top of the stack strace output (german version):</p>
<p>&nbsp;&nbsp; bei Csla.Reflection.MethodCaller.GetPropertyValue(Object obj, PropertyInfo info) in C:\Visual Studio Projects\csla38net4\cslacs\Csla\Reflection\MethodCaller.cs:Zeile 682.</p>
<p>&nbsp;&nbsp; bei Csla.Wpf.PropertyStatus.GetRealSource(Object source, String bindingPath) in C:\Visual Studio Projects\csla38net4\cslacs\Csla\Wpf\PropertyStatus_.cs:Zeile 210.<br />&nbsp;&nbsp; bei Csla.Wpf.PropertyStatus.SetSource() in C:\Visual Studio Projects\csla38net4\cslacs\Csla\Wpf\PropertyStatus_.cs:Zeile 171.<br />&nbsp;&nbsp; bei Csla.Wpf.PropertyStatus.&lt;.ctor&gt;b__0(Object o, DependencyPropertyChangedEventArgs e) in C:\Visual Studio Projects\csla38net4\cslacs\Csla\Wpf\PropertyStatus_.cs:Zeile 48.<br />&nbsp;&nbsp; bei System.Windows.FrameworkElement.RaiseDependencyPropertyChanged(EventPrivateKey key, DependencyPropertyChangedEventArgs args)<br />&nbsp;&nbsp; bei System.Windows.FrameworkElement.OnDataContextChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)<br />&nbsp;&nbsp; bei System.Windows.DependencyObject.OnPropertyChanged(DependencyPropertyChangedEventArgs e)<br />&nbsp;&nbsp; bei System.Windows.FrameworkElement.OnPropertyChanged(DependencyPropertyChangedEventArgs e)<br />&nbsp;&nbsp; bei System.Windows.DependencyObject.NotifyPropertyChange(DependencyPropertyChangedEventArgs args)<br />&nbsp;&nbsp; bei System.Windows.DependencyObject.UpdateEffectiveValue(EntryIndex entryIndex, DependencyProperty dp, PropertyMetadata metadata, EffectiveValueEntry oldEntry, EffectiveValueEntry&amp; newEntry, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Friday, December 23, 2011</h2><p>This works:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;UserControl.Resources&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;bxfc:VisibilityConverter x:Key=&quot;VisibilityConverter&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DataTemplate x:Key=&quot;OrderInfo&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;StackPanel Orientation=&quot;Horizontal&quot; DataContext=&quot;{Binding Path=Model}&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;TextBlock Text=&quot;{Binding Path=OrderDate}&quot; Margin=&quot;3&quot; Width=&quot;60&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;TextBlock Text=&quot;{Binding Path=OrderNumber}&quot; Margin=&quot;3&quot; Width=&quot;80&quot; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Visibility=&quot;{Binding ElementName=propStatusOrderNo, Path=CanRead, Converter={StaticResource VisibilityConverter}}&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;cslaxaml:PropertyStatus Name=&quot;propStatusOrderNo&quot; Width=&quot;0&quot; Height=&quot;0&quot; Property=&quot;{Binding Path=OrderNumber}&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/StackPanel&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/UserControl.Resources&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Grid DataContext=&quot;{Binding Path=OrderList}&quot; Grid.ColumnSpan=&quot;1&quot; Grid.Column=&quot;1&quot; Grid.RowSpan=&quot;1&quot; Grid.Row=&quot;2&quot; Name=&quot;gridOrderList&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;ListBox VirtualizingStackPanel.IsVirtualizing=&quot;True&quot; VirtualizingStackPanel.VirtualizationMode=&quot;Recycling&quot;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ItemsSource=&quot;{Binding}&quot; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Name=&quot;OrderListListBox&quot;&nbsp; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ItemTemplate=&quot;{StaticResource OrderInfo}&quot; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ScrollViewer.VerticalScrollBarVisibility=&quot;Auto&quot; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Height=&quot;{Binding ElementName=parentGrid, Path=ActualHeight}&quot;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; HorizontalContentAlignment=&quot;Stretch&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/ListBox&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/Grid&gt;<br /></p>
<p>This does not:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;ListView VirtualizingStackPanel.IsVirtualizing=&quot;True&quot; VirtualizingStackPanel.VirtualizationMode=&quot;Recycling&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ItemsSource=&quot;{Binding}&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Name=&quot;OrderListListView&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Height=&quot;{Binding ElementName=parentGrid, Path=ActualHeight}&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; HorizontalContentAlignment=&quot;Stretch&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IsSynchronizedWithCurrentItem=&quot;True&quot;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; attprops:GridViewSort.AutoSort=&quot;True&quot;&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;ListView.View&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridView&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridView.Columns&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridViewColumn Header=&quot;OrderDate&quot; 
DisplayMemberBinding=&quot;{Binding Path=Model.OrderDate}&quot; Width=&quot;60&quot; 
attprops:GridViewSort.PropertyName=&quot;Model.OrderDate&quot;/&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridViewColumn Header=&quot;OrderNumber&quot; attprops:GridViewSort.PropertyName=&quot;Model.OrderNumber&quot;&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridViewColumn.CellTemplate&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;DataTemplate&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;TextBlock Text=&quot;{Binding Path=Model.OrderNumber}&quot; Margin=&quot;3&quot; Width=&quot;80&quot; <br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Visibility=&quot;{Binding 
ElementName=propStatusOrderNo, Path=CanRead, Converter={StaticResource 
VisibilityConverter}}&quot; /&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;cslaxaml:PropertyStatus 
Name=&quot;propStatusOrderNo&quot; Width=&quot;0&quot; Height=&quot;0&quot; Property=&quot;{Binding 
Path=Model.OrderNumber}&quot; /&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/StackPanel&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridViewColumn.CellTemplate&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridViewColumn&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridView.Columns&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridView&gt;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/ListView.View&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/ListView&gt;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Friday, December 23, 2011</h2><p>Found the solution myself... it has nothing to do with the &quot;DisconnectedItem&quot; thing nor the PropertyStatus control!</p>
<p>It is a matter of providing a common DataContext for related controls the right way...</p>
<p>I just had to set the DataContext on the container element:</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridViewColumn Header=&quot;OrderNumber&quot; attprops:GridViewSort.PropertyName=&quot;Model.OrderNumber&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;GridViewColumn.CellTemplate&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;DataTemplate&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;StackPanel Orientation=&quot;Horizontal&quot; <b>DataContext=&quot;{Binding Path=Model}&quot;</b>&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;TextBlock Text=&quot;{Binding <b>Path=OrderNumber</b>}&quot; Margin=&quot;3&quot; Width=&quot;80&quot; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Visibility=&quot;{Binding ElementName=propStatusOrderNo, Path=CanRead, Converter={StaticResource VisibilityConverter}}&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;cslaxaml:PropertyStatus Name=&quot;propStatusOrderNo&quot; Width=&quot;0&quot; Height=&quot;0&quot; Property=&quot;{Binding <b>Path=OrderNumber</b>}&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/StackPanel&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridViewColumn.CellTemplate&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/GridViewColumn&gt;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
