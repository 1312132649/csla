<html><header><title>Failed DataPortal Update doesn't Undo properly in a grid?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Failed DataPortal Update doesn't Undo properly in a grid?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3305.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lotrij posted on Tuesday, July 31, 2007</h2><P>Hey,</P>
<P>I have an EditableRootListBase bound to an Infragistics UltraGrid.&nbsp; If I try to update an object and that update results in an exception being thrown in the DataPortal_Update method, the undo state of the object is lost and the end user can't cancel their edit.&nbsp; The original state of the object is lost (popped off of the undo stack) so the end user can't undo the edit (from their perspective at least, no data is actually modified).</P>
<P>I put some break points around and here's what I saw:<BR>*Right before the end user clicks off the row to confirm their edit, the underlying object has an edit level of 1.<BR>*When the end user clicks off of the row, IEditableObject.EndEdit is called.&nbsp; This results in ApplyEdit being called which results in &nbsp;AcceptChanges being called.<BR>*AcceptChanges pops a layer off of the undo stack, bringing the object's edit level/undo count&nbsp;to 0, and throwing away the object's original state.<BR>*AcceptChangesComplete is then called, which ultimately leads to EditableRootListBase's SaveItem to be called.<BR>*At this point the object's edit level is still 0, and Save is called on it.&nbsp; This leads to DataPortal_Update being called which throws an exception.<BR>*Somehow/somewhere along the way the grid knows that an error has occured, so it doesn't switch rows.&nbsp; It pops up a message box with the exception information.<BR>*An IEditableObject.BeginEdit isn't called on the row right away, so I can click off of it without another EndEdit attempt.&nbsp; This is probably the grid's fault.&nbsp; If I try to edit the row (by clicking on a cell), a IEditableObject.BeginEdit will be called, and an attempt to click off of the row causes the expected error message to pop up without a row change.<BR>*If, while still in edit mode on the row, I try to hit escape to cancel the edit, the new&nbsp;state still shows since the old&nbsp;state has been lost.</P>
<P>Should the pop of state happen before the save?&nbsp; It makes it so that the original&nbsp;state is lost before even knowing whether or not the update will succeed. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 31, 2007</h2><P>This is under discussion in another thread:</P>
<P><A HREF="/forums/thread/16450.aspx">http://forums.lhotka.net/forums/thread/16450.aspx</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
