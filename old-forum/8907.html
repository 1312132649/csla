<html><header><title>MarkAsRoot for BusinessBase, BusinessListBase</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>MarkAsRoot for BusinessBase, BusinessListBase</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8907.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MarkOviedo posted on Monday, May 10, 2010</h2><p>In our Silverlight application, we are retrieving POCO domain objects from our database on the server, and then converting them to CSLA-based view models for return to the client. We utilize AutoMapper to create these CSLA view models and map the property values from the associated domain object.</p>
<p>AutoMapper orchestrates much of the complexity of heirarchical object construction for us. However, there is one wrinkle we need to manage for heirarchical CSLA objects, which is the MarkAsChild() for all child objects in the heirarchy.</p>
<p>We have found that the easiest way to accomplish this is to have our own ViewModelBase/ViewModelListBase that inherits from BusinessBase/BusinessListBase. In our base classes, we invoke MarkAsChild for each object in the constructor, thus defaulting each created view model to child. Then for the one parent of the heirarchy that is returned from AutoMapper, we invoke parent.MarkAsRoot().</p>
<p>To enable this behavior, we added the following method to BusinessBase and BusinessListBase :</p>
<p>
<p>protected void MarkAsRoot()&nbsp;&nbsp; &nbsp;{&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;_isChild = false;&nbsp;&nbsp; &nbsp;}</p>
</p>
<p>This obviously becomes a maintenance issue for us now, as we upgrade CSLA in the future. We could have folded this method into our own view model base classes, but _isChild is private. &nbsp; :( &nbsp;Is it possible to add something equivalent to the framework, or yield _isChild in some form that it is accessible in derived classes?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, May 10, 2010</h2><p>I recommend (as a general rule) that people put their own base class between the CSLA base classes and their own types. Havng a base class in between is the primary extensibility model for CSLA.</p>
<p>[Serializable]<br />public class MyBusinessBase&lt;T&gt; : Csla.BusinessBase&lt;T&gt; where T : MyBusinessBase&lt;T&gt;</p>
<p>In your case you might create different base classes for root and child types - which is fine. But you shouldn&#39;t need to alter CSLA to do this - your base classes should continue to function over time as CSLA changes (within limits of course).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MarkOviedo replied on Monday, May 10, 2010</h2><p>Thanks for the response. As far as I could tell, there was no way to set the _isChild field of the BusinessBase, BusinessListBase = false since it is a private field, and there was no property or method exposing it to the derived class. Thus I resorted to adding the method to the base. If _isChild was protected, I could have manipulated it in the derived class, but it would seem to violate encapsulation.</p>
<p>I definitely need to manipulate the _isChild value of the base class, since that flag is used internally for decision making. Am I missing something?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, May 10, 2010</h2><p>The value is not protected because an object must be a root or child and that can&#39;t change during the object&#39;s lifetime. That value must be set as the object is created.</p>
<p>The value defaults to false (root), and you can use MarkAsChild() to set it to true (child) as the object is created.</p>
<p>Changing the value after the object is created isn&#39;t a valid scenario. If I make IsChild have a protected setter I&#39;ll just have support issues forever as people think it is valid to manipulate the value.</p>
<p>So there&#39;s exactly one, very limited, way to manipulate the value, which is to set it to true by calling MarkAsChild() - and that is something that&#39;s normally handled by the data portal so you don&#39;t have to worry about it.</p>
<p>But you are clearly doing something outside the normal scope of CSLA, and so you are in unsupported territory. Still, the choice must be made as the object is created.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
