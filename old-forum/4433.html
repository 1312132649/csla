<html><header><title>ChildDataPortal.Update (CSLA 3.5)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ChildDataPortal.Update (CSLA 3.5)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4433.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gkurtz posted on Thursday, February 28, 2008</h2><P><FONT face=Arial size=2>Hello,</FONT></P>
<P><FONT face=Arial size=2>Seems like I'm missing something.<BR>In my BusinessBase I&nbsp;implement the following inside de <FONT color=#3a3a3a size=2>DataPortal_Insert</FONT><FONT size=2>() method</FONT>;</FONT></P><FONT color=#3a3a3a size=2>
<P>Csla</FONT><B><FONT color=#408080 size=2>.</FONT><FONT color=#2b91af size=2>DataPortal</FONT><FONT color=#408080 size=2>.</B></FONT><FONT color=#3a3a3a size=2>UpdateChild</FONT><FONT size=2>( </FONT><FONT color=#3a3a3a size=2>ReadProperty</FONT><B><FONT color=#408080 size=2>&lt;</FONT><FONT color=#2b91af size=2>UserRoles</FONT><FONT color=#408080 size=2>&gt;</B></FONT><FONT size=2>( </FONT><FONT color=#3a3a3a size=2>RolesProperty</FONT><FONT size=2> ), </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2> );</FONT></P>
<P><FONT size=2><FONT face=Arial>Where UserRoles is a BusinessListBase. But in de ChildDataPortal the following is happening;</FONT></FONT></P><FONT size=2><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>Update</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>obj</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>params</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>[] </FONT><FONT color=#3a3a3a size=2>parameters</FONT><FONT size=2>)<BR>{<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;var</FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>busObj</FONT><FONT size=2> </FONT><B><FONT color=#408080 size=2>=</B></FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>obj</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>as</FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>Core</FONT><B><FONT color=#408080 size=2>.</FONT><FONT color=#2b91af size=2>BusinessBase</B></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#3a3a3a size=2>busObj</FONT><FONT size=2> </FONT><B><FONT color=#408080 size=2>!=</B></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2> </FONT><B><FONT color=#408080 size=2>&amp;&amp;</B></FONT><FONT size=2> </FONT><FONT color=#3a3a3a size=2>busObj</FONT><B><FONT color=#408080 size=2>.</B></FONT><FONT color=#3a3a3a size=2>IsDirty</FONT><FONT size=2> </FONT><B><FONT color=#408080 size=2>==</B></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><B><FONT color=#008000 size=2>// if the object isn't dirty, then just exit<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</B></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT size=2><FONT face=Arial>Wich renders my BusinessListBase UserRoles null because it's not a BusinessBase.<BR></FONT></FONT><FONT size=2><FONT face=Arial>What am I doing wrong?</FONT></FONT></P>
<P><FONT size=2><FONT face=Arial>Thanx in advance,</FONT></FONT></P>
<P><FONT size=2><FONT face=Arial>Rob</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 28, 2008</h2><P>That check prevents an unchanged BusinessBase from being processed. If your object is a BusinessListBase it will fall right through this check because busObj will be null. That code is correct, and isn't your problem (I don't think).</P>
<P>&nbsp;</P>
<P>A root BusinessBase will implement DataPortal_XYZ methods as normal, though it will call DataPortal.UpdateChild() to update each of its child objects, which you are doing.</P>
<P>A child BusinessBase will implement Child_XYZ methods. If there are grandchildren, it will call DataPortal.UpdateChild() on each grandchild object.</P>
<P>A root BusinessListBase will implement DataPortal_XYZ methods. Its DataPortal_Update() will typically call base.Child_Update():</P>
<BLOCKQUOTE dir=ltr>
<P>[Transactional(TransactionalTypes.TransactionScope)]<BR>protected override void DataPortal_Update()<BR>{<BR>&nbsp; using (var mgr = ConnectionManager&lt;SqlConnection&gt;.GetManager("dbname"))<BR>&nbsp;&nbsp;&nbsp; base.Child_Update();<BR>}</P></BLOCKQUOTE>
<P>Notice that the <EM>only </EM>reason for this code is to control the transaction and to set up the database connection or data context. Otherwise CSLA does all the work.</P>
<P>A child BusinessListBase needs no code, because Child_Update() is called automatically, and does the right thing.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gkurtz replied on Friday, February 29, 2008</h2><P><FONT face=Arial size=2>Thanx Rocky.</FONT></P>
<P><FONT face=Arial size=2>Regards,<BR>Rob</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
