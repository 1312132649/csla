<html><header><title>Data binding in Win forms</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Data binding in Win forms</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3394.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rossl123 posted on Friday, August 17, 2007</h2>I have a problem that I am wondering if anyone in the CSLA community has come across.<br><br>My winforms controls behave strangely if I code against their 'changed' events, they don't seem to invoke the binding mechanism on the first time through.<br><br>To elaborate, my users were getting irritated by the fact that a form is not dirtied until they leave a control. Consequently, on forms with say just a single enabled data control (like a text box), they cannot click on the 'Save' button immediately after making a value change because the Save control doesn't get enabled until the focus has left the text box. So the Save button cannot be clicked on until the user clicks another active control first, or tabs away from the textbox control.<br><br>To get around this problem I trapped the 'changed' event on the text box control and invoked the form ValidateChildren() method. This allows the content of the control to be 'committed' which in turn invokes the binder to the underlying business object, which dirties the form and enables the 'Save' button. It also has the added side benefit of allowing instant feedback for things like keystroke level validation.<br><br>What I have experienced is that everything works wonderfully well, except on the very first control 'changed' event (this occurs not only for textboxes). Even if that event is to paste multiple characters into the control, everything works as you would expect, except the binder mechanism doesn't get fired off and the underlying business object doesn't get the bound controls properties set, so the form doesn't get dirtied. Any subsequent change works as expected, it's just the first one, and even then it's just the first one after the form is shown and the control receives the focus for the first time.<br><br>What I am describing sounds very much like a problem with .Net, and I will be posting to the MSDN user goups as well, but I thought perhaps I might have a better chance of striking a chord with someone here first.<br><br>Cheers<br>Ross<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, August 17, 2007</h2><P>Well indeed this isn't a problem of CSLA as such but rather in the way databinding works (I wouldn't even call it a problem for databinding...). The problem you have is that you want the Save button to get enabled directly when the user types something in a checkbox, changes a selection in a combo etc. I never use this functionality, leaving the save button always enabled and leave the bo save only if the object is dirty. Furthermore, all my forms (or user controls rather) know that when they are initiating a save and specifically change focus in order to complete the change.<BR>Back to your problem. I guess a one way of enabling your save button is to create custom controls for your textbox, combobox etc which have a Button property. Then internally, if a change occurs (and before databinding kicks in) you can enable that button. The only problem is that if e.g. you paste something in a textbox (and the event fires to enable the save button), then delete everything, you will need to be smart about disabling the save button again.<BR>Maybe I am overcomplicating this though...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, August 17, 2007</h2><P>Hi Ross</P>
<P>There is a standard way of doing what you want by changing one of the databinding properties. I'm doing this from memory so I might not have the words exactly right but on the&nbsp;properties of a control in Visual Studio, expand "Databinding" near the top and then hit "Advanced". You can change when validation occurs from OnValidation to OnPropertyChanged. I think that will achieve what you're doing with the changed event.</P>
<P>I always do that for clickable type controls such as checkboxes or dropdown lists but I don't usually do it for textboxes. I think it would mean a lot of activity for every keystroke but ... its probably not an issue.</P>
<P>The user usually wants to close the form after saving so I solve the problem you're dealing with by trapping the FormClosing event and prompting with a "Do you want to Save". That works fairly well, it means that the user hits the close button instead of Save even if Save is disabled. I described it here <A HREF="/forums/post/16170.aspx">http://forums.lhotka.net/forums/post/16170.aspx</A></P>
<P>Cheers from another Ross</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardb replied on Friday, August 17, 2007</h2><P>As you type in the textbox your Business Object property should be getting set at each keystroke&nbsp;and hopefully the rules checking would be firing too, and the BO would evaluate it's state.&nbsp; If IsValid is true then doesn't some event get fired by the BO which the WinForm can handle and then enable/disable the buttons?</P>
<P>That's from my memory too as I don't have the code to hand.....we created some base UI forms to do all of this - I'll look back and post how we actually did it once I find it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, August 17, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tetranz:</strong></div><div></P>
<P>You can change when validation occurs from OnValidation to OnPropertyChanged.</P>
<P></div></BLOCKQUOTE></P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>richardb:</strong></div><div></P>
<P>As you type in the textbox your Business Object property should be getting set at each keystroke&nbsp;and hopefully the rules checking would be firing too, and the BO would evaluate it's state.</P>
<P></div></BLOCKQUOTE></P>
<P>I'm not sure if I am getting confused here but that's not the behaviour I see. The property gets changed only once you tab out of a checkbox or combobox... Even if you manage to change databinding settings like tetranz specifies, I still can't see how the save button would become enabled since the propery only changes when the user has tabbed out... An I the only one seeing this behaviour? <img src="/emoticons/emotion-43.gif" alt="Confused [8-)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, August 17, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>triplea:</strong></div><div>I'm not sure if I am getting confused here but that's not the behaviour I see. The property gets changed only once you tab out of a checkbox or combobox... Even if you manage to change databinding settings like tetranz specifies, I still can't see how the save button would become enabled since the propery only changes when the user has tabbed out... An I the only one seeing this behaviour? <img src="/emoticons/emotion-43.gif" alt="Confused [8-)]" /></div></BLOCKQUOTE><BR><BR>It definitely works for me the instant I click on a checkbox or select from a dropdown list. The BO is updated and the buttons change. That's if I set the "Data Source Update Mode" (I have the words right now) to <SPAN class=referenceNoLink>OnPropertyChanged. If I leave it set to the default which is OnValidation then I get the behaviour you describe which is what I'd expect. It determines when your BO will receive a new value from the UI. The call to PropertyHasChanged() in your property setter will trigger the other magic to happen.&nbsp; I've never tried a textbox but I think it should work on each keystroke. I'm at home today and don't have a CSLA project to try it on.<BR><BR>I'm not sure how you're controlling the buttons but I strongly recommend following Rocky's advice and control the buttons from the BindingSource CurrentItemChanged event rather than try to bind the enable properties. <A href="http://lhotka.net/Article.aspx?area=4&amp;id=5faaee8e-8496-4845-86f7-787c6b64096c">http://lhotka.net/Article.aspx?area=4&amp;id=5faaee8e-8496-4845-86f7-787c6b64096c</A><BR></SPAN><SPAN class=referenceNoLink><BR>Ross</P></SPAN></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rossl123 replied on Monday, September 03, 2007</h2>Thankyou all for your replies. Changing the update behaviour using the Data Source Binding Update Mode certainly came as a revelation to me and did help streamline my code. It certainly does work for text boxes and the way I have hooked up my Save and Reset buttons works fine, except in the unusual circumstances that I originally reported. <br><br>When the form is first loaded and it's controls bound to the first bo, the OnPropertyChanged event doesn't seem to fire at all for any control on the form until a focus change event occurs where a control has been altered. Once any control on the form has been altered, binding updates at the control changed level work as advertised. Strange. I have multiple instances of this phenomenon, not just one form, although they are all coded using the same design template.<br><br>I did have other issues way back with my forms that necessitated implementing code at the Form Enter event (to do with setting properties of controls on the parent form) and it seemed to help stabilise things if I did the databinding for the current bo during this event as well, including that of the initial bo when the form is first loaded. On first load it is interesting to note that the form hasn't actually been properly painted at that stage, maybe that has something to do with it?<br><br>Once again, thanks to those who have helped look into this problem.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
