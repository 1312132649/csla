<html><header><title>Objectfactory &amp; Delete</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Objectfactory &amp; Delete</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6432.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Monday, February 16, 2009</h2>Today i started trying to impliment an delete method, ok a bit late but i though it would work as expected. I expected that the delete method would be hit as discribed in the book. 
<P></P>
<P>Deferred Deletion (Page 161) </P>
<P><STRONG>5. b. <BR></STRONG></P>
When using an ObjectFactory attribute, the data portal creates an instance of the specified object factory class and invokes the specified delete method. This delete method contains the code needed to delete the business objectâ€™s data, along with any related child data.</P>
<P>My code:<BR><FONT color=#2b91af><FONT color=#2b91af><BR>Persoon</FONT></FONT> persoon = <FONT color=#2b91af><FONT color=#2b91af>Persoon</FONT></FONT>.GetPersoon(1097);<BR>persoon.Delete();<BR>persoon.Save();</FONT></FONT></FONT></FONT></FONT></P>
<P>My Call Stack:</FONT></FONT></FONT></FONT></P>
<P>&gt;&nbsp;Framework.Data.dll!U4A.Framework.Data.Factories.U4ABusinessBaseFactory&lt;U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon&gt;.Update(U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}) Line 67&nbsp;C#<BR><BR>&nbsp;&nbsp;[Lightweight Function]&nbsp;<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Reflection.MethodCaller.CallMethod(object obj = {U4A.Ceedrie.Data.Relatiemanagement.Factories.PersoonFactory}, Csla.Reflection.DynamicMethodHandle methodHandle = {Csla.Reflection.DynamicMethodHandle}, object[] parameters = {object[1]}) Line 298 + 0x1e bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Reflection.MethodCaller.CallMethod(object obj = {U4A.Ceedrie.Data.Relatiemanagement.Factories.PersoonFactory}, string method = "Update", object[] parameters = {object[1]}) Line 226 + 0xe bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Server.FactoryDataPortal.InvokeMethod(string factoryTypeName = "Factory Type=U4A.Ceedrie.Data.Relatiemanagement.Factories.PersoonFactory, Data.Relatiemanagement;Item Type=U4A.Ceedrie.Business.Relatiemanagement.Persoon, Business.Relatiemanagement", string methodName = "Update", object e = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}, Csla.Server.DataPortalContext context = {Csla.Server.DataPortalContext}) Line 77 + 0x3f bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Server.FactoryDataPortal.Update(object obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}, Csla.Server.DataPortalContext context = {Csla.Server.DataPortalContext}) Line 158 + 0x4e bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Server.DataPortalSelector.Update(object obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}, Csla.Server.DataPortalContext context = {Csla.Server.DataPortalContext}) Line 110 + 0x10 bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.Server.DataPortal.Update(object obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}, Csla.Server.DataPortalContext context = {Csla.Server.DataPortalContext}) Line 278 + 0xf bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.DataPortalClient.LocalProxy.Update(object obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}, Csla.Server.DataPortalContext context = {Csla.Server.DataPortalContext}) Line 55 + 0x18 bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.DataPortal.Update(object obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}) Line 460 + 0xf bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.DataPortal.Update&lt;Csla.BusinessBase&lt;U4A.Ceedrie.Business.Relatiemanagement.Entities.Relatie&gt;&gt;(Csla.BusinessBase&lt;U4A.Ceedrie.Business.Relatiemanagement.Entities.Relatie&gt; obj = {U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon}) Line 336 + 0x8 bytes&nbsp;C#<BR><BR>&nbsp;&nbsp;Csla.dll!Csla.BusinessBase&lt;U4A.Ceedrie.Business.Relatiemanagement.Entities.Relatie&gt;.Save() Line 125 + 0x46 bytes&nbsp;C#<BR>&nbsp;&nbsp;Business.Relatiemanagement.dll!U4A.Ceedrie.Business.Relatiemanagement.Entities.Persoon.Save() Line 85 + 0x8 bytes&nbsp;C#<BR>&nbsp;&nbsp;Relatiemanagement.dll!</P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Monday, February 16, 2009</h2><P>Btw, i forgot to mention that the Immediate deletion works fine. DataPortal.Delete()<BR>It's only the defered deletion which reach the Update method instead of Delete method in de objectfactory.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Monday, February 16, 2009</h2>Deferred deletion will call the Update method, as you have seen.&nbsp; The update method needs to handle insert/update/delete.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Monday, February 16, 2009</h2>yes, but it's not according what is written in the book on page 161 and 162</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, February 16, 2009</h2><P>I think you may be reading that page a little too closely.</P>
<P>"the business developer must provide both a factory class and the business class. The factory class must implement a delete method that ..."</P>
<P>The book doesn't say that the factory delete method will be called. It says you have to have one. I think you just proved the Update method gets called. In there, you have to call your delete method.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Tuesday, February 17, 2009</h2><P>Ok, it seems somehow logic to me that the update method is being called. In must then implement another 'target.IsDeleted' in my base class just like i did for target.IsNew and target.IsDirty. The standard Csla-ObjectFactory base class doesn't provide this information.<BR><BR>Still section 5.b on page 161 points out that the <STRONG>specified delete method </STRONG>will be invoked by the dataportal. Maybe im just plain stupid ;)<BR><BR>Anyway maybe it can be added as&nbsp;wish work item on the bug tracker site.<BR><BR>- make IsNew accessable<BR>- make IsDirty accessable<BR>- make IsDeleted accessable</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Tuesday, February 17, 2009</h2>Looking at the book 161 5b, the book is wrong, maybe a copy and paste error.<br><br>We check the obj.IsXXX properties directly on the BO with the obj being passed to Update.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
