<html><header><title>Concurrent DataPortal Calls Question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Concurrent DataPortal Calls Question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11808.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute posted on Tuesday, January 29, 2013</h2><p>I am running into an issue that I am hoping someone can confirm as expected or unexpected behavior and possible solutions.&nbsp; My environment is SL5 and CSLA 4.3.10.&nbsp; Here is a typical scenerio I am running into:</p>
<p>After by main BO is loaded, I use either a CommandBase or ROB to load an additional list of transactions.&nbsp; This secondary Execute or Fetch operation may take 10-20 seconds (may need to communicate with 3rd party system etc) so I want the user to be able to start working right away before this finishes.&nbsp; This basically works fine.&nbsp; However, if the user does something to initiate another DataPortal operation, that operation will block until the long-running Execute/Fetch is finished.&nbsp; The block seems to occur with the WCF DataPortal call at the web server.&nbsp; If I change the IIS application pool to run multiple Worker Processes (eg web garden), then no blocking occurs provided there are enough worker processes to handle concurrent requests from one user session.</p>
<p>I am wondering if this behavior is expected and if so, do others that run into it simply use Multiple Worker Processes or something else to resolve.&nbsp; It seems that a longer running lazy loading scenerio would exhibit the same type of behavior so I am guessing others have had to work with this.</p>
<p>Any thoughts would be appreciated!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Wednesday, January 30, 2013</h2><p>Ok, so I figured out that ASP.NET SessionState is the culprit here, and I suppose that makes sense.&nbsp; I am thinking I don&#39;t need ASP.NET sessions for SL or CSLA.&nbsp; Can anyone else comment on whether they turn this off to allow concurrent requests to the server?&nbsp; Or are there other options (like multiple Worker Processes) that would be a better choice?</p>
<p>I am going to play with this some more but any comments would be appreciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>knute replied on Wednesday, January 30, 2013</h2><p>I have went with setting sessionState=&quot;Off&quot; in web.config and this effectively solves the issue.&nbsp; Now, all server requests run concurrent so longer-running requests aren&#39;t blocking other server requests made by the same user session.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, February 02, 2013</h2><p>Normally session isn&#39;t loaded in a WCF host project. But if your web site is configured to use session (and YOU aren&#39;t using session in your code) then you should turn it off. The data portal doesn&#39;t use it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Saturday, February 02, 2013</h2><p>Thanks Rocky for that confirmation.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
