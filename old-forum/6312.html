<html><header><title>BrokenRule:  Bug or intended behavior?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BrokenRule:  Bug or intended behavior?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6312.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, February 02, 2009</h2>I have a rule method which looks like this:<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<font color="#0000ff"> private static bool</font> RequireCategory(<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#008000">Document </font>target,<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#008000">RuleArgs </font>e<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">bool </font>result;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; result = <font color="#008000">CommonRules</font>.StringRequired( target, e );<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<font color="#0000ff"> if </font>( !result ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">if</font> ( target.isLocked || target.IsClosed ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; e.Severity = <font color="#008000">RuleSeverity</font>.Warning;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">return </font>result;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>Now, the first time it's run on one of my objects, the state is such that e.Severity is set to Warning.<br><br>Later, isLocked is set to <font color="#0000ff">false </font>and IsClosed is <font color="#0000ff">false </font>as well, so the e.Severity line is never hit.&nbsp; The odd thing (at least, it was unexpected to me!) e.Severity is set to Warning by the caller of RequireCategory.&nbsp; In other words, it seems to remember that it was set to be a warning last time it ran, and continues to do so.&nbsp; I thought it was the rule method's sole responsiblity to properly set Severity to Warning or Info.. that it should always be Error by default.<br><br>So... bug, or by design?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Monday, February 02, 2009</h2>Do you actually see e.Severity being changed back to warning before the rule is called, or is&nbsp;CSLA just holding&nbsp;onto the last RuleArgs reference that was passed in and reusing it over and over&nbsp;(and hence is just retaining any changes you made to it)?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 02, 2009</h2>Hmm... I didn't actually look at the Csla code.&nbsp; But I inspected the RuleArgs object instance before ANY line in my rule handler executed, and it was already set to Warning.<br><br>It looks like RuleMethod keeps a reference to the same RuleArgs and passes it each time.&nbsp; So I guess this is by design.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 02, 2009</h2>Yes this is by design. The RuleArgs object is created at the time AddRule() is called - in fact you can create your own RuleArgs object (and often do if you use anything beyond the simplest rules).</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 02, 2009</h2>Ok, I'll probably just update my rule method to always set Severity properly. <br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
