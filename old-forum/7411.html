<html><header><title>Problems with pure CSLA for Silverlight 3.7.0 and Silverlight 3.0 installations</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problems with pure CSLA for Silverlight 3.7.0 and Silverlight 3.0 installations</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7411.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gareth posted on Thursday, August 06, 2009</h2>Hi Rocky, firstly congrats on your Silverlight video series. It's been very informative and useful. I've only got the last video to watch now!<br />In the meantime I thought I'd start looking at some of the demo projects on my machine.<br />Now I've come into CSLA and Silverlight at version 3.0 and the problem is none of the demos actually work because the System.Web.Silverlight assembly no longer exists (it was removed purposely by MS).<br /><br />So the .aspx page reference to the assembly fails. This has to be removed.<br /><br />(How do I put ASP code segments in these posts??)<br /><br />Also the line:<br /><br /><font face="Lucida Console" size="2">&amp;lt;asp:Silverlight ID=&amp;quot;Xaml1&amp;quot; runat=&amp;quot;server&amp;quot; Source=&amp;quot;/ClientBin/Demo.xap&amp;quot; MinimumVersion=&amp;quot;2.0.31005.0&amp;quot; Width=&amp;quot;100%&amp;quot; Height=&amp;quot;100%&amp;quot; /&amp;gt;<br /></font><br /><br />...no longer works in pure Silverlight 3 (it probably works okay if you had Silverlight 2 and then installed 3 on top!).<br /><br />In Silverlight 3 it has to be replaced with:<br /><br /><font face="Lucida Console" size="2">&amp;lt;object ID=&amp;quot;Xaml1&amp;quot; type=&amp;quot;application/x-silverlight&amp;quot; Width=&amp;quot;100%&amp;quot; Height=&amp;quot;100%&amp;quot;&amp;gt;<br />                &amp;lt;param name=&amp;quot;Source&amp;quot; value=&amp;quot;/ClientBin/Demo.xap&amp;quot; /&amp;gt;<br />                &amp;lt;param name=&amp;quot;minRuntimeVersion&amp;quot; value=&amp;quot;3.0.40624.0&amp;quot; /&amp;gt;<br />            &amp;lt;/object&amp;gt;                       <br /></font><font face="Lucida Console" size="2"><br /><br />So far so good. I got the demo to run, but on selecting &amp;quot;Add Product&amp;quot; I get various exceptions and things are just not working.<br /><br />Any chance you could review your demo code to work with pure Silverlight 3 installations? <br /><br />There is a whitepaper from Microsoft about it here: http://go.microsoft.com/fwlink/?LinkId=153377<br /><br />Regards,<br />Gareth.</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 06, 2009</h2>It is on my to-do list :)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 06, 2009</h2>Though I am curious about the exceptions you are getting? I've run several of the demos underSL3 without problem (other than the &lt;object&gt; tag issue).</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gareth replied on Thursday, August 06, 2009</h2>Hi Rocky, thanks for getting back. With regard to the exceptions, once the app is running and the main screen appears with the menu options down the left hand side (Add Product, Show Product List, etc..).<br /><br />If I click "Add Product" I get this:<br /><br />Unhandled Error in Silverlight 2 Application Collection was modified; enumeration operation may not execute.   at System.ThrowHelper.ThrowInvalidOperationException(ExceptionResource resource)\n   at System.Collections.Generic.Dictionary`2.Enumerator.MoveNext()\n   at System.Windows.FrameworkElement.NotifyDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.OnAncestorDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.NotifyDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.OnAncestorDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.NotifyDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.OnAncestorDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.NotifyDataContextChanged(DataContextChangedEventArgs e)\n   at System.Windows.FrameworkElement.OnTreeParentUpdated(DependencyObject newParent, Boolean bIsNewParentAlive)\n   at System.Windows.DependencyObject.UpdateTreeParent(IManagedPeer oldParent, IManagedPeer newParent, Boolean bIsNewParentAlive, Boolean keepReferenceToParent)\n   at MS.Internal.FrameworkCallbacks.ManagedPeerTreeUpdate(IntPtr oldParentElement, IntPtr parentElement, IntPtr childElement, Byte bIsParentAlive, Byte bKeepReferenceToParent)<br /><br />On continuing past that the form appears. I enter an Id of "A123" and Name "Gareth". The Red error dot stays by Id and hovering over it reports "Could not load file or assembly 'Csla, Version 3.7.0.0, Culture="neutral"......<br /><br />Also there is no existing data in any of this obviously because I have no database - where do I get the source database from, or have I missed it?<br /><br />Gareth.<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 06, 2009</h2><P>Most of the demos have no database, instead relying on mock data. </P>
<P>I think only #8 has an actual database because it is for the data access video segment. That demo uses a SQL Express database that is in the App_Data folder where the data portal is hosted.</P>
<P>The exception you are getting is due to some change in SL3 that is breaking the PropertyStatus control. This is something I'm actively working on (with help from another person on the forum from a different thread).</P>
<P>Debugging the issue is turning out to be very difficult, because the exception occurs in the SL runtime, not in my code. I'm sure the problem is somewhere in my code - and after a few hours of slowly commenting out bits of code I think I've narrowed it down to just a half dozen possibilities... Nasty...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 06, 2009</h2><P>Regarding the exception you are getting:</P>
<P>I believe I resolved the issue and the fix is in the 3.7.x branch in svn.</P>
<P>I still don't fully understand the nature of the issue, but it seems that the XAML visual tree may not be entirely stable when PropertyStatus is initially rendered. In other words, I think the visual tree is changing out from under PropertyStatus as it is being loaded - an apparently new behavior of SL3.</P>
<P>My resolution may or may not be a real fix. As the control loads, it now bypasses the method that attempts to resolve the relative path to the UI control to be manipulated for authz purposes. All my test apps appear to work fine with this change, but I am suspicious that there might be some edge case where it won't work properly now.</P>
<P>In any case, the PropertyStatus control is in the middle of a facelift for CSLA .NET 3.8 and I'm hoping to entirely eliminate this issue with the redesign (and grant more power to the XAML designer).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 06, 2009</h2><P>Also, I put the updated demo code on <A href="http://download.lhotka.net">http://download.lhotka.net</A> - though I still need to get a refresh of 3.7.1 online with the PropertyStatus fix, as that's rather important.</P>
<P>But at least the updated sample projects are all online.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gareth replied on Friday, August 07, 2009</h2>Great stuff. Thanks Rocky! I've almost got my first SL3 with CSLA test app working...<br /><br />Cheers,<br />Gareth.<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
