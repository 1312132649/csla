<html><header><title>Bypass object level authorization</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Bypass object level authorization</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10896.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro posted on Thursday, November 17, 2011</h2><p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Is there a way to ignore (bypass) object level authorization rules in some cases (like BypassPropertyChecks does for setting business properties)? </span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;"></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">For instance I want to call DataPortal.Fetch(&hellip;) for a read-only collection that has authorization rules for &ldquo;AuthorizationActions.GetObject&rdquo;, but in some cases (internal factory method called from Client by consuming Biz Object) I do not want to enforce the authorization rules since the consumer is a business object that has its own way to enforce security.</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Thank you,</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Lazaro</span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, November 17, 2011</h2><p>In CSLA 4 authorization rules are implemented as a class, and you can create your own rules. I would suggest that you are describing a custom rule scenario, where your authz rule should allow the fetch operation based on the knowledge that the object has its own way to enforce security.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, November 17, 2011</h2><p>Hi,</p>
<p>You could also include an interface and a boolean property to say &quot;BypassAuthorization&quot; with your own custom authorization rules.<br />Then create factory methods that can accept this as a parameter or has a builtin setting of bypass. </p>
<p>Another option is to create new command objects that bypass authorization rules (f.ex for use in business rules) that fetches the same object and acts as a DTO object. The authorization rules are enforced by the data portal on the &quot;root&quot; object on the client side.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Friday, November 18, 2011</h2><p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Hi Jonny,</span></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">I understand the second option but I have my doubts on how to implement the first option and I would really appreciate it if you can give me a little more details preferable with some sort of pseudocode.</span></span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"></span></span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks,</span></span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Lazaro</span></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Sample:</span></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">&nbsp;</span><span style="font-size:small;"><span style="font-family:Calibri;">Base read only class that contain the interface and the custom authorization rule</span></span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">public interface ILNRReadOnlyGetAuthorizationRule<br />{<br />&nbsp; bool BypassAuthorization { get; set; }<br />}</span></span></p>
<p class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Custom object level authorization rule.<br />private class CanBrowseRule: LNRAuthorizationRuleOr, ILNRReadOnlyGetAuthorizationRule<br />{<br />&nbsp; /// &lt;summary&gt;<br />&nbsp; /// Can the user browse this read only collection<br />&nbsp; /// &lt;/summary&gt;<br />&nbsp; /// &lt;param name=&quot;action&quot;&gt;Action this rule will enforce.&lt;/param&gt;<br />&nbsp; /// &lt;param name=&quot;roles&quot;&gt;List of allowed roles.&lt;/param&gt;<br />&nbsp; public CanBrowseRule(AuthorizationActions action, params ALRSecurity[] roles) : base(action, roles) { }<br />&nbsp;<br />&nbsp; public bool BypassAuthorization { get; set; }<br />&nbsp;<br />&nbsp; protected override void Execute(AuthorizationContext context)<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; if (BypassAuthorization)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.HasPermission = true;&nbsp; // always allow <br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.Execute(context);<br />&nbsp; }<br />}</span></span></p>
<p><span style="font-size:small;"><span style="font-family:Calibri;">
<p class="MsoNormal"><br />One factory method implemented:<br />&bull;&nbsp;How can I finish the implementation of the BypassAuthorization logic? <br />&bull;&nbsp;How can I communicate with the custom rule from the static method?</p>
<p class="MsoNormal">public static LoansReadOnly GetLoansReadOnly(int propertyLifeID)<br />{<br />&nbsp; return DataPortal.Fetch&lt;LoansReadOnly&gt;(propertyLifeID);<br />}<br /></p>
</span></span></p>
<p class="MsoNormal">&nbsp;</p>
<pre></pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
