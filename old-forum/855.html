<html><header><title>Another Reflection Question?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Another Reflection Question?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/855.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy posted on Wednesday, August 09, 2006</h2><P><SPAN>I just successfully used reflection to instantiate a BO and call method dynamically :) YEEPIE</SPAN></P>
<P><SPAN>Can I kill this dynamically loaded assembly as soon as I have the results from the method we invoked and how do I do this?</SPAN></P>
<P><SPAN></SPAN>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, August 09, 2006</h2>Yes and no. Once the assembly is loaded, it stays in the appdomain.<br><br>The only way to do what you want would be to create another appdomain and load the assembly there.&nbsp; Then when you're done, unload the appdomain.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Wednesday, August 09, 2006</h2><P>oh i just read that...was hoping there was a simpler solution :( but if that's the only way then that's the only way.</P>
<P>How long do these dynamically loaded assemblies have a reference to the physical dll file?</P>
<P>I was hoping that once they are done doing there work they are sent to the garbage collection</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, August 10, 2006</h2><P>Why do you want to unload the assembly that one of your BOs is in?&nbsp; </P>
<P>Surely you actually want the assembly with your BOs to remain resident the whole time?</P>
<P>Otherwise the .NET framework will keep loading the assembly back into memory every time you access that BO!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AndrewCr replied on Thursday, August 10, 2006</h2><P>No, assemblies are not garbage-collected like normal objects.&nbsp; The only way to release the physical DLL is to unload the AppDomain, as described previously.&nbsp; (Sorry.)</P>
<P>As to "why would you?": Being able to do this&nbsp;could be&nbsp;useful in updating always-on systems like services.&nbsp; Say you had a service that handled a number of different types of requests, each requiring different business objects.&nbsp; You would upgrade the service by disabling only the requests that used a specific business object and unloading (only) that app domain.&nbsp; You could then replace the DLL and re-enable the request.&nbsp; In the meantime the service continues to run and service other requests.</P>
<P>Of course to do this, you need to design the service from the ground up to have different AppDomains for each type of request.</P>
<P>Hop this helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, August 10, 2006</h2><P>It's a long story LOL! But what we need to do is load an assembly based on some criteria. Then invoke a method dynamically. I've accomplished what we need to do using reflection :) </P>
<P>But I was concerned with the assembly not releasing it's resources effectively. I have since learned the only way to release an assemblies reference to the physical file and other resources is to unload the asp.net app domain. </P>
<P>You can do this by "touching" the webconfig file :)&nbsp; </P>
<P>Please keep in mind if you do this you loose all session data and cached data as well because they all are stored in the app domain.</P>
<P>Thanks everybody for the help! :) </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 10, 2006</h2>Uh... I wouldn't recommend 'touching' the web.config just to unload appdomains.. since as you know it will cause problems for users.<br><br>Why not just proceed as recommended?&nbsp; Creating an appdomain and then unloading it when you are doing isn't that difficult, and you don't need to worry about causing havock for your users.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, August 10, 2006</h2><P>mmmm.... was thinking that the need to update the app domain would not happen much after the site goes to the production environment. But if it does need to be done then the users will loose all there data that is not committed. </P>
<P>Well looks like I got some homework tonight LOL! I'm going to do some reading on AppDomains.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tymberwyld replied on Friday, August 11, 2006</h2>Well, if you're interested I have a class that manages this for you.&nbsp; It's actually very simple to understand once you've used it a few times.&nbsp; It encapsulates everything including the calls through Reflection.&nbsp; It can also Load and Unload AppDomains.<br><br>Basically, the way to do this is instantiate a new AppDomain yourself (this may get somewhat complicated as there are many weird options in the AppDomainSetup class).&nbsp; You can then Unload that new AppDomain without affecting your current Main AppDomain running from ASP.NET.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
