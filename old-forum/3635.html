<html><header><title>How does Linq to Sql fit with CSLA?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How does Linq to Sql fit with CSLA?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3635.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix posted on Tuesday, October 02, 2007</h2><P>Hi,</P>
<P>We are planning of using LinqTo Sql and I was wondering whether it would fit around CSLA.</P>
<P>My first conclusion is that by using &nbsp;Linq To Sql we have to program a different kind of business object alltogether ,a much lighter one.</P>
<P>I am also struggling to find out where linq actually fits in an NTier application as I cannot seem to make a clear distinction between a Business Layer and a DataLayer ,so far my conclusion is that Linq is both a DAL and BizLayer.</P>
<P>What&nbsp;are your views?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 02, 2007</h2>I think it'd show up in the DP_xyz methods mainly.&nbsp; Possibly your BO could keep the resulting objects around and use the update features of the entities, but that's a while guess, I haven't started with Linq yet.<br><br>It also might be useful to filter business lists (thinking of searching through ROLB objects).<br><br>Just my guess from what I know so far.. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Tuesday, October 02, 2007</h2>I would probably wait for Rocky to release his next book on the topic :-) But in the meantime I would also probably look at utilising it in the dataportal methods simply as an OR mapper (though I know Linq is so much more), nothing fancier.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 02, 2007</h2>We could, but Rocky has already given us a clue as to where <a href="http://www.lhotka.net/weblog/ADONETEntityFrameworkLINQAndCSLANET.aspx">he sees EF and Linq fitting in.</a><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Tuesday, October 02, 2007</h2><P>Thanks for your replies</P>
<P>Reading the post that Rocky put with regards to Linq and EF&nbsp;,my understanding is that he doenst see a place in the CSLA.</P>
<P>I have been asked to provide a framework around LinqToSql but I am struggling to abstract the business Layer from the Data Layer.</P>
<P>The more I look at it ,it looks like that LinqToSql "is" the Data Layer and whatever Is generated by sqlMetal is the actual business Layer,which means not having a physical DataLayer.</P>
<P>If you know of way to abstract LinqToSql DataLayer from the BizLayer please let know how you do that?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 02, 2007</h2><P>Check out Rick Strahl's blog&nbsp; - he has been working on this exact issue and has hit many of the pain points already. In fact he made some interesting conclusions yesterday about disconnected data contexts. We won't know the final result until the next build is released.</P>
<P><A href="http://west-wind.com/weblog/">http://west-wind.com/weblog/</A></P>
<P>&nbsp;</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 03, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>Reading the post that Rocky put with regards to Linq and EF&nbsp;,my understanding is that he doenst see a place in the CSLA.</div></BLOCKQUOTE><br><br>Not quite what I would say; he sees a use for it for data access, similar to how NHibernate fits in today.<br>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>I have been asked to provide a framework around LinqToSql but I am struggling to abstract the business Layer from the Data Layer.</div></BLOCKQUOTE></p><p>You should be able to build a data layer that uses Linq.&nbsp; The business layer would use your data layer, although I'm not sure how helpful that would be.<br></p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>The more I look at it ,it looks like that LinqToSql "is" the Data Layer and whatever Is generated by sqlMetal is the actual business Layer,which means not having a physical DataLayer.</div></BLOCKQUOTE></p>No, sqlmetal would generate DTOs which your business layer would use to move data into or out of the database.&nbsp; Those objects would also be part of the data layer.<br>

<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>If you know of way to abstract LinqToSql DataLayer from the BizLayer please let know how you do that?</div></BLOCKQUOTE></p><p>Well you'd have to write a layer that would take some data and use Linq behind the scenes.&nbsp; Again though, I'm not sure what use that would be.&nbsp; I have a data layer now that I maintain, to hide embedding sql into my application, and also to give me a strongly typed object to code against.. but Linq will fill that need for me, so over time I will replace my data layer with Linq.<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Wednesday, October 03, 2007</h2><P>Thanks for taking the time to reply to my queries.</P>
<P><STRONG>ajj3085 </STRONG><EM>No, sqlmetal would generate DTOs which your business layer would use to move data into or out of the database.&nbsp; Those objects would also be part of the data layer.</EM><BR></P>
<P>&nbsp;&nbsp;&nbsp;I would not call them DTOs as they have logic in them<STRONG> </STRONG>and your can add partial methods and so on.</P>
<P><STRONG>ajj3085 </STRONG><EM>You should be able to build a data layer that uses Linq.&nbsp; The business layer would use your data layer, although I'm not sure how helpful that would be.</EM></P>
<P>&nbsp;&nbsp;&nbsp; I can build the DAL&nbsp; using sqlmetal via commandLine and put in one assembly(myCompany.DAL) The entity generated contains logic and interfaces in much lighter version than a csla would have.<BR>What do I put in my Business Layer if my generated entities that resides on the DAL already have that logic?<BR></P>
<P><STRONG>ajj3085 </STRONG><EM>Well you'd have to write a layer that would take some data and use Linq behind the scenes.&nbsp; Again though, I'm not sure what use that would be</EM></P>
<P>I agree in the sense that Linq is both your Dal and Biz.<BR>However if you think different and it's simple for you can you post an example on how you would put Generated Entities in (myCompany.BLL) and all the sprocs,dataContext stuff in the Mycompany.DAL (separate assemblies) and you make them talk to each other.</P>
<P>My problem is that I was trying to separate the two but I dont think you can.</P>
<P>Also regarding how it fits into CSLA you right ,I misread the last bit of his note where he says he sees it working on a DataPortal a bit like nHibernate does.</P>
<P>Has anybody tried that?</P>
<P>&nbsp;</P>
<P>thanks again for your time</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 03, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>I would not call them DTOs as they have logic in them<strong> </strong>and your can add partial methods and so on.</div></BLOCKQUOTE><br><br>What kind of logic?&nbsp; I certainly wouldn't put any business logic in there.&nbsp; From my limited exposure, sqlmetal generates classes based off of database tables.. which I would classify as a DTO.<br><p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>I can build the DAL&nbsp; using sqlmetal via commandLine and put in one assembly(myCompany.DAL) The entity generated contains logic and interfaces in much lighter version than a csla would have.<br>What do I put in my Business Layer if my generated entities that resides on the DAL already have that logic?</div></BLOCKQUOTE></p><p>If you're using Sqlmetal to put business logic into the generated classes, that's not really an approach that would be recommended here.&nbsp; Your business objects should be modeled to fit your use cases.&nbsp; This means they almost never match your database design.&nbsp; So again, what kind of logic would be in these classes?<br></p><p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>I agree in the sense that Linq is both your Dal and Biz.<br>However if you think different and it's simple for you can you post an example on how you would put Generated Entities in (myCompany.BLL) and all the sprocs,dataContext stuff in the Mycompany.DAL (separate assemblies) and you make them talk to each other.</div></BLOCKQUOTE></p><p>I wasn't trying to say that Linq would BE the business layer.&nbsp; It would be USED by the data layer, just like NHibernate would.&nbsp; <br></p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>My problem is that I was trying to separate the two but I dont think you can.</div></BLOCKQUOTE></p><p>Well the business layer needs to talk to the data layer somehow, so they are coupled.&nbsp; It would be hard to totally decouple them, but I think Linq + entity classes are a good enough seperation.<br></p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>Also regarding how it fits into CSLA you right ,I misread the last bit of his note where he says he sees it working on a DataPortal a bit like nHibernate does.</div></BLOCKQUOTE></p><p>I think you misunderstood; NHiberate would be used in the DataPortal_xyz methods contained within the business object.. the DataPortal itself doesn't care how you access data, whether you use linq, ado.net, or nhibernate.</p>But using NHibernate in your business objects data access code certainly has been done.&nbsp; I think there's a sample floating around if you search the forums.<br><br>Hope that clears things up.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Wednesday, October 03, 2007</h2><P>Thanks for your reply.</P>
<P>I actually disagree on many points with regards to Linq but I really appreciate your help and time in replying.</P>
<P>EG<BR>LinqToSql entities (generated by sqlmetal) Implements interfaces + their properties raises events and methods that you can override in your own partial class using partial method.So it's not a DTO in the pure sense with just getters and setters in the simple form.</P>
<P>Linq is your DAL no doubt.But much of the stuff that gets generated is stuff that I would have coded in the bizObject.</P>
<P>Thanks again</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 03, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>dotnetbrix:</strong></div><div>
<P>Thanks for your reply.</P>
<P>I actually disagree on many points with regards to Linq but I really appreciate your help and time in replying.</P>
<P>EG<BR>LinqToSql entities (generated by sqlmetal) Implements interfaces + their properties raises events and methods that you can override in your own partial class using partial method.So it's not a DTO in the pure sense with just getters and setters in the simple form.</P>
<P>Linq is your DAL no doubt.But much of the stuff that gets generated is stuff that I would have coded in the bizObject.</P>
<P>Thanks again</P>
<P></div></BLOCKQUOTE></P>
<P>There's no doubt that Microsoft's code-gen for LINQ is putting some code beyond a simple DTO into their generated objects. Don't make the mistake of thinking this is anything other than code-gen though. In an earlier post someone discounted code-gen, but then accepted Microsoft's code-gen. That kind of thinking is dangerous and can lead to odd results like thinking a Recordset isn't an object because it came from Microsoft.</P>
<P>Not that I'm saying <EM>you</EM> are doing that. But I spent a lot of time explaining how and why custom objects (al la CSLA) are faster and lighter weight than a Recordset - to people who figured that since the Recordset came from Microsoft it must be "blessed".</P>
<P>The same with the DataSet. </P>
<P>LINQ's tools are merely code generators. Not open or flexible like most code-gen gools, and so technically not nearly as good. But what they DO have going for them is that they code-gen in a way that is expected by VS, and so there's an element of integration. That often offsets the lack of flexiblity, but not always.</P>
<P>In any case, there's a core philisophical question you need to answer for yourself. Are your objects defined by data, and then behavior is grafted onto them? Or are your objects defined by behavior (responsibility), and then they use the data necessary to perform that responsibility?</P>
<P>If you are comfortable with the former answer, then L4S, nHibernate, ADO.NET EF and most other ORM tools can be made to work for you. Generate the entity objects, graft on the business logic and away you go.</P>
<P>If you are comfortable with the second answer, then ORM tools fall short. I have yet to see one that works for this. CSLA is <EM>intended</EM> to help with this second approach. To help you create single responsibiltiy-driven objects that match your use case requirements.</P>
<P>I strongly prefer the second answer. 12 years ago I was solidly in the data-centric object camp. I lived and breathed that for years, increasingly frustrated the the "OO promise" never came true. I never reaped the benefits of the promised land.</P>
<P>About 7 years ago I started learning about this behavioral/responsibility based world. Slowly I moved more and more that direction, and I am far happier for it. I really do think I get major benefits from the OO promise now - in ways I never did before.</P>
<P>I think the data-centric approach is a dead end. Easier, more seductive, but not more powerful.</P>
<P>Which is not to say that ORM tools are bad. Far from it! Even though they don't solve the impedance mismatch problem (see David Taylor's books for this term), they do make it <EM>far easier</EM> to get data into/out of databases in many cases.</P>
<P>And it turns out to be much easier to solve object-to-object mapping than object-to-relational mapping when it comes to getting data into/out of responsibility-driven business objects. The ORM tools do the hard part of mapping from ugly relational tables into objects, and mapping those ugly (and inconsistent) database types into nice CLR types.</P>
<P>So by the time the ORM has done its job, our data is in nice CLR objects, ready for easy consumption. And that's a happy thing.</P>
<P>Unfortunately most ORMs (including L4S) kind of ignore the n-tier distributed computing world. Key bits of state don't move across tier boundaries (isnew, isdirty, isdeleted, etc). This complicates things and is very sad.</P>
<P>But don't look to Microsoft for an answer in the near term. They are so SOA focused that it doesn't matter. None of that stuff will ever flow across a service boundary, and there's a bias <EM>against</EM> n-tier within Microsoft these days. Sad but true.</P>
<P>CSLA does track this sort of state, and brings it with the object - thus solving the n-tier issue nicely, and still working with the SOA world too.</P>
<P>The hardest part of making CSLA play nice with L4S turns out to be <EM>this exact issue</EM>. How to best convince L4S to work efficiently when it is simply unable to manage this extra state data. There are answers - but the question is which answer is both maintainable and performant. Where's the tradeoff, and can CSLA help automate the work involve in any solution (thus increasing maintianability).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>webjedi replied on Wednesday, October 03, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>
<P>I think the data-centric approach is a dead end. Easier, more seductive, but not more powerful.</P>
<P></div></BLOCKQUOTE></P>
<P>So it's the like the Dark Side of the Force? :-)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 03, 2007</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>That was the intended reference </span><span>J</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>(though that is just a paraphrase &#8211; but I have this theory
that all of life can be described as a series of Star Wars quotes, and that has
yet to be proven wrong) <o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> webjedi
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Wednesday, October 03, 2007 4:35 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] How does Linq to Sql fit with CSLA?<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<blockquote>

<div>

<p class=MsoNormal><img id="_x0000_i1025" src="/Themes/default/images/icon-quote.gif"><strong>RockfordLhotka:</strong><o:p></o:p></p>

</div>

<div>

<p>I think the data-centric approach is a dead end. Easier, more seductive, but
not more powerful.<o:p></o:p></p>

</div>

</blockquote>

<p>So it's the like the Dark Side of the Force? :-)<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 04, 2007</h2><P>I am not a big fan of reflection either. It is just a tool that is sometimes useful.</P>
<P>CSLA doesn't use as much as people seem to think. There are a limited number of calls in the data portal to achieve dynamic behaviors. And n-level undo uses it to avoid you having to write tons of repetative, hard-to-debug code. All other uses are strictly optional.</P>
<P>L4S doesn't use much (if any) reflection. They avoid using reflection by using code-gen.</P>
<P>And CSLA could do this too - except in the data portal (which is a non-issue anyway). For example, n-level undo without reflection requires a lot of code. But code-gen could create that code, thus eliminating the use of reflection in that common scenario.</P>
<P>So the question is whether you want to rely on extensive code-gen, or the use of some reflection.</P>
<P>I've consistently opted for the limited use of reflection, because the alternative would <EM>require</EM> the use of code-gen to use CSLA. While I <EM>encourage</EM> the use of code-gen, I'm not quite ready to require it.</P>
<P>Microsoft has a long history of going the other way - all the way back to the VB4 wizard days. Fortunately they've gotten quite good at it, and most people don't even realize that the Windows Forms, Web Forms, WPF and other designers (including the LINQ designers) are all just code-gen tools built into VS.</P>
<P>However, if I do build a CSLA Light (as discussed in another thread), I would almost certainly end up going down that mandatory-code-gen path. This is because the kind of reflection required for n-level undo isn't in Silverlight, and so the huge, ugly, hard-to-debug code becomes unavoidable. And the way to make that a non-issue is to go with code-gen.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Friday, October 05, 2007</h2><P>hi,</P>
<P>thanks for your reply.If you use StoredProcedure with LinqToSql&nbsp; than reflection is used.</P>
<P>You might say it defeats the object of using LinqToSql.Yes it does.But it's inevitable with legacy system and real world app where SPS are way to complex or many more network trip would be required using LinqToSql or any other orm tool for that matter.<FONT size=2></P>
<P>[</FONT><FONT color=#2b91af size=2>Function</FONT><FONT size=2>(Name=</FONT><FONT color=#a31515 size=2>"dbo.Customer_READALL"</FONT><FONT size=2>)]</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ISingleResult</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>&gt; Customer_READALL()</FONT></P>
<P><FONT size=2>{</FONT></P>
<P><FONT color=#2b91af size=2>IExecuteResult</FONT><FONT size=2> result = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.ExecuteMethodCall(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>, ((</FONT><FONT color=#2b91af size=2>MethodInfo</FONT><FONT size=2>)(</FONT><FONT color=#2b91af size=2>MethodInfo</FONT><FONT size=2>.GetCurrentMethod())));</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> ((</FONT><FONT color=#2b91af size=2>ISingleResult</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>&gt;)(result.ReturnValue));</P>
<P>}</P>
<P>Thanks again</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, October 05, 2007</h2>






 





<div class=Section1>

<p class=MsoNormal><span>Well yes. But that kind of method-level reflection is a
non-issue. Just like the data portal using it.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>It is important to keep these things in perspective. Calling a
database is incredibly expensive. A small number of reflection calls to make it
happen are totally immaterial &#8211; they have no meaningful impact on
performance.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Now if you tell me that L4S, in some scenarios, uses reflection
to copy all the fields of data from the columns into some other location. Then
THAT can be an issue.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Do some tests. You&#8217;ll find that in a typical real app
(like a web app), whether you make a small number (1-5) method calls via
reflection when loading data from the database doesn&#8217;t even show up on
load tests.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>But if you try to load all your fields using reflection you&#8217;ll
probably see a 15% to 20% slowdown when compared to setting the fields directly
like I do in the book.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I did a lot of research in this area early on, because I did
consider making the data portal do the data copies on your behalf. And for a
lot of apps, that 15% perf hit is totally acceptable, so I did seriously
consider including my mapping code. But in the end I did not include it,
because that much use of reflection would have discredited the framework in the
eyes of too many people &#8211; even if it was optional&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Times have changed though. ASP.NET, Windows Forms and WPF use
reflection all over the place. Continually. And (almost) no one worries. The
amount of reflection used in a normal app is staggering, and people just
happily go about their business.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>So CSLA 3.5 may, in fact, include some heavier (though still
optional) use of reflection to help streamline the amount of code you need to
write when working with DTO/Entity objects (because L4S more properly creates a
form of Entity object) behind your business objects.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky</span><o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Monday, October 08, 2007</h2><P>Rocky,</P>
<P>what you are saying makes perfect sense.</P>
<P>However I have put together a quick test as this guy suggested</P>
<P><A href="http://alexpinsker.blogspot.com/2007/07/benchmarking-linq-vs.html">http://alexpinsker.blogspot.com/2007/07/benchmarking-linq-vs.html</A></P>
<P><STRONG><U>Results<BR></U></STRONG>So, comparing to the raw ADO.NET - DAAB is 8% slower and LINQ is 28% slower.<BR>Comparing to DAAB - LINQ is 18% slower.<BR>CPU usage intensity is about 2% average for raw ADO.NET vs. about 8% for DAAB vs. about 20% for LINQ - order of magnitude worse than raw ADO.NET (CPU graphs captured with perfmon below).</P>
<P>Thanks again for thorough reply.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, October 08, 2007</h2>Well, its good that you have some benchmarking tests, but Linq is still in beta.&nbsp; Its likely to be faster on RTM, when they don't have debug code and such.&nbsp; So I'd try again once its actually released.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 08, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>As has been pointed out, you are running beta software, so perf
tests are pretty unreliable. Also they are probably in violation of the EULA so
be careful </span><span>J</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>There&#8217;s no doubt that _<i>anything</i>_<i> </i>will be
slower than raw ADO.NET (with a &nbsp;datareader). This is because _<i>everything
else</i>_ uses a datareader to get data, and thus adds overhead. That&#8217;s
inescapable unless you find a data access technology that doesn&#8217;t build
on ADO.NET&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>L4S ultimately gets its data from a datareader. And if you
follow the pattern in my books your CSLA objects will too. But you can bet L4S
has to do more work than your DataPortal_XYZ() methods, because it is a more
general technology, where your methods are very specific to your needs.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>All that said, there are people on this forum who use a DataSet
to load their objects with data. That is _<i>terribly</i>_ slow compared to a
datareader. But if it is fast enough for their needs then who cares?<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>That&#8217;s the tradeoff. It is like CanReadProperty(). You can
use the fast-but-less-maintainable overload or the slower-but-more-maintainable
overload. Which you choose depends on whether, for your specific app,
maintainability or performance matters most. I can&#8217;t (and shouldn&#8217;t)
make that decision for you, I should just allow you to make that decision with
as little penalty (either way) as possible.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>So as I integrate LINQ into CSLA, that&#8217;s my guiding
principle. You _<i>must</i>_ still be able to use raw datareaders if you need
maximum performance. But if you can live with (whatever) overhead LINQ imposes then
you will most likely have to write a lot less code. Same kind of tradeoff.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> dotnetbrix
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Monday, October 08, 2007 7:18 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: How does Linq to Sql fit with CSLA?<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Rocky,<o:p></o:p></p>

<p>what you are saying makes perfect sense.<o:p></o:p></p>

<p>However I have put together a quick test as this guy suggested<o:p></o:p></p>

<p><a href="http://alexpinsker.blogspot.com/2007/07/benchmarking-linq-vs.html">http://alexpinsker.blogspot.com/2007/07/benchmarking-linq-vs.html</a><o:p></o:p></p>

<p><strong><u>Results</u></strong><b><u><br>
</u></b>So, comparing to the raw ADO.NET - DAAB is 8% slower and LINQ is 28%
slower.<br>
Comparing to DAAB - LINQ is 18% slower.<br>
CPU usage intensity is about 2% average for raw ADO.NET vs. about 8% for DAAB
vs. about 20% for LINQ - order of magnitude worse than raw ADO.NET (CPU graphs
captured with perfmon below).<o:p></o:p></p>

<p>Thanks again for thorough reply.<o:p></o:p></p>

<p>&nbsp;<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Tuesday, October 09, 2007</h2><P>Thanks a lot for your reply.It all makes sense.I only wish my boss listened to me</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robert_m replied on Tuesday, October 09, 2007</h2><P><SPAN>Rocky wrote:</SPAN></P>
<P><SPAN>"So as I integrate LINQ into CSLA, that’s my guiding principle....."</SPAN></P>
<P><SPAN>What kind of integration do you have in mind, if it's not too early to ask&nbsp;??</SPAN></P>
<P><SPAN></SPAN>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 09, 2007</h2>






 





<div class=Section1>

<p class=MsoNormal><span>You can envision a number of possibilities (and if you have
other thoughts I’d love to hear them).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>L4S returns DTOs (basically) that can be used to load the fields
of your object. DataMapper can (optionally) be used to copy this data to/from
the DTO if it is enhanced along that line.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>LINQ itself can be used in two modes – with projections and
without projections. Depends on your select clause.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>If you do a projection you are on your own – you get a new list
of new objects that have no link to the original objects at all.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>But if you do a “select item” then you get a new list that
contains references to the real objects. Even this, by default, is bad, because
this new list isn’t linked to the old list, so adding/removing items from it
has no effect on the real list – and that would be counter-intuitive, or at
least not nearly as powerful as today’s SortedBindingList and
FilteredBindingList.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>It may be possible to make LINQ return a list that IS linked to
the original list. Basically allowing you to do a query (without a projection)
that returns a live view of the original list (much like SBL and FLB). That’d
be cool.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I work with Aaron Erickson, the author of the open source
indexing library for LINQ. We may implement a version of that indexing code
directly in CSLA. Because CSLA objects are guaranteed to be richer than
standard objects, we can make LINQ do more with CSLA objects than it can do
with standard objects – and that’d be cool too.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Finally, and this is the hard part, to really work nicely with L4S
in a distributed scenario (remote data portal) it must be possible to do
insert/update/delete operations efficiently. Since L4S has a context idea that
isn’t n-tier, CSLA needs to help L4S overcome that limitation without making
the business developer write a lot of extra code. Challenging issue…<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky</span><o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robert_m replied on Tuesday, October 09, 2007</h2><P>Thnx for quick reply.</P>
<P>We are starting a new project using CSLA and are considering using LINQ primarily to load data from db (and save it back, of course). The idea for now is just to replace SqlCommand and SqlDataReader functionality with L4S (in DataPortal_XXX methods)....</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 09, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Yes, and that works great &#8211; no problems there that I&#8217;m
aware of &#8211; other than dealing with context for insert/update/delete
operations.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> robert_m [mailto:cslanet@lhotka.net]
<br>
<b>Sent:</b> Tuesday, October 09, 2007 8:07 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: RE: RE: How does Linq to Sql fit with
CSLA?<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Thnx for quick reply.<o:p></o:p></p>

<p>We are starting a new project using CSLA and are considering using LINQ
primarily to load data from db (and save it back, of course). The idea for now
is just to replace SqlCommand and SqlDataReader functionality with L4S (in
DataPortal_XXX methods)....<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 09, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>Finally, and this is the hard part, to really work nicely with L4S
in a distributed scenario (remote data portal) it must be possible to do
insert/update/delete operations efficiently. Since L4S has a context idea that
isn’t n-tier, CSLA needs to help L4S overcome that limitation without making
the business developer write a lot of extra code. Challenging issue…</div></BLOCKQUOTE><br><br>I've read an intro to Linq book, so I'm not as up on this as I'd like.&nbsp; Would it be possible to have the business objects hold on to Linq objects.&nbsp; I'm talking about classes marked with Table, Column, etc. attributes.&nbsp; Since I already have such objects (my DAL uses them so I can have strongly typed data objects), my hope was I could just flag them as Serializable add the additional Linq attributes, and possibly be able to have the BO use those to store the data.<br><br>Any reason that wouldn't work?&nbsp; I think its difficult, if you don't have a timestamp column on your table, but it does seem to be possible to unhook the context and re-attach one later.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 09, 2007</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>The problem is that the context can’t be serialized, so it is
lost in a remote data portal scenario, or stateless web scenario or a
service-oriented scenario. You can recreate the context – but that means
re-querying the database and that is inefficient.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>So instead, you need to call some other methods to “trick” an
empty context into realizing that your DTOs are “new”, “old” or “for deletion”.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> ajj3085
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Tuesday, October 09, 2007 8:40 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: RE: RE: How does Linq to Sql fit with
CSLA?<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<blockquote>

<div>

<p class=MsoNormal><img id="_x0000_i1025" src="/Themes/basicblue/images/icon-quote.gif"><strong>RockfordLhotka:</strong><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>Finally, and this is the hard part, to really work nicely
with L4S in a distributed scenario (remote data portal) it must be possible to
do insert/update/delete operations efficiently. Since L4S has a context idea
that isnâ€™t n-tier, CSLA needs to help L4S overcome that limitation without
making the business developer write a lot of extra code. Challenging issueâ€¦<o:p></o:p></p>

</div>

</blockquote>

<p class=MsoNormal><br>
<br>
I've read an intro to Linq book, so I'm not as up on this as I'd like.&nbsp;
Would it be possible to have the business objects hold on to Linq
objects.&nbsp; I'm talking about classes marked with Table, Column, etc.
attributes.&nbsp; Since I already have such objects (my DAL uses them so I can
have strongly typed data objects), my hope was I could just flag them as
Serializable add the additional Linq attributes, and possibly be able to have
the BO use those to store the data.<br>
<br>
Any reason that wouldn't work?&nbsp; I think its difficult, if you don't have a
timestamp column on your table, but it does seem to be possible to unhook the
context and re-attach one later.<br>
<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>komminane replied on Friday, October 05, 2007</h2>will the LinQ Anonymous classes replaces the CSLA DTO'S concept ?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dotnetbrix replied on Thursday, October 04, 2007</h2><P>Hi there,</P>
<P>thank you very much for such a lenghty and good reply.Apologies if didnt reply earlier on.</P>
<P>I am a big fan of CSLA and I have used it in personal projects.I am trying to persuade my boss not to go for the time being via LinqToSql route till it becames a more mature product&nbsp;but embrace the CSLA,as it would be crazy to write a framework from scratch when there is one already available with a fairly big community too.</P>
<P>I am not a particular fan of ORMs tools either&nbsp; for all the reasons you mentioned above.</P>
<P>I beleive it too that Data Centric is not the way to go,however I am not the decision maker.</P>
<P>Because we going for linqToSql i am been asked to put a framework together around it,and I am still struggling on some bits .My conclusion is that it's not ready for enterprise usage and multitier scenarios,but hey I have to make it work.</P>
<P>I beleive MS did a fantastic job with SqlMetal but not a finished job though as there are so many limitation to this tool,not time on my part to put a gui to it.</P>
<P>All this prompted me to ask this community their view on integrating with CSLA.As already pointed out it come be done ,but at what cost.</P>
<P>I am not a big fan of Reflection and even though is also used in CSLA ,I tend to avoid when I can to keep the performance up.There is nothing faster than RAW ADO.NET,however this&nbsp;ORM&nbsp;tools make very large use of it.</P>
<P>I will stop here and I will be keeping an eye just in case somebody in community posts an example&nbsp; of integration with LinqToSql</P>
<P>Thanks again </P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tolomaüs replied on Wednesday, October 03, 2007</h2><P>&gt; The more I look at it ,it looks like that LinqToSql "is" the Data Layer and whatever Is generated by sqlMetal is the actual business Layer,which means not having a physical DataLayer.Indeed, </P>
<P>Indeed, I have come to the same conclusion with NHibernate as ORM solution and I think&nbsp;this conclusion&nbsp;is valid for any ORM. In fact, the ORM itself contains a "generic" datalayer&nbsp;which it hides from the business layer. Instead, it provides access to the business objects themselves.&nbsp;</P>
<P>Even with this in mind, it&nbsp;still seems interesting to me to abstract away the behaviour of&nbsp;your specific ORM behind an interface so your business doesn't depend on it. You could call this additional layer a "Repository" as it groups all methods to access your business objects.</P>
<P>I found some interesting reads about this:</P>
<P><A href="http://krisvandermotten.wordpress.com/2006/11/19/creating-a-data-access-layer-with-linq-to-sql-part-1/">http://krisvandermotten.wordpress.com/2006/11/19/creating-a-data-access-layer-with-linq-to-sql-part-1/</A></P>
<P>and</P>
<P><A href="http://debasishg.blogspot.com/2007/02/domain-driven-design-inject.html">http://debasishg.blogspot.com/2007/02/domain-driven-design-inject.html</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robert_m replied on Wednesday, October 03, 2007</h2><P>I am quite new to LINQ but I would agree with <A HREF="/members/ajj3085.aspx">ajj3085</A> 's post. LINQ can be used in DataPortal_XYZ methods to load and save data. In standard scenarios&nbsp;there should be&nbsp;no need for an extra data access&nbsp;tier since one of the main features of CSLA architecture&nbsp;is that CSLA objects are mobile. ie they exist on both client and server side as neeeded. So, instead of working with SqlCommands and SqlDataReaders, you can use strongly typed LINQ queries to achieve the same funcionality with less code (and much more maintainable code)</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
