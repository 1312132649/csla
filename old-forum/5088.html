<html><header><title>Values in Identity column</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Values in Identity column</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5088.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gPlans posted on Saturday, July 12, 2008</h2>When saving a business object that contains an identity column, the value is assigned by the DB automatically. Is there a way of assigning unique values to the identity column <STRONG><EM>before</EM></STRONG> the insert? i.e. before the business object is saved like ado.net's datatable or do I have to write such logic myself?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Saturday, July 12, 2008</h2>The usual way to do this is to assign negative numbers to the new objects. When they are saved, update it with the real id that you get back from the db. Keep a static variable in the class to remember the next temporary id and decrement when required.<br><br><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>gPlans:</strong></div><div>When saving a business object that contains an identity column, the value is assigned by the DB automatically. Is there a way of assigning unique values to the identity column <strong><em>before</em></strong> the insert? i.e. before the business object is saved like ado.net's datatable or do I have to write such logic myself?</div></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Saturday, July 12, 2008</h2>If you use an identity column, the only way to make that work is to allow the database to do its magic.&nbsp; The identity column must be managed by the database to satisfy the requirements of serving multiple insert requests from from application instances.<br><br>One other choice is to use a GUID as the primary key.&nbsp; You can generate the GUID value in the application and simply send the value to the database at the time of the insert.&nbsp; A lot of people swear by this approach.&nbsp; The downside is that the GUID is significantly harder to read, type, etc.&nbsp; That makes debugging more difficult.&nbsp; The GUID column also takes up 128 bits against 32 bits for the typical identity column.&nbsp; <br><br>In my mind, the major (but not the only) discriminator between the two approaches is the "distance" between the application and the database.&nbsp; If the application is "far away" in the sense of having to communicate with the database over a narrow (perhaps sometimes disconnected) pipe, the GUID makes a lot of sense.&nbsp; I could build an application that runs on a disconnected laptop and creates GUID-keyed data on a local copy of the database, syncing up when it finally got a connection.&nbsp; This would be a very workable solution.&nbsp; On the other hand, if the application and the database were "close together" in the sense that there was a big pipe to the database and the application was designed on the premise that pipe was always available, the downsides of the identity column do not have much impact.<br><br>I suspect that there are other issues here, but this is my two cents.<br><br>Jon Stonecash<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gPlans replied on Saturday, July 12, 2008</h2><P class=MsoNormal><FONT face=Tahoma size=2>Hi,</FONT></P>
<P class=MsoNormal><o:p><FONT face=Tahoma size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Tahoma size=2>Sorry guys, I left out some crucial information from my earlier post. Here it is:</FONT></P>
<OL>
<LI class=MsoNormal><FONT face=Tahoma size=2>I am new to CSLA but not to .Net or to programming in general.</FONT></LI>
<LI class=MsoNormal><FONT size=2><FONT face=Tahoma>My target database is an already existing and is being used by another application, so editing its schema is not an option.</FONT></FONT><o:p><FONT face=Tahoma size=2>&nbsp;</FONT></o:p></LI></OL>
<P class=MsoNormal><FONT size=2><FONT face=Tahoma>JonStonecash:<o:p></o:p></FONT></FONT></P>
<P class=MsoNormal><o:p><FONT face=Tahoma size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT size=2><FONT face=Tahoma>Using a GUID could have been the best option, if I could change the schema (my apologies for not supplying you with all the information)<o:p></o:p></FONT></FONT></P>
<P class=MsoNormal><o:p><FONT face=Tahoma size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Tahoma size=2>tetranz:</FONT></P>
<P class=MsoNormal><o:p><FONT face=Tahoma size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Tahoma size=2>Using negative numbers seem to be the only option since there is no possibility of having a conflict while updating to the database. I have done this before in ADO.NET datatables. My question is: since having objects with a unique key is an everyday requirement, and since Identity Columns are very common, is there a traditional way of doing this in CSLA build-in or otherwise? Note: I am talking about an object <B><I>before</I></B> it has been saved to the database since after saving, the assigned ID can be retrieved.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Saturday, July 12, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>gPlans:</strong></div><div><p class="MsoNormal"><font size="2" face="Tahoma">Using negative numbers seem to be the only option since there is no possibility of having a conflict while updating to the database. I have done this before in ADO.NET datatables. My question is: since having objects with a unique key is an everyday requirement, and since Identity Columns are very common, is there a traditional way of doing this in CSLA build-in or otherwise? Note: I am talking about an object <b><i>before</i></b> it has been saved to the database since after saving, the assigned ID can be retrieved.</font></p></div></BLOCKQUOTE><br><br>There's no built in way of handling it. That's because Csla doesn't assume any type of data access technology.<br><br>The negative numbers work fine, involves very little code and ensures that the object always has a unique id which Csla requires if it's a child object in a collection. I don't have my standard code at my fingertips but it's something like:<br><br>private static int _tempId;&nbsp; // (that's at the class level);<br><br>DataPortal_Create()<br>{<br>&nbsp; _id = --_tempId;<br>}<br><br>I usually use stored procedures with SQL Server. My Id parameter is marked as OUTPUT in my insert sprocs. @Id is set to SCOPE_IDENTITY() after the insert.<br><br>DatePortal_Insert<br>{<br>&nbsp; _id = Get new value of parameter after execution.&nbsp; Sorry I don't have the exact line of code. I think it's just the Value property of SqlParameter.<br>}<br><br>Some of my WinForms use the id to control single instance. I need to update that after a save.<br><br>Cheers<br>Ross<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gPlans replied on Saturday, July 12, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tetranz:</strong></div><div><BR>There's no built in way of handling it. That's because Csla doesn't assume any type of data access technology.<BR></div></BLOCKQUOTE></P>
<P>Thanks so much, that is the confirmation I needed.&nbsp;By&nbsp;writting custom code, I know I will not be re-inventing the wheel.</P>
<P>Regards,<BR>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
