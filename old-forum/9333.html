<html><header><title>CSLA Framework, Multiple Environments and a Single App</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA Framework, Multiple Environments and a Single App</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9333.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>walkerstewart posted on Friday, August 06, 2010</h2><p>Hi All,</p>
<p>Not sure if anyone has discussed this before (there was this post: <a href="http://forums.lhotka.net/forums/p/4413/21600.aspx#21600">http://forums.lhotka.net/forums/p/4413/21600.aspx#21600</a>, but wasn&#39;t sure if it does the same thing).</p>
<p>I have created a single administration application that can access 4 seperate CSLA WCF environments (provided they run the same server side of things), by dynamically selecting a different WCF endpoint configured in an app.config.</p>
<p>I know that this may have limited use, but Just thought that I&#39;d post it in case anyone else was interested in doing this as well.</p>
<p>Code Changes in CSLA:</p>
<p>In the WcfProxy.cs class:</p>
<p>FROM:</p>
<p>protected virtual ChannelFactory&lt;IWcfPortal&gt; GetChannelFactory()<br />{<br />&nbsp;&nbsp;&nbsp; return new ChannelFactory&lt;IWcfPortal&gt;(_endPoint);<br />}</p>
<p>TO</p>
<p>protected virtual ChannelFactory&lt;IWcfPortal&gt; GetChannelFactory()<br />{<br />&nbsp;&nbsp;&nbsp; string _wcfEndPoint = Environment.GetEnvironmentVariable(&quot;WcfEndPoint&quot;, EnvironmentVariableTarget.Process);</p>
<p>&nbsp;&nbsp;&nbsp; if (_wcfEndPoint != null)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _endPoint = _wcfEndPoint;<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; return new ChannelFactory&lt;IWcfPortal&gt;(_endPoint);<br />}</p>
<p>&nbsp;</p>
<p>In your main application, simply set the system environment variable before accessing your CSLA classes (I have a Combo box to do this since my app is an admin tool).</p>
<p>Environment.SetEnvironmentVariable(&quot;WcfEndPoint&quot;, &quot;Dev&quot;&nbsp;, EnvironmentVariableTarget.Process);</p>
<p>Environment.SetEnvironmentVariable(&quot;WcfEndPoint&quot;, &quot;Test&quot;&nbsp;, EnvironmentVariableTarget.Process);</p>
<p>Environment.SetEnvironmentVariable(&quot;WcfEndPoint&quot;, &quot;Prod&quot;&nbsp;, EnvironmentVariableTarget.Process);</p>
<p>&nbsp;</p>
<p>And finally in the App.Config file setup your extra CSLA End Points.</p>
<p>&lt;client&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;net.tcp://xappd01:8142/Service/&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;netTcpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;RBehavior&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;RNew&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; name=&quot;WcfDataPortal&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servicePrincipalName value=&quot;MYSERVICE/MyMachine&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;net.tcp://xappd01:8142/Service/&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;netTcpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;RBehavior&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;RNew&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; name=&quot;Dev&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servicePrincipalName value=&quot;MYSERVICE/MyMachine&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;net.tcp://xappd01:8350/Service/&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;netTcpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;RBehavior&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;RNew&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; name=&quot;Test&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servicePrincipalName value=&quot;MYSERVICE/MyMachine&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;net.tcp://xappd01:8551/Service/&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;netTcpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;RBehavior&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;RNew&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; name=&quot;Qual&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servicePrincipalName value=&quot;MYSERVICE/MyMachine&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;net.tcp://xappd02:8650/Service/&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;netTcpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;RBehavior&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;RNew&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; name=&quot;Prod&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servicePrincipalName value=&quot;MYSERVICE/MyMachine&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/client&gt;<br />&nbsp; &lt;/system.serviceModel&gt;</p>
<p>&nbsp;</p>
<p>Somehow I thought that it might be a little more difficult, but this turned out to be extremely straight forward. Note that the Environment Variable set applies at the process level, so as soon as the app is closed, the variable is cleared. Oh and if you don&#39;t set the Environment Variable, CSLA gets left alone and the standard &quot;WcfDataPortal&quot; name is used.</p>
<p>&nbsp;</p>
<p>Let me know what you guys think and whether it is worthy of inclusion in the CSLA core.</p>
<p>Stewy</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
