<html><header><title>Somewhat OT:  Sql server and &quot;parent&quot; rows</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Somewhat OT:  Sql server and &quot;parent&quot; rows</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4364.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, February 18, 2008</h2>I have a hierarchy stored in Sql with the simply ParentId column method.&nbsp; I'm at a point now where I want to take the current rows quantity, and multiplie it by its parent row quantity, if it has a parent.&nbsp; This multipling should continue all the way up until we get to the row which has no parent.<br><br>These are line items.. so they have quantity, price ,etc.&nbsp; here's a sample row<br><br>LineItemId&nbsp;&nbsp;  Qty&nbsp;&nbsp;  PartNumber&nbsp;&nbsp;  Parent<br>1&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  2&nbsp;&nbsp;  &nbsp;&nbsp;  GP-001&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  NULL<br>2&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  4&nbsp;&nbsp;  &nbsp;&nbsp;  BND-001&nbsp;&nbsp;  &nbsp;&nbsp;  1<br>3&nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  7&nbsp;&nbsp;  &nbsp;&nbsp; PART-001&nbsp;&nbsp;  &nbsp; 2<br><br>What I want is to find the actual quantity of line item 3, which is 56.&nbsp; Anyone have a good way to do this in Sql / Linq directly?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SomeGuy replied on Monday, February 18, 2008</h2><P>I think you can do it with a CTE like:</P><FONT color=#0000ff size=2>
<P>DECLARE</FONT><FONT size=2> @AssemblyID </FONT><FONT color=#0000ff size=2>INT</P>
<P>SELECT</FONT><FONT size=2> @AssemblyID </FONT><FONT color=#808080 size=2>=</FONT><FONT size=2> 800</FONT><FONT color=#808080 size=2>;</P></FONT><FONT color=#0000ff size=2>
<P>SELECT</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>*</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>FROM</FONT><FONT size=2> Production</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>Product </FONT><FONT color=#0000ff size=2>WHERE</FONT><FONT size=2> ProductID </FONT><FONT color=#808080 size=2>=</FONT><FONT size=2> @AssemblyID</FONT><FONT color=#808080 size=2>;</P></FONT><FONT color=#0000ff size=2>
<P>WITH</FONT><FONT size=2> Parts</FONT><FONT color=#808080 size=2>(</FONT><FONT size=2>AssemblyID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> ComponentID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> PerAssemblyQty</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> TotalQty</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> UnitMeasureCode</FONT><FONT color=#808080 size=2>)</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>AS</P></FONT><FONT color=#808080 size=2>
<P>(</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>SELECT</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ProductAssemblyID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>PerAssemblyQty</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>PerAssemblyQty</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>UnitMeasureCode</P>
<P></FONT><FONT color=#0000ff size=2>FROM</FONT><FONT size=2> Production</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>BillOfMaterials </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> b</P>
<P></FONT><FONT color=#0000ff size=2>WHERE</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ProductAssemblyID </FONT><FONT color=#808080 size=2>=</FONT><FONT size=2> @AssemblyID</P>
<P></FONT><FONT color=#808080 size=2>AND</FONT><FONT size=2> b</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>EndDate </FONT><FONT color=#808080 size=2>IS</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>NULL</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>UNION</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>ALL</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>SELECT</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ProductAssemblyID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>PerAssemblyQty</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2>CAST</FONT><FONT color=#808080 size=2>(</FONT><FONT size=2>p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>PerAssemblyQty </FONT><FONT color=#808080 size=2>*</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>PerAssemblyQty </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>DECIMAL</FONT><FONT color=#808080 size=2>(</FONT><FONT size=2>8</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2>2</FONT><FONT color=#808080 size=2>)),</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>UnitMeasureCode</P>
<P></FONT><FONT color=#0000ff size=2>FROM</FONT><FONT size=2> Production</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>BillOfMaterials </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> bom </P>
<P></FONT><FONT color=#808080 size=2>INNER</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>JOIN</FONT><FONT size=2> Parts </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> p</P>
<P></FONT><FONT color=#0000ff size=2>ON</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ProductAssemblyID </FONT><FONT color=#808080 size=2>=</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID</P>
<P></FONT><FONT color=#808080 size=2>AND</FONT><FONT size=2> bom</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>EndDate </FONT><FONT color=#808080 size=2>IS</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>NULL</P>
<P>)</P></FONT><FONT color=#0000ff size=2>
<P>SELECT</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> pr</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#0000ff size=2>Name</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2>SUM</FONT><FONT color=#808080 size=2>(</FONT><FONT size=2>p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>TotalQty</FONT><FONT color=#808080 size=2>),</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>UnitMeasureCode</P></FONT><FONT color=#0000ff size=2>
<P>FROM</FONT><FONT size=2> Parts </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> p</P>
<P></FONT><FONT color=#808080 size=2>INNER</FONT><FONT size=2> </FONT><FONT color=#808080 size=2>JOIN</FONT><FONT size=2> Production</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>Product </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2> pr</P>
<P></FONT><FONT color=#0000ff size=2>ON</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID </FONT><FONT color=#808080 size=2>=</FONT><FONT size=2> pr</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ProductID</P></FONT><FONT color=#0000ff size=2>
<P>GROUP</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>BY</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>ComponentID</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> pr</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#0000ff size=2>Name</FONT><FONT color=#808080 size=2>,</FONT><FONT size=2> p</FONT><FONT color=#808080 size=2>.</FONT><FONT size=2>UnitMeasureCode</FONT><FONT color=#808080 size=2>;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 18, 2008</h2>Ahh, good idea.&nbsp; I was able to get this working..I think.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Monday, February 18, 2008</h2>Andy, to take products of these rows, you can use <font face="Arial" size="2">EXP(SUM(LOG(Qty))).<br><br>The only catch is the qty must be positive value.<br><br>HTH,<br>Ricky.<br></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
