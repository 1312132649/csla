<html><header><title>Business Rule</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business Rule</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10484.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro posted on Friday, July 01, 2011</h2><p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">We are working with CSLA 4 and we have an issue with the business rules. We want to modify/reset a property when another specific property is set (value changes), so I created a Business Rule to do this (let&rsquo;s call it B1). The problem is that when BusinessRules.CheckRules() runs it also runs B1, and I do not want that. I want the rule B1 to be run only when the value changes. I would have thought that Business Rules, which modify other properties, would be run only when the properties associated to them are set.</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Is there a built in way to achieve this?</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Here are some solutions I know I can implement:</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:-0.25in;mso-list:l0 level1 lfo1;" class="MsoListParagraphCxSpFirst"><span style="mso-fareast-font-family:Calibri;"><span style="mso-list:Ignore;"><span style="font-size:small;font-family:Calibri;">-</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:small;"><span style="font-family:Calibri;">one is to remove the rule and go back to how we used to do it: by calling a reset method directly from the property setter.</span></span></p>
<p style="margin:0in 0in 10pt 0.5in;text-indent:-0.25in;mso-list:l0 level1 lfo1;" class="MsoListParagraphCxSpLast"><span style="mso-fareast-font-family:Calibri;"><span style="mso-list:Ignore;"><span style="font-size:small;font-family:Calibri;">-</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:small;"><span style="font-family:Calibri;">another possible solution is to create a flag to indicate that the property is in the process of been changed and it will help us know inside the rule that the call came from the property setter but we will have to create variables for every property that has a business rule associated. </span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Does anybody know how to do it or has a better solution for this situation?</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">Thanks,</span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">Lazaro</span></p>
<p style="margin:0in 0in 0pt;line-height:50%;mso-margin-top-alt:auto;" class="MsoNormal"><span style="font-size:9pt;color:black;line-height:50%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;"></span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Tuesday, July 05, 2011</h2><p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Does anyone have any ideas for this problem?</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks, </span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Lazaro</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>rxelizondo replied on Wednesday, July 06, 2011</h2><p><br />Hi Lazaro,</p>
<p><br />I never tried this but I wonder if a &quot;RuleSet&quot; will work for you. Something like this:</p>
<p>protected override void AddBusinessRules()<br />{<br />&nbsp;&nbsp; BusinessRules.RuleSet = &quot;default&quot;;<br />&nbsp;&nbsp; // Here you add all your rules including B1 rule.</p>
<p>&nbsp;&nbsp; BusinessRules.RuleSet = &quot;SpecialRuleSet&quot;;<br />&nbsp;&nbsp; // Here you add all your rules except B1.</p>
<p>&nbsp;&nbsp; // Set what RuleSet you want to be active.<br />&nbsp;&nbsp; BusinessRules.RuleSet = &quot;default&quot;;<br />}</p>
<p>So now, when you do a &quot;RuleCheck()&quot;, you do this:</p>
<p>BusinessRules.RuleSet = &quot;SpecialRuleSet&quot;;<br />BusinessRules.CheckRules();<br />BusinessRules.RuleSet = &quot;default&quot;;</p>
<p>----------------</p>
<p>Instead of retyping all the rules twice, I guess you could create a function that adds all the rules and pass a parameter to the function indicating wether to add or not add the B1 rule:</p>
<p>protected override void AddBusinessRules()<br />{<br />&nbsp;&nbsp; BusinessRules.RuleSet = &quot;default&quot;;<br />&nbsp;&nbsp; AddAllRules(true) // includes B1.</p>
<p>&nbsp;&nbsp; BusinessRules.RuleSet = &quot;SpecialRuleSet&quot;;<br />&nbsp;&nbsp; AddAllRules(false) // do not includes B1.</p>
<p>&nbsp;&nbsp; // Set what RuleSet you want to be active.<br />&nbsp;&nbsp; BusinessRules.RuleSet = &quot;default&quot;;<br />}</p>
<p>Again, not sure if it would work so please let me know because I am kind of curios.</p>
<p>Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Friday, July 08, 2011</h2><p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Thank you for your answer. Here is how I did it using the RuleSet.</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">We have a Business Base class that is the base to all our business classes (in-between the CSLA Base class), so we put the following logic there for all our business classes to use. The idea is that when a rule gets added, we know whether it modifies or not and if it does, we do not execute it when calling all the rules. Note that the rules that we add as modifying rules should not contain validation logic, but only modification logic.</span></span></p>
<p style="margin:0in 0in 0pt;line-height:normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;" class="MsoNormal"><span style="font-size:10pt;color:blue;font-family:Consolas;mso-fareast-font-family:&#39;Times New Roman&#39;;">public</span><span style="font-size:10pt;font-family:Consolas;mso-fareast-font-family:&#39;Times New Roman&#39;;">&nbsp;<span style="color:blue;">abstract</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">MyBusinessBase</span>&lt;T&gt;&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessBase</span>&lt;T&gt;&nbsp; <br />&nbsp;&nbsp;<span style="color:blue;">where</span>&nbsp;T&nbsp;:&nbsp;<span style="color:#2b91af;">MyBusinessBase</span>&lt;T&gt;<br />{</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;" class="MsoNormal"><span style="font-size:10pt;font-family:Consolas;mso-fareast-font-family:&#39;Times New Roman&#39;;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span>#region</span><span style="font-size:9.5pt;font-family:Consolas;"> CONSTANT</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span><span style="font-size:9.5pt;font-family:Consolas;"> <span style="color:blue;">const</span> <span style="color:blue;">string</span> CONST_RULESET_WITHOUT_MODIFYING_BUSINESS_RULES = <span style="mso-spacerun:yes;">&nbsp;&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span><span style="color:#a31515;">&quot;WithoutModifyingBusinessRules&quot;</span>;</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span><span style="font-size:9.5pt;font-family:Consolas;"> <span style="color:blue;">const</span> <span style="color:blue;">string</span> CONST_RULESET_DEFAULT = <span style="color:#a31515;">&quot;default&quot;</span>;</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp; </span>#endregion</span></p>
<p style="margin:0in 0in 0pt;line-height:normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;" class="MsoNormal"><span style="font-size:10pt;font-family:Consolas;mso-fareast-font-family:&#39;Times New Roman&#39;;">&nbsp;</span></p>
<pre><span style="color:blue;font-family:Consolas;"><span style="font-size:x-small;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span></span><span style="font-family:Consolas;"><span style="font-size:x-small;">&nbsp;<span style="color:blue;">void</span>&nbsp;AddBusinessRule(<span style="color:#2b91af;">IBusinessRule</span>&nbsp;rule)<br /><span style="mso-spacerun:yes;">&nbsp; </span>{<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;AddBusinessRule(rule,&nbsp;<span style="color:blue;">false</span>);<br /><span style="mso-spacerun:yes;">&nbsp; </span>}<br /><br />
<span style="color:blue;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AddBusinessRule(<span style="color:#2b91af;">IBusinessRule</span>&nbsp;rule,&nbsp;<span style="color:blue;">bool</span>&nbsp;itModifies)<br /><span style="mso-spacerun:yes;">&nbsp; </span>{<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;<span style="color:blue;">if</span>&nbsp;(!itModifies)<br /><span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;&nbsp;&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_WITHOUT_MODIFYING_BUSINESS_RULES;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;BusinessRules.AddRule(rule);<br /><span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;&nbsp;&nbsp;}<br /><span style="mso-spacerun:yes;">&nbsp;</span><br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_DEFAULT;<br /><span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;&nbsp;&nbsp;BusinessRules.AddRule(rule);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="mso-spacerun:yes;">&nbsp; </span>}<br />
<span style="color:blue;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span>&nbsp;<span style="color:blue;">void</span>&nbsp;CheckAllRules()<br /><span style="mso-spacerun:yes;">&nbsp; </span>{<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_WITHOUT_MODIFYING_BUSINESS_RULES;<br /><span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;&nbsp;&nbsp;BusinessRules.CheckRules();<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp; </span>&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_DEFAULT;<br /><span style="mso-spacerun:yes;">&nbsp; </span>}</span></span></pre>
<p style="margin:0in 0in 0pt;line-height:normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;" class="MsoNormal"><span style="font-size:10pt;font-family:Consolas;mso-fareast-font-family:&#39;Times New Roman&#39;;">&nbsp;</span><span style="font-family:Consolas;"><br /><span style="font-size:x-small;"><span style="color:blue;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Child_Create()<br /><span style="mso-spacerun:yes;">&nbsp; </span>{<br /><span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_WITHOUT_MODIFYING_BUSINESS_RULES;<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;<span style="color:blue;">base</span>.Child_Create();<br /><span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_DEFAULT;<br /><span style="mso-spacerun:yes;">&nbsp; </span>}<br /><br /><span style="color:blue;"><span style="mso-spacerun:yes;">&nbsp; </span>protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;DataPortal_Create()<br /><span style="mso-spacerun:yes;">&nbsp; </span>{<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_WITHOUT_MODIFYING_BUSINESS_RULES;<br /><span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.DataPortal_Create();<br />&nbsp;&nbsp;<span style="mso-spacerun:yes;">&nbsp;&nbsp;</span>&nbsp;BusinessRules.RuleSet&nbsp;=&nbsp;CONST_RULESET_DEFAULT;<br /><span style="mso-spacerun:yes;">&nbsp; </span>}</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">}</span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, July 09, 2011</h2><p>Hi, </p>
<p>A very simple soultion is in your rules execute method to test for:</p>
<p>if (ApplicationContext.LogicalExecutionContext == LogicalExecutionContexts.Client) {<br />&nbsp;&nbsp;&nbsp; ... rule logic runs onle on client side when property is changed or CheckRules is called. <br />}</p>
<p>You should also be aware that for Csla 4.2 we have added options to restrict when a rule will run (RunMode) when you register a rule. I have had the same problems with rules that updates other properties and (avoiding) async rule chaining. </p>
<p>&nbsp; [Flags]<br />&nbsp; public enum RunModes<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Default value, rule can run in any context<br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; Default=0,<br />&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Deny rule from running in CheckRules <br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; DenyCheckRules = 1,<br />&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Deny rule from running as AffectedProperties from another rule.<br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; DenyAsAffectedProperty = 2,<br />&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Deny rule from running on serverside portal<br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; DenyOnServerSidePortal = 4<br />&nbsp; }<br /><br />Code sample <br /><br /><br />&nbsp;&nbsp;&nbsp; protected override void AddBusinessRules()&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.AddBusinessRules();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new OnlyWhenPropertyHasChanged(Value1Property) { RunMode = RunModes.DenyCheckRules | RunModes.DenyAsAffectedProperty });<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule((new AsyncRule(Value2Property){RunMode = RunModes.DenyOnServerSidePortal}));<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Monday, July 11, 2011</h2><p>Thanks Jonny.</p>
<p><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">I will download the version 4.2 right now because it is really what I was waiting for.</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Monday, July 11, 2011</h2><p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Hi Jonny,</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">I just downloaded the version 4.2 but it did not include the logic that you just mentioned about restricting when the business rules should be running.</span></span></p>
<p style="margin:0in 0in 10pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Could you let me know when the code will be available to de downloaded?</span></span></p>
<p style="margin:0in 0in 0pt;line-height:normal;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Thanks again,</span></span></p>
<p style="margin:0in 0in 0pt;line-height:normal;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Lazaro</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, July 12, 2011</h2><p>Use Subversion and download the latest version from trunk (anynonymous has readonly&nbsp;access):</p>
<p><a href="http://www.lhotka.net/cslanet/Repository.aspx">http://www.lhotka.net/cslanet/Repository.aspx</a></p>
<p>(We use TortoiseSVN for access - you will find a link to this in the repository page.)</p>
<p>Another interesting point is that we/you may also create new rule&nbsp;base classes like (I haven&#39;t time to tinker&nbsp;around with these ideas yet)&nbsp;</p>
<p>PropertyChangedRule&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (property changed and cascaded change)<br />PropertyChangedOnlyRule (property changed only - not cascaded property changed)<br />ObjectRule&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (object level rule)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro replied on Thursday, July 14, 2011</h2><p>Thanks Jony,</p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">I was able to download CSLA from the trunk and we are testing the project right now. </span></p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">When the version 4.2 gets officially released, will it contain this code?</span></p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;"></span></p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">Thanks,</span></p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">Lazaro</span></p>
<p style="margin:0in 0in 0pt;"><span style="font-size:9pt;color:black;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;">&nbsp;</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, July 15, 2011</h2><p>Csla 4.2 is still alpha so there could still come breaking changes but we have not (yet) discussed any removal of this feature/rework of the rule engine. </p>
<p>We&#39;d still like to get feedback from developers on how this feature has been implemented and it&#39;s usability. </p>
<p>This feature has been on the wish list for some time and we want to support the Error/Warn/Info messages to other properties than primary property and also support external rule engines (that may return a list of properties and messages).</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Tuesday, October 18, 2011</h2><p>Hi,</p>
<p>The RunModes sound interesting to me. Have you considered a mode for&nbsp; &quot;run only before Save()&quot; ? <br />Right now we set a flag on the BOs, which all our rules have to check.</p>
<p>Or has anyone a solution for this: for certain reason we set <span style="color:red;">UpdateSourceTrigger</span><span style="color:blue;">=</span><span style="color:black;">&quot;</span><span style="color:blue;">PropertyChanged</span><span style="color:black;">&quot; in Xaml. That&#39;s no problem with simple validation rules, but expensive rules should only run just before the Save() ?&nbsp; </span></p>
<p><span style="color:black;">Would async rules or priority help?</span></p>
<p><span style="color:black;"><br /></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 19, 2011</h2><p>Hi Stefan, </p>
<p>No, we haven&#39;t discussed or even considered a mode for RunOnlyBeforeSave. </p>
<p>The main reason is that inside CSLA the BusinessRules.CheckRules() is only ever called by the framework in Core.BusinessBase:</p>
<ul>
<li>DataPortal_Create</li>
<li>Child_Create</li>
<li>ICheckRules.CheckRules&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (used by CslaModelBinder in web applications)</li>
<li>IDataPortalTarget.CheckRules&nbsp; (used by ObjectFactory classes)</li>
</ul>
<p>So - there is no &quot;context&quot; for the BusinessRules to know if it is called from a Save or any other part of your code. </p>
<p>The &quot;primary&quot; usage of rules should be to check rules when object is 
created - then check all rules as properties is changed by the user. </p>
<p>Property rules is triggered from the &lt;bo&gt;.<b>PropertyHasChanged </b>method and object level rules by &lt;bo&gt;.<b>CheckObjectRules</b>. These are the ONLY methods you should call on an object that is active in databinding as only these methods will raise OnPropertyChanged for affected properties to keep the UI in sync.</p>
<p>&lt;bo&gt;.BusinessRules.CheckRules should only be called on objects that are not active in databinding (ex dDataAccess) because this code will not raise&nbsp; OnPropertyChanged event to update the UI. </p>
<p><div style='padding-left: 50px;background-color:silver'><b>StefanCop<br></b>Or has anyone a solution for this: for certain reason we set <span style="color:red;">UpdateSourceTrigger</span><span style="color:blue;">=</span><span style="color:black;">&quot;</span><span style="color:blue;">PropertyChanged</span><span style="color:black;">&quot; in Xaml. That&#39;s no problem with simple validation rules, but expensive rules should only run just before the Save() ?&nbsp; </span></div></p>
<p>Now for your WPF/SL validation I prefer to use async validation rules for expensive rules and only allow these to run when the property is changed by the user (ie: <b>CanRunAsAffectedProperty</b>, <b>CanRunInCheckRules </b>and <b>CanRunOnServer </b>all set to <b><i>false</i></b>). </p>
<p>Another option is to use &quot;object&quot; level rules. These can be restrictet to run <i>ONLY </i>when your code calll &lt;BO&gt;.CheckObjectRules() (ie: <b>CanRunInCheckRules </b>= <b><i>false</i></b>). That would however run all the object rules but only when your code calls the method.</p>
<p>And it&#39;s also my recommendation to always run async rules with a higher priority than sync rules (to be executed after the sync rules).&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Wednesday, October 19, 2011</h2><p>Hi Jonny</p>
<p>Thanks a lot for your explanation, that makes the decision clear. And I also appriciate your recommendation and options! </p>
<p>I&#39;m just wondering if that&#39;s <b>not a common problem</b>: <br />If you set <span style="color:red;">UpdateSourceTrigger</span><span style="color:blue;">=</span><span style="color:black;">&quot;</span><span style="color:blue;">PropertyChanged</span><span style="color:black;">&quot;, a&nbsp; </span>PropertyChanged is raised with every keystroke, <br />and then if a rule needs to go to the server to validate that property, this takes far to long. </p>
<p>I must admit that I&#39;ve not used async rules yet. If my understanding of async rules is correct, they wouldn&#39;t block the UI (only the property becomes busy?), but entering 10 characters could send 10 requests to the server.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, October 19, 2011</h2><p>Oh, I see. </p>
<p>Ideally you would apply a sync rule for format check/length and only allow the expensive rule to run when input is valid or use UpdateSourceTrigger=&quot;LostFocus&quot;. (Ie: the async rule has a priority higher that BusinessRules.ProcessThroughPriority and will not run when a previous sync rule is broken).</p>
<p>You could however also create a &quot;dummy&quot; field and attach the expensive rule to that field. Then when some condition is met your code call PropertyChanged for that &quot;dummy&quot; property to trigger that rule. (You only need a PropertyInfo - don&#39;t have to implement the property with getter/setter).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Wednesday, October 19, 2011</h2><p>Oh yes, your first remark sounds good! Now, I remember Rocky mentioning this in an ebook, too.&nbsp; I&#39;ll try this soon. </p>
<p>[ With the &quot;LostFocus&quot; option we get stuck on a &quot;WPF problem&quot;: Clicking a Save button without leaving the field. <br />Also the dummy field (same as the object rule) has the disadventage of not having any property where the validation message can be assigned to. ]</p>
<p>Thanks a lot for your input!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 19, 2011</h2><p>Just one last comment.</p>
<p>Starting from CSLA 4.2 property rules can set validation messages to other properties than PrimaryProperty. <br />So the &quot;dummy&quot; property is a valid option for your case.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
