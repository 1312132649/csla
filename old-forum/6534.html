<html><header><title>GrandChild objects missing From GrandChild Collection returned to root object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>GrandChild objects missing From GrandChild Collection returned to root object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6534.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MikeH posted on Friday, February 27, 2009</h2><P>Hi :</P>
<P>I have a 3 level object hierarchy as follows :</P>
<P><STRONG>Object Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Property&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClassName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BaseType</STRONG><BR>Root Class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSLA BusinessBase<BR>ChildCollection&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItems&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItems&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSLA BusinessListBase<BR>Child&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSLA BusinessBase<BR>GrandChildCollection&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceSubLineItems&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItems&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSLA BusinessListBase<BR>GrandChild&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceSubLineItem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineItem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSLA BusinessBase</P>
<P>The root class data fetch pulls the full dataset fot the object graph, populating the hierarchy by making a function call of<BR>&nbsp;InvoiceLineItems=InvoiceLineItems.GetList(data).<BR>I can see using debug that InvoiceLineItems (when examined from within the child collection instance) correctly populates the data, and has a complete hierarchy to pass back to the root Invoice instance. </P>
<P><BR><FONT color=#000000><STRONG>However, the returned object in the Invoice instance is being stripped of the InvoiceSubLineItems (grandchild objects) in the returned InvoiceLineItems collection!</STRONG></FONT></P>
<P>Appreciate if anyone has any idea why this may be happening.&nbsp; I'm fairly new to CSLA and OOP programming generally so may be missing something basic.</P>
<P>Fyi, am using CSLA version 3.5 with VB.&nbsp; Have also noticed in debug that the collections exhibit the Count={System.TypeLoadException} exception.&nbsp; This occurs for collections whether they are populated ok or not so may not be relevant (have seen other references to this exception in other threads)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, March 02, 2009</h2>Is InvoiceLineItem subclassed at all, or is it the ultimate subtype?&nbsp; If you're subclassing it, I think I found that you need to implement ICustomTypeDescriptor in&nbsp; your subclasses.&nbsp; It's been a while, but if I'm remembering correctly, I had this problem and that was the solution.&nbsp; <br><br>My design was a bit different though, since I implemented a Composite pattern... so my base class LineItem inhertits BusinessBase, but also implements IEnurmable and some other list stuff.&nbsp; LineItem base has two direct subclasses; LineItemNode and LineItemLeaf.&nbsp; I only needed to implement ICustomTypeDescriptor in my base class though (or any subclasses which had additional members that the LineItemBase didn't define).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MikeH replied on Monday, March 02, 2009</h2><P>InvoiceLineItem is not subclassed.&nbsp; The child and grandchild are the same class i.e. InvoiceLineItem.&nbsp; The collections InvoiceLineItems and InvoiceSubLineItems are also not subclassed, both are the InvoiceLineItems class.</P>
<P>The way the code is working is as follows:-</P>
<P>InvoiceLineItem has a property of ParentLineItemID and collection property of SubLineItems.&nbsp; </P>
<P>1. The root class calls the GetInvoiceLineItems(data) function</P>
<P>2. InvoiceLineItems creates a collection of all InvoiceLineItems.</P>
<P>3, InvoiceLineItems iterates through the created collection, moving a line item into&nbsp;the relevant&nbsp;InvoiceLineItem.SubItems collections as appropriate depending on the InvoiceLineItem.ParentLineItemID value.</P>
<P>As mentioned, after processing, the InvoiceLineItems collection is as expected with the hierarchial structure when viewed from with the InvoiceLineItems collection at the point of returning itself to the root object.&nbsp; However, the returned collection when examined in the root class is missing all the grandchild items!</P>
<P>Fyi, I've worked around this for my immediate need by having the root class (Invoice) create the hierarchy from the returned InvoiceLineItems collection.&nbsp; This seems to be working ok.&nbsp; However, I'm at odds to understand why the grandchild items are being stripped away duriing the function return call.</P>
<P>Incidentally, I also tried creating the SubLineItem and SubLineItems as totally separate classes i.e. a ReadOnlyBase and ReadOnlyListBase respectively.&nbsp; However, I got the same result i.e. the ReadOnlyBase grandchild items were missing on the returned collection.</P>
<P>Appreciate you're input or any other explanations for this behaviour.</P>
<P>Fyi, thought about using the composite pattern, but decided against it in the immediate term as I've not had the experience of implemeting it and felt that the LineItems in current use case are essentially identical except for hirarchial structure.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
