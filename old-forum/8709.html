<html><header><title>Index was outside the bounds of the array</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Index was outside the bounds of the array</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8709.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb posted on Tuesday, March 23, 2010</h2><p>My code throws the below mentioned error when a method is called to update a child. The child_update method is never reached. The problem occurs in the Csla.Reflection.MethodCaller. When the following code is reached: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>result = methodHandle.DynamicMethod(obj, inParams); (line 357). The exception is thrown.</p>
<p>The child is created using CodeSmith template v2.0.</p>
<p>{&quot;Index was outside the bounds of the array.&quot;}<br />&nbsp;&nbsp;&nbsp; [System.IndexOutOfRangeException]: {&quot;Index was outside the bounds of the array.&quot;}<br />&nbsp;&nbsp;&nbsp; _className: null<br />&nbsp;&nbsp;&nbsp; _data: {System.Collections.ListDictionaryInternal}<br />&nbsp;&nbsp;&nbsp; _dynamicMethods: {object[1]}<br />&nbsp;&nbsp;&nbsp; _exceptionMethod: null<br />&nbsp;&nbsp;&nbsp; _exceptionMethodString: null<br />&nbsp;&nbsp;&nbsp; _helpURL: null<br />&nbsp;&nbsp;&nbsp; _HResult: -2146233080<br />&nbsp;&nbsp;&nbsp; _innerException: null<br />&nbsp;&nbsp;&nbsp; _message: &quot;Index was outside the bounds of the array.&quot;<br />&nbsp;&nbsp;&nbsp; _remoteStackIndex: 0<br />&nbsp;&nbsp;&nbsp; _remoteStackTraceString: null<br />&nbsp;&nbsp;&nbsp; _source: null<br />&nbsp;&nbsp;&nbsp; _stackTrace: {sbyte[48]}<br />&nbsp;&nbsp;&nbsp; _stackTraceString: null<br />&nbsp;&nbsp;&nbsp; _xcode: -532459699<br />&nbsp;&nbsp;&nbsp; _xptrs: 0<br />&nbsp;&nbsp;&nbsp; Data: {System.Collections.ListDictionaryInternal}<br />&nbsp;&nbsp;&nbsp; HelpLink: null<br />&nbsp;&nbsp;&nbsp; HResult: -2146233080<br />&nbsp;&nbsp;&nbsp; InnerException: null<br />&nbsp;&nbsp;&nbsp; IsTransient: false<br />&nbsp;&nbsp;&nbsp; Message: &quot;Index was outside the bounds of the array.&quot;<br />&nbsp;&nbsp;&nbsp; Source: &quot;Csla&quot;<br />&nbsp;&nbsp;&nbsp; StackTrace: &quot;&nbsp;&nbsp; at dm(Object , Object[] )\r\n&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\\Visual Studio Projects\\csla\\Source\\cslacs\\Csla\\Reflection\\MethodCaller.cs:line 357&quot;<br />&nbsp;&nbsp;&nbsp; TargetSite: {System.Object dm(System.Object, System.Object[])}</p>
<p>I use VS2008 SP1 and CSLA 3.8 framework with CodeSmith templates version 2.0</p>
<p>I hope this is some known problem or mistake on my side, otherwise I am severely stuck.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, March 23, 2010</h2><p>Just throwing a total guess out there - as I don&#39;t believe I&#39;ve ever used DynamicMethod,&nbsp;but your &quot;inParams&quot; - does this represent the parameters needed for the method? Do you have a sufficient number of parameters for your method call? (i.e. is it trying to look for a parameter and finding that the parameter array is a day late and a parameter short?)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb replied on Wednesday, March 24, 2010</h2><p>Dear Skagen,</p>
<p>Thanks for the effort, but to make things clear. The problem occurs outside the scope of my code. The DynamicMethod is an internal function of the CSLA framework to invoke late bound methods on business objects. I did look at the parameters of this method, but they seemed fine. It contains two objects, one being the child on which the portal update method should be invoked, the other being the connection to the database. At least, this is my understanding up till know.</p>
<p>I do not use any non public method of the CSLA framework. As a matter of fact all business objects have been generated by CodeSmith templates. I use the partial classes to supplement my own code.</p>
<p>But again, I might be missing something obvious, I worked with previous versions of CSLA up to 2.0, so 3.8 is quite new to me.</p>
<p>Regards -- Casper</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, March 24, 2010</h2><p>Can you please provide the stack trace from the exception? The exception itself isn&#39;t enough information to tell where the error occurred in the code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb replied on Wednesday, March 24, 2010</h2><p>Thank you for looking into this:</p>
<p>Index was outside the bounds of the array. <br />Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <br /><br />Exception Details: System.IndexOutOfRangeException: Index was outside the bounds of the array.<br /><br />Source Error: <br /><br /><br />Line 355:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />Line 356:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />Line 357:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = methodHandle.DynamicMethod(obj, inParams);<br />Line 358:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />Line 359:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<br />&nbsp;<br /><br />Source File: C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs&nbsp;&nbsp;&nbsp; Line: 357 <br /><br />Stack Trace: <br /><br /><br />[IndexOutOfRangeException: Index was outside the bounds of the array.]<br />&nbsp;&nbsp; dm(Object , Object[] ) +100<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:357<br /><br />[CallMethodException: Child_Insert method call failed]<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:361<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:270<br />&nbsp;&nbsp; Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:86<br />&nbsp;&nbsp; Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:201<br /><br />[DataPortalException: ChildDataPortal.Update failed on the server]<br />&nbsp;&nbsp; Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:258<br />&nbsp;&nbsp; Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:939<br />&nbsp;&nbsp; Csla.BusinessListBase`2.Child_Update(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\BusinessListBase.cs:966<br />&nbsp;&nbsp; dm(Object , Object[] ) +77<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:357<br /><br />[CallMethodException: Child_Update method call failed]<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:361<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:270<br />&nbsp;&nbsp; Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:86<br />&nbsp;&nbsp; Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:228<br /><br />[DataPortalException: ChildDataPortal.Update failed on the server]<br />&nbsp;&nbsp; Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:258<br />&nbsp;&nbsp; Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:939<br />&nbsp;&nbsp; Csla.Core.FieldManager.FieldDataManager.UpdateChildren(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Core\FieldManager\FieldDataManager.cs:544<br />&nbsp;&nbsp; GenForm.Library.Apotheek.DataPortal_Update() in D:\Data\VisualStudio\GenForm\GenForm.Library\Entities\Apotheek.DataAccess.cs:132<br />&nbsp;&nbsp; dm(Object , Object[] ) +60<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:357<br /><br />[CallMethodException: DataPortal_Update method call failed]<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:361<br />&nbsp;&nbsp; Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:270<br />&nbsp;&nbsp; Csla.Reflection.LateBoundObject.CallMethod(String method) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:70<br />&nbsp;&nbsp; Csla.Server.SimpleDataPortal.Update(Object obj, DataPortalContext context) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\SimpleDataPortal.cs:211<br /><br />[DataPortalException: DataPortal.Update failed (Csla.DataPortalException: ChildDataPortal.Update failed on the server ---&gt; Csla.Reflection.CallMethodException: Child_Update method call failed ---&gt; Csla.DataPortalException: ChildDataPortal.Update failed on the server ---&gt; Csla.Reflection.CallMethodException: Child_Insert method call failed ---&gt; System.IndexOutOfRangeException: Index was outside the bounds of the array.<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 201<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 201<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 258<br />&nbsp;&nbsp; at Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:line 939<br />&nbsp;&nbsp; at Csla.BusinessListBase`2.Child_Update(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\BusinessListBase.cs:line 966<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 201<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 258<br />&nbsp;&nbsp; at Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:line 939<br />&nbsp;&nbsp; at Csla.BusinessListBase`2.Child_Update(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\BusinessListBase.cs:line 966<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 228<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 201<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 258<br />&nbsp;&nbsp; at Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:line 939<br />&nbsp;&nbsp; at Csla.BusinessListBase`2.Child_Update(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\BusinessListBase.cs:line 966<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 361<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 270<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\LateBoundObject.cs:line 86<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 228<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Server\ChildDataPortal.cs:line 258<br />&nbsp;&nbsp; at Csla.DataPortal.UpdateChild(Object child, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\DataPortal.cs:line 939<br />&nbsp;&nbsp; at Csla.Core.FieldManager.FieldDataManager.UpdateChildren(Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Core\FieldManager\FieldDataManager.cs:line 544<br />&nbsp;&nbsp; at GenForm.Library.Apotheek.DataPortal_Update() in D:\Data\VisualStudio\GenForm\GenForm.Library\Entities\Apotheek.DataAccess.cs:line 132<br />&nbsp;&nbsp; at dm(Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\Source\cslacs\Csla\Reflection\MethodCaller.cs:line 357)]<br />&nbsp;&nbsp; GenForm.MVC2.Controllers.FormulariumController.Create(FormCollection formValues) in D:\Data\VisualStudio\GenForm\GenForm.MVC2\Controllers\FormulariumController.cs:63<br />&nbsp;&nbsp; lambda_method(ExecutionScope , ControllerBase , Object[] ) +140<br />&nbsp;&nbsp; System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters) +17<br />&nbsp;&nbsp; System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +178<br />&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +24<br />&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClassd.&lt;InvokeActionMethodWithFilters&gt;b__a() +52<br />&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +254<br />&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClassf.&lt;InvokeActionMethodWithFilters&gt;b__c() +19<br />&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +192<br />&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +314<br />&nbsp;&nbsp; System.Web.Mvc.Controller.ExecuteCore() +105<br />&nbsp;&nbsp; System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +39<br />&nbsp;&nbsp; System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext) +7<br />&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClass8.&lt;BeginProcessRequest&gt;b__4() +34<br />&nbsp;&nbsp; System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +21<br />&nbsp;&nbsp; System.Web.Mvc.Async.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _) +12<br />&nbsp;&nbsp; System.Web.Mvc.Async.WrappedAsyncResult`1.End() +59<br />&nbsp;&nbsp; System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult) +44<br />&nbsp;&nbsp; System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result) +7<br />&nbsp;&nbsp; System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +8677678<br />&nbsp;&nbsp; System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +155<br /><br />&nbsp;<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tbim92 replied on Friday, April 15, 2011</h2><p>Has this been resolved? I am getting the same error and a similar, very long stack trace with multiple levels of nested errors (inner exceptions). I am on VS2010 SP1 and CSLA 4.1.0.&nbsp;The stack trace is very long, but I can email it immediately if needed. The last of the nested errors is:</p>
<p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InnerException: Csla.Reflection.CallMethodException</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Message=Child_Insert method call failed</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Source=Csla</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StackTrace:</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at lambda_method(Closure , Object , Object[] )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Reflection\MethodCaller.cs:line 545</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Reflection\MethodCaller.cs:line 549</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Reflection\MethodCaller.cs:line 413</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Reflection\LateBoundObject.cs:line 93</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at Csla.Server.ChildDataPortal.Update(Object obj, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Server\ChildDataPortal.cs:line 214</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InnerException: System.IndexOutOfRangeException</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Message=Index was outside the bounds of the array.</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Source=Anonymously Hosted DynamicMethods Assembly</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StackTrace:</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at lambda_method(Closure , Object , Object[] )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Dev.VS\Frameworks\CSLA\CSLA\Reflection\MethodCaller.cs:line 545</p>
</p>
<p>Thank you.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, April 15, 2011</h2><p>The CSLA CallMethod method implements a late bound method calling convention that supports overloaded methods. There is at least one known issue with passing a parameter that is an array that I have been unable to resolve - literally because at runtime it is impossible to differentiate that value from other value types - the information just doesn&#39;t exist.</p>
<p>I don&#39;t know what you are passing into the data portal&#39;s UpdateChild method as a parameter, but it is possible you are hitting this unresolvable edge condition.</p>
<p>Which is a long winded way of asking you: what are you passing as a parameter to UpdateChild?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tbim92 replied on Friday, April 15, 2011</h2><p>
<p>Sorry for the delay in the reply. I wanted to test something with it before submitting the update - nothing to note on the test though.</p>
<p>&nbsp;</p>
<p>I my case i have an Editable Root List (LocationList) with Editable child objects (Location). I added a child object and ran the &quot;LocationList = LocationList.Save();&quot; command.</p>
<p>My LocationList code is:</p>
<p>&nbsp; &nbsp; [Csla.Transactional(Csla.TransactionalTypes.TransactionScope)]</p>
<p>&nbsp; &nbsp; protected override void DataPortal_Update() { base.Child_Update(); }</p>
<p>My Location code, which execution never reaches, is:</p>
<p>&nbsp; &nbsp;private void Child_Update(object parent) { DoUpdate(); }</p>
<p>The line of code that has the error is in &quot;MethodCaller.CallMethod(object obj, System.Reflection.MethodInfo info, params object[] parameters)&quot; on the last try/catch at &quot;result = methodHandle.DynamicMethod(obj, inParams);&quot;. The obj object is my Location business object and looks like a typical object; it is valid, dirty, new and a child (I checked all these values). The inParams is an emtpy object array - its length is 0. The error occurs executing this line. I can&#39;t step into this method call. I put a breakpoint in the DynamicMethodHandle method but it never gets there before the error.</p>
<p>Is there anything else I can provide? I&#39;ll email the entire call stack, send you screenshots, let you screen share and walk through the code yourself - anything! I&#39;m completely stumped.</p>
<p>I have another object tree that is Parent - child list - child objects - child list - child object. Saving a new item works fine in that object tree (with a single grandchild and great-grandchild added). The two child objects there appear to be exact duplicates to the one that is getting the error - with the exception of the properties of course.</p>
</p>
<p>Thank you.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, April 15, 2011</h2><p>The core issue here is that your Child_Update call is provided with 0 parameters, and your Child_Update expects&nbsp;1 parameters.</p>
<p>base.Child_Update just finds all child references and calls DataPortal.UpdateChild on each one, passing the (non-existant) parameters you provide.</p>
<p>The MethodCaller implementation in CSLA is then looking for a Child_Update, Child_Insert, or Child_DeleteSelf method that accepts 0 parameters.</p>
<p>The exception could probably be better here, but ultimately the issue is that you don&#39;t have such a method (with&nbsp;0 parameters), so it fails.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tbim92 replied on Friday, April 15, 2011</h2><p>Thank you! I&#39;m not sure I would have thought of that. I wonder why my other two objects worked. They were the same way.</p>
<p>In case anyone else reads this post, to solve the problem, in my List object&#39;s DataPortal_Update() method I had one line of code: &quot;base.Child_Update();&quot;. I changed it to &quot;base.Child_Update(this);&quot; which matches my child object&#39;s &quot;Child_Insert(object parent)&quot; and &quot;Child_Update(object parent)&quot; methods and that solved the problem.</p>
<p>I appreciate your time.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergioadh replied on Saturday, May 14, 2011</h2><p>I could use exactly what you do inside those methods, I&#39;m experiencing a problem of the like now.</p>
<p>&nbsp;</p>
<p>Thanks</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Thursday, November 10, 2011</h2><p>Hi Rocky, I just ran into this as well with csla 4.1 and I wasted a *lot* of time on it, thank you for posting the suggestion, it pointed directly to the problem which was my own.</p>
<p>I agree with you wholeheartedly that the exception message could be better there. &nbsp;I urge you to consider making a change to that message to avoid anyone else wasting a lot of time chasing wild geese in future.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
