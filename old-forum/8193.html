<html><header><title>Child Delete asking parent list to remove the child</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child Delete asking parent list to remove the child</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8193.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>am_fusion posted on Tuesday, December 22, 2009</h2><P>So one of the developers on my team asked me to override CSLA child delete behavior.&nbsp; His suggestion was:</P>
<UL>
<LI>when delete is executed the BusinessBase instance should</LI>
<UL>
<LI>if this.IsChild is true</LI>
<UL>
<LI>if this.parent is business list base</LI>
<UL>
<LI>execute parent.Remove(this)</LI></UL>
<LI>else</LI>
<UL>
<LI>throw can not delete child</LI></UL></UL>
<LI>else</LI>
<UL>
<LI>throw can not delete child</LI></UL></UL></UL>
<P>Can anyone think of a reason to not do this?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 22, 2009</h2><P>Why wouldn't root objects be able to be deleted?&nbsp; That's a perfectly valid thing to do.</P>
<P>Also, a child doesn't necessarly have to belong to a list to be a child; it may represent optional information which can be deleted.</P>
<P>My question is why would you WANT to restrict deletes to only children in a list?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>am_fusion replied on Tuesday, December 22, 2009</h2><P>The thought here is that if the child belongs to a list, we want the delete operation (of off the child) to remove itself from the parent list.</P>
<P>nothing special needs to happen if the BO is a root object (root objects can and should just delete themselves... I haven't given much thought to the EditableRootList scenerio...hmmm)</P>
<P>nothing special needs to happen if the BO is not a member of a list (BOs that are Children of another BusinessBase can and should be dealt with through normal processing... I think).</P>
<P>regarding your last question...my mistake, the last else should be</P>
<P>base.Delete();</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 22, 2009</h2><P>Ok, that makes a bit more sense then, but I'm still not sure what you're trying to do.</P>
<P>If you want to remove an object from the parent list, why wouldn't you just call Remove on the parent list?&nbsp; Databinding expects you to call Remove, so going your route I think would confuse databinding.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, December 22, 2009</h2><P><FONT face=Tahoma size=2>I'm with Andy... BB objects that are children of a BusinessListBase can't be deleted "on their own".&nbsp; Explicitly calling the "Delete" method on a child object already throws an exception.&nbsp; So in what case would the delete functionality be executed on a child BB object that didn't originate from its parent list?&nbsp; And what would you gain by allowing this to happen?</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>am_fusion replied on Tuesday, December 22, 2009</h2><P>I would have to dig back into the use case again (it has been on my plate for a while and I am just now getting back to it).&nbsp; From what I can remember, the ViewModel did not have access to the parent list... but I could be wrong.&nbsp; I will post back to this thread when I get a chance to refresh my understanding of the use case again.</P>
<P>As far as messing up databinding, I don't think this will be a problem (at least in silverlight... and probably in winforms as well).&nbsp; If I understand correctly, the fact that the remove is being called from the child should be irrelivant to databinding.&nbsp; Whether remove is executed from the UI layer (databinding, codebhind, viewmodel, etc.) or from the business layer the remove&nbsp;*should* behave the same.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 22, 2009</h2><P>Well, I'm not sure about Wpf, but it certainly would screw up WinForms databinding.&nbsp; The problem would be that you've basically yanked away the databound object without the UI knowing about it... so it thinks its still there.&nbsp; From there, bad things happen..</P>
<P>To my knowledge though, a grid in Wpf should behave like a WinForms one; it should ask the collection to remove the specified item.&nbsp; At least, that's how the grids behave when I've been working in wpf.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, December 23, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>am_fusion:</strong></div><div><br />if this.IsChild is true</LI><br />-- if this.parent is business list base</LI><br />----  execute parent.Remove(this)</LI></UL><br /></div></BLOCKQUOTE><br /><br />OK, I think I am having a flash back here. Although my question is completely irrelevant to this post, my curiosity is getting the best of me, so my question is, did we not have something like this at one point or another in the CSLA life?<br /><br />I am wondering if it was back when the CSLA was coded using the old VB, did we not have a Delete method in the BB that called the parent (list) and ask it to delete it from the collection?<br /><br />Again, itâ€™s a pointless question, just a trivia question to satisfy my curiosity.<br /><br />Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 23, 2009</h2><P>Yes, in Windows Forms 1.x data binding, when a row was removed from a datagrid binding would tell the child to remove itself from the collection. So CSLA had (and has) code to allow the child to talk to the collection and ask the parent collection to remove the child. Of course that just moved the child to the deletedList.</P>
<P>In Windows Forms 2.0+ data binding is a lot better, and directly talks to the collection to remove the child.</P>
<P>In CSLA 4.0 I'll probably remove the ugly code for 1.x support - I surely hope people using .NET 4.0 aren't still using old 1.x style data binding :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>am_fusion replied on Wednesday, December 23, 2009</h2><P>So CSLA currently has code that allows the child to talk to the collection and ask the parent collection to remove the child?&nbsp; I haven't found any code like this.&nbsp; I don't supose you remember where this code is off the top of your head?</P>
<P>When I think about the behavior we are describing here, it seems to me that we should be ok since databinding is responding to NotifyCollectionChanged\ListChanged event neh?&nbsp; In other words, when a child is removed from the list via code, the UI element updates its state by listening to the NotifyCollectionChanged\ListChanged.&nbsp; It shouldn't care who executed the remove.&nbsp; Is there something I am not understanding correctly?</P>
<P>I hope to sepend some time with the developer who original requested this change to better understand why they can't use the collection directly to do the remove.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 23, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>am_fusion:</strong></div><div>When I think about the behavior we are describing here, it seems to me that we should be ok since databinding is responding to NotifyCollectionChanged\ListChanged event neh?&nbsp; In other words, when a child is removed from the list via code, the UI element updates its state by listening to the NotifyCollectionChanged\ListChanged.&nbsp; It shouldn't care who executed the remove.&nbsp; Is there something I am not understanding correctly?</div></BLOCKQUOTE></P>
<P>Again, I'm not sure about Wpf, but in WinForms this certainly isn't the case.&nbsp; You get into all sorts of problems unless you ask the BindingSource component to remove the item (via its Remove method).&nbsp; Going directly to the BusinessListBase collection and calling remove screwed up the databinding.&nbsp; Even then I'm not sure it always worked right, and I tend to favor asking the grid to remove the row (which then triggers the proper databinding stuff).&nbsp; </P>
<P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>am_fusion:</strong></div><div>I hope to sepend some time with the developer who original requested this change to better understand why they can't use the collection directly to do the remove.</div></BLOCKQUOTE></P>
<P>I'd be curious to know too..&nbsp; I would think the grid and databinding should be handling it.. even if you're just asking a grid to remove programatically.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 23, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>am_fusion:</strong></div><div>
<P>So CSLA currently has code that allows the child to talk to the collection and ask the parent collection to remove the child?&nbsp; I haven't found any code like this.&nbsp; I don't supose you remember where this code is off the top of your head?</div></BLOCKQUOTE></P>
<P>It is buried deeply in the n-level undo implementation, and is tied into the IEditableObject interface implementation as well.</P>
<P>There' only one way to trigger this behavior, and it is by emulating (or using) Windows Forms 1.x datagrid binding behavior.</P>
<P>And honestly it was a terrible thing to do. It complicated the heck out of the IEO implementation and was the source of many headaches. .NET is generally designed under the assumption that the collection will be told to remove an object, not a child object, and 1.x data binding went against that model - thus causing pain.</P>
<P>This is why 2.0 data binding fixed the issue - because everyone involved realized how bad an idea the 1.x design really was.</P>
<P>My recommendation is to not emulate that mistake :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmnc replied on Monday, January 04, 2010</h2><P>I've overriden the delete method in a child business object to remove itself from the collection as follows:</P>
<P>public override void Delete()<BR>{<BR>&nbsp;&nbsp; CanExecuteMethod("Delete", true);<BR>&nbsp;&nbsp; this.Parent.RemoveChild(this);<BR>}</P>
<P>I mainly use the child delete method when working with tree structures wrapped in ViewModel objects. </P>
<P>Will the RemoveChild() method be abandoned in CSLA 4.0?<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 04, 2010</h2><P>I don't know that I'll get rid of RemoveChild() necessarily. The part I want to get rid of in 4.0 is the code in the IEditableObject implementation that tracks whether the child is new so it knows to call RemoveChild() when CancelEdit() is called on a new/unchanged child object.</P>
<P>And honestly, even that is just cleanup, and so falls pretty low on the priority list.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
