<html><header><title>N00B.  Not Fully Grasping Root, Child, and Parent: Specific Example</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>N00B.  Not Fully Grasping Root, Child, and Parent: Specific Example</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5369.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>eulerthegrape posted on Tuesday, September 09, 2008</h2>Hi,<br><br>I have read Expert C#2005 and an enormous amount of these forum pages and have hit a wall in understanding the relationship between child and parent and child objects and root stereotypes.&nbsp; I'm working on the design of one section of an application and can't get the relationships straight.<br><br>The use cases are:<br>- The user wishes to maintain a list of companies <br>- These companies can be edited<br>- Each company has a single address (but this may change).&nbsp; <br>- A company can be selected from a list elsewhere in the application<br><br>I have the following business objects:<br>Address<br>Company - Editable Child Object<br>Companies - Editable Root List<br>CompanyList - Name / Value Pair?<br><br>The relationship between Companies and Company is analogous to the Roles -&gt; Roles relationship in PTracker, right?<br><br>Currently, the companies' addresses are found in a Company Table in my database.&nbsp; The simplest solution seems to be to eliminate the address class altogether but Rocky (in another thread) suggested Address being a direct child object of Company (Address may have existed in another Table, I cannot remember).&nbsp; Does this mean Address is a grandchild of Companies?&nbsp; Does this complicate data access?<br><br>I understand many will say eliminate the address class for expediency but if a case arises where I need to create a direct child object I will be in the same situation so I really want to work through my understanding and solve this without getting rid of the Address object.<br><br>Along the same lines, if I have name / value pairs for states and countries in Address, do these becomes great granchildren?<br><br>I am confused at this point and may be making things worse by over thinking...<br><br>Somewhat off topic, I wanted Address to format data for presentation, i.e. Company Name (Carriage Return), Address1 (CR), Address2 (CR), etc.&nbsp; Is this different behavior and thus a different class and possibly not business related and belonging in the UI?&nbsp; Should I create a AddressFormatter object in my forms folder that takes a company object validates and formats.&nbsp; That kind of sounds the most reasonable.<br><br>Thank you so much in advance from a humbled electrical engineer temporarily turned programmer,<br><br>Euler<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, September 09, 2008</h2><P>Euler - shouldn't you be doing Mathematics, not programming? &lt;g&gt;</P>
<P>Let's see if this helps at all.</P>
<P>A Root is a BO that inherits from your BusinessBase class (which inherits from Rocky's CSLA BusinessBase class.) There is no call in the constructor for MarkAsChild.</P>
<P>The Root BO can *contain* other BOs.</P>
<P>If a Root contains a BO then the contained BO can be considered a Child. The Root is responsible for fetching the data for itself and the contained child. It pass the data reader to the child after it is done fetching its own data. So the child BO has MarkAsChild in its constructor. This means the child can't perform direct data access - it always relies on its Parent to do it for it. </P>
<P>So the prime example of this structure is an Order. The Order BO contains a collection of OrderLines which contains a bunch of OrderLine objects.</P>
<P>The Order is the root BO. The OrderLines is and Editable Child Collection (ECC) and is a child of the Order BO. Each OrderLine in the collection is also a child. But their Parent is the ECC, not the Order. This has been a point of confusion for many people for a long time. Many times they want their OrderLine to have access to some data in the root Order BO and they want to use Parent to get to it, but the Parent is the ECC. I think Rocky finally gave up and supports using Pranet all the way up the chain until you get to the Root. So you should be able to get to it now if you really want to. It is not normally a good idea for a child to know about its Parent. The Parent should know about its children though.</P>
<P>The Root BO can contain other BOs which are not Marked as Children. I use a pattern called the Use Case Controller which is a Root BO that contains all the other BOs required to support a given use case (which could translate to a given screen in your app). So if your screen needs to present a lot of data, the Root BO or UCC object is responsible for creating itself and then fetching all the other BOs and exposing them to the UI as ReadOnly Properties. This means the UI can set values in these BOs but now create a whole ne BO and replace the one your UCC fetched.</P>
<P>The UCC is now responsible for saving all the data in the right order too. It can pass around a manual transaction object in the Context so you can save BO1 and then BO2 and do a rollback if needed.</P>
<P>The UCC can also fetch some NVLs which are used on the screen to let the user select from cbos.</P>
<P>I tend to have smaller BOs which are like Entities (look a lot like the DB table) and then I compose them inside a UCC so they work together nicely. The UCC can also have its own rules that cross over more than one contained BO. It can see down the graph as far as needed too so it can evaluate collections if it has to. (The collection or its immediate parent&nbsp;should evaluate itself though in most cases.)</P>
<P>HTH</P>
<P>Joe</P>
<P>PS - for the off topic question - </P>
<P>The Address class contains a lot of data and has many Properties. Just add 1 more Property like ToString or MyAddressInANiceFormat or ... and use the internal data to compose a single big string like you describe.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eulerthegrape replied on Tuesday, September 09, 2008</h2>Thank you Joe for your quick response.<br><br>Mathematics by day coding by night kind of situation.&nbsp; Why do I always find myself working for companies that require a multi-hat disposition? Ah, to be at a large company with a clearly stated role.&nbsp; It's my fault, we don't have any programmers on staff and I said, 'I took data structures in college!'&nbsp; This piece of the program is part of a larger, I'll say, instrumentation control program, which is pertinent to what is, theoretically, my job function :-)<br><br>The grand children concept is not pertinent to my issue, right?<br><br>So Company is the Root BO and Companies would be an editable child collection of Company that holds something like CompanyItems?&nbsp; That kind of rocks my world.&nbsp; I thought Rocky said the opposite in his Role, Roles, RoleList paradigm.<br><br>Now when we say the root is responsible for fetching all the data we are talking in relation to the user, right?&nbsp; The user cannot interact with a child object to access data but the child's parent can request returned data from the child, which in turn needs to access the database?<br><br>So in case of the form holding companies loading data:<br>----------------<br>In Form<br>_companies = Companies.GetCompanies();<br>----------------<br>In Companies<br>public static Companies GetCompanies()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;Companies&gt;();<br>}<br><br>private void DataPortal_Fetch()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = false;<br>&nbsp;&nbsp;&nbsp;&nbsp; using (SqlConnection cn = new SqlConnection(Database.CasasConnection))<br>&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (SqlCommand cm = cn.CreateCommand())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "getCompanies";<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (dr.Read())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Add(Company.GetCompany(dr));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br>----------------<br>In Company<br>private Address _address;<br><br>// Should I expose Address Properties with explicit properties in Company?<br>// private _addres1<br>// public string Address1<br>// { get { return _address.address1;}}<br><br>internal static&nbsp; Company GetCompany(Csla.Data.SafeDataReader dr)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; return new Company(dr);<br>}<br><br>private Company(Csla.Data.SafeDataReader dr)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; MarkAsChild();<br>&nbsp;&nbsp;&nbsp;&nbsp; Fetch(dr);<br>}<br><br>private void Fetch(Csla.Data.SafeDataReader dr)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; _id = dr.GetInt16("id");<br>&nbsp;&nbsp;&nbsp;&nbsp; _name = dr.GetString("name");<br>
&nbsp;&nbsp;&nbsp;&nbsp; _address = Address.GetAddress(dr);<br>
&nbsp;&nbsp;&nbsp;&nbsp; dr.GetBytes("lastChanged", 0, _timestamp, 0, 8);<br>&nbsp;&nbsp;&nbsp;&nbsp; MarkOld();<br>}<br>-----------------<br>In Address<br>
<br>
internal static&nbsp; Address GetAddress(Csla.Data.SafeDataReader dr)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp; return new Address(dr);<br>
}<br>
<br>
private Address(Csla.Data.SafeDataReader dr)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp; MarkAsChild();<br>
&nbsp;&nbsp;&nbsp;&nbsp; Fetch(dr);<br>
}<br>
<br>
private void Fetch(Csla.Data.SafeDataReader dr)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp; _address1 = dr.GetString("address1");<br>&nbsp;&nbsp;&nbsp;&nbsp; _address2 = dr.GetString("address2");<br>&nbsp;&nbsp;&nbsp;&nbsp; _state = dr.GetString("state");<br>&nbsp;&nbsp;&nbsp;&nbsp; _country = dr.GetString("country");<br>
&nbsp;&nbsp;&nbsp;&nbsp; _zipCode = dr.GetString("zipCode");<br>
&nbsp;&nbsp;&nbsp;&nbsp; MarkOld();<br>
}<br>---------------<br><br>Will this work?&nbsp; Do I need a separate procedure to recall the address?&nbsp; If I do then I would need to know who the parent is.<br><br>Thanks again,<br>Euler<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, September 09, 2008</h2><P>You did not explain the screen so it is not possible to evalute the code. </P>
<P>In the first post you said you want to use this: Companies - Editable Root List</P>
<P>I have never used one of those in almost 5 years. There is only 1 screen where it makes sense to use that and that is a Windows Grid. An ERL is a special kind of list which takes Root BOs and stores them in the list (so no MarkAsChild in the constructor). Then as you edit each row of the grid and move off it the root BO is saved immediately. <BR></P>
<P>You also wrote:</P>
<P>The use cases are:<BR>- The user wishes to maintain a list of companies <BR>- These companies can be edited<BR>- Each company has a single address (but this may change).&nbsp; <BR>- A company can be selected from a list elsewhere in the application</P>
<P>The UI I would create for this is:</P>
<P>1. A Search screen with various criteria that the user can fill in. (Company Starts With {xyz}, State Starts With {NY}, etc.)</P>
<P>2. Once they enter their criteria, I do a database search and return a Result screen with a ReadOnly grid on it. So this is a ROC with contain Info items. The grid displays key info, like Company Name, State, etc. The last column of the grid is an Action column. There is a column of buttons there to Select the company to Edit. </P>
<P>3. When they click a button, the CompanyID is stored and the user is directed to the Edit screen which uses the CompanyID to fetch the Root Comapny BO for editing. This screen could have a grid for multiple addresses as a child portion of the window. (Master Detail relationship.)</P>
<P>HTH</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P><BR>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eulerthegrape replied on Tuesday, September 09, 2008</h2>Hey Joe,<br><br>Ok, I think I understand the confusion as the use case "These companies can be edited" is somewhat vague and lends itself to different UI conventions.<br><br>Being new to CSLA, I'm basing a lot of my work on PTracker where Rocky often uses datagridviews.&nbsp; Since the company edit functionality is administrative, I thought this control would make sense but I do see the value of an editable list with a per item edit form.&nbsp; I think this is where I got confused by your root object being the Company while I was thinking of Companies as the Root.<br><br>I must have accidentally implied that I wanted to work with an Editable Root List because my understanding from reading Rocky's response to people was that this is an undesirable stereotype.&nbsp; With your UI construction I see there only being one child which makes things simpler in my head but what happens if we do have an editable datagridview?&nbsp; Is this much more complicated?<br><br>Since one of the goals behind CSLA is to make to business objects UI agnostic would it be prudent to have a way to edit both Companies and Company?&nbsp; But then, unadvisably, Company is sometimes a root and sometimes a child.<br><br>Thanks,<br>Euler<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, September 10, 2008</h2><P>One of the key ideas is that you build BOs for each use case - without regard to re-using them in different cases! Many people shudder over that idea but once you wrap you head around it you find that things are simpler to maintain. A given BO has only 1 function. I admit I do not always follow that rule and there is some twisted code inside some of my BOs to support extra cases - but I regret some of that and would change things to keep it simpler if I could go back.</P>
<P>I don't run PT and am not familiar with the examples. I don't do Winforms either. As I said, I never built a ERL and have no plans to.</P>
<P>But your last statement is not true:&nbsp; "But then, unadvisably, Company is sometimes a root and sometimes a child."</P>
<P>Recall that an ERL list is Root List which contains Root objects! So in that example Company is never a child. It is always a root. Sometimes used on its own and sometimes used as part of a grid where it saves itself when you move off the row.</P>
<P>BTW - a BO can be a root and a child. That is called a Switchable object. It just combines both sets of templates and calls MarkAsChild when appropriate. It has been said that if you want to use a Switchable object then something is probably wrong with your object model.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eulerthegrape replied on Wednesday, September 10, 2008</h2>Thank you Joe, you have been extremely helpful in making CSLA much clearer.<br><br>I guess this is a more than one way flay a bear scenario.<br><br>It seems like I have two clear design choices.&nbsp; The first solution is to create an ERL that contains Company root objects.&nbsp; I would then bind this collection to a datagridview control and perform edits directly in the datagridview.&nbsp; The other solution is to create a datagridview or listview control and bind to a read only list or name / value pair.&nbsp; Then have a separate editing form to edit the company.<br><br>In the second solution I would have to create a read only list but I'm going to have to do this anway for another use-case, as I originally explained.&nbsp; One solution does seem much more web-centric.<br><br>I was under the really dumb assumption that ERLs was a huge no-no but re-reading Rocky's book I see now that his Roles class is, in fact, an ERL and their are lots of posts regarding them in this forum.&nbsp; But also in re-reading the forum, it does seem that many around these part discourage the use of ERLs or have disdain for them.<br><br>I guess I'll pose the question to the gallery:<br>What is your preferred design solution?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, September 11, 2008</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>eulerthegrape:</strong></div><div>I was under the really dumb assumption that ERLs was a huge no-no but re-reading Rocky's book I see now that his Roles class is, in fact, an ERL and their are lots of posts regarding them in this forum.&nbsp; But also in re-reading the forum, it does seem that many around these part discourage the use of ERLs or have disdain for them.</div></BLOCKQUOTE><br><br>Um, that's probably the wrong attitude to show toward the ERLB.&nbsp; The words around may be strong, but it's perfectly valid to use.&nbsp; But, it's designed to be used in a very limited scenerio:&nbsp; by a Windows Forms (or WPF, I would assume) application, where changes to each row are to be committed independately to the database as the user leaves the row.&nbsp; So even though each row is in the same grid, they really exist in their own independant universe.&nbsp; <br><br>So if that's what your use case calls for, then by all means use an ERLB.&nbsp; But if you're doing something else, it probably doesn't fit.&nbsp; This is the trap that most fall into; they assume ERLB should be used for most lists, and BLB is some kind of exception, when the relaity is the opposite.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>eulerthegrape:</strong></div><div>I guess I'll pose the question to the gallery:<br>What is your preferred design solution?</div></BLOCKQUOTE><br><br>It sounds like no matter what you'll want a readonly list of companies.&nbsp; For display, to select a company maybe, etc.&nbsp; So there are two classes (ROLB and ROB subclasses).<br><br>Now, you're going to need a way to edit a company.&nbsp; No matter what you'll be editing one company at a time (that is, you're going to be changed within a single transaction only one at a time).&nbsp; So you'll definately need a Company which is a BB subclass.<br><br>So the only question is this:&nbsp; do your uses expect to see the entire list, and be able to change multiple companies at once?&nbsp; If yes, should the changes be batched or not?<br><br>If the changes should be batched, your Company class should be a child and containined within a BLB subclass.&nbsp; You'll Save the list of companies all at once.&nbsp; All changes go, or none do.&nbsp; <br><br>If your users want to "save" each company as they click off the row, then your Company class should be a root and contained in an ERLB.<br><br>Finally, if editing a company is too complicated to be done in a single row of some kind of grid control, you'll probably want a seperate form.&nbsp; In this case, there's no need for a BLB or ERLB class.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb replied on Tuesday, September 16, 2008</h2><P>Wouldn't the following scenario lend itself to an ERL?&nbsp; Just want to make sure I understand it correctly:</P>
<P>A list of invoices that you would like to "approve" or some other function, it's just an example.&nbsp; </P>
<P>It would be a list of root objects (invoices) that you need to do something with.&nbsp; Wouldn't that be an ERL?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 16, 2008</h2>Only if each approval should be recorded immediately as the data is committed in the Winforms grid you're using.&nbsp; So the user selects approve, clicks to the next row on the grid and the approval is recorded at that point.<br><br>If the list of approvals must go as a batch, or if it needs to wait for a Save button click, for example, the no, ERLB would not be appropriate.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
