<html><header><title>Add a child object without using AddNewCore</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Add a child object without using AddNewCore</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4056.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SethSpearman posted on Monday, December 17, 2007</h2><P>In Rocky's book he says this on page 367 (VB Version):</P>
<P>"Child objects are usually created when the UI code calls an Add() method on the collection object that contains the child object.&nbsp; Ideally, the child class and the collection class will be in the same assembly, so the Shared factory methods on a child object can be scoped as Friend, rather than Public.&nbsp; Ths way, the UI can't directly create the object, but the collection object can create the child when the UI calls the collection's Add() method"</P>
<P>Rocky also wrote in the note in the same page:&nbsp; "Child object can optionally be created through data binding, in which case the addition is handled by overriding the AddNewCore() method in the collection class"</P>
<P>The background is that I have succeeded in writing my Collection classes by overriding the AddNewCore but have NOT successfully determined (and therefore written) how to add children to a collection if you DON'T override AddNewCore.&nbsp; Rocky has an Assign method that seems similar to the Add method described above but I cannot find any example that is coded using an Add method.</P>
<P>Help will be greatly appreciated here.&nbsp; Here is what my code looks like.&nbsp; This code is from the Unit Test for this object.&nbsp; </P>
<P>This code works UNTIL I add a Required field validation rule to the child object:</P><FONT color=#0000ff size=2>
<P>Dim</FONT><FONT size=2> objChild </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> childBizObject<BR>objChild=obj.AddNew&nbsp; 'obj is the parent object</FONT></P>
<P>The book basically SAYS that this code will fail if you have a required field. </P>
<P><FONT size=2><FONT size=3>What would the code look like if you were <STRONG>NOT</STRONG> using AddNew?</FONT></FONT></P>
<P><FONT size=2><FONT size=3>I have tried this:</FONT></FONT></P>
<P><FONT size=2>Dim objChild as childBizObject<BR>obj.Add(objChild)</FONT></P>
<P><FONT size=2><FONT size=3>This causes a compiler warning and a runtime error (that matches the warning) - A Null reference error.&nbsp; </FONT></FONT></P>
<P><FONT size=2><FONT size=3>So I thought I could change the first line to this:</FONT></FONT></P>
<P><FONT size=2><FONT size=3></FONT>Dim objChild as childBizObject = childBizObject.NewChildBizObject</FONT></P>
<P><FONT size=2>But this doesn't work becasue the factory method on the childObject is scoped as friend and of course my unit tests are in a different project as will be my UI.</FONT></P>
<P><FONT size=2>Any suggestions</FONT></P>
<P><FONT size=2>Seth B Spearman<BR></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 18, 2007</h2>Well, if you ever want your list to work with data binding, you MUST override AddNewCore.&nbsp; You won't be left with a choice.<br><br>If that's not the case though, you'll have to make your child's factory method public; otherwise how would the UI create an instance to add either?  <br><br>On a related now, if you just want your test assembly to see the internals (friend) of your BO assembly, use the InternalsVisibleTo attribute on the BO assembly.&nbsp; See documentation for more information.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, December 18, 2007</h2><P>I use code like this to add children to a collection:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> AddChild(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> key </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Long</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> testForExistence </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> MyBO<BR></FONT><FONT color=#0000ff size=2>&nbsp; Dim</FONT><FONT size=2> obj </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> MyBO= MyBO.NewMyBO(key)<BR></FONT><FONT color=#0000ff size=2>&nbsp; Return</FONT><FONT size=2> DoAdd(obj, testForExistence)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT></P>
<P><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Add(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> key </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Long</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> testForExistence </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>)<BR>&nbsp;<FONT color=#0000ff> Dim</FONT><FONT size=2> obj </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> MyBO= MyBO.NewMyBO(key)<BR></FONT></FONT><FONT size=2>&nbsp; DoAdd(obj, testForExistence)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>In my Base class, which is derived from CSLA and which all my collections derive from, I have:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> DoAdd(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> obj </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> C, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> testForExistence </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> C</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> testForExistence = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> Contains(obj) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Add(obj)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> obj<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing<BR></FONT><FONT color=#0000ff size=2>Else<BR>&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Add(obj)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> obj<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>So, the collection creates the child object using the AddChild method and then returns it to the caller so other properites can be set if needed. Or it also creates the child using the Add method and then does not bother returning the object to the caller. Your choice.</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
