<html><header><title>Smart value classes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Smart value classes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1006.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Thursday, August 24, 2006</h2>Hi,<br><br>I'm building some Smart classes, much like the SmartDate class.&nbsp; One thing I'd like to do is add implicit conversions.&nbsp; Decimal to SmartDecimal is pretty straight foreword.&nbsp; However, I'd like some opinions on how to go the other way.&nbsp; <br><br>My choice is to either not provide an implicit SmartDecimal to decimal.&nbsp; The other is to return Value, even if the SmartDecimal is currently 'empty.'<br><br>Anyone have thoughts on this?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2><P>We are in the process of implementing the same type of thing.&nbsp; In all of our ValueTypes we explicitly implement System.IConvertible to handle indirect conversion rather than try to incorporate all the different variations implicitly.&nbsp; As you said, Decimal to SmartDecimal is straight-forward and expected behavior, but Decimal to Single, etc. we leave to the IConvertible interface (which allows us to simply delegate to the internal Decimal, in this case, which already exposes IConvertible).</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 24, 2006</h2>Pirate,<br><br>Yes, I've implemented IConvertable as well.&nbsp; I had no plans to do implict conversions for anything but going between SmartDecimal and decimal.<br><br>So it sounds as if leaving out an implicit SmartDecimal to decimal is your recommendation.<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2><P>Sorry, had to go back and look at what we've done...</P>
<P>Yea, I've always left it so that the decimal value had to be "promoted" to the new type (SmartDecimal) and not the other way around.&nbsp; But, we do expose a Value property that returns the base type (decimal).</P>
<P>The only exception to this is when overloading operators.&nbsp; In that case we implement both - actually all 3:</P>
<P><CODE>public static SmartDecimal operator+(SmartDecimal a, SmartDecimal b)<BR>public static SmartDecimal operator+(SmartDecimal a, Decimal b)<BR>public static SmartDecimal operator+(Decimal a, SmartDecimal b)</CODE></P>
<P>When implementing, the last two create a new SmartDecimal from the Decimal and delegate to the first for the actual work.</P>
<P>And, I believe that it was because of the operator overloads that we do not implement implicit conversion in both directions.&nbsp; If we did, if memory serves me correctly, depending on the order of the arguments, adding a SmartDecimal to a Decimal would cause it to convert the SmartDecimal to a Decimal and then do straight Decimal addition.&nbsp; That may not seem like a big deal in this case, but we have other value types, such as Rational, that we want to control the operator methods so it is important the the 'primitive' types be converted 'up' to our type.&nbsp; I could be remembering wrong, though, it's been a while since this was done.</P>
<P><FONT size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, August 24, 2006</h2>Allow me to chime in with a question: What do you do when you have an empty value and try to compare against that?<br>That is an important factor because it affects rules and sorting. Are you implementing something like rocky did with smartdate and EmptyIsMin ?<br><br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 24, 2006</h2>I do something similar to what Rocky did, yes.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2>Likewise.&nbsp; When converting from our type to a 'primitive' type, we have a property that allows us to indicate what value to use.&nbsp; For instance, our SmartBoolean will (by default) return false when converted to Boolean if the SmartBoolean's value is null but this can be toggled to true if for some reason we want that to be our default.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 24, 2006</h2>Even with that knowledge though, I'm thinking implicit SmartBool -&gt; bool shouldn't be allowed... you're assuming the developer will know what the MinIsEmpty value is and that they'll get that value should the variable be empty... seems too dangerous to me.<br><br>While we're talking about this; do you strickly stick to Rocky's implementation where MaxValue really is empty if that's what's stored?&nbsp; I did something a little different, and keep a seperate flag.&nbsp; This allows the object to store both empty and and Max and Min.&nbsp; Obviously you had to do that for the boolean.. but did you take the effort to the numerics as well?<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2><P>I took a cue from Nullables and use the internal flag.&nbsp; I didn't care for the fact that Rocky's implementation eliminated use of a legitimate value for the variable.&nbsp; However, to allow the Value property to return something, we had to provide a way to set what that value was going to be.&nbsp; So, in that regard, we did do it Rocky's way.&nbsp; BUT, this is only in the Value property if the internal 'empty' flag is set.</P>
<P>What I am considering now is to carry the Nullable concept a little farther and instead of having the Value property return this 'dummy' value, completely eliminate it and have it throw an exception if accessed when the object is 'empty'.&nbsp; I have to see what this does to my data access code before implementing, though, to make sure I don't break things elsewhere.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 24, 2006</h2>I agree; although extereme values, it did eliminate 2 values from a finite set.. never sat completely well with me either.<br><br>Of course if MS had had proper support for Nullable types and databinding, this would likely be a moot issue.&nbsp; Maybe in .Net 3.0..<br><br>Andy<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2>We can only hope.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
