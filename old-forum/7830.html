<html><header><title>Unexpected behaviour with child IsValid properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Unexpected behaviour with child IsValid properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7830.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 posted on Tuesday, October 20, 2009</h2><br />Hi<br /><br />I'm using 3.7.1 with managed properties. I was expecting that when I call my root object's IsValid property it would always get all of the children and grandchildren IsValid properties. I guess there's a very good reason why it doesn't however I have the following problem:<br /><br />In a child collection I have this override:<br /><br />        public override bool IsValid<br />        {<br />            get<br />            {<br />			// loop through PhoneNumbers<br />			// CheckRules is internal and calls each child's ValidationRules.CheckRules<br />                foreach (var item in this)<br />                    item.CheckRules(); <br />                return base.IsValid;<br />            }<br />        }<br /><br />To ensure that this is called when the root IsValid is called I override the root as:<br /><br />        public override bool IsValid<br />        {<br />            get<br />            {<br />               return PhoneNumbers.IsValid &amp;&amp; base.IsValid;<br />            }<br />        } <br /><br />This seems rather fragile because there are likely to be other Collections that need checking in this way and this mod could easily be overlooked.<br /><br />Can someone offer some thoughts or suggestions on how I might overcome this?<br />Thanks<br />Andrew<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 21, 2009</h2>If you're using a Managed Property to store you child collection in your root object, you shouldn't need to override IsValid.<br /><br />In other words, it should function as you expect it.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Wednesday, October 21, 2009</h2>In that case it doesn't work as expected:<br /><br />PhoneNumbers.IsValid is as follows:<br /><br /><br />        public override bool IsValid<br />        {<br />            get<br />            {<br />                foreach (var item in this)<br />                    item.CheckRules();<br />                return base.IsValid;<br />            }<br />        }<br /><br />Basically checks for duplicate numbers in the collection (similar to ProjectTracker Role NoDuplicates).<br /><br />Without the Root IsValid override the object sometimes incorrectly shows a BrokenRule for the PhoneNumber when the root also contains a correct BrokenRule. I wonder if the child IsValid is only checked when the root IsValid is true?<br /><br />Not really desired behaviour in my case.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 21, 2009</h2>not sure running rules checks before calling isvalid is a great way to go.  I'd remove that override, and override in the root object the childChanged, and if its something in your phone numbers collection, ask the collection to check its rules (which will ask each item in the collection to check is rules).<br /><br />i do that, and IsValid works fine for me.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Thursday, October 22, 2009</h2>OK, I think you're right.<br /><br />I posted some code which I think does what you're suggesting a bit earlier:<br /><br />http://forums.lhotka.net/forums/thread/37060.aspx<br /><br />Cheers<br />Andrew</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
