<html><header><title>Disabling BusinessListBase events when cancelling changes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Disabling BusinessListBase events when cancelling changes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3108.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>amselem posted on Wednesday, June 27, 2007</h2><P>Hi all,<BR><BR>In these threads they conclude that we should disable the BindingSource.RaiseListChangedEvents before calling BusinessListBase.CancelEdit for avoiding slow performance when undoing changes:</P>
<P>&nbsp;<A href="/forums/thread/3149.aspx">http://forums.lhotka.net/forums/thread/3149.aspx</A><BR>&nbsp;<A href="/forums/thread/3727.aspx">http://forums.lhotka.net/forums/thread/3727.aspx</A></P>
<P>I'd like to standarize this behavior to all my BLB so I derived it and overrided BusinessListBase.UndoChanges :</P>
<P><FONT color=#0000ff>Protected Overrides Sub UndoChanges(ByVal parentEditLevel As Integer)<BR>&nbsp;&nbsp;&nbsp;Dim OldRaiseListChangedEvents As Boolean = Me.RaiseListChangedEvents&nbsp;<BR>&nbsp;&nbsp;&nbsp;Me.RaiseListChangedEvents = False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyBase.UndoChanges(parentEditLevel)<BR>&nbsp;&nbsp;&nbsp;Finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me.RaiseListChangedEvents = OldRaiseListChangedEvents<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If OldRaiseListChangedEvents Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyBase.OnListChanged(New System.ComponentModel.ListChangedEventArgs(ListChangedType.Reset, -1))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<BR>&nbsp;&nbsp;&nbsp;End Try<BR>End Sub</FONT></P>
<P>This works fine, the problem is that I did change the framework to make UndoChanges overridable and I don't like that. <BR>Is there any other way to implement this ?&nbsp; maybe Rocky could add two overridable methods like OnUndoChanges() and OnUndoChangesComplete() ?</P>
<P>Regards,<BR>Jacobo</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 29, 2007</h2>There is already a "complete" method that you can override, but there isn't anything like OnUndoChanges(). That is a fine idea and I'll add it to the <A href="http://www.lhotka.net/cslanet/wishlist.aspx">wish list</A>.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, December 09, 2010</h2><p>Is there a better solution for this today in the latest version of CSLA?&nbsp; I have a grid bound to a list of 1000 objects (don&#39;t ask) and calling CancelEdit() on the list takes forever (10 seconds).</p>
<p>Thanks!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 09, 2010</h2><p>In CSLA 4 UndoChanges() in BLB sets ERLB to false before the undo. That&#39;s not new to CSLA 4 though - the change is in change set 1979 from Jan 14, 2008, which would be around version 3.5.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Friday, December 10, 2010</h2><p>Ok, thanks.&nbsp; Any other thoughts on improving the speed of the CancelEdit() operation on a large collection (short of reducing the collection size itself ;) ?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 10, 2010</h2><p>Rethink the UI to avoid the need for using n-level undo?</p>
<p>Ultimately there may not be a lot to be done. BeginEdit and CancelEdit aren&#39;t cheap operations - especially CancelEdit.</p>
<p>Also, you should try to figure out (using the debugger perhaps) whether it is the cancel operation or the rebinding that is taking so long. When CancelEdit completes it raises events to tell data binding that the entire object graph has changed - basically causing data binding to entirely rebind to the data.</p>
<p>In some UI technologies data binding is the bottleneck more than the CancelEdit operation itself.</p>
<p>If that did turn out to be the case for you, it might be worth switching to a datagrid control that supports virtual/paged loading so the UI would only rebind to the items that are currently visible.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Friday, December 10, 2010</h2><p>Good thoughts, thanks.&nbsp; It is in fact the CancelEdit() method itself&nbsp;that is taking a while.&nbsp; I removed the binding of the list from the grid to verify.</p>
<p>I tried executing CancelEdit() on a new thread, but unfortunately, it needs to execute via dispatcher on the UI thread, so no luck there either...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 10, 2010</h2><p>This may sound odd, but you could try not using CancelEdit, but instead discarding the entire object graph and reloading it from the database. Basically just do a Fetch instead of the CancelEdit&nbsp;and see if that&#39;s faster.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Friday, December 10, 2010</h2><p>Yeah, I thought about that approach actually.&nbsp; It is faster to do that, but the problem is, the scroll position of the grid is lost when the new list comes back and I re-bind to it.</p>
<p>Some time ago, I figured out a way to update the bindings with a new list which kept the grid&#39;s scroll position, but I remember it being very hackish.</p>
<p>I think I looked into how RootBindingListBase handles that type of behavior, as it successfully updates the binding to a bound object after dataportal_update.</p>
<p>If you have any clever ideas on how to update the bindings after a save operation and keeping the scroll position of the grid, I&#39;m all ears.&nbsp; Otherwise, I&#39;m afraid I&#39;ll just have to re-design my business objects and call BeginEdit() / CancelEdit() only on the participating children&nbsp;objects, as opposed to the root object.</p>
<p>Thanks again!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
