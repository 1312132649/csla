<html><header><title>Dependant Rule validation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dependant Rule validation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1815.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai posted on Wednesday, November 22, 2006</h2><P>I have two properties, AccountTypeId and NavAccountNo.&nbsp; There are also two instance rules, one which validates that the NavAccountNo exists and the second which validates that the AccountTypeId selected is valid for the entered NavAccountNo.</P>
<P>I only want the AccountTypeId validation done if the NavAccountNo is validated as existing, but I also need to make sure that if they change the NavAccountNo to a valid entry the AccountTypeId validation will get done.&nbsp; So I tried doing this</P><FONT size=2>
<P>ValidationRules.AddInstanceRule(NavisionAccountExists, </FONT><FONT color=#800000 size=2>"NavAccountNo"</FONT><FONT size=2>, 1);</P>
<P>ValidationRules.AddInstanceRule(CreditCardExists, </FONT><FONT color=#800000 size=2>"AccountTypeId"</FONT><FONT size=2>, 2);</P>
<P>ValidationRules.AddDependantProperty(</FONT><FONT color=#800000 size=2>"NavAccountNo"</FONT><FONT size=2>, </FONT><FONT color=#800000 size=2>"AccountTypeId"</FONT><FONT size=2>);</P>
<P><FONT size=3>This works nearly perfectly.</FONT>&nbsp;<FONT size=3>The only issue&nbsp;is that this displays an error provider error symbol against the AccountTypeId bound control when the NavAccountNo does not exist.&nbsp; The tooltip for the error is the one for the </FONT></FONT><FONT size=2>NavisionAccountExists </FONT><FONT size=3>rule.&nbsp; So I end up with the same error displayed against two properties.&nbsp; How can I get the two properties to trigger each others validation rules but only show the error icon against the relevant property?&nbsp; Hope this makes sense!</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 22, 2006</h2><P>So your AccountTypeId is getting the same tooltip as NavAccountNo? That doesn't make any sense - the NavisionAccountExists rule shouldn't be running for the AccountTypeId property...</P>
<P>Or are you saying that you just don't want CreditCardExists to run if NavisionAccountExists fails?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, November 23, 2006</h2><FONT size=2>
<P>I do not want CreditCardExists to run if NavisionAccountExits fails. I thought that the priority parameter I used when adding the rules would facilitate this? I don 't understand the tooltip thing either, but it only happens if I have the AddDependantProperty line. If I comment this out then the tooltip will only display next to the NavAccountNo property, which is correct - but then I don't get the CreditCardExists rule to fire if someone changes the NavAccountNo property and it passes the NavisionAccountExits validation. Hope this is clearer</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 23, 2006</h2>




<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2>The priority setting is used to prioritize the order in 
which rules are applied for each specific property. It does nothing across 
properties.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2>What you need is a rule that runs, and fails, on the same 
property as CreditCardExists, and _that_ rule should be at priority 0 so it runs 
before CreditCardExists.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2>But that's not really what you want either. 
Hmm...</FONT></SPAN></DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2>I'll have to give this some thought as I digest my turkey 
dinner this afternoon.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=906370714-23112006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV>
<DIV align=left><SPAN class=906370714-23112006></SPAN>&nbsp;</DIV><BR>
<BLOCKQUOTE>
  <DIV class=OutlookMessageHeader align=left>
  <HR>
  <FONT face=Tahoma size=2><B>From:</B> razorkai [mailto:cslanet@lhotka.net] 
  <BR><B>Sent:</B> Thursday, November 23, 2006 2:25 AM<BR><B>To:</B> 
  rocky@lhotka.net<BR><B>Subject:</B> Re: [CSLA .NET] Dependant Rule 
  validation<BR></FONT><BR></DIV>
  <DIV></DIV><FONT size=2>
  <P>I do not want CreditCardExists to run if NavisionAccountExits fails. I 
  thought that the priority parameter I used when adding the rules would 
  facilitate this? I don 't understand the tooltip thing either, but it only 
  happens if I have the AddDependantProperty line. If I comment this out then 
  the tooltip will only display next to the NavAccountNo property, which is 
  correct - but then I don't get the CreditCardExists rule to fire if someone 
  changes the NavAccountNo property and it passes the NavisionAccountExits 
  validation. Hope this is clearer</P></FONT><BR><BR><BR></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, November 23, 2006</h2>Further information:&nbsp; Don't worry about the tooltip issue, as that was the guy who wrote the validation stored procedures I am using getting it wrong.&nbsp;&nbsp; Thanks for the info about the rule priorities, they make more sense now.&nbsp; Look forward to seeing what can be done regarding my rule requirement!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, November 27, 2006</h2><P>OK, thanks for letting me know about the tooltip issue - I couldn't figure that one out...</P>
<P>But I think I have a workable answer for the short-circuiting issue. Before implementing it I want to get feedback on the idea though.</P>
<P>One of the things you can do to short-circuit processing for a property is have a rule method explicitly set e.StopProcessing to True, and then return False. Regardless of all other factors, this combination will cause subsequent rules for the property to be ignored.</P>
<P>If I change this slightly I think I can provide an answer to your scenario.</P>
<P>If e.StopProcessing = True causes short-circuiting <EM>in all cases</EM> (even if the rule returns True), then you could create a required-field rule method that <EM>doesn't fail</EM>, but does stop processing of subsequent rules.</P>
<P>Or, to be slightly more clever, you could create a rule that doesn't fail, but stops processing of subsequent rules if some <EM>other</EM> property has 1+ broken rules. This could be a new common rule, because if my scheme works I could see this being quite useful in many cases.</P>
<P>So what you'd do is:</P>
<OL>
<LI>Run normal processing on PropertyA - causing it to have a broken rule if it is missing</LI>
<LI>Use this new PropertyHasNoErrors rule on PropertyB, at priority 0</LI>
<LI>Use any other rules on PropertyB at priority 1 or higher</LI></OL>
<P>Since PropertyHasNoErrors would not "fail", it wouldn't trigger a tooltip. However, with my proposed e.StopProcessing mod, it <EM>would</EM> stop all subsequent rules from processing for PropertyB, which gets you the desired result.</P>
<P>What do you think?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Tuesday, November 28, 2006</h2><P>Hi Rocky.</P>
<P>That sounds like a good solution.&nbsp; My only concern is that by changing StopProcessing to short circuit in all cases you could break other peoples code that relies on the way it behaves now.&nbsp; This&nbsp;concern may prove to be unfounded, maybe other people in the forum have some feedback?</P>
<P>John.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, November 28, 2006</h2>I agree with the concern about breaking existing code. And yet I am becoming increasingly convinced that this is how I should have done this in the first place <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
