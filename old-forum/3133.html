<html><header><title>TransactionalType TransactionScope over multiple BO's rollback fails?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>TransactionalType TransactionScope over multiple BO's rollback fails?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3133.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna posted on Tuesday, July 03, 2007</h2>This message concerns post&nbsp; http://forums.lhotka.net/forums/thread/15688.aspx. I've posted it there as well sorry for that! I wanted to start a new title...<br><br>Hello,<br><br>I've solved the above problem. I was sloppy on replacing the ADO transactions and try catch structures.<br><br>But than I got a new problem :) I'm trying to create a CommandBase object that calls the Save for two BO's.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Transactional(TransactionalTypes.TransactionScope)]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Execute()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _inslag.Status = WmsMutationStatusses.Afgedrukt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _inslag.Save();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _locatie.IntakeId = (int)_inslag.SysId;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _locatie.Save();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Two questions about this structur:<br><br>1. Rollback<br>The first save is no problem. The second BO however has an invalid Stored Procedure name and runs into an error. I now this is an user error, however shouldn't this do a rollback for the first BO as well?<br><br>2. Multiple connections<br>Both BO's open the same connection during the Save. In the forum I read that this means DTC starts a distributed transaction. Is this a problem and perhaps the problem for my first question? I can't pass the connection for two separate BO's can I?<br><br>Any thoughts?<br><br>Regards,<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Tuesday, July 03, 2007</h2>Hmmm. i've found that adding enlist=false to the connstring does not really help in using the transactions the dtc way?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Tuesday, July 03, 2007</h2>I've changed the connstring and the dtc is responding, however not the right way... after approx two minutes I receive the following exception:<br><br>Print is niet gelukt. DataPortal.Update mislukt (Csla.DataPortalException: DataPortal.Update mislukt (System.Transactions.TransactionException: The transaction has already been implicitly or explicitly committed or aborted. ---&gt; System.Runtime.InteropServices.COMException (0x8004D00E): De transactie is al impliciet of expliciet doorgevoerd of afgebroken. (Exception from HRESULT: 0x8004D00E)<br><br>Does the use of several Transactions interrupt the proces?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Tuesday, July 03, 2007</h2>Ok, so I found the problem... the commandbase that calls the Save for both the BO's has a transaction as well as the two BO's....<br><br>It seems like the Transaction is not shared or something...<br><br>Any thoughts?<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Tuesday, July 03, 2007</h2>even if I get this stuff to work, it seems like using SQL2K with transactionscope isn't a smart thing to do as it will always use distributed transactions...<br><br>however, how DO I handle one transaction for two BO's?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Thursday, July 05, 2007</h2>*bump*<br><br>I would like to know how this can be done too...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Thursday, July 05, 2007</h2>Hello Skafa,<br><br>It took me a while to figure out that getting TransactionScope to work with SQL2K is hard to do. However simply using ADO transactions does the trick perfectly. Please take a look at my post at the following address:<br><br><a HREF="/forums/thread/15835.aspx">http://forums.lhotka.net/forums/thread/15835.aspx</a><br><br>This works great for me. Please let me know if you have any problems getting it to work.<br><br>Regards,<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Thursday, July 05, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>cultofluna:</strong></div><div>even if I get this stuff to work, it seems like using SQL2K with transactionscope isn't a smart thing to do as it will always use distributed transactions...</div></BLOCKQUOTE></P>
<P>Here's a way of overcoming that. It works pretty well for me.<BR><A href="http://blogs.msdn.com/florinlazar/archive/2005/09/29/475546.aspx">http://blogs.msdn.com/florinlazar/archive/2005/09/29/475546.aspx</A></P>
<P>I found it via Rocky's suggestion here:<BR><A href="http://lhotka.net/Article.aspx?area=4&amp;id=39c79955-ddc9-42c7-a657-d5c2ed49975e">http://lhotka.net/Article.aspx?area=4&amp;id=39c79955-ddc9-42c7-a657-d5c2ed49975e</A></P>
<P>Ross</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Thursday, July 05, 2007</h2>Hello Ross,<br><br>Thanks for that. I've found these as well, however I was having a hard time getting it to work the way it should as the DTC was getting activated, probably because not only the CommandBase but the BO's themselves started an own connection and transaction. <br>After several hours of frustation I quit using it and started the ADO version based on another post of Rocky (please refer to the post in my previous message, as I dont have it at hand right now!)<br>What I like about the ADO solutions is that's it's pretty lightweight, transparant and easy to use. However when I move to SQL2K5 I'll try again :)<br><br>Regards,<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
