<html><header><title>Delaying Validation in bound XAML fields until after initial user interaction?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Delaying Validation in bound XAML fields until after initial user interaction?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9331.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>djcohen66 posted on Thursday, August 05, 2010</h2><p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">I am looking for a decent solution to a model validation/display issue in an MVVM implementation of CSLA&nbsp;using&nbsp;Silverlight.</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">We&nbsp;have built a simple model with fields like so:</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">private</span> <span style="color:blue;">static</span> <span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:blue;">string</span>&gt; UsernameProperty = RegisterProperty&lt;<span style="color:blue;">string</span>&gt;(c =&gt; c.Username);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>[<span style="color:#2b91af;">Display</span>(Description = <span style="color:#a31515;">&quot;Username&quot;</span>)]</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>[<span style="color:#2b91af;">Required</span>(ErrorMessage = <span style="color:#a31515;">&quot;Username required&quot;</span>)]</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">public</span> <span style="color:blue;">string</span> Username</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">get</span> { <span style="color:blue;">return</span> GetProperty(UsernameProperty); }</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">set</span> { SetProperty(UsernameProperty, <span style="color:blue;">value</span>); }</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:9pt;">and used the AddBusinessRules method to activate the validation.&nbsp; This works fine and when I bind the field to a text control the validation fires like a charm.<span style="mso-spacerun:yes;">&nbsp; </span>Unfortunately it fires the moment the field is displayed on the screen.<span style="mso-spacerun:yes;">&nbsp; </span>I would prefer that validation not highlight the required fields until after the user has attempted to submit the for the first time.</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:9pt;">I found that I could get something close to the behavior I wanted by setting </span><span style="font-family:Consolas;font-size:9.5pt;mso-bidi-font-family:Consolas;">BusinessRules.SuppressRuleChecking = false; </span><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:9pt;">after AddBusinessRules was called and then setting it to true again when the set method of the model property was called.<span style="mso-spacerun:yes;">&nbsp; </span>However my co-worker feels, and I must agree, that this seems too much like monkeying with the model to satisfy behavior required in the UI and violates appropriate separation of concerns.</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:9pt;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:9pt;">So how can I achieve my goal, maintain the purity of the model, and not put code in the code behind of the view?</span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, August 06, 2010</h2><p>All the UI technologies generally work this way - as part of their binding process, they check to see if each property is valid and update the display accordingly. I don&#39;t know of any way to turn that behavior off in any of the UI technologies.</p>
<p>You can use rule short-circuiting to get some level of solution. Basically, create a rule that short-circuits if the object isn&#39;t in a state where you want the rules to run. Then attach that rule to every property at priority -1 (so it runs before any normal rules).</p>
<p>This way a new object will be valid up until the point the user interacts with it. Of course this implies you can detect that the user has interacted with the object - and there&#39;s no built-in mechanism for that either - at least by default.</p>
<p>So then what you can do is override the default MarkNew() behavior so a new object isn&#39;t dirty by default. That way, your short-circuit rule can stop processing if the object is not dirty, and only allow rules to run if the object is dirty.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>djcohen66 replied on Friday, August 06, 2010</h2><p>It would be nice if it were possible to change the value AllowEmptyStrings parameter of the Required attribute at runtime.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, August 07, 2010</h2><p>In CSLA 4 rule instances are shared across all instances of a business type, so there&#39;s no way to make persistent state changes to a rule without affecting all current (and future) instances of the corresponding business type.</p>
<p>I suspect that&#39;s true of the DataAnnotations attributes as well. It is very likely that one instance of the attribute is created for the type and is reused - though I don&#39;t know that for sure. I hope that&#39;s the case though, from a resource consuption perspective.</p>
<p>What this means, is that the difference in behavior can&#39;t rely on the state of the rule, it has to rely on the state of the business object instance. That&#39;s true for CSLA 4 rule objects, or for custom ValidationAttribute objects. Either technique allows you to create your own custom rule implementation where your rule can adapt to the state of the business object at runtime.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
