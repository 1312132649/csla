<html><header><title>How insert a new child object?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How insert a new child object?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/551.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram posted on Thursday, July 06, 2006</h2><P>Hi!</P>
<P>I would ask if somebody can show an example code&nbsp;of how to insert a new child editable object.</P>
<P>Regards</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram replied on Friday, July 07, 2006</h2><P>I am sure somebody knows the CSLA way to add-insert new child objects with identity id PK, but who?</P>
<P>Let's wait and see<img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, July 07, 2006</h2>Usually the new child is added when its internal 'SaveSelf ' is called, after the user indicates they want to save the root object they are working with.<br><br>If you MUST insert the row as soon as the user adds a new child, you can override AddNew in the collection, like so:<br><br>public class MyList : BusinessListBase&lt;MyList, MyChild&gt; {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // other code<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override object AddNewCore() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyChild result;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = MyChild.NewChild();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnAddingNew( new AddingNewEventArgs( result ) );<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add( result );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br><br>public classs MyChild : BusinessBase&lt;MyChild&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static MyChild NewChild() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Create&lt;MyChild&gt;( new EmptyCriteria() );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class EmptyCriteria : CriteriaBase {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public EmptyCriteria() : base( typeof ( MyChild ) ) { }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void DataPortal_Create( EmptyCriteria crit ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ADO.Net code inserts row<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  MyPK = (int)cmd.Parameters[ "@NewId" ];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br><br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>matt tag replied on Friday, July 07, 2006</h2><font face="Verdana" size="1">You should not need to insert the child into the database right away - so there is no need to know the child object's PK right away.<br><br>Consider this example - when you open Word or Excel and select "New", does anything get written to disk right away?&nbsp; It does not. The new document stays in memory until the user hits "Save", only then does the object get written to disk and assigned a "primary key" (in this case, a file name in the file system).<br><br>CSLA works the same way. When the user clicks "Add new Object" - nothing should get written to the database at that time. A new CSLA object gets created in memory and is ready for editing by the user. Only when the user says "Save" on the root object does anything get written to the database.<br><br><br>matt tag<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram replied on Friday, July 07, 2006</h2><P>First I must say thank you for your efforts to answer my questaion.</P>
<P>Probably it is me! but it doesn't matter how long you wait before you save the new child object to DB. Hopfuly you do that eventually. What happens after that is my problem because when I call rootobject.Save() to insert the new child object that reference that I have to child object is invalid and must find a new refference to child object but to get that I must know the identity id that is return by insert SP and UI developer is wondering how he can get it back!</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, July 07, 2006</h2>What does your UI code look like?&nbsp; Usually you don't need to keep track of individual children, since the collection they are in is databound to a grid.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shahram replied on Friday, July 07, 2006</h2><P>I use SCSF(<A href="http://www.gotdotnet.com/codegallery/codegallery.aspx?id=941d2228-3bb5-42fd-8004-c08595821170">http://www.gotdotnet.com/codegallery/codegallery.aspx?id=941d2228-3bb5-42fd-8004-c08595821170</A>) and my UI is a windows form with textbox and labels and combobox like any other UI.</P>
<P>When user has open the insert new contact form he inputs some data like name and address and then he pushes insert and in code Rootobject.Save() so contact becomes inserted in DB but user expexts after clicking the insert button the form is kept alive(rebounded to contact oblect with the newly identity) so user can continue to edit and do what he just wants!</P>
<P>The issue is after rootobject.save() no reference is left to rebound to the form!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, July 07, 2006</h2>Assuming your text boxes are bound to a binding source, you'd do this:<br><br>rootobject = rootobject.Save();<br>rootBindingSource.DataSource = rootobject;<br><br>That will rebind everything.<br><br>So where is this child object you're talking about?&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Friday, July 07, 2006</h2><P>Don't you have to set .DataSource to null first before setting it to your new object?</P>
<P>I've been doing that because the book says so (C# 2.0 page 492). Honestly I've never tried not doing it, but the book says it will still be bound to the old object if you don't.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, July 07, 2006</h2>Oh, you may be right there.&nbsp; I don't use remoting though, so it hasn't been a problem for me (yet).<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 07, 2006</h2><P>You need to look at Chapter 9, as I walk through the process of supporting an "Apply" button that does a save and also keeps the form open.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>shahram:</strong></div><div></P>
<P>The issue is after rootobject.save() no reference is left to rebound to the form!</P>
<P></div></BLOCKQUOTE></P>
<P>Just be aware that there is some errata around the content in the book - specifically that you should avoid calling BeginEdit/ApplyEdit directly on the business object, and instead should call EndEdit on the bindingsource instead. Details are in other threads here, or on <A href="http://www.lhotka.net/cslanet">www.lhotka.net/cslanet</A> </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
