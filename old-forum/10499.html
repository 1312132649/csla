<html><header><title>Calling DataPortal inside DataPortal.Fetch -&gt; new thread?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Calling DataPortal inside DataPortal.Fetch -&gt; new thread?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10499.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mesh posted on Thursday, July 07, 2011</h2><p>When calling DataPortal.Fetch inside another Fetch method (server side, Silverlight app), application is skipping to a new thread and User ( application have an unauthenticated principal )&nbsp;and LocalContext are being lost?</p>
<p>EDIT: I am calling async dataportal from server side. Ok, so I cant&nbsp;do that&nbsp;and keep User object?</p>
<p>Thanks</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, July 07, 2011</h2><p>You really shouldn&#39;t use async data portal calls when you are in logical server-side code. In other words, if you are &quot;in the data portal&quot;, don&#39;t make async data portal calls.</p>
<p>CSLA and the data portal do <em>absolutely nothing</em> to ensure that such a thing would work. And this means you would need to implement thread syncronization and notification yourself.</p>
<p>Most notably, the &quot;primary data portal thread&quot; - the first one running in the logical server-side - can&#39;t be allowed to complete and return to the client until all other server-side threads complete. You are <em>completely responsible</em> for ensuring that is done right if you try to do async in the logical server.</p>
<p>You must also understand that SL itself switches all WCF (or other) async callbacks to run on the UI thread. So you also must completely understand how SL does threading.</p>
<p>To my knowledge, if you were really, really careful and completely understood what was going on with threading in SL and the data portal, you should be able to use async code within the server-side data portal code. But understand that CSLA doesn&#39;t do anything to support such a scenario, and I don&#39;t recommend it.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
