<html><header><title>Inactive Lookup Codes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Inactive Lookup Codes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1573.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RealQuiet posted on Tuesday, October 24, 2006</h2><P>I realize this problem is not specific to CSLA, but I'm trying to use CSLA objects to solve it, so here goes:</P>
<P>I currently have a collection of lookup objects.&nbsp; These objects have 3 properties: key, value, and&nbsp;active flag.&nbsp; I am also wrapping that collection up with a "cache" object that retrieves a set of lookup values the first time it's used and caches it.</P>
<P>The customer needs to be able to inactivate codes.&nbsp; I think it&nbsp;should be easy enough to pull the active values out of the lookup collection using the FilteredBindingList, but the problem is what to do about inactive codes for historical data.&nbsp; </P>
<P>For example, a record was entered sometime in the past with a code that was active at that time.&nbsp; The code was made inactive at some point, and now the user tries to pull up the old record.&nbsp; If I use the active codes to bind to a combo box, the old value isn't valid and can't be displayed.&nbsp; In the combobox, I need to show the active items plus the inactive item that&nbsp;was previously entered.&nbsp; In addition to this, this may occur in a datagrid, so there may be multiple inactive items that need to be added in with the active items.</P>
<P>I am hoping to find out how other people are handling the inactive code issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 24, 2006</h2>Search the forum for displaying a 'blank' line in a combo box.&nbsp; It sounds similar to this; the idea is that a combo should have a blank value, but the db list obviously won't contain the blank value. <br><br><br>You should be able to workout a similar solution, which is to create a view which is bound to the combo (which has everything + the selected value, if that value is inactive).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 24, 2006</h2><P>I agree with Andy. </P>
<P>I add the "inactive" value to the list of "Active" values - but only when editing an existing record. A New record only gets the list of Actvie values. </P>
<P>I also have rules that check for IsNew and that the Inactive value has not changed to a different inactive value. </P>
<P>In other words, the user can leave the field alone and edit the rest of the record and the Save will work (even though the field is inactive.)&nbsp; I do this by setting the orig_Value of the field to a private member variable and using that in my rules for ensuring the current value is either the originally loaded inactive value or is a new Active value.</P>
<P>Also, they can change the field if they want to one of the Active values. They just can't change it to a different inactive value.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtagliaf replied on Tuesday, October 24, 2006</h2><font color="#000000" face="Verdana" size="1">I agree w/ the above, with one other point - I see these as two different use cases - "All Active Codes" and "All Active Codes along with the one inactive code on the current record". Two use cases - two objects (or, at the very least, a second factory method on the same object that alters the SQL).<br><br>You might also want to rethink the caching on the second object - since the object changes frequently.<br><br>matt tag</font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RealQuiet replied on Tuesday, October 24, 2006</h2><P>Thanks guys.&nbsp; You've hit exactly what I'm looking for.&nbsp; Currently, my "cache" object has a method that returns a given lookup list.&nbsp; That method has an override to accept a string parameter for the first item.&nbsp; So you could pass in "&lt;Choose Something&gt;", and the object would pass you back the list with that as the first item in the list.&nbsp; In that method, I clone the cached object and add the item, so the original cached item is untouched and still available for use throughout the application.</P>
<P>Joe, it sounds like you have done exactly what I need to do with the object keeping the original value, etc, and that is the behavior I want.&nbsp; Can I ask how you are adding the current&nbsp;inactive values to the active list?&nbsp; Is this lookup exposed through your BO, and the BO populates&nbsp;the extra values&nbsp;for you?&nbsp;&nbsp;-Or- Do you pass in the values to the lookup object to return you the modified list?&nbsp; Or what is the cleanest way to do that?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SlyBelle replied on Tuesday, October 24, 2006</h2><P>Not sure if this is the absolutely right way, but this is how I accomplished what your looking to do.&nbsp; I do it through actual SQL.&nbsp; Basically, you pass the Stored Procedure the current value and the stored procedure returns all the currently active records plus the original record selected.&nbsp; Now you can select any currently active items or the one that was previosuly used since they will be listed in the listbox.</P><FONT color=#0000ff size=2>
<P>SELECT</P>
<P></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;[TestId],</P>
<P>&nbsp;&nbsp;&nbsp;[TestName],</P>
<P>&nbsp;&nbsp;&nbsp;[ActiveStatus]</P>
<P></FONT><FONT color=#0000ff size=2>FROM </FONT><FONT size=2>[tblTest]</P>
<P></FONT><FONT color=#0000ff size=2>WHERE</P></FONT><FONT size=2>
<P>([TestId] = @OldTestIdValue) </FONT><FONT color=#0000ff size=2>or </FONT><FONT size=2>([ActiveStatus] = 1)</P></FONT>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Tuesday, October 24, 2006</h2>I lob the lookup list into an ObjectListView and set its filter property to "Active = True or Id in (" + GetIdsCurrentlyInUseByObjects() + ")".&nbsp; Then you get the items that are active or used by the items that you want to display.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RealQuiet replied on Tuesday, October 24, 2006</h2>Perfect, thanks everyone!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
