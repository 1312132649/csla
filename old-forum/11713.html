<html><header><title>3-tier and Application tier Security</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>3-tier and Application tier Security</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11713.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>brian_peterson posted on Monday, November 19, 2012</h2><p>I have a working CSLA v4 MVC3 App. I have it setup with a MVC Web tier, and a Application Server tier. It&#39;s setup using wsHttpbinding. It uses a self generated 509 certificate.</p>
<p>Anyway, I was setting up a test box, and set it up with basicHttpBinding without SSL. Again, it works fine.</p>
<p>I was writing a anonymous controller method for MVC, and to my shock any CSLA business object was able to call the Application Server just fine. This seems wrong to me.</p>
<p>I would have expected that CSLA would check my Identity &quot;IsAuthenticated&quot; flag before I went across the wire to the Application tier, or throw an exception on the application server. </p>
<p>The reason this concerns me is what if I placed my Application Server outside the firewall? What are the security implications then? Granted you will have SSL turned on. So, is it reasonable to think everything will be secure because of my SSL setup?</p>
<p>What I don&#39;t want is someone who steals my Business Object DLL is able to call my Application server without being authenticated. Currently, this is the case with basicHttpBinding or wsHttpBinding. Except, they would need to get my SSL cert on their end. This seems flawed, because what if I used GoDaddy? Would they be able to call my Application Server then?</p>
<p>Maybe the community can calm my fears, as I had always assumed CSLA was enforcing the IsAuthenticated flag on the Application Server.</p>
<p>&nbsp;</p>
<p>Thoughts?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Monday, November 19, 2012</h2><p>Would it always be required to have IsAuthenticated = true? - No. </p>
<p>But - you can easily add this to your serverside DataPortal. </p>
<div style="color:black;background:white;font-family:Consolas;font-size:10pt;">
</div>
<p>Just create your own class that implements <span style="color:#2b91af;">IAuthorizeDataPortal </span>and configure this by setting <span style="color:#a31515;">CslaAuthorizationProvider </span>in web.config.</p>
<p>This is the default authorizer class:</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">NullAuthorizer</span>&nbsp;:&nbsp;<span style="color:#2b91af;">IAuthorizeDataPortal</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Creates&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;type.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;clientRequest&quot;</span><span style="color:gray;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Client&nbsp;request&nbsp;information.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Authorize(<span style="color:#2b91af;">AuthorizeRequest</span>&nbsp;clientRequest)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<span style="color:green;">/*&nbsp;default&nbsp;is&nbsp;to&nbsp;allow&nbsp;all&nbsp;requests&nbsp;*/</span>&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />In reality - if anyone can get your assemblies they can do whatever they like!!!!!! <br />Reflection in .NET is so powerful that a developer/hacker can do whatever he wants <br />and set IsAuthenticated to true in your principal. </pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brian_peterson replied on Monday, November 19, 2012</h2><p>True, but then it seems like you would never want your Application Server out on the Internet? It seems like a security flaw that I could create a message to my application server, without being authenticated. If you have MVC with ASP.NET Forms Authentication you need a special cookie that is only created on the server, unique to that user&#39;s IP, and time bombed. This would stop a hacker (assuming Forms Authentication has not been compromised, but Microsoft seems to be quick to fix these issues).<br /><br />However, CSLA&#39;s way it serializes to the Application Server seems flawed. There is no mechanism that I can see that would prevent someone to record WCF messages and re-play them back. I will give the custom Authorize a go. But like you said it&#39;s still a problem.</p>
<p>I am not a fan of Security by Obscurity... Maybe there is someone who has a more secure way to communicate between both tiers?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brian_peterson replied on Tuesday, November 20, 2012</h2><p>As a follow-up. I decided to add a custom authorize, checking if the CSLA user is authenticated. It&#39;s filled-out at that point, which made it easy. Then we are making sure we always use our own x.509 certificates (through WCF). That should make it so only the Web Server can talk to the Application Server. This seems to be the easiest thing to do at this point. If anyone has more ideas I would welcome them!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, November 20, 2012</h2><p>Like ASP. NET, CSLA is designed to support a wide range of scenarios, including the idea of guest users, and low security transports like basicHttp and other bindings.</p>
<p>Again, just like with any web app or service, it is up to you to understand how to secure your service or site. As Jonny points out, we provide you with a clear location to check the validity of each inbound request. Additionally, we default to using WCF, and support all the security models it supports. So you can secure your channel as much as WCF will allow and the data portal will run within that context.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
