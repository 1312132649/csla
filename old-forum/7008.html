<html><header><title>Parent child relationships....</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent child relationships....</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7008.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nemisis posted on Wednesday, May 27, 2009</h2>Hi everyone, hope you are all well. I have recently upgraded from v2.1 to v3.6 and very happy with it so far, but i have a question, more about design rather then csla.<br><br>I have a parent list called TeamList.&nbsp; TeamList holds Team objects, but each Team object has a property called TeamList, so basically a Team can be within another team and have team as children.<br><br>Now, my problem is that if i need to move a team to a different parent, i would call Remove in the list and then insert, but csla now thinks that the objects needs to be deleted in the database and then added as a new item.&nbsp; Now all other tables that use that Id are incorrect.<br><br>Has anyone come across anything like this before?&nbsp; How would people suggest going about this?&nbsp; Is it bad practice to store the actual parentId against the object as another property, especially since if i update this the object will still be in the wrong place, unless i refetch the data.<br><br>Another option, is to do the Remove and Insert option, and then create a custom property that Marks the object as swapped, which looks like this.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Friend Sub MarkSwapped()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkNew()&nbsp;&nbsp; ' so not IsDeleted<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld()&nbsp;&nbsp; ' so not IsNew<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkDirty() ' so IsDirty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>Is this ok?&nbsp; This would mean that the list is in the correct order, before saving and when saving, the object is updated ONLY, rather then deleted and added.<br><br>If anyone has a better way to do this let me know<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, May 28, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Nemisis:</strong></div><div>...Now, my problem is that if i need to move a team to a different parent, i would call Remove in the list and then insert, but csla now thinks that the objects needs to be deleted in the database and then added as a new item.&#160; Now all other tables that use that Id are incorrect...</div></BLOCKQUOTE><br /><br />Maybe this isn't the right way to think of this from the CSLA perspective, but what you are doing here really isn't a Remove but instead is simply changing the parent property. <br /><br />I'd think there are several ways to do this, but one possibility would be to implement a specific method for this purpose that doesn't use the Remove method but instead updates the relationships directly (perhaps a CommandBase derived object). I think you are on the right track that refreshing the original list is the correct way to "remove" it from the original list. </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmnc replied on Friday, May 29, 2009</h2><P>You could have a MoveTo method on you Team object that delegates the movement to the parent TeamList collection and marks the moved Team object as dirty. In the TeamList collection clone the Team object, remove it from the collection and deleted list and add it to the new parent.</P>
<P>Public Class Team<BR>&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of Team)</P>
<P>&nbsp;&nbsp;&nbsp; Public Sub MoveTo(ByVal target As Team)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim movedTeam = DirectCast(Me.Parent, TeamList).MoveTo(Me, target)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; movedTeam.MarkDirty()</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>End Class</P>
<P>Public Class TeamList<BR>&nbsp;&nbsp;&nbsp;Inherits BusinessListBase(Of TeamList , Team)</P>
<P>&nbsp;&nbsp; Friend Function MoveTo(ByVal sourceTeam As Team, ByVal targetTeam As Team) As Team<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim clone = sourceTeam.Clone()</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Remove(sourceTeam)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.DeletedList.Remove(sourceTeam)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; targetTeam.TeamList.Add(clone)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return clone</P>
<P>&nbsp;&nbsp;&nbsp; End Function</P>
<P>End Class</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nemisis replied on Sunday, May 31, 2009</h2>Thanks for both replies, but i think i like the MoveTo Sub and Function best as i think it suits me more.<br><br>I have one question about this though....<br><br>This works perfectly for moving teams to other teams, but since TeamList is the parent object, and a team can NOT have a parent (thus it would be in the root TeamList), how can i move a team&nbsp; that has a parent, to the root teamlist?&nbsp; I guess i would need some sort of reference to the root team?&nbsp; I dont think i can use the Parent property?<br><br>Thanks again<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nemisis replied on Sunday, May 31, 2009</h2>Never mind, i have created a second function/sub that takes a list parameter.<br><br>Thanks again<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
