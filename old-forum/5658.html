<html><header><title>Dynamically Create Objects From Class Name</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamically Create Objects From Class Name</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5658.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>geltendorf posted on Thursday, October 23, 2008</h2>It might sound wierd, but at the moment I don't have any other/better idea how to acomplish this. There is a need to recreate (renew) almost all aubscriptions evry year again based on accounts and subscriptions/transactions from previous year. So naturally, in CSLA i have to clone plenty of objects form previous year to new objects using DataMapper. But, there is a posibility that list of objects to be recreated and persisted is going to change over the time I don't want to to add/remove object name&nbsp;in "Selecet Case" clause list of objects and recompile every time when objects to be cloned are added/removed. The idea is to have a table in database with Object name, Method to call to instatiate object, Criteria to fetch object, parent object id if collection&nbsp;etc. So renewal could be database driven without recompiling the code&nbsp;every time/when&nbsp;list of object is changed over the time. Reflection is not my strong part so anything I've tried in a few days didn't work. I was curious if somebody already did some work with similar requirements and want to share code/snippet/idea with me. So basically, I need to be able to dynamically create object and fetch data based on data from database table as class name, method name to get/fetch data, criteria, parent object id&nbsp;etc. Any help is greatlly appreciated.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, October 23, 2008</h2><P>Yes, you can do this pretty easily. </P>
<P>The key is to construct a System.Type object from the class name. There may be other ways, but I have done this by first building a string that can be resolved into a classname, which is in the format:</P>
<P>Completely.Qualified.Class.Name,Assembly</P>
<P>(For example, "Csla.Core.BusinessBase,Csla") </P>
<P>Then you can use the System.Type functions to retrieve an actual type object. The above class is probably abstract so you can't instantiate it, but any concrete class would work. You can also reflect on static methods in the class (e.g. if you had a class factory method like Create() or GetList()). You can use Activator.CreateInstance() to construct actual object using the System.Type value.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> strClassName =&nbsp; </FONT><FONT color=#a31515 size=2>"<FONT color=#000000>Csla.Core.BusinessBase,Csla</FONT>"</FONT><FONT size=2>;</P>
<P>System.</FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2> aType = System.</FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2>.GetType(strClassName, </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>);</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>geltendorf replied on Thursday, October 23, 2008</h2><P>rsbaker0,</P>
<P>Thank you for quick response. I will appreciate a little bit&nbsp;more details, since as I said reflection is not my strong part (I've never worked with reflection before). The constructor for CSLA object is protected so I cannot instatiate the object with constructor but with a static method providing criteria (parameters) to fetch data. This part is&nbsp;pretty fogy for me, or&nbsp;beter said the syntax to invoke the get and invoke the&nbsp;method from CSLA object&nbsp;instantiated using reflection:</P><FONT size=2>
<P></FONT><FONT size=2>Activator.CreateInstance(_type, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True</FONT></FONT><FONT size=2>)</FONT><FONT size=2></P></FONT>
<P>Actually what I need explanation of following syntax:</P>
<P>System.<FONT color=#2b91af size=2>Type</FONT><FONT size=2>&nbsp;_type = System.</FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2>.GetType(strClassName, </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>);</P></FONT>
<P><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>Object </FONT></FONT><FONT size=2>o </FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>= </FONT></FONT><B><FONT size=2>null</B></FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>;<BR><FONT size=2>MethodInfo mi = null</FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>;<BR></FONT></FONT></FONT></FONT><FONT size=2><FONT size=2>mi </FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>= </FONT></FONT>_type.GetMethod(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>strMethodName</FONT></FONT><FONT size=2>, BindingFlags.Public </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Or</FONT></FONT><FONT size=2> BindingFlags.CreateInstance, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Nothing</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2> Type() {_type}, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Nothing</FONT></FONT><FONT size=2>)<BR>o = mi<FONT color=#006400 size=2><FONT color=#006400 size=2>.</FONT></FONT><B><FONT color=#191970 size=2><FONT color=#191970 size=2>Invoke</B></FONT></FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>(</FONT></FONT><FONT size=2>oList</FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>, </FONT></FONT><B><FONT color=#008b8b size=2><FONT color=#008b8b size=2>new </B></FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>object</FONT></FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>[] {</FONT></FONT><FONT size=2>criteria</FONT><FONT color=#006400 size=2><FONT color=#006400 size=2>});</P>
<P></FONT></FONT></FONT><FONT size=2>The syntax might be wrong but whatever I've tried didn't work or I don't see neither know how to fill in the blanks.</FONT></P>
<P><FONT size=2>TIA,</FONT></P>
<P><FONT size=2>geltendorf</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, October 24, 2008</h2><P>Rocky has a MethodCaller in the CSLA infrastructure -- it would be worthwhile to look at it. </P>
<P>If you are manufacturing or retreiving object, usually you would be calling a static method. </P>
<P>For simple scenarios, you don't have to retrieve the MethodInfo. You can invoke the member by name. </P>
<P>Here are some&nbsp;examples (sorry it's C#).</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>object</FONT></FONT><FONT size=2> obj = ObjectType.InvokeMember(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Get"</FONT></FONT><FONT size=2>, System.Reflection.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.FlattenHierarchy | System.Reflection.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.Public | System.Reflection.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.Static | System.Reflection.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.InvokeMethod, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2>[] { currentVal });</P></FONT>
<P>Or an entire function that calls GetEditableRootList (my static method) for a set of criteria:</P>
<P>&nbsp;</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IList</FONT></FONT><FONT size=2> GetEditableRootList(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Type</FONT></FONT><FONT size=2> aType, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> strFilter, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> strSort, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> pageSize, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> pageIndex, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>params</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2>[] parameters)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IList</FONT></FONT><FONT size=2>)aType.InvokeMember(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"GetEditableRootList"</FONT></FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.FlattenHierarchy | </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.Public | </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.Static | </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BindingFlags</FONT></FONT><FONT size=2>.InvokeMethod, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>,</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2>[] { strFilter, strSort, pageSize, pageIndex, parameters});</P>
<P>}</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
