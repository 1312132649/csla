<html><header><title>Issue binding datagrid with BindingSourceHelper/BindingSourceNode</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Issue binding datagrid with BindingSourceHelper/BindingSourceNode</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6307.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sroberts posted on Monday, February 02, 2009</h2>Previously to the new CSLA Binding Source Helper object I was using the <font color="#006400" size="1" face="Courier New">Public Sub UnbindBindingSource(ByVal source As BindingSource, ByVal apply As Boolean, ByVal isRoot As Boolean)</font> way of doing unbinding prior to a save/cancel etc.<br><br>I decided to switch to using the new helper objects to generally make the code easier (and to embrace the change) but my form has now lost binding on a DataGridView and I can't work out why.<br><br>Let me explain...<br><br>I have a parent Quotation class (BusinessBase) that contains a managed property QuotationItems (BusinessListBase) this child class in turn is a collection of QuotationItem (BusinessBase)class objects. I use lazy loading of the QuotationItems property, so far so good...<br><br>I have a Windows Form where the text/combobox controls are bound to the Quotation class and a DataGridView which is bound to the QuotationItems class, both via a standard BindingSource control.<br><br>In code I use the CSLA BindingSourceNode and BindingSourceHelper objects to do my binding and Save, Cancel functionality.<br><br>When the form loads, the text/combobox fields bind to the Quotation object just fine, however the datagrid is blank. I've put a break point on the Child_Fetch of the child object and can see that being called and the object being populated.<br><br>So I'm not sure if I've missed something I have to do with the BindingSourceNode/Helper concerning the loading/binding of child objects. The CSLA binding source helper objects must be working to some extent as I have binding of the parent.<br><br>Below, I've posted some simplified code of what I'm doing behind the scenes.<br><br>(mQuotation is a local object reference that gets initialised during the form's New creator)<br><br><font color="#006400" size="1" face="Courier New">Private WithEvents mQuotation As Quotation = Nothing<br></font><font color="#006400" size="1" face="Courier New">Private mCSLA_BindingSourceNode As Csla.Windows.BindingSourceNode<br><br>Public Sub New(QuotationID As Integer)<br><br>&nbsp;&nbsp; mQuotation = Quotation.GetQuotation(QuotationID)<br>&nbsp;&nbsp; BindUI()<br><br>End Sub<br><br>Private Sub BindUI()<br><br>&nbsp;&nbsp; mCSLA_BindingSourceNode = Csla.Windows.BindingSourceHelper.InitializeBindingSourceTree(Me.components, bsQuotation)<br>&nbsp;&nbsp; mCSLA_BindingSourceNode.Bind(mQuotation)<br><br>End Sub</font><font size="1" face="Courier New"><font color="#006400"><br><br>public sub cmdSave () Handles cmdSave.Click<br><br></font></font><font size="1" face="Courier New"><font color="#006400">&nbsp;&nbsp; mCSLA_BindingSourceNode.Apply()<br>&nbsp;&nbsp; mQuotation = mQuotation.Save<br>&nbsp;&nbsp; BindUI()<br><br>End Sub<br><br></font><br></font>Any help would be much appreciated.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sroberts replied on Monday, February 02, 2009</h2>I just tried revising my BindUI() code to the following;<br><br><font color="#006400" size="1" face="Courier New">Private Sub BindUI()<br><br>&nbsp;&nbsp; mCSLA_BindingSourceNode = Csla.Windows.BindingSourceHelper.InitializeBindingSourceTree(Me.components, bsQuotation)<br>&nbsp;&nbsp; mCSLA_BindingSourceNode.Bind(mQuotation)<br></font><font color="#ff1493" size="1" face="Courier New">&nbsp;&nbsp; mCSLA_BindingSourceNode.Bind(mQuotation.QuotationItems)</font><br><br><font color="#006400" size="1" face="Courier New">End Sub</font><font size="1" face="Courier New"><font color="#006400"><br></font></font><br>In the hope that my error is due to not explicitly asking the helper object to bind the child collection, but this just produces a runtime error 'BeginEdit is not valid on a child object'<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sroberts replied on Tuesday, February 03, 2009</h2>Does anyone use the CSLA BindingSourceHelper / BindingSourceNode objects ?<br><br>It's looking like I have to go back to the long winded way of de-coupling my UI from the objects prior to a save/cancel operation as I just can't get my child object binding on the DataGridView using the above.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Tuesday, February 03, 2009</h2>Hi,<br><br>Does the "child" BindingSource point to the "parent" BindingSource ?<br><br>That is, bsQuotationItems.DataSource must be bsQuotation, and bsQuotationItems.DataMember must be the child property of the parent, in your case "QuotationItems". You should be able to set this at design time assuming both BindingSource are created at design time.<br><br>Hope this helps.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sroberts replied on Tuesday, February 03, 2009</h2><font size="2" face="Arial">Luc,<br><br>That solved the problem, thank you very much for your post.<br><br><b>bsQuotationItems.DataSource</b> was referencing the base child class in the my object hierachy (probably from when I initially created the binding source and linked it to the class containing the data for it) and I had never seen a reason to set the DataMember property so this was blank.<br><br>As soon as I set the DataSource on <b>bsQuotationItems </b>to point at <b>bsQuotation</b>, I then had a dropdown available on DataMember that of course contained a single choice of <b>QuotationItems </b> (this being the public property Getter on the parent class)</font><font size="2" face="Arial"><br><br>I'm so happy that this now works and my code can use the CSLA BindingSourceHelper and BindingSourceNode helper objects as these remove the need to use and manual edit state handling and de-coupling code to detach form based binding sources from their business objects.<br><br>Also hopefully this post will help others in a similar situation.</font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
