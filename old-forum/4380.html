<html><header><title>LoadProperty after Insert issue</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LoadProperty after Insert issue</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4380.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DaseinFiasco posted on Wednesday, February 20, 2008</h2>Greetings,<br><br>I'm having an issue with Csla 3.0 during database inserts when I try to return and assign a new primary key. Here're the relevant portions code I'm using:<br><br>First, from DataPortal_Insert():<br><br>int? id = null;<br>ctx.DataContext.AddMyObject(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadProperty&lt;string&gt;( NameProperty ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadProperty&lt;string&gt;( AddressProperty ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadProperty&lt;string&gt;( CityProperty ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadProperty&lt;string&gt;( StateProperty ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadProperty&lt;string&gt;( PostalCodeProperty ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ref id );<br><br>When that code executes, the id variable returns with a correct value coresponding to the new PK in the database. Now I want to immediately assign that value to the object's id field like so (I've tried both):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty&lt;int&gt;( IdProperty, id.GetValueOrDefault( 0 ) );<br>or<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;int&gt;( IdProperty, id.GetValueOrDefault( 0 ) );<br><br>For what it's worth, here's the field declaration itself:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;int&gt; IdProperty = RegisterProperty&lt;int&gt;( typeof( MyObject), new PropertyInfo&lt;int&gt;( "Id" ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [System.ComponentModel.DataObjectField( true, true )]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Id<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;int&gt;( IdProperty ); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>The problem is that within the application which is invoking .Save() on MyObject, the .Id property remains unset. Interestingly enough, during the DataPortal_Insert() method, I can add a watch to "this.Id" and it's set correctly. Only having returned to the application does the .Id property show up as its default value of 0. Any ideas?<br><br>Thanks,<br><br>.t.<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, February 20, 2008</h2><P>This is the number one problem people have when coding CSLA.</P>
<P>In the UI code you probably have this:</P>
<P>myBO.Save</P>
<P>You need to have this (at a minimum):</P>
<P>myBO = myBO.Save</P>
<P>By updating the reference, you will see the correct value back in the UI.</P>
<P>Remember CSLA returns a new object to the UI.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DaseinFiasco replied on Wednesday, February 20, 2008</h2>The number one problem? I'm sure people interpret it in all sorts of interesting ways. :) It's pretty mysterious until you realize just how stupid you are. In any case, thanks for the explanation; references are in good shape now and code is working!<br><br>.t.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
