<html><header><title>DataGridView Binding Problems</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataGridView Binding Problems</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1114.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MartinMason posted on Monday, September 04, 2006</h2><P>We have what I would think would be a simple problem but I can't find a discussion on the topic anywhere.&nbsp; On our form, we have an editable child collection that is bound to a DataGridView that allows additions and modifications within the grid.&nbsp; One of the child properties is a quantity field that we would like to return a double.&nbsp; With the attribute as a double, the following error is returned when changing the attribute value in the grid.</P>
<P>The following exception occurred in the DataGridView:</P>
<P>System.InvalidCastException: Unable to cast object of type 'system.Double' to type 'System.String'.</P>
<P>&nbsp;&nbsp; at System.ComponentModel.ReflectPropertyDescriptor.SetValue(Object component, Object value) ....</P>
<P>Changing the attribute to return a string instead of a double resolves the problem so we have a work around.&nbsp; Using the BindingSourceRefresh control did not resolve the problem either.<CODE></P></CODE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 05, 2006</h2>I've used properties that return Double before with no problem. Can you walk through in the debugger to find the issue? Or look at the stack trace for the exception? My guess is that the exception is occuring in some code you don't realize is running, and which obviously is expecting a string rather than a double.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MartinMason replied on Tuesday, September 05, 2006</h2><P>Found the line that caused the problem but still don't understand what's happening.&nbsp; Here's the property definition:</P><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Double</FONT></FONT><FONT size=2><FONT face="Courier New"> quantity{</FONT></P></FONT><FONT size=2>
<P></FONT><FONT face="Courier New" color=#0000ff size=2>&nbsp;&nbsp;&nbsp;set</FONT><FONT size=2><FONT face="Courier New">{</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanWriteProperty(</FONT></FONT><FONT face="Courier New" color=#0000ff size=2>true</FONT><FONT size=2><FONT face="Courier New">);</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (_quantity != </FONT><FONT color=#0000ff size=2>value</FONT></FONT><FONT size=2><FONT face="Courier New">){</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_quantity = </FONT></FONT><FONT face="Courier New" color=#0000ff size=2>value</FONT><FONT size=2><FONT face="Courier New">;</FONT></P>
<P></FONT><FONT color=#008000 size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<STRONG>PropertyHasChanged();</STRONG></FONT></P></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT face="Courier New">}</FONT></P>
<P><FONT face="Courier New">Removing the call to PropertyHasChanged resolved the problem as well.&nbsp; Any ideas?</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 05, 2006</h2>PropertyHasChanged() triggers several activities as discussed in Chapters 3 and 7. Most notably, it triggers all your validation rule methods, so one of those could be the problem, and it raises the PropertyChanged event, so any event handler of that property could be the problem.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MartinMason replied on Tuesday, September 05, 2006</h2><P>ID10T error.&nbsp; </P>
<P>ValidationRules.AddRules(CommonRules.StringRequired, "quantity"); was the problem.&nbsp; </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
