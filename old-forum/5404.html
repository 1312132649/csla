<html><header><title>CSLA 3.5.1 and Byte[]</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.5.1 and Byte[]</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5404.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ctallos posted on Monday, September 15, 2008</h2><P>Well I have enjoyed tremendously using CSLA for building the many applications I have worked on and now I am building a whole new app using CSLA 3.5.1, VS08 and CodeSmith.&nbsp; But I can't for the life of me figure out why this does not work.</P>
<P>I have an IMAGE field in SQL and am simply trying to pull it from my Fetch method using this but it does not seem to work. I get all sorts of syntax errors,&nbsp;anyone have any insight into pulling an image from SQL using 3.5.1?</P><FONT size=2>
<P>LoadProperty&lt;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>byte</FONT></FONT><FONT size=2>[], </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>byte</FONT></FONT><FONT size=2>[]?&gt;(ImageProperty, data.Image);</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, September 15, 2008</h2><P>Have not had time to try the new stuff.</P>
<P>But I pull out images from SQL Server all the time.</P>
<P>I use code like this to define the Property and field:</P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> mImage </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Byte</FONT></FONT><FONT size=2>() = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Nothing</FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Property</FONT></FONT><FONT size=2> Image() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Byte</FONT></FONT><FONT size=2>()<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Get<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Return</FONT></FONT><FONT size=2>&nbsp;mImage<BR></FONT><FONT size=2>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Get</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Set</FONT></FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> Value </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Byte</FONT></FONT><FONT size=2>())<BR>&nbsp;&nbsp;&nbsp; mImage= Value<BR>&nbsp;&nbsp;&nbsp; PropertyHasChanged(</FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>"Image"</FONT></FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Set<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Property</FONT></FONT></P>
<P></FONT></FONT>I use code like this in Fetch:</P><FONT size=2>
<P>mImage = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CType</FONT></FONT><FONT size=2>(dr.Item(</FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>"image"</FONT></FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Byte</FONT></FONT><FONT size=2>())</P>
<P></P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Tuesday, September 16, 2008</h2><P>Try this:</P>
<P>&nbsp;LoadProperty&lt;<FONT color=#0000ff><FONT color=#0000ff>byte</FONT></FONT>[], <FONT color=#0000ff><FONT color=#0000ff>byte?</FONT></FONT>[]&gt;(ImageProperty, data.Image);</P>
<P>ie: move the question mark to before the square brackets.</P>
<P>Regards,</P>
<P>Patrick</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ctallos replied on Wednesday, October 08, 2008</h2><P>I did try that.&nbsp; I think the key here is I am using LINQ as well and so the specific error I am getting is cannot convert from 'System.Data.Linq.Binary' to 'byte?.&nbsp; Any more ideas on how to make this work?</P>
<P>&nbsp;</P>
<P>**************** Problem Resolved ****************** </P>
<P>I resolved the problem.&nbsp; Frank Wang has a good explanation of how to tell LINQ to use System.Byte[] due to serialization issues.&nbsp; <A href="http://geekswithblogs.net/frankw/Default.aspx">http://geekswithblogs.net/frankw/Default.aspx</A>&nbsp;after following his step then I simply changed the LoadProperty line to:</P>
<P>LoadProperty&lt;<FONT color=#0000ff><FONT color=#0000ff>byte</FONT></FONT>[]&gt;(StudentImageProperty, data.StudentImage);</P>
<P>It works for now.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Philip replied on Wednesday, October 08, 2008</h2><P>Here how I do it (I amusing a stored procedure here to return data). Here the Image field is a Byte array.</P>
<P>&nbsp;Private Overloads Sub DataPortal_Fetch(ByVal criteria As SingleCriteria(Of BLPhotoAlbum, System.Int32))</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using ctx = ContextManager(Of ProjectTrackerDataContext).GetManager("ProjectTracker")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim data = ctx.DataContext.spSelectPhotoAlbum(criteria.Value).Single()</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(Of System.Int32)(_ImageId, data.ImageId)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(Of System.String)(_Description, data.Description)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If data.Image IsNot Nothing Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _Image = data.Image.ToArray()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
