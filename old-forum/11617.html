<html><header><title>Asynchronous call previously hooked into BeginSave in Silverlight - CSLA 4.5</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Asynchronous call previously hooked into BeginSave in Silverlight - CSLA 4.5</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11617.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Wednesday, October 03, 2012</h2><p>I am basically doing my first tinkering with await and async, so I may have this incorrect.</p>
<p>Here&#39;s an example of something I need to refactor on the Silverlight side.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override void BeginSave(bool forceUpdate, EventHandler&lt;Csla.Core.SavedEventArgs&gt; handler, object userState)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Need to update the lock status before we try to save.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RefreshLockStatus((o, e) =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (BusinessRules.GetBrokenRules().GetFirstBrokenRule(IsLockedProperty.Name) != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new CompanyException(Properties.BusinessRules.CannotSaveDueToLock);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.BeginSave(forceUpdate, handler, userState);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Basically, we look to refresh the locked status of the record before initiating the save process such that the user can basically be given a broken rule message prior to the actual save initiating.&nbsp;</p>
<p>I&#39;m not sure that there is an easy mechanism to solve this now, is there?</p>
<p>I have refactored RefreshLockStatus to RefreshLockStatusAsync (is async).&nbsp; My inclination was to plug into SaveAsync, but &quot;await RefreshLockStatusAsync&quot; is not correct syntax since the method itself isn&#39;t async.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override System.Threading.Tasks.Task&lt;CompanyObjectType&gt; SaveAsync(bool forceUpdate, object userState, bool isSync)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; await RefreshLockStatusAsync();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Check the impact of the refresh lock and do stuff.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return base.SaveAsync(forceUpdate, userState, isSync);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Is it something trivial I am missing?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, October 03, 2012</h2><p>Looks like this ends up compiling - once my project fully compiles I guess I will find out if this actually works.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected <strong>async</strong> override System.Threading.Tasks.Task&lt;CompanyObjectType&gt; SaveAsync(bool forceUpdate, object userState, bool isSync)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; await RefreshLockStatusAsync();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; // Do stuff.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return <strong>await</strong> base.SaveAsync(forceUpdate, userState, isSync);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 03, 2012</h2><p>Yes, this should be correct. Because SaveAsync is designed to return Task&lt;T&gt;, it can be marked with the async keyword (and the base class implementation is marked that way).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
