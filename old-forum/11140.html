<html><header><title>CslaDataSource with DataPortalResult Async list methods</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataSource with DataPortalResult Async list methods</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11140.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jamie.clayton posted on Thursday, February 09, 2012</h2><p>I&#39;ve got an application with multiple UI&#39;s connected.&nbsp; I&#39;ve just been through an exercise to upgrade all the List methods to include Asycn for retrieving lists for ViewModels in WPF.</p>
<p><b>VB Example</b></p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;Asynchronous&nbsp;retrieval&nbsp;of&nbsp;all&nbsp;the&nbsp;software&nbsp;in&nbsp;the&nbsp;system.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;handler&quot;</span><span style="color:gray;">&gt;&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;remarks&gt;</span><span style="color:green;">Designed&nbsp;for&nbsp;use&nbsp;with&nbsp;ViewModels(of&nbsp;CSLA.BusinessObject)</span><span style="color:gray;">&lt;/remarks&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Public</span>&nbsp;<span style="color:blue;">Shared</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;GetAllAsync(<span style="color:blue;">ByVal</span>&nbsp;handler&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:#2b91af;">EventHandler</span>(<span style="color:blue;">Of</span>&nbsp;<span style="color:#2b91af;">DataPortalResult</span>(<span style="color:blue;">Of</span>&nbsp;<span style="color:#2b91af;">SoftwareList</span>)))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;dp&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">New</span>&nbsp;<span style="color:#2b91af;">DataPortal</span>(<span style="color:blue;">Of</span>&nbsp;<span style="color:#2b91af;">SoftwareList</span>)()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">AddHandler</span>&nbsp;dp.FetchCompleted,&nbsp;handler
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp.BeginFetch(<span style="color:blue;">New</span>&nbsp;<span style="color:#2b91af;">SoftwareCriteria</span>())
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span></pre>
<p><b>WPF View Model</b></p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;"><span style="color:blue;">Namespace</span>&nbsp;ViewModels
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Public</span>&nbsp;<span style="color:blue;">Class</span>&nbsp;<span style="color:#2b91af;">SoftwareListViewModel</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Inherits</span>&nbsp;Csla.Wpf.<span style="color:#2b91af;">ViewModel</span>(<span style="color:blue;">Of</span> VIP.BL.<span style="color:#2b91af;">SoftwareList</span>)
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Shared</span>&nbsp;<span style="color:blue;">ReadOnly</span>&nbsp;logger&nbsp;<span style="color:blue;">As</span>&nbsp;NLog.<span style="color:#2b91af;">Logger</span>&nbsp;=&nbsp;NLog.<span style="color:#2b91af;">LogManager</span>.GetCurrentClassLogger()
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Sub</span>&nbsp;<span style="color:blue;">New</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">MyBase</span>.New()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">If</span>&nbsp;System.ComponentModel.<span style="color:#2b91af;">DesignerProperties</span>.GetIsInDesignMode(<span style="color:blue;">Me</span>)&nbsp;<span style="color:blue;">Then</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Return</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">If</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadAsync()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;Report&nbsp;any&nbsp;ansync&nbsp;errors&nbsp;back&nbsp;to&nbsp;the&nbsp;user.&nbsp;Provides&nbsp;a&nbsp;full&nbsp;path&nbsp;of&nbsp;the&nbsp;issue&nbsp;to&nbsp;user/logging&nbsp;mechanism.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;sender&quot;</span><span style="color:gray;">&gt;&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;e&quot;</span><span style="color:gray;">&gt;&lt;/param&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&#39;&#39;&nbsp;</span><span style="color:gray;">&lt;remarks&gt;</span><span style="color:green;">Improvement&nbsp;over&nbsp;constructor&nbsp;based&nbsp;lamba&nbsp;method,&nbsp;as&nbsp;we&nbsp;can&nbsp;report&nbsp;explicit&nbsp;code&nbsp;location&nbsp;back&nbsp;to&nbsp;the&nbsp;user/logger.</span><span style="color:gray;">&lt;/remarks&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;Property_Changed(sender&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>,&nbsp;e&nbsp;<span style="color:blue;">As</span>&nbsp;System.ComponentModel.<span style="color:#2b91af;">PropertyChangedEventArgs</span>)&nbsp;<span style="color:blue;">Handles</span>&nbsp;<span style="color:blue;">Me</span>.PropertyChanged
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">If</span>&nbsp;e.PropertyName&nbsp;=&nbsp;<span style="color:#a31515;">&quot;Error&quot;</span>&nbsp;<span style="color:blue;">AndAlso</span>&nbsp;[Error]&nbsp;<span style="color:blue;">IsNot</span>&nbsp;<span style="color:blue;">Nothing</span>&nbsp;<span style="color:blue;">Then</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Const</span>&nbsp;cVIEWMODEL_ERROR&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">String</span>&nbsp;=&nbsp;<span style="color:#a31515;">&quot;{0}&nbsp;error:&nbsp;{1}&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Const</span>&nbsp;cVIEWMODEL_ERROR_TITLE&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">String</span>&nbsp;=&nbsp;<span style="color:#a31515;">&quot;Data&nbsp;error&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;Current&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:#2b91af;">StackFrame</span>&nbsp;=&nbsp;<span style="color:blue;">New</span>&nbsp;<span style="color:#2b91af;">StackFrame</span>(0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;stackPath&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">String</span>&nbsp;=&nbsp;<span style="color:blue;">String</span>.Format(<span style="color:#a31515;">&quot;{0}.{1}&quot;</span>,&nbsp;Current.GetMethod().ReflectedType.FullName,&nbsp;Current.GetMethod().Name)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;message&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">String</span>&nbsp;=&nbsp;<span style="color:blue;">String</span>.Format(cVIEWMODEL_ERROR,&nbsp;stackPath,&nbsp;[Error].Message)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.ErrorException(message,&nbsp;[Error])
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">MessageBox</span>.Show(message,&nbsp;cVIEWMODEL_ERROR_TITLE,&nbsp;<span style="color:#2b91af;">MessageBoxButton</span>.OK)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">If</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;Load()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;Fine&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;populate&nbsp;a&nbsp;async&nbsp;list,&nbsp;but&nbsp;it&nbsp;you&nbsp;then&nbsp;want&nbsp;to&nbsp;bind&nbsp;a&nbsp;value&nbsp;in&nbsp;that&nbsp;list&nbsp;we&nbsp;really&nbsp;want&nbsp;to&nbsp;know</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;When&nbsp;the&nbsp;list&nbsp;is&nbsp;populated&nbsp;and&nbsp;then&nbsp;we&nbsp;want&nbsp;to&nbsp;select&nbsp;an&nbsp;item&nbsp;in&nbsp;that&nbsp;list.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;LL:&nbsp;For&nbsp;a&nbsp;simple&nbsp;UI&nbsp;behaviour,&nbsp;this&nbsp;seems&nbsp;a&nbsp;little&nbsp;more&nbsp;complex&nbsp;than&nbsp;expected.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;parameters&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>()&nbsp;=&nbsp;PopulateBoMethodParameters()
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;DoRefresh(&quot;GetAll&quot;,&nbsp;parameters)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoRefresh(<span style="color:#a31515;">&quot;GetAll&quot;</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;LoadAsync()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;Fine&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;populate&nbsp;a&nbsp;async&nbsp;list,&nbsp;but&nbsp;it&nbsp;you&nbsp;then&nbsp;want&nbsp;to&nbsp;bind&nbsp;a&nbsp;value&nbsp;in&nbsp;that&nbsp;list&nbsp;we&nbsp;really&nbsp;want&nbsp;to&nbsp;know</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;When&nbsp;the&nbsp;list&nbsp;is&nbsp;populated&nbsp;and&nbsp;then&nbsp;we&nbsp;want&nbsp;to&nbsp;select&nbsp;an&nbsp;item&nbsp;in&nbsp;that&nbsp;list.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;&nbsp;&nbsp;&nbsp;LL:&nbsp;For&nbsp;a&nbsp;simple&nbsp;UI&nbsp;behaviour,&nbsp;this&nbsp;seems&nbsp;a&nbsp;little&nbsp;more&nbsp;complex&nbsp;than&nbsp;expected.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;parameters&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>()&nbsp;=&nbsp;PopulateBoMethodParameters()
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;BeginRefresh(&quot;GetAll&quot;,&nbsp;parameters)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginRefresh(<span style="color:#a31515;">&quot;GetAllAsyncWithAllEntry&quot;</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Shared</span>&nbsp;<span style="color:blue;">Function</span>&nbsp;PopulateBoMethodParameters()&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Dim</span>&nbsp;parameters(0)&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;parameters(0)&nbsp;=&nbsp;Application.Globals.UserID</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">&#39;Return&nbsp;parameters</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Return</span>&nbsp;<span style="color:blue;">Nothing</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Function</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Class</span>
<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Namespace</span></pre>
<p><b>WPF Form XAML &amp; Code</b></p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">CollectionViewSource</span><span style="color:red;">&nbsp;x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SoftwareListVM_Source&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;d</span><span style="color:blue;">:</span><span style="color:red;">DesignSource</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">d</span><span style="color:blue;">:</span><span style="color:#a31515;">DesignInstance</span><span style="color:red;">&nbsp;vm</span><span style="color:blue;">:</span><span style="color:red;">SoftwareListViewModel</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;CreateList</span><span style="color:blue;">=</span><span style="color:blue;">True</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><span style="color:blue;">&nbsp;/&gt;</span>
<span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;">&lt;</span><span style="color:#a31515;">CollectionViewSource</span><span style="color:red;">&nbsp;x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SoftwareListModelSource&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;Source</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Path</span><span style="color:blue;">=</span><span style="color:blue;">Model</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;Source</span><span style="color:blue;">={</span><span style="color:#a31515;">StaticResource</span><span style="color:red;">&nbsp;SoftwareListVM_Source</span><span style="color:blue;">}}</span><span style="color:blue;">&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">Public</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;LoadSoftwareList()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PopulateCollectionView(<span style="color:#a31515;">&quot;SoftwareListVM_Source&quot;</span>,&nbsp;<span style="color:blue;">New</span>&nbsp;ViewModels.<span style="color:#2b91af;">SoftwareListViewModel</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span></pre>
<p>The performance improvement for the WPF forms that are drop down list heavy is fantastic! So now I&#39;m trying to get my head around doing this on web pages that use CSLADataSource.</p>
<p><b>ASPX example</b></p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;"><span style="color:blue;">&lt;</span><span style="color:maroon;">csla</span><span style="color:blue;">:</span><span style="color:maroon;">CslaDataSource</span>&nbsp;<span style="color:red;">ID</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SoftwareCslaDataSource&quot;</span>&nbsp;<span style="color:red;">runat</span><span style="color:blue;">=</span><span style="color:blue;">&quot;server&quot;</span>&nbsp;<span style="color:red;">TypeName</span><span style="color:blue;">=</span><span style="color:blue;">&quot;VIP.BL.SoftwareList, VIP.BL&quot;</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;/</span><span style="color:maroon;">csla</span><span style="color:blue;">:</span><span style="color:maroon;">CslaDataSource</span><span style="color:blue;">&gt;</span></pre>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Private</span>&nbsp;<span style="color:blue;">Sub</span>&nbsp;SoftwareCslaDataSource_SelectObject(<span style="color:blue;">ByVal</span>&nbsp;sender&nbsp;<span style="color:blue;">As</span>&nbsp;<span style="color:blue;">Object</span>,&nbsp;<span style="color:blue;">ByVal</span>&nbsp;e&nbsp;<span style="color:blue;">As</span>&nbsp;Csla.Web.<span style="color:#2b91af;">SelectObjectArgs</span>)&nbsp;<span style="color:blue;">Handles</span>&nbsp;SoftwareCslaDataSource.SelectObject
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">If</span>&nbsp;<span style="color:blue;">Me</span>.rptlstSoftware.Visible&nbsp;<span style="color:blue;">Then</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.BusinessObject&nbsp;= VIP.BL.<span style="color:#2b91af;">SoftwareList</span>.GetAll()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">Else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.BusinessObject&nbsp;=&nbsp;<span style="color:blue;">Nothing</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">If</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">End</span>&nbsp;<span style="color:blue;">Sub</span></pre>
<p>Can any one tell me how I can load the CslaDataSource on the web page Asynchronously. I can&#39;t seem to find an example or an obvious method to complete this.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 09, 2012</h2><p>You can&#39;t use the async data portal in ASP.NET.</p>
<p>There are numerous reasons this is problematic, mostly having to do with the way ASP.NET itself is designed to work and use threads.</p>
<p>This may change in .NET 4.5 with the new async/await keywords, because they allow your code to function as though it were <em>synchronous</em>, even though behind the scenes it does asynchronous work.</p>
<p>Even then however, using async will probably cause worse performance on a web server than the simpler sync counterparts.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jamie.clayton replied on Thursday, February 09, 2012</h2><p>Thanks for the quick reply Rocky.</p>
<p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>You can&#39;t use the async data portal in ASP.NET.</div></p>
<p>This is good to know.</p>
<p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b> however, using async will probably cause worse performance on a web server than the simpler sync counterparts</div></p>
<p>In my case I have a report criteria web page that includes every list in a database as potential report criteria.&nbsp; So I&#39;m loading 14 lists synchronously.One of these lists alone take 5 seconds to load, so I&#39;m close to that 6 second web standard before users get frustrated.&nbsp; </p>
<p>Essentially I&#39;m looking at trying to apply the &quot;animated loading circle&quot; UX approach from WPF to ASPX. Since the Async data portal is not practical, I thought I might need to go down a <a title="PageAsyncTask" href="http://msdn.microsoft.com/en-us/library/system.web.ui.pageasynctask.aspx#Y1007">PageAsyncTask</a> or an <a title="jquery" href="http://stackoverflow.com/questions/4523769/passing-a-list-of-ints-to-webmethod-using-jquery-and-ajax">jQuery</a> path. Does anyone have any recommendations on a good technology match for this scenario?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 09, 2012</h2><p>I can provide a more &quot;robust&quot; answer that might help you :)</p>
<p>It <em>is possible </em>to use the async data portal in ASP.NET if you fully understand the ramifications.</p>
<p>First, you must understand how ASP.NET uses threads so you don&#39;t starve the server of threads. I won&#39;t cover the details here - it is a well known reality that ASP.NET uses the thread pool, as does the data portal (and many other async technologies), so they compete for that pool of threads. Take up too many, and inbound web requests from other users can be blocked waiting for a thread to become available.</p>
<p>Second, you must understand how ASP.NET renders pages. It expects to run on one thread, and when that thread completes the request is done - even if there are outstanding &quot;background&quot; threads running. Those threads just complete and the results of their work is lost. So you must <em>ensure</em> that you implement proper thread synchronization code to block the main request thread from completing until you know that all background threads are complete. This is probably done with ManualReset or other thread synchronization objects from System.Threading.</p>
<p>If you understand those two points, it is absolutely possible to fire off multiple async data portal requests as part of your page processing, and they will run on background threads (from the thread pool) to interact with your data access code. When each async request completes, the callback for that request will run, just like it does in a smart client setting.</p>
<p>What I don&#39;t know, is on what thread the callback will run. The data portal relies on a .NET synchronization context to get the callback to run on the &quot;UI thread&quot; in Windows Forms, WPF, Silverlight, etc. I <em>think</em> that ASP.NET has a synchronization context too, but I&#39;m not sure.</p>
<p>If ASP.NET does NOT have a synchronization context, the callback code will run on the background thread. That&#39;s probably good, because your callback handler can signal a threading primitive so the main request thread knows the task is complete. You&#39;d probably have a threading primitive for each data portal call, so you can do a WaitAll on all those primitives to block the primary thread until they are done.</p>
<p>If ASP.NET does have a synchronization context, the callback code will run on the primary request thread. This would be more complex, because it means you can&#39;t block that thread with a simple WaitAll or Wait. If you do block the primary thread, it could never run to handle the callback. In this case you&#39;d need to implement something called a SpinWait (I don&#39;t know if .NET includes one of these in System.Threading?) so the thread just spins idle while waiting for the background tasks to complete. Implementing a SpinWait is a little tricky, because you obviously don&#39;t want the primary thread to chew up 100% CPU while spinning and polling the background task completion flags...</p>
<p>In any case, you must ensure that the primary thread doesn&#39;t complete and render the output until all the background tasks are complete.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, February 09, 2012</h2><p>ASP.NET has it&#39;s own <strong>AspNetSynchronizationContext:</strong></p>
<p><a href="http://msdn.microsoft.com/en-us/magazine/gg598924.aspx">http://msdn.microsoft.com/en-us/magazine/gg598924.aspx</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 09, 2012</h2><p>I kind of suspected that was the case Jonny. That tends to make things a little more complex due to the spinwait requirement.</p>
<p>But if there&#39;s a good spinwait implementation this should work fine.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rcollette replied on Friday, February 10, 2012</h2><p>Rocky, </p>
<p>Is it possible to write BO code in a manner that makes it possible to run in the Silverlight/Metro clients as well as on IIS without having to write two separate sets of logic due to threading requirements?&nbsp;&nbsp; If so, do your latest books/videos provide an example of that?</p>
<p>The impression I got, coming out of the 2008 book was that running my BOs with CSLA.NET Silverlight was more of file linking and recompile exercise but now as I look at some of the Silverlight examples, it appears that the code is written differently.&nbsp;&nbsp; Maybe I&#39;m missing something because I haven&#39;t read any of the Silverlight books yet.</p>
<p>Thanks,</p>
<p>Rich</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, February 10, 2012</h2><p>The differences are not dramatic - at least not in most classes.</p>
<p>You are right to mention async - the primary code differences aren&#39;t SL vs .NET - they are sync vs async. </p>
<p>The other code difference area relates to platform capability (does ADO.NET exist on each platform?). This can be mitigated by using a encapsulated invocation with a DAL provider model, or factory implementation or invocation - all discussed in the <em>Using CSLA 4: Data Access</em> book.</p>
<p>SL/WP7/WinRT require async in some places. .NET does not.</p>
<p>.NET has ADO.NET, not all other platforms have it. WinRT will have data access, but it will be async (unlike all existing data access technologies).</p>
<p>What does this mean?</p>
<p>It means that any logic that talks to a server or database might have to vary between platforms.</p>
<p>(as an aside - there are a LOT of other differences between platforms, but CSLA is able to transparently abstract them for you - I&#39;m only talking about the differences we <em>can&#39;t</em> abstract)</p>
<p>In most business classes you need to use &quot;#if !SILVERLIGHT&quot; blocks to ensure that synchronous static factory methods, and DataPortal_XYZ methods, don&#39;t compile on SL/WP7. That&#39;s all, nothing else should be different.</p>
<p>The exception to this is if you have a business rule that needs to talk to a server/database. Like a rule that checks the database to see if a value already exists.</p>
<p>Such a rule would be implemented through the use of another business object (often a command object or read-only object). Where this gets a little tricky is that the rule needs to be an async rule on SL/WP7, it could be async or sync on Windows Forms or WPF, and it normally needs to be a sync rule in ASP.NET.</p>
<p>The <em>Using CSLA 4: Creating Business Objects</em> book discusses this specific scenario and shows how to implement such a rule to minimize the code differences between the sync/async scenarios. You end up with one set of code, with just&nbsp;an &quot;if (IsAsync)&quot; check so the rule works properly on client vs server.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
