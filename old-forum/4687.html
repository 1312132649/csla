<html><header><title>SmartDate Format Changed in CSLA 3.5</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SmartDate Format Changed in CSLA 3.5</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4687.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsargent posted on Monday, April 14, 2008</h2><font face="Verdana">I noticed that SmartDate formatting has changed slightly in CSLA 3.5. Is this intentional?<br><br>I execute the following code in both versions of CSLA and get the following output (assuming 10:00 am on April 14th):</font><br><blockquote><font face="Courier New"><b>Code</b><br>SmartDate dt = new SmartDate(DateTime.Now);</font><br><font face="Courier New">string SmartDateFormat = string.Format("{0}", dt);</font><br><font face="Courier New">string SmartDateToString = dt.ToString();</font><br><font face="Courier New">string SmartDateToStringNull = dt.ToString(null);</font><br><font face="Courier New">Trace.WriteLine(SmartDateFormat);<br>Trace.WriteLine(SmartDateToString);<br>Trace.WriteLine(SmartDateToStringNull);<br></font></blockquote><br><blockquote><font face="Courier New"><b>CSLA 3.0.x Output</b><br>4/14/2008<br>4/14/2008<br>4/14/2008 10:00:00 AM<br></font></blockquote><br><blockquote><font face="Courier New"><b>CSLA 3.5.0 Output</b><br>4/14/2008 10:00:00 AM<br>
4/14/2008<br>
4/14/2008 10:00:00 AM<br>
</font></blockquote><font face="Verdana">As you can see, dt.Format() and dt.Format(null) produce different output, but the output is </font><span>consistent</span><font face="Verdana"> from CSLA 3.0 to 3.5. <br><br>However, the default string format has changed to include the time in CSLA 3.5.<br><br>Any comments?<br><br>Thanks<br><br>Richard Sargent</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, April 14, 2008</h2><P>The default format string didn't change.</P>
<P>However, SmartDate in 3.5 has <EM>much</EM> richer support for the cast operation - it can convert itself to/from quite a number of types.</P>
<P>Notice that your first test uses a format string, but without specifying a format. Odds are that pre-3.5 the SmartDate was converted to a string (and thus formatted), but in 3.5 I bet that string.Format() is not converting it to a string (it may be converting it to a DateTime?) and so you are seeing the difference.</P>
<P>SmartDate in 3.5 is a much more complete replication of DateTime than the 3.0 version - especially in terms of type conversion.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsargent replied on Wednesday, April 16, 2008</h2><i><font face="Verdana">&gt;&gt; The default format string didn't change.</font></i><br><font face="Verdana">Sure it did. <br><br>If I have a string.Format("{0}", dt) in my code, the output will be different when I use CSLA 3.5 instead of CSLA 3.0. This is a change in the CSLA default behavior for SmartDate. This may not be a "breaking" change, but I will need to change my code to make the output the same across versions.<br><br><i>&gt;&gt; Notice that your first test uses a format string, but without
specifying a format. Odds are that pre-3.5 the SmartDate was converted
to a string (and thus formatted), but in 3.5 I bet that string.Format()
is not converting it to a string (it may be converting it to a
DateTime?) and so you are seeing the difference.<br></i><br>The difference appears to be the implementation of IFormattable.ToString.<br><br>When I call </font><font face="Verdana">string.Format("{0}", dt) in CSLA 3.0, the SmartDate object uses the SmartDate.ToString() method which returns SmartDate.Text.<br><br>In CSLA 3.5, </font><font face="Verdana">IFormattable.ToString is called with a null format. SmartDate now uses SmartDate.ToString(null), which produces a different result.<br><br>To be </font><span>consistent</span><font face="Verdana">, ToString() and ToString(null) should return the same string. <br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 16, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsargent:</strong></div><div><I><FONT face=Verdana>&gt;&gt; The default format string didn't change.</FONT></I><BR><FONT face=Verdana>Sure it did. <BR><BR>If I have a string.Format("{0}", dt) in my code, the output will be different when I use CSLA 3.5 instead of CSLA 3.0. This is a change in the CSLA default behavior for SmartDate. This may not be a "breaking" change, but I will need to change my code to make the output the same across versions.<BR><FONT face="Times New Roman"></div></BLOCKQUOTE></FONT></FONT></P>
<P><FONT face=Verdana><FONT face="Times New Roman">No, the default format string didn't change. Look at the code - you can see it is still the same.</FONT></FONT></P>
<P><FONT face=Verdana><FONT face="Times New Roman">The fact that the format string isn't <EM>used in this new scenario</EM> is not the same as saying the format string has changed...</FONT></FONT></P>
<P><FONT face=Verdana><FONT face="Times New Roman">My post wasn't denying that there was a change - I was speculating about how/why the change might have come to be - and obviously it isn't because the format string changed.</FONT></FONT></P>
<P><FONT face=Verdana><FONT face="Times New Roman"></FONT><BR><FONT face="Times New Roman"><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsargent:</strong></div><div></FONT><EM>&gt;&gt; Notice that your first test uses a format string, but without specifying a format. Odds are that pre-3.5 the SmartDate was converted to a string (and thus formatted), but in 3.5 I bet that string.Format() is not converting it to a string (it may be converting it to a DateTime?) and so you are seeing the difference.<BR></EM><BR>The difference appears to be the implementation of IFormattable.ToString.<BR><BR>When I call </FONT><FONT face=Verdana>string.Format("{0}", dt) in CSLA 3.0, the SmartDate object uses the SmartDate.ToString() method which returns SmartDate.Text.<BR><BR>In CSLA 3.5, </FONT><FONT face=Verdana>IFormattable.ToString is called with a null format. SmartDate now uses SmartDate.ToString(null), which produces a different result.<BR><BR>To be </FONT><SPAN>consistent</SPAN><FONT face=Verdana>, ToString() and ToString(null) should return the same string. <BR></FONT></div></BLOCKQUOTE></P>
<P>That is useful information, thank you. I think this is a bug in the implementation of ToString(string). I'll change the ToString(string) overload to check for a null format string, a change you'll see in 3.5.1.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsargent replied on Tuesday, May 06, 2008</h2>Thanks!<br><br>We just updated to Csla 3.5.1.0 and it works the same as 3.0.x.<br><br>Richard<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
