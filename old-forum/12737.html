<html><header><title>Issue with [Csla.Reflection.MethodCaller.GetParameterTypes(object[] parameters) (csla ver 3.8.4)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Issue with [Csla.Reflection.MethodCaller.GetParameterTypes(object[] parameters) (csla ver 3.8.4)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12737.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho posted on Saturday, August 30, 2014</h2><p>Hi everybody.</p>
<p>I&#39;m invoking public factory methods using Csla Reflection, and came across a particular case where</p>
<p><span style="COLOR:blue;"><span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:blue;">static</span>&nbsp;<span style="COLOR:blue;">object</span>&nbsp;CallFactoryMethod(<span style="COLOR:#2b91af;">Type</span>&nbsp;objectType,&nbsp;<span style="COLOR:blue;">string</span>&nbsp;method,&nbsp;<span style="COLOR:blue;">params</span>&nbsp;<span style="COLOR:blue;">object</span>[]&nbsp;parameters)<br />		{<br />&nbsp;&nbsp;<span style="COLOR:blue;">object</span>&nbsp;returnValue;<br />&nbsp; <span style="COLOR:#2b91af;">MethodInfo</span>&nbsp;factory&nbsp;=&nbsp;objectType.GetMethod(method,&nbsp;factoryFlags,&nbsp;<span style="COLOR:blue;">null</span>,&nbsp;</span><span style="COLOR:blue;">MethodCaller.GetParameterTypes(parameters),&nbsp;<span style="COLOR:blue;">null</span>);<br />&nbsp;<br />&nbsp;<span style="COLOR:blue;">if</span>&nbsp;(factory&nbsp;==&nbsp;<span style="COLOR:blue;">null</span>)<br />....</span>
<p>presents an issue when it calls [MethodCaller.GetParameterTypes(parameters)] and [<em>parameters</em>] is null.</p>
<p>When [GetParameterTypes(null) is executed, it adds [result.Add(<span style="COLOR:blue;">typeof</span>(<span style="COLOR:blue;">object</span>));] to the result [<em>type</em>] list.</p>
<p><span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:blue;">static</span>&nbsp;<span style="COLOR:#2b91af;">Type</span>[]&nbsp;GetParameterTypes(<span style="COLOR:blue;">object</span>[]&nbsp;parameters)<br />{<br />	<span style="COLOR:#2b91af;">List</span>&lt;<span style="COLOR:#2b91af;">Type</span>&gt;&nbsp;result&nbsp;=&nbsp;<span style="COLOR:blue;">new</span>&nbsp;<span style="COLOR:#2b91af;">List</span>&lt;<span style="COLOR:#2b91af;">Type</span>&gt;();<br /> <br />	<span style="COLOR:blue;">if</span>&nbsp;(parameters&nbsp;==&nbsp;<span style="COLOR:blue;">null</span>)<br />	{<br />		result.Add(<span style="COLOR:blue;">typeof</span>(<span style="COLOR:blue;">object</span>));<br />	}<br />	<span style="COLOR:blue;">else</span></p>
<p><span style="COLOR:blue;">
<p><span style="color:#000000;">I have a particular case where I define 2 public static methods on a class like this:</span></p>
<p><span style="color:#000000;">1. public static NewObject() {...}</span></p>
<p><span style="color:#000000;">2. public static NewObject(object obj} {...}</span></p>
</span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">By default, when I try to Invoke the 1st. method with no parameters, CallFactoryMethod(..) with [<em>null</em>] as params[], it&nbsp;defaults to the 2nd. version of the method, due to its default parameter added by </span><span style="color:#000000;">GetParameterTypes(..).</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">And it throws an exception because I&#39;m not sending the [object] parameter, instead, I&#39;m sending null as params.</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">I didn&#39;t get to check the implications of changing this behaviour on CSLA.</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">If anyone can suggest a simple workaround, it&#39;s welcome.</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">For now I&#39;ll use my own Reflection Functions to call on this factory methods for NewObject on my BOs.</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">Thanks to all,</span></span></p>
<p><span style="COLOR:blue;"><span style="color:#000000;">Troncho</span></span></p>
</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, September 05, 2014</h2><p>It has been a long time since I&#39;ve looked at that code, but it is complex to distinguish between no parameter, null parameter, and param arrays (which might be null or not). I do know there are some cases we just never figured out how to solve, and if you look at the data portal flow (for example) you&#39;ll see that we pass a second flag (or special value) to indicate the total absence of a parameter vs a null or empty param array.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Troncho replied on Friday, September 05, 2014</h2><p>Thanks for your answer Rocky. You are absolutely right about it. I&#39;ve just copied the code to an independant static method so I can get a parameterless constructor. The idea of an extra flag param is an excelent choice in thes cases.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
