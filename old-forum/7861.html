<html><header><title>Dynamic Validation Rules - possibly</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic Validation Rules - possibly</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7861.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>whelzer posted on Friday, October 23, 2009</h2>I would like to achieve the following: (vb 2008 , windows forms, 2 tier using, csla 3.6.2 but mostly 3.0.4 syntax!)<br><br>I've a root object (say Customer) bound to Customer screen,&nbsp; the data is held in tblCustomer.<br>I use a versioning/audit technique whereby each row in tblCustomer starts off with version 999 and in decrements each time an amedment (update) is made.&nbsp; The old version is put out to tblCustomerArc.<br><br>Under certain circumstances during DP_Fetch of Customer I would like to get the data from a previous version, compare it against the latest and somehow flag to the user the old value.&nbsp; I was thinking a slick way of achieving this would be to use a dynamic validation rules and set the severity to "Information" and the Description to the old value.&nbsp; Thus each changed textbox on the form would have a nice little info icon and hovering would give details of the previous value.&nbsp; I've no issue in getting the old data and comparing it to the new, its the creating and trigger of rules in this scenario that has me stumped.&nbsp; Any pointers or help much appreicated.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, October 23, 2009</h2><P>I've often thought that it would be nice to have a direct way to add a permanent Information 'broken rule' for a property. The kind of thing you'd do in DataPortal_Create() or DP_Fetch().</P>
<P>Maybe like this:</P>
<P>ValidationRules.AddInformationMessage(IPropertyInfo property, string text)</P>
<P>Or if we wanted to be able add/remove them:</P>
<P>ValidationRules.SetInformationMessage(IPropertyInfo property, string ruleName, string text)</P>
<P>Such a message would never auto-add or auto-remove as other rules run, but they'd be in the broken rules list and so would appear in the UI, etc.</P>
<P>Probably something that should go on the wish list - it seems like this is the kind of thing that'd make your scenario pretty easy.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>whelzer replied on Friday, October 23, 2009</h2>Sounds good.&nbsp; Any ideas for now?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, October 23, 2009</h2><P>In the meantime, the solution is to write a rule method and attach it to each of your properties. The trick is to provide that rule method with access to the comparison data, which can be accomplished by storing it as a NonSerialized field on your business class itself.</P>
<P>This is far from elegant, but something like this should work:</P>
<P>&nbsp; [Serializable]<BR>&nbsp; public class Test : BusinessBase&lt;Test&gt;<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; NameProperty = RegisterProperty&lt;string&gt;(c =&gt; c.Name);<BR>&nbsp;&nbsp;&nbsp; public string Name<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(NameProperty); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(NameProperty, value); }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; protected override void AddBusinessRules()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.AddBusinessRules();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule(InfoRule, NameProperty);<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; private static bool InfoRule(object target, Csla.Validation.RuleArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var obj = target as Test;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var comp = obj._comparisonData;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (obj != null &amp;&amp; comp != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Severity = Csla.Validation.RuleSeverity.Information;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (e.PropertyName)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case "Name":<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (obj.Name != comp.Name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Name is different";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; [NonSerialized]<BR>&nbsp;&nbsp;&nbsp; private Test _comparisonData;</P>
<P>&nbsp;&nbsp;&nbsp; private void DataPortal_Fetch(SingleCriteria&lt;Test, int&gt; criteria)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // load object data<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // load comparison data<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules();<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>whelzer replied on Friday, October 23, 2009</h2>Cool.&nbsp; Thanks for taking the time to post this.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
