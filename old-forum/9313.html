<html><header><title>Property/Method Authorizations are not quite dynamic enough</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Property/Method Authorizations are not quite dynamic enough</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9313.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash posted on Monday, August 02, 2010</h2><p>Rocky,</p>
<p>We are doing what is essentially a claims-based authorization scheme for object, object properties, and object methods.&nbsp; Specifically, for properties and methods, we want to allow/disallow access based upon the contents of the object. &nbsp;&nbsp; We have a set of authorization rules that determine the authorization permissions 
for one property based upon contents of other properties in the same 
object.&nbsp; This works just fine.&nbsp; We bring up an object and buttons, text boxes, and so on behave as desired.&nbsp; </p>
<p>The problem comes in those cases that we allow the user to change the contents of the object properties.&nbsp; We wanted to demonstrate to our client that the authorization changes when the contents of the object changes, but we ran into a problem.&nbsp; Csla caches the property and method authorization rules/results for each object.&nbsp; Under normal circumstances that increases performance, but it does get in the way of a cool demo. </p>
<p>Note, that if we exit the form and return, the authorization rules are applied properly.&nbsp; It is just when we are dynamically changing the object that we have a problem.&nbsp; It might be argued that the new rules should not be applied until the object is saved, but I would disagree.&nbsp; It might well be the case that the user is about to enter/change data that would make it impossible to change the object afterward; that would be a serious &quot;oops&quot;.</p>
<p>The only time that Csla resets the cache is when the application principal changes.&nbsp; This seems like a hold over from a role based authorization scheme and not in keeping with a claims-based approach.</p>
<p>What I would like is a means to either force the cache to clear, say, with a protected method.&nbsp; I would not need this capability for every class and perhaps not in all circumstances.&nbsp; </p>
<p>Could we look forward to such an addition?</p>
<p>Jon Stonecash</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, August 02, 2010</h2><p>Hi Jon,</p>
<p>See this discussion too: http://forums.lhotka.net/forums/t/9301.aspx?PageIndex=1 </p>
<p>However, for now at least, you can override CanWriteProperty, CanReadProperty and CanExecuteMethod like this to make it dynamic:</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">public</span>&nbsp;<span style="color:#cc7832;">override</span>&nbsp;<span style="color:#cc7832;">bool</span>&nbsp;CanWriteProperty(Csla.Core.<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;property)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#004000;">//&nbsp;must&nbsp;override&nbsp;so&nbsp;that&nbsp;authorization&nbsp;rules&nbsp;are&nbsp;not&nbsp;cached</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">return</span>&nbsp;<span style="color:#ffc66d;">BusinessRules</span>.HasPermission(<span style="color:#ffc66d;">AuthorizationActions</span>.WriteProperty,&nbsp;property);<br />&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">public</span>&nbsp;<span style="color:#cc7832;">override</span>&nbsp;<span style="color:#cc7832;">bool</span>&nbsp;CanReadProperty(Csla.Core.<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;property)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#004000;">//&nbsp;must&nbsp;override&nbsp;so&nbsp;that&nbsp;authorization&nbsp;rules&nbsp;are&nbsp;not&nbsp;cached</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">return</span>&nbsp;<span style="color:#ffc66d;">BusinessRules</span>.HasPermission(<span style="color:#ffc66d;">AuthorizationActions</span>.ReadProperty,&nbsp;property);<br />&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonStonecash replied on Monday, August 02, 2010</h2><p>Do I love this forum or what?&nbsp; Read the referenced post, agreed with the direction, but overrode the can read and can write properties, and all in time to do my demo in about 10 minutes.</p>
<p>Thanks.</p>
<p>Jon Stonecash</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
