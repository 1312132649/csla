<html><header><title>One to Many Parent, Child Relationship - coding basics</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>One to Many Parent, Child Relationship - coding basics</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8125.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>FCazabon posted on Thursday, December 10, 2009</h2>Hi,<br /><br />I am trying to learn CSLA.NET by creating a simple application and adapting what I have learned from the Expert C# 2008 Business Objects book.  I am not understanding how to create the Data Access side of an object, so I hope someone can explain it to me.<br /><br />My application is very simple Membership database.  A Member joins the club and her membership status can change as time passes.  I need to maintain the history of this membership.  The different types of membership are user defined.  So, my Database is a very simple three tables like this:<br /><br />1. Member (which has Id, Name and personal details)<br />2. Membership (which has a MemberId, MembershipTypeId and Date)<br />3. MembershipType (which has Id and Name)<br /><br />The classes I have come up with for the design are:<br /><br />public class Member : BusinessBase<br /><br />public class MembershipHistory : BusinessListBase<br /><br />public class Membership : BusinessBase<br /><br />public class MembershipTypeList : NameValueListBase<br /><br />public class MembershipType : BusinessBase<br /><br />so far.<br /><br />I have created a Members.DalLinq project and created a Members.dbml in there by dragging in the tables and stored procedures from my database.<br /><br />Now, when creating the Data Access code for Member I load the data from my Members table like this:<br /><br /><pre>var data = (from m in ctx.DataContext.Members<br />                            where m.Id == criteria.Value<br />                            select m).Single();<br /></pre><br /><br />My problem arises when I try to load the "child" data using this:<br /><br /><pre>                //Get child data<br />                LoadProperty(<br />                    MembershipProperty,<br />                    MembershipHistory.GetMembershipHistory(<br />                    data.MembershipHistory.ToArray()));</pre><br /><br />I get this error:<br /><br />'Members.DalLinq.Member' does not contain a definition for 'MembershipHistory' and no extension method 'MembershipHistory' accepting a first argument of type 'Members.DalLinq.Member' could be found (are you missing a using directive or an assembly reference?)<br /><br />It is my understanding that this method that it is looking for should reside in the Members.designer.cs file in the Members.dbml section of my solution and it should have been created automatically by VS.  So since it wasn't done, I guess I have set something up incorrectly.  <br /><br />If anyone has read this far and has any clue what I am talking about, I would really appreciate your suggestions.<br /><br />Thanks very much for your time and patience!<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 10, 2009</h2>sounds like the linq2sql is messed up somewhere.&nbsp; Did intellisense come up with MembershipHistory when you typed data<STRONG>. </STRONG>?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FCazabon replied on Thursday, December 10, 2009</h2>Nope, no intellisense.  I'm wondering if maybe I should be calling FetchChild() instead. ??</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FCazabon replied on Friday, December 11, 2009</h2>OK, got some intellisense kicking in now which allows me to set it up like this:<br /><br /><pre>                //Get child data<br />                LoadProperty(<br />                    MembershipProperty,<br />                    MembershipHistory.GetMembershipHistory(<br />                    data.Memberships.ToArray()));</pre><br /><br />but this now gives me two errors:<br /><br />Error	1	The best overloaded method match for 'Members.Library.MembershipHistory.GetMembershipHistory(Members.DalLinq.MembershipHistory[])' has some invalid arguments<br /><br />Error	2	Argument '1': cannot convert from 'Members.DalLinq.Membership[]' to 'Members.DalLinq.MembershipHistory[]'<br /><br />I seem to have fixed these errors by changing code in my MembershipHistory.cs file from this:<br /><br /><pre>        internal static MembershipHistory GetMembershipHistory(<br />          Members.DalLinq.MembershipHistory[] data)<br />        {<br />          return DataPortal.FetchChild(data);<br />        }</pre><br /><br />to this:<br /><br /><pre>        internal static MembershipHistory GetMembershipHistory(<br />          Members.DalLinq.Membership[] data)<br />        {<br />          return DataPortal.FetchChild(data);<br />        }</pre><br /><br />Does that make sense?<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 11, 2009</h2>It makes sense, if you really want to load memberships instead of membershiphistory.&nbsp; I have no idea what your domain model is, so I can't tell you if that's correct or not though.&nbsp; But if you're getting the expected results, then I'd say you're on the right track.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FCazabon replied on Friday, December 11, 2009</h2>I *think* memberships and membershiphistory are conceptually the same thing, just I was thinking of it as MembershipHistory, but the SQL to Link thing seems to have called it Memberships.  I can't say if it is correct yet as I still need to do bit more coding to get all the other classes set up.<br /><br />Thanks for your help</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 11, 2009</h2>Well I'd double check the Linq designer then, to see what data is being pulled out.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
