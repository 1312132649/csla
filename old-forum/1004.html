<html><header><title>Running Total in Parent object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Running Total in Parent object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1004.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy posted on Thursday, August 24, 2006</h2><P>I want to keep a running total in my order object so that every time a orderdetail is updated,added or deleted it fires an event that changes the "sub total" of an order. So that I don't have to loop thru the order everytime I want the sub - total.</P>
<P>So I am wondering would it be ok to create 2 events AddToSubTotal and MinusFromSubTotal then fire these events in the add &amp; remove methods of the child collection (orderdetails) which updates the SubTotal property of the parent (Object) order.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2><P>A&nbsp;more general way of&nbsp;accomplishing this is to add a PriceChanged event to your OrderDetail object and have the OrderDetailCollection register a handler each time an item is added.&nbsp; Then you can have a PriceChangedEventArgs expose properties such as: OldPrice, NewPrice, ChangeInPrice, that can be used&nbsp;to adjust the subtotal.</P>
<P>You can issue another PriceChanged event from the OrderDetailCollection to the parent Order object which has registered a handler for the collection's event that would update the Order's SubTotal property...</P>
<P>or,</P>
<P>Make the SubTotal a property of the OrderDetailsCollection and change the Order object to delegate its SubTotal property to return the collection's property.&nbsp; This would eliminate the need for cascading the event up to the Order object.</P>
<P>The first approach (maybe both) would be consistent with the automation model-type approach where objects expose changed events for each property and simplifies things because you don't have to include logic to determine if the change is an addition or subtraction as it is handled through the sign of the ChangeInPrice property (or by NewPrice - OldPrice, which is all ChangeInPrice would be anyway).</P>
<P>Hope that helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Thursday, August 24, 2006</h2><P>Or you could just put the SubTotal property in the collection and let it increment/decrement it in its own Add/Remove methods.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2>You'll want to use an event-driven approach if your OrderDetail objects are editable.&nbsp; You can't capture changes to the item with Add/Remove in the collection.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, August 24, 2006</h2><P>Don't know why I couldn't see how to do this... not enough coffee maybe LOL! </P>
<P>I thought I'd post this to share how i figured it out :) I started to think creating events and handlers seemed overly complex. </P>
<P>class Order : BusinessBase&lt;Order&gt;<BR>{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;private OrderDetails _OrderDetails = OrderDetails.NewOrderDetails();</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;public double SubTotal<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get{ return _OrderDetails.SubTotal; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;<BR>}</P>
<P>class OrderDetails : BusinessListBase&lt;OrderDetails ,OrderDetail&gt;<BR>{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;private double _SubTotal = 0.0;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;public double SubTotal&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _SubTotal;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}</P>
<P>&nbsp;public void AssignProduct(ProductInfo product, int qty)<BR>&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (OrderDetail od in this)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!Contains(product, qty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrderDetail newOrderDetail = OrderDetail.NewOrderDetail(product, qty);</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Update Running Sub Total<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SubTotal = _SubTotal + (product.Cost * qty);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Add(newOrderDetail)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;}</P>
<P>&nbsp;public void RemoveProduct(ProductInfo product, int qty)<BR>&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (OrderDetail od in this)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (od.product.equals(product) &amp;&amp; od.qty = =&nbsp;qty)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Update Running Sub Total<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SubTotal = _SubTotal - (product.Cost * qty);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove(od);&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;}<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 24, 2006</h2><P>Keep in mind that this assumes your OrderDetail objects are read-only.&nbsp; If you allow the user to makes changes, such as to the Quantity property, you will need some way to capture the change made at the item level in your collection.&nbsp; That is why the event approach is more commonly used.</P>
<P>But, if it is read-only, then this will work just fine.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, August 24, 2006</h2><P>RIGHT! Totally wasn't thinking of the properties for order details DOH!</P>
<P>Thanks!</P>
<P>I think I'm going to have to start paying you SonOfPirate LOL!</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
