<html><header><title>Authorization and Parent/Child relationship.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authorization and Parent/Child relationship.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12860.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 posted on Monday, April 13, 2015</h2><p>I am currently 4.3.13 and am encountering what I believe might be I thought was a bug, but realize might be intentional.</p>
<p>I have a parent child scenario and have authorization rules on the parent.&nbsp; For what I can see, the authorization rules do not cascade down to the child.&nbsp;&nbsp;For example, if the parent is read only, I can still make changes to the child.</p>
<p>I can understand why if this is&nbsp;intentional.&nbsp; If it isn&#39;t, please let me know.</p>
<p>If it is intentional, how do I handle security on the children best.&nbsp; Should I:</p>
<p>1) Set security on each child class explicitly.&nbsp; This is a problem if there are multiple parent classes that use this child and have different security.</p>
<p>2) Access the Parent and check it&#39;s security.&nbsp; This seems to be a bit of a complex base class.&nbsp; How does one override this if a child as a special security requirement?</p>
<p>Any help would be appreciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Monday, April 13, 2015</h2><p>Its intentional as it may be valid for someone&#39;s use case to allow editing of children but not the parent.&nbsp; you can use the same rule methods as the parent class or reference the parents methods directly.&nbsp; as for children with different types as parents, that&#39;s a bit unusual but you can write a rule method that makes a decision based on the parents type.&nbsp; </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, April 14, 2015</h2><p>Hi,</p>
<p>Like Andy said - this is intentional as a Child object is considered to have their own authorization rules.<br />(And I assume we are talking property level authorization rules here). </p>
<p>If the purpose is to &quot;make the entire object readonly&quot; I have often added overrides to CanWriteProperty (and CanExecuteMethod) to have a check on some condition and just return false. </p>
<p>Remember: there is a limit of 1-one AutohorizationRule per property and authorization action. So you cannot chain multiple AuthorizationRules in AddBusinessRules (althjo you can make AuthorizationRules that call other authorization riles). So I usually prefer to have AuthorizationRules that are for the necessary properties only - and if I need to make the entire object read only to use the override in CanWriteProperty.&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Tuesday, April 14, 2015</h2><p>I&#39;m only dealing with object level authorization since it&#39;s the business requirement.</p>
<p>I do have classes that are shared with multiple parents.&nbsp; For example, Address is an object that could be a child of both Member and Business.&nbsp; Depending on who the parent is, the authorization should be different.&nbsp; I also have to plan that more parents could be added in the future.</p>
<p>I&#39;m hoping I&#39;m not over complicating this in my mind.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 15, 2015</h2><p>Is the child object a 1-1 or is it in a collection?&nbsp; </p>
<p>You could have a base Address&lt;T&gt; class which is abstract. You could create internally visible only subclasses which then have the AddObjectAuthorization rules setup specifically for each parent that will have an object and the factory methods to create the instance.&nbsp; All of the other logic could be in the base class; of course all your factory methods would have to be internal so that only the parent can create instances.&nbsp; So you&#39;ll need to create a new subclass for every new parent, but all that would end up there is the behavior specific to who the subclass is meant to be used with, which should just be the security code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, April 16, 2015</h2><p>Hi,&nbsp;</p>
<p>The real issue here is when and where to check authorization. </p>
<p>ObjectLevel authorization is checked only for &quot;root&quot; DataPortal calls (DataPortal.Create/Fetch/Delete/Execute/Update). </p>
<p>There is no authorization checks in the child dataportal calls. When a child object is created it has NO knowledge of any parent until it is added to a parent object/list (and SetParent method is called) and this occurs after the ChildDataPortal call has completed.</p>
<p>See: http://forums.lhotka.net/forums/t/11561.aspx<br />(and there is several other posts too on the forum)&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Thursday, April 16, 2015</h2><p>I recognise this would be an issue on the Get security, but my more immediate concern is with Edit.&nbsp; In my case, all data should be loaded for Editing and SetParent should already be executed.</p>
<p>I guess I&#39;m a little surprised a security inherited from the parent object has never been a requirement before.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Thursday, April 16, 2015</h2><p>If you&#39;re mainly concerned about editing child objects, you could override CanWriteProperty and have your parent (or grandparent in the case of a list of addresses) implement an interface which returns a Boolean CanEdit property.&nbsp; Then in the override just get your parent or grandparent, casting to your interface, and if it returns false you can return false otherwise call the base.CanWriteProperty.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Thursday, April 16, 2015</h2><p>I think it is what I&#39;m looking at doing.&nbsp; My only remaining issue is how to override this behaviour if the child needs to have a different or additional security.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, April 16, 2015</h2><p>Just a caution.</p>
<p>ObjectLevel &nbsp;Authorization rules does NOT prevent edit of properties. In the case of EditObject is only checked in Save() on the &quot;root&quot; object.</p>
<p>PropertyLevel authorization rules can be used for ReadProperty/WriteProperty/ExecuteMethod. &nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Thursday, April 16, 2015</h2><p>Is this a difference between 4.3.x and 4.5.x?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, April 16, 2015</h2><p><div style='padding-left: 50px;background-color:silver'><b>Joseph Morin<br></b>Is this a difference between 4.3.x and 4.5.x?</div></p>
<p>I believe its the same for both versions.</p>
<p>Since you&#39;re talking about property rules though you can make the auth rule as smart as it needs to be.&nbsp; With property rules you don&#39;t need to override CanWriteProperty as the rule can contain any of the logic you need.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, April 17, 2015</h2><p>For property level AuthorizationRules be aware of:</p>
<p><ol>
<li>There can be only <b>ONE-1&nbsp;</b>rule per AuthorizationAction / Property&nbsp;</li>
<li>The result is by default cached (IE: Rule is only run once)</li>
<li>Make sure to inherit from AuthorizationRule base class and set CacheResult = false if you want the rule to run every time (no caching)</li>
</ol></p>
<p>If you already have role based authorization rules - it may be easier and safer to add an override to CanWriteProperty rather than create multiple sets of rules or change your rule registrations.&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
