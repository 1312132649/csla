<html><header><title>Enterprise Library DAAB, Use it, or Not?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Enterprise Library DAAB, Use it, or Not?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1025.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>secovel posted on Friday, August 25, 2006</h2>I've seen Rocky's post that Enterprise Library can compliment CSLA.&nbsp; That's good!&nbsp; I need a bigger question answered.&nbsp; SHOULD I use the DAAB with CSLA?&nbsp; If the answer is yes, how would one go about doing it?&nbsp; Has anybody used the DAAB with CSLA, and would you share that experience with me?<br><br>Thanks,<br><br>Sean<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Friday, August 25, 2006</h2><P>I started the thread "presentation and data access layer frameworks" (Take a look at that too)</P>
<P>and I tried to find someone who would share their experiences with us regarding CSLA and Enterprise integration. So far the folks who have replied didn't&nbsp; enjoy enterprise library with CSLA ( especially if your DBMS is only one type like SQLServer), Personally I dont like Enterprise library dataaccess block or DAAB because of its dependency on Datasets (it probably stems from the fact that I am not a big fan of datasets when it comes down to using them in business layer or even data access layer).</P>
<P>Ash</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brent replied on Saturday, August 26, 2006</h2><P>The DAAB works great with CSLA in my experience (that's our only pattern).&nbsp; You need to separate your DAL in a separate assembly if you really want to get the benefits of DAAB when using CSLA.&nbsp; If you're dealing with transactions, there is a issue at the moment about how to move the transactions to the server but Rocky has mentioned that he may have a possible solution for that problem (LocalContext).</P>
<P>In my experience, CSLA does nothing but compliment the enterprise library and vice versa.<o:p></o:p></P>
<P class=MsoNormal><o:p>&nbsp;P.S.&nbsp;I never use datasets in any case, the IDataReader interface from the DAL works well with SafeDataReader.</o:p></P>
<P class=MsoNormal><o:p></o:p>&nbsp;</P>
<P class=MsoNormal><o:p>Brent</o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Saturday, August 26, 2006</h2>Surely the first question should be: does the&nbsp;DAAB help me meet my requirements? That is, what is it that using the DAAB solves that I can't solve without it or something similar.No point in using it just for its own sake.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>secovel replied on Saturday, August 26, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>simon_may:</strong></div><div>Surely the first question should be: does the&nbsp;DAAB help me meet my requirements? That is, what is it that using the DAAB solves that I can't solve without it or something similar.No point in using it just for its own sake.</div></BLOCKQUOTE><br><br>Simon,<br><br>Sometimes the requirement that you fullfill is that you support all of the buzzwords that managment is looking for... :-(&nbsp; <br><br>"The app needs to be Scalable and Robust.&nbsp; Shouldn't we be using the Enterprise Library?&nbsp; What's that DAAB everyone is talking about.&nbsp; Shouldn't we be using that?"<br><br>The chances that an app will ever get "ported" to another DB is pretty slim.&nbsp; Sounds like Rocky's CSLA already takes care of the 3-tier requirement.&nbsp; Probably don't need it at all.&nbsp; What else is it good for?&nbsp; <br><br>Sean<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Sunday, August 27, 2006</h2><P>Sean</P>
<P>Good point. Thankfully, I have been out of that type of environment for a while now and, silly me, I forgot about those types of&nbsp;requirements. </P>
<P>So let me rephrase my response. The DAAB is a brilliant addition to your technical Marketecture, it performs exremely well on all powerpoint slides and in most meetings with senior management patrticularly when they have recently returned a drop of Microsoft hospitality ;-)</P>
<P>Simon</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>secovel replied on Sunday, August 27, 2006</h2>OMG!&nbsp; I almost shot milk out my nose!&nbsp; And I wasn't even drinking milk!<br><br>Sean<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>secovel replied on Saturday, August 26, 2006</h2>Brent,<br><br>Thanks!&nbsp; That gives me something to look into.<br><br>Sean<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lprada replied on Monday, August 28, 2006</h2><P>I use EntLib. Great Integration. Here is a Fetch Example. </P>
<P>&nbsp;</P>
<P>&nbsp;private void DataPortal_Fetch(Criteria criteria) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Microsoft.Practices.EnterpriseLibrary.Data.Database PMDatabase = DatabaseFactory.CreateDatabase("PM");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (DbCommand dbCommand = PMDatabase.GetStoredProcCommand("GetProject")) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PMDatabase.AddInParameter(dbCommand, "guid", DbType.Guid, criteria.Id);</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new SafeDataReader(PMDatabase.ExecuteReader(dbCommand))) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _id = dr.GetGuid("guid");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _internalCode = dr.GetString("internalcode");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _comercialName = dr.GetString("comercialname");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _internalName = dr.GetString("internalname");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _description = dr.GetString("description");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _started = dr.GetSmartDate("started", _started.EmptyIsMin);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ended = dr.GetSmartDate("ended", _ended.EmptyIsMin);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.GetBytes("lastchanged", 0, _timestamp, 0, 8);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _isInactive = dr.GetBoolean("isdeleted");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Monday, August 28, 2006</h2><P>sweet! Can you please give a short example where you update the database ( I mean Insert, Update operation)</P>
<P>Thanks</P>
<P>Ash</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Wednesday, August 30, 2006</h2>Oh Oh! No one is interested anymore ???</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FireGarden replied on Wednesday, August 30, 2006</h2><P>Come on Ash! Download the DAAB and read the help file. It will show you how to do an insert. Its really not much&nbsp;differnt than the&nbsp;above example.</P>
<P>&nbsp;Personally I really enjoy the Enterprise Library and think you will too.</P>
<P>Rob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Thursday, August 31, 2006</h2><P>FireGarden! I know that DAAP hands on lab and documentation show how to use its methods, what I was looking for its usage with CSLA, if you look at the post by Bob hagan, he is using db.excecutenonquery, </P>
<P>I thought how could we possibly use db.updatedataset with CSLA?</P>
<P>I hope I have cleared myself</P>
<P>&nbsp;</P>
<P>Ash</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>thomasjrr replied on Wednesday, February 14, 2007</h2><P>Ash,</P>
<P>&nbsp; I modified the CSLAContrib CodeSmith templates to use the Jan 06 Enterprise Library.&nbsp; It is just a start (transactions not solved), but it might get you started.&nbsp; The reason we are using the EL is that we are developing COTS software and we want to be able to support Oracle and MS Sql Server.&nbsp; So far, testing has progressed well.&nbsp; If you are interested in the templates, please e-mail me.</P>
<P><A href="mailto:robert.thomas@capricciosoftware.com">robert.thomas@capricciosoftware.com</A></P>
<P>Bob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Monday, March 12, 2007</h2><P>FWIW, we originally started with a DAL that integrated with the DAAB.&nbsp; It worked fine, but we were still writing a bunch of SQL Stored Procedure code.</P>
<P>Then we discovered NHibernate and decided to use that instead because:</P>
<P>(1) It gives the potential for cross database portability (SQL Server, Oracle, MySQL are our target database engines).</P>
<P>(2) You don't have to write any SQL Stored Procedures - NHibernate does all the SQL for you.</P>
<P>(3) You can use attributes to mark up your class code giving you potential benefits with code generation techniques.</P>
<P>At the end of the day, you need to pick the tools that get the job done.&nbsp; Either technology will do a good job, so you need to pick the one that best suits your needs.</P>
<P>HTH</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bobhagan replied on Thursday, August 31, 2006</h2>It might not be quite as simple as it seems.&nbsp;&nbsp; <br>Des Nolan mentioned in another thread about dals, that the biggest benefit for this is when you have an application that has to use more than one data source.&nbsp; I'm using Oracle and some SQL Server, so I experimented with the 1.1 version.<br><br>There are some real differences in calling stored procedures etc between the two databases.&nbsp; The code above calls a stored procedure in SQL Server format.&nbsp; Oracle frequently combines sps into a "package" with the format "Project.GetProject".&nbsp; Oracle also must use a "RefCursor" to return values in a fetch.&nbsp; Because of these seemingly minor differences, for at least some things you need to create a separate dal with a provider for each database you are supporting.<br><br>I was able to make a dynamic query/update work, but then disovered that there was a bug in the way the Oracle provider handled parameters.&nbsp; There was a patch created later, but I gave up, because I had no need to support different dbs in the same application. &nbsp; I use CodeSmith templates and it was relatively easy to modify them so you could generate the dataportal code for the correct db.&nbsp; <br><br>This is the old style dataportal code modified<br><br>if(this.IsNew)<br>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp; //perform an insert, object has not been persisted<br>&nbsp;&nbsp;&nbsp;&nbsp; if(System.Configuration.ConfigurationSettings.AppSettings["DBType"] == "ORA" )<br>&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; db.ExecuteNonQuery(tr,CommandType.Text,OraQueries.Client_Insert(CLIENT_ID,CLIENT_NM, blah) );<br> else<br>&nbsp;&nbsp;&nbsp; //Insert to SQLServer<br><br>OraQueries had:<br><br>public static string Gen_id(IDbTransaction tr, Database db)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //Not using an SP, so get the Ora Sequence<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DBCommandWrapper dbCommandWrapper = db.GetStoredProcCommandWrapper("PRC_GEN_ID");<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; dbCommandWrapper.AddOutParameter("OUT_ID", DbType.String, 16);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; db.ExecuteNonQuery(dbCommandWrapper, tr); <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; string GEN_ID = dbCommandWrapper.GetParameterValue("Out_ID").ToString();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return GEN_ID ;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>public static string Client_Insert( string CLIENT_NM, blah)<br>{<br>&nbsp;&nbsp; string CLIENT_ID = Queries.Gen_id(tr, db);<br>&nbsp;&nbsp; string SQL = "INSERT INTO CLIENT " +&nbsp; <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "(CLIENT_ID,CLIENT_NM, blah) " +&nbsp; <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "VALUES ('" + CLIENT_ID + "','"+ CLIENT_NM +"','"+ blah ))";<br>&nbsp; return SQL;<br>}<br><br>There are additional commands to handle parameters, but I couldn't get them to work.<br>I discovered on gotdotnet that there was a bug, that was later patched.<br><br>dbCommandWrapper.AddInParameter("p_CLIENT_ID", DbType.String, CLIENT_ID);<br>DBCommandWrapper dbCommandWrapper = db.GetSqlStringCommandWrapper();<br>Client_parameters(dbCommandWrapper,&nbsp; )<br>then the query.&nbsp; <br>there is a similar Command Wrapper to call a stored procedure.<br>(I noticed in my code that I also called the Gen_id function from the dataportal and passed the value back the the query, so that was not generic.&nbsp; I just moved the call to the OraQueries section - I haven't tested this)<br><br>Hope that helps<br><br>I have a couple of questions, as well:<br><br>1) Has anyone tried the EntLib with Oracle in VS2.0?&nbsp; Are the problems I described above fixed?<br>2) I've also been unable to use Oracle stored procedures in VS 2.0 becasue it appears that the MS Oracle provider no longer supports RefCursors.&nbsp; I posted a question on this on the ASP.NET site, but only got a reply from the woman who also thought that csla was going to be integrated into the Enterprise Library.&nbsp;&nbsp; What she said was that support for RefCursors was dropped from the Microsoft Oracle Provider and to change to the Oracle built Oracle provider.&nbsp; Say what?<br><br>Bob Hagan <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 31, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>bobhagan:</strong></div><div>What she said was that support for RefCursors was dropped from the Microsoft Oracle Provider and to change to the Oracle built Oracle provider.&nbsp; Say what?</div></BLOCKQUOTE><br><br>Well this part I think means that you should use the Oracle created .Net managed provider, not the one MS ships with the framework.<br><br>Frankly I'd rather use the managed provider from Oracle anyway.. MS's version likely is out of date and slower (kind of like the default video drivers; they work, but you're better off getting the ones from NVidia).<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
