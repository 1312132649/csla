<html><header><title>Validation and deferred deletion</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation and deferred deletion</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7134.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 posted on Thursday, June 18, 2009</h2><P>Hi</P>
<P>Is there a way of using Validation rules for objects requiring deferred deletion? I've had some success by creating a Rule which checks IsDeleted before validating, then override the delete method:<o:p></o:p></P>
<P class=MsoPlainText><o:p>&nbsp;</o:p></P>
<P class=MsoPlainText><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>public override void Delete()<o:p></o:p></P>
<P class=MsoPlainText><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></P>
<P class=MsoPlainText><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>ValidationRules.CheckRules();<o:p></o:p></P>
<P class=MsoPlainText><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>base.Delete();<o:p></o:p></P>
<P class=MsoPlainText><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>}<o:p></o:p></P>
<P class=MsoPlainText><o:p>&nbsp;</o:p></P>
<P class=MsoPlainText>The problem is that the Save method doesn't throw an exception if the object is deleted. I know I could override that too. Also the CheckRules method obviously checks all rules which may not be valid but are not relevant to the delete requirement. Perhaps I'm missing something here.<o:p></o:p></P>
<P class=MsoPlainText><o:p>&nbsp;</o:p></P>
<P class=MsoPlainText>Can the framework provide for validation just on deleted objects or do I need to handle this myself? Any help/suggestions much appreciated. Please also point me to any pages in the book which you think might help me with this.<o:p></o:p></P>
<P class=MsoPlainText><o:p>&nbsp;</o:p></P>
<P class=MsoPlainText>Many thanks<o:p></o:p></P>
<P class=MsoPlainText>Andrew<o:p></o:p></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, June 19, 2009</h2>Hi,<br><br>Why would you want to run validation rules on deleted objects? Your users cannot edit or change items in the deleted list so that would be a catch 22 if your objects became Invalid due to broken rules in deleted items. <br><br>/jonnybee<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Friday, June 19, 2009</h2>Perhaps I'm using the wrong terminology.<br /><br />What I'm trying to do is restrict delete operations when the object contains certain values. E.g. The current user should only be allowed to delete an object they created. My object contains an OwnerId property. The current user identity should only be able to delete if the custom Identity contains the same ID. Also if the object has a status=live setting then the user cannot delete the object. In which case it should throw an exception. At the moment all users of certain roles can delete all objects. Am I right in thinking the framework doesn't provide anything to deal with these scenarios? In which case can you suggest an approach to this?<br /><br />What about something like a ValidationRules.AddDeleteRule and ValidationRules.CheckDeleteRules()?<br /><br />Thanks<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, June 19, 2009</h2>I am not sure you need a framework level solution. Depending on the scope of this issue it is something you can put into a single root BO or in your Base class which inherits from CSLA and from which all your BOs derive.<br /><br />Just add a property to your BO named CanDelete As Boolean. In that property you evaluate all the conditions of the given BO and return True or False. Then in your UI you simply ask the bO if CanDelete is True and then either show or enable your delete button.<br /><br />If you need it in all your BOs then move the property into your Base class.<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmnc replied on Friday, June 19, 2009</h2><P>How about overriding the CanExecuteMethod() method to determine whether the user is allowed to delete the object?</P>
<P>public override void Delete()<BR>{<BR>&nbsp;&nbsp; CanExecuteMethod("Delete", true);<BR>&nbsp;&nbsp; base.Delete();<BR>}</P>
<P>public override bool CanExecuteMethod(string methodName) <BR>{ <BR>&nbsp;&nbsp;&nbsp; if (methodName == "Delete") {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty(OwnerIdProperty) == Csla.ApplicationContext.User.Identity.Name &amp;&amp; ReadProperty(StatusProperty) != "live"; <BR>&nbsp;&nbsp;&nbsp; } <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; return base.CanExecuteMethod(methodName); <BR>}</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, June 20, 2009</h2>Hi,
<br><br>I agree with dmnc but I would check the base command first before custom checks: 

<br><br>public override bool CanExecuteMethod(string methodName) 
<br>{ 
    <br>&nbsp;&nbsp; if (!base.CanExecuteMethod(methodName)) return false;
<br><br>&nbsp;&nbsp; if (methodName == "Delete") <br>&nbsp;&nbsp; {                    
        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty(OwnerIdProperty) == Csla.ApplicationContext.User.Identity.Name &amp;&amp; ReadProperty(StatusProperty) != "live"; 
    <br>&nbsp;&nbsp;&nbsp; } 
<br>}

<br><br>I also apply the same rule for any overloads of CanReadProperty and CanWriteProperty.<br><br>&nbsp;/jonnybee</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
