<html><header><title>Duplication of work and Project Tracker</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Duplication of work and Project Tracker</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/191.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay posted on Wednesday, May 24, 2006</h2><P>I saw Rocky speak a little while back and he made the comment that if you are thinking like a relational database programmer when creating your classes you are going down the wrong path.</P>
<P>He was trying to show that, while in the database there may only be 1 Project table, that doesn't mean that you will only have 1 Project class in your application.</P>
<P>This is evident in the fact that there is a Project, and a&nbsp;ProjectInfo class which both represent a Project.</P>
<P>I am having a hard time understanding this concept.</P>
<P>I understand that in the application the ProjectInfo is used in places where the full Project class is not needed, but why not reuse the Project class and save the work of creating the ProjectInfo class?&nbsp; </P>
<P>Couldn't you supply the criteria object with a value to indicate that you don't need to front load the children of Project (e.g. Resources collection) when you wanted to use the Project class in a place where right now they are using the ProjectInfo class?</P>
<P>I think when I saw Rocky speaking, he called this Responsibility Analysis or Responsibility Driven Design (if I remember correctly) and suggested Object Thinking by David West, but I didn't see anything from thumbing through it to give me an idea why I am wrong on this point.</P>
<P>Any thoughts, or ideas where I could find some more info on this?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pfeds replied on Wednesday, May 24, 2006</h2><P>Do you have the 2005 book as there is a really good section of the BO Design chapter that explains modelling objects dependent on their behaviour.&nbsp; You could also look into SRP (Single Responsibility Principle) as this might help.</P>
<P>I found it strange at first, especially as it seemed to duplicate code which I've always tried to avoid at all cost.&nbsp; However, each object in the ProjectTracker library does have a concise behaviour, and object modelling is all about behaviour and not data.&nbsp; The ProjectList and ProjectInfo objects are lightweight and readonly - ideal for displaying in a list.&nbsp; If you wish to modify a project then it is then you create the full fat object with all the data, and this helps you avoid creating large collections incorporating masses of redundant data.</P>
<P>This has worked especially well in practice for me with some code I worked on recently, so this should be a good illustration.&nbsp; The code involved working with Active Directory to retrieve a list of users (potentially around 5000), and to also add, remove and update these users.&nbsp; A user object not only required data from Active Directory, but also&nbsp;about permissions for&nbsp;installed tools on the system.&nbsp; If I were to retrieve a list of UserInfo objects with only the information from AD then this is far more efficient than having to find out all the extra redundant information that is not required at the time.&nbsp; This means I can efficiently display the list or a filtered list, and only when I select a user for editing do I create the User object with all the information I need.</P>
<P>Hope this helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Wednesday, May 24, 2006</h2><P>I understand that in cases like the one you suggest, there might be performance issues that would drive you to creating simple lightweight class, rather than reuse a heavy complex class</P>
<P>I went back and re-read the section I think you are talking about:</P>
<P>Chapter 6: Object Oriented Application Design : Object Design.</P>
<P>Interestingly, in the book it looks like Rocky was planning on using Project instead of ProjectInfo.&nbsp; It looks like ProjectList is a collection of Project, not ProjectInfo as in the Project Tracker.</P>
<P>&nbsp;</P>
<P>Let me approach your&nbsp;AD User example in a manner similar to how we have been doing stuff and maybe you can comment on it.</P>
<P>Lets say you have a User object that contains a InstalledToolPremissions collection.<BR>When you "normally" use the User object, the InstalledToolPermissions collection is very important, but when working with AD, it isn't used.&nbsp; The User info can be loaded from AD or from the database.</P>
<P>I would build a couple different factory methods to create a User.&nbsp; Maybe one would take a datareader as a parameter and another would take a DirectoryEntry (AD) object.&nbsp; If a datareader were provided it would populate itself and also pass the datareader on to the InstalledToolPermission factory to build that object.&nbsp; The AD factory method wouldn't populate the InstalledToolPermission collection, but the property accessor would be built to lazy load it if needed.</P>
<P>What do you think?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, May 24, 2006</h2>Well, There are several things here to take into account:<br>To do what you propose, you'd need a switchable object with lazy loading children.<br>These objects would need to be marked as child if they're called within the context of a collection. This brings issues with saving, since once you mark an item as child you can't individually save it. (And if you do, it'd be hacky). <br><br>Also, there's a performance issue that comes from two sides:<br>-Security: Generally you don't have security constraints for reading the lists, but you do for full blown objects. Using the same object for browsing and editing will add an unnecesary&nbsp; overhead in this area.<br>-Quantity of data: Generally you make readonly lists contain just a couple of fields. The ones that are more relevant / important. If your bo has 20 fields, you're not going to show all those 20 in your list, but you'll be fetching them anyway. Other wise you'd have to lazy load the rest of the fields which is just crazy.<br><br>Again, separating objects by behaviour may seem to duplicate efforts sometimes, but it actually makes things more simple and agile for the developer and the user.<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>phowatt replied on Thursday, May 25, 2006</h2><P>When I first started with OOP via Rocky's book I had the relational view of the world.&nbsp; I saw the caveats about making your business classes behavior oriented vs data oriented.&nbsp; At about the same time I was introduced to a great code generating tool called CodeSmith.&nbsp; CodeSmith makes it easy to generate business classed based on a table in your database.&nbsp; I read lots of comments in our forum about that approach not being behavior oriented but I still did not appreciate what these folks were saying.&nbsp; I was heavily involved in a development project and I was deep into the order entry part.&nbsp; I started out by using the Customer object as the central object for order entry.&nbsp; But I soon found that the Customer object graph was growing larger and larger.&nbsp; Customer orders were a child collection to the customer and of course order line items were the grandchildren.&nbsp; Then I had to handle returns.&nbsp; And then there was a composite customer history that include orders, returns, and contacts with the customer.&nbsp; On and on it went.&nbsp; Some customers placed a lot of orders with the company and soon I could see that if a had a simple need to, lets say change the customers phone number I could potentially be retrieving a lot of data from the database just to change a phone number.&nbsp; That did not seem advisable to me.</P>
<P>One day I was having a review of my code for a form I had written.&nbsp; I had a really smart guy working for me.&nbsp; After reviewing the code for a while he got a funny look on his face and ask me 'Just how many lines of code are in this form anyway?'&nbsp; After getting to the end and seeing how big the form class was he told me that I was putting a lot of the business logic in the form when it belonged in a business class.&nbsp; And I could see that what he said really made sense.&nbsp; You do not want to have your business logic spread amoungst a bunch of forms making it hard to maintain and probably producing a consider amount of redundant code.&nbsp; As best you can you want just one place for your business logic and that is in a business class.</P>
<P>We worked out a two layer architecture that solved our problem nicely.&nbsp; What I now do is have one layer of business classes that are essentially data facing.&nbsp; If I have a Customer table I will have a Customer class.&nbsp; That class may have a child collection or two but the child collection will only include data that is required for all of the customer data like a collection of alternate addresses, or perhaps a collection of contacts for that customer.&nbsp; But things like orders and history are not part of the Customer class.&nbsp; The second layer of classes is what I call the application facing business classes.&nbsp; In the case of order entry I may have a class called OrderEntryManager.&nbsp; This class will use any of the data facing classes it needs to support the order entry behavior. But all of the complex business logic require to manage the order entry process will be found in this class. My forms have access to any and all data facing objects they need through the OrderEntryManager class. The property and methods that involve multiple data facing classes are written in the OrderEntryManager.&nbsp; This class provides any methods necessary to take the burden of business logic out of the UI classes.&nbsp; </P>
<P>This approach puts the basic data validation business logic in the data facing classes and lets me use CodeSmith to generate those classes quickly and effectively.&nbsp; The manager classes I code from scratch.&nbsp; They might include the need for a stored procedure to retrieve some data or not.&nbsp; </P>
<P>This approach allows me to write UI code that has little or not business logic in it.&nbsp; The code is mostly for making the UI work.&nbsp; The business logic is mostly in a business class.</P>
<P>One way to look at it is to think of the database as the place where the business data is persisted and the business classes are where the business rules are persisted.</P>
<P>I am not an oop guru but I had to make the same change in thinking that you are facing.&nbsp; Hopefully my experience will be helpful to you.</P>
<P>Good luck.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Thursday, May 25, 2006</h2><P>cmay, I agree with you in principle and have posted similar message myself numerious times.&nbsp; The thing I wrestle with in trying to decide whether or not to go forward with this idea is the complexities involved, as others have explained.</P>
<P>This is sort of a catch-22 if you ask me.&nbsp; It's quite apparent that there often needs to be at least a couple classes pointing to the same underlying data when you're looking at things from the single responsibility point of view.&nbsp; But I think it's also apparent that doing so can&nbsp;lead to a violation of the "normalization of behavior" principle via duplication of code/functionality.&nbsp; </P>
<P>A couple of solutions have been discussed here over the years.&nbsp; The first is a "helper class" where all the common business functionality is represented in an&nbsp;static/shared&nbsp;class used by the various BOs.&nbsp; For example, a FullName property in both the Customer and CustomerInfo classes that's derived from concatenating 2 or 3 name fields could use a&nbsp;static method PersonHelper.FullName(string firstName, string middleName, string lastName).&nbsp; Being able to use Rules in an OO way also helps avoid the duplication of code.</P>
<P>The other solution is to have a series of classes building more and more complex through composition rather than as distinct classes.&nbsp; The full Customer class would contain the business logic in the simple CustomerInfo class this way, so there's never any duplication.</P>
<P>I think most, if not all,&nbsp;have taken the pragmatic path and used the first approach as the second is of course considerably more complex.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Thursday, May 25, 2006</h2>I've been using helper classes more frequently lately. One of the first that I created was an Address class. Our database doesn't have a normalized address table. We have address fields in the customer table, the vendor table, the order table, the invoice table, etc. Fortunately, the column names follow a certain convention among the tables, so I can easily populate the class by passing in the data reader that is used to populate the primary business object.<br><br>I'm working now on a quote and sales order project. Quotes and sales orders share behavior, such as estimating the cost of an item. This behavior works as a separate class because it is not exclusive to a single domain object. I have a lot more CommandBase and ReadOnly objects in the project than I do editable objects in my projects.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
