<html><header><title>Child_DeleteSelf() not called from parent</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child_DeleteSelf() not called from parent</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12122.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sguolla posted on Tuesday, August 20, 2013</h2><p>I have a parent object that inherits from BusinessBase and a child object that inherits from BusinessBase.&nbsp;&nbsp;The child is an object contained within the parent.&nbsp; The child object is a regular business object.&nbsp; It is NOT a list.&nbsp; All my child data portal methods (e.g.&nbsp;Child_Create(), Child_Insert(), Child_Fetch(), Child_Update())&nbsp;get called as expected with the exception of Child_DeleteSelf().&nbsp; My child methods get called correctly when I invoke FieldManager.UpdateChildren(this);&nbsp; I have the correct signature in the methods.</p>
<p>I&#39;ve seen&nbsp;similar posts on-line&nbsp;from other people and there doesn&#39;t seem to be an answer.&nbsp; I don&#39;t understand why the parent cannot invoke a delete on a child in the same way it invokes for insert, fetch, update, etc.&nbsp; This seems like a natural thing to do and it&#39;s all part of one transaction.</p>
<p>If a parent cannot invoke this, I have no idea why Child_DeleteSelf() even exists.</p>
<p>I&#39;ve been using CSLA for several years now.&nbsp; I guess I&#39;ve never encountered this situation.</p>
<p>If anyone has any insight or experience with this, I&#39;d be very grateful.<br /><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, August 20, 2013</h2><p>There 2 important requirements for CSLA DataPortal to call into Child_DeleteSelf</p>
<p><ol>
<li>Object must has IsDeleted == true (ie: you must have called MarkDeleted on the child)</li>
<li>Object must have IsNew == false (ie: if IsNew is true the object does not exist in the database and no reason to call Child_DeleteSelf)</li>
</ol></p>
<p>so please make sure that the child object has both IsDeleted == true and IsNew == false and the Child_DeleteSelf method will be called.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sguolla replied on Tuesday, August 20, 2013</h2><p>Thanks for getting back to me Jonny Bee.&nbsp; You&#39;re the man!&nbsp; So, IsNew is false which is good and I see that IsDeleted is false.&nbsp; For MarkDeleted() to work, it has to be called from within the child object.&nbsp; The parent object does not have access to it.</p>
<p>So my solution is to create a public method in the child object which has one line of code: MarkDeleted() and have the parent call this public method.&nbsp; Then, when I place FieldManager.UpdateChildren() in DataPortal_DeleteSelf(), the method Child_DeleteSelf() is called.</p>
<p>That&#39;s great, but I don&#39;t like having to add this extra step.&nbsp; I don&#39;t have to do it for INSERT and UPDATE so why do I have to do it for DELETE.&nbsp; This seems like flawed design.&nbsp; It&#39;s as if the default behavior of CSLA is to NOT automatically delete children when a parent is deleted.&nbsp; Wouldn&#39;t the opposite&nbsp;be the desired behavior all the time?&nbsp; Especially considering at the database level the children have foreign keys that are primary keys of the parent.</p>
<p>Am I missing something?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, August 20, 2013</h2><p>No, if the parent is deleted the parent should be responsible for deleting all its children as well.</p>
<p>You would only be correct if the assumption is that ALL child objects must be loaded.</p>
<p>In a relational database (and business object use case) you would happily load only a few of the related table(s) or even use Lazy-loading to only load data when required and still want to delete the parent record.</p>
<p>So you would be better off to use cascading delete in the database or call a stored procedure that handles the delete - rather than assuming that the object structure must load and mark all the child data as deleted.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sguolla replied on Tuesday, August 20, 2013</h2><p>I see where you&#39;re coming from.&nbsp; One of&nbsp;the design goals for our project is to have really&nbsp;straightforward stored procedures and have ALL logic in C# code and in CSLA.&nbsp; As such, we don&#39;t want complicated cascading deletes at the database level.&nbsp; In the same way a child inserts or updates data for his/her own database table, we want that same child to perform its own deletion.</p>
<p>In short, we want the object structure to manage everything.&nbsp;&nbsp;Your original suggestion is a&nbsp;fine workaround.&nbsp; It really struck me as odd for the case of deletion.</p>
<p>I also didn&#39;t consider the lazy-load situation.</p>
<p>Thanks again.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
