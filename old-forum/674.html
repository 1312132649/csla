<html><header><title>Where to call a stroed procedure?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Where to call a stroed procedure?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/674.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit posted on Wednesday, July 19, 2006</h2><P>Hi guys,</P>
<P>I am embarking on a new project and using the CSLA for the frst time in a business environment...</P>
<P>I apologize in advance for what I suspect is a really stupid question, and possibly the weather is causing me not to think straight...</P>
<P>What I am trying to do - is create a function based within my "customer" business object that will ultimately return a string message and am having problems trying to implement it.</P>
<P>Basically, it need to call a stored procedure that returns a string value based on the customer# criteria. I have tried to implement something along the lines of the "exists" function using commandbase, but I don't have an example of how this is implemented (in ProjectTracker?). If I try to call from my windows form with something like this...</P>
<P>mystatus = customer.getmystatus(customerno)</P>
<P>the compiler is saying "<EM>Access of shared member, constant member, enum member or nested type through an instance; qualifying expression will not be evaluated</EM>."</P>
<P>Am I barking up the wrong tree? Should I be approaching this in a different way?</P>
<P>Any help/suggestions would be much appreciated.</P>
<P>Thanks,</P>
<P>Graham</P>
<P>Here's the code I have in my customer business object.... if it's any help..</P>
<P>&nbsp;</P><FONT size=3>
<P>#</FONT><FONT color=#0000ff size=3>Region</FONT><FONT size=3> </FONT><FONT color=#800000 size=3>" Get Status"</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Public</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Shared</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Function</FONT><FONT size=3> GetStatus(</FONT><FONT color=#0000ff size=3>ByVal</FONT><FONT size=3> customerno) </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>String</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Dim</FONT><FONT size=3> result </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> GetStatusCommand</P>
<P>result = DataPortal.Execute(</FONT><FONT color=#0000ff size=3>Of</FONT><FONT size=3> GetStatusCommand)(</FONT><FONT color=#0000ff size=3>New</FONT><FONT size=3> GetStatusCommand(customerno))</P>
<P></FONT><FONT color=#0000ff size=3>Return</FONT><FONT size=3> result.myStatus</P>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Function</P></FONT><FONT size=3>
<P>&lt;Serializable()&gt; _</P>
<P></FONT><FONT color=#0000ff size=3>Private</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Class</FONT><FONT size=3> GetStatusCommand</P>
<P></FONT><FONT color=#0000ff size=3>Inherits</FONT><FONT size=3> CommandBase</P>
<P></FONT><FONT color=#0000ff size=3>Private</FONT><FONT size=3> mCUSTOMERNO </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>String</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Private</FONT><FONT size=3> mMyStatus </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>String</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Public</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>ReadOnly</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Property</FONT><FONT size=3> myStatus() </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>String</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Get</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Return</FONT><FONT size=3> mMyStatus</P>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Get</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Property</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Public</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Sub</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>New</FONT><FONT size=3>(</FONT><FONT color=#0000ff size=3>ByVal</FONT><FONT size=3> customerno </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>String</FONT><FONT size=3>)</P>
<P>mCUSTOMERNO = customerno</P>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Sub</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>Protected</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Overrides</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Sub</FONT><FONT size=3> DataPortal_Execute()</P>
<P></FONT><FONT color=#0000ff size=3>Using</FONT><FONT size=3> cn </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>New</FONT><FONT size=3> SqlConnection(Database.crm2k6Connection)</P>
<P>cn.Open()</P>
<P></FONT><FONT color=#0000ff size=3>Using</FONT><FONT size=3> cm </FONT><FONT color=#0000ff size=3>As</FONT><FONT size=3> SqlCommand = cn.CreateCommand</P>
<P>cm.CommandType = CommandType.StoredProcedure</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@CustomerNo"</FONT><FONT size=3>, mCUSTOMERNO)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@ContactNo"</FONT><FONT size=3>, </FONT><FONT color=#800000 size=3>""</FONT><FONT size=3>)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@SiteNo"</FONT><FONT size=3>, </FONT><FONT color=#800000 size=3>""</FONT><FONT size=3>)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@Status"</FONT><FONT size=3>, mMyStatus)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@Flag"</FONT><FONT size=3>, </FONT><FONT color=#800000 size=3>""</FONT><FONT size=3>)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@OptArg"</FONT><FONT size=3>, </FONT><FONT color=#800000 size=3>""</FONT><FONT size=3>)</P>
<P>cm.Parameters(</FONT><FONT color=#800000 size=3>"@Status"</FONT><FONT size=3>).Direction = ParameterDirection.Output</P>
<P>cm.CommandText = </FONT><FONT color=#800000 size=3>"C2K6_getstatus"</P></FONT><FONT size=3>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=3>"@CUSTOMERNO"</FONT><FONT size=3>, mCUSTOMERNO)</P>
<P>cm.ExecuteNonQuery()</P>
<P>mMyStatus = </FONT><FONT color=#0000ff size=3>CType</FONT><FONT size=3>(cm.Parameters(</FONT><FONT color=#800000 size=3>"@Status"</FONT><FONT size=3>).Value, </FONT><FONT color=#0000ff size=3>String</FONT><FONT size=3>)</P>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Using</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Using</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Sub</P></FONT><FONT size=3>
<P></FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Class</P></FONT><FONT size=3>
<P>#</FONT><FONT color=#0000ff size=3>End</FONT><FONT size=3> </FONT><FONT color=#0000ff size=3>Region</P></FONT>
<P>&nbsp;</P>
<P><BR>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, July 19, 2006</h2>gajit,<br><br>It seems as if you where using an instance of the object to access a Shared method.<br><br>This means:<br><br>Public Class MyClass<br>&nbsp;&nbsp;&nbsp; Public Shared Sub DoSomething()<br>&nbsp;&nbsp;&nbsp; End Sub<br>End Class<br><br><br>In your form:<br><br>Private mInstance as MyClass = New MyClass<br><br>&nbsp;&nbsp;&nbsp; Private Sub RunSomeOtherThing()<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 'This throws that error you see because you're <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 'accessing the method through an instance<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; mInstance.DoSomething()<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  'This does what you expect and is the correct approach <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 'for calling shared methods (through the class name)<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  MyClass.DoSomething()<br>&nbsp;&nbsp;&nbsp; End Sub<br><br><br>Andr√©s</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 19, 2006</h2>You are barking up the wrong tree if you ever intend to use the data portal. Unless your method is in a class that only exists on the server, you are violating a core princple of CSLA - putting data access code in a public method. At least on the surface, it appears that you are create a public method
that might be called by UI code, and in that method you are directly
talking to the database, and that's "illegal".<br><br>Data access code should always go into a DataPortal_XYZ method, or into a server-side data access assembly that is only called by a DataPortal_XYZ method.<br><br>If your business use case requires the retrieval of a string value as part of the overall process, then there should be an object that represents either that string value, or the command to get the value. The data access code should be in that object's DataPortal_Fetch() or DataPortal_Execute() method respectively.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Thursday, July 20, 2006</h2><P>I thought I might be ... (darn tree)...&nbsp;&nbsp; </P>
<P>I thought I had approached it correctly by placing the sub/function in my business class a la the obj.exists method - is this not a command? I do want to use the dataportal for this type of thing absolutelty,</P>
<P>I used the string value as a simplified example - I am in fact calling a stored procedure that runs off to another application to trigger a new order - the stored proc, merely returns a completion status (0=successfully populated the order entry module with data, 1=failed, etc...). So the value itself isn't persistent - I only need the value (and can only request it) when I want to 'place an order'.</P>
<P>Any help to put me on track would be appreciated...</P>
<P>thx,</P>
<P>gajit</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 20, 2006</h2>gajit, your code looks ok to me.&nbsp; It almost sounds like Rocky's reply actually belongs to another thread, where the poster wants to pass Ado.Net objects out of the business layer into the UI.&nbsp; Hopefully Rocky will post here again to clarify...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Thursday, July 20, 2006</h2><P>i thought so.. :)... well.. i had a suspicion...&nbsp;&nbsp; but didn't want to upset the boss :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 20, 2006</h2>Yeah, my bad... You are doing exactly what I suggested, making my suggestion rather pontless...  <img src="/emoticons/emotion-10.gif" alt="Embarrassed [:$]" /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Thursday, July 20, 2006</h2><P>Thanks Rocky ... no problem - good to know I'm on the right track - and incidentally - it works. I was trying to call an using a instance of the class and not the class itself.</P>
<P>Onwards I go....</P>
<P>gajit.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ktweedy replied on Thursday, July 20, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><BR>Data access code should always go into a DataPortal_XYZ method, or into a server-side data access assembly that is only called by a DataPortal_XYZ method.<BR></div></BLOCKQUOTE></P>
<P>I haven been thinking to seperate the data access routines into a assembly that only gets installed on the server.&nbsp; For two reasons, I can make changes to this code and only have to install a new DLL on the server, and second is kind of reducing risk of having something on the client that tells how the databse is imlpemented and could be disassembled.&nbsp;</P>
<P>So my question is do you have any thoughts on how to implement a server-side data access assemply.&nbsp; I would need to dynamically load this DLL so the client wouldn't have any referernces to it?&nbsp; I am thinking that the client execuatable can't have a reference to this DLL if it is not installed on the client.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 20, 2006</h2>Implement it just as you would if the DAL was going to be client side.&nbsp; Your BO assembly may have a reference to the DAL even. <br><br>On your client, the DAL assembly would be missing, but this wouldn't be a problem, as long as you're only accessing the DAL on the server, meaning that your BO may only reference DAL objects in the DataPortal_xxx methods.&nbsp; .Net won't try to load your DAL assembly until it actually needs it, so as long as you keep within the Csla framework, you'll be good to go.&nbsp; <br><br>Only your server would actually have the DAL assembly side-by-side with the business assembly.&nbsp; No need for dynamic loading or anything fancy like that. <br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ktweedy replied on Thursday, July 20, 2006</h2>Thanks, I'll have to give it a try.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ktweedy:</strong></div><div><p>So my question is do you have any thoughts on how to implement a server-side data access assemply.&nbsp; I would need to dynamically load this DLL so the client wouldn't have any referernces to it?&nbsp; I am thinking that the client execuatable can't have a reference to this DLL if it is not installed on the client.</p>
</div></BLOCKQUOTE><br><br>Having a reference isn't a problem - .NET lazy-loads assemblies. So your business assembly can reference the DAL without needing the DAL on the client.<br><br>However, that doesn't allow you to easily swap to a different DAL. That's why you need dynamic loading - so you can load the right DAL based on a configurable assembly name.<br><br>Remember, the data portal always routes your request through the DataPortal_XYZ methods, so it is the business object that must create the DAL.<br><br>Now you can abstract this. You could create a DalFactory assembly that did the dynamic loading of the actual DAL. The business assembly could reference the DalFactory and call it, knowing nothing about the actual DAL - which is not a bad idea because it means the business objects would need to know virtually nothing about the DAL itself.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ktweedy replied on Thursday, July 20, 2006</h2>Interesting, I appreciate the reply.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
