<html><header><title>Authorizations</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authorizations</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5561.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so posted on Thursday, October 09, 2008</h2>csla 3.5 .<br><br>I have the following,<br><br>BO:<br>Authorization rules added -<br>AllowCreate(typeof(BO));<br>DenyEdit(typeof(BO));<br>AllowDelete(typeof(BO));<br><br>BLB of this BO<br><br>UI: a datagridview bound to the BLB<br><br><br>How may I apply the authorization s.t. I allow the user to add any number of BO's to the list + edit any unsaved BO's; I allow delete any BO's from the list; <b>but I DISALLOW edit of existing BO's</b>?<br><br>And, please verify that I did specify the Authorization rules properly.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 14, 2008</h2>I would override CanWriteProperty:<br><br>protected override CanWriteProperty( string propertyName ) {<br>&nbsp;&nbsp;&nbsp;&nbsp; return !IsNew &amp;&amp; base.CanWriteProperty( propertyName );<br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so replied on Tuesday, October 14, 2008</h2>Yes, that would help.<br><br>I am still not sure how I may set the datagridview cells that are from the saved BO instances to readonly, and the new ones not readonly.<br><br>Can any1 help on this?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 14, 2008</h2>Ah... items in a grid.&nbsp; You should have some kind of RowInitialize or CellInitialize event from the grid.&nbsp; Hook up to that, and for each instance coming in set the cell's ReadOnly (or equivolent) based on the result of CanWriteProperty for the BO.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so replied on Tuesday, October 14, 2008</h2>Thanks! <br><br>I have come up with another approach, in each of the Set clauses of the properties, I have a IsNew check<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (IsNew)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;string&gt;(XXXProperty, value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><br>This seems to serve my objective also. But this means in the UI, users are allowed to edit the cells of a saved BO, just the value never gets updated after the edit, in contrast with a ReadOnly cell to disallow any edit at all.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, October 14, 2008</h2><P class=MsoNormal><SPAN>I suspect you would need to subscribe to CellBeginEdit event of the grid, test to see if underlying object is in new state, and set e.Cancel to true if not.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><B><SPAN>Sergey Barskiy<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><B><I><SPAN>Principal Consultant<o:p></o:p></SPAN></I></B></P>
<P class=MsoNormal><SPAN>office: 678.405.0687 | mobile:&nbsp;404.388.1899</SPAN><SPAN><o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 14, 2008</h2>I wouldn't go that route; you're silently ignoring a command to change the property value.<br><br>This means that developers can attempt to set that value, expect it to work, then wonder why the value is not changing.&nbsp; That could lead to hard to find bugs.&nbsp; If you ask an object to do something, you expect it to do what it's asked, or thrown an exception if the request is invalid.&nbsp; <br><br>I really recommend going the route suggested earlier; overridng CanWriteProperty (so everyone is clear that you can't change the value on the instance at this time as they'll get an exception if you call the property setter) and setting your UI properly to set the cell to readonly if CanWriteProperty returns false.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>k2so replied on Tuesday, October 14, 2008</h2>I agree, and not only to developer, I reckon users would be confused with the UI not able to update the values too.<br><br>I decided to use the method you suggested, with overriden CanWriteProperty and a check at BeginEdit to cancel the event if the object is not new.<br><br>Thanks ppl.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
