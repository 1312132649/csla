<html><header><title>How should I transfer a Child from ParentA to ParentB ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How should I transfer a Child from ParentA to ParentB ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7037.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky posted on Tuesday, June 02, 2009</h2>Hi all,<br><br>As the subject states, I'm trying to implement a method of transferring certain Child objects from a Parent to another one.<br><br>In the concrete, I want to transfer OrderDetails from one OrderHeader to another one. In the Database&nbsp; OrderDetails table, it would simply be a matter of changing the OrderHeaderID of the selected OrderDetails rows, but to do it using BOs implies more I guess.<br><br>I want to avoid having to delete the OrderDetails and recreate them, as this would cause Triggers to be fired that would cause unwanted side-effect (those Triggers are used to insert/update/delete ProductionOrderDetails in a one-to-one fashion with OrderDetails, and we don't want to delete/insert them).<br><br>So, if anyone could suggest a way....<br><br>Thank you.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, June 02, 2009</h2>I think you need to explain the use case a bit more. Because you don't say if you have both OrderHeader BOs in memory at the time you need to transfer the child BO. If neither is in memory then you just need a command object to do what you described as far as hitting the database an just changing the order detail row ID so it points to a different parent order hdr.<br /><br />If both are in memory it may matter if they are both editable or if one of them is a read only collection.<br /><br />So I think we need more information before we can provide solid advice.<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Wednesday, June 03, 2009</h2>Joe,<br><br>You are right. The problem is that I haven't decided yet on the exact use case, since I'd like to know if doing it with BOs is complicated.<br><br>Let's say I have the original Order BO in memory. I could simply use SPs to create a copy of the OrderHeader, and update the desired OrderDetails' FK to now point to the new OrderHeader. It would then be only a matter of reloading the BO. Simple enough.<br><br>On the other hand, let's say I have both BOs in memory, and that I pass a Child object between the two. Would I be able with minimum effort to treat this in such a way that it won't be sent back to the DB as both a delete and an insert ? If yes, then I might consider doing it "in memory".<br><br>Thanks for your time.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>shawndewet replied on Wednesday, June 03, 2009</h2><P><FONT face=Arial size=2>The CommandObject executing a change on the database would be the simplest; this obviously requires both order headers to exist at the time.</FONT></P>
<P><FONT face=Arial size=2>But it sounds like you are creating a new order header, and to get this new one into the DB for the CommandObject to work would of course require saving of this new order header first.&nbsp; I don't know about your business rules, but ours typically do not allow the saving of an orderheader if there are no detail lines.&nbsp; If you do have such a rule, you'd have to go the route of doing this "in memory".&nbsp; Load up the&nbsp;"source" OrderHeader along with its DetailLine collection.&nbsp; At this point, each detail line's IsDirty would be False, and the IsNew will be False.</FONT></P>
<P><FONT face=Arial size=2>Instantiate your new OrderHeader and set its properties as needed.&nbsp; Then add to it's DetailLines collection&nbsp;the detail line objects from the "source" OrderHeader.&nbsp; If at this point you call Save on the header, it won't also save the detail lines coz they're still "Clean".&nbsp; The way to get them "dirty" for the save&nbsp;would be to set their FK property to the new order header's ID.&nbsp; Of course if you're using database-assigned Identity fields here, you only know this new ID once you have saved the OrderHeader - in which case you can only set this property on the lines in the DataPortal_Insert of the header.&nbsp; Even so, doing it then is fine, and this will still cause the detail lines to be "dirty";&nbsp; the key though is that their IsNew is still False, causing the dataportal to Update them (instead of inserting them).&nbsp; That's it for the new orderheader.</FONT></P>
<P><FONT face=Arial size=2>As for the&nbsp;"source" OrderHeader, if you have removed the the detail lines from it's DetailLines collection, you once again end up with an OrderHeader with no lines, so business rules would/could/<STRONG>should</STRONG> prevent you from saving it.&nbsp; So I'd say here just call the static OrderHeader.DeleteOrderHeader(iPKToDelete) method, and then clear it from memory.&nbsp; (This database code here would (<STRONG>should</STRONG>)&nbsp;delete from the OrderHeader table the PK, and then delete from the detail lines table for the same orderheader, but by then there are no detail lines matching the given key to delete, so no harm done).</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
