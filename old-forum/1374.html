<html><header><title>Returning an Empty Object to a DetailsView</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Returning an Empty Object to a DetailsView</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1374.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtavares posted on Tuesday, October 03, 2006</h2>I was just wondering if there was a way to get the CslaDatasource to return what would be considered an empty data row to the detailsview.&nbsp; I am trying to use the EmptyDataText&nbsp; property on the Detailsview, and it appears that just passing my blank BO isn't good enough.&nbsp; The Detailsview still thinks it is an actual data row instead of an empty one and therefore displays all of the fields with blanks instead of the EmpyDataText.&nbsp; Is there something I have to do in the BO to tell the Detailsview it is actually empty?&nbsp; Any help would be appreciated.<br><br>Thanks,<br>Mike<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, October 03, 2006</h2><P>Try this.</P>
<P>Open DetailView --&gt; Edit Templates --&gt; Edit EmptyDataTemplate.&nbsp; Then in the little window type something like "No data available"</P>
<P>I don't work with DetailViews but&nbsp;I do use&nbsp;FormViews and GridViews and it works in those.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtavares replied on Tuesday, October 03, 2006</h2>Hi Jav,<br><br>Thanks for the response.&nbsp; Unfortunately, the problem for me is that the detailsview can't tell that my BO is empty, so it will never actually render what's in the EmptyDataTemplate.&nbsp; I'm looking for a way to let the DetailsView know that the BO being passed into it is the equivalent of an empty data row.<br><br>Thanks,<br>Mike<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, October 03, 2006</h2><P>Aah, now that I re-read your question I see that you were already trying to do what I was suggesting.&nbsp; I assume that CslaDataSource in question&nbsp;is supposed to return an Object, not a Collection.&nbsp; If that is the case, you are coming up against an issue which may require handling in the Factory method.</P>
<P>What happens is this.&nbsp; You call your Shared Factory GetObject method. By the time the code gets to your DataPortal_Fetch, the object is already created with whatever values you assign to the object's instance variables.&nbsp; (This is obvious because, after all, the DataPortal_Fetch is a method of that very object).&nbsp; Now in DataPortal_Fetch when the call goes out to the database, it comes back empty handed, and you end up with your blank object back in the factory method, which is then returned to the UI.</P>
<P>I suppose what you would like to get back is "Nothing" or Null - in which case I expect that DetailView will show the EmptyDataView stuff.&nbsp; You can achieve that by examining the object in the Factory method as it comes back from the DataPortal_Fetch for some key Instance variables - like the LastName being blank, and then return "Nothing" if that's the case.&nbsp; Do make sure that your UI is aware of that and always checks for Nothingness of all such objects before trying to use them.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtavares replied on Tuesday, October 03, 2006</h2>So if I understand you correctly, if I determine the object passed back from my BO fetch to be a blank, then I should set the e.BusinessObject in the CslaDatasource to nothing.&nbsp; Unfortunately, that doesn't seem to work.&nbsp; I get the following error:<br><h2><font size="4"><i>A data item was not found in the container. The container must either 
implement IDataItemContainer, or have a property named DataItem.</i></font></h2>Let me know if I misinterpreted your suggestion. It seems like there needs to be some mechanism to tell the detailsview that the object I'm passing to it is empty, but still be a valid object.<br><br>Thanks,<br>Mike<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, October 03, 2006</h2><P>Mike,</P>
<P>No, I was assuming that you have access to the Business layer, and I was simply trying to explain the reason why you are getting a "blank" object (instead of a Null object) when no data was found in the database, and how to return Nothing from the Factory Method.&nbsp; </P>
<P>You cannot set CslaDataSource to nothing - that won't work as you already saw.&nbsp; Normally, here is how you use the CslaDataSource.</P>
<P>&nbsp;&nbsp;&nbsp; Protected Sub PersonDataSource_SelectObject(ByVal sender As Object, ByVal e As Csla.Web.SelectObjectArgs) Handles PersonDataSource.SelectObject<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim obj As Person = GetPerson()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#ff0000>If obj IsNot Nothing Then</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.BusinessObject = obj<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#ff0000>End If<BR></FONT>&nbsp;&nbsp;&nbsp; End Sub<BR><BR>So in effect, normally, <EM>you leave e.BusinessObject alone</EM> if the Object returned from CslaDataSource is Nothing.&nbsp;Possibly you could try doing the same thing if the object returned is "blank"</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtavares replied on Tuesday, October 03, 2006</h2><P>I follow what you are saying, but even with the code that you just showed me, if your Person object is nothing and you don't set it to the datasource, you will still get the error because if e.BusinessObject is never set, it is still nothing and therefore the error I displayed earlier will still be thrown.&nbsp; </P>
<P>I guess maybe the question I should be asking is how does the DetailsView know if something is a blank data row or not, and what can I do in my business object to make it think it is a blank data row.</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Tuesday, October 03, 2006</h2>Concerncing the error message:<br>I've dealt with this before. The case is, when using CslaDataSource as the datasource on a *View Datasource / DataSourceID property, it tries to bind. And when it tries to bind, it expects a value. If it doesn't get a value, you get an error.<br><br>I'm not really into the internals of databinding or how rocky implemented CslaDataSource, but to avoid the error: do not databind if you know you have no object.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, October 03, 2006</h2><P>I just tried out a DetailsView for the first time. It lloks like:</P>
<UL>
<LI>If DetailsView has the DataSourceID set, it expects valid data to be available</LI>
<LI>It also looks like the DataKeyNames value must be set along with the DataSourcesID - if not, you will get an error</LI></UL>
<P>So here is what I did:</P>
<UL>
<LI>Dragged a CslaDataSource on to the designer, and set its values</LI>
<LI>Dragged a DetailsView on the designer and set its DataSourceID to CslaDataSource</LI>
<LI>Clicked EditFields and set all the fields that I needed</LI>
<LI>Went to properties window and deleted the DataSourceID to blank.&nbsp; It will ask if you want to regenerate the Fields - make sure to click NO</LI>
<LI>Now in the code that I gave in my previous message, set the DetailsView's DataSourceID and the DataKeyNames in the same code block <STRONG><EM>and after</EM></STRONG> setting the e.BusinessObject - and only if the Object is not nothing</LI></UL>
<P>In my quick test, I did not get any error, the Detailsview did not even show up - presumably because I did not set up EmptyData info.&nbsp; I am assuming that when the object is valid, everything will show up.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtavares replied on Tuesday, October 03, 2006</h2>That is a workaround, but still doesn't get the detailsview to show the emptydatatext, it just doesn't display at all.&nbsp; Upon some digging into the CslaDatasource,&nbsp; I found a way to get it to work by changing some code in the ExecuteSelect Method.&nbsp; The original code had the following:<br><br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' if the result isn't IEnumerable then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' wrap it in a collection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not TypeOf result Is IEnumerable Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim list As New ArrayList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.Add(result)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = list<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br><br>Now with the original code if result (the BO) is nothing, then when the control is bound to the detailsview that error occurs.&nbsp; But if I change it to:<br><br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' if the result isn't IEnumerable then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' wrap it in a collection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not TypeOf result Is IEnumerable Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim list As New ArrayList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If result IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.Add(result)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = list<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>Then I get the results I was looking for.&nbsp; the Details view will return the Empty Data Row because it is looking at an empty ArrayList instead of an arraylist with one item set to nothing.&nbsp; I decided to test this same thing out with a collection based BO with a gridview, and the results were still good where the Empty Data Row for the gridview was displayed.&nbsp; I also tried a bound dropdownlist and it was still ok.<br><br>So that being said, my next question if for Rocky:&nbsp; Are there any repercussions with only adding the result to the list if it is not nothing?&nbsp; My tests seemed to be fine, but I may not be accounting for something.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, October 03, 2006</h2><P>That's interesting.&nbsp; Mike you may want to post this in a separate thread so that Rocky will see it.&nbsp; That may be the answer to some of the tedious issues I have been facing with FormViews</P>
<P>Jav</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
