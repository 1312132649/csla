<html><header><title>CSLA 4 Asynchronous Business Rules in VB .Net</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4 Asynchronous Business Rules in VB .Net</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9064.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs posted on Thursday, June 10, 2010</h2><p>Hi all.</p>
<p>I am attempting to port code from CSLA 3.8 to CSLA 4.0. Having a bit of trouble with the new rules methodology regarding asynchronous rules.</p>
<p>Under 3.8 I implemented asynch rules as follows (yes, I&#39;m an atavist and still use VB .Net):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;Add Asynchronous no duplicate eMail check<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule(AddressOf eMailExists, New AsyncRuleArgs(eMailProperty))</p>
<p>Which used the following methods:</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared Sub eMailExists(ByVal context As AsyncValidationRuleContext)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim command As New cmdNewMemberEMailExists(context.PropertyValues(&quot;eMail&quot;))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim dp As DataPortal(Of cmdNewMemberEMailExists) = New DataPortal(Of cmdNewMemberEMailExists)()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler dp.ExecuteCompleted, AddressOf eMailExistsCompleted<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.BeginExecute(command, context)<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared Sub eMailExistsCompleted(ByVal sender As Object, ByVal e As DataPortalResult(Of cmdNewMemberEMailExists))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim context As AsyncValidationRuleContext = CType(e.UserState, AsyncValidationRuleContext)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.Error IsNot Nothing Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Description = &quot;Error checking for duplicate eMail Address.&nbsp; &quot; &amp; e.Error.ToString()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Severity = RuleSeverity.Error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Result = False<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.Object.ExistsKey &gt; 0 Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Description = &quot;This eMail Address is already registered!&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Severity = RuleSeverity.Error<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Result = False<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.OutArgs.Result = True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Complete()<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>I can&#39;t see how to translate that to the new BusinessRules.AddRule method.</p>
<p>Can anyone help me with what the new syntax is to achieve the same thing under CSLA 4? I tried to look at the Rolodex sample for CSLA 4, but it&#39;s still using the old method of ValidationRules that doesn&#39;t work.</p>
<p>&nbsp;</p>
<p>Thanks!</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, June 11, 2010</h2><p>Rules in CSLA 4 are now a type, not a method. The conversion process is the same in VB and C#:</p>
<ol>
<li>Create a class with the name of your rule</li>
<li>Inherit from Csla.Rules.BusinessRule</li>
<li>Put your rule code in an override of Execute()</li>
</ol>
<p>For simple rule methods, this is a pretty easy conversion, and you can see examples in my blog posts (in C#, but still, it is simple code).</p>
<p>For more complex rules this can take more work.</p>
<p>For async rules, you&#39;ll need a constructor, in which you set IsAsync to true. Again, my blog posts should be pretty instructive.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Friday, June 11, 2010</h2><p>You are the man, Rocky! Exactly what I needed - I&#39;ll be sure to check your Blog in the future as another resource.</p>
<p>I hope you and your family enjoy a much-deserved vacation next week!</p>
<p>- Greg</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
