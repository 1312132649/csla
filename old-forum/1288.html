<html><header><title>Biz rule for duplicate children in collection (CSLA 1.53)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Biz rule for duplicate children in collection (CSLA 1.53)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1288.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>etterre posted on Wednesday, September 20, 2006</h2><P>Hey, </P>
<P>&nbsp;&nbsp;&nbsp;I hope that someone out there has figured out this problem before - I've searched the old forum and this one and I seem to be coming up empy.&nbsp; </P>
<P>How can I "best" use the RuleManager/AddBusinessRules flavor of business rules to enforce a "no duplicate child in a collection" type rule?&nbsp; I can see how I could put an "instance type" rule on the collection and keep it to O(n) for each call to the rule.&nbsp; But I want the rule to be broken on all the affected children so that it's easy for the user to see which children are duplicates of each other.&nbsp; Most of the things I can think of get rather expensive...</P>
<P>My particular situation has a requirement that the particular combination of 3 properties on a child BO should be unique for all children in the collection.&nbsp; I also need to be pickier and have the rule "unbreak" no matter how it gets resolved (deletion of&nbsp;original, modification of a property on the original, deletion of&nbsp;dupe, etc).&nbsp; </P>
<P>At the moment we're "stuck" with VS2003 and VS2005 is probably 6 months to a year away.&nbsp; But I'd like to keep my code reasonably compatible with some of the changes in CSLA 2.x since we could be standardizing on VS2005 "soon" and I'd like the port to be as painless as possible...</P>
<P>Unfortunately my first whack at this problem&nbsp;uses BrokenRules.Assert calls as shown in the attached file (attached as combined.txt, split and rename to .vb)&nbsp;- and I know that those are going away...&nbsp; </P>
<P>I've tried to keep this short - let me know if more info would help.</P>
<P>Thanks!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 20, 2006</h2><P>I've done something like this really similar recently.</P>
<P>Since the collection has the "perspective" with which to validate/invalidate, I capture when the collection changes in a way that may affect the result - row inserted/deleted or onlistchanged when a particular couple properties change.</P>
<P>It is then the collection which has a&nbsp;validity checking method to survey the members to determine which (if any) are in an invalid state. I then have the collection communicate via an internal set property (get is public) of its members for whether the Seasonal info is valid for each particular member. </P>
<P>A validation rule then exists on the child members directly on the IsSeasonalValid - which is a rule that simply ensures it's true. If it's false, it's considered a broken rule. To me this works very well. </P>
<P>In my case, there are only a few members to check (less than 5). If you have a lot to check, perhaps it gets to be tooexpensive - perhaps you maintain a dictionary on the collection for the various item types in the list so that you can easily survey whether a change in the list breaks one or more records and be more efficient with the validity/invalidity setting. </P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 20, 2006</h2>I have to mention that I didn't notice until just now your question was with CSLA 1.53. I suppose a similar approach could be taken but not having worked with 1.53 I'm afraid I can't help you with that.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, September 20, 2006</h2>The basic concept you are using should work in 1.53 as well. Version 1.53 includes the automatic hook-up of IsDirtyChanged for all child objects by BusinessCollectionBase, and so the tools should be there to implement what you are describing.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
