<html><header><title>Help needed with child persistence</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Help needed with child persistence</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8479.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jpm posted on Thursday, February 04, 2010</h2><p>I have a parent BO which contains a list of child BO&rsquo;s.
The primary key of the parent BO is an integer (the real value is returned from the database when the object is persisted &ndash; like the Resource BO in the project tracker sample).
The child object&rsquo;s primary key is a complex key made up of the parent key and another integer that&rsquo;s value is determined by the DB on persistence. Both values are stored as read-only properties of the child object.
When DataPortal_Insert() is called on the parent BO it persists the parent data, updates its ID property then calls FieldManager.UpdateChildren(this) to persist the child objects.
My problem is how to I go about updating the matching id property on the children prior to calling FieldManager.UpdateChildren without having to make that property editable on the child.
I&rsquo;m sure I&rsquo;m being very dense here but any help would be greatly appreciated.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, February 04, 2010</h2>You should not need to store the ID value of the parent on the child object to begin with. Thats why you are passing the &quot;this&quot; pointer to FieldManager.UpdateChildren() method call.<br />
<br />
When Child_Create is called, it will be called with a reference to the parent (this) and you can get the parent ID value using that reference.<br />
<br />
Not sure if this is what you where asking, hope I did&#39;t misunderstand your question.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Thursday, February 04, 2010</h2>I think rxelizondo meant Child_Insert() instead of Child_Create, just in-case anyone was confused.<br />
<br />
Your method signature should probably look like this: Child_Insert(ByVal parent as RootObjectType)<br />
<br />
From there you could access the root level&#39;s id property, which would be populated from the original dataportal_insert().</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 05, 2010</h2>I'd probably just pass the key value directly, and not a reference to the parent to avoid coupling the child objects to the parent.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, February 05, 2010</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>I'd probably just pass the key value directly, and not a reference to the parent to avoid coupling the child objects to the parent.</div></BLOCKQUOTE></P>
<P>I do this.</P>
<P>But I recall reading that Rocky prefers to do it the opposite way! He likes to pass the Parent object instead of just the key.</P>
<P>In all the years I have been doing this I have never needed anything from the parent other than the key so I stopped passing the parent a long time ago.</P>
<P>YMMV</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 05, 2010</h2>Ya, in the end I think it comes down to personal preference.&nbsp; It'd be unusual to reuse one child between two different root objects (although I do have such a case).</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, February 04, 2010</h2>I have an intermediate base class between BusinessBase and my concrete object classes. <br /><br />I chose to solve this problem by implementing a virtual SetChildForeignKey() method (which the default implementation does nothing). The parent object invokes this for all child objects as part of it's persistence implementation. <br /><br />This allows the child object to use the parent object's key in any way it sees fit before it is actually saved.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jpm replied on Sunday, February 07, 2010</h2><p>Thanks everyone, I <strong>was</strong> being a bit dense but this is exactly what I was after.&nbsp; I my case my child objects may end up having more than one valid parent so I&#39;ll probably go for the loosly coupled option and just pass the key to the child_insert() method.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
