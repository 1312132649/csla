<html><header><title>Kerberos Delegation using Csla and WCF NetTCPBinding required change to Csla</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Kerberos Delegation using Csla and WCF NetTCPBinding required change to Csla</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7480.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MikeDouglasDev posted on Wednesday, August 19, 2009</h2>Hi,<br /><br />I am setting up Csla to use the Wcf.  I am hosting the Wcf service in a windows service so I can use NetTCPBinding.  I also want to use Kerberos delegation to delegate the client's credentials to the database server (2 hops).  I successfully got it working but I had to make a change to the methods in the WcfPortal to allow for Impersonation.  I had to add this attribute to the 4 methods<br /><br />	[OperationBehavior(Impersonation = ImpersonationOption.Allowed)]<br />	public WcfResponse Create(CreateRequest request) <br /><br />Before I made the change, I would get this error when the host was trying to Open.<br /><br />The service operation 'Create' that belongs to the contract with the 'IWcfPortal' name and the 'http://ws.lhotka.net/WcfDataPortal' 	namespace does not allow impersonation.<br /><br />I thought I read that the impersonateCallerForAllOperation="true" attribute in the serviceAuthorization behavior element would overrride the methods but it didn't work.<br />	<br /><br />Has anyone been able to get this to work without recompiling Csla?  <br /><br />I also tried subclassing the WcfPortal but I got this error, plus it seems like is more to maintain then simply adding the attributes. <br /><br />Service 'ImpersonateWcfPortal' has zero application (non-infrastructure) endpoints. This might be because no configuration file was found for your application, or because no service element matching the service name could be found in the configuration file, or because no endpoints were defined in the service element.<br /><br />Thanks,<br /><br />Mike<br /><br />http://www.CodeSmartNotHard.com</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MikeDouglasDev replied on Wednesday, August 19, 2009</h2>I figured out the error when I subclassed the WcfPortal class.  I forgot to change the service name in the config file.<br />    service name="BO.ImpersonateWcfPortal"<br /><br />instead of <br />    service name="Csla.Server.Hosts.WcfPortal"<br /><br />Unless someone else has another idea, I think we are going to do the subclass option.  Even though it is more code, it should keep the upgrades easier.<br /><br />Thanks,<br />Mike</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
