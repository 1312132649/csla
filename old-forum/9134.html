<html><header><title>ListBox ContextMenu Error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ListBox ContextMenu Error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9134.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini posted on Friday, June 25, 2010</h2><p class="MsoNoSpacing"><b style="mso-bidi-font-weight:normal;"><span style="font-size:small;"><span style="font-family:Calibri;">Tools &amp; Methodologies - .NET 4, Silverlight 4, CSLA 4, MVVM</span></span></b></p>
<p class="MsoNoSpacing"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNoSpacing"><span style="font-family:Calibri;font-size:small;">I need to add a ContextMenu to every item on a ListBox and associate each action item on the ContextMenu with a CSLA trigger action invoking a method in a ViewModel. Here is how I have the XAML (simplified) laid out in an attempt to do this.</span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ListBox</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> x</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:red;font-size:9.5pt;">Name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;lbAssetSummaryTemplate&quot;</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> DataContext</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;{</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">Binding</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> DomainAssetSummaryTemplate</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">,</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Mode</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=TwoWay}&quot;</span><span style="font-family:Consolas;font-size:9.5pt;"> <span style="color:red;">ItemsSource</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:blue;">}&quot; &gt;</span></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ListBox.ItemTemplate</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">DataTemplate</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">StackPanel</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Orientation</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;Horizontal&quot;&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;</span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">TextBlock</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Text</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;{</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">Binding</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">}&quot;/&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:blue;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp; </span>&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">controlsInputToolkit</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ContextMenuService.ContextMenu</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">controlsInputToolkit</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ContextMenu</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> x</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:red;font-size:9.5pt;">Name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;itemMenu&quot;&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun:yes;">&nbsp;</span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">controlsInputToolkit</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">MenuItem</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Header</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;Move Up&quot;</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> x</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:red;font-size:9.5pt;">Name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;btnMoveUp&quot;/&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">csla</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">TriggerAction</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Height</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;0&quot;</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;MoveASTFUp&quot;</span><span style="font-family:Consolas;color:red;font-size:9.5pt;"> Width</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=&quot;0&quot;</span><span style="font-family:Consolas;font-size:9.5pt;"> <span style="color:red;"><span style="mso-spacerun:yes;">&nbsp;</span>DataContext</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">StaticResource</span><span style="color:red;"> domainEditModel</span><span style="color:blue;">}&quot;</span><span style="color:red;"> TargetControl</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;"> ElementName</span><span style="color:blue;">=btnMoveUp}&quot;</span><span style="color:red;"> MethodName</span><span style="color:blue;">=&quot;MoveAssetSummaryTemplateFieldUp&quot;</span> <span style="color:red;">MethodParameter</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;"> ElementName</span><span style="color:blue;">=lbAssetSummaryTemplate,</span><span style="color:red;"> Path</span><span style="color:blue;">=SelectedItem}&quot; /&gt;</span><span style="color:#a31515;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;</span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">controlsInputToolkit</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ContextMenu</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">controlsInputToolkit</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">:</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ContextMenuService.ContextMenu</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">StackPanel</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">DataTemplate</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ListBox.ItemTemplate</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ListBox</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">However, this seems to be causing some unwanted issues. When I first load the screen, I get this warning - </span></p>
<p class="MsoNormal"><span style="mso-no-proof:yes;"></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;"><a href="http://docs.google.com/leaf?id=0B-Qwbn69ZX90MTgzMGYyZmEtMzdkYi00OTgyLTk2MmItOWMxNDFiOWVjNDli&amp;hl=en">http://docs.google.com/leaf?id=0B-Qwbn69ZX90MTgzMGYyZmEtMzdkYi00OTgyLTk2MmItOWMxNDFiOWVjNDli&amp;hl=en</a></span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">The entire error reads <span style="mso-spacerun:yes;">&nbsp;</span>-</span></p>
<p class="MsoNormal"><i style="mso-bidi-font-style:normal;"><span style="font-size:small;"><span style="font-family:Calibri;">Error: Unhandled Error in Silverlight Application </span></span></i></p>
<p class="MsoNormal"><i style="mso-bidi-font-style:normal;"><span style="font-size:small;"><span style="font-family:Calibri;">Code: 4009<span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span></span></span></i></p>
<p class="MsoNormal"><i style="mso-bidi-font-style:normal;"><span style="font-size:small;"><span style="font-family:Calibri;">Category: ManagedRuntimeError<span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></i></p>
<p class="MsoNormal"><i style="mso-bidi-font-style:normal;"><span style="font-size:small;"><span style="font-family:Calibri;">Message: Element is already the child of another element.<span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></i></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">If I click No I am able to proceed and everything else works fine. Anyone have any idea what I am doing wrong? </span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">Thanks</span></p>
<p class="MsoNormal"><span style="font-family:Calibri;font-size:small;">Ranjini</span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, June 25, 2010</h2><p>Try with beta 3, there was a bug in TriggerAction that caused trouble in a DataTemplate, and I wonder if you are hitting the same issue.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Friday, June 25, 2010</h2><p>I was excited about your suggestion and installed beta 3. Unfortunately, I am still getting the error.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 25, 2010</h2><p>In that case, can you provide an extremely simple solution that demonstrates the problem?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Ranjini replied on Tuesday, June 29, 2010</h2><p>Ok.. This might be a very useless posting, but I have resolved the problem. I wanted to create a sample solution to demonstrate the problem and was using the CslaMVVMSl solution to modify it in a manner that resembled my page. In doing so, I figured that with some work, I could get it work perfectly fine in that solution. I compared it to mine and realized the only thing&nbsp;I had&nbsp;different in that&nbsp;peice was, I had DataContext={StaticResource&nbsp;ViewModel} and the working solution had DataContext={Binding Source={StaticResource ViewModel}}. I&nbsp;was excited that this would fix my problem but when i made this change in my solution ,&nbsp;I realised&nbsp;I celebrated too soon. It had no effect on my problem.</p>
<p>After several hours worth of small changes, I figured out that it all came down to the DataContext tag and how it was being inherited/set. Visually and syntactically it all looked right, but since my page was very complicated with 3 viewmodels governing peices of it, somewhere there was a broken/missing peice.</p>
<p>So, I systematically analyzed top-down every DataContext tag and made sure I eliminated redundancies and streamlined it. I also made each one of the DataContext tags a binding (ie DataContext={Binding Source={StaticResource ViewModel}}) rather than a direct assignment (ie DataContext={StaticResource ViewModel}}) and it worked!!! Unfortunately, I cannot point my finger on what solved the problem and am not even sure at this point if it was a problem with something I did or a bug that I just managed to circumvent somehow. If there is anything I can answer to make this determination, please let me know.</p>
<p>In the mean time, my only advice to anyone getting this error is - track your DataContext tags !</p>
<p>Ranjini</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 29, 2010</h2><p>Troubleshooting the DataContext is way too hard in my opinion - and the problem you describe is the biggest issue I keep facing when building SL/WPF apps.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
