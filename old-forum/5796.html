<html><header><title>Activator.CreateInstance still being used in DataPortal</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Activator.CreateInstance still being used in DataPortal</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5796.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant posted on Wednesday, November 12, 2008</h2>Hi guys<br>I noticed that Activator.CreateInstance is still being used within the DataPortal. Previously this wouldn't have been that bigger deal as the proxies where being cached, but now the system will be creating new instances on every request. Hence, The Activator.CreateInstance in GetDataPortalProxy should probably be replaced with MethodCaller.CreateInstance(_proxyType).<br>Cheers<br>Anthony<br><br>Edit:<br>I think i have just had the best idea of a change that could happen here which would really help.<br><br><br><b>private static IDataProxyFactory _ProxyFactory;</b><br><br>private static IDataProxy DetermineDataPortalProxyAlt(bool forceLocal)<br>{<br>&nbsp;&nbsp;&nbsp; if (DataPortalClient.IsInDesignMode)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new DataPortalClient.DesignTimeProxy();<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (forceLocal)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new DataPortalClient.LocalProxy();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> if (!String.IsNullOrEmpty(ApplicationContext.DataPortalProxyFactory) &amp;&amp; _ProxyFactory == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type proxyFactoryType = Type.GetType(ApplicationContext.DataPortalProxyFactory, true, true);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ProxyFactory = (IDataProxyFactory)MethodCaller.CreateInstance(proxyFactoryType);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</b><br><br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_ProxyFactory != null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return portal = _ProxyFactory.Create();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.DataPortalClient.IDataPortalProxy portal;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string proxyTypeName = ApplicationContext.DataPortalProxy;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (proxyTypeName == "Local")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; portal = new LocalProxy();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (DataPortalClient._ProxyType == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortalClient._ProxyType = Type.GetType(proxyTypeName, true, true);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; portal = (IDataProxy)MethodCaller.CreateInstance(DataPortalClient._ProxyType);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return portal;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> }</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>This kills about 10 birds with 1 stone. Basically as you can see I have introduced MethodCaller.CreateInstance to help boost performance. But that got me thinking that this is being be used a lot now that the proxy is being called every time request is made. So what i was thinking was is there a way of statically doing this (for people that are only ever using the 1 proxy). So what I have introduced is a factory that is created once, and then is reused from then on. This would mean that factory could be created (if one so desirers) which creates the proxy instances statically. But when thinking about it, one might only be splitting hairs in terms of performance as MethodCaller is used quite a few time in the DataPortal.<br><br>But then I came across this http://forums.lhotka.net/forums/thread/28189.aspx just now and this would solve his problem exactly. This would allow developers to create there own version of IDataProxyFactory and register it in the web config.<br><br>Note, i didn't convert over the current code in the else block there, but it to could use IDataProxyFactory and be set by default if no other Proxy factory is found. <br><br>But more than that, I came across this http://forums.lhotka.net/forums/thread/28189.aspx just now and this would solve his problem exactly. This would allow developers to create there own version of IDataProxyFactory and register it in the web config.<br><br>Note, i didn't convert over the current code in the else block there, but it to could use IDataProxyFactoryand be set by default if no other Proxy factory is found.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 13, 2008</h2><P>Good idea - added to wish list</P>
<P><A href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=228">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=228</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
