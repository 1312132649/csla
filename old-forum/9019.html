<html><header><title>Authorization 4 (aka new authz)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authorization 4 (aka new authz)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9019.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Wednesday, June 02, 2010</h2><p>Hi Rocky,</p>
<p>I&#39;ve read your blog post about the new authorization system in CSLA.NET 4</p>
<p>We can have:</p>
<p>- per-type rules<br />- per-property rules<br />- per-instance rules</p>
<p>I have a few question:</p>
<p>1)<br />protected override void AddBusinessRules()&nbsp;{} is the method where we add per-type and per-property rules (authorization and plain business rules)?</p>
<p>2)<br />protected static void AddObjectAuthorizationRules() {} is the method where we add per-instance authorization rules?</p>
<p>3) The difference&nbsp;between type and property rules seems to be just the Authorization Action specified. Is this correct?</p>
<p>4) We can add property rules in both 1) and 2) methods. It looks like we can also have per per-instance property rules. Is this supposed to be like this? Will this work?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, June 02, 2010</h2><p>It is important to get the terms/definitions right:</p>
<ul>
<li>Per-type rules - these control the create/get/save/delete of a business object type</li>
<li>Per-instance - really applies to the save of a business object (since there is no instance yet for a create/get/delete operation); I don&#39;t really count &quot;per-instance&quot; as meaningful, since it is <i>exactly the same as per-type</i>, but the rule gets a reference to the actual object in the AuthorizationContext</li>
<li>Per-property - applies to an instance of an object, and to a specific property, and to a specific action (read or write)</li>
<li>Per-method - applies to an instance of an object, and to a specific method (with the action being execute)</li>
</ul>
<p>AddBusinessRules() is where you add per-property and per-method rules. This is the same as 3.8.</p>
<p>The static AddObjectBusinessRules() is where you add per-type (and &quot;per-instance&quot;) rules (since they are really the same thing). This is the same as 3.8.</p>
<p>You must add the per-type rules in the static method, because that&#39;s the only way they can be available before the first instance of the type has been created. Suppose your app is just starting up, and you want to enable/disable the &quot;Create Customer&quot; button. And suppose you add your per-type rules in AddBusinessRules(), which is run the first time a customer is created. So the UI thinks the user can create a customer, even though your actual rule might block that action...</p>
<p>If you set up the per-type rules in AddObjectAuthorizationRules(), then the rules are set up earlier - on the first access to the <i>type</i>, not an <i>instance of the type</i>. So as your app starts up the &quot;Create Customer&quot; button is disabled as expected.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Wednesday, June 02, 2010</h2><p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Hi Rocky, I&#39;m struggling with the same problem. I had placed my per-type rules in my AddBusinessRules method but the first time the system called HasPermission it ALWAYS returned true even if the user wasn&#39;t in the Admin role. Here is the code:</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:8pt;mso-bidi-font-size:9.5pt;">protected</span><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"> <span style="color:blue;">override</span> <span style="color:blue;">void</span> AddBusinessRules()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:blue;">base</span>.AddBusinessRules();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(CodeProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(CodeProperty, 10));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(DescriptionProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(DescriptionProperty, 100));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.CreateObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.EditObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.DeleteObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in 45.0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">}</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">I just read your response and I have now move the rules around like this:</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:8pt;mso-bidi-font-size:9.5pt;">protected</span><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"> <span style="color:blue;">override</span> <span style="color:blue;">void</span> AddBusinessRules()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:blue;">base</span>.AddBusinessRules();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(CodeProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(CodeProperty, 10));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(DescriptionProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(DescriptionProperty, 100));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:8pt;mso-bidi-font-size:9.5pt;">protected</span><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"> <span style="color:blue;">static</span> <span style="color:blue;">void</span> AddObjectBusinessRules()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.CreateObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.EditObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.DeleteObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">The problem is the three AddRule lines in the static AddObjectBusinessRules give the following error:</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-size:9pt;mso-bidi-font-size:11.0pt;"><span style="font-family:Calibri;">An object reference is required for the non-static field, method, or property &#39;Csla.Rules.BusinessRules.AddRule(Csla.Rules.IAuthorizationRule)&#39;</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">Can you tell me what I&#39;m doing wrong?</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">Thanks</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">Russ.</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">P.S. There appears to be a contradiction in your last post. You initially say that per-type rules go in the static AddObjectBusinessRules() and later you say they go in the AddObjectAuthorizationRules() method.<span style="mso-spacerun:yes;">&nbsp; </span>I have tried both with the same results.</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 02, 2010</h2><p>The static method is named AddObjectAuthorizationRules(). There is no AddObjectBusinessRules() - though maybe that should be changed to be consistent?</p>
<p>In any case, the problem you are hitting is that you need to disambiguate &quot;BusinessRules&quot; since it is a protected property of the base class, but you want to use the actual type from Csla.Rules:</p>
<p>Csla.Rules.BusinessRules.AddRule(...);</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Wednesday, June 02, 2010</h2><p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">Thanks Rocky!</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">Here is the working code for anyone who is following this thread:</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:8pt;mso-bidi-font-size:9.5pt;">protected</span><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"> <span style="color:blue;">override</span> <span style="color:blue;">void</span> AddBusinessRules()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:green;">// per-property and per-method rules go here</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:blue;">base</span>.AddBusinessRules();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(CodeProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(CodeProperty, 10));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">Required</span>(DescriptionProperty));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span>BusinessRules.AddRule(<span style="color:blue;">new</span> Csla.Rules.CommonRules.<span style="color:#2b91af;">MaxLength</span>(DescriptionProperty, 100));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:8pt;mso-bidi-font-size:9.5pt;">protected</span><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"> <span style="color:blue;">static</span> <span style="color:blue;">void</span> AddObjectAuthorizationRules()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:green;">// per-type rules go here</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">AddressCode</span>), <span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.CreateObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">AddressCode</span>), <span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.EditObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;"><span style="mso-tab-count:1;">&nbsp; </span><span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">AddressCode</span>), <span style="color:blue;">new</span> <span style="color:#2b91af;">IsInRole</span>(<span style="color:#2b91af;">AuthorizationActions</span>.DeleteObject, <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:blue;">string</span>&gt; { <span style="color:#a31515;">&quot;Admin&quot;</span> }));</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;tab-stops:9.0pt .25in 27.0pt .5in;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:8pt;mso-bidi-font-size:9.5pt;">}</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNoSpacing" style="margin:0in 0in 0pt;"><span style="font-family:Calibri;font-size:small;">Russ</span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BruderKotlett replied on Tuesday, July 05, 2011</h2><p>Hi,</p>
<p>I also have this problem. Here is my code:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected static void AddObjectAuthorizationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // CRUD --&gt; Create, Read, Update, Delete (Reading all user groups fomr the database)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BenutzerGruppeList gruppen = BenutzerGruppeList.GetBenutzerGruppeList();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; create = new List&lt;string&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; read = new List&lt;string&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; update = new List&lt;string&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; delete = new List&lt;string&gt;();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Put the groupd into my list objects, regarding CRUD permissions<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (BenutzerGruppe g in gruppen)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (g.BenutzerAnlegen)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; create.Add(g.Bezeichnung);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (g.BenutzerLesen)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read.Add(g.Bezeichnung);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (g.BenutzerBearbeiten)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; update.Add(g.Bezeichnung);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (g.BenutzerLoeschen)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete.Add(g.Bezeichnung);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Adding the rules to my &quot;Benutzer&quot; object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Rules.BusinessRules.AddRule(typeof(Benutzer), new Csla.Rules.CommonRules.IsInRole(Csla.Rules.AuthorizationActions.CreateObject, create));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Rules.BusinessRules.AddRule(typeof(Benutzer), new Csla.Rules.CommonRules.IsInRole(Csla.Rules.AuthorizationActions.GetObject, read));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Rules.BusinessRules.AddRule(typeof(Benutzer), new Csla.Rules.CommonRules.IsInRole(Csla.Rules.AuthorizationActions.EditObject, update));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Rules.BusinessRules.AddRule(typeof(Benutzer), new Csla.Rules.CommonRules.IsInRole(Csla.Rules.AuthorizationActions.DeleteObject, delete));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Here I&#39;m checking if the the user has permission...</p>
<p>if (Csla.Rules.BusinessRules.HasPermission(Csla.Rules.AuthorizationActions.CreateObject, typeof(Business.Benutzer)))</p>
<p>This returns always true. If I use for example &quot;Admin&quot; instead auf my &quot;create-List&quot; object, it will work. Do you have any suggestions for me?</p>
<p>Kind regards</p>
<p>Kevin</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BruderKotlett replied on Tuesday, July 05, 2011</h2><p>Ok. I got it :-)</p>
<p>My List&lt;string&gt; object count was 0, so the permission was always set to true. </p>
<p>Now I&#39;m checking the list count and if it&#39;s 0 I&#39;m adding a empty string.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
