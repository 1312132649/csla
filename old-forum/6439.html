<html><header><title>Save from a Toolbarbutton</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Save from a Toolbarbutton</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6439.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>l.vanderdonk posted on Tuesday, February 17, 2009</h2><P>Hi There,</P>
<P>Im very ;) new to Csla and tried an example from the book. It works fine when im using a standard windows forms button, but when im using a toolbarbutton the last field i entered will be cleared after the save operation. I hope im not nr gazilion asking this question.</P>
<P>Best Regards,</P>
<P>Laurens</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>public partial class InvoiceView : UserControl, ISave<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public InvoiceView()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();<BR>&nbsp;&nbsp;&nbsp;invoice = Invoice.NewInvoice();</P>
<P>&nbsp;&nbsp;&nbsp;BindUI();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;private Invoice invoice = null;</P>
<P>&nbsp;&nbsp;private BindingSourceNode _bindingTree = null;</P>
<P>&nbsp;&nbsp;private void BindUI()<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;_bindingTree = BindingSourceHelper.InitializeBindingSourceTree(this.components, invoiceBindingSource);<BR>&nbsp;&nbsp;&nbsp;_bindingTree.Bind(invoice);<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;public void Save()<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;if(SaveObject())<BR>&nbsp;&nbsp;&nbsp;&nbsp;MessageBox.Show("Object saved..");<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;public bool SaveObject()<BR>&nbsp;&nbsp;{<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;bool ret = false;<BR>&nbsp;&nbsp;&nbsp;_bindingTree.Apply();<BR>&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;invoice = invoice.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;ret = true;<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;catch (Exception ex)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;MessageBox.Show(ex.Message);<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;BindUI();<BR>&nbsp;&nbsp;&nbsp;return ret;<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;private void button1_Click(object sender, EventArgs e)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;SaveObject();<BR>&nbsp;&nbsp;}</P>
<P>&nbsp;&nbsp;&nbsp; }</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Tuesday, February 17, 2009</h2>I think your problem is that, for some reason, when you move focus from an input control to a toolbar button, the input control does not validate like it does when you move to another "normal" control.<br><br>The answer is simply to call this.Validate() in your toolbar button's click event. "this" referring to the form.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>l.vanderdonk replied on Tuesday, February 17, 2009</h2><P>Hi Tetranz,</P>
<P>That's it. Thanks a lot!!</P>
<P>Best Regards,</P>
<P>Laurens</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Tuesday, February 17, 2009</h2>I think this has probably bitten everybody at some point.<br><br>MS should document this in 3" tall, red blinking letters <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
