<html><header><title>Csladatasource binding Question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csladatasource binding Question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4908.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy posted on Wednesday, May 28, 2008</h2><P>Hi There,</P>
<P>Wondering if anybody has any ideas on this one. Here's where I'm confused.</P>
<P>1) I have a ultrawebgrid on an aspx page and a csladatasource that binds my business object collection to the grid on post back after a submit button is pressed. Works great.</P>
<P>2) I then went and added a "CheckBox" column to the grid and click submit and as long as I don't change the value by clicking on the checkbox everything works great. As soon as I check and uncheck checkboxes in the grid. The databinding failes saying that it can't find one of my libraries. The library it can't find would cause #1 to fail as well.</P>
<P>The actual Error is</P>
<P>[FileNotFoundException: Could not load file or assembly 'MyCompany.MyLibrary' or one of its dependencies. The system cannot find the file specified.]<BR></P>
<P>It took me for ever to figure out what was causing this error and have no idea how to solve it. I can click on the submit button as much as I was as long as I don't change the value of the checkbox from what it was set at when loaded.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 28, 2008</h2>Is this within a SerializationException?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, May 29, 2008</h2><FONT size=1>
<P><FONT face=Arial size=3></FONT>&nbsp;</P>
<P><FONT face=Arial size=3>Here is the full error from the event viewer. It's very strange. </FONT></P>
<P><FONT face=Arial size=3>The column with checkboxes binds correctly to the boolean value in the collection using the csladatasource and if I don't change any of the values the page submits correctly. </FONT></P>
<P><FONT face=Arial size=3>BUT</FONT></P>
<P><FONT face=Arial size=3>If I unselect or select another checkbox and then submit the form. I get the following error.<BR></FONT></P>
<P><FONT face=Arial size=3>Event code: 3005 </FONT></P>
<P><FONT face=Arial size=3>Event message: An unhandled exception has occurred. </FONT></P>
<P><FONT face=Arial size=3>Event time: 5/29/2008 9:40:38 AM </FONT></P>
<P><FONT face=Arial size=3>Event time (UTC): 5/29/2008 1:40:38 PM </FONT></P>
<P><FONT face=Arial size=3>Event ID: 994033e7d6824bc88d6b75e0d590b0cf </FONT></P>
<P><FONT face=Arial size=3>Event sequence: 15 </FONT></P>
<P><FONT face=Arial size=3>Event occurrence: 1 </FONT></P>
<P><FONT face=Arial size=3>Event detail code: 0 </FONT></P>
<P><FONT face=Arial size=3></FONT></P>
<P><FONT face=Arial size=3>Application information: </FONT></P>
<P><FONT face=Arial size=3>Application domain: /LM/W3SVC/1/Root/MyWebSite-1-128565419777970339 </FONT></P>
<P><FONT face=Arial size=3>Trust level: Full </FONT></P>
<P><FONT face=Arial size=3>Application Virtual Path: /MySite </FONT></P>
<P><FONT face=Arial size=3>Application Path: C:\Dev\MyCompany\MySite\ </FONT></P>
<P><FONT face=Arial size=3>Machine name:&nbsp;DEV </FONT></P>
<P><FONT face=Arial size=3></FONT></P>
<P><FONT face=Arial size=3>Process information: </FONT></P>
<P><FONT face=Arial size=3>Process ID: 4308 </FONT></P>
<P><FONT face=Arial size=3>Process name: aspnet_wp.exe </FONT></P>
<P><FONT face=Arial size=3>Account name: DEV\ASPNET </FONT></P>
<P><FONT face=Arial size=3></FONT></P>
<P><FONT face=Arial size=3>Exception information: </FONT></P>
<P><FONT face=Arial size=3>Exception type: FileNotFoundException </FONT></P>
<P><FONT face=Arial size=3>Exception message: Could not load file or assembly 'MyCompany.MyLibrary' or one of its dependencies. The system cannot find the file specified. </FONT></P>
<P><FONT face=Arial size=3></FONT></P>
<P><FONT face=Arial size=3>Request information: </FONT></P>
<P><FONT face=Arial size=3>Request URL: <A href="http://localhost/MySite/admin/search.aspx">http://localhost/MySite/admin/search.aspx</A> </FONT></P>
<P><FONT face=Arial size=3>Request path: /MySite/admin/search.aspx </FONT></P>
<P><FONT face=Arial size=3>User host address: 127.0.0.1 </FONT></P>
<P><FONT face=Arial size=3>User:&nbsp;DevUser </FONT></P>
<P><FONT face=Arial size=3>Is authenticated: True </FONT></P>
<P><FONT face=Arial size=3>Authentication Type: Csla </FONT></P>
<P><FONT face=Arial size=3>Thread account name: DEV\ASPNET </FONT></P>
<P><FONT face=Arial size=3></FONT></P>
<P><FONT face=Arial size=3>Thread information: </FONT></P>
<P><FONT face=Arial size=3>Thread ID: 1 </FONT></P>
<P><FONT face=Arial size=3>Thread account name: DEV\ASPNET </FONT></P>
<P><FONT face=Arial size=3>Is impersonating: False </FONT></P>
<P><FONT face=Arial size=3>Stack trace: at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)</FONT></P>
<P><FONT face=Arial size=3>at System.Reflection.Assembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)</FONT></P>
<P><FONT face=Arial size=3>at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)</FONT></P>
<P><FONT face=Arial size=3>at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)</FONT></P>
<P><FONT face=Arial size=3>at System.Reflection.Assembly.Load(String assemblyString)</FONT></P>
<P><FONT face=Arial size=3>at Csla.Web.CslaDataSource.GetType(String assemblyName, String typeName)</FONT></P>
<P><FONT face=Arial size=3>at Csla.Web.CslaDataSourceView.get_CanUpdate()</FONT></P>
<P><FONT face=Arial size=3>at Infragistics.WebUI.UltraWebGrid.UltraWebGrid.UpdateDBRow(UltraGridRow row, UltraGridRow oldRow)</FONT></P>
<P><FONT face=Arial size=3>at Infragistics.WebUI.UltraWebGrid.UltraWebGrid.ProcessChanges(StateChanges stateChanges, Boolean fireEvents)</FONT></P>
<P><FONT face=Arial size=3>at Infragistics.WebUI.UltraWebGrid.UltraWebGrid.RaisePostDataChangedEvent()</FONT></P>
<P><FONT face=Arial size=3>at System.Web.UI.Page.RaiseChangedEvents()</FONT></P>
<P><FONT face=Arial size=3>at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)</FONT></P>
<P></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 29, 2008</h2><P>Hmm.</P>
<P>I usually see this exception during deserialization of an object. But ultimately the core issue is in the way .NET tries to find pre-loaded assemblies when you attempt to get at a Type object by name.</P>
<P>Obviously deserialization needs to get a Type object by name to create an empty instance of your object type so it can deserialize data into that object.</P>
<P>What is happening here is that CslaDataProvider needs to find out if the target business object is "updatable", which it does by examining the Type object for the business object.</P>
<P>To do that, it needs to get the Type object, and it does that using the type name you provided at design time via the properties window or attribute on the CslaDataProvider tag in your aspx page.</P>
<P>Ultimately it calls the standard Type.GetType() method, which does all the real work. But this is exactly the point at which deserialization can fail too - so I suspect the core issue is the same, though there's one other possibility.</P>
<P>The likely core issue is that .NET has different ways of loading an assembly. Assemblies loaded each way are stored in a different list - for example there's a list for dynamically loaded assemblies. Oddly, Type.GetType() doesn't check all the lists - it only checks some of them - to find the requested assembly, and this causes the failure.</P>
<P>The other possible issue is that the UltraGrid might be creating its own AppDomain that doesn't use the same assembly probing path(s) as the normal ASP.NET AppDomain. You can run into issues along this line when using nunit for example, because nunit creates an AppDomain inside which your tests run.</P>
<P>OK.</P>
<P>So if it is the first issue, the solution would be to use the "Serialization bug workaround" code from EnterpriseServicesPortal. This code should be run ONCE per AppDomain, so probably in your web application startup event handler in global.asax. It hooks an event on the current AppDomain and does a more thorough search to find the assembly in the case that an assembly isn't found automatically.</P>
<P>That's easy enough to try - so give that a go and see if it fixes the issue.</P>
<P>If it doesn't fix this issue then I'm not entirely sure what to try...</P>
<P>In any case, the UltraGrid seems to be doing something very strange here to get the CslaDataProvider running in some context where it can't load assembly information...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Monday, June 02, 2008</h2><P>Hi Rocky,</P>
<P>Thanks for the great tip!.. Read up on the&nbsp; "Serialization bug workaround" and sure sounds like that's what is wrong. After reading up I didn't want the end user to have to configure anything but the web app. So I opted just to remove the csla data source and override the grid databinding and paging... Works great now!&nbsp; No more errors :)</P>
<P>Thanks again for the quick reply!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Monday, June 02, 2008</h2><P>Hi RangerGuy,</P>
<P>I'm running into something similar. You wouldn't happen to be using classes that are in the App_Code folder and specify a namespace would you?</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy replied on Thursday, May 29, 2008</h2><P>Thanks Rock I will try that :)</P>
<P>Here is the error reported by ASP. This is the error that displays instead of the page. I just noticed it's more detailed than the event viewer message</P>
<P>Could not load file or assembly 'MyCompany.MyLibrary'&nbsp; or one of its dependencies. The system cannot find the file specified. <BR>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </P>
<P>Exception Details: System.IO.FileNotFoundException: Could not load file or assembly 'MyCompany.MyLibrary'&nbsp; or one of its dependencies. The system cannot find the file specified.</P>
<P>Source Error: </P>
<P>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.&nbsp; </P>
<P>Assembly Load Trace: The following information can be helpful to determine why the assembly 'MyCompany.MyLibrary' could not be loaded.</P>
<P><BR>Assembly manager loaded from:&nbsp; C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorwks.dll<BR>Running under executable&nbsp; C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_wp.exe<BR>--- A detailed error log follows. </P>
<P>=== Pre-bind state information ===<BR>LOG: User = DEV\ASPNET<BR>LOG: DisplayName = MyCompany.MyLibrary<BR>&nbsp;(Partial)<BR>LOG: Appbase = <A>file:///C:/Dev/MyCompany/MySite/</A> </P>
<P>LOG: Initial PrivatePath = C:\Dev\MyCompany\MySite\bin<BR>Calling assembly : Csla, Version=2.1.3.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30.<BR>===<BR>LOG: This bind starts in default load context.<BR>LOG: Using application configuration file: C:\Dev\MyCompany\MySite\web.config<BR>LOG: Using host configuration file: C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet.config<BR>LOG: Using machine configuration file from C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\config\machine.config.<BR>LOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).<BR>LOG: Attempting download of new URL <A>file:///C:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/Temporary</A> ASP.NET Files/mysite/293577e4/bc069f76/MyCompany.MyLibrary.DLL.<BR>LOG: Attempting download of new URL <A>file:///C:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/Temporary</A> ASP.NET Files/mysite/293577e4/bc069f76/MyCompany.MyLibrary/MyCompany.MyLibrary.DLL.<BR>LOG: Attempting download of new URL <A>file:///C:/Dev/MyCompany/MySite/bin/MyCompany.MyLibrary.DLL</A>.<BR>LOG: Attempting download of new URL <A>file:///C:/Dev/MyCompany/MySite/bin/MyCompany.MyLibrary/MyCompany.MyLibrary.DLL</A>.<BR>LOG: Attempting download of new URL <A>file:///C:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/Temporary</A> ASP.NET Files/mysite/293577e4/bc069f76/MyCompany.MyLibrary.EXE.<BR>LOG: Attempting download of new URL <A>file:///C:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/Temporary</A> ASP.NET Files/mysite/293577e4/bc069f76/MyCompany.MyLibrary/MyCompany.MyLibrary.EXE.<BR>LOG: Attempting download of new URL <A>file:///C:/Dev/MyCompany/MySite/bin/MyCompany.MyLibrary.EXE</A>.<BR>LOG: Attempting download of new URL <A>file:///C:/Dev/MyCompany/MySite/bin/MyCompany.MyLibrary/MyCompany.MyLibrary.EXE</A>.</P>
<P><BR>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
