<html><header><title>Odd Behavior With StringLength</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Odd Behavior With StringLength</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11434.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonBock posted on Tuesday, June 26, 2012</h2><p>I&#39;m using the StringLength attribute on a property to ensure the value never goes beyond a certain length. I&#39;ve run into a strange scenario.<br /><br />* The user types in data into a text box that is bound to the BO property. So far, so good.<br />* The user types in data that goes beyond the expected length. I see a red border show up in the text box - again, this is expected.<br />* Now, the user changes something on the screen that fires a rule that makes the property change to <span class="remaining-body" style="display:inline;">string.Empty. This is also working as expected.<br />* However...I still see the StringLength broken rule, even though I&#39;ve confirmed that property getter is called and GetProperty is returning string.Empty.<br /><br />I&#39;ve got to be missing something obvious, but ... something doesn&#39;t seem right. Even though my rule sets the property to string.Empty via context.AddOutValue(), it seems like the BO has already decided that it&#39;s evaluated the StringLength rule and it still thinks it&#39;s broken.<br /><br />Am I not using the attribute correctly? Any insight is appreciated - TIA.</span> <a class="collapse-body yj-small" style="display:inline;"></a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, June 26, 2012</h2><p>Hi Jason, </p>
<p>Yes,&nbsp;I&nbsp;think you are using the attribute correctly.</p>
<p>Which Version of CSLA and UI?</p>
<p>Might be connected to the PropertyChangedMode (default WindowsForms in 3.x and earlier, Xaml in 4.x) that could cause UI and BO to loose sync. <br />Is the rule stilll broken in the BO? </p>
<p>If the rule that sets the field value to string.Empty is triggered from a &quot;dependent&quot; property than that may be the reason the field is not revaildated. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonBock replied on Tuesday, June 26, 2012</h2><p>Well, I found a hack... :)</p>
<p>Since the rules run for data annotation-based rules run at priority 0, and we use a base class for all business rules, I just set the priority to -1 so our rules would run first. That seemed to fix it, and our all tests pass, but this does feel a little hackish.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, June 26, 2012</h2><p>Well, if the rule that sets the property to string.Empty runs after the DataAnnotation rule that would explain the behavior. <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonBock replied on Tuesday, June 26, 2012</h2><p>Seems to. We&#39;ve never set the Priority level before, so all the rules were at 0. It was just an ordering issue.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
