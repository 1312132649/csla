<html><header><title>LoadProperty and Milliseconds</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LoadProperty and Milliseconds</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5569.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones posted on Friday, October 10, 2008</h2><P>When using LoadProperty&lt;SmartDate, DateTime?&gt;(myDateProperty, data.myDate) the milliseconds are ignored (set to zero).</P>
<P>I've traced this problem to the CoerceValue() method where the line 169, "tmp.Text = value.ToString();" ignores milisseconds.</P>
<P>Is this a known issue?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, October 10, 2008</h2><P>I think it depends on your default format string.</P>
<P>As I recall the default is short date.</P>
<P>If you want something different you can set it for each SmartDate or you can set it once for all SmartDates when the app starts up.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones replied on Friday, October 10, 2008</h2><P>I'm sorry, I don't see where to set a format string that would help.</P>
<P>When I call LoadProperty&lt;SmartDate, DateTime?&gt;(myDateProperty, data.myDate), Csla.CoerceValue() is eventually called and line 169, "tmp.Text = value.ToString();",&nbsp;uses the ToString() of the&nbsp;original DateTime? value (which is "10/10/2008 2:30:14 PM" without milliseconds) to create the tmp SmartDate that is then returned as the property's value.</P>
<P>Is there something that needs to be done to the original value (the DateTime?) so ToString() includes milliseconds?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Sunday, October 12, 2008</h2>Just a thought and I am not sure if this would work, but what happens if you create a new SmartDate class which inherits from the CSLA SmartDate. That what you can override the ToString implementation.<br><br>I am not sure if this would work, but it might - I would need to re-look at the CoerceValue code again, its been a while.<br><br>Hope that helps<br>Anthony<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TJones replied on Monday, October 13, 2008</h2><P>The offending ToString() is actually called on the loaded value (the DateTime) not the target, SmartDate value.</P>
<P>A solution, that appears to have&nbsp;low impact on the existing code,&nbsp;is&nbsp;to change line 169 of Csla.CoerceValue()&nbsp;to the following:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (value.GetType().Equals(typeof(DateTime)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp.Date = (DateTime)value;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp.Text = value.ToString();</P>
<P>This allows&nbsp;direct DateTime and DateTime? conversions to SmartDate,&nbsp;maintaining precision while null&nbsp;values, which are set to string.Empty in an earlier statement,&nbsp;are&nbsp;handled&nbsp;in the "else" (the original line if code).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 14, 2008</h2><P>Thanks for tracking down the details of this issue - I'll add it to the work list.</P>
<P><A href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=202">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=202</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
