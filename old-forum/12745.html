<html><header><title>CSLA Discussion</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA Discussion</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12745.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mayurimalgave posted on Friday, September 12, 2014</h2><p>Hello...</p>
<p>I have written a BO class viz. PersonEdit. It has PersonAddresses &amp; PersonPhones as child properties.</p>
<p>Each address or phone may have tags such as Home,Office,School.</p>
<p>The following DataPortal_Create() code runs successfully in Silverlight. But in wpf, it doesn&#39;t work. Can anyone tell me the reason behind it.&nbsp;</p>
<p>protected override void DataPortal_Create()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PersonAddressesEditList addressList = new PersonAddressesEditList();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var addressTag in AddressTagNVList.GetList())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PersonAddressEdit obj = DataPortal.CreateChild&lt;PersonAddressEdit&gt;(this.Id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.AddressTagId = addressTag.Key;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.AddressTagDescription = addressTag.Value;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.ShareUnshareContent = &quot;Share&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addressList.Add(obj);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PersonPhonesEditList phoneList = new PersonPhonesEditList();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var phoneTag in PhoneTagNVList.GetList())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PersonPhoneEdit obj = DataPortal.CreateChild&lt;PersonPhoneEdit&gt;(this.Id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.PhoneTagId = phoneTag.Key;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.PhoneTagDescription = phoneTag.Value;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.ShareUnshareContent = &quot;Share&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phoneList.Add(obj);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(PersonAddressesProperty,addressList);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(PersonPhonesProperty,phoneList);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.DataPortal_Create();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>For WPF,If I comment this code, then the Person object is saved.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 16, 2014</h2><p>If you comment out this code then your object is saved?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mayurimalgave replied on Tuesday, September 16, 2014</h2><p>Yes..If I comment this code, then only&nbsp;the Person object gets saved,but its children doesn&#39;t save.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, September 16, 2014</h2><p>Well, that&acute;s likely to be a problem in your code.</p>
<p>You try to pass the &quot;parent&quot; id in the DataPortal_Create method. I suspect that you will get the actual id in the DataPortal_Insert method and should pass this value down to the children in your code.</p>
<p>In order to make your code perform more optimized you should also do all the initialization of child objects in their Child_Create method and not set properties after the object is returned as:</p>
<p>&nbsp;</p>
<ul>
<li>BusinessRules.CheckRules() is called after Child_Create</li>
<li>BusinessRules is triggered for each property Set</li>
<li>And the properties is also Dirty before you return the object to the UI</li>
</ul>
<p>So IMO you should pass the adressTag/phoneTag object to the DataPortal.CreateChild method and NOT the this.Id.&nbsp;</p>
<p>this.Id will typically only be determined after the Save and should be passed on in DataPortal.UpdateChild / FieldManager.UpdateChildren so the child objects get their parent Id as a parameter.&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
