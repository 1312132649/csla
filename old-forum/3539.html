<html><header><title>IsValid and this.ValidationRules.CheckRules()</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsValid and this.ValidationRules.CheckRules()</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3539.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea posted on Friday, September 14, 2007</h2><P>I have an object which is definately not valid (e.g. a property has exceeded its max length). If I inspect the IsValid property, I get back true. If I call ApplyEdit() I still get back true. Now if I call the CheckRules() method for that object, IsValid is false.<BR>I have been good and have&nbsp;a custom&nbsp;BusinessBase class in which I will simply override IsValid and call CheckRules() prior to base.IsValid but it seems somehow weird that this is not the current behaviour...<BR>So could someone please point out&nbsp;if I am missing something out or am doing something wrong? Also, will severity levels mix anything up (when I start using them that is...)?</P>
<P>FYI I am using CSLA 2.1.4</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, September 14, 2007</h2><P>It sounds like you are not having your business rule triggered when your string changes and becomes invalid. Ensure that your PropertyHasChanged() method is getting fired in your string property's setter and ensure that your business rule is hooked up to the property correctly. The moment your string changes in the business object you should be triggering your validation rule... You'd be getting IsValid to flip to false when you do CheckRules because you're essentially firing all of your business rules off. </P>
<P>That's what I'd suggest based on what you wrote above... throw a breakpoint in your validation rule, and hop into your UI and change your control tied to the string property - if your validation rule doesn't fire, then there's a problem. </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, September 14, 2007</h2><P>Thanks for that. Actually based on your reply let me be more specific (sorry am a bit tired...). The problem is I have a Customer editable root object containing an Orders editable list object. Its one of the Orders that is not valid.</P>
<P>For that Orders object I am calling the PropertyHasChanged in the property in question and in the Customer.IsValid override I do check on both base.IsValid and Orders.IsValid.</P>
<P>Is it possible that when adding an Order in the Customer.OrderList that is not valid (not even sure that's possible) that Customer won't reflect that in its own IsValid?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 14, 2007</h2>Your root object does need to override IsValid and IsDirty to include the child list's state. This is described in Chapter 7 or 8. If you don't do the overrides, the child list's state won't impact the root object's properties and you'll have problems.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, September 14, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>triplea:</strong></div><div>
<P>For that Orders object I am calling the PropertyHasChanged in the property in question and in the Customer.IsValid override I do check on both base.IsValid and Orders.IsValid.</P>
<P></div></BLOCKQUOTE></P>
<P>Thanks Rocky but I was doing that already... <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dean replied on Friday, September 14, 2007</h2>Triplea,<br><br>Just to cover all the bases : Have you checked the actual order object that is not supposed to be valid to make sure it is not valid? If it is not valid then somewhere in your isvalid overrides there is something wrong.<br><br>You could put a breakpoint in the rule that doesn't seem to be firing and test that it is actually firing. Once it fires, check thru your object hierarchy and see if orders is not valid and then customer is not valid. <br><br>You could create a unit test to do this also.<br><br>Dean<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jhw replied on Friday, September 14, 2007</h2><P>Are you saying it should be invalid when it is new, but it showing valid. Or is it showing valid after the property has been set during use?</P>
<P>For new objects, you&nbsp;would of course call validationRules.checkrules in dataportal_create.</P>
<P>In the property you would call PropertyHasChanged.</P>
<P>&nbsp;</P>
<P>I don't know that calling apply edit should have any effect on the valid state, though cancel edit would</P>
<P>&nbsp;</P>
<P>Heath</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, September 14, 2007</h2><P>Heath</P>
<P>The object is not new and thanks for reminding me that I should call CheckRules() in the dataportal_create method (was not doing it but added it and the object is valid at creation). I am convinced I somewhere missed something but still think that it would make sense if CheckRules was fired automatically from within IsValid... </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jhw replied on Friday, September 14, 2007</h2><P>I would have to agree with Chris that the problem must be in making sure that you PropertyHasChanged is being called and that the correct authorization rule is giving you the valid/invalid result you expect.</P>
<P>As for whether the child list is not reflecting the state of all its children, that is not a problem. If any children are invalid then the list WILL be invalid.</P>
<P>&nbsp;</P>
<P>Heath</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
