<html><header><title>Loading child objects based on a property value</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Loading child objects based on a property value</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10862.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it posted on Thursday, November 10, 2011</h2><p>
<p>I have an Object &quot;Company&quot; having child objects &quot;AutoDealer&quot; and &quot;BankAccounts&quot;.</p>
<p>The company object have some properties. In those, there are two properties &quot;CompanyType&quot; and &quot;AccountType&quot;.</p>
<p>Both the child objects are of RelationTypes.Child | RelationTypes.Lazy</p>
<p>Now based on the companytype property the AutoDealer object should be instantiated.</p>
<p>In the same way the BankAccounts child object. Whenever the AccountType is set to Preferred Account then only the BankAccounts should be instantiated.</p>
<p>How can I form the BusinessRules so that the child objects are only available whenever the proper values are set on the related properties (CompanyType and AccountType)</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Thursday, November 10, 2011</h2><p>This sounds odd to me: loading through business rules. I fear having misunderstood your question.</p>
<p>Usually, while you fetch you have the values of&nbsp;CompanyType and AccountType read and can put that logic in the DataPortal_Fetch. And if you use lazy loading, you have UoW (ChildLoader) which do the load, and you can add your property there.</p>
<p>What do you mean with &quot;only available&quot;? Is not available an empty list or null. If you really want to load through BusinessRules, I would defined one on CompanyType as the primary property, getting the list through factory methods of AutoDealer and AddOutput to this affected/output property. </p>
<p>And a second BusinessRule for AccountType and BankAccounts.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it replied on Sunday, November 13, 2011</h2><p>Hi Stefan,</p>
<p><div style='padding-left: 50px;background-color:silver'><b> stefan cop<br></b></p>
<p>This sounds odd to me: loading through business rules. I fear having misunderstood your question.</p>
<p>Usually, while you fetch you have the values of&nbsp;CompanyType and AccountType read and can put that logic in the DataPortal_Fetch. And if you use lazy loading, you have UoW (ChildLoader) which do the load, and you can add your property there.</p>
<p>What do you mean with &quot;only available&quot;? Is not available an empty list or null. If you really want to load through BusinessRules, I would defined one on CompanyType as the primary property, getting the list through factory methods of AutoDealer and AddOutput to this affected/output property. </p>
<p>And a second BusinessRule for AccountType and BankAccounts.</p>
<div style="clear:both;"></div>
<p></div></p>
<p>Thanks for your reply.</p>
<p>I&#39;m sorry if my question is confusing. In our requirements we have a user registration use case. In that, there exists mandatory information that user has to provide at the time of registration. If the user selects the CompanyType as AutoDealer, then he has to enter the&nbsp;auto dealer&nbsp;information oherwise, that information is not required. In the same way he has to select the AccountType. (We have two types of accounts: Standard and Preferred). If the user selects the Preferred account then it&#39;s mandatory to enter at least One bank account information. This is the brief of the situation. Suggest me how can I implement the Business Rules/Events /any thing else that satisfies my requirement.</p>
<p>I&#39;m unable to find the examples of UoW in Project Tracker. I hope you could you provide me the links.</p>
<p>Thanks &amp; Regards,</p>
<p>SreeRam.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Monday, November 14, 2011</h2><p class="MsoNormal" style="margin:0cm 0cm 0pt;"><a name="_GoBack"></a><span lang="EN-US" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN-US;">Jonny provided a good example of an AuthorizationRule, which depends on a property, in this post: <a href="http://forums.lhotka.net/forums/p/10868/50695.aspx#50695">http://forums.lhotka.net/forums/p/10868/50695.aspx#50695</a>&nbsp;.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN-US" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN-US;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN-US" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN-US;">And for 4.1 (I don&rsquo;t know if it&rsquo;s still true for 4.2), you should override CachResult to return false, because your rule should check a property&rsquo;s value of the instances.</span></p>
<p><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">public</span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;"> </span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">override</span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;"> </span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">bool</span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;"> <b>CacheResult</b>&nbsp;{ </span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">get </span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;">{ </span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">return</span><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;"> </span><b><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;">false</span></b><span lang="EN" style="font-family:&#39;Courier New&#39;;color:#333333;font-size:10pt;mso-ansi-language:EN;">; } }</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN-US" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN-US;">The Authorization is enforced in Get/SetProperty(). Your property can test this in advance; see ebook 2 Objects p. 123.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">bool</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt;"> canRead = this.CanReadProperty(<span style="color:#31849b;mso-themecolor:accent5;mso-themeshade:191;">ProductEdit</span>.CityProperty); </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">bool</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt;"> canWrite = this.CanWriteProperty(<span style="color:#31849b;mso-themecolor:accent5;mso-themeshade:191;">ProductEdit</span>.CityProperty);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">And the for example: </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">public AutoDealer AutoDealer</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;get </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;{</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">CanReadProperty(Company.</span><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">AutoDealerProperty))</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return GetProperty(</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">Company.</span><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">AutoDealerProperty);</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;<span style="mso-spacerun:yes;">&nbsp; </span>// or whatever you want</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">&nbsp;&nbsp;&nbsp;}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span lang="EN" style="font-family:&#39;Courier New&#39;;font-size:10pt;mso-ansi-language:EN;mso-fareast-language:DE-CH;">}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;">Another option is to Load the appropriate value in DataPortal_Fetch. </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 0pt;"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;"><span style="mso-spacerun:yes;"></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Sunday, November 13, 2011</h2><p>In that case you should probably not use RealationShipTypes.Lazy. </p>
<p>Typicall - Lazy loading means that your child objects are loaded when UI (or any other code) needs to get the list/child. </p>
<p>That is not quite what you need it seems as you only want to create the child object when a certain condition is met. </p>
<p>I would consider to use AuthorizationRules as an alternative so that you can &quot;hide&quot; the objects unless the specific condition is met. </p>
<p>IE, my recommendation </p>
<p>1. Create the objects whenever necessary (lazy loaded in the Property getter)</p>
<p>2. Use Authz rules to hide the actual BO unless state is correct. When an Authz rule says you can not read property the default value (should be an empty list/child) will be returned to the UI.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it replied on Sunday, November 13, 2011</h2><p>Hi Jonny,</p>
<p>&nbsp;I&#39;m leaning towards the authorization rules. In that case I required an example of writing custom authorization rules. It would be help full to suggest the references where I can get the required info or examples.&nbsp;</p>
<p>Thanks for your support.</p>
<p>Thanks &amp; Regards,</p>
<p>SreeRam.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
