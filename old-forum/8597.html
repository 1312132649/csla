<html><header><title>Editable/Readonly</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Editable/Readonly</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8597.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrazerS posted on Monday, March 01, 2010</h2><p>I have two conceptual entities:&nbsp; Employee and Mailbox.</p>
<p>Employee is associated with 0,1..n Mailboxes.</p>
<p>There are two associative roles &quot;owner&quot; and &quot;reader&quot;.&nbsp; </p>
<p>In the underlying SQL database, there is a link table called MailboxView that links theEmployee and Mailbox tables and has an intersection data column of &quot;Role&quot;.</p>
<p>In the EF entity model, this link table is represented as data entity because there&nbsp;is an intersection&nbsp; data column&nbsp;&nbsp;- hence 3 EF entities:</p>
<p>Employee --&gt; MailboxView &lt;-- Mailbox</p>
<p>The relevant use-cases are:</p>
<p>1.&nbsp; An Employee can&nbsp;read and change&nbsp; Mailboxes for which their Role=&quot;owner&quot;</p>
<p>2.&nbsp;An Employee has read-only access to Mailboxes for which their Role=&quot;reader&quot;</p>
<p>Can anyone suggest the simplest pattern of business objects which implement this behaviour?</p>
<p>Can I, for example, have two collection objects - OwnerMailboxes, which is an ECC and ReaderMailboxes which is a ROC - both having Mailbox as items?&nbsp; I could use join queries on the entity model (per Julia Lehrman&#39;s article at: <a href="http://learnentityframework.com/LearnEntityFramework/tutorials/many-to-many-relationships-in-the-entity-data-model/">http://learnentityframework.com/LearnEntityFramework/tutorials/many-to-many-relationships-in-the-entity-data-model/</a></p>
<p>Is there a better pattern?</p>
<p>Frazer</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, March 03, 2010</h2><p>I vote against your plan to use the Mailbox child class in both the ECC and the ROC. Rocky has stated many times that the fact that two objects have many of the same properties is not a good enough reason to try to &quot;re-use code&quot;. I agree.</p>
<p>I agree that an Employee object should have two collections as you named them. And that they should be an ECC and an ROC.</p>
<p>The ECC should have an editable child BO named Mailbox.</p>
<p>But the ROC should have an internal class named MailboxInfo which has Public Get and Friend Set methods for each Property. It should also have 2 constructors:</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;Private Sub New()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;require use of factory methods<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Friend Sub New(ByVal dr As SafeDataReader)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mCode = Trim(.GetString(&quot;code&quot;))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</p>
<p>The Friend constructor is used by the ROC to populate each instance of the Info class.</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;RaiseListChangedEvents = False<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = False</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim dr As SafeDataReader = Nothing<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim strSQL As String = &quot;someSQL&quot;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr = New SafeDataReader(DAL.ExecuteReader(strSQL))</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; While dr.Read<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim info As New someInfo(dr)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Add(info)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End While</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New ApplicationException(&quot;Exception in myList DataPortal_Fetch.&quot;, ex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If dr IsNot Nothing Then dr.Close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try</p>
<p>HTH<br />Joe</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, March 03, 2010</h2><p>Normally I&#39;d agree, but in this case it seems like a case where you&#39;re opening a detail screen to which you only have readonly access.&nbsp; For example, in my system a user might be able to view everything about an Order, but never be able to edit it.&nbsp; I don&#39;t see a reason to create an identical screen, with an identical (but readonly) BO just to display the data.&nbsp; </p>
<p>The MailBox class could have an OwnerId property, and its only a few lines of business code which determines access, readonly or read / write.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, March 03, 2010</h2><p>If this is the same screen, and same object, with different authorization based on the user and object state, then it seems like the solution is to use the authorization subsystem?</p>
<p>Override CanWriteProperty() and return false if the user isn&#39;t authorized to manipulate the object? And override Save() to throw an exception if they try to save?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, March 03, 2010</h2><p>Is this question directed at me, or the OP?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>FrazerS replied on Wednesday, March 03, 2010</h2><p>Thanks to all who provided feedback on this one.</p>
<p>I think that approaching this as an authorization issue will work best for me.&nbsp; My OP failed to point out that Mailbox have Folders, Folders have Folders, Folders have Messages etc. etc.&nbsp; I need to provide a view of the entire structure that differs only in accessibility, based on the relationship between the Employee and a particular Mailbox.&nbsp; While I need to prototype this a bit further and see, for example, how CanWriteProperty is (or isn&#39;t) propagated to child objects, it seems more promising to take the tack suggested by Rocky.</p>
<p>Thanks again,</p>
<p>Frazer</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
