<html><header><title>Moving application context between backgroun worker and UI thread</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Moving application context between backgroun worker and UI thread</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10497.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Saman posted on Wednesday, July 06, 2011</h2><p>Hello </p>
<p>i have searched a lot about&nbsp; this issue but i didn&#39;t find my answer</p>
<p>i have a login form in my application and i used background worker in my login process. but when ui thread gets the control the application context is not initiated, in other word it has initiated in backgrounworker thread.</p>
<p>therefor i fetched the login information in the background worker thread and then create the principal object in the worked completed event as rocky mentioned in some posts &quot;You can never interact with UI elements in the actual work method - you 
can only interact with the UI in the progress or complete event handlers
 because those are on the UI thread&quot; but&nbsp; still i have not user credential in my UI thread! and when my ui forms try to create csla objects they got unauthorized exception</p>
<p>Thank you</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, July 07, 2011</h2><p>This is a pretty common issue in WPF apps, and the Csla.ApplicationContext.User property is designed to overcome the way WPF &quot;manages&quot; the application principal object.</p>
<p>I haven&#39;t encountered the issue in other UI environments. What UI technology are you using?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Saman replied on Thursday, July 07, 2011</h2><p>Thanks Rocky</p>
<p>i used&nbsp; Winforms technology</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, July 09, 2011</h2><p>Have you tried/are&nbsp;you using the Csla.Threading.BackgroundWorker?</p>
<p>The default System.Threading.BackgroundWorker will NOT transfer the ApplicationContext to the background thread and is the reason we added our own BackgroundWorker in the Csla.Threading namespace.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Saman replied on Saturday, July 09, 2011</h2><p>thanks a lot jonny thats it</p>
<p>i did not know about csla&#39;s background working</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Saman replied on Sunday, July 10, 2011</h2><p>Jonny i used CSLA.Threading.BW but the still i have that problem</p>
<p>what should i do please?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, July 11, 2011</h2><p>Could you create a sample project to illustrate your problem?<br /> It&#39;s much easier if we can see the code.</p>
<p>You should set Csla.ApplicationContext.User in your worker completed and make sure to tell Csla that your AuthenticationMode (app.config)&nbsp;is different from &quot;Windows&quot; (which in turn makes Csla send the ApplicationContext.User over the wire on DataPortal calls). Have a look at the ProjectTracker sample for how to use a custom principal and settings in app.config.</p>
<p>Remember also that your UI thread/ process will continue to run and possibly make other DataPortal calls before the BW has completed. </p>
<p>I&#39;d also recommend to initialize the ApplicationContext.LocalContext, ClientContext and GlobalContext in the startup method. <br />If not initialized before&nbsp;- then be aware that your WorkerCompleted EventArgs offer the GlobalContext as returned from the server (and your code must decide if it is going to update&nbsp;theGlobalContext&nbsp;on the UI thread&nbsp;in any way after the async process is completed).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
