<html><header><title>EditLevel Mismatch in CopyState</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditLevel Mismatch in CopyState</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10154.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mosgath posted on Thursday, March 10, 2011</h2><p>We are using CSLA 4.1.&nbsp; Our business objects are generated from the T4 templates.&nbsp; We are getting an EditLevel Mismatch in CopyState when we return an updated EditableBusinessBase class&nbsp; as criteria for an async&nbsp;Static Command.&nbsp; The class is originally part of the criteria object passed to the command.&nbsp;&nbsp;The return of the command includes an updated&nbsp;base class.&nbsp; When I look at the object model in the watch window, the Edit levels are different for the base class versus its child classes (EditableChildLists).&nbsp; I changed the template to add the &quot;DisableIEditableObject=true&quot; on the child classes (EditableChildBase) contructors .&nbsp; However, this is not available to be set for the BusinessListBase classes.&nbsp; I also attempted to clone the object before it was passed to the command and after the command received it, but still have the issue when the Async callback attempts to set the Business base class in the ui to the one from the command.&nbsp; So what can I set to cause the collections to Disable the IEditableObject or could this be caused by the way the ChildList objects are being initialized when the root base is created?</p>
<p><em><strong>Command Call in Silverlight Client:</strong></em></p>
<p>CriteriaObject criteria = new CriteriaObject();<br />criteria.Property1 = value;<br />criteria.Property2 = value;<br />criteria.BusinessObject = this.Model.Clone;</p>
<p>BusinessObject.CommandMethod(Criteria, (o, e) =&gt;<br />{<br />&nbsp;if (e.Error == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;this.Model = e.Object.BusinessObject;&nbsp;//Error occurs here.<br />&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;System.Windows.MessageBox.Show(e.Error.Message);<br />});</p>
<p><em><strong>Business Object Method to Call Command:</strong></em></p>
<p>public static void CommandMethod(CriteriaObject criteria, EventHandler&lt;DataPortalResult&lt;Command&gt;&gt; callback)<br />{<br />&nbsp;Command.Execute(criteria, callback);<br />}</p>
<p><em><strong>Collection Object Load:</strong></em></p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">internal static MyCollection Get(IEnumerable&lt;EZOrder.Data.MyChildItem&gt; data)<br />{<br />&nbsp;if (data == null)<br />&nbsp;&nbsp;return null;<br />&nbsp;return DataPortal.FetchChild&lt;MyChildItem&gt;(data);&nbsp;&nbsp;&nbsp;&nbsp;<br />}&nbsp;</pre>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mosgath replied on Thursday, March 10, 2011</h2><p>Additionally, when the Editable Root class is set to a property on the criteria object, it still has the valid Edit Level 2.&nbsp; However, once it is deserialized on the server, only the Editable Root class has an edit level of 0.&nbsp; Its children are Edit Level 2.&nbsp; It seems like it is inheriting the edit level from Criteria, but not passing it along to the grandchildren.&nbsp; Stingy Parents...&nbsp; <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>mosgath replied on Friday, March 11, 2011</h2><p>We ended up solving this by using the ManageObjectLifetime =false in the ViewModel classes since we don&#39;t use the N-Level Undo features in our app.&nbsp; </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
