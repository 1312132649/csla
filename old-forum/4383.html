<html><header><title>Building Graphs with Business Objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Building Graphs with Business Objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4383.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick posted on Wednesday, February 20, 2008</h2><font face="Arial">Hi, <br><br>I have a challenge and was wondering how other solved (would solve) this with CSLA.NET<br><br>I have a graph structure of nodes and edges:<br></font><ul><li><font face="Arial">Every node can have multiple parents connected by an edge</font></li><li><font face="Arial">And every node can have multiple children again connected by an edge</font></li><li><font face="Arial">There is always one root node and it's not allowed to create cycles.</font></li></ul><font face="Arial"><br>The prototype looks like this:<br><br><u><b>Tables:<br></b></u>Edges:<br>- NodeId (int)<br>- ChildNodeId (int)<br>Nodes:<br>- NodeId (int)<br>- NodeName (varchar())<br>- ...<br><u><b>Business objects:<br></b></u>- NodeList (EditableRootList)<br>-- Node&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(EditableChild)<br>--- EdgeList (EditableChildList)<br>---- Edge&nbsp;&nbsp; &nbsp; (EditableChild)<br><br><u>NodeList properties:<br></u></font><ul><li><font face="Arial">GetNodeList(int rootId): Get's all nodes and connected child edges through a recursive CTE. So we end up with a list of nodes each having a EdgeList with their children Edges (but otherwise unconnected to the actual children nodes).</font></li><li><font face="Arial">RootNodeId: Property is set via GetNodeList(int rootId)</font></li></ul><font face="Arial"><u>Node properties<br></u></font><ul><li><font face="Arial">Parents: gets nodes by asking the NodeList to return all Nodes which have the current node as a child</font></li><li><font face="Arial">Children: gets all child nodes by looping through the Edges in its EdgeList and then using the ChildNodeId property of the Edge to look up the Node in NodeList</font></li></ul><font face="Arial"><br>This works quite ok but the there are some difficulties with persisting the graph:<br></font><ul><li><font face="Arial">When calling NodeList.Update - NodeList cycles through the dirty Nodes and persists them with their corresponding EdgeList. This doesn't work for new inserted Nodes as all Nodes need to be inserted first before any new Edge is inserted (foreign key constraint)</font></li><li><font face="Arial">The primary key of the Node is set after it's inserted. Now all parent and child edges need to get the new primary key before they can be persisted</font></li></ul><font face="Arial">Other point </font><font face="Arial">which this solution doesn't cover</font><font face="Arial">:<br></font><ul><li><font face="Arial">&nbsp;Node's don’t get notification when a child changes</font></li><li><font face="Arial">There is the requirement for nodes to be able to summarize their children’s value for a certain property e.g. price.<br></font></li><li><font face="Arial"> There is the requirement for nodes to be able to inherit values from their parents e.g. color.<br></font></li></ul><font face="Arial"><br>I was wondering what other approaches you might have taken or would take. </font><font face="Arial"><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></font><br><font face="Arial"><br>Thanks a lot for your feedback, <br>Patrick<br><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, February 21, 2008</h2><P>Patrick,</P>
<P>1. Your posts are always interesting.</P>
<P>2. One thing you might consider is creating a Use Case Controller object. This is a normal root level BO which contains the other BOs you are discussing. </P>
<P>When you Create a New controller BO you might pass it the rootID and then it instantiates all the other BOs as normal.</P>
<P>The advantage you now have is that the controller has access to all the Bos in side of it and can enforce rules and such.</P>
<P>In this case you can also call DataPortal_Update on the controller BO and then you can decide within its Update method how to do the save of your objects.</P>
<P>Since the standard Save of your root BO fails you can now step back and do something different.</P>
<P>e.g. Loop over a child collection and insert all new nodes first, then insert Edges.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Thursday, February 21, 2008</h2><FONT face=Arial><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>1. Your posts are always interesting.</div></BLOCKQUOTE>Thank you<BR></FONT>
<P><FONT face=Arial><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>2. One thing you might consider is creating a Use Case Controller object.</div></BLOCKQUOTE>Yes very good idea.</FONT></P>
<P><FONT face=Arial>Here are some more threads on the topic<BR></FONT></P>
<UL>
<LI><FONT face=Arial><A HREF="/forums/thread/14301.aspx">http://forums.lhotka.net/forums/thread/14301.aspx</A></FONT> 
<LI><FONT face=Arial><A HREF="/forums/post/14287.aspx">http://forums.lhotka.net/forums/post/14287.aspx</A></FONT></LI></UL><FONT face=Arial>I'm still looking forward to some more feedback :)<BR><BR>Thanks a lot,<BR>Patrick</FONT><BR></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
