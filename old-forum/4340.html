<html><header><title>Help with CSLA Security</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Help with CSLA Security</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4340.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dantruj posted on Tuesday, February 12, 2008</h2><P>I have a question of design or best practice on using the CSLA security (CanAddObject, CanEditObject ...).&nbsp; The methods are static and check against static roles listed in the database.&nbsp; IsUserInRole("Admin").&nbsp; But what if all your users are the same but should only see their data?&nbsp; User1 and User2 can both be Admins in applicationA, but I dont want User1 to see User2's data.&nbsp; I know that the stored procedures should only return UserA's data when userA is logged in, but what if UserB calls a page page.aspx?Id = 20 and Id = 20 belongs to UserA?&nbsp; I have encrypted the query string and this should not happen but what if?&nbsp; How would the static security methods handle this situation? or should they?&nbsp; Maybe I should call a method called IsUsersData() which checks if the current user in context is the same as the user who created the record loaded in the BO.&nbsp; But this depends upon the UI making this call and the BO would not enforce this.&nbsp; Does anyone have a similiar problem or any suggestions on how to handle this sistuation.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>webjedi replied on Tuesday, February 12, 2008</h2><P>I'm just spit-balling here and while I am thinking it through there's an element of stink to it so keep that in mind.&nbsp; What if you define the role they are in as their login User1 or User2 in your membership provider and then check the context when you are in the CanEditObject do like: </P>
<P>IsUserInRole(Context.UserName.ToString());</P>
<P>Can recall the syntax of retrieving the context user name at the moment (in Microsoft Server 2008 Marketing Haze at the moment).</P>
<P>Though as I said eariler something seems wrong about accessing the context in the BO like this.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dantruj replied on Tuesday, February 12, 2008</h2>That's funny I did do something kinda like that.&nbsp; Except I made the security methods instance methods and not static.&nbsp; Then I did get the current user from context, then compared against the instance property (field) for the user who created the record.&nbsp; It works, but I wonder if this is the correct way to handle this.&nbsp; If the security methods are static and their roles that they access are static, then how do you handle the case of instance security?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>webjedi replied on Tuesday, February 12, 2008</h2><P>Just realized my pseudo example would always yield a true in the scenario described...lol...so don't do it my way.</P>
<P>Like this would be *better*:</P>
<P>IsUserInRole(_createdbyuserid);</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dantruj replied on Friday, February 22, 2008</h2>But if the CanAddObject(), CanGetObject(), CanDeleteObject() and CanEditObject() methods are static methods then you can't have the _createdByuserId instance field in those methods, right?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, February 23, 2008</h2><P>1. Yes the SP should have and ID parameter to return only the current user's data.</P>
<P>2. You should not pass the ID on the Query String. If you encrypt it then it should work fine. No one is going to hack it.</P>
<P>3. But there is no need to pass the ID. You already have it on every page. It is in the Custom Principal object which you used to authenticate the user. Simply pull the principal off the thread or out of Context and read the ID directly.</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
