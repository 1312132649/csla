<html><header><title>Sorting - Who's responsibility?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Sorting - Who's responsibility?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8345.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough posted on Wednesday, January 13, 2010</h2>Hi,<br><br>We are currently experiencing a problem where Undo/Cancel doesn't retain the order for child collections, as the deleted items are put back at the end of the collection.&nbsp; This has lead us to wonder what layer should be responsible for sorting these collections.<br><br>Currently we are sorting child collections via our database layer such as "created_on desc", but this breaks on undo in the UI.&nbsp; We have a lot of child collections on our BO's so if the UI is responsible for sorting, the UI dev has to remember to wrap all the collections.<br><br>So where should we do the sorting???<br><br>Should these collections be wrapped and sorted in the BO?&nbsp; How?<br>Should the ViewModel wrap and sort them?<br><br>TIA<br>Kevin<br><br>Csla 3.8 - WPF<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 13, 2010</h2><P>In almost all cases sorting is a UI concern. </P>
<P>Rarely is there a business requirement for sorting, though that can happen in batch processing sceanrios like invoice posting routines.</P>
<P>But the fact that sorting is a UI concern doesn't mean people don't frequently sort at the database level - in fact it is required in cases where paging is also used. But sorting at the database level is often a very efficient way to address the UI requirement - but the requirement still lives at the UI.</P>
<P>And generally speaking, if your UI allows different sorts, it is unlikely (again, unless you use paging) taht you'd go back to the database just to resort the items. That'd be inefficient, so usually the sort is just changed right there on the client.</P>
<P>Normally WPF would just do this for you, but as has been discussed on numerous other threads, CSLA collections inherit from BindingList&lt;T&gt;, not ObservableCollection&lt;T&gt;, so the auto-sorting doesn't work. In another thread this morning though, someone mentioned that Infragistics has a datagrid that does work with BindingList collections - something I think WPF should have done to start with...</P>
<P>CSLA 4 will address this issue by having two sets of collection base classes, and the default set will work with WPF (everything but Windows Forms actually).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Wednesday, January 13, 2010</h2>Thanks for the quick reply <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>Our particular problem only happens because of the undo.&nbsp; The user cannot sort the listbox contents and they are retrieved in created_on order, newest first.&nbsp; Therefore our standard behaviour of adding new items puts them at the beginning, they are always in order until an undo operation.<br><br>I think in this case the BO should be responsible for the sorting?&nbsp; Should the BO expose another list that is sorted and used for binding?<br><br>TIA<br>Kevin<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Wednesday, January 13, 2010</h2>Here's a thought... CSLA includes a class called SortedBindingList that can provide a sorted view into any IList. <br /><br />Perhaps you could create one of these and bind it to your list rather than the actual list provided by the BO.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Thursday, January 14, 2010</h2>Hello,<br /><br />hm, I'm not that sure, that sorting should be a UI concern, almost exclusivly.<br /><br />I give an example: let your app have a grid with a list of certain objects (say employee) presented to the user. He/she clicks (as used to) on a column header, let's say "age" property. Ok, asume it works as expected. But now he clicks on "print this employee list". What does he expect to be printed and most important: in what ranking! I'd guess in the same sorting as he sorted the grid before. Unfortunatly one has to do that work separatly to the objectlist that is handled to the report-engine.<br /> <br />So, I won't call that a requirement to the UI and it's controls (grid in this case), but to the underlying object, whereas the action is triggered by the UI. In that way similar to the delete functionality (marking the row header and pressing DEL). Triggered by the UI, but definitly done/represented by the object.<br /><br />Just my 2c<br /><br />Best wishes<br /><br />Volker</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Thursday, January 14, 2010</h2>In my root BO I plan to do the following:<br><br><font size="2" face="Courier New">private static PropertyInfo&lt;ChildList&gt; ChildListProperty = RegisterProperty(new PropertyInfo&lt;ChildList&gt;("ChildList", PropertyNames.ChildList));<br>private ChildList _ChildList<br>{<br>&nbsp;&nbsp;&nbsp; get { return GetProperty(ChildListProperty); }<br>&nbsp;&nbsp;&nbsp; set { SetProperty(ChildListProperty, value); }<br>}<br><br>[NonSerialized]<br>[NotUndoable]<br>private SortedBindingList&lt;ChildItem&gt; _childSorted;<br>public SortedBindingList&lt;ChildItem&gt; ChildList<br>{<br>&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; if (_</font><font size="2" face="Courier New">childSorted</font><font size="2" face="Courier New">== null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _</font><font size="2" face="Courier New">childSorted</font><font size="2" face="Courier New">= new SortedBindingList&lt;ChildItem&gt;(ChildList);<br>&nbsp;&nbsp;&nbsp; _</font><font size="2" face="Courier New">childSorted</font><font size="2" face="Courier New">.ApplySort("CreatedOn", ListSortDirection.Descending);<br>&nbsp;&nbsp;&nbsp; return _</font><font size="2" face="Courier New">childSorted</font><font size="2" face="Courier New">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; }<br>}<br></font><br>The fact I have to do this because of the Undo is annoying.<br><br>Will the binding to the UI still work, with regard to edits etc?<br><br>TIA<br>Kevin<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, January 14, 2010</h2>The sorted binding list holds references to all the object in the source list, so in theory this should work. <br /><br />The only possibly missing piece (and you'll just have to try it without doing this first) might be that you would override UndoChangesComplete() in your root BO and call ApplySort on your _childSorted member.<br /><br />Incidentally, some Grid controls, like the DevExpress XtraGrid, might take care of all this automatically in the UI without you having to do any of this, so it's possible that to some degree you're being forced into it by the choice of UI controls. </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, January 14, 2010</h2>I don't understand why you simply don't do that in the UI.&nbsp; After the user elects the undo, just call apply sort.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Friday, January 15, 2010</h2>Well this is the real question.<br><br>If the UI shouldn't re-sort the collection then the sorting code shouldn't be inside the UI, No?.&nbsp; The undo appends deleted items when restoring them hence I have to messy up my BO with wrappers around all my (non UI sortable) collections. <br><br>Kevin<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
