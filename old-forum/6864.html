<html><header><title>Strange SmartDate behaviour</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Strange SmartDate behaviour</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6864.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael posted on Tuesday, April 28, 2009</h2><font face="Arial"><font size="2"><font face="Courier New">DateTime? date = null;<br>var smartDate = new SmartDate(date, false);</font><br><br>You would expect <font face="Courier New">smartDate.IsEmpty == true</font> but it's not.<br><br>In the constructor the line:<br><font face="Courier New">_date = DateTime.MinValue;</font><br>should be<br><font face="Courier New">_date =&nbsp; emptyIsMin ? DateTime.MinValue : DateTime.MaxValue;</font><br><br>and in the Date property:<br></font></font><font face="Arial"><font size="2"><font face="Courier New">_date = DateTime.MinValue;</font><br>
should be<br>
<font face="Courier New">_date =&nbsp; EmptyIsMin ? DateTime.MinValue : DateTime.MaxValue;</font></font></font><br><font face="Arial"><font size="2"><br>The same applies to <font face="Courier New">public SmartDate(DateTime? value, EmptyValue emptyValue)</font><br><br>Or am I missing something?<br><br>Regards<br>Michael<br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, April 29, 2009</h2>Have you read the book on this?<br />As I recall there is some "interesting" initialization behavior required to make it work correctly. Not sure if this is part of that or not.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Wednesday, April 29, 2009</h2><font size="2" face="Arial">Hi Joe<br><br>I have just read the relevant pages from the book (p. 490 in particular).</font><font size="2" face="Arial"> I can see the interesting initialisation due to the idiosyncrasies of structs. However, I still think if you create a SmartDate using a constructor that specifies either <font face="Courier New">emptyIsMin </font>or an <font face="Courier New">EmptyValue</font>, but without a date value, the SmartDate should return <font face="Courier New">true</font> for <font face="Courier New">IsEmpty</font>. Currently, this only works if you pass in <font face="Courier New">emptyIsMin == true<font face="Arial"> </font></font>or <font face="Courier New">EmptyValue.MinValue</font>.<br><br>I discovered this through a unit test that was failing. I have a nullable date field in the database, being stored in the biz object in a SmartDate initialised with <font face="Courier New">EmptyValue.MaxValue </font>- infinitely far in the future, as Rocky says. In the Fetch method:<br><br><font face="Courier New">m_dateReturned = new SmartDate(data.DateReturned, m_dateReturned.EmptyIsMin);</font><br><br>If <font face="Courier New">data.DateReturned</font> is <font face="Courier New">null</font>, then <font face="Courier New">m_dateReturned.Text == "01-01-0001"</font> instead of empty string. Which means I'd have to check the value for null before constructing the SmartDate - but only where I want to treat empty dates as infinitely far in the future. I think this is inconsistent, and is pretty easily fixed. In fact, the method <font face="Courier New">SetEmptyDate(EmptyValue emptyValue)</font> already does what I described in my first post, it's just not called in <font face="Courier New">SmartDate(DateTime? value, bool emptyIsMin)</font> or <font face="Courier New">SmartDate(DateTime? value, EmptyValue emptyValue)</font> which looks like an oversight.<br><br><font face="Courier New">new SmartDate(EmptyValue.MaxValue)</font><br>should be the same as<br><font face="Courier New">new SmartDate(null, </font></font><font size="2" face="Courier New">EmptyValue.MaxValue</font><font face="Courier New">)</font><br><font size="2" face="Arial">but it's not.</font><br><font size="2" face="Arial"><br>Regards<br>Michael<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, April 30, 2009</h2>I think I have to agree that it should work the same way in either constructor.  The semantics seem off.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
