<html><header><title>Best Practice For Restricting Edits</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best Practice For Restricting Edits</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7943.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb posted on Wednesday, November 04, 2009</h2>I wanted to get some feedback on what the best way to conditionally lock down properties would be.  We have objects that are editable until some event happens.  <br /><br />Lets say we have an object that is editable until it's status is "Locked".  My initial thoughts were to just put a conditional in the SET of each property that should be read-only after "Locked" like:<br /><br />if (IsLocked()) {<br />     throw new Exception(....);<br />}<br /><br />Are there other ways that are better to handle this scenario or am I on the right track?<br /><br />Thanks,<br />Mike</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 04, 2009</h2>Your easiest option is probably to override CanWriteProperty() in that class and add your check for object state there. That way you leverage the existing features of CSLA .NET, including UI helpers like PropertyStatus.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb replied on Wednesday, November 04, 2009</h2>This is why I love this forum!  Thanks Rocky!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb replied on Wednesday, November 04, 2009</h2>This is working perfectly for locking it down, but now the problem is the mapping in the UI after the SET is locked.<br /><br />Is the best idea to remove each field conditionally from the mapping or is there a cleaner solution?<br /><br />Thanks,<br />Mike</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 04, 2009</h2>I'm not sure I understand your question.<br /><br />Also, the answer is different depending on your UI technology.<br /><br />The UI can ask the object whether the current user is authorized to read or<br />write to a property by calling the CanReadProperty() and CanWriteProperty()<br />methods on the business object. Using that information, the UI can<br />enable/disable/hide/whatever the UI control(s) corresponding to that<br />property.<br /><br />In XAML this is usually done through some fairly simple binding expressions<br />- and CSLA provides UI helpers like ObjectStatus and PropertyStatus to<br />combine these authorization rules with various other rules to make things<br />easier.<br /><br />In Windows Forms there's the ReadWriteAuthorizer control that automatically<br />enables/disables UI controls for detail forms, but you are on your own for<br />complex controls like a datagrid.<br /><br />In Web Forms you are really on your own, because there's no model for<br />creating extender controls or helper controls like in Windows Forms or XAML.<br />But it still isn't terribly complex code - you can see examples in<br />ProjectTracker\PTWeb.<br /><br />In ASP.NET MVC you are on your own, but this is usually pretty easy since<br />the view can just choose whether or how to render various UI elements based<br />on the CanReadProperty() and CanWriteProperty() results. In the MVC world<br />you are largely on your own to render the UI anyway, so this is a small bit<br />of extra effort for a lot of gain.s</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Wbmstrmjb replied on Wednesday, November 04, 2009</h2>Thanks Rocky.<br /><br />I was referring to the DataSource's Update call and mapping e.Values to the object.  The properties that are throwing an exception on CanWrite (now that it is overridden) are causing a problem.  Do I pull the values out of e.Values selectively based on whether CanWrite is false?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 04, 2009</h2>Yes, that's basically what you need to do.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
