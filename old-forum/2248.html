<html><header><title>Reports with Crystal Reports</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Reports with Crystal Reports</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2248.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb posted on Wednesday, January 31, 2007</h2>Has anyone created a report using crystal reports and CSLA without using a dataset but directly from the BO? I have put the report in my library of a web project and put the crystalviewer on an asp page allong&nbsp;with a CRdatasource control pointing to the report in the&nbsp;library. It does not work!(asks for connection details to the database). Probably I am&nbsp;doing something terribly wrong.&nbsp;I am using VS 2005 and CR XI R2 SP1. Any suggestions or help are more than welcome!!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2><P>George,</P>
<P>I've done Crystal Reports directly off of BO's, although in a Windows Forms app and not a web project.</P>
<P>When I've seen Crystal ask for the database login, it was because I didn't set the data source of the report via .SetDataSource(). I figured Crystal was asking where to get the data because it wasn't handed any.</P>
<P>Not sure if that's your issue though.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2>Thank you for your suggestion but I am still confused. In my library I have a messageRPT.rpt file which as a database field has the BO a root object containing childs. Then on an ASP page I place a crystallReportViewer and&nbsp; a crystalReportSource pointing to the messageRPT file. It is not clear where to pass the actual data (BO) to the report. It does not accept directly the BO as a datasource? </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2><P>Here's some code I have - never done it in a web app, but I'm guessing it's similar. Hope it helps anyway.</P>
<P class=MsoNormal><SPAN><SPAN>// ReportForm is a windows form that contains a Crystal<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>// report viewer.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>ReportForm</SPAN> rf = <SPAN>new</SPAN> <SPAN>ReportForm</SPAN>();<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>rf.Text = <SPAN>"Order Report"</SPAN>;<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>// OrderHeaderReport is a Crystal ReportClass.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>OrderHeaderReport</SPAN> report = <SPAN>new</SPAN> <SPAN>OrderHeaderReport</SPAN>();<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>// Set the viewer's report source to our report.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN>rf.crystalReportViewer1.ReportSource = report;<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>// Get the data. OrderHeader is a Csla.ReadOnlyListBase.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>OrderHeader</SPAN> order = <SPAN>OrderHeader</SPAN>.GetOrderHeader(_orderHeader.PK);<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>// Set the report's data to our business object.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN>report.SetDataSource(order);<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>rf.WindowState = <SPAN>FormWindowState</SPAN>.Maximized;<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>rf.Show();<o:p></o:p></SPAN></P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P><FONT size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2><P>Thanks for the steps, the confusion remains&nbsp;I have written the following code</P>
<P><FONT color=#0000ff size=2>Imports</FONT><FONT size=2> CrystalDecisions.CrystalReports.Engine</FONT></P>
<P><FONT color=#0000ff size=2>Imports</FONT><FONT size=2> CrystalDecisions.Shared</P></FONT><FONT color=#0000ff size=2>
<P>Imports</FONT><FONT size=2> Secretary.Library</P></FONT><FONT color=#0000ff size=2>
<P>Partial</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MessagesRPT</P>
<P></FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> System.Web.UI.Page</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> messagesReport </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> MessagesRPT&nbsp;&nbsp; 'that is the report</P>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> businessObject </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Secretary.Library.Subscriber</P>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Page_Load(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.EventArgs) </FONT><FONT color=#0000ff size=2>Handles</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.Load</P></FONT><FONT size=2>
<P>businessObject = Session(</FONT><FONT color=#a31515 size=2>"currentObject"</FONT><FONT size=2>)</P>
<P>myCrystalReportViewer.ReportSource = messagesReport</P>
<P>//The problem is that the messagesReport does not show the method SetDataSource. Instead it show a private method ob businessobject. That is what confuses me.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2><P>What does "<FONT size=2>MessagesRPT" derive from? I guess it's not a CrystalDecisions.CrystalReports.Engine.ReportClass?</FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2>Oh, looking at your code again, MessagesRPT is your web form, not the Crystal Report you designed, right?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2>No, it is the Crystal Report I designed</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2>I used the same name and that confused the system. I changed the name and now I get the data source name is invalid but I get the method to set the datasource.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2>Can you post more details regarding "the data source name is invalid "? Maybe the code and whether it's a compile-time or run-time issue.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2>Michael, thank you very much!!!! I found the answer you gave for the last error in <A HREF="/forums/thread/9081.aspx">http://forums.lhotka.net/forums/thread/9081.aspx</A>&nbsp;.As you state there it needs a List or a collection. So to finalize this your steps work fine and the object passed to the report must be a collection or a list. The overall process simplyfies the report creation with CSLA and crystal reports.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2><P>Oh, I think I've seen this before - does the exception say "The data source object is invalid."?</P>
<P>If that's the case, it could be because you're passing in an object in .SetDataSource() that Crystal doesn't like. I think the Crystal documentation is a little out of whack. Intellisense doesn't show an overload that takes a type of object, but you can pass in any object. The documentation doesn't show that an overload takes a type that implements IEnumerable, but that's what you pass in, so it would have to be a ReadOnlyList or something else that implements IEnumerable.</P>
<P>Even if you have only one object for your report, you need to wrap it in something that implements IEnumerable.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, January 31, 2007</h2><P>Heh, little late on that last response.</P>
<P>Glad you got it figured out.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>georgeb replied on Wednesday, January 31, 2007</h2>It is the name of the report in the library</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
