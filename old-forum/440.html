<html><header><title>Odd Remoting error - Security - BusinessPrincipal  ? ? </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Odd Remoting error - Security - BusinessPrincipal  ? ? </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/440.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift posted on Wednesday, June 21, 2006</h2><font size="3">"</font><font size="4"><font size="2"><font size="3">C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Server\\DataPortal.cs:line 84"<br><br>My application is in inetpub/wwwroot/HTRemotingHost/&nbsp;&nbsp; and so is&nbsp; csla.dll, and my BO assemblies, so why would it be referencing this location?&nbsp; Maybe its the .pdb&nbsp; debug files that carry an old location reference? <br><br>The main question is this exception message when I try to make a&nbsp; call to my BO's.&nbsp; I'm not sure why it would be saying this, because my HTPrinciple Class is of type BusinessPrincipalBase<br><br>"&nbsp; public class HTPrincipal : Csla.Security.BusinessPrincipalBase&nbsp; "<br><br></font></font></font><font size="4"><font size="2">ex.Message = <br>"Principal must be of type BusinessPrincipal, not System.Security.Principal.GenericPrincipal"<br><br><br><br>ex.StackTrace<br>"\r\nServer stack trace: \r\n&nbsp;&nbsp; at Csla.Server.DataPortal.SetContext(DataPortalContext context) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Server\\DataPortal.cs:line 282\r\n&nbsp;&nbsp; at Csla.Server.DataPortal.Fetch(Object criteria, DataPortalContext context) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Server\\DataPortal.cs:line 84\r\n&nbsp;&nbsp; at Csla.Server.Hosts.RemotingPortal.Fetch(Object criteria, DataPortalContext context) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Hosts\\RemotingPortal.cs:line 36\r\n&nbsp;&nbsp; at System.Runtime.Remoting.Messaging.StackBuilderSink._PrivateProcessMessage(IntPtr md, Object[] args, Object server, Int32 methodPtr, Boolean fExecuteInContext, Object[]&amp; outArgs)\r\n&nbsp;&nbsp; at System.Runtime.Remoting.Messaging.StackBuilderSink.PrivateProcessMessage(RuntimeMethodHandle md, Object[] args, Object server, Int32 methodPtr, Boolean fExecuteInContext, Object[]&amp; outArgs)\r\n&nbsp;&nbsp; at System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(IMes<br>sage msg, Int32 methodPtr, Boolean fExecuteInContext)\r\n\r\nException rethrown at [0]: \r\n&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)\r\n&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)\r\n&nbsp;&nbsp; at Csla.Server.IDataPortalServer.Fetch(Object criteria, DataPortalContext context)\r\n&nbsp;&nbsp; at Csla.DataPortalClient.RemotingProxy.Fetch(Object criteria, DataPortalContext context) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Client\\RemotingProxy.cs:line 100\r\n&nbsp;&nbsp; at Csla.DataPortal.Fetch(Object criteria) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Client\\DataPortal.cs:line 166\r\n&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\\Projects\\CSLA 2.0 projects\\CSLA 2.0\\Csla\\DataPortal\\Client\\DataPortal.cs:line 138\r\n&nbsp;&nbsp; at HorseTracker.Library.AnimalList.GetAnimalList() in C:\\Projects\\HorseTracker\\HorseTracker\\HorseTracker.Library\\AnimalList.cs:line 21\r\n&nbsp;&nbsp; at HorseT<br>racker.WinGUI.AnimalsGUIInfo.GetChildren() in C:\\Projects\\HorseTracker\\HorseTracker\\HorseTrackerWin\\MetaObjects\\AnimalsGUIInfo.cs:line 48"<br></font><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>Well this is strange, I setup the Project Tracker application for remoting, and it gives me the identical error as above.&nbsp; <br><br>Both applications work when set to a local data portal, and both give the same exception when set up for remoting! <br><br><br>&nbsp;<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 22, 2006</h2>Both your client and server config files need to have the same authentication setting (Csla). Having one side different (or not set at all) is the most common cause of this exception.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>Thanks Rocky, <br><br> I didn't have the csla authentication mode set on my client - but I do now...<br>It seemed to get me somewhere, because I was getting a different error saying it couldn't connect to the server (which is a different issue, I even physically bypassed my router when using my url, so I know its not the firewall). <br><br>When I plug in localhost to the config of the remoting host , I get the same type error as above. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>hmm.. well its a serialization exception.&nbsp; "Input stream is not a valid binary format".&nbsp;&nbsp; <br><br>I've checked my business objects to make sure they have the serializable attribute, as well as criteria classes..&nbsp;&nbsp; maybe there's a common overlook here as well?&nbsp; I know it has to be a simple configuration thing again...&nbsp;&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>http://localhost/HorseTrackerRemHost/RemotingPortal.rem?wsdl<br><br>According to this post:&nbsp; http://forums.lhotka.net/forums/thread/654.aspx<br><br>I should be able to tell more about if my data portal is working or not.&nbsp; But I am getting this error. <br><br><br>System.IO.FileNotFoundException: Could not load file or assembly 'CSLA.Server.DataPortal' or one of its dependencies. The system cannot find the file specified.
File name: 'CSLA.Server.DataPortal'
<br><br><br>Its right there!&nbsp; Its in the Bin directory.&nbsp; I even tried pulling it out into the root&nbsp; (HorseTrackerRemHost), rebuilding etc.&nbsp;&nbsp; They were put there via referencing them in my empty web project,&nbsp; with an appropriate config file.&nbsp;&nbsp; I even tried deleting all of them, and putting them in there manually (CSLA.dll, horseTracker.Library.dll, and Csla.XmlSerializers.dll went with it. <br><br>still nothing. <br><br>what a pain in the butt this is! <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 22, 2006</h2>




<DIV align=left><SPAN class=316331900-23062006><FONT face=Arial color=#0000ff size=2>Wait. It is looking for a file named 
Csla.Server.DataPortal? Are you running CSLA 1.x or 2.0? If 2.0, there's no such 
file, and so this would indicate that you have a typo in your config file where 
the type name and assembly name are reversed.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=316331900-23062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=316331900-23062006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>Using 2.0, that wasn't in there originally, I must have copied an old 1.* config by accident, what a long day. <br><br>heres's my config, and the current errors.&nbsp; <br><br><b>Config:<br></b><font size="2">&lt;?xml version="1.0"?&gt;<br>&lt;configuration&gt;<br>&nbsp;&nbsp;&nbsp; &lt;system.runtime.remoting&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;application&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;service&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;wellknown mode="SingleCall" objectUri="RemotingPortal.rem" type=" CSLA.Server.Hosts.RemotingPortal, Csla"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/service&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;channels&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;channel ref="http"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;serverProviders&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;provider ref="wsdl"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;formatter ref="soap" typeFilterLevel="Full"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;formatter ref="binary" typeFilterLevel="Full"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/serverProviders&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/channel&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/channels&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/application&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/system.runtime.remoting&gt;<br>&nbsp;&nbsp;&nbsp; &lt;appSettings&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;add key="CslaAuthentication" value="Csla"/&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/appSettings&gt;<br>&nbsp;&nbsp;&nbsp; &lt;system.web&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;compilation&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;assemblies&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;add assembly="System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;add assembly="System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;add assembly="System.Transactions, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;add assembly="System.Runtime.Remoting, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/&gt;&lt;/assemblies&gt;&lt;/compilation&gt;&lt;/system.web&gt;&lt;/configuration&gt;<br><br><br><br><br><br><b><font size="3">Error when Browsing to:&nbsp; http://localhost/HorseTrackerRemHost/RemotingPortal.rem?wsdl<br><br></font></b></font>System.Runtime.Remoting.RemotingException: Cannot load type 'CSLA.Server.Hosts.RemotingPortal, Csla'.
<br><br>and when I try to access it from my app, I get the serialization exception. "The Input stream is not a valid binary format"<br><br><br><br><b><br></b></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Thursday, June 22, 2006</h2>Ok, that was dumb,&nbsp;&nbsp; i had CSLA instead of Csla.&nbsp;&nbsp; So, now I can see the xml wsdl when navigating to it in my browser, but... I'm right back where I started with the BusinessPrincipal exception! <br><br>I checked the appsettings, and they're there on the client and the remoting host (as you can see above in the appsettings section). <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Friday, June 23, 2006</h2>I'm having the EXACT same issues when I try to run any nunit tests from within VS.&nbsp; Thinking I had royally screwed the pooch, I even reformatted my dev machine and re-installed everything. Viola, same problem.&nbsp; I don't know what to do.&nbsp; Using Csla 2.0.2.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Friday, June 23, 2006</h2>Try to do a logout before your first login, this should set the underlying 
thread.Principal to your Principal type instead of the default GenericPrincipal. 
It seems odd to do a logout first but give it a try anyway. <br><br>Remember, Csla doesn't care if you're authenticated or not, it just needs the right Principal/Indentity pair.<br><br>GuyRoch <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Sunday, June 25, 2006</h2>I swear there were a couple posts lost on this thread. <br><br>Anyways, the logout sounds like a hack because you should be able to get remoting to work without logging in.. or maybe this is a quirk with a remoting host.&nbsp;&nbsp; My error comes up if I log in or not, and if I do your suggested Logout then I get a dataportal_fetch error "object ref not set". <br><br>I think its one of two things - my .dlls aren't visible on my server, OR, there is something wrong with the serialization / deserialization in my code.&nbsp;&nbsp; <br><br>Maybe someone could offer a checklist of things to go through in my code as far as serialization - I know all Business Objects need to be marked serializable...&nbsp; anything else?&nbsp; Anything NonSerializable? <br><br>This is the biggest headache I've had in a while.. i have to fix this! <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Sunday, June 25, 2006</h2><P>Yep, server crash so a couple of posts might be lost in space</P>
<P><A HREF="/forums/thread/2280.aspx">http://forums.lhotka.net/forums/thread/2280.aspx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Tuesday, June 27, 2006</h2>Because I'm not able to figure out this problem - and the people who have put the effort in to help me on this haven't solved my problems the way they solved theirs with remoting, I'd like to offer an invitation to anyone who thinks they would like to test my remoting setup to see if they get the same errors - and maybe we can clarify this. <br><br>So, if anyone would like, please reply to this thread - (I can respond quickly because I will be notified on my blackberry) - and I will send you a copy of my project to see if you can get it working. <br><br>This is a project I'm doing pro bono so source code is completely open, and you can modify / use my project as you wish - although it really isn't complex at all ! <br><br><br>Hopefully someone has a spare half hour or so..&nbsp;&nbsp; thanks to those who have helped so far! <br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Tuesday, June 27, 2006</h2>Send me your solution, I'll give it try when I can a chance.&nbsp; I got my remoting to work with CSLA 2.0 a while back with no problems whatsoever.<br><br>Send to guyroch [no spam please] at gmail dot com.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Tuesday, June 27, 2006</h2>Hey<br /><br />Thanks for the help<br /><br />I will as soon as I recover my crashed pc lol. Perfect timing!<br /><br />Computers hate me these days<br /><br /><br /><br /><br /><br /><br /><br />Thanks, <br /><br />Brett Swift<br />(403) 861-2552<br />    <br /><br />-----Original Message-----<br />From: "guyroch" <br />Date: Tue, 27 Jun 2006 18:37:33 <br />To:"brettswift@gmail.com" <br />Subject: Re: [CSLA .NET] RE: Odd Remoting error - Security - BusinessPrincipal  ? ?<br /><br />Send me your solution, I'll give it try when I can a chance.&#160; I got my remoting to work with CSLA 2.0 a while back with no problems whatsoever.<br /><br />Send to guyroch [no spam please] at gmail dot com.<br /><br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brettswift replied on Wednesday, June 28, 2006</h2>Thanks GuyRoch - huge help.&nbsp; I knew it was just something stupid.... my config file -DB String in the client rather than the remoting host.&nbsp; I thought I had tried that previously but there must have been a different error at that time - because it works now. <br><br>phew<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Wednesday, June 28, 2006</h2><P>Brett, for the purpose of this thread and for the benefit of the entire CSLA community, I'm posting the steps I took to troubleshoot your GenericPrincipal issue your had with remoting in the hope that I might help somebody else in the future.</P>
<P>----- Start -----</P>
<P>I got it to work just fine Brett, I'm not getting any IPrincipal error<BR>when logged in.<BR><BR>Here's waht I did once I created the database and added a few data rows.<BR><BR>(1) I mocked the DataPortal_Fetch of your HTIdentity so that I would<BR>always log in<BR><BR>&nbsp; &nbsp; &nbsp; &nbsp;public void DataPortal_Fetch(Criteria criteria)<BR>&nbsp; &nbsp; &nbsp; &nbsp;{<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_name = "BOB";<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_isAuthenticated = true;<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_roles.Add("Administrator");<BR>&nbsp; &nbsp; &nbsp; &nbsp;}<BR><BR>(2) I added a connection string to you wed.config<BR><BR>&nbsp; &nbsp; &nbsp; &nbsp;&lt;connectionStrings&gt;<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;add name="HorseTracker"<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; connectionString="Data Source=(local);initial<BR>catalog=HorseTracker;user id=sa;password=p1234567;Connect Timeout=120"<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; providerName="System.Data.SqlClient" /&gt;<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;add name="Security"<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; connectionString="Data Source=(local);initial<BR>catalog=CjamSecurity;user id=sa;password=p1234567;Connect Timeout=120"<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; providerName="System.Data.SqlClient" /&gt;<BR>&nbsp; &nbsp; &nbsp; &nbsp;&lt;/connectionStrings&gt;<BR><BR>(3) I create a virtual directory in IIS and had it pointed to the web<BR>project and made sure the the http://.....?wsdl is working just fine.<BR>It did.<BR><BR>(4) I fired up the app and clicked on "Expand All" button. &nbsp;Sure<BR>enough I got the GenericPrincipal error. &nbsp;I was expecting this because<BR>I wasn't loogin just yet.<BR><BR>(5) The clicked on login and typed in a user name and password.<BR>Didn't really matter what Ityped in here because of step (1).<BR><BR>(6) Once logged in, I clicked the "Reload" button and then the "Expand<BR>All" button again.<BR><BR>(7) Works like a charm, the animals were listed.<BR><BR>Hope this helps. &nbsp;Let me know.</P>
<P>----- End -----<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Tuesday, September 12, 2006</h2><P>I could use some help here, too. I added the appropriate config section and Guy recommended, but I am still getting the file not found exception, and there is no Csla.Server.DataPortal.dll file.</P>
<P>There is a Csla.dll and the ProjectTracker.Library.dll, though.</P>
<P>I am just trying to get the sample project up and running.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Tuesday, September 12, 2006</h2><P>What's up Doc!</P>
<P>Send me you app.config file on your client and your web.config file on your remoting server and I'll see what I can do...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Tuesday, September 12, 2006</h2>BTW, Csla.DataPortal.Server is not a file, but rather a namespace in the Csla.dll assembly.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Tuesday, September 12, 2006</h2><P>Guy, this may be part of the problem.&nbsp; I am in the process of implementing CSLA with my place of work.&nbsp; I am at home and on a single box. </P>
<P>I am new to physically distributed applications. My assumption was that I could build on my machine and test the various scenarios in advance before I sell the boss on the idea to purchase another server, though I am sure he is sold on the idea we will eventually need to.</P>
<P>Working at home, on one box, is there still a way to test the remoting (serialized as binary) and webservice (remoting, serialized as soap)?&nbsp; Before I send you these files?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Tuesday, September 12, 2006</h2><P>You bet you can run w/ remoting on one box.</P>
<P>1) Create a web project and add the Csla.dll as a reference, and all of your BO dlls that you have created.&nbsp; Call you web project <FONT color=#ff0000><STRONG>MyRemotingTest</STRONG></FONT></P>
<P>2) Add a web.config file into this web project and configure it properly... add the following in the &lt;system.runtime.remoting&gt; section.</P>
<P><FONT color=#008000>&nbsp; &lt;system.runtime.remoting&gt; <BR>&nbsp;&nbsp;&nbsp; &lt;application&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;service&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wellknown mode="SingleCall" objectUri="<FONT color=#ff0000><STRONG>RemotingPortal.rem</STRONG></FONT>" type="Csla.Server.Hosts.RemotingPortal, Csla"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/service&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;channels&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;channel ref="http"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serverProviders&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;provider ref="wsdl"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;formatter ref="soap" typeFilterLevel="Full"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;formatter ref="binary" typeFilterLevel="Full"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/serverProviders&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/channel&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/channels&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/application&gt;<BR>&nbsp; &lt;/system.runtime.remoting&gt;</FONT></P>
<P>3) Go into IIS and create a virtual directory and call it <FONT color=#ff0000><STRONG>MyRemotingTest</STRONG></FONT><FONT color=#000000> and have it pointed to you web project&nbsp;.&nbsp;&nbsp; If you have both the .Net framework 1.1 and 2.0 install you'll have to set your virtual directory to use 2.0 - it uses 1.1 by default.</FONT></P>
<P>4) Test the remoting works by typing the following in your browser.</P>
<P><A href="http://localhost/MyRemoringTest/RemotingPortal.rem?wsdl">http://localhost/<FONT color=#ff0000>MyRemoringTest</FONT>/<FONT color=#ff0000>RemotingPortal.rem</FONT>?wsdl</A></P>
<P>If remoting works, you should get something similar to this...</P>
<DIV class=e><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <FONT color=#0000ff><SPAN class=m>&lt;?</SPAN><SPAN class=pi>xml version="1.0" encoding="UTF-8" </SPAN><SPAN class=m>?&gt;</SPAN></FONT> </DIV>
<DIV class=e>
<DIV class=c><A class=b href="http://localhost/Ojama.RemotingPortal/RemotingPortal.rem?wsdl#"><STRONG><FONT face="Courier New" color=#ff0000>-</FONT></STRONG></A> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><FONT color=#990000><SPAN class=t>definitions</SPAN><SPAN class=t> name</SPAN></FONT><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B>RemotingPortal</B><SPAN class=m><FONT color=#0000ff>"</FONT></SPAN><SPAN class=t><FONT color=#990000> targetNamespace</FONT></SPAN><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B>http://schemas.microsoft.com/clr/nsassem/Csla.Server.Hosts/Csla%2C%20Version%3D2.0.3.0%2C%20Culture%3Dneutral%2C%20PublicKeyToken%3D93be5fdc093e4c30</B><SPAN class=m><FONT color=#0000ff>"</FONT></SPAN><SPAN class=ns><FONT color=#ff0000> xmlns</FONT></SPAN><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B class=ns><FONT color=#ff0000>http://schemas.xmlsoap.org/wsdl/</FONT></B><SPAN class=m><FONT color=#0000ff>"</FONT></SPAN><SPAN class=ns><FONT color=#ff0000> </FONT></SPAN></DIV></DIV>
<P>5) Now that you have confirmed that remoting works, create client app and&nbsp;add the Csla.dll as a reference, and all of your BO dlls that you have created.</P>
<P>6) Add an app.config file to you client app and add to following in the &lt;appSettings&gt; section.</P>
<P>&nbsp; &lt;appSettings&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaAuthentication" value="Csla" /&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalProxy" value="Csla.DataPortalClient.RemotingProxy, Csla"/&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalUrl" value="<A href='http://localhost/MyRemoringTest/RemotingPortal.rem"/'>http://localhost/<FONT color=#ff0000>MyRemoringTest</FONT>/<FONT color=#ff0000>RemotingPortal</FONT>.rem"/</A>&gt;<BR>&nbsp; &lt;/appSettings&gt;</P>
<P>7) Voilà, remoting should work.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Wednesday, September 13, 2006</h2><P>I am trying to get this to work with the actual ProjectTracker sample, too. </P>
<P>I have the PTWin app working and ran into the same problem Brett did at login with the WebApp. I got the serialization error.</P>
<P>When I set up the web.config file with the ProjectTracker sample like this:</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CslaAuthentication</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Csla</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CslaDataPortalProxy</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Csla.DataPortalClient.RemotingProxy, Csla</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CslaDataPortalUrl</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>http://localhost/PTWebVB/RemotingPortal.rem</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;!--</FONT><FONT color=#008000 size=2>&lt;add key="CslaDataPortalProxy" value="Csla.DataPortalClient.WebServicesProxy, Csla"/&gt;</P>
<P>&lt;add key="CslaDataPortalUrl" value="http://localhost:3137/WebServicesHost/WebServicePortal.asmx"/&gt;</FONT><FONT color=#0000ff size=2>--&gt;</P>
<P>&lt;!--</FONT><FONT color=#008000 size=2> &lt;add key="CslaDataPortalProxy" value="EnterpriseServicesHost.EnterpriseServicesProxy, EnterpriseServicesHostvb"/&gt; </FONT><FONT color=#0000ff size=2>--&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>connectionStrings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>name</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>PTracker</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>connectionString</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Data Source=(local);Initial Catalog=PTracker;Integrated Security=True;</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>providerName</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>System.Data.SqlClient</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>name</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Security</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>connectionString</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Data Source=(local);Initial Catalog=PSecurity;Integrated Security=True;</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>providerName</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>System.Data.SqlClient</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>connectionStrings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>system.runtime.remoting</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>application</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>service</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>wellknown</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>SingleCall</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>objectUri</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>RemotingPortal.rem</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>type</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CSLA.Server.Hosts.RemotingPortal, Csla</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>service</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>channels</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>channel</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>http</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>serverProviders</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>provider</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>wsdl</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;!--</FONT><FONT color=#008000 size=2> TODO: comment the following two lines for .NET 1.0 </FONT><FONT color=#0000ff size=2>--&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>formatter</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>soap</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>typeFilterLevel</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Full</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>formatter</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>binary</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>typeFilterLevel</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Full</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>serverProviders</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>channel</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>channels</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>application</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>system.runtime.remoting</FONT><FONT color=#0000ff size=2>&gt;</P>
<P></FONT></FONT>
<P><FONT color=#0000ff size=2></P></FONT></P>
<P>I get this error when I type <A href="http://localhost/PTWebVB/RemotingHost.rem?wsdl">http://localhost/PTWebVB/RemotingHost.rem?wsdl</A></P>
<P>System.Runtime.Remoting.RemotingException: Cannot load type 'CSLA.Server.Hosts.RemotingPortal, Csla'.<BR>&nbsp;&nbsp; at System.Runtime.Remoting.RemotingConfigHandler.RemotingConfigInfo.LoadType(String typeName, String assemblyName)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.RemotingConfigHandler.RemotingConfigInfo.GetServerTypeForUri(String URI)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.RemotingConfigHandler.GetServerTypeForUri(String URI)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.RemotingServices.GetServerTypeForUri(String URI)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.Channels.Http.HttpRemotingHandler.CanServiceRequest(HttpContext context)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.Channels.Http.HttpRemotingHandler.InternalProcessRequest(HttpContext context)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Wednesday, September 13, 2006</h2><P>I got it!</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>wellknown</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>SingleCall</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>objectUri</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>RemotingPortal.rem</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>type</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><STRONG><U><FONT color=#800080>CSLA</FONT></U></STRONG>.Server.Hosts.RemotingPortal, Csla</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P></FONT>
<P>has to be changed to</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>wellknown</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>SingleCall</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>objectUri</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>RemotingPortal.rem</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>type</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><STRONG><U><FONT color=#800080>Csla</FONT></U></STRONG>.Server.Hosts.RemotingPortal, Csla</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Wednesday, September 13, 2006</h2>Glad to see you got it to work.<br>
<br>
Yeah, I too find it somewhat stupid that is case sensitive.<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sune42 replied on Wednesday, September 27, 2006</h2>I also got this error "<font size="4"><font size="2">Principal must be of type BusinessPrincipal, not System.Security.Principal.GenericPrincipal" today and my bug was that I accidently called my CSLA business objects before I did the authentication/login operation. <br><br>After I fixed it so that I logged in first, the error went away.<br><br>//Andy<br><br><br><br><br></font></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
