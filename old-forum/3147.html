<html><header><title>AllowPartiallyTrustedCallers and CAS and FullTrust</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>AllowPartiallyTrustedCallers and CAS and FullTrust</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3147.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo posted on Thursday, July 05, 2007</h2><P>Kind of two thought thread - one about assembly level checks, one for alternatives to CSLA needing FullTrust</P>
<P>Is there any particular reason why the AllowPartiallyTrustedCallers attribute couldn't be added into the Assembly file and adding the required CAS attributes at the assembly file for things like reflection so that users of CSLA can determine right away if they're going to have problems...or at minimum put the <FONT color=#008000 size=2></P>
<P><FONT color=#000000>[assembly: PermissionSet(SecurityAction.RequestMinimum, Name="FullTrust")]</FONT></P>
<P><FONT color=#000000><FONT size=3>into the assembly file so that when CSLA is loaded into an application a person would know right away versus a few screens in or down in a workflow when a CSLA factory method is first called.</FONT></FONT></P>
<P><FONT color=#000000 size=3>My thought process is that CSLA doesn't truly require full trust; it requires</FONT></P>
<P><FONT color=#000000>[assembly: </FONT><FONT color=#000000>ReflectionPermission(SecurityAction.RequestMinimum, Unrestricted=true)]</FONT></P>
<P><FONT color=#000000 size=3>for sure along with a few others (such as Remoting), but I run into a lot of headaches with sys-admins who don't wan't to fully trust my application.&nbsp; Some are willing to fully trust CSLA itself but since it has the implicit LinkDemand because it doesn't have the AllowPartiallyTrustedCallers attribute at the assembly level...my application has to be fully trusted in order to use CSLA.&nbsp; So in some cases my fights with sys-admins would be less or non-existant&nbsp;because I would only have to fight for the rights I need versus fighting for full-trust.</FONT></P>
<P><FONT size=3><FONT color=#000000>Of coarse I can just add these items into the source code and do it myself; but I'm wondering if this maybe should be something that is added to the framework by default?</FONT></FONT></P>
<P><FONT size=3><FONT color=#000000><FONT>Comments?</P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, July 08, 2007</h2><P>To responsibly allow partially trusted callers, code must ensure that it can't be exploited to allow that caller to do malicious things by calling the framework. CSLA can make no such guarantee because it uses the BinaryFormatter and/or NetDataContractSerializer. Both of these allow a caller to inject arbitrary code that would be run under FullTrust, even though that code came from a partially trusted caller.</P>
<P>So I won't put that attribute into the project, because I can't guarantee your code. However, <EM>you</EM> can put that attribute into the project if you'd like - because then it is very clear that you are assuming the associated risks by your own concious choice <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>boo replied on Monday, July 09, 2007</h2>Why does the fact that it used the BinaryFormatter and/or NetDataContractSerializer (not sure what that is...will have to Google later) mean that it has to be FullTrust...why couldn't the assembly just have the RequestMinimum on those permission sets?&nbsp; Then the calling code still has to have some level of trust, but it's not an all or nothing approach.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 09, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>This is a best practice issue. It isn&#8217;t a matter of what I
_<i>can</i>_ do, but rather what I _<i>should</i>_ do.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>If an assembly uses FullTrust (which CSLA does, because the
BinaryFormatter/NDCS/private reflection/Remoting/WCF/etc all require it), and
that assembly allows partially trusted callers, then it is up to the author of
that assembly to do all the demands and asserts and more importantly <i>ensure
that it can&#8217;t be used as an exploit</i>.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>If you implement ISerializable you (untrusted code author) get
to write the serialization and deserialization methods for your object. They run
within the context of the trusted code (BinaryFormatter/NDCS &#8211; within CSLA),
which means you get to write code that runs under FullTrust. Huge exploit
scenario.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>This is why BF/NDCS are never allowed in any sandboxes and why
neither Remoting nor WCF work (or are likely to work) in Silverlight or similar
environments.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>So as a responsible framework author I should not (and thus won&#8217;t)
allow partially trusted callers. Sure, I _<i>can</i>_ provide workarounds, but
that would be irresponsible. <i>You</i> can implement those workarounds for
your own use and that&#8217;s no problem &#8211; you are accepting the risks of
opening exploits, but you are writing the &#8220;untrusted&#8221; code, so
there&#8217;s really no risk to you.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Just don&#8217;t tell your sysadmins what is really going on,
because they&#8217;d freak and stop granting CSLA FullTrust </span><span>J</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> boo
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Monday, July 09, 2007 12:32 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] AllowPartiallyTrustedCallers and CAS and
FullTrust<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Why does the fact that it used the BinaryFormatter and/or
NetDataContractSerializer (not sure what that is...will have to Google later)
mean that it has to be FullTrust...why couldn't the assembly just have the
RequestMinimum on those permission sets?&nbsp; Then the calling code still has
to have some level of trust, but it's not an all or nothing approach.<br>
<br>
<br>
<o:p></o:p></p>

</div>



</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
