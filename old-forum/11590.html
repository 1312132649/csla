<html><header><title>Throwing exception when a callback method is available?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Throwing exception when a callback method is available?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11590.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan posted on Friday, September 21, 2012</h2><p>Hi Rocky,</p>
<p>I found a code pattern in the CSLA samples (ProjectTracker.Library, V4-3-x) that does look &quot;suspicious&quot; to me.</p>
<p>It is&nbsp;the following&nbsp;asynchronous&nbsp;factory method from ProjectTracker.Library.ProjectGetter:</p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">static</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> GetExistingProject(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">int</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> projectId, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">EventHandler</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DataPortalResult</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ProjectGetter</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt;&gt; callback)</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Inside the code block you have: </span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">if (e.Error != null) throw e.Error;</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Shouldn&#39;t the callback always be called?&nbsp;The calling context&nbsp;(Typically the UI) should get the chance to react to the exception.</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Or maybe there is a reason for the code as it is now, and I just don&#39;t get it...</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">And sorry for the formatting...<img src="http://forums.lhotka.net/emoticons/emotion-10.gif" alt="Embarrassed" /></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, September 21, 2012</h2><p>You are correct. the code should be: </p>
<p>&nbsp;</p>
<div style="color:black;background:white;font-family:Consolas;font-size:10pt;">
<p style="margin:0px;">&nbsp; &nbsp; <span style="color:blue;">public</span> <span style="color:blue;">static</span> <span style="color:blue;">void</span> CreateNewProject(<span style="color:#2b91af;">EventHandler</span>&lt;<span style="color:#2b91af;">DataPortalResult</span>&lt;<span style="color:#2b91af;">ProjectGetter</span>&gt;&gt; callback)</p>
<p style="margin:0px;">&nbsp; &nbsp; {</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; <span style="color:#2b91af;">DataPortal</span>.BeginFetch&lt;<span style="color:#2b91af;">ProjectGetter</span>&gt;(<span style="color:blue;">new</span> <span style="color:#2b91af;">Criteria</span> { ProjectId = -1, GetRoles = !<span style="color:#2b91af;">RoleList</span>.IsCached }, (o, e) =&gt;</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; {</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:blue;">if</span> ((e.Error == <span style="color:blue;">null</span>) &amp;&amp; (!<span style="color:#2b91af;">RoleList</span>.IsCached))</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#2b91af;">RoleList</span>.SetCache(e.Object.RoleList);</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; callback(o, e);</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; });</p>
<p style="margin:0px;">&nbsp; &nbsp; }</p>
<p style="margin:0px;">&nbsp;</p>
<p style="margin:0px;">&nbsp; &nbsp; <span style="color:blue;">public</span> <span style="color:blue;">static</span> <span style="color:blue;">void</span> GetExistingProject(<span style="color:blue;">int</span> projectId, <span style="color:#2b91af;">EventHandler</span>&lt;<span style="color:#2b91af;">DataPortalResult</span>&lt;<span style="color:#2b91af;">ProjectGetter</span>&gt;&gt; callback)</p>
<p style="margin:0px;">&nbsp; &nbsp; {</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; <span style="color:#2b91af;">DataPortal</span>.BeginFetch&lt;<span style="color:#2b91af;">ProjectGetter</span>&gt;(<span style="color:blue;">new</span> <span style="color:#2b91af;">Criteria</span> { ProjectId = projectId, GetRoles = !<span style="color:#2b91af;">RoleList</span>.IsCached }, (o, e) =&gt;</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; {</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:blue;">if</span> ((e.Error != <span style="color:blue;">null</span>) &amp;&amp; (!<span style="color:#2b91af;">RoleList</span>.IsCached))</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#2b91af;">RoleList</span>.SetCache(e.Object.RoleList);</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; &nbsp; callback(o, e);</p>
<p style="margin:0px;">&nbsp; &nbsp; &nbsp; });</p>
<p style="margin:0px;">&nbsp; &nbsp; }</p>
<p style="margin:0px;">&nbsp;</p>
<p style="margin:0px;">Beware that this code will change for CSLA 4.5 to return a Task&lt;T&gt; and also DataPortal_Fetch will return a Task&lt;T&gt;</p>
</div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Friday, September 21, 2012</h2><p>Hi Jonny,</p>
<p>&nbsp;</p>
<p>thanks for the clarification.</p>
<p>The equivalent code pattern&nbsp;can also be found in the code for&nbsp;ResourceGetter as well as in the Exists methods within ProjectGetter and ResourceGetter.</p>
<p>Just search for &quot;if (e.Error != null)&quot; !</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
