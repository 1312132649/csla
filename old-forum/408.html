<html><header><title>CLSA Collections Missing Ingredients!?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CLSA Collections Missing Ingredients!?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/408.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i posted on Monday, June 19, 2006</h2><P>I'm having a problem with my CLSA collections.&nbsp; This has been mentioned by serveral of you but, as yet, I still have no satisfactory solution so any help would be GREATLY appreciated....</P>
<P>First, to make my explanation a little simple consider the following object model: 'Person' object may have children which would be a </P>
<P>collection of 'Person' objects..</P>
<P>::(People)Group</P>
<P>&nbsp; -&gt; (Person) Jack<BR>&nbsp;&nbsp;&nbsp; -:: (People) Jack's Children<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (Person) Jack's only child: Jack Junior</P>
<P>&nbsp; -&gt; (Person) Jill<BR>&nbsp;&nbsp;&nbsp; -:: (People) Jill's Children<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (Person) Jill's 1st Child: Jill Junior<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -:: (People) Jill Junior's Children<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (Person) Jill Junior's 1st Child&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (Person) Jill's 2nd Child<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (Person) Jill's 3rd Child</P>
<P><BR>Now, what I simply want to do is bind this object model to a grid (I use Infragistics but despite finger point in their direction I don't believe the problem lies with them).&nbsp; However, when I do bind to a grid the various People collections get sent numerous IBindingList.AddNew() events.&nbsp; My understanding is that this is CurrencyManager/BindingContext behaviour to find out the schema of an object.&nbsp; Trouble is that these collection may be 1. read only or 2. have very complex NewObject behaviour that either results in exceptions being raised or performance absolutely dying.</P>
<P>Now, I have read of the IsBindingNow()/IsFinishedBinding() approach but while this works for the first call to SetDataBinding() it does not solve my problem as the tree is navigated and these IBindingList.AddNew() events trigger as + buttons are pressed.</P>
<P>NOW, why am I posting here!?&nbsp; This is where I'm going to be devils advocate and suggest that the problem must lie in the way collection are implemented in CSLA.&nbsp; See, when I try this stuff with the DataSet/Relationship approach I do no get any of these issues.&nbsp; This leads me, obviously, to conclude that the DataView is a lot more clever when it comes to databinding!????&nbsp; So what does it do that CSLA collection fail to do!?</P>
<P>I have tried implementing the ICustomTypeDescriptor and ITypedList interfaces on the objects/collections but still that damn AddNew() gets called in the background.</P>
<P>I know I'm not alone in dealing with this so please spare a minute to tell me what you've done/are doing to get around this problem.</P>
<P>And, just to note, my object hierarchies/graphs are pretty complex - the People/Person is purely for illustration.</P>
<P>Thanks as always.<BR>jh</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dawn replied on Monday, June 19, 2006</h2>I have the same problem serval months ago. I don't remember the solution exactly. <br>
Can you try not to bind the CSLA collection directly to the
Infragistics Grid, using a BindSource Component instead. And set the
BindSouce Componet's DataSouce to you CSLA collection. some thing like
below.<br>
<br>
cardBindingSrouce.DataSouce = Your CSLA collection.<br>
<br>
Infragistics Grid.SetDataBinding(cardBindingSouce, "Your CSLA Col Member Name")<br>
<br>
it's seem when you object hierarchies/graphs are pretty complex, Grid
can't retrieve the type info correctly, especially when the a child
collection is empty, this Grid try to create a new child to create it's
band which CSLA dones't like, all CSLA BO use factory method to create
new one. But the BindSource Component works.<br>
<br>
Dawn.<br>
<br>
<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Monday, June 19, 2006</h2><FONT size=2>Hi Dawn, Thanks for that reply.&nbsp; I'm confused as to what exactly the <EM>BindSource Component</EM> is?&nbsp; </FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, June 19, 2006</h2>Its a new component in .Net 2.0.&nbsp; The BindingSource component providers a middle layer between the actual datasource and the controls on your forms.&nbsp;&nbsp; <br><br>So you'd typically create the binding source, and (using the designer) set its datasource to a Csla based object.&nbsp; You then bind the controls to the binding source.&nbsp; When your form loads, you'd set the BindingSource's DataSource property to an instance of your BO.&nbsp; <br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Monday, June 19, 2006</h2>Ah!&nbsp; Not at 2.0&nbsp;yet I'm afraid.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 19, 2006</h2><P>The key in 1.x or 2.0 is to realize that if you turn on AllowNew in your collection, then you MUST be able to easily and cheaply create a new child object on demand. You mention that the problem doesn't exist with a dataset - which of course it wouldn't, because a datatable is always able to easily and cheaply create a new datarow on demand.</P>
<P>The problem isn't with the way collections are implemented in CSLA as such, but rather with the base assumption of complex data binding (binding with grids and grid-like controls), that when AllowNew returns true that the grid can feel free to create a new row as it sees fit. YOUR object model must conform to this restriction if you set AllowNew to true - that's just a fact of life.</P>
<P>If you can't make your child objects create quickly or cheaply, then you can't set AllowNew to true, and you'll need to have another UI metaphor to allow the user to add new items to your collection.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dawn replied on Monday, June 19, 2006</h2>I agree with Rocky. <br>
I think the problem is Infragistics Grid, even I set it's AllowAddNew
to false, it still call IBingingList.AddNew when you has a complex
objet hierarchies/graphs. This dones't occur when the datasouce just a
flat CSLA collection. When I use BindingSource Componet, every thing
ok. It seem BindingSource Compent found CSLA collection does't support
easily AddNew, then the Grid does't complain, and it's also can get all
the hierarchies/grahs info. So I think problem is not CSLA collection,
it's the way&nbsp; Infragistics Grid implent to retrieve BO type info.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, June 20, 2006</h2><P>Again, thanks for the replies.&nbsp; I read your entry with interest Rocky and my one question was....answered in a way by you Dawn - the fact that my problem is almost always with collections whose AllowNew is set to false.&nbsp; These ones raise the exception from the Core... which cause all manner of problems when binding to Infragistic controls.</P>
<P>Implementing ICustomType.../etc. theoretically means that the object doesn't actually need to be <EM>created </EM>by BindingManager/whatever for it to figure out its <EM>schema</EM> but, of course, this doesn't work consistently.</P>
<P>I'm not at v2.0 yet so am stuck with a very big problem in the UI layer - any suggestions (however whacky) on how I might workaround this problem given that the business layer is complex and, more importantly, complete!?&nbsp; </P>
<P>Maybe&nbsp;someone would be interested enough to do a <EM>Lutz Roeder's .NET Reflector </EM>on the new <EM>BindingSource component </EM>and tell me what it is doing under the hood to circumvent these AddNew problems!?</P>
<P>&nbsp;</P>
<P>Thanks again.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dawn replied on Tuesday, June 20, 2006</h2>Sorry I can't give more help. below is some comment from Infragistic
6.1 source Code, it's seem at old version, there is a bug. but which
version, i don't know, may be you should ask Infragistic for support<br>
<br>
<font color="#006400">// SSP 6/8/05 BR03609<br>
// Added GetItemPropertiesHelper to fix that issue where if a parent binding manager<br>
// doesn't have at least one row in it and the associated IBindingList doesn't allow adding <br>
// rows then the child binding manager can't be created (the BindingContext indexer throws an exception).<br>
</font><br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, June 20, 2006</h2><P>Thanks for that Dawn.&nbsp; Suggestion there is that the problem lies in the BindingContext and not the grid code.&nbsp; I'll keep trying to find a solution but I'm not optimistic.&nbsp;&nbsp;Thanks again for your help.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dawn replied on Tuesday, June 20, 2006</h2>hi, another problem I forget mentioned. Infragistic Grid does't support
band order, if you have two child list, then you can not adjust the two
child band order programmingly, if the order of them is not important,
forget this. If you&nbsp; care their order in the grid, then one
solution which Infragistic Said:<br>
<br>
first you datasource must be custom business object, like CSLA, <br>
second you should implement ITypedList your self.<br>
<br>
My solution is name the chlid list alphabetically, say AList, BList,
yes it is bad name convention, but now the project is overdue, and it's
work. I'll try ITypedList later.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Tuesday, June 20, 2006</h2>Maybe <FONT size=2>IListSource </FONT><FONT size=3>could solve this particular problem?&nbsp; Implement <FONT size=2>IListSource.GetList() </FONT></FONT><FONT size=3>and provide some custom sorting!?!</FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Thursday, September 13, 2007</h2><P>Hi all.</P>
<P>It appears that I'm still having this same problem even though I am using a bindingSource in the middle and AllowNew is set to false on both the collection and the bindingSource.&nbsp; Anybody have a solution to this problem?&nbsp; I'm starting to think that it's Infragistics related and not so much .Net or CSLA related.</P>
<P>Dustin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Thursday, January 17, 2008</h2><P>Folks,<BR>This goes back to an old problem discussed at <A HREF="/forums/thread/2054.aspx">http://forums.lhotka.net/forums/thread/2054.aspx</A>.&nbsp; </P>
<P>What I NEED to figure out is why I can bind my empty collection to a BindingSource and later bind that to a grid and all will work while I get AddNew problems when binding directly to the collection.</P>
<P>i.e. can any of you gurus out there tell me what the BindingSource does that navigates around the problem of AddNew being called to discover the schema of objects in a collection.</P>
<P>See, using BindingSource in the UI of all our apps seems a huge amount of work and I was hoping that I could do something at the base collection classes to sort the problem out (implementing ITypedList, etc. - that kind of thing).</P>
<P>Thanks</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 17, 2008</h2><P>I doubt the DataSet works any differently. When you bind an empty DataTable to a bindingSource/grid it immediately adds a&nbsp;new row to the DataTable for display in the grid. This occurs through a&nbsp;call to AddNewCore() in the DataTable. You just don't have a lot of heavy initialization code in <EM>that</EM> AddNewCore() - though you could if you use the partial class support added in .NET 2.0.</P>
<P>I also doubt that it is creating a new item just to discover the schema. In .NET 2.0, using the generic collection base classes to create a collection means that the indexer (Item property in VB) is strongly typed. The normal behavior for data binding is to use reflection against a strongly typed indexer if it exists, and to only fall back to looking at items in the collection as a last resort. </P>
<P>At no point have I seen data binding create a new item in&nbsp;a list to get type information. Instead of doing that, it simply gives up and binds the grid to type Object (meaning no columns).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Friday, January 18, 2008</h2><P>Thanks for that reply Rocky - I'm one of your original tormentors and will soon be looking to move our apps to be more inline with your newer versions and approaches - expect more torment :)</P>
<P>It is&nbsp;confusing because the stack trace from binding a collection to a grid is this (from bottom up below) and clearly shows a path to AddNew from a simple data binding operation:<BR><FONT size=1><BR>CSLA.Core.BindableBase.dll!CSLA.Core.BindableCollectionBase.System.ComponentModel.IBindingList.AddNew()<BR><BR></FONT><FONT size=1>System.Windows.Forms.dll!System.Windows.Forms...<BR>.CurrencyManager.AddNew() <BR>.RelatedCurrencyManager.ParentManager_CurrentItemChanged(object sender, System.EventArgs e) <BR>.RelatedCurrencyManager.Bind(System.Windows.Forms.BindingManagerBase parentManager, string dataField) <BR>.BindingContext.EnsureListManager(object dataSource, string dataMember) <BR>.BindingContext.this[object, string].get(object dataSource, string dataMember) <BR><BR></FONT><FONT size=1>Infragistics.Win.v7.1.dll!Infragistics.Win.DataBindingUtils.GetCurrencyManager(System.Windows.Forms.BindingContext bindingContext, object dataSource, string dataMember) <BR><BR></FONT><FONT size=1>Infragistics.Win.UltraWinGrid.v7.1.dll!Infragistics.Win.UltraWinGrid...<BR>.UltraGridBase.GetCurrencyManager(string dataMember) <BR>.UltraGridColumn.CreateChildBandBindingManagerHelper(out string newDataMember) <BR>.UltraGridColumn.InitPropertyDescriptor(System.ComponentModel.PropertyDescriptor propertyDescriptor, Infragistics.Win.UltraWinGrid.UltraGridBand[] oldBands = null) <BR>.UltraGridBand.InitColumns(Infragistics.Win.UltraWinGrid.UltraGridBand[] oldBands = null) <BR>.UltraGridBand.InitListManager(System.Windows.Forms.BindingManagerBase bindingManager, string dataMember, Infragistics.Win.UltraWinGrid.UltraGridBand[] oldBands) <BR>.UltraGridLayout.ListManagerUpdated(System.Windows.Forms.BindingManagerBase bindingManager) <BR>.UltraGridLayout.ListManagerUpdated() <BR>.UltraGridBase.Set_ListManager(object newDataSource, string newDataMember) <BR>.UltraGridBase.SetDataBindingHelper(object dataSource, string dataMember, bool hideNewColumns = true, bool hideNewBands = true) <BR>.UltraGridBase.SetDataBinding(object dataSource, string dataMember, bool hideNewColumns, bool hideNewBands) <BR><BR></FONT></P>
<P><FONT size=1><FONT size=3>Just now I'm suspecting that maybe the fact that BusinessCollection is a property of a base UI form that is only populated with an actual business collection at run-time&nbsp;may be a contributing factor. This mechanism allows us to write particularly lightweight UIs by using the patterns of the business objects at base.</FONT></FONT></P>
<P>BaseUI....<BR><FONT size=1><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>virtual</FONT> <FONT color=#008080>BusinessCollectionBaseEx</FONT> BusinessCollection</FONT></P><FONT size=2><FONT size=3>
<P><FONT size=2><FONT size=3>Example Use....<BR></FONT><FONT color=#0000ff size=1>this</FONT><FONT size=1>.BusinessCollection = <FONT color=#008080 size=1>Customers</FONT><FONT size=1>.GetCollection(<FONT color=#008080 size=1>AllowActions</FONT><FONT size=1>.ReadOnly | </FONT><FONT color=#008080 size=1>AllowActions</FONT><FONT size=1>.IsRealtimeSubscriber)<BR>...<BR><FONT color=#0000ff size=1>this</FONT><FONT size=1>.grdData.SetDataBinding(</FONT><FONT color=#0000ff size=1>this</FONT><FONT size=1>.BusinessCollection,</FONT><FONT color=#800000 size=1>""</FONT><FONT size=1>, </FONT><FONT color=#0000ff size=1>true</FONT><FONT size=1>, </FONT><FONT color=#0000ff size=1>true</FONT><FONT size=1>);</P></FONT></FONT></FONT>
<P></FONT></P></FONT></FONT><FONT size=1></FONT>
<P><FONT size=2><FONT size=3>Where Customers Inherit BusinessCollectionBaseEx...<BR></FONT><FONT color=#0000ff size=1><FONT color=#0000ff size=1>public</FONT><FONT color=#000000 size=1> </FONT><FONT color=#0000ff size=1>class</FONT><FONT color=#000000 size=1> </FONT><FONT color=#008080 size=1>Customers</FONT><FONT color=#000000 size=1>: </FONT><FONT color=#008080 size=1>BusinessCollectionBaseEx</FONT></FONT></FONT><BR></FONT></P>
<P>Whereas using the BindingSource as a trial I have had to set its type expliticly to, example, typeof(Customers)</P>
<P>mmmm, I'm going to have to investigate that more on Monday but feel free to post any insights you may have.<BR><BR>Have a good weekend all.</P>
<P><FONT size=1></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jh72i replied on Wednesday, February 27, 2008</h2><PRE><FONT color=#1000a0><FONT color=#000000>*</FONT> from <FONT color=#000000>System.Windows.Forms.RelatedCurrencyManager </FONT>and seems to be the crux of my AddNew problem.<BR></FONT><FONT size=1><FONT color=#1000a0>private</FONT> </FONT><A title=System.Void href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Void"><FONT color=#006018 size=1>void</FONT></A><FONT size=1> <B><A class=bold href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/ParentManager_CurrentItemChanged(Object,System.EventArgs)"><FONT color=#000000>ParentManager_CurrentItemChanged</FONT></A></B>(</FONT><A title=System.Object href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Object"><FONT color=#006018 size=1>object</FONT></A><FONT size=1> sender, </FONT><A title=System.EventArgs href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs"><FONT color=#006018 size=1>EventArgs</FONT></A><FONT size=1> e)
{
    <FONT color=#1000a0>if</FONT> (!<FONT color=#1000a0>this</FONT>.</FONT><A title="bool System.Windows.Forms.RelatedCurrencyManager.ignoreParentCurrentItemChanged;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/ignoreParentCurrentItemChanged:Boolean"><FONT color=#006018 size=1>ignoreParentCurrentItemChanged</FONT></A><FONT size=1>)
    {
        </FONT><A title=System.Int32 href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Int32"><FONT color=#006018 size=1>int</FONT></A><FONT size=1> <B>listposition</B> = <FONT color=#1000a0>base</FONT>.</FONT><A title="int System.Windows.Forms.CurrencyManager.listposition;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager/listposition:Int32"><FONT color=#006018 size=1>listposition</FONT></A><FONT size=1>;
        <FONT color=#1000a0>try</FONT>
        {
            <FONT color=#1000a0>base</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.PullData();" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/PullData()"><FONT color=#006018 size=1>PullData</FONT></A><FONT size=1>();
        }
        <FONT color=#1000a0>catch</FONT> (</FONT><A title=System.Exception href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Exception"><FONT color=#006018 size=1>Exception</FONT></A><FONT size=1> <B>exception</B>)
        {
            <FONT color=#1000a0>base</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.OnDataError(Exception e);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/OnDataError(System.Exception)"><FONT color=#006018 size=1>OnDataError</FONT></A><FONT size=1>(</FONT><A title="Exception exception // Local Variable"><FONT color=#006018 size=1>exception</FONT></A><FONT size=1>);
        }
        <FONT color=#1000a0>if</FONT> (<FONT color=#1000a0>this</FONT>.</FONT><A title="BindingManagerBase System.Windows.Forms.RelatedCurrencyManager.parentManager;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/parentManager:System.Windows.Forms.BindingManagerBase"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1> <FONT color=#1000a0>is</FONT> </FONT><A title=System.Windows.Forms.CurrencyManager href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager"><FONT color=#006018 size=1>CurrencyManager</FONT></A><FONT size=1>)
        {
            </FONT><A title=System.Windows.Forms.CurrencyManager href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager"><FONT color=#006018 size=1>CurrencyManager</FONT></A><FONT size=1> <B>parentManager</B> = (</FONT><A title=System.Windows.Forms.CurrencyManager href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager"><FONT color=#006018 size=1>CurrencyManager</FONT></A><FONT size=1>) <FONT color=#1000a0>this</FONT>.</FONT><A title="BindingManagerBase System.Windows.Forms.RelatedCurrencyManager.parentManager;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/parentManager:System.Windows.Forms.BindingManagerBase"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>;
            <FONT color=#1000a0>if</FONT> (</FONT><A title="CurrencyManager parentManager // Local Variable"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>.</FONT><A title="int System.Windows.Forms.BindingManagerBase.Count { ... }" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/property:Count:Int32"><FONT color=#006018 size=1>Count</FONT></A><FONT size=1> &gt; <FONT color=#800000>0</FONT>)
            {
                <FONT color=#1000a0>this</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.SetDataSource(object dataSource);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/SetDataSource(Object)"><FONT color=#006018 size=1>SetDataSource</FONT></A><FONT size=1>(<FONT color=#1000a0>this</FONT>.</FONT><A title="PropertyDescriptor System.Windows.Forms.RelatedCurrencyManager.fieldInfo;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/fieldInfo:System.ComponentModel.PropertyDescriptor"><FONT color=#006018 size=1>fieldInfo</FONT></A><FONT size=1>.</FONT><A title="object System.ComponentModel.PropertyDescriptor.GetValue(object);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System:2.0.0.0:b77a5c561934e089/System.ComponentModel.PropertyDescriptor/GetValue(Object):Object"><FONT color=#006018 size=1>GetValue</FONT></A><FONT size=1>(</FONT><A title="CurrencyManager parentManager // Local Variable"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>.</FONT><A title="object System.Windows.Forms.BindingManagerBase.Current { ... }" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/property:Current:Object"><FONT color=#006018 size=1>Current</FONT></A><FONT size=1>));
                <FONT color=#1000a0>base</FONT>.</FONT><A title="int System.Windows.Forms.CurrencyManager.listposition;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager/listposition:Int32"><FONT color=#006018 size=1>listposition</FONT></A><FONT size=1> = (<FONT color=#1000a0>this</FONT>.</FONT><A title="int System.Windows.Forms.BindingManagerBase.Count { ... }" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/property:Count:Int32"><FONT color=#006018 size=1>Count</FONT></A><FONT size=1> &gt; <FONT color=#800000>0</FONT>) ? <FONT color=#800000>0</FONT> : <FONT color=#800000>-1</FONT>;
            }
            <FONT color=#1000a0>else</FONT>
            {
                </FONT><A title="CurrencyManager parentManager // Local Variable"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.AddNew();" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/AddNew()"><FONT color=#006018 size=1>AddNew</FONT></A><FONT size=1>(); <FONT>****************</FONT>
                <FONT color=#1000a0>try</FONT>
                {
                    <FONT color=#1000a0>this</FONT>.</FONT><A title="bool System.Windows.Forms.RelatedCurrencyManager.ignoreParentCurrentItemChanged;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/ignoreParentCurrentItemChanged:Boolean"><FONT color=#006018 size=1>ignoreParentCurrentItemChanged</FONT></A><FONT size=1> = <FONT color=#800000>true</FONT>;
                    </FONT><A title="CurrencyManager parentManager // Local Variable"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.CancelCurrentEdit();" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/CancelCurrentEdit()"><FONT color=#006018 size=1>CancelCurrentEdit</FONT></A><FONT size=1>();
                }
                <FONT color=#1000a0>finally</FONT>
                {
                    <FONT color=#1000a0>this</FONT>.</FONT><A title="bool System.Windows.Forms.RelatedCurrencyManager.ignoreParentCurrentItemChanged;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/ignoreParentCurrentItemChanged:Boolean"><FONT color=#006018 size=1>ignoreParentCurrentItemChanged</FONT></A><FONT size=1> = <FONT color=#800000>false</FONT>;
                }
            }
        }
        <FONT color=#1000a0>else</FONT>
        {
            <FONT color=#1000a0>this</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.SetDataSource(object dataSource);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/SetDataSource(Object)"><FONT color=#006018 size=1>SetDataSource</FONT></A><FONT size=1>(<FONT color=#1000a0>this</FONT>.</FONT><A title="PropertyDescriptor System.Windows.Forms.RelatedCurrencyManager.fieldInfo;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/fieldInfo:System.ComponentModel.PropertyDescriptor"><FONT color=#006018 size=1>fieldInfo</FONT></A><FONT size=1>.</FONT><A title="object System.ComponentModel.PropertyDescriptor.GetValue(object);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System:2.0.0.0:b77a5c561934e089/System.ComponentModel.PropertyDescriptor/GetValue(Object):Object"><FONT color=#006018 size=1>GetValue</FONT></A><FONT size=1>(<FONT color=#1000a0>this</FONT>.</FONT><A title="BindingManagerBase System.Windows.Forms.RelatedCurrencyManager.parentManager;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.RelatedCurrencyManager/parentManager:System.Windows.Forms.BindingManagerBase"><FONT color=#006018 size=1>parentManager</FONT></A><FONT size=1>.</FONT><A title="object System.Windows.Forms.BindingManagerBase.Current { ... }" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/property:Current:Object"><FONT color=#006018 size=1>Current</FONT></A><FONT size=1>));
            <FONT color=#1000a0>base</FONT>.</FONT><A title="int System.Windows.Forms.CurrencyManager.listposition;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager/listposition:Int32"><FONT color=#006018 size=1>listposition</FONT></A><FONT size=1> = (<FONT color=#1000a0>this</FONT>.</FONT><A title="int System.Windows.Forms.BindingManagerBase.Count { ... }" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/property:Count:Int32"><FONT color=#006018 size=1>Count</FONT></A><FONT size=1> &gt; <FONT color=#800000>0</FONT>) ? <FONT color=#800000>0</FONT> : <FONT color=#800000>-1</FONT>;
        }
        <FONT color=#1000a0>if</FONT> (</FONT><A title="int listposition // Local Variable"><FONT color=#006018 size=1>listposition</FONT></A><FONT size=1> != <FONT color=#1000a0>base</FONT>.</FONT><A title="int System.Windows.Forms.CurrencyManager.listposition;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager/listposition:Int32"><FONT color=#006018 size=1>listposition</FONT></A><FONT size=1>)
        {
            <FONT color=#1000a0>this</FONT>.</FONT><A title="void System.Windows.Forms.CurrencyManager.OnPositionChanged(EventArgs e);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.CurrencyManager/OnPositionChanged(System.EventArgs)"><FONT color=#006018 size=1>OnPositionChanged</FONT></A><FONT size=1>(</FONT><A title=System.EventArgs href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs"><FONT color=#006018 size=1>EventArgs</FONT></A><FONT size=1>.</FONT><A title="EventArgs System.EventArgs.Empty;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs/Empty"><FONT color=#006018 size=1>Empty</FONT></A><FONT size=1>);
        }
        <FONT color=#1000a0>this</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.OnCurrentChanged(EventArgs e);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/OnCurrentChanged(System.EventArgs)"><FONT color=#006018 size=1>OnCurrentChanged</FONT></A><FONT size=1>(</FONT><A title=System.EventArgs href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs"><FONT color=#006018 size=1>EventArgs</FONT></A><FONT size=1>.</FONT><A title="EventArgs System.EventArgs.Empty;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs/Empty"><FONT color=#006018 size=1>Empty</FONT></A><FONT size=1>);
        <FONT color=#1000a0>this</FONT>.</FONT><A title="void System.Windows.Forms.BindingManagerBase.OnCurrentItemChanged(EventArgs e);" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.BindingManagerBase/OnCurrentItemChanged(System.EventArgs)"><FONT color=#006018 size=1>OnCurrentItemChanged</FONT></A><FONT size=1>(</FONT><A title=System.EventArgs href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs"><FONT color=#006018 size=1>EventArgs</FONT></A><FONT size=1>.</FONT><A title="EventArgs System.EventArgs.Empty;" href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventArgs/Empty"><FONT color=#006018 size=1>Empty</FONT></A><FONT size=1>);
    }
}
</FONT></PRE>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div></P>
<P>I also doubt that it is creating a new item just to discover the schema. In .NET 2.0, using the generic collection base classes to create a collection means that the indexer (Item property in VB) is strongly typed. The normal behavior for data binding is to use reflection against a strongly typed indexer if it exists, and to only fall back to looking at items in the collection as a last resort. </P>
<P>At no point have I seen data binding create a new item in&nbsp;a list to get type information. Instead of doing that, it simply gives up and binds the grid to type Object (meaning no columns).</P></div></BLOCKQUOTE></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
