<html><header><title>N-Tier application. Underlying connection was closed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>N-Tier application. Underlying connection was closed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10377.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JacoM posted on Tuesday, May 17, 2011</h2><p>Hi, </p>
<p>&nbsp;</p>
<p>I&#39;m new to the CSLA framework and I&#39;m trying to write an N-Tier application so I can demo the framework to my company.</p>
<p>I&#39;m really struggling to get the data access working. I keep getting the &quot;The underlying connection was closed: The connection was closed unexpectedly.&quot; error every time I try to access a dataportal.fetch command.</p>
<p>I&#39;m using a windows forms UI and WcfHost.</p>
<p>Here is some of the code in the app.config files and the web.config file. I&#39;m really not even sure where to find the problem, so if more code is required just let me know.</p>
<p>WindowsFormsUI app.config</p>
<p>&lt;code&gt;</p>
<p>&lt;appSettings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add key=&quot;CslaAuthentication&quot; value=&quot;Windows&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add key=&quot;CslaDataPortalProxy&quot; value=&quot;Csla.DataPortalClient.WcfProxy, Csla&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add key =&quot;CslaDataPortalUrl&quot; value =&quot;http://localhost:41337/WcfPortal.svc&quot;/&gt;<br />&nbsp; &lt;/appSettings&gt;<br />&nbsp; &lt;connectionStrings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add name=&quot;RIMS_PC&quot; connectionString=&quot;Data Source=.\SQLEXPRESS;AttachDbFilename=&amp;quot;C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQLEXPRESS\MSSQL\DATA\RIMS_PC.mdf&amp;quot;;Integrated Security=True;Connect Timeout=30;User Instance=True&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;<br />&nbsp; &lt;/connectionStrings&gt;</p>
<p>&lt;/code&gt;</p>
<p>DAL library app.coinfig</p>
<p>&lt;code&gt;</p>
<p>&lt;connectionStrings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add name=&quot;CSLAtester.DAL.Properties.Settings.RIMS_PCConnectionString&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connectionString=&quot;Data Source=.\SQLEXPRESS;AttachDbFilename=&amp;quot;C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQLEXPRESS\MSSQL\DATA\RIMS_PC.mdf&amp;quot;;Integrated Security=True;Connect Timeout=30;User Instance=True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; providerName=&quot;System.Data.SqlClient&quot; /&gt;<br />&nbsp; &lt;/connectionStrings&gt;</p>
<p>&lt;/code&gt;</p>
<p>WcfHost web.config</p>
<p>&lt;code&gt;</p>
<p>&lt;connectionStrings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;add name=&quot;RIMS_PC&quot; connectionString=&quot;Data Source=.\SQLEXPRESS;AttachDbFilename=&amp;quot;C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQLEXPRESS\MSSQL\DATA\RIMS_PC.mdf&amp;quot;;Integrated Security=True;Connect Timeout=30;User Instance=True&quot; providerName=&quot;System.Data.SqlClient&quot; /&gt;<br />&nbsp; &lt;/connectionStrings&gt;<br />&nbsp; &lt;system.serviceModel&gt;<br />&nbsp;&nbsp;&nbsp; &lt;serviceHostingEnvironment multipleSiteBindingsEnabled=&quot;true&quot; aspNetCompatibilityEnabled=&quot;true&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;services&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;service name=&quot;Csla.Server.Hosts.WcfPortal&quot; behaviorConfiguration=&quot;returnFaults&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; binding=&quot;wsHttpBinding&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/service&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;service behaviorConfiguration=&quot;WcfPortalBehavior&quot; name=&quot;Csla.Server.Hosts.Silverlight.WcfPortal&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Csla.Server.Hosts.Silverlight.IWcfPortal&quot; bindingConfiguration=&quot;basicHttpBinding_IWcfPortal&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dns value=&quot;localhost&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint address=&quot;mex&quot; binding=&quot;mexHttpBinding&quot; contract=&quot;IMetadataExchange&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/service&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/services&gt;</p>
<p>&lt;/code&gt;</p>
<p>&nbsp;</p>
<p>I&#39;m using CSLA 4.1 and VS 2010 and MS SQL server 2008 R2</p>
<p>Any suggestions please</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JacoM replied on Tuesday, May 17, 2011</h2><p>I set up a tracelog, </p>
<p>and there is an exception happening at</p>
<p> Process action &#39;http://ws.lhotka.net/WcfDataPortal/IWcfPortal/Fetch&#39;.</p>
<p>Is my SP maybe wrong? Originally I wrote everything myself, but after struggling with this I created a new project and created the business libraries and SPs from the database using CSLAGenFork.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
