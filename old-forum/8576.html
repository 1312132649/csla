<html><header><title>Csla for Silverlight, C++ Libraries, and the AppDomain</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csla for Silverlight, C++ Libraries, and the AppDomain</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8576.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper posted on Wednesday, February 24, 2010</h2><p>I was running into an exception today...</p>
<p>System.TypeInitializationException: The type initializer for &#39;Atalasoft.Imaging.AtalaImage&#39; threw an exception. ---&gt; System.TypeInitializationException: The type initializer for &#39;&lt;Module&gt;&#39; threw an exception. ---&gt; System.TypeInitializationException: The type initializer for &#39;&lt;Module&gt;&#39; threw an exception. ---&gt; &lt;CrtImplementationDetails&gt;.ModuleLoadException: The C++ module failed to load while attempting to initialize the default appdomain.<br />---&gt; System.Runtime.Serialization.SerializationException: Type is not resolved for member &#39;Csla.Security.UnauthenticatedPrincipal,Csla, Version=3.8.1.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&#39;.<br />at System.AppDomain.get_Id()<br />at &lt;CrtImplementationDetails&gt;.DoCallBackInDefaultDomain(IntPtr function, Void* cookie)<br />at &lt;CrtImplementationDetails&gt;.DefaultDomain.Initialize()<br />at &lt;CrtImplementationDetails&gt;.LanguageSupport.InitializeDefaultAppDomain(LanguageSupport* )<br />at &lt;CrtImplementationDetails&gt;.LanguageSupport._Initialize(LanguageSupport* )<br />at &lt;CrtImplementationDetails&gt;.LanguageSupport.Initialize(LanguageSupport* )<br />--- End of inner exception stack trace ---<br />at &lt;CrtImplementationDetails&gt;.ThrowModuleLoadException(String errorMessage, Exception innerException)<br />at &lt;CrtImplementationDetails&gt;.LanguageSupport.Initialize(LanguageSupport* )<br />at .cctor()<br />--- End of inner exception stack trace ---<br />at a(String , Exception )<br />at c(atalano* )<br />at .cctor()<br />--- End of inner exception stack trace ---<br />at Atalasoft.Imaging.AtalaImage..cctor()<br />--- End of inner exception stack trace ---<br />(my code here) </p>
<p>... and I was trying to figure out what was going on. Atalasoft is a component vendor that is popular in the .NET space for imaging components, and it just so happens that we use them for imaging features in our software. I started getting this exception whenever the silverlight client issued a dataportal request that, when on the server, hit an aspect of Atalasoft.</p>
<p>I came across this post from the past: <a target="_blank" title="http://forums.lhotka.net/forums/p/4366/21404.aspx#21404" href="http://forums.lhotka.net/forums/p/4366/21404.aspx#21404">http://forums.lhotka.net/forums/p/4366/21404.aspx#21404</a> Pretty similar right? The difference here is that I know Atalasoft will work in an ASP.NET environment.</p>
<p>Long story short, I found that if I ran some Atalasoft code from the global.asax during application start, the dlls would spin up just fine, and I would no longer get the above exception when hitting Atalasoft during a dataportal request.</p>
<p>So the question is, what is it about the wcf dataportal that prevents this component vendor&#39;s libraries from loading into ASP.NET? I&#39;m really not sure where to start digging here.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, February 24, 2010</h2><p>One thing to consider is that WCF doesn&#39;t use the page lifecycle you get with an ASP.NET Web Form. Some parts of the lifecycle are similar, but most of the page lifecycle doesn&#39;t apply to services, and so doesn&#39;t occur in a WCF service call.</p>
<p>Or to put it another way, ASP.NET is a base platform on which you now find Web Forms, MVC and WCF. The sequence of events that occurs when an inbound request comes into each of these three technologies is different. Just because a component works in Web Forms doesn&#39;t mean it will work in the other two.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
