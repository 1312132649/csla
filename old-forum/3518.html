<html><header><title>When to call ValidationRules.CheckRules()?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>When to call ValidationRules.CheckRules()?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3518.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mase posted on Tuesday, September 11, 2007</h2>Should I be calling ValidationRules.CheckRules() explicitly?&nbsp; I'm having an issue where I sometimes get a broken rules collection when it is definitely not broken.&nbsp; <br><br>I am not even really able to reproduce the error, but sometimes when I create a new object and then try to save it to the database, I get a broken rule execption.&nbsp; But when capturing this bug, I print a bit of debug output and the property that is shown to be broken is not b/c I can see the value is correct, but the rule is shown broken anyway.<br><br>From what I understand, the rules are checked when attempting to save or insert, but if I need to check before trying to save, then do I just override IsValid and call CheckRules when IsValid is checked?&nbsp; Optionally, I could do a CheckRule("Property") in the property setter, right?<br><br>Thanks<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Tuesday, September 11, 2007</h2><font face="Arial" size="2">The rules are checked whenever the PropertyChanged() method is called, therefore you calling it manually shouldn't change the behaviour that you are seeing; unless it is a multiple property rule. What sort of rule is being broken? Is it a common CSLA rule or a custom rule? Does it affect one or more than property? <br><br>I could see the following causing the behaviour that you are seeing:<br></font><br><i>I have a rule which states that if PropertyA &gt;= 5 then PropertyB must have a value. </i><br><br><font face="Arial" size="2">If PropertyB is not added as a dependant property via:</font><br>&nbsp;&nbsp;&nbsp; <font face="Courier New" size="2"><font color="#0000ff">Me</font>.ValidationRules.AddDependantProperty(<font color="#ff0000">"PropertyA"</font>, <font color="#ff0000">"PropertyB"</font>)<br><br><font face="Arial">If you changed PropertyA to be Open, the rule would be marked as broken; if you then changed the value of PropertyB the rule would not fire because it PropertyB doesn't have any rules against it <span>(unless the above code is run)</span>. Adding dependant properties in my understanding a better way to do it, rather than overriding the Save method and calling Validation.CheckRules() calling Mybase.Save()<font face="Courier New"><br><br><font face="Arial">Hopefully this gives you a bit of guideance, however, feel free to post some more details about your rules and what values you are using and I'll try to give you a better answer.</font><br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, September 12, 2007</h2><P>Most people call ValidationRules.CheckRules as the last step in DataPortal_Create (and Fetch).</P>
<P>This means that once the BO is initially created or fetched it is in the correct state. (Either Valid or not.)</P>
<P>All of your property sets&nbsp;should contain code like this:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> Value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mAcctcode &lt;&gt; Value </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>mAcctcode = Value<BR>&nbsp;&nbsp;&nbsp; PropertyHasChanged(</FONT><FONT color=#ff00ff size=2>"Acctcode"</FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>As each property is changed your rules are broken or removed. The BO should always be in the correct state.</FONT></FONT></P>
<P>In my Web app, I find it useful sometimes to override IsValid and add a call to <BR>CheckRules("SomeSpecialRule"). Where SomeSpecialRule uses more than one field in the BO.</P>
<P>e.g. You have 5 Boolean properties and you want to know if 1 of them is True. Rather than run the rule 5 times as each Property Set occurs, I run it once when I check IsValid. The check for IsValid is usually in the Save button code so I can give the user a message before going through the DataPortal.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Joe</FONT></P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
