<html><header><title>Upgrading from CSLA 1 to 4</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Upgrading from CSLA 1 to 4</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10279.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>khoff posted on Tuesday, April 19, 2011</h2><p>Hi,</p>
<p>My company has been using CSLA 1 for years.&nbsp; We&#39;re now looking at upgrading to CSLA 4 and were wondering what the best strategy would be for upgrading 200+ BOs.&nbsp; We&#39;ve tossed around ideas and their downsides, such as:</p>
<ul>
<li>Running parallel libraries
<ul>
<li>We think this would break</li>
</ul>
</li>
<li>Branching and doing a full upgrade all at once
<ul>
<li>This would mean not seeing any benefits for quite a while as we expect this to be a long process</li>
<li>Nasty conflict resolution as the trunk would be changing quite a bit in the meantime</li>
</ul>
</li>
<li>Attempting to host a 1.x BO with a 4.0 BO
<ul>
<li>Haven&#39;t really looked into if this is even remotely possible yet, was just an idea that came up</li>
</ul>
</li>
</ul>
<p>We understand this is a huge undertaking and that any solution will take quite a bit of work, both in code and in wrapping our heads around 3 generations of new features, requirements, and rules.&nbsp; I&#39;ve purchased&nbsp;the CSLA 4 eBook series to start absorbing all I can about it before we start the upgrade process to help us along the way.&nbsp; We&#39;d really appreciate whatever advice we can get.</p>
<p>Thanks,</p>
<p>Ken</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, April 19, 2011</h2><p>The first thing to realize is that this isn&#39;t an upgrade so much as a rewrite.&nbsp; Pretty much the entire framework has changed in that time, and you very likely aren&#39;t going to be able to keep any semblance of your original structure, and probably hardly any of your code.&nbsp; Especially if you&#39;re considering any of the new display technologies, or any of the asynchronous features...</p>
<p>I&#39;d also say that your hosting option isn&#39;t likely to work either, unless you want to take your CSLA-1-era code and re-compile it into .NET 4.0.&nbsp; Multiple versions of the .NET runtime cannot exist in the same AppDomain, so you&#39;d have to hoist your code up to the new runtime version.&nbsp; And even if you were to do that, all the structural changes in the framework are probably going to kill that idea.&nbsp; And if that didn&#39;t do it, remember that you&#39;ll have to hoist the version-1 CSLA libraries as well, and you&#39;ll have&nbsp;a lot of&nbsp;work to do&nbsp;surrounding namespace collisions.&nbsp; All this probably kills the parallel-library options too.</p>
<p>That leaves what sounds like the least palatable option.&nbsp; I am assuming your &quot;trunk&quot; issues are&nbsp;because you&#39;re still modifying the existing app.&nbsp; If you&#39;re going to do a rewrite, you&#39;re probably going to have to at least attempt to stop any sort of significant changes to the&nbsp;existing codebase.&nbsp; I realize that the rewrite takes time, but if you are going to have any chance of doing it smoothly, you need to do your best to not have to work to a moving target.&nbsp; <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, April 19, 2011</h2><p>If they&#39;ve enhanced CSLA 1.53 to work in .NET 4 they can probably run both versions of CSLA in the same app. The trick is to rename the 1.53 namespaces to something like Csla153 (or something) and leave the CSLA 4 namespace root the same.</p>
<p>Then you can inherit from Csla153.BusinessBase or Csla.BusinessBase to get the version you want.</p>
<p>It should go without saying that all types in each object graph must be implemented with one version of CSLA.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>khoff replied on Tuesday, April 19, 2011</h2><p>Thanks for the replies.</p>
<p>Scott:&nbsp; Yes, I&#39;m aware that it is a rewrite, and that&#39;s why we were looking for advice on how best to handle it. We&#39;ve actually moved our applications to .NET 3.5 with no problems, and the rest of the way to 4.0 doesn&#39;t seem too bad (ignoring warnings for obsolete/deprecated methods, which will be fixed shortly). That part of the parallel library idea doesn&#39;t seem to be the biggest issue...but that CSLA won&#39;t be able to exist side by side with an older version of itself, which Rocky just said should be possible.</p>
<p>Rocky:&nbsp; Thanks for confirming that for me.&nbsp; It seemed like a good way for us to manage this undertaking but even figuring out if it was possible could have taken too much time for us while we&#39;re just figuring out all the changes you&#39;ve made from&nbsp;v1 to 4.</p>
<p>I suppose we will persue that route for a bit so we can start enjoying the benefits ASAP and take our time in the rest of the integration.&nbsp; I may have more questions in the future as we start working out the implications and developing a plan.</p>
<p>Thanks again for the replies,</p>
<p>Ken</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Tuesday, April 19, 2011</h2><p>Hi Ken, I tried to reply earlier but couldn&#39;t log in for some reason in firefox.</p>
<p>I am in the process of doing *exactly* what you are about to do, going from csla 1.x to 4.1 with a large commercial app with hundreds of business objects.</p>
<p>The old app is winform and asp.net &nbsp;interfaces and we wanted to move to wpf / silverlight / html5 interfaces instead and generally modernize it all as well as add some much needed focus on comprehensive unit testing and opted for a complete rewrite.</p>
<p>I don&#39;t understand fully why you are even considering mixing versions as you say and I can&#39;t address that however I can address a complete rewrite as that&#39;s what we&#39;re doing now.</p>
<p>The process so far has been figuring out the basics of csla 4.x (and constantly having to remember to forget everything we know about csla 1.x) and then learning how to implement one of each of the core csla business object stereotypes we used in 1.x csla to 4.x csla.</p>
<p>Knowing about CSLA 1.x is a huge disadvantage and adds greatly to the learning curve. &nbsp;The learning process proved to be *way* more time consuming than we thought at first. &nbsp;Allocate *plenty* of time for this. </p>
<p>I am still not fully up to speed on all aspects of what I need to know but getting there; unfortunately Rocky hasn&#39;t finished some critical EBooks yet so you will need to consider the purchase of the older published book about CSLA 2008 even though it&#39;s v3.5 it&#39;s valuable because there is currently no comprehensive end to end information for 4.x and the changes from 3 to 4 are minor compared to 1.x to 4.x.</p>
<p>With all the changes it&#39;s easy to go down the wrong path and waste a lot of time and resources so I stongly suggest you do what I&#39;m doing which is to pick a small sample of representative business objects of each of the major CSLA types in your 1.x csla project and port them to v4.x csla. </p>
<p>Pick the right objects so that they cover most of your cases of what you need but are simple enough to not bog you down too much and the right mix of objects so that you can make a simple UI for them in all the UI technologies you plan to implement.</p>
<p>The UI is a major consideration, don&#39;t look on it lightly even if you are not changing UI technologies because if your app is anything like ours you have a *lot* more code at the UI level than you should because some things just weren&#39;t possible with the old CSLA that are now easy to do at the business object level with the much more powerful business rules system. &nbsp;You can now push nearly any UI code down to the business object level and this is a powerful feature of csla 4.x.</p>
<p>What I opted to do is preserve the existing database schema for the new version so I picked a representative business object from the original app for each major CSLA stereotype we use, (read only list, root object, etc etc).</p>
<p>I&#39;m only starting in on the UI now, I used Unit tests for testing as I went along to implement the sample business objects.</p>
<p>In this way you can learn csla 4 from top to bottom using your business objects and your app&#39;s data so it&#39;s familiar and easier to learn and you avoid going down a wrong path while porting too much of your code at once. &nbsp;You can test a portion of it as a finished app and ensure it will work as you wish from end to end (installation to upgrade) etc.</p>
<p>Finally you can then leverage the hand written code you wrote for each stereotype and write a converter application that can read your original class definition and emit a csla 4.x version. &nbsp;This is doable and I&#39;ve done it so far with all but one of the stereotypes I use. &nbsp;I found it easiest to not bother with codedom techniques and simply read in the original source code, look for specific keywords with regex where necessary or simple string matching and then crank out the equivalent in csla 4.x to match what I came up with hand coding. &nbsp;It helped tremendously that I was very uniform in my original classes.</p>
<p>It is *totally* worth taking the time to write a converter application. &nbsp;In about &nbsp;a day you can write / test and implement a converter for each stereotype and it will save you untold amounts of work and ensure everything is super consistent. &nbsp;Even if it just converts parts of each class, anything that will save hand writing the code which is much more verbose in 4.x than it was in 1.x.</p>
<p>Of course you will still need to hand tweak those classes but you can convert 99% of the object over in my experience and all of that is the boring repetitive stuff.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Wednesday, April 20, 2011</h2><p>Hello,</p>
<p>Have you thought about using Code Generation to save time that it would take to rewrite in 4.0? Also, you speak of a conversion tool?? I&#39;ve never come across something like this. Can you please explain in detail on what you needed to todo?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jwhook replied on Tuesday, December 13, 2011</h2><p>I&#39;ve just been reading your thorough response to the same question that we&#39;re now wrestling with ... moving from 1.x to 4.x.</p>
<p>I&#39;m curious about how your rewrite progressed. Are you finished? As a result of your work, can you provide any kind of quantitative measure of effort to update the various elements of your application? Did you end up using any code generators?</p>
<p>I understand if you don&#39;t have time to answer, but any additional feedback you could supply would be appreciated.</p>
<p>- jim</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
