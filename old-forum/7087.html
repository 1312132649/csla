<html><header><title>Instance Failure using ContextManager</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Instance Failure using ContextManager</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7087.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jrule posted on Thursday, June 11, 2009</h2><P><FONT face=Tahoma>When using ContextManager, the first use of the DataContext object throws an "Instance Failure" error.&nbsp; I can create a DataContext object directly (without using&nbsp;ContextManager).</FONT></P>
<P><FONT face=Tahoma>Anyone have a clue what might be going on?</FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 12, 2009</h2><P>ContextManager creates the DataContext using a parameterless constructor (if I recall correctly), and so only works if the DataContext can be created in that manner. Perhaps your context is somehow different?</P>
<P>My recommendation is to use the debugger, step through the code in ContextManager to where it creates the instance of the DataContext and see exactly what exception occurs. Or look at the stack trace and find the underlying exception.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jrule replied on Friday, June 12, 2009</h2><P><FONT face=Arial>Looking at the code in debug, the ContextManager appears to get setup properly.&nbsp; But the first time it's accessed, the first code executed in ContextManager is Dispose(), which resets the refcount to 0.&nbsp; Here's the code I'm executing:</FONT></P>
<P><FONT face="Courier New" size=2>Using (ContextManager&lt;MyDataContext&gt; ctx = ContextManager&lt;MyDataContext&gt;.GetManager(MyDal.Database.MyDbName, true))</FONT></P>
<P><FONT face="Courier New" size=2>{</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New" size=2>// The following line of code causes ContextManager Dispose() to run.</FONT></P>
<P><FONT face="Courier New" size=2>var data = (from g in ctx.DataContext.Groups where g.Id == criteria.value select g).Single();</FONT></P>
<P><FONT face="Courier New" size=2>LoadProperty(IdProperty, data.Id);</FONT></P>
<P><FONT face="Courier New" size=2>.....</FONT></P></BLOCKQUOTE>
<P dir=ltr><FONT face="Courier New" size=2>}</FONT></P>
<P dir=ltr><FONT face=Arial>I'm not sure I understand why the ContextManager hits the Dispose() method while still in the Using block.&nbsp; I thought it could be due to running in the IDE, but I get the same error executing outside the IDE.</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
