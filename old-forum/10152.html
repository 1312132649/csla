<html><header><title>Silverlight, csla, and versioning</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight, csla, and versioning</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10152.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH posted on Thursday, March 10, 2011</h2><p>I&#39;m wondering how others deal with versioning when developing/deploying SL apps that utilize the CSLA.&nbsp; </p>
<p>More specifically, if a user is using version 1 of our software, they may perform work (let&#39;s say add a bunch of records and not commit them).&nbsp; Over night, we deploy version 2 of our software, and now the binaries for that user&nbsp;won&#39;t match, so that user will not be able to save their changes.</p>
<p>Something like utilizing a polling duplex binding that will reach out to all open clients, invoke a save, and close the app automatically comes to mind, but seems like an awfully rude approach (especially if the user is in the middle of interacting with the UI).</p>
<p>I guess a week&#39;s warning and notice of upgrade via email might suffice, but seems a bit archaic and error prone as well.</p>
<p>I&#39;m hoping to get some thoughts as to how to deal with this specific issue.&nbsp; </p>
<p>Thanks!</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Thursday, March 10, 2011</h2><p>Are you serializing your BOs to disk to store them?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, March 10, 2011</h2><p>No, not directly.&nbsp; I&#39;m utilizing the dataportal methods to perform my CRUD operations against the database.</p>
<p>So when I speak &quot;versioning&quot;, I mean the actual BO library that is built upon CSLA.&nbsp; If version 1 exposes 5 classes and version 2 exposes 7 classes, after a deploy, the server will host version 2.&nbsp; If the user in my example never refreshes their browser before they hit save, they will have version 1 loaded up.&nbsp; I guess I&#39;m assuming that a save at this point will fail because the assembly loaded in his/her browser will not match the new hosted assembly (version 2).&nbsp; Am I missing something?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, March 10, 2011</h2><p>I realize this is going to come off as kind of harsh, but I&#39;ve never had much sympathy for users who leave an application open and never log off the network.&nbsp; I realize that your question is more of a general sense, but your original question talked about an overnight deployment.&nbsp; When paired with your next scenario (they don&#39;t refresh their browser before saving), that says to me that your user(s) left your SL app (and browser) open when they left work for the day.</p>
<p>There are precious few apps that really are used 24/7 and cannot tolerate any kind of downtime.&nbsp; If your app is that kind of app, then you have a whole set of issues to resolve that go far and above your general question (and, presumably, you would have resolved them and thus wouldn&#39;t ask us. &nbsp;<img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" />)&nbsp; So, presuming your app isn&#39;t that kind of app, inform your users of the projected downtime window and call it a day.&nbsp; Every business I&#39;ve worked for has maintenance windows, and most of them &quot;ask&quot; their users to log off at the end of the day, since they use the after-hours window to push/install patches and other updates to the users&#39; desktops.</p>
<p>Now, if you&#39;re deploying a change during the day that is a &quot;breaking change&quot;... well, there isn&#39;t a whole lot you can do to cushion the blow.&nbsp; As you&#39;ve noted, the save will fail because of mismatched assemblies.&nbsp; About all I can think of would be to build in some kind of interception system on the server that does a version check before performing the update, and in the case of a mismatch sends an error message back to the user saying &quot;We can&#39;t save your work because a newer version of the app is available.&nbsp; Close your browser and re-load the app.&nbsp; We&#39;re sorry we lost your updates.&quot;&nbsp; I think something like that might be possible in the new CSLA 4 DataPortal inspector options, but I&#39;m not sure.&nbsp; I wouldn&#39;t try to automatically resolve the issue either - that could be a rat&#39;s nest of code to write.</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, March 10, 2011</h2><p>Scott,</p>
<p>Hahah, actually, I appreciate your candidness, and I completely agree with you on all counts.&nbsp; As far as I&#39;m concerned, this application is not business critical.&nbsp; However, the folks who wrote the original version gave the world to it&#39;s users, so it&#39;s going to be a difficult case for me to deliver less to the users.&nbsp; Unfortunately, many of it&#39;s users log in during random hours of the night (nation wide), so it&#39;s not your typical 9-5 usage app.</p>
<p>I&#39;d still love to hear how others have handled this scenario.</p>
<p>Thanks!</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, March 10, 2011</h2><p>If it is at all realistic to allow users to run the old version while other users start running the new version you can do a rolling update.</p>
<p>To do this:</p>
<ol>
<li>Create your new version of the app</li>
<li>Set up a new data portal endpoint (a new virtual root, with the new version of the app in the bin folder)</li>
<li>Make the new version of the app available - using the new URL for the data portal</li>
<li>Leave the old URL online for a time</li>
</ol>
<p>This isn&#39;t without its limitations obviously, but if your underlying database structure didn&#39;t change or something like that, it might be possible to make this work.</p>
<p>This is exactly the kind of thing people do when they need 99.999% uptime - they have to do rolling updates to avoid having any downtime...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, March 10, 2011</h2><p>Yeah, I thought about this solution as well, the largest problem being that the URL changes and everyone who had it bookmarked/linked/whathaveyou will now have to update them.&nbsp; Not the end of the world, but annoying, nontheless.</p>
<p>Thanks for the thoughts though, I appreciate it.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
