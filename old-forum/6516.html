<html><header><title>Specified cast is not valid error on LoadProperty of child class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Specified cast is not valid error on LoadProperty of child class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6516.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gidzone posted on Thursday, February 26, 2009</h2><font size="2" face="Tahoma">Hello,<br><br>I am receiving a "Specified cast is not valid" error from the FieldManager when I try and call a LoadProperty statement in a child class.&nbsp; All the types seem to be fine and the data returned from the db seems to be correct.&nbsp; Please see my class setup below.<br>Any help would be appreciated.<br><br>thanks!<br><br>-sanjay</font><font size="2"><br><br></font><font size="2" face="Tahoma"><b>My class set up is as follows:</b><br><br>Class: ParentBase:Businessbase&lt;ParentBase&gt;<br>Class: Child<br><br>public abstract class ParentBase: Businessbase&lt;ParentBase&gt;<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; protected virtual void DataPortal_Fetch(BaseCriteria criteria)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //fetching code<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>}<br><br>public class Child:ParentBase<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Fetch(BaseCriteria criteria)<br>&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.DataPortal_Fetch(criteria);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Fetching Code<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(SomeProperty, data.SomeProperty);&nbsp; &lt;--- Line throws "Specific Cast Is&nbsp; Invalid"<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br>}</font> <font size="2"><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, February 26, 2009</h2><P>You do not say what version of CSLA you are on.</P>
<P>The latest version 3.6.2 solves the problem of static field initialization for you. Older versions require you to use the _forceInit trick in every class and sublcass of your hierarchy.</P>
<P>Since you probably did not implement the trick, your static Property declarations got loaded out of sequence and the indexes are messed up and it is actually trying to load something else into the wrong property. Thus the invalid cast error.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gidzone replied on Thursday, February 26, 2009</h2>Thanks Joe.<br><br>I am on 3.6.0.&nbsp; I will upgrade and check it out.<br><br>thanks!<br><br>-sanjay<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gidzone replied on Thursday, February 26, 2009</h2>I upgraded and I now get a Cannot Register Property Error on all child classes.&nbsp; I went back and read the changelog for 3.6.1/3.6.2 to see if it explained how to register properties on base classes, but I did not see anything.<br><br>Any help would be appreciated.<br><br>Thanks!<br><br>-sanjay<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gidzone replied on Thursday, February 26, 2009</h2>I think I found the solution here:<br><br>http://forums.lhotka.net/forums/thread/29224.aspx<br><br>thanks!<br><br>-sanjay<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, February 27, 2009</h2><P>That is the _forceInit trick I was referring to.</P>
<P>You should not need it for 3.6.2!</P>
<P>Although I have not tested it myself yet.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gidzone replied on Sunday, March 01, 2009</h2>It turns out my issue after upgrading to 3.6.2 was not specifying the child type in my RegisterProperty calls.&nbsp; It was trying to register the properties in the base class after the base class had initialized thus the error.<br><br>Joe, thanks for all of your help.<br><br>-sanjay<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
