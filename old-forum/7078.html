<html><header><title>Please help me, have a question with EditableRootListBase inherited class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Please help me, have a question with EditableRootListBase inherited class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7078.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>niijyeni posted on Thursday, June 11, 2009</h2>I create two class with this code, and bind to a datagridview,when addnew item, system alway throw a NotSupportedException(Resources.NoSaveChildException).<br /><br />please help me.thanks everyone.<br /><br />code:<br />---------------------------------------------------------------<br /><br />    [Serializable]<br />    public class Container : BusinessBase<br />    {<br />        #region Business Methods<br /><br />        private static PropertyInfo IdProperty =<br />            RegisterProperty(typeof(Container), new PropertyInfo("Id", "Id of Container"));<br />        public Guid Id<br />        {<br />            get { return GetProperty(IdProperty); }<br />            set { SetProperty(IdProperty, value); }<br />        }<br /><br />        private static PropertyInfo NameProperty =<br />            RegisterProperty(typeof(Container), new PropertyInfo("Name", "Name of Container"));<br />        public string Name<br />        {<br />            get { return GetProperty(NameProperty); }<br />            set { SetProperty(NameProperty, value); }<br />        }<br /><br />        private static PropertyInfo CapacityProperty =<br />            RegisterProperty(typeof(Container), new PropertyInfo("Capacity", "Capacity of Container"));<br />        public int Capacity<br />        {<br />            get { return GetProperty(CapacityProperty); }<br />            set { SetProperty(CapacityProperty, value); }<br />        }<br /><br />        #endregion<br /><br />        #region Validation Rules<br /><br />        protected override void AddBusinessRules()<br />        {<br />            // TODO: add validation rules<br />            //ValidationRules.AddRule(RuleMethod, "");<br />        }<br /><br />        #endregion<br /><br />        #region Authorization Rules<br /><br />        protected override void AddAuthorizationRules()<br />        {<br />            // TODO: add authorization rules<br />            //AuthorizationRules.AllowWrite("Name", "Role");<br />        }<br /><br />        private static void AddObjectAuthorizationRules()<br />        {<br />            // TODO: add authorization rules<br />            //AuthorizationRules.AllowEdit(typeof(EditableChild), "Role");<br />        }<br /><br />        #endregion<br /><br />        #region Factory Methods<br /><br />        internal static Container NewContainer()<br />        {<br />            return DataPortal.CreateChild();<br />        }<br /><br />        internal static Container GetContainer(object rootData)<br />        {<br />          return new Container(rootData);<br />        }<br />        private Container()<br />        {<br />            /* Require use of factory methods */<br />        }<br />        private Container(object rootData)<br />        {<br />            Fetch(rootData);<br />        }<br />        #endregion<br /><br />        #region Data Access<br /><br />        protected override void Child_Create()<br />        {<br />            // TODO: load default values<br />            // omit this override if you have no defaults to set<br /><br />            LoadProperty(IdProperty, Guid.NewGuid());<br />            LoadProperty(CapacityProperty, 100);<br /><br />            base.Child_Create();<br />        }<br /><br />        private void Fetch(object rootData)<br />        {<br />            LoadProperty(IdProperty, ((DataAccessLayer.Containers)rootData).ContainerId);<br />            LoadProperty(NameProperty, ((DataAccessLayer.Containers)rootData).ContainerName);<br />            LoadProperty(CapacityProperty, ((DataAccessLayer.Containers)rootData).ContainerCapacity);<br /><br />            MarkOld();<br />        }<br /><br />        protected override void DataPortal_Insert()<br />        {<br />            using (var ctx = ContextManager.GetManager(DataAccessLayer.Database.SmartSyncDemo))<br />            {<br />                var item = new DataAccessLayer.Containers();<br />                item.ContainerId = this.Id;<br />                item.ContainerName = this.Name;<br />                item.ContainerCapacity = this.Capacity;<br /><br />                ctx.DataContext.Containers.Attach(item);<br />                ctx.DataContext.SubmitChanges();<br />            }<br />        }<br /><br />        protected override void DataPortal_Update()<br />        {<br />            using (var ctx = ContextManager.GetManager(DataAccessLayer.Database.SmartSyncDemo))<br />            {<br />                var item = ctx.DataContext.Containers.Single(o => o.ContainerId == ReadProperty(IdProperty));<br />                item.ContainerName = ReadProperty(NameProperty);<br />                item.ContainerCapacity = ReadProperty(CapacityProperty);<br />                ctx.DataContext.SubmitChanges();<br />            }<br />        }<br /><br />        protected override void DataPortal_DeleteSelf()<br />        {<br />            using (var ctx = ContextManager.GetManager(DataAccessLayer.Database.SmartSyncDemo))<br />            {<br />                var item = ctx.DataContext.Containers.Single(o => o.ContainerId == ReadProperty(IdProperty));<br />                ctx.DataContext.Containers.DeleteOnSubmit(item);<br />                ctx.DataContext.SubmitChanges();<br />            }<br />        }<br />        #endregion<br />    }<br /><br />    [Serializable]<br />    public class Containers : EditableRootListBase<br />    {<br />        #region Factory Methods<br /><br />        internal static Containers NewEditableChildList()<br />        {<br />            return DataPortal.Create();<br />        }<br /><br />        internal static Containers GetContainers()<br />        {<br />            return DataPortal.Fetch();<br />        }<br /><br />        private Containers()<br />        {<br />            AllowNew = true;<br />        }<br /><br />        protected override object AddNewCore()<br />        {<br />            var item = Container.NewContainer();<br />            Add(item);<br />            return item;<br />        }<br />        #endregion<br /><br />        #region Data Access<br /><br />        private void DataPortal_Fetch()<br />        {<br />            using (var ctx = ContextManager.GetManager(DataAccessLayer.Database.SmartSyncDemo))<br />            {<br />                var items = from data in ctx.DataContext.Containers<br />                            select data;<br /><br />                RaiseListChangedEvents = false;<br />                foreach (var child in items)<br />                    this.Add(Container.GetContainer(child));<br />                RaiseListChangedEvents = true;<br />            }<br />        }<br />        #endregion<br />    }<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, June 11, 2009</h2>The ERLB list is a list of ROOT objects. Not CHILD objects. That is what the exception is trying to tell you. It won't save a child object. Replace your child objects with root objects and it should work fine. <br /><br />BTW - the ERLB class seems to be quite popular for some reason. I have never created one in 5 years. It has a very limited use case - binding to a winforms grid. I usually create a normal root BO to contain a standard child collection and everything is fine. But I am using web forms almost all the time so I really have no need for this.<br /><br />Joe</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, June 11, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>BTW - the ERLB class seems to be quite popular for some reason. I have never created one in 5 years. It has a very limited use case - binding to a winforms grid.</div></BLOCKQUOTE><br /><br />This may be the official party line, but what other editable CSLA collection is generally usable when the collection can be large? <br /><br />BusinessListBase classes save as entire unit (very useful in some scenarios), but this seems to require the entire collection be sent over the data portal just to save one item.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry replied on Thursday, June 11, 2009</h2><P>To extend what Joe is saying, take a look at the Editable Root Collection pattern, which is a root collection of editable children.&nbsp; It works very nicely for data grids, etc.&nbsp; It's p.187 in the 2008 book.</P>
<P>In the ERC, </P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>override</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DataPortal_Update()</P>
<P>{</P>
<P>Data.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyDataContext</FONT></FONT><FONT size=2> dc = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> Data.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyDataContext</FONT></FONT><FONT size=2>();</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.Child_Update(dc);</P>
<P>dc.SubmitChanges();</P>
<P>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>niijyeni replied on Thursday, June 11, 2009</h2>If I have table with this structure, named A<br /><br />   ID<br />   ParentID<br />   Name<br /><br />ParentID(foreign key) -> ID, and some other table may be use ID as foreign key. such as B table have a filed A_ID.<br />B table structure:<br />  ID<br />  A_ID<br />  Name<br /><br />All data like a tree, which base class i need it?<br />How to write some csla class for manager this data.... i'm lost.<br /><br />need bind to datagridview, thanks everyone.<br /><br />please help me</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>niijyeni replied on Saturday, June 13, 2009</h2>Does anyone help me...
Lhotka, are you there....</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
