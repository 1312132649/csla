<html><header><title>DataPortal.Fetch failed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal.Fetch failed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10641.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tesicg posted on Friday, August 26, 2011</h2><p>Hello,</p>
<p>We have Silverlight application that uses Csla.&nbsp;We should&nbsp;load&nbsp;test WCF service that Silverlight&nbsp;application uses. WCF service is deployed on IIS 7. We wrote simple WinForms application and added service reference to it. The following&nbsp;code is used:</p>
<p>ServicePointManager.ServerCertificateValidationCallback =<br />&nbsp;new RemoteCertificateValidationCallback((o, cert, chain, error) =&gt; true);</p>
<p>WcfPortalClient client = new WcfPortalClient();<br />client.ClientCredentials.UserName.UserName = &quot;username&quot;;<br />client.ClientCredentials.UserName.Password = &quot;password&quot;;<br />client.ClientCredentials.ServiceCertificate.Authentication.CertificateValidationMode = System.ServiceModel.Security.X509CertificateValidationMode.None;</p>
<p>// Use the &#39;client&#39; variable to call operations on the service.<br />Csla.Server.Hosts.Silverlight.CriteriaRequest critRequest = new Csla.Server.Hosts.Silverlight.CriteriaRequest();<br />critRequest.Principal = Encoding.ASCII.GetBytes(&quot;QBhBcnJheU9mU2VyaWFsaXp&quot;);<br />critRequest.CriteriaData = Encoding.ASCII.GetBytes(&quot;QBhBcnJheU9mU2VyaWFsa&quot;);<br />critRequest.TypeName = &quot;HCFB.UFO.Customer.Customer, HCFB.UFO.Business, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot;;<br />Csla.Server.Hosts.Silverlight.WcfResponse response = client.Fetch(critRequest);</p>
<p>MessageBox.Show(response.ErrorData.Message);<br />client.Close();</p>
<p>But, this error comes up:</p>
<p>DataPortal.Fetch failed (Attempted to perform an unauthorized operation.)</p>
<p>I&#39;m not sure if we can do something to overcome this issue.</p>
<p>Could someone, please,&nbsp;give some advice?</p>
<p>Thank you in advance.</p>
<p>Goran</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tesicg replied on Tuesday, August 30, 2011</h2><p>Does anybody can help or just point to right direction?</p>
<p>Thanks in advance.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, August 30, 2011</h2><p>I assume your exception is thrown here in Csla.Server.DataPortal: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">internal</span>&nbsp;<span style="color:#a52a2a;">static</span>&nbsp;<span style="color:#ff0000;">object</span>&nbsp;<span style="color:#191970;font-weight:bold;">Fetch</span><span style="color:#006400;">(</span>Type objectType<span style="color:#006400;">,</span>&nbsp;<span style="color:#ff0000;">object</span>&nbsp;criteria<span style="color:#006400;">)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Server<span style="color:#006400;">.</span>DataPortalResult result =&nbsp;<span style="font-weight:bold;">null</span><span style="color:#006400;">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Server<span style="color:#006400;">.</span>DataPortalContext dpContext =&nbsp;<span style="font-weight:bold;">null</span><span style="color:#006400;">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008080;font-weight:bold;">try</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#191970;font-weight:bold;">OnDataPortalInitInvoke</span><span style="color:#006400;">(</span><span style="font-weight:bold;">null</span><span style="color:#006400;">);</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">if</span>&nbsp;<span style="color:#006400;">(!</span>Csla<span style="color:#006400;">.</span>Rules<span style="color:#006400;">.</span>BusinessRules<span style="color:#006400;">.</span><span style="color:#191970;font-weight:bold;">HasPermission</span><span style="color:#006400;">(</span>Rules<span style="color:#006400;">.</span>AuthorizationActions<span style="color:#006400;">.</span>GetObject<span style="color:#006400;">,</span>&nbsp;objectType<span style="color:#006400;">))</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008080;font-weight:bold;">throw</span>&nbsp;<span style="color:#008b8b;font-weight:bold;">new</span>&nbsp;System<span style="color:#006400;">.</span>Security<span style="color:#006400;">.</span><span style="color:#191970;font-weight:bold;">SecurityException</span><span style="color:#006400;">(</span><span style="color:#ff0000;">string</span><span style="color:#006400;">.</span><span style="color:#191970;font-weight:bold;">Format</span><span style="color:#006400;">(</span>Resources<span style="color:#006400;">.</span>UserNotAuthorizedException<span style="color:#006400;">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">&quot;get&quot;</span><span style="color:#006400;">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objectType<span style="color:#006400;">.</span>Name<span style="color:#006400;">));</span>&nbsp;</p>
<p>So could it be that your serialized principal object does not contain the necessary roles/permissions? </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
