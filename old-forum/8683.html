<html><header><title>Enumerations and Wcf - The underlying connection was closed: The connection was closed unexpectedly.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Enumerations and Wcf - The underlying connection was closed: The connection was closed unexpectedly.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8683.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Thursday, March 18, 2010</h2><p>Using the&nbsp;local&nbsp;dataportal configuration&nbsp;my application is working&nbsp;perfectly, but when i want to use the WcfPortal configuration i bumped into the exception. <strong>&quot;The underlying connection was closed: The connection was closed unexpectedly.&quot;</strong> After trying out several types of wpf binding, bindingConfigurations, behaviours, security, servicehostfactory,&nbsp;etc.. i learned alot about wcf configurations, but i couldn&#39;t solve the error without getting other errors like bad request (400) or invalid codebase..</p>
<p>Just changing the dataportal configuration from local to wcf won&#39;t work if u have the following.</p>
<p>Having an repository with id&#39;s 0, 1, 2, 3<br />And having an enumeration</p>
<p>public enum Pets<br />{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dog = 0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cat = 1<br />}</p>
<p>When trying to load the property with LoadProperty(myBO, MyBO.Pet, 3) it will just succeed and resulting into an value which is not a member of the enumeration Pets</p>
<p>In the local dataportal configuration this work fine<br />In the wcf dataportal configuration this throws <strong>&quot;The underlying connection was closed: The connection was closed unexpectedly.&quot;</strong><br /><br />Did u guys know this won&#39;t even throw an exception?<br />Pets pet = (Pets)3;</p>
<p>The bottomline is that an enum value should be checked if it&#39;s defined.</p>
<p>&nbsp;something like this is for now my solution<span style="font-size:x-small;"><span style="font-size:x-small;">
<p>&nbsp;</p>
</span></span></p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">protected</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">void</span></span><span style="font-size:x-small;"> LoadProperty(</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">object</span></span><span style="font-size:x-small;"> obj, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">IPropertyInfo</span></span><span style="font-size:x-small;"> propertyInfo, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">object</span></span><span style="font-size:x-small;"> newValue)<br />{<br /></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">&nbsp;&nbsp;&nbsp; Type</span></span><span style="font-size:x-small;"> enumType = propertyInfo.Type;<br />&nbsp;&nbsp;&nbsp; </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">if</span></span><span style="font-size:x-small;"> (enumType.IsEnum)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">if</span></span><span style="font-size:x-small;"> (!</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Enum</span></span><span style="font-size:x-small;">.IsDefined(enumType, newValue))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">throw</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">new</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">InvalidCastException</span></span><span style="font-size:x-small;">(newValue.ToString() + </span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">&quot; is not a member of enum &quot;</span></span><span style="font-size:x-small;"> + enumType.ToString());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; </span><span style="font-size:x-small;">}<br />....</span></p>
<p><span style="font-size:x-small;">better would be an exception in the csla framework under the non-generic LoadProperty, &nbsp;LoadFieldData or&nbsp;Utilities.CoerceValue where the enum is being checked if it&#39;s defined.</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chachek replied on Thursday, March 18, 2010</h2><p>Didi you try marking the enum as Serializable?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Friday, March 19, 2010</h2><p>I did as i did alot of other things, the only solution is to 100% match the datacontract definition generated by csla. Using not defined enum&#39;s will result in the common exception above &quot;closed unexpectedly&quot;. I found something else that might work&nbsp;using Flags for bitwise enum usage&nbsp;<a href="http://geekswithblogs.net/claeyskurt/archive/2006/07/19/85667.aspx">http://geekswithblogs.net/claeyskurt/archive/2006/07/19/85667.aspx</a></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
