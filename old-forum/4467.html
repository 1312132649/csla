<html><header><title>LoadOnlyCriteria in PTIdentity - why is it there?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LoadOnlyCriteria in PTIdentity - why is it there?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4467.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nhwilly posted on Thursday, March 06, 2008</h2><P><FONT face=Arial size=2>I've finally jumped into CSLA (simply fantastic) and naturally, custom authentication is the first thing I'm trying to do.&nbsp; </FONT></P>
<P><FONT face=Arial size=2>I am trying to understand why there is a LoadOnlyCriteria in PTIdentity.</FONT></P>
<P><FONT face=Arial size=2>The code looks like it retrieves the same information as the CredentialsCriteria, only it doesn't check the password.&nbsp; You still get all the same data.</FONT></P>
<P><FONT face=Arial size=2>I can only think this is to retrieve the data without logging in.&nbsp; An administrator for maintenance or reporting, perhaps.</FONT></P>
<P><FONT face="Courier New" size=2><FONT face=Arial>But then Fetch sets the IsAuthenticated property to True regardless of which DataPortal_Fetch calls it.&nbsp; And PTPrincipal.LoadPrincipal uses SetPrincipal to set the CSLA.ApplicationContext.User to the principal that just got loaded.&nbsp; </FONT></FONT></P>
<P><FONT face="Courier New" size=2><FONT face=Arial>Somehow that doesn't seem right.&nbsp; What am I missing here?</FONT></FONT></P>
<P><FONT face="Courier New" size=2><FONT face=Arial>TIA.</FONT>&nbsp;&nbsp;</FONT></P>
<P><FONT color=#0000ff>------------</FONT></P><FONT color=#0000ff size=2>
<P><FONT face="Courier New">Private</FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2><FONT face="Courier New"> LoadOnlyCriteria)</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Using</FONT><FONT size=2> ctx = ContextManager(</FONT><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2><FONT face="Courier New"> ProjectTracker.DalLinq.Security.SecurityDataContext).GetManager(Database.SecurityConnection)</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> data = </FONT><FONT color=#0000ff size=2>From</FONT><FONT size=2> u </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> ctx.DataContext.Users </FONT><FONT color=#0000ff size=2>Where</FONT><FONT size=2> u.Username = criteria.Username </FONT><FONT color=#0000ff size=2>Select</FONT></FONT><FONT size=2><FONT face="Courier New"> u</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> data.Count &gt; 0 </FONT><FONT color=#0000ff size=2>Then</FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2></P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fetch(data.Single)</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;Else</FONT></P></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fetch(</FONT></FONT><FONT face="Courier New" color=#0000ff size=2>Nothing</FONT><FONT size=2><FONT face="Courier New">)</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> user </FONT><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2><FONT face="Courier New"> DalLinq.Security.User)</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>If</FONT><FONT size=2> user </FONT><FONT color=#0000ff size=2>IsNot</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;mName = user.Username</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;mIsAuthenticated = </FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">True</FONT></P></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> roles = </FONT><FONT color=#0000ff size=2>From</FONT><FONT size=2> r </FONT><FONT color=#0000ff size=2>In</FONT></FONT><FONT size=2><FONT face="Courier New"> user.Roles</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> role </FONT><FONT color=#0000ff size=2>In</FONT></FONT><FONT size=2><FONT face="Courier New"> roles</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRoles.Add(role.Role)</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;Next</FONT></P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT face="Courier New">Else</FONT></P></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;mName = </FONT></FONT><FONT color=#a31515 size=2><FONT face="Courier New">""</FONT></P></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;mIsAuthenticated = </FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">False</FONT></P></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;mRoles.Clear()</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></FONT>
<P><FONT color=#0000ff>----------</FONT></P><FONT color=#0000ff><FONT color=#0000ff size=2>
<P><FONT face="Courier New">Public</FONT></FONT><FONT face="Courier New"><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT color=#000000 size=2> LoadPrincipal(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT color=#000000 size=2> username </FONT><FONT color=#0000ff size=2>As</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>String</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000>)</FONT></P>
<P><FONT face="Courier New">SetPrincipal(PTIdentity.GetIdentity(username))</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> SetPrincipal(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> identity </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> PTIdentity) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>If</FONT><FONT size=2> identity.IsAuthenticated </FONT><FONT color=#0000ff size=2>Then</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> principal </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> PTPrincipal = </FONT><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2><FONT face="Courier New"> PTPrincipal(identity)</FONT></P>
<P><FONT face="Courier New">Csla.ApplicationContext.User = principal</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New" color=#0000ff size=2>Return</FONT><FONT size=2><FONT face="Courier New"> identity.IsAuthenticated</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, March 06, 2008</h2><P>What you are missing is the context in which Rocky created it.</P>
<P>You have to read this forum or one of his eBooks to get it in depth.</P>
<P>As I recall it is a WPF thing. The Authorize and Authenticate steps are separate and the Principal is lost in between them. Rocky wanted to only hit the DB once and this code had something to do with fixing the issue. Or not. I really don't remember. &lt;g&gt;</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nhwilly replied on Thursday, March 06, 2008</h2><P>I bought the ebook, but didn't look there (duh).</P>
<P>That sounds oddly familiar, though.</P>
<P>&nbsp;</P>
<P>Thanks.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nhwilly replied on Thursday, March 06, 2008</h2>Found it, thanks.<br /><br />-----Original Message-----<br />From: JoeFallon1 <br />Sent: Thursday, March 06, 2008 2:10 PM<br />To: bill@netheads.com <br />Subject: Re: [CSLA .NET] LoadOnlyCriteria in PTIdentity - why is it there?<br /><br />What you are missing is the context in which Rocky created it.<br /><br />You have to read this forum or one of his eBooks to get it in depth.<br /><br />As I recall it is a WPF thing. The Authorize and Authenticate steps are separate and the Principal is lost in between them. Rocky wanted to only it the DB once and this code had something to do with fixing the issue. Or not. I really don't remember. <br /><br />Joe<br /><br /> <br /><br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
