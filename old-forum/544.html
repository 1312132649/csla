<html><header><title>How to pass a value to a stored procedure and then show the result in a readonlylist</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to pass a value to a stored procedure and then show the result in a readonlylist</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/544.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>f-scherer posted on Wednesday, July 05, 2006</h2>Hi,<br><br>i have an asp.net form with a search textbox. This textbox is empty when loading the page. I also want to use the csladatasource to show the result of my query in a detailsview.<br><br>The problem is that the detailsview wants to show the values right away (at page load) But at this point i havenÂ´t passed a criteria yet.<br><br>Can someone give me an advice? Is it possible to use the csladatasource for my problem? <br><br><br>Thanks in advance,<br><br>frank.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 05, 2006</h2><P>CslaDataSource, in order to get it to reassign the business object through the "select" (where one codes something like this: e.BusinessObject = myQuery.GetQueryResults()..), only gets triggered on non-postback page calls if I'm correct. </P>
<P>One way might be to go away from the CslaDataSource. Another might be to do a Server.Transfer to itself and then refer back to the calling page to get the criteria and then to facilitate the retrieval and assign e.BusinessObject to the newly retrieved object - since Server.Transfer will facilitate a postback obviously, it'll trigger that select code. (I use the latter technique myself when it comes to a maintenance form right now where various parts of the BO can be manipulated&nbsp;but must be fully valid before saving is possible). </P>
<P>In the case of what you're talking about, I would probably opt for the former approach (not use the CslaDataSource). </P>
<P>I too would&nbsp;be interested in knowing if something else can "rebind" to a new business object myself other than a non-postback page call. (In which case you'd just bind to an empty result set initially and rebind afterwards). </P>
<P>My two cents. </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>f-scherer replied on Wednesday, July 05, 2006</h2>Hi Chris,<br><br>thanks for the quick answer. I am still very new the csla. Earlier i always used datasets to pass database values to a frontend. <br><br>Since i want to continue using csla what would be the best to pass values... I read the book and following the example values are always as type object.<br><br>Thanks in advance,<br><br>frank.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 05, 2006</h2><P>I'll give you an example of what I do for queries, and hopefully it'll help. </P>
<P>I have what is called a Query object. It's an editable root. I can request new queries, retrieve a saved one, delete one, etc. The Query object contains the information defining the query. What elements are part of my search both to show as criteria and as result set items (it's a data-centric search engine). </P>
<P>I have, on my Query object, an ExecuteQuery command. (I'm assuming you're using Csla 2.0 -- if not, since you're new, I'd recommend stepping up to it). On my Query object, I have an instance method on my Query object called&nbsp;Execute(). It will utilize the ExecuteQuery command to perform a server side activity that will construct the dynamic SQL and return a DataTable and such. </P>
<P>Within the ExecuteQuery command is where you'd invoke your stored procedure (instead of what I do in my case, where I'm invoking a command type other than a stored procedure). You'll note that my command assigns values for the QueryResults, and that the instance method Execute() returns this QueryResults. This is how my UI code will utilize the "return value" of the stored procedure, so to say. </P>
<P>So my instance method looks like this on my Query (BusinessBase&lt;Query&gt;):</P><FONT size=1>
<P></FONT><FONT color=#808080 size=1>///</FONT><FONT color=#008000 size=1> </FONT><FONT color=#808080 size=1>&lt;summary&gt;</P></FONT><FONT size=1>
<P></FONT><FONT color=#808080 size=1>///</FONT><FONT color=#008000 size=1> Executes the Query, returning a DataTable. </P></FONT><FONT size=1>
<P></FONT><FONT color=#808080 size=1>///</FONT><FONT color=#008000 size=1> </FONT><FONT color=#808080 size=1>&lt;/summary&gt;</P></FONT><FONT size=1>
<P></FONT><FONT color=#0000ff size=1>public</FONT><FONT size=1> </FONT><FONT color=#008080 size=1>QueryResults</FONT><FONT size=1> Execute()</P>
<P>{</P>
<P></FONT><FONT color=#008080 size=1>ExecuteQueryCommand</FONT><FONT size=1> executeCommand;</P>
<P>executeCommand = DataPortal.Execute&lt;</FONT><FONT color=#008080 size=1>ExecuteQueryCommand</FONT><FONT size=1>&gt;(</FONT><FONT color=#0000ff size=1>new</FONT><FONT size=1> </FONT><FONT color=#008080 size=1>ExecuteQueryCommand</FONT><FONT size=1>(</FONT><FONT color=#0000ff size=1>this</FONT><FONT size=1>));</P>
<P></FONT><FONT color=#0000ff size=1>return</FONT><FONT size=1> executeCommand.Results;</P>
<P>}</P>
<P><FONT size=3>And then the command looks like this:</FONT></P><FONT size=1>
<P></FONT><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// This command executes the Query, also recording the SQL used and the execution time. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Serializable()]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class ExecuteQueryCommand : CommandBase<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Query _query;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private QueryResults _results;</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public QueryResults Results<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _results;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ExecuteQueryCommand(Query queryToExecute)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _query = queryToExecute;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Execute()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; querySQL = &lt;Dynamically constructed SQL&gt; </FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;snip&gt;</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; selectColumnsCommand = new SqlCommand(querySQL, connection);</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; legacyDataAdapter = new SqlDataAdapter(selectColumnsCommand);</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connection.Open();</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; legacyDataAdapter.Fill(dt);</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT color=#000000 size=1>&nbsp;&nbsp;&lt;snip&gt;</FONT></P>
<P><FONT color=#000000 size=1><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; executionTimeMS =&nbsp;...execution time;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _results = new QueryResults(executionTimeMS, querySQL, dt);</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></P><FONT size=3>
<P>Hope that helps. </P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 05, 2006</h2><P>You need to understand how Web Forms data binding is working - this isn't specific to CslaDataSource, but rather to the broader data binding infrastructure.</P>
<P>The data binding mechanism is very lazy - which is good, as it is an optimization feature. What happens is this: a UI control (grid, etc.) determines that it needs data, so it asks for that data from data binding, which asks the data control, which asks the data source.</P>
<P>In the case of CslaDataSource, that last step means that the select event is raised so you know to provide the requested data.</P>
<P>To cause data on a page to reload at any time, you need to tell the UI control (grid, etc.) that it needs new data. Typically this is done by simply calling that control's DataBind() method. That tells the control to rebind, which causes it to ask data binding for data, which asks the control, which (with CslaDataSource) raises the select event.</P>
<P>So, after you've retrieved your other data, and need to refresh the drop-down list or whatever, simply add code to invalidate the drop-down list's data and it will rebinding all by itself.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 05, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>
<P>To cause data on a page to reload at any time, you need to tell the UI control (grid, etc.) that it needs new data. Typically this is done by simply calling that control's DataBind() method. That tells the control to rebind, which causes it to ask data binding for data, which asks the control, which (with CslaDataSource) raises the select event.</P>
<P></div></BLOCKQUOTE></P>
<P>That's very useful information, thank you. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Wednesday, July 05, 2006</h2><P>I did have some problems last time when it calls the page_load it will populates the Gridview, however I found a trick no to trigger the SelectObject() event in&nbsp; csladatasource during the first load. In your Gridview, convert all fields to template fields. Setting all fields to template fields, you also dont need to set the DataKeyNames properties. </P>
<P>Cheers,</P>
<P>Glenn</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>f-scherer replied on Thursday, July 06, 2006</h2>Hi,<br><br>now instead of using the csladatasource to bind data, what should i use to bind data coming from a readonlylist to a gridview for example?<br><br>Sorry if this question is dumb, but i am still used to write a method passing me a dataset and then binding it&nbsp; to a control for example....<br><br>thx in advance,<br><br>frank.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Friday, July 07, 2006</h2><P>Hi Frank,</P>
<P>If your GridView doesn't do anything, just simply displaying a set of results you can use ObjectDataSource. </P>
<P>Cheers,</P>
<P>Glenn</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
