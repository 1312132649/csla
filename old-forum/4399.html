<html><header><title>Missing properties in object data source for a generic LineItem class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Missing properties in object data source for a generic LineItem class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4399.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan posted on Saturday, February 23, 2008</h2>When building a new object data source based on one of my classes,<br>I notice that the properties of&nbsp; the class which is topmost in my inheritance hierarchy <br>are missing.<br><br>I will show you my class hierarchy.<br>It represents the well known Order-OrderLineItems-OrderLineItem structure:<br><br><font face="Arial">Public Class Order<br>&nbsp;mLineItems As OrderLineItems<br><br>The list hierarchy:<br>&nbsp;<br>Public Class OrderLineItems<br>&nbsp;Inherits MyAppLineItems(Of OrderLineItem)<br>&nbsp;<br>&nbsp;Public MustInherit Class MyAppLineItems(Of T As MyAppLineItem(Of T))<br>&nbsp;&nbsp; Inherits MyBusinessListBase(Of MyAppLineItems(Of T), MyAppLineItem(Of T))<br>&nbsp;<br>&nbsp; Public MustInherit Class MyBusinessListBase(Of T As MyBusinessListBase(Of T, C), C As MyBusinessBase(Of C))<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessListBase(Of T, C)<br>&nbsp;<br>The lineItem hierarchy:<br>&nbsp;<br>Public Class OrderLineItem<br>&nbsp;Inherits MyAppLineItem(Of OrderLineItem)<br>&nbsp;<br>&nbsp;Public MustInherit Class MyAppLineItem(Of T)<br>&nbsp;&nbsp; Inherits MyBusinessBase(Of MyAppLineItem(Of T))<br><br>&nbsp; Public MustInherit Class MyBusinessBase(Of T As MyBusinessBase(Of T))<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessBase(Of T)<br></font><br>I only see the Properties of MyAppLineItem(Of T). I expect to also see any public properties of OrderLineItem.<br><br>Maybe I have messed up my generic class declarations...<br><br>Any help would be greatly appreciated!<br><br>@Andy: I think this is something for you, as beeing the "LineItem guru"&nbsp; ;-)<br><br>Stefan</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 25, 2008</h2>Hi,<br><br>I had similar problems.&nbsp; In your base line item class, you'll need to implement ICustomTypeDescriptor.<br><br>Just be sure not to hardcode a typeof( ) function when you're implementing the interface, always use the GetType method.&nbsp; That way, you're getting the final subclass, not the base class.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Monday, February 25, 2008</h2>Thank you Andy for your response.<br><br>I somehow cannot believe that ICustomTypeDescriptor will solve my issue. (I am 'googleing' right now...) I want to get an explanation for the behaviour I am seeing, which is the WinFormsDesigner (or better the DataSourceExplorer) stopping to see properties in the middle of a class hierarchy...<br><br>I much more expect my generic classes beeing the source of the problem.<br><br>Maybe I could rework this. Knowing that you have implemented objects like SubTotalLineItem, PackingfeeLineItem etc., may I ask you how you did achieve this kind of polymorphism in your LineItemsCollection? <br>I thought that, for databinding to work with our Csla business objects, keeping our lists strongly typed was mandatory.<br><br>Could you just give me a hint. Maybe I could make my LineItem classes a bit less complex.<br><br>Thanks,<br>Stefan<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 25, 2008</h2>Well, it might not help if you're expecting to see something in the designer.&nbsp; It may though, because in my reporting services client side reports I would use properties on specialized line items, and these wouldn't work with the report (I got an #Error whenever I tried to put the value on the report) until I implemented ICustomTypeDescriptor.&nbsp; I think there's also an article somewhere that says you need to do this if your list holds a base class with mixed subtypes.&nbsp; <br><br>The problem I had was very weird; if a certain type of line item was FIRST in the list of items on the report, everything was fine.&nbsp; If it was second, it would display #Error.&nbsp; I think the very first line item dictated what ALL the rest of the items in the list would look like (ie. it assumed the first item's type woudl be the type for ALL items in the list).&nbsp; The only solution was to implement ICustomTypeDescriptor.<br><br>So, I'd try it.&nbsp; Its very easy to implement; its just a bunch of one line impelementations that use PropertyDescriptor to do all the real work.&nbsp; <br><br>On the other side of the coin, I never expect to see properties that only exist on a particular subclass.&nbsp; I have somewhat virtual "properties" which right now are only boolean flags.&nbsp; I build a context menu when a particular line item is selected and this building queries the line item though an API... but that API is common to all line items, so any line item can have such flags.<br><br>But nothing in the designer for my application is something that isn't really common to all line items.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Monday, March 03, 2008</h2>I rebuilt my Document-LineItemList-LineItem structure from scratch in a separate testproject and - voil√°, I found the mistake I made in the generic class declarations. <br>For the sake of completeness, I will show the resulting class signatures:<br><font face="Arial"><br>Public Class Order<br>&nbsp;Private mLineItems As OrderLineItems</font><br>...<br><br><font face="Arial">The list hierarchy:<br>&nbsp;<br>Public Class OrderLineItems<br>&nbsp;Inherits MyAppLineItems(Of </font><font face="Arial">OrderLineItems, </font><font face="Arial">OrderLineItem)<br>&nbsp;<br>Public MustInherit Class MyAppLineItems(Of T As </font><font face="Arial">MyAppLineItems(Of T, C), </font><font face="Arial">C As MyAppLineItem(Of C))<br>&nbsp;&nbsp; Inherits MyBusinessListBase(Of T, C)</font><br><br><font face="Arial">Public MustInherit Class MyBusinessListBase(Of T As MyBusinessListBase(Of T, C), C As MyBusinessBase(Of C))<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessListBase(Of T, C)<br></font><br><br><font face="Arial">The lineItem hierarchy:<br>&nbsp;<br>Public Class OrderLineItem<br>&nbsp;Inherits MyAppLineItem(Of OrderLineItem)<br>&nbsp;<br>&nbsp;Public MustInherit Class MyAppLineItem(Of T As </font><font face="Arial">MyAppLineItem(Of T)</font><font face="Arial">)<br>&nbsp;&nbsp; Inherits MyBusinessBase(Of T))<br><br>&nbsp; Public MustInherit Class MyBusinessBase(Of T As MyBusinessBase(Of T))<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessBase(Of T)<br></font><br><br>Now the resulting datasource is providing all the properties of all three levels.<br><br>For clarification:<br>The "MyApp..." level classes implement the interfaces needed for my lineitems to work properly (common LineItem properties, a parent reference etc.)<br>and the "MyBusiness..." level classes implement interfaces needed for my custom authorization.<br><br>Stefan<br><br><br><br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
