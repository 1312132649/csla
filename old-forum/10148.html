<html><header><title>All items returned by a BusinessListBase class are the same item.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>All items returned by a BusinessListBase class are the same item.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10148.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr posted on Wednesday, March 09, 2011</h2><p>Having some issues getting proper results when creating a list of test events.<br />I am using CSLA 3.7.1</p>
<p>The issue is that the list that is returned to the program has the proper number of tests but all of the tests are the same.<br />In other words there seems to be an issue with the list using a reference to the same object for each of the EmployeeTest objects returned by GetChildItem.<br />Resulting in all of the items in the list being the last item returned.<br />The results of the Debug Print statement in the EmployeeTestsList show</p>
<p>&nbsp;&gt;&gt; Record Test_AN = 249371<br />&nbsp;&gt;&gt; Record Test_AN = 257789<br />&nbsp;&gt;&gt; Record Test_AN = 259444<br />&nbsp;&gt;&gt; Record Test_AN = 261276<br />&nbsp;&gt;&gt; Record Test_AN = 299916<br />&nbsp;&gt;&gt; Record Test_AN = 352359<br />&nbsp;&gt;&gt; Record Test_AN = 384673<br />&nbsp;&gt;&gt; Record Test_AN = 416849<br />&nbsp;&gt;&gt; Record Test_AN = 422689<br />&nbsp;&gt;&gt; Record Test_AN = 428135<br />&nbsp;&gt;&gt; Record Test_AN = 465173<br />&nbsp;&gt;&gt; Record Test_AN = 480984<br />&nbsp;&gt;&gt; Record Test_AN = 500611</p>
<p>But the list returned by GetList to the GUI shows all 13 tests being 500611</p>
<p>Any Ideas................................I have read in some other posts that with Windows forms I should be using BusinessBindingListBase. instead of BusinessListBase but I can not find that Class at all.</p>
<p>Here is the simplified setup</p>
<p>I have an EmployeeTestsList class that returns a list of EmployeeTest </p>
<p>&lt;Serializable()&gt; _<br />Public Class EmployeeTestsList<br />&nbsp;&nbsp;&nbsp; Inherits BusinessListBase(Of EmployeeTestsList, EmployeeTest)</p>
<p>&nbsp;&nbsp;&nbsp; Friend Shared Function GetList(ByVal employeeid As Integer) As EmployeeTestsList<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DataPortal.FetchChild(Of EmployeeTestsList)(employeeid)<br />&nbsp;&nbsp;&nbsp; End Function</p>
<p>&nbsp;&nbsp; Private Sub Child_Fetch(ByVal employeeid As Integer)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim data As New TestEvent</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data.Where.Donor_AN.Value = employeeid<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data.Query.Load()</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If data.RowCount &gt; 0 Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Do<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.Print(&quot; &gt;&gt; Record Test_AN = &quot; &amp; data.Test_AN.ToString) &#39;Added to be sure of return values<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add(EmployeeTest.GetChildItem(data))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Loop While data.MoveNext<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; End Sub<br />End Class</p>
<p>The EmployeeTest Class</p>
<p>&lt;Serializable()&gt; _<br />Public Class EmployeeTest<br />&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of EmployeeTest)</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared IdProperty As PropertyInfo(Of Integer) = RegisterProperty(Of Integer)(New PropertyInfo(Of Integer)(&quot;ID&quot;, &quot;ID&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _idprop As Integer = IdProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; &lt;System.ComponentModel.DataObjectField(True, True)&gt; _<br />&nbsp;&nbsp;&nbsp; Public ReadOnly Property Id() As Integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _idprop<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared EmployeeIDProperty As PropertyInfo(Of Integer) = RegisterProperty(Of Integer)(New PropertyInfo(Of Integer)(&quot;EmployeeID&quot;, &quot;EmployeeID&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _empID As Integer = EmployeeIDProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; Public ReadOnly Property EmployeeID() As Integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _empID<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared ReasonForTestingCodeProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(New PropertyInfo(Of String)(&quot;ReasonForTestingCode&quot;, &quot;ReasonForTestingCode&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _reason As String = ReasonForTestingCodeProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; Public Property ReasonForTestingCode() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _reason<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(ReasonForTestingCodeProperty, _reason, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared EmployeeCatagoryCodeProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(New PropertyInfo(Of String)(&quot;EmployeeCatagoryCode&quot;, &quot;Employee Catagory Code&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _empCatCode As String = EmployeeCatagoryCodeProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; Public Property EmployeeCatagoryCode() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _empCatCode<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(EmployeeCatagoryCodeProperty, _empCatCode, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; Private Shared DateScheduledProperty As PropertyInfo(Of SmartDate) = RegisterProperty(Of SmartDate)(New PropertyInfo(Of SmartDate)(&quot;DateScheduled&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _dSched As SmartDate = DateScheduledProperty.DefaultValue<br />&nbsp;&nbsp;&nbsp; Public Property DateScheduled() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _dSched.ToString(&quot;MM/dd/yyyy&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPropertyConvert(Of SmartDate, String)(DateScheduledProperty, _dSched, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p><br />&nbsp;&nbsp;&nbsp; Friend Shared Function GetChildItem(ByVal data As Data.TestEvent) As EmployeeTest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DataPortal.FetchChild(Of EmployeeTest)(data)<br />&nbsp;&nbsp;&nbsp; End Function</p>
<p>&nbsp;&nbsp; Private Sub Child_Fetch(ByVal data As Data.TestEvent)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With data<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(IdProperty, _idprop, .Test_AN)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(EmployeeIDProperty, _empID, .EMP_ID)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(ReasonForTestingCodeProperty, _reason, .TEST_TYPE)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(EmployeeCatagoryCodeProperty, _empCatCode, .EMP_CAT)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPropertyConvert(Of SmartDate, String)(DateScheduledProperty, _dSched, .s_DATE_SCH)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br />&nbsp;&nbsp; End Sub<br />End Class</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Wednesday, March 09, 2011</h2><p>BusinessBindingListBase doesn&#39;t exist until Csla 4, so no need to worry about that unti you upgrade. How are you displaying this in windows forms? Using the standard datagrid? Or some other control?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Thursday, March 10, 2011</h2><p>In the GUI The data is displayed in a Pure Components LightGrid control. However, It really does not matter since when debugging I can look at the returned object in the IDE and see that all of the returned list items are the same.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, March 10, 2011</h2><p>Put your Debug line in the Child_Fetch to make sure the parameter is the value you think it is.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Roger_wgnr replied on Thursday, March 10, 2011</h2><p>The Child Fetch is getting the proper value. In fact the records shown in the data.Query are the expected values. Even when I check the values in EmployeeTestGetChildItem they are correct for each record in Data. I have also verified that the return from GetChildItem contains the expected result. But after the Loop Completes all values are the same. </p>
<p>What appears to be happening (and this is what I can not figure out) is that it appears that the Add is not creating a new object but referencing an the object in memory so when it is updated all instances are pointing to the same object.</p>
<p>I have even tried changing the add as follows with the same result.</p>
<p>Dim _FoundTest as EmployeeTest = EmployeeTestGetChildItem(data)</p>
<p>Add(_foundTest.Clone)</p>
<p>A bit more information on this issue..... It appears to be related to child items as any parent items are returning correctly.</p>
<p>I have also tried the following - Reinstalled .NET 3.5 SP1, Reinstalled VS2008 Professional, Reinstalled CSLA 3.7.1, and even tried changing to CSLA 3.6.3 All with the same resulting issue. I am at a loss as to what may be going on. I am beginning to think I am going to have to redesign my methods so that for listing information I can use the ReadOnlyListBase since I do not have this issue using it.....</p>
<p>I am looking for any clues as to something I may be overlooking or forgetting to do when it comes to child data...</p>
<p>Anyone......</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Thursday, March 10, 2011</h2><p>&nbsp;&nbsp;&nbsp; Private Shared ReasonForTestingCodeProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(New PropertyInfo(Of String)(&quot;ReasonForTestingCode&quot;, &quot;ReasonForTestingCode&quot;))<br />&nbsp;&nbsp;&nbsp; Private Shared _reason As String = ReasonForTestingCodeProperty.DefaultValue <br />&nbsp;&nbsp;&nbsp; Public Property ReasonForTestingCode() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _reason<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(ReasonForTestingCodeProperty, _reason, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;</p>
<p>Found your problem:</p>
<p>&nbsp;&nbsp;&nbsp; Private <strong><em>Shared</em></strong> _reason As String = ReasonForTestingCodeProperty.DefaultValue</p>
<p>All your backing fields are shared.&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
