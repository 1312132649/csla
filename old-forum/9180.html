<html><header><title>CanSave bug?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CanSave bug?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9180.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini posted on Wednesday, July 07, 2010</h2><p>Tools : CSLA 4 beta 3 / Silverlight 4</p>
<p>I have a business base with several children , one being a BLB. In the UI, i have a tabbed child window representing different groupings of these children items. One of the tabs contains a DataGrid - DataForm (master-child) UI representing the BLB child object. Selecting one item in the grid, causes the dataform to populate , allowing the user the ability to change them. The entire childwindow has&nbsp; a Save and Cancel button bound to CanSave and CanCancel of the viewmodel. When I change one of the items in the BLB , the save button becomes enabled. If i then proceed to save the object (thus making Save disabled again) and edit any of the other items, the Save never gets enabled again. However, if i&nbsp;Save and then tab away&nbsp;and come back to edit other items,&nbsp;the Save button gets enabled and everything works fine. I dont have any code here and everything is based on binding, so i am stumped as to what I can do to troubleshoot this, especially when it works on the first edit.</p>
<p>Any suggestions?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, July 07, 2010</h2><p>Can you grab the current code from svn? I think I found and fixed this issue last week, but would like to be sure.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Thursday, July 08, 2010</h2><p>Could you please give me a link to this version? I tried downloading but it seems like it is an older version. I dont want to make any assumptions here.</p>
<p>Thanks!</p>
<p>Ranjini</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, July 13, 2010</h2><p>I moved to RC0 and am facing some newer problems. In my BO -&gt; BLB structure i add objects to the BLB via the UI and that was working just fine before. Suddenly now, erratic errors are appearing when i do adds - <a href="http://docs.google.com/leaf?id=0B-Qwbn69ZX90MmEzYzdmN2YtN2NmZi00ZjE2LWJiMjYtMmMzYWRiZGY0MDM2&amp;hl=en&amp;authkey=CMin4pYK">http://docs.google.com/leaf?id=0B-Qwbn69ZX90MmEzYzdmN2YtN2NmZi00ZjE2LWJiMjYtMmMzYWRiZGY0MDM2&amp;hl=en&amp;authkey=CMin4pYK</a>&nbsp;. Also, if you note in the snapshot, there is a dataform that has &quot;autogeneratefields = true&quot; and the &quot;IsChild&quot; property is appearing in it now, which i am sure wasnt before.. Please help with any suggestions!</p>
<p>Thanks</p>
<p>Ranjini</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, July 13, 2010</h2><p>The IsChild issue is a bug, so it will be fixed (I think the fix was checked in last night actually).</p>
<p>CSLA now enforces that a BusinessListBase can only contain child objects. This helps avoid bugs that would otherwise occur. Your code has a bug where the objects you are adding to the collection are not child objects.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, July 13, 2010</h2><p>As you note in the snapshot, the &quot;IsChild&quot; flag is true. Would there still be a chance I am not adding proper child objects?</p>
<p>Thanks for your quick response.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Peran replied on Tuesday, July 13, 2010</h2><p>Hi,</p>
<p>&nbsp;</p>
<p>Your first issue is a result of this change:</p>
<p>http://www.lhotka.net/cslabugs/edit_bug.aspx?id=25</p>
<p>You need to call MarkChild() on your business object before inserting it into your list, or use the DataPortal.CreateChild() which call this on your behalf.</p>
<p>&nbsp;</p>
<p>The dataform issue will be fixed by this:</p>
<p>http://www.lhotka.net/cslabugs/edit_bug.aspx?id=797</p>
<p>Updated code is in SVN.</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>&nbsp;</p>
<p>Peran</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, July 13, 2010</h2><p>Per the link - <a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=25">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=25</a> , the exception is thrown if IsCHild is false, which doesnt seem to be the case in my situation as you can see from the snapshot.&nbsp; Am i still doing something wrong?&nbsp; I am using AddNew() ( eg. Model.MyBusinessListBase.AddNew() is the code in my viewmodel) to add my child object and not overriding any of the default create behaviour. In other words, I am letting the DataPortal add the child to the collection and thus expect the MarkAsChild to be called automatically.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Peran replied on Tuesday, July 13, 2010</h2><p>There is something not quite adding up here; your UI is showing IsChild = true, yet when your code reaches BLB.InsertItem IsChild = false.&nbsp; </p>
<p>I can&#39;t replicate the issue using BLB.AddNew() in unit tests, please could you add a break point on BLB.AddNewCore; DataPortal.CreateChild&lt;C&gt;() should create an item with IsChild = true. Try adding a break point to BLB.InsertItem(), item.IsChild will = false for the exception to occur, does the stacktrace help?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, July 13, 2010</h2><p>Thank you all for helping me debug this.. You were right about the IsChild being false.</p>
<p>It turned out that the child object causing the error was different from the one I thought was the culprit. In that specific object I used an AddNew but later in my code, it was being replaced by a new child instance and that was causing the error. Thanks again for helping me through this and I apologize for any unnecessary confusions !</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
