<html><header><title>Is this proper use of Validation Rules ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Is this proper use of Validation Rules ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6199.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky posted on Monday, January 19, 2009</h2>Hi,<br><br>Since I'm using code generation for my BOs, I use partial class definition in a separate file to put all my customized code.<br><br>In some cases, I need to customize the setter of some properties because setting property A has an impact on the value of property B. Now, the generation takes care of creating bare bones setters/getters for each column in the table on which the BO is based. Any customizing to a setter/getter will be lost if the class is regenerated.<br><br>So, what I need is a way to call some code, that will be in my other "non-generated" file, every time a given property is changed. This is where Validation Rules come into play. The code generator is kind enough to generate a partial method for me to add my custom validation rules, so I'm thinking of using a validation rule to set property B based on the value of property A, and simply return true. My concern is that this will "break" the normal CSLA way of doing things.<br><br>Is this "safe" ? Or is there another mechanism I should be using ?<br><br>Thank you.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux replied on Monday, January 19, 2009</h2><P>This is most of the reason I've always gone with split base classes instead of partial classes. With split base all you have to do is override the property in question in the editable portion of your code and you're golden.</P>
<P>With partial classes the only way to do that would be to mark the property as virtual and then override it in an inherited class, in which case you probably haven't gained a whole lot by using the partial classes in the first place.</P>
<P>Will</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robert_m replied on Monday, January 19, 2009</h2><P>What you are doing is perfectly valid. I've done the same thing in many&nbsp;BOs and everything is fine...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Monday, January 19, 2009</h2><P>You can also override OnPropertyChanged, then uyou need nod generate any extra code.</P>
<P>HTH</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, January 20, 2009</h2><P>The validation rules method works fine, but remember that your rules may be called even when nothing has changed (e.g. someone explicitly calls ValidationRules.CheckRules()). </P>
<P>So, you have to be careful/clever in how rules that modify data work so they function properly even when the data hasn't been altered. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Tuesday, January 20, 2009</h2>rsbaker,<br><br>Yes, this is what I've come to realize and it has me wondering if for those cases I shouldn't simply use a base class approach as suggested by someone else.<br><br>One other issue with using the validation rule is that it gets fired only after the actual SetProperty(), and in some cases I need to act before. <br><br>I guess base class + overriding is the only way to do what I want. It would be nice, though probably impossible to implement, if partial classes allowed you to "override" methods <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br>Thank you.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Tuesday, January 20, 2009</h2><P>Lukky, Maybe I am missing something here. Can you explain why overriding OnPropertyChanged will not do what you want. I use it extensively in my business objects to acheive what, I believe, you are trying to do. </P>
<P>Obviously you must call base.OnPropertyChanged in order that other PropertyChanged handlers are callled. This can be doen either before executing your code or after. Validation is executed during the call to the base.OnPropertyChange so you can decide whether to validate before or after your code is executed.</P>
<P>Here is a snippet from a nongenerated partial class file as an example.</P><FONT size=4>
<P></FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>protected</FONT></FONT><FONT size=4> </FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>override</FONT></FONT><FONT size=4> </FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>void</FONT></FONT><FONT size=4> PropertyHasChanged(</FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>string</FONT></FONT><FONT size=4> propertyName)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>if</FONT></FONT><FONT size=4> (propertyName == </FONT><FONT color=#a31515 size=4><FONT color=#a31515 size=4>"GroupRef"</FONT></FONT><FONT size=4>)</P>
<P>Audit.GroupChanged = </FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>true</FONT></FONT><FONT size=4>;</P>
<P></FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>if</FONT></FONT><FONT size=4>(propertyName == </FONT><FONT color=#a31515 size=4><FONT color=#a31515 size=4>"Status"</FONT></FONT><FONT size=4>)</P>
<P>Audit.StatusChanged = </FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>true</FONT></FONT><FONT size=4>;</P>
<P></FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>if</FONT></FONT><FONT size=4>(propertyName == </FONT><FONT color=#a31515 size=4><FONT color=#a31515 size=4>"Program"</FONT></FONT><FONT size=4>)</P>
<P>Audit.ProgramChanged = </FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>true</FONT></FONT><FONT size=4>;</P>
<P></FONT><FONT color=#0000ff size=4><FONT color=#0000ff size=4>base</FONT></FONT><FONT size=4>.PropertyHasChanged(propertyName);</P>
<P>}</P>
<P>&nbsp;</P>
<P>Regards </P>
<P>Simon</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Tuesday, January 20, 2009</h2>Just seen that I have been wittering on about OnPropertyChanged and of course it i PropertyHasChanged. Ooops, sorry about that.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Tuesday, January 20, 2009</h2>Simon,<br><br>I understand the idea, and it should&nbsp; indeed do what I want.<br><br>I just need to rethink the logic of what I do when the property changes, as it's a bit more complicated than just setting another property. In my actual scenario, I make use of the old value of the property that's being changed, which is obviously not available in this override.<br><br>So thank you for brining it to my attention, as I'll definitely use it in simple scenarios.<br><br>Regards.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, January 20, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>lukky:</strong></div><div>rsbaker,<BR><BR>Yes, this is what I've come to realize and it has me wondering if for those cases I shouldn't simply use a base class approach as suggested by someone else.<BR><BR>One other issue with using the validation rule is that it gets fired only after the actual SetProperty(), and in some cases I need to act before. <BR>...<BR></div></BLOCKQUOTE></P>
<P>I can't help with the latter problem, but I've managed to leverage my auditing implementation to help with rules like this. </P>
<P>I *really* know whether or not a property has been changed or not because I have a copy of the original value for any changed property, so &nbsp;I can do some fairly complicated transformations via business rules that are NOP's if the rule fires when the property hasn't really changed. </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
