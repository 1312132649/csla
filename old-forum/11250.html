<html><header><title>BusinessRules confusion</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessRules confusion</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11250.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 posted on Thursday, March 22, 2012</h2><p>I am having a difficult time with a set of business rules.&nbsp; Last I worked in CSLA Business rules I was in 3.8.&nbsp; We moved to 4.0 and mostly I use CodeSmith and build the business objects.&nbsp; However I am helping out with business rules.&nbsp; So, to the problem.&nbsp; In 3.8, I recall adding rules to properties and when a rule failed, the BrokenRulesCollection got populated.&nbsp; In 4.0, it seems to be different.&nbsp; Specifically, I have a pair of rules that the first one fails but the second succeeds and &quot;hides&quot; the failure of the first.&nbsp; </p>
<p>Example:</p>
<p>Properties: Date1, Date2, Date3</p>
<p>Date1 Rules: Date1 Required, Date1 LessThan &quot;NOW&quot;</p>
<p>Date2 Rules: Date2 GreaterThan Date1, Date2 LessThan Date3</p>
<p>Date 3 Rules Date3 LessThan &quot;NOW&quot;, Date3 GreaterThan Date1</p>
<p>The gist is a flight.&nbsp; Date1 is the date/time it takes off.&nbsp; If it lands but doesn&#39;t shut down(refuels while running), the takeoff time is Date2 and the landing at its final destination is date3, which means&nbsp;Date2 is not a required value.&nbsp; This data is captured post flight.&nbsp; Thus all dates are prior to the current date/time and must be chronological.&nbsp; </p>
<p>Testing my rules:</p>
<p>3 valid dates I get no broken rules as expected</p>
<p>Change Date2 and make Date2 greater than Date3 and I get a broken rule and it flags on the screen as expected</p>
<p>Change Date2 and make Date2 less than Date 1 and there is no flag on screen.&nbsp; If I put a breakpoint on my rule, I see the rule fail; however the next rule is Date2 LessThan Date3 and that succeeds so the broken rule seems to be over written with a success.&nbsp; Back in 3.8, once a rule was broken, it wasn&#39;t removed from the collection until its condition&nbsp;was satisfied (other than explictly clearing the collection).&nbsp; </p>
<p>I cannot find anything in the digital books that helps with this.&nbsp; The order of the rules is irrelivant as if I set priorieties, then I can fail the rules one way but again not the other.&nbsp; It probably isn&#39;t as hard as it seems, but this is not nearly as easy as 3.8 was.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, March 22, 2012</h2><p>Hi,</p>
<p>So you have the same rule with the same primaryProperty but different properties to compare to. </p>
<p>Then you MUST make sure that each rule instance have a&nbsp;unique RuleName. <br /><b>To achieve this the secondary property must be added to&nbsp;as QueryParameter to the RuleURI.</b></p>
<p>&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">GreaterThan</span>&nbsp;:&nbsp;<span style="color:#2b91af;">CommonBusinessRule</span><br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;CompareTo&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;GreaterThan(<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:#2baaaf;">IPropertyInfo</span>&nbsp;compareToProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CompareTo&nbsp;=&nbsp;compareToProperty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2baaaf;">IPropertyInfo</span>&gt;()&nbsp;{&nbsp;primaryProperty,&nbsp;compareToProperty&nbsp;};<br /><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">this</span>.RuleUri.AddQueryParameter(<span style="color:#a31515;">&quot;compareTo&quot;</span>,&nbsp;compareToProperty.Name);</strong><br />&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>Will give this RuleName:&nbsp; &nbsp;<b>&quot;rule://comparefieldsrules.rules.greaterthan/EndDate?compareTo=StartDate&quot;</b>&nbsp;<br />and the result from the two rules will not be viewed as the result of the same rule by the BrokenRulesCollection. </p>
<p>This is also true for CSLA 3.8&nbsp; - taken from Csla 3.8 : Csla.Validation.IRuleMethod:</p>
<p>&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; /// Gets the name of the rule.<br />&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; /// &lt;remarks&gt;<br />&nbsp;&nbsp;&nbsp; /// The rule&#39;s name must be <b>unique</b> and is used<br />&nbsp;&nbsp;&nbsp; /// to identify a broken rule in the BrokenRules<br />&nbsp;&nbsp;&nbsp; /// collection.<br />&nbsp;&nbsp;&nbsp; /// &lt;/remarks&gt;<br />&nbsp;&nbsp;&nbsp; string RuleName { get;}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Thursday, March 22, 2012</h2><p>YOU ARE THE MAN!&nbsp; Thank you so much, that worked perfectly.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
