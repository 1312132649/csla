<html><header><title>Problem with deferred deletion</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with deferred deletion</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/297.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jrlopher posted on Wednesday, June 07, 2006</h2>Hello all, I've a new problem with the business objects in my project (CSLA 1.0). If I want to use the deferred deletion in a root object and there are some cases in which the delete operation is forbidden, how can I use the broken rules to mantain this logic?. For example, an object is marked for deletion but we are in a case in which the operation shouldn't be allowed. When the Save method is called I would like to have that broken rule in the broken rules collection. But if I've marked an object for deletion, how could I restore the undeleted state?<br><br>Thanks in advance.<br><br>Jose<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 07, 2006</h2>Hmm,<br><br>You'll have to tie your business rule to the collection property of your root.&nbsp; You'll also need to hook into the collection's ListChanged event.<br><br>When ListChanged is called, call ValidationRules.CheckRules( "collProperty").<br><br>This will likely have to call a method on your collection to check for items which are deleted by should not be.<br><br>Of course the problem is fixing the object; do you provide an undelete?&nbsp; How do you show the items which are deleted by can be recovered?&nbsp; I don't think the DeletedList can be seen, so you may need to create a property DeletedItems which allows a readonly view of the collection.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 07, 2006</h2>As an aside, it might make sense for BusinessListBase to offer up a BrokenRules property, just like BusinessBase does.<br><br>The purpose of having rules there would be to store rules which don't apply to an individual item, but only when looking at the collection as a whole.&nbsp; For example, you aren't allowed to add DiscountLineItem more than once (only one discount per order).<br><br>I know there was a thread about this on the old forum, but it may be worth bringing the discussion back.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mark replied on Wednesday, June 07, 2006</h2><P>I don't think he was asking about a child collection - more of how to prevent a deferred delete on a root object.&nbsp; For example,&nbsp;you might have a PurchaseOrder object that is in &lt;some state&gt; that indicates you can't make a deferred Delete call.</P>
<P>Ideally, you'd override the Delete method and throw an exception so it never gets marked as deleted to begin with, but alas, Delete is not marked as overridable in Core.BusinessBase.</P>
<P>The only other option is to override Save() and catch it there.&nbsp; You have to rely on the client using n-level undo to get back to the prior state via a CancelEdit call.</P>
<P>Rocky - any chance of providing an overridable deferred 'Delete' method in CSLA, or do you see a better way of handling this?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 07, 2006</h2>Ah, a root object defered delete.. it was still early.<br><br>This is a good question, I'm not sure a good way to do this within the framework.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 07, 2006</h2>No, it certainly appears that Delete() should be virtual/Overridable. This change will be in 2.0.2 then.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jrlopher replied on Thursday, June 08, 2006</h2>Thanks for your responses.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
