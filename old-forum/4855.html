<html><header><title>Update many child objects in one transaction</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Update many child objects in one transaction</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4855.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tchimev posted on Friday, May 16, 2008</h2>I'm using CSLA .net and Linq To SQL.<br>I have a ProductList : BusinessListBase&lt;ProductList, Product&gt;<br>I changed the values of two Products form the list.<br><br>using (System.Transactions.TransactionScope ts = new&nbsp; System.Transactions.TransactionScope())<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.Update&lt;ProductList&gt;(pList);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ts.Complete();<br>}<br><br>I use the code above to save the changes into DB.<br><br>Here is the DataPortal method from the Product class:<br>&nbsp;private void Child_Update()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var ctx = ContextManager&lt;LinqDataContext&gt;.GetManager("DBname"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.DataContext.Products.Attach(this.MapToLinq(), this.IsDirty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.DataContext.SubmitChanges();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br><br>I expected to save it in one transaction but I got an error it requires a Distributed transaction.<br>Is there a way to save changes in one local transaction?<br>Without transaction everything works fine.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, May 16, 2008</h2>The only time you're creating a connection is in the child update.&nbsp; Since no connection exists, one is created.&nbsp; At the end of the using block, since only one object was using the connection, it's closed.&nbsp; Loop around again, and the same thing happens.<br><br>Leave the code in your child alone, but change the parents data portal code to this:<br><br>using (var ctx = ContextManager&lt;LinqDataContext&gt;.GetManager("DBname"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; DataPortal.Update&lt;ProductList&gt;(pList);<br>}<br><br>This will create the connection.&nbsp; The ContextManager in the CHILD object will pick up that a connection already exists, and use that.&nbsp; It also won't close the connection because the parent still has a reference to it.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, May 16, 2008</h2>Also, there's no need to manually use the TransactionScope.&nbsp; You can use the Transactional attribute with an TransactionScope value to do the same thing, without requiring you to code it. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tchimev replied on Saturday, May 17, 2008</h2>Thank you for your answer.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
