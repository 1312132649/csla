<html><header><title>problem with validation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>problem with validation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1932.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vbdotnetguy posted on Friday, December 08, 2006</h2>Hello all!&nbsp; I recently downloaded and implemented the 2.1 version and now I'm getting the following exception<br><br>DataPortal.Fetch failed (Csla.DataPortalException: DataPortal.Fetch failed (System.InvalidOperationException: Invalid rule method (instance methods of the target object not allowed)<br>&nbsp;&nbsp; at Csla.Validation.ValidationRules.ValidateHandler(MethodInfo method) <br><br>and here is my business rules.&nbsp; am i missing something?<br><br>Protected Overrides Sub AddInstanceBusinessRules()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays1, "Code1")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays1, "Hours1")<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays2, "Code2")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays2, "Hours2")<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays3, "Code3")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddInstanceRule(AddressOf HasVacationDays3, "Hours3")<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Function HasVacationDays1(ByVal target As Object, ByVal e As Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mEmployeeID &gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mCode1.ToLower = "e4" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return HasVacationDays(mHours1, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<br>&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp; Private Function HasVacationDays2(ByVal target As Object, ByVal e As Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mEmployeeID &gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mCode2.ToLower = "e4" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return HasVacationDays(mHours2, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<br>&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp; Private Function HasVacationDays3(ByVal target As Object, ByVal e As Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mEmployeeID &gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mCode3.ToLower = "e4" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return HasVacationDays(mHours3, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<br>&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp; Private Function HasVacationDays(ByVal HoursTaking As Double, ByVal e As Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim emp As Employee = Employee.GetEmployee(mEmployeeID)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim days As Double = UsedVacationList.GetUsedVacationDays(mEmployeeID, Date.Today.Year.ToString)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim Taking As Double = HoursTaking / 8<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim UsedTime As Double = days + Taking<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Convert.ToDouble(emp.VacationDays) &lt; days Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Employee does not have anymore available vacation"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf Convert.ToDouble(emp.VacationDays) &lt; UsedTime Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = String.Format("The employee only has a total of {0:#.#} days of vacation left for this year which is a total of {1} hours", Convert.ToDouble(emp.VacationDays) - days, (Convert.ToDouble(emp.VacationDays) - days) * 8)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<br>&nbsp;&nbsp;&nbsp; End Function<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vbdotnetguy replied on Friday, December 08, 2006</h2>nevermind i figured it out<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jules140 replied on Thursday, December 14, 2006</h2><P>I'm having the same problem. Could you let me know how you solved it?</P>
<P>Cheers</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, December 14, 2006</h2>ValidateHandler is only called when you do:<br>ValidationRules.AddRule, not when you call ValidationRules.AddInstanceRule.<br><br>I don't see why it would be called in your code, since you are using instance rules...<br><br>The exception is raised when adding a type rule (via AddRule, not AddInstanceRule) and the method isn't static an is declared inside your BO class.<br><br>So if the method is not static, but lives in an external object (like a validation object), or if the method is static you shouldn't have any issues.<br><br>What's your scenario??<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jules140 replied on Tuesday, January 02, 2007</h2><P>Thanks guys,</P>
<P>AddInstanceRule works a treat.</P>
<P>Happy New Year to all.</P>
<P>Jules</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
