<html><header><title>Dynamic Business Object Properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic Business Object Properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3952.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sbrickler posted on Wednesday, November 28, 2007</h2><P>I was wondering if anyone has a good implementation of dynamic or runtime properties in CSLA business objects? I found a few threads related to the issue but nothing definitive.</P>
<P>&nbsp;The reason I ask is that we often have to tie into existing databases that have userdefined fields. This is easy when there is a set number of udfs, we just add a possible udfs as normal properties.&nbsp;But&nbsp;we have come across applications/databases that support infinite udfs (often called UET's or user extended tables). This presents more of a challenge as the schema we are working with&nbsp;can essentially be infinately variable.</P>
<P>&nbsp;In the past we have just built a&nbsp;"Property/Properties" class/collection that have fields like PropertyName,Value, DataType;&nbsp; then exposed&nbsp;proper views of this data through a custom TypeDescriptionProvider </P>
<P>For example: </P>
<P>A Properties collection has&nbsp;a child property object with the following values:</P>
<P>PropertyName = "udf_myproperty"</P>
<P>Value = "Scott"</P>
<P>DataType = System.String</P>
<P>The properties collection is added to the standard object with normal field schema. Say the normal class has an ID property and a Name property. Reflection would return ID, Name, and Properties (collection) from the GetProperties call. Therefore we use the TypeDescriptionProvider to allow for a custom GetProperties implementation that bubbles up the dynamic properties from the Properties collection and ignores the Properties collection object. Once the provider is added,&nbsp;a call to Typedescriptor.getproperties will return ID, Name, and udf_myproperty. </P>
<P>I know that much of CSLA&nbsp;uses reflection to find properties in may occassions to do binding and the like.&nbsp;Has anyone done similar work using TypeDescriptors instead of reflection??&nbsp;&nbsp;&nbsp;Am I&nbsp;even on the right track with this thinking, maybe someone else has a more elegant solution?? I am pretty new to CSLA so maybe I am overlooking a feature?? </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 28, 2007</h2><P>I haven't fully explored this, and so may not be totally correct. However, I don't think there's any major&nbsp;issue using ICustomTypeDescriptor with CSLA.</P>
<P>CSLA itself doesn't use reflection to do data binding. Data binding uses reflection to do data binding <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /> But data binding first checks for ICustomTypeDescriptor before doing its binding - this is how&nbsp;data binding&nbsp;works with the DataTable for example.</P>
<P>The rule methods in CommonRules do use reflection, and so you couldn't use them. But they are relatively easy to re-implement in a manner that would work with ICTD I would think.</P>
<P>The validation and authoriziation subsystems are string-driven. I think you could make appropriate CanReadProperty(), CanWriteProperty() and PropertyHasChanged() calls in your getproperty and setproperty methods, because those methods clearly have the dynamic name of the property available for their use.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sbrickler replied on Wednesday, November 28, 2007</h2><P>Rockford,</P>
<P>Thank you for the quick response. I am glad to&nbsp;find out&nbsp;that normal databinding uses the ICTD, you learn something new everyday <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" />. I can see where reimplementing the rules would be pretty simple. Of course, I would have to provide a mechanism to add these rules at run-time.... Has anyone in the community attempted to do this???&nbsp;</P>
<P>I am also interested&nbsp;in your opinion of this implementation of&nbsp;dynamic custom properties.&nbsp;Is this a good approach or is there something out there they may be more elegant??</P>
<P>Thanks again for your help,</P>
<P>Scott&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 28, 2007</h2><P>Yeah, adding the rules at runtime is a requirement for this. The only trick to it is creating the delegate pointer from a string, which requires a bit of reflection. It helps too if you make your rule implementations run off DecoratedRuleArgs so you can easily pass in name/value parameter pairs.</P>
<P>Of course that leads to the requirement that you have the rule metadata (rule name, property name, parameter name/values) available <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
