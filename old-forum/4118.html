<html><header><title>PTWin\ProjectEdit.cs: ResourceId.Visible - trouble and solutions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>PTWin\ProjectEdit.cs: ResourceId.Visible - trouble and solutions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4118.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>so24wo posted on Friday, January 04, 2008</h2><P>This issue is addressed at least to:<BR>PTWin\ProjectEdit.cs, up to&nbsp;rev.1900 (current)<BR>.Net 2.0</P>
<P><BR>Recall that we set the ResourceId.Visible property to false at design time<BR>(see Chapter 9, Page 502, "Expert C# 2005 Business Objects, Second Edition").</P>
<P>But there is a small trouble. </P>
<P>The ResourceId.Visible property is switched to true when we initialize<BR>projectBindingSource.DataSource with _project in BindUI().</P>
<P><FONT color=#000080><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp; private void BindUI()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.BeginEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.projectBindingSource.DataSource = _project; </FONT><FONT face="Courier New"><FONT size=2><FONT color=#008000>// ResourceId.Visible switched to true here.<BR></FONT>&nbsp;&nbsp;&nbsp; }</FONT></FONT></FONT></P>
<P>Anybody can see this just comparing two pictures in the book:<BR>Figure 9-14 (p.498) shows the ResourceId column&nbsp;was hidden at design time.<BR>But this column is visible on the figure 9-20 (p.503) when the programm shows the grid to a user.</P>
<P><BR>First my idea was simply hide this column just after the datasource was assigned:</P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; private void BindUI()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.BeginEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.projectBindingSource.DataSource = _project;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>if ( ResourceId.Visible ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ResourceId.Visible = false; <FONT color=#008000>// hide the ResourceId column</FONT></STRONG><BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><BR>But are there any other ideas instead of checking each grid showed to users <BR>and comparing them with the design requirements?</P>
<P><BR>Yes.&nbsp;</P>
<P>This switching happens only before datagridview is completely initialized.</P>
<P>And all we needs is just move binding code from the ProjectEdit() constructor to <BR>the control load event handler. When this event is fired all grids on the control <BR>are initialized already and our assigns to the projectBindingSource.DataSource <BR>will not change the ResourcesDataGridView layout.</P>
<P>So the code:</P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; public ProjectEdit(Project project)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// store object reference<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project = project;</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000><STRONG>//</STRONG>// set up binding<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>//</STRONG>this.roleListBindingSource.DataSource = RoleList.GetList();</FONT></FONT></P>
<P><FONT face="Courier New" color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>//</STRONG>BindUI();</FONT></P>
<P><FONT face="Courier New" color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>//</STRONG>// check authorization<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>//</STRONG>ApplyAuthorizationRules();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2><STRONG>&nbsp;&nbsp;&nbsp; private void ProjectEdit_Load( object sender, EventArgs e )<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG><STRONG><FONT color=#008000>// set up binding<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.roleListBindingSource.DataSource = RoleList.GetList();</STRONG></FONT></P>
<P><FONT face="Courier New" color=#000080 size=2><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BindUI();</STRONG></FONT></P>
<P><FONT face="Courier New" color=#000080 size=2><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// check authorization</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules();<BR>&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; private void BindUI()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.BeginEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.projectBindingSource.DataSource = _project;<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P>and the RerourceId column stay invisible.</P>
<P><BR>---<BR>Regards,<BR>Oleg<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 04, 2008</h2>Nice! Thank you for sharing the solution to this problem!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>so24wo replied on Saturday, January 05, 2008</h2><P>After I posted the previous message I begin reread RolesEdit.cs to prepare next <BR>article about RolesEdit.SaveButton_Click() and I was surprised.</P>
<P>The technique described here is successfully used in<BR>RolesEdit.RolesEdit_Load().</P>
<P>Nice. Isn't it?</P>
<P>---<BR>Regards,<BR>Oleg<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Monday, January 07, 2008</h2>I have a form with a tab control on it, which has a datagridview control on each of its 4 tabpages.<br>Each datagridview ist bound to a different bindingsource control. All these bind to a different child collection of a 'master'-bindingsource.<br><br>Your solution only works for the datagridview on the first tabpage...<br><br>Anybody any ideas?<br><br>Stefan<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>so24wo replied on Tuesday, January 08, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>stefan:</strong></div><div>I have a form with a tab control on it, which has a datagridview control on each of its 4 tabpages.<BR>Each datagridview ist bound to a different bindingsource control. All these bind to a different child collection of a 'master'-bindingsource.<BR><BR>Your solution only works for the datagridview on the first tabpage...<BR><BR>Anybody any ideas?<BR><BR>Stefan<BR></div></BLOCKQUOTE></P>
<P>You are right. I reproduced this also.</P>
<P>There is one another solution.</P>
<P>To initialize some internal bits of your datagridviews you can use the DrawToBitmap() method.<BR>And with this method you don't need to wait for the load event. All code can be placed&nbsp;inside the&nbsp;constructor.</P>
<P>So my code looks like:</P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; public UserControl1(Project project)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// store object reference<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project = project;</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// Initialize datagridviews:<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<STRONG> resourcesDataGridView.DrawToBitmap( new Bitmap(1,1), new Rectangle(0,0,1,1));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resourcesDataGridView1.DrawToBitmap( new Bitmap(1,1), new Rectangle(0,0,1,1));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resourcesDataGridView2.DrawToBitmap( new Bitmap(1,1), new Rectangle(0,0,1,1));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resourcesDataGridView3.DrawToBitmap( new Bitmap(1,1), new Rectangle(0,0,1,1));</STRONG></FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// set up binding<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.roleListBindingSource.DataSource = RoleList.GetList();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BindUI();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// check authorization</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules();</FONT></P>
<P><FONT face="Courier New" color=#000080 size=2>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><BR>I've checked this idea over the WinPart-based control and over the Form-based window with an ErrorProvider on it.<BR>This works well.</P>
<P><BR>---<BR>Regards,<BR>Oleg<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Thursday, January 10, 2008</h2>I have found one solution that works.<br><br>The issue is related to the way a TabControl creates its child controls...<br>and databinding only works with controls that have already been created!<br>The background is explained <a href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=60177&amp;SiteID=1">here.</a><br>
<br>In Form_Load you have to put:<br><br>&nbsp;&nbsp;&nbsp; Me.TabPage2.Show()<br>
&nbsp;&nbsp;&nbsp; Me.TabPage2.Hide()<br>
&nbsp;&nbsp;&nbsp; Me.TabPage3.Show()<br>&nbsp;&nbsp;&nbsp; Me.TabPage3.Hide()<br>&nbsp;&nbsp;&nbsp; Me.TabPage4.Show()<br>&nbsp;&nbsp;&nbsp; Me.TabPage4.Hide()<br>&nbsp;&nbsp;&nbsp; ...<br>before any databinding related code.<br>This forces the creation of the DataGridView controls and results in the correct presentation of the columns as set in the designer.<br><br>Stefan</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
