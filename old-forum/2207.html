<html><header><title>CanReadProperty performance heads-up</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CanReadProperty performance heads-up</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2207.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams posted on Thursday, January 25, 2007</h2><P>I have a case where I load 25,000 records from a database into a ReadOnlyListBase list, then about 10,000 times have to go to the list to get specific matching items (usually 2-3).</P>
<P>This is what I have in the collection:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>List</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>OwnerSummary</FONT><FONT size=2>&gt; SelectForAccount(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> accountID)<BR>{<BR></FONT><FONT color=#2b91af size=2>&nbsp;&nbsp; List</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>OwnerSummary</FONT><FONT size=2>&gt; results = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>List</FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2>OwnerSummary</FONT><FONT size=2>&gt;();<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp; foreach</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>OwnerSummary</FONT><FONT size=2> owner </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>)<BR>&nbsp;&nbsp; {<BR></FONT><FONT color=#0000ff size=2>&nbsp; &nbsp;if</FONT><FONT size=2> (owner.AccountID == accountID)<BR>&nbsp;&nbsp;&nbsp; &nbsp; {<BR>&nbsp; &nbsp;&nbsp;&nbsp; results.Add(owner);<BR>&nbsp; &nbsp; &nbsp; }<BR>&nbsp;&nbsp; }<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp; return</FONT><FONT size=2> results;<BR>&nbsp;&nbsp; }</FONT></P>
<P><FONT size=2><FONT size=3>This part of the code was running dog slow.&nbsp; I eventually tracked it down to the CanReadProperty call every time I accessed owner.AccountID.&nbsp; I was using the reflection stack-trace&nbsp;version&nbsp;in the OwnerSummary class.&nbsp; When I switched to CanReadProperty("AccountID", true) the execution time for the above code went from 3-4 seconds to the expected negligible time.</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, January 25, 2007</h2><P>Thanks for the post.&nbsp;&nbsp;Guess the moral of the story is to use the explicit overload when performance matters and/or for frequently accessed fields.&nbsp; Great to have true bench-marking to substantiate this "guideline".</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tbim92 replied on Friday, August 03, 2007</h2>Thank you for posting this. Saved my hide. <br><br>I couldn't find anything that helped me on slow-loading lists for a couple of days until I finally found this post. After reading it I vaguely remember reading about this in Rocky's book or in a post a long time ago. Wasted a couple of days trying to figure it out and narrowed it down to the "obj = Me.GetItemByID(id)" call which of course zipped through the objects in the list to find the correct object, referencing the ID property which used the CanReadProperty method with no property name specified.<br><br>Here are the load times for loading 450 objects and then finding those 450 objects one at a time to load a child list in each (time includes two database calls total, returning 450 and then 1785 records):<br><br><ul><li>Using "CanReadProperty(True)" = 25.9 seconds</li><li>Using "CanReadProperty("ID", True)" = 2.56 seconds</li><li>Not using CanReadProperty at all = 2.54 seconds</li></ul><br>What a difference. Thanks again for posting!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kcharney replied on Thursday, March 27, 2008</h2><P>WOW !!!!</P>
<P>This was EXACTLY what I was looking for. <BR>It just saved my hide.</P>
<P>I could not figure out why in the world my form was taking so long to load. <BR>I have a Parent with 6 children - 3 core and 3 summary.<BR>Each child has several hundred items in them and it was taking forever to load up.<BR><BR>Commenting out the CanReadProperty - it loads almost instantly.<BR><BR>Thanks again for this post -wouldn't have thought to look there. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P>
<P>Kurt</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, March 27, 2008</h2>Well, you don't need to comment it.&nbsp; Just use the overload where you explicitly pass the property name.&nbsp; Of course if your really don't need it, commenting it would be fine.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, March 27, 2008</h2><P>In CSLA 3.5 there are two things:</P>
<P>1. The CanReadProperty() overload (and similar methods) that infer the property name are marked obsolete, so you can't use them anymore (unless you like compiler warnings)</P>
<P>2. The new ReadProperty&lt;T&gt;() and LoadProperty&lt;T&gt;() methods bypass authorization checks and validation, loading the property value directly - and so you do avoid this overhead entirely.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
