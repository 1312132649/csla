<html><header><title>Modifying StatusBusy Problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Modifying StatusBusy Problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3729.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>eslater posted on Tuesday, October 16, 2007</h2><P>I am trying to modify StatusBusy to show a user control on the form that is using it but the control never appears.&nbsp; My StatusBusy class is as follows:</P><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> StatusBusy<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Implements</FONT><FONT size=2> IDisposable</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Private</FONT><FONT size=2> mOldStatus </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Private</FONT><FONT size=2> mOldCursor </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Cursor<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Private</FONT><FONT size=2> mWait </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> WaitForm<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Private</FONT><FONT size=2> mForm </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Windows.Forms.Form</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> statusText </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> Form </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Windows.Forms.Form)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mForm = Form<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mOldStatus = frmMain.StatusLabel.Text<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frmMain.StatusLabel.Text = statusText<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mOldCursor = frmMain.Cursor<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frmMain.Cursor = Cursors.WaitCursor</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> mWait </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> WaitForm(statusText)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mWait.Top = (mForm.Size.Height - mWait.Height) / 2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mWait.Left = (mMain.Size.Width - mWait.Width) / 2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mWait.BringToFront()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mForm.Controls.Add(mWait)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P>
<P></P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Private</FONT><FONT size=2> disposedValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>' To detect redundant calls</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Dispose(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> disposing </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.disposedValue </FONT><FONT color=#0000ff size=2>Then<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> disposing </FONT><FONT color=#0000ff size=2>Then<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frmMain.StatusLabel.Text = mOldStatus<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frmMain.Cursor = mOldCursor<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mForm.Controls.Remove(mWait)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me</FONT><FONT size=2>.disposedValue = </FONT><FONT color=#0000ff size=2>True<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Dispose() </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IDisposable.Dispose<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dispose(</FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GC.SuppressFinalize(</FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000>And I am calling it using code similar to the following:<BR><FONT color=#0000ff size=2>Using</FONT><FONT size=2> busy </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> StatusBusy(</FONT><FONT color=#800000 size=2>"Loading Customer List..."</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;'Doing some stuff here<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</FONT></FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000><FONT color=#0000ff size=2><FONT color=#000000>Is anyone able to point me in the right direction?</FONT></FONT></FONT></FONT><FONT color=#0000ff size=2><FONT color=#000000><FONT color=#0000ff size=2></P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>eslater replied on Tuesday, October 16, 2007</h2>Maybe I should point out I am not running an MDI app but none of the windows will have multiple instances.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>juddaman replied on Wednesday, October 17, 2007</h2><P>In the Status property after setting the lablels text,&nbsp;refresh the label parent control, the status strip. Like so:</P>
<P><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (lblStatus.Text != </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>)</P>
<P>{</P>
<P>&nbsp;&nbsp;&nbsp;lblStatus.Text = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P>&nbsp;&nbsp;&nbsp;<FONT color=#006400>statusStrip1.Refresh();</FONT></P>
<P>}</P>
<P>}</P>
<P>HTH</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 17, 2007</h2>Are performaing a long running operation?&nbsp; If so, you may want to use a Background worker component.&nbsp;&nbsp; The problem with the status busy approach is that it may never update, because the code immediately after is intensive and the message pump doesn't get processed until after all the code completes... which includes disposing of the status busy.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rexhxiao replied on Friday, October 19, 2007</h2><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string StatusLabel<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _statusLabel.Text; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { _statusLabel.Text = value; Application.DoEvents(); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>ok?</P>
<P>I&nbsp;use it!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 19, 2007</h2>Application.DoEvents is kind of a bad hack.&nbsp; It can cause some unpredictable problems.&nbsp; If you see yourself using it, I think you should consider the BackgroundWorker component instead.&nbsp; You shouldn't really be doing any "heavy lifting" in your UI thread if you can avoid it.&nbsp; The solution above will still cause the windows to detect your application as Not Responding for any long running process.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
