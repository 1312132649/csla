<html><header><title>Object design question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Object design question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5865.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cosmin posted on Monday, November 24, 2008</h2><br>Hi,<br><br>I've got a sales order that is associated with a customer and an address of that customer. <br>I tried to design the sales order this way:<br>SalesOrder(BB)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Customer(ROB)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeliveryAddress(ROB)<br><br>In the DP Insert and Update I get the customerid and addressid from the Customer and DeliveryAddress objects. I don't feel this is right as I serialize the RO objects back to the server. On the Customer/Address setters I could copy the IDs to the private fields and mark the ROBs&nbsp; as NonSerialized.<br>Also, if I don't expose the CustomerID and AddressID then the databinding doesn't work smoothly as I need to do some bindings manually in code. I also have to make sure the Address for the order comes from customer.Addresses.<br><br>How would you design it? Do you expose both IDs and ROBs?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Monday, November 24, 2008</h2>If Customer and DeliveryAddress are ROB (I assume you mean Read Only Business ...) then why do you have setters (in which case these should be BB)? Are you actualy inserting the customer and delivery address when saving your sales order or where these already persisted in your database and you just populated them for display purposes?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cosmin replied on Monday, November 24, 2008</h2><br>The setters are there to be able to change the address for example in case you need to. If you have a setter doesn't really mean you can change the value. You can change the Address reference that the Customer holds not the address itself. I use them not for display purposes only but because they give me a good way to model the business.<br><br>salesOrder = SalesOrder.NewSalesOrder()<br>c = Customer.GetCustomer(123)<br>salesOreder.Customer = c<br>salesOrder.DeliveryAddress = c.Addresses(0) //actually here I set whatever user choses<br><br>later on<br><br>slaesOrder.GetSalesOrder(1000000)<br>salesOrder.DeliveryAddress = salesOrder.Customer.Addresses(1) //or whatever user wants<br><br>To be sure I get only selected customer's addresses in my delivery address I have a custom business rule.<br><br>Not sure if there is a simpler way. I feel that by following this design I'll have headaches in the UI.<br>&nbsp;<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, November 24, 2008</h2>Ya, I think you will have headaches.<br><br>What I would do is have a SalesOrderDeliveryAddress class, and use that as the type for DeliveryAddress.&nbsp; You shouldn't be able to set this property in the UI, it's read only.<br><br>You can then implement a method, SetAddress on that type which accepts a CustomerAddress instance, and copies it's values into it's own.&nbsp; <br><br>I've gone down this route, and this seems to be the best solution.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cosmin replied on Monday, November 24, 2008</h2><br>SetAddress seems ok. I think I'm going to go that route either.<br>What do you do inside SetAddress()? Do you store the address object in a field or just grab its id and use that?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, November 24, 2008</h2>It depends on what you're doing.&nbsp; If you want the address linked, I would copy all the fields (just so the UI can display them) and also the address id of the instance passed to SetAddress.&nbsp; In my case, we don't want that to be the case so I create a new row in the address table, because I need to keep the address at the time the order was created, not the most current one.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cosmin replied on Monday, November 24, 2008</h2><br>ajj thanks for your input. much appreciated.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, November 25, 2008</h2><P>I have run into this situation many times in cases where customers have multiple addresses that you can select from when entering a Sales Order.&nbsp; Typical fields are Bill To and Ship To, for instance.</P>
<P>I usually have a separate BO, CustomerAddressList, that contains CustomerAddress objects and is used to display the list of available addresses to select from in the UI.&nbsp; As you mention, the actual address itself is read-only in this context.&nbsp; However, my SalesOrder business object has BillTo and ShipTo properties which are of the CustomerAddress type.&nbsp; This works just great.</P>
<P>Part of the reason for this comes from the realization that a reference to the address is not sufficient when we persist the SalesOrder to the data store.&nbsp; If the customer's address changes later, is should NOT be reflected in old sales orders.&nbsp; They MUST reflect the address at the time the order was completed.&nbsp; As a result, I have structured my business objects to satsify the required UI behavior.</P>
<P>When I persist the SalesOrder object, it writes out the various properties of each CustomerAddress object to the appropriate columns in the database, such as BillToAddress, BillToCity, ShipToState and so on.&nbsp; Granted this decreases normalization in the db, but given the business case where we need accurate history for our sales order, it is appropriate as each sales order record is now a snapshot of the data at the time the sales order was created/completed.</P>
<P>Now, if the customer's address changes, the original SalesOrder will still reflect the original values when retrieved.</P>
<P>NOTE: I have come across a&nbsp;use case where there is value in updating the address data when the customer's address changes.&nbsp; This has only been the case when the sales order has yet to be completed and I use the sales order's state to determine what records must be updated.&nbsp; This is handled when the address changes by retrieving all CustomerOpenSalesOrders (BO) for that customer and&nbsp;resetting the appropriate address property then saving the COSO object.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 25, 2008</h2>Sounds just like what I've implemented, except I keep the address in the address table and simply create a new record tied to the order.&nbsp; I also have a way to refresh the address on the order, so it has to always keep a link to the original address to copy the data again.&nbsp; Also... uses wanted to be able to send changes on the order address back to the original contact address... so I have a method to do that as well..<br><br>It was a PITA to get it working...but now that it's in place it seems to work pretty well.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
