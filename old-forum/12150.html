<html><header><title>Serialisation of business object assemblies with different versions (minor/revision/build)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Serialisation of business object assemblies with different versions (minor/revision/build)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12150.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Friday, September 13, 2013</h2><p>We use strongly named assemblies and have an effective and rigorous versioning process.</p>
<p>As you know, both the Client and the Server (read Data Portal Host) must have the same version available when serializing/deserializing CSLA mobile objects. <br />If you don&#39;t (for example the server has a newer version than the client) then you typically get a FileNotFoundException and a message along the lines of:<br /><span style="font-family:mceinline;">&quot;<i>Could not load file or assembly &#39;XXXX, Version=1.2.3.4, Culture=neutral, PublicKeyToken=XXXl&#39; or one of its dependencies</i>&quot;&nbsp;</span></p>
<p>For us, we normally manage backwards compatibility with AssemblyFileVersion, but with Silverlight clients this does not help, and Out-Of-Browser (OOB) applications do not detect that there is a newer version available for upgrade, based solely on AssemblyFileVersion.<br /><br />So, we need to change the AssemblyVersion, but that would break backwards compatibility. My question is therefore how can I have the CslaBinaryWriter / CslaBinaryReader / MobileFormatter allow serialization/deserialization when a part of the AssemblyVersion number is be different (say the last 2 numbers of the 4 part version number). It would be great if I can have it fail (as it does now) when the Major / Minor numbers differ?&nbsp;</p>
<p>Many thanks,<br />Jaans&nbsp;</p>
<p>--------------------------------------------------------------------------------------------</p>
<p><span style="font-family:mceinline;">For those wanting more detail, below is a more long-winded-background blurb.&nbsp;</span></p>
<p><span style="font-family:mceinline;">We maintain our backwards-compatible builds by incrementing versioning only for the AssemblyFileVersion and retain the same AssemblyVersion for versions of assemblies that are compatible.&nbsp;The CSLA Mobile Object serialization doesn&#39;t break because the AssemblyVersion of the client and the server still match.</span></p>
<p><span style="font-family:mceinline;">When changes are made that breaks backwards compatibility (due to either API change or more substantial features) we would obviously increment our AssemblyVersion, and usually the Major/Minor parts. This is pretty standard stuff in the .NET side of things and works very well.&nbsp;</span></p>
<p><span style="font-family:mceinline;">The key takeaway from this is that in .NET the assembly loading is smart enough to know to reload an assembly if it&#39;s AssemblyFileVersion is different, despite the AssemblyVersion being the same. This is great as it allows us to deploy critical patches and hotfixes to the offending assemblies only to production environments.</span></p>
<p><span style="font-family:mceinline;">However, on the Silverlight side things are not so &quot;easy&quot;, mostly because the AssemblyFileVersioning doesn&#39;t translate to the browser and specifically not to an Out-Of-Browser (OOB) Silverlight application.</span></p>
<p><span style="font-family:mceinline;">The simple solution would be to change the AssemblyVersion, specifically only the 3rd or 4th parts of the &nbsp;4 part version number (build and revision depending on your flavour of juice). e.g. v2.2.0.0 gets a backwards compatible patch as v2.2.0.1.</span></p>
<p><span style="font-family:mceinline;">In Silverlight, when the change to the AssemblyVersion is made, the new version is downloaded, and most importantly for us, the OOB application can detect that there is a new version available and update itself. The bad bit with it is that already installed but not-yet-upgraded OOB applications will break when they interact with the server due to the version number skew.</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Saturday, September 14, 2013</h2><p>Apologies - I just discovered we had a problem with our version generation for Silverlight. Silverlight does in fact honour detecting a change to the AssemblyFileVersion as an update when the AssemblyVersion is kept the same.</p>
<p>So that resolves my issue above.</p>
<p>However, the concept still intrigues me - would you want to be able to control what is deemed compatible versions or not, when you potentially update only the server or only the client?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
