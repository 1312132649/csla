<html><header><title>Handling children in an ObjectFactory</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Handling children in an ObjectFactory</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7082.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Telison posted on Thursday, June 11, 2009</h2>I have for some time trying to work out the correct patterns for handling children in the data access code in my object factory classes.<br /><br />When implementing the data acces code in the business objects the methods to use are Child_Update, Child_Insert etc. Now, when using an ObjectFactory class instead am I right in my conclusion that these "child" prefixed methods are out of the picture? In other words in this scenario these details need to be implemented in the Objectfactory in a more manual fashion.<br /><br />I just watched movie no six in the CSLALight movie series and from those instructions this seems to be the case.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 12, 2009</h2><P>That is correct.</P>
<P>As I've discussed in other threads, the object factory model leaves all the work to the factory implementation intentionally so as to not reduce flexibility as people create their own data access layers using the model.</P>
<P>In other words, I presuppose that users of the object factory model will create a DAL based around the object factory model, not necessarily use it from scratch (as that requires a fair amount of work).</P>
<P>The DataPortal_XYZ model is intended for use when you want CSLA to do more work on your behalf.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gort replied on Thursday, December 09, 2010</h2><p>So, in this scenario, how would we go about actually saving child objects?&nbsp; Would you suggest just calling the &#39;.Update()&#39; method on the DAL of a particular child object?&nbsp; Is there a way to iterate through all child properties and then simply call .Save() on them, or something similar?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 09, 2010</h2><p>It totally depends on how you are choosing to implement your factory objects and DAL. There are so many different ways to do this...</p>
<p>For my part, if I&#39;m using ObjectFactory, I tend to make my factory objects <em>be the DAL</em>, so they are what actually talk to the database. This is because ObjectFactory is already a level of indirection, and you can have many different sets of factory objects, one for each type of database or whatever.</p>
<p>But even if you make that assumption, you still have to pick a data access technology like raw ADO.NET, EF, L2S, NHibernate, etc. And that affects how you write your DAL code as well. I tend to use either raw ADO.NET or EF, with a preference for raw ADO.NET (connection/command/datareader/etc) since I think EF tends to complicate more than it simplifies.</p>
<p>Given those assumptions, I typically have a private method that is called by the public Update method - one private method for each child object type.</p>
<ol>
<li>The public Update method opens the connection, sets up any transaction, etc.</li>
<li>The public Update method saves the root object&#39;s data</li>
<li>The public Update method calls a private SaveChildX method, passing in ChildX</li>
<li>The SaveChildX method saves the child data (in the case of ChildX being a collection, it loops through the DeletedList, then the active list, calling a SaveChildY method on each child)</li>
</ol>
<p>Basically I look at a factory object as being responsible for persisting <em>an entire object graph</em> defined by the root object&#39;s type.</p>
<p>But I&#39;m sure other people have different views and different approaches. And certainly the approach could be very different if you are using EF or NHibernate or other technologies, because you could (and should) create your own factory object base type (subclass ObjectFactory) to help streamline and simplify your code.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
