<html><header><title>CLSA4 ViewModelBase : undo.BeginEdit()</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CLSA4 ViewModelBase : undo.BeginEdit()</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8972.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>HK.Lee posted on Saturday, May 22, 2010</h2><p>Hi alI,</p>
<p>How do you design viewmodel in case of parent-child object such as project-projectResouces-Resouce in Projecttracker sample ?&nbsp; My object is same with project tracker&nbsp;as such;</p>
<p>&nbsp; Cmod(BusinessBase) - CmodAccessarys(BusinessListBase) - Accessary(BusinessBase)</p>
<p>I created 2 viewmodels, one for root and another for BusinessListBase and bind them through xaml.</p>
<p>&nbsp; &lt;UserControl.Resources&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;CollectionViewSource x:Key=&quot;cmodViewModelViewSource&quot; d:DesignSource=&quot;{d:DesignInstance this:CmodViewModel, CreateList=True}&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;this:CmodChildViewModel x:Key=&quot;cmodChildVM&quot; Model=&quot;{Binding Source={StaticResource cmodViewModelViewSource},Path=Model.CmodAccessarys}&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/UserControl.Resources&gt;</p>
<p>However, when child collection viewmodel is created and reached in ModelProperty&#39;s&nbsp; PropertyMetadata() of ViewModelBase,complained error at undo.BeginEdit() because model is child object.&nbsp;</p>
<p>&nbsp;I think 1 viewmodel will cover everything for parent-child relations but&nbsp; would be very crowded,so 2 would be more cleaner.&nbsp;If I didn&#39;t&nbsp;take a wrong way in xaml binding, PropertyMetadata() of viewmodelbase might be changed&nbsp;to consider IsChild status&nbsp;as follows;</p>
<p>&nbsp;&nbsp;&nbsp; if (viewmodel.ManageObjectLifetime)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //var undo = e.NewValue as Csla.Core.ISupportUndo;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if (undo != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; undo.BeginEdit();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var undo = e.NewValue as Csla.Core.ISupportUndo;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (undo != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var parent = e.NewValue as IParent;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (parent == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; undo.BeginEdit();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>In addition,&nbsp;it might be&nbsp;needed to reset and change&nbsp;&nbsp;IsEnable of add/delete/cancel buttons according to U.I&#39;s special state, in which is already automatically set in viewmodel&#39;s SetProperties(). If SetProperties() of ViewModelBase is &#39;protected virtual&#39;, subclassed&nbsp;viewmodel&nbsp;can&nbsp; have more flexibility.</p>
<p>Thank you in advance.</p>
<p>HK.Lee</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>HK.Lee replied on Monday, May 24, 2010</h2><p>It looks my faults. Runs fine, so close this thread.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
