<html><header><title>Login failed for user '(null)'. Reason: Not associated with a trusted SQL Server connection.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Login failed for user '(null)'. Reason: Not associated with a trusted SQL Server connection.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1055.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dualybing posted on Monday, August 28, 2006</h2><P><FONT face="Courier New">Hello, I am attempting to use "Windows" authentication with my implementation of the CSLA Framework.&nbsp; For&nbsp;testing, I&nbsp;have a separate machine for UI, Application Server&nbsp;and Database.</FONT></P>
<P><FONT face="Courier New">I have added the CslaAuthentication = "Windows" key to my&nbsp;UI machine&nbsp;as well as the&nbsp;IIS machine&nbsp;handles the remoting.&nbsp; I have also created the identity impersonate="true" key on the IIS server and disabled anonymous access under the website config.</FONT></P>
<P><FONT face="Courier New">Everything works great when the UI + Business logic reside on the same machine... however, everytime I attempt to use&nbsp;a remote dataportal I get:</FONT></P>
<P><FONT face="Courier New" color=#ff0000>System.Data.SqlClient.SqlException: Login failed for user '(null)'. Reason: Not associated with a trusted SQL Server connection.</FONT></P>
<P><FONT face="Courier New">When I look in the EventLog I can see that my user account has been successfully authenticated by Windows on my web server, but when the data call goes out to my SQL Server (third and separate machine) the credentials are not making it there.</FONT></P>
<P><FONT face="Courier New">Will someone be awesome enough to explain&nbsp;what I have missed?</FONT></P>
<P><FONT face="Courier New">Thanks,</FONT></P>
<P><FONT face="Courier New">-Rob</FONT><FONT face="Courier New"><FONT color=#0000ff size=2></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 28, 2006</h2>I am not a security expert, so I can't give a full explanation. However, I do know that there are limits to how far you can impersonate, and I think you are hitting that limit. In other words, the app server can impersonate the identity of the client's user, but it can't then pass those credentials to the database server to do the impersonation there. I'm sure there's a good reason why this is the case, but I'm not enough of a security expert to explain it...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>figuerres replied on Monday, August 28, 2006</h2><P>OMG.... it's been a while but....</P>
<P>if you have a domain and several servers you may use AD with Keberos to pass a Kebros TGT all the way back to the SQL server.</P>
<P>but first I'd check "WHY" you want to do that.</P>
<P>generally if you go to deep with impersonation you incurr some problems like number of CAL's you have to have and number of sql connections you are opening.</P>
<P>say you have 3 servers:&nbsp; front web, midle app, back end SQL</P>
<P>then let the mid-tier have an account to connect to SQL</P>
<P>then sql gets one user, and you can use connection pooling to keep connections llow and CAL's low</P>
<P>and perf high.</P>
<P>If I dug out the details there are sveral reasons why that is generaly the way to go aside from the first few....</P>
<P>build checks in your front and mid servers and then "trust" that mid teir box to do only what you tell it to do.</P>
<P>do not let any users inputs go all the way back w/o having been transformed and sanitised so to speak :-)</P>
<P>HTH</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>figuerres replied on Monday, August 28, 2006</h2><P>here is a blog item that relates:</P>
<P><A href="http://blogs.msdn.com/mjeelani/archive/2004/12/07/275921.aspx">http://blogs.msdn.com/mjeelani/archive/2004/12/07/275921.aspx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dualybing replied on Tuesday, August 29, 2006</h2><P><FONT face="Courier New">ok, i'll just hard code the middle tier impersonation&nbsp;to take advantage of connection pooling&nbsp;(that worked when I tested it previously).</FONT></P>
<P><FONT face="Courier New">Thanks.</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
