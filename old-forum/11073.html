<html><header><title>Edit Level mismatch error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Edit Level mismatch error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11073.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>fredg posted on Friday, January 20, 2012</h2><p>Hi,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; We are coding against windows form. Our root object contains multiple children objects. When updating a child opject, Edit Level mismatch error happens.</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;I check the Edit Level of every object (including parent, children&#39;s) and if one of the chilren has different edit level from others&#39;, that means this particular child has problem even if&nbsp;we&#39;re updating another child object?</p>
<p>&nbsp;Thanks.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, January 20, 2012</h2><p>Windows Forms data binding is very particular about following its rules. And so is CSLA. The rules are relatively straightforward, but you can&#39;t deviate.</p>
<p>The primary rule: every beginedit must have a corresponding canceledit/endedit on each object (parent, child, etc).</p>
<p>Edit level mismatch occurs because some object in the object graph didn&#39;t get a canceledit/endedit call. The most common reason is that the object wasn&#39;t properly unbound from the UI prior to saving.</p>
<p>The <em>Using CSLA .NET 3.0</em> ebook has pretty extensive coverage of Windows Forms data binding and how to make it work correctly.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fredg replied on Friday, January 20, 2012</h2><p>Thanks. Can I have more specific for my situation:</p>
<p>The parent object&nbsp;has 2 children objects:&nbsp;when updating&nbsp;child 1, the mismatch error happens. The parent and child1 have edit level 0, child2 has edit level 1. That necessarily means child 2 has problem? We need to determine which one has issue and fix that object.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 20, 2012</h2><p>There is no real easy way to find the object that has the elevated edit level. Nor can you &quot;fix that object&quot;. You&#39;ll have to fix the broken UI code that isn&#39;t using data binding correctly.</p>
<p>The thing to keep in mind is that data binding uses a concept called currency. In any given binding source only one object is current. That object will have an elevated edit level.</p>
<p>In a detail form bound to a single object, that object clearly has currency.</p>
<p>In a datagrid or other complex binding control that is bound to a list, only one object in the list will have currency. As the user moves from row to row currency is automatically moved/managed by the WinForms binding source object.</p>
<p>With parent-child objects, the most common scenario is that the parent object is bound to a form, so it has currency.</p>
<p>Then the child collection is bound to a datagrid or something like that. So one child has currency too (because this is a separate binding source).</p>
<p>Before you can save, you must first unbind the child collection <em>properly</em>. And that usually means manually calling EndEdit on the current row, because data binding won&#39;t do that automatically :(</p>
<p>Then you must unbind the parent object and ensure EndEdit is called.</p>
<p>Then you can save the object.</p>
<p>Then you rebind the UI to the result of the Save method.</p>
<p>Again, this is covered in some detail in the 3.0&nbsp;ebook. In CSLA .NET 3.7 and higher there are also some helper components in Csla.Windows that automate some of this work. Those components are discussed briefly in the <em>Expert 2008 Business Objects</em> book.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, January 21, 2012</h2><p>Hi,</p>
<p>You can also download the latest source from CslaContrib and look at the CslaContrib.Windows.BindingHelperExtension class. </p>
<p>There is some hard learned lessons in that code for Rebind/Unbind data objects and BindingSource. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fredg replied on Tuesday, January 24, 2012</h2><p>Sorry I cannot find CslaContrib.Windows.BindingHelperExtension class in CslaContrib.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, January 24, 2012</h2><p>Hi,</p>
<p>Download the latest source code from here:<br /><a href="http://cslacontrib.codeplex.com/SourceControl/list/changesets">http://cslacontrib.codeplex.com/SourceControl/list/changesets</a></p>
<p>or use this direct link to BindingSourceExtensions.cs:<br /><a href="http://cslacontrib.codeplex.com/SourceControl/changeset/view/92754#1623433">http://cslacontrib.codeplex.com/SourceControl/changeset/view/92754#1623433</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fredg replied on Thursday, January 26, 2012</h2><p>Thanks. In the ProjectEdit control sample, the parent is bound to a form, and the child collection is bound to a datagrid. So the RebindUI() looks like:&nbsp;</p>
<p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">
<p>private void RebindUI(bool saveObject, bool rebind) <br />{&nbsp;&nbsp;&nbsp; <br />&nbsp; this.projectBindingSource.RaiseListChangedEvents = false; <br />&nbsp; this.resourcesBindingSource.RaiseListChangedEvents = false; <br />&nbsp; try <br />&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; UnbindBindingSource(this.resourcesBindingSource, saveObject, false);<br />&nbsp;&nbsp; UnbindBindingSource(this.projectBindingSource, saveObject, true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .............<br />&nbsp; }<br />}</p>
<p>&nbsp;&nbsp; My question is: if the UI only contains a datagrid which is bound to child collection and&nbsp;parent object is NOT bound to any control/form, can we reduce the above code to the following and do NOT need to care about parent bindingsource?</p>
<p>&nbsp;private void RebindUI(bool saveObject, bool rebind)&nbsp;&nbsp; <br />&nbsp;{<br />&nbsp;this.resourcesBindingSource.RaiseListChangedEvents = false; <br />&nbsp;try<br />&nbsp;{<br />&nbsp;&nbsp; UnbindBindingSource(this.resourcesBindingSource, saveObject, false); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ......<br />&nbsp;}<br />}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
</span></span></span></span></span></span></span></span></span></span></span></span></p>
</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
