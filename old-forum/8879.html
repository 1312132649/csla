<html><header><title>Calling methods in a ViewModel from Xaml</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Calling methods in a ViewModel from Xaml</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8879.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Tuesday, May 04, 2010</h2><p>I&#39;ve been chewing on the MVVMExperimentSL code for a couple of days now, and it has been quite helpful. I am now stuck trying to figure out how to call a method in a ViewModel from Xaml.</p>
<p>In MVVMExperimentSL I see two&nbsp;methods in DataListViewModel, Load() and ProcessItems2 being called from ListPage.xaml where I see this line at the top:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;this:DataListViewModel x:Key=&quot;ListModel&quot; /&gt;</p>
<p>I also see the DataContext of StackPanel being set:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;StackPanel Grid.Column=&quot;0&quot; Margin=&quot;10&quot; DataContext=&quot;{Binding Source={StaticResource ListModel}}&quot;&gt;</p>
<p>I then see the ListBox binding to the Model of DataListViewModel:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ListBox ItemsSource=&quot;{Binding Path=Model}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ItemTemplate=&quot;{StaticResource DataList}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SelectionMode=&quot;Multiple&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name=&quot;DataListBox&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.TriggerEvent=&quot;SelectionChanged&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.MethodName=&quot;ShowItem&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.MethodParameter=&quot;{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem}&quot; /&gt;</p>
<p>Then there is this xaml for the button:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Button Content=&quot;Process items&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tag=&quot;{Binding ElementName=DataListBox}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.TriggerEvent=&quot;Click&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.MethodName=&quot;ProcessItems2&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csla:InvokeMethod.MethodParameter=&quot;{Binding ElementName=DataListBox, Path=SelectedItems}&quot;&gt;</p>
<p>I am assuming that since the&nbsp;Binding in the StackPanel governs the actions of all controls placed therein, perhaps that should be enough.&nbsp; But when I try to do this I keep getting errors.&nbsp; The first few times the error complained about not finding a Method with &quot;that name&quot;.&nbsp; This must be because Method signature did not match the call. But now I am getting an error 4004</p>
<p>Here is my ViewModel:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;this:FrameViewModel x:Key=&quot;frameData&quot; /&gt;</p>
<p>Here is the xaml in my button:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;RadioButton x:Name=&quot;btnPlan&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Content=&quot;{Binding RootCategories[3].RootCategoryName}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla:InvokeMethod.TriggerEvent=&quot;Click&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla:InvokeMethod.MethodName=&quot;btnPlanClick&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla:InvokeMethod.MethodParameter=&quot;{Binding ElementName=btnPlan}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Height=&quot;16&quot; /&gt;</p>
<p>Button content comes from the Model of the same ViewModel, FrameViewModel, and works just fine.&nbsp;&nbsp;I have also tried with my&nbsp;Method&nbsp;without arguments, and by eliminating the MethodParameter line from the xaml.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 05, 2010</h2><p>I have found the answer to my problem, but have also discovered a dilemma posed by this MVVM thing.</p>
<p>Here&#39;s what&#39;s happening.&nbsp; Much of the structure of my page is built on the fly based on info obtained from the database, i.e., the Model of my FrameViewModel.&nbsp; The Button I am pushing is bound to the Model so it can get the Content.&nbsp; Hence it knows nothing of the ViewModel.&nbsp; When I set the DataContext of the button itself to:<br /><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"><font size="2" color="#ff0000"><font size="2" color="#ff0000">
<p>DataContext</p>
</font></font></span><font size="2" color="#ff0000">
<p>&nbsp;</p>
</font></span></p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">=&quot;{</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">Binding</span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"> Source</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">={</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">StaticResource</span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"> frameData</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">}}&quot;</span></span></p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">instead of the DataContext of the entire Grid where the button lies, i.e.:<br /><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"><font size="2" color="#ff0000"><font size="2" color="#ff0000">
<p>DataContext</p>
</font></font></span><font size="2" color="#ff0000">
<p>&nbsp;</p>
</font></span>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">=&quot;{</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">Binding</span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"> Model</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">,</span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"> Source</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">={</span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">StaticResource</span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"> frameData</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">}}&quot;</span></span></p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">then the Button Click works like a charm, but the button content disappears. With Code-Behind, the button can get the Content from one binding and the click response from another entity, the codebehind.&nbsp; I suppose, I could expose all of the Model properties in the ViewModel, but that seems like a lot of work!&nbsp; Would appreciate a suggestion for&nbsp;something a little&nbsp;more pleasant.</span></span></p>
<p>Jav</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"></span></span></p>
</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 05, 2010</h2><p>(Sorry, the one time I decided to click Post without previewing the message, it is almost unreadable.&nbsp; Here is what I meant to say)</p>
<p>I have found the answer to my problem, but have also discovered a dilemma posed by this MVVM thing.</p>
<p>Here&#39;s what&#39;s happening.&nbsp; Much of the structure of my page is built on the fly based on info obtained from the database, i.e., the Model of my FrameViewModel.&nbsp; The Button I am pushing is bound to the Model so it can get the Content.&nbsp; Hence it knows nothing of the ViewModel.&nbsp; When I set the DataContext of the button itself to:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext =&quot;{Binding Source={StaticResource frameData}}&quot;</p>
<p>instead of the DataContext of the entire Grid where the button lies, i.e.:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext =&quot;{Binding Model, Source={StaticResource frameData}}&quot;</p>
<p>then the Button Click works like a charm, but the button content disappears. With Code-Behind, the button can get the Content from one binding and the click response from another entity, the codebehind.&nbsp; I suppose, I could expose all of the Model properties in the ViewModel, but that seems like a lot of work!&nbsp; Would appreciate a suggestion for something a little more pleasant.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 05, 2010</h2><p>Okay, continuing my education - there does appear to be a way.</p>
<p>I can set the DataContext of the overall container control to:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext =&quot;{Binding Source={StaticResource frameData}}&quot;</p>
<p>This will set the datacontext to the ViewModel.&nbsp; And then for binding the UI Controls I can use an expression that starts off with Model. followed by the actual property like:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model.MySleepingBrain.LeftHemisphere</p>
<p>Sheesh! Can&#39;t believe I couldn&#39;t figure it out sooner!!</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 06, 2010</h2><p>In 3.8 there are two (now three) controls in CSLA to help you:</p>
<ul>
<li>InvokeMethod</li>
<li>Execute</li>
<li>TriggerAction (3.8.3 only)</li>
</ul>
<p>In CSLA 4 I recommend the use of TriggerAction, because it is more powerful and works with the VS10 designer tools. I back-ported it to 3.8.3 because it is what I&#39;m using in the MVVM video I&#39;m creating.</p>
<p>Execute is gone in 4, because the Blend SDK has the exact same functionality - and removing it from CSLA means I can get rid of the System.Windows.Interactivity dependency (yea!).</p>
<p>InvokeMethod remains for backward compatibility, but it isn&#39;t as nice as TriggerAction, so I&#39;ve stopped using it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, May 06, 2010</h2><p>Thanks Rocky.&nbsp; It took some effort but I think I now have at least some comprehension of what&#39;s going on in this MVVM thing.&nbsp; MVVMExperimentSL project has helped a lot.&nbsp; There is a lot packed in that sample.&nbsp; Subclassing ViewModel now seems somewhat clear, but I&#39;m having difficulty visualizing situations where FrameworkElement would be the one to use other than the obvious one of when Model access is not needed.</p>
<p>I am using Csla 3.8.3, and in the intellisense I only see the InvokeMethod and NavigatorProvider.&nbsp; InvokeMethod then offers a choice of TiggerEvent, Target, MethodName and MethodParameter.&nbsp; I am back to using VS2008.&nbsp; I loved using VS2010 but it kept giving me errors about WebService, even though the code would run just fine, so a few days ago I decided to postpone migration to 2010.</p>
<p>Jav</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
