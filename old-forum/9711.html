<html><header><title>Validation for series of numbers</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation for series of numbers</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9711.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Holger posted on Thursday, November 04, 2010</h2><p>Hi all,<br /><br />I want to validate a series of numbers (e.g. money). I have a class with three Money-Properties &quot;Money1&quot;, &quot;Money2&quot; and &quot;Money3&quot; where the input rule is &quot;Money1 less than Money2 less than Money3&quot;. The input values should always be in ascending order and the error provider should show both errors &quot;less than&quot; and &quot;greater than&quot;. Our money class is tested and all operators are working well.<br /><br />My first idea was to create two rules &quot;MoneyLessThanOtherMoney&quot; and &quot;MoneyGreaterThanOtherMoney&quot; <br /><br />Sample code of &quot;MoneyLessThanOtherMoney&quot; (&quot;MoneyGreaterThanOtherMoney&quot; is the same):<br /><br />public class MoneyLessThanOtherMoney : CommonBusinessRule<br />{<br />&nbsp;&nbsp;&nbsp; public IPropertyInfo MoneySecondProperty { get; private set; }<br />&nbsp;<br />&nbsp;&nbsp;&nbsp; public MoneyLessThanOtherMoney(Csla.Core.IPropertyInfo moneyFirst, Csla.Core.IPropertyInfo moneySecond)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(moneyFirst)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;Csla.Core.IPropertyInfo&gt; { moneyFirst, moneySecond };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MoneySecondProperty = moneySecond;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AffectedProperties.Add(moneySecond);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;<br />&nbsp;&nbsp;&nbsp; protected override void Execute(Csla.Rules.RuleContext context)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Money moneyFirst = context.InputPropertyValues[PrimaryProperty] as Money;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Money moneySecond = context.InputPropertyValues[MoneySecondProperty] as Money;<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (moneyFirst != null &amp;&amp; moneySecond != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (moneyFirst &gt;= moneySecond)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string message = string.Format(Localization.MoneyRules.MoneyLessThanOtherMoney, PrimaryProperty.FriendlyName, MoneySecondProperty.FriendlyName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Results.Add(new RuleResult(RuleName, PrimaryProperty, message) { Severity = Severity });<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />}<br /><br />And the AddBusinessRules method is:<br /><br />protected override void AddBusinessRules()<br />{<br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyLessThanOtherMoney(Money1Property, Money2Property) { Severity = Csla.Rules.RuleSeverity.Error });<br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyGreaterThanOtherMoney(Money2Property, Money1Property) { Severity = Csla.Rules.RuleSeverity.Error });&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br /><br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyLessThanOtherMoney(Money2Property, Money3Property) { Severity = Csla.Rules.RuleSeverity.Error });<br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyGreaterThanOtherMoney(Money3Property, Money2Property) { Severity = Csla.Rules.RuleSeverity.Error });<br /><br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyLessThanOtherMoney(Money1Property, Money3Property) { Severity = Csla.Rules.RuleSeverity.Error });<br />&nbsp;&nbsp; &nbsp;BusinessRules.AddRule(new MoneyGreaterThanOtherMoney(Money3Property, Money1Property) { Severity = Csla.Rules.RuleSeverity.Error });<br />}<br /><br />I would expected that I get two broken rules, when the users enters the following data<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;10 USD, 5 USD, 20 USD<br />&nbsp;&nbsp; &nbsp;<br />broken rule messages should be<br /><br />&nbsp;&nbsp; &nbsp;Money1 -&gt; must be less than Money2<br />&nbsp;&nbsp; &nbsp;Money2 -&gt; must be greater than Money1<br /><br />but I get only the message<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Money2 -&gt; must be greater than Money1<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />When I debug into my rule classes BOTH &quot;context.Results.Add&quot; got fired, but in the BrokenRulesCollection of my business class is only ONE broken rule. I tried different scenarios 2 - 4 depending money properties, only with 2 money properties I got the expected results. I&#39;m new to the new business rule subsystem, maybe it is a bug in the new system or my rules are not correct.</p>
<p>Does someone have a hint for me?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
