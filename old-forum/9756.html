<html><header><title>Foreign key combobox in MVVM</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Foreign key combobox in MVVM</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9756.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>hanspret posted on Saturday, November 13, 2010</h2><p>Hi</p>
<p>I&#39;m in the process of learning MVVM in Silverlight and making good process. I am however stuck on one situation. I am creating a screen where one can maintain users. When adding/updating a user record the user should link a role to a user by choosing the role from a combobox. The relationship is: One user can belong to one role and one role can belong to many users.</p>
<p>How would one accomplish this in the ViewModel. I have created a ViewModel for roleCollection and created an ObservableCollection in the UserViewModel that Reference the Role ViewModel but this isn&#39;t working as I hoped for. Below is the ObservableCollection in the User ViewModel:</p>
<p>&nbsp;</p>
<p>&nbsp;public ObservableCollection&lt;RoleViewModel&gt; RoleList&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var result = new ObservableCollection&lt;RoleViewModel&gt;();&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;r = new RoleListViewModel();&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//r.PropertyChanged += new System.ComponentModel.PropertyChangedEventHandler(r_PropertyChanged);&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (r.Model != null)&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;result = r.RoleList;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return result;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}&nbsp;</p>
<p>&nbsp;</p>
<p>Can anybody please show an example how to do this? I am using bxf.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Jaans replied on Sunday, November 14, 2010</h2><p>Hi Hannes</p>
<p>Mostly, I&#39;ve done this using a Dependency Property on the ViewModel for that list of Roles and then I simply bind the ComboBox&#39;s ItemSource to that dependency property. Important thing is to ensure that the dependency property is populated before your model is populated, or the binding gets a bit unhappy.</p>
<p>I&#39;m not sure about how much I&#39;m bending the M-V-VM rules with this approach, and I wonder what others have done. I&#39;ve just completed a post (before seeing your post) on the BXF discussion forums regarding this issue and questioning what the best approach is.<br /><br />Please have a read and see if it relates to your situation:</p>
<p><a href="http://bxf.codeplex.com/Thread/View.aspx?ThreadId=234636">http://bxf.codeplex.com/Thread/View.aspx?ThreadId=234636</a></p>
<p>Regards,<br />Jaans</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, November 14, 2010</h2><p>It depends on who&#39;s definition of MVVM you listen to :)</p>
<p>I use two things in this scenario.</p>
<p>First, I use a <em>unit of work</em> business object to retrieve the NVL and editable business objects in the same server request. That avoids timing issues due to async in Silverlight (and I always use async in WPF too).</p>
<p>Second, I do what Jaans suggests, having a dependency property on my viewmodel that exposes the NVL used to populate the list or combo box. And of course my viewmodel has a Model property that exposes the editable business object.</p>
<p>There are variations on this theme with &quot;parent-child&quot; viewmodels for some more complex screens too - but this is the central theme.</p>
<p>It might not be &quot;pure MVVM&quot;, but it is a simple and works well. Sometimes &quot;purity&quot; can make things so complex as to be useless...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Sunday, November 14, 2010</h2><p>Ah... OK.</p>
<p>That&#39;s a nice way of getting around the timing issues with multiple async retrievals - just wrap them in another BO.</p>
<p>Rocky, do you have an example of such a UOW amongst the samples? I guess one could simply put the &quot;Root&quot; objects as properties of ReadOnlyBase object?</p>
<p>Any pointers for organisation, naming convention, project structure regarding UOW? </p>
<p>PS: Just thought I&#39;m overthinking this ... is that called mental recursion? <img src="http://forums.lhotka.net/emoticons/emotion-40.gif" alt="Hmm" /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hanspret replied on Sunday, November 14, 2010</h2><p>Thanks for the answers.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, November 14, 2010</h2><p>There&#39;s some info in the FAQ (<a href="http://www.lhotka.net/cslanet/faq">www.lhotka.net/cslanet/faq</a>) and there&#39;s an example of UOW in the Core 3.8 video series samples.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Sunday, November 14, 2010</h2><p>Thanks Rocky</p>
<p>I found it in Core3804.wmv at position 1:39:27.</p>
<p>PS: Perhaps it would be nice to add timestamp to FAQ?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Monday, November 15, 2010</h2><p>Disclaimer: Sorry&nbsp;if this is included in the above references, but I could find anything about it though.</p>
<p>What do I use for the Model in the ViewModel?</p>
<p>My gut tells me the Model type of ViewModel doesn&#39;t change and that the Model and other dependency properties for the lookups / FK lists are populated with the result of the UoW factory.</p>
<p>My uncertainty comes in with the overloaded Refresh method on the inherted CSLA ViewModel base class. Normally you would have something like this:</p>
<pre style="font-family:consolas;"><span style="color:darkcyan;">BeginRefresh</span>(&nbsp;<span style="color:#a31515;">&quot;Get&quot; )</span></pre>
<p>What would be appropriate considering we now have UoW to use instead?</p>
<p>Apologies if I&#39;m being daft... just not seeing it at the moment.</p>
<p>Thank you<br />Jaans</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
