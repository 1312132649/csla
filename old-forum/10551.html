<html><header><title>CSLA object re-use / extension</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA object re-use / extension</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10551.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF posted on Thursday, July 21, 2011</h2><p>I&#39;d like to ask a question based on Rocky&#39;s suggestion <a target="_self" href="http://forums.lhotka.net/forums/p/8659/41221.aspx#41221">here</a> (to a different problem) about re-using and extending objects.&nbsp; His quote:</p>
<p style="padding-left:30px;">&quot;I&#39;ve said this so many times I can&#39;t count - it is always a good practice to create a set of custom base classes that sit between the CSLA base classes and your business classes. This is the primary extensibility model for several aspects of CSLA, including things like business rules, validation rules, authorization and the data portal.&quot;</p>
<p>With this in mind, if you create a base readonly object, is it recommended to leave the DataPortal_Fetch method empty in your base class and instead code it in your extended objects?&nbsp; Or do you code it in the base class and just override it in the inherited class?&nbsp; Consider the following:</p>
<ul>
<li>BaseCustomerInfo : ReadOnlyBase
<ul>
<li>Id</li>
<li>Name</li>
</ul>
</li>
<li>AppA.CustomerInfo : BaseCustomerInfo
<ul>
<li>LastCallDateTime</li>
</ul>
</li>
<li>AppB.CustomerInfo : BaseCustomerInfo
<ul>
<li>AssignedSalesPerson</li>
<li>NextDeliveryDate</li>
<li>...10 other properties, etc</li>
</ul>
</li>
</ul>
<p>What about the DAL (we&#39;re using encapsulated invocation)?&nbsp; Do you have one DAL that is used across the objects and pull all possible fields in there?&nbsp; Or separate DALs, one for each object?&nbsp; It would seem like you wouldn&#39;t want to always pull 20 fields from the database if the object is only going to use two of them.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, July 21, 2011</h2><p>Your custom base classes provides extensibility for behavior.</p>
<p>Think, f.ex logging, timing data, exception logging. </p>
<p>You should NOT implement DataPortal_Fetch/Delete/Update in these classes. . <br />These methods should be implemented in the actual business objects.</p>
<p>DAL&#39;s can be coded in so many different ways. </p>
<p>I like Linq2Sql and EF - where it&#39;s up tp the developer to either get anononymus types or defines types. When using anonymous types (result not defined in your enitity model) you cannot send it as a &quot;well defined&quot; parameter to other objects so I prefer so have each object implement their own mapping logic between the Data objects and the business object. </p>
<p>On a personal not - I prefer ObjectFactory but that is just my personal preference as it keeps my BO&#39;s totally clean from any type of Data Access types, whether is be a SQL Database, REST service, WebService or proprietary data access technology.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Friday, July 22, 2011</h2><p>Thanks.&nbsp; So by &quot;behavior&quot; do you mean only those examples such as logging, or are additional properties included in that reasoning?&nbsp; </p>
<p>Is my outline of the BaseCustomerInfo and subclasses not a correct usage of it?&nbsp; In other words, is it not meant to create my own base CSLA class and provide the standard properties / rules / auth that every app would need and just allow subclasses to extend those properties/rules/auth, as needed?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, July 22, 2011</h2><p>You can create base objects with properties and authz/business rules.</p>
<p>The problem is that you get a very strong coupling and especially rules can be cumbersome.<br /> So, I have created some objects with common properties but always try to avoid adding authz/business to base classes.&nbsp; </p>
<p>Rules, in my experience, is not easily extendable and will often vary between subclasses (think f.ex&nbsp; corporate/private customer) .<br />So as a general recommendation - try to avoid adding business/authz rules to base classes.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 22, 2011</h2><p>The philosphy of the CSLA rules engine is that rules are first-class citizens. They are objects (and therefore can be tested, reused, etc).</p>
<p>Rules are then attached to properties of editable objects. Unless your class defines a property, the class can&#39;t do anything with rules, because it won&#39;t have anything to which the rule should be attached.</p>
<p>Typically you should avoid defining properties in base classes, primarily because it complicates the data access process substantially and really breaks down any sense of organization or abstraction in your code. So if you don&#39;t have properties in the base class, then you wouldn&#39;t attach rules in the base class either, so that limits the sorts of things you might do in a base class.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Friday, July 22, 2011</h2><p>So what I hear you both&nbsp;saying is that unless I want to do behavioral things like logging (as Jonny stated) I shouldn&#39;t create a bass class just to add common properties.</p>
<p>This takes me back to what really prompted me to ask about this:&nbsp; what is the general practice when creating or extending objects for use in two or more apps that each have slightly different needs?&nbsp; If the use case between the two is only slightly different, do you just make one object flexible enough to serve both needs?&nbsp; Or do you adhere to a hard rule of saying that any difference in use case leads to a totally new object?&nbsp; Again, the current scenario in my mind is a CustomerInfo object.&nbsp; One app might need 3 properties displayed, while another might require 8 properties.&nbsp; Do you just add the 5 extra to one object and re-use between the two apps even though the one app will be pulling over 5 extra properties that it really doesn&#39;t need?&nbsp; Thanks, again.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, July 22, 2011</h2><p>The pitfall that many developer experience with CSLA BusinessObjects is thinking of entities (as you would in a database/DAL).</p>
<p>Your BO should be shaped as per the use case and if there is a 1:1 relationship you will be better off by having all these properties in the same BO.<br /><b>IE: The BO&#39;s should be shaped as per the UseCase - do not think entities</b>. If they have different fields and rules then I&#39;d rather have them as separate objects as it makes my code more maintainable.</p>
<p>This will also simplify your business rules. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Friday, July 22, 2011</h2><p>The following is coming from a n00b over here <img src="http://forums.lhotka.net/emoticons/emotion-13.gif" alt="Angel" />... I also strongly feel that your business object should be based on how you are going to use it (E.G., use case) and all of your entities <strong>shouldn&#39;t </strong>be modeled like entities in an ORM.... But,&nbsp;I don&#39;t&nbsp;completely&nbsp;agree with the statement above saying that all of your properties should be in the same BO.&nbsp;</p>
<p><span>I think that TSF&#39;s point is perfectly valid for wanting to have a base class implementation, it makes sense&nbsp;</span><span>(sometimes like when it is in the same project, against the same DataSource...). I agree with both you and Rocky on the fact that one should understand the complexities involved in this task as well as some of the implications that are involved. But I think its crazy to throw code reuse out the window <img src="http://forums.lhotka.net/emoticons/emotion-7.gif" alt="Tongue Tied" />. From the sounds of it, he could get around the Rule issues with a virtual method that is overridden when adding or *changing* BO rules. Please correct me if I&#39;m wrong<img src="http://forums.lhotka.net/emoticons/emotion-13.gif" alt="Angel" />.</span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlambert replied on Monday, July 25, 2011</h2><p>I did this with a prior version of CSLA, and I now have another case where I&#39;d like to be able to do something like this.&nbsp; I understand that inheritance of base business objects adds some complexity, and I know it&#39;s a tricky case to model into the framework, but I think it&#39;s important to acknowledge that there are cases where there&#39;s a real need for something like this.</p>
<p>The business scenario I&#39;m looking at is one where there are several dozen forms that users can fill out.&nbsp; Although each of these forms is unique somehow, there&#39;s a set of rules that *all* of them are supposed to enforce.&nbsp; In the current (non-CSLA) system, since the forms are all different in some way, each of these forms is represented by its own chunk of code, so the common business rules are enforced differently from form instance to instance.</p>
<p>I&#39;m trying to drill into business people the need to have business rules managed in a way that ensures that they&#39;re coded and executed consistently (thus, the appeal of a framework like CSLA), and to have to turn right around and code a couple dozen business objects that repeat the same rules in &quot;n&quot; places is pretty hypocritical of me, IMO.</p>
<p>I haven&#39;t yet started prototyping a solution with a current version of CSLA yet, so I&#39;m not sure if the new approach for rules will work better than in previous versions, but I wholeheartedly support the idea that &quot;don&#39;t do that&quot; isn&#39;t really an answer to this type of inheritance.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 25, 2011</h2><p>I would not advocate implementing a rule more than once. In fact, the whole point of the system is so you can implement a rule, along with tests, one time, and then just associate that rule with as many properties of as many classes as necessary.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Tuesday, November 08, 2011</h2><p>That&#39;s certainly true for rules bound to properties, like the CommonRules. </p>
<p>What about a rule, which needs a part of the object graph, i.e. checks that the sum of some property of every children is 100%, or calculation of an amount base on regulations. This is logic, I want to reuse and ensure consistency! </p>
<p>I can see one technique for reusing such a business rule in multiple use cases: the use of interfaces and to code the rule againts the interfaces. As a benefit you get a clear contract between the rule and BOs.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
