<html><header><title>Subclassing:  How to Plumb</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Subclassing:  How to Plumb</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1683.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>WyattRidesAgain posted on Saturday, November 04, 2006</h2><P>I'm getting up to speed on CSLA and am a relative OO novice.&nbsp; In trying to design various parts of my application I keep coming up with a pattern for which I cannot figure out a CSLA solution.&nbsp; The pattern is:</P>
<P>&nbsp;- Root CSLA biz object,&nbsp;composed of one or more&nbsp;child CSLA biz objects and/or collections&nbsp;that implement behaviors specific to the root object.</P>
<P>&nbsp;- Subclassed CSLA biz objects, which add behaviors to the root biz object and inherit the behaviors of the root object via its child objects/collections.</P>
<P>To give a concrete example, assume the root object is "Entity".&nbsp; It holds&nbsp;a child collection "Roles",&nbsp;which holds one or more objects like "Customer", "Vender", etc.&nbsp; Entity is subclassed into either "Individual" or "Organization".&nbsp; The goal is that Individual or Organization inherits the Entity Role behaviors related to Customer and/or Vender and/or etc.&nbsp;</P>
<P>I've read many posts in the forum about related topics on using inheritance, composition, generics, and interfaces.&nbsp; While I understand much of it on an abstract level, when I try to write real code I keep hitting roadblocks.&nbsp; My head is swirling and my brain hurts.&nbsp; I think I'm missing the elephant in the room.</P>
<P>Could someone give a concrete example of how the various CSLA objects might be set up?</P>
<P>Thanks,</P>
<P>Wyatt</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Saturday, November 04, 2006</h2><P>Here's a c# code sample on how to inherit from your base class...</P>
<P>[Serializable()]<BR>public abstract class MyAppBusinessBase&lt;T&gt; : BusinessBase&lt;T&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where T : MyAppBusinessBase&lt;T&gt;<BR>{&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;// Base Class</P>
<P><BR>}</P>
<P>---------------</P>
<P>[Serializable()]<BR>public sealed partial class MyBizObjectBO : MyAppBusinessBase&lt;MyBizObjectBO&gt;<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Business Object Class which Inherits your base class<BR>}</P>
<P>&nbsp;</P>
<P>Hope this helps<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Sunday, November 05, 2006</h2>So, if I understand you correctly you have the following forces on your design:<br>- both individuals and organization can be assigned roles, so you want a base class that provides exactly this (Entity)<br>- but other than that they each have specific behavior, which causes you to make specific subclasses<br><br><br>To make this work, I believe all you would have to do is the following:<br>- create a member on your child collection class which takes a ISafeDataReader (or something akin like a DataTable or DataSet, whatever works for you) and then populates the collection for you from the supplied data object<br>- on Entity you define a property that holds such a collection (e.g. Roles)<br>- in the dataportal_fetch of both Individual and Organization you would invoke the aforementioned member with the correct argument(s) in order have it load the Roles<br>- the remainder of your dp_fetch members in those subclasses deal with loading the specific class<br><br>See also <a href="http://www.onelittlevictory.com">www.onelittlevictory.com</a> for additional help on this, also on how to get the other CRUD operations to work.<br><br>What you achieved then is that you can load, update and save your objects.<br><br><br>The next thing that you hit into then will be that you want to alter/extend/enhance behaviors in your specific sub-classes. Several techniques (design patterns) exist to address these kinds of challenges, but 'template methods' are usually preferred:<br><br>- declare a method in your base class (Entity) as overriddable, you can leave it empty or you provide a default implementation in your base class. In your sub-class you then override this method, depending on your use case you can then call the base implementation via MyBase.&lt;methodname&gt; or you decide to fully replace the default implementation with a new one (so don't call the base class' implemenation).<br><br>- sometimes you have routines in your base class that strongly rely on specifics that your subclass <b>must </b>provide. Then you can also choose to define MustOverride members in your base class. You can invoke them as usual in your base-class routines, but you leave the actual implementation to the sub classes. Basically, with MustOverride you <i>force </i>sub-classes to provide an implementation, whereas with overridable you gently allow this.<br><br>Many more techniques exist. If you need more advice, then you may perhaps better outline the details of the brick wall you hit into. <br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>WyattRidesAgain replied on Monday, November 06, 2006</h2><P>Bayu and guyroch,</P>
<P>Thanks very much for your advice;&nbsp; you've given me new energy to try again.&nbsp; Let me work on it and see if I can get it to work.&nbsp; Will let you know how it goes.</P>
<P>Wyatt</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Monday, November 06, 2006</h2><P>Here's another helpful link...</P>
<P><A href="http://www.primos.com.au/primos/Articles/CSLAversion2whatsinitforme/tabid/67/Default.aspx">http://www.primos.com.au/primos/Articles/CSLAversion2whatsinitforme/tabid/67/Default.aspx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>WyattRidesAgain replied on Monday, November 06, 2006</h2><P>I'm stuck trying to design the Role editable child, which would be held by Entity via its Roles collection property.&nbsp; Assuming the parent Entity is designed like guyroch suggests:</P><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>abstract</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Entity</FONT><FONT size=2>&lt;T&gt; : Csla.</FONT><FONT color=#008080 size=2>BusinessBase</FONT><FONT size=2>&lt;T&gt; </FONT><FONT color=#0000ff size=2>where</FONT><FONT size=2> T : </FONT><FONT color=#008080 size=2>Entity</FONT><FONT size=2>&lt;T&gt; { //base code }</FONT></P>
<P><FONT size=2>then for CRUD data access how does the child Role reference Entity, which presumably is its parent?&nbsp; To use Insert as an example, I've tried:</FONT></P><FONT color=#0000ff size=2>
<P>internal</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Insert(</FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> cn, Entity&lt;T&gt; parent)&nbsp; { // data access code here }</FONT></P>
<P><FONT size=2>..but the compiler doesn't like "Entity&lt;T&gt;".&nbsp; I've tried other variations to reference Entity, but they all create compiler errors.</FONT></P>
<P>I know I'm doing something wrong here.&nbsp; Any ideas?</P>
<P>&nbsp;</P>
<P>Thanks,</P>
<P>Wyatt</P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Monday, November 06, 2006</h2>Hey Wyatt,<br><br>To make this work, I guess you would need to define your roles collection as follows: <br><br>(sorry, I am a VB guy, so you will need to translate this)<br><br>&lt;Serializable()&gt; _<br>Public Class Roles(Of TParent As Entity(Of TParent)<br>&nbsp;&nbsp;&nbsp; Inherits BusinessListBase(Of Roles, Role)<br><br><br>In your Insert member you could then do the following:<br><br>Friend Sub Insert(conn as SqlConnection, parent As TParent)<br><br><br>This will have some repercussions on your other code, I cannot oversee if this will cause you more trouble or whether this is going to lead to a solution for you.<br><br>Hope this helps.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>WyattRidesAgain replied on Wednesday, November 08, 2006</h2><P>Bayu and guyroch,</P>
<P>After much trial and error and pain, I finally got it working.&nbsp; I've learned a bit about generics in the process, though a fair amount of it still mystifies me.&nbsp; Many thanks for your help!</P>
<P>Having gone through this now, I'm curious to get your insight on something.&nbsp; I'm trying to use code generation (ala Ricky Supit's CodeSmith tool at Codeplex) for my business objects.&nbsp; I now see that using using inheritance involves a lot of hand-coding on the objects;&nbsp; at least it did for me.&nbsp; In addition to the OO mantra of preferring composition over inheritance, is there some truth that using composition in CSLA&nbsp;is more "codegen friendly" than using inheritance?</P>
<P>Wyatt</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Wednesday, November 08, 2006</h2><P>Glad to see you up and running... can you please post your working code for everybody to see :)&nbsp; It would be good for future readers.</P>
<P>Thanks&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>WyattRidesAgain replied on Thursday, November 09, 2006</h2><FONT size=2>
<P>GuyRoch,</P>
<P>Glad to contribute; thanks for asking. Attached is a zip file with four classes I built to figure out how to use inheritance as described in this thread. The classes' members and behaviors are as simple as possible, since my focus was on how to implement generics. Class overview:</P>
<P>Role:</P>
<P>- Inherits from Csla.BusinessBase</P>
<P>- Has one string business property, RoleName, which would hold values like "vendor", "customer", "employee", etc.</P>
<P>Roles:</P>
<P>- Inherits from Csla.BusinessListBase</P>
<P>- Child to Party (see below)</P>
<P>- Holds the Role objects</P>
<P>Party:</P>
<P>- ("Party" is replacement name for "Entity" used earlier in the thread) </P>
<P>- Is abstract; inherits from BusinessBase</P>
<P>- Has one business property, PartyType, which holds a string value like "Person" or "Organization", describing what kind of Party it is.</P>
<P>- Holds a reference to Roles</P>
<P>Person:</P>
<P>- Inherits from Party, and therefore inherits Roles behavior/information</P>
<P>- Has one business property, FirstName</P>
<P>Again, the class methods are deliberately trivial since I was struggling getting generics to work. In the end it finally did, though I have to admit to being mystified by some of it.</P>
<P>As a question to pose to the group: Is there a way to avoid using generics with Roles and Role? Doing so seems to force client code to have to reference the concrete class, which isn't particularly intuitive to the user of the Role object. It looks like this: </P>
<P>_role = Role&lt;Person&gt;.NewRole(); // not intuitive</P>
<P>It would be nice to be able to simply use: </P>
<P>_role = Role.NewRole(); // intuitive</P>
<P>Thanks,</P>
<P>Wyatt</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
