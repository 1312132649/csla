<html><header><title>Override AddBusinessRules on Subclass</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Override AddBusinessRules on Subclass</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10334.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>brianlagunas posted on Tuesday, May 03, 2011</h2><p>It seems that it is not possible to have a subclass of a CSLA object such as:</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">[</span></span></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Serializable</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">]<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">abstract</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">class</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">GmcReadOnlyBase</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;T&gt; : </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ReadOnlyBase</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;T&gt; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">where</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> T : </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">GmcReadOnlyBase</span></span></span> <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;T&gt; <br />{<br />&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">protected</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">override</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span> <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">AddBusinessRules() <br />&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">base</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.AddBusinessRules();<br /><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(</span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsInRole</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AuthorizationActions</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.CreateObject, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">SecurityRoles</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.SystemAdministrator));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">BusinessRules.AddRule(</span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsInRole</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AuthorizationActions</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.DeleteObject, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">SecurityRoles</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.SystemAdministrator));<br />&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">}</span></span></p>
<p>Then override the AddBusinessRules again to add more rules:</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">[</span></span></span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Serializable</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">]<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">class</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CompanyInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> : </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">GmcReadOnlyBase</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CompanyInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt; <br />{<br />&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">protected</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">override</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void </span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">AddBusinessRules()<br /></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">base</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.AddBusinessRules();<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(</span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsInRole</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AuthorizationActions</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.CreateObject, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">SecurityRoles</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.Administrator));<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(</span></span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">IsInRole</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AuthorizationActions</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.DeleteObject, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">SecurityRoles</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.Administrator));<br />&nbsp;&nbsp;&nbsp;&nbsp; }</span></span>&nbsp;</p>
<p>The following appears in the output window:&nbsp;</p>
<p>A first chance exception of type &#39;System.ArgumentException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;System.NullReferenceException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.Reflection.CallMethodException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.Server.DataPortalException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.Server.DataPortalException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.Server.DataPortalException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.DataPortalException&#39; occurred in Csla.dll<br />A first chance exception of type &#39;Csla.DataPortalException&#39; occurred in Csla.dll</p>
<p>Is there a way to declare global rules to the base object and then add to those rules in the derived object?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, May 03, 2011</h2><p>Per-type rules are set in the static AddObjectAuthorizationRules method:</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AddObjectAuthorizationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.Rules.<span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">ProjectEdit</span>),&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">new</span>&nbsp;Csla.Rules.CommonRules.<span style="color:#2b91af;">IsInRole</span>(Csla.Rules.<span style="color:#2b91af;">AuthorizationActions</span>.CreateObject,&nbsp;<span style="color:#a31515;">&quot;ProjectManager&quot;</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.Rules.<span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">ProjectEdit</span>),&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">new</span>&nbsp;Csla.Rules.CommonRules.<span style="color:#2b91af;">IsInRole</span>(Csla.Rules.<span style="color:#2b91af;">AuthorizationActions</span>.EditObject,&nbsp;<span style="color:#a31515;">&quot;ProjectManager&quot;</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.Rules.<span style="color:#2b91af;">BusinessRules</span>.AddRule(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">ProjectEdit</span>),&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">new</span>&nbsp;Csla.Rules.CommonRules.<span style="color:#2b91af;">IsInRole</span>(Csla.Rules.<span style="color:#2b91af;">AuthorizationActions</span>.DeleteObject,&nbsp;<span style="color:#a31515;">&quot;ProjectManager&quot;</span>,&nbsp;<span style="color:#a31515;">&quot;Administrator&quot;</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre>
<p>This is discussed in the <em>Using CSLA 4: Creating Business Objects</em> ebook.</p>
<p>The rules are set per-type, and the data portal only operates on the concrete (non-generic) type of a specific business class. So the answer is no, you can&#39;t establish per-type rules at a base type level and have them apply to subclasses.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brianlagunas replied on Tuesday, May 03, 2011</h2><p>Thanks for the quick response. This is offically the&nbsp;first limitation I have had with CSLA.&nbsp; Not a big one though, I will just have to add the role to every object instead.&nbsp; I guess I should buy your new book :0)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, May 03, 2011</h2><p>Would this work in CustomBusinessBase&lt;T&gt; : BusinessBase&lt;T&gt; &nbsp;class?</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AddObjectAuthorizationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.Rules.<span style="color:#2b91af;">BusinessRules</span>.AddRule(typeof(T),&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">new</span>&nbsp;Csla.Rules.CommonRules.<span style="color:#2b91af;">IsInRole</span>(Csla.Rules.<span style="color:#2b91af;">AuthorizationActions</span>.CreateObject,&nbsp;<span style="color:#a31515;">&quot;ProjectManager&quot;</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 03, 2011</h2><p>That&#39;s an interesting thought Sergey, but I don&#39;t think CSLA will find or invoke that AddObjectAuthorizationRules method, because it isn&#39;t on the concrete type.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, May 03, 2011</h2><p>I must be thinking 3.8 then.&nbsp; I think that version used to invoke AddObjectAuthorizationRules method when evaluating rules for a type in ObjectAuthorizationRules class, so I was thinking it would find the method on base type and evaluate T properly...&nbsp; Would be cool if it did...&nbsp; I like global rules a lot...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brianlagunas replied on Tuesday, May 03, 2011</h2><p>This in fact does work, but the problem is that this method is static, and I can&#39;t &quot;add&quot; rules to it from the derived class.&nbsp; The call to AddObjectAuthorizationRules in the derived class would hide the call to the base class.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, May 03, 2011</h2><p>I wonder if you could make this method smarter, and walk inheritance change (while currentType.BaseType !+ null) and invoke this method using reflection on each type?</p>
<p>Seems kind of ugly at a high level though...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, May 03, 2011</h2><p>No way that will work with our current codebase in CSLA 4. </p>
<p><b>A</b><b>uthorizationRules will only allow one - 1 rule per AuthorizationAction / IElementInfo. </b></p>
<p>You cannot have 2 Authz rules instances for f.ex&nbsp; <i>AuthorizationActions.CreateObject </i>or <i>AuthorizationActions.DeleteObject</i> like the sample that Brian has in his original post.</p>
<p>Which is why you should only define (at least the static)&nbsp; Authz rule at the lowest level.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Tuesday, May 03, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>Brian Lagunas<br></b></p>
<p>This in fact does work, but the problem is that this method is static, and I can&#39;t &quot;add&quot; rules to it from the derived class.&nbsp; The call to AddObjectAuthorizationRules in the derived class would hide the call to the base class.</p>
<div style="clear:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp;<span><span>protected</span>&nbsp;<span>static</span>&nbsp;<span>void</span>&nbsp;AddObjectAuthorizationRules()</span></p>
<p>&nbsp; &nbsp; &nbsp;{</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calls base class static method.</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;GmcReadOnlyBase&lt;CompanyInfo&gt;.AddBusinessRules();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ........</p>
<p>&nbsp; &nbsp; &nbsp;}&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brianlagunas replied on Tuesday, May 03, 2011</h2><p>Yes, I am aware I could make that call, but it doesn&#39;t solve the problem which JohnnyBee puts it best. In a nutshell, CSLA does not support inherited Auth rules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 03, 2011</h2><p>I think Rene&#39;s answer is a decent workaround though?</p>
<p>Implement the default behavior in the base static method, and invoke that from your concrete class - unless you want custom rules in the concrete class, in which case you wouldn&#39;t invoke the base method because you are creating custom rules for the specific type.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>brianlagunas replied on Tuesday, May 03, 2011</h2><p>The reason for this behavior is for this scenario.&nbsp; Let&#39;s say that I have a few security roles one of them being a SystemAdmin.&nbsp; Naturally SystemAdmin will have rights to every single object, where other roles will have limited rights.&nbsp; The intent was not to have to keep adding the same SystemAdmin role to every single object, but instead add it to a base object so every single object will have SystemAdmin rights applied.&nbsp; Now all derived objects will have more roles appended to the object such as ProjectManager or whatever.&nbsp; The idea is to append, or add additional rights to the object.&nbsp; I hope I am being clear.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 03, 2011</h2><p>I see what you are saying.</p>
<p>I wonder if a variation on Rene&#39;s idea wouldn&#39;t work though?</p>
<p>Suppose your base class implemented a static method such as AddObjectAuthorizationRule(action, roleList)?</p>
<p>This method would be invoked from the AddObjectAuthorizationRules method of each concrete class, and would append any required roles (such as SystemAdmin) to the list of roles provided by the concrete class. At least each concrete class would only deal with its specific roles, leaving global roles to the base class.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, May 03, 2011</h2><p>That is absolutely&nbsp;doable for Object level authorization rules. </p>
<p>Just be aware that the same restrictions (only 1 - one aAuthz rule) also applies to methods and properties. So you may need to create a similar implementation for Authz in AddBusinessRules. </p>
<p>That may also force you&nbsp;to override CanReadProperty / CanWriteProperty /CanExecuteMethod for &quot;business-type&quot; related Authz rules as you can never know if any subclass / baseclass would add an Autz rule to the field. I&#39;m thinking of rules like this field is required based on another field value but only if you are Admin.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
