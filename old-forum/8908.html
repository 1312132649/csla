<html><header><title>CommandBase &amp; Transactional</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CommandBase &amp; Transactional</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8908.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Monday, May 10, 2010</h2><p>In our application, we have a CommandBase that descends from Csla.CommandBase.</p>
<p>We provide for some implementation in DataPortal_Execute, executing &quot;ExecuteCore&quot; (virtual) w/ the implementation in the concrete Command classes - wrapping it with a try / catch / EnterpriseLibrary.HandleException.</p>
<p>Some commands are transactional in nature and some are not.&nbsp; But if DataPortal_Execute is implemented in our base Command object, it obviously doesn&#39;t lend itself to having the attribute uniquely defined for each Command class.</p>
<p>An alternative is to have a TransactionalCommandBase class which inherits from our CommandBase class with the only implementation being in DataPortal_Execute: base.DataPortal_Execute(). It would be decorated with the transactional attribute and would be the base class for any transactional commands.</p>
<p>Is there another easy alternative to this approach that people have used&nbsp;that would behave against the examination of this attribute in the CSLA framework&nbsp;to determine which DataPortal to instantiate (Simple, Transactional, etc).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, May 11, 2010</h2><p>Hi, </p>
<p>So what you are doing is implementing a &quot;base class&quot; Command that calls a virtual method in your implementation so that your ExceptionHandling is implemented just once.&nbsp; Is this for logging purposes only or do you actually handle exceptions and possible return OK even if exception was thrown? </p>
<ol>
<li>A: If it is for logging purposes only then you could also consider to only implement <b>DataPortal_OnDataPortalException </b>method in your base class and use Tracsactional attributes as normal on DataPortal_Execute. There is even <b>DataPortal_OnDataPortalInvoke</b> and <b>DataPortal_OnDataPortalInvokeComplete</b> available for logging when call runs OK. </li>
<li>If you wish to change the actual exception being returned in DataPortalResult, then I am working on<a title="Bug: 679" href="http://lhotka.net/cslabugs/edit_bug.aspx?id=679"> Bug:679</a> to provide for this in a hook in the&nbsp; DataPortal. That is - having one common hook for all DataPortal calls (not including ChildXYZ calls) to inspect the Exception - log and rethrow original or transform to another execption for the client.</li>
</ol>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, May 11, 2010</h2><p>Thank you for the response. </p>
<p>Yes on the virtual method and exception handling occuring once.</p>
<p>Primarily for exception handling - I&#39;m using Enterprise Library, so it may have various exception handlers including rethrowing a different exception (to hide the exception details from the client) as well as a custom&nbsp;logging handler configured to log the exception as well as a private reflection of the business object of the data portal to store as XML along w/ the exception details.</p>
<p>I can&#39;t really have it occur in OnDataPortalException b/c I can&#39;t catch and handle (potentially rethrowing) the exception from there.&nbsp; It&#39;s already been caught by CSLA.</p>
<p>It sounds like the hook may be exactly what I&#39;m looking for.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, May 11, 2010</h2><p>Another thing you could consider, if you are just using TransactionScope and not Enterprise Services, is to have your base class manage the transaction.</p>
<p>Remember that the CSLA Transactional attribute, when using TransactionScope, is only saving you&nbsp;4 lines of code, two of which are brackets <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>Just have your base class decide (based on some protect property?) whether the subclass needs a transaction or not, and either wrap or don&#39;t wrap the subclass method call in a TransactionScope.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, May 11, 2010</h2><p>I think the only difference would be that the Invoke, InvokeComplete, etc would not be considered part of the transaction, whereas with TransactionalDataPortal they would be... right?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
