<html><header><title>Users inside Firewall vs. Users Outside Firewall</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Users inside Firewall vs. Users Outside Firewall</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2434.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeanB posted on Monday, February 26, 2007</h2><P>I have a situation where the business application I am writing is going to be used by people inside the network and by people outside the network.&nbsp; How can I change modes on the dataportal for people inside so it doesn't use the remoting site or at least uses the inside IP address?&nbsp; I am new to the forum so forgive me if this is "old hat".&nbsp; </P>
<P>Thanks.</P>
<P>Dean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 27, 2007</h2>You'll need to know if the user is currently inside or out of the firewall... I'm not sure what the best way to do that is, especially if some users have laptops and will be moving in and out of the domain..<br><br>You probably would also have to modify Csla a bit so that you can switch the dataportal to use on the fly.&nbsp; I think right now its only read out of a configuration file.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, February 27, 2007</h2><P>My guess is that the client will demand 2 applications. Not one.</P>
<P>One will be configured in the DMZ so outside users can hit and use the remoting DP.</P>
<P>The other will be on a different internal server for employee use. No remoting required.</P>
<P>(This is how I configured my app to run.)</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 27, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div><BR>You probably would also have to modify Csla a bit so that you can switch the dataportal to use on the fly.&nbsp; I think right now its only read out of a configuration file.<BR></div></BLOCKQUOTE></P>
<P>You won't have to actually modify CSLA itself, just create a custom data portal proxy.</P>
<P>If you look at Chapter 4 you can see how the four existing proxy classes are created - and none of them are terribly hard. They implement an interface, create the connection to the server (or not) and delegate the call.</P>
<P>You aren't talking about changing the way the network transport works or anything like that, so you should be able to create a switchable proxy - probably that just delegates to LocalProxy or RemotingProxy (or whatever protocol you are using).</P>
<P>Remember, this is all interface based, so chaining these things is pretty easy.</P>
<P>So what you might do is create your SwitchableProxy like this:</P>
<P>public class SwitchableProxy : DataPortalClient.IDataPortalProxy<BR>{<BR>&nbsp; private static bool _thruFirewall;</P>
<P>&nbsp; private static void SetThruFirewall(bool thruFirewall)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; _thurFirewall = thruFirewall;<BR>&nbsp; }</P>
<P>&nbsp; public bool IsServerRemote<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; get { return _thurFirewall; }<BR>&nbsp; }</P>
<P>&nbsp; public DataPortalResult Create(<BR>&nbsp;&nbsp;&nbsp; Type objectType, object criteria, DataPortalContext context)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; if (_thurFirewall)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.DataPortalClient.LocalProxy portal = new Csla.DataPortalClient.LocalProxy();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return portal.Create(objectType, criteria, context);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.DataPortalClient.RemotingProxy portal = new Csla.DataPortalClient.RemotingProxy();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return portal.Create(objectType, criteria, context);<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; // implement Fetch/Update/Delete<BR>&nbsp; }<BR>}&nbsp; </P>
<P>I'm sure you can optimize this and make it cleaner - but I'm trying to just illustrate the point. Your app code would need to detect whether you are inside or outside the firewall and call the SetThruFirewall() method so this object could route the call appropriately.</P>
<P>This class would be in your code - or it its own DLL. Again, no need to alter CSLA at all - I specifically designed the data portal to use a provider pattern for this sort of extensibility.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 27, 2007</h2>Ya, that's a better solution... that's one thing I keep forgetting, that you can build your own DataPortalProxy..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeanB replied on Tuesday, February 27, 2007</h2>Thanks.&nbsp; I will look at that and come back</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AzStan replied on Tuesday, February 27, 2007</h2><P>On method that Sort-of worked for us is to use DNS.&nbsp; A public DNS entry points to your application server via your public IP address on your gateway.&nbsp; Meanwhile your private network also has a DNS server that points that same name directly to the application server's private IP address.</P>
<P>I say 'Sort-of' worked, because when laptop computers move from public network to private network (or vise-versa), they don't immediatly function due to DNS caching.&nbsp; </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
