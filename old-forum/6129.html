<html><header><title>Ordered BO list</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Ordered BO list</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6129.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, January 12, 2009</h2>hi,<br><br>I'm converting some code to use the newer PropertyInfo capabilities in Csla.&nbsp; I ran across something I'm not sure how to handle.&nbsp; The BO is a BLB subclass, and when saved, the items in the list use their position within the list to save their order.&nbsp; The old code is like this:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"> internal void</font> SaveSelf( <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Data.Quoting.<font color="#008000">Product </font>parentProductData<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#008000">PositionCounter </font>counter;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">bool </font>raiseEvents;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">if </font>( IsDirty ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; raiseEvents = RaiseListChangedEvents;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = <font color="#0000ff">false</font>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">foreach </font>( <font color="#008000">BundleItem </font>item <font color="#0000ff">in </font>DeletedList ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.DeleteSelf();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeletedList.Clear();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; counter = <font color="#0000ff">new </font><font color="#008000">PositionCounter</font>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">foreach</font>( <font color="#008000">BundleItem </font>item<font color="#0000ff"> in this</font> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.SaveSelf( <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; parentProductData, <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; counter<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = raiseEvents;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>PositionCounter is just a class that has a method called GetPosition, which returns the current int value it stores than increments it.&nbsp; The child class calls it in it's data routines.<br><br>The problem is that Csla now iterates the list, so I have no way to create and send the instance.<br><br>My current thought is just to have the child item get the list via Parent, and then calling IndexOf.&nbsp; Does anyone see any issues with this?&nbsp; What about other ideas?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, January 12, 2009</h2><P>If you're using Child_Update, I had a scenario similar to this. It had to do with code maintenance - codes don't change too much and here isn't much to them, so the solution isn't highly performant - but that's OK because the frequency of use is very low. </P>
<P>I did an override of Child_Update in the BLB and looped through the children setting their sort values&nbsp;(I believe its an internal property)&nbsp;to their index, and then did base.Child_Update. (which took it from there)</P>
<P>I don't know if that's entirely identical to what you're attempting to do, but it sounded familiar. Obviously, in the event an item is inserted into the middle, it will force an update on potentially all of the codes (if inserted at position 0) -- but like I said, since it's a low frequency event and the objects are tiny,&nbsp;I wasn't too worried about it. </P>
<P>Chris</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, January 12, 2009</h2>Ok, thanks for the feedback.&nbsp; It sounds like I might be on the right track then.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, January 12, 2009</h2><P>We ran into something similar (and had hierarchy too).&nbsp; Someone I worked with did a performance test and found that, in our case, it was actually more performant to update the indexes as properties on each item whenever an applicable change was made to the list (add, remove, move) rather than iterate through the whole list each time we needed to re-index (on save in your case, I guess).</P>
<P>In our case we had long lists and, as I mentioned, a&nbsp;hierarchical component, and changes to the list itself were far less frequent than changes to the list items.&nbsp; Trust me, the logic wasn't the simplest but it did work out for us.&nbsp; For an incremental cost when an item was removed, inserted into the middle of the list or otherwise moved, we saved a ton not having to lookup each item's position as we iterated through to save.&nbsp; We basically spread it out rather than incurring it all at once.</P>
<P>Something to think about.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>daniel_higgins replied on Monday, January 12, 2009</h2><P>why not override the ChildUpdate and use a </P>
<P>for(int x=0; x&lt; this.Count; x++)&nbsp;<FONT size=2>DataPortal.UpdateChild(this[x], parameters, i);</FONT></P>
<P><FONT size=2>in the middle of your override. </FONT><FONT size=2>The current code in BLB UpdatChild is pretty much the same as what you used before.</FONT></P>
<P><FONT size=2>I've noticed that BLB has a lot of logic for maintaining Indices and PositionMaps. It might be that calling up to the parent from the child object, as you've considered as an alternative, might be very fast. </P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
