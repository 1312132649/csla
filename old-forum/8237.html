<html><header><title>Puzzling Behavior in BusinessBase</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Puzzling Behavior in BusinessBase</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8237.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Wednesday, December 30, 2009</h2>Sorry for the idiotic Subject line for this message but I couldn't think of anything else.<br /><br />Using Csla 3.8.1 (Silverlight).<br />After working with ReadOnlyBase derived objects all this time, I created my first parent-child BusinessBase pair of objects.  Everything else looks fine except when, in the parent object, I am creating a Property to access the child object like:<br /><br />                if (!FieldManager.FieldExists(childObjectProperty ))<br />                    LoadProperty(childObjectProperty, ChildObject .NewChildObject ());<br />                return GetProperty(childObjectProperty);<br /><br /><br />In the ChildObject.Server.cs I do have:<br />                public static ChildObject NewChildObject ()<br />        {<br />            return DataPortal.CreateChild();<br />        }<br /><br />In the ChildObject.Client.cs I also have:<br />public static void NewChildObject(EvenetHandler stuff  callback)<br />{<br />}<br /><br />But the line ChildObject .NewChildObject () in the parent gives me the error:<br /><br />No overload for method 'ChildObject' takes '0' arguments<br /><br />If I Right click on the method call in the Parent and choose GoTo Definition, it takes me to ChildObject.Server to the correct NewChildObject () method.<br /><br />If I change the child object's declaration from Csla.BusinessBase to Csla.ReadOnlyBase, this error promptly disappears (of course, there are other (expected) errors.<br /><br />I have looked at the class declarations and they all appear correct, but obviously I am not doing something right.<br /><br />Would appreciate a hint or two.<br /><br />Javed</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 30, 2009</h2><P>CreateChild always runs on the client and it sounds like your NewChildObject method is only in the server side assembly.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, December 30, 2009</h2>In the ChildObject.Server.cs I have: <br />public static ChildObject NewChildObject () <br />{ <br />return DataPortal.CreateChild(); <br />} <br /><br />In the ChildObject.Client.cs I also have: <br />public static void NewChildObject(EvenetHandler stuff callback) <br />{ <br />} <br /><br />The NewChildObject is in both, ChildObject.Server as well as in ChildObject.Client.  It is true that the NewChildObject on the client has the callback EventHandler argument and thus the error "No overload for method 'NewChildObject' takes '0' arguments".  But that will always be the case because of the need for the callback EventHandler on the Client.<br /><br />I am wondering if something else is screwed up in this pair of projects because if I "Clean Solution" followed by "Build Solution", I see an additional error:<br /><br />\Documents\Visual Studio 2008\Projects\....\VisitClientLibrary\Bin\Debug\VisitLibrary.dll' could not be found.  VisitLibrary is the NameSpace as well as the Assembly name of VisitServerLibrary and VisitClientLibrary projects - the two projects in question.<br /><br />Javed</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 30, 2009</h2><P>The new error just means a project depends on VisitLibrary, which isn't building and thus there's no assembly for the dependant project to use to resolve types.</P>
<P>Are you getting a runtime error or compile error?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, December 30, 2009</h2>Thanks for your help.<br /><br />The bin directory of my VisitClientLibrary was indeed empty at that time.  The problem may have been with my WebService reference.  I am not sure but after fiddling with the projects, the bin directory now has everything in it.<br /><br />My error however persists - and it is a compile error.  I decided to create another small Silverlight solution and moved my Parent and Child classes into it.  I intended to attach it to this email to demonstrate the problem.<br /><br />But lo and behold - no error!  Compiler is happy and the project builds fine.<br /><br />At this point, I think I will remove my existing, quite likely sick, projects and replace them with new projects and move my files into them.  That will probably fix the problem.<br /><br />Thanks for your help.<br /><br />HAPPY NEW YEAR TO YOU AND Y'ALL.<br /><br />Javed</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 31, 2009</h2><P>Hmm... its possible that the project calling the NewChild() method wasn't looking at the business library which contained by the .Client and .Server files.&nbsp; My understanding of Csla Light is that you have a BO assembly for Silverlight, which only includes the .Client files, and a BO assembly for your application server, which includes both.</P>
<P>But I don't know how you had things setup, so I have no idea!</P>
<P>Just don't be mislead by VS though; just because it figured out where the method lives doesn't mean that's how the compiler sees it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, December 31, 2009</h2>You are right that the ...ClientLibrary project will contain the Child.Client file and the ....ServerLibrary project the Child.Server file.  <br />The Client file has Factory methods that only work asynchronously and therefore always have at least one argument, the EventHandler for callback, and the methods are declared public static void.  The Server file also has (should it always have?) Factory methods that return the object, as in Windows version, and can have 0 argument.<br /><br />It looks like that the magic is provided by the CslaDataProvider in the Silverlight xaml file. When calling the Factory method that expects the call back argument, CslaDataProdier adds the callback after any other parameters supplied by the programmer.  If I was to call the same exact method manually in code, I'll have to supply the callback.<br /><br />Here is where the problem originated.  Problem started in the Property code that checks to see if Child exists, and if not to "Create" a new Child by calling - what else - the New.. factory method. The question is, which factory method?  And with what parameters , i.e., with callback or without.  In my little sample that I was about to post, I had the Server file Factory method with 0 arguments and compiler was happy but  that method will never be called in Silverlight.<br /><br />What is now happening in my project is an inconsistent behaviour.  Sometimes everything works fine and the project actually runs, at other times I start getting an error - and it is always the code within the Child Property declaration.<br /><br />I have a feeling that creating an object within the property declaration like that is going to be non-option in SL - but I may be wrong.<br /><br />I think only Rocky can solve this dilemma.<br /><br />Javed</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 31, 2009</h2><P>Because the factory method is called asyc (which is required by silverlight), its possible for your property to return null... and your UI must handle this scenario correctly.</P>
<P>You can do it... but I'm afraid I can't be of much more help, as I've yet to delve into silverlight. The answer should be on the forum somewhere, as that's how I recall this issue.&nbsp; Maybe searching for silverlight and lazy load will help.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, December 31, 2009</h2>I have now tried using this in the Property Get:<br /><br />            get<br />            {<br />                if (!FieldManager.FieldExists(childProperty))<br />                {<br />                    Child.NewChild(ChildKey,(o, e) =><br />                        {<br />                            LoadProperty(childProperty, (Child)o);<br />                    });                    <br />                }<br />                return GetProperty(childProperty);<br />            }<br /><br />I do have an overload of NewChild that expects Int32 ChildKey plus the callback - in other words 2 arguments.  What is maddening is the same old error:<br /><br />"No overload for method 'NewChild' takes '2' arguments"<br /><br />I have a second overload of NewChild with only the callback.  If I remove the ChildKey from NewChild call, I get this:<br /><br />"Cannot convert lambda expression to type 'int' because it is not a delegate type"<br /><br />I declare!!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
