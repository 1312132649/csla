<html><header><title>Moving Criteria to the DAL interface</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Moving Criteria to the DAL interface</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10806.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Monday, October 24, 2011</h2><p>Hi Rocky,</p>
<p>I have this SearchCriteria with 13 properties. Under the Encapsulated Implementation model it used to be a protected POCO class that was nested in a ReadOnlyBindingListBase class. Now I&#39;m moving the project to Encapsulated Invoke and of course the 13 properties are still needed to make a decent search.</p>
<p>The DAL interface must know about a POCO object that stores the 13 properties as this object is passed as parameter of a Fetch method overload. None of the 13 properties is used by the interface itself. The options are:</p>
<p>1) Keep the SearchCriteria on the Business/Library assembly but make it inherit from an interface definition in the DAL interface. On the negative side, on the DAL implementation, an equivalent object must also be defined.</p>
<p>2) Move the SearchCriteria to the DAL interface assembly and use this object on the Business/Library and on the DAL implementation (somewhat like you do with DTOs).</p>
<p>I think everyone agrees option 2) is the simplest one. Now suppose this SearchCriteria class was changed and inherits from CriteriaBase or even BusinessBase. Defining the class on the DAL interface would make it dependent on Csla. Then again, DataNotFoundException class used on the EncapsulatedInvoke samples is already dependent on Csla.</p>
<p>What do you think?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Tuesday, October 25, 2011</h2><p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;">I think option 2) is fine. </span></p>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;">Here&#39;s another idea. </span><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;">The CodeSmith&#39;s Csla Templates uses a&nbsp;&nbsp; <span style="font-family:courier new,courier;">Dictionary&lt;string, object&gt; _bag&nbsp; </span>to store alle criteria values.&nbsp; And it passes this Bag to the DAL as a generic structure to construct the where clause. </span></p>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;">When generating you can choose the keys in the dictionary equals to the column names, while the property names correspond to the business:</span></p>
<p class="MsoNormal">
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;"><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">public</span></span></span> <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">string</span></span></span></span></span><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;"> Iso3166Alphabetical<br />{<br />&nbsp;&nbsp; <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">get</span></span></span> { <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">return</span></span></span> GetValue&lt; <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">string</span></span></span> &gt;(<span style="color:#a31515;"><span style="color:#a31515;"><span style="color:#a31515;">&quot;iso3166alpha3&quot;</span></span></span></span></span></span><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;">); }<br />&nbsp;&nbsp; <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">set</span></span></span> { _bag[<span style="color:#a31515;"><span style="color:#a31515;"><span style="color:#a31515;">&quot;iso3166alpha3&quot;</span></span></span>] = <span style="color:#0000ff;"><span style="color:#0000ff;"><span style="color:#0000ff;">value</span></span></span></span></span></span><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;">; }<br />}</span></span></span></span></p>
</p>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;"><span style="font-size:small;"><span style="font-family:arial,helvetica,sans-serif;">For some additional reasons, I made the Business a &quot;friend&quot; assembly of the DAL (I&#39;ve no interfaces yet). So the DAL can access all internals of its Business counterpart, and the Criteria and DTO are in the Business.</span></span></span></p>
<p class="MsoNormal"><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;font-size:10pt;mso-bidi-font-size:11.0pt;mso-bidi-font-family:&#39;Times New Roman&#39;;mso-bidi-theme-font:minor-bidi;"><span style="font-size:small;"><span style="font-family:arial,helvetica,sans-serif;"></span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Tuesday, November 01, 2011</h2><p>On second thoughts, this can be handled in a couple of different ways. Some notes:</p>
<p>1) In what the DAL is concerned, criteria parameters are just parameters to pass on to the SQL query. As Stefan Cop pointed out, a Dictionary&lt;string, object&gt; is a form as good as any other. Maybe not the fastest alternative though.</p>
<p>2) Another way to do it is to let the Criteria class live in the business layer and to pass the criteria parameters to the DAL as method parameters. This is brings back the DTO or no DTO question. One of the issues is readability of the code. According to &quot;Code Complete&quot; author&#39;s advice, for readability sake the maximum number of parameters one should use is 7. If one has to pass more than 7 parameters, use 1) or 3)</p>
<p>3) Or we can do as stated before: move the criteria class to the interface layer.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>StefanCop replied on Wednesday, November 02, 2011</h2><p><span>I totally agree with you. </span>Some more notes:</p>
<p>1) Such a generic structure has the advantage, that the presence or absence of entries indicate what you want in the where clause (as used by codesmith tempates), and as .NET&nbsp;type it is always accessible. On the other hand, you can add errornous entries,&nbsp;no safety.&nbsp;<br />The templates cerate an accessor to the dictionary, which is in fact the Criteria for a BO. So, business code will only&nbsp;manipulate the dictionary through the Criteria wrapper. <br />In my opinion, if you don&#39;t&nbsp;benefit from dynamic creation of SQL Where clause, don&#39;t use a dictionary, but tailored type.</p>
<p>2) I suppose, you don&#39;t think criteria and DTO are the same. But the both help&nbsp;to overcome the problem not having to many parameters.</p>
<p>3) If you think of a true API or service contract, then all structures (and exceptions) which are referenced by interfaces are also part of the interface. <br />Therefore, DTOs (row data or criteria)&nbsp;belong truely to the interface layer.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Wednesday, November 02, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b> stefan cop<br></b>
<p>In my opinion, if you don&#39;t&nbsp;benefit from dynamic creation of SQL Where clause, don&#39;t use a dictionary, but tailored type.</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>True. I can use criteria or a &quot;tailored&quot; type with dynamic WHERE creation; if a property is NULL, don&#39;t add that property to the WHERE clause :)</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
