<html><header><title>Saving XML Files to Database</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Saving XML Files to Database</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/994.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>eslater posted on Wednesday, August 23, 2006</h2><P>How would I go about saving/retrieving files from a SQL Server database?&nbsp; I have tried using .GetBytes but cant seem to get it working correctly.</P>
<P>Thanks for any help you can provide</P>
<P>Elliot</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael Hildner replied on Wednesday, August 23, 2006</h2><P>What version of Sql Server you using? There's a new xml data type in 2005. I've used that, and also just a varchar column. Either way you can treat it as a string in your BO.</P>
<P>Regards,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>figuerres replied on Wednesday, August 23, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>eslater:</strong></div><div>
<P>How would I go about saving/retrieving files from a SQL Server database?&nbsp; I have tried using .GetBytes but cant seem to get it working correctly.</P>
<P>Thanks for any help you can provide</P>
<P>Elliot</P>
<P></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>here is a fragment of code:</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbCommand.Connection = dbConnection;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbCommand.CommandText = "INSERT INTO OrderLog (EventClass,Data,Link) VALUES(@EventClass,@Data,@Link)";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SqlParameter firstParameter = dbCommand.Parameters.Add(new SqlParameter("@EventClass", System.Data.SqlDbType.NVarChar, 50));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SqlParameter secondParameter = dbCommand.Parameters.Add(new SqlParameter("@Data", System.Data.SqlDbType.Xml));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SqlParameter thirdParameter = dbCommand.Parameters.Add(new SqlParameter("@Link", System.Data.SqlDbType.UniqueIdentifier));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; firstParameter.Value = "Request";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; thirdParameter.Value = Link;<BR></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XmlSerializer s = new XmlSerializer(typeof(OrderLog));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringWriter Output = new StringWriter(new StringBuilder());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s.Serialize(Output, OL);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; secondParameter.Value = new SqlXml(new XmlTextReader(Output.ToString(), XmlNodeType.Document, null));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbCommand.ExecuteNonQuery();</P>
<P>&nbsp;</P>
<P>with 2005 you can query the xml data w/o a need to do the bytes stuff...</P>
<P>hmm I can't find my sample right now but as I recall a normal query gets the data and an x-path thing will pull out a selected bit of it.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
