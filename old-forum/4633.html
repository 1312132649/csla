<html><header><title>Newbie question: ValidationRules.CheckRules();</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Newbie question: ValidationRules.CheckRules();</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4633.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>starchild posted on Tuesday, April 08, 2008</h2><P>This is a very newbie question since I haven't seen others with the same problem and hence I guess this should just work fine if i'd followed the rules...</P>
<P>Anyway, I have a Customer-BO. In my application I have a form users can insert a customer.<BR><BR><FONT size=2><FONT size=3>Her are a couple of snippets from the Customer-BO:</FONT><BR></FONT><FONT size=2><BR><FONT size=2><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> _firstName = </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>.Empty;<BR><BR><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> FirstName<BR>{<BR></FONT><FONT color=#0000ff size=2>get<BR></FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _firstName;<BR>}<BR></FONT><FONT color=#0000ff size=2>set<BR></FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;_firstName = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;<BR></FONT><FONT size=2>}<BR>}</P></FONT></FONT>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> AddBusinessRules()<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>ValidationRules.AddRule(Csla.Validation.</FONT><FONT color=#2b91af size=2>CommonRules</FONT><FONT size=2>.StringRequired, </FONT><FONT color=#a31515 size=2>"FirstName"</FONT><FONT size=2>);<BR></FONT><FONT size=2>}</P></FONT></FONT><FONT size=2><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>RunLocal</FONT><FONT size=2>()]<BR></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Create(</FONT><FONT color=#2b91af size=2>Criteria</FONT><FONT size=2> criteria)<BR>{<BR><FONT size=2>&nbsp;&nbsp;&nbsp;ValidationRules.CheckRules();<BR></FONT></FONT><FONT size=2>}</FONT></P>
<P><FONT size=2><FONT size=3>When clicking Save in the form,&nbsp;following code will run:<BR></FONT><BR><FONT color=#2b91af size=2>Customer</FONT><FONT size=2> customer = </FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2>.NewCustomer();<BR>customer.FirstName = firstName;<BR>customer.Save();<BR></FONT><BR></FONT><FONT size=3>What I want is to make alle the validationchecks on the saving of data. What happens now is problably that the validationchecks run on instantination of the customer-object(<FONT size=2>Customer.NewCustomer())</FONT> and then BEFORE customer.FirstName = firstName - because I get the message FirstName requires.<BR>I've tried to move the&nbsp;<FONT size=2>ValidationRules.CheckRules();</FONT> to the Insert/Update-code, but then the Checks won't run at all no matter if FirstName-string contains a value or not.</FONT></P>
<P><FONT size=3>But if I place the validation on the set-section of FirstName like this <FONT size=2>ValidationRules.CheckRules(<FONT color=#a31515>"FirstName"</FONT>);<BR></FONT>it works exactly how I want it to. But due to performanceissues etc. I want to do alle the validations on one place.<BR><BR>Could anyone give me some hints here?<BR><BR>Thanks in advance!! :-)</FONT><FONT size=2></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, April 08, 2008</h2><P>Your Property Set is not correct.</P>
<P><FONT color=#0000ff size=2>public<FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT color=#000000 size=2> FirstName<BR>{<BR></FONT><FONT color=#0000ff size=2>get<BR></FONT><FONT color=#000000 size=2>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>return</FONT><FONT color=#000000 size=2> _firstName;<BR>}<BR></FONT><FONT color=#0000ff size=2>set<BR></FONT><FONT color=#000000 size=2>{</FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#000000 size=2>
<P><FONT color=#0000ff size=2>&nbsp; If</FONT><FONT size=2> _firstName &lt;&gt; Value </FONT><FONT color=#0000ff size=2>Then<BR>{<BR></FONT>&nbsp; &nbsp;&nbsp;&nbsp;_firstName = </FONT><FONT color=#0000ff size=2>value</FONT><FONT color=#000000 size=2>;<BR>&nbsp; &nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#000000 size=2>PropertyHasChanged(<FONT color=#ff00ff size=2>"FirstName"</FONT><FONT size=2>);<BR></FONT></FONT></FONT><FONT color=#0000ff size=2><FONT color=#000000 size=2><FONT size=2>}</P></FONT>
<P><BR></FONT><FONT color=#000000 size=2>}<BR>}</FONT></P>
<P><FONT color=#000000>By calling PropertyHasChanged, your Validation rules will also run.</FONT></P>
<P><FONT color=#000000>Joe</FONT></P>
<P><FONT color=#000000></FONT>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>starchild replied on Wednesday, April 09, 2008</h2><P>Thanks for your reply. But that actually doesn't solve my problem. I want to validate all rules at the same time(on save) by using ValidationRules.CheckRules();.<BR><BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardb replied on Wednesday, April 09, 2008</h2><P>The propertyhaschanged method tells the the object that something has changed and it's now Dirty.&nbsp; So it's good to do that.</P>
<P>Im pretty sure tThe Save method does check the rules automatically for you.</P>
<P>But you can do this if you want</P>
<P>If customer.IsValid Then<BR>&nbsp;&nbsp; customer.Save<BR>Else........</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>starchild replied on Wednesday, April 09, 2008</h2><P>I will try customer.IsValid. Thank you!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, April 09, 2008</h2>customer.IsValid won't re-run your rules by default.&nbsp;Just identify if any rules are broken (as would be maintained in my prior post from object instantiation to rule checking as things change) </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>starchild replied on Wednesday, April 09, 2008</h2><P>Thank you for clearifying this for me. I will skip the CheckRules() on the Save-section and rather to the ruleschecks on the set-part of each attribute.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, April 09, 2008</h2><P>Validation.CheckRules() when trying to save tends to be an inefficient way to do this to be honest with you.</P>
<P>When an object is new, typically ValidationRules.CheckRules() is run to create broken rules on the object, mainly for things such as "required fields", etc.&nbsp;When an object is fetched, I'd wager most people do not call ValidationRules.CheckRules() (there's a bit of personal preference in this one) -- the thinking is that if you've successfully saved your object, it was valid. So when you retrieve it, it should theoretically still be valid. This could change if the rules change or if something else affects your object externally to it. </P>
<P>As the object changes, you trigger very specific rules to be checked by PropertyHasChanged being run. Which rules run is dependent on your code in AddBusinessRules - you tie rules to properties.&nbsp;It's inefficient to run all the rules every time something changes, so PropertyHasChanged works to identify the rules mainly associated with that property&nbsp;and checks them. </P>
<P>By keeping your object in an accurate state as far as&nbsp;validity and&nbsp;broken rules go, there is very little reason for you to need to call ValidationRules.CheckRules prior to a save. There may be very targeted rules you might want to check prior to saving, but in very few conditions would you ever want to just call ValidationRules.CheckRules() in a parameterless fashion for an object prior to saving. </P>
<P>Perhaps there's something you're omitting, but I suspect you may wish to get a better feel for the best practices of CSLA in terms of rules and object validity. I think what you're wanting to do may be misguided. </P>
<P>JMHO,</P>
<P>Chris Hlusak</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
