<html><header><title>WPF problem: Binding BusinessListBase to ListView - strange delete behavior</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WPF problem: Binding BusinessListBase to ListView - strange delete behavior</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3235.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>wleary posted on Friday, July 20, 2007</h2><P>I have been struggling with something now for quite a few hours. I have a WPF page that is bound to my CSLA object, for editing. I have a ListView that is bound to a property on the object, which is a BusinessListBase. I need to be able to delete items in this list. But, whenever I remove one, I see two items deleted from my ListView. Here are my business objects:</P>
<P>using System;<BR>using System.Collections.Generic;<BR>using System.Text;<BR>using System.Collections.ObjectModel;<BR>using System.Collections.Specialized;<BR>using System.ComponentModel;<BR>using Csla;</P>
<P>namespace ListViewDeleteBug<BR>{<BR>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Roster : BusinessBase&lt;Roster&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Persons _persons;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Persons Persons<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _persons; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Roster()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons = new Persons();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Willa", "Cather"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Isak", "Dinesen"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Victor", "Hugo"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Jules", "Verne"));</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.ListChanged += new System.ComponentModel.ListChangedEventHandler(_persons_ListChanged);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override object GetIdValue()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Guid.NewGuid();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void _persons_ListChanged(object sender, System.ComponentModel.ListChangedEventArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged(null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Persons : BusinessListBase&lt;Persons, Person&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Person : BusinessBase&lt;Person&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string firstName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string lastName;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Person(string first, string last)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkAsChild();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.firstName = first;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.lastName = last;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string FirstName<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return firstName; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { firstName = value; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string LastName<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return lastName; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { lastName = value; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override object GetIdValue()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return firstName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>And here is the XAML and code-behind:</P>
<P>&lt;Window x:Class="ListViewDeleteBug.Window1"<BR>&nbsp;&nbsp;&nbsp; xmlns="<A href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</A>"<BR>&nbsp;&nbsp;&nbsp; xmlns:x="<A href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</A>"<BR>&nbsp;xmlns:l="clr-namespace:ListViewDeleteBug"<BR>&nbsp;&nbsp;&nbsp; Title="ListViewDeleteBug" Height="300" Width="300"<BR>&nbsp;&nbsp;&nbsp; &gt;<BR>&nbsp;&lt;Grid&gt;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&lt;ListView x:Name="myNames" ItemsSource="{Binding Path=Persons,Mode=OneWay}" KeyDown="OnNamesKeyDown" SelectionMode="Single" IsSynchronizedWithCurrentItem="True"&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;ListView.View&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;GridView&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GridViewColumn Header="Name" DisplayMemberBinding="{Binding FirstName}" Width="300"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/GridView&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/ListView.View&gt;<BR>&nbsp;&nbsp;&lt;/ListView&gt;<BR>&nbsp;&lt;/Grid&gt;<BR>&lt;/Window&gt;<BR></P>
<P>using System;<BR>using System.Collections.Generic;<BR>using System.Text;<BR>using System.Windows;<BR>using System.Windows.Controls;<BR>using System.Windows.Data;<BR>using System.Windows.Documents;<BR>using System.Windows.Input;<BR>using System.Windows.Media;<BR>using System.Windows.Media.Imaging;<BR>using System.Windows.Shapes;</P>
<P>namespace ListViewDeleteBug<BR>{<BR>&nbsp;&nbsp;&nbsp; public partial class Window1 : System.Windows.Window<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Roster _roster;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Window1()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster = new Roster();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext = _roster;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnNamesKeyDown(object sender, KeyEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (myNames.SelectedItem != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Person person = myNames.SelectedItem as Person;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster.Persons.Remove(person);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; args.Handled = true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>You'll see when you run this, that if you delete one of the names, two get deleted. I tried the code with an EditableRootList, and that did not exhibit the same behavior. Any help will be greatly appreciated. This has been driving me nuts.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 20, 2007</h2>I don't know why, and I don't have time to keep digging, but OnNamesKeyDown() gets called twice when I hit the Delete key - which explains why 2 items get deleted <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wleary replied on Friday, July 20, 2007</h2><P>Hi Rocky,</P>
<P>I am not seeing that behavior at all. I just&nbsp;tried with delete, and did not hit the event handler twice.&nbsp;I am also able to replicate the behavior simply by programmatically deleting the child. The problem goes away if I change the type of the Persons property to a non-BusinessListBase. Here is my new classes file:</P>
<P>using System;<BR>using System.Collections.Generic;<BR>using System.Text;<BR>using System.Collections.ObjectModel;<BR>using System.Collections.Specialized;<BR>using System.ComponentModel;<BR>using Csla;</P>
<P>namespace ListViewDeleteBug<BR>{</P>
<P>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Roster : BusinessBase&lt;Roster&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Persons _persons;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Persons Persons<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _persons; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Roster()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons = new Persons();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Willa", "Cather"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Isak", "Dinesen"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Victor", "Hugo"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.Add(new Person("Jules", "Verne"));</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // THIS WORKS!!!<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _persons.CollectionChanged += new NotifyCollectionChangedEventHandler(_persons_CollectionChanged);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void _persons_CollectionChanged(object sender, NotifyCollectionChangedEventArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged("Persons");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override object GetIdValue()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Guid.NewGuid();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Persons : List&lt;Person&gt;, INotifyCollectionChanged //BusinessListBase&lt;Persons, Person&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region INotifyCollectionChanged Members</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public event NotifyCollectionChangedEventHandler CollectionChanged;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void removeAtIndex(int index)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Person person = this[index];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveAt(index);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CollectionChanged(this, new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, person));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp;&nbsp; public class Person : BusinessBase&lt;Person&gt;<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string firstName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string lastName;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Person(string first, string last)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkAsChild();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.firstName = first;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.lastName = last;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string FirstName<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return firstName; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { firstName = value; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string LastName<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return lastName; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { lastName = value; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override object GetIdValue()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return firstName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P><BR>}<BR></P>
<P>I updated my XAML also, with more tests. (It also happened with a ListBox, simply by removing the item from the collection, via code in button click...not event handlers. So, I know it's not a ListView-specific thing.)</P>
<P>&lt;Window x:Class="ListViewDeleteBug.Window1"<BR>&nbsp;&nbsp;&nbsp; xmlns="<A href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</A>"<BR>&nbsp;&nbsp;&nbsp; xmlns:x="<A href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</A>"<BR>&nbsp;xmlns:l="clr-namespace:ListViewDeleteBug"<BR>&nbsp;&nbsp;&nbsp; Title="ListViewDeleteBug" MinHeight="300" MinWidth="300"<BR>&nbsp;&nbsp;&nbsp; &gt;<BR>&nbsp;&lt;StackPanel Orientation="Vertical"&gt;<BR>&nbsp;&lt;Grid&gt;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&lt;ListView x:Name="myNames" ItemsSource="{Binding Path=Persons,Mode=OneWay}" KeyDown="OnNamesKeyDown" SelectionMode="Single" IsSynchronizedWithCurrentItem="True"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;<BR>&nbsp;&nbsp;&nbsp;&lt;ListView.View&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;GridView&gt;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GridViewColumn Header="Name" DisplayMemberBinding="{Binding FirstName}" Width="300"/&gt;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/GridView&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/ListView.View&gt;<BR>&nbsp;&nbsp;&lt;/ListView&gt;</P>
<P>&nbsp;&nbsp;<BR>&nbsp;&lt;/Grid&gt;<BR>&nbsp;&nbsp;&lt;!--&lt;ListBox ItemsSource="{Binding Path=Persons,Mode=OneWay}" DisplayMemberPath="FirstName"&gt;&lt;/ListBox&gt;--&gt;<BR>&nbsp;&nbsp;&lt;Button Click="OnResetClick"&gt;Reset&lt;/Button&gt;<BR>&nbsp;&nbsp;&lt;Button Click="OnRemoveFirstClick"&gt;Remove first Name&lt;/Button&gt;<BR>&nbsp;&nbsp;&lt;Button Click="OnRemoveLastClick"&gt;Remove last Name&lt;/Button&gt;<BR>&nbsp;&nbsp;&lt;Button Click="OnRemoveNextToLastClick"&gt;Remove next to lastlast Name&lt;/Button&gt;<BR>&nbsp;&lt;/StackPanel&gt;<BR>&lt;/Window&gt;<BR></P>
<P>using System;<BR>using System.Collections.Generic;<BR>using System.Text;<BR>using System.Windows;<BR>using System.Windows.Controls;<BR>using System.Windows.Data;<BR>using System.Windows.Documents;<BR>using System.Windows.Input;<BR>using System.Windows.Media;<BR>using System.Windows.Media.Imaging;<BR>using System.Windows.Shapes;</P>
<P>namespace ListViewDeleteBug<BR>{<BR>&nbsp;&nbsp;&nbsp; public partial class Window1 : System.Windows.Window<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Roster _roster;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Window1()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster = new Roster();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext = _roster;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnNamesKeyDown(object sender, KeyEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (myNames.SelectedItem != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Person person = myNames.SelectedItem as Person;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster.Persons.Remove(person);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; args.Handled = true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnRemoveFirstClick(object sender, RoutedEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //_roster.Persons.RemoveAt(0);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster.Persons.removeAtIndex(0);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnRemoveLastClick(object sender, RoutedEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //_roster.Persons.RemoveAt(_roster.Persons.Count - 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster.Persons.removeAtIndex(_roster.Persons.Count - 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnRemoveNextToLastClick(object sender, RoutedEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //_roster.Persons.RemoveAt(_roster.Persons.Count - 2);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster.Persons.removeAtIndex(_roster.Persons.Count - 2);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void OnResetClick(object sender, RoutedEventArgs args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roster = new Roster();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataContext = _roster;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 20, 2007</h2><P>OK, shouldn't have been so quick...</P>
<P>It appears to be a problem with BLB. Specifically, BLB implements both IBindingList and INotifyCollectionChanged. Somehow in my testing I missed the fact that this is bad.</P>
<P>If you watch closely, you'll find that the correct number of items (one) are being removed from the list, but the UI is somehow missing one of them. That's because data binding is lazy and infers how to do the display update. When it gets the deleted notification from IBindingList it updates. Then it updates again when notified from INotifyCollectionChanged.</P>
<P>How this got missed I'm not sure, but it is a serious issue <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /></P>
<P>I think 3.0.1 will be coming out sooner than later so I can address this...</P>
<P>In the short term, you can go into BLB and remove all code dealing with INotifyCollectionChanged and the CollectionChanged event, and that appears to solve the issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wleary replied on Friday, July 20, 2007</h2><P>Thank you very much! I commented out the following in BLB, and that seemed to fix it, as you indicated:</P>
<P>protected void OnCollectionChanged(NotifyCollectionChangedEventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if (_nonSerializableCollectionChangedHandlers != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; _nonSerializableCollectionChangedHandlers.Invoke(this, e);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if (_serializableCollectionChangedHandlers != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; _serializableCollectionChangedHandlers.Invoke(this, e);<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>Thanks again. Looking forward to the update.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 23, 2007</h2>I've posted 3.0.1 for download, primarily because it includes the fix for this issue. BLB no longer implements INotifyCollectionChanged, thus avoiding the duplicate eventing issue.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wleary replied on Monday, July 23, 2007</h2>Thanks for the quick responses and the fix Rocky. I have updated our project to use 3.0.1. Thanks!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
