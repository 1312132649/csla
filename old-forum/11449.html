<html><header><title>Business rules for interdependent properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business rules for interdependent properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11449.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kgulden posted on Tuesday, July 03, 2012</h2><p>I am using CSLA 4.3.12.0 and am struggling with understanding how to structure a particular business rule.&nbsp; I am out in the wilderness wandering...&nbsp; I have great hope someone on this forum can help.</p>
<p>I have two PropertyInfo&#39;s A and B in a root object.&nbsp; PropertyInfo-A is a string, PropertyInfo-B is a datetime.&nbsp; The business rule requires both values before it invokes an expensive asynchronous operation ( named ExpensiveRule).&nbsp; Both properties have other rules like min/max values.&nbsp; However, when ExpensiveRule is invoked by the framework, only the primary-property (PropertyInfo-A) associated with ExpensiveRule has had its lower priority&nbsp;rules applied and enforced,&nbsp;the dependency property (PropertyInfo-B) contains raw data without any rules applied.&nbsp; The basic rule syntax is:</p>
<p>... priority=0 rules for PropertyInfo-A and PropertyInfo-B go here...</p>
<p>BusinessRules.AddRule(new ExpensiveRule(PropertyInfo-A, PropertyInfo-B){Priority=1,RunMode=Csla.Rules.RunModes.DenyOnServerSidePortal});</p>
<p>The trouble is, the ExpensiveRule is feed this raw, unvalidated data and must re-apply all the same rules before it can run properly.&nbsp; Is there any way to have a dependency property (PropertyInfo-B) have its rules run and/or enforced beforehand so that ExpensiveRule needs not perform double-duty?</p>
<p>(Thanks ahead of time for anyone how even read this and understood it.)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, July 04, 2012</h2><p>Hi,</p>
<p>The rule engine itself does not provide support for this. </p>
<p>You can achive this by making the ExpensiveRule an object rule (with PrimaryProperty = null) and override the PropertyHasChanged method. </p>
<p>&nbsp;&nbsp;&nbsp; protected override void PropertyHasChanged(IPropertyInfo property)<br />&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var AandB = new List&lt;IPropertyInfo&gt; {AProperty, BProperty};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Run rules for Property and Dependent properties. <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.PropertyHasChanged(property);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // was A or B changed<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (AandB.Contains(property))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // check if there are broken rules on A or B then return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (BrokenRulesCollection.Any(p =&gt; AandB.Any(o =&gt; o.Name == p.Property) &amp;&amp; p.Severity == RuleSeverity.Error))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // call check object rules to start expensive rule. <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.CheckObjectRules();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kgulden replied on Wednesday, July 04, 2012</h2><p>Thanks Jonny.&nbsp; I truly appreciate the quality of your response.&nbsp; I faguely guessed I was &quot;swimming up stream&quot;.&nbsp; I need this functionality, so I will incorporate your prescribed solution.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
