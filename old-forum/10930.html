<html><header><title>Weird validation issue when binding to a Observable collection of type</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Weird validation issue when binding to a Observable collection of type</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10930.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CrikeyMoses posted on Tuesday, November 29, 2011</h2><p>Hi guys,</p>
<p>We are using Silverlight 4, Csla 4.1, MVVM and Bxf.</p>
<p>Background: We have custom validation that checks if the &#39;State&#39; has been selected if someone lives in the USA, something like this:<br /><br />public class ParticipantUSRule : Csla.Rules.BusinessRule<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; protected override void Execute(Csla.Rules.RuleContext context)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var target = (Participant)context.Target;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (target.Country_of_Residence == &quot;United States of America&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (string.IsNullOrEmpty(target.State))<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context.AddErrorResult(&quot;State required for US country&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.Execute(context);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />}</p>
<p>That all works fine...</p>
<p>The issue we are getting is validation doesn&#39;t fire when we bind a combo box to an observable collection of a type BO (StateList, in my case), it does how ever work when we bind to an observable collection of type string, i&#39;ll post the two&nbsp;scenarios&nbsp;below to&nbsp;demonstrate:&nbsp;</p>
<p>Firstly the working version:<br />In my ViewModel i have a Observable collection of type string which i bind to the itemsource property of a combo box.&nbsp;<br />&nbsp;public ObservableCollection&lt;string&gt; StatesList</p>
<p>&nbsp;</p>
<p>&nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var result = new ObservableCollection&lt;string&gt;();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result.Add(&quot;Alabama&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result.Add(&quot;Arizona&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result.Add(&quot;Calafornia&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return result;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp;}</p>
<p>For this my xaml binding would look like:<br /><br />&nbsp;&lt;ComboBox Grid.Column=&quot;1&quot; Grid.Row=&quot;11&quot; &nbsp;Name=&quot;cboState&quot; Margin=&quot;5&quot; SelectedItem=&quot;{Binding Path=Model.State, Mode=TwoWay,ValidatesOnExceptions=True, &nbsp;NotifyOnValidationError=True}&quot; ItemsSource=&quot;{Binding Path=StatesList}&quot; /&gt;</p>
<p>&nbsp;</p>
<p>Now that all works fine until we populate the StateList with values from the DB as follows:</p>
<p>public ObservableCollection&lt;StateListVM&gt; StatesList<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var result = new ObservableCollection&lt;StateListVM&gt;();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result.Add(new StateListVM());<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return result;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />}<br /><br />And for this my binding would change slightly to:<br />&lt;ComboBox Grid.Column=&quot;1&quot; Grid.Row=&quot;11&quot; &nbsp;Name=&quot;cboState&quot; Margin=&quot;5&quot; SelectedValue=&quot;{Binding Path=Model.State, Mode=TwoWay,ValidatesOnExceptions=True, &nbsp;NotifyOnValidationError=True}&quot; ItemsSource=&quot;{Binding Source={StaticResource participantVMStatesListModelViewSource}}&quot; SelectedValuePath=&quot;State_Name&quot; DisplayMemberPath=&quot;State_Name&quot;/&gt;</p>
<p>The binding seems to work fine as it is saving the data to the DB, just the validation we are&nbsp;struggling&nbsp;with.</p>
<p>Please help</p>
<p><b>UPDATE: The States loads and the CustomRule does fire, just no red border and ErrorInfo on the Combo Box control... Please help</b></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, November 29, 2011</h2><p>There is several bugfixes in PropertyStatus in Csla 4.2 so try and update this component first.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CrikeyMoses replied on Thursday, December 01, 2011</h2><p>No luck there Jonny. I still have the same issue after upgrading. Any other&nbsp;suggestions?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, December 05, 2011</h2><p>Do you use the PropertyStatus control to show error messages? </p>
<p>It doesn&#39;t show in the code in your post. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CrikeyMoses replied on Friday, December 09, 2011</h2><p>
<div>
<p>No I&#39;m not using PropertyStatus, we are using the standard error message (with red border) from the ComboBox. I wouldn&#39;t think this makes a difference. Also when i did use the PropertyStatus control this didn&#39;t change anything.<br /><br />Like i said the issue is when we are binding a Observable collection of type string (to the ComboBox), everything works fine and when we change the Observable collection to fetch from the DB it doesn&#39;t work, I think it has to do with the fact that the ViewModel (Participant) gets fetched BEFORE the fetch of the observable collection (StateList) has completed. Then the binding messes something up... (Because its trying to bind the Itemsource of the combobox after the SelectedValue has been set)</p>
</div>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>Have you considered to use a&nbsp;UOW - approach. </p>
<p>Look at this post: <a href="http://forums.lhotka.net/forums/p/10968/51038.aspx#51038">http://forums.lhotka.net/forums/p/10968/51038.aspx#51038</a>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
