<html><header><title>MVVM, PropertyStatus, and CSLA 4 beta 3</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>MVVM, PropertyStatus, and CSLA 4 beta 3</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9144.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom posted on Tuesday, June 29, 2010</h2><p>I&#39;m delving into MVVM for the first time and I&#39;m still shakey on a lot of the concepts.&nbsp; My particular problem right now is that I can&#39;t get the PropertyStatus to work.</p>
<p>In my resources I have the following</p>
<pre style="font-family:consolas;"><span style="color:#a31515;">&nbsp;       </span><span style="color:blue;">&lt;</span><span style="color:#a31515;">this</span><span style="color:blue;">:</span><span style="color:#a31515;">SoxControlListViewModel</span><span style="color:red;">&nbsp;x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SoxControlListModel&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br /> <br /><span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;">&lt;</span><span style="color:#a31515;">DataTemplate</span><span style="color:red;">&nbsp;x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">=</span><span style="color:blue;">&quot;DataList&quot;</span><span style="color:blue;">&gt;</span><br /><span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#a31515;">&nbsp;           ...</span><br /><br /><span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;">&lt;</span><span style="color:#a31515;">Label</span><span style="color:red;">&nbsp;Content</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Control&nbsp;Activity&nbsp;Description:&quot;</span><span style="color:red;">&nbsp;Grid.Column</span><span style="color:blue;">=</span><span style="color:blue;">&quot;1&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">          HorizontalAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Left&quot;</span><span style="color:red;">&nbsp;Margin</span><span style="color:blue;">=</span><span style="color:blue;">&quot;0&quot;</span><span style="color:red;">&nbsp;VerticalAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Center&quot;</span><span style="color:red;">&nbsp;Grid.ColumnSpan</span><span style="color:blue;">=</span><span style="color:blue;">&quot;2&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;">&lt;</span><span style="color:#a31515;">TextBox</span><span style="color:red;">&nbsp;Grid.Column</span><span style="color:blue;">=</span><span style="color:blue;">&quot;1&quot;</span><span style="color:red;">&nbsp;Grid.Row</span><span style="color:blue;">=</span><span style="color:blue;">&quot;1&quot;</span><span style="color:red;">&nbsp;HorizontalAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Stretch&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">          IsReadOnly</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;ElementName</span><span style="color:blue;">=</span><span style="color:blue;">ControlActivityDescriptionPS</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;Path</span><span style="color:blue;">=</span><span style="color:blue;">CanWrite</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                       Converter</span><span style="color:blue;">={</span><span style="color:#a31515;">converters</span><span style="color:blue;">:</span><span style="color:#a31515;">NotConverter</span><span style="color:blue;">}}</span><span style="color:blue;">&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                       Name</span><span style="color:blue;">=</span><span style="color:blue;">&quot;ControlActivityDescriptionTextBox&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                       Text</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Path</span><span style="color:blue;">=</span><span style="color:blue;">ControlActivityDescription</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                              Mode</span><span style="color:blue;">=</span><span style="color:blue;">TwoWay</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;ValidatesOnExceptions</span><span style="color:blue;">=</span><span style="color:blue;">true</span><span style="color:blue;">,</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                              NotifyOnValidationError</span><span style="color:blue;">=</span><span style="color:blue;">true</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                       VerticalAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Stretch&quot;</span><span style="color:red;">&nbsp;TextWrapping</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Wrap&quot;</span><span style="color:red;">&nbsp;</span><span style="color:red;"> IsReadOnlyCaretVisible</span><span style="color:blue;">=</span><span style="color:blue;">&quot;True&quot;</span><span style="color:red;">&nbsp;Margin</span><span style="color:blue;">=</span><span style="color:blue;">&quot;0&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                       Grid.ColumnSpan</span><span style="color:blue;">=</span><span style="color:blue;">&quot;3&quot;</span><span style="color:red;">&nbsp;VerticalContentAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Stretch&quot;</span><span style="color:red;">&nbsp;HorizontalContentAlignment</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Stretch&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br /><br /><span style="color:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;">&lt;</span><span style="color:#a31515;">csla</span><span style="color:blue;">:</span><span style="color:#a31515;">PropertyStatus</span><span style="color:red;">&nbsp;Grid.Row</span><span style="color:blue;">=</span><span style="color:blue;">&quot;0&quot;</span><span style="color:red;">&nbsp;Grid.Column</span><span style="color:blue;">=</span><span style="color:blue;">&quot;1&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                   Name</span><span style="color:blue;">=</span><span style="color:blue;">&quot;ControlActivityDescriptionPS&quot;</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">                   Property</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Path</span><span style="color:blue;">=</span><span style="color:blue;">ControlActivityDescription</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><span style="color:red;">&nbsp;Margin</span><span style="color:blue;">=</span><span style="color:blue;">&quot;175,0,0,0&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br />                        ...</pre>
<pre style="font-family:consolas;"></pre>
<pre style="font-family:consolas;">I&#39;ve set my main DockPanel as bound to the model containing a buisness list object to a listbox</pre>
<pre style="font-family:consolas;"><pre style="font-family:consolas;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">DockPanel</span><span style="color:red;">&nbsp;DataContext</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Source</span><span style="color:blue;">={</span><span style="color:#a31515;">StaticResource</span><span style="color:red;">&nbsp;SoxControlListModel</span><span style="color:blue;">}}</span><span style="color:blue;">&quot;</span><span style="color:blue;">&gt;</span><br />...</pre>
<pre style="font-family:consolas;"><pre style="font-family:consolas;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">ListBox</span><span style="color:red;">&nbsp;ItemsSource</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Path</span><span style="color:blue;">=</span><span style="color:blue;">Model</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;ItemTemplate</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">StaticResource</span><span style="color:red;">&nbsp;DataList</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;Name</span><span style="color:blue;">=</span><span style="color:blue;">&quot;DataListBox&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;csla</span><span style="color:blue;">:</span><span style="color:red;">InvokeMethod.Target</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Source</span><span style="color:blue;">={</span><span style="color:#a31515;">StaticResource</span><span style="color:red;">&nbsp;SoxControlListModel</span><span style="color:blue;">}}</span><span style="color:blue;">&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;csla</span><span style="color:blue;">:</span><span style="color:red;">InvokeMethod.TriggerEvent</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SelectionChanged&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;csla</span><span style="color:blue;">:</span><span style="color:red;">InvokeMethod.MethodName</span><span style="color:blue;">=</span><span style="color:blue;">&quot;ShowItem&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&nbsp;csla</span><span style="color:blue;">:</span><span style="color:red;">InvokeMethod.MethodParameter</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;RelativeSource</span><span style="color:blue;">={</span><span style="color:#a31515;">RelativeSource</span><span style="color:red;">&nbsp;Self</span><span style="color:blue;">},</span><span style="color:red;">&nbsp;</span></pre>
<pre style="font-family:consolas;"><span style="color:red;">      Path</span><span style="color:blue;">=</span><span style="color:blue;">SelectedItem</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><span style="color:blue;">/&gt;</span></pre>
<pre style="font-family:consolas;"><span style="color:blue;">...</span></pre>
</pre>
</pre>
<pre style="font-family:consolas;"></pre>
<pre style="font-family:consolas;">When I run the window, it displays perfectly, however the propertystatus does not work.  I am able to break rules</pre>
<pre style="font-family:consolas;">without any error symbols and I&#39;m able to edit the textbox when I shouldn&#39;t be able to.  Any pointers to get me headed in the right direction?</pre></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, June 29, 2010</h2><p>There appears to be some bug (that I&#39;m having a hard time finding - working on this today actually) with PropertyStatus in CSLA 4 beta 2 and beta 3. I&#39;m seeing the same sort of issue you are encountering...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Tuesday, June 29, 2010</h2><p>I&#39;m glad I&#39;m not going crazy.&nbsp; Good luck finding the bug.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, June 29, 2010</h2><p>This was harder than I could have imagined, but the problem is solved.</p>
<p>There were two problems actually - the CanRead/CanWrite problem was trivial. The &quot;disappearing control&quot; problem was <a href="http://www.lhotka.net/weblog/Silverlight4VisualStateManagerValidIssue.aspx">pretty crazy</a>.</p>
<p>If you grab the latest code (PropertyStatus and Themes\Generic.xaml) from svn it should work - and of course the fix will be in the upcoming RC release.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Tuesday, June 29, 2010</h2><p>Will Do.</p>
<p>Thanks for the fix.&nbsp; That was quite the bug.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, June 29, 2010</h2><p>Any chance of this fix making its way into 3.8.4&nbsp;Beta before it releases? (Pretty please)<br /><br />I&#39;m using 3.8.x in Silverlight 4 quite extensively.</p>
<p>Thanks<br />Jaans</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 29, 2010</h2><p>As I mentioned in the other thread - I <i>might </i>create a 3.9 that is 3.8.4 compiled for .NET 3.5 SP1 and SL4 in VS10. In that case I would fix this in that code.</p>
<p>But you can fix it yourself - now that we know the problem it is really trivial. Just do this:</p>
<ol>
<li>open themes\generic.xaml and change the visual state named &quot;Valid&quot; to &quot;PropertyValid&quot;.</li>
<li>open PropertyStatus.cs and replace all &quot;Valid&quot; state names with &quot;PropertyValid&quot; - there are 2-4 of them in the code</li>
</ol>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
