<html><header><title>Best way to handle &quot;session&quot; specific user data in a CSLA MVC app?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best way to handle &quot;session&quot; specific user data in a CSLA MVC app?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11923.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dane posted on Friday, April 05, 2013</h2><p>I make fairly heavy use of the user&#39;s Id value in my application. In the Silverlight and Windows UI Csla.ApplicationContext.User.Identity is of my custom identity type after authentication but, of course, in MVC it resolves simply to an IIdentity object. Is the best approach to persisting something like a user Id to utilize a Session or is there some better approach that CSLA itself helps with?</p>
<p>Thanks</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>I discuss various alternatives in the &#39;Expert 2008 Business Objects&#39; book and in the &#39;Using CSLA 4&#39; ebook series.</p>
<p>Because the web server doesn&#39;t remember anything between requests, you have to recreate or re-obtain the principal/identity at the start of each page request.</p>
<p>In and of itself that&#39;s not terribly hard - there&#39;s an event in global.asax for this purpose.</p>
<p>The trick is figuring out the optimal way to recreate or re-obtain the identity data. Common options include:</p>
<ul>
<li>Reload from the database</li>
<li>Stash in Session</li>
<li>Store in a cookie (if small enough - but usually this isn&#39;t workable)</li>
<li>Store in a distributed in-memory cache (Velocity, memcached, etc.)</li>
</ul>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dane replied on Monday, April 08, 2013</h2><p>I ended up going with the cookie. I really just needed the UserId to persist and that&#39;s plenty small enough.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, April 08, 2013</h2><p>Ahh, if _all_ you need is the user id (user name) then you don&#39;t need to do any work yourself, because Forms Authentication will do it for you. ASP.NET forms authn _already_ creates an encrypted cookie with the username.</p>
<p>That cookie is used to automatically create a very basic principal/identity on each postback - so you have easy access to the username.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, April 08, 2013</h2><p>Not just that, but the forms auth ticket gets encrypted in the forms auth cookie; if you&#39;re just storing a user name in a cookie in plain text that seems like a problem if you&#39;re using it to pass as authentication.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dane replied on Monday, April 08, 2013</h2><p>No, user name is being stored in the ticket which is being encrypted and then stored in a cookie. I just needed both the user name and the user Id values which was easily accomplished with the UserData field on the ticket.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
