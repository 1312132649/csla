<html><header><title>Business logic question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business logic question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/833.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, August 07, 2006</h2>Hi,<br><br>I need some advice, as I don't know the best way to proceed.&nbsp; <br><br>I have a quote object, which is what you'd expect.&nbsp; The user may modify the quote as much as they want.&nbsp; At some point, they send the quote to the customer.&nbsp; At this point, the quote becomes readonly.&nbsp; The only way to change it is to make a revision, which basically is a completely new document which is pre-populated will all the data from the old document (and the revision is tied to the original, to track history).&nbsp; Also, it shouldn't be possible to send to the customer if the quote has a revision which supersides the previous version.<br><br>Basically the requirement is this; the user needs to specify they are sending the quote to the customer.&nbsp; The user will be able to fax the document or send it via email.&nbsp; Either way, a Pdf will be created first, and then printed or attached to a new email.&nbsp; <br><br>Obviously I need a method which is similar to save, but also sets a flag to mark the quote readonly.&nbsp; But is it the BO's responsibilty to create the Pdf?&nbsp; The UIs responsiblity?&nbsp; I'm leaning toward the latter, as its a presentation thing, but I just want to be sure.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 07, 2006</h2>I agree that you either need a method that sets the flag and calls Save() to "close" the quote.<br><br>I would think that the PDF creation is very much a reporting operation. If you read my 1.0 book, I had a bit of discussion where I split the concept of reporting into "report" and "list", where a "list" is something you create against easy-to-get data. Lists can be generated using client-side report generation tools, and that seems to be the case here.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 07, 2006</h2>That's what I though; the thing that throws me sometimes is that the pdf generation is a requirement at the time the quote is created.. then I start wondering.. kind of like if some business operation fails, and email needs to be sent. <br><br>Thanks for the feedback; kinda out of it today.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 07, 2006</h2>There's only one piece about this that I'm missing; whats to stop the UI layer from generating the Pdf or exporting the data some how before locking it to prevent any changes?<br><br>Thats why I get stuck sometimes... it seems like the answer is nothing... yet it is a business rule that the order cannot be sent to a customer before its locked.&nbsp; <br><br>Am I worrying about nothing here?<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, August 07, 2006</h2><P>In keeping with a behavior-based design, it would make sense if you have an object whose responsibility it is to generate the PDF file, e.g. QuotePdfGenerator.</P>
<P>In dealing with this VERY frequent topic, we usually look at it this way: The PDF file itself is a presentation component, but the source of the PDF is a business object.&nbsp; <BR></P>
<P>So, this would allow you to implement the process in one of two ways:</P>
<OL>
<LI>Have a GeneratePDF or ToPDF (or whatever) method on your Quote object.&nbsp; Your UI code calls this method.&nbsp; Inside the method, the Quote object delegates to your helper class for the work. 
<LI>Have a static Generate method on the helper class that accepts a Quote object as an argument.&nbsp; The UI code calls this method passing in the Quote object.</LI></OL>
<P>or, better yet, do both!&nbsp; Then you have the option at any time.</P>
<P>But, that doesn't really answer your questions about which way to deal with it.&nbsp; Truth be told, this is just semantics as odds are the GeneratePDF (or whatever) method on your Quote object is just going to call QuotePdfGenerator.Generate(this), so it is actually just another way of doing the exact smae thing.</P>
<P>The rule of thumb I usually use when trying to determine which way to go is to decide if you have or need to have an instance of the object you are working with.&nbsp; If this is the only thing you are doing with the object, than using the static method on the helper class is the perferred approach.&nbsp; If you have the object in memory already, use the object's method to initiate the operation.</P>
<P>For example, if you have the following code:</P>
<P><CODE>Quote q = Quotes[QuoteIdDropDownList.SelectedValue];<BR>q.GeneratePdf(); </CODE></P>
<P>I'd rather use this approach:</P>
<P><CODE>QuotePdfGenerator.Generate(Quote[QuoteIdDropDownList.SelectedValue]);</CODE></P>
<P>because you aren't using the instance for anything other than this function.</P>
<P>On the other hand, as an example, if you are using a form that has the Quote stored in a private variable and multiple operations are performed on that object, I would do the following:</P>
<P><CODE>dataSource.GeneratePdf();</CODE></P>
<P>Ultimately, by having methods in both places, how you use them is really up to you and preferences.&nbsp; Everyone develops their own preferences and logic based on their own experiences, so it is highly subjective.&nbsp; This is just the informal rule-of-thumb we try to apply to this situation to make the same decision.</P>
<P>Of course, you raise a valid point in regards to enforcing business rules that govern who and when the method may be used.&nbsp; Based on this, I would say that calling the method on the object is the better path.&nbsp; Inside this method, which ultimately delegates to the helper class, you can implement your validation rules to control access to the method.</P>
<P>Hope this helps.&nbsp; Good luck.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 08, 2006</h2>I think this is the route I will go; it doesn't eliminate the problem (the UI developer can build their own report, etc etc.) but perhaps by providing a method here I can exploit the 'laziness' factor that I will always use the method here to generate the quote (or order, or invoice).<br><br>It won't be a pdf, it will be a ReportingSerivces LocalReport.. which can be exported to pdf.<br><br>Thanks<br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
