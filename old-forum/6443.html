<html><header><title>BusinessBase derived class loses IsDirty and Save capability when exported from class library</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessBase derived class loses IsDirty and Save capability when exported from class library</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6443.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Neo posted on Tuesday, February 17, 2009</h2><P>Hello, I am using CodeSmith to generate a class that derives from the CSLA BusinessBase type to read and write to an SQL database.&nbsp; The derived class overrides Save() and calls base.Save().&nbsp; When called after data has been changed, this normally results in DataPortal_Update() being called which, again, is overridden in the derived class.</P>
<P>However, I have created a class library that exposes itself as a Windows Service.&nbsp; I have a client GUI (an XBAP) that has a Web Reference to this class library.&nbsp; One of the methods on my class library returns the type that is derived from BusinessBase.&nbsp; This is automatically exported to the client application as a type with exactly the same name but is actually a wrapper of the original type.&nbsp; This isn't apparent until I see that all the properties have been prefixed with an underscore.</P>
<P>However, when I make changes to this wrapper object in the client application and pass it back to the class library via a parameter to a public method (whether by reference or by value), it seems that the data is copied over, but the IsDirty flag is set to 'false'.&nbsp; In fact, the wrapper class doesn't set its own IsDirty flag to 'true' in the client application when any of the properties change, it's like the IsDirty flag is completely redundant in the exported wrapper class.</P>
<P>This presents a problem because I am unable to use the exported objects to change data and save it.&nbsp; The only way round this is to instantiate another object of the original type inside the class library method (which means getting the record from the database again) and copy the data from the passed object into it manually.&nbsp; Or, reference the CSLA libraries in my client application and remove the need for exporting the generated classes from a Windows Service class library.&nbsp; But this means I'll no longer have a service runnable on a server that can be reused by other client applications.</P>
<P>It seems to me that the IsDirty flag should be updated in the wrapper class just as it is in the original class that derives from BusinessBase.&nbsp; Is a fix planned for this, or am I missing something, or is there another suitable method for achieving my aim or working around this particular problem?</P>
<P>Many thanks,</P>
<P>Jason</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 17, 2009</h2>It sounds like you're directly exposing your BOs in the web service.&nbsp; This isn't supported.&nbsp; If that is what you're doing, you'll have to consider writing DTOs which are exposed by the web service.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, February 17, 2009</h2><P><FONT face=Tahoma size=2>What you're seeing is a by-product of the service.&nbsp; The object that is returned to you via your Windows service is not the same as what's in your actual class library.&nbsp; It is the serializable form of your object.&nbsp; The thing about serialization is that the code in your class (or the CSLA base classes)&nbsp;doesn't come along for the ride - only the data.&nbsp; All the BO properties (like IsDirty) that the CSLA class manages for you are handled via the CSLA code.&nbsp; So you aren't getting the behavior you want.</FONT></P>
<P><FONT face=Tahoma size=2>What you should do is read the chapters in Rocky's book surrounding web and WCF services.&nbsp; The fact that you've chosen to expose your objects via a Windows service doesn't solve the "service boundary" issues inherent in web and WCF services.&nbsp; It just changes how you access the service.</FONT></P>
<P><FONT face=Tahoma size=2>Ultimately, if you're using the Windows service as a kind of middle tier, then the only way to get what you want is to have a copy of your BO class library present on the client.&nbsp; If you intend to simply expose your BO's&nbsp;as a service for your XBAP application to consume, then you have to follow the service rules outlined in the service chapters in Rocky's book that I mentioned above - and live with the consequences of that approach.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Neo replied on Thursday, February 19, 2009</h2><P>Thanks for your replies.&nbsp; I assume a DTO is essentially a wrapper class for the CSLA class.&nbsp; In which case, our SOAP-compatible class that derives from BusinessBase could be the "DTO", yes?</P>
<P>Anyway, I have managed to resolve the issue in a very simple way while retaining the Windows Service as a middle tier.&nbsp; I've added the following function to the derived class, and the exposed function on the class library simply calls this function on the object passed into it:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>public</FONT>&nbsp;<FONT color=#008080>MyDerivedBusinessClass</FONT> ForceSave()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkDirty();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>return</FONT> Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, February 19, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Neo:</strong></div><div>
<P>I assume a DTO is essentially a wrapper class for the CSLA class.&nbsp;</P>
<P></div></BLOCKQUOTE></P>
<P>Bad assumption.</P>
<P>CSLA BO's are not designed to be service objects. You really need to read the book which has a whole chapter on this topic.</P>
<P>Bottom line -&nbsp;a DTO is a simple class that only contains the raw data, some Public Properties&nbsp;and no methods.</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
