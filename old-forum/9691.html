<html><header><title>Problem with BusinessRules which affect two Properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with BusinessRules which affect two Properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9691.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>t.kehl posted on Saturday, October 30, 2010</h2><p>Hi.</p>
<p>I have the fallowing problem:<br />My BusinessObject has two Properties, which should be checked by a businessRule:</p>
<p>DefaultInchargeModeProperty - this is of type byte and has 0, 1 or 2 as value.<br />DefaultInchargeUserProperty - this is a ReadOnlyObject.</p>
<p>Now, when DefaultInchargeMode has the value 2, DefaultInchargeUserProperty must has a not null value.</p>
<p>I have now created the fallowing businessrule:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class CheckDefaultInchargeRule : BusinessRule {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CheckDefaultInchargeRule(IPropertyInfo primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(primaryProperty) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;IPropertyInfo&gt; { primaryProperty, DefaultInchargeUserProperty };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AffectedProperties.Add(DefaultInchargeUserProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute(RuleContext context) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((byte)context.InputPropertyValues[PrimaryProperty] == (byte)DefaultInchargeModes.GivenUser) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(context.InputPropertyValues[DefaultInchargeUserProperty] == null) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(DefaultInchargeUserProperty, string.Format(Properties.Resources.RequiredRule, DefaultInchargeUserProperty.FriendlyName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>I create the rule like this:</p>
<p>this.BusinessRules.AddRule(new CheckDefaultInchargeRule(DefaultInchargeModeProperty));</p>
<p>&nbsp;</p>
<p>The Rule does not working.</p>
<p>but when I change</p>
<p>context.AddErrorResult(DefaultInchargeUserProperty, 
string.Format(Properties.Resources.RequiredRule, 
DefaultInchargeUserProperty.FriendlyName));</p>
<p>to</p>
<p>context.AddErrorResult(string.Format(Properties.Resources.RequiredRule, 
DefaultInchargeUserProperty.FriendlyName));</p>
<p>It works. why this? - I need in the Result the DefaultInchargeUserProperty for coloring the UI. I check, if there is a Binding from the view to the Property in the ErrorResult.</p>
<p>I hope someone can help me.</p>
<p>Thanks.</p>
<p>Thomas</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, November 01, 2010</h2><p>Hi Thomas, </p>
<p>I&#39;ll try to give me views to your rule here: </p>
<p>1. You need a business rule to check the property 
DefaultInchargeUserProperty</p>
<p>when DefaultInchargeMode has the value 2, DefaultInchargeUserProperty is required.</p>
<p>2. You have a dependency on the value of another property DefaultInchargeModeProperty </p>
<p>To solve this I would create the following rule for validatin DefaultInchargeUserProperty: </p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">public</span>&nbsp;<span style="color:#cc7832;">class</span>&nbsp;<span style="color:#ffc66d;">CheckInCharge</span>&nbsp;:&nbsp;Csla<span style="font-weight:400;">.</span>Rules<span style="font-weight:400;">.</span>CommonRules<span style="font-weight:400;">.</span><span style="color:#ffc66d;">Required</span><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">private</span>&nbsp;IPropertyInfo&nbsp;_chargeModeProperty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">public</span>&nbsp;CheckInCharge(IPropertyInfo&nbsp;primaryProperty,&nbsp;IPropertyInfo&nbsp;chargeModeProperty)&nbsp;:&nbsp;<span style="color:#cc7832;">base</span>&nbsp;(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_chargeModeProperty&nbsp;<span style="font-weight:400;">=</span>&nbsp;chargeModeProperty;<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">if</span>&nbsp;(InputProperties&nbsp;<span style="font-weight:400;">==</span>&nbsp;<span style="color:#cc7832;">null</span>)&nbsp;InputProperties&nbsp;<span style="font-weight:400;">=</span>&nbsp;<span style="color:#cc7832;">new</span>&nbsp;<span style="color:#ffc66d;">List</span><span style="font-weight:400;">&lt;</span>IPropertyInfo<span style="font-weight:400;">&gt;</span>();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties<span style="font-weight:400;">.</span>Add(chargeModeProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">public</span>&nbsp;<span style="color:#cc7832;">void</span>&nbsp;Execute(<span style="color:#ffc66d;">RuleContext</span>&nbsp;context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">if</span>&nbsp;((<span style="color:#cc7832;">byte</span>)context<span style="font-weight:400;">.</span>InputPropertyValues[_chargeModeProperty]&nbsp;<span style="font-weight:400;">==</span>&nbsp;(<span style="color:#cc7832;">byte</span>)DefaultInchargeModes<span style="font-weight:400;">.</span>GivenUser)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">base</span><span style="font-weight:400;">.</span>Execute(context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>And in AddBusinessRules: </p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">this</span><span style="font-weight:400;">.</span>BusinessRules<span style="font-weight:400;">.</span>AddRule(<span style="color:#cc7832;">new</span>&nbsp;<span style="color:#ffc66d;">CheckInCharge</span>(DefaultInchargeUserProperty));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">this</span><span style="font-weight:400;">.</span>BusinessRules<span style="font-weight:400;">.</span>AddRule(<span style="color:#cc7832;">new</span>&nbsp;<span style="color:#ffc66d;">Dependency</span>(DefaultInchargeModeProperty,&nbsp;DefaultInchargeUserProperty));</pre>
<p>&nbsp;to make sure that if DeaultInchargeMode is changed then rules for DefaultInchargeUser field is rerun.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>t.kehl replied on Monday, November 01, 2010</h2><p>Hi JonnyBee</p>
<p>Thank you. This is now working fine.</p>
<p>Best Regards, Thomas</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Tuesday, November 02, 2010</h2><p>This would perhaps work with my ConditionProperty</p>
<p><a href="http://forums.lhotka.net/forums/t/9699.aspx">http://forums.lhotka.net/forums/t/9699.aspx</a><br /><br /><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;">// When InChargeMode = GivenUser then DefaultInchargeUserProperty is required<br /></span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">BusinessRules.AddRule(</span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ConditionRule</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Required</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">, </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DefaultInchargeModes</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt;(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DefaultInchargeModeProperty, (p) =&gt; p == </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DefaultInchargeModes</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.GivenUser,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Required</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(DefaultInchargeUserProperty)));</span></span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
