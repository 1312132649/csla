<html><header><title>Design advice</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design advice</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4148.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JimBalo posted on Thursday, January 10, 2008</h2><P>Hi,</P>
<P>I am working on a fairly simple app (CSLA) dealing with payment scheduling of invoices, but I cannot seem to come up with a smooth design for this.&nbsp; I am hoping one of you fellows would be able to give me some advice. </P>
<P>It is a WinForm app with a monthly calendar that shows an overview of invoice totals, etc. by day.&nbsp; When a day is clicked, you get a detail screen for that day.&nbsp; The detail screen contains:<BR>A Vendor grid showing each vendor with amount due, payment total, etc. <BR>An Invoice grid showing all invoices for the selected vendor<BR>A Payment grid, showing all scheduled payments for the selected invoice.</P>
<P>I have attached a diagram of the main business objects (VendorCollection-&gt;Vendors-&gt;InvoiceCollection-&gt;Invoices-&gt;PaymentCollection-&gt;Payments).</P>
<P>I have about 4,000 open invoices which I first load into a InvoiceCollection, then I pass that InvoiceCollection to VendorCollection.Create(InvoiceCollection), which creates the hierarchy you can see in the attached diagram.&nbsp; The Calendar is then populated from the VendorCollection.&nbsp; </P>
<P>In the detail screen, the Vendor grid binds to the VendorCollection, the Invoice grid binds to the InvoiceCollection [_vendorCollection.GetVendor(CurrentVendorNo).InvoiceCollection] and the Payment grid binds to the Payment Collection (CurrentInvoice.PaymentCollection).&nbsp; </P>
<P>What makes it complicated is that the user needs to be able to view and work with a variety of subsets of the vendors / invoices:<BR>1) The Calendar on the main screen shows dayily totals (all vendors combined), but highlight the day box if any one vendor has a daily total exceeding a certain amount.<BR>2) In the detail screen, the Vendor grid shows daily totals, monthly totals and grand totals for each vendor.<BR>3) The user can select one or more vendors in the vendor grid and perform operations on all payments assigned to the invoices for those vendors for the day (for example: remove payments, change payment date, add payments). <BR>4) The user can select one or more vendors in the vendor grid and perform operations on all payments assigned to the invoices for those vendors for the month.<BR>5) The user can select one or more vendors in the vendor grid and perform operations on all payments assigned to the invoices for those vendors (no time-limiter)<BR>6) The user can select one or more invoices in the invoice grid and perform operations on all payments assigned to those invoices.</P>
<P>I have tried two different approaches to handle this:<BR>1) Have the collection objects return subsets of vendors / invoices, etc. and bind these sub-collections to the grids, etc.<BR>2) Operate on the same all-inclusive VendorCollection (containing all vendors, invoices and payments for all days) and use a SetDateFilter method together with methods like RemovePaymentsForDay, etc. </P>
<P>The problem with 1) is that the DataBinding events fire in the subcollection, so other grids, etc. do not get updated.&nbsp; Also, if you remove items from a subcollection, you have to setup a mechanism to also remove them from any other collections.&nbsp; It becomes very messy trying to keep the collections synchronized.</P>
<P>The problem with 2) is that the collection objects get cluttered with a lot of methods / properties like AmountDue, AmountDueForMonth, PaymentTotalForDay, etc.</P>
<P>I am looking for a cleaner, smoother design for handling this.&nbsp; </P>
<P>Any advice would be greatly appreciated.&nbsp; </P>
<P>Thanks,<BR>Jim</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JimBalo replied on Friday, January 11, 2008</h2><P>Anyone??</P>
<P>I realize that it is a lengthy post, but maybe someone can shed some light on how to address the overall&nbsp;issue of having a user work with subsets of collections of business objects&nbsp;via databinding?&nbsp; </P>
<P>Thanks,</P>
<P>Jim</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lars replied on Friday, January 11, 2008</h2><P>Jim,</P>
<P>I am having a very similar scenario, so I am also interested in a solution to this.&nbsp; It has to be a fairly common scenario to work with "filtered" business object collections, but it turns out to be quite a challenge.&nbsp; But I am new to CSLA&nbsp;and not an expert on OOD.</P>
<P>Maybe&nbsp;one of the csla / OOD gurus in the forum will be able to help...</P>
<P>Lars</P>
<P>Ps. One option would be to use a DataSet with DataViews filtering, but then you would of course lose all the benefits of having business logic encapsulated a' la Rocky.&nbsp; </P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, January 12, 2008</h2><P>In my Web app, if I have two grids and I want to display the data in the 2nd grid based on the slected row of the first grid, then I fetch 2 collections and set the data source of the 2nd grid to a FilteredBindingList which uses the 2nd collection as a source and the first collection selected row PK as the filter.</P>
<P>The FilteredBindingList keeps the original full 2nd collection up to date with changes made by the user.</P>
<P>Search this forum for FilteredBindingList and you should find some good code samples.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JimBalo replied on Monday, January 14, 2008</h2><P>Hi Joe and thanks for the reply,</P>
<P>I am using a FilteredBindingList whenever I need to bind a filtered subset to a grid already&nbsp;(that part was easy).&nbsp; The part I find tricky / messy is when the user then wants to perform some action on this filtered subset (such as remove all payments for the subset of invoices or move all payments for the subset to a different date, etc.).&nbsp;&nbsp; I have methods in InvoiceCollection already to handle all such actions and&nbsp; in a perfect world, all such methods would be able to operate on a filtered subset as well.&nbsp; But I do not know of a way to accomplish this in the real world, so&nbsp;instead I have&nbsp;created a bunch of filter-related methods instead.&nbsp;</P>
<P>Example for InvoiceCollection:</P>
<P>SetDateFilter is called on InvoiceCollection, which in turn calls it on each Invoice which calls it on PaymentCollection which calls it on each Payment.</P>
<P>&nbsp; public void SetDateFilter(DateTime date)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _filteredInvoices = new FilteredBindingList&lt;Invoice&gt;(this, InvoiceFilter);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _filteredInvoices.ApplyFilter("", date);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Invoice invoice in this)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; invoice.SetDateFilter(date);<BR>&nbsp; }</P>
<P>&nbsp; public void ChangePayDates(DateTime newDate)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PaymentsForDay.ChangePayDates(newDate);<BR>&nbsp; }<BR></P>
<P>&nbsp; public InvoiceCollection InvoicesForDay<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InvoiceCollection invoices = InvoiceCollection.GetEmpty();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Invoice invoice in _filteredInvoices)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; invoices.Add(invoice);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return invoices;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }</P>
<P>&nbsp; public double InvoicesForDayPaymentTotal<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double amount = 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Invoice invoice in _filteredInvoices)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amount += invoice.PaymentTotalForDay;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return amount;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }</P>
<P>&nbsp; public double InvoicesForDayDueAmountTotal<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double amount = 0;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Invoice invoice in _filteredInvoices)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amount += invoice.InvoiceAmount;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return amount;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }</P>
<P>There are many more filter related methods.&nbsp; I am looking for a cleaner solution to the above...</P>
<P>Thanks,</P>
<P>Jim</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
