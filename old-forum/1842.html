<html><header><title>Problem retrieving all child objects when there are grandchildren</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem retrieving all child objects when there are grandchildren</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1842.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>awegele posted on Monday, November 27, 2006</h2><P>I have created an object (Employee) that has children (Profiles) which in turn have children (Roles) and (Groups) using the CSLA 2.0 templates for Codesmith.&nbsp; In the Profiles object, the fetch code looks like this:</P><FONT color=#0000ff size=2>
<P>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Fetch(</FONT><FONT color=#008080 size=2>SafeDataReader</FONT><FONT size=2> dr)</P>
<P>{</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>while</FONT><FONT size=2>(dr.Read())</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Add(</FONT><FONT color=#008080 size=2>Profile</FONT><FONT size=2>.GetProfile(dr));</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>In the Profile object, the fetch code calls the NextResult method to obtain the Roles and Groups but when control returns to the Profiles fetch method, the data reader is pointing to the groups resultset (which has already been looped thru) and thus the read returns false and the second profile record is not returned.</P>
<P>Is this a limitation of the CSLA model (ie only 2 levels) or is there a way to handle more than 2?</P>
<P>&nbsp;</P>
<P>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, November 27, 2006</h2><P>The issue of fetching grandchild records has been discussed in great detail many times.</P>
<P>It is not a limitation of CSLA. There are many ways to do it. The Codesmith templates simply suggest one way to do it. If you do not like that method then you are free to override the implementation or simply write a new one.</P>
<P>Do a search of this forum for Grandchild and you should find some interesting reading including some details of the alternate methods.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Monday, November 27, 2006</h2>

<p class="MsoNormal">The answer to this question should be placed in the FAQ
sticky because it is asked every week.<span>&nbsp;
</span>BTW, does anyone know where the FAQ sticky went?<span>&nbsp; </span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, November 27, 2006</h2>We need better glue.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, November 27, 2006</h2>Indeed.<br><br>Here's the <a HREF="/forums/thread/6133.aspx">FAQ thread</a>.&nbsp; I can still edit it, but I can't make it sticky again.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, November 27, 2006</h2>And by here you mean.... ??<br><br>Anyway, to address the original issue of the thread, the data reader will limit your ability to fill multiple levels. You have several options although the most common are:<br><ul><li>Use anothe sp to fill grand children (maybe even lazy loading).</li><li>Use a dataset. </li></ul><br>I usually create a strongly typed dataset, fill it with one sp and navigate the relationships in order to fill the n-levels...<br>Using strongly typed is far easier than dynamic ds because you get a GetXYZRows() method for each of the relationships in the datarow, which makes the whole thing obscenely easy.<br>Things to keep in mind in this scenario:<br><ul><li>Do the table mappings correctly, otherwise you'll get empty tables and then a set of new tables called "Table", "Table1", "Table2",...,"TableN"</li><li>Don't forget to call your standard constructor which probably contains the calls to the appropiate MarkAsChild() or call it in the constructor that takes the datarow as a param.</li><li>Also, don't forget to call MarkOld() as well.</li></ul>Hope it helps!<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>awegele replied on Tuesday, November 28, 2006</h2>Thanks for the response.&nbsp; I used lazy loading to resolve the immediate issue but I appreciate the variety of techniques identified by you and others and will use them in the future if I encounter the need.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>awegele replied on Tuesday, November 28, 2006</h2>Thanks for your response.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
