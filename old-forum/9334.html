<html><header><title>Problem implementing server side caching</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem implementing server side caching</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9334.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ThomasHepp posted on Friday, August 06, 2010</h2><p>Hallo,</p>
<p>I&#39;am using Csla for my current project. It&#39;s a website. The DataPortal run&#39;s in a seperate windows service. I want to cache frequently used BOs server side. In my examle I want to cache my User and my UserGroup BOs. I implemented it very easy:</p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR:blue;">private</span> <span style="COLOR:blue;">static</span> <span style="COLOR:#2b91af;">Users</span> _users;</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR:blue;">public</span> <span style="COLOR:blue;">static</span> <span style="COLOR:#2b91af;">Users</span> Get()</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR:blue;">if</span> (_users == <span style="COLOR:blue;">null</span>)</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR:#2b91af;">SelectCriteria</span> crit = <span style="COLOR:blue;">new</span> <span style="COLOR:#2b91af;">SelectCriteria</span>(<span style="COLOR:blue;">typeof</span>(<span style="COLOR:#2b91af;">Users</span>));</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_users = <span style="COLOR:#2b91af;">DataPortal</span>.Fetch&lt;<span style="COLOR:#2b91af;">Users</span>&gt;(crit);</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;">}</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR:blue;">return</span> _users;</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="FONT-FAMILY:Consolas;FONT-SIZE:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p>&nbsp;</p>
<p>This code is working perfekt, but now I want to access the &quot;cache&quot; from the User BO:</p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">public</span> <span style="color:blue;">static</span> <span style="color:#2b91af;">User</span> Get(<span style="color:#2b91af;">Guid</span> id)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#2b91af;">Users</span> users = <span style="color:#2b91af;">Users</span>.Get();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">return</span> users.GetByID(id);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;font-size:9.5pt;">}</span></p>
<p>
<p>This is working until I want wo save this user bo instance, because it is a child object of Users. Now I tried the following:</p>
</p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">public</span> <span style="color:blue;">static</span> <span style="color:#2b91af;">User</span> Get(<span style="color:#2b91af;">Guid</span> id)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#2b91af;">Users</span> users = <span style="color:#2b91af;">Users</span>.Get();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">return</span> users.GetByID(id).Clone();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span lang="EN-US" style="font-family:Consolas;font-size:9.5pt;mso-ansi-language:EN-US;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;font-size:9.5pt;">}</span></p>
<p>
<p>But my clone is still a child object. Now the question: How can I mark the clone of a child as &quot;Not Child&quot;? Or is there a better way.</p>
<p>Thank&#39;s</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Wednesday, August 11, 2010</h2><p>It sounds like you want to cache user data which doesn&#39;t frequently change, but then you&#39;re trying to use cached data to update.</p>
<p>You&#39;d probably be better off creating a UserList which contains UserInfo objects.&nbsp; these would be a ROLB and RO objects.&nbsp; Getting the cached user data seems like a different use case with different requirements, and thus seperate BOs to handle them.</p>
<p>Your current user class would then only be used for editing (and you&#39;d probably want to invalidate the cache of userinfo when this is saved as well).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 11, 2010</h2><p>Caching actual business objects is essentially unworkable, because CSLA isn&#39;t threadsafe. Web servers are multithreaded, hence the conflict.</p>
<p>You can cache <i>serialized</i> objects, because when you deserialize the data you get your own copy of the object. That serialization/deserialization can be somewhat expensive though, so you should do perf testing to make sure it is workable for your application.</p>
<p>As Andy notes, it is probably better to consider caching the data than to cache the objects themselves.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
