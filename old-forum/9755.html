<html><header><title>One child to multiple parents (kind of)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>One child to multiple parents (kind of)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9755.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>krasimir posted on Saturday, November 13, 2010</h2><p>First, I already used the search function and read what I&#39;ve found on this topic, but still I think my case is valid and want to ask for suggestions. Here is my scenario:</p>
<p>I develop a Bug tracking system and have such hierarchy:</p>
<p>User</p>
<p>&nbsp; - Project</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; - Bug</p>
<p>Now, the problem is that I want to introduce Comment object, which (obviously) will contains comment text, but I want to have comments for specific bug, as well as for specific project. Then my hierarchy will change to this:</p>
<p>User</p>
<p>&nbsp; - Project</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; - Comment</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; - Bug</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Comment</p>
<p>Since the CSLA.net by default do not support one child with multiple parents, what I currently have in mind, is to have two different classes - BugComment and ProjectComment, both of which will point to one table Comments in the database. The Comment table will not contain reference to its parent, since I don&#39;t know if the parent is Project or Bug, and there will be two additional tables ProjectComments and BugComments that will store the mappings between each comment and its parent. </p>
<p>However, this means that I have to introduce two different collection classes too - BugComments and ProjectComments.</p>
<p>Is there something that I&#39;m missing here and is there an easier approach?</p>
<p>Thanks.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Saturday, November 13, 2010</h2><p>I think your plan seems fine, you&#39;re not violating any Csla rules with your plan.&nbsp; There&#39;s no reason two Csla objects can&#39;t point to the same tables in the database.</p>
<p>You can get away with one Comments collection and Comment class; when calling UpdateChildren, call it like this:&nbsp; UpdateChildren(this) or UpdateChildren(parentDataObj), then have two Child_[Insert | Update]s like this:&nbsp; Child_Insert(Project proj) and Child_Insert(Bug bug) (and the corroposnding Updates).&nbsp; </p>
<p>In this way you know exactly what&nbsp;the parent is and can insert the row in either BugComments or ProjectComments, as appropriate, and share the code which updates the Comments table.</p>
<p>Of course, this assumes Comments share behavior regardless of the type of parent.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>krasimir replied on Monday, November 15, 2010</h2><p>Thank you, Andy.</p>
<p>I like the idea with one class, but two Insert/Update methods - I&#39;ll try to see how it goes.</p>
<p>However, there is second part of my problem.</p>
<p>When I bild the UI later on (most probably Silverlight and ASP.NET MVC and/or WebForms), I would like to display a list with all comments form all projects/bugs from all users. This is not a problem. The problem is what if I select one particullar comment and want to delete it?</p>
<p>What I understand from the book (2008 edition) is that the only way to delete a child object is to go to its parent object and delete it from the&nbsp;its collection, that holds the child object. But how will I know which is the parent of my selected child form the UI list, when even the static GetXXX() method of the child class should be internal and not public?</p>
<p>I wonder, wouldn&#39;t be easier to make the all the static ChildClass.GetXXX() methods public, so when I select the comment in my list in the UI, I will be able to get the Parent of the comment, and if the parent of the comment is also a child class (the second case in my first posting on this topic), then I will be able to get the Project object throught its static GetProject() method and then, finally to get the root User object. Once I know which is the right root object, I can delete the comment object without a problem.</p>
<p>However, this seems not so ellegant to me, I probably I miss something. Moreover, I&#39;m sure there is a good reason for Rocky to made the GetXXX() methods internal and not public.</p>
<p>Please advise.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, November 18, 2010</h2><p>So from your previous post, that object graph is for editing, and everything is saved within the root BO&#39;s context.&nbsp; This list of all comments for all projects / bugs sounds like a different use case, so you&#39;d have a different (likely readonly) set of business objects.&nbsp; Immediate delete of a command can be accomplished by a DeleteComment command object.&nbsp;&nbsp; </p>
<p>I wouldn&#39;t advise going the switchable object route, which sounds like what you&#39;re describing.&nbsp; You&#39;ll be coupling two use cases together, and as soon as they have conflicting requirements, your code will be in trouble (and you&#39;ll need to split them at that point anyway).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
