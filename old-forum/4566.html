<html><header><title>Adding child via AddNew leaves IsNew = false</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Adding child via AddNew leaves IsNew = false</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4566.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>preludecrazy posted on Wednesday, March 26, 2008</h2><P><FONT face=Arial>Hi.</FONT></P>
<P><FONT face=Arial>I've added the following to my LiteCompanyCollection:<BR></FONT><FONT face=Arial><BR><FONT color=#0000ff><FONT face="Courier New">protected</FONT></FONT><FONT face="Courier New"> override object</FONT><FONT face="Courier New"> AddNewCore()<BR></FONT><FONT face="Courier New" color=#008080><FONT color=#000000>{<BR></FONT>LiteCompany</FONT><FONT face="Courier New"> result;<BR></FONT><FONT face="Courier New">result = </FONT><FONT face="Courier New" color=#008080>LiteCompany</FONT><FONT face="Courier New">.NewLiteCompany();<BR></FONT><FONT face="Courier New">OnAddingNew(</FONT><FONT face="Courier New"><FONT color=#0000ff>new</FONT> <FONT color=#008080>AddingNewEventArgs</FONT></FONT><FONT face="Courier New">(result));<BR></FONT><FONT face="Courier New">Add(result);<BR></FONT><FONT face="Courier New" color=#0000ff>return</FONT><FONT face="Courier New"> result;<BR></FONT><FONT face="Courier New">}</FONT></FONT></P>
<P><FONT face=Arial>And I'm adding a child to it like this:</FONT></P><FONT face=Arial><FONT color=#008080>
<P><FONT face="Courier New">LiteCompanyCollection</FONT></FONT><FONT face="Courier New"> objLCC = <FONT color=#008080>LiteCompanyCollection</FONT></FONT><FONT face="Courier New">.GetLiteCompanyCollection(-1); //Get all companies.<BR></FONT><FONT face="Courier New" color=#008080>LiteCompany</FONT><FONT face="Courier New"> objLC = objLCC.AddNew();<BR></FONT><FONT face="Courier New">objLC.Name = </FONT><FONT face="Courier New" color=#800000>"BBC"</FONT><FONT face="Courier New">;<BR></FONT><FONT face="Courier New">objLC.URL = </FONT><FONT face="Courier New" color=#800000><A href="http://www.bbc.co.uk/">http://www.bbc.co.uk/</A></FONT><FONT face="Courier New">;<BR></FONT><FONT face="Courier New">objLCC.Save();</FONT></P>
<P>The new child is added fine, however when I save it, DataPortal_Update() thinks the object I added IsNew&nbsp;is false, so the Update method is called instead of the Insert method.&nbsp; Am I supposed to be calling MarkNew() somewhere?</P>
<P>Thanks.</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, March 27, 2008</h2><P>The last 2 lines of my DataPortal_Create are:</P><FONT size=2>
<P>MarkNew()<BR>ValidationRules.CheckRules()</P></FONT>
<P>So when you call .NewLiteCompany you should be using DataPortal_Create and it should be marking your child BO new.</P>
<P>I think the framework tries to do it for you automatically for root objects. I know Rocky moved the call to a couple of lines earlier in the code in 3.5 so I have to re-evaluate if I can now stop commenting it out. I was one of the few remaining coders who branched to DP_Create if the ID is not found in DP_Fetch and the BOs were getting mixed up with New and Old in earlier versions.</P>
<P>My templates have left the call to MarkNew and MarkOld even for root objects because I needed them set before calling check rules. I can re-evaluate them later too.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>preludecrazy replied on Thursday, March 27, 2008</h2><P><FONT face=Arial>Thanks Joe.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, March 27, 2008</h2>What does your factory method look like?<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
