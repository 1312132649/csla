<html><header><title>ASP.net Storing Session in Database</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ASP.net Storing Session in Database</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4559.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant posted on Wednesday, March 26, 2008</h2><P>Just wondering if anyone has had any experience with CSLA, ASP.net&nbsp;and storing the session in the database rather than inproc.<BR><BR>The reason why i ask is that at first i thought that it was going to be simple but when i thought about it the default implementation for enabling this feature within ASP.net is that the web server will contact the database server directly. This goes against the model that CSLA puts forward. Hence i was wondering if anyone has dealt with this problem with CSLA and ASP.net before.<BR><BR>Thanks<BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlambert replied on Wednesday, March 26, 2008</h2>ASP.Net session implementation should be independent of CSLA, shouldn't it?  In fact, as long as everything you're storing in session is serializable, you should be able to switch implementation from inproc to session-server (in-memory or in-DB) just by changing your configuration.  It's really not connected to how CSLA persists business objects, if that's what you mean.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, March 26, 2008</h2><P>I agree with dlambert.</P>
<P>The key point to consider is that the CSLA database (and server) are NOT necessarily the same server and database as the ASP.Net session DB. In fact the DBs have to be different but the servers could be the same. It is your choice.</P>
<P>But if you are remoting to the CSLA DB then the APS.Net DB server should be a different box.</P>
<P>Note: for an app of any size you really should skip the InProc session state as it is too volatile and gets lost on AppDomain re-starts.</P>
<P>I use StateServer in a web farm.</P>
<P>Note: Serialization of session can be a perf killer if you store large objects in it. I probably have way too much stuff in my session state but I try hard to keep large BOs out of it once they are no longer needed. e.g. Result page lists are kept in session while paging or sorting - but once a slection is made the list is removed from session and the next page is rendered based on some key value extracted from the selected record.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Thursday, March 27, 2008</h2><P>Hi guys <BR>Thanks for the reply.<BR><BR>Firstly, Joe i have not had any experience with using a StateServer but i would imagine that the objects still need to be Serializable, is that correct? Also is there any perf difference between using a state server and using the default in-DB config session management?<BR><BR>Also my question about the database and CSLA is as follows. If you are splitting the client and the server in a web situation, chance are you are doing it because of security reasons. In this case the only server that can contact the database server is the server&nbsp;box and not the client box that runs the business objects and asp.net. Hence if i use the default implementation of storing the session in-DB via the config the client server will be trying to access the database server directly when it does not have access to do that, only the server box (as in the server that run the application data access code). Hence how does one handle this case??? Thus why I brought in CSLA and the fact that one might need to use a command object to retrieve the session and pass it onto the session handler or something.<BR><BR>Thanks <BR>Anthony<o:p></o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, March 27, 2008</h2><P><FONT face=Tahoma size=2>I think you may be getting a little confused... <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P>
<P><FONT face=Tahoma size=2>The "default" database-based session storage is a state server - StateServer is not the proper name of a product.&nbsp; Basically, if you switch to database-based session storage, you are introducing a database server into the process, and thus taking a performance hit.&nbsp; All your session objects need to be serializable.</FONT></P>
<P><FONT face=Tahoma size=2>As for your other question - if you're going to use the built-in ASP.NET facilities for database-based session storage, you have to give your IIS server access to a database to store session state.&nbsp; As Joe said, it doesn't have to be the same database as&nbsp;your application data, but it can be.&nbsp;&nbsp;If you dedicate a database server for session state, then you can&nbsp;lower your risk exposure, and you'll help keep performance up in a web-farm environment - all your web servers won't be contending with other apps for database resources.&nbsp; If you can't/won't do that, then you'll probably have to develop a custom session handler (not a trivial exercise), and you'll take another performance hit as you introduce another server into the process.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, March 27, 2008</h2><P>Anthony,</P>
<P>Yes - all objects in session must be serializable if you use State Server or SQL Server.</P>
<P>You are still mixing up the idea of the database for session being the same as the DB for CSLA. They are different.</P>
<P>For example,</P>
<P>1. Client browser is on a PC.</P>
<P>2. Client contacts Web Server.</P>
<P>3. Web server has a local SQL Server running for ASP.Net session information storage. (see the connection information below:)</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#a31515 size=2>sessionState</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>StateServer</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>stateNetworkTimeout</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>15</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>cookieless</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>AutoDetect</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>timeout</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>40</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>stateConnectionString</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>tcpip=127.0.0.1:42424</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>sqlConnectionString</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>data source=127.0.0.1;Trusted_Connection=yes</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P></FONT>
<P>4. The Web Server contacts a different SQL Server remotely for CSLA and processes data to send to the client.</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
