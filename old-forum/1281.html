<html><header><title>Need advice</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need advice</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1281.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Wednesday, September 20, 2006</h2>Hi,<br><br>I have an odd use case..<br><br>The case is that a user can edit a contact.&nbsp; The contact must have a company and department entered before its considered valid.&nbsp; To this end, the contact has a DepartmentId public property.&nbsp; Since a department is tied to a company, company is not stored.<br><br>The part I'm having problems with is this; the user, when editing the contact, can enter a company and / or department which does not yet exist.&nbsp; The system should accept this and when the contact is saved, the company and / or department are created.<br><br>Currently the UI handles this by looking at the SelectedIndex of the dropdown displaying the department.&nbsp; If this index is -1, it knows the department doesn't exist and will use the Company and Department business classes before continuing to save the contact.<br><br>For the DepartmentId property, if the combobox's text is null or empty, DepartmentId is set to -1.&nbsp; If its not, and the item is not in the list (selectedIndex = -1) the DepartmentId is set to int.MaxValue.&nbsp; The reason for this is that the business rule is defined such that DepartmentId must be &gt; -1.&nbsp; <br><br>This works, but has the drawback that since I cannot bind the ComboBox directly to DepartmentId, I must create a Textbox bound to that property so that the ErrorProvider shows.&nbsp; In the old layout, that text box is 'behind' the combobox so the user can't see it.&nbsp; In the new layout, this can't be done because all the controls are now contained within a TableLayoutContainer control.<br><br>This problem has lead me to rethink if the public DepartmentId property is a good idea or not.&nbsp; Ideally, my solution would allow me to bind the combobox directly to the property on the contact for the department.&nbsp; <br><br>Anyone have better ideas on how to handle this scenario?&nbsp; Should the UI be responsible for creating companies and departments which don't exist?&nbsp; Or should that be part of the contact object's responsiblity?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, September 20, 2006</h2><P>The question of whether you should allow new companies/departments to be created when adding/editing contacts is really a question for your users/customers but I would lean away from it if possible.&nbsp; If you want users to have the ability to add companies/departments from this interface, consider adding an ellipsis button (...) next to the drop-down control that will display a list editor when clicked.</P>
<P>Then, if you want to enforce security so that only certain users may add/remove/modify the list of companies/departments, you can bind this button's Visible or Enabled property instead if trying to implement all kinds of additional logic to handle it the way you've described.</P>
<P>This would also eliminate the mess with DepartmentID being -1 or Int32.MaxValue by always limiting the user to selecting from the drop-down list from your main interface.&nbsp; So, SelectedIndex will always be &gt;= -1.</P>
<P>You can bind the drop-down list and the list editor to the same collection object so that any changes to the collection through the list editor can be carried over to the drop-down list by simply rebinding the control when the list editor is closed.&nbsp; Then, you can still bind DepartmentID to the SelectedIndex property of the drop-down list as you indicated.</P>
<P>Obviously this adds to your UI requirements, but may be a cleaner way to code it unless your business requirements prevent this approach.</P>
<P>Hope that helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>The question of whether you should allow new companies/departments to be created when adding/editing contacts is really a question for your users/customers but I would lean away from it if possible.&nbsp; If you want users to have the ability to add companies/departments from this interface, consider adding an ellipsis button (...) next to the drop-down control that will display a list editor when clicked.</div></BLOCKQUOTE><br><br>The way things are now is what is required; they want to be able to type anything they want, whether it exists or not, without other forms appearing..<br>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>Then, if you want to enforce security so that only certain users may add/remove/modify the list of companies/departments, you can bind this button's Visible or Enabled property instead if trying to implement all kinds of additional logic to handle it the way you've described.</div></BLOCKQUOTE></p><p>Fortunately for right now, the users that can create contacts can create companies, and users that cannot create contacts cannot create companies.&nbsp; Only Sales people can modify those aspects of the data.<br></p><p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>You can bind the drop-down list and the list editor to the same collection object so that any changes to the collection through the list editor can be carried over to the drop-down list by simply rebinding the control when the list editor is closed.&nbsp; Then, you can still bind DepartmentID to the SelectedIndex property of the drop-down list as you indicated.</p>
<p>Obviously this adds to your UI requirements, but may be a cleaner way to code it unless your business requirements prevent this approach.</div></BLOCKQUOTE></p><p>I would like to go this route, but the requirements are such that they want 'one form' when creating a contact.&nbsp;&nbsp;&nbsp; Originally I had required the users to create the company / department first, then it would appear in the comboboxes.. however Sales people are on the phone and must capture all the info at once.&nbsp; They found they were writing things down, then maybe going to the app to enter the data later.. <br></p><p>The way it works now, the users are happy and enter directly into the application while they are on the phone.&nbsp; Which is good.. its just my end of things are more complicated..&nbsp; I did float the elipsises idea by them, and they were instant that it was all one form.<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, September 20, 2006</h2><P>Oh, boy.&nbsp; I've been down that road before.&nbsp; Have they considered what safeguards are to be in place to prevent one user from entering "Ford", another from entering "Ford Motor", a third from entering "Ford Motor Co." and fourth from entering "Ford Motor Company"?&nbsp; (Been there, done that!).</P>
<P>This is the obvious pitfall in not enforcing selection from a list, but if they are comfortable with the risk or have incorporated some additional logic to prevent such things, then who's to tell them otherwise, eh?&nbsp; Just wait until they try to run a report and bring up all sales for "Ford" and the list is missing some items!!!</P>
<P>If this is to be the case, then your work is a bit more complicated because, as you said, there is a problem trying to bind the DepartmentId to the drop-down list.&nbsp; If I understand your original post correctly, you are going to have the following type of code in the Save routine (pardon the rough semi-code):</P>
<P><CODE>if (CompanyList.SelectedIndex == -1)<BR>{<BR>&nbsp; &nbsp; if (String.IsNullOrEmpty(CompanyList.Text))<BR>&nbsp; &nbsp; {<BR>&nbsp; &nbsp; &nbsp; &nbsp; DataSource.DepartmentId = -1;<BR>&nbsp; &nbsp; }<BR>&nbsp; &nbsp; else<BR>&nbsp; &nbsp; {<BR>&nbsp; &nbsp; &nbsp; &nbsp; Company c = new Company(CompanyList.Text);<BR>&nbsp; &nbsp; &nbsp; &nbsp; c.Save();<BR>&nbsp; &nbsp; &nbsp; &nbsp; DataSource.DepartmentId = c.Id;<BR>&nbsp; &nbsp; }<BR>}<BR>else<BR>&nbsp; &nbsp; DataSource.DepartmentId = CustomerList.SelectedIndex; </CODE></P>
<P>Is that close?&nbsp; I guess the only questionable area is creating the new company and saving it all in one shot, but if that's what you've got to do, ya know?</P>
<P>Sounds like you are on the right track given the requirements you've been handed.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>Oh, boy.&nbsp; I've been down that road before.&nbsp; </div></BLOCKQUOTE><br><br>Yes, I'm certainly not the first I'm sure.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>Have they considered what safeguards are to be in place to prevent one user from entering "Ford", another from entering "Ford Motor", a third from entering "Ford Motor Co." and fourth from entering "Ford Motor Company"?&nbsp; (Been there, done that!).<br>
<p>This is the obvious pitfall in not enforcing selection from a list, but if they are comfortable with the risk or have incorporated some additional logic to prevent such things, then who's to tell them otherwise, eh?&nbsp; Just wait until they try to run a report and bring up all sales for "Ford" and the list is missing some items!!!</div></BLOCKQUOTE></p><p>Yes, I did explain these problems.&nbsp; Their answer was that it doesn't change the fact that need to enter data very quickly, and having more forms opened slows them down, which, to be fair, is a valid point.</p><p>To prevent the problems you describe, I've set the company / department comboboxes SuggestList.&nbsp; Changing the company changes the SuggestList on the department (or nulls it, if the company doesn't exist).&nbsp; Additionally, there is functionality to merge companies, departments and even contacts, since they do have some duplicates of those too!</p><p>I don't have any reports yet; only the contact management piece is done.&nbsp; But I am working on quoting, invoicing and ordering, and reports will be part of that phase and those issues will be brought to light.&nbsp; If its a big problem, I can try pushing them to the elipsis button route..&nbsp; unless someone has another solution!&nbsp; <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><br></p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>If this is to be the case, then your work is a bit more complicated because, as you said, there is a problem trying to bind the DepartmentId to the drop-down list.&nbsp; If I understand your original post correctly, you are going to have the following type of code in the Save routine (pardon the rough semi-code):</p>
<p><code>if (CompanyList.SelectedIndex == -1)<br>{<br>&nbsp; &nbsp; if (String.IsNullOrEmpty(CompanyList.Text))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; DataSource.DepartmentId = -1;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; Company c = new Company(CompanyList.Text);<br>&nbsp; &nbsp; &nbsp; &nbsp; c.Save();<br>&nbsp; &nbsp; &nbsp; &nbsp; DataSource.DepartmentId = c.Id;<br>&nbsp; &nbsp; }<br>}<br>else<br>&nbsp; &nbsp; DataSource.DepartmentId = CustomerList.SelectedIndex; </code></p>
<p>Is that close?&nbsp; I guess the only questionable area is creating the new company and saving it all in one shot, but if that's what you've got to do, ya know?</div></BLOCKQUOTE></p><p>That more or less is what I have done. <br></p>

<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>Sounds like you are on the right track given the requirements you've been handed.</div></BLOCKQUOTE></p>I was hoping there may be a simplier solution, like creating a Company and Department properties on Contact.&nbsp; Behind the scenes when the contact is saved, it would look up the company / department from the text entered.&nbsp; <br><br>My concern there is that it doesn't pick the 'right company' because there could be duplicates... but OTOH duplicates would likely be the same company anyway and so it wouldn't matter, and the problem goes away when they finally merge the duplciates.<br><br>Thoughts on that approach?&nbsp; Is the contact doing 'too much' at that point?&nbsp; I hear people talking about the single responsibility principal or something.. would that be a violation? (Even if it handed the actual work of creating off the the proper classes?)<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
