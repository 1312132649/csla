<html><header><title>Data transfer speed issues for WindowsForms/WPF in 4.5.20</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Data transfer speed issues for WindowsForms/WPF in 4.5.20</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11905.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Wednesday, March 27, 2013</h2><p>Hi Rocky,</p>
<p>I have this test application that started life on CSLA .NET 2.xx using Windows Forms. Since the business and the data access are generated, I made it evolve to CSLA .NET 4.3.13 and now there are also WPF and Silverlight versions. These two versions used the same ViewModels and almost the same Views.</p>
<p>I have a form/view that is a ReadOnly list of ReadOnly objects. In the database there are 500.000 rows but I only fetch 10.000 at a time.</p>
<p>For 10.000 rows, under 4.3.13 the timings are:<br />WindowsForms/WPF: 12.5 sec<br />WindowsForms/WPF binary formater: 4 sec<br />Silverlight: &lt; 2 sec</p>
<p>For the same 10.000 rows, under 4.5.20 the timings are.. the same!!!</p>
<p>Except I can&#39;t use the binary formater. So the net result of upgrading to 4.5.20 is that my application runs slower!</p>
<p>I was under the very strong impression that upgrading to CSLA 4.5 would result in WindowsForms/WPF using the same lightning fast serializer/formater used by Silverlight. I even thought this was the only serializer/formater available on CSLA 4.5.</p>
<p>I tried a lot of configuration settings but the numbers didn&#39;t change.</p>
<p>Why do the WindowsForms/WPF versions take 6 times more than the Silverlight one, to transfer the exact same data? What am I doing wrong?</p>
<p>&lt;edit&gt;</p>
<p>I tried CSLA .NET 4.5.20 targeting NET 4.0 and NET 4.5 and the results are the same.</p>
<p>&lt;/edit&gt;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Thursday, March 28, 2013</h2><p>Final update and request for help</p>
<p>There are no samples that use mobile serializer/formater, except for Silverlight/WP/WinRT. My problem concerns NET so...</p>
<p>This NET 4.5 project has clients for Silverlight, WPF and Windows Forms. Let&#39;s forget about Windows Forms for a moment.</p>
<p>The project is a migration of a CSLA 4.3.13 and so there are only synchronous DataPortal_XYZ methods (the ones that return void). This shoudn&#39;t be a problem since everything works when using WcfProxy.</p>
<p>When I switch the WPF client to MobileProxy (I founf out how to do it), some classes behave as they should, some other classes just hang the WPF client application.</p>
<p>I know the MobileProxy is being used because the view referred above loads 10.000 rows in less than 2 seconds, but I can&#39;t login (the list is available for everyone).</p>
<p>I don&#39;t think this is related to BO code, as the same code&nbsp;works all right under Silverlight (that is using the Mobile serializer/formater) and when I use WcfProxy.</p>
<p>So... I need help. What are the correct configuration options? Could this be a new bug?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, March 30, 2013</h2><p>It is possible that there are bugs of course :)</p>
<p>Version 4.3 didn&#39;t automatically use the new binary reader/writer - you need to configure the client and server to use them. This is discussed in the change log for the version where this was introduced (4.1?).</p>
<p>In 4.5 we changed the default behavior to use the new reader/writer.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, March 30, 2013</h2><p>Hi Rocky,</p>
<p>The new MobileFormatter was introduced in 4.3.0 and according to</p>
<p><a href="http://www.lhotka.net/Article.aspx?id=1c287e08-d428-4c27-b538-d588e3c55775">http://www.lhotka.net/Article.aspx?id=1c287e08-d428-4c27-b538-d588e3c55775</a></p>
<p>it was available only&nbsp;for Silverlight and Windows Phone.</p>
<p>On the appserver web.config we had to add to the appSettings block</p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">add</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">key</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">CslaWriter</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">value</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Serialization.Mobile.CslaBinaryWriter,&nbsp;Csla</span>&quot;<span style="COLOR:blue;">&nbsp;/&gt;</span>
<span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">add</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">key</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">CslaReader</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">value</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Serialization.Mobile.CslaBinaryReader,&nbsp;Csla</span>&quot;<span style="COLOR:blue;">&nbsp;/&gt;</span>
</pre>
<p>On&nbsp;the Application_Startup method of App.xaml.cs of Silverlight and Windows Phone projects we had to add</p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">Serialization</span>.<span style="COLOR:darkblue;">Mobile</span>.<span style="COLOR:darkblue;">CslaReaderWriterFactory</span>.<span style="COLOR:darkcyan;">SetCslaReaderType</span>(<span style="COLOR:blue;">typeof</span>(<span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">Serialization</span>.<span style="COLOR:darkblue;">Mobile</span>.<span style="COLOR:darkblue;">CslaBinaryReader</span>));
<span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">Serialization</span>.<span style="COLOR:darkblue;">Mobile</span>.<span style="COLOR:darkblue;">CslaReaderWriterFactory</span>.<span style="COLOR:darkcyan;">SetCslaWriterType</span>(<span style="COLOR:blue;">typeof</span>(<span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">Serialization</span>.<span style="COLOR:darkblue;">Mobile</span>.<span style="COLOR:darkblue;">CslaBinaryWriter</span>));
</pre>
<p>That works all right. Some configuration changes were needed in order to keep it working on 4.5.20. I had a look at the ProjectTracker projects and made the necessary adjustments. But that&#39;s not the point. My SIlverlight projects is using the so called binary reader/writer under 4.3.13 and 4.5.20 and works all right on both scenarios. The problem is my NET applications under 4.5.20: both WPF and Windows Forms stop working as they should when I try to use the mobile formatter.</p>
<p>Let me add that while WPF half works (some views do, some other don&#39;t), Windows Forms is completely broken. The view that works on WPF uses a <strong>ReadOnlyList </strong>while in Windows Forms the equivalent form uses a <strong>ReadOnlyBindingList</strong>. This shouldn&#39;t be important but I can&#39;t find&nbsp;any other difference at all.</p>
<p>By the way, I find the naming quite confusing, since&nbsp;binary formatter is the standard Microsoft .NET, the one we can find on <strong>System.Runtime.Serialization.Formatters.Binary.BinaryFormatter</strong>. On the above link to 4.3.0 release notes, you can see that Issue 984 refers a <strong>CslaFormatter &quot;</strong>that is more efficient than <strong>MobileFormatter</strong>&quot;. So all of a sudden we have 3 names for the same formatter:</p>
<ul>
<li>Csla&#39;s own binary formatter</li>
<li>mobile formatter </li>
<li>csla formatter</li>
</ul>
<p>As far as I can see by looking at 4.5.20 source code, the correct name is <strong>MobileFormatter</strong>.</p>
<p>Again, as far as I can see by looking at 4.5.20 source code, the <strong>MobileProxy</strong> uses the <strong>MobileFormater</strong>&nbsp;and so does the <strong>WcfPortal</strong> you can find on <strong>Csla.Server.Hosts.Mobile</strong>. Simple, consistent and makes sense.</p>
<p>There are no samples that use this scenario for WPF or Windows Forms. This is important because when in doubt, we turn to samples. So&nbsp;either I have misconfigured something or&nbsp;it doesn&#39;t work.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, April 02, 2013</h2><p>Ahh, I suspect I know the issue then.</p>
<p>The BusinessListBase class is modern, and has always had to work with MobileFormatter.</p>
<p>BusinessBindingListBase is for legacy support of Windows Forms and never had to work with MobileFormatter in the past.</p>
<p>It is very likely that the ___BindingListBase classes use private backing fields and/or don&#39;t include the IMobileObject implementations required to work with the MobileFormatter.</p>
<p>That is a bug of course. One most easily solved by eliminating support for Windows Forms - if only I could do that... :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 03, 2013</h2><p>Now I think my suspicion is wrong. Mostly because I created a simple test app using the MobleProxy and I&#39;m not having any problems with the data portal or serialization with BusinessBase or BusinessBindingListBase.</p>
<p>Can you create&nbsp;a simple repro of the issue? </p>
<p>Basically try what I just did - create a new UI project, class library, and web project. Set them up for n-tier configuration using the MobileProxy and host, and retrieve some objects of various stereotypes.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Friday, April 05, 2013</h2><p>Hi Rocky,</p>
<p>What are the correct configurations? Can you confirm the configuration changes below?</p>
<p><strong>Windows Forms app.config</strong></p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">appSettings</span><span style="COLOR:blue;">&gt;</span></pre>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">  ...</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">add</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">key</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">CslaDataPortalProxy</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">value</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.DataPortalClient.<span style="text-decoration:underline;">MobileProxy</span>,&nbsp;Csla</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">appSettings</span><span style="COLOR:blue;">&gt;</span>
</pre>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">system.serviceModel</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;"><span style="COLOR:blue;">&nbsp;&nbsp;&lt;!--</span><span style="COLOR:green;">&nbsp;The default is <span style="color:green;">basicHttpBinding. </span>Is&nbsp;wsHttpBinding needed&nbsp;or the default <span style="color:green;">will do as well</span>?&nbsp;</span><span style="COLOR:blue;">--&gt;</span>
&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">client</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">endpoint</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">name</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">WcfDataPortal</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">binding</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">wsHttpBinding</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">bindingConfiguration</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">wsHttpBinding_IWcfPortal</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">address</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">http://localhost:33725/WcfPortal.svc</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">contract</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">WcfPortal.IWcfPortal</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;/</span><span style="COLOR:#a31515;">client</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">bindings</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">wsHttpBinding</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">binding</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">name</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">wsHttpBinding_IWcfPortal</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxReceivedMessageSize</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxBufferPoolSize</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">receiveTimeout</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">10</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">sendTimeout</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">10</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">openTimeout</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">10</span>&quot;<span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">readerQuotas</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxBytesPerRead</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxArrayLength</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxStringContentLength</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxNameTableCharCount</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">maxDepth</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">2147483647</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="COLOR:#a31515;">binding</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="COLOR:#a31515;">wsHttpBinding</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;/</span><span style="COLOR:#a31515;">bindings</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">system.serviceModel</span><span style="COLOR:blue;">&gt;</span></pre>
<p><strong>WcfPortal.svc</strong></p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="BACKGROUND:yellow;">&lt;%</span><span style="COLOR:blue;">&nbsp;@</span><span style="COLOR:maroon;">ServiceHost</span>&nbsp;<span style="COLOR:red;">Service</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:darkblue;">Csla</span><span style="COLOR:blue;">.</span><span style="COLOR:darkblue;">Server</span><span style="COLOR:blue;">.</span><span style="COLOR:darkblue;">Hosts</span><span style="COLOR:blue;">.</span><span style="COLOR:darkblue;"><span style="text-decoration:underline;">Mobile</span></span><span style="COLOR:blue;">.</span><span style="COLOR:darkblue;">WcfPortal</span><span style="COLOR:blue;">&quot;</span>&nbsp;<span style="BACKGROUND:yellow;">%&gt;</span>
</pre>
<p><strong>WcfAppServer web.config</strong></p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">appSettings</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;!--</span><span style="COLOR:green;">&nbsp;Is&nbsp;this&nbsp;needed&nbsp;at&nbsp;all?&nbsp;</span><span style="COLOR:blue;">--&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">add</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">key</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">CslaWriter</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">value</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Serialization.Mobile.CslaBinaryWriter,&nbsp;Csla</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">add</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">key</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">CslaReader</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">value</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Serialization.Mobile.CslaBinaryReader,&nbsp;Csla</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">appSettings</span><span style="COLOR:blue;">&gt;</span></pre>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">services</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">service</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">name</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Server.Hosts.<span style="text-decoration:underline;">Mobile</span>.WcfPortal</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">behaviorConfiguration</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">returnFaults</span>&quot;<span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="COLOR:#a31515;">endpoint</span><span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">binding</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">wsHttpBinding</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">bindingConfiguration</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">wsHttpBinding_IWcfPortal</span>&quot;<span style="COLOR:blue;">&nbsp;</span><span style="COLOR:red;">contract</span><span style="COLOR:blue;">=</span>&quot;<span style="COLOR:blue;">Csla.Server.Hosts.<span style="text-decoration:underline;">Mobile</span>.IWcfPortal</span>&quot;<span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:blue;">&nbsp;&nbsp;&lt;/</span><span style="COLOR:#a31515;">service</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">services</span><span style="COLOR:blue;">&gt;</span></pre>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>Close.</p>
<p>The client no longer needs the system.servicemodel stuff at all - just set the data portal url via appsettings and it does the right thing.</p>
<p>The server does still need all the system.servicemodel stuff to set the data size limits to max (I assume you have that but didn&#39;t show it).</p>
<p>In CSLA 4.5 you do not need to set the cslareader/cslawriter because they default to binary.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p>There may be some big misunderstanding because when I apply the configuration changes to the trunk&#39;s&nbsp;project tracker it just hangs.</p>
<p><strong>WfUI app.config</strong></p>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalProxy</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.DataPortalClient.<span style="text-decoration:underline;">MobileProxy</span>,&nbsp;Csla</span>&quot;<span style="color:blue;">/&gt;</span>
</pre>
<p><strong>WcfAppServer WcfPortal.svc</strong></p>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;"><span style="background:yellow;">&lt;%</span><span style="color:blue;">&nbsp;@</span><span style="color:maroon;">ServiceHost</span>&nbsp;<span style="color:red;">Service</span><span style="color:blue;">=</span><span style="color:blue;">&quot;</span><span style="color:darkblue;">Csla</span><span style="color:blue;">.</span><span style="color:darkblue;">Server</span><span style="color:blue;">.</span><span style="color:darkblue;">Hosts</span><span style="color:blue;">.</span><span style="color:darkblue;"><span style="text-decoration:underline;">Mobile</span></span><span style="color:blue;">.</span><span style="color:darkblue;">WcfPortal</span><span style="color:blue;">&quot;</span>&nbsp;<span style="background:yellow;">%&gt;</span>
</pre>
<p>What am I missing?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>On the client I have this:</p>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;"><span style="color:blue;">&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">appSettings</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalProxy</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.DataPortalClient.MobileProxy,&nbsp;Csla</span>&quot;<span style="color:blue;">/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalUrl</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://localhost:17270/SlPortal.svc</span>&quot;<span style="color:blue;">/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">appSettings</span><span style="color:blue;">&gt;</span><br /></pre>
<p>On the server I have this:</p>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;"><span style="color:blue;">&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">system.serviceModel</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceHostingEnvironment</span><span style="color:blue;">&nbsp;</span><span style="color:red;">multipleSiteBindingsEnabled</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">services</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">service</span><span style="color:blue;">&nbsp;</span><span style="color:red;">behaviorConfiguration</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">WcfPortalBehavior</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.Server.Hosts.Mobile.WcfPortal</span>&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">endpoint</span><span style="color:blue;">&nbsp;</span><span style="color:red;">address</span><span style="color:blue;">=</span>&quot;&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">binding</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">basicHttpBinding</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">contract</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.Server.Hosts.Mobile.IWcfPortal</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">bindingConfiguration</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">basicHttpBinding_IWcfPortal</span>&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">identity</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">dns</span><span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">localhost</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">identity</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">endpoint</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">endpoint</span><span style="color:blue;">&nbsp;</span><span style="color:red;">address</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">mex</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">binding</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">mexHttpBinding</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">contract</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">IMetadataExchange</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">service</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">services</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">bindings</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">basicHttpBinding</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">binding</span><span style="color:blue;">&nbsp;</span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">basicHttpBinding_IWcfPortal</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">maxReceivedMessageSize</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">2147483647</span>&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">readerQuotas</span><span style="color:blue;">&nbsp;</span><span style="color:red;">maxBytesPerRead</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">2147483647</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">maxArrayLength</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">2147483647</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">maxStringContentLength</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">2147483647</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">maxDepth</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">1024</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">binding</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">basicHttpBinding</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">bindings</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">behaviors</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceBehaviors</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&nbsp;</span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">returnFaults</span>&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceDebug</span><span style="color:blue;">&nbsp;</span><span style="color:red;">includeExceptionDetailInFaults</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&nbsp;</span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceMetadata</span><span style="color:blue;">&nbsp;</span><span style="color:red;">httpGetEnabled</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceDebug</span><span style="color:blue;">&nbsp;</span><span style="color:red;">includeExceptionDetailInFaults</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&nbsp;</span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">WcfPortalBehavior</span>&quot;<span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceMetadata</span><span style="color:blue;">&nbsp;</span><span style="color:red;">httpGetEnabled</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">serviceDebug</span><span style="color:blue;">&nbsp;</span><span style="color:red;">includeExceptionDetailInFaults</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">&nbsp;/&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">behavior</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">serviceBehaviors</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">behaviors</span><span style="color:blue;">&gt;</span><br /><span style="color:blue;">&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">system.serviceModel</span><span style="color:blue;">&gt;</span></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>One other thing to note is that Windows Forms defaults the current principal to the .NET GenericPrincipal. That type can&#39;t be serialized through the MobileFormatter, so you must ensure your app&#39;s current principal is set to some valid object as the app starts. I typically do this:</p>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.<span style="color:#2b91af;">ApplicationContext</span>.User&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;Csla.Security.<span style="color:#2b91af;">UnauthenticatedPrincipal</span>();</pre>
<pre style="font-size:13px;font-family:Consolas;background:white;color:black;"><br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p>After the changes to *.config files on the&nbsp;master branch&nbsp;ProjectTracker, WPF UI can login and shows data. Even after the fix for Windows Forms principal, its UI can&#39;t login and it doesn&#39;t show any data at all.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>
<p>One other thing to note is that Windows Forms defaults the current principal to the .NET GenericPrincipal. That type can&#39;t be serialized through the MobileFormatter (...)</p>
<p></div></p>
<p>If a type can&#39;t be serialized, shouldn&#39;t the serializer raise an exception?</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p>On my test project WPF I wasn&#39;t able to login using the MobileProxy. As soon as I changed the ViewModel class to use <strong>BeginLogin()</strong> instead of the synchronous <strong>Login</strong>() the problem was solved.</p>
<p>This project was migrated from 4.3.13 with minimal changes and doesn&#39;t use&nbsp;async/await keywords.</p>
<p>Everything works when I used WcfProxy.</p>
<p>Windows Forms uses only synchronous methods.</p>
<p>Some forms that work under Silverlight, hang under WPF when using the MobileProxy.</p>
<p>No form works under Windows Forms when using the MobileProxy.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>I wonder if you have proper exception handling code? The serializer _does_ throw an exception if it can&#39;t serialize or deserialize an object - that&#39;s what reminded me about the principal (because as soon as I ran my little test app it blew up).</p>
<p>Is it possible that you are getting exceptions from the data portal and are swallowing them so you don&#39;t see the reason for failure?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p>No try/catch block are used. Then again, the exceptions should also show on ProjectTracker WfUI project and I saw none. Why don&#39;t you try to port ProjectTracker to MobileProxy?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Saturday, April 06, 2013</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b> </p>
<p>One other thing to note is that Windows Forms defaults the current principal to the .NET GenericPrincipal. That type can&#39;t be serialized through the MobileFormatter, so you must ensure your app&#39;s current principal is set to some valid object as the app starts. I typically do this:</p>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Csla.<span style="COLOR:#2b91af;">ApplicationContext</span>.User&nbsp;=&nbsp;<span style="COLOR:blue;">new</span>&nbsp;Csla.Security.<span style="COLOR:#2b91af;">UnauthenticatedPrincipal</span>();</p>
<pre></pre>
<p>
</p>
<pre></pre>
<div style="CLEAR:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p>On my test project I added then removed the line above. Then I checked the default value of </p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">ApplicationContext</span>.<span style="COLOR:purple;">User</span>
</pre>
<p>is indeed Csla.Security.UnauthenticatedPrincipal.&nbsp;That&#39;s why I don&#39;t get a serialization exception.</p>
<p>I made brakpoints on all four exceptions that are thrown on the <span style="COLOR:darkblue;">MobileFormatter</span>&nbsp;class. After I click on the login button, execution never stops on any of the breackpoints.</p>
<p>I manage to force an exception by inserting the lines below in the <span style="COLOR:darkblue;">MobileFormatter</span>&nbsp;class, in the&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:darkblue;">SerializationInfo</span>&nbsp;<span style="color:darkcyan;">SerializeObject</span>(<span style="color:blue;">object</span>&nbsp;obj) method</p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">if</span>&nbsp;(obj.<span style="COLOR:darkcyan;">GetType</span>()&nbsp;<span style="COLOR:darkcyan;">==</span>&nbsp;<span style="COLOR:blue;">typeof</span>&nbsp;(<span style="COLOR:darkblue;">Csla</span>.<span style="COLOR:darkblue;">Core</span>.<span style="COLOR:darkblue;">MobileList</span>&lt;<span style="COLOR:blue;">string</span>&gt;))
&nbsp;&nbsp;mobile&nbsp;=&nbsp;<span style="COLOR:blue;">null</span>;
</pre>
<p>right after</p>
<pre style="FONT-SIZE:13px;FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;"><span style="COLOR:blue;">var</span>&nbsp;mobile&nbsp;=&nbsp;obj&nbsp;<span style="COLOR:blue;">as</span>&nbsp;<span style="COLOR:darkblue;">IMobileObject</span>;
</pre>
<p>Running (CTRL F5) with this change I get a &quot;Type MobileList`1 must implement IMobileObject&quot; exception</p>
<p>So my UI app shows exceptions.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 06, 2013</h2><p>It is possible that the issue is related to this</p>
<p><a href="https://github.com/MarimerLLC/csla/issues/66">https://github.com/MarimerLLC/csla/issues/66</a></p>
<p>I assume your calls are sync (DataPortal.Fetch, not FetchAsync)?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Sunday, April 07, 2013</h2><p>As sync as it can be.</p>
<p>I&#39;m using <strong>DataPortal.Fetch</strong> (not BeginFetch nor FetchAsync):</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, April 07, 2013</h2><p>OK, it is a sort of related issue, but is really this:</p>
<p><a href="https://github.com/MarimerLLC/csla/issues/114">https://github.com/MarimerLLC/csla/issues/114</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Thursday, April 11, 2013</h2><p>It&#39;s almost solved. The forms/views show all right. There is this issue about a DynamicRoot not invalidating the cache (it works with the WcfProxy but doesn&#39;t with the MobileProxy).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
