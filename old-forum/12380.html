<html><header><title>using WCF service in mvc with csla</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>using WCF service in mvc with csla</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12380.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Narvesh posted on Friday, February 14, 2014</h2><p><span>I have a WCF service Provided by csla. I want to consume this service in my MVC Project.I have create a object of service like below:</span></p>
<pre class="lang-cs prettyprint prettyprinted"><pre class="default prettyprint prettyprinted"><code><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">WcfPortalClient</span><span class="pln"> obj </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">WcfPortalClient</span><span class="pun">();</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">Application</span><span class="pln"> </span><span class="typ">App</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Application</span><span class="pun">();</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">AppType</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">App</span><span class="pun">.</span><span class="typ">GetType</span><span class="pun">();</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">ApplicationCriteria</span><span class="pln"> </span><span class="typ">Criteria</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ApplicationCriteria</span><span class="pln"> </span><span class="pun">{</span><span class="typ">ApplicationName</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">&quot;application&quot;</span><span class="pln"> </span><span class="pun">};</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">FetchRequest</span><span class="pln"> </span><span class="typ">Fetch1</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">FetchRequest</span><span class="pun">();</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">CslaTest</span><span class="pun">.</span><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">DataPortalContext</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ServiceReference2</span><span class="pun">.</span><span class="typ">DataPortalContext</span><span class="pun">();</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">Fetch1</span><span class="pun">.</span><span class="pln">_context </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">;</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">Fetch1</span><span class="pun">.</span><span class="pln">_objectType</span><span class="pun">=</span><span class="pln"> </span><span class="typ">AppType</span><span class="pun">;</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="typ">Fetch1</span><span class="pun">.</span><span class="pln">_criteria </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Criteria</span><span class="pun">;</span></code></pre>
<pre class="default prettyprint prettyprinted"><code><span class="pln">
 </span><span class="kwd">var</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> obj</span><span class="pun">.</span><span class="typ">Fetch</span><span class="pun">(</span><span class="typ">Fetch1</span><span class="pun">);</span></code></pre>
</pre>
<pre class="lang-cs prettyprint prettyprinted"><code><span class="pun"><span>Getting error as:</span></span></code></pre>
<pre class="lang-cs prettyprint prettyprinted"><code><span class="pun"><pre class="default prettyprint prettyprinted"><code><span class="typ">Type</span><span class="pln"> </span><span class="str">&#39;CslaTest.BusinessLibrary.ApplicationCriteria&#39;</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> data contract name </span><span class="str">&#39;ApplicationCriteria:http://schemas.datacontract.org/2004/07/CslaTest.BusinessLibrary&#39;</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> expected</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Consider</span><span class="pln"> </span><span class="kwd">using</span><span class="pln"> a </span><span class="typ">DataContractResolver</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> add any types </span><span class="kwd">not</span><span class="pln"> known statically to the list of known types </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> example</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="kwd">using</span><span class="pln"> the </span><span class="typ">KnownTypeAttribute</span><span class="pln"> attribute </span><span class="kwd">or</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> adding them to the list of known types passed to </span><span class="typ">DataContractSerializer</span><span class="pun">.</span><span class="str">&#39;</span></code></pre>
</span></code></pre>
<pre class="lang-cs prettyprint prettyprinted"></pre></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Sunday, February 16, 2014</h2><p>You got this all wrong. You should rather use the DataPortal and configure the DataPortal to use WCF as transport channel if you want to use N-Tier deployment. </p>
<p>So to fetch a &quot;root&quot; object you just call: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:#2b91af;">Order</span>&nbsp;GetOrder(<span style="color:blue;">int</span>&nbsp;id)
{
&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:#2b91af;">DataPortal</span>.Fetch&lt;<span style="color:#2b91af;">Order</span>&gt;(id);
}</pre>
<p>and this will use the WCF channel when properly configured, f.ex: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">appSettings</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalProxy</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.DataPortalClient.WcfProxy,&nbsp;Csla</span>&quot;<span style="color:blue;">/&gt;</span>
<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalUrl</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://localhost:21647/WcfPortal.svc</span>&quot;<span style="color:blue;">/&gt;</span></pre>
<p>Look at the <i>NET\cs\SimpleNTier</i> sample in the Samples folder. This sample shows a how to use N-Tier deployment with different UI technologies, including ASP.NET MVC.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AdrianSegovia replied on Wednesday, February 26, 2014</h2><p>Hello JonnyBee,</p>
<p>Could you help me with this?<br />I have my mvc app working properly in IIS Express but I&#39;m having a hard time deploying in my test server. I&#39;m pretty sure it&#39;s related to my WcfAppServer.<br />How do you go about deploying your&#39;s with WCF? <br />My test server has IIS 7.5 in it and I deployed the service in it but my mvc cannot see it.</p>
<p>Thanks</p>
<p>Adrian&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
