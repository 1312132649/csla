<html><header><title>Object Level Audit Trail</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Object Level Audit Trail</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1955.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy posted on Tuesday, December 12, 2006</h2>In most cases audit trail is implemented in DB using triggers/stored procedures upon inserting/updating/deleting the data in the table. However has anyone thought of doing object level audit trail in CSLA version 2.0? Again, I want to hear your insights/theory on how to achieve object level audit trail.<br><br>Thanks,<br>Glenn<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 12, 2006</h2>Glenn, are you trying to do auditing or locking?&nbsp; Those are distinct tasks, and have nothing to do with each other usually.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Tuesday, December 12, 2006</h2>Sorry Andy, what I mean is Audit Trail. I got mixed up with my previous post. I'll try to edit the main post. What I'm trying to do here is to create proof of concept of object level audit trail.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Norty replied on Wednesday, December 13, 2006</h2><P>Since we do not always have a DB where we can implement triggers, we do not use them.&nbsp; To date we have only implemented 1 project using CSLA<img src="/emoticons/emotion-10.gif" alt="Embarrassed [:$]" />, but this is about to change.&nbsp; In the past we have always maintained a list of changes in the app, which get written to the DataStore when the object is persisted.</P>
<P>I am currently considdering an intermediate library (myCSLA) with&nbsp;public classes that inherit from CSLA.&nbsp; Apps will then inherit from myCSLA.&nbsp; At this point, the only class that will do anything meaningfull is myBusinessBase.&nbsp; It will include the following code (or something like it).&nbsp; Then in the DP_Update we would persist the list to the DataStore.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Structure</FONT><FONT size=2> AuditLog</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> PropertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> SavedValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> CurrentValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Structure</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mAudit </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> List(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> AuditLog)</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> SetProperty(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> PropertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByRef</FONT><FONT size=2> OldValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> NewValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)</P></FONT><FONT color=#0000ff size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.IsNew </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Exit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> OldValue.Equals(NewValue) </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Exit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P>
<P></FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> blnExists </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> itm </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> AuditLog </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> mAudit</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> itm.PropertyName = PropertyName </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blnExists = </FONT><FONT color=#0000ff size=2>True</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> itm.SavedValue.Equals(NewValue) </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mAudit.Remove(itm)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else</P></FONT><FONT size=2>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itm.CurrentValue = NewValue</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>For</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Next</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> blnExists </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> itm </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> AuditLog</P>
<P>&nbsp;&nbsp;&nbsp;itm.PropertyName = PropertyName</P>
<P>&nbsp;&nbsp;&nbsp;itm.SavedValue = OldValue</P>
<P>&nbsp;&nbsp;&nbsp;itm.CurrentValue = NewValue</P>
<P>&nbsp;&nbsp;&nbsp;mAudit.Add(itm)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P>OldValue = NewValue</P>
<P>PropertyHasChanged(PropertyName)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 13, 2006</h2>No problem, just needed to know what you were really seeking suggestions on.<br><br>If you have a database which supports stored procedures or triggers, those are your best bet.&nbsp; You don't need to do anything in the objects to create an audit history.&nbsp; You can also add auditing to an existing database without worrying about breaking your application in some cases.<br><br>You likely would need some BOs that can read an intereprate that audit trail, but thats a seperate use case, so i wouldn't put any code in your existing BOs.&nbsp; <br><br>Now if your db doesn't support stored procedures or triggers,&nbsp; you may have to have your BOs create the audit trail.&nbsp; But this should be handled by a BO who's only job it is to create the audit trail, if possible.<br><br>HTH<br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
