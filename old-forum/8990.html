<html><header><title>CSLA 4 Object Authorizations</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4 Object Authorizations</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8990.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash posted on Tuesday, May 25, 2010</h2><p>Rocky,</p>
<p>I am working on my authorization logic for my project with CSLA 4 (fresh beta 2 bits downloaded this morning).&nbsp; The authorization framework is a (more or less) a claims-based framework.&nbsp; A CRUD operation may be authorized based upon a combination of items.&nbsp; Most of these items are drawn from database tables based on user identity but some are based upon the current context. Moving from one part of the object hierarchy to another turns things on and off.</p>
<p>My original cut at working through all of this was to create a single authorization object that was aware of all of this complexity.&nbsp; This has not worked because the context passed into the rule does not specify the type that triggered the rule execution. My common rule cannot figure out the type of the object that is to be authorized.</p>
<p>The framework knows the type and uses it to look up the rules for the type.&nbsp; My request is that the triggering type be passed in as part of the context.&nbsp; That way I could use a single object that could be type sensitive.</p>
<p>If I have understood what is going on, without this change, I would have to create four different rule objects per type (CRUD).&nbsp; I could obviously include a reference in each of these objects to a common object that would do all of the heavy lifting.&nbsp; Composition and delegation are your friends!&nbsp; But it would be more elegant in my mind to have the framework let the rule in on all of the details of the rule invocation, including the object type.</p>
<p>Any possibility that such a thing could be done?&nbsp; Or perhaps a learned explanation of why my brain. after 10 hours banging away at this, is fried and should be re-booted?</p>
<p>Jon Stonecash</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, May 25, 2010</h2><p>That is an oversight on my part - I totally agree that the type should be provided via the context - I&#39;m surprised I didn&#39;t do that - I&#39;ll add that value in the next release.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Tuesday, May 25, 2010</h2><p>Rocky,</p>
<p>Thanks!&nbsp; Just to clarify things, I am looking at the CanRead, CanEdit, etc. functionality.&nbsp; Although I have not gotten to it yet, I am assuming that the rules for properties and methods will pass the target object from which I can derive the type.</p>
<p>Jon Stonecash</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 25, 2010</h2><p>The context already had a Target property, which is set to the actual business object whenever possible. So per-property rules get that, and per-type rules <em>might</em> get that value (like for update scenarios), but sometimes it just isn&#39;t available (like with cancreate scenarios).</p>
<p>The context will now have TargetType as a property, which will always be set to the type of the business class/object - this will be true for per-type and per-property rules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Wednesday, May 26, 2010</h2><p>Thank you for that.</p>
<p>I spent some time digging into the CSLA code related to authorization.&nbsp; I am confused by a couple of things.&nbsp; Each rule must implement IAuthorizationRule.&nbsp; This means that the rule must have properties for the Element and the Action.&nbsp; Each time that the rule must be applied, Csla uses the object type to find the AuthorizationManager for that type.&nbsp; The AuthorizationManager, in turn, uses the element and action to find the relevant rule within that object type.&nbsp; It then constructs a context that includes the element and the action and passes that to the Execute method.</p>
<p>But, isn&#39;t it the case that CSLA is telling the rule two things that the rule already knows?&nbsp; There does not seem to be a scenario in which the rule would be invoked for a different action or different element.&nbsp; Am I missing something important here?</p>
<p>Jon Stonecash</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 26, 2010</h2><p>I&#39;m not sure I follow you. The AuthorizationContext has Target, TargetType and HasPermission properties. It does not include the element or action, because those are already part of the rule.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Wednesday, May 26, 2010</h2><p>My bad.&nbsp; I said I was confused.&nbsp; Boy, was I confused.&nbsp; </p>
<p>In any case, I have my object and property authorization logic working.&nbsp; Just starting on the method authorization, which should be a fairly simple variation on the property authorization.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
