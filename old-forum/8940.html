<html><header><title>Please I need help with Authorization Rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Please I need help with Authorization Rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8940.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>coommark posted on Sunday, May 16, 2010</h2><p>In the sample applications such as ProjectTracker, authorization rules are applied to roles that are created in code such as Administrator and&nbsp;ProjectManager. My question is, what about a situation where the programmer doesnt know the roles&nbsp;a customer may choose to create and use? For instance&nbsp;a customer customer may choose to create a sub-admin role, which able to perform some, but not all of the&nbsp;activities assigned to a typical Power&nbsp;User (Admin), in such a case, what happens?</p>
<p>Is it not possible for one to&nbsp;pull out authorization roles from a database, and apply them as appropriete?</p>
<p>Please&nbsp;some sample code may really help. Or if there is any such implementation out there, pls help point me to it. </p>
<p>Thank you in advance.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, May 16, 2010</h2><p>Yes, you can load the roles from the database. Honestly I think that is way over-complicated and is just asking for trouble, but it is absolutely possible.</p>
<p>What you need is a ReadOnlyBase object that gets the roles for a business object. Basically, you need to create an object model that represents your authorization metadata - roles, properties, etc.</p>
<p>Then in your AddAuthorizationRules() method, get this read-only metadata object as normal (so it uses the data portal) and use the metadata to add the rules to your business object.</p>
<p>AddAuthorizationRules() is called one time per AppDomain per business object type, so you&#39;ll only be retrieving the metadata for a given business object type one time (twice if you have a 3-tier deployment - once on the client, once on the server). So this is generally pretty efficient.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>coommark replied on Sunday, May 16, 2010</h2><p>Wow! Thanks Mr. Lhotka for replying this! Its great to have you yourself reply. I must say your Framework rocks! Its just perfect for our next project, which is a Microfinance Management application. We particularly love the Authentication and authorization components, and the idea of mobile objects. Thanks a million. </p>
<p>I have been thinking about it, and i agree with your opinion that loading it from the database with be quiet complicated. I do not understand well your solution above. Maybe as we make progress in understanding the framework, we will understand more. What I think we will do is maybe add different roles to every business object, such as such as to Customer BO, we could add roles like EditCustomer, AddCustomer, DeleteCustomer, etc, instead of using a more generic role such as Administrator. That way, we can take each individual user&nbsp; of the system and assign her these roles as appropriete. </p>
<p>It will mean a little more work when it comes to assigning roles to users, but other great software such as Microsoft Dynamics NAV does the same. We can live with that until we know more... Or we can create another table that goups individual roles into RoleGroups, e.g. Cashiers, CustomerOfficers, etc?</p>
<p>Thank you for taking the time to reply. Atleast we are able to understand from the onset that it will be complicated to load roles from a DB, as such we will avoid that approach and stick to the samples available. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, May 17, 2010</h2><p>You mgiht also find this blog post to be useful</p>
<p><a href="http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx">http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx</a></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Tuesday, May 18, 2010</h2><p>Hi,</p>
<p>I think the confusion starts when the term &#39;role&#39; is used as synonym for &#39;permission&#39;. Unfortunatly the MS security model (IIdentity and IPrincipal) and derived models enhance this misunderstanding.</p>
<p>Here&#39;s what we do:<br />Permissions are defined by us, as we develop the code and the app at all. So, it&#39;s our concern to ask whether someone has&nbsp;a certain permission to do something. Our customers define the users and give them certain permissions directly and/or assign them to roles, which can be defined by the customers, too. And not only defined, but also fitted with certain permissions. So we have USER, ROLE and PERMISSION as core-objects and assignment objects (USER-PERMISSION, USER-ROLE, ROLE-PERMISSION). We use CSLA for the User/Permission-management and authentification/authorization as well and it works fine.<br />Indeed we made it a little more complex by adding DIVISION (sub-organisation), forbidding permissions&nbsp;and inherited permissions (EDIT-Permission inherits from VIEW-Permission...), but all works fine.<br />Key for that was to divide the concerns of the classes that handle authorization/authentification from those that deal with user/permission-management.</p>
<p>Only our way, no golden rule, but it works fine with CSLA and customers are pleased.</p>
<p>Don&#39;t hesitate to ask, if any question</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>coommark replied on Wednesday, May 19, 2010</h2><p>Thank you very much, vschaak. </p>
<p>I agree with you on the inappropriate use of &quot;role&quot; as synonymous&nbsp;to &quot;permission&quot;. I am new to CSLA, and in the past every app we&#39;d worked on used Role-Based permissions. This means there are users, who are assigned&nbsp; toroles, and roles assigned persmisions. So i&nbsp;am thinking that CSLA handles authorization in the sense of permissions, not roles. That is not to say i&#39;m suggesting CSLA is doing something wrong, just that its how it handles authorization.</p>
<p>Now to ask you.&nbsp;was it easy for you to add roles to CSLA? Did it involve&nbsp;extending certain classes in the framework?&nbsp;My desire was to create permisions, allow the customer to create roles with common permissions, and assign users to those roles. How were you able to achieve that?</p>
<p>Pardon my english. Its second language to me. Hope you understand. Thanks. Waiting...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Wednesday, May 19, 2010</h2><p>Hi,</p>
<p>no need to excuse for beeing no native english speaker. This applies to me too, as I &#39;m german<img src="http://forums.lhotka.net/emoticons/emotion-5.gif" alt="Wink" /></p>
<p>As said, dividing the business cases of authentification/authorization on the one hand and the management of Users, Roles and Permissions on the other was the key. <br />The first case handles what&#39;s need to verify a users account/credentials and to tell the app he(or she)&nbsp;logs in, whether he has certain permissions. Roles don&#39;t come in here, since you don&#39;t want to know if he is in the role &#39;poweruser&#39;, but if he has the permission &quot;saveThis&quot; or &quot;DoThat&quot; (which may be assigned to that role, but more on that later). All data about that is stored in DB and retrieved from there. So there is a sproc that retrieves a list of all the permissions that are effectivly assigned to a user (directly and through assigned roles). This list is put into the roles of a&nbsp;CSLAIdentity-object. So we put permissions into what&#39;s called &#39;roles&#39;. This is the only place to twist the framework (at least a little), but as this stays internal, not that bad.</p>
<p>Another story, but simple&nbsp;is the assignment etc. of all that stuff. This is quite similar to PTracker since it has root objects and children. Just look at users, roles and permissions as regular business objects. OK, they are used to have immidiate effect on authorization/authentification, but THESE are not made to fullfill those tasks, since that is handled by the objects mentioned above.</p>
<p>So we have two &#39;User&#39; objects:<br />a) used to authentify and authorize a login and for changing a password by the logged in user itself (inheriting from CSLAIdentity)<br />and <br />b) which is responsible for editing users and all that in an admin&#39;s management-app. This one handles User &lt;-&gt; Roles assignment, which is written to the DB (and retrieved by a)). A very nice effect of that is, that admins can easily figure out, not only &quot;What are the roles, that are assigned to Mr.X?&quot;, but also &quot;Which users are assigned to role Y?&quot; or &quot;Which roles are assigned to permission Z?&quot;</p>
<p>I hope I made my points clear? (If not, just question)</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>coommark replied on Thursday, May 20, 2010</h2><p>Hi Volker,</p>
<p>Thank you for the indepth explanation. Didnt have time to try it out, so couldnt reply you.<em>&nbsp; </em>I will try it out tonight however, and get back to you if i am able to implement it as you did.</p>
<p>Once again, thanks.</p>
<p>Mark</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
