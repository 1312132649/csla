<html><header><title>UndoChangesComplete causing an additional Begin Edit....</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>UndoChangesComplete causing an additional Begin Edit....</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3719.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CSLABound posted on Monday, October 15, 2007</h2><P>I have a business base class (Incident)&nbsp;that has some attributes as well as child business base lists.&nbsp; After binding the Incident class to the windows form, I run into the following issue.... </P>
<P>If someone edits one of the child lists and cancels, it sets the _bindingEdit to false even though the stateStack is not 0 and my parent object is still bound.</P>
<P>is there a way to change UndoChangesComplete to check if the canceledit() call isn't removing the entire stack, and avoid setting _bindingEdit to false w<FONT size=2>ithout messing up the framework?</FONT></P>
<P><FONT size=2>Brian</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CSLABound replied on Monday, October 15, 2007</h2><P>This was the change I made to Business Base method UndoChangesComplete, and all my tests seem to point to it working:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> UndoChangesComplete()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>base</FONT><FONT size=2>.EditLevel &lt; 1) //changed</P>
<P>{ _bindingEdit = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>; }//changed</P>
<P>ValidationRules.SetTarget(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);</P>
<P>AddBusinessRules();</P>
<P>OnUnknownPropertyChanged();</P>
<P></FONT><FONT color=#0000ff size=2>base</FONT><FONT size=2>.UndoChangesComplete();</P>
<P>}</P>
<P><FONT size=3>It sems to do the trick.&nbsp; If someone sees something that would cause an issue, please post.&nbsp; </FONT></P>
<P><FONT size=3>Thanks,</FONT></P>
<P><FONT size=3>Brian</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 16, 2007</h2>I'd be careful here.&nbsp; The reason BeginEdit is called again is because Windows databinding calls CancelEdit immediately followed by BeginEdit again.&nbsp; There's no way to stop that behavior (short of unbinding the object), its by design.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CSLABound replied on Tuesday, October 16, 2007</h2><P>The reason I see it occur in my code is that I explicitly call a CancelEdit because the user is wanting to undo an insert into one of the child lists.&nbsp; Because of this undo, a call gets made to UndoChangesComplete, and the _bindingEdit gets set to false, and when we go back to the main screen the parent object appears to rebind, causing the stack&nbsp;count to jump to 2 instead of 1, and the save fails when the user hits the save button because the object is still being edited.&nbsp; This was the only fix I could see that appeared correct.&nbsp; If the stack of the base parent is at least 1, it's already been bound so I don't want any rebind by .NET to cause the edit level to change.</P>
<P>Would it be better to unbind and rebind the object?&nbsp;</P>
<P>Brian</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 16, 2007</h2>Well what version of Csla are you using?&nbsp; There's been some important fixes, so if you're not on 3.0.2, you may want to consider upgrading to see if that resolves the issue.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
