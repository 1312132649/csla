<html><header><title>Csla.Data.DataMapper.Map &amp; CanWriteProperty</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csla.Data.DataMapper.Map &amp; CanWriteProperty</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4343.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoOfMetL posted on Wednesday, February 13, 2008</h2><br>Hello, <br> <br> In the method "Map", I propose to call CanWriteProperty to verify that the user can change the value.<br><br>public static void Map(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Collections.IDictionary source, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object target, bool suppressExceptions, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; params string[] ignoreList)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; ignore = new List&lt;string&gt;(ignoreList);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> Csla.Core.BusinessBase b = target as Csla.Core.BusinessBase;</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (string propertyName in source.Keys)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!ignore.Contains(propertyName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>if (b == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPropertyValue(target, propertyName, source[propertyName]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (b.CanWriteProperty(propertyName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPropertyValue(target, propertyName, source[propertyName]);&nbsp;&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!suppressExceptions)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new ArgumentException(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String.Format("{0} ({1})", <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Resources.PropertyCopyFailed, propertyName), ex);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, February 13, 2008</h2>Any reason why?&nbsp; Seems to me that would silently hide an error if CanWriteProperty returned false, and you would be left wondering why the field didn't map.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoOfMetL replied on Thursday, February 14, 2008</h2><br>&nbsp;Because, in my website, I have a page which allow to update data.<br>A user can update all the properties, and a another can update only 1 property, but he can see all the properties. So I disabled the property that he can't update (enabled = false).<br><br>But it's the same Code, in DataSource_Update Event, I use the 'Map" Method to update the data of my object. So I have a exception, because the map method want to push my property(wich have enabled = false) <br><br>So I have modify the code of the Map Method.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
