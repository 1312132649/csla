<html><header><title>couple of times Undo cause System.OutOfMemoryException</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>couple of times Undo cause System.OutOfMemoryException</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6539.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>fudongma posted on Monday, March 02, 2009</h2><P>Our Windows application is using n-level undo functionality of CSLA.NET 2.0. I have lots of unused harddisk space,&nbsp;and the memory is 2GB. I only&nbsp;opened Window Outlook 2007 and our windows application on my machine. Afer small amount of changes, I can successfully undo. However, if I did lots of changes and then undo, I got exception error as followings:</P>
<P class=MsoNormal><SPAN>Exception Information<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>=====================<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.IO.MemoryStream.set_Capacity(Int32 value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.IO.MemoryStream.EnsureCapacity(Int32 value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.IO.MemoryStream.WriteByte(Byte value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.IO.BinaryWriter.Write(Byte value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.__BinaryWriter.WriteObject(NameInfo nameInfo, NameInfo typeNameInfo, Int32 numMembers, String[] memberNames, Type[] memberTypes, WriteObjectInfo[] memberObjectInfos)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Write(WriteObjectInfo objectInfo, NameInfo memberNameInfo, NameInfo typeNameInfo, String[] memberNames, Type[] memberTypes, Object[] memberData, WriteObjectInfo[] memberObjectInfos)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Write(WriteObjectInfo objectInfo, NameInfo memberNameInfo, NameInfo typeNameInfo)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Serialize(Object graph, Header[] inHeaders, __BinaryWriter serWriter, Boolean fCheck)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream serializationStream, Object graph, Header[] headers, Boolean fCheck)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream serializationStream, Object graph)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at Csla.Core.UndoableBase.CopyState()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at Csla.BusinessListBase`2.CopyState()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at Csla.BusinessListBase`2.Csla.Core.IUndoableObject.CopyState()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at Csla.Core.UndoableBase.CopyState()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>&nbsp;&nbsp; at Csla.Core.BusinessBase.BeginEdit()<o:p></o:p></SPAN></P>
<P><SPAN>&nbsp;&nbsp; at Win.UI.frmProfileMDIParent.UndoChanges(Boolean supressQuestion, Boolean closingParen)</SPAN></P>
<P>Can anybody help??</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv replied on Monday, March 02, 2009</h2>Check your code.&nbsp; You may have a reference back to a parent object that is not marked as notundoable.&nbsp; This will cause a circular ref.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dheerajv replied on Thursday, August 13, 2009</h2><P>hi,</P>
<P>&nbsp;&nbsp;&nbsp;i am facing the same problem. i have checked the parent refrence but there is no such issue Please reply if you have any other idea.</P>
<P>Regards,</P>
<P>Dheeraj</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 13, 2009</h2><P>How big is your object graph?</P>
<P>The exception is being thrown by the .NET serializer, so either you have some sort of circular reference, or your object graph must be massively huge.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Monday, October 12, 2009</h2>Hi,<br /><br />i'm having the same problem.<br /><br />What can i do to solve this problem?<br /><br />Nuno Alves</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 12, 2009</h2>The most common issue is to have a circular reference in your object graph<br />(like a child referencing a parent - directly or indirectly). The solution<br />in that case is to add the NotUndoable attribute to the parent reference (or<br />equivalent) to break the circular reference.<br /><br /><br />-----Original Message-----<br />From: nuno.s.alves [mailto:cslanet@lhotka.net] <br />Sent: Monday, October 12, 2009 10:33 AM<br />To: rocky@lhotka.net<br />Subject: Re: [CSLA .NET] couple of times Undo cause<br />System.OutOfMemoryException<br /><br />Hi,<br /><br />i'm having the same problem.<br /><br />What can i do to solve this problem?<br /><br />Nuno Alves<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>Hi,<br /><br />i can't understand what you are saying.<br />Let me show you my scenario.<br /><br />I have an object with multiple objects and some properties. When i load the object, sometimes my application return all the properties, when i try it again, the error comes up.<br /><br />I can't say when it happens.<br /><br />May you tell me where can i set this attribute?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 13, 2009</h2><P>There are only a couple possibilities.</P>
<P>One is that your object graph is HUGE. Either many, many thousands of objects, or the objects contain very large data elements (really big strings, image data, etc).</P>
<P>The other is that you have objects that reference each other in a circular manner. This is the most common type of problem. For example, you might have a Person object that contains a collection of Address objects, and one of the Address objects references the Person object. That's a circular reference.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>thanks,<br /><br />i didn't see your message.<br /><br />Nuno Alves</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>Ok,<br /><br />i understand now what you mean.<br /><br />But i don't have a circular reference. I only have an object with 5 objects. These are simple references.<br /><br />One of the objects is a list of files and it's here where i can't understand because sometimes the application can load the object. When the error comes up, if i restart the application, i can load the object again.<br /><br />Every time that the error comes up, i must restart the application to load the object.<br />After restart, it works again until the error comes up again.<br /><br />I can't say when it happens because sometimes the object with the files is empty and the error comes up anyway.<br /><br />What is the maximum size for an object?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 13, 2009</h2><P>When you say "list of files" you mean a list of filenames (string values) or something else?</P>
<P>Many system-level objects, like file handles, aren't serializable and can cause all sorts of nasty issues.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>Well,<br /><br />when i say list of files, i want to say list of documents, that each document has 1 MB and the list has 10 documents.<br /><br />But i don't know if this is important, because some objects have any documents and the error comes up anyway.<br /><br />Nuno Alves</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>ok,<br /><br />maybe i already know what is happening.<br /><br />I start my application and open a process that shows me data from database. This object returns a list of documents. <br /><br />For the first process it's all ok, but when i try to open another one, with documents the error comes up, because all memory (RAM) is full ! So i restart the application and i can open the process.<br /><br />It's all about the documents.<br /><br />Thanks, Nuno Alves</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nuno.s.alves replied on Tuesday, October 13, 2009</h2>Hi again,<br /><br />thanks for your replay.<br /><br />Let me show you my scenario.<br /><br />I have an object with multiple objects and some properties. Sometimes i can load the object but if i try it again, the error comes up.<br /><br />I can't say when it happens, because sometimes it doesn't happen.<br /><br />May you tell me where can i add the NotUndoable attribute? or some page where i can see an example like mine?<br /><br />Thanks, Nuno Alves</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
