<html><header><title>Exception emailing</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Exception emailing</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4096.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Friday, December 28, 2007</h2>Hi,<br><br>I recently switched to a three tier setup.&nbsp; Previously, the client would catch any unhandled exceptions and show a generic error box, as well as email me the exception details.&nbsp; Now, if an exception occurs on the application server, I get an email which simply states that the byte stream is not in the expected format.&nbsp; Not so helpful.<br><br>My original idea is to override DataPortal_OnDataPortalException and just email there.&nbsp; This works, but sometimes exceptions are raised because of an event in the database, which I handle by displaying a custom message to the user.&nbsp; For example, if someone saves an invoice, and another user has edited the invoice an attempts to save, I raise an error in the stored procedure, which the BO will catch and rethrown as a custom exception.&nbsp; The UI catches this and displays the appropriate message.<br><br>The problem is that in that case I am now getting emails for these "routine" exceptions.&nbsp; I'm hoping there's a way to weed these out.. any ideas?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, December 28, 2007</h2><P><FONT face=Tahoma size=2>I'm assuming that you don't want to take your concurrency checks and move them out of your SP's - because if you did that, you could simply throw a custom exception and catch that appropriately.&nbsp; But you knew that.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P>
<P><FONT face=Tahoma size=2>About the only thing I can think of is some parsing of the exception message.&nbsp; It's a little funky, but it's about all I can think of to do.&nbsp; </FONT><FONT face=Tahoma size=2>If you're using VB.NET, you could add "When" clauses to your Catch statements.&nbsp; Those could examine the text of the SqlException you're catching, and as long as you&nbsp;provide appropriately-constructed error text in your SP's, it would work.&nbsp; </FONT><FONT face=Tahoma size=2>If you're using C#, then you'll have to code that on your own, using a series of if/switch blocks within your "catch" blocks.</FONT></P>
<P><FONT face=Tahoma size=2>Another option&nbsp;would be&nbsp;checking the "Number" property of the SqlException - I think if you provide an error number in your RAISERROR call, that ends up in the "Number" property.&nbsp; It's just a different form of parsing, but parsing by numbers feels a little better than string parsing (and it would be faster, too).&nbsp; But it's the same basic concept.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 28, 2007</h2>Well, if i move the check out, then its possible that I blow away someone else's changes.. so that's not an option. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>Hmm... those parsing ideas aren't bad.&nbsp; I'll have to check out the number; i know there are some parts of the raiserror that are for user use.. so anything like system assigned should be bubbled.<br><br>Thanks!<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, December 28, 2007</h2><P><FONT face=Tahoma size=2>I know that RAISERROR requires that any error # you provide has to be over 50,000, and if you don't specify a number, it will default to 50,000.&nbsp; However, the kicker to using a message ID is that it's essentially considered a user-defined system message, which means you'd have to add it to the "sys.messages"&nbsp;catalog view&nbsp;using the "sp_addmessage" system SP.&nbsp; Don't know whether you want to go through that kind of effort.&nbsp; </FONT><FONT face=Tahoma size=2>If you provide message text instead, the error # is always 5000.</FONT></P>
<P><FONT face=Tahoma size=2>(While this is a little confusing in relation to the earlier statement (at least it was to me), I believe that what this means is that if you provide some error text, the error # is 5000.&nbsp; If you provide an error number, it better be &gt; 50,000, and it better match something in the "sys.messages" catalog view.&nbsp; If you provide neither a number nor text, the error # is 50,000.)</FONT></P>
<P><FONT face=Tahoma size=2>I thought you might be able to use the "State" parameter of RAISERROR - there is a "State" property on the SqlException - but I can't tell from the docs whether those match up or not.&nbsp; It's not exactly what you're supposed to use "State" for, but...</FONT></P>
<P><FONT face=Tahoma size=2>You'll probably end up having to do some testing to see what you can get from a RAISERROR.&nbsp; You might be forced to use text parsing.&nbsp; But look at it this way: you're planning on wrapping the error in a custom exception, so your exception text can be pretty much anything you want.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
