<html><header><title>New to CSLA - A few questions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>New to CSLA - A few questions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/405.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana posted on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>I just started reading the book and attempting to use CSLA. Firstly, I must say it seems to be a great framework. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /> Just trying to follow along with the book without getting too confused.</P>
<P>&nbsp;</P>
<P>I have a few questions that I would like clarification on if possible.</P>
<P>&nbsp;</P>
<P>Firstly, with authentication and authorization, along with using ASP.NET for the web interface. I want to be able to have both a Windows forms interface and a web interface, so I don't want the implementation to be specific to the web.</P>
<P>&nbsp;</P>
<P>It spoke a bit about this in the book, in chapter 10 I believe, but it was a bit confusing and I was hoping for a bit more of an explanation.</P>
<P>&nbsp;</P>
<P>Let's say I have a custom identity and principal, similar to that in the code examples. Let's also say I have a custom provider for forms authentication and membership in ASP.NET. How can I tie these two together, without making the identity and principal tied too closely or too specific to&nbsp;the web interface?</P>
<P>&nbsp;</P>
<P>Second question:</P>
<P>&nbsp;</P>
<P>More a matter of design. Let's say I have a list of categories and products. Products have a many to many relationship with the categories, but categories are also related to other categories, where one category may have several children categories.</P>
<P>&nbsp;</P>
<P>The only way I could think of to solve the above would be using a switchable kind of class, where it is either a parent or a child. There obviously has to be at least one category with no parent. Further, say I'm on a page where the category ID was passed, I'd just want to fetch that particular category, along with its products.</P>
<P>&nbsp;</P>
<P>However, the only thing is it'd be nice to retrieve the category's immediate parent, but I'm not sure how I'd go about doing this.</P>
<P>&nbsp;</P>
<P>Any help is much appreciated.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>If you set your dataportal up as a webservice, then set the asp membership &amp; role provider for the site where the portal is located to point back to your main websites asp membership database, you can do the following in the DataPortal_Fetch method of your custom Identity:<br><pre><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Membership.ValidateUser(criteria.Username, criteria.Password))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _name = criteria.Username;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _isAuthenticated = true;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _roles = new List&lt;string&gt;(Roles.GetRolesForUser(_name));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br></pre><br><br><br>This should work since the code is being executed in the context of the dataportal (which is a website).<br>Thus, all your clients can use aspnet's membership &amp; roles, regardless of platform.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>thanks for the reply. I'm still trying to figure out exactly how it was done in the book. It seems the most flexible way really.</P>
<P>&nbsp;</P>
<P>Also, any comments about the categories issue?</P>
<P>&nbsp;</P>
<P>Thanks again. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>OK, this isn't actually implemented in the PTWeb project, but it is talked about in the book I think somewhere around page 537.</P>
<P>&nbsp;</P>
<P>So, it looks like using this method, there would actually be two principals? One that wraps IPrincipal, and one that is called by the membership provider, which is the one in the project library itself. Would this be correct?&nbsp;&nbsp;&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 19, 2006</h2><P>Yes, exactly. You just create a custom principal that inherits from BusinessPrincipalBase, which delegates all its work to an underlying principal object that you obtain from the membership provider. Your custom principal's code isn't complex then, since IPrincipal only defines two members, and they both delegate to the underlying principal. Something like this:</P>
<P>&lt;Serializable()&gt; _<BR>Public Class MyPrincipal<BR>&nbsp; Private mMembershipPrincipal As IPrincipal<BR><BR>&nbsp; Public Sub New(membershipPrincipal As IPrincipal)<BR>&nbsp;&nbsp;&nbsp; mMembershipPrincipal = membershipPrincipal<BR>&nbsp; End Sub<BR><BR>&nbsp; Public Overrides Function IsInRole(role As String) As Boolean<BR>&nbsp;&nbsp;&nbsp; Return mMembershipPrincipal.IsInRole(role)<BR>&nbsp; End Function<BR><BR>&nbsp; Public Overrides ReadOnly Property Identity() As IIdentity<BR>&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mMembershipPrincipal.Identity<BR>&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp; End Property<BR><BR>End Class</P>
<P>This may not be perfectly right, but it is close anyway. Then you follow the basic pattern in the book, where in global.asax and login.aspx,&nbsp;AFTER the user's identity has been determined by the membership service, you set the principal object to this object - passing the previous principal into the constructor.</P>
<P>The only real reason for wrapping the principal from membership services is so your principal can flow through the data portal. Note that this technique ONLY works if the original principal/identity objects are serializable - which the membership ones are (or were when I tested this while writing the book).</P>
<P>But what this means is that if your data portal is running in local mode then you don't need to worry about this at all, because the data portal would run in the "client" context and automatically has the same security. This is only important if you configure the data portal to be remote.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>Ah, thanks for replying.</P>
<P>&nbsp;</P>
<P>True, it only needs to be used when it'll use DataPortal remotely, but if it&nbsp;ever needs to be used like that, I really don't want to have to change any code. I want to make it as simple as possible.</P>
<P>&nbsp;</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div></P>
<P>Yes, exactly. You just create a custom principal that inherits from BusinessPrincipalBase, which delegates all its work to an underlying principal object that you obtain from the membership provider. Your custom principal's code isn't complex then, since IPrincipal only defines two members, and they both delegate to the underlying principal. Something like this:</P>
<P>&lt;Serializable()&gt; _<BR>Public Class MyPrincipal<BR>&nbsp; Private mMembershipPrincipal As IPrincipal<BR><BR>&nbsp; Public Sub New(membershipPrincipal As IPrincipal)<BR>&nbsp;&nbsp;&nbsp; mMembershipPrincipal = membershipPrincipal<BR>&nbsp; End Sub<BR><BR>&nbsp; Public Overrides Function IsInRole(role As String) As Boolean<BR>&nbsp;&nbsp;&nbsp; Return mMembershipPrincipal.IsInRole(role)<BR>&nbsp; End Function<BR><BR>&nbsp; Public Overrides ReadOnly Property Identity() As IIdentity<BR>&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mMembershipPrincipal.Identity<BR>&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp; End Property<BR><BR>End Class</P>
<P>This may not be perfectly right, but it is close anyway. Then you follow the basic pattern in the book, where in global.asax and login.aspx,&nbsp;AFTER the user's identity has been determined by the membership service, you set the principal object to this object - passing the previous principal into the constructor.</P>
<P>The only real reason for wrapping the principal from membership services is so your principal can flow through the data portal. Note that this technique ONLY works if the original principal/identity objects are serializable - which the membership ones are (or were when I tested this while writing the book).</P>
<P>But what this means is that if your data portal is running in local mode then you don't need to worry about this at all, because the data portal would run in the "client" context and automatically has the same security. This is only important if you configure the data portal to be remote.</P></div></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>&nbsp;If implemented per page 537 (which is alot better than I have previously described) there is technically 2, one in the ASP context and one in the Csla application context.&nbsp; The Csla one wraps the ASP one.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>In the book, Rocky uses "hand-rolled" UserName and Role tables to store user information.&nbsp; If you did the same thing, you'd have to keep your aspnet membership database sync'd with your custom membership database.&nbsp; You could also write a custom membership and role provider for ASP that pulled authentication info from your customer tables, but I've found ASP's authentication model and supporting API quite complete.<br><br>re: Categories<br>Have you thought about doing something along the lines of;<br>Categories(ReadOnlyRoot)<br>+---&gt;RelatedCategories(ReadOnlyChildList)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---&gt;RelatedCategories(ReadOnlyChild)&nbsp; (where this is derived from your associative/fact table)?<br>+---&gt;RelatedProducts(ReadOnlyChildList)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---&gt;RelatedProducts (derived also from an associative/fact table)<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>On membership:</P>
<P>&nbsp;</P>
<P>The thing about the default membership implementation is firstly, it's hard to extend; to add any additional functionality you have to wrap Membership and add your own methods. Secondly, it complicates the business logic a bit. You can't quite have a Member business object, because there's already MembershipUser, so you can't use the business object class interface you do for other objects.</P>
<P>&nbsp;</P>
<P>On categories:</P>
<P>Are you saying there'd be a RelatedCategories list as child to Category, and a RelatedCategory as child of that list? Still there can be multiple levels of categories. Unless RelatedCategory also has a child RelatedCategories list, but I'm not sure if there is anything wrong in doing that. Also most of the business logic would be duplicated, unless I have some generic Category class that wraps all data access common to both.</P>
<P>&nbsp;</P>
<P>Also, however it is implemented, how could a category retrieve it's parent category? Would it be acceptable to have a _parentID field, and just a method, GetParentcategory(), which could call Category.GetCategory(_parentID);</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>re: Membership<br>Then I think your best solution would be to implement a custom membership &amp; role provider for ASP, instead of using ASP as your membership provider for your CSLA application.<br><br>re: Categories<br>How's your underlying data modeled?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>bcdennis:</strong></div><div>re: Membership<BR>Then I think your best solution would be to implement a custom membership &amp; role provider for ASP, instead of using ASP as your membership provider for your CSLA application.</div></BLOCKQUOTE></P>
<P>I presume you mean a membership provider, while still working within ASP.NET membership so it can use the login controls and such. Admittedly not the easiest way, but I can probably use this from project to project. Code reuse. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>bcdennis:</strong></div><div>re: Categories<BR>How's your underlying data modeled?<BR></div></BLOCKQUOTE></P>
<P>It's not, yet. I'm thinking something like:</P>
<P>CategoryID | ParentID | Name | Description | Image</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>devbanana:</strong></div><div><br>I presume you mean a membership provider, while still working within ASP.NET membership so it can use the login controls and such. Admittedly not the easiest way, but I can probably use this from project to project. Code reuse. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><p></div></BLOCKQUOTE></p><p>The default membership provider for ASP is AspNetSqlMembershipProvider (which itself defaults to attaching a aspnet.mdf database file) and role provider is ASpNetSqlRoleProvider (which also houses its data in aspnet.mdf).&nbsp; You can change this to a custom membership &amp; role provider that sources its data from your own tables which ASP will use for all the Forms Authentication stuff (including login controls.)&nbsp; To view this configuration, go to IIS management console.&nbsp; Right click on your virtual root and select "Properties".&nbsp; On the Service Properties dialog, click on the ASP.NET tab, then click "Edit Configuration".&nbsp; On the ASP.NET Configuration Settings dialog, click on the Authentication tab and you'll find the settings for the Membership Provider&nbsp; and Role Provider (to ASP).&nbsp; You can also manually edit the Web.config file accordingly.&nbsp; <br></p><p><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>devbanana:</strong></div><div><br>
</p><p>It's not, yet. I'm thinking something like:</p>
<p>CategoryID | ParentID | Name | Description | Image</p></div></BLOCKQUOTE><br>Well, I think there's some flaws with this approach.&nbsp; You can't model a many-to-many relationship using that data structure.&nbsp; For one, that model restricts&nbsp; a sub-category to only have one parent, which isn't a many-to-many relationship to begin with.<br>The standard approach to doing many-to-many is something like;<br>Categories (CategoryId, Name, Description, Image)<br>RelatedCategories (ParentId, ChildId)&nbsp; --- where ParentId and ChildId are themselves CategoryIds. (this is called an associative table or fact table.)<br>You could then go;<br>Products (Productid, ...)<br>ProductCategories (ProductId, CategoryId)<br>which would then allow you to derive all the categories that product falls in along with the related categories (from your fact table.)<br><br>Using that approach, a given child category could/would have many "parent" categories.<br>If a Category and a Child Category are logically different things (versus inter-related same things) then you could use a standard parent-child model such as;<br>Categories (CategoryId, Name, Description, Image)<br>ChildCategories (ChildCategoryId, CategoryId (FK), ...)<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>I don't need categories to have a many to many relationship with other categories, just a one to many. Each category has one parent, each category may have no, one, or many children.</P>
<P>&nbsp;</P>
<P>So how would you organize the objects in this situation?</P>
<P>&nbsp;</P>
<P>Thanks again.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>Category(Editable/Readonly Root)<br>&nbsp;+---&gt; Parent<br>&nbsp;+---&gt; ChildCategories(Editable/ReadOnly ChildList)<br>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  +---&gt;CategoryInfo(Editable/ReadOnly Child)&nbsp; (where CategoryInfo is some light-weight Category BO)<br><br>Maybe something like that?<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>The top category, it really wouldn't have a parent, only the child categories. Again, there should be multiple levels of child categories, or at least the option for there to be an unknown number of levels of child categories for each parent category.</P>
<P>&nbsp;</P>
<P>These categories all act the same, just some are children and some are parents.</P>
<P>&nbsp;</P>
<P>If there would be a parent field, would it just contain the ID of its parent, or the actual top category? I would think only the ID, as otherwise you'd have a nice loop of references going, lol.</P>
<P>&nbsp;</P>
<P>Thanks again.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>How about this?</P>
<P>&nbsp;</P>
<P>Category is the root</P>
<P>ChildCategories is under that, and this holds ChildCategory objects</P>
<P>ChildCategories basically has the same definition but also has private string _parentID; and a GetParentCategory method.</P>
<P>&nbsp;</P>
<P>Common behavior is delegated to a GenericCategory class.</P>
<P>&nbsp;</P>
<P>Would this be OK?</P>
<P>&nbsp;</P>
<P>Also, back to membership:</P>
<P>Can IPrincipal be serialized? I see no such attribute in the class definition in MSDN. I'm hoping it can, or that'll immensely complicate things.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcdennis replied on Monday, June 19, 2006</h2>re: Categories<br>Sounds like a good plan.<br><br>re: Membership<br>yeah pretty sure it can be.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>devbanana replied on Monday, June 19, 2006</h2><P>hi,</P>
<P>&nbsp;</P>
<P>Excellent. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P>
<P>&nbsp;</P>
<P>Yes, I hope so. I'll have to test it so I can be sure.</P>
<P>&nbsp;</P>
<P>This is my first project using CSLA, so I'm still ironing out some things.</P>
<P>&nbsp;</P>
<P>By the way, this forum doesn't keep you logged in, even when you check the appropriate box. <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /> Quite annoying.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
