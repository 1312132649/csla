<html><header><title>ReadOnlyListBase Criteria</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ReadOnlyListBase Criteria</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3331.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SergioTorres posted on Sunday, August 05, 2007</h2><P>I am using a ReadOnlyListBase (CSLA 2.1.1.) to fill a datagridview.</P>
<P>My table includes a column Delete_Flag (bit) and I want to be able to choose between retrieving only those rows that have Delete_Flag=False (or the number 0) or retrieving all rows.&nbsp;</P>
<P>I added in my class code the criteria class like this:</P><FONT size=2>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> Criteria<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mCondition </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Condition() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mCondition<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mCondition = Back.booShowDeleteFlag<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT></P>
<P><FONT color=#0000ff size=2>I added a parameter in the class DataPortal_Fetch&nbsp; to the sqlcommand like</FONT></P><FONT color=#0000ff size=2><FONT color=#008000 size=2>
<P>cmd.Parameters.AddWithValue("@Delete_Flag", New Criteria())</P>
<P></FONT></FONT>And when I run my code I receive the following&nbsp;error message:</P>
<P>"DataPortal.Fetch failed (System.ArgumentException: No mapping exists from object type ...cContactList+Criteria to a known managed provider native type."</P>
<P>I'm lost here. What can I do to implement this "selective retrieve".</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Sunday, August 05, 2007</h2><font face="Arial" size="2">Sergio,<br><br>I would suggest taking a look at the ProjectTracker examples, provided with the framework.<br><br>However, the reason the your example fails is because the Criteria class can not be converted to a known SQL data type. Depending on the type of data_portal_fetch that you've used, you would need to the following: <br><font face="Courier New" size="1"><br></font></font><font color="#000000" face="Courier New" size="2">Protected Overrides Sub DataPortal_Fetch(ByVal c As Object)<br><br>&nbsp;&nbsp;&nbsp; --SqlConnection code<br>&nbsp;&nbsp;&nbsp; cmd.Parameters.AddWithValue("@Delete_Flag" , DirectCast(c, </font><font face="Courier New" size="2">Criteria).Condition)</font><font face="Courier New" size="2"><br></font><font color="#000000" face="Arial" size="2"><font face="Courier New" size="2"><br>End Sub</font><br><br>You would normally pass the criteria object to the fetch method, therefore allowing you to determine if the delete_flag is shown within the factory method (doing the new crtieria there); instead of within the data_portal method itself. The other option is to overload the fetch method like the following:<br><br></font><font color="#000000" face="Courier New" size="2">Protected Overloads Sub DataPortal_Fetch(ByVal c As Criteria)<br>
<br>
&nbsp;&nbsp;&nbsp; --SqlConnection code<br>
&nbsp;&nbsp;&nbsp; cmd.Parameters.AddWithValue("@Delete_Flag" , c</font><font face="Courier New" size="2">.Condition)</font><font face="Courier New" size="2"><br></font>
<font color="#000000" face="Courier New" size="2"><br>End Sub</font><font face="Arial" size="2"><br></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
