<html><header><title>Validation rules dependant on other items in collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation rules dependant on other items in collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7293.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 posted on Friday, July 17, 2009</h2>Hi<br /><br />I have a rule which checks for duplicates in the collection. If the Web UI changes another item in the collection so it no longer contains duplicates then the original item still has it's broken rule. How can I reset or remove the original item's broken rule and at what point in the cycle?<br /><br />Many thanks<br />Andrew</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, July 17, 2009</h2>What I have tended to do is make the parent responsible for duplicate broken rule issues with children.<br /><br />Capturing a listchanged (or child changed) event for any given child, I have the parent scan over the collection for duplicates. <br /><br />The parent sets a property on each child through an internal setter - "IsAddressUnique". Each child has a broken rule that basically is broken if IsAddressUnique is false. <br /><br />Chris<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Friday, July 17, 2009</h2>OK, That makes sense I think. I'll give it a go. How do I deal with items being removed. My item may become valid if another is removed but I'm not sure the ListChanged event or ChildChanged event can alert the parent. Those events just fire when properties change don't they?<br /><br />Thanks again<br />Andrew</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, July 17, 2009</h2><P>Nope, you'll get notifications for deletions too. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Friday, July 17, 2009</h2>Hi<br /><br />Add this to my BLB. Fires on property changes but not a remove from collection.<br /><br />        protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />        {<br />            Debug.WriteLine("ChildChanged");<br />}<br /><br />I'm using v3.6.2.0. What am I missing?<br />Thanks<br />Andrew</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, July 17, 2009</h2>I'm guessing the BLB doesn't detect that - a child didn't change in this respect, it did.<br /><br />Try adding your override to the business base containing the business list base. <br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Monday, July 20, 2009</h2>I had a req where a total percentage entered in child objects should be exactly 100, to achieve that I have added helpers in both parent and child objects. <br /><br />Although the normal rule checking triggers the routine and makes the individual obj valid/invalid. <br /><br />But suppose there are 2 child objects in which user entered 40 and 60 percent. later on he went and changed 60 to 55 which made that obj invalid but then he went and changed 40 to 45. At this point, complete collection is valid.<br /><br />So to acheive this, Here is the complete flow on how I made it :-<br /><br />1. After the PropertySetter in child bo, make a call to a Helper which triggers the parent checking routine. here is that method<br /><br />void TriggerAllRulesChk()<br />        {<br />            FabAccETDs _FabAccETDs = this.Parent as FabAccETDs;<br />            if (!_FabAccETDs.XIsEmpty())<br />                _FabAccETDs.ChkRules();<br />        }<br /><br />Parent collection is having following method, this simply loops through all items and re-checks rules<br /><br />internal void ChkRules()<br />        {<br />            foreach (var item in this)<br />	        {<br />                item.ChkRules();        		 <br />	        }<br />                    <br />        }<br />       <br />coming back to the child, bcos ValidationRules.CheckRules() can only be called from within class, I have added this helper..<br /><br />internal void ChkRules()<br />        { ValidationRules.CheckRules(); }<br /> <br />Pls let me know if this helps or if this approach is not good and there is a better option avl..</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Monday, July 20, 2009</h2>Hi Rocky,<br /><br />Even in tracker app, in role checking it will fail to validate without the extra handling mentioned in this post.<br /><br />Kindly advise your comments.<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>j055 replied on Tuesday, July 21, 2009</h2>Hi <br /><br />For my duplicates problem I ended up doing the following, expose BO checkrules: <br /><br />internal void CheckRules() <br />{ <br />ValidationRules.CheckRules(); <br />} <br /><br />Then in BLB: <br /><br />protected override void OnChildChanged(ChildChangedEventArgs e) <br />{ <br />var target = (MyObject) e.ChildObject; <br />CheckChildrenRules(target); <br />base.OnChildChanged(e); <br />} <br /><br />private void CheckChildrenRules(MyObject target) <br />{ <br />foreach (var item in this) <br />if (!(ReferenceEquals(item, target))) <br />item.CheckRules(); <br />} <br /><br />And this in case a removed item makes the BLB valid: <br /><br />protected override void RemoveItem(int index) <br />{ <br />var item = this[index]; <br />base.RemoveItem(index); <br />CheckChildrenRules(item); <br />} <br /><br />I found that setting a child property from within OnChildChanged was dangerous because that in turn fires the ChildChanged event, potentially raising a stack overflow exception. <br /><br />Thanks for all the help. <br />Andrew </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Wednesday, July 29, 2009</h2>What is the recommended approach in this case... Even my method which I mentioned before was not triggering validations if item was deleted from list..<br /><br />PTTracker will also have same issue without this extra handling..<br /><br />After experimenting with other events i.e. childchanged, removingitem etc. I finally found that ListChanged event is triggering the validations when item is removed and that is a easier approach also..<br /><br />I just wanted to know if this is the recommended approach...</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
