<html><header><title>Warning Dialog Before Property Change</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Warning Dialog Before Property Change</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3379.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>josh.kodroff posted on Tuesday, August 14, 2007</h2>I have a property that when changed needs to display the user with a warning message to confirm or cancel the change.&nbsp; In order to present the warning message and allow the user to cancel the change, I removed databinding from the field and took care of getting and setting the BO property manually .<br><br>The problem is that by removing databinding, I also removed the ErrorProvider control's hookup to the validation rules.<br><br>Any ideas on how to get both requirements: <br>1.&nbsp; A warning message before changing a property that can cancel an edit to a property (the properties that need warnings are bound to comboboxes and checkboxes).<br>2.&nbsp; An error provider that reads the broken rules associated with the property.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Tuesday, August 14, 2007</h2>I think it would be better to move all the logic into a customer control (e.g. ComboboxEx and CheckboxEx each extending the base controls). You could then display the visual warning on the appropriate event (avoiding all this removing of bindings etc which always leads to troubles for me). Also, regarding (2), you can always ask your object (which should always be of type MyBusinessBase) for the asociated&nbsp; broken rules by exposing an appropriate public method.<br>I have done something similar (e.g. limiting number of characters types in a textbox, enabling/disabling based on security etc) and it shouldn't be too much trouble.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 14, 2007</h2>This is probably the best approach.&nbsp; Its the UIs responsiblity to warn the user of any adverse consequences of changing a property value, not the business layers.&nbsp; Its also probably best not to remove databinding, but instead cancel the change even before.&nbsp; how you do this depends on your control.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, August 14, 2007</h2><P>Not sure if this needs to be very complicated.&nbsp; We've come up with what I believe to be a relatively simple and flexible solution to this exact problem: we added a PropertyChanging event with the PropertyChangingEventArgs derived from CancelEventArgs.&nbsp; Using the INotifyPropertyChanging interface, UI forms, etc. can register handlers for the event then poll the property being changed, display a confirmation dialog and set the EventArgs.Cancel property accordingly.&nbsp; Within the property, we simply check if e.Cancel == false before updating the property's variable with the new value.&nbsp; Has worked without a problem for us thus far.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick.Roeper replied on Tuesday, August 14, 2007</h2><P>So if you were firing an event from within the business object, and the UI is handling the event, is this one of the situations where serialization fails for a system using remoting? I vaguely remember reading a blog that rocky wrote a little while back that said there was a problem with serialization and events being handled from non-serializable objects (like a form). </P>
<P>I know there was an easy solution like marking the event with [field: NonSerializable] in C#... I dont remember the VB implementation, I just remember it being the majority of the blog post..</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Wednesday, August 15, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>
<P>Using the INotifyPropertyChanging interface, UI forms, etc. can register handlers for the event then poll the property being changed, display a confirmation dialog and set the EventArgs.Cancel property accordingly.&nbsp; </P>
<P></div></BLOCKQUOTE></P>
<P>I guess that works fine as well but isn't that a bit sneaky since you shift UI logic in your BO? I occasionally use some of my BOs to run batch updates (e.g. load customer info from a spreadsheet and call my CustomerEdit object, modify and call Save()) in which case i wouldn't want notifications to come up.<BR>I still think its not too complicated to create a custom control :-)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>McManus replied on Wednesday, August 15, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>triplea:</strong></div><div><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div> 
<P>Using the INotifyPropertyChanging interface, UI forms, etc. can register handlers for the event then poll the property being changed, display a confirmation dialog and set the EventArgs.Cancel property accordingly.&nbsp; </P>
<P></div></BLOCKQUOTE></P>
<P>I guess that works fine as well but isn't that a bit sneaky since you shift UI logic in your BO? I occasionally use some of my BOs to run batch updates (e.g. load customer info from a spreadsheet and call my CustomerEdit object, modify and call Save()) in which case i wouldn't want notifications to come up.<BR>I still think its not too complicated to create a custom control :-)</P>
<P></div></BLOCKQUOTE></P>
<P>Triplea,</P>
<P>We use exactly the same method as SonOfPirate. √çn my opinion you don't shift UI logic into your BO. Showing a confirmation dialog is done in the UI (more precisely in the event handler for the PropertyChangingEvent). The BO only makes it possible to have this functionality in the UI by raising the cancelable&nbsp;event just before the property is changed.</P>
<P>Cheers,<BR>Herman</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, August 15, 2007</h2><P>Yep, McManus has it right.&nbsp; All we are doing is making it possible for the UI to capture what is happening.&nbsp; Nothing in the BO says that anything has to happen or that it has to be in the UI - anything can handle the event and do anything with it that it wants.</P>
<P>As for the question about batch updates, you are correct that firing multiple events is undesirable.&nbsp; I did fail to mention that we make use of the&nbsp;RaisePropertyChangedEvents property in our OnPropertyChanging method to filter when and when not to raise the event.&nbsp; Our thinking is that if you don't want to raise post-change events then you probably don't want to raise pre-change events.&nbsp; But, if that logic breaksdown, you can always add a RaisePropertyChangingEvents property and distinguish between the two.&nbsp; For batch updates, I would think you'd want them both off so this would suffice.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Wednesday, August 15, 2007</h2>OK I think you guys have convinced me that the approach is fine. I guess I stuck similar logic in my user controls since I have CSLA specific controls (e.g. CslaTextbox, CslaCombobox etc) that expect to be databound with an object of type MyBusinessBase and do lots of UI specific work within there. So to keep things consistent in my projects I would refrain from using the events but otherwise I like the approach and might consider it in the future :-)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>josh.kodroff replied on Monday, August 27, 2007</h2>There's a few gotchas in SonOfPirate's solution, which I suspect he left out deliberately because he knew I was a Penn State fan.&nbsp; (j/k)&nbsp; Actually, the solution's not too hard, but a little intimidating if you're inexperienced with custom delegates as I am.<br><br>Here's the code for the complete solution:<br><br>First,. define your interface and args and delegate stuff:<br><br><font face="Courier New" size="2">Public Interface INotifyPropertyChanging<br>&nbsp;&nbsp;&nbsp; Event PropertyChanging As PropertyChangingEventHandler<br>End Interface<br><br>Public Class PropertyChangingEventArgs<br>&nbsp;&nbsp;&nbsp; Inherits System.ComponentModel.CancelEventArgs<br>&nbsp;&nbsp;&nbsp; Private mPropertyName As String<br>&nbsp;&nbsp;&nbsp; Private mProposedValue As Object<br><br>&nbsp;&nbsp;&nbsp; Public Sub New(ByVal propertyName As String, ByVal proposedValue As Object)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mPropertyName = propertyName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mProposedValue = proposedValue<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property PropertyName() As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mPropertyName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property ProposedValue() As Object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mProposedValue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property<br>End Class<br><br>Public Delegate Sub PropertyChangingEventHandler(ByVal sender As Object, ByVal e As PropertyChangingEventArgs)<br><br><font face="Times New Roman" size="3">Then you need to put this stuff in the class that's going to raise the event:</font><br><br>Implements INotifyPropertyChanging<br>&lt;NotUndoable()&gt; &lt;NonSerialized()&gt; Private mNonSerializableHandlers As PropertyChangingEventHandler<br>&nbsp;&nbsp;&nbsp; Private mSerializableHandlers As PropertyChangingEventHandler<br>&nbsp;&nbsp;&nbsp; Public Custom Event PropertyChanging As PropertyChangingEventHandler Implements INotifyPropertyChanging.PropertyChanging<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler(ByVal value As PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Method.IsPublic AndAlso _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (value.Method.DeclaringType.IsSerializable OrElse value.Method.IsStatic) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializableHandlers = DirectCast(System.Delegate.Combine(mSerializableHandlers, value), PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializableHandlers = DirectCast(System.Delegate.Combine(mNonSerializableHandlers, value), PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End AddHandler<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveHandler(ByVal value As PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Method.IsPublic AndAlso _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (value.Method.DeclaringType.IsSerializable OrElse value.Method.IsStatic) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializableHandlers = DirectCast(System.Delegate.Remove(mSerializableHandlers, value), PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializableHandlers = DirectCast(System.Delegate.Remove(mNonSerializableHandlers, value), PropertyChangingEventHandler)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RemoveHandler<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent(ByVal sender As Object, ByVal e As PropertyChangingEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim nonSerializableHandlers As PropertyChangingEventHandler = mNonSerializableHandlers<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If nonSerializableHandlers IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonSerializableHandlers.Invoke(sender, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim serializableHandlers As PropertyChangingEventHandler = mSerializableHandlers<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If serializableHandlers IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; serializableHandlers.Invoke(sender, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RaiseEvent<br>&nbsp;&nbsp;&nbsp; End Event<br><br><font face="Times New Roman" size="3">Finally, to raise the event on the property whose change you need to warn the user on:</font><br><br>Public Property DangerousProperty() As Integer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _dangerousProperty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As Integer)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If _</font><font face="Courier New" size="2">dangerousProperty</font><font face="Courier New" size="2"> &lt;&gt; value Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim e As New PropertyChangingEventArgs("</font><font face="Courier New" size="2">DangerousProperty</font><font face="Courier New" size="2">", value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent PropertyChanging(Me, e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If e.Cancel = False Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _</font><font face="Courier New" size="2">_</font><font face="Courier New" size="2">dangerousProperty</font><font face="Courier New" size="2"> </font><font face="Courier New" size="2">= value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' other effects of property change &nbsp;  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged()<br></font><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font face="Courier New" size="2">End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br>&nbsp;&nbsp;&nbsp; End Property<br></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
