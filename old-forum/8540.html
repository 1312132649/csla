<html><header><title>TransactionScope Timeout</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>TransactionScope Timeout</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8540.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nemisis posted on Tuesday, February 16, 2010</h2><p>Hi everyone, &nbsp;I have some code that runs but it appears to timeout because of the transactionscope surrounding it. &nbsp;Two questions.</p>
<p>1. Can i increase the timeout for that 1 dataportal call only?</p>
<p>2.&nbsp;My business logic is within the dataportal routine, where i retrieve objects, calculate some numbers etc and i add objects to the database. &nbsp;The whole process must complete, that is why i have the transactionscope tag on the dataportal_execute method. &nbsp;I dont really want the retrieves to be within the transaction, for performance reasons, so can i just put the save methods within a transaction?<br /><br />e.g<br /><br />Sub DataPortal_Execute()&nbsp;</p>
<p>&#39; Do some retrieves and calculations here<br /><br />&#39; Create a tranaction<br />&#39; DO SAVES HERE?<br />End Sub&nbsp;</p>
<p>Is this possible?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 16, 2010</h2><p>Yes, switch to Manual transactions on your DP_Execute() method, and then manually create your own TransactionScope object in the method, only around the parts you want protected.</p>
<p>That should solve both problems.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nemisis replied on Wednesday, February 17, 2010</h2><p>Rocky,<br /><br />Thanks, sorry to be a pain though, but how do i switch to manually transactions? &nbsp;Do i simply leave out the transactionScope tag and then write the transaction code? &nbsp;That what you mean? </p>
<p>Sorry if that sounds stupid&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Wednesday, February 17, 2010</h2><p>You&#39;ll change the attribute to be TransactionScope.Manual and then write the transaction code that is required for the whatever database you are using.</p>
<p>I was going to try and post an example, but still can&#39;t get the color formatting correct in my browser.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SethSpearman replied on Monday, December 01, 2014</h2><p>Here is a sample of what is discussed in this post...</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; &lt;Transactional(TransactionalTypes.Manual)&gt; _<br />&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Execute()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim options As TransactionOptions = New TransactionOptions() With {.IsolationLevel = IsolationLevel.ReadCommitted, .Timeout = TimeSpan.FromMinutes(4)}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using ts As New TransactionScope(TransactionScopeOption.Required, options)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New SqlConnection(Database.ApplicationConnection)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Execute(cn)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ts.Complete()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br /><br />&nbsp;&nbsp;&nbsp; End Sub</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, February 17, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>Nemisis<br></b></p>
<p>&nbsp;how do i switch to manually transactions? &nbsp;Do i simply leave out the transactionScope tag and then write the transaction code?&nbsp;</p>
<div style="clear:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p>Hi,</p>
<p>Manual transaction is&nbsp;achieved&nbsp;by either <span style="text-decoration:underline;"><strong>not </strong></span>decorating your&nbsp;<strong><span style="font-family:mceinline;">DataPortal_Execute()</span></strong>&nbsp;function with the&nbsp;<strong>Transactional&nbsp;</strong>attribute or by decorating your function with the&nbsp;<strong>Transactional&nbsp;</strong>attribute but setting its value to&nbsp;manual&nbsp;as in:&nbsp;<strong>[Transactional(TransactionalTypes.Manual)]</strong></p>
<p>once you have done any of the above you can then go ahead and do your transactions stuff just like you would do it anywhere else.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Wednesday, February 17, 2010</h2><p>Also, I found that CSLA only look at the attribute on the DataPortal_X method.</p>
<p>I had tried having DataPortal_Update check something (like a config file) and if it was supposed to avoid transactions, to call another method like &quot;UpdateWithoutTransactions&quot;, to which I applied the Manual transaction scope attribute, but CSLA doesn&#39;t walk up the calling stack to find the first transactionscope attribute, it just looks at the Dataportal_X method that instantiated everything.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, February 17, 2010</h2><p><span style="word-spacing:0px;font:medium &#39;Times New Roman&#39;;text-transform:none;color:#000000;text-indent:0px;white-space:normal;letter-spacing:normal;border-collapse:separate;orphans:2;widows:2;webkit-border-horizontal-spacing:0px;webkit-border-vertical-spacing:0px;webkit-text-decorations-in-effect:none;webkit-text-size-adjust:auto;webkit-text-stroke-width:0px;" class="Apple-style-span">
<div style="font-size:12px;margin:8px;color:#000000;font-family:Arial, Helvetica, sans-serif;background-color:#ffffff;background-origin:initial;background-clip:initial;">
<p><div style='padding-left: 50px;background-color:silver'><b>cmay<br></b></p>
<p>Also, I found that CSLA only look at the attribute on the DataPortal_X method.</p>
<div style="clear:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p class="MsoNormal"><span style="font-size:small;font-family:Times New Roman;">That&rsquo;s right, internally, when the DataPortal_XYZ is decorated with the transactional attribute that requires a transaction, the CSLA delegates the update code to a class called <strong>TransactionalDataPortal</strong>. Inside that class the update code looks like this:</span></p>
<p>--------------------------------------</p>
<p>public DataPortalResult Update(object obj, DataPortalContext context)<br />{<br />&nbsp;&nbsp;&nbsp; DataPortalResult result;<br /><strong><span style="color:#00ff00;">&nbsp;&nbsp;&nbsp; using (TransactionScope tr = new TransactionScope())<br />&nbsp;&nbsp;&nbsp; {</span></strong><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var portal = new DataPortalSelector();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = portal.Update(obj, context); <strong><em>// Calls your acutal implementation of&nbsp;your DataPortal_XYZ</em></strong>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tr.Complete();<br />&nbsp;&nbsp;&nbsp; <strong><span style="color:#00ff00;">}<br /></span></strong>&nbsp;&nbsp;&nbsp; return result;<br />}</p>
<p>--------------------------------------</p>
<p>Note how the <strong>portal.Update(obj, context)</strong> call (the code that ends up calling your acutal implementation of&nbsp;your DataPortal_XYZ&nbsp;) is sorunded by the using <strong>(TransactionScope tr = new TransactionScope()).</strong> </p>
<p>So basically, anything running inside the DataPortal_XYZ will use the transaction scope.</p>
</div>
</span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
