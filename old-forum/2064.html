<html><header><title>Very strange &quot;trust relationship&quot; error when calling User.IsInRole...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Very strange &quot;trust relationship&quot; error when calling User.IsInRole...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2064.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCannelos posted on Tuesday, January 02, 2007</h2><P><FONT face=Verdana size=2>Guys,</FONT></P>
<P><FONT face=Verdana size=2>As strange error started happening today - when I call ApplicationContext.User.IsInRole("SiteManager"), I get an error that states "The trust relationship between this workstation and the primary domain failed."?? I've never heard of this error. All parts (Csla, my business objects, my web app, database) are all on my local laptop and running in debug mode. I have not really set up my login page yet, but if anything I should be getting "Security Exception: Can not add Company" rather than this! :(</FONT></P>
<P><FONT face=Verdana size=2>Anyone come across this before?</FONT></P>
<P><FONT face=Arial size=2>Thanx!</FONT></P>
<P><FONT face=Arial size=2>J'son</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 02, 2007</h2>Try rebooting.&nbsp; Failing that, you'll have to remove the workstation from the domain, reboot and rejoin the workstation to the domain.<br><br>The problem is that the cert for the workstation got out of sync with the cert the dc expects.&nbsp; <br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCannelos replied on Tuesday, January 02, 2007</h2><P><FONT face=Verdana size=2>Andy,</FONT></P>
<P><FONT face=Verdana size=2>Ok, well.. I just added the following line to my web.config that fixed the problem:</FONT></P>
<P><FONT face=Verdana size=2>&lt;roleManager enabled="true" /&gt;</FONT></P>
<P><FONT face=Verdana size=2>Not really sure what this does though and if that will mess me up later&nbsp;when I finally add in my &lt;membership defaultProvider... /&gt; piece.</FONT></P>
<P><FONT face=Verdana size=2>The weird thing is that main part of my static CanAddObject() method looks like this:</FONT></P>
<P><FONT face=Verdana size=2>return (ApplicationContext.User.IsInRole("Administrator") || ApplicationContext.User.IsInRole("SiteManager"));</FONT></P>
<P><FONT face=Verdana size=2>The "Administrator" role check happens fine, but the trust domain error happens when the "SiteManager" role is checked. Weird, eh?</FONT></P>
<P><FONT face=Verdana size=2>Thanx for the domain tip. I'll look into that.</FONT></P>
<P><FONT face=Verdana size=2>J'son</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 02, 2007</h2>It probably fixed it because the membership provider isn't going against the Active Directory anymore, whereas previously it was.&nbsp; <br><br>The error message you're getting indicates that whatever domain your laptop (the web server is on the laptop, correct?) belongs to isn't trusting the laptop anymore.&nbsp;&nbsp; <br><br>I actually had this happen on a workstation here, but it happened when the workstation was trying to connect to the Sql Server, which used Integrated Security, because .&nbsp; The unjoin / rejoin solution resolved this.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCannelos replied on Tuesday, January 02, 2007</h2><P><FONT face=Verdana size=1>Good stuff... thanx for your help!</FONT></P>
<P><FONT face=Verdana size=1>J'son</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
