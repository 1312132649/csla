<html><header><title>InputProperties property not initialized in base class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>InputProperties property not initialized in base class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9105.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dpk posted on Friday, June 18, 2010</h2><p>I&#39;m writing custom rules for the new rule system in CSLA.NET 4.0 and I&#39;m looking at the rules provided in the CommonRules class in the CSLA source as a guide. I noticed that the property InputProperties declared in the BusinessRule base class has to be initialized in the subclass. Why? </p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, June 18, 2010</h2><p>This was a choice I made to avoid overhead. Since most rules are sync, and most sync rules don&#39;t need/use input property values like that, creating the collection object for every rule invocation (every rule context) would be a waste.</p>
<p>Also, I rather like using collection initializers to set the values while creating the list object - all in one neat line of code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dpk replied on Friday, June 18, 2010</h2><p>I agree that it&#39;s unnecessary to initialize the collection for every rule. However, I don&#39;t like the fact that a property from a base class throws a NullReference exception if I try to use it, especially for collections. I believe it&#39;s more natural and less error-prone to return an empty list. Might I suggest that a better approach would be to lazy-initialize the collection like this:</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">List</span>&lt;Csla.Core.<span style="color:#2b91af;">IPropertyInfo</span>&gt;&nbsp;_inputProperties;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;Csla.Core.<span style="color:#2b91af;">IPropertyInfo</span>&gt;&nbsp;InputProperties&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(_inputProperties&nbsp;==&nbsp;<span style="color:blue;">null</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_inputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;Core.<span style="color:#2b91af;">IPropertyInfo</span>&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;_inputProperties;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre>
<p>The&nbsp;collection is initialized only if it is referenced. Also, the protected setter is not needed. The protected constructor can add the PrimaryProperty to the InputProperties collection if it is called:</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;BusinessRule(Csla.Core.<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color:blue;">this</span>.InputProperties.Add(primaryProperty);<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultSeverity&nbsp;=&nbsp;<span style="color:#2b91af;">RuleSeverity</span>.Error;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AffectedProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;Core.<span style="color:#2b91af;">IPropertyInfo</span>&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrimaryProperty&nbsp;=&nbsp;primaryProperty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">this</span>.RuleUri&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">RuleUri</span>(<span style="color:blue;">this</span>,&nbsp;primaryProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre>
<p>Just some ideas.</p>
<p>Dave</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
