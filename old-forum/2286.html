<html><header><title>Why does moving the location of a Child BO in a collection make it dirty?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Why does moving the location of a Child BO in a collection make it dirty?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2286.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM posted on Tuesday, February 06, 2007</h2><P>Hi,</P>
<P>I'm trying to implement a simple swap routine of elements within an EditableChildCollection BO.&nbsp; The contents of the collection are EditableChild BO's.&nbsp; The code is located in the EditableChildCollection BO and looks like this...</P><FONT color=#0000ff size=2>
<P>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> SwapElements(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> indx1 </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> indx2 </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> t </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> EditableChildBO</P></FONT><FONT size=2>
<P>t = </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(indx2)</P>
<P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.SetItem(indx2, </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(indx1))</P>
<P></FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.SetItem(indx1, t)</P></FONT><FONT color=#0000ff size=2>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Prior to this code running, IsDirty is false for the BO's at both indx1 and indx2.&nbsp; After it runs, IsDirty is True for both, even though nothing has changed except their location within the containing collection.</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Why is this and how do I get these BO's "clean" again.&nbsp; I've tried setting RaiseListChangedEvents to false, and also using an explicit&nbsp;BeginEdit / ApplyEdit on each object as it is moved.&nbsp; No luck.&nbsp;&nbsp;</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Thanks for your help.&nbsp; I'm using Version 2.02 of CSLA if that makes any difference.</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>BBM</FONT>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 06, 2007</h2>Check out the code in SetItem.<br><br>Normally, SetItem assumes the current item in the position is being removed, and thus is copied to the DeletedList which also sets the BO's IsDeleted flag to true.&nbsp; You have to do this, because what if you're just setting the item without a swap operation, the old object no longer part of the list and thus needs to be deleted.<br><br>Now, as to a solution.. instead of using SetItem, set the items directly using the protected Items property which is inhertied from Collection&lt;T&gt; (the ultimate super of BLB).<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM replied on Tuesday, February 06, 2007</h2><P>Andy,</P>
<P>Thank you VERY MUCH for your help.&nbsp; I'm not sure I would have ever found the "Items" property on my own.&nbsp; &nbsp;When I wrote my post, I actually had already tried to use the default property for the collection (me(indx1)) and the "explicit" item property (me.item(indx1)) without success.</P>
<P>I'm still not exactly sure why "Items" works.&nbsp; The only thing I can think of is that the Item property must call SetItem() to do its work, which is really the SetItem override in BLB that you pointed out.&nbsp; So Items() must use some other method to set&nbsp; the collection contents that doesn't call SetItem and therefore doesn't run afoul of the DeletedList?</P>
<P>Like I say, I don't know if I would have ever discovered this difference between the Items and Item properties in BLB without your help.&nbsp;&nbsp; Very handy to know.&nbsp; </P>
<P>Thanks again.</P>
<P>BBM</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, February 07, 2007</h2>BBM,<br><br>I think you are correct; the indexing operator Item[ index ] calls SetItem to actually set the item.<br><br>The Items property is a protected List&lt;T&gt; that actually stores as the items; Collection&lt;T&gt; doesn't actually store the items itself, it wraps List&lt;T&gt; and delegates calls to the wrapped instance.<br><br>I actually had to go up the hierarchy checking out members to discover that.<br><br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
