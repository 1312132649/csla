<html><header><title>Silverlight and Windows authentication - clarification needed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight and Windows authentication - clarification needed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10571.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF posted on Saturday, July 30, 2011</h2><p>I&#39;ve read a number of posts about this in the forum and I&#39;m also trying to learn from the e-books, but I&#39;m still somewhat confused.&nbsp; For an intranet Silverlight app, I want to use Windows authentication.</p>
<p>I had wanted my Silverlight 4 (CSLA 4.1) app to&nbsp;pass the Csla.ApplicationContext.User.Identity.Name value&nbsp;to the DP (WcfPortal service) so I could pass that, in turn, to the DAL.&nbsp; But the&nbsp;Identity.Name in Silverlight is always null.&nbsp; I guess that makes sense when I think about it.&nbsp; So I started to think that I should not worry about the Silverlight client passing the username and instead have the .NET (server) code pull this, since it would get it from IIS.</p>
<p>But then I read this <a href="http://forums.lhotka.net/forums/p/8825/42016.aspx#42016">older post</a> from Rocky on a similar-sounding situation, and it sounds like he is stating that, while I could&nbsp;rely on the server-side code to deal with this,&nbsp;Silverlight could also store the Windows-provided identity for this type of purpose. But then he says: </p>
<p style="padding-left:30px;">&quot;Arguably the SL client wouldn&#39;t need to pass this principal to the server each time, because the server should already know (via the browser login) which Windows user to impersonate on each call. <strong>But that&#39;d preclude the use of an IAuthorizeDataPortal check to make sure the client principal still matches the server principal...</strong> &quot;</p>
<p>I&#39;m not quite sure what this last sentence means...what is preferred in my intranet scenario?&nbsp; Letting the server handle it with each request, or use an IAuthorizeDataPortal check?<br />Thanks.<br />Tim</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, July 30, 2011</h2><p>I think I explain this pretty well in the <em>Data Portal Configuration</em> ebook.</p>
<ol>
<li>The user logs into IIS/ASP.NET with their Windows credentials</li>
<li>The SL app makes a data portal call to get the user&#39;s identity information from the web server</li>
</ol>
<p>Normally, nothing else needs to be done now, because the browser/server work together to ensure the server always impersonates the Windows user. And the SL client has the username and group/role information so it can do normal authorization.</p>
<p>This all presupposes IIS/ASP.NET are configured to require the user to log on, and to do impersonation.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Saturday, July 30, 2011</h2><p>Thanks for your reply.&nbsp; I am still working my way through (re-reading) the data portal e-book.&nbsp; What has to occur in the data portal call to get the user&#39;s identity information?&nbsp; And is this a particular DP method that I would be calling?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, July 30, 2011</h2><p>From the SL side it is a custom principal/identity. There&#39;s a pre-created WindowsIdentity type in CSLA (Csla.Silverlight.Security I think) that already knows how to copy the Windows identity information into a custom identity object.</p>
<p>There&#39;s an example in the download for the ebook - in the Authentication\Windows folder.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, August 01, 2011</h2><p>I&#39;ve been looking at the example projects in the Auth\Windows folder and they are definitely helpful.&nbsp;&nbsp; </p>
<p>Sort of off topic, I wanted to ask why you&nbsp;implement INotifyPropertyChanged on the MainPageViewModel VM intsead of inheriting from Csla.Xaml.ViewModel.&nbsp; Was it just an easier way to demonstrate what you were doing?&nbsp; Or is this a recommended approach for a VM that manages authentication in Silverlight?&nbsp; Thanks.<br />Tim</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, August 01, 2011</h2><p>The ViewModel&lt;T&gt; class is great for building a viewmodel that manages one business object.</p>
<p>The main page viewmodel (or presenter) for a typical app will expose/manage numerous objects - MainContent, StatusContent, ErrorContent, MenuContent, etc.</p>
<p>So ViewModel&lt;T&gt; isn&#39;t terribly useful. But any viewmodel must at least implement INotifyPropertyChanged (or subclass DependencyObject) to participate in XAML binding.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
