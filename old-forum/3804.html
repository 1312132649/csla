<html><header><title>RaiseListChangedEvents</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>RaiseListChangedEvents</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3804.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 posted on Monday, October 29, 2007</h2><P>In all of my collections I use code like this during fetch:</P><FONT size=2>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>False</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#008000>&nbsp; 'get the data</FONT></P></FONT><FONT size=2>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>True</P></FONT>
<P>I have a case where I wanted to ensure that no events were raised but I can't seem to find where in the CSLA framework the code above is being "honored".</P>
<P>Specifically, this code does not honor the setting for RaiseListChangedEvents:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Child_PropertyChanged(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, _</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.ComponentModel.PropertyChangedEventArgs)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> index </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = 0 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> Count - 1<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> ReferenceEquals(</FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(index), sender) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>OnListChanged(</FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> System.ComponentModel.ListChangedEventArgs( ComponentModel.ListChangedType.ItemChanged, index))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Exit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>For<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Next<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>Even though I set it to False the code in Child_PropertyChanged still runs and raises OnListChanged.</P>
<P>This is causing a problem because the ObjectListView is subscribing to the event and is re-sorting itself "on the fly". This is bad because I am in a Web app and am trying to get the data in a grid into the corresponding BO in the collection. I have them all lined up and am ready to shove the values for each row into the right BO but when I change a property, OnPropertyChanged is called which then calls <FONT size=2>mNonSerializableHandlers.Invoke(sender, e).</P></FONT>
<P>But this is the ListChanged event. When it runs, the value in the first row of data is evaluated and if it causes the list to re-sort, then it does. Now my grid and BOs are no longer "lined up" and there is a huge mess during unbinding.</P>
<P>I am pretty sure the code in the objectListView is supposed to react to that event and re-order the list on the fly - but I don't want it to happen during unbinding in my Web app.</P>
<P>Any advice?</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, October 30, 2007</h2><P>Joe,<BR>I looked at the CSLA framework classes&nbsp;and I see what&nbsp;you mean.&nbsp; Strictly speaking the Child_PropertyChanged() handler is kicking in because you've changed a property of a child object inside the list - you've not actually changed the list.&nbsp; That's why the RaiseListChangedEvents flag (from the .NET framework BindingList&lt;T&gt; class) has no effect.</P>
<P>But I can absolutely see why you would expect the behaviour you describe.</P>
<P>I&nbsp;know it sounds obvious and you probably don't want to do it.&nbsp; I guess you've considered "patching" your CSLA base class to add "support" for the RaiseListChangedEvents flag into the Child_PropertyChanged() method?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 30, 2007</h2><P>David,</P>
<P>Thanks for taking a look. This isn't obvious or trivial.</P>
<P>I decided to add this code to my Base class that inherits from CSLA BusinessBase:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> mDisablePropertyChanged </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> OnPropertyChanged(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> propertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mDisablePropertyChanged </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#008000 size=2>'do nothing<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.OnPropertyChanged(propertyName)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>Then in the BO that is contained in the collection I set mDisablePropertyChanged = True during DP_Create and Fetch.</P>
<P>This means that all other BOs act as they always have but for this BO the event is not raised.</P>
<P>It solved the issue during unbinding so that the sorted list is not re-arranged too soon.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Tuesday, October 30, 2007</h2>Yup, that looks like a neat way to solve the problem.&nbsp; I knew you wouldn't want to change the framework <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
