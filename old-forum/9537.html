<html><header><title>CSLA AddAuthorizationRules / CanGetObject/CanCreateObject/canDeleteObject/canEditObject not working</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA AddAuthorizationRules / CanGetObject/CanCreateObject/canDeleteObject/canEditObject not working</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9537.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ram007 posted on Tuesday, September 14, 2010</h2><p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">It looks like<span style="mso-spacerun:yes;">&nbsp; </span></span></span><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>AddAuthorizationRules</strong><span style="mso-spacerun:yes;">&nbsp; </span></span><span style="font-size:small;"><span style="font-family:Calibri;">is firing on the DataPortal.Create. I have a PersonSearch page with the grid which displays the search results. The PersonID field is a link field &nbsp;in the grid. I need to disable/enable that link based on loggedin user, whether the login user cancreate/canget the Person object from the PersonSearch page. </span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">I am trying to use csla security authorization rules. CanGetObject/CanCreateObject but it always returns true even when the login user doesn&rsquo;t have access. Please let me know how I can check the user access of the object without creating it.</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>Csla.Security.AuthorizationRules.CanGetObject(<span style="COLOR:blue;">GetType</span>(MyLibrary.Person))</strong></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>Csla.Security.AuthorizationRules.CanCreateObject(<span style="COLOR:blue;">GetType</span>(MyLibrary.Person))</strong></span></strong></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>Csla.Security.AuthorizationRules.CanEditObject(<span style="COLOR:blue;">GetType</span>(MyLibrary.Person))</strong></span></strong></span></strong></span></strong></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>Csla.Security.AuthorizationRules.CanDeleteObject(<span style="COLOR:blue;">GetType</span>(MyLibrary.Person))</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="FONT-SIZE:10pt;FONT-FAMILY:&#39;Courier New&#39;;mso-no-proof:yes;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">I have the following code in the Person class.</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Partial Public Class Person</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>Inherits BusinessBase(Of Person)</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">Protected Overrides Sub AddAuthorizationRules()</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Dim canWrite As String() = {&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;}</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Dim canRead As String() = {&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;}</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Dim canCreate As String() = {&quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;}</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Dim canDelete As String() = {&quot;A&quot;,&quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;}</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AuthorizationRules.AllowCreate(GetType(Person), canCreate)</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AuthorizationRules.AllowDelete(GetType(Person), canDelete)</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AuthorizationRules.AllowEdit(GetType(Person), canWrite)</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AuthorizationRules.AllowGet(GetType(Person), canRead)</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>End Sub</span></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;font-family:Calibri;">&nbsp;</span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><span style="font-family:Calibri;">End Class</span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, September 14, 2010</h2><p>You need to implement a static method named AddObjectAuthorizationRules - that&#39;s where you add per-type rules.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ram007 replied on Wednesday, September 15, 2010</h2><p>Thanks for your quick response. This is working partially but I found another issue. Please let me know how I need to fix this.</p>
<p>As I mentioned I have a Person Search Page with PersonGridView. When I search the results and trying to enable/disable the link based on canGetObject , Its working fine. In the same grid I have another link to go to the Case Details for that Person. The login user should be able to view Case Details but he cannot access Person details (person link on the case details page) from case details page. And I am try to do the same check <span style="font-size:10pt;font-family:&#39;Courier New&#39;;mso-no-proof:yes;"><strong>Csla.Security.AuthorizationRules.CanGetObject(<span style="color:blue;">GetType</span>(MyLibrary.Person))&nbsp;</strong><span style="font-family:Arial;"> and I noticed the CanGetObject returns always true and also Its somehow appends the roles. I debug the code and found It calls </span></span></p>
<p><span style="font-size:10pt;font-family:&#39;Courier New&#39;;mso-no-proof:yes;">GetAllowGetRoles in AuthorizationRules.cs<br />GetRoles in ObjectAuthorizationRules.cs<br />Csla.Security.AuthorizationRules.GetAllowGetRoles(objectType) in AuthorizationRules.cs&nbsp;returns 15 roles<br />which means &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot; + &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot; + loginuser &quot;H&quot;<br />I don&#39;t understand why its keeping the roles and appending. Is there a parameter we can force&nbsp;it to call AddObjectAuthorizationRules from the Case details page because the AddObjectAuthorizationRules&nbsp; is not called from the case details page.</span></p>
<p><span style="font-size:10pt;font-family:&#39;Courier New&#39;;mso-no-proof:yes;">Here is the code I have now :</span></p>
<p><span style="font-size:10pt;font-family:&#39;Courier New&#39;;mso-no-proof:yes;">Private Shared Sub AddObjectAuthorizationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim canWrite As String() = {&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim canRead As String() = {&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim canCreate As String() = {&quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim canDelete As String() = {&quot;A&quot;,&quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;}</span></p>
<p><span style="font-size:10pt;font-family:&#39;Courier New&#39;;mso-no-proof:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.AllowCreate(GetType(Person), canCreate)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.AllowDelete(GetType(Person), canDelete)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.AllowEdit(GetType(Person), canWrite)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.AllowGet(GetType(Person), canRead)<br />End Sub</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, September 15, 2010</h2><p>AddObjectAuthorizationRules is called one time per AppDomain per type, and the results are cached for the lifetime of the AppDomain. Every business object type is responsible for managing its own authorization rules.</p>
<p>CSLA objects are UI independent. If your UI has different requirements for different pages, then those pages should use different objects - which seems a little odd at first, but is pretty obvious when you think about what I just said.</p>
<p>If your UI has <i>different requirements</i> that means different business rules. Objects encapsulate behavior (business rules). So if different pages need different business rules, then they obviously need different objects.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
