<html><header><title>Urgent: need help with issue connecting Infragistics and CSLA</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Urgent: need help with issue connecting Infragistics and CSLA</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9032.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lord02 posted on Thursday, June 03, 2010</h2><p>Hi Lhotka!</p>
<p>Could you please have a look at this issue ?</p>
<p>http://community.infragistics.com/forums/p/42178/233660.aspx#233660</p>
<p>rgd,<br />EE.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 03, 2010</h2><p>What version of CSLA are you using?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lord02 replied on Thursday, June 03, 2010</h2><p>v3.8.2 ... what would be the functionality of CSLA that the Ultragrid would be using to re-paint the field *without* the need of hoovering over the area with the mouse?</p>
<p>rgd,<br />EE</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 03, 2010</h2><p>I don&#39;t know what they are expecting. CSLA raises the PropertyChanged event, as required by standard data binding, and at the collection level the BindingList&lt;T&gt; collection raises the ListChanged event - that&#39;s standard .NET behavior.</p>
<p>My recommendation any time people encounter an issue with a third party datagrid control is to try the same thing with the Microsoft datagrid control. You can think of the Microsoft datagrid control as the reference control - that&#39;s the core standard to which CSLA is coded, because it is the official Microsoft control. </p>
<p>If you can replicate the problem with the Microsoft control then it is probably an issue with your code or maybe with CSLA. If you can&#39;t replicate the issue with the Microsoft datagrid, then the problem is probably with the third party control.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lord02 replied on Friday, June 04, 2010</h2><p>Hi !</p>
<p>I&#39;ve also noticed this with out-of-the-box Microsoft controls, so it&#39;s NOT related to this UltraGrid I think ... <br /><br />What I noticed on 2 cases which I have is that if the validation rule is called from the:<br /><br /><b>protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)</b><br /><br />It&#39;s like it&#39;s &quot;behind&quot; ... e.g. I have too hoover over the item to get it to appear in the Grid, but in a regular [label] control from Microsoft this is ALSO happening !</p>
<p>Let me give you a real simple example:<br /><br />I have this rule:<br /><br />protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (e.ChildObject is SteeringCommittee)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.ValidationRules.CheckRules(&quot;ErrorLabel&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.OnChildChanged(e);<b> //I&#39;ve also tried putting this line at the top of the this function, doesn&#39;t matter</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected bool AddBusinessValidationRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule&lt;Project&gt;(SteeringCommiteesCount&lt;Project&gt;, &quot;ErrorLabel&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>private static bool SteeringCommiteesCount&lt;T&gt;(T target, Csla.Validation.RuleArgs e) where T : Project<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( target.SteeringCommittees.Count == 0 )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = &quot;There needs to be at least one member in steering committee&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> return true;</b> <b>// It enters this! But still the ErrorProvider remains on the label</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>Now the errorLabel appears spot on, in a simple Label control ( which is bound to this &quot;ErrorLabel&quot; string inside Project class ).<br />Then I insert a steeringCommittee ( and the rule runs and returns TRUE, but the errorProvider still remains on the simple label on the form !<br />- But the minute I change some OTHER property on the form, the ErrorLabel disappears **WITHOUT** running through this rule again ( and that&#39;s correct ... it should not enter the rule again, because I&#39;m changing SOME other property ( any other property ) )</p>
<p>This is really weird ... and I&#39;ve narrowed it down to this ...<br />When I&#39;m running Validation rules through this, I get weird behaviours:</p>
<p><b>protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />{<br />&nbsp;&nbsp; ....<br />}</b></p>
<p>Please help !<br /><br />Regards,<br />EE</p>
<p>p.s. this is the simple &quot;ErrorLabel&quot; property on the Project&#39;s class:<br /><br />private static readonly PropertyInfo&lt;System.String&gt; _errorLabelProperty = RegisterProperty&lt;System.String&gt;(p =&gt; p.ErrorLabel, string.Empty, null);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public System.String ErrorLabel<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(_errorLabelProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private set { SetProperty(_errorLabelProperty, value); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 04, 2010</h2><p>Yeah, that&#39;s a bug in your code then.</p>
<p>The ChildChanged event is raised <i>in response to a PropertyChanged</i> event. So it happens too late in the process to do what you want.</p>
<p>The easy fix is for you to call OnPropertyChanged() after you call CheckRules() to force another PropertyChanged event to be raised.</p>
<p>The correct fix is to use dependent properties so the CSLA rules engine invokes the rules for you - assuming this is all in one object - if the object handling ChildChanged is different from the one where the original change occurred, then your only answer is to call OnPropertyChanged() yourself.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lord02 replied on Friday, June 04, 2010</h2><p>Thanx Lhotka !</p>
<p>This fixed the problem:</p>
<p>protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (e.ChildObject is SteeringCommittee)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.ValidationRules.CheckRules(&quot;ErrorLabel&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged(&quot;ErrorLabel&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.OnChildChanged(e);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><br />BUT of course I want to do it the correct way ... you say with dependent properties.</p>
<p>How would you do that ? ( I know how to use dependent properties )<br />- Which properties would you connect as dependant ?</p>
<p>Would you add this property ( which is a EditableChildList ) to be dependent on the &quot;ErrorLabel&quot; control ? <br /><br />This managed property is inside the Project class ( which also has the managed property for ErrorList ):</p>
<p>//AssociatedOneToMany<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static readonly PropertyInfo&lt; SteeringCommitteeList &gt; _steeringCommitteesProperty = RegisterProperty&lt;SteeringCommitteeList&gt;(p =&gt; p.SteeringCommittees, Csla.RelationshipTypes.Child);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public SteeringCommitteeList SteeringCommittees<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!FieldManager.FieldExists(_steeringCommitteesProperty))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(IsNew || !RecoveryPlanner.Business.SteeringCommitteeList.Exists(new RecoveryPlanner.Business.SteeringCommitteeCriteria {ProjectId = ProjectID}))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(_steeringCommitteesProperty, RecoveryPlanner.Business.SteeringCommitteeList.NewList());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(_steeringCommitteesProperty, RecoveryPlanner.Business.SteeringCommitteeList.GetByProjectId(ProjectID));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return GetProperty(_steeringCommitteesProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>This does NOT fix the problem:</p>
<p>//Properties all dependant on each other:<br />ValidationRules.AddDependentProperty(_errorLabelProperty, _steeringCommitteesProperty, true);</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lord02 replied on Friday, June 04, 2010</h2><p>Infragistics have replied ... can you please look at the reply from them ?</p>
<p>




http://community.infragistics.com/forums/p/42178/233797.aspx#233797</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, June 04, 2010</h2><p>Sure, but their reply just confirms what you already know from our discussion <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
