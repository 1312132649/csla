<html><header><title>WPF, custom authentication</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WPF, custom authentication</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8507.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>fsl posted on Wednesday, February 10, 2010</h2><p>Hi</p>
<p>I&#39;m using custom authentication in an WPF/VSTO application. I&#39;ve implemented a custom principal and a custom identity. I&#39;m using&nbsp;Csla.ApplicationContext.User to store the identity etc. I a have a main window in which I login, i.e. create the custom principal and so on. Inside one control in the UI,&nbsp;Csla.ApplicationContext.User.Identity returns the correct custom identity. But inside another control&nbsp;Csla.ApplicationContext.User.Identity returns a generic identity..&nbsp;</p>
<p>Any ideas why this may be happening?</p>
<p>Regards,</p>
<p>Fredrik</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Wednesday, February 10, 2010</h2><p>It sounds like you&#39;re creating a plugin for an Office application, is that correct?&nbsp; </p>
<p>If that&#39;s the case, its been my experience (with my Outlook plugin, at least) that the thread your code gets executed on changes, based on things outside your control (namely the Office application you&#39;re targeting).&nbsp; </p>
<p>The only solution I&#39;ve found for this is to store the principal in a static field reference when the plugin starts up and to reset it again&nbsp;whenever code is executed in response to the application (in my case, whenever an item is added to the Inbox or Sent Items).</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>fsl replied on Wednesday, February 10, 2010</h2><p>Thank you, for your answer.</p>
<p>Yes, I&#39;m creating an addin for outlook.</p>
<p>I just tried using:</p>
<p>&nbsp;AppDomain.CurrentDomain.SetThreadPrincipal(principal);</p>
<p>, which so far have solved the problem..&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, February 10, 2010</h2><p>I thought I had tried that at one point and it would still fail sometimes.&nbsp; Let me know how it goes with you, maybe I was doing something else odd too that was making that not work.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, February 10, 2010</h2><p>SetThreadPrincipal() only affects threads created after that method is called. So if threads have been created before you make that call, and those threads are reused (which is likely) then you could end up on an unaffected thread that doesn&#39;t have your principal. I suspect that&#39;s why you&#39;ve seen it fail sometimes.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 11, 2010</h2><p>Hmm... that might not be the solution then, because I was calling in respond to the Startup event Outlook triggers when your application starts up.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
