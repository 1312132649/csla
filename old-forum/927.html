<html><header><title>Editable Root Collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Editable Root Collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/927.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RangerGuy posted on Thursday, August 17, 2006</h2><P><FONT size=2><FONT face=Arial>I need to make Root object that&nbsp;this is a collection of other objects.&nbsp; So in the update method would it be ok to create the connection to the database&nbsp;in the overridden method </FONT><FONT face=Arial>DataPortal_Update() of the</FONT> Collection object then reuse that connection to work with the objects in the collection like so:</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P><FONT size=2><FONT color=#0000ff size=2>
<P>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Update()</P>
<P>{</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> cn = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>Database</FONT><FONT size=2>.CustomerDB))</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>Customer </FONT><FONT size=2>cust </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> DeletedList)</P>
<P>cust .DeleteSelf(cn);</P>
<P>DeletedList.Clear();</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>Customer&nbsp;<FONT color=#000000>cust&nbsp;</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (cust .IsNew)</P>
<P>cust .Insert(cn,</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2>else</P></FONT><FONT size=2>
<P>cust .Update(cn,</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vargasbo replied on Thursday, August 17, 2006</h2>Since a root object owns the collection of X. I would put the logic in X as such<br>internal void Update()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.RaiseListChangedEvents = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // update (thus deleting) any deleted child objects<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Unit obj in DeletedList)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.DeleteSelf(obj);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // now that they are deleted, remove them from memory too<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeletedList.Clear();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // add/update any current child objects<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Unit obj in this)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (obj.IsNew)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.Insert(obj);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.Update(obj);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.RaiseListChangedEvents = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Regards,<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Thursday, August 17, 2006</h2><P>RangerGuy,</P>
<P>All root objects including editable root list uses DataPortal_Update method so your implementation is correct.</P>
<P>Create connection in this method is also an acceptable method.&nbsp; In fact its a good way to avoid dtc from kicks in sql2k5 when using TtransactionScope.</P>
<P>You don't need to pass your current object (list object) when calling insert or update method though.</P>
<P>Ricky</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
