<html><header><title>Adding Events to subclasses of Winparts</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Adding Events to subclasses of Winparts</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1756.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pirithoos posted on Tuesday, November 14, 2006</h2>(Csla v2.1)<br><br>Hi there,<br><br>In my application there is a combobox used to allow the user to select a SubstanceBO to edit.<br>I have adopted Rockys design from PTracker with user controls inherited from WinPart.<br>Once I have added a new Substance or e.g. changed the name of a Substance during<br>editing it I want the combobox to immeidately reflect either the changes to the Substance.Name<br>(basically used as DisplayMember of the ComboBox) or to show the newly added Substance in the list to allow selecting it from the ComboBox after saving it to the DB.<br><br>My idea is to add new event to my 'SubstanceEdit' user control (inherited from Winpart)<br>called 'SubstanceIsSaved'. This event is raised when the SaveButton on the SubstanceEdit UC<br>is clicked and the SaveSubstance Sub is invoked...<br><br>&nbsp;&nbsp;&nbsp; Private Sub SaveSubstance(ByVal rebind As Boolean)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.SubstanceBindingSource.RaiseListChangedEvents = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim temp As Substance = mSubstance.Clone<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp.ApplyEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSubstance = temp.Save<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSubstance.BeginEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rebind Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.SubstanceBindingSource.DataSource = Nothing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.SubstanceBindingSource.RaiseListChangedEvents = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.SubstanceBindingSource.DataSource = mSubstance<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Csla.DataPortalException<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString, "Error saving", MessageBoxButtons.OK, MessageBoxIcon.Exclamation)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ButtonSave.Enabled = mSubstance.IsSavable<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.UndoButton.Enabled = mSubstance.IsDirty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">RaiseEvent SubstanceSaved(Me, EventArgs.Empty)</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>Within the application's MainForm I did add a Handler to listen to this event and if fired I do <br>force the SubstanceListBindingSource (where the ComboBox is bound to) to freshly retrieve<br>all data from the DB by setting it to a new instance of SubstanceList.<br><br>#Region " WinPart handling "<br><br>&nbsp;&nbsp;&nbsp; Private Sub AddWinPart(ByVal part As WinPart)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler part.CloseWinPart, AddressOf CloseWinPart<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">Dim obj As SubstanceEdit = CType(part, SubstanceEdit)</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">AddHandler obj.SubstanceSaved, AddressOf ReloadComboboxesAfterSubstanceIsSaved</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Panel1.Controls.Add(part)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ShowWinPart(part)<br><br>&nbsp;&nbsp;&nbsp; End Sub<br>...<br><br>&nbsp;Private Sub ReloadComboboxesAfterSubstanceIsSaved(ByVal sender As Object, ByVal e As EventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff"> Me.SubstanceListBindingSource.DataSource = SubstanceList.GetSubstanceList</font><br>&nbsp;&nbsp;&nbsp; End Sub<br><br><font color="#008000">QUESTION:<br><br>the code workes, but I wonder if I it's a legal approach or do I cause any unforeseen side-effects?</font><br><br>brgds,<br>Frank<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, November 14, 2006</h2>IMO: if it works you already have at least one strong argument in favour of your approach. <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br>Ok, no kidding. It looks fine to me. It is entirely a UI issue, so your choice to make appropriate changes in the UI (as opposed to in the BO) is a sound one. In addition, by making use of Events you are in fact implementing a observer pattern, which is always a good pattern to keep your objects loosely coupled.<br><br>The only thing that might bother me is that in a way your WinPart subclass strongly depends on the Event actually being handled. The event is merely a 'request' than a notification. The issue with Observer patterns (or Event raising) is that you never know if their will actually be a recieving party. This is of course by design and makes them so well suited for 'notifications'. <br><br>If you find that your (and perhaps many more) view really needs to be sure there is a collaborating object that takes care of refreshing the bindingsource for your, then you might opt for a more strongly coupled approach:<br>- define an interface IRefreshService<br>- this interface declares 1 member: RefreshNow (with appropriate arguments)<br>- make your mainform implement this IRefreshService<br>- alter the constructor of your WinPart so it requires a reference to a IRefreshService instance (i.e. your mainform, but using your interface you keep it loosely coupled)<br>- in your SaveSubstance routine you then call the RefreshNow when needed<br><br>You asked for detailed feed-back, hence I;m giving it. By no means do I intend to criticise, I think your approach is fine as it is (hey! It works, right?), I'm hinting at a possible approvement just to be thorough. ;-)<br><br>Kind regards,<br>Bayu<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 14, 2006</h2>Just wanted to agree with Bayu's assertion that you can't technically be sure anyone is listening to the event, and thus shouldn't depend on someone handling it in the code you've posted.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pirithoos replied on Thursday, November 16, 2006</h2>Thanks to both of your comments.<br><br>Now I adopted Bayus approach with the IRefreshService interface.<br>I do prefer Bayus appraoch as it give me a option to control what exactly to Refresh<br>by giving arguments to the RefreshNow method.<br><br>Thanks a lot Bayu.<br><br>brgds<br><br>Frank<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
