<html><header><title>DataPortal.Delete succeeded?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal.Delete succeeded?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1820.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gmclean posted on Wednesday, November 22, 2006</h2>&nbsp;&nbsp;&nbsp; It has been a while since I have worked on CSLA related projects so maybe I am missing something simple.<br><br>I want to use CSLA to delete a business object directly. In this BO I have defined an override for dataportal delete and it seems to work fine except for one thing. If all the data is deleted successfully I would like to pass back a boolean letting the calling program know the deletes were OK. I tried creating a public boolean property and setting it to true in the override of dataportal delete if all went well in the delete transaction. The property gets set but the value does not persist when I look at the BO in the calling program.<br><br>Any suggestions on a good way to let the calling program know the BO was deleted successfully?<br><br>Thanks for your help,<br><br>George<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Wednesday, November 22, 2006</h2><P>You're clearly not going to get a return value all the way back from your DP_Delete routine and I don't see how you could pass a variable by reference in hopes of getting it back modified to suit, either.</P>
<P>So the only other option appears to be some sort of test to see if the persisted object still exists.&nbsp; This shouldn't be hard should it?&nbsp; Your calling routine must know the ID value of the object (else how could it have deleted it directly?).&nbsp; So you can either (a) rely on logic you may already have in a fetch routine that can gracefully handle the absence of the requested object&nbsp;or (b) create an&nbsp;object (Command type?) to check for it.</P>
<P>Happy Thanksgiving,</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Wednesday, November 22, 2006</h2><DIV>In my case, I am using stored procedure to perform the deletion. And, the stored procedure will return a status value to tell this. In case of deletion fail, my DataPortal_Delete will throw an exception to inform the UI.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, November 23, 2006</h2>Hey,<br><br>Isn't the fact that you didn't catch an exception the 'success' flag that you need?<br><br>Or don't you trust your sql or sproc? <br><br>Then you could implement a shared/static Exists function like this:<br><br>&nbsp;&nbsp;&nbsp; Public Shared Function Exists(ByVal id As Guid) As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim result As ExistsCommand = DataPortal.Execute(Of ExistsCommand)(New ExistsCommand(id))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return result.Exists<br>&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Private Class ExistsCommand<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Inherits CommandBase<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Private _ID As Guid<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Private _Exists As Boolean<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Public Sub New(ByVal id As Guid)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Me._ID = id<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Public ReadOnly Property Exists() As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return Me._Exists<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Execute()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New MySqlConnection(Database.CrmDBConnection(True))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As MySqlCommand = cn.CreateCommand<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.Text<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "SELECT COUNT(CustomerID) FROM Customer WHERE CustomerID = @id"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Add("?id", Me._ID)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim count As Integer = CInt(cm.ExecuteScalar)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me._Exists = (count &gt; 0)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br><br>Note that in this case deletion takes 2 DB hits, but I guess your needs then would validate this.<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gmclean replied on Monday, November 27, 2006</h2>

<p class="MsoNormal">Thanks for all the suggestions. I had thought about another
trip to the database to check that the record was deleted but I was hoping to
avoid what I thought was an unnecessary database hit. I guess if
data_portal.delete throws an exception that is really all that is needed since
I can handle the exception in the calling program.<br>
<br>
Thanks again for the suggestions, <br>
<br>
George</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
