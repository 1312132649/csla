<html><header><title>duplicating a row in a business object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>duplicating a row in a business object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6448.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas posted on Tuesday, February 17, 2009</h2><P>hello all</P>
<P>i have a form that executes a search based on the users entries and returns a line of info about the certain business object ex Name of order, date, quantity ...all of this is displayed in a data grid. I would like to be able to duplicate a row. How would i be able to do this. I know i can add a button that says duplicate?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Antonio Sandoval replied on Tuesday, February 17, 2009</h2>BussinesBase implements a method named Clone (Csla.Core.ObjectCloner), but it method uses Serialization, so everything that is not marked as NonSerializable will be copied, including binding status, edit level, primary keys, old, new dirty etc. Depending on what you need to do with the new row you can use clone, or Csla.Data.DataMapper. DataMapper will copy only the public properties of the root, it does not include any children.<br>How is that you can get the BO from the grid, it depends of the datagrid that you are using, check the documentation, for example for a DataGridView:<br><br>if(datagrid.SelectedRows.Count&gt;0){<br>&nbsp;&nbsp;&nbsp; BO source= datagrid.SelectedRows[0].DataBoundItem;<br>&nbsp;&nbsp;&nbsp; BO dest = source.Clone();<br>&nbsp;&nbsp;&nbsp; BO dest2 = BO.NewBO();<br>&nbsp;&nbsp; Csla.Data.DataMapper.Map(source,dest2);<br>}<br>&nbsp;<br>Other way is using a CurrencyManager and it does not depends of the Datagrid<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Wednesday, February 18, 2009</h2>so where would i apply this method...in the search results that bind to the grid?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Wednesday, February 18, 2009</h2>ohh ok so i should put this in the button that i intend to add in order to clone the object huh...if so im so excited this might work </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, February 19, 2009</h2><P>We include the notion of duplication in our object models.&nbsp; In our case,&nbsp;our primary concern and reason for not directly cloning the object was that&nbsp;we wanted the new instance to have its own unique identifier.</P>
<P>Our collection class includes a DuplicateItem method that accepts the index/identifier of the item to duplicate and does all of the work.&nbsp; It looks for the ICloneable interface on the item and, if found,&nbsp;does as described above; otherwise, we delegate to the ObjectCloner directly.&nbsp; Oh, we also automatically append the new item to the collection before returning it to the caller.</P>
<P>So, following your use-case, you would simply pass in the identifier from the row selected in the grid to the DuplicateItem on the grid's datasource (collection) and the rest would happen automatically (because a ListChanged event is raised causing the grid to refresh and show the new, duplicate item).</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Monday, February 23, 2009</h2><P>errrrr ok kinda sounds like greek to me i have to do some more studying...................the identifier? meaning the business object...............i want to introduce a button that will be labled duplicate item. I am assuming i will put this code in the event of this button right? if you could explain in more detail i would greatly appreciate.....i am a newbie and amatuer at csla concepts....i understand c# but not the whole framework </P>
<P>thanks</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, February 25, 2009</h2><P>Presumably you are persisting your business object data to some data store such as SQL Server, Oracle, etc.&nbsp; As such, you have some way of uniquely identifying each object (row) so that you can retrieve the information.&nbsp; This value is typically used in your UI to reference the appropriate record when you want to do something on a specific item (row) like editing, deleting or copying.&nbsp; When you use data-binding, you will indicate this property as the key value for each item.</P>
<P>This is not to be confused with the index value which is the numeric location of the object within an array or list - which can also be used to identify the item you want to work with.</P>
<P>In our case, all of our business objects have a Guid property as their unique identifier.&nbsp; We overload methods on our collections that allow us to retrieve items by this value and use this property as the key when binding the collections to UI grids.</P>
<P>When we implement duplication, we also place a button on our form that, when clicked, obtains the key value for the selected item in the grid then calls the DuplicateItem() method on our business collection which does the rest of the work.&nbsp; For example, in an ASP.NET application with a GridView control bound to our business collection, we would have something like:</P>
<P><CODE>void DuplicateButton_Click(object sender, EventArgs e)<BR>{<BR>&nbsp; &nbsp; myCollection.DuplicateItem(GridView1.SelectedValue as System.Guid);<BR>}</CODE></P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Thursday, February 26, 2009</h2>so it seems i have to dig deeper in the code and understand the code behind the databinding...i think i shall do this.....would it help is i showed you some of the code that i am dealing with because i understand what ur saying but i am still kind of lost</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Thursday, February 26, 2009</h2>hey ..... where do you define the duplicateItem method...i have tried to complie and run the program but it failed....becuase it said that the duplicate method is not delcared anywhere. Do you inherit it from the ObjectCloner interface?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pagolas replied on Thursday, February 26, 2009</h2><P>hey just for you to see...this is an extract of my code and what it contains</P><FONT color=#0000ff size=2>
<P>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> button1_Click(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> sender, </FONT><FONT color=#2b91af size=2>EventArgs</FONT><FONT size=2> e)</P>
<P>{</P>
<P>myList.DuplicateItem(myListDataGridView.CurrentRow.DataBoundItem);</P>
<P>}</P></FONT>
<P>myList is my collection of objects. It shows up in the datagrid when you do the search.</P>
<P>below is the code that shows the data binding nature of my myList</P>
<P>&nbsp;</P><FONT color=#0000ff size=2>
<P>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> SortAndBindResults(myList</FONT><FONT size=2> list)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// clear previous results</P></FONT><FONT size=2>
<P>myListBindingSource.DataSource = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (list.Count &gt; 0)</P>
<P>{</P>
<P>Csla.</FONT><FONT color=#2b91af size=2>SortedBindingList</FONT><FONT size=2>&lt;myList</FONT><FONT color=#2b91af size=2>Info</FONT><FONT size=2>&gt; sortedList = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> Csla.</FONT><FONT color=#2b91af size=2>SortedBindingList</FONT><FONT size=2>&lt;<FONT color=#2b91af>myList</FONT></FONT><FONT color=#2b91af size=2>Info</FONT><FONT size=2>&gt;(list);</P>
<P></FONT><FONT color=#008000 size=2>//sortedList.ApplySort("IsWorkCommitted", ListSortDirection.Descending);</P></FONT><FONT size=2>
<P>sortedList.ApplySort(</FONT><FONT color=#a31515 size=2>"myListId"</FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2>ListSortDirection</FONT><FONT size=2>.Ascending);</P>
<P>myListListBindingSource.DataSource = sortedList;</P>
<P>myListDataGridView.Focus();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>MessageBox</FONT><FONT size=2>.Show(</FONT><FONT color=#a31515 size=2>"No matching lists found"</FONT><FONT size=2>,</P>
<P></FONT><FONT color=#a31515 size=2>"No matching lists"</FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2>MessageBoxButtons</FONT><FONT size=2>.OK);</P>
<P>}</P>
<P>}</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
