<html><header><title>HDI: implement a business rule which enables updates &amp; deletes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>HDI: implement a business rule which enables updates &amp; deletes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11017.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton posted on Sunday, December 25, 2011</h2><p>How do I implement a business rule that if an item is &quot;posted&quot; it can no longer be updated nor deleted?</p>
<p>&nbsp;</p>
<p>thank you.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Sunday, December 25, 2011</h2><p>First a question: What do you expect to happen when item is &quot;Posted&quot;? </p>
<p>1. can fields be edited or should they be disabled<br />2. Save/Delete method is not allowed (and should throw Security exception).</p>
<p>For 1) the simplest solution is to override CanEditProperty to return false if item is &quot;posted&quot;. </p>
<p>for 2: You will create a rule class that inherits from AuthorizationRule and make sure CachResult is set to false. </p>
<p>In the Execute method you will set HasPermission to not IsPosted. </p>
<p>This sample rule is from Samples\Net\cs\BusinessRuleDemo:</p>
<p>&nbsp; public class OnlyForUS : Csla.Rules.AuthorizationRule<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; private IMemberInfo CountryField { get; set; }<br />&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; public OnlyForUS(AuthorizationActions action, IMemberInfo element, IMemberInfo countryField)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(action, element)<br />&nbsp;&nbsp;&nbsp; { CountryField = countryField; }<br /><br />&nbsp;&nbsp;&nbsp; public override bool CacheResult<br />&nbsp;&nbsp;&nbsp; { get { return false; }<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; protected override void Execute(AuthorizationContext context)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var country = (string)MethodCaller.CallPropertyGetter(context.Target, CountryField.Name);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.HasPermission = country.Equals(CountryNVL.UnitedStates);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br /></p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
