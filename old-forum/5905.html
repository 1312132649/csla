<html><header><title>Custom Criteria objects, Linq and ReadOnlyLists</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Criteria objects, Linq and ReadOnlyLists</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5905.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>raz0rf1sh posted on Sunday, November 30, 2008</h2>I have a TaskCriteria object that has a property for ProjectId and Status.  Sometimes the values are provided, other times they are not.  How do I get my DataPortal_Fetch code to handle this using Linq?  Here is my current code:<br /><br /><br />        private void DataPortal_Fetch(TaskCriteria criteria)<br />        {<br />            bool cancel = false;<br />            this.OnFetching(ref cancel);<br />            if (cancel)<br />                return;<br /><br />            using (var mgr = ContextManager<br />                        .GetManager(Database.ApplicationConnection, false))<br />            {<br />                this.RaiseListChangedEvents = false;<br />                this.IsReadOnly = false;<br /><br />                var data = (from row in mgr.DataContext.Tasks<br />                              select TaskInfo.FetchTaskInfo(row));<br /><br />                if (criteria.ProjectId != Guid.Empty)<br />                {<br />                    data = (from row in mgr.DataContext.Tasks<br />                            where row.ProjectId == criteria.ProjectId<br />                            select TaskInfo.FetchTaskInfo(row));<br />                }<br /><br />                //if (criteria.Status != TaskStatus.NotSet)<br />                //{<br />                //    data = (from row in mgr.DataContext.Tasks<br />                //            where row.Status == (int)criteria.Status<br />                //            select TaskInfo.FetchTaskInfo(row));<br />                //}<br /><br />                this.AddRange(data);<br /><br />                this.IsReadOnly = true;<br />                this.RaiseListChangedEvents = true;<br />            }<br /><br />            this.OnFetched();<br />        }<br /><br />If I uncomment the last section it will only filter by Status, override the ProjectId.  How do I make so these Linq statements both work?<br /><br />Any help would be be much appreciated!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>raz0rf1sh replied on Monday, December 01, 2008</h2>Okay ... Got it working ... not sure if this is the right way ... but it works!<br /><br /><br />        private void DataPortal_Fetch(TaskCriteria criteria)<br />        {<br />            bool cancel = false;<br />            this.OnFetching(ref cancel);<br />            if (cancel)<br />                return;<br /><br />            using (var ctx = ContextManager<br />                        .GetManager(Database.ApplicationConnection, false))<br />            {<br />                this.RaiseListChangedEvents = false;<br />                this.IsReadOnly = false;<br /><br />                IQueryable query = ctx.DataContext.Tasks;<br /><br />                if (criteria.ProjectId != Guid.Empty)<br />                {<br />                    query = query.Where(t => t.ProjectId == criteria.ProjectId);<br />                }<br /><br />                if (criteria.Status != TaskStatus.NotSet)<br />                {<br />                    query = query.Where(t => t.Status == (int)criteria.Status);<br />                }<br /><br />                var data = query.Select(t => TaskInfo.FetchTaskInfo(t));<br /><br />                this.AddRange(data);<br /><br />                this.IsReadOnly = true;<br />                this.RaiseListChangedEvents = true;<br />            }<br /><br />            this.OnFetched();<br />        }<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Monday, December 01, 2008</h2>I do not know what "right" is in this case, but this is the way that I have done this in the past and it seems to work just fine.&nbsp; If we are wrong, we are in good company.<br><br>Jon Stonecash<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>raz0rf1sh replied on Monday, December 01, 2008</h2>Thanks Jon! =)</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
