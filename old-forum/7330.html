<html><header><title>Breaking change in LINQ to CSLA.NET between versions 3.6.2 and 3.6.3</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Breaking change in LINQ to CSLA.NET between versions 3.6.2 and 3.6.3</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7330.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MBursill posted on Thursday, July 23, 2009</h2>My hierarchy of objects consists of:<br><br>Role (root)<br>&nbsp; |__ PermissionCategories (editable list)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |_PermissionCategory (editable object)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |_ Permissions (editable list)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |_ Permission (editable object)<br><br>In CSLA.NET 3.6.2-090322, I used the following LINQ expression (inside the role class) without issues:<br><br>// get a list of all the current permissions this role has<br>var rolePermissions = from pc in PermissionCategories<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from p in pc.Permissions<br>&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select p;<br><br>In csla-3.6.3-090610 to csla-3.7.0-090721 the same LINQ query returns null.<br><br>I have confirmed that the proper data is still contained in the objects. The problem has to be with the way this LINQ statement is now being evaluated.<br><br>Any thoughts?<br><br>Thanks.<br><br>-Mike.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Thursday, July 23, 2009</h2>Good afternoon.  I just checked a change into the trunk that should resolve this issue, as well as added a new test that demonstrates this bug.
</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MBursill replied on Tuesday, August 04, 2009</h2>I just tested this with build 3.7.1-090803 and unfortunately the bug still appears to exist. Same holds true for the test in the csla test project.<br><br>I made a simple WPF project, dumped in the "nested_collections_return_valid_results" method, and necessary collection/item classes. I made the method return a bool, and changed the last line to:<br><br>return get42back.First().TestProp == "42";<br><br>I get a null exception on "get42back".<br><br>I don't know NUnit very well, but is it possible the Assert.IsTrue method is trapping the exception and causing a false positive?<br><br>-Mike.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MBursill replied on Tuesday, August 04, 2009</h2>I see the problem... digging through the source of 3.7.1 it doesn't look like the fix made its way in <a href="http://www.lhotka.net/cslacvs/viewvc.cgi/trunk/cslacs/Csla/Linq/CslaQueryProvider.cs?r1=3949&amp;r2=4012">(http://www.lhotka.net/cslacvs/viewvc.cgi/trunk/cslacs/Csla/Linq/CslaQueryProvider.cs?r1=3949&amp;r2=4012</a>), which is odd seeing as the change log quotes:<br><br><span id="ctl00_ContentPlaceHolder1_BodyLabel"><p class="MsoNormal"><b>LINQ to CSLA (090723)<o:p></o:p></b></p>
<p class="MsoNormal"><a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=448">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=448</a></p>
<p class="MsoNormal">Resolution to certain generic mapping issues in the method mapper caused <span class="CodeInline"><span><font color="#008000" face="Courier New">SelectMany</font></span></span> to break... resolved so that <span class="CodeInline"><span><font color="#008000" face="Courier New">SelectMany</font></span></span> method mapping is handled similar to <span class="CodeInline"><span><font color="#008000" face="Courier New">GroupJoin</font></span></span>, which has same sort of issues with mapping a generic <span class="CodeInline"><span><font color="#008000" face="Courier New">Expression</font></span></span> to a similar generic <span class="CodeInline"><span><font color="#008000" face="Courier New">Func</font></span></span>.</p></span><br>-Mike.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 04, 2009</h2><P>It is possible that the fix is only in 3.8.</P>
<P>I changed the version structure yesterday, creating a new branch for 3.7.1, while trunk is now 3.8.0.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 04, 2009</h2>Yes, that was the problem. I've now merged the 3.8 change into the 3.7.x branch.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
