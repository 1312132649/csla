<html><header><title>Silverlight serialization with MobileObject</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight serialization with MobileObject</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9891.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mudbugz posted on Monday, December 20, 2010</h2><p>The Silverlight FAQ page (<a href="http://www.lhotka.net/cslanet/faq/SilverlightFaq.ashx">http://www.lhotka.net/cslanet/faq/SilverlightFaq.ashx</a>) has a link to a Silverlight serialization page (<a href="http://www.lhotka.net/weblog/SilverlightSerializer.aspx">http://www.lhotka.net/weblog/SilverlightSerializer.aspx</a>) that has an example of how to use MobileObject for criteria classes in Silverlight 2.0.</p>
<p>In Csla 4.0.1, MobileObject doesn&#39;t have a GetValue() or SetValue() method to override. Getting and setting each individual property in OnGetState() and OnSetState() is no fun.&nbsp; So, I&#39;ve create a base class that inherits from MobileObject that does the work for me.</p>
<p>Example criteria class:</p>
<p>[Serializable()]<br />public class Person: DataPortalCriteria<br />{<br />&nbsp;public string FirstName { get; set; }<br />&nbsp;public string LastName {get; set;}<br />&nbsp;public Guid Id { get; set; }<br />&nbsp;public string LoginName { get; set; }<br />}</p>
<p>Serialize properties using reflection:</p>
<p>[Serializable()]<br />public class DataPortalCriteria : MobileObject<br />{<br />&nbsp;private static List&lt;PropertyInfo&gt; lstProperties;</p>
<p>&nbsp;protected List&lt;PropertyInfo&gt; GetProperties()<br />&nbsp;{<br />&nbsp;&nbsp;if (lstProperties == null)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;lstProperties = new List&lt;PropertyInfo&gt;();</p>
<p>&nbsp;&nbsp;&nbsp;PropertyInfo[] pis = this.GetType().GetProperties();<br />&nbsp;&nbsp;&nbsp;foreach (System.Reflection.PropertyInfo pi in pis)<br />&nbsp;&nbsp;&nbsp;&nbsp;lstProperties.Add(pi);<br />&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;return lstProperties;<br />&nbsp;}</p>
<p>&nbsp;protected override void OnGetState(Csla.Serialization.Mobile.SerializationInfo info, StateMode mode)<br />&nbsp;{<br />&nbsp;&nbsp;foreach (PropertyInfo pi in GetProperties())<br />&nbsp;&nbsp;&nbsp;info.AddValue(pi.Name, pi.GetValue(this, null));<br />&nbsp;}</p>
<p>&nbsp;protected override void OnSetState(Csla.Serialization.Mobile.SerializationInfo info, StateMode mode)<br />&nbsp;{<br />&nbsp;&nbsp;foreach (PropertyInfo pi in GetProperties())<br />&nbsp;&nbsp;&nbsp;pi.SetValue(this, info.GetValue&lt;object&gt;(pi.Name), null);<br />&nbsp;}<br />}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, December 20, 2010</h2><p>That is a good idea for your purpose. However, this only works because your properties are public. Silverlight will block non-public reflection.</p>
<p>Our base classes are designed to support normal CSLA business types - where you can&#39;t just access the properties because that&#39;d trigger business and authorization rules. So normally you have to access the <em>fields</em>, not the properties. And fields are almost always non-public, so reflection won&#39;t work.</p>
<p>You could create a MobileDto base class though, because what you are doing is creating a DTO that you want to be serializable through the data portal. As long as the DTO only has public read-write properties with no business logic this would work pretty well.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
