<html><header><title>CSLA and ViewModel&lt;T&gt;, and why I gave up</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA and ViewModel&lt;T&gt;, and why I gave up</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9000.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dagware posted on Thursday, May 27, 2010</h2><p>Before I go on, let me make it clear that I love CSLA, and think Rocky is the bomb! SO although this isn&#39;t exactly a positive post, I still love everyone. ;p</p>
<p>I&#39;ve been trying to understand how to get CSLA 3.8.3 and ViewModel&lt;T&gt; to work with&nbsp;in Parent/Child/Grandchild situation, with the children and grandchildren being sorted. I have also been trying to figure out how to have a ViewModel&lt;T&gt; for not only the child and grandchild collections, but the individual business objects also - because Rocky suggested I use a ViewModel&lt;T&gt; anywhere where I need to use Verbs.</p>
<p>I have had nothing but frustration, and no real success at all. The main problem is that I don&#39;t have enough documentation, or else enough of an example to understand how it&#39;s supposed to work. I know Rocky feels that the MVVMexperiment should be enough, but for me it just isn&#39;t.</p>
<p>It would be nice if&nbsp;someone&nbsp;could write a simple demo showing how to do a parent/child/grandchild example with all of them databound at one time (instead of clicking a button to show the children), and perhaps even how to implement ViewModel&lt;T&gt; for each child object, that would be really helpful.</p>
<p>Until then, I have to give up on it.</p>
<p>Dan</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hayrob replied on Thursday, May 27, 2010</h2><p>Can I support this post, including the first sentence!</p>
<p>The videos may well be a great resource but they are priced way out of my pocket. I have copies of all Rocky&#39;s books and ebooks since 2001, but the videos are too expensive. I have set aside a few days next week to work through the source code of Csla4.0 and I&#39;m going to try to get the samples working - I&#39;ve failed so far!</p>
<p>So please can we have some documentation coming along soon - I&#39;m happy to pay up front for it, and read it in draft.</p>
<p>(This is not really a moan - OK, it is - but a plea from someone who values Csla and wants to incorporate Csla4.0 in my next project.)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, May 27, 2010</h2><p>Dan,</p>
<p>I can relate to that.&nbsp; I have had exactly the same issues as you have narrated.&nbsp; But I didn&#39;t want to give up because the promise was too compelling.&nbsp; </p>
<p>I also have a huge object graph, and no I also never figured out how to create functioning VMs for all those children or grandchildren. Now the promise of MVVM is supposed to be do away with any and all code from the code-behind file.&nbsp; In order to do that I needed to be a lot more proficient with xaml than I currently am.&nbsp; So I decided to give up&nbsp;on that goal, and let it all be handled in the code-behind.&nbsp; So what was left was essentially the communication of my View with my Model.&nbsp; So here&#39;s what I did. It&#39;s probably not pretty but it works.&nbsp; </p>
<p>I created a single ViewModel for my Root object only.&nbsp; When any UI element needs to talk to any object in the object graph, it does that through the same one&nbsp;ViewModel, using the Model property:&nbsp; Model.MyFirstChild.MyGrandChild etc.&nbsp; For DataBinding, I do the same.&nbsp; I set the DataContext to the proper object or List in the hierarchy using MyViewModel.Model.MyChild and go from there.&nbsp; I am not finsished with my project, and probably I&#39;ll hit a brick wall one of these days - but for now it works for my limited goals.&nbsp; Can I join the MVVM club now!&nbsp; I wouldn&#39;t even want to apply yet.</p>
<p>HTH</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, May 27, 2010</h2><p>Here&#39;s a start:</p>
<p><a href="http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Samples/CslaLight/cs/CslaMvvmSl/">http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Samples/CslaLight/cs/CslaMvvmSl/</a></p>
<p>I&#39;m using this sample (and it will continue to evolve and grow) in my public presentations. It is a little less complete than the one I&#39;ve been building for the MVVM video content, but shows the most important parts.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Friday, May 28, 2010</h2><p>Hi Rocky</p>
<p>Just wanting to start experimenting with CSLA and MVVM - the sample, is that for 3.8.3 or 4.0 beta 2?</p>
<p>I&#39;ve downloaded 4.0 beta 2 and got the above sample source from SVN. I&#39;ve updated the references in the&nbsp;sample to point to&nbsp;&nbsp;the appropriate assemblies. When I run it it seems to go OK but when I click the Save button (adding a new Person) I get a missing method exception (and get thrown into the runtime debugger).</p>
<p>The exact exception is:</p>
<p>Webpage error details</p>
<p>User Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; WOW64; Trident/4.0; GTB6.4; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.5.30729; FDM; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E; Zune 4.0; OfficeLiveConnector.1.5; OfficeLivePatch.1.3)<br />Timestamp: Fri, 28 May 2010 10:09:13 UTC</p>
<p><br />Message: Unhandled Error in Silverlight Application <br />Code: 4004&nbsp;&nbsp;&nbsp; <br />Category: ManagedRuntimeError&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />Message: System.MissingMethodException: Save<br />&nbsp;&nbsp; at Csla.Xaml.TriggerAction.CallMethod(Object sender, EventArgs e)<br />&nbsp;&nbsp; at System.Windows.Controls.Primitives.ButtonBase.OnClick()<br />&nbsp;&nbsp; at System.Windows.Controls.Button.OnClick()<br />&nbsp;&nbsp; at System.Windows.Controls.Primitives.ButtonBase.OnMouseLeftButtonUp(MouseButtonEventArgs e)<br />&nbsp;&nbsp; at System.Windows.Controls.Control.OnMouseLeftButtonUp(Control ctrl, EventArgs e)<br />&nbsp;&nbsp; at MS.Internal.JoltHelper.FireEvent(IntPtr unmanagedObj, IntPtr unmanagedObjArgs, Int32 argsTypeIndex, String eventName)&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>Line: 54<br />Char: 13<br />Code: 0<br />URI: <a>file:///F:/Visual%20Studio%20Projects/CslaMvvmSl/CslaMvvmSl/Bin/Debug/CslaMvvmSlTestPage.html</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>What gives?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 28, 2010</h2><p>That is in /core/trunk, so it is CSLA 4.</p>
<p>The basic concepts and structures should mostly work in 3.8 too - but the code itself won&#39;t. There&#39;ve been some enhancements to the TriggerAction and ViewModel&lt;T&gt;&nbsp;types for CSLA 4.</p>
<p>I think the particular issue you are encountering is due to TriggerAction. The 3.8 TriggerAction doesn&#39;t include all the code to dereference CollectionViewSource objects, so you need to make sure the DataContext is set to the current item explicitly (by setting Path to / or CurrentItem).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Friday, May 28, 2010</h2><p>Rocky -</p>
<p>We are in the same boat and would like to look through this sample you have provided a link to, but, we are unable to download it.. I guess it is a part of source control? Can you please provide a link outside of that to download it? Or am i missing something , here?</p>
<p>Thanks much for all the guidance you continue provide</p>
<p>Ranjini</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 28, 2010</h2><p>Right now it is in the source code repository, and it will be in the CSLA 4 Beta 3 download in a couple weeks.</p>
<p>In the meantime you can use TortoiseSvn or a similar tool to pull it from source control: <a href="http://www.lhotka.net/cslanet/Repository.aspx">http://www.lhotka.net/cslanet/Repository.aspx</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dagware replied on Friday, May 28, 2010</h2><p>It&#39;s good to know I&#39;m not alone in my issues. And thanks, Rocky, for responding. Unfortunately I won&#39;t be able to fiddle with this any further right now, because I&#39;m going a different direction in the project I&#39;m working on right now, and of course, deadlines are deadlines.</p>
<p>But I didn&#39;t want you to think I didn&#39;t appreciate the response, because I do!</p>
<p>Good luck to everyone else. I&#39;ll be curious to see how you all do.</p>
<p>Dan</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Saturday, May 29, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>
<p>That is in /core/trunk, so it is CSLA 4.</p>
<p>The basic concepts and structures should mostly work in 3.8 too - but the code itself won&#39;t. There&#39;ve been some enhancements to the TriggerAction and ViewModel&lt;T&gt;&nbsp;types for CSLA 4.</p>
<p>I think the particular issue you are encountering is due to TriggerAction. The 3.8 TriggerAction doesn&#39;t include all the code to dereference CollectionViewSource objects, so you need to make sure the DataContext is set to the current item explicitly (by setting Path to / or CurrentItem).</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>Thanks for the reply Rocky, but I&#39;m still confused. The question about 3.8 vs 4.0 was due to the originator of this thread referring to 3.8.</p>
<p>However, I&#39;ve now got 4.0 beta 2 downloaded and am trying to run the CslaMvvmSl sample - targetting Silverlight 4, using CSLA 4 beta 2. It runs, but the Save and Cancel buttons both cause the exception. Are you saying that in 4.0 this doesn&#39;t actually work?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, May 29, 2010</h2><p>It works in CSLA 4 beta 3. Please remember, this is beta code. So as I&#39;m working with it (and hopefully you and others too) I find bugs/issues and address them. While the rate of change is becoming very low at this point, there are still some changes - including in ViewModelBase&lt;T&gt; and TriggerAction.</p>
<p>The changes to TriggerAction aren&#39;t strictly <i>necessary</i>. You can always force the binding Path to &#39;CurrentItem&#39; or &#39;/&#39;, but I figured out a way to make that unnecessary, by having TriggerAction be aware of the CollectionViewSource type. But that change was put in place after beta 2...</p>
<p>I realize the original question was for 3.8 - but 3.8 is in maintenance mode now, and all my attention is on 4. These periods of transition are always a little complicated, but ultimately I only have so much bandwidth...</p>
<p>But things are a little different in .NET 3.5 anyway. While you <i>can</i> use a CollectionViewSource in 3.5, most people don&#39;t. They set the datacontext directly to the viewmodel - in which case the 3.8.3 TriggerAction works great. I had never used CollectionViewSource at all until I started using the VS10 XAML designer...</p>
<p>It is really important to remember that MVVM is a design pattern - a broad guideline of a concept. The specific details of implementing any pattern often vary depending on technology, product versions and so forth. That&#39;s true for all patterns.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Saturday, May 29, 2010</h2><p>Thanks for the claification.</p>
<p>So if I us SVN to get the latest to play with it should work then.</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
