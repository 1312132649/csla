<html><header><title>Method definition question for IStartEnd in abstract class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Method definition question for IStartEnd in abstract class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1969.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin posted on Wednesday, December 13, 2006</h2>I have a base class that needs to implement IStartEnd.&nbsp; The database stores addresses in child tables:<br><br>AddressTable - stores all addresses<br>OfficeAddressTable - links OfficeTable to AddressTable<br>PersonAddressTable links PersonTable to AddressTable<br><br>Address itself is a base class, so I thought I might uses a base class for Office Address Assignements:<br><br><font color="#006400" size="2">[Serializable()]<br>&nbsp;&nbsp;&nbsp; public abstract class BaseAddressAssignment&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : BusinessBase&lt;T&gt;where T : BaseAddressAssignment&lt;T&gt;</font><br><br>I need to implement IStartEnd to something like this effect:<br><br><font color="#006400" size="2">[Serializable()]<br>&nbsp;&nbsp;&nbsp; public abstract class BaseAddressAssignment&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : BusinessBase&lt;T&gt;where T : BaseAddressAssignment&lt;T&gt;<font color="#0000ff">, IStartEnd<br><br><font color="#000000" size="3">Or this?<br><br><font color="#006400" size="2">[Serializable()]<br>&nbsp;&nbsp;&nbsp; public abstract class BaseAddressAssignment&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : BusinessBase&lt;T&gt;, <font color="#0000ff">IStartEnd</font> where T : BaseAddressAssignment&lt;T&gt;, <font color="#0000ff">IStartEnd<br><br><font color="#000000"><font size="3">The problems is how I now define the StartEndDate validation implementation as used in the project tracker. If I use:<br><br><font size="2"><font color="#0000ff">private static bool StartDateGTEndDate&lt;T&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T target, Csla.Validation.RuleArgs e) where T : IStartEnd</font><br><br><font size="3"><font color="#ff0000">The parameter type T has the same name for outer type.</font>&nbsp; This makes sense.<br><br>So here is my question: How do I define an abstract base class that will implement IStartEnd?<br><br>I also noticed that I will have to do something different when adding Business Rules:<br><br><font size="2">ValidationRules.AddRule&lt;BaseAddressAssignment&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StartDateGTEndDate&lt;BaseAddressAssignment&gt;, "Started");<br><br><font size="3">In this case, there error message is:&nbsp; <font color="#ff0000">The generic type... requires '1' type argument</font>.<br><br>Since I do not have my definitions correctly stated though, I cannot say whether or not this is simply a side effect of an incorrect definition.<br></font></font><br>Thank you.<br><font size="2"><br><br></font></font></font><br><br></font></font></font></font></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, December 13, 2006</h2>OK, quick and (very) dirty sample:<br><br><br>&nbsp;&nbsp;&nbsp; public interface IStartEnd<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DateTime Date { get; set; }<br>
&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class BaseAddressAssignment&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Csla.BusinessBase&lt;T&gt;, IStartEnd where T : BaseAddressAssignment&lt;T&gt;<br><br>&nbsp;&nbsp;&nbsp; {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void AddBusinessRules()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.AddBusinessRules();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule&lt;IStartEnd&gt;(<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CustomRules.StartDateGTEndDate&lt;IStartEnd&gt;, <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "Date");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DateTime Date<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return DateTime.Now; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class CustomRules<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static bool StartDateGTEndDate&lt;T&gt;(T target, Csla.Validation.RuleArgs e) <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; where T : IStartEnd<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>Is that what you where trying to do? or did I get it completely wrong?<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, December 13, 2006</h2>I think I get what you mean now... if you don't want to use the interface as a generic param (for whatever reason), you just specify the current type.<br>Now, you must be thinking, BaseAddressAssignment IS my current type, but no it's not.<br>As your class definition states, the type for the current class is BaseAddressAssignment&lt;T&gt;, so you should add it like this:<br><br>ValidationRules.AddRule&lt;BaseAddressAssignment&lt;T&gt;&gt;(<br>&nbsp;&nbsp;&nbsp; CustomRules.StartDateGTEndDate&lt;BaseAddressAssignment&lt;T&gt;&gt;, <br>&nbsp;&nbsp;&nbsp; "Date");<br><br>aaaah... Generics!! I know I bumped my head against the wall (more than) a few times until I finally got it... :D<br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 13, 2006</h2><P>In retrospect that interface approach for the rule method was not the best answer... It turns out that there's a much simpler answer to the problem that I just missed <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /></P>
<P>Shared/static methods in a class have access to the fields of instances of that class, so the rule method <EM>should</EM> look like this:</P>
<P>&nbsp; private static bool StartDateGTEndDate&lt;T&gt;(T target, RuleArgs e) where T: Project<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; if (target._started &gt; target._ended)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "..."<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<BR>&nbsp; }</P>
<P>This way the interface isn't needed at all - much cleaner and simpler.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, December 13, 2006</h2>Unless of course you DO plan to have many different classes that have a start/end date that aren't necessarily inheriting from project or addressbase (like in jspurlin's sample). In that case it does make perfect sense to have an interface and just one common rule that applies to all...<br><br>I remember once creating a collection + child object that where something along the lines of:<br><br><br><br>Public Class DateRangeCollection(Of T As DateRangeCollection(Of T,C), C As {BusinessBase(Of C), IDateRange})<br>Inherits BusinessListBase(Of T, C)<br><br>End Class<br><br>The collection, along with the object that implemented such interface would mark child items that where invalid because their date ranges collided with others. It also did grouping of items, like for instance, a project can have the same resource twice, but not on an overlapping date range, and of course, different resources could be in the project at the same time.<br><br>This collection + interface handled all of those cases (and a couple more) very very well. It took a few tries to get there, because performance became an issue when you had 200+ items (I had 20.000 in one case). It also had to handle adding, removing and editing of the child items, so it was an interesting challenge.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Thursday, December 14, 2006</h2>What I am trying to do is implement the IStartEnd interface in an abstract class where generic type T is used to inherit BusinessBase.&nbsp; So this method definition works for other abstract classes that need to inherit from BusinessBase:<br><font color="#006400"><br><font size="2">[Serializable()]<br>&nbsp;&nbsp;&nbsp; public abstract class BasePerson&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : BusinessBase&lt;T&gt; where T : BasePerson&lt;T&gt;</font></font><br><br>And this I think is what to do to implement the IStartEnd interface<br><br><font color="#006400"><font size="2">[Serializable()]<br>&nbsp;&nbsp;&nbsp; public abstract class BaseAddressAssignment&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : BusinessBase&lt;T&gt;</font><font color="#ff0000" size="2">, IStartEnd</font><font size="2"> where T : BaseAddressAssignment&lt;T&gt;</font><br><br><font color="#000000">Adding Business rules by your suggestion works:<br><br><font color="#006400"><font size="2">ValidationRules.AddRule&lt;</font><font color="#0000ff" size="2">IStartEnd</font><font size="2">&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StartDateGTEndDate&lt;</font><font color="#0000ff" size="2">IStartEnd</font><font size="2">&gt;, "Started");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule&lt;</font><font color="#0000ff" size="2">IStartEnd</font><font size="2">&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StartDateGTEndDate&lt;</font><font color="#0000ff" size="2">IStartEnd</font><font size="2">&gt;, "Ended");</font><br><font color="#000000"><br>The problem is with the method <u>StartDateGTEndDate:<br><br></u><font size="2">private static bool StartDateGTEndDate&lt;</font><font color="#0000ff" size="2">T</font><font size="2">&gt;(</font><font color="#0000ff" size="2">T</font><font size="2"> target, RuleArgs e) where </font><font color="#0000ff" size="2">T</font><font size="2"> : BaseAddressAssignment&lt;</font><font color="#0000ff" size="2">T</font><font size="2">&gt;</font><br><br>T is already used for the outer type BaseAddressAssignment. But this actually may not be the best way to call it. I was thinking this particular business rule / validation rule / method (IStartEnd) could be "automatically" used, but "hidden" from the AddressAssignment classes (there are only 2) that will inherit from it.<br><br>I have not yet got that method signature to compile, but again, as XAL pointed out as generics where once new to him, they are new to me. Since StartDate and EndDate are fields to the linking tables OfficeAddress and PersonAddress I am struggling with correct object composition, too.<br><br>Here is the quandry:&nbsp; A single address may have more than one StartDate and EndDate.&nbsp; For example, we are coding for a hospices where things really have to check out for billing in order for Medicare to reimburse. So if an office moves, we need to make sure during billing the correct address is used or reimbursements are not made and the hospice staff does not get paid.&nbsp; It sounds complicated:&nbsp; correct object composition is not so difficult to understand.&nbsp; It becomes "not so easy" to do when "social logic" is added!<br></font></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 14, 2006</h2>Maybe I haven't been following closely enough, but if an address can have a start and end date (and multiple ones, maybe you need a collection of addresses, and each one has its own distinct start and end date.&nbsp; Would that help clean things up for you?<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, December 14, 2006</h2>If you just want your rule method to apply to anything deriving from BaseAddressAssignment, and you're going to implement it in that base class, all you need to do is this:<br><br><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2">private static bool StartDateGTEndDate(BaseAddressAssignment&lt;T&gt; target, RuleArgs e) { return true; }<br></font></font></font></font></font><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2"><br></font><font size="2"></font><font size="2">and add the rule like:<br>ValidationRules.AddRule&lt;BaseAddressAssignment&lt;T&gt;&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StartDateGTEndDate, "StartDate");<br></font></font></font></font></font><br><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2"><br>========================================================================<br><br>If you want the method outside the base class and want it to apply to any IStartEnd, then you just do:<br><br></font></font></font></font></font><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2">private static bool StartDateGTEndDate</font><font size="2">(IStartEnd</font></font></font></font></font><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2"> target, RuleArgs e) {...}<br><br>And add the rule like:<br></font></font></font></font></font><font color="#006400"><font color="#000000"><font color="#006400"><font color="#000000"><font size="2">ValidationRules.AddRule&lt;IStartEnd&gt;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StartDateGTEndDate, "StartDate");</font></font></font></font></font><br><br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jspurlin replied on Thursday, December 14, 2006</h2>Thank you, I will put it to use and let you know in a little bit.<br><br>ajj385, it is an interesting design problem (which may sound confusing, but it is really about scenarios where Medicare can reject a claim).<br><br>So the object composition is pretty key here. What I may need to do is add a collection of AddressAssignments to the OfficeAddress class.<br><br>Xal, you have been great help.&nbsp; Thank you.<br>jspurlin<br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
