<html><header><title>FAQ: How to use Windows authentication in PTracker (PTWin) (C#)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>FAQ: How to use Windows authentication in PTracker (PTWin) (C#)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5781.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Tuesday, November 11, 2008</h2><P>I want to keep the Csla authentication PTracker currently uses but optionally use Windows authentication and&nbsp;Csla authorization as follows:<BR><STRONG>Windows authentication</STRONG> - the application believes in the user identity that it gets from Windows and doesn't (re)check for the user password.<BR><STRONG>Csla authorization</STRONG> - the application uses the user roles table table.<BR><BR><STRONG>Possible uses:</STRONG><BR>Full application server<BR>- The user won't have access to the SQL Server.<BR>- The solution will use an aplication server and Remoting.<BR>- The user must be logged on the same domain of the application server.<BR>SQL Server (with no application server)<BR>- If the user has access to the SQL Server, Windows autehtication will also work as expected.<BR>N.B. - On both scenarios, no domain checks are made for SQL Server access (i.e. it can be on a different domain).</P>
<P><STRONG>"Not logged in domain" use case</STRONG><BR>When I go to a customer, I use my laptop and I'm not logged in the customer's domain. I must use an "admin" user of the application.<BR>If the Windows domain\identity is unknown to PTracker, it shows the login window.</P>
<P><STRONG>1. Application version and VS2008<BR></STRONG>1.1. Use version 3.0.5 of the application (and of Csla framework as well)<BR>1.2. Convert it to VS2008</P>
<P><STRONG>2. Backup</STRONG><BR>2.1, Make a backup of "<FONT face="Courier New">ProjectTracker.Library\Security</FONT>" folder<BR>2.2. Make a backup of "<FONT face="Courier New">MainForm.cs</FONT>" file<BR><BR><STRONG>3. Update PTracker<BR></STRONG>3.1. Unzip the attached file "<FONT face="Courier New">PTrackerWindowsAuthentication-0.1.zip</FONT>" on top of your "<FONT face="Courier New">ProjectTrackercs</FONT>" folder<BR>3.2. Open the solution under VS2008<BR>3.3. Select "<FONT face="Courier New">ProjectTracker.Library</FONT>" project<BR>3.4. Click "Show All Files"<BR>3.5. Unfold "Security"<BR>3.6. Select "<FONT face="Courier New">NetworkInformation.cs</FONT>" and "<FONT face="Courier New">PTUser.cs</FONT>"<BR>3.7. Right-click those files and select "Include In Project" (don't forget to click "Show All Files" again)</P>
<P><STRONG>4. Test new files</STRONG><BR>4.1. Rebuild the solution and test application login works as it did before the update<BR>4.2. Select "<FONT face="Courier New">PTwin</FONT>" project and edit "<FONT face="Courier New">App.config</FONT>"<BR>4.3. Change <FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">&lt;</FONT></FONT></FONT><FONT face="Courier New"><FONT color=#a31515 size=2><FONT color=#a31515 size=2>add</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2> </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>key</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>=</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CslaAuthentication</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2> </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>value</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>=</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Csla</FONT></FONT><FONT size=2>"</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New"> /&gt;</FONT></FONT></FONT>&nbsp;to <FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">&lt;</FONT></FONT></FONT><FONT face="Courier New"><FONT color=#a31515 size=2><FONT color=#a31515 size=2>add</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2> </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>key</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>=</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CslaAuthentication</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2> </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>value</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>=</FONT></FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Windows</FONT></FONT><FONT size=2>"</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New"> /&gt;</FONT></FONT></FONT>&nbsp;and rebuild the project<BR>4.4. If you are using a full application server, make the same change in "<FONT face="Courier New">Web.config</FONT>" of "<FONT face="Courier New">...\RemotingHost\</FONT>", build this Web Site and publish it again<BR>4.5. Use a Windows login that is in the "<FONT face="Courier New">Users</FONT>" table of the "<FONT face="Courier New">Security</FONT>" database - PTracker shouldn't show the login window and you should have the correct configured roles<BR>4.6. Use a Windows login that is NOT in the "<FONT face="Courier New">Users</FONT>" table - PTracker SHOULD show the login window and behave as it did before the update<BR>4.7. You can revert step 4.3 in order to use the old Csla authentication.</P>
<P><STRONG>5. Why "<FONT face="Courier New">NetworkInformation.cs</FONT>"?</STRONG><BR>This is used to find out the domain name and the joined status (is it an AD domain or a Workgoup or what?)<BR>"<FONT face="Courier New">PTPrincipal.cs</FONT>" uses it in order to store the joined status and domain name in <FONT color=#2b91af size=2><FONT color=#2b91af size=2><FONT face="Courier New">ApplicationContext</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2>.ClientContext[</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"LocalStatus"</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">]</FONT></FONT>and in&nbsp;<FONT color=#2b91af size=2><FONT color=#2b91af size=2><FONT face="Courier New">ApplicationContext</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2>.ClientContext[</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"LocalDomain"</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">]</FONT></FONT>respectively.<BR>"<FONT face="Courier New">PTIdentity.cs</FONT>" uses it in <FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">private</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LoadOnlyCriteria</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> criteria)</FONT></FONT>&nbsp;when trying to to Windows authentication, as it must compare the status and domain of the application server with those of the user.<BR><FONT face="Courier New">PTUser.cs</FONT> also uses it.<BR>N.B. - Read the copyleft notice.</P>
<P><STRONG>6. Why "<FONT face="Courier New">PTUser.cs</FONT>"?</STRONG><BR>Information about the user is scattered around in a bunch a different namesspaces. This is a way to put it together in a single static object. "<FONT face="Courier New">MainForm.cs</FONT>" uses it to display some appropriate datails when authetication fails.</P>
<P><STRONG>7. I don't need/want the "Not logged in domain" use case</STRONG><BR>This means when Windows authenticaton is used no Csla authentication is&nbsp;allowed<BR>7.1. In "<FONT face="Courier New">PTPrincipal.cs</FONT>", go to <FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">public</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> Login(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> username, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> password)</FONT></FONT>&nbsp;and follow the instructions<BR>7.2. In "<FONT face="Courier New">MainForm.cs</FONT>", got to <FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">private</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> DoLoginWindows()</FONT></FONT>&nbsp;and follow the instructions near "// now ask for login/password"</P>
<P>--<BR>Tiago Freitas Leal<BR></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
