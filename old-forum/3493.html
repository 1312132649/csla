<html><header><title>Making an Editable Root Read-Only</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Making an Editable Root Read-Only</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3493.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>David posted on Thursday, September 06, 2007</h2>I have an Editable Root object (an&nbsp;Invoice)&nbsp;that becomes Read-Only when its&nbsp;Status property is set to Finalised. What is the best way to&nbsp;enforce this?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RikGarner replied on Thursday, September 06, 2007</h2><P>We do this by overriding the CanWriteProperty method in the object; internally we have a permissionResolver object that knows what state the object is in and whether the user has permission to alter the object.</P>
<P><FONT color=#0000ff size=1>public</FONT><FONT size=1> </FONT><FONT color=#0000ff size=1>override</FONT><FONT size=1> </FONT><FONT color=#0000ff size=1>bool</FONT><FONT size=1> CanWriteProperty(</FONT><FONT color=#0000ff size=1>string</FONT><FONT size=1> propertyName)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=1>&nbsp;&nbsp;&nbsp;return</FONT><FONT size=1> _permissionResolver.Permission == </FONT><FONT color=#2b91af size=1>PermissionLevel</FONT><FONT size=1>.Write;</P>
<P>}</P></FONT>
<P>&nbsp;</P><FONT size=1></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Tuesday, February 05, 2008</h2><P>Would you be willing to shed some light on your implementation of the permissionResolver?&nbsp; I have a few different states for my object and I'm wondering how best to model such an implementation.</P>
<P>How does it get info/data about the business object?</P>
<P>Thanks,</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, February 06, 2008</h2>You may also use the ReadWriteAuthorization control&nbsp; in Csla to set ReadOnly/Enabled/Visible on UI components based on the CanWriteProperty / CanReadProperty.<br><br>Jonny<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Wednesday, February 06, 2008</h2>I am already using the ReadWriteAuthorization control to control the UI components.&nbsp; What I'm trying to do is have the CanWriteProperty use a helper class (like permissionResolve) to determine the state of the object and it's children (based on object variables like dates, status, etc.) and return the correct value (true or false) based on that state.&nbsp; So, I'm interested in understanding how to implement such a class per my questions above.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, February 06, 2008</h2>If you have a private field in the root bo that determines if can be changed, you can check that in a CanWriteProperty override.<br><br>public override CanWriteProperty( string propertyName ) {<br>&nbsp;&nbsp; if ( isLocked ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  return false;<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; return base.CanWriteProperty( propertyName );<br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Wednesday, February 06, 2008</h2>I do have some private fields in the root of the bo.&nbsp; So, that would work.&nbsp; However, I also need to implement this override in the children and grand-children (dependent on the same parent properties).&nbsp; And, although I understand there are topics on sharing data&nbsp;down to&nbsp;children and grandchildren, I know it's typically not a good idea because it causes tight coupling.&nbsp; That's why the thought of a helper class like permsissionResolver intrigues me.&nbsp; However, I'm not sure how&nbsp;I would go about implementing that class.&nbsp; Maybe that class isn't as "robust" as I initially thought (maybe it doesn't handle a situation like mine).&nbsp; Maybe my situation can't be solved without sharing data down to children and grandchildren (in which case I should use interfaces maybe)?&nbsp; I've been using CSLA for a year or so now but I'm still not real keen on "advanced" OO techniques such as this so any help/guidance would be greatly appreciated!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SomeGuy replied on Wednesday, February 06, 2008</h2><P>Assuming that you know that Status is Finalized at load time, couldn't you set a flag on the Child Objects as you fetch them to make them read only.</P>
<P>E</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RikGarner replied on Wednesday, February 06, 2008</h2><P>I don't think my PermissionResolver addresses your problem. When I originally wrote that post I was using a PermissionResolver which contained&nbsp;a bunch of common functions and then subclassing it for state management of different types, e.g. DocumentPermissionResolver. These subclassed objects would know how to adapt to changes in state of their 'host object' by setting properties on it when things changed - PropertyHasChanged is useful here.</P>
<P>As the design and code progressed this began to get really complicated and, in the end, it was easier to just use the PermissionResolver to work out the allowed access level based on external information (a permission table, whether a user was assigned to a team etc) and manage the access based on the state of the instance as internal variables as ajj3085 suggests. </P>
<P>In practice the state management stuff was less complicated than it felt it was going to be when we started.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
