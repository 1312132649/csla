<html><header><title>Another Undo question with a Business base with a child collection bound to DevExpress Grid</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Another Undo question with a Business base with a child collection bound to DevExpress Grid</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9670.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>timster posted on Monday, October 25, 2010</h2><p>I know this type of question has been rehashed time and time again and I should think that forum members are probably sick to the back teeth with this subject but I have looked high and low on the&nbsp;web for a solution to a problem and I just can&#39;t seem to get a sensible solution.</p>
<p>I am using CSLA 3.7, I have a Winform with three controls bound using a binding source to a Business base derived object that is an editable root with a child collection.&nbsp; The collection is bound to a Dev Express grid.&nbsp; The collection consists of a single value for each item that I want to edit &quot;in grid&quot;.&nbsp; I am using the Bind and Rebind methods as suggested in the forums.</p>
<p>Everything appears to work correctly as far as undo is concerned.&nbsp; I change a property on the root object, press my undo button and everything rebinds and works fine.&nbsp; I change a value in the grid, press escape, and the field reverts back to its previous value.&nbsp; So I know the mechanism is working perfectly and the Dev Express grid is working as it should in terms of BeginEdit, CancelEdit and EndEdit..&nbsp; Note I want to re-iterate - the grid IS working as it should.</p>
<p>The problem is this is not the desired behaviour I require.&nbsp; I want to be able to undo all the changes made to the child collection when I press the undo button.&nbsp; I have tried combinations of begin edit, end edit, taking cloned snapshots (the problem is with the latter is I could end up rehashing all the N-level undo code in my UI!), and all I seem to get is the EditLevel mismatch error.&nbsp; Hours of research and trial and error have resulted in no progress whatsoever.</p>
<p>Another issue I wish to implement is to recover from save errors and rebind the UI to a snap shot of the object graph to it can be rebound with undo history still intact.&nbsp; Surely if business logic exists within the database as well as business objects then when an error is detected and returned through the data access layer, the user will want to correct the error.&nbsp; In my opinion this is&nbsp;a fundamental requirement that seems to have been overlooked (purists will say this should occur BUT in some cases business logic needs to be&nbsp;replicated or can only occur within the database - concurrency issues being a typical example).</p>
<p>It seems I am jumping through hoops to solve a very simple and common problem.&nbsp; From articles I have read on this and the dev express forums it seems that very complex solutions are offered.&nbsp; I believe the solution is probably very fundamental. </p>
<p>So can someone please help me solve this problem - am I using the correct control (each row in the grid only has one value to edit).&nbsp; Is there something I should be doing&nbsp;in the child collection?&nbsp; Can I override the&nbsp;edit level&nbsp;changes in the parent&nbsp;and cascade through all the children?&nbsp;&nbsp;&nbsp;</p>
<p>Thanks</p>
<p>Tim</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, October 25, 2010</h2><p>Your description here is exactly as Windiows Forms Databinding should normally work.&nbsp;</p>
<p>When your objects are databound you should never call BeginEdit/CancelEdit or EndEdit so the semantics would be like this:</p>
<p>1. call root.BeginEdit<br />2. set up databinding to connect UI to business objects</p>
<p>Undo:<br />10. disconnect databinding <br />11. call root.CancelEdit<br />12. call 1) to setup databinding</p>
<p>You may have a &quot;larger&quot; undo but that can only be used when object is not active in databinding. </p>
<p>Ie -&nbsp; WinForms databinding assumes it has full control on the Begine/Cancel/EndEdit process so if you want to control it yourself then it must be done with objects that are not active in databinding. Hence before your form is connected to business objects or after they are disconnected.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timster replied on Tuesday, October 26, 2010</h2><p>Jonny</p>
<p>I think this makes sense now and I can correct my code to make it work correctly.&nbsp; I well let you know how I do!</p>
<p>Thank you for your help</p>
<p>Tim</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
