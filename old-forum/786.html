<html><header><title>Nested Undo (Don't Try This At Home)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Nested Undo (Don't Try This At Home)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/786.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tsmo posted on Tuesday, August 01, 2006</h2>Given a parent object with a child object, the following use case fails with CSLA's undo implementation:<br><br>1) Begin an edit on the parent. (child has state "A")<br><br>2) Begin an edit on the child. (child still has state "A")<br><br>3) Make a change on the child (child has state "B")<br><br>4) Begin an edit on the child.&nbsp; (child still has state "B")<br><br>5) Make a change on the child. (child has state "C")<br><br>6) Cancel edit on the parent.<br><br>The expected result would be that the child would now have state "A", as it did when the parent began its current edit.&nbsp; The actual result is that the child is restored to state "B".<br><br>From stepping through the code it seems that the reason for this is that UndoEdit's cascade un-does the last edit on the child's scope, rather than the parent's.&nbsp; <br><br>I've got a feeling that there's a pragmatic explanation for this behavior having to do with memory use, and that this isn't so much a bug as a lack of support for bizarre and reckless behavior.&nbsp; In any case, I'd love to know the technical reasons behind this situation.<br><br>Thanks,<br>tsmo<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 09, 2006</h2>I think I answered this and then the server's hard drive crashed...<br><br>The answer is that n-level undo requires that every BeginEdit() call on an object have a matching CancelEdit() or ApplyEdit() on that same object, within the same call scope.<br><br>In other words, n-level undo is a nested operation, and each call to BeginEdit() creates a new nesting level that must be committed or rolled back before any previous level is committed or rolled back.<br><br>For details see Chapter 3.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
