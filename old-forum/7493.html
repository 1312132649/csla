<html><header><title>Configuring Csla DataPortal / WCF / Endpoints</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Configuring Csla DataPortal / WCF / Endpoints</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7493.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry posted on Friday, August 21, 2009</h2>I'm wondering what the right way is to set up the WCF configuration for a Silverlight project.  I've got it working with a reference to the dev box in ServiceReferences.ClientConfig, but of course I have to put a different address in and recompile when deploying.<br /><br />&amp;lt;endpoint address="http://localhost/AgService/WcfPortal.svc" binding="basicHttpBinding" bindingConfiguration="basicHttpBinding_IWcfPortal"<br />              contract="Csla.WcfPortal.IWcfPortal" name="CslaWcfPortal" /><br /><br />I've tried setting the end point at startup, but I don't seem to get the pieces just right and of course the call fails.<br /><br />Uri cslaEndpointUri = new Uri(Application.Current.Host.Source, "/AgService/WcfPortal.svc");<br />           Csla.DataPortalClient.WcfProxy.DefaultUrl = cslaEndpointUri.AbsoluteUri;<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Friday, August 21, 2009</h2>You actually do not need to recompile this reference.  Once you have created your XAP file for deployment and deployed it to the target server, you can just unzip the content of the XAP file (you can rename it to .zip extension first), update your ClientConfig, then zip it back in, and rename the file back to XAP extension.  This is a typical deployment procedure anyway because you do not know in advance what the server address is.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: esaulsberry [mailto:cslanet@lhotka.net] <br />Sent: Friday, August 21, 2009 4:52 PM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] Configuring Csla DataPortal / WCF / Endpoints<br /><br />I'm wondering what the right way is to set up the WCF configuration for a Silverlight project.  I've got it working with a reference to the dev box in ServiceReferences.ClientConfig, but of course I have to put a different address in and recompile when deploying.<br /><br />              contract="Csla.WcfPortal.IWcfPortal" name="CslaWcfPortal" /><br /><br />I've tried setting the end point at startup, but I don't seem to get the pieces just right and of course the call fails.<br /><br />Uri cslaEndpointUri = new Uri(Application.Current.Host.Source, "/AgService/WcfPortal.svc");<br />           Csla.DataPortalClient.WcfProxy.DefaultUrl = cslaEndpointUri.AbsoluteUri;<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry replied on Friday, August 21, 2009</h2>Idealy I'd be able to pick it up at run time.  Thanks for the tip though.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 24, 2009</h2><P>If you want it at runtime you may need to have the host web page provide the value to the SL runtime via script.</P>
<P>In other words, the web server could render the address into the web page so the web page has the correct value - and it would then use script to provide that value to the SL runtime.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry replied on Monday, August 24, 2009</h2>Thanks for responding.<br /><br />I can get the address pushed down into the SL app, it's how to override the config settings on the portal that's causing me trouble.<br /><br />I've been trying variations on this to do it but I haven't been successfull.<br />        private void SetCslaBinding()<br />        {<br />            string endpointFromWeb = HtmlPage.Window.Invoke("GetEndpointHost", null) as string;<br />            ServerHost = endpointFromWeb;<br />            Uri cslaEndpointUri = new Uri(Application.Current.Host.Source, "/AgService/WcfPortal.svc");<br /><br />            Csla.DataPortalClient.WcfProxy.DefaultUrl = cslaEndpointUri.AbsoluteUri;<br />            System.ServiceModel.BasicHttpBinding cslaBinding = new System.ServiceModel.BasicHttpBinding();<br />            cslaBinding.Name = "basicHttpBinding_IWcfPortal";<br />            cslaBinding.MaxBufferSize = int.MaxValue;<br />            cslaBinding.MaxReceivedMessageSize = int.MaxValue;<br />            <br />            Csla.DataPortalClient.WcfProxy.DefaultBinding = cslaBinding;<br />            Csla.DataPortalClient.WcfProxy.DefaultEndPoint = "/AgService/WcfPortal.svc";<br />        }<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 24, 2009</h2><P>Is there a bug in WcfProxy that is preventing that from working? The intent is that you can set the properties explicitly and override the config file values.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry replied on Monday, August 24, 2009</h2>More likely I'm doing something wrong.  Don't know what though.  <br /><br />Bah.  Now I know what it is.  Nothing like having to explain the problem for seeing it.<br /><br />What I was doing was providing the wrong value for <br />Csla.DataPortalClient.WcfProxy.DefaultEndPoint = "CslaWcfPortal";<br /><br />The value I was giving was more the address.  What threw me I think was I expected to have to supply an object that provided the information that's in the config file for the endpoint, such as the contract, etc.  It's always blindingly obvious... once you figure it out.<br /><br />Thanks<br />Elton</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jack replied on Tuesday, August 25, 2009</h2>Elton,<br><br>Would you mind summarizing for a FAQ how you implemented this?&nbsp; I'd like to put something together such that I can push the selection of the environment to log into down to the first page the user sees.<br><br>Thanks<br><br>jack<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esaulsberry replied on Tuesday, August 25, 2009</h2>The way I push a string from the html to the client is like this:<br />I have a hidden field on the page that contains the SliverLight control.<br /><br /><br />This is populated when the page loads:<br />	protected void Page_Load(object sender, EventArgs e)<br />	{<br />	        hdnEndpoint.Value = Request.ServerVariables["HTTP_HOST"].ToString();<br />	}<br />There is a JavaScript function to provide this to the SilverLight app:<br />    <br />        function GetEndpointHost() {<br />            var hostField = document.getElementById('hdnEndpoint');<br />            if (hostField) {<br />                return hostField.value;<br />            }<br />            else {<br />                return ('no host');<br />            }<br />        }<br />    <br />There's probably a way to do this just with JavaScript, but I was unwilling to spend any time finding it.<br /><br />In the startup of the SilverLight app (App.xaml.cs):<br />    public partial class App : Application<br />    {<br />        public static string ServerHost { get; set; }<br />...<br />        private void Application_Startup(object sender, StartupEventArgs e)<br />        {<br />			ControlContainer cont = new ControlContainer();<br />			LoginPage lp = new LoginPage(cont);<br />			cont.SetContent(lp);<br />			this.RootVisual = cont;<br /><br />		        SetCslaBinding();<br /><br />        }<br /><br />        private void SetCslaBinding()<br />        {<br />            string endpointFromWeb = HtmlPage.Window.Invoke("GetEndpointHost", null) as string;<br />            ServerHost = endpointFromWeb;<br />            Uri cslaEndpointUri = new Uri(Application.Current.Host.Source, "/AgService/WcfPortal.svc");<br /><br />            Csla.DataPortalClient.WcfProxy.DefaultUrl = cslaEndpointUri.AbsoluteUri;<br />            System.ServiceModel.BasicHttpBinding cslaBinding = new System.ServiceModel.BasicHttpBinding();<br />            cslaBinding.Name = "basicHttpBinding_IWcfPortal";<br />            cslaBinding.MaxBufferSize = int.MaxValue;<br />            cslaBinding.MaxReceivedMessageSize = int.MaxValue;<br />            <br />            Csla.DataPortalClient.WcfProxy.DefaultBinding = cslaBinding;<br />            Csla.DataPortalClient.WcfProxy.DefaultEndPoint = "CslaWcfPortal";<br />        }<br /><br /><br />I think it was unnecessary for me to pull down the server name from the html page, as Application.Current.Host.Source seems to provide it as well.<br /><br />            Uri cslaEndpointUri = new Uri(Application.Current.Host.Source, "/AgService/WcfPortal.svc");<br /><br />In your case, this would probably all move to something that responded to the user's choice...<br /><br />Hope this helps.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jack replied on Tuesday, August 25, 2009</h2>Thank you.<br /><br />-----Original Message-----<br />From: esaulsberry [mailto:cslanet@lhotka.net] <br />Sent: August-25-09 9:37 AM<br />To: jaddington@alexandergracie.com<br />Subject: Re: [CSLA .NET] RE: Configuring Csla DataPortal / WCF / Endpoints<br /><br />The way I push a string from the html to the client is like this:<br />I have a hidden field on the page that contains the SliverLight control.<br /><br /><br />This is populated when the page loads:<br />	protected void Page_Load(object sender, EventArgs e)<br />	{<br />	        hdnEndpoint.Value =<br />Request.ServerVariables["HTTP_HOST"].ToString();<br />	}<br />There is a JavaScript function to provide this to the SilverLight app:<br />    <br />        function GetEndpointHost() {<br />            var hostField = document.getElementById('hdnEndpoint');<br />            if (hostField) {<br />                return hostField.value;<br />            }<br />            else {<br />                return ('no host');<br />            }<br />        }<br />    <br />There's probably a way to do this just with JavaScript, but I was unwilling<br />to spend any time finding it.<br /><br />In the startup of the SilverLight app (App.xaml.cs):<br />    public partial class App : Application<br />    {<br />        public static string ServerHost { get; set; }<br />...<br />        private void Application_Startup(object sender, StartupEventArgs e)<br />        {<br />			ControlContainer cont = new ControlContainer();<br />			LoginPage lp = new LoginPage(cont);<br />			cont.SetContent(lp);<br />			this.RootVisual = cont;<br /><br />		        SetCslaBinding();<br /><br />        }<br /><br />        private void SetCslaBinding()<br />        {<br />            string endpointFromWeb =<br />HtmlPage.Window.Invoke("GetEndpointHost", null) as string;<br />            ServerHost = endpointFromWeb;<br />            Uri cslaEndpointUri = new Uri(Application.Current.Host.Source,<br />"/AgService/WcfPortal.svc");<br /><br />            Csla.DataPortalClient.WcfProxy.DefaultUrl =<br />cslaEndpointUri.AbsoluteUri;<br />            System.ServiceModel.BasicHttpBinding cslaBinding = new<br />System.ServiceModel.BasicHttpBinding();<br />            cslaBinding.Name = "basicHttpBinding_IWcfPortal";<br />            cslaBinding.MaxBufferSize = int.MaxValue;<br />            cslaBinding.MaxReceivedMessageSize = int.MaxValue;<br />            <br />            Csla.DataPortalClient.WcfProxy.DefaultBinding = cslaBinding;<br />            Csla.DataPortalClient.WcfProxy.DefaultEndPoint =<br />"CslaWcfPortal";<br />        }<br /><br /><br />I think it was unnecessary for me to pull down the server name from the html<br />page, as Application.Current.Host.Source seems to provide it as well.<br /><br />            Uri cslaEndpointUri = new Uri(Application.Current.Host.Source,<br />"/AgService/WcfPortal.svc");<br /><br />In your case, this would probably all move to something that responded to<br />the user's choice...<br /><br />Hope this helps.<br /><br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
