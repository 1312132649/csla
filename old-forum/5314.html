<html><header><title>Edit level mismatch in CopyState (Yes again) - Winforms binding</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Edit level mismatch in CopyState (Yes again) - Winforms binding</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5314.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies posted on Thursday, August 28, 2008</h2><P>Hi</P>
<P>I have a Parent BusinessBase class which has another child BusinessBase class as a property. If i configure my databinding for this property i get the "Edit level mismatch in CopyState" error. </P>
<P>I have two other properties on the Parent of type BusinessListBase which all work just fine. The only difference being the type of business object the property represents.</P>
<P>I have configured databinding exactly like the samples in the PTracker winforms sample. Could there be any issue with the Undo when have property of BusinessBase type&nbsp;on a Parent&nbsp;BusinessBase class?<BR><BR>Thanks</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 28, 2008</h2>What version of Csla are you using?&nbsp; And if it's 3.5 or higher, are you using managed properties or unmanaged properties?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Thursday, August 28, 2008</h2><P>I am using 3.5.1 and yes I am using managed properties.<BR><BR>The property on the parent is declared like so..</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Shared</FONT></FONT><FONT size=2> VestingSettingsProperty </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> PropertyInfo(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> AwardVestingSetting) = RegisterProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> AwardVestingSetting)(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>GetType</FONT></FONT><FONT size=2>(Award), </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2> PropertyInfo(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> AwardVestingSetting)(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"VestingSettings"</FONT></FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"VestingSettings"</FONT></FONT><FONT size=2>))</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>''' </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;Summary&gt;<BR></FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>''' Gets and sets the VestingSettings value.<BR></FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>''' </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/Summary&gt;</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Property</FONT></FONT><FONT size=2> VestingSettings() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> AwardVestingSetting<BR><BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Get<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Return</FONT></FONT><FONT size=2> GetProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> AwardVestingSetting)(VestingSettingsProperty)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Get</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Set</FONT></FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> AwardVestingSetting)<BR>SetProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> AwardVestingSetting)(VestingSettingsProperty, value)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Set</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Property</FONT></FONT></P>
<P><FONT color=#0000ff><FONT color=#0000ff><FONT color=#000000 size=2></FONT>&nbsp;</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 28, 2008</h2>I'm not a Vb guy, but I don't think I use the overload of RegisterProperty that takes a type as the first argument.&nbsp; Maybe take that parameter out and see if that changes things?&nbsp;&nbsp; Otherwise I'm at a loss... but you may want to post the code were you setting your BindingSources and if you call ApplyEdit CancelEdit, etc.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Thursday, August 28, 2008</h2><P>hi again :)</P>
<P>I did&nbsp;tried taking out the overload too but get the same result/error unfortunatly :(</P>
<P>When changing properties for VestingSettings (for example) the parent bindingsource (AwardBindingSource) does not seem to fire either so I am must be setting up something wrong.</P>
<P>My binding setup looks like the following.</P>
<P>Parent (Businessbase)&nbsp; - AwardBindingSource.datasource = MyLibary.Award<BR></P>
<P>Child&nbsp;1 (BusinessListbase)&nbsp;&nbsp; - TransactionsBindingSource.DataSource = AwardBindingSource<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TransactionsBindingSource.DataMember = Transactions</P>
<P>Child&nbsp;2 (BusinessListbase)&nbsp;&nbsp; - VestingsSettingBindingSource.DataSource = AwardBindingSource<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VestingsBindingSource.DataMember = Vestings</P>
<P>Child&nbsp;3 (Businessbase)&nbsp;&nbsp; - VestingSettingBindingSource.DataSource = AwardBindingSource<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VestingSettingBindingSource.DataMember = VestingSettings<BR></P>
<P>I use the rebind method Rocky uses in the PTracker application and copystate error appears on the _award.CancelEdit line</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>Private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> RebindUI(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> saveObject </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Boolean</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> rebind </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Boolean</FONT></FONT><FONT size=2>)</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' disable events</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.TransactionsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingSettingsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</P>
<P></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' unbind the UI<BR><FONT color=#000000>UnbindBindingSource(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT color=#000000 size=2>.VestingSettingsBindingSource, saveObject, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT color=#000000 size=2>)<BR></FONT></FONT></FONT><FONT size=2>UnbindBindingSource(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingsBindingSource, saveObject, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)<BR>UnbindBindingSource(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.TransactionsBindingSource, saveObject, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)<BR>UnbindBindingSource(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource, saveObject, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True</FONT></FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingSettingsBindingSource.DataSource = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingsBindingSource.DataSource = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.TransactionsBindingSource.DataSource = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' save or cancel changes</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</FONT></FONT><FONT size=2> saveObject </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then</P></FONT></FONT><FONT size=2>
<P>_award.ApplyEdit()</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try</P></FONT></FONT><FONT size=2>
<P>_award = _award.Save</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Catch</FONT></FONT><FONT size=2> ex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> Csla.DataPortalException</P>
<P>MessageBox.Show(ex.BusinessException.ToString(), _</P>
<P></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Error saving"</FONT></FONT><FONT size=2>, MessageBoxButtons.OK, _</P>
<P>MessageBoxIcon.Exclamation)</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Catch</FONT></FONT><FONT size=2> ex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> Exception</P>
<P>MessageBox.Show(ex.ToString(), _</P>
<P></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Error Saving"</FONT></FONT><FONT size=2>, MessageBoxButtons.OK, _</P>
<P>MessageBoxIcon.Exclamation)</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Else</P></FONT></FONT><FONT size=2>
<P>_award.CancelEdit()</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Finally</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' rebind UI if requested</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</FONT></FONT><FONT size=2> rebind </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then</P></FONT></FONT><FONT size=2>
<P>BindUI()</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' restore events</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.TransactionsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingSettingsBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>True</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</FONT></FONT><FONT size=2> rebind </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>' refresh the UI if rebinding</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.AwardBindingSource.ResetBindings(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.TransactionsBindingSource.ResetBindings(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingsBindingSource.ResetBindings(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.VestingSettingsBindingSource.ResetBindings(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>False</FONT></FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Thursday, August 28, 2008</h2><P>Ok my bad, i had made a mistake on my Child_Fetch method and passed through the SingleCriteria class of the wrong type...The CopyState error has now gone..but...</P>
<P>Any reason or something I can look at specifically to check why when making changes to to the vestingSettings child object that the AwardBindingSource CurrentItemChanged is not fired at all. As VestingSettings is a child i would expect making changes to properties on the child would automatically fire the parent&nbsp;(AwardBindingSource) bindingsource?</P>
<P>Thanks for any help.</P>
<P><FONT size=2>&nbsp;</P>
<P>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, August 28, 2008</h2><P><FONT face=Tahoma size=2>IIRC, BusinessBase does not have code to automatically bubble its events to a parent.&nbsp; BusinessListBase subscribes to the BB events and handles the bubbling for you, and BusinessBase has hooks for child BLB's, but not direct child BB's.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Friday, August 29, 2008</h2><P>Can anyone else confirm this and possibly provide suggestions on a workaround? Perhaps i need to implement my business object differently? How do other poeple handle situations where there is a one to one mappings?</P>
<P>I cannot see any reason why&nbsp;the BusinessBase parent class shouldnt handle any events fired on the Businessbase child at all unless I am missing something.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Friday, August 29, 2008</h2><P>Hello guys! </P>
<P>I am really pulling my hair out on this one...arghhh&nbsp; I just cannot seem to pinpoint why the Parent BindingSource wil not fire when properties on the child is changed.</P>
<P>The child object (of BusinessBase) behaves exactly as I want it too except for the Undo! :(</P>
<P>Any help or suggestions will be greatly appreciated,</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, August 29, 2008</h2>This is by design.&nbsp; It was discovered that doing this causes problems with Data Binding.&nbsp; for now, you can listen to the ChildChanged event on your root object... but it may not work if you have grandchild objects.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
