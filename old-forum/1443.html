<html><header><title>IsDeleted in EditableRootObject</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsDeleted in EditableRootObject</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1443.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy posted on Tuesday, October 10, 2006</h2>I have an editable root object, and I try to delete it with the following statements:<br><br>Dim myObject as MyRootObject =&nbsp; MyRootObject.GetMyRootObject(...)<br>:<br>:<br>' after myObject.Delete(), myObject.IsDeleted was set to true<br>myObject.Delete() <br><br>' after the statement below myObject.IsDeleted was set to false and IsDirty&nbsp; = true?<br>myObject = myObject.Save() <br><br>Is this a normal behavior or I'm missing something? What would be the proper way of doing it using Save() or the Shared Factory method? Just got a little confuse :-)<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 11, 2006</h2>In this case, Delete sets IsDeleted to true, but doesn't do anything else.&nbsp; Its by design, as you can 'undelete' the object.<br><br>When you call save, your DP_U should be called where you delete the data from the database.&nbsp; After this is completed, MarkNew is called.&nbsp; New indicates the object exists only in memory and not in the database.&nbsp; Its no longer marked as deleted (because you can delete something which does not exist) and its Dirty, because in Csla new objects are dirty (although you can override that behavior if you want).<br><br>The shared factory method Delete calls DP_D which deletes the item immediately.&nbsp; <br><br>Which one you use depends on what behavor you want.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>glenntoy replied on Thursday, October 12, 2006</h2>Thanks Andy. Actually, I'm developing an ASP.NET application such that I used a FormView to edit/delete/create an entry. <br><br>I wanted a behavior where in the user clicks delete, it will still show the entry that I deleted (which I already achieve because I still have it in memory but not in database), but I also wanted to disable/hide the edit &amp; delete link buttons in a form view when the its on Readonly mode and I was thinking to do this one using LinkButton.Visible = myObject.IsDeleted<br><br>I guess I need to override the Save(..), such that it will set the object as deleted. And I think I should be careful on this one. :-)<br><br>Public Overrides Function Save() As myObject<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'retrieve first the original value of IsDeleted before performing the action<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim deleted As Boolean = Me.IsDeleted<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim t As myObject = MyBase.Save()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'only marked as deleted if the previous state was deleted<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If deleted Then t.MarkDeleted()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return t<br>End Function<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, October 12, 2006</h2>Hi,<br><br>There's no need to override save to do this.&nbsp; The Delete method on the instance will mark it as deleted.<br><br>In your DataPortal_Update&nbsp; you'll want to call MarkNew, because the object is 'new' in that it no longer exists in the database.<br><br>MarkDeleted is used to tell the object that when Save is called, it should delete itself, NOT to indicate that the object WAS deleted from the database.<br><br>IsNew tells you if the object exists in the database (in which case IsNew will be false) or exists only in memory (IsNew will be true).<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 12, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>glenntoy:</strong></div><div>I have an editable root object, and I try to delete it with the following statements:<br><br>Dim myObject as MyRootObject =&nbsp; MyRootObject.GetMyRootObject(...)<br>:<br>:<br>' after myObject.Delete(), myObject.IsDeleted was set to true<br>myObject.Delete() <br><br>' after the statement below myObject.IsDeleted was set to false and IsDirty&nbsp; = true?<br>myObject = myObject.Save() <br><br>Is this a normal behavior or I'm missing something? What would be the proper way of doing it using Save() or the Shared Factory method? Just got a little confuse :-)<br></div></BLOCKQUOTE><br><br>This is normal. The reason being, that the object WAS deleted by the Save() call, but then you get back a new instance of the object. <br><br>By definition, that new object's key value does not match a row of data (because you just deleted it) and so IsNew should be true.<br><br>By definition, that new object's fields don't match data in the database, and so IsDirty is true.<br><br>And that new object is not marked for deletion - it represents the now-deleted data, but since the delete has already completed, so the object isn't marked to re-delete the already deleted data.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
