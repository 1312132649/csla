<html><header><title>IsDirty Change Event</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsDirty Change Event</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12594.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt posted on Tuesday, April 22, 2014</h2><p>Good day.</p>
<p>i would like to get some help on the following. i am working in a WinForms environment application, i have a &quot;Save&quot; button but i would like to enable/disable the button is my object has been changed. i would think that i would need to check the &#39;IsDirty&#39; flag of my object, is this correct?</p>
<p>if so, how would i get a raised event when my &#39;IsDirty&#39; property gets changed so that i can enable/disable my save button accordingly?</p>
<p>any help with on this would be much appreciated.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sash_kr replied on Tuesday, April 22, 2014</h2><p>Maybe you should check &quot;IsDirty&quot; property in &quot;PropertyChanged&quot; event.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt replied on Tuesday, April 22, 2014</h2><p>Good day sash_kr.</p>
<p>thank you for your reply, i gathered as much. so how would i go about getting the IsDirty changed event in my winforms so that i can enable/disable my button?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sash_kr replied on Tuesday, April 22, 2014</h2><p><div style='padding-left: 50px;background-color:silver'><b>Brendt<br></b></p>
<p>Good day sash_kr.</p>
<p>thank you for your reply, i gathered as much. so how would i go about getting the IsDirty changed event in my winforms so that i can enable/disable my button?</p>
<div style="clear:both;"></div>
<p></div></p>
<p>&nbsp;</p>
<p>this.MyBusinessObject.PropertyChanged += 
&nbsp;MyBusinessObject_PropertyChanged;</p>
<p>&nbsp;</p>
<p>void &nbsp; MyBusinessObject_PropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)<br />        {<br />&nbsp;           &nbsp; &nbsp; this.btnSave.Enabled = this.MyBusinessObject.IsDirty;<br />        }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, April 22, 2014</h2><p>It is better to use the BindingSource.&nbsp;</p>
<p>If you attach events directly between the form and the business object you must also unsubscribe before Save or else the automatic Clone will fail (and try to serialize the form and controls which are NOT serializable).&nbsp;</p>
<p>The BindingSource is your &quot;connection&quot; to the Business Object and is where you should attach your events to. <br />The BindingSource also contains a &quot;currency manager&quot; and keep track of the &quot;current&quot; object if you are editing in a list.&nbsp;<br />So all you need to do is to hook into the BindingSource.CurrentItemChanged and this can even be done in the designer. &nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt replied on Wednesday, April 23, 2014</h2><p>Good day JonnyBee.</p>
<p>Thank you for your Answer, i am still a bit stumped on how to achieve this. i have placed this line of code in my form load which disables the save button, but when i make a change (eg remove a line) BTW this is an invoice form with invoice lines, the save button does not become active again.</p>
<p>cmdSave.DataBindings.Add(&quot;Enabled&quot;, InvoiceObject, &quot;IsDirty&quot;);</p>
<p>i checked, the state when form loads of &#39;IsDirty&#39; = False and once a line is removed the &#39;IsDirty&#39; state does change to True but the button does not get enabled. the button does however become enabled if i change a property in the Invoice object (and &#39;IsDirty&#39; = True). but then if i click save and the object &#39;IsDirty&#39; = False again the button does not become disabled again. i have added the following lines as well.</p>
<p>public event EventHandler CurrentChanged;</p>
<p>AND</p>
<p>void bindingSource_CurrentChanged(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //this.cmdSave.Enabled = this.qu.IsDirty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(&quot;Binding source firing&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>but nothing happens...please could you provide me with more information on this.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, April 23, 2014</h2><p>CSLA does not support databinding to the &quot;status&quot; properties (like IsDirty).&nbsp;</p>
<p>You must add this in code inside the BindingSource.CurrentItemChanged, </p>
<p>Example:</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;rootBindingSource_CurrentItemChanged(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;System.<span style="color:#2b91af;">EventArgs</span>&nbsp;e)
{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;bindingSource&nbsp;=&nbsp;(<span style="color:#2b91af;">BindingSource</span>)&nbsp;sender;
&nbsp;&nbsp;&nbsp; <span style="color:green;">// if there is no &quot;current&quot;&nbsp;item&nbsp;in&nbsp;currency&nbsp;manager?</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(bindingSource.Position&nbsp;&lt;&nbsp;0)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmdSave.Enabled&nbsp;=&nbsp;<span style="color:blue;">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>;
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;get&nbsp;the&nbsp;current&nbsp;businessobject&nbsp;and&nbsp;set&nbsp;button&nbsp;enabled&nbsp;if&nbsp;object&nbsp;IsSavable&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;that&nbsp;is&nbsp;both&nbsp;IsDirty&nbsp;and&nbsp;IsValid.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;bo&nbsp;=&nbsp;(Csla.Core.<span style="color:#2b91af;">ITrackStatus</span>)&nbsp;bindingSource.Current;
&nbsp;&nbsp;&nbsp;&nbsp;cmdSave.Enabled&nbsp;=&nbsp;bo.IsSavable;
}
</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt replied on Wednesday, April 23, 2014</h2><p>Hi JonnyBee.</p>
<p>Thanks for your reply... One other question, what is &#39;rootBindingSource&#39;? would it be my Invoice Object?</p>
<p>[EDIT]</p>
<p>OK so i have added the BindingSource object onto the form and using its &#39;CurrentItemChanged&#39; but it only seems to get fired when my form loads. but it doesn&#39;t fire when the IsDirty or IsSavable actually changes.</p>
<p>i used this line to set its datasource in the form Load event.</p>
<p>this.bs.DataSource = this.Invoice;</p>
<p>why would this be happening?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, April 23, 2014</h2><p>Yes, you may need to add this to the child bindingsources as well. </p>
<p>When you have a parent and child bindingsource then the parent does not field CurrentItemChanged when a property/item is changed in the child list.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt replied on Wednesday, April 23, 2014</h2><p>hi JonnyBee.</p>
<p>ok, this is becoming most frustrating...i have added another bindingsource object and set it to my child (lines) object but it do only fires on loading the form. Both &#39;CurrentItemChanged&#39; events only fire on load or if a property is changed. It doesn&#39;t seem to fire when lines are removed.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, April 24, 2014</h2><p>Can you provide a sample solution that shows the issues?&nbsp;</p>
<p>(I will be travelling until next monday without PC so will not be able to look at solution until next week).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brendt replied on Thursday, April 24, 2014</h2><p>hi JonnyBee.</p>
<p>this is the bindingSource objects created.</p>
<p>private void lines_CurrentItemChanged(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var bindingSource = (BindingSource)sender;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // if there is no &quot;current&quot; item in currency manager?<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bindingSource.Position &lt; 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cmdSave.Enabled = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // get the current businessobject and set button enabled if object IsSavable <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // that is both IsDirty and IsValid.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var bo = (Csla.Core.ITrackStatus)bindingSource.Current;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cmdSave.Enabled = bo.IsSavable;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(&quot;Lines Firing&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void root_CurrentItemChanged(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var bindingSource = (BindingSource)sender;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // if there is no &quot;current&quot; item in currency manager?<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bindingSource.Position &lt; 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cmdSave.Enabled = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // get the current businessobject and set button enabled if object IsSavable <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // that is both IsDirty and IsValid.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var bo = (Csla.Core.ITrackStatus)bindingSource.Current;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cmdSave.Enabled = bo.IsSavable;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(&quot;Root Firing&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>and this is how i am setting it in the Form Load event</p>
<p>this.root.DataSource = InvoiceObject;<br />this.lines.DataSource = InvoiceObject.LineList;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, April 22, 2014</h2><p>Hi,</p>
<p>Normally you will use a BindingSource in your form for DataBinding and you should hook into the CurrentItemChanged event on the BindingSource&nbsp;and set enabled on the button. </p>
<p>See also: <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.bindingsource.currentitemchanged(v=vs.110).aspx">http://msdn.microsoft.com/en-us/library/system.windows.forms.bindingsource.currentitemchanged(v=vs.110).aspx</a></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
