<html><header><title>Getting the &quot;new row&quot; to appear in a DataGridView</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Getting the &quot;new row&quot; to appear in a DataGridView</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/360.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM posted on Tuesday, June 13, 2006</h2><P>Hi everyone,</P>
<P>I'm writing an application that has a UserControl that is basically a clone of the Project Tracker RolesEdit control.&nbsp; I've gotten it to work (all the stuff about setting AllowNew to true in the Editable Root collection constructor, and overriding AddNewCore()), but I have one difference between my code and Project Tracker that I don't understand.</P>
<P>The difference is the setting of the AllowNew property on the BindingSource object in the UserControl designer&nbsp;&nbsp;(RolesBindingSource on the RolesEdit designer).&nbsp; In Project Tracker it's set to false, but I can't seem to get mine to work without setting this value to true in the designer.</P>
<P>I figured that maybe this value was being manipulated in WinPart, or maybe in the code behind of the UserControl, but I can't find anyplace in ProjectTracker that this property is being set.</P>
<P>I suspect that I'm setting myself up for future trouble here by making the "new row" always show, even if the user is not authorized to add rows.&nbsp; So I'm considering adding code to the "load" routine of the UserControl to set this value based on the user's authority&nbsp;and the AllowNew setting of the DataSource.&nbsp; I obviously don't want to do this if I can help it.</P>
<P>Can someone educate me on this?&nbsp; Does DataBinding or WinPart or anything automatically manipulate the value of AllowNew in the BindingSource?&nbsp; Or do I have something else set up wrong?</P>
<P>Thanks for your help.</P>
<P>BBM</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM replied on Thursday, June 15, 2006</h2><P>Here's what I've found out so far:</P>
<P>1)&nbsp; The AllowNew property of the RolesBindingSource in Project Tracker is set to true by the BindingSource object itself when an object that implements IBindingList (like BusinessListBase (of T,C)) is assigned to the DataSource property.&nbsp; If AllowNew is set to true for the object that is assigned&nbsp;as the DataSource, the AllowNew property of the BindingSource will automatically be set to true.&nbsp; There are some cases where it won't be set, like if the DataSource object is fixed length, or doesn't implement a default constructor.&nbsp; The documentation for BindingSource covers these.</P>
<P>2)&nbsp; That having been said, my code doesn't work that way.&nbsp; I think my&nbsp;code mirrors that in Project Tracker (none of the exception conditions seem to apply,&nbsp; my collection is a BusinessListBase&nbsp;(of T,&nbsp;C) and AllowNew is set to true&nbsp;on instantiation)&nbsp;but when the assignment is made, AllowNew for the BindingSource object stays false.&nbsp; I can rectify this by just setting the value myself after the DataSource assignment, and in fact, I think this improves the code because you have the option to check to see if the user can add objects and you can leave it false if he/she doesn't have the authority.</P>
<P>So for now, unless someone else has any ideas, I'm considering this to be a quirk of the BindingSource class (although I'm open to the idea that it's not working because of some other bonehead thing I've done).&nbsp;&nbsp;I'll explicitly set AllowNew on the BindingSource to what I need when I set the DataSource.</P>
<P>Thanks to everyone who peeked at my problem to see if they could help.</P>
<P>BBM</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Friday, June 16, 2006</h2><P>BBM</P>
<P>Thanks for writing what you found out b/c I was going through a similar situation.&nbsp; I gave up and created an "Add New" button that adds a new item to my list that is data bound, because I couldn't figure this out.</P>
<P>Thanks again.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Saturday, June 17, 2006</h2><P>Hey BBM,</P>
<P>I tried your method of setting the AllowNew on the collection = true, but I am still getting the exception that there is no available constructor for my collected object (because of factory usage).</P>
<P>Do you have to create a public constructor in order to get this to work?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM replied on Sunday, June 18, 2006</h2><P>Rocky covers this in the VB book on page 452.&nbsp; You have to&nbsp;override the AddNewCore method on the collection object so that it can add the&nbsp;object for the "new row".&nbsp; This method just calls the factory New &nbsp;method in the "collected" type.</P>
<P>So the collected type constructors are&nbsp;private.</P>
<P>Hth.</P>
<P>BBM</P>
<P>&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmay replied on Monday, June 19, 2006</h2><P>Thanks BMM!</P>
<P>For anyone interested this is on page 450 of the C# book.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
