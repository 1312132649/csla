<html><header><title>CSLA.NET with binary objects i.e. JPEGS, MP3 &amp; AVI</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA.NET with binary objects i.e. JPEGS, MP3 &amp; AVI</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3084.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pixel posted on Monday, June 25, 2007</h2><P>Hi,</P>
<P>Im quite new to CSLA and serious enterprise development in general.&nbsp; I'm in the process of developing an application to manage digital assets be they pictures, images or audio.&nbsp;&nbsp; My reasons for using CSLA are more to do with consistency of the code&nbsp;than just the&nbsp;scalability.&nbsp; I want my code to be easily maintained when I move on to other projects.</P>
<P>My question at this stage in my research is CSLA suited to handling binary objects like those discussed?&nbsp;&nbsp; It is a web app that allows users to upload their files and at that point they are manipulated and stored.&nbsp;&nbsp; In fact lets say YouTube is similar but with just video.&nbsp;&nbsp; Would you attempt to build 'you tube' with CSLA.NET? <BR><BR>Youtube needs scalability and the ability to record data such as tags and comments etc against each piece of video.......but&nbsp;would the manipulation of the video on initial upload be somehting completely seperate to CSLA?</P>
<P>Sorry if I'm rambling.</P>
<P>Pixel.&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 25, 2007</h2><P>I guess it depends on what you mean by "manipulated'.</P>
<P>I'm assuming you aren't talking about actually manipulating the content, as there are specialized tools for that. So you are talking about taking the uploaded file, putting it into the correct directory on the server and associating metadata with that file?</P>
<P>If that's the case then CSLA should be quite helpful. All that metadata is merely data entered (somehow) by the user and stored/retrieved from a database or other data store, and that's exactly what CSLA is designed for.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pixel replied on Monday, June 25, 2007</h2><P>Thanks Rocky.......</P>
<P>I guess I'm looking at the scenario, for example, of a picture being uploaded to a web site and using CSLA.NET to manage extracting the meta data and recording it in the database and then kick starting any manipulation such as resizing or water marking.&nbsp;&nbsp;&nbsp;I realise CSLA would have to collaborate with other objects to&nbsp;physically extract the metadata&nbsp;string or do the resizing.&nbsp;&nbsp; I just wanted to know if pumping a raw binary&nbsp;stream/object into a CSLA BO direct from a HTML/ASP.NET form is overkill.<BR><BR>CSLA.NET will be extremely useful in the management of the users, tagging, general business management and eventual e-commerce components but I just wanted it to own the upload process of the application as well.<BR><BR>Reading your response it sure looks like this is going to be worth further investigation.&nbsp; Am I on the right lines?</P>
<P>&nbsp;&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 25, 2007</h2>






 





<div class=Section1>

<p class=MsoNormal><span>I&#8217;m not a web expert, so bear with me here, but don&#8217;t
all the standard file upload tools upload to some file on the web server? It
seems like a bad idea to upload a file into an in-memory object on the server;
CSLA or not&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>From a technical perspective, it is quite possible for a CSLA object
to hold binary data &#8211; that&#8217;s what an int is after all </span><span>J</span><span>&nbsp;&nbsp;
The broader concern I&#8217;d have is whether it is wise to load large binary
blobs into memory at all, and if you do so, how to manage them so server memory
doesn&#8217;t become an issue.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pixel replied on Monday, June 25, 2007</h2><P>I'm a little confused now.&nbsp; You're undoubtedly more knowledgable than I am but&nbsp; my understanding based on years of ASP development is that the browser just delivers a binary file to the server via HTTP.&nbsp; The server running a script or exectuting .NET has to decide what to do with the data.&nbsp; Its not automatically written to disk.&nbsp;&nbsp; You&nbsp;'had' to buy third party tools to do that.&nbsp;&nbsp; Is it not in memory at the point before being written to to the location on disk?<BR><BR>My prototypes have been extracting the upload from the HTTP stream and resizing etc all on one thread.&nbsp; I know thats bad.<BR><BR>I guess I should be looking at getting the files written to disk as soon as possible in the upload and then on a different thread doing any resizing?<BR><BR>Thanks for allowing me to go a little off-topic.<BR><BR><BR><BR></P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, June 25, 2007</h2><P>I use CSLA and ASP.Net to upload images (and files and ...).</P>
<P>I use the Binary data from the upload and store it in a CSLA BO.</P>
<P><FONT color=#000000>===================================================================================</FONT></P>
<P>e.g. BO Code:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> mAttdoc </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Byte</FONT><FONT size=2>() = </FONT><FONT color=#0000ff size=2>Nothing</P></FONT><FONT size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Attdoc() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Byte</FONT><FONT size=2>()<BR></FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>&nbsp; Return</FONT><FONT size=2> mAttdoc<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> Value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Byte</FONT><FONT size=2>())<BR>&nbsp; mAttdoc = Value<BR>&nbsp; PropertyHasChanged(</FONT><FONT color=#ff00ff size=2>"Attdoc"</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT></P>
<P><FONT color=#008000>'fetch the binary data from the database:<BR></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overridable</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> FetchData(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> dr </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> SafeDataReader)<BR></FONT><FONT color=#0000ff size=2>With</FONT><FONT size=2> dr<BR></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> .Read = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR></FONT><FONT size=2>&nbsp;&nbsp;</FONT><FONT size=2>mAttdoc = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(.Item(</FONT><FONT color=#ff00ff size=2>"attdoc"</FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2>Byte</FONT><FONT size=2>())<BR>&nbsp; mContenttype = Trim(.GetString(</FONT><FONT color=#ff00ff size=2>"contenttype"</FONT><FONT size=2>))<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>With<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#008000>'save the binary data to the database. (Or to a folder on the web server or...)</FONT></P></FONT><FONT color=#000000 size=2>
<P><FONT color=#000000>===================================================================================</FONT></P></FONT>
<P><FONT color=#000000 size=2>Web Page Code:</FONT></P><FONT color=#0000ff><FONT color=#0000ff size=2>
<P>Private</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT color=#000000 size=2> btnSave_Click(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT color=#000000 size=2> sender </FONT><FONT color=#0000ff size=2>As</FONT><FONT color=#000000 size=2> System.Object, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT color=#000000 size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT color=#000000 size=2> System.EventArgs) </FONT><FONT color=#0000ff size=2>Handles</FONT><FONT size=2><FONT color=#000000> btnSave.Click</FONT></FONT></P>
<P><FONT size=2><FONT color=#000000>'other code here</FONT></P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mBO.IsNew </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> </FONT><FONT size=2>FileUpload.PostedFile </FONT><FONT color=#0000ff size=2>IsNot<FONT size=2>&nbsp;</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> FileUpload.PostedFile.ContentLength &gt; 0 </FONT><FONT color=#0000ff size=2>Then<BR><BR></FONT><FONT size=2>&nbsp; mBO.AttachDoc.contenttype = FileUpload.PostedFile.ContentType<BR>&nbsp; mBO.AttachDoc.attdoc = GetBinaryData(FileUpload.PostedFile, FileUpload.PostedFile.ContentLength)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</FONT></P>
<P><FONT color=#000000>'other code here</FONT></P>
<P><FONT color=#0000ff size=2>End Sub</P></FONT></FONT>
<P><FONT color=#000000>===================================================================================</FONT></P><FONT color=#0000ff size=2>
<P>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetBinaryData(</FONT><FONT color=#0000ff size=2>ByRef</FONT><FONT size=2> theFile </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Web.HttpPostedFile, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> ContentLength </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Byte</FONT><FONT size=2>()</P>
<P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> Temp(ContentLength) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Byte<BR></FONT><FONT size=2>theFile.InputStream.Read(Temp, 0, ContentLength)<BR></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> Temp<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT color=#000000>
<P><FONT color=#000000>===================================================================================</FONT></P></FONT>
<P><FONT color=#000000>Joe</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pixel replied on Monday, June 25, 2007</h2>You learn something new everyday.....I just found this.&nbsp; ( I dont work for powupload.com) !!!!<BR>
<P><EM>ASP.NET has native object that <STRONG>stores uploaded files.</STRONG> Native ASP.NET object has one seriouse disadvantage: It uses memory equal to files size. If you uploads large files you can get "<STRONG>out of memory</STRONG>" error.</EM></P>
<P><EM>May be you will be interested in our another product </EM><A title="file upload component" href="http://www.powupload.com/" target=_blank><EM>PowUpload ASP.NET upload control</EM></A><EM>. PowUpload handles and stores the contents of the <STRONG>POST request to a file</STRONG> on the server hard disk rather than loading it into memory as the built-in ASP.NET upload support does. PowUpload provides rich server-side progress indicator that lets users to monitor the progress of their uploads and some ather advanced features.</EM></P>
<P>So it looks like Rocky was right 'again'.&nbsp; I need to get this right as I might very well have 100 people at the sametime uploading images that all need to be resized on the fly.<BR><BR>Anybody else got experience with ASP.NET uploads and CSLA.NET?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
