<html><header><title>Business rules execution on complex properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business rules execution on complex properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10216.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby posted on Tuesday, March 29, 2011</h2><p>Hi,</p>
<p>I have a BusinessObject called Scale having multiple properties of type Weight (e.g. ReferenceWeight, DisplayWeight, StandardWeight, etc.)</p>
<p>The Weight BusinessObject itself has a WeightUnit and a WeightValue.</p>
<p>Now I want to Create a BusinessRule calculating a DisplayWeight when the WeightUnit or the WeightValue of the ReferenceWeight is updated. The DisplayWeight shhould only be updated when a property of the ReferenceWeight has been changed. If the properties of other Weight properties are changed the rules needs not to be called (must not be called).</p>
<p>I tried to mark the Weight BusinessObject as child and call the rule in OnChildChange:<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></span></span>
<p>&nbsp;<span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">protected</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">override</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> OnChildChanged(Csla.Core.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ChildChangedEventArgs </span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">e) <br /></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">{<br />&nbsp; </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">base</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.OnChildChanged(e);<br />&nbsp; <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">BusinessRules.CheckRules(DisplayWeightProperty);</span></span><br />}</span></span></p>
</p>
<p>&nbsp;</p>
<p>But in this case the rules is executed each time when one of the weight property has been changed. Moreover because I&#39;m changing the DisplayWeight (whichis a Wight itself) the rules is called recursively...</p>
<p>What is the best way to implement a Business rule which depends on the property of a property (a subproperty)?</p>
<p>Thanks</p>
<p>Kirby</p>
<p>&nbsp;</p>
<p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p>
</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Tuesday, March 29, 2011</h2><p>Check the parameter e, you should be able to see which property changed.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kirby replied on Thursday, March 31, 2011</h2><p>Hi,</p>
<p>in &quot;<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Csla.Core.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ChildChangedEventArgs</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> e&quot; I can see the name of tha parameter changed (on the child object). I my case I see that WeightUnit or WeightValue was changed but I do not know whether it was a WeightValue of DisplayWeight or ReferenceWeight! If can check the ChildObject on e but that also gives me just an Weight and I have no idea what kind of weight.</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Any ideas?</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Kirby</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Kirby replied on Thursday, March 31, 2011</h2><p>Some investigations later...</p>
<p>e.ChildObject and the my ReferenceWeight are the same objects when a property on ReferenceWeight changes... So a simple reference comparison does the trick!&nbsp;</p>
<p>protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />{<br />&nbsp;&nbsp; base.OnChildChanged(e);<br />&nbsp; <br />&nbsp;&nbsp; if (e.ChildObject == this.CurrentScaleWeight &amp;&amp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (e.PropertyChangedArgs.PropertyName == &quot;Unit&quot; || e.PropertyChangedArgs.PropertyName == &quot;Value&quot;)<br />&nbsp;&nbsp; )<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.CheckRules(CurrentScaleWeightProperty);<br />&nbsp;&nbsp; }<br />} </p>
<p>Andy - you were right with your answer of corse!</p>
<p>Cheers</p>
<p>Kirby</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>marthac replied on Thursday, February 16, 2012</h2><p>I need to do a similar thing except my child property is a list. </p>
<p>In this case, PropertyChangedArgs&nbsp;is null in the ChildChangedEventArgs param. How can I easily find the property that matches the ChildObject that has changed?</p>
<p>Note that I am implementing this in my own BusinessBase class derived from Csla.BusinessBase. So I can&#39;t simply do something like e.ChildObject == this.CurrentScaleWeight, like this example.</p>
<p>Any suggestions would be greatly appreciated.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
