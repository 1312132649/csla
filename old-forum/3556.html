<html><header><title>System.Web.Mail -where does it fit in the CSLA model?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>System.Web.Mail -where does it fit in the CSLA model?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3556.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lyndon posted on Monday, September 17, 2007</h2><P>Hi,</P>
<P>In the spirit of keeping most of the business rules in the buiness objects as part of the CSLA framework, I am trying to use the System.Web.Mail functionality in ASP.NET 2.0 to send an email to a user indicating that a requests they have submitted has changed status.</P>
<P>I currently identify that&nbsp; change in status by looking for certain values in combination in my business object which inherits BusinessBase.</P>
<P>Normally you need to include an 'imports' command in your code. When you do that in the object, it understands importing 'System.Web' but does not give the option of 'System.Web.Mail'&nbsp; .</P>
<P>If I do the imports at the aspx page level code and look to action the email as a change in the value of a dropdown, it understands Systems.Web.Mail.</P>
<P>Perhaps its a dumb question, but why is the above the case? Should automatic creation/sending of emails be located in the business object or the web page? </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, September 17, 2007</h2><P>System.Web.Mail does appear to be in System.Web.dll. So you need to make sure you are add a reference to System.Web for the project you're adding this logic to. You probably have another assembly referenced that has elements in the System.Web namespace, which is why you can say "using System.Web" but not "using System.Web.Mail".&nbsp;For mail you need System.Web.dll.</P>
<P>For sending the emails - think about the use cases - if I change status, I want an e-mail to be sent. It's business logic - you're going to want this behavior within the business layer. </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Monday, September 17, 2007</h2><font size="2"><font face="Arial">Not directly related to your question but </font></font><font size="2"><font face="Arial">System.Web.Mail is obsolete and replaced by </font></font><font size="2"><font face="Arial">System.Net.Mail.<br><br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, September 17, 2007</h2>I thought it would be, but I've since changed my outlook.&nbsp; It led to problems, such as how do you test that the mail is being sent in unit testing?&nbsp; Do you want an email sent every run of the test?<br><br>I'm now of the school of thought that the email should be considered part of the presentation layer, possibly using business objects to determine who gets an email and the data it would contain.<br><br>Normally, I'd advocate Sql Server Notification Services, but unfortunately this is going away in Sql Server 2008.&nbsp; Supposedly, you can do the same thing via reporting services... but I haven't looked into that.&nbsp; <br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>josh.kodroff replied on Monday, September 17, 2007</h2>My personal favorite OO principle is encapsulation.&nbsp; <br><br>To understand why you shouldn't import System.Web.Mail (or System.Net.Mail) in your business logic layer, think about this:&nbsp; What would you do if you web app became a Windows app?&nbsp; Maybe sending an email would no longer be appropriate.&nbsp; <br><br>Whichever object is saving the status-changing data to the DB should be raising an event that's handled by the UI or some other layer.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lyndon replied on Monday, September 17, 2007</h2><P>In my example above, I am actually wanting an email to be sent regardless of whether it is a windows based client accessing the object or a web based client. The choices I felt were&nbsp; to either send the email when a dropdownlist value was selected in the client application or when the value changed in the business object as a result of the the value being selected in the dropdown list</P>
<P>Thanks guys for all the above responses</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 18, 2007</h2><P>Just to follow up -</P>
<P>I think especially given your notes about it occuring through Web or Windows - I think it belongs in the business layer. I do not think that "side effects of unit testing" should affect the architecture of your app. </P>
<P>With respect to including System.Web.dll or what have you in a business class library, it has nothing to do with breaking encapsulation. Zero, nada. Will most people find a need to include System.Web in their business class library? Probably not. But we happen to use the ASP.Net Membership and Role API as our standard authentication and authorization for our application - we're building a Web application but there's no reason why we need to have a separate security scheme for Windows (we wouldn't want that!)</P>
<P>In the case where behavior varies between UI's, it depends on specs as to how to proceed - but for example Caching will work differently in Web than Windows for us - in this situation, we have leveraged the provider design and happen to have a WebCacheProvider for our current UI (Web) understanding that what we do for Web is not applicable for Windows. But our business library invokes the CacheManager - part of the business library (which looks at the config file to determine which CacheProvider to leverage). </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 18, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>skagen00:</strong></div><div>I think especially given your notes about it occuring through Web or
Windows - I think it belongs in the business layer. I do not think that
"side effects of unit testing" should affect the architecture of your
app.</div></BLOCKQUOTE><br><br>The side effect of testing brings to the surface though that this probably doesn't belong in the business layer.&nbsp; What happens when load on the library increases?&nbsp; More and more time is now spent sending emails.&nbsp; What happens if the network or mail server is done?&nbsp; Does the business object abort the entire transaction?&nbsp; Nevermind the fact that it will block while its waiting for a timeout, further hurting performance.<br><br>A simple email may not seem like a big deal, but it can get out of hand, and become a big problem in the business layer.&nbsp; Remember, the email is presenting information... its part of the presentation layer.&nbsp;&nbsp; Notification on data changes can be a big task, which was why Notification Services was developed.&nbsp; Its just too bad nobody seemed to be using it.&nbsp; <img src="/emoticons/emotion-8.gif" alt="Indifferent [:|]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 18, 2007</h2><P>I'm not sure what you mean about load - a sent e-mail is a sent e-mail. I sure hope it doesn't take a lot of effort to send e-mails because I would start to feel sorry about all these spammers. ;)</P>
<P>Sending an e-mail from the business layer doesn't need to be synchronous, too. </P>
<P>Bottom line is that if someone wants a "notification if a record has changed" - I don't want to be coding that accomodation in my Win UI, my Web UI, and Web Services UI. </P>
<P>Anyways, I think we'll have to agree to disagree here! </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 19, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>skagen00:</strong></div><div>I'm not sure what you mean about load - a sent e-mail is a sent e-mail. I sure hope it doesn't take a lot of effort to send e-mails because I would start to feel sorry about all these spammers. ;)</div></BLOCKQUOTE><br><br>If you're talking about an app server, the server is spending more time sending emails, which can slow things down.&nbsp; If done on the client side, your user will be waiting for the mail to be sent before the UI returns control to them.&nbsp; I had my application sending an email when certain data changed on save, and it did slow things down quite a bit.&nbsp; As my application needed to send more and more emails, things got more complex.&nbsp; Especially when I had to send the same email when the same data was changed, but the change could happen in five different business objects.<br>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>skagen00:</strong></div><div>Sending an e-mail from the business layer doesn't need to be synchronous, too.</div></BLOCKQUOTE></p><p>True, but then you add complexity.&nbsp; Do you have to handle the AsyncCompletedCallback?&nbsp; I don't know, I can't find anything in the docs one way or another.&nbsp; What happens if the sending fails, and the mail MUST be sent?&nbsp; Do you retry?&nbsp; You have to inform the user at some point.&nbsp; A down mail server can cause a lot of problems.<br> </p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>skagen00:</strong></div><div>Bottom line is that if someone wants a "notification if a record has changed" - I don't want to be coding that accomodation in my Win UI, my Web UI, and Web Services UI.</div></BLOCKQUOTE></p><p>I agree!&nbsp; That's why I advocated SSNS or I guess in Sql 2008, SSRS.&nbsp; SSNS was great because it handled failures and automatically retried, was easily extensible, could handle digest or multicast delivery and a host of other things.&nbsp;&nbsp; SSNS worked basically by running queries you define to detect changes in data, and then generated notifications based on that data.&nbsp; No need to code anything into your application at all, SSNS handled it all for you.<br> </p>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>skagen00:</strong></div><div>Anyways, I think we'll have to agree to disagree here!</div></BLOCKQUOTE></p>I suppose so; like I said, its unfortnate SSNS is being discontined, otherwise I'd suggest you check it out.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, September 19, 2007</h2><P>I have a table in my DB where I store the data for emails that need to be sent.</P>
<P>Then I have a separate scheduled task which runs every 10 minutes (or whatever interval the client defines) which processes the records in this email table and sends them. This separates the 2 activities and the offline task is free to take as much time as it needs to talk to the mail server. The offline task can also log information about each email it sends - ncluding the fact that the mail server might be down.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 19, 2007</h2>Joe, that's basically what SSNS does <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, September 19, 2007</h2><P>I use a web service for sending emails which simplifies the async.&nbsp; It isn't critical for my app if the email doesn't send.&nbsp; I am intrigued by this SSNS though.&nbsp; Are there any good articles out there on it?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lyndon replied on Wednesday, September 19, 2007</h2>I have same question- I havent found a whole lot of good documentation on notification services. Any one have any good leads?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, September 20, 2007</h2>Here is the home page:<br><br>http://www.microsoft.com/sql/technologies/notification/default.mspx<br><br>Here's a SqlMag article: http://www.sqlmag.com/Article/ArticleID/47143/sql_server_47143.html<br><br><br>As I said though, its not going to be around in 2008.&nbsp; Supposedly Reporting Services can do the same thing, but I'm not sure.&nbsp; <br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
