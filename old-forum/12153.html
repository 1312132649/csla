<html><header><title>Config File Catch 22</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Config File Catch 22</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12153.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cslah posted on Tuesday, September 17, 2013</h2><p>We have an app.config file that contain our connection string and the dataportal settings. When the end-user logs in, they have the option to change the connection settings through a winforms UI.</p>
<p>Since the config file resides in the install folder, Windows dictates that by default you cannot write these files. This means that only an administrator can change the connection settings, which is becoming a pain for our end-users. It also violates Windows logo compliance as you&#39;re not supposed to modify files here.</p>
<p>I&#39;ve experimented with creating external xml files for the config file to refer to, but these must still reside in the install folder, and thus still require admin.</p>
<p>The only way I can see to make it work under a non-admin account is to place the xml files in the end-users appsettings folder or the registry, which is fine, but it requires us to make a change to the ConnectionManager object in the core Csla dll&#39;s to attempt to read from there instead of the app.config.</p>
<p>I&#39;m curious if anyone else has solved this problem. </p>
<p>Thanks,<br />Brian</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, September 18, 2013</h2><p>ConnectionManager has overloads for GetManager that accepts the ConnectionString (and not just the name of the setting in app.config). </p>
<p>So you may place your connection strings wherever you like in your app and handle this in your own code. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cslah replied on Thursday, September 19, 2013</h2><p>Thanks Jonny. That will work for the connection string, which I can also move (using the file=connection.xml) to the public folder.</p>
<p>We also have settings that allow end-users to change the endpoint for the WCF connection to the dataportal (below). Unfortunately, WCF (in my limited testing here) doesn&#39;t allow these files to be moved outside of the folder where the app.config resides, meaning that the enduser still needs admin access to modify them. I can&#39;t see how to get around this one either...&nbsp;<span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"> </span></span></span></span></span></span><span style="font-size:x-small;font-family:Consolas;color:#a31515;"><span style="font-size:x-small;font-family:Consolas;color:#a31515;"><span style="font-size:x-small;font-family:Consolas;color:#a31515;">endpoint</span></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"> </span></span></span><span style="font-size:x-small;font-family:Consolas;color:#ff0000;"><span style="font-size:x-small;font-family:Consolas;color:#ff0000;"><span style="font-size:x-small;font-family:Consolas;color:#ff0000;">address</span></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">=</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><a href="http://www.csladataportalhere.com/WcfPortal.svc">http://www.csladataportalhere.com/WcfPortal.svc</a></span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, September 20, 2013</h2><p>Hi,</p>
<p><i>If your first question gets answered please mark the tread as answered and start a new thread when you have a new question! </i></p>
<p>Csla has the <i>CslaDataPortalUrl </i>that you may set in your app.config or in code as the</p>
<p><i><b>ApplicationContext.DataPortalUrlString </b></i></p>
<p>Look at the SimpleNTier og ProjectTracker samples.</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">appSettings</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalProxy</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Csla.DataPortalClient.WcfProxy,&nbsp;Csla</span>&quot;<span style="color:blue;">/&gt;</span>
<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515;">add</span><span style="color:blue;">&nbsp;</span><span style="color:red;">key</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">CslaDataPortalUrl</span>&quot;<span style="color:blue;">&nbsp;</span><span style="color:red;">value</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://localhost:21647/WcfPortal.svc</span>&quot;<span style="color:blue;">/&gt;</span>
<span style="color:blue;">&nbsp;&nbsp;&lt;/</span><span style="color:#a31515;">appSettings</span><span style="color:blue;">&gt;</span></pre>
<p>Using this approach CSLA will autoconfigure the WCF channel.</p>
<p>This is the actual code in Csla.ApplicationContext: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">    private</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">string</span>&nbsp;_dataPortalUrl&nbsp;=&nbsp;<span style="color:blue;">null</span>;
<br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">string</span>&nbsp;DataPortalUrlString
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">if</span>&nbsp;(_dataPortalUrl&nbsp;==&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_dataPortalUrl&nbsp;=&nbsp;<span style="color:#2b91af;">ConfigurationManager</span>.AppSettings[<span style="color:#a31515;">&quot;CslaDataPortalUrl&quot;</span>];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span>&nbsp;_dataPortalUrl;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_dataPortalUrl&nbsp;=&nbsp;<span style="color:blue;">value</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>If you have special requirements then create your own version of the client side proxy class. </p>
<p><br />Any WCF configuration that you can define in app.config can also be done in code so you should<br /> be able to have a &quot;no-config&quot; configuration in your application.&nbsp; </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cslah replied on Saturday, September 21, 2013</h2><p>Awesome, thanks very much!!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
