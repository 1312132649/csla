<html><header><title>Design suggestions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design suggestions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3444.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Tuesday, August 28, 2007</h2>Hi,<br><br>Finally my users have begun testing my quoting module in their sales application, and I'm getting lots of good feedback.<br><br>One wishitem in particular is this:&nbsp; my application allows multiple price lists, and when product line items are added they must all be of the same price list.&nbsp; Changing the price list used for the quote will currently clear the line items.&nbsp; The obvious functionality they want is to have the line items update with the prices from the newly selected list.<br><br>I'm trying to think of a good, clean way to do this.&nbsp; Currently I have different line items, some of which have prices, some of which do not.&nbsp; The changing of a price list will only affect some of the line item types.&nbsp; I'm struggling trying to figure out where to put this funcationality.<br><br>Should it be the responsibility of the line item to get its own price from the database?&nbsp; Is it another objects&nbsp; responsibility?&nbsp; My current thinking is to add a method to the line item types affected so that they can reload their own prices, but I'm not sure if this violates SRP.&nbsp; <br><br>Any thoughts?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 28, 2007</h2><P>If I understand, the Quote knows that there's a new PriceList. I'd suggest first that the Quote provide this new PriceList to the LineItems collection, which in turn provides it to each LineItem - as a notification basically.</P>
<P>Then I'd suggest that there's a PriceCalculator object (logically anyway) that accepts a LineItem and PriceList, and which recalculates the price (if appropriate). That way your LineItem-type checking goes there, as does any calculations. The result is a new price.</P>
<P>If data access is required during that process, it would be encapsulated in PriceCalculator, which might use a command object or RO object to get the new price.</P>
<P>This way LineItem stays simple, but is responsible for <EM>triggering</EM> the generation of a possible new price.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Wednesday, August 29, 2007</h2>Two things that come to my mind when reading this:<br>I would then try to minimize database-access by retrieving all the prices that are needed for the entire LineItems collection at once. Maybe there is something called a QuotePriceManager that would&nbsp; retrieve and temporarily store the required prices. The PriceCalculator would use the prices provided by the QuotePriceManager.<br>Maybe this sounds a bit complicated (Thinking as I type...) - then think of a PriceCalculator object that accepts&nbsp; a whole LineItems collection instead and a PriceList and does the work for the entire quote.<br>I think this is it.<br><br>The second thing was to keep in mind the undo mechanism:<br>Undoing the PriceList change in the quote must also trigger the undo for the prices in the LineItems collection. So, assuming the PriceList change in the Quote is happening inside a public property, the PriceCalculator object would also have to call the public price-setter-property of each LineItem.<br>But that's basic anyway...<br><br>Hope this is of some help <br><br>Stefan<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, August 29, 2007</h2>Thank you both for your responses.&nbsp; This sounds like the best way to go.<br><br>Things are somewhat simplier because there's no calculations necessary, just need to replace the current unit price with a new one.&nbsp; Also I do cache price lists in memory, so I can simply use that and not really worry about data access (and if data is required, another class can get all the info I need).<br><br>I'll get on this right away.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bowman74 replied on Wednesday, August 29, 2007</h2><P>When dealing with a process that spans multiple disparate business objects like this, my first worry is always coupling.&nbsp; What I would usually do in this situation is create a process object (ChangeQuotePricelist or something like that) that handles changing the price list on a quote.&nbsp; This object now serves as a mediator for this special business process, it handles the interaction between the separate quote/line item and price list/price object hierarchies.&nbsp; If you need a process that updates multiple objects and saves them, then I inherit from CommandBase so I can ensure that they happen within the same transaction.</P>
<P>Personally I would avoid having the quote/line items fetching and using the price list/price objects directly.&nbsp; It will work but if you put this type of coupling everywhere in your app, as it grows and changes you are going to have a tougher time maintaining it.&nbsp; Don't get me wrong, coupling needs to happen somewhere.&nbsp; But the mediator pattern was created to make the pain of it as low as possible.&nbsp; Personally I use process objects quite a bit for this exact reason and have been very happy for doing so.</P>
<P>Thanks,</P>
<P>Kevin</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
