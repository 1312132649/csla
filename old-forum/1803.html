<html><header><title>Using the same Business Objects in Winforms Client and WebService</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Using the same Business Objects in Winforms Client and WebService</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1803.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D posted on Tuesday, November 21, 2006</h2><P>Hi,</P>
<P>I'm currently developing an application for SmartClient wherein I must call a webservice to access my database. </P>
<P>I would like to have the business objects seamless to the user. That is, if the user calls Project.GetProject(id), the class will call the webservice to access the database, and populate the instance. No problem there, my DataPortal_XYZ methods simply call a webservice.</P>
<P>However, to make things simpler for the developers, I'd like to use the same classes when developing the webservice.This webservice is NOT a data portal. I'm not using WS instead of remoting. </P>
<P>That is, Project.GetProject(id) when called on the client, will call the underlying WS layer, whereas in the ASP.NET Webservice, it will access the database.</P>
<P>I will be using classes akin to ProjectData (From Chapter 11), to return the data.</P>
<P>Has anyone tried this? </P>
<P>I'm using the MS ServiceInterface pattern for my service, and would like to also implement that interface on the client. This will provide the consistency that I need, and hopefully not at the cost of complexity.</P>
<P>Many thanks,</P>
<P>Sean</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, November 21, 2006</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>Sean D:</strong></div><div><p>That is, Project.GetProject(id) when called on the client, will call the underlying WS layer, whereas in the ASP.NET Webservice, it will access the database.</p></div></BLOCKQUOTE><br><br>Just to make sure I understand you correctly:<br><br>You have one smart-client app:<br>- winforms UI<br>- which calls a webservice to fetch BOs<br>- and the webservice calls your DB to fetch data<br><br>And you have a web app:<br>- webforms UI<br>- which directly calls the DB to fetch BOs ..?<br><br>Isn't it true that in both cases your BOs need to populate themselves from the DB?<br><br>I don't understand what you mean by 'my DataPortal_XYZ methods simply call a webservice'. Why don't you use the App.Config file to tell CSLA that your BOs should fetch their data through a webservice? In that case, your DataPortal_XYZ methods could be programmed to fetch data using ADO.Net, and the CSLA dataportal will take care of the Webservice part.<br><br>Maybe I did not fully understand your challenge, let me know if you need more info.<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D replied on Tuesday, November 21, 2006</h2><P>Hi,</P>
<P>I have a Winforms app only. I;m developing an ASP.NET WebService. I can't use the DataPortal as a webservice (CRUD functions). My webservice may be used by other apps.</P>
<P>However, when I use the webservice from my application (Winforms), I'd like to use the same class library that I used in the actual webservice. When the static methods, e.g. GetProject(),&nbsp;are called on the client, the DataPortal_XYZ methods will call the webservice, and when the same methods are called in the webservice gateway, the methods will access the database via ADO.NET.</P>
<P>I would like to use the webservice dataportal to create, update, etc from my client, but that's not an option, as future clients will be unaware of this functionality, and will access the webservice methods&nbsp;directly. These will be methods like GetProject(), GetProjectList(), and will return typed data (that's described in the WSDL). </P>
<P>I hope that clarifies things somewhat.</P>
<P>Thanks,</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, November 21, 2006</h2><P>It seems to me (and trust me, I am no expert as I am only now&nbsp;venturing into this area myself), that the only conflict that you have is differentiating the call on the client which is to pass the request onto the web service and the call on the server that is to perform the data access and return the desired BO. Isn't this handled by the web service itself?</P>
<P>What I mean is, when you call Projects.GetProjectList() on the client, even though it seems like you are calling your BO directly, you are calling a proxy created for your web service.&nbsp; The web service handles the fact that this call has occurred on the client and passes the call onto the server-side web service.&nbsp; The body of the method actually executes on the server so you can easily implement whatever data access code you need - in fact, this is where you would implement the data portal to allow for a distributed architecture on the server(s).</P>
<P>As such, your application is actually entirely on the server.&nbsp; What you have done is exposed a service interface, via the web service to allow client applications to hook into the application.</P>
<P>Now, the catch is, at least as far as my knowledge goes, is determining the proper way to work with the returned objects.&nbsp;&nbsp;The "object" that is returned from the web service is coming across&nbsp;in an XML serialized format.&nbsp; So, the proxy should be able to deserialize the stream into the BO on the client so that it can be used as expected.&nbsp; You'll just have to have the client app reference the class library that contains the class definitions.</P>
<P>Oh, one other thought, to simplify the logic we are considering that it might be easier to use a factory to serve as the interface to the WS rather than the BO.&nbsp; So, instead of Projects.GetProjectList(), we would have ProjectFactory.GetProjectList() where ProjectFactory is the WS proxy and the method returns a ProjectList BO.&nbsp; This separates the web service part from the BO.</P>
<P>Hope that helps.&nbsp; I am interested in how you proceed.&nbsp; As I said, I am just delving into this approach myself.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D replied on Tuesday, November 21, 2006</h2><P>Hi guys,</P>
<P>Thanks for the feedback. </P>
<P>Let me try and make an analogy to the ProjectTracker examples.</P>
<P>I'm using the PTWebService ASP.NET WebService.</P>
<P>My client (PTServiceClient in this case) currently calls the PTService.GetProjectList() webservice method, that returns an array of ProjectData.</P>
<P>What I want to do, in PTServiceClient, is to have access to the Library classes, and just call call ProjectList.GetProjectList(). This will then call the WS method, which returns the ProjectData array, which then populates the ProjectList with Projectinfo structures.</P>
<P>This might seem like overkill, but it gives me the options I need on the ASP.NET WebService. That is, the service can be used by other applications that don't use the Library.</P>
<P>Does this make sense?&nbsp;I could, I suppose, put some code in the ProjectList::dataPortal_Fetch to determine the context (i.e. WinForms, or WebService), and execute the WS or ADO.NET code accordingly. does that seem like a reasonable approach?</P>
<P>Thanks,</P>
<P>Sean&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, November 21, 2006</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>Sean D:</strong></div><div><p>I would like to use the webservice dataportal to create, update, etc from my client, but that's not an option, as future clients will be unaware of this functionality, and will access the webservice methods&nbsp;directly. These will be methods like GetProject(), GetProjectList(), and will return typed data (that's described in the WSDL). </p></div></BLOCKQUOTE><br><br>Ahhhhh, now I get it. ;-)<br><br>The solution is simple: have 2 webservices .... <br>- one that hosts the dataportal and provides CRUD functionality<br>- another one that you expose to the external world and provides all your GetProject, GetProjectList, etc. functions<br><br>This would nicely deal with all your scenarios:<br>- your BOs can forget about webservices, all you program in the dataportal_xxx methods is ADO.net code that allows a BO to populate itself from the DB<br>- in your Winforms app you configure the app.config file so CSLA uses the webservice as dataportal host<br>- you do the same in your public (non-dataportal) webservice<br>- and for this latter webservice you can define whatever methods you like (GetProject, GetProjectList etc) and all your method bodies would contain just 1 line of code I guess that invokes the factory method of the particular BO<br><br><br>Thinking about it, this also yields nice benefits for your security as you can fully lock-up the dataportal webservice with all the CRUD functionality on the one hand, and on the other hand you are in full control of what functionality you expose publicly in the second webservice.<br><br>Does this solve it?<br><br>Bayu<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 21, 2006</h2>Sean,<br><br>Regarding your web service.&nbsp; Your web service should use the BOs just as your winforms app would.&nbsp; In effect, your web service should provide a facade.&nbsp; Now, you should NOT expose your BOs to clients of the web service.&nbsp; If you do this, you couple the interface of your service to the interface of your BOs, and every change to your BOs will break any clients using your web service... and thats exactly the opposite of what you want to have happen.<br><br>Regarding your WinForms application.&nbsp; Have it use the BOs directly just as it has been doing.&nbsp; There's absolutely no good reason an application which you have control over to use a web service to talk to a business layer which you also have control over.&nbsp; The business layer may use Web services to talk to the database (which would be the WSDataPortal), but you've indicated you do not want to do that.&nbsp; So there really is no reason at all to use Web services from within your WinForms application.&nbsp; If you have the WinForms use the Web service you're exposing to clients you're just adding unnecessary overhead and complexity and you gain nothing.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D replied on Tuesday, November 21, 2006</h2><P>Hi guys,</P>
<P>Thanks for the excellent feedback. I've tried the following, and it works. But, its not the nicest of solution:</P>
<P>In ProjectList::DataPortal_Fetch() I do the following:</P><FONT size=2><FONT size=2>
<P>System.Web.</FONT><FONT color=#008080 size=2>HttpContext</FONT><FONT size=2> l_Context = System.Web.</FONT><FONT color=#008080 size=2>HttpContext</FONT><FONT size=2>.Current;</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (l_Context == </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>) </FONT><FONT color=#008000 size=2>// We're not in a WS or Web App</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (PTService.</FONT><FONT color=#008080 size=2>PTService</FONT><FONT size=2> svc = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> PTService.</FONT><FONT color=#008080 size=2>PTService</FONT><FONT size=2>())</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.IsReadOnly = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>ProjectData</FONT><FONT size=2> l_Project </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> svc.GetProjectList())</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Add(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ProjectInfo</FONT><FONT size=2>(l_Project.Id, l_Project.Name));</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.IsReadOnly = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> cn = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>Database</FONT><FONT size=2>.PTrackerConnection))</P>
<P>{</P>
<P>cn.Open();</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlCommand</FONT><FONT size=2> cm = cn.CreateCommand())</FONT></P>
<P><FONT size=2>.</FONT></P>
<P><FONT size=2>.</FONT></P>
<P><FONT size=2>Rest of existing code......</FONT></P>
<P><FONT size=2>}</FONT></P>
<P><FONT size=2>In the PTWebService, ProjectList.GetProjectList() &nbsp;is called as normal.</FONT></P>
<P><FONT size=2>In the PTWin application, I call ProjectList.GetProjectList() - This now calls the PTWebService (as in the above code)... </FONT></P>
<P>My problem here is that a) theres a reference from the ProjectTracker.Library to the PTService, and b) if the ProjectList object is called from an ASP.NET application, it will alway call the ADO.NET directly.</P>
<P>This is the kinda thing I'm trying to do. I don't really want to do it this way though. Any ideas?</P>
<P>Many thanks,</P>
<P>Sean<FONT size=2></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D replied on Tuesday, November 21, 2006</h2><P>One final thing.</P>
<P>I dont want to use the WebServicePortal, because I don't want objects being created and passed around the network at this time with neither Remoting nor SOAP/WS.</P>
<P>However, I might be changing to either .NET Remoting host, or webservice host at a later date. </P>
<P>Currently,&nbsp; CSLA.NET is configured for local dataportal only. But, as per my changes in the previous post, it calls an ASP.NET webservice (NOT the portal).</P>
<P>Regards,</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 21, 2006</h2>Sean,<br><br>It looks like what you want is a DAL that abstracts away your data access, so that you have objects which represent tables or views, but you don't know the underlying database.<br><br>Look into NHibernate if that's what you're trying to do.&nbsp; That way your web service has a certain configuration which will get its data from a web service, and your forms app will have another configuration file that uses Sql server directly.<br><br>I must admit though I'm note sure if NHibernate supports a 'web service database,', so you may have to roll your own.. but the concept is the same.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sean D replied on Monday, November 27, 2006</h2><P>Thanks everyone for your excellent responses. I've come to a solution to my predicament.</P>
<P>I am going to share my objects library between the webservice, and the client (winforms). The data access methods' implementation will be configured using a factory. The factory, configured from the config file, creates one implementation that calls the webservice methods, and the other implementation that calls the ADO.NET&nbsp;implementation.</P>
<P>Effectively, my webservice is simply an added layer of communication. I will be testing the use of&nbsp; the Remoting Data Portal, and WebServices data portal to see if the overhead of passing the objects round the network is minimal enough to remove my webservices comms layer. </P>
<P>Regards,</P>
<P>Sean</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
