<html><header><title>Massive Memory Growth with saving using DataPortal (CSLA 3.8.4.0)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Massive Memory Growth with saving using DataPortal (CSLA 3.8.4.0)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12448.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>xenoputtss posted on Thursday, March 06, 2014</h2><p>We having been using CSLA for the better part of 2 years now, no real issues. &nbsp;We have discovered a issue with some new code when we go to save a lot of rows.</p>
<p>Our memory usage for our app typically remains below &lt; 400mb in size. &nbsp;With this new code (albeit it there is more data) our memory usuage will jumb from ~350MB to just over 2.5GB. &nbsp;I traced this down to, what I think is happening, and it appears that the dataportal is doing binary xml serialization of the object (creating a 2.5GB xml), sending this over the network to the DataPortal host.&nbsp;</p>
<p>&nbsp;</p>
<p>I&#39;m not sure what the resolution is. &nbsp;I&#39;m wondering if I should change from using an IIS hosted DataPortal to .net Remoting. &nbsp;Should I upgrade CSLA to a newer version. &nbsp;Should I do something else?</p>
<p>&nbsp;</p>
<p>We are using .net 4.0, &nbsp;CSLA 3.8.4.0, IIS Hosted DataPortal, IIS7.</p>
<p>Let me know any more information i can provide. &nbsp;I do not have a working example that I can post (if it is needed, i can try to make one)&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, March 08, 2014</h2><p>There are a couple things to consider.</p>
<p>First, if you upgrade to CSLA 4 or higher you&#39;ll be able to use a new formatter we wrote to shrink the size of the serialized data. If that&#39;s an option for you that might be the best solution.</p>
<p>Second, if you can&#39;t upgrade you can look at using compression. This won&#39;t help memory consumption, but can help radically reduce the amount of data transferred over the network. There&#39;s a perf cost to running compression, but it is usually more than offset by the bandwidth savings. Unfortunately it isn&#39;t until in CSLA 4 that there&#39;s a real easy way to do compression in the .NET data portal, but you can (or could) find some WCF bindings that do compression.</p>
<p>Third, and this is perhaps the most extreme, you can look at the DiffGram sample (I think it is in the Silverlight samples folder) that shows how to send only changed data over the network. If you do this you give up the mobile object concept and many of the benefits of the data portal, but if you have a specific object graph that is very large this can be a worthwhile tradeoff to get better performance (just apply it to that one object graph).</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, March 08, 2014</h2><p>This FAQ page may be helpful:</p>
<p><a href="http://www.lhotka.net/cslanet/faq/DataPortalFaq.ashx">http://www.lhotka.net/cslanet/faq/DataPortalFaq.ashx</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xenoputtss replied on Monday, March 10, 2014</h2><p>I think upgrading seems to be our most logical step since compression won&#39;t reduce the memory usage at the client end.</p>
<p>&nbsp;</p>
<p>I&#39;m not incredibly knowledgeable in this area, but I thought I read somewhere about using .net Remoteing, would this offer any benefit to this issue? &nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, March 12, 2014</h2><p>Remoting won&#39;t help here because it uses serialization too, and it is serialization that&#39;s consuming your memory.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
