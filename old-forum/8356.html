<html><header><title>DeletedList not cleaned up.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DeletedList not cleaned up.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8356.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Thursday, January 14, 2010</h2>Hello,<br /><br />I was experimenting a little with collection items when I ran into the following scenario:<br /><br />1.	Fetch root object.<br />2.	Add child object “X” to the root object collection.<br />3.	Remove child object “X” from the root object collection.<br /><br />At this point I would expect for the DeletedList to be empty but it still contains the “X” object and for the looks of it, this object will never go away.<br /><br />This works appropriately.<br /><br />1.	Fetch root object.<br />2.	BeginEdit on root object.<br />3.	Add child object “X” to the root object collection.<br />4.	Remove child object “X” from the root object collection.<br />5.	ApplyEdit on root object.<br /><br />This will clean up the DeleteList as I would expect.<br /><br />Personally, I think that for the first example, the CSLA should realize that the object is new and that edit level is zero and should just nuke that object “X” straight away and not put it into the DeleteList.<br /><br />The other option would be for the CSLA to throw an exception when adding a new child when edit level is equal to zero..... now, I can almost smell the response to that, it will go something like “This behavior is by design” followed by something like “This allows something like ASP to be more efficient” or something.<br /><br />I am still experimenting with this so I would appreciate if someone could tell me if I am missing something. I tried to follow the code but it looks somewhat complex and I don’t necessarily want to dive into this right now…. at least not for this list type, is not worth the time for me, I probably would for the observable one.<br /><br />Thanks</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, January 14, 2010</h2><P><FONT face=Tahoma size=2>The DeletedList collection primarily exists to support undo functionality.&nbsp; That's why the second set of steps is what's giving you the behavior you expect.&nbsp;&nbsp;So "nuking the object straight away" would&nbsp;break undo, since you could no longer get that object back if the user pressed "Cancel".</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, January 14, 2010</h2>Thanks Scott,<br /><br />The thing is that we are in the *same* edit level when we do add/remove so to me it makes no sense to put a brand *new* object into the deleted collection to in such scenario.<br /><br />When we add and remove an object while in the same edit level, a CancelEdit() as well as ApplyEdit() operation would end up removing the object from the DeletedList so what is the point for putting it there in the first place?<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, January 14, 2010</h2><P><FONT face=Tahoma size=2>If you think beyond a simple OK/Cancel scenario, what if you have a user who entered&nbsp;the new&nbsp;child record and then deleted it by accident?&nbsp; If the application provides&nbsp;an undo facility on the data-entry screen, then they can get their new record back, complete with the values they entered.</FONT></P>
<P><FONT face=Tahoma size=2>It is admittedly something of an edge case.&nbsp; But it's also the "more consistent" method of handling objects - no special coding required for new objects.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Friday, January 15, 2010</h2>Not sure I am following you, are you describing the following scenario?<br /><br />1. Fetch root object. <br />2. BeginEdit on root object. <br />3. Add child object “X” to the root object collection. <br />5. CancelEdit on root object. <br /><br />Because if you are describing this scenario, then the “X” object will simply go away. <br /><br />I am pretty sure this is not what you meant though. Could you please be little bit more specific? I think I am just missing something very simple.<br /><br />Just to be sure, we are still talking about adding and then removing at the same edit level right?<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, January 15, 2010</h2><P><FONT face=Tahoma size=2>User has a form where they can enter several child objects at once - basically, a single&nbsp;form to manage the entire collection as a group, if you will.</FONT></P>
<P><FONT face=Tahoma size=2>1. User opens form.</FONT></P>
<P><FONT face=Tahoma size=2>2. User&nbsp;creates a new child item and adds it to the list.</FONT></P>
<P><FONT face=Tahoma size=2>3. User accidentally deletes the newly-created child from the list.</FONT></P>
<P><FONT face=Tahoma size=2>4. User utters favorite expletive, then clicks the "Undo" button/menu option/toolbar button.</FONT></P>
<P><FONT face=Tahoma size=2>5. User is happy, as the newly-created child object they deleted is back, complete with all the information they already entered.</FONT></P>
<P><FONT face=Tahoma size=2>6. User clicks "OK" to save the whole shebang and exit the form.</FONT></P>
<P><FONT face=Tahoma size=2>This is not a simple cancel/apply operation, because this isn't a block-level operation.</FONT></P>
<P><FONT face=Tahoma size=2>After checking things over, this is admittedly not a scenario that CSLA directly supports.&nbsp; But it is possible to make this work, at least on a limited basis, as I've done it before.&nbsp; If you directly dumped the child object, it would be impossible.&nbsp; </FONT><FONT face=Tahoma size=2>Based on that, if it was decided to simply dump new children instead of moving them to the deleted list, I likely don't have a good case to keep the old functionality around.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
