<html><header><title>DataPortal.Fetch exception fail when connecting to sql server 2008</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal.Fetch exception fail when connecting to sql server 2008</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7021.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidIS posted on Friday, May 29, 2009</h2>Hi. <br>currently we are using csla 1.5 on a sql server 2000 box. however, we are trying to test using a sql server 08 box. <br>when we keep trying to connect to the 08 box we receive an error. (detailed error posted below).<br>The error occurs on BusinessPrincipal.Login(dlg.Username, dlg.Password)<br>If you have any suggestions that would be great. we are using a windows auth connection with sspi security integration. <br><br>Thanks for any help you can give me. <br><br>CSLA.DataPortalException was unhandled<br>&nbsp; Message="DataPortal.Fetch failed"<br>&nbsp; Source="CSLA"<br>&nbsp; StackTrace:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnection owningObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(String host, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, Int64 timerStart)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Security.BusinessIdentity.DataPortal_Fetch(Object Criteria)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Server.DataPortal.CallMethod(Object obj, String method, Object[] params)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Server.DataPortal.Fetch(Object Criteria, DataPortalContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.DataPortal.Fetch(Object Criteria)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Security.BusinessIdentity.LoadIdentity(String UserName, String Password)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Security.BusinessPrincipal..ctor(String Username, String Password)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at CSLA.Security.BusinessPrincipal.Login(String Username, String Password)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at RM.Main.DoLogin() in C:\development\New Folder\RM.root\RM\RM\Main.vb:line 1199<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at RM.Main.Main_Load(Object sender, EventArgs e) in C:\development\New Folder\RM.root\RM\RM\Main.vb:line 1108<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.EventHandler.Invoke(Object sender, EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.OnLoad(EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.OnCreateControl()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.CreateControl()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmShowWindow(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ScrollableControl.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ContainerControl.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.WmShowWindow(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.UnsafeNativeMethods.SendMessage(HandleRef hWnd, Int32 msg, Int32 wParam, Int32 lParam)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.SetVisibleCore(Boolean value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.set_Visible(Boolean value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.Run(ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.OnRun()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.DoApplicationModel()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.Run(String[] commandLine)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at RM.My.MyApplication.Main(String[] Args) in 17d14f5c-a337-4978-8281-53493378c1071.vb:line 81<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 29, 2009</h2><P>I'd try creating a tiny test app - no CSLA or anything - just open a connection to your database.</P>
<P>The exception is occuring on the Open() call to the connection - so you may have a problem with your connection string, or maybe you need to update the SQL Server client components on your client or something.</P>
<P>Or, if you can run a debugger on this machine, attach the debugger and break on the Open() statement, so you can see what exception you are getting from the Open(). In later versions of CSLA this would be visible in the stack trace, but not in 1.5...</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
