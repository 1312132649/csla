<html><header><title>How to partial class References.cs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to partial class References.cs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1272.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes posted on Tuesday, September 19, 2006</h2><P>I have subclassed the CSLA framework.&nbsp; I am in the process of adding the functionality I need by create partial classes that add to the framework functionality.&nbsp; I am finished with it upto the point where I have to work with <FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>partial</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>WebServicePortal.</FONT><FONT size=2> </FONT></P>
<P>I found this class in a file called references.cs under "Csla\Web References\WebServiceHost".&nbsp; I need to add four things to this web service.&nbsp; Specifically</P>
<P>DeactivateCompletedEventArgs<BR>DactivateCompletedEventHander</P>
<P>ReactivateCompletedEventArgs<BR>RactivateCompletedEventHander</P>
<P><FONT size=2><FONT size=3>The problem is I do not see this file represented anywhere in Visual Studio.&nbsp; I am not familiar with Web Services and I am trying to learn so I know how to add this functionality, but if anyone can clue me in, I would appreciate it.</FONT></FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Friday, September 22, 2006</h2><P>Are you using web services for your inter-tier communication within CSLA?&nbsp; Rocky's position is that's there really just to demonstrate that any communication channel was possible and he didn't expect it to be&nbsp;widely useful.</P>
<P>Besides that question, I'm not expertly familiar with this either, but what you're trying to do looks a little bizarre.&nbsp; Are you trying to somehow implement&nbsp;event functionality to a web service DataPortal channel above what's already in&nbsp;in the web service itself?</P>
<P>BTW, by subclassing CSLA rather than modifying it I never meant using partial classes but rather inheritance.&nbsp; The goal was to leave CSLA exactly as is as much as possible.&nbsp; It's probably not a tremendously difficult thing, but you have to go back through and set up all the CSLA classes as partial when you want to use a new CSLA version, right?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Friday, September 22, 2006</h2><P>&nbsp;&nbsp;&nbsp;Well, I am implementing is exactly like the Fetch, Delete, Update etc routines that already exist.&nbsp; I am only trying to add two&nbsp;more methods.&nbsp; They are called</P>
<P>Deactivate <BR>Reactivate</P>
<P>&nbsp;(The naming was because made done because an object will assume to be active whenever it is created, so it must first be deactivated.)</P>
<P>&nbsp;&nbsp;&nbsp;Anyway I needed to add these two methods and when I did, I just followed the compiling error messages throughout the framework and created the code I needed to accomplish this. I was able to hack the framework to do this in my original foray into the framework.&nbsp; </P>
<P>&nbsp;&nbsp;&nbsp;Taking your advice, I am tried to subclass the functionality, but it is impossible because it requires additional code throughout the framework in order to support the additional two methods.&nbsp; .&nbsp; So my next solution was to create partial classes where the additional code was needed.&nbsp; That way when a new version of the framework came out, I would just need to go into the original code and change the classes to partial and then copy my custom partial classes.&nbsp; This all works fine, until Web Services.</P>
<P>&nbsp;&nbsp;&nbsp;By the way, I originally thought about just using the Update functionality to implement the Reactivate, Deactivate capability but it occured to me that a Reactivate or Deactivate stored procedure would be different than an Update stored procedure.&nbsp; The Update SP just updates a single object.&nbsp; A Reactivate/Deactivate&nbsp;SP would behave more like a Delete SP, where they go through the related tables and Reactivate/Deactivate the associated records.&nbsp; Now that I think of it, I guess I <EM>could</EM> make a special field in each SP that would call a seperate stored procedure depending on the value contained in it.</P>
<P>&nbsp;&nbsp;&nbsp;Maybe I will give that a try instead.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Friday, September 22, 2006</h2>Oh hey.&nbsp; Thanks a ton.&nbsp; I was really at a dead end with this.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Friday, September 22, 2006</h2><P>I'm still confused, and probably will remain so unless I retrace all your steps and see what you're seeing.</P>
<P>The references.cs file is something built automatically by Visual Studio when you reference a web service.&nbsp; But apparently not trying to change the functionality of the web service itself, right?&nbsp; (If you are then I think you've taken a wrong turn somewhere.)</P>
<P>So I'm still really puzzed at how you ended up in references.cs.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Friday, September 22, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DansDreams:</strong></div><div>
<P>I'm still confused, and probably will remain so unless I retrace all your steps and see what you're seeing.</P>
<P>The references.cs file is something built automatically by Visual Studio when you reference a web service.&nbsp; But apparently not trying to change the functionality of the web service itself, right?&nbsp; (If you are then I think you've taken a wrong turn somewhere.)</P>
<P>So I'm still really puzzed at how you ended up in references.cs.</P>
<P></div></BLOCKQUOTE></P>
<P>Let me use the original base code as an example.&nbsp; </P>
<P>&nbsp;&nbsp;&nbsp;When you call the Save() function in your object, it starts code that goes THROUGH the framework which allows the object to be moved to the application server and ultimately calls your DataPortal_Update() at the application server.&nbsp; There are also capabilities for code to be run when the update completes.&nbsp; In order to accomplish this, there are&nbsp;DataPortal_Update type references&nbsp;throughout the framework.&nbsp; For instance, the web services has UpdateCompletedEventArgs and UpdateCompletedEventHandler;&nbsp; the RemotingPortal class has the&nbsp;<FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>DataPortalResult</FONT><FONT size=2> Update(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> obj, </FONT><FONT color=#008080 size=2>DataPortalContext</FONT><FONT size=2> context).&nbsp;&nbsp;</FONT>&nbsp;So there are references to the following functions that are prevasive throughout the framework:</P><FONT size=2>
<P>DataPortal_Fetch<BR><FONT size=2>DataPortal_Insert<BR><FONT size=2>DataPortal_Update<BR><FONT size=2>DataPortal_Delete</FONT></FONT></FONT></P>
<P><FONT size=2><FONT size=2><FONT size=2><FONT color=#000000 size=3>What I am trying to do is add </FONT></FONT></FONT></FONT></P>
<P>DataPortal_Deactivate<BR>DataPortal_Reactivate</P>
<P><FONT color=#000000 size=3>to the capability list such that I can assign seperate stored procedures to these.&nbsp; And call them seperate from any of the above four processes.&nbsp; I cannot do this via subclassing because the framework needs to be aware that those two additional functions exist, so when I tell it to execute them&nbsp;it&nbsp;knows how to find them.</FONT></P>
<P><FONT color=#000000 size=3>.&nbsp; I created partial classes everywhere I had to add additional code and it was around 15 - 20 additional files.&nbsp; Still, I was ok with that because my code was seperate from the frame work.&nbsp; But then I ran into the Web Reference part of the Web Services.&nbsp; I don't know much about Web Services and I manually found "references.cs"&nbsp; but I couldn't find it in Visual studio.&nbsp; </FONT></P>
<P>&nbsp;&nbsp;&nbsp;<FONT size=3>As it is, I think that I have thought of a way to work around the issue.&nbsp; If I make special parameters in my Update Stored Procedure, I can tell it that I am Reactivating or Deactivating an object and thus run a&nbsp;different stored procedure than the normal Update Stored Procedure.</FONT></P>
<P><FONT size=3>&nbsp;&nbsp;&nbsp;BTW, I ended up in "references.cs" because when I started adding functionality to the framework, I would get errors because a supporting object would not support my Reactivate/Deactivate functionality.&nbsp; So I would then move to that object, see what it did and write the code to enable the functionality at that level.&nbsp; I would try a rebuild and it would complain because a supporting&nbsp;object didn't support the functionality.&nbsp; Rinse-and-repeat.&nbsp; I followed this process until I got to Web Services.&nbsp; Then I was not able to resolve the error.&nbsp;&nbsp;I couldn't find the WebServicePortal in Visual Studio so I dropped out of Visual Studio and started looking for it.&nbsp; I found it in "references.cs".</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Monday, September 25, 2006</h2><P>I think the statement or observation of those four methods being pervasive throughout the framework might be a little misleading.</P>
<P>The DataPortal is simply a design&nbsp;whereby client code calls a DataPortal method on the "server" (which may of course actually be on the same machine) which in turn calls a perdertermined method back on the passed client BO via reflection.&nbsp; At that point it really has nothing particularly&nbsp;to do with web services unless you're specifically trying to use the web services channel.</P>
<P>Which is to say that you would not have to modify every single class in which you find some code dealing with the DataPortal_XYZ methods.&nbsp; Only the ones you <EM>need</EM> to.</P>
<P>So again I ask, are you trying to use the web services channel for this kind of intranet inter-tier communication?&nbsp; If so, was this mandated or a decision of yours?</P>
<P>BTW, you probably don't have the "show all files" option on in Visual Studio.&nbsp; It's a button in Solution Explorer and will show you all the files behind the scenes when switched on.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 25, 2006</h2><P>&nbsp;&nbsp;&nbsp;So far all my decisions have been mine.&nbsp; Until this morning I haven't had input from anyone else in my company.&nbsp; This morning, in a meeting, we decided to use LocalProxy.&nbsp; So I don't <STRONG><EM>need</EM></STRONG> any of the other channels.&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;On the otherhand,&nbsp;I do not want to have to recompile and redistribute the DLLs when/if a change comes allong that makes me centralize the application server.&nbsp; Also, even if you use Local Proxy but&nbsp;you add the Reactivate/Deactivate functionality, how can you get the framework to compile.&nbsp; </P>
<P>&nbsp;&nbsp;&nbsp;In order to get the functionality, you would have to modify the&nbsp;<FONT color=#008080 size=2>IDataPortalServer </FONT>interface.&nbsp; To add the functions </P>
<P>Reactivate(<FONT color=#008080 size=2>Type</FONT><FONT size=2> objectType, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> criteria, </FONT><FONT color=#008080 size=2>DataPortalContext</FONT><FONT size=2> context</FONT>)&nbsp;<BR>Deactivate(<FONT color=#008080 size=2>Type</FONT><FONT size=2> objectType, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> criteria, </FONT><FONT color=#008080 size=2>DataPortalContext</FONT><FONT size=2> context</FONT>)</P>
<P>&nbsp;&nbsp;&nbsp;Once you did that, you would invalidate the pre-existing, unmodified&nbsp;channels because they don't implement those functions.&nbsp; So then you would have to "Exclude from Project" on them from the context menu in order to get it to compile.&nbsp; Then you loose the capability to use the different channels without re-compiling later.</P>
<P>&nbsp;</P>
<P>&nbsp;&nbsp;I&nbsp;am happy to continue to discuss this because I would love to learn a bit more about this stuff,&nbsp;but I don't want to annoy you in any way.&nbsp; I appreciate your help and insight.&nbsp; Asi it is, I have thought up a work-around solution, thanks to your prodding from earlier in this post.&nbsp; I am going to impliment the work around this week.</P>
<P>&nbsp;</P>
<P>P.S.&nbsp; In my VS2005, the "Show All Files" icon at the top of the Solution Explorer is inaccessible.&nbsp; It looks greyed-out, but it is hard to tell.&nbsp; At anyrate, I cannot select like the other two icons.</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
