<html><header><title>Simple question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Simple question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1515.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Tuesday, October 17, 2006</h2>Hi,<br><br>I have a phone number class.&nbsp; It has a type, such as fax, cell, etc.&nbsp; The types are loaded from the database so that we can extend them easily.<br><br>Now I have an object which has PhoneNumber and FaxNumber as properties.&nbsp; Both of these properties are of type PhoneNumber.&nbsp; Obviously I want to set the type and not allow changes.<br><br>Easy enough..<br><br>FaxNumber = PhoneNumber.New( PhoneTypeList.List.Key( "Fax" ) );<br><br>Not too crazy about hard coding the string Fax, but not too sure if there's a way around it (although i'll probably drop it in the resx file, but its still basically hardcoding Fax there).&nbsp; Now, this table is not user modifiable, so maybe I'm worrying about nothing?<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Henrik replied on Wednesday, October 18, 2006</h2><P class=MsoNormal><SPAN>Andy<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I too have struggled to come up with a solution for this. Here’s how I solved it.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I have built a class library for Party/Address management which is being used in<SPAN>&nbsp; </SPAN>several of my systems. The library is built on the Party/Role idea´s of Len Silverston, where all methods of contact to a Party is stored in a ContactMethod collection. Addresses are stored in an Address collection:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Party<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp; </SPAN>AddressList<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Address<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp; </SPAN>ContactMethodList<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>ContactMethod<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Each ContactMethod has a ContactMethodType. <o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>In my first iteration I thought that I could just create an enum to represent the types of contact methods but soon found that another of my apps needed other types and some of the existing types had to be removed. So I put the types into a DB table and changed the code to be a NameValueList.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Now this posed a problem, since my code couldn’t just say: “Give me a Party’s Home Phone number” anymore, by specifying an enum id. It had to lookup the id of the “Home Phone” type in the NameValueList, by specifying the textual representation.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>This posed another problem, since almost all of my apps are globalized/localized, where a copy of my app running in an english speaking country would have a “Home Phone” textual representation but a copy running in a danish speaking country would have a “Telefon hjem” textual representation.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN></SPAN>&nbsp;</P>
<P class=MsoNormal><SPAN>First I thought of adding the localized textual representations to a resource file, but this defeated the purpose of having a dynamically changing ContactMethodType collection, since it would require me to add/remove textual representations in the resource files as well. Furhermore I had users running a danish copy of a system but with english localization. That totally broke this idea.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>So I took the 1000 mile high view on what I was trying to solve and what I actually needed to do within my code. I found that there was only a handfull of ContactMethodTypes and AddressTypes that my code needed to know internally like. <o:p></o:p></SPAN></P>
<UL>
<LI class=MsoNormal><SPAN>Create a Home Phone number for a party<o:p></o:p></SPAN></LI>
<LI class=MsoNormal><SPAN>Create a Fax number for a party<o:p></o:p></SPAN></LI>
<LI class=MsoNormal><SPAN>Get the party’s Fax number<o:p></o:p></SPAN></LI>
<LI class=MsoNormal><SPAN>Get the party’s Email<o:p></o:p></SPAN></LI>
<LI class=MsoNormal><SPAN>Get the party’s home address<o:p></o:p></SPAN></LI>
<LI class=MsoNormal><SPAN>And so on<o:p></o:p></SPAN></LI></UL>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>So I added an extra “TypeDescriptor” field to my ContactMethodType table which uniquely identifies the types I know my code will need access to.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>The following is an excerpt of a danish copy of my ContactMethodType table with type descriptors:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>TypeId<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>TypeName<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>TypeDescriptor<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>1<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Telefon hjem<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>HomePhone<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>2<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Telefon arbejde<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>WorkPhone<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>3<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Fax<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Fax<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>4<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Anden Fax<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P class=MsoNormal>5<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>E-post 1<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Email</P>
<P class=MsoNormal>6<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Anden telefon<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></P>
<P class=MsoNormal><SPAN>7<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Anden fax<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>8<SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>…<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>The types that doesn’t have a type descriptor cannot be directly looked up by code.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>When I design a new app I first select which type descriptors the code needs to lookup. Then I assign these to the ContactMethodTypes like above.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>Then in my ContactMethodType NameValueList, I have a method that allows me to get the TypeId, so I can write code that looks like yours:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Dim phone As ContactMethod<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>phone = ContactMethod.Create(ContactMethodTypeList.FromDescriptor(“HomePhone”))<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>This allows me to “hardcode” that TypeDescriptors and still have the TypeName localized. I can still bind the NameValueList to a combo, where the user picks the localized version of a type.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>It also allows a sysadm to add new ContactMethodTypes to the table without adding/altering code. Of course, if a sysadm removes a TypeDescriptor that is used in code, the NameValueList will return nothing and the code needs to handle this exception. I usually log an exception, for example <SPAN>&nbsp;</SPAN>“HomePhone TypeDescriptor not found” and notifies the user of the problem.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I too thought that this was a lot for almost nothing, but even the seemingly simplest problems can be quite hard to tackle when you throw in dynamically changing lookup lists and localization.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I guess I’ve been babbling enough, but I hope you can use some or all of this.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Cheers<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>/Henrik<o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 18, 2006</h2>This solution sounds fine to me.&nbsp; Since I don't have to globalize the code though, it sounds like I can use the name as the descriptor.&nbsp; Might be a good idea to have a seperate FromDiscriptor method though and use that, in case I do need globalization later.<br><br>Thanks!<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, October 18, 2006</h2><P>The issue is not a big deal if you are limited to accessing the information blindly in your code, i.e. leaving it to the UI to make the distinction.&nbsp; This would be the case when you have a drop-down list display all of the types and a textbox or label display the number.&nbsp; Then, you can simply use what the user selected as your key.&nbsp; Since both come from the DB, you know they will always be valid and expand/contract as your DB does.</P>
<P>However, what you are describing is the need to hard-code a specific type into a property.&nbsp; First, are you sure you want to do this?&nbsp; Assuming you are, you are left with the fact that at some point, no matter what approach you take, you are going to be left hard-coding the "key".&nbsp; But, the good news is that you don't necessarily need to worry about extensibility and what happens with new keys, etc. because you only care about the "Fax" phone type.</P>
<P>This is an issue though when you consider how the types are created and what if "Fax" is removed from the database then re-entered as "Facsimile"?&nbsp; You've probably considered this, so I'll move on.</P>
<P>The bottom-line is that by locking down your property to one type, you are going to have to hard-code the value whether it is from an enumeration, resource file, string, whatever, you will have to make sure it stays in sync with the DB.&nbsp; That is the challenge.</P>
<P>And, even if you passed this off to client code and had a PhoneNumbers property, it only makes it so the client code has to deal with knowing the key instead of your class.&nbsp; Eventually someone needs to know what value to use.&nbsp; Short of having a DDL or some other dynamically generated souce for the user to select from, you'll have to hard-code it somewhere.</P>
<P>BTW - I too use a "descriptor" - we call it a "key" - that is used to identify records in lookup tables in a common language (english) to allow for globalization and not interfere with code.&nbsp; Everything has a Key and a DisplayName with the latter in the applicable language for the user.</P>
<P>Hope that helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, October 18, 2006</h2><P>Andy,</P>
<P>You slipped your last post in while I was typing...</P>
<P>Your explanation was perfect to explain the use case for your problem.&nbsp; I've run into this when developing (e)commerce apps where a customer is able to maintain several addresses but when an invoice is generated, the system must select the customer's <STRONG>current</STRONG> billing address and duplicate it into the Invoice (we duplicate and not reference so that the invoice will always reflect its state at the time it was generated and not be subject to future address changes).</P>
<P>In this case, we have to have code like:</P>
<P><CODE>Invoice.BillingAddress = Customer.Addresses["Billing"];</CODE></P>
<P>Which is exactly what you are doing.</P>
<P>Maybe an additional example will help.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 18, 2006</h2>Pirate,<br><br>Yes that is what I am working on as well.&nbsp; In this case our orders etc. have a fax and phone number (which I'm calling office..) and although it can be blank, the type is hard coded.<br><br>And like you, I will be keeping a snapshop of the data at the time the invoice was saved.&nbsp; <br><br>I suspected this was the only way, but just wanted to see if a better solution had ever bee developed.<br><br>Thanks for taking the time to repond!<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RedMark replied on Wednesday, October 18, 2006</h2><P>Not sure if this helps but...</P>
<P>"The types are loaded from the database so that we can extend them easily" and</P>
<P>"Not too crazy about hard coding the string Fax"</P>
<P>are a bit contrary in that if you extend the types in the database you'll have to break into code and write some more hard-coded strings and&nbsp;coupled with the strongly-typed properties FaxNumber and PhoneNumber make this solution non-extensible</P>
<P>It's hard to know the answer without knowing what you are doing because some instances may be as simple as a foreign key in the db. but in others like, "Pick a primary comms. line?" Fax, Phone etc. etc. May be a different solution or is it a case of picking contact types and then entering numbers against them? Reading back that seems more likely...</P>
<P>First off I'd create a child collection of numbers from your objects and just use the Type Description (loaded from the database) as the key.</P>
<P>So just use the Type Code or&nbsp;Description as the identifier in code...</P>
<P>From a combo or something bind to the types list...</P>
<P>Numbers.Add (PhoneNumber.New( cboTypes.Value));<BR></P>
<P>In the Add method check for the existance of PhoneNumber.Type in the collection.</P>
<P>&nbsp;</P>
<P>Something of that ilk. Extendable and no hard-coding.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 18, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RedMark:</strong></div><div>"The types are loaded from the database so that we can extend them easily" and
<p>"Not too crazy about hard coding the string Fax"</p>
<p>are a bit contrary in that if you extend the types in the database you'll have to break into code and write some more hard-coded strings and&nbsp;coupled with the strongly-typed properties FaxNumber and PhoneNumber make this solution non-extensible</div></BLOCKQUOTE></p><p>I can see how you might see it as contrardictory.&nbsp; There are two places the phone types are used.</p>One is when editing a contact.&nbsp; The user has a grid allowing them to add phone numbers.&nbsp;&nbsp; They pick the type and enter the number.&nbsp; All types are always available.&nbsp; If the users need a new type of phone number here, I can simply add it to the database (the user's do not maintain this table, I do).&nbsp; This has already happened, I needed to add the type Lab.&nbsp; Lab has no meaning whatsoever to the code, its just a flag.&nbsp; The FQN of the class is Contacts.PhoneNumber.<br><br>The second area is sales / invoicing.&nbsp; Here, there are two fixed fields allowing phone data; one marked Phone number and the other Fax.&nbsp; The user can only use these two fields, and cannot change the type of phone number.&nbsp; Whatever they entered into Fax is a fax number and will be flagged automatically as such.&nbsp; This PhoneNumber (Quoting.PhoneNumber) class has a type property which is NOT exposed to the UI, the parent object asks that a PhoneNumber be created with a specified type, and once created, that type cannot change.&nbsp;&nbsp; So this part of the application assumes that Office and Fax types always exist (and they will; users want these types of phone numbers, and I will not remove them).<br><p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RedMark:</strong></div><div>So just use the Type Code or&nbsp;Description as the identifier in code...</p>
<p>From a combo or something bind to the types list...</p>
<p>Numbers.Add (PhoneNumber.New( cboTypes.Value));<br></p>
<p>In the Add method check for the existance of PhoneNumber.Type in the collection.</div></BLOCKQUOTE></p><p>I think you can understand why this will not work in my second scenario.&nbsp; Since the functionality of PhoneNumber differs in the two areas, I have two seperate classes to handle these.&nbsp; The first just ensures that whatever type is entered is in PhoneTypeList.&nbsp; The second requires that two types always exist.</p>It may be that hardcoding is acceptable in this case (and from the other poster, it sounds like it might be ok).&nbsp; If I can avoid it, that'd be great and would love to hear other suggestions for doing so that still allow me to properly tag the type of phone number in the database (so that I can put them in the right property when loading the invoice).<br><br>Thanks<br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
