<html><header><title>CSLA 4.5.1 and Windows Azure support</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4.5.1 and Windows Azure support</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11560.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF posted on Monday, September 03, 2012</h2><p>I&#39;m trying to deploy a web role to Windows Azure it is says I can&#39;t target the .NET Framework 4.5.&nbsp; Apparently, only 3.5 &amp; 4.0 are supported.&nbsp; If that is true, that leaves me in a bind because my web role is serving as my data portal using the CSLA 4.5.1 release, which I think requires .NET 4.5.&nbsp; I tried to change the Web role (and dependencies like my .NET library, DataAccess and DataAccess.Sql projects) to .NET 4.0 but then my Csla is broken.</p>
<p>Any thoughts on how to get around this?&nbsp; I am trying to get a WinRT application working using CSLA and was expecting to use Windows Azure to host the service and SQL database.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, September 03, 2012</h2><p>Get the latest source from trunk. I added a CSLA project that targets .NET 4.0 just before VSLive to enable this scenario. </p>
<p>This will enable you to create a Azure server in .Net 4.0. <br />I believe Rocky had a demo that demonstrated just this at VSLive. &nbsp;&nbsp;</p>
<p>You should also update to get the latest support for async/await keywords.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>Thanks, Jonny.&nbsp; Could you point me in the right direction?&nbsp; I have not downloaded anything from the source code before, and I&#39;m not sure what project to use in the Trunk.&nbsp; I see lots of things under Trunk, including CslaContrib, CslaContribu.Caliburn.Micro.Silverlight, etc.&nbsp;&nbsp;What should I choose?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>Also...you&#39;re referring to the CslaContrib code on codeplex, right?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, September 03, 2012</h2><p>No, </p>
<p>This is the <i><b>CSLA .NET (Current dev)</b></i>. See instructions in: <br /><a title="http://lhotka.net/cslanet/Repository.aspx" href="http://lhotka.net/cslanet/Repository.aspx">http://lhotka.net/cslanet/Repository.aspx</a></p>
<p>You need a SVN client to download the source code and then build on your computer. </p>
<p>The source code repository is readonly, publicly available for anonymous users.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>Using TortoiseSVN, I get a message saying &quot;Access to http://lhotka.net/cslacvs/viewvc.cgi/core/trunk&quot; forbidden.&nbsp; I get this when trying to export to my local directory.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, September 03, 2012</h2><p>You must use the Subversion URI - NOT the Web View URI - &nbsp;as specified on the Repository page.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>How do I find the Subversion URI?&nbsp; When I right-click on the directory to which I want to download the source, what URI do I specify?</p>
<p>Thanks (and sorry for the trouble).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, September 03, 2012</h2><p>Look at this page: <a href="http://lhotka.net/cslanet/Repository.aspx">http://lhotka.net/cslanet/Repository.aspx </a></p>
<p>The Subversion URI for project <i><b>CSLA .NET (current dev)</b></i> is <i><b>svn://svn.lhotka.net/csla/core/trunk</b></i></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>Duh...not sure how I missed that.&nbsp;&nbsp;I&#39;ll give it a try.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, September 03, 2012</h2><p>Should I be using the Csla.Net4 project in the Source directory?&nbsp; If so, when I build I get the following exception:&nbsp; &quot;System.Threading.Tasks.Task does not contain a definition for &#39;Run&#39;.&quot;</p>
<p>Note: the exception occurs in DataPortalT.cs, line 491.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, September 04, 2012</h2><p>Yes, you should use the Csla.Net4 project.</p>
<p>Read this thread: <a href="http://forums.lhotka.net/forums/t/11559.aspx">http://forums.lhotka.net/forums/t/11559.aspx</a> </p>
<p>Remember, this is a live repository - and there is still work in progress.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Tuesday, September 04, 2012</h2><p>I&#39;m making headway, but now I&#39;m running into this:</p>
<p>Could not load file or assembly &#39;Microsoft.CompilerServices.AsyncTargetingPack.Net4, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&#39; or one of its dependencies. The system cannot find the file specified.</p>
<p>However, I have already added (via NuGet) the Async Targeting Pack to the assemblies that I&#39;m compiling against 4.0.</p>
<p>Just to summarize, here is the setup of my project...hopefully this is as it should be:</p>
<ul>
<li>WinRT project:&nbsp; .NET 4.5</li>
<li>BusinessLibrary.WinRT:&nbsp; .NET 4.5</li>
<li>BusinessLibrary (.NET version):&nbsp; .NET 4.0 Client Profile</li>
<li>DataAccess:&nbsp; .NET 4.0 Client Profile</li>
<li>DataAccess.Dal:&nbsp; .NET 4.0 Client Profile</li>
<li>Web project:&nbsp; .NET 4.0</li>
</ul></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Tuesday, September 04, 2012</h2><p>I don&#39;t know what I did, but it&#39;s not happening anymore.&nbsp; But I&#39;m still getting weird behavior, though, which I&#39;ll have to research.</p>
<p>In the meantime, I would like to verify one thing based on the link that Jonny gave to the thread with Tiago.&nbsp; Tiago used the symbol <strong>NET45</strong>.&nbsp; Is that a custom symbol, or is that built in to VS?&nbsp; Thanks.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff">
<p style="padding-left:30px;">#if&nbsp;NET45<br />&nbsp;&nbsp; </p>
</font></font></font></span><font face="Consolas" size="2" color="#0000ff"><font face="Consolas" size="2" color="#0000ff">
<p style="padding-left:30px;">&nbsp;</p>
</font></font></span><font face="Consolas" size="2" color="#0000ff">
<p style="padding-left:30px;">&nbsp;</p>
</font></span></p>
<p style="padding-left:30px;"><span style="font-size:x-small;font-family:Consolas;color:#808080;"><span style="font-size:x-small;font-family:Consolas;color:#808080;"><span style="font-size:x-small;font-family:Consolas;color:#808080;">return Task.Run(() =&gt; dp.DoFetchAsync(objectType, criteria, true)).Result;<br /></span></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">#else<br />&nbsp;&nbsp; </span></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">return</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">TaskEx</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">.Run(() =&gt; dp.DoFetchAsync(objectType, criteria, </span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">true</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">)).Result; <br /></span></span><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">#endif</span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, September 04, 2012</h2><p>It is a compiler directive and variable that is defined in the &quot;Project Properties&quot;. </p>
<p>I have updated trunk so the code will compile now - so update your copy of the code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Wednesday, September 05, 2012</h2><p>I now get the following error with one of my objects.&nbsp; I don&#39;t think I&#39;m referencing Silverlight in any of my projects, so I&#39;m not sure where to look.&nbsp; This happens somewhere after calling portal.BeginFetch(criteria) and is returned to my VM in the Csla.Xaml.ViewModelBase error event:</p>
<p>Could not load type &#39;Csla.Silverlight.PrimitiveCriteria&#39; from assembly &#39;Csla, Version=4.5.1.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&#39;.</p>
<p>Stack trace:</p>
<p>&nbsp;&nbsp; at System.RuntimeTypeHandle.GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMarkHandle stackMark, IntPtr pPrivHostBinder, Boolean loadTypeFromPartialName, ObjectHandleOnStack type)<br />&nbsp;&nbsp; at System.RuntimeTypeHandle.GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean loadTypeFromPartialName)<br />&nbsp;&nbsp; at System.RuntimeType.GetType(String typeName, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark&amp; stackMark)<br />&nbsp;&nbsp; at System.Type.GetType(String typeName, Boolean throwOnError, Boolean ignoreCase)<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.GetType(String typeName, Boolean throwOnError, Boolean ignoreCase) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Reflection\MethodCaller.cs:line 191<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.GetType(String typeName) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Reflection\MethodCaller.cs:line 211<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.GetTypeFromCache(String typeName) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Serialization\Mobile\MobileFormatter.cs:line 188<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.DeserializeAsDTO(List`1 deserialized) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Serialization\Mobile\MobileFormatter.cs:line 233<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(Stream serializationStream) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Serialization\Mobile\MobileFormatter.cs:line 217<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(Byte[] data) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Serialization\Mobile\MobileFormatter.cs:line 375<br />&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.WcfPortal.GetCriteria(Byte[] criteriaData) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Server\Hosts\Silverlight\WcfPortal.cs:line 222<br />&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.WcfPortal.Fetch(CriteriaRequest request) in c:\Users\Tim\Documents\Visual Studio 2012\Projects\CslaTrunk\Source\Csla\Server\Hosts\Silverlight\WcfPortal.cs:line 91</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Thursday, September 06, 2012</h2><p>I think I got past this for now (although I&#39;m not sure why the problem exists).&nbsp; Since the message referred to the PrimitiveCriteria, I tried changing my criteria as an Int to a class containing an int property and passing that to the DP_Fetch method.&nbsp; That resolved the issue. Is this to be expected in the future, i.e. will we be restricted from passing primitive types to the DP methods?&nbsp; Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 07, 2012</h2><p>You should expect existing code to work, including PrimitiveCriteria. I&#39;m not sure why that&#39;s failing.</p>
<p>The Silverlight references in the stack trace occur because WinRT uses the &quot;Silverlight&quot; data portal. I&#39;m considering renaming that to the &quot;Mobile&quot; data portal to avoid this confusion, though that introduces another breaking change from 4.3...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>phredaustin replied on Tuesday, September 04, 2012</h2><p>BTW, if you want to use .Net 4.5 on Azure, please go over to the Azure UserVoice site and vote for the support so that the Microsoft PMs are aware of how much the community wants 4.5.&nbsp; Here&#39;s the link: <a href="http://www.mygreatwindowsazureidea.com/forums/34192-windows-azure-feature-voting/suggestions/2598170-iis8-and-asp-net-4-5-support-in-azure-platform">http://www.mygreatwindowsazureidea.com/forums/34192-windows-azure-feature-voting/suggestions/2598170-iis8-and-asp-net-4-5-support-in-azure-platform</a></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
