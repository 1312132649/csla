<html><header><title>Bug in Roles object?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Bug in Roles object?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/630.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cuong posted on Friday, July 14, 2006</h2>Bug reproduce:<br>+ Run PTWin and login with admin role<br>+ Choose Admin | Edit Roles<br>+ Insert 2 roles with the same id value. E.g: <br>Role1 = (7, "test1")<br>Role2 = (7, "test2")<br>There will be an error icon in the id cell of role2 (because of NoDuplicates rule)<br>+ Now delete the role1 row =&gt; the role2 becomes totally valid but the error icon still exists in its id cell<br>+ Continueing to click on Save button will throw a data exception although all data is valid.<br><br>I think the error is Roles does not call its childrent's CheckRules method when it Removes child objects. Unfortunatelly the BusinessBase does not have CheckRules method and its ValidationRules property is protected. <br><br>Does anyone have an idea to resolve this problem? My current project must create some business objects like Roles but I have not found any good solution.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 17, 2006</h2><P>That's an interesting scenario - yes, I can see where the problem comes in here. I'll have to give some thought to a good solution. I don't like the idea of making CheckRules() public, for instance, as that seems like serious overkill.</P>
<P>The real issue is that child objects, in general, may need to know when the collection's contents have changed. Or more broadly, when the parent object has changed. It is up to the child what it might, or might not, do in response to a change in its parent.</P>
<P>So what's really needed, is a mechanism by which a child can know that the parent changed. One solution would be for Core.IEditableCollection to define a method that is invoked by the parent on each child. A default (empty) implementation would be in Core.BusinessBase, but you could override that and call CheckRules() if it was important for your particular object.</P>
<P>Another option that would work today, is that the child automatically has a Parent property, referring to the collection. You could just hook the existing ListChanged event and thus be notified of any changes to the parent collection. In that event handler you could call CheckRules(). That would require casting Parent to IBindingList, and so it isn't as elegant, but it would certainly work.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cuong replied on Wednesday, July 19, 2006</h2>Thank Rockford, I will follow your suggestion to hook the parent collection's ListChanged event.&nbsp; I still a little bit wonder where and when to hook this event. I will do something like bellow&nbsp; but I am not sure if it is the best solution.<br><br>public class MyChild : BusinessBase&lt;MyChild&gt;<br>{<br>&nbsp;&nbsp;&nbsp; internal static MyChild NewChild(MyParentCollection parent)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  MyChild child = DataPortal.Create&lt;MyChild&gt;();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  parent.ListChanged += delegate { child.ValidationRules.CheckRules(); };<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  return child;<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>I hope you will have some small improving in Csla in the future version. to resolve this issue easier<strong><b><br><br></b><br></strong></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
