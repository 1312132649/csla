<html><header><title>Doing a Web Service the Right Way</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Doing a Web Service the Right Way</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2463.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ltgrady posted on Friday, March 02, 2007</h2><P>I tried this over at asp.net forums and didn't get a response.</P>
<P>We had a quick and dirty web service we had to create on the fly for a client.&nbsp; Lots of dynamic sql typed right into our .cs file, loading and returning XmlDataDocuments. It worked, but it was nothing we were happy with.</P>
<DIV class=ForumPostContentText id=ctl00_ctl01_bcr_ctl00___PostRepeater_ctl01_PostViewWrapper>
<P>Since then we've gotten our system working properly.&nbsp; All our asp.net pages are running using&nbsp;CSLA objects.&nbsp; So now we're re-writing our web service and we want to do it right.&nbsp;We're pretty new to web services and our clients will be using asp.net, php, and java stuff.&nbsp; So we want as much interoperability as possible.</P>
<P>So for simple scalar type methods we're just returning the value.&nbsp; Like a int or a String.&nbsp; For Search Results, lists of Brands, and other more complex items we've created a custom class in our web service, then we call our business object and transfer the data from our biz object to our data transfer object ad return that object.&nbsp; We're passing our security credentials to the service inside the SOAP header.</P>
<P>We are also trying to pass our parameters in using objects.&nbsp; For instance our SearchResults had about 10 criteria fields.&nbsp; An ArrayList of brands, an ArrayList of Categories, FromPrice, ToPrice, etc..&nbsp; These were being passed in each with its own parameters, however, now we have an object with these properties that we&nbsp;pass in.&nbsp; We made this change after reading Rocky's web service chapter again.&nbsp; This way if we change anything in the future we don't have to have GetSearchResults2, GetSearchResultsEx, or other things like that.&nbsp; </P>
<P>So right now our objects are just simple, basic classes that we pass back to the consumer.&nbsp; I'll include an example below.&nbsp; I know I'm missing something here.&nbsp; When my consumers begin working with my web service what defines the classes for them?&nbsp; How do they&nbsp;take what I give them and easily use it as a object, and also know how to form the object they need to pass back to me?&nbsp;What am I missing?&nbsp;&nbsp;In order for this to be as generic and usable by as many platforms as possible, I know there is something else I need to do.&nbsp; Is it XSD?&nbsp; If so, does someone have a quick example of what the output below may look like?&nbsp; Also, is this something I should code by hand or is there a tool or process to simplify this?</P>
<P>EDIT NOTE:&nbsp; After reading through XSD tutuorial it seems pretty clear I should do this for my docs.&nbsp; I'm still not sure though how my cosumers see these definitions before they use service though?</P>
<P>We're working on our input objects now but this would be&nbsp;what's being returned from&nbsp;one of our main Web Service Methods:</P>
<P>&nbsp;<FONT color=#0000ff><SPAN class=m>&lt;?</SPAN><SPAN class=pi>xml version="1.0" encoding="utf-8" </SPAN><SPAN class=m>?&gt;</SPAN></FONT> </P>
<DIV class=e>
<DIV class=c><A class=b href="http://localhost:8010/ReplinkProductSearchService.asmx/WM_GetSR#"><STRONG><FONT face="Courier New" color=#ff0000>-</FONT></STRONG></A> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>ArrayOfAnyType</FONT></SPAN><SPAN class=ns><FONT color=#ff0000> xmlns:xsi</FONT></SPAN><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B class=ns><FONT color=#ff0000>http://www.w3.org/2001/XMLSchema-instance</FONT></B><SPAN class=m><FONT color=#0000ff>"</FONT></SPAN><SPAN class=ns><FONT color=#ff0000> xmlns:xsd</FONT></SPAN><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B class=ns><FONT color=#ff0000>http://www.w3.org/2001/XMLSchema</FONT></B><SPAN class=m><FONT color=#0000ff>"</FONT></SPAN><SPAN class=ns><FONT color=#ff0000> xmlns</FONT></SPAN><SPAN class=m><FONT color=#0000ff>=</FONT></SPAN><B class=ns><FONT color=#ff0000><A href="http://webservices.ourcompany.net/">http://webservices.ourcompany.net</A></FONT></B><FONT color=#0000ff><SPAN class=m></SPAN><SPAN class=m>&gt;</SPAN></FONT></DIV>
<DIV>
<DIV class=e>
<DIV class=c><A class=b href="http://localhost:8010/ReplinkProductSearchService.asmx/WM_GetSR#"><STRONG><FONT face="Courier New" color=#ff0000>-</FONT></STRONG></A> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><FONT color=#990000><SPAN class=t>anyType</SPAN><SPAN class=t> xsi:type</SPAN></FONT><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B>SResult</B><FONT color=#0000ff><SPAN class=m>"</SPAN><SPAN class=m>&gt;</SPAN></FONT></DIV>
<DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Product_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>041be....6eb</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Product_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_Name</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>Brand X</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_Name</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>adaee....ab4</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Model</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>PHL-200</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Model</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_ShortName</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>Widget 200</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_ShortName</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_SalesCopy</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>The new and improved Widget.</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_SalesCopy</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_C_QuotedPrice</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>25.9900</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_C_QuotedPrice</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_MSRP</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>42.9900</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_MSRP</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Status</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>1</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Status</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>anyType</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN></DIV></DIV></DIV>
<DIV class=e>
<DIV class=c><A class=b href="http://localhost:8010/ReplinkProductSearchService.asmx/WM_GetSR#"><STRONG><FONT face="Courier New" color=#ff0000>-</FONT></STRONG></A> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><FONT color=#990000><SPAN class=t>anyType</SPAN><SPAN class=t> xsi:type</SPAN></FONT><SPAN class=m><FONT color=#0000ff>="</FONT></SPAN><B>SResult</B><FONT color=#0000ff><SPAN class=m>"</SPAN><SPAN class=m>&gt;</SPAN></FONT></DIV>
<DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Product_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>a46a5...a40</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Product_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_Name</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>Brand X</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_Name</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>adaee....ab4</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Brand_ID</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Model</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>PHL-300</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Model</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_ShortName</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>Widget 300</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_ShortName</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_SalesCopy</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>The even newer and more improved Widget.</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_SalesCopy</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_C_QuotedPrice</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>64.9900</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_C_QuotedPrice</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_MSRP</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>75.9900</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_MSRP</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV class=e>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Status</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN><SPAN class=tx><STRONG>1</STRONG></SPAN><SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>_Prd_Status</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN> </DIV></DIV>
<DIV><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>anyType</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN></DIV></DIV></DIV>
<DIV class=e>
<DIV class=c><SPAN class=b><STRONG><FONT face="Courier New" color=#ff0000>&nbsp;</FONT></STRONG></SPAN> <SPAN class=m><FONT color=#0000ff>&lt;/</FONT></SPAN><SPAN class=t><FONT color=#990000>ArrayOfAnyType</FONT></SPAN><SPAN class=m><FONT color=#0000ff>&gt;</FONT></SPAN></DIV></DIV></DIV></DIV></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, March 02, 2007</h2><P>The point of web services is that you <EM>don't know what your clients are doing</EM>. You don't know if they put this result into an object, or if they parse the XML directly or something else. And, frankly, you shouldn't care.</P>
<P>What you <EM>should</EM> care about, is whether you are expessing your message structure through your WSDL, because that's what gives the consumer the flexibility to do what they want.</P>
<P>Let's face it. <EM>Most</EM> web service consumer technologies do represent results as some sort of object or object-like-thing. And they get the shape of that object from the WSDL description - actually the XSD in the WSDL.</P>
<P>In many cases, especially if you are accepting/returning simple DTO types like I show in the book, Visual Studio will create perfectly acceptable WSDL on your behalf. </P>
<P>If it does <EM>not</EM>, then you are in for more work. The general solution is to create the XSD yourself, then merge it into the WSDL <EM>and</EM> use it to create your DTO objects. There's a command line tool provided by Microsoft that creates DTOs based on XSD/WSDL.</P>
<P>Christian Weyer has done a lot of work in this area, and I think he has some tools to help with this XSD approach. It is often called contract-first design.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
