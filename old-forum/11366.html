<html><header><title>CSLA, Silverlight , PrivateFields and deserialization problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA, Silverlight , PrivateFields and deserialization problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11366.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mtrtm posted on Friday, May 18, 2012</h2><p>
 
  Normal
  0
  
  
  
  
  false
  false
  false
  
  EN-US
  X-NONE
  X-NONE
  
   
   
   
   
   
   
   
   
   
   
   
  
  MicrosoftInternetExplorer4
  
   
   
   
   
   
   
   
   
   
   
   
  

 
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
 



</p>
<p>I have a Silverlight 5 project with a WCF remote data portal (CSLA 4.3 code generated by CodeSmith) and have a property in my business object that looks like this:<br /><br />&nbsp;<br /><br />private static readonly PropertyInfo&lt;System.String&gt; _myStringProperty = RegisterProperty&lt;System.String&gt;(p =&gt; p.MyString, &quot;MyString&quot;, (System.String)null, RelationshipTypes.PrivateField);<br /><br />private System.String _myString = _myStringProperty.DefaultValue;<br /><br />public System.String MyString<br /><br />{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(_myStringProperty, _myString); }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(_myStringProperty, ref _myString, value); }<br /><br />}<br /><br />&nbsp;<br /><br />In Silverlight, when I get the object back from the data portal fetch, all the properties (public and private) are empty/null. <br /><br />While I am new to Silverlight and CSLA, I have a theory that this may be due to Silverlight&rsquo;s security restriction on reflection of private members.&nbsp; I am assuming that CSLA uses reflection to set class properties, and when registering a private field with the RegisterProperty() call CSLA now knows about this field (instead of not knowing about a private auto-generated backing field).&nbsp;&nbsp; I am guessing that since code compiled with Silverlight cannot access private members but CSLA knows about the property it tries to set it and can&rsquo;t.<br /><br />&nbsp;<br /><br />When I change the code to have public a public property (see below) the public property&rsquo;s value in Silverlight is populated after a data portal fetch:<br /><br />private static readonly PropertyInfo&lt;System.String&gt; _myStringProperty = RegisterProperty&lt;System.String&gt;(p =&gt; p.MyString, &quot;MyString&quot;);<br /><br />private System.String _myString = _myStringProperty.DefaultValue;<br /><br />public System.String MyString<br /><br />{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(_myStringProperty); }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(_myStringProperty, value); }<br /><br />}<br /><br />&nbsp;<br /><br />Does anyone know:</p>
<ol>
<li>&nbsp;&nbsp;&nbsp; Why CodeSmith CSLA templates are using the private field (from a quick google search it sounds like it has something to do with enforcing business rules)</li>
<li>&nbsp;&nbsp;&nbsp; Is my theory is correct, what is actually happening and why?</li>
<li>&nbsp;&nbsp;&nbsp; How should properties be defined in business objects with Silverlight?</li>
</ol></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, May 18, 2012</h2><p>You may want to read the <em>Using CSLA 4</em> books - at least the data portal book that covers serialization in some detail.</p>
<p>CSLA uses its own serializer for Silverlight, called the MobileFormatter. To avoid the use of reflection (because reflection is too restricted on Silverlight to be useful for serialization) you should generally use managed backing fields (not private fields) for your properties. This allows MobileFormatter to automatically serialize the values. If you do want to use private fields, you must override OnGetState and OnSetState and manually get/set the private field values into the serialization context so they are serialized.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
