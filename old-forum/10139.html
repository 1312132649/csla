<html><header><title>Questions relate with the Authorization Rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Questions relate with the Authorization Rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10139.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Lazaro posted on Tuesday, March 08, 2011</h2><p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;"><span style="font-size:small;">I have two questions relate with the authorization and the CanWriteProperty implementation: </span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;"><span style="font-size:small;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;">Q1:</span></span></b><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"> Why do you enforce having only one Authorization Rule object per element (property, method, object)? You allow multiple rules objects for Business Rules and Validation Rules, but not for Authorization Rules. </span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">I ask this because I could make use of it allowing multiple Authorization Rules, where the rules are evaluated like an OR (if one is true user has right), and having one rule with multiple roles, where the roles are evaluated like an AND (all must evaluate to true for the rule to be true). This behavior will allow me greater flexibility and I would have to create customs rules only for more complex and less common cases.</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">Here are 2 scenarios that we were considering (scenario 1 being the most flexible):</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">Scenario 1:</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:-0.25in;" class="MsoListParagraph"><span style="color:black;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;"><span style="font-size:small;">&middot;</span></span><span style="font-size:7pt;color:black;mso-fareast-font-family:Symbol;"><span style="font-family:Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-bidi-font-family:Tahoma;"><span style="font-size:small;">Allow multiple authorization rules per element, which are evaluated as an OR.</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:-0.25in;" class="MsoListParagraph"><span style="color:black;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;"><span style="font-size:small;">&middot;</span></span><span style="font-size:7pt;color:black;mso-fareast-font-family:Symbol;"><span style="font-family:Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-bidi-font-family:Tahoma;"><span style="font-size:small;">Have the multiple roles per rule be evaluated as an AND.</span></span></p>
<p style="margin:0in 0in 0pt 0.25in;" class="MsoNormal"><span style="text-decoration:underline;"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">Sample: </span></span></span></p>
<p style="margin:0in 0in 0pt 0.25in;text-indent:0.25in;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;"><span style="font-size:small;">Rule Object 1(&hellip;, Property: <b style="mso-bidi-font-weight:normal;">IsReviewed</b>, Roles: AssetManager, Reviewer) </span></span></p>
<p style="margin:0in 0in 0pt 0.25in;text-indent:0.25in;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;"><span style="font-size:small;">Rule Object 2(&hellip;, Property: <b style="mso-bidi-font-weight:normal;">IsReviewed</b>, Roles: Administrator)</span></span></p>
<p style="margin:0in 0in 0pt 0.25in;text-indent:0.25in;" class="MsoNormal"><span style="color:black;"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">Scenario 2:</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:-0.25in;" class="MsoListParagraph"><span style="color:black;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;"><span style="font-size:small;">&middot;</span></span><span style="font-size:7pt;color:black;mso-fareast-font-family:Symbol;"><span style="font-family:Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-bidi-font-family:Tahoma;"><span style="font-size:small;">Have 2 classes inherit from AuthorizationRule (1) AuthorizationRuleAND and (2) AuthorizationRuleOR, where each evaluate the multiple roles as an AND or OR depending on the class type used. </span></span></p>
<p style="margin:0in 0in 0pt 0.25in;" class="MsoNormal"><span style="text-decoration:underline;"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"><span style="font-size:small;">Sample: </span></span></span></p>
<p style="margin:0in 0in 0pt 0.25in;text-indent:0.25in;" class="MsoNormal"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;"><span style="font-size:small;">RuleAND Object 1(&hellip;, Property: <b style="mso-bidi-font-weight:normal;">IsReviewed</b>, Roles: AssetManager, Reviewer)</span></span></p>
<p style="margin:0in 0in 0pt 0.25in;text-indent:0.25in;" class="MsoNormal"><span style="font-size:small;"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;mso-fareast-font-family:&#39;Times New Roman&#39;;mso-bidi-font-family:Calibri;">RuleOR Object 2(&hellip;, Property: <b style="mso-bidi-font-weight:normal;">Comment</b>, Roles: AssetManager, Administrator)</span><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"></span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="color:black;"><span style="font-size:small;font-family:Times New Roman;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;">Q2:</span></span></b><span style="color:black;font-family:&#39;Calibri&#39;,&#39;sans-serif&#39;;"> There are some scenarios where we would like to throw a more specific/descriptive exception when an authorization rule is broken instead of the generic <span style="background:#ffff99;">___</span> exception being thrown when the authorization check does not pass. How would you recommend doing that?</span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, March 08, 2011</h2><p>Q1:</p>
<p>One reason for the one rule limit is for performance. When an object is bound to a UI (especially in Windows Forms), the properties can be read very frequently. BusinessBase (by default) caches the result of the rule to minimize how often each rule is run. Although I suppose I could have aggregated and cached the result generated by combining all rules, the whole process of invoking a list of rules and caching the combined result would have overhead.</p>
<p>Another reason is that I would have to arbitrarily choose to AND or OR the results. I&#39;d choose wrong for some subset of users - very possibly you :)</p>
<p>Finally, I don&#39;t really need to support more than one rule. You can do that. You can easily create an aggregate rule that is provided with a list of other rules that you execute, and then you combine their results. Because the ultimate result of an authorization check is true or false - a singular value - this aggregate rule technique is easy to implement.</p>
<p>(Unlike business rules, where there are business rules and validation rules, and they have no discrete or singular result, so there&#39;s no easy way to aggregate them together. Though having said that, I do want to make it clear that you could implement an aggregate business rule scheme too - it is just a bit more complex - but I discuss having rules run other rules in the <em>Creating Business Objects</em> ebook).</p>
<p>Q2:</p>
<p>There is no way to do this, because authorization rules don&#39;t throw any exceptions. They return true or false. In some cases CSLA will throw an exception due to a false result, but the rules themselves are Boolean. In the most common scenario (property read) no exception is thrown at all (by default).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
