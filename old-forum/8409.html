<html><header><title>Serializing CommandBase derived object fails in WCF, but works with Web Service portal?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Serializing CommandBase derived object fails in WCF, but works with Web Service portal?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8409.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 posted on Tuesday, January 26, 2010</h2>In doing some pre-release testing, we've run into a class that functions properly when run with either the local or Web Service portal, but fails when run with the WCF portal. <br /><br />The error being returned to the client is "The underlying connection was closed: The connection was closed unexpectedly". <br /><br />I've debugged as far as I can in Visual Studio -- I've traced through the actual execution of the command. <br /><br />An internal error is thrown in System.Data.DataTable.WriteXmlSchema (but is not returned as an inner exception)<br /><br />System.InvalidOperationException occurred<br />  Message="Cannot serialize the DataTable. DataTable name is not set."<br />  Source="System.Data"<br />  StackTrace:<br />       at System.Data.DataTable.WriteXmlSchema(XmlWriter writer, Boolean writeHierarchy)<br />  InnerException: <br /><br />I can possibly see how to correct this from this description, but why would serialization fail here but work with the exact same object with the Web Service?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 26, 2010</h2><P>The older data portal channels (everything except WCF) uses the BinaryFormatter to serialize the object graph into a byte stream.</P>
<P>The WCF channel lets WCF do the work, and so the NetDataContractSerializer is used.</P>
<P>The NDCS is 99.99% backward compatible with the BinaryFormatter. I don't have a list of the (very few) incompatibilities, but I'm told there are a couple obscure differences.</P>
<P>Perhaps you are hitting one of those obscure differences somehow?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, January 26, 2010</h2>OK, as long as these are "rare". I fixed this particular problem by taking a cue from the internally captured exception and providing a name for the DataTable. <br /><br />Incidentally, I've found the WCF portal to be much more finicky about differences between object definitions (not that this is necessarily a bad thing). For example, I have some fields that are only defined in the debug build of a class and not the release build. The web service portal is quite happy to allow me to connect a debug version of the object with the release build of the data portal, but the WCF portal complains about field mismatch.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 26, 2010</h2>This is all Msft code we're talking about here, so if the problems are too great you'll need to create a lower level repro and file the issue on connect as a .net bug.<br /><br /> <br /><br />-----Original Message-----<br />From: rsbaker0 <br />Sent: January 26, 2010 7:21 PM<br />To: rocky@lhotka.net <br />Subject: Re: [CSLA .NET] Serializing CommandBase derived object fails in WCF, but works with Web Service portal?<br /><br />OK, as long as these are "rare". I fixed this particular problem by taking a cue from the internally captured exception and providing a name for the DataTable. <br /><br />Incidentally, I've found the WCF portal to be much more finicky about differences between object definitions (not that this is necessarily a bad thing). For example, I have some fields that are only defined in the debug build of a class and not the release build. The web service portal is quite happy to allow me to connect a debug version of the object with the release build of the data portal, but the WCF portal complains about field mismatche.<br /><br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
