<html><header><title>OT: Can't navigate away from bound masked textbox</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT: Can't navigate away from bound masked textbox</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2555.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan posted on Monday, March 19, 2007</h2><P>This is driving me nuts, but I can't navigate away from a bound masked textbox to any of the other controls on a form.&nbsp; I have the masked textbox bound to a BindingSource which, in turn, is bound to one of my business objects.&nbsp; The problem seems to occur after the user clicks on the cmdNewCategory button to create a new category record.&nbsp; I'm not sure the problem is caused by the cmdNewCategory_Click function or not, but the code for it is as follows:</P>
<P>&nbsp;&nbsp;private void cmdNewCategory_Click(object sender, EventArgs e)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;catPosition = bindingSourceCategories.Position;</P>
<P>&nbsp;&nbsp;&nbsp;categories.AddNew();</P>
<P>&nbsp;&nbsp;&nbsp;bindingSourceCategories.DataSource = categories;<BR>&nbsp;&nbsp;&nbsp;bindingSourceCategories.MoveLast();<BR>&nbsp;&nbsp;&nbsp;navigatorCategories.BindingSource = bindingSourceCategories;</P>
<P>&nbsp;&nbsp;&nbsp;categoryCodeMaskedTextBox.Mask = "\\" + deptCode + "&gt;A";<BR>&nbsp;&nbsp;&nbsp;categoryCodeMaskedTextBox.ReadOnly = false;<BR>&nbsp;&nbsp;&nbsp;categoryCodeMaskedTextBox.Focus();</P>
<P>&nbsp;&nbsp;&nbsp;categoryDescTextBox.ReadOnly = false;</P>
<P>&nbsp;&nbsp;&nbsp;cmdSaveCategory.Enabled = true;<BR>&nbsp;&nbsp;&nbsp;cmdCancelCategory.Enabled = true;<BR>&nbsp;&nbsp;&nbsp;cmdNewCategory.Enabled = false;<BR>&nbsp;&nbsp;&nbsp;cmdDeleteCategory.Enabled = false;<BR>&nbsp;&nbsp;}</P>
<P>Any help would be greatly appreciated.</P>
<P>Allen Anderson<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Monday, March 19, 2007</h2><DIV>I encountered the similar issue in the past where I bind a DateTimePicker control's Value property. See if this helps.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV>
<DIV>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Tuesday, March 20, 2007</h2><P>William, I tried to find a reference to your DateTimePicker issue but couldn't locate it.&nbsp; One thing I've just noticed is that a System.Security.SecurityException is being thrown as soon as I try to navigate away from the maskedtextbox.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>William:</strong></div><div></P>
<DIV>I encountered the similar issue in the past where I bind a DateTimePicker control's Value property. See if this helps.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV>
<DIV>&nbsp;</DIV></div></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Tuesday, March 20, 2007</h2><P>I've found the problem; AllowWrite(string propertyName, params string[] roles) throws the error because the code generator I'm using to generate my Category class produces the following line in the AddAuthorizationRoles:</P>
<P>&nbsp;&nbsp;&nbsp;AuthorizationRules.AllowWrite("CategoryCode", "CategoryWriteGroup");</P>
<P>and there's nothing in the CategoryWriteGroup array.&nbsp; Where (or how) do I insert the allowed roles into the CategoryWriteGroup array?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Tuesday, March 20, 2007</h2><P>Albruan,</P>
<P>I think you are misinterpreting the AllowWrite syntax.&nbsp; The second parameter to the AllowWrite method is an array of role names that are allowed to write to the property specified in propertyName (the first parameter).&nbsp; In this case, "CategoryWriteGroup" is the name of a role that would contain the users who were allowed to write to this property.&nbsp; Depending on the type of security that you are&nbsp;using you'll need to appropriately create a "CategoryWriteGroup" role (you can name it whatever you want, as long as you stay in sync with your generator).&nbsp; Once you have the role created, you'll need to add the appropriate users to this role.</P>
<P>Dustin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>albruan replied on Tuesday, March 20, 2007</h2><P>I understand that, that's why I asked "Where (or how) do I insert the allowed roles into the CategoryWriteGroup array?"&nbsp; Do I create it in my override of the Security.Identity class or should the array be created elsewhere?&nbsp; I'm assuming I will also have to create similar arrays for the rest of my business objects that&nbsp;write similar properties to my data store.&nbsp; Am I correct in assuming this?</P>
<P>Allen B. Anderson</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>dshafer:</strong></div><div></P>
<P>Albruan,</P>
<P>I think you are misinterpreting the AllowWrite syntax.&nbsp; The second parameter to the AllowWrite method is an array of role names that are allowed to write to the property specified in propertyName (the first parameter).&nbsp; In this case, "CategoryWriteGroup" is the name of a role that would contain the users who were allowed to write to this property.&nbsp; Depending on the type of security that you are&nbsp;using you'll need to appropriately create a "CategoryWriteGroup" role (you can name it whatever you want, as long as you stay in sync with your generator).&nbsp; Once you have the role created, you'll need to add the appropriate users to this role.</P>
<P>Dustin</P></div></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Thursday, March 22, 2007</h2><P>Allen,</P>
<P>Sorry it took me so long to reply.&nbsp; I've been out of the office the last couple of days.&nbsp; I'm no expert on security in CSLA, but here are a few things that should help you get started.&nbsp; First off, do you plan on using Windows integrated authentication, or custom CSLA authentication?&nbsp; If you are in an environment where it makes sense to use Windows integrated security, you can take advantage of the WindowsIdentity and WindowsPrincipal classes in System.Security.Principal.&nbsp; This will allow you to use the users/roles already setup on the computer/domain.&nbsp; If you plan on going the custom CSLA authentication route, take a look at the ProjectTracker sample application that Rocky has provided with the framework.&nbsp; In the sample app he basically implements the IIdentity and IPrincipal interfaces in his own PTPrincipal and PTIdentity classes.&nbsp; Furthermore, he sets up a security database with a roles table and a users table.&nbsp; If you go this route, you'd enter say user1, user2, user3 as entries in your "user" table.&nbsp; Then you'd make entries in your "roles" table that link your users to certain roles.&nbsp; This would allow you to create a role named "CategoryWriteGroup" and add user1, user2, and user3 to that role.&nbsp; Then you could use the AllowWrite command as follows: </P>
<P>AllowWrite("category","CategoryWriteGroup")</P>
<P>Once you have authenticated the user using the Pricipal and Identity&nbsp;classes, be it the&nbsp;windows classes or your custom classes, the framework should be able to use this information in the AllowWrite implementation to determine if the user is in the allowed role.</P>
<P>Dustin</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
