<html><header><title>Concerns over having WCF Services be the DAL</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Concerns over having WCF Services be the DAL</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3770.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SoftwareArchitect posted on Wednesday, October 24, 2007</h2>Client application is a web app (ASP.NET)&nbsp; that is hosted by a third party (external to the customer) site.&nbsp; The app uses a CSLA business objects assembly...and, since it is a external, it will be using the web services portal.&nbsp; The portal is located on a machine sitting in the corporate DMZ.&nbsp; <br><br>Once the dataportal methods are invoked (on the machine in the DMZ), how should I perform the data operations?&nbsp; We are concerned about opening up the ability to query the internal databases directly from that machine in the dmz.&nbsp; So, the thought is to build a WCF host internally that pretty much just executes queries.&nbsp; Then, open up access to that internal WCF host and have the business objects use that instead of the typical datareader/sqlcommand code.&nbsp;&nbsp;&nbsp; Thus a DAL built with WCF. <br><br>Questions:<br>Any concerns with this architecture?&nbsp;&nbsp; <br>It it acceptable to allow machines in the DMZ to do direct database access?<br>Any guess on performance impact in shuttling datasets around as opposed using datareader directly?<br><br>Thanks,<br>Mike Stover<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, October 24, 2007</h2><P>The whole idea of the DataPortal is that your server in the DMZ can *avoid* talking directly to the DB and instead talk to an app server (Web Server) located on the other side of the firewall (inside Corporate.)</P>
<P>For this you simply need to follow standard CSLA coding techniques (mainly no DB communications unless you are in a Dataportal_xyz method.)</P>
<P>Then you can switch between local dataportal (the web server can talk to tthe DB server) and a remote dataportal (your web server talks to a 2nd web server which talks tot he DB for you) by changing your config file.</P>
<P>The BOs are shuttled back and forth through the DataPortal automatically because they are serializable.</P>
<P>You can begin implementing WCF as the Remoting mechanism - but be sure to get the eBook before even thinking about it. There is a lot of information there which you should know before deciding if it is worth it.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, October 25, 2007</h2><P>Can we just clarify the situation you are describing.&nbsp; &nbsp;Are you talking about a situation where you have the following physical requirements.</P>
<P>The web server is an externally hosted server outside the control of the corporation.&nbsp; This will communicate with an App server that is inside the "outer" corporate firewall, but outside the "inner" corporate firewall (I believe that is what you mean by inside the DMZ).</P>
<P>There is a "primary"&nbsp;App server inside the DMZ that for security reasons cannot communicate through the "inner"&nbsp;firewall to access the DB.&nbsp; Therefore you want to configure the "primary" App server to communicate with a "secondary" App server that is inside the "inner" firewall.</P>
<P>The "secondary" App server is inside the "inner" firewall and this server does have access to the DB server.&nbsp; This server will perform all SQL requests against the DB.</P>
<P>Have I understood the situation correctly?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SoftwareArchitect replied on Thursday, October 25, 2007</h2>David - you have it exactly correct.<br>------------------------------------------------<br>Joe - not sure how I can make a "double hop" through to the internal app server that CAN query the db directly.&nbsp; Let me explain...<br><br>InnerAppServer | DMZ Zone AppServer -----internet ----&nbsp; Externally Hosted WebServer<br><br>If my website (client) were running on the DMZ AppServer I could certainly pass my business objects into a data portal running on InnerAppServer; however, my client is hosted outside of the corporate network and that server (and the rest of the internet at large) can only communicate with the DMZ zone Server.&nbsp; <br><br>Thus, the current setup looks like:<br>WCF DataPortal | WebService DataPortal ----internet---- ASP.NET client<br><br>Thanks,<br>Mike Stover<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, October 25, 2007</h2><P>I thought that's what you were getting at <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />.&nbsp; That's an interesting configuration problem you have there.</P>
<P>I wonder if Rocky, or someone else at Magenic, has already had experience with that type of configuration?</P>
<P>It's an obvious web-based scenario that you are describing.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, October 25, 2007</h2><P>Actually, I've just had a further thought on this topic based on some other work we are doing with Exchange Server 2007.</P>
<P>I think, the key thing here is that you don't want to de-serialize the objects in the DMZ.&nbsp; You really only want to do that when reach the "inner" App server.</P>
<P>So what you need in the DMZ is a relay service.&nbsp; Something that takes the request, but immediately passes it on to the ultimate target.</P>
<P>So we managed to achieve something like this using a Web Service wrapper that sits around the Web Service API for Exchange Server 2007.&nbsp; "Our"&nbsp;Web Service runs on a server and just takes the request and forwards it to the real Exchange Server Web Service with no de-serialization.&nbsp; And as far as the client consumer is concerned it looks like the request was handled by our Web Service.</P>
<P>If you used Web Services as the transport in both cases that might solve the problem.</P>
<P>Is that a possibility?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, October 25, 2007</h2>I think there was a similar "relay" requirement discussed on this forum before.&nbsp; Rocky's suggestion was to implement a dataportal which handled this relaying.&nbsp; It would be similar to remoting, for example, that simply does the remoting call then passes to the simple data portal.&nbsp; In this case, it would pass it to whatever dataportal is configured on the app server.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, October 25, 2007</h2>I'd need to check our implementation details for our Exchange Server solution.&nbsp; But if my memory is correct, we achieved it all with zero code.&nbsp; It just used configuration settings to achieve the result.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 25, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>I think there was a similar "relay" requirement discussed on this forum before.&nbsp; Rocky's suggestion was to implement a dataportal which handled this relaying.&nbsp; It would be similar to remoting, for example, that simply does the remoting call then passes to the simple data portal.&nbsp; In this case, it would pass it to whatever dataportal is configured on the app server.&nbsp; <BR></div></BLOCKQUOTE></P>
<P>Yes, this was my recommendation.</P>
<P>I think the overall architecture here is pretty iffy. It seems like the relay "app server" does nothing but add overhead to the solution.</P>
<P>But if you do need a data portal relay, it wouldn't be that hard to write. Just create a data portal service/host like I do in Chapter 4. The data portal is all interface based, so all you need to do is create objects with the right interface so the message gets routed to your relay object. Your relay object would then contact the real app server and just pass the message along. That real app server would run a normal data portal configuration.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SoftwareArchitect replied on Friday, October 26, 2007</h2>Agreed.&nbsp; The relay app server is absolutely nothing but overhead.&nbsp; At present, there is no way to get the business objects from the client (asp.net app) to a machine where the databases can be accessed.&nbsp; The best possible scenario would be for the company to host the website themselves, thus alleviating the need for this middle physical layer.&nbsp; I am not sure that is going to be possible though.<br><br>Thanks for all of your replies.&nbsp; I appreciate the professionalism found in this forum and the willingness [of many] to offer advice/suggestions.<br><br>Mike Stover<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
