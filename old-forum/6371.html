<html><header><title>Does ReadProperty() work with properties with backing fields?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Does ReadProperty() work with properties with backing fields?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6371.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CodeSmartNotHard posted on Saturday, February 07, 2009</h2><P>Hi,</P>
<P>I'm using the propertyinfo property pattern in csla 3.6.&nbsp; When I create a property without a private backing field the ReadProperty method works fine.&nbsp; When the property has a private backing field, the ReadProperty doesn't return anything.&nbsp; Should this work and I am just doing something wrong?</P>
<P>Here's the two property declarations</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; CustomerNameProperty = RegisterProperty(new PropertyInfo&lt;string&gt;("CustomerName", "Customer Name"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string _customerName = CustomerNameProperty.DefaultValue;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string CustomerName<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(CustomerNameProperty, _customerName); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(CustomerNameProperty, ref _customerName, value); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; AddressProperty = RegisterProperty(new PropertyInfo&lt;string&gt;("Address", "Address"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Address<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(AddressProperty); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(AddressProperty, value); }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>Here's where I'm trying to call ReadProperty() </P>
<P>cm.Parameters.AddWithValue("@CustomerName", ReadProperty(CustomerNameProperty));<BR>cm.Parameters.AddWithValue("@Address", ReadProperty(AddressProperty));</P>
<P>Thanks in advance for any help.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, February 08, 2009</h2><P>No, ReadProperty() doesn't work with private backing fields. There's no reason to use ReadProperty() in such a case, because you already have access to the private field - so ReadProperty() would be useless overhead.</P>
<P>ReadProperty() exists so you can read a managed backing field without the authorization check that occurs with GetProperty(). But with a private backing field, you can access the field directly, which obviously doesn't trigger the authorization check.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CodeSmartNotHard replied on Sunday, February 08, 2009</h2><P>That makes sense.&nbsp; Thanks Rocky!</P>
<P>Mike&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonG replied on Wednesday, March 24, 2010</h2><p>I&#39;m experiencing a problem with the ReadProperty method. This does make total sense, but i don&#39;t understand what my problem is.</p>
<p>I&#39;m using the&nbsp;managed backing fields...</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">private</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">static</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">PropertyInfo</span></span><span style="font-size:x-small;">&lt;</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">string</span></span><span style="font-size:x-small;">&gt; FirstNameProperty =RegisterProperty(</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">new</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">PropertyInfo</span></span><span style="font-size:x-small;">&lt;</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">string</span></span><span style="font-size:x-small;">&gt;(</span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">&quot;FirstName&quot;</span></span><span style="font-size:x-small;">));<font size="2">
<p>
<p>&nbsp;</p>
</p>
</font></span></p>
<p>
<p>&nbsp;</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">public</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">string</span></span><span style="font-size:x-small;"> FirstName</span></p>
<p><span style="font-size:x-small;">{</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">get</span></span><span style="font-size:x-small;"> { </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">return</span></span></p>
<p><span style="font-size:x-small;"> GetProperty(FirstNameProperty); }<font size="2">
<p>&nbsp;</p>
</font></span></p>
<p>&nbsp;</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">set</span></span><span style="font-size:x-small;"> { SetProperty(FirstNameProperty, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">value</span></span></p>
<p><span style="font-size:x-small;">); }</span></p>
<p><span style="font-size:x-small;">And in the&nbsp;&nbsp;<span style="font-size:x-small;">DataPortal_Update()</span></span></p>
</p>
<p><span style="font-size:x-small;"><span style="font-size:x-small;"><span style="font-size:x-small;"><font size="2">
<p>cmd.Parameters.Add(</p>
</font></span>
<p><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">&quot;@First_Name&quot;</span></span><span style="font-size:x-small;">, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">OleDbType</span></span><span style="font-size:x-small;">.VarChar).Value = ReadProperty(FirstNameProperty);</span></p>
<p><span style="font-size:x-small;">If i update the First Name property with a new value, the ReadProperty() returns the old value. </span></p>
<p><span style="font-size:x-small;">Do you have any suggestions?</span></p>
<p>thanks.</p>
<p>&nbsp;</p>
<p><span style="font-size:x-small;"></span></p>
</span></span></p>
<p><span style="font-size:x-small;"><span style="font-size:x-small;"></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, March 24, 2010</h2><p>The following code works as expected - printing out &quot;default&quot;, &quot;Rocky&quot; and &quot;Rocky&quot;. So there&#39;s something else going on in your code beyond a simple bug in ReadProperty().</p>
<p>using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br />using Csla;</p>
<p>namespace ConsoleApplication1<br />{<br />&nbsp; [Serializable]<br />&nbsp; public class Test : BusinessBase&lt;Test&gt;<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; NameProperty = RegisterProperty&lt;string&gt;(c =&gt; c.Name, &quot;Name&quot;, &quot;default&quot;);<br />&nbsp;&nbsp;&nbsp; public string Name<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(NameProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(NameProperty, value); }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; public string GetName()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty(NameProperty);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }</p>
<p>&nbsp; class Program<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; static void Main(string[] args)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var obj = new Test();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(obj.Name);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.Name = &quot;Rocky&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(obj.Name);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(obj.GetName());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ReadLine();<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br />}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonG replied on Thursday, March 25, 2010</h2><p>I&#39;m sure the problem is with my implementation, but its odd that the public FirstName property returns the updated value but the ReadProperty() method returns the old value. Also the object that is return from the .Save() contains the updated values, but its the old values&nbsp;are saved when DataPortal_Update() is called.</p>
<p>Can you think of anything that could cause that problem?</p>
<p>I really appreciate your help.&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonG replied on Thursday, March 25, 2010</h2><p>Man, don&#39;t i feel stupid!&nbsp;&nbsp; Problem solved... </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, March 25, 2010</h2><p>Can you share what the problem was?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JasonG replied on Thursday, March 25, 2010</h2><p>It was nothing to do with the framework.&nbsp;there were a number of things happening.. </p>
<p>&nbsp;first my testing data&nbsp;was the&nbsp;same as the property names, so when i was debugging&nbsp;i assumed the values were not updating, but the values i was seeing were the&nbsp;property names.. secondly, my oledb.execute command wasn&#39;t working due to the parameters not in the correct order. &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
