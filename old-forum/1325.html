<html><header><title>Collection questions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Collection questions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1325.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, September 25, 2006</h2>Hi,<br><br>I have a ProductBundle class, which allows the user to specify if the price is calculated (by adding the prices of its components) or if the price is fixed (specified by the user).<br><br>The system allows any number of price lists as well.&nbsp; So when editing a product bundle, the user can edit prices for ALL of the lists at once.&nbsp; The price list and associated unit price are edited through a grid.<br><br>Now for the fun.&nbsp; The Prices collection will always contain a Price object for each PriceList, even if no price is defined for the list.&nbsp; When the bundle's price type is set to Calculated, the Prices list is cleared.&nbsp; This works fine.&nbsp; What I'd like to do is restore the list to the state its before being cleared when PriceType is set back to Fixed.&nbsp; <br><br>My first idea is to simply add an internal method to the collection which will move everything in the DeletedList back to the main list.&nbsp; I think this should work, since Adding and Removing objects to and from the collection is not allowed by public members.&nbsp; <br><br>Thoughts or other suggestions?<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, September 25, 2006</h2><P>Just a suggestion, as I didn't fully understand everything you were saying: </P>
<P>In your collection get you could also check to see if pricetype=calculated, and if so the get on the collection could just return an empty collection - if it's not calculated, it returns the actual collection. That way you wouldn't need to tinker with the collection itself.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, September 25, 2006</h2>That would cause the collection class to be tightly coupled to the parent.. which won't work because the collection is also used by the Product class which doesn't have a PriceType property.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jkellywilkerson replied on Monday, September 25, 2006</h2><P>Could you have the object .Clone() itself and implement some sort of Backup/Restore feature within the BO itself?&nbsp; Not sure what that would look like or if it would even work.&nbsp; Just a thought from "left field".</P>
<P>Kelly.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 26, 2006</h2>Kelly,<br><br>That's what I thought too.&nbsp; I think I came up with a workable solution that offers better performance.<br><br>Basically, the client code can never add or remove items from the collection.&nbsp; So what I did is add some internal methods, ClearPrices and UnclearPrices.&nbsp; <br><br>Basically what happens is this; when the bundle's price is set to calculated, it calls clear, which simply moves everything to DeletedList.&nbsp; When set to unclear, all items in DeletedList are moved back to the 'real' list.&nbsp; <br><br>The tricky part was figuring out the proper behavior when the list is saved.&nbsp; When I save either everything is in DeletedList in which case the proper row is removed and the object is set to New, or its in the main list and items are inserted / updated as needed.&nbsp; <br><br>I never clear DeletedList though; the reason is that after a save, if the user sets the price back to Fixed, I need to have those objects.. so I just move them out of the deleted list.<br><br>So far it works pretty well, and gives the user a better experience than having to remember 'add' a new price list to the Prices and set its price.&nbsp; The price list is just always there ready to be filled out.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jmbowles replied on Tuesday, September 26, 2006</h2><P>This is my first post, so, take it easy on me ...</P>
<P>These are all good suggestions.&nbsp; However, I look at the problem in a different way.&nbsp; If I understand correctly, the ProductBundle's calculation behavior can change at runtime.&nbsp;I would configure a ProductBundle with a strategy (i.e. IProductCalculationStrategy) that knows how to calculate the costs.&nbsp; Each strategy can then determine what values or lack thereof are present and calculate accordingly.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 26, 2006</h2>Welcome to the board!<br><br>That's a good idea when I need to calculate the price of the bundle or even non-bundle, which I will have to do in other use cases.&nbsp; <br><br>At this point when editing the bundle, the price isn't shown if Calculated is selected; its just a flag for this particular use case.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
