<html><header><title>Encapsulate Collection. Possible ReadOnlyBindingListWrapper&amp;lt;T&amp;gt;.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Encapsulate Collection. Possible ReadOnlyBindingListWrapper&amp;lt;T&amp;gt;.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4531.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MozgC posted on Thursday, March 20, 2008</h2>Dear Rockford,<br />   ReadOnlyBindingList is a very good class. But sometimes you need to return read-only collection from a class. <br /><br />For example, we have a ManufacturerAccessor class (inside DAL) that keeps collection of manufacturers internally. Its method GetAllManufacturers() should return a collection of manufacturers, but that collection should be read-only for external consumer. In this case it is very convenient to keep collection as BindingList, but return ReadOnlyBindingListWrapper. <br /><br />Here is the possible implementation (based on your ReadOnlyBindingList):<br /><br />	/// <br />	/// A readonly version of BindingList(Of T)<br />	/// <br />	/// Type of item contained in the list.<br />	/// <br />	/// This is a subclass of BindingList(Of T) that implements<br />	/// a readonly list, preventing changing, adding and removing of items<br />	/// from the list.<br />	/// <br />	public class ReadOnlyBindingListWrapper : BindingList<br />	{<br />		private const string MSG_NOT_ALLOWED_IN_READONLY_COLLECTION = "Not allowed in read-only collection";<br /><br />		/// <br />		/// Creates an instance of the object.<br />		/// <br />		public ReadOnlyBindingListWrapper(BindingList list) : base(list)<br />		{<br />			this.RaiseListChangedEvents = false;<br />			base.AllowEdit = false;<br />			base.AllowRemove = false;<br />			base.AllowNew = false;<br />			this.RaiseListChangedEvents = true;<br /><br />			list.ListChanged += new ListChangedEventHandler(ReadOnlyBindingList_ListChanged);<br />		}<br /><br />		private void ReadOnlyBindingList_ListChanged(object sender, ListChangedEventArgs e)<br />		{<br />			OnListChanged(e);<br />		}<br /><br />		/// <br />		/// Prevents clearing the collection.<br />		/// <br />		protected override void ClearItems()<br />		{<br />			throw new InvalidOperationException(MSG_NOT_ALLOWED_IN_READONLY_COLLECTION);<br />		}<br /><br />		/// <br />		/// Prevents insertion of items into the collection.<br />		/// <br />		protected override object AddNewCore()<br />		{<br />			throw new InvalidOperationException(MSG_NOT_ALLOWED_IN_READONLY_COLLECTION);<br />		}<br /><br />		/// <br />		/// Prevents insertion of items into the collection.<br />		/// <br />		/// Index at which to insert the item.<br />		/// Item to insert.<br />		protected override void InsertItem(int index, T item)<br />		{<br />			throw new InvalidOperationException(MSG_NOT_ALLOWED_IN_READONLY_COLLECTION);<br />		}<br /><br />		/// <br />		/// Prevents removing of items into the collection<br />		/// <br />		/// Index of the item to remove.<br />		protected override void RemoveItem(int index)<br />		{<br />			throw new InvalidOperationException(MSG_NOT_ALLOWED_IN_READONLY_COLLECTION);<br />		}<br /><br />		/// <br />		/// Prevents replacing the item at the specified index with the <br />		/// specified item<br />		/// <br />		/// Index of the item to replace.<br />		/// New item for the list.<br />		protected override void SetItem(int index, T item)<br />		{<br />			throw new InvalidOperationException(MSG_NOT_ALLOWED_IN_READONLY_COLLECTION);<br />		}<br /><br />		/// <br />		/// Gets a value indicating whether items in the list can be edited.<br />		/// <br />		public new bool AllowEdit { get { return false; } }<br /><br />		/// <br />		/// Gets a value indicating whether you can add items to the list using the AddNew method.<br />		/// <br />		public new bool AllowNew { get { return false; } }<br /><br />		/// <br />		/// Gets a value indicating whether you can remove items from the collection. <br />		/// <br />		public new bool AllowRemove { get { return false; } }<br />	}<br /><br />If somebody is gonna use it, don't forget to write BindingList or IList in signature of a method that returns that ReadOnlyBindingListWrapper. Here is the possible usage:<br /><br />class ManufacturerAccessor { ...<br /><br />private BindingList _manufacturers = new BindingList();<br /><br />public BindingList GetAllManufacturers()<br />{<br />  ...<br />  return new ReadOnlyBindingListWrapper(_manufacturers);<br />}<br /><br />And you call it like this:<br /><br />BindingList manufacturers = ManufacturerAcessor.GetAllManufacturers();<br /><br />As it seems this forum doesn't support good code insertion, you can take source code in attachment.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MozgC replied on Sunday, March 23, 2008</h2>Any comments?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Sunday, March 23, 2008</h2><P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>MozgC:</strong></div><div>Dear Rockford, ReadOnlyBindingList is a very good class. But sometimes you need to return read-only collection from a class. For example, we have a ManufacturerAccessor class (inside DAL) that keeps collection of manufacturers internally. Its method GetAllManufacturers() should return a collection of manufacturers, but that collection should be read-only for external consumer. In this case it is very convenient to keep collection as BindingList, but return ReadOnlyBindingListWrapper.</div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>If you're worried about binding to a read-only collection, why not simply have your DAL return a DataReader,&nbsp;populate a standard ReadOnlyList with ReadOnly child objects, and use that?&nbsp; You can bind to it just like an&nbsp;editable list, and by default it doesn't allow for adding or removing of items.&nbsp; And if the child objects in the list are ReadOnly-derived objects, you can't modify them.</FONT></P>
<P><FONT face=Tahoma size=2>Aside from that, you shouldn't be mixing CSLA objects in your DAL - CSLA is designed to create business objects.&nbsp; As such, it's designed to sit between your DAL and your UI.</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MozgC replied on Sunday, March 23, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>tmg4340:</strong></div><div><P><FONT face=Tahoma size=2>If you're worried about binding to a read-only collection, why not simply have your DAL return a DataReader,&#160;populate a standard ReadOnlyList with ReadOnly child objects, and use that?&#160; You can bind to it just like an&#160;editable list, and by default it doesn't allow for adding or removing of items.&#160; And if the child objects in the list are ReadOnly-derived objects, you can't modify them.</FONT></P><br /><P><FONT face=Tahoma size=2>Aside from that, you shouldn't be mixing CSLA objects in your DAL - CSLA is designed to create business objects.&#160; As such, it's designed to sit between your DAL and your UI.</FONT></P><br /><P><FONT face=Tahoma size=2>- Scott</FONT></P></div></BLOCKQUOTE><br /><br />DAL shouldn't return a DataReader, it should return business object to BLL. It's not BLL's task to work with low level data such as in DataReader. Also I need to know about changes in collection. For example, if I get that collection and connect it to combobox or whatever, I need to show updates if the collection is changed (new manufacturer added, manufacturer info updated and so on). <br /><br />And I should mix business objects in my DAL - it IS ok, as my model is based on objects, not on plain row data. Only DAL works with plain data, all other layers work with business objects, so DAL returns business objects, not DataReader.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
