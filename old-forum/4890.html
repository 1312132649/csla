<html><header><title>CSLA 3.5 LinqBindingList NullReferenceException</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.5 LinqBindingList NullReferenceException</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4890.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kathleen posted on Friday, May 23, 2008</h2><P>Hi,</P>
<P>In my project I have an employee and for this employee regimes can be added. If I add a&nbsp;regime and save&nbsp;the employee&nbsp;everything works fine. If I then&nbsp;add another regime I get a NullReferenceException(Object reference not set to an instance of an object) &nbsp;in EmployeeRegimeList in </P>
<P><FONT color=#000000>protected override void InsertItem(int index, EmployeeRegime item)</FONT></P>
<P><FONT color=#000000>{base</FONT><FONT size=2><FONT color=#000000 size=3>.InsertItem(index, item);}</FONT></FONT></P>
<P><FONT size=2><FONT size=3>with base being BusinessListBase&lt;x,y&gt;</FONT></FONT></P>
<P><FONT size=2><FONT size=3></FONT></FONT>&nbsp;</P>
<P><FONT size=2><FONT size=3>Any idea what is going wrong? Is this a known bug?</FONT></P>
<P></FONT><BR>&nbsp;&nbsp; at Csla.LinqBindingList`1.ItemShouldBeInList(T item)<BR>&nbsp;&nbsp; at Csla.LinqBindingList`1.SourceChanged(Object sender, ListChangedEventArgs e)<BR>&nbsp;&nbsp; at System.ComponentModel.ListChangedEventHandler.Invoke(Object sender, ListChangedEventArgs e)<BR>&nbsp;&nbsp; at System.ComponentModel.BindingList`1.OnListChanged(ListChangedEventArgs e)<BR>&nbsp;&nbsp; at System.ComponentModel.BindingList`1.InsertItem(Int32 index, T item)<BR>&nbsp;&nbsp; at Csla.BusinessListBase`2.InsertItem(Int32 index, C item)<BR>&nbsp;&nbsp; at Rls.CapacityPlanning.Entities.EmployeeRegimeList.InsertItem(Int32 index, EmployeeRegime item) in C:\Real\Projects\TrunkCab\CapPlanV2\Source\Entities\Rls.CapacityPlanning.Entities\EmployeeRegimeList.cs:line 28<BR>&nbsp;&nbsp; at System.Collections.ObjectModel.Collection`1.Add(T item)<BR>&nbsp;&nbsp; at Rls.CapacityPlanning.Entities.Employee.AddRegime(DateTime fromDate, Nullable`1 toDate, Int32 regimeID) in C:\Real\Projects\TrunkCab\CapPlanV2\Source\Entities\Rls.CapacityPlanning.Entities\Employee.cs:line 299<BR>&nbsp;&nbsp; at Rls.CapacityPlanning.Planning.Views.EmployeeDetail.EmployeeDetailViewPresenter.AddRegime(Object sender, EventArgs e) in C:\Real\Projects\TrunkCab\CapPlanV2\Source\Planning\Planning\Views\EmployeeDetail\EmployeeDetailViewPresenter.cs:line 475<BR>&nbsp;&nbsp; at Microsoft.Practices.CompositeUI.Commands.Command.OnExecuteAction(Object sender, EventArgs e)<BR>&nbsp;&nbsp; at Microsoft.Practices.CompositeUI.Commands.CommandAdapter.FireCommand()<BR>&nbsp;&nbsp; at Microsoft.Practices.CompositeUI.Commands.EventCommandAdapter`1.InvokerEventHandler(Object sender, EventArgs e)<BR>&nbsp;&nbsp; at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)<BR>&nbsp;&nbsp; at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)<BR>&nbsp;&nbsp; at System.Windows.UIElement.RaiseEventImpl(RoutedEventArgs args)<BR>&nbsp;&nbsp; at System.Windows.UIElement.RaiseEvent(RoutedEventArgs e)<BR>&nbsp;&nbsp; at System.Windows.Controls.Button.OnClick()<BR>&nbsp;&nbsp; at System.Windows.Controls.Primitives.ButtonBase.OnMouseLeftButtonUp(MouseButtonEventArgs e)<BR>&nbsp;&nbsp; at System.Windows.UIElement.OnMouseLeftButtonUpThunk(Object sender, MouseButtonEventArgs e)<BR>&nbsp;&nbsp; at System.Windows.Input.MouseButtonEventArgs.InvokeEventHandler(Delegate genericHandler, Object genericTarget)<BR>&nbsp;&nbsp; at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)<BR>&nbsp;&nbsp; at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)<BR>&nbsp;&nbsp; at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)<BR>&nbsp;&nbsp; at System.Windows.UIElement.ReRaiseEventAs(RoutedEventArgs args, RoutedEvent newEvent)<BR>&nbsp;&nbsp; at System.Windows.UIElement.OnMouseUpThunk(Object sender, MouseButtonEventArgs e)<BR>&nbsp;&nbsp; at System.Windows.Input.MouseButtonEventArgs.InvokeEventHandler(Delegate genericHandler, Object genericTarget)<BR>&nbsp;&nbsp; at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)<BR>&nbsp;&nbsp; at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)<BR>&nbsp;&nbsp; at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)<BR>&nbsp;&nbsp; at System.Windows.UIElement.RaiseEventImpl(RoutedEventArgs args)<BR>&nbsp;&nbsp; at System.Windows.UIElement.RaiseEvent(RoutedEventArgs args, Boolean trusted)<BR>&nbsp;&nbsp; at System.Windows.Input.InputManager.ProcessStagingArea()<BR>&nbsp;&nbsp; at System.Windows.Input.InputManager.ProcessInput(InputEventArgs input)<BR>&nbsp;&nbsp; at System.Windows.Input.InputProviderSite.ReportInput(InputReport inputReport)<BR>&nbsp;&nbsp; at System.Windows.Interop.HwndMouseInputProvider.ReportInput(IntPtr hwnd, InputMode mode, Int32 timestamp, RawMouseActions actions, Int32 x, Int32 y, Int32 wheel)<BR>&nbsp;&nbsp; at System.Windows.Interop.HwndMouseInputProvider.FilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled)<BR>&nbsp;&nbsp; at System.Windows.Interop.HwndSource.InputFilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled)<BR>&nbsp;&nbsp; at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled)<BR>&nbsp;&nbsp; at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)<BR>&nbsp;&nbsp; at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Boolean isSingleParameter)<BR>&nbsp;&nbsp; at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)<BR>&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.InvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Boolean isSingleParameter)<BR>&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.Invoke(DispatcherPriority priority, Delegate method, Object arg)<BR>&nbsp;&nbsp; at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)<BR>&nbsp;&nbsp; at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG&amp; msg)<BR>&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)<BR>&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)<BR>&nbsp;&nbsp; at System.Windows.Threading.Dispatcher.Run()<BR>&nbsp;&nbsp; at System.Windows.Application.RunInternal(Window window)<BR>&nbsp;&nbsp; at System.Windows.Application.Run(Window window)<BR>&nbsp;&nbsp; at System.Windows.Application.Run()<BR>&nbsp;&nbsp; at SCSFContrib.CompositeUI.WPF.ApplicationShellApplication`2.Start()<BR>&nbsp;&nbsp; at Microsoft.Practices.CompositeUI.CabApplication`1.Run()<BR>&nbsp;&nbsp; at Rls.CapacityPlanning.Shell.Shell.Main() in C:\Real\Projects\TrunkCab\CapPlanV2\Source\Infrastructure\Shell\Shell.cs:line 18<BR>&nbsp;&nbsp; at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)<BR>&nbsp;&nbsp; at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<BR>&nbsp;&nbsp; at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<BR>&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<BR>&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<BR>&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 23, 2008</h2><P>Yes, it appears to be a bug. The fix should be to change ItemShouldBeInList() to this:</P>
<BLOCKQUOTE dir=ltr>
<P>&nbsp;&nbsp;&nbsp; private bool ItemShouldBeInList(T item)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InnermostWhereFinder whereFinder = new InnermostWhereFinder();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MethodCallExpression whereExpression = whereFinder.GetInnermostWhere(_expression);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Expression&lt;Func&lt;T, bool&gt;&gt; whereBody = (Expression&lt;Func&lt;T, bool&gt;&gt;)((UnaryExpression)(whereExpression.Arguments[1])).Operand;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var searchable = _list as Linq.IIndexSearchable&lt;T&gt;;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (searchable == null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return searchable.SearchByExpression(whereBody).Contains(item);<BR>&nbsp;&nbsp;&nbsp; }</P></BLOCKQUOTE>
<P>I've put this fix into svn for 3.5.1.</P>
<P>VB users should note that the code is a bit different there, but I've put an equivalent fix into svn in the VB edition as well for 3.5.1.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kathleen replied on Tuesday, May 27, 2008</h2>Thanks for the quick reply!</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
