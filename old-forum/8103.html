<html><header><title>AddEventHooks() Possibe Issue</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>AddEventHooks() Possibe Issue</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8103.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Sunday, December 06, 2009</h2>While looking at the LoadPropertyValue method under Csla.Core.BusinessBase, I noticed that the EventHooks() method was only being applied when the framework detected that the new property value was being updated with a different object.<br /><br />This will work fine if the object is being set using the property get/set methods but what happens when the value is set as a default value from within the RegisterProperty() call? Well, it looks like this will not work as expected.<br /><br />I created a little test project to illustrate the problem. The project is overly simplified but it should get the point across.<br /><br />One more thing, I realize that what I am doing here may or may not be a good practice. That’s beond the pint right now. All I am trying to do is just to point out possible issues with the CSLA code.<br /><br />Thank you.<br /><br />** Note:  I tried to fix/escape the lower-than and greater-than symbols but gave up…. Probably should have tried harder but did not have the patient to deal with that.<br /><br />Here is the code:<br />-----------------------------------<br />using System;<br />using Csla;<br /><br />namespace ConsoleApplication1<br />{<br />    class Program<br />    {<br />        class Employee : BusinessBase<br />        {<br />            private static PropertyInfo JobProperty = RegisterProperty(o => o.EmployeeJob, null, new Job());<br />            public Job EmployeeJob<br />            {<br />                get { return GetProperty(JobProperty); }<br />                set { SetProperty(JobProperty, value); }<br />            }<br />        }<br /><br />        class Job : BusinessBase<br />        {<br />            private static PropertyInfo IDProperty = RegisterProperty(o => o.ID);<br />            public string ID<br />            {<br />                get { return GetProperty(IDProperty); }<br />                set { SetProperty(IDProperty, value); }<br />            }<br />        }<br /><br />        static void Main(string[] args)<br />        {<br />            //This does not work.<br />            Employee emp = new Employee();<br />            emp.ChildChanged += emp_ChildChanged;<br />            emp.EmployeeJob.ID = "xyz";<br />            Console.Read();<br /><br />            ////This works.<br />            //Job job = new Job();<br />            //Employee emp = new Employee();<br />            //emp.EmployeeJob = job;<br />            //emp.ChildChanged += emp_ChildChanged;<br />            //emp.EmployeeJob.ID = "xyz";<br />            //Console.Read();<br />        }<br /><br />        static void emp_ChildChanged(object sender, Csla.Core.ChildChangedEventArgs e)<br />        {<br />            Console.WriteLine("Employee class detected a property changed in Job class");<br />        }<br />    }<br />}</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, December 06, 2009</h2><P>Actually what you are doing is illegal. Remember that RegisterProperty() is a static method, so that default value you create will be used on every single object ever created - providing <EM>the same child instance to multiple parents</EM>.</P>
<P>It is not legal for an object to have multiple parent objects - this will cause all sorts of problems (wrong Parent value, messed up edit levels, etc).</P>
<P>I'm not saying you didn't find a "bug", but even if we fixed that bug it would simply lead to another bug, and another and another.</P>
<P>Perhaps the real bug is that RegisterProperty() should throw an exception when you try to set a non-valuetype default value. And if this was a common issue I'd do that - but I can't recall anyone actually reporting an issue with this at all, so it isn't worth "fixing".</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, December 09, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><P>Actually what you are doing is illegal. Remember that RegisterProperty() is a static method, so that default value you create will be used on every single object ever created - providing <EM>the same child instance to multiple parents</EM>.</P></div></BLOCKQUOTE><br /><br />Ok, I can understand that, but there is also the possibility for the Employee object to be a singleton class in which case, it would be totally legal right?<br /><br /><br /><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><P>Perhaps the real bug is that RegisterProperty() should throw an exception when you try to set a non-valuetype default value. And if this was a common issue I'd do that - but I can't recall anyone actually reporting an issue with this at all, so it isn't worth "fixing".</P></div></BLOCKQUOTE><br /><br />Two things.<br /><br />---------------------------------------<br />1) The Csla.Core.Business object has a method called "SetParent()" that is implemented as:<br /><br />        internal void SetParent(Core.IParent parent)<br />        {<br />            _parent = parent;<br />        }<br /><br />for what I can see, all parents (BusinessBaes or BusinessListBase) will call this method to set themselves as the parents of the object. So in order to avoid this and other issues would it not be possible to throw an error in that method if the _parent is not null<br /><br />        internal void SetParent(Core.IParent parent)<br />        {<br />           if(_parent != null)<br />                      throw new InvalidOperationException("Object can't belong to more than one parent")<br />            _parent = parent;<br />        }<br /><br /><br />---------------------------------------<br />2) This one kind of troubles me a bit. The <b>so it isn't worth>"fixing" </b> part.<br /><br />To me everything is worth fixing, I mean, why not? <br /><br />Whats the problem? There's probably a bunch of people that are eager to contribute to the development of the CSLA, I know I am one of them... I mean, I would pay money to be able to be more than just a user of the CSLA. It would be really gratifying to see some of my code land on the CSLA...... ok, perhaps I am not worthy at this time but I am sure others are.<br /><br />So rather than not fixing the issue, have you consider doing something to allow people to help you out with the core csla? is this being done at this time (other than the VB effort)?<br /><br />Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Wednesday, December 09, 2009</h2><P><FONT size=2 face=Tahoma><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rxelizondo:</strong></div><div>2) This one kind of troubles me a bit. The <B>so it isn't worth&gt;"fixing" </B>part. To me everything is worth fixing, I mean, why not? Whats the problem? There's probably a bunch of people that are eager to contribute to the development of the CSLA, I know I am one of them... I mean, I would pay money to be able to be more than just a user of the CSLA. It would be really gratifying to see some of my code land on the CSLA...... ok, perhaps I am not worthy at this time but I am sure others are. So rather than not fixing the issue, have you consider doing something to allow people to help you out with the core csla? is this being done at this time (other than the VB effort)? Thanks.</div></BLOCKQUOTE></FONT></P>
<P><FONT size=2 face=Tahoma>There is a contributor agreement you can sign with Rocky which opens up opportunities to assist in maintaining CSLA.&nbsp; I haven't seen it, so I don't know what's involved.</FONT></P>
<P><FONT size=2 face=Tahoma>Having said that, there most certainly are bugs that aren't worth fixing.&nbsp; I've found this blog entry to be pretty good at explaining my perspective on it:</FONT></P>
<P><A href="http://www.joelonsoftware.com/articles/fog0000000014.html"><FONT size=2 face=Tahoma>http://www.joelonsoftware.com/articles/fog0000000014.html</FONT></A></P>
<P><FONT size=2 face=Tahoma>In this case, the blog author is dealing with commercial software, which lives in a slightly different world than CSLA.&nbsp; But I think the same principles still apply.&nbsp; Basically, from this perspective, fixing a bug isn't worth it if it takes more time to fix than it saves.&nbsp; Given the situation that Rocky has described - i.e. this is a "bug" that no one has encountered - there's nothing on the "time saved" column to balance out the "time to fix" column.&nbsp; He also mentioned that tackling this issue opens up a whole other set of potential issues, which add even more time to the "time to fix" column...</FONT></P>
<P><FONT size=2 face=Tahoma>(Having said that, if you read the article, you'll see that he did end up fixing every bug in his system.&nbsp; "Cost" is sometimes a relative term... <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />)</FONT></P>
<P><FONT size=2 face=Tahoma>I also know that Rocky has his own hierarchy of how he determines what bugs he fixes, which has been laid out in posts before.&nbsp; It doesn't follow the article I linked to, but I see elements of the article in his hierarchy.</FONT></P>
<P><FONT size=2 face=Tahoma>I'm not trying to speak for Rocky here - just offering my opinion.</FONT></P>
<P><FONT size=2 face=Tahoma>HTH</FONT></P>
<P><FONT size=2 face=Tahoma>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 09, 2009</h2><P>Triage of bugs is basic software engineering. Any sizable software effort ends up with decisions made about what to fix and not to fix based on a variety of factors. </P>
<P>Not meaning offense, but it is naive to think that everything can be fixed - there are many costs to changing software (real cost, time, impact on existing users, opportunity cost, etc). Regardless of whether the change is a bug or a new feature, these costs exist.</P>
<P>It is true that I accept some help in maintaining CSLA. Generally the help is limited, though there are a small number of people I've been working with (sometimes off and on) for years, where I have a high level of trust that they share my view on software development and their impact has sometimes been quite high. Developing that level of trust takes a long time, but I really appreciate the contributions of the people who've stuck with me.</P>
<P>My view on CSLA contributions is not unlike Torvald's view on Linux - this is a "benevolent dictatorship" :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, December 09, 2009</h2>Thanks for responding Rocky.<br /><br />No offence taken!<br /><br />It’s not that I am being na&#239;ve, in fact, it’s somewhat ironic that today I found a “bug” in one of the applications I built. It’s one of those issues that fall in that infamous gray area of “Is this a bug or a feature” type of thing.<br /><br />When the users approached me with the issue, my response was, “This behavior is by design” … pretty original isn’t it :)<br /><br />I also told them that the best way to avoid the issue is not to do what they were doing… that was pretty original too wasn’t it :)<br /><br />The fact is that it wasn’t worth fixing the “bug” because it was a corner case and everyone agreed with me (including the users).<br /><br />There are a couple of differences between my app and the CSLA though:<br /><br />1) My app is used by a miserly 30 people all sitting in the same building, whereas the CSLA has a LOT more users than that.<br /><br />2) My app does not have the potential of literally changing people’s lives. I know that the CSLA changed my life. The principles and practices that I have learned from using it have opened many doors for me (and I am just an idiot).<br /><br />3) I don’t have a group of contributors that could help me make that change, I either make the change myself or it does not get done.<br /><br />So you see, its not that I don’t get it, it’s just that when it comes to software such as the CSLA I picture you as having a “the greater good” type of philosophy/attitude, the “balls to the wall” sort of way of thinking.<br /><br />On a more selfish note, users of the CSLA have a vested interest in seeing the CSLA get adopted by more and more developers. It would be a pity if the CSLA lost the framework fight and we saw it go bye-bye in favor of some other framework.  So the “no bugs” / “clean code” statements are big sellers to someone deciding between frameworks. The more CSLA adopters the better, the CSLA is a marketable skill if it’s well known.<br /><br />Anyway, that’s just my way of thinking.<br /><br />PS: Special thanks to the person editing this response and fixing the 50 spelling/grammar errors that I had. Simply put, I am never going to get English. </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 09, 2009</h2><P>What's ironic is that, as you might expect, CSLA was much cleaner and tighter when</P>
<OL>
<LI>It was smaller, so I was able to discuss literally every part in detail in the <EM>Expert Business Objects</EM> book</LI>
<LI>I was the only developer</LI></OL>
<P>The first point is a big one, because you <EM>must</EM> have amazingly clean code if you are going to use it as a tutorial in a book. But if I restricted the size of the framework to what I could completely discuss in the book the framework would have become irrelevant to most people several years ago.</P>
<P>The second point is just as important. Two developers never share exactly the same sensibilities, and there are parts of the framework now that I didn't implement - and so they are somewhat in the same style, but aren't completely in the same style. The more developers that become involved, the less consistency (and thus in a sense the less clean) the code becomes.</P>
<P>In my observation over the years, that's just the way software works. Barring some sort of Vulcan mind meld, everyone has a different take on things and that impacts (negatively) consistency and so forth.</P>
<P>Which is not a negative reflection on any contributors - there's some excellent code in the framework from some very smart people - but it isn't always quite the way I'd have done it :)</P>
<P>In any case, I fully appreciate that CSLA impacts a lot of people and organizations in some very deep ways. That's quite humbling.</P>
<P>And because of that reality, the need to prioritize changes and fixes based on broad impact is all the more important. Fixing things that no one has ever encountered in the wild falls at the absolute bottom of the priority list in most cases.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 10, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>rxelizondo:</strong></div><div>On a more selfish note, users of the CSLA have a vested interest in seeing the CSLA get adopted by more and more developers. It would be a pity if the CSLA lost the framework fight and we saw it go bye-bye in favor of some other framework. So the “no bugs” / “clean code” statements are big sellers to someone deciding between frameworks. The more CSLA adopters the better, the CSLA is a marketable skill if it’s well known.</div></BLOCKQUOTE></P>
<P>I'm curious.. what frameworks do you feel compete with Csla?&nbsp; To my knowledge, there are none, Csla fills a niche seemingly ignored by everyone else.&nbsp; DTO mapping is well covered, UI is well covered.... but business rules?&nbsp; The only things close are external rules engines, or something like WF.&nbsp; But these don't seem to be aimed at building a library to address particular use cases as much as they are a way to let "normal" people build "applications."</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Thursday, December 10, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div><P>I'm curious.. what frameworks do you feel compete with Csla?&#160; To my knowledge, there are none, Csla fills a niche seemingly ignored by everyone else.&#160; DTO mapping is well covered, UI is well covered.... but business rules?&#160; The only things close are external rules engines, or something like WF.&#160; But these don't seem to be aimed at building a library to address particular use cases as much as they are a way to let "normal" people build "applications."</P></div></BLOCKQUOTE><br /><br />Any framework out there is a competitor of the CSLA framework no matter how big/small or famous/unknown the other frameworks are, each framework has their pros and cons, that is why they exist.<br /><br />And just to be clear, I realize that some will claim that the CSLA is not at war against other frameworks and I would completely agree with such statement. I was just approaching this form the “marketable skill” point of view. The more famous/successful the CSLA is the more marketable you are. Especially since frameworks are critical to the development of any serious applications.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 10, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>rxelizondo:</strong></div><div>Any framework out there is a competitor of the CSLA framework no matter how big/small or famous/unknown the other frameworks are, each framework has their pros and cons, that is why they exist.</div></BLOCKQUOTE></P>
<P>That's a fair enough statement, but like I said, I'm not really sure there ARE other frameworks out there that tackle business objects.&nbsp; I've looked, and have yet to find one that fits the same niche.</P>
<P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>rxelizondo:</strong></div><div>I was just approaching this form the “marketable skill” point of view. The more famous/successful the CSLA is the more marketable you are. Especially since frameworks are critical to the development of any serious applications.</div></BLOCKQUOTE></P>
<P>I agree; of course, I've also had interviewers ask "what's Csla," and I give them an executive summary and explain why it's useful.&nbsp; So even if potential employers don't know what it is, it still helps you be marketable.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
