<html><header><title>View/Edit Mode and Authorization Rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>View/Edit Mode and Authorization Rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/521.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute posted on Friday, June 30, 2006</h2><P>I have a requirement for a form to support view/edit behavior.&nbsp; In other words, the form is initially in "view" mode and the user must click a button to enter "edit" mode.&nbsp; Once in "edit" mode, the user can "save" or "cancel" their changes to return to "view"mode etc.</P>
<P>There are a couple of ways to do this using panels and such but I was wondering if anybody has tried to work this at a control level, factoring in the CSLA authorization behavior, without battling for who is&nbsp;managing each control's Enabled and ReadOnly properties.&nbsp; Maybe I should forgo using CSLA authorization at the control level (no ReadWriteAuthorization extender)?</P>
<P>I am new to CSLA and learning its structure so I may be missing an obvious place/way to plug/build this functionality in.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Friday, June 30, 2006</h2>My ISP Mail Server is "having issues" and is apparently dropping random e-mails to me <br />during the week of 6/26 - 6/30.<br /><br />If you don't receive a timely reply during this period, PLEASE try again OR BETTER YET <br />pick up the phone and call me at 512 255-7566!<br /><br />The ISP is replacing the server on 6/30, so the problem should be gone by next week.<br /><br />FYI, if you are receiving this notice it should mean that I _HAVE_ received the mail <br />message to which this is auto-responding.  But your last few or your next few <br />might be (or might have been) victims.<br /><br />Sorry for the inconvenience.  <br /><br />Q</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 30, 2006</h2>This could be way out there, but would it be possible to override CanWriteProperty and have it fail / return false if the EditLevel is not 0?&nbsp; Whether or not this works will depend on when databinding calls BeginEdit on your object.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Friday, June 30, 2006</h2>Hmmm... I see that CanWriteProperty is virtual and I believe the book talked about overriding this to suit your needs so that makes a lot of sense.&nbsp; I'll try it out.&nbsp; Thanks for the suggestion ajj3085.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 30, 2006</h2>Let us know how this works too; there could be consequences I didn't think about.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jwooley replied on Friday, June 30, 2006</h2><P>I implemented a scheme in 1.x before the current authorization roles scheme came out whereby I have a function on my business object called FieldEditable where I pass the field name in and find out if it is editable or not. In my forms, I create a collection which helps to manage the databindings. I can then call a method to set visible based on the object's editable status and it loops through the control collection setting the enabled property on a per-field basis depending on the FieldEditable value for that field. This was necessary for 2 purposes: As my objects change values (dates) the state changes which changes which fields are then editable, also I had a business rule which allowed for certain users to be able to override values regardless of state.</P>
<P>It is a rather flexible model. I didn't go to the level of checking for FieldEditable on each property set, but that would probably be a bit more robust. I have yet to ponder how it would fit with the new scheme in 2.0 as I'm still stuck in 1.x world having made customizations to the framework and not having the time to retrofit them into 2.x at this point.</P>
<P>Jim Wooley<BR><A href="http://devauthority.com/blogs/jwooley/default.aspx">http://devauthority.com/blogs/jwooley/default.aspx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Friday, June 30, 2006</h2>That sounds very interesting Jim.&nbsp; I'm not familiar with 1.x but from my quick experiments based on ajj3085 comments, I think your scheme would fit nicely right along side the 2.0 authorization roles w/o having to change the frameworks.&nbsp; I don't require the flexiblity your solution provides (yet!) in regards to editability but it is giving me a few ideas to solve some other hurdles I have coming up.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Friday, June 30, 2006</h2>The good news is that overriding the CanWriteProperty (in my BO) does do the trick in the UI.&nbsp; However, I'm not sure how you were proposing to access the EditLevel property.&nbsp; I just used an "editing"&nbsp;property in the BO to test overriding CanWriteProperty, not using EditLevel itself.&nbsp; Were you suggesting a change to the framework itself?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, June 30, 2006</h2>EditLevel is accessible inside your business object... It just doesn't appear in intellisense because it's marked with &lt;EditorBrowsable(EditorBrowsableState.Never)&gt;.<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Friday, June 30, 2006</h2><P>Thanks Xal.&nbsp; Putting it all together, this seems to work pretty good.&nbsp; Here is what I did.&nbsp; I put this in my BO:</P>
<P>&nbsp;&nbsp;public override bool CanWriteProperty(string propertyName)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;if (this.EditLevel &gt; 1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;return base.CanWriteProperty(propertyName);<BR>&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;return false;<BR>&nbsp;&nbsp;}<BR></P>
<P>Add a ReadWriteAuthorization control to the form and set the applicable data entry controls to ApplyAuthorization.&nbsp; Then when I want to enter "Edit" mode, I do a BeginEdit() followed by&nbsp;a call to:</P><FONT size=2>
<P></FONT><FONT size=2>readWriteAuthorization.ResetControlAuthorization();</FONT></P>
<P><FONT size=2><FONT size=3>to refresh/enable the data entry controls.&nbsp; After I ApplyEdit()&nbsp;and save or CancelEdit(), I call ResetControlAuthorization() again to refresh/disabled the controls.</FONT></FONT></P>
<P><FONT size=2><FONT size=3>Although I am not using Authorization roles right now, they should still take effect&nbsp;so proper authorization should remain intact.&nbsp; I think I will consider moving the CanWriteProperty() code above to an abstract class off BusinessBase for this application so similiar BOs can share this behavior.</FONT></FONT></P>
<P><FONT size=2><FONT size=3>Thanks to everyone who chimed in!</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 30, 2006</h2>The button could call BeginEdit, and then you can try calling the bindingsource's ResetBindings or ResetCurrentItem method..<br><br>As I said, there may be problems with the approach I've suggested, I'm not sure others have done this.&nbsp; I would think that the resetting of the bindings would then re-evaluate the ability to read / write properties.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>knute replied on Friday, June 30, 2006</h2><P>ajj3085,&nbsp;I actually am using ResetControlAuthorization() of the ReadWriteAuthorization control to re-evaluate.&nbsp; Does that make sense?</P>
<P>Thanks for your help.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, July 03, 2006</h2>Yes, makes sense to me.. I just read the part of the book on that control and it sounds like that's exactly the way to go.<br><br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
