<html><header><title>3.8 ListChanged vs. 4.1 CollectionChanged</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>3.8 ListChanged vs. 4.1 CollectionChanged</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10560.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DaveStorey posted on Monday, July 25, 2011</h2><p>Hi,</p>
<p>I&#39;m relatively new to CSLA so I apologise in advance has an obvious answer that I am missing.</p>
<p>We have recently moved from v3.8 to v4.1 and in doing so have moved all of our old validation rules to business rules and all of our ListChanged event handles to CollectionChanged event handlers. In doing so we have noticed some odd behaviour whereby if we change a property on a child collection item the CollectionChanged event does not fire.&nbsp;It would appear that the collection changed event does not seem to bubble up to the parent object&nbsp;any more&nbsp;unless there is a change made to the actual collection object.&nbsp;An example being a parent table with child rows:</p>
<p style="padding-left:30px;">Table.OnCollectionChanged += new System.Collections.Specialized.NotifyCollectionChangedEventHandler();</p>
<p style="padding-left:30px;">Table.Add(newRow) - The event fires<br />Table[0].Name = &quot;Bob&quot;; &nbsp;- The event does not fire</p>
<p>It might be worth mentioning at this point we attach our event handlers on both the property setter for our collection and also on the OnDeserialized event for our object.</p>
<p>We have rolled our code back to v3.8 and checked this behaviour and it would seem that the ListChanged event is firing in both the example circumstances.&nbsp;</p>
<p>Is there a new event we should be using instead of CollectionChanged? Or is this new behaviour by design?</p>
<p>Regards,</p>
<p>Dave</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, July 25, 2011</h2><p>The core behavior around ListChanged and CollectionChanged is defined by Microsoft, not CSLA. Because BindingList and ObservableCollection are different types, they have different behavior. And those are the two base classes from which the various CSLA collection types derive.</p>
<p>You might be better off using ChildChanged. This is&nbsp;a CSLA event that bubbles up through the object graph, and should provide consistent behavior for both collection types.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>DaveStorey replied on Tuesday, July 26, 2011</h2><p>Thanks Rocky for the quick response. That ChildChanged event does seem to provide the functionality that we were expecting once we changed our event setters to use the SetProperty rather than LoadProperty.</p>
<p>As a quick side query is there any helper methods to tie a PropertyInfo to the event args returned by the ChildChanged event? I have noticed when manipulating a collection the ChildChanged event is raised 4 times in the following sequence: Count changed, Item[] changed, CollectionChanged and then finally my custom object property changed. Of these I am only interested in the final event as it is going to be used to re-evaluate a business rule. At present my event handler just calls PropertyHasChanged(PropertyInfo) but am worried that this may cause a performance hit to the system dependant on the complexity of the business rule. I want to filter out the event calls that don&#39;t relate to my PropertyInfo but the only way I can see to do this is:</p>
<p style="padding-left:30px;"><span>if (e.PropertyChangedArgs.PropertyName ==&nbsp;</span>MyPropertyInfo<span>.Name)<br />{<br />PropertyHasChanged(</span>MyPropertyInfo<span>);<br />}&nbsp;</span></p>
<p>
<p>Any help or advice would be appreciated,</p>
<p>Dave</p>
</p>
<p style="padding-left:30px;">
<p><span></span></p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, July 26, 2011</h2><p>Hi Dave, </p>
<p>You should implement as you suggested. </p>
<p>Events may occur from several places and your suggestion is the proper way to handle this.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DaveStorey replied on Tuesday, July 26, 2011</h2><p>Thanks guys, appreciate the help</p>
<p>Dave</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 26, 2011</h2><p>You can filter based on the args information provided to your ChildChanged event handler though. For example, when Count has changed maybe you don&#39;t do any work, because that doesn&#39;t affect you.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
