<html><header><title>Async LazyLoad child collection problems WPF/MVVM</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Async LazyLoad child collection problems WPF/MVVM</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10266.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough posted on Friday, April 15, 2011</h2><p>Ref: <a title="http://forums.lhotka.net/forums/p/9824/46131.aspx#46131" href="http://forums.lhotka.net/forums/p/9824/46131.aspx#46131">http://forums.lhotka.net/forums/p/9824/46131.aspx#46131</a></p>
<p>Hi</p>
<p>Background:</p>
<p>We are trying to hook up a UI to a root object with lazy collections.&nbsp; The main UI has a popup UI with a separate ViewModel which is fed the child collection therefore the Model property of the VM is set manually for the child.&nbsp; We want the busy spinner to be inside the child popup view.</p>
<p>&nbsp;</p>
<p>Is there a snippet for the correct way to async lazy load a child object?</p>
<p>When calling OnPropertyChanged(ChildProperty) it marks the root as dirty.&nbsp; I cannot remove this as the test wont know when the property has finished loading.&nbsp; Is there an OnChildLazyLoaded I can call?&nbsp;</p>
<p>Regarding the busy spinner, MarkBusy &amp; MarkIdle must be required but this marks the root as busy not the child collection, so the spinner is in a different context, i.e. the center of the screen not in the center of the popup.</p>
<p>Also it doesn&#39;t work first time in <span class="Apple-style-span" style="border-collapse:separate;color:#333333;font-family:Arial,Helvetica;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;font-size:medium;"><span class="Apple-style-span" style="font-size:12px;">InvalidOperationException<span class="Apple-converted-space">&nbsp;</span></span></span> &quot;Property get not allowed&quot;, similar to : <a>http://forums.lhotka.net/forums/t/10264.aspx</a></p>
<p>Many Thanks</p>
<p>Kevin</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, April 15, 2011</h2><p>OnPropertyChanged doesn&#39;t mark an object as dirty. Only MarkDirty does that. OnPropertyChanged only raises the PropertyChanged event.</p>
<p>There&#39;s no real way to mark the child object as busy, because the whole point is that you are retrieving the child object. It might be busy - but it would be busy on the server as it is being loaded, and the client won&#39;t know one way or the other until it arrives on the client and is set into the property field.</p>
<p>In other words, the only object the client has access to during the load process is the parent object, so that&#39;s the only thing you can mark as busy.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Friday, April 15, 2011</h2><p>My mistake, I&#39;ve found the bug in our code regarding Dirty problem.</p>
<p>What we have done for now is, as we are manually setting the Model property in the ChildViewModel we also manually set the IsBusy in the ChildViewModel this gives us the spinner in the correct place.</p>
<p>For some reason I was under the inpression that OnPropertyChanged for the child list would be fired if and when the list contents change hence we couldn&#39;t use that to tell first load.</p>
<p>Thanks</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Kevin Fairclough replied on Friday, April 15, 2011</h2><p>The InvalidOperationException in GetProperty was a problem with the Getter not returning null after initiating async load call.&nbsp; It was attempting to return a non initialized property, GetProperty(ImagesProperty) see first link REF link for correct way to define lazy async property.</p>
<p>Kevin</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, April 15, 2011</h2><p>I should also point out (shameless plug&nbsp;<img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /> ) that the <em>Using CSLA 4</em> ebook series includes async lazy load code/discussion.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
