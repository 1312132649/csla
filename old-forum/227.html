<html><header><title>How to implement Base class &amp; Sub Classes ...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to implement Base class &amp; Sub Classes ...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/227.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdlc posted on Tuesday, May 30, 2006</h2><P>how can i implement this design using CSLA .NET?</P>
<P>Base Class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub Classes</P>
<P>Person&nbsp;&nbsp;&nbsp;--&gt;&nbsp;&nbsp;&nbsp;&nbsp;Customer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;&nbsp;&nbsp;&nbsp;Employee</P>
<P>Thanks in Advance!</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, June 01, 2006</h2><P><U>Option 1</U><BR>Create abstract base class Person, inherit from BusinessBase.<BR>Create concrete class Customer, inherit from Person.<BR>Create concrete class Employee, inherit from Person.</P>
<P><U>Option 2</U><BR>Create Interface IPerson.<BR>Create concrete class Customer, inherit from BusinessBase, implement IPerson.<BR>Create concrete class Employee, inherit from BusinessBase, implement IPerson.</P>
<P>I'd say that the choice depends on what you are trying to model in your concept of a Person.</P>
<P>What is it that the Person object represents?&nbsp; Does it need behaviour?&nbsp; What can you do with a Person?&nbsp; Do you want to get collections of Person for common processing?</P>
<P>HTH</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>LayeredDev replied on Thursday, June 01, 2006</h2><P>Or</P>
<P><U>Option 3<BR></U>Create&nbsp;concrete class Person.<BR>Create concrete class Customer, containing an object of class Person.<BR>Create concrete class Employee, containing an object of class Person.</P>
<P>If you want a Person to be used without referring to the Person as a Customer or an Employee, the above option may suit you.&nbsp;As David says, it all depends on what you are trying to model in your concept of a Person.</P>
<P>Cosmic Ovungal</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, June 01, 2006</h2>Don't forget option 3:<br>

<br>

IPerson interface<br>

Person abstract class (holds common behaviors, Inherits BusinessBase, implements IPerson, or pieces of it)<br>Customer (inherts Person; overrides functionality, implements abstract functionality not implemented)<br>
Employee( inherits Person, etc etc.)<br><br>Of course this assumes there are common behaviors for Customer and Employee which likely won't change.<br><br>Which option you pick will of course depend on your use cases.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RanceDowner1234 replied on Wednesday, June 07, 2006</h2><P>kdlc.&nbsp; Try the following...</P>
<P>Imports Csla<BR>Imports Csla.Data<BR>Imports Csla.Validation</P>
<P>Imports System.Data.SqlClient '[or whatever database library]</P>
<P>&lt;System.Serializable()&gt; _<BR>Public MustInherit Class Person(Of T As Person(Of T))<BR>&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of T)</P>
<P>&nbsp;&nbsp;&nbsp; 'No Factory Methods </P>
<P>&nbsp;&nbsp;&nbsp; Protected Overridable Sub Fetch(ByVal dr As SafeDataReader)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Fill private Variables<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'e.g. ... _LastName = .GetString("LastName")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; Protected Overridable Sub Update(ByVal cm As SqlCommand)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With cm<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'fill command parameters with values from private variables<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'e.g ... .Parameters.AddWithValue("@LastName", _LastName)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<BR>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>End Class</P>
<P>&lt;System.Serializable()&gt; _<BR>Public Class Customer<BR>&nbsp;&nbsp;&nbsp; Inherits Person(Of Customer)</P>
<P>&nbsp;&nbsp;&nbsp; Protected Overrides Function GetIdValue() As Object<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Return Something<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'e.g. .... Return _CustomerID<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp; 'Factory Methods<BR>&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp; Public Shared Function GetInstance(ByVal id As Integer) As Customer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return DataPortal.Fetch(Of Customer)(New Criteria(id))<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp; 'Data Methods<BR>&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<BR>&nbsp;&nbsp;&nbsp; Private Class Criteria</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private mId As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public ReadOnly Property Id() As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mId<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Sub New(ByVal id As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mId = id<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<BR>&nbsp;&nbsp;&nbsp; End Class</P>
<P>&nbsp;&nbsp;&nbsp; Protected Overrides Sub Fetch(ByVal dr As SafeDataReader)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Call MyBase.Fetch(dr) 'Call Base Class Fetch<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'fill customer variables<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'e.g. _Customer AddressLine1 = .GetString("AddressLine1")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As SqlConnection = New SqlConnection("&lt;insert connection string&gt;")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "[Call a stored Proc]"</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New Data.SafeDataReader(cm.ExecuteReader)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Call Me.Fetch(dr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; Protected Overrides Sub Update(ByVal cm As SqlCommand)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.Update(cm) 'Call Base Class to update it's parameters<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With cm<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Update customer parameters<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'e.g. ... .Parameters.AddWithValue("AddressLine1", _AddressLine1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<BR>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; &lt;Transactional(Csla.TransactionalTypes.Manual)&gt; _<BR>&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Update()</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim cn As SqlConnection&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Instantiate cn ... e.g. ... cn = New SqlConnection("&lt;insert connection string&gt;")<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim trans As SqlTransaction&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trans = cn.BeginTransaction( )</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Me.IsDirty Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "[Call _Update Stored Proc]"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Transaction = trans<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Update(cm)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.ExecuteNonQuery()</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.Commit()</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.Rollback()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw ex<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>End Class</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AndrewCr replied on Friday, August 04, 2006</h2><P>&nbsp; (Sorry to add on to a slightly older thread, but my question is related...)</P>
<P>&nbsp; First off, this bit of code was immensely helpful, thanks.&nbsp; That said, I'm trying to create a collection (list) of base objects.&nbsp; Since the base object is virtual (MustInherit) the objects in the collection will actually be instances of the child classes, but I want to be able to hold them all in the same collection.</P>
<P>&nbsp; When I attempt to declare the list&nbsp;as (for example:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> PersonList<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Inherits</FONT><FONT size=2> BusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> PersonList, Person</FONT><FONT size=2>)</FONT></P>
<P>&nbsp;&nbsp;the compiler&nbsp;wants me to add a type argument to Person.&nbsp; Of course, if I change it to:</P><FONT size=2>
<P><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> PersonList<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Inherits</FONT><FONT size=2> BusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> PersonList, Person(<FONT color=#0000ff>Of</FONT><FONT size=2> Person)</FONT></FONT><FONT size=2>)</FONT></P>
<P><FONT size=3>&nbsp; I'm back where I started, only one level deeper.&nbsp; It will accept:</FONT></P>
<P><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> PersonList<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Inherits</FONT><FONT size=2> BusinessListBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> PersonList, Customer</FONT><FONT size=2>)</FONT></P>
<P><FONT size=3>&nbsp; but that defeats the point, since I want to be able to have other Person child objects in the list as well.&nbsp; Perhaps I just don't understand generics well enough.</FONT></P>
<P><FONT size=3>&nbsp; Any help?</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, August 04, 2006</h2>I'd think you'd need a common interface and have the list accept anything which implements that interface... an IPerson.&nbsp; Of course, your person abstract would implement this interface.&nbsp; The catch is that you must have the IPerson interface implement IEditableBusinessObject, to make the C type parameter on BLB accept it.<br><br>So :<br><br>public interface IPerson : IEditableBusinessObject { <br>// Define your interface; just right click on your Person class and tell it to Extract <br>// interface..tweak to your liking.<br>}<br><br>public abstract Person : BusinessBase&lt;Person&gt;, IPerson {<br>// No changes should be needed here<br>}<br><br>Then your list:<br>public class PersonList : BusinessListBase&lt; PersonList, IPerson&gt; {<br>}<br><br>Sorry for the C#... but I'm don't work in Vb... but I hope it will be clear.<br><br>Let us know if that solves the problem for you.<br><br>Andy<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AndrewCr replied on Friday, August 04, 2006</h2><P>&nbsp; Yes, I think this will work nicely.&nbsp; Thanks very much.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
