<html><header><title>Extending PropertyInfo for custom metadata: Does this look right?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Extending PropertyInfo for custom metadata: Does this look right?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10258.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina posted on Monday, April 11, 2011</h2><p>I want to store data access metadata with my properties in my read only lists which are displayed on a grid and the properties are used to build sql sort and filter based on users choices in the grid.&nbsp; </p>
<p>I used to use attributes in csla 1.x for this but PropertyInfo seems to be the way to go now.</p>
<p>I couldn&#39;t find an example so winged it with a simplified test, does the following look correct?</p>
<p>//Custom property info class</p>
<p>public class ListPropertyInfo&lt;T&gt; : PropertyInfo&lt;T&gt;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string sqlColumnName { get; set; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ListPropertyInfo(string Name, string SqlColumnName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(Name)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sqlColumnName = SqlColumnName;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>//Using it to declare a property in my read only list business object</p>
<p>&nbsp;public static readonly Utility.ListPropertyInfo&lt;string&gt; NameProperty = (Utility.ListPropertyInfo&lt;string&gt;)RegisterProperty(new Utility.ListPropertyInfo&lt;string&gt;(&quot;Name&quot;, &quot;MySqlColumnName&quot;));</p>
<p><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(NameProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { LoadProperty(NameProperty, value); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>//Getting the sql column name information from the property in my business object consuming code</p>
<p>&nbsp;string SqlColumnName = ((Utility.ListPropertyInfo&lt;string&gt;)AddressFieldPickListInfo.NameProperty).sqlColumnName;</p>
<p>&nbsp;</p>
<p>This works but it seems clunky, am I doing this correctly?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, April 11, 2011</h2><p>Hi, </p>
<p>Well - An elegant solution would be to use your own:</p>
<p>* PropertyInfoFactory<br />* PropertyInfo type with a property for SqlColumnName.<br />* a custom SqlColumnAttribute on the property for SqlColumn name.<br /><br />And in the custom propertyInfoFactory read the attribute and set the value into your own PropertyInfo&lt;T&gt; </p>
<p>This is close to how FriendlyName works today - if empty or null try to read the DisplayName attribute on the property.</p>
<p>In CslaContrib you can look at PropertyInformationFactory and PropertyInformationUsingOriginalvalue in CustomFieldData project.</p>
<p>So, your code would look someting like this: </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#a52a2a;">static</span>&nbsp;<span style="color:#a52a2a;">readonly</span>&nbsp;PropertyInfo<span style="color:#006400;">&lt;</span><span style="color:#ff0000;">string</span><span style="color:#006400;">&gt;</span>&nbsp;NameProperty = RegisterProperty<span style="color:#006400;">&lt;</span><span style="color:#ff0000;">string</span><span style="color:#006400;">&gt;(</span>c =<span style="color:#006400;">&gt;</span>&nbsp;c<span style="color:#006400;">.</span>Name<span style="color:#006400;">);</span></p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#006400;">[</span><span style="color:#191970;font-weight:bold;">SqlColumn</span><span style="color:#006400;">(</span><span style="color:#0000ff;">&quot;CustomerName&quot;</span><span style="color:#006400;">)]</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">string</span>&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">get</span>&nbsp;<span style="color:#006400;">{</span>&nbsp;<span style="color:#000080;">return</span>&nbsp;<span style="color:#191970;font-weight:bold;">GetProperty</span><span style="color:#006400;">(</span>NameProperty<span style="color:#006400;">);</span>&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">set</span>&nbsp;<span style="color:#006400;">{</span>&nbsp;<span style="color:#191970;font-weight:bold;">SetProperty</span><span style="color:#006400;">(</span>NameProperty<span style="color:#006400;">,</span>&nbsp;<span style="font-weight:bold;">value</span><span style="color:#006400;">);</span>&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span></p>
<p>and the custom PropertyInfoFactory would look for the SqlColumn attribute&nbsp; to set the custom ListPropertyInfo&lt;T&gt;.SqlColumnName.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Monday, April 11, 2011</h2><p>Hi Johnny, that looks interesting, I&#39;ll definitely keep it in mind however what I actually need to do is much more complex and only applies to my read only lists, everything else can use the native PropertyInfo therefore I&#39;m just trying to determine if this procedure is correct as I outlined it before I get into alternatives.</p>
<p>I&#39;d appreciate it if anyone can confirm that before I get into alternatives.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, April 11, 2011</h2><p>If it&#39;s much more complex then I&#39;d try to use another approach and not put all that into PropertyInfo and rather create your own metadata type and methods in your own ReadOnlyBase intermediate class for exposing it to the UI.&nbsp;</p>
<p>You should still be able to use Attributes on you properties.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Monday, April 11, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>JonnyBee<br></b>If it&#39;s much more complex then I&#39;d try to use another approach and not put all that into PropertyInfo and rather create your own metadata type and methods in your own ReadOnlyBase intermediate class for exposing it to the UI</div></p>
<p>I considered that but Rocky has mentioned previously that one of the possible uses for a custom PropertyInfo class would be to add database column information if that&#39;s a requirement which is exactly what I need to do so it sounds ideal.&nbsp; </p>
<p>It&#39;s not a *lot* more complex than that, basically there is the display and value database column info to associate with the field and also an attribute that suggests how it&#39;s displayed in the UI, i.e. as a link or a button or a text or numeric etc.</p>
<p>This allows me to make a generic grid list UI element that adapts itself to display various lists.&nbsp; I have dozens of different read only lists to display in my app and I fit most of them into one generic grid and just make custom ones for edge cases.</p>
<p><div style='padding-left: 50px;background-color:silver'><b>JonnyBee<br></b>You should still be able to use Attributes on you properties.</div></p>
<p>I used to but I don&#39;t really need to now.&nbsp; It&#39;s not a requirement at all and ultimately I&#39;m going to write code to automatically generate the new code from the old code so it&#39;s not a matter of me *wanting* to use attributes.</p>
<p>Jonny, did you see any glaring mistakes in the code I posted earlier?&nbsp; (I appreciate your suggestions but I&#39;d like to know that first and foremost before I start looking at alternatives just to be sure I&#39;m correct in my understanding of making and using a subclassed PropertyInfo.)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
