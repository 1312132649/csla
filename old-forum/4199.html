<html><header><title>Unable to Pass CSLA object to WCF service</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Unable to Pass CSLA object to WCF service</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4199.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly posted on Saturday, January 19, 2008</h2><P>I have created a wcf service in which I need to pass my CSLA BO (BusinessListBase) to my service. </P>
<P>This is how I'm defining the DataContract and I have also defined my BO as knowntype</P>
<P>&nbsp;</P><FONT size=2><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>KnownType</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>FabAccMainItems</FONT><FONT size=2>))]</P>
<P>[</FONT><FONT color=#2b91af size=2>DataContract</FONT><FONT size=2>(Name=</FONT><FONT color=#a31515 size=2>"RepObject"</FONT><FONT size=2>)] </P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>RepObject</P></FONT><FONT size=2>
<P>{</P>
<P>[</FONT><FONT color=#2b91af size=2>DataMember</FONT><FONT size=2>(Name = </FONT><FONT color=#a31515 size=2>"RepName"</FONT><FONT size=2>, IsRequired = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, Order = 0)]</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> _RepName = </FONT><FONT color=#a31515 size=2>""</FONT><FONT size=2>;</P>
<P></P>
<P>[</FONT><FONT color=#2b91af size=2>DataMember</FONT><FONT size=2>(Name = </FONT><FONT color=#a31515 size=2>"RepParams"</FONT><FONT size=2>, IsRequired = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, Order = 1)]</P>
<P></FONT><FONT color=#2b91af size=2>SortedList</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>&gt; _RepParams = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>SortedList</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>,</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>&gt;();</FONT></P>
<P><FONT size=2>}</P></FONT></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>
<P>Prob is that as soon as the parameter is passed by adding my BO in SortedList _RepParams from calling code and calling the required service, following error is thrown. </P>
<P>&nbsp;</P>
<P>"Insert is an invalid Operation" and following is the stack trace (truncated), I'm surprised why it is going in ReadOnlyBindingList...</P>
<P>&nbsp;&nbsp; at Csla.Core.ReadOnlyBindingList`1.InsertItem(Int32 index, C item) in C:\Dev\Projects\cslacs\cslacs\Csla\Core\ReadOnlyBindingList.cs:line 87<BR>&nbsp;&nbsp; at System.Collections.ObjectModel.Collection`1.Add(T item)<BR>&nbsp;&nbsp; at ReadArrayOfBrokenRuleFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString , XmlDictionaryString , CollectionDataContract )<BR></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, January 20, 2008</h2><P>It isn't clear whether you are trying to serialize an actual CSLA business object, or whether you are doing the right thing and defining a DTO?</P>
<P>You can't directly pass CSLA objects through WCF, just like you can't pass them directly through an asmx Web service.</P>
<P>CSLA uses serialization to do many things, including n-level undo support and data portal support. It requires that serialization create a complete clone of the original object graph.</P>
<P>Unfortunately (and I argued against this), WCF only allows one data contract per object. I'd have preferred at least two (one for external contract use, and one for internal use).</P>
<P>What you need to do is described in the&nbsp;<EM>Using CSLA .NET 3.0</EM> ebook, and is along the same lines as Chapter 11 of <EM>Expert 2005 Business Objects</EM>. </P>
<OL>
<LI>Create&nbsp;a formal contract for your service in the form of either an XSD contract (from which you code-gen a DTO) or a DTO (from which VS will code-gen the XSD). I tend to create the DTO, as that's easiest.</LI>
<LI>Write code in your service implementation to copy data between the DTO and your business object.</LI></OL>
<P>A WCF service is just another type of interface to your application. It is just like a web interface, except that it exposes/consumes XML instead of HTML. But all the same concepts apply - you don't send your real business objects directly to the consumer - you copy their data into the UI format (HTML, XML, XAML, whatever) and send <EM>that</EM> to the consumer.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Sunday, January 20, 2008</h2><P>Appreciate your detailed response on this and I understood the solution, it is a lot of work to accomplish what I want to do.</P>
<P>I will explain little bit more on what exactly I'm doing. WCF service is a&nbsp;special Excel&nbsp;Reporting Engine which I have created (by natively generating excel files not using the COM) and is running on server. Report parameters are passed, if for a particular report the data is already avl in memory then I simply want to pass that BO and generate report from it.</P>
<P>Currently I'm forcing the users to save data first and then they can generate report, if the BO can be passed directly then this gives the added advantage of previewing some special reports without saving it in Database.</P>
<P>But seeing the amount of work involved I guess will stick to the current mechanism only.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
