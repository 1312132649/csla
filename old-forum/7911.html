<html><header><title>Possible problem with LINQ provider</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible problem with LINQ provider</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7911.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael posted on Thursday, October 29, 2009</h2><font face="Tahoma" size="2">I have a Connection class which simply exposes two Guid properties, which are decorated with &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Courier New">[Indexable(IndexModeEnum.IndexModeAlways)]</font>. In the Connections collection I have the following method:<br><br><font face="Courier New">public Connection GetConnection(Guid openingId)<br>{<br>&nbsp;&nbsp;&nbsp; var data = from connection in this<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where connection.OpeningId1 == openingId<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select connection;<br><br>&nbsp;&nbsp;&nbsp; if (data.Count() == 1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return data.First();<br><br>&nbsp;&nbsp;&nbsp; data = from connection in this<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where connection.OpeningId2 == openingId<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select connection;<br><br>&nbsp;&nbsp;&nbsp; return data.FirstOrDefault();<br>}</font><br><br>I'm doing two Linq queries to enable the index to work properly. (I can't do both checks in the same where, correct?) The method always returns <font face="Courier New">null</font>. When I change the condition to </font><font face="Tahoma" size="2"><font face="Courier New">where connection.OpeningId1.Equals(openingId)</font> it works as expected.<br><br>Adding the generic extension method:<br><br><font face="Courier New">public static T Dump&lt;T&gt;(this T instance)<br>{<br>&nbsp;&nbsp;&nbsp; Console.WriteLine(instance); return instance;<br>}</font><br><br>and changing the conditions to </font><font face="Tahoma" size="2"><font face="Courier New">where connection.OpeningIdX.Dump() == openingId.Dump()</font> or </font><font face="Tahoma" size="2"><font face="Courier New">where (connection.OpeningIdX == openingId).Dump()</font> makes it work as expected also.<br><br>Why is it so?<br><br>Regards<br>Michael<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Friday, October 30, 2009</h2>Hi Michael-<br><br>I suspect what is occuring is that the indexer test for equality does not go through an operator overload on == unless the type is primitive.&nbsp; I have seen similar behavior before.&nbsp; I suspect what I need to do is to check to see if == is supported and use that for checking equals.<br><br>I will likely put this on the backlog for updates in the .NET 4 version of CSLA, as there is a simple enough workaround for it.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Friday, October 30, 2009</h2><font face="Tahoma" size="2">Hi Aaron<br><br>Thanks for the reply. Does that really explain how the Dump() extension method fixes it, which simply returns the instance passed in?<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Friday, October 30, 2009</h2>My guess is that using Dump probably moves it out of indexing mode... but it is hard to tell 100% without recreating a scenario.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Friday, October 30, 2009</h2><font face="Tahoma" size="2">That makes sense.</font><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
