<html><header><title>Need help with passing NextResult SafeDataReader to Child Collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need help with passing NextResult SafeDataReader to Child Collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4497.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gorreskime posted on Thursday, March 13, 2008</h2><P><FONT face=Tahoma size=2>I am just getting familiar with the newest framework (3.0) and am having problems with passing the SafeDataReader to my child collection.</FONT></P>
<P><FONT face=Tahoma size=2>I have a simple Client (editable root) that contains Addresses (editable child collection) which contains a collection of Address objects (editable child).</FONT></P>
<P><FONT face=Tahoma size=2>My Client objects DataPortal_Fetch uses a stored proc that returns both the client data and client addresses.</FONT></P>
<P><FONT face=Tahoma size=2>My Code looks like this:</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>Client DataPortal_Fetch method:</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _id = dr.GetInt32("ClientID");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _firstName = dr.GetString("FName");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _lastName = dr.GetString("LName");</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dr.NextResult();</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_addresses = Addresses.GetAddresses(dr);</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>&nbsp;Addresses class GetAddresses method:</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>internal static Addresses GetAddresess(SafeDataReader dr)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new Addresses(dr);<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>When I am in the Client object the SafeDataReader has data after the NextResult. When I check it again in the Addresses class, it is empty.</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>I am guessing it is something silly that I am missing but am stumped.</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>Thanks for any help,</FONT></P>
<P dir=ltr><FONT face=Tahoma size=2>Mike</FONT></P>
<P dir=ltr>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, March 13, 2008</h2>Don't know if this is your problem or not but somewhere after the dr.NextResult(); you are going to need a dr.Read();<br><br><br>Mike<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Thursday, March 13, 2008</h2>Mike,<br><br>Adding to the previous post, you should have at a minimum, the following code in your Addresses class:<br><br><span class="keyword">private New(SafeDataReader dr)<br>{<br>&nbsp;&nbsp;&nbsp; MarkAsChild();<br>&nbsp;&nbsp;&nbsp; Fetch(dr);&nbsp;<br>}</span><br><br>private void Fetch(SafeDataReader dr)<br>{<br>&nbsp;&nbsp;&nbsp; this.RaiseListChangedEvents = false;<br>&nbsp;&nbsp;&nbsp; while (dr.Read()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Add(Addresses.GetAddress(dr));<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; this.RaiseListChangedEvents = true; &nbsp;<br>}<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gorreskime replied on Friday, March 14, 2008</h2><P>John,</P>
<P>I have those methods in my addresses class. When it gets to the "while (dr.Read())" it never gets into the add because there are no records. I have backtracked the location where the SafeDataReader is empty and it is at the boundry between my Client and Addresses classes (the code&nbsp;I posted).</P>
<P>Thanks for the suggestion though.</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Friday, March 14, 2008</h2>Are you certain that your stored proc is returning two results sets? If you run the stored proc in SQL Mgmt Studio you should see two result sets. Let's eliminate the easy stuff first.<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gorreskime replied on Friday, March 14, 2008</h2><P>The SP does return 2 results sets and I an even see the second data set right after I do the dr.NextResult(). By "see" I mean hovering over the object and drilling down to the data. I just loose that data when I check it in the Addresses class.</P>
<P>I've even done:</P>
<P>if (dr.NextResult())</P>
<P>&nbsp;&nbsp;&nbsp;_addresses = Addresses.GetAddresses(dr);</P>
<P>and it does return true and calls the GetAdresses</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gorreskime replied on Friday, March 14, 2008</h2><P><FONT face=Tahoma size=2>Ok. I found something weird. As I step through the code and check the DataSet as&nbsp;I go&nbsp;it looses the data. If I run it without any breaks, it works.</FONT></P>
<P><FONT face=Tahoma size=2>Maybe a bug with VS2008? That would explain why it was so hard to figure out what I did wrong <img src="/emoticons/emotion-4.gif" alt="Stick out tongue [:P]" /></FONT></P>
<P><FONT face=Tahoma size=2>Thanks for everyones help.</FONT></P>
<P><FONT face=Tahoma size=2>Mike</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
