<html><header><title>strange exception with command object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>strange exception with command object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2034.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>andy posted on Wednesday, December 27, 2006</h2><P>I am using the command object to run Interop object on my remote server.</P>
<P>Occassionally I got the exception below:</P><FONT size=2>
<P>System.Runtime.Serialization.SerializationException: The input stream is not a valid binary format. The starting contents (in bytes) are: 3C-68-74-6D-6C-3E-0D-0A-20-20-20-20-3C-68-65-61-64 ...</P>
<P>Server stack trace: </P>
<P>at System.Runtime.Serialization.Formatters.Binary.SerializationHeaderRecord.Read(__BinaryParser input)</P>
<P>at System.Runtime.Serialization.Formatters.Binary.__BinaryParser.ReadSerializationHeaderRecord()</P>
<P>at System.Runtime.Serialization.Formatters.Binary.__BinaryParser.Run()</P>
<P>at System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize(HeaderHandler handler, __BinaryParser serParser, Boolean fCheck, Boolean isCrossAppDomain, IMethodCallMessage methodCallMessage)</P>
<P>at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream serializationStream, HeaderHandler handler, Boolean fCheck, Boolean isCrossAppDomain, IMethodCallMessage methodCallMessage)</P>
<P>at System.Runtime.Remoting.Channels.CoreChannel.DeserializeBinaryResponseMessage(Stream inputStream, IMethodCallMessage reqMsg, Boolean bStrictBinding)</P>
<P>at System.Runtime.Remoting.Channels.BinaryClientFormatterSink.SyncProcessMessage(IMessage msg)</P>
<P>Exception rethrown at [0]: </P>
<P>at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)</P>
<P>at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)</P>
<P>at Csla.Server.IDataPortalServer.Update(Object obj, DataPortalContext context)</P>
<P>at Csla.DataPortalClient.RemotingProxy.Update(Object obj, DataPortalContext context)</P>
<P>at Csla.DataPortal.Update(Object obj)</P>
<P>at Csla.DataPortal.Update[T](T obj)</P>
<P>at Csla.DataPortal.Execute[T](T obj)</P>
<P>at BusinessServerTier.Workorder.Workorder.DoLoad(String shipvoy)</P>
<P>at YMAmerica.Workorder.frmWorkorder.worker_DoWork(Object sender, DoWorkEventArgs e)</P>
<P>at System.ComponentModel.BackgroundWorker.OnDoWork(DoWorkEventArgs e)</P>
<P>at System.ComponentModel.BackgroundWorker.WorkerThreadStart(Object argument)</P>
<P>&nbsp;</P>
<P>Any comment or suggestion how to resolve this issue?</P>
<P>Andy</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 27, 2006</h2>It sounds like you're hitting a problem where the Principal object is not serializable and the thread has switched appdomains (which will be the case if you're remoting host is Cassini; use IIS instead).<br><br>OR.. there could be an assembly version mismatch.<br><br>The easiest thing to do would be to try to open the remoting host with Internet explorer, as you're probably getting HTML back instead of a binary object.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andy replied on Wednesday, December 27, 2006</h2><P>Thank you for quick reply.</P>
<P>I am hosting in IIS running Windows 2K3 using CSLA 2.1</P>
<P>I am not quite sure if it's related to assembly version mismatch, as&nbsp;the problem happens sporadically.</P>
<P>For your suggestion, I don't know how to go about tracing the error via IE.&nbsp; </P>
<P>I just wonder if it has anything to do with timeout session.</P>
<P>I do notice only happened for a long running process session.</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 27, 2006</h2>Well your command object shouldn't be relying on getting the same IIS session, so hopefully you aren't doing that.<br><br>Basically you open IE and give it the same url that you used when configuring remoting.&nbsp; There's also a tool out there, and unfortunately I can't remember the name at the moment, but you launch it and it listens for HTTP traffic between IE and the server, and can save the raw HTML headers out.&nbsp; Hopefully someone knows what I'm talking about..<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andy replied on Wednesday, December 27, 2006</h2><P>I am suppose getting the same IIS session if I am hosting inside IIS.</P>
<P>I am using the same Interop object with my asp.net app and it's working perfectly fine.</P>
<P>Using the same web.config configuration session as follow:</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>sessionState</P></FONT><FONT color=#0000ff size=2>
<P></FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>StateServer</FONT><FONT size=2>"</P></FONT><FONT color=#0000ff size=2>
<P></FONT><FONT color=#ff0000 size=2>stateConnectionString</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>tcpip=localhost:42424</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>timeout</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>60</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt; </FONT></P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P>
<P><FONT color=#0000ff size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, December 28, 2006</h2>This usually happens due to timeouts or when the serialized object is bigger than the default max length.<br><br>In your web.config, create a  &lt;httpRuntime&gt; node inside &lt;system.web&gt;. Set maxRequestLength (in KB) and executionTimeout (in seconds) to whatever suits your needs for httpRuntime.<br><br>I hope it helps.<br><br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, December 28, 2006</h2><P>The tool you are looking for is called Fiddler.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
