<html><header><title>Possible error in ProjectTracker download for Using CSLA 4 MVC?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible error in ProjectTracker download for Using CSLA 4 MVC?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10414.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>correodemarques posted on Friday, June 03, 2011</h2><p>Looking at ProjectResourceEdit.cs on the code download from Using CSLA 4 MVC, the method Child_Update looks like this:</p>
<p>&nbsp;&nbsp;&nbsp; private void Child_Update(ProjectEdit project)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var ctx = ProjectTracker.Dal.DalFactory.GetManager())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dal = ctx.GetProvider&lt;ProjectTracker.Dal.IAssignmentDal&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (BypassPropertyChecks)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var item = dal.Fetch(project.Id, ResourceId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.Assigned = ReadProperty(AssignedProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; item.RoleId = Role;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dal.Update(item);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TimeStamp = item.LastChanged;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>I can see a new Dto being fetched:</p>
<p> var item = dal.Fetch(project.Id, ResourceId);</p>
<p>And then the values from the BO are provided to the Dto. After that the Update method in the Dal is invoked.</p>
<p>What I don&#39;t see is the Dto object getting the TimeStamp value from the BO before the Update. </p>
<p>In the example the value of the LastChanged field on the Dto is the value obtained when the Dto was Fetched right before the Update. I believe that value should be the one in the Business Object which was read it when the Business Object was fetched and therefore represents the moment the user started to modify the values of the BO.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, June 03, 2011</h2><p>Nice catch, thank you!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
