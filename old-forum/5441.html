<html><header><title>Cloning bug in DataPortal?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Cloning bug in DataPortal?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5441.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>GlennMiller posted on Monday, September 22, 2008</h2>In CslaCE.DataPortal.Update about halfway down, there's a try block that calls Clone before calling proxy.Update. The call to Clone crashes in our code because the business object obj doesn't implement IClonable. It looks like the non-mobile code implements IClonable on BusinessBase, but the mobile code doesn't. <br /><br />We could fix it by remembering to manually implement IClonable on all our business objects. Instead we chose to do what Rocky does in 3.5, which is to modify DataPortal.Update to add a check whether obj implements IClonable, and only call Clone() if it does.<br /><br />Does our "fix" to DataPortal.Update make sense, or is the intent for the developer to implement IClonable on every business object?<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lawrencek replied on Tuesday, September 23, 2008</h2><P>yes I think your fix does make sence.&nbsp;</P>
<P>if you can please post the fix I'll update the svn code.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GlennMiller replied on Tuesday, September 30, 2008</h2>Originally the try block mentioned looked like this:<br /><br />try<br />{<br />    // when using local data portal, automatically<br />    // clone original object before saving<br />    obj = ((ICloneable)obj).Clone();<br />    result = proxy.Update(obj, dpContext);<br />}<br /><br />We changed it to this:<br /><br />try<br />{<br />    // when using local data portal, automatically<br />    // clone original object before saving<br />    ICloneable cloneable = obj as ICloneable;<br />    if(cloneable != null)<br />        obj = cloneable.Clone();<br />    result = proxy.Update(obj, dpContext);<br />}<br /> <br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
