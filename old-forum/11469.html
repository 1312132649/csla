<html><header><title>GetPropertyConvert&lt;F, P&gt; with private backing fields.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>GetPropertyConvert&lt;F, P&gt; with private backing fields.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11469.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 posted on Thursday, July 12, 2012</h2><p>I have a property using an enum and an int on the private backing field:</p>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:#2b91af;">TransactionStatusEnum</span>&gt;&nbsp;TransactionStatusProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:#2b91af;">TransactionStatusEnum</span>&gt;(c&nbsp;=&gt;&nbsp;c.TransactionStatusID,&nbsp;<span style="color:#a31515;">&quot;TransactionStatus&quot;</span>,&nbsp;<span style="color:#2b91af;">TransactionStatusEnum</span>.Payment,&nbsp;<span style="color:#2b91af;">RelationshipTypes</span>.PrivateField);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">int</span>&nbsp;_transactionStatusID&nbsp;=&nbsp;(<span style="color:blue;">int</span>)TransactionStatusIDProperty.DefaultValue;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">TransactionStatusEnum</span>&nbsp;TransactionStatus
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;GetPropertyConvert&lt;<span style="color:blue;">int</span>,&nbsp;<span style="color:#2b91af;">TransactionStatusEnum</span>&gt;(TransactionStatusProperty,&nbsp;_transactionStatusID);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;SetPropertyConvert&lt;<span style="color:#2b91af;">TransactionStatusEnum</span>,&nbsp;<span style="color:blue;">int</span>&gt;(TransactionStatusProperty,&nbsp;_transactionStatusID,&nbsp;<span style="color:blue;">value</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;"></pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">My problem arises when I try using the above GetPropertyConvert and SetPropertyConvert.  In the case of the Get property convert, I set the F and P correctly, but the method is expecting the property info to be an int instead of my enum.  Looking at the source:</pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;"><pre style="font-family:Consolas;background:white;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;P&nbsp;GetPropertyConvert&lt;F,&nbsp;P&gt;(PropertyInfo&lt;F&gt;&nbsp;propertyInfo,&nbsp;F&nbsp;field)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;Utilities.CoerceValue&lt;P&gt;(<span style="color:blue;">typeof</span>(F),&nbsp;<span style="color:blue;">null</span>,&nbsp;GetProperty&lt;F&gt;(propertyInfo.Name,&nbsp;field,&nbsp;propertyInfo.DefaultValue,&nbsp;Security.NoAccessBehavior.SuppressException));
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;"></pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;">I am wondering, should the PropertyInfo not be P as the Property is different than the field?</pre>
<pre style="font-family:Consolas;background:white;color:black;font-size:13px;"></pre>
</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, July 13, 2012</h2><p>Yes,</p>
<p>&nbsp;The PropertyInfo should be the type of the private backing field. In Your case <strong>int</strong>. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Friday, July 13, 2012</h2><p>I&#39;ve attempted this without success.&nbsp; GetPropertyConvert is asking that both the field and the propertyinfo be the same type.&nbsp; Even with the different field and property typing.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joemorin73 replied on Friday, July 13, 2012</h2><p>I got this to work by setting the PropertyInfo and RegisterProperty to int as opposed the enum.&nbsp; This just seems strange to me.&nbsp; Should the PropertyInfo be the same type as the property or the backing field?</p>
<p>I was going to say property.&nbsp;&nbsp;But as I&#39;m thinking about it, I suppose the backing field makes sense.&nbsp; I suppose a little clarity would help here.&nbsp; Is the PropertyInfo supposed to reflect the Property or the Field?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, July 14, 2012</h2><p>Usually these are the same, but the PropertyInfo is supposed to reflect the backing field type.</p>
<p>IE: One backing field could be exposed as 2 different data properties, yet share the same backing field.</p>
<p>F.ex a SmartData field may be exposed as both String and DateTime.<br />&nbsp; &nbsp; &nbsp; &nbsp; a ENum field may be exposed as Int or as Enum type. &nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
