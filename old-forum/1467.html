<html><header><title>EditableRootList and EditableChild</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditableRootList and EditableChild</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1467.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>smark posted on Thursday, October 12, 2006</h2>Obviously, I am really getting into these templates Ricky provided, and to be clear, this is my first experience doing code generation.<br><br>I generated an editable root collection from the EditableRootList.cst template and then for a child of this collection, I generated an editable child using the EditableChild.cst template. <br><br>I am getting an error. In the root collection class, the DataPortal_Update method has a loop for child inserts:<br>-------------------------------------<br>foreach (AccessMode child in this)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child.IsNew)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.Insert ( cn );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.Update ( cn );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>-----------------------------------<br><br>In the child of this root collection there is an internal insert method:<br>----------------------------------------------------------------<br>internal void Insert ( SqlConnection cn, AccessModes parent )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!IsDirty) return;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ExecuteInsert ( cn, parent );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld ();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //update child object(s)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UpdateChildren ( cn );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>--------------------------------------------------------------<br><br>As you can see, the Insert method in the child expects two parameters (cn and parent), whereas the insert in root collections' update method is only providing one (cn). For the time being, I have added the 'this' keyword as child.Insert (cn, this). <br><br>I am wondering if the templates need to be updated.<br><br>Thanks.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>paulhumphris replied on Friday, October 13, 2006</h2><P><FONT face=Verdana size=2>I have experienced this problem also.&nbsp; The problem appears to be in the EditableRootList.cst file, you will have to make the changes as follows.</FONT></P>
<P><FONT face=Verdana size=2>Change</FONT></P>
<P class=CodeTextChar><FONT face="Courier New" size=2>&lt;%=Indent(i+1)%&gt;child.Insert(&lt;% if(objInfo.UseAdoTransaction) { %&gt;tr&lt;% } else {%&gt;cn&lt;%}%&gt;);</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>to</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=CodeTextChar><B><FONT size=2><FONT face="Courier New">&lt;%=Indent(i+1)%&gt;child.Insert(&lt;% if(objInfo.UseAdoTransaction) { %&gt;tr&lt;% } else {%&gt;cn&lt;%}%&gt;, this);<o:p></o:p></FONT></FONT></B></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>and also change</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=CodeTextChar><FONT face="Courier New" size=2>&lt;%=Indent(i+1)%&gt;child.Update(&lt;% if(objInfo.UseAdoTransaction) { %&gt;tr&lt;% } else {%&gt;cn&lt;%}%&gt;);</FONT></P>
<P class=MsoNormal><o:p><FONT face=Verdana size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Verdana size=2>to </FONT></P>
<P><B><SPAN>&lt;%=Indent(i+1)%&gt;child.Update(&lt;% if(objInfo.UseAdoTransaction) { %&gt;tr&lt;% } else {%&gt;cn&lt;%}%&gt;, this);</SPAN></B></P>
<P><SPAN>In effect you are simply adding the "this" value into the end of these two lines.</SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>smark replied on Friday, October 13, 2006</h2>Thanks Paul, I will make these changes. I have run into another related problem however; in the child's Insert method where the insert parameters are added to the SQL sproc, the child has the parent's Id (Guid) as a property:<br><br>cm.Parameters.AddWithValue ( "@PermissionCategoryID", _permissionCategoryID );<br><br>This is passing an empty Guid value, so I changed it to<br><br>cm.Parameters.AddWithValue ( "@PermissionCategoryID", parent.PermissionCategoryID );<br><br>Question is: am i missing something in the generated editable child class's xml property set? Do I need to make this change every time I generate an editable child? <br><br>Thanks.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Friday, October 13, 2006</h2>Smark,<br>In your scenario, you need to leave the parent property as blank in EditableChild.<br><br>See my posts at <a HREF="/forums/thread/5082.aspx">http://forums.lhotka.net/forums/thread/5082.aspx</a> to understand when to use parent.<br><br>HTH,<br>Ricky<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
