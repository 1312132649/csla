<html><header><title>Validation.Commonrules decimal type problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation.Commonrules decimal type problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1516.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBergdahl posted on Tuesday, October 17, 2006</h2><P><FONT face=Verdana size=2>I added some validationrules like this:</FONT></P>
<P><FONT size=2><FONT face=Verdana>ValidationRules.AddRule(Csla.Validation.</FONT><FONT face=Verdana><FONT color=#008080>CommonRules</FONT>.MaxValue&lt;<FONT color=#0000ff>decimal</FONT></FONT><FONT face=Verdana>&gt;,&nbsp;<BR>&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT face=Verdana><FONT size=2><FONT color=#0000ff>new</FONT> Csla.Validation.<FONT color=#008080>CommonRules</FONT>.<FONT color=#008080>MaxValueRuleArgs</FONT>&lt;<FONT color=#0000ff>decimal</FONT>&gt;(<FONT color=#800000>"GrossWeight"</FONT>, 99999.99m));</FONT></FONT></P>
<P><FONT face=Verdana><FONT size=2>The code happily compiles and executes until I set the GrossWeight property. It then fails, with an exception with&nbsp;generic description like Unable to set property, that is hiding the real cause of the exception: throw <FONT color=#008080 size=2>ArgumentException</FONT><FONT size=2>(Resources.PrimitiveTypeRequired);</FONT></FONT></FONT></P>
<P><FONT face=Verdana><FONT size=2><FONT size=2>Why isn't decimal supported in the CommonRules class, seems easy enough? <BR></FONT></FONT></FONT><FONT face=Verdana><FONT size=2><FONT size=2>Why is the real exception hidden, making med debug this for 30 minutes before I found out what was wrong?</FONT></FONT></FONT></P>
<P><FONT face=Verdana><FONT size=2><FONT size=2>Regards;<BR>/jb</FONT></FONT></FONT><FONT face=Verdana><FONT size=2><FONT size=2></P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 17, 2006</h2>What is your GrossWeight property type?&nbsp; I've used MinValue for decimal and it works just fine.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, October 18, 2006</h2><P>Not sure what is leading up to the exception during runtime, but the statement you've included does make me wonder if some kind of a Type.IsPrimitive condition is being evaluated (use of Resource.PrimitiveTypeRequired&nbsp;as the exception message).</P>
<P>If this is the case, then the condition will fail for System.Decimal (decimal) because it is not considered a primitive type.&nbsp; See if that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, October 19, 2006</h2><P>As I recall the check for IsPrimitiveType did exist in an older implementation of this rule</P>
<P>But Rocky updated it in 2.1 to this:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> MaxValue(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IComparable)(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> target </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> RuleArgs) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> pi </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> PropertyInfo = target.GetType.GetProperty(e.PropertyName)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(pi.GetValue(target, </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2>), T)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> max </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(e, MaxValueRuleArgs(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)).MaxValue<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> result </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = value.CompareTo(max)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; If</FONT><FONT size=2> result &gt;= 1 </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>e.Description = </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>.Format(</FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.MaxValueRule, e.PropertyName, max.ToString)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>True<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>However, I did a quick test and found a problem with the use of DirectCast. I had a large Integer value that could not be DirectCast to a Decimal value. But CType of the same Integer value to Decimal worked fine. </P>
<P>So I think this is a bug in the latest version which needs to be fixed.</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
