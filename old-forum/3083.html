<html><header><title>BO design to impement n-ary and n-level tree</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BO design to impement n-ary and n-level tree</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3083.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sai posted on Monday, June 25, 2007</h2><P>Hello,</P>
<P>I need&nbsp;help preparing design to implement n-ary and n-level&nbsp;tree retaining all the benefits provided by CSLA framework. All nodes are of the same type say NodeType.</P>
<P>One approach, I think, is&nbsp;create&nbsp;type NodeType : BusinessBase&lt;NodeType&gt;&nbsp;and NodeTypes : BusinessListBase&lt;NodeTypes,NodeType&gt;. NodeType will hold reference to NodeTypes corresponding to it's children and so on.</P>
<P>Another approach is create type NodeType : BusinessBase&lt;NodeType&gt;&nbsp;and NodeTypes : BusinessListBase&lt;NodeTypes,NodeType&gt;. NodeType will hold array of ids corresponding to it's children and all queries to retrieve hierarchical information will answered by NodeTypes object. With this approach each hierarchy will have single NodeTypes object.</P>
<P>Also I don't want to use lazy loading as I am required to retrieve information about entire hierachy in single request.</P>
<P>And most important is that I want to retain all the benefits of CSLA framework. Which of the above approach will satisfy this or is there any better one.</P>
<P>Thanks</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Monday, June 25, 2007</h2>Our project involves n-level assemblies for fabrication in a shop. We chose to have each node in our assembly contain a variable of the nodes collection. This gives us the structure that is needed in most use cases.<br><br>Some of our use cases work better with a flat list of the nodes. We have a shared method on the Node class that takes a node and returns a flat list of the nodes.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>josh.kodroff replied on Tuesday, June 26, 2007</h2>Sai,<br><br>Interestingly enough, I just had to do this myself.&nbsp; While I've only gotten fetching done (correctly), here's what I've come up with:<br><br>First off, I'm using a (simplified) table structure like this:<br>Tree: tree_id, tree_name<br>Tree_Node: tree_node_id, tree_node_name, tree_node_parent_id (null when the node is the root)<br><br>With this table structure, you can retrienve all nodes of a tree in a single query.&nbsp; Round trips to the DB server are very expensive.<br><br>and an object structure like this:<br><br>Class Tree<br>&nbsp;&nbsp;&nbsp; mName as string<br>&nbsp;&nbsp;&nbsp; mRoot as TreeNode<br><br>Class TreeNode<br>&nbsp;&nbsp;&nbsp; mParent as TreeNode &lt;- Very important!&nbsp; Make sure you mark this one as &lt;NonSerialiable&gt; &lt;NotUndoable&gt; or you'll get an infinite loop when the framework tries to copy state.&nbsp; You'll also need to write code for the Deserialization event.<br>&nbsp;&nbsp;&nbsp; mChildren as TreeNodeList<br><br>I'm using the CSLA templates as the basis for my classes.<br><br>When I'm fetching, the Tree class executes an sproc that does this:<br>select * from tree where tree_id = @x<br>select * from tree_node where tree_id = @x<br><br>Then I pass a datatable (not a datareader) to the root.&nbsp; The fetch for the children should have a signature of (dt as DataTable, parent as TreeNode).<br><br>The root knows it's parent is nothing, so it looks for the row where tree_node_parent_id is null.<br><br>Then, for each row where tree_node_parent_id = Me.mParentId, I create a new TreeNode, but you need to be careful to mark the row as deleted as you cycle through the list, or you can get stuck in an infinite loop, reading the same children over and over since this is an n-ary tree.<br><br>For writing to the db, I plan to use a function that returns the nodes as a datatable, copying the IsNew and IsDirty fields so that the Tree class can write the nodes to the db.<br><br>Does that help?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sai replied on Friday, June 29, 2007</h2><P>Josh, Thanks.</P>
<P>I&nbsp;have started working on my second approach and although this means that I have flattened the tree, hierarchy get build the way you are&nbsp;doing. Your explanation helped lot. </P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
