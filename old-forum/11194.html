<html><header><title>Criteria values don't appear to be making it from WP7 to server</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Criteria values don't appear to be making it from WP7 to server</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11194.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>itogroup posted on Friday, February 24, 2012</h2><p>After making sure everything inherits from a CSLA base class and has a parameterless constructor, I finally seem to have a working link from WP7 to the server! The only problem is that my DataPortal_Fetch methods aren&#39;t getting the values that are set in the criteria object. Specifically:</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; internal static void BeginGetStaff(string username, string password, EventHandler&lt;DataPortalResult&lt;HarldIdentity&gt;&gt; callback)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StringStringCriteria criteria = new StringStringCriteria(username, password);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DataPortal.BeginFetch&lt;HarldIdentity&gt;(criteria, (o, e) =&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (e.Error != null) throw e.Error;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; callback(o, e);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private void DataPortal_Fetch(StringStringCriteria criteria)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (String.IsNullOrEmpty(criteria.Value1))<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; throw new ArgumentNullException(&quot;username&quot;);</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [...]<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; [Serializable()]<br />&nbsp;&nbsp;&nbsp; public class StringStringCriteria : CriteriaBase&lt;StringStringCriteria&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public /*readonly*/ string Value1 { get; set; }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public /*readonly*/ string Value2 { get; set; }<br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public StringStringCriteria() { }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public StringStringCriteria(string value1, string value2)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Value1 = value1;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Value2 = value2;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>Before calling BeginFetch, the criteria object has its values set, but the ArgumentNullException in DataPortal_Fetch keeps getting thrown and sent back to the phone.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, February 24, 2012</h2><p>You must use managed backing fields for your properties for them to automatically serialize. In other words, standard RegisterProperty style property declarations as shown in the <em>Using CSLA 4</em> books.</p>
<p>The data portal uses the MobileFormatter to serialize objects over the network, including the criteria object. The MobileFormatter can only serialize registered properties automatically.</p>
<p>Another alternative is for you to override OnGetState/OnSetState and manually insert/remove the field values from the serialization stream. This is discussed in the <em>Using CSLA 4: Data Portal Configuration</em> book.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>itogroup replied on Friday, February 24, 2012</h2><p>As always Rocky, you&#39;re a sanity saver! I&#39;m still so used to the CSLA 2 and CSLA 3 style declarations. Looks like I <i>really</i> should have read the Data Portal Configuration book.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
