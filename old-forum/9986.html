<html><header><title>CSLA4 SL: MobileDictionary crashes when keys are business objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA4 SL: MobileDictionary crashes when keys are business objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9986.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cuong posted on Wednesday, January 26, 2011</h2><p>Hi Rocky,</p>
<p>I use MobileDictionary like below. Please notice the class Key drives from ReadOnlyBase.</p>
<p>[Serializable]<br />public class Data : ReadOnlyBase&lt;Data&gt;<br />{<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;MobileDictionary&lt;Key, string&gt;&gt; DicProperty = RegisterProperty&lt;MobileDictionary&lt;Key, string&gt;&gt;(x =&gt; x.Dic);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public MobileDictionary&lt;Key, string&gt; Dic<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; var value = ReadProperty(DicProperty);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (value == null)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; value = new MobileDictionary&lt;Key, string&gt;();<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LoadProperty(DicProperty, value);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return value;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />...</p>
<p>}</p>
<p>When I run the app and get Data from the server the app throws an exception:</p>
<p>System.ArgumentException: An item with the same key has already been added.<br />&nbsp;&nbsp; at System.ThrowHelper.ThrowArgumentException(ExceptionResource resource)<br />&nbsp;&nbsp; at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)<br />&nbsp;&nbsp; at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)<br />&nbsp;&nbsp; at Csla.Core.MobileDictionary`2.Csla.Serialization.Mobile.IMobileObject.SetChildren(SerializationInfo info, MobileFormatter formatter)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.DeserializeAsDTO(List`1 deserialized)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(List`1 data)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(XmlReader reader)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(Stream serializationStream)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)</p>
<p>&nbsp;</p>
<p>I created a sample to illustrate the issue. You can download it from the link</p>
<p>http://www.mediafire.com/?wrin747gca2lx2a</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, January 26, 2011</h2><p>That isn&#39;t a supported scenario, sorry.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
