<html><header><title>Abstract Base class Factory methods</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Abstract Base class Factory methods</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/258.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DamReev posted on Friday, June 02, 2006</h2><P>I have the following classes:</P>
<P><CODE>
<DIV><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>public</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>enum</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>ActivityType</FONT><FONT size=2><FONT color=#000000> {Meeting, Call, Reminder}</FONT></P></FONT><FONT color=#0000ff size=2>
<P>public</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>abstract</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>Activity</FONT><FONT color=#000000 size=2>: </FONT><FONT color=#008080 size=2>BusinessBase</FONT><FONT color=#000000 size=2>&lt;</FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2><FONT color=#000000>&gt; { </FONT></P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ActivityType</FONT><FONT size=2> ActivityType { </P>
<P></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2> {</FONT><FONT color=#008000 size=2>/*...*/</FONT><FONT size=2>} </P>
<P></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2> {</FONT><FONT color=#008000 size=2>/*...*/</FONT><FONT size=2>} </P>
<P>}</P>
<P></FONT><FONT color=#008000 size=2>//....</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>//Factory Methods</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2> GetActivity(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> activityId){</P>
<P></FONT><FONT color=#008000 size=2>//Need to return activity based on ActivityType which is stored in the database</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>//Want to be able to do something like the following</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>DataPortal</FONT><FONT size=2>.Fetch&lt;</FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Criteria</FONT><FONT size=2>(activityId));</P>
<P>}</P>
<P></FONT><FONT color=#008000 size=2>//Data Access</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Criteria</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>CriteriaBase</FONT><FONT size=2> {</FONT><FONT color=#008000 size=2>/*...*/</FONT><FONT size=2> }</P>
<P>} </P></FONT><FONT color=#0000ff size=2>
<P>public</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>Meeting</FONT><FONT color=#000000 size=2>: </FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2><FONT color=#000000> { } </FONT></P></FONT><FONT color=#0000ff size=2>
<P>public</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>Call</FONT><FONT color=#000000 size=2>: </FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2><FONT color=#000000> { } </FONT></P></FONT><FONT color=#0000ff size=2>
<P>public</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT color=#000000 size=2> </FONT><FONT color=#008080 size=2>Reminder</FONT><FONT color=#000000 size=2>: </FONT><FONT color=#008080 size=2>Activity</FONT><FONT size=2><FONT color=#000000> { } </FONT></P></FONT></FONT>
<P><FONT size=2>How would I do this in CSLA considering the fact that I won't know the type of the activity until I hit the database an retrieve ActivtyType? Am I to assume I can't use the DataPortal to do this for me, and will have to use a switch statement to call&nbsp;the specific factory methods? </P></FONT></CODE></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, June 02, 2006</h2>Well, you're kind of missing the point of strong typing.<br><br>First of all in order to avoid trouble you should declare activity like:<br><br><font color="#0000ff" size="2"><font color="#0000ff" size="2">public</font><font color="#000000" size="2"> </font><font color="#0000ff" size="2">abstract</font><font color="#000000" size="2"> </font><font color="#0000ff" size="2">class</font><font color="#000000" size="2"> </font><font color="#008080" size="2">Activity</font><font color="#000000" size="2">&lt;T&gt;: </font><font color="#008080" size="2">BusinessBase</font><font color="#000000" size="2">&lt;</font><font color="#008080" size="2">T</font><font size="2"><font color="#000000">&gt; where T: Activity<br><br>and then you declare the derived classes like:<br>public class Remainder : Activity&lt;Remainder&gt;<br><br>Now, I'll assume that the user doesn't know / interact with the id, so you need to somehow provide of a way to abstract that from him, and while doing so, you could also handle the activity type issue.<br><br>So, suppose you have a readonly list of activities. And the readonly items have the id, the activity type and whatever other field you want to display in a list. So, from this point, there are two nice ways of doing this:<br>a) Create a method inside the readonly activity class like <br>object GetActivity()<br>{<br>&nbsp;&nbsp;&nbsp; switch (this._activityType)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  case ActivityTypes.Remainder:<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  return Remainder.GetRemainder(this._id);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  ...<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br><br>b) Create a method inside the activity class that takes the readonly item as param, which would finally call the factory methods in the actual classes.<br><br>Now, that is a way to solve it, although I'm not very fond of that, since you're not returning a strongly typed object. Another problem with that is that you're likely to use different UI logic for each type and that you'll need a lot of type checking too.<br><br>Andrés<br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DamReev replied on Monday, June 05, 2006</h2><P><FONT face=Georgia>Thanks for the response.</FONT></P>
<P><FONT face=Georgia>From what you have said it seems that I'm pretty much going to be forced to create all my activities on the client, which isn't a big deal now (everything is happening locally now in our application), but it takes away from one of the reasons we chose to use CSLA (flexibility for the future).</FONT></P>
<P><FONT face=Georgia>Also declaring: </FONT></P>
<P><FONT size=2><FONT face=Georgia><FONT color=#0000ff>public</FONT><FONT color=#000000> </FONT><FONT color=#0000ff>abstract</FONT><FONT color=#000000> </FONT><FONT color=#0000ff>class</FONT><FONT color=#000000> </FONT><FONT color=#008080>Activity</FONT><FONT color=#000000>&lt;T&gt;: </FONT><FONT color=#008080>BusinessBase</FONT><FONT color=#000000>&lt;</FONT><FONT color=#008080>T</FONT><FONT color=#000000>&gt; where T: Activity</FONT></FONT></FONT></P>
<P><FONT face=Georgia size=2>Is actually pretty hard to deal with since it propagates generics all over the object model, but I think I can get around this with an IActivity interface, my only problem is that as you guessed I will have a list of activities; however, this list is read-write since the user can create new activities. I'm now pretty much stuck to have to make IActivity inherit from <FONT color=#008080 size=2>IEditableBusinessObject<FONT color=#000000> but thats fine again.</FONT></FONT></FONT></P>
<P><FONT face=Georgia size=2><FONT color=#008080 size=2><FONT color=#000000>I still feel there should be a way for me to do the object type determination on the serverside dataportal, but I understand the type issues that this causes.</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, June 05, 2006</h2>I am aware that you will be creating new activities, but that doesn't neccesarily mean that the list should be editable. This is a very common topic. You see, editable objects generally have child objects, and are much bigger than readonly objects, so you typically want to avoid loading such big complex lists of objects and instead provide a speedy flat dumb readonly list.<br><br>That said, if your requirement is that the changes to the entire list live inside one transaction and either everything gets commited or nothing, then you probably do need an editable root collection. If that is not your requirement, then consider taking the first approach. It'll save you a few headaches and the overall performance most likely will be better.<br><br><br>One question: Are your activities so different that they need to be different types? Is their behaviour or the data they contain very different?<br><br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DamReev replied on Monday, June 05, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>xal:</strong></div><div>I am aware that you will be creating new activities, but that doesn't neccesarily mean that the list should be editable. This is a very common topic. You see, editable objects generally have child objects, and are much bigger than readonly objects, so you typically want to avoid loading such big complex lists of objects and instead provide a speedy flat dumb readonly list.<BR><BR>That said, if your requirement is that the changes to the entire list live inside one transaction and either everything gets commited or nothing, then you probably do need an editable root collection. If that is not your requirement, then consider taking the first approach. It'll save you a few headaches and the overall performance most likely will be better.<BR></div></BLOCKQUOTE><BR></P>
<P><FONT face=Georgia>You make a very compelling point, about the readonly list. So how would I go about adding an object to a list once the user has created a new activity. Would I basically set <FONT color=#000000>IsReadOnly</FONT> = <FONT color=#000080>false </FONT><FONT color=#000000>and then add the object and then set the property back to true. A readonly list does make sense to me to a degree since the user isn't actually modifying the list directly when they add or delete items. Any guidance is appreciated (I'm sure you can tell I'm a CSLA newbie).</FONT></FONT></P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>xal:</strong></div><div>-<BR>One question: Are your activities so different that they need to be different types? Is their behaviour or the data they contain very different?<BR><BR><BR>Andrés<BR></div></BLOCKQUOTE></P>
<P><FONT face=Georgia>Yes it turns out that most of our different activity types actually live in different database tables and they all have different business rules. I've already flattened the structure since we have subtypes of most of the other activies i.e. Meeting has meeting subtypes such as Personal, Client Meeting, or ProspectMeeting... all these meetings require different kinds of attendees.</FONT></P>
<P><FONT face=Georgia>By the way, Generics did complicate things a bit to where I can't fetch an activity with a static:</FONT></P><FONT face=Georgia><FONT color=#000000><FONT color=#008080 size=2>
<P>IActivity Activity&lt;T&gt;</FONT><FONT size=2>.GetActivity(</FONT><FONT color=#0000ff size=2>long</FONT><FONT size=2> activityId) {...}</FONT></P>
<P><FONT size=2>since i don't know T when I invoke the method.</FONT></P>
<P><FONT size=2>So I've created an ActivityFactory class that will hit the DB figure out the activity type and pass the DataReader to the concrete Meeting, Call, or Reminder's static GetInstance(<FONT color=#008080 size=2>IDataReader <FONT color=#000000>reader) method</FONT></FONT>&nbsp;.&nbsp; So its coming along.&nbsp; </FONT></P>
<P><FONT size=2>Thanks for the help.</P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, June 05, 2006</h2>About refreshing the list you can<br>a) Reload from the db.<br>b) You can use something like the observer's channel events. (read more about observer in http://csla.kozul.info/) (And no, observer does not require that you use active objects)<br><br>Hm... ActivityFactory class sounds like a very good idea to me...<br><br>Andrés<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
