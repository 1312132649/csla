<html><header><title>Connection to Oracle </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Connection to Oracle </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4031.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash posted on Thursday, December 13, 2007</h2><P>I have been asked to conevert our solution from SQL Server to Oracle 10g. I have converted the database but I now need to get CSLA to connect to it. The settings I have in the App.Config is:</P>
<P><FONT color=#0000ff size=2>&lt;add key="Authentication" value="PrimeWorks" /&gt;<BR>&lt;add key="DB:PrimeWorks" value="data source=DevServer;initial catalog=PrimeWorks;user id=pwn_db;password=XYZ" /&gt;<BR>&lt;add key="DB:Security" value="data source=DevServer;initial catalog=PrimeWorks;user id=pwn_db;password=XYZ" /&gt;</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Can anyone&nbsp;help?</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>PS I don't really know much about CSLA as the code was written by someone else. </FONT></P>
<P><BR></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 13, 2007</h2>You'll have to look in the DataPortal_xxx methods, and see what they are using to do data access.&nbsp; If they're using SqlCommand, SqlDataReader, etc. you have a bit of work to do.<br><br>Mainly though, it will involve changing SqlCommand to IDataCommand and such.&nbsp; Or OracleCommand if you're moving to Oracle and leaving MS Sql.&nbsp; <br><br>Note that changing database's should affect any code outside the DataPortal_xxx methods and&nbsp; your UI should work the same as well.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2><P>Thanks for the prompt reply.</P>
<P>Having never connected to an Oracle database before, I am SQL Server kind of guy, this is new territory for me.</P>
<P>We have clients that use SQL Server and some who use Oracle, I was hoping that ADO would hide the actual database type and we could have only one C# Codebase. Is this achieavable?</P>
<P>Does the connection string:</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Authentication</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>PrimeWorks</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>DB:PrimeWorks</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>data source=DevServer;initial catalog=PrimeWorks;user id=pwn_db;password=XYZ</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>DB:Security</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>data source=DevServer;initial catalog=PrimeWorks;user id=pwn_db;password=XYZ</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P></FONT>
<P>in the App.Config remain the same?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, December 13, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Rick Nash:</strong></div><div>
<P>We have clients that use SQL Server and some who use Oracle, I was hoping that ADO would hide the actual database type and we could have only one C# Codebase. Is this achieavable?</P>
<P></div></BLOCKQUOTE></P>
<P>It really depends on how it was written.&nbsp; Is it using stored procedures or sql statements?&nbsp; Was it using a ConnectionManager class of sorts to abstract the database?&nbsp; Does it use SqlClient.SqlCommand or does it work with the IDbCommand interfaces?&nbsp; I am guessing if this wasn't thought about when the application was originally written my guess would be no.&nbsp; </P>
<P>In my applications, I have written a ConnectionManager dll that abstracts what type of database the application is talking to.&nbsp; So it is possible.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2>Luckily its all stored procs but I guess some&nbsp;kind of connection manager is required, as per you suggestion. Its going to be a real pain and not very interesting.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, December 13, 2007</h2><P>Rick,</P>
<P>I supported both SQL Server and Oracle for many years.</P>
<P>I added a DBType to my config file so that I could tell which one I was supposed to use. Then I used the correct connection string:<BR><FONT color=#0000ff size=2>&lt;!--</FONT><FONT color=#008000 size=2> &lt;add key="DBType" value="Oracle" /&gt; </FONT><FONT color=#0000ff size=2>--&gt;<BR>&lt;!--</FONT><FONT color=#008000 size=2> &lt;add key="ConnectionString" value="data source=myOracleDB;uid=myUser;password=myPwd" /&gt; </FONT><FONT color=#0000ff size=2>--&gt;</P>
<P>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>DBType</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>SQL Server</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>ConnectionString</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>data source=myServer;database=myDB;uid=myUser;password=myPwd;connection timeout=50</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P></P></FONT></FONT>
<P>My ADO.Net code was abstracted to use the interfaces like <FONT size=2>IDbConnection and IDataReader.</P>
<P></FONT>When the app starts it reads the config file and then knows which DBType to use.</P>
<P>There is code to branch based on DBType so it creates the correct object.</P>
<P>e.g. It creates a SqlConnection when DBType is SQL Server and creates an OracleConnection when DDBType is Oracle. The method returns an IDbConnection which can hold either of the 2 concrete objects.</P>
<P>I dislike Oracle very much. I jumped for joy when told this year that we can stop supporting it.</P>
<P>You are fairly lucky that you are on a newer version becasue at least the SQL commands are 98% the same as SQL Server. Oracle did not support JOIN syntax until recently so you had to use older style operators.</P>
<P>Oracle Stored Procedures are nothing like SQL Server SPs. I took me whole lot of digging to figure out how to return a result set from an Oracle SP. Hint: you don't just call the SP.</P>
<P>There are other quirks that you will likely run into. As I recall Oracle DB tables do not support Bit fields so your True/False code could be an issue. I tweaked stuff to support this.</P>
<P>If you get the whole thing done in 3 weeks you deserve major kudos. I would have said 3 months.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Hi Joe<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I thought the big job would be porting the Oracle database from
SQL Server, as it turns out this was pretty painless. I managed to download a
free tool to do it <a href="http://www.swisssql.com/">http://www.swisssql.com/</a>.
The biggest problem seems to be getting Oracle on to Vista, currently it&#8217;s
on an XP box.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I used Oracle years ago and hated it then, it seems that not
much has changed.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Best regards<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rick nash<o:p></o:p></span></p>

<p class=MsoNormal><b><span><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b><span>Manor House Computing Ltd.<o:p></o:p></span></b></p>

<p class=MsoNormal><span>Software Solutions &amp; IT Consultancy<o:p></o:p></span></p>

<p class=MsoNormal><span>01794 340677 (W)<o:p></o:p></span></p>

<p class=MsoNormal><span>07791 498004 (M)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> JoeFallon1 [mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> 13 December 2007 15:48<br>
<b>To:</b> ricknash@mhcltd.net<br>
<b>Subject:</b> Re: [CSLA .NET] Connection to Oracle<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Rick,<o:p></o:p></p>

<p>I supported both SQL Server and Oracle for many years.<o:p></o:p></p>

<p>I added a DBType to my config file so that I could tell which one I was
supposed to use. Then I used the correct connection string:<br>
<span>&lt;!--</span><span> &lt;add key=&quot;DBType&quot; value=&quot;Oracle&quot;
/&gt; </span><span>--&gt;<br>
&lt;!--</span><span> &lt;add
key=&quot;ConnectionString&quot; value=&quot;data
source=myOracleDB;uid=myUser;password=myPwd&quot; /&gt; </span><span>--&gt;<o:p></o:p></span></p>

<p><span>&lt;</span><span>add</span><span> </span><span>key</span><span>=</span><span>&quot;<span>DBType</span>&quot;<span> </span><span>value</span><span>=</span>&quot;<span>SQL Server</span>&quot;<span>/&gt;<br>
&lt;</span><span>add</span><span> </span><span>key</span><span>=</span><span>&quot;</span><span>ConnectionString</span><span>&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;</span><span>data source=
myServer;database=myDB;uid=myUser;password=myPwd;connection timeout=50</span><span>&quot;</span><span> /&gt;<o:p></o:p></span></span></p>

<p>My ADO.Net code was abstracted to use the interfaces like <span>IDbConnection and IDataReader.<o:p></o:p></span></p>

<p>I dislike Oracle very much. I jumped for joy when told this year that we can
stop supporting it.<o:p></o:p></p>

<p>You are fairly lucky that you are on a newer versin becasue at least the SQL
commands are 98% the same as SQL Server. Oracle did not support JOIN syntax
until recently so you had to use older style operators.<o:p></o:p></p>

<p>Oracle Stored Procedures are nothing like SQL Server SPs. I took me whole
lot of digging to figure out how to return a result set from an Oracle SP.
Hint: you don't just call the SP.<o:p></o:p></p>

<p>There are other quirks that you will likely run into. As I recall Oracle DB
tables do not support Bit fields so your True/False code could be an issue. I
tweaked stuff to support this.<o:p></o:p></p>

<p>If you get the whole thing done in 3 weeks you deserve major kudos. I would
have said 3 months.<o:p></o:p></p>

<p>Joe<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, December 13, 2007</h2><P>Your biggest problem is going to be getting the Recordsets out of the oracle procedures.&nbsp; You are going to have to create a refcursor&nbsp;in order to get the record set out of the Oracle procedure.&nbsp; When you do this the refCursor is going to be a parameter when calling the stored procedure, this is going to give you fits if you want to use the same class for Sql Server and Oracle.&nbsp; This is why I created a ConnectionManager to abstract adding the refcursors to the list of parameters of the stored procedure.&nbsp; I have attached some code snippets that should help show you what I am doing.&nbsp; Hopefully it will help.</P>
<P>&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Hi<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I thought the big job would be porting the Oracle database from
SQL Server, as it turns out this was pretty painless. I managed to download a
free tool to do it <a href="http://www.swisssql.com/">http://www.swisssql.com/</a>.
The biggest problem seems to be getting Oracle on to Vista, currently it&#8217;s on
an XP box.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I used Oracle years ago and hated it then, it seems that not
much has changed.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The code snippets seemed not to be attached, could you send them
again.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Still it&#8217;s a good learning experience!!!<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Best regards<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rick nash<o:p></o:p></span></p>

<p class=MsoNormal><b><span><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b><span>Manor House Computing Ltd.<o:p></o:p></span></b></p>

<p class=MsoNormal><span>Software Solutions &amp; IT Consultancy<o:p></o:p></span></p>

<p class=MsoNormal><span>01794 340677 (W)<o:p></o:p></span></p>

<p class=MsoNormal><span>07791 498004 (M)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> mr_lasseter [mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> 13 December 2007 16:00<br>
<b>To:</b> ricknash@mhcltd.net<br>
<b>Subject:</b> Re: [CSLA .NET] Connection to Oracle<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Your biggest problem is going to be getting the Recordsets out of the oracle
procedures.&nbsp; You are going to have to create a refcursor&nbsp;in order to
get the record set out of the Oracle procedure.&nbsp; When you do this the
refCursor is going to be a parameter when calling the stored procedure, this is
going to give you fits if you want to use the same class for Sql Server and
Oracle.&nbsp; This is why I created a ConnectionManager to abstract adding the
refcursors to the list of parameters of the stored procedure.&nbsp; I have
attached some code snippets that should help show you what I am doing.&nbsp;
Hopefully it will help.<o:p></o:p></p>

<p>&nbsp;<o:p></o:p></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, December 13, 2007</h2><P>The attachment appears for me.&nbsp; Let me try it again.</P>
<P>&nbsp;</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Hi<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Sorry found it on the Forum, I thought it was attached to my
email.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Best regards<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rick nash<o:p></o:p></span></p>

<p class=MsoNormal><b><span><o:p>&nbsp;</o:p></span></b></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> mr_lasseter [mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> 13 December 2007 16:17<br>
<b>To:</b> ricknash@mhcltd.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: Connection to Oracle<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>The attachment appears for me.&nbsp; Let me try it again.<o:p></o:p></p>

<p>&nbsp;<o:p></o:p></p>

<p>Mike<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 13, 2007</h2>I'd think that Oracle would require a different connection string.<br><br>Ado.Net can hide the actual database, but you have to stick to using interfaces, IDataCommand instead of OracaleCommand or SqlCommand.&nbsp; You'll have to dig into the code, the connection strings won't help you figure out what you need to do.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, December 13, 2007</h2><P>First, your conneciton string is not correct.&nbsp; Data Source should be the name of the database, there is no such thing as initial catalog.</P>
<P>Other question, can you connect to the database using sqlplus?&nbsp; If not then you are&nbsp;going to need the Oracle client installed on your machine and the tnsnames.ora file setup correctly.&nbsp; </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rick Nash replied on Thursday, December 13, 2007</h2><P>I have the database ported to Oracle and I can run SQL Plus, its not as easy to use as SQL Server.</P>
<P>I have also&nbsp;routed through the code and I can see that I need some #defines</P>
<P>#if ORACLE</P>
<P>#if SQL Server</P>
<P>I managed to get this info as well </P>
<P class=MsoNormal><SPAN><A href="http://www.connectionstrings.com/?carrier=oracle">http://www.connectionstrings.com/?carrier=oracle</A></SPAN><SPAN><o:p></o:p></SPAN></P>
<P>I think my initial estimate of 3 weeks may not be correct, I am sure this was much easier back in the bad old days of ODBC and ADO (not ADO.Net)!!</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
