<html><header><title>Unable to set field values when deployed to server</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Unable to set field values when deployed to server</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11881.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TNRollingStone posted on Thursday, March 14, 2013</h2><p>I have an ASP.NET MVC 3/4 application that is using CSLA for a portion of our business logic. &nbsp;The permissions to read/write are handled through AD by a domain account, the same account as the&nbsp;Application&nbsp;Pool Identity and .NET&nbsp;Impersonation&nbsp;user. &nbsp;When testing on my local machine, the validation runs perfectly. &nbsp;Once the application is deployed to one of our test environments (dev or qa) I receive&nbsp;exceptions&nbsp;that seem to point to permissions. &nbsp;I&#39;ve verified that the username being used by the assembly is indeed the correct user, but have been unable to set the values of any of the fields due to not having the appropriate permissions. &nbsp;Anyone experienced anything like this before?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, March 14, 2013</h2><p>Are you reloading the correct principal/identity object into memory on each callback to the web server? This would normally be done with a bit of code in global.asax.cs, and is discussed in the &#39;Using CSLA 4&#39; ebook series as well as previous CSLA books.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TNRollingStone replied on Thursday, March 14, 2013</h2><p>This is my first journey into CSLA and was told that I should be able to just use the DLL from our company&#39;s framework (referencing CSLA as well). &nbsp;I was unaware of having to reload the correct principal/identity, but will read into that and get back to you. &nbsp;Thank you for the quick response!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TNRollingStone replied on Thursday, March 14, 2013</h2><p>I went through the sections of your C# 2008 and CSLA 4 ASP.NET MVC books, but am not having any luck at all. &nbsp; During my debugging, I noticed that each call to the AcquireRequestState function is returned after checking the authentication type as &quot;Windows&quot;. &nbsp; &nbsp;</p>
<p>The site is an MVC 4 application with sub-applications hosted as Areas within the main app, in case that has any relevance to my situation.</p>
<p>&nbsp;I am &nbsp;I added the following lines of code to the application:</p>
<p>&nbsp;</p>
<p><span style="text-decoration:underline;"><strong>Web.config</strong></span></p>
<p>&lt;add key=&quot;CslaAuthentication&quot; value=&quot;Windows&quot;/&gt;</p>
<p>&nbsp;</p>
<p><strong><span style="text-decoration:underline;">Global.asax.cs</span></strong></p>
<p><strong><span>
<p>&nbsp; protected void Application_AcquireRequestState(object sender, EventArgs e)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (HttpContext.Current.Handler is IRequiresSessionState)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (Csla.ApplicationContext.AuthenticationType == &quot;Windows&quot;)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System.Security.Principal.IPrincipal principal;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; principal = (System.Security.Principal.IPrincipal)HttpContext.Current.Session[&quot;CslaPrincipal&quot;];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; catch</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; principal = null;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (principal == null)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (User.Identity.IsAuthenticated &amp;&amp; User.Identity is FormsIdentity)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FormsAuthentication.SignOut();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Response.Redirect(Request.Url.PathAndQuery);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Csla.ApplicationContext.User = principal;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; }</p>
</span></strong></p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
