<html><header><title>CslaDataProvider chaining?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataProvider chaining?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7998.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jjhartma posted on Sunday, November 15, 2009</h2><br>I'm writing a simple WPF address book app.&nbsp; I have a details form that shows the Person record with 2 listboxes, one for Addresses and one for Contact Numbers.<br><br>When the user double clicks on an Address in the listbox a dialog comes up to edit that address.<br><br>Currently, I have a CSLADataProvider that manages my Root object and I bind all the controls to that, including the Listboxes.&nbsp; I have DataTemplates that handle displaying the child objects.<br><br>The problem I'm seeing is that if I make a change to one of the addresses, that change doesn't update the listbox.&nbsp; It does update the root object IsDirty and IsSavable flags, but I can't see the change on the details form.<br><br>Is there a correct way to bind these objects?&nbsp; Do I need another CslaDataProvider for each child list, and if so, how do I chain them together?<br><br>I would also like the dialog that comes up to allow them to "Save" and "Cancel" changes to the address, without saving the actual object until the Root object is saved.&nbsp; Is there anything special I have to do here?<br><br>Thanks for looking at my problem.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, November 16, 2009</h2><P>I'll try to focus on the CSLA-related aspects to this question. Some of what you are asking is just WPF development skills and techniques.</P>
<P>You can use a CslaDataProvider on both the main form and dialog. In the main form you'll probably have it actually get the data by calling a factory method.</P>
<P>&nbsp;&nbsp;&nbsp; &lt;csla:CslaDataProvider x:Key="data"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FactoryMethod="GetList"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectType="{x:Type this:DataItemList}"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ManageObjectLifetime="True"/&gt;</P>
<P>In the dialog form you will <EM>not</EM> allow it to call a factory method, and instead will somehow (probably in code-behind) set the ObjectInstance property.</P>
<P>&nbsp;&nbsp;&nbsp; &lt;csla:CslaDataProvider x:Key="data"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectType="{x:Type this:DataItem}"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ManageObjectLifetime="True"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsInitialLoadEnabled="False"/&gt;</P>
<P>How you do your code-behind can vary a lot, depending on how you decide to structure your application and its code. But the basic concept is pretty straightforward - this code is in the main form and sets up and displays the dialog:</P>
<P>&nbsp;&nbsp;&nbsp; private void ListBox_MouseDoubleClick(object sender, MouseButtonEventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var selected = DataList.SelectedItem as DataItem;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (selected != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dlg = new Window2();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dp = dlg.Resources["data"] as Csla.Wpf.CslaDataProvider;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.ObjectInstance = selected;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dlg.ShowDialog();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>The key is that I'm setting the ObjectInstance property of the data provider in the dialog. The last bit is the Save button event handler in the dialog:</P>
<P>&nbsp;&nbsp;&nbsp; private void SaveButton_Click(object sender, RoutedEventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dp = Resources["data"] as Csla.Wpf.CslaDataProvider;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var obj = (DataItem)dp.Data;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.ApplyEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Close();<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>Because I told the data provider in the dialog to manage the object's lifetime, I need OK/Cancel buttons that call ApplyEdit() and CancelEdit() before closing the form.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
