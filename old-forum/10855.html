<html><header><title>DataPortal Child_Create</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal Child_Create</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10855.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>comp1mp posted on Tuesday, November 08, 2011</h2><p>The following code results in creating a child object in a BusinessLIst that is the child of a Root BusinessBase object. </p>
<p>&nbsp;</p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0in 0in 0pt;mso-layout-grid-align:none;"><span style="FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;COLOR:blue;FONT-SIZE:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">private</span><span style="FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;FONT-SIZE:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;"> <span style="COLOR:blue;">void</span> Child_Create(Enums.<span style="COLOR:#2b91af;">PatientContactType</span> type)</span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0in 0in 0pt;mso-layout-grid-align:none;"><span style="FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;FONT-SIZE:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">{<span style="mso-spacerun:yes;">&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="LINE-HEIGHT:normal;MARGIN:0in 0in 0pt;mso-layout-grid-align:none;"><span style="FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;FONT-SIZE:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;"><span style="mso-spacerun:yes;">&nbsp;&nbsp; </span>LoadProperty&lt;Enums.<span style="COLOR:#2b91af;">PatientContactType</span>&gt;(TypeProperty, type);<span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="MARGIN:0in 0in 10pt;"><span style="LINE-HEIGHT:115%;FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;FONT-SIZE:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">}</span><span style="LINE-HEIGHT:115%;FONT-FAMILY:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;FONT-SIZE:8pt;"></span></p>
<p>&nbsp;</p>
<p>I can inspect the child object at runtime, and all looks good.&nbsp;All is not well however. The childobject has only a single validation rule&nbsp;implemented on a property with the [Required] attribute, Yet, IsValid returns true for the root object, even though the property value is an empty string.</p>
<p>Changing my Child_Create code to the following fixes the issue.</p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;color:blue;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">private</span><span style="font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;"> <span style="color:blue;">void</span> Child_Create(Enums.<span style="color:#2b91af;">PatientContactType</span> peType)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;"><span style="mso-spacerun:yes;">&nbsp;&nbsp; </span><span style="color:blue;">base</span>.Child_Create();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;"><span style="mso-spacerun:yes;">&nbsp;&nbsp; </span>LoadProperty&lt;Enums.<span style="color:#2b91af;">PatientContactType</span>&gt;(seTypeProperty, peType);<span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="line-height:115%;font-family:&#39;Arial Narrow&#39;,&#39;sans-serif&#39;;font-size:8pt;mso-bidi-font-family:&#39;Courier New&#39;;mso-no-proof:yes;">}</span></p>
<p>I am confused by this. Why is the call to the base method required?&nbsp;</p>
<p>I am using Csla 3.8.3, and have the videos and the ProjectTracker reference app. There are several instances in Project tracker of Child_Create methods (in the context of BusinessList) that do not call the base method. ProjectResource specifically.</p>
<p>I have implemented a custom PropertyInfoFactory, and I am concerned that my implementation may be causing this?? I walke dthrough the framework code, and the rule is successfully being created.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>StefanCop replied on Wednesday, November 09, 2011</h2><p>1. I think the base.Child_Create() should be invoked after the properties are set. The base Child_Create() let the rules run.</p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;"><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="color:blue;">private</span> <span style="color:blue;">void</span> Child_Create(Enums.<span style="color:#2b91af;">PatientContactType</span> peType)</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;"><span style="font-family:courier new,courier;"><span style="font-size:small;">{</span></span><span style="font-family:courier new,courier;"><span style="font-size:small;">&nbsp;&nbsp; <span style="color:blue;"><br /></span></span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;"><span style="font-family:courier new,courier;"><span style="font-size:small;">&nbsp;&nbsp; LoadProperty&lt;Enums.<span style="color:#2b91af;">PatientContactType</span>&gt;(seTypeProperty, peType);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;"><span style="font-family:courier new,courier;"><span style="font-size:small;">&nbsp;&nbsp; </span></span><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="color:blue;">base</span>.Child_Create();</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="line-height:115%;">}</span></span></span></p>
<p>2. I don&#39;t know v3.8, but maybe this version doesn&#39;t support Validation Attributes ([Required]) ?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, November 09, 2011</h2><p>1. This is the code in Child_Create and DataPortal_Create:</p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">protected</span>&nbsp;<span style="color:#a52a2a;">virtual</span>&nbsp;<span style="color:#ff0000;">void</span>&nbsp;<span style="color:#191970;font-weight:bold;">Child_Create</span>()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidationRules.<span style="color:#191970;font-weight:bold;">CheckRules</span>();<br />
&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">protected</span>&nbsp;<span style="color:#a52a2a;">virtual</span>&nbsp;<span style="color:#ff0000;">void</span>&nbsp;<span style="color:#191970;font-weight:bold;">DataPortal_Create</span>()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidationRules.<span style="color:#191970;font-weight:bold;">CheckRules</span>();<br />
&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>and should be called after you have set the property values (using LoadProperty or BypassPropertyChecks + set property).</p>
<p>2.&nbsp; In your AddBusinessRules you must also call base.AddBusinessRules to call this (from Csla.BusinessBase.cs) : </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">protected</span>&nbsp;<span style="color:#a52a2a;">virtual</span>&nbsp;<span style="color:#ff0000;">void</span>&nbsp;<span style="color:#191970;font-weight:bold;">AddBusinessRules</span>()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidationRules.<span style="color:#191970;font-weight:bold;">AddDataAnnotations</span>();<br />
&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>in order to add the DataAnnotation rules to the registered BusinessRules of your BO type.</p>
<p>3. The DataAnnotation rules must be defined on the property and not the PropertyInfo. This is the correct version: </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#a52a2a;">static</span>&nbsp;PropertyInfo&lt;<span style="color:#ff0000;">string</span>&gt;&nbsp;CustomerNameProperty =&nbsp;<span style="color:#191970;font-weight:bold;">RegisterProperty</span>(<span style="color:#008b8b;font-weight:bold;">new</span>&nbsp;PropertyInfo&lt;<span style="color:#ff0000;">string</span>&gt;(<span style="color:#0000ff;">&quot;CustomerName&quot;</span>,&nbsp;<span style="color:#0000ff;">&quot;Customer name&quot;</span>));<br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;[Required]<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">string</span>&nbsp;CustomerName<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">get</span>&nbsp;{&nbsp;<span style="color:#000080;">return</span>&nbsp;<span style="color:#191970;font-weight:bold;">GetProperty</span>(CustomerNameProperty);&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">set</span>&nbsp;{&nbsp;<span style="color:#191970;font-weight:bold;">SetProperty</span>(CustomerNameProperty,&nbsp;<span style="font-weight:bold;">value</span>);&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>comp1mp replied on Thursday, November 10, 2011</h2><p>Teach a person to fish :). Next time I will look at the framework code prior to asking, as it is clear now why one must call the base implementation.</p>
<p>I just noticed the business child template provides this guidance&nbsp;&nbsp;in its override of Child_Create(). I deleted the override in this particular class&nbsp;however as my&nbsp;BusinessObject required parameterized creation. Thinking about it now, I should still be overriding and throwing an exception to prevent child creation without the parameter :).</p>
<p>As far as the ProjectTracker reference app, I am assuming 3.5 did not require the call to the base implementation. As I said in the OP, ProjectResource does not call the base.Child_Create(). There have been a few other instances in my experience&nbsp;where looking at the sample refrence apps has resulted in confusion.</p>
<p>I wonder if the samples should be versioned?</p>
<p>Thanks for the answers!&nbsp;&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
