<html><header><title>Possible SetParent Discrepancy</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible SetParent Discrepancy</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12018.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>acgritt posted on Wednesday, June 12, 2013</h2><p>I believe I have come across a discrepancy as to how SetParent is called and how an object is marked as a parent or child of another object. &nbsp;I ran across this because of our particular implementation. &nbsp;I had a Property Info defined as follows:</p>
<p>Note: I am using 4.3.13.0 of CSLA</p>
<p><b>private static readonly PropertyInfo&lt;IProduct&gt; _ProductProperty = RegisterProperty&lt;IProduct&gt;(p =&gt; p.Product);</b></p>
<p>In the actual property we Lazy Load the Product. &nbsp;Product is a CSLA object but we expose it as a IProduct because the parent object is exposed as an interface to the UI layer. &nbsp;When we call LoadProperty the Parent property is not set for the Product. &nbsp;It is set correctly though after the parent object is saved. &nbsp;Looking through the CSLA Source I believe I have found the where the issue/discrepancy lies.</p>
<p>In <b>Csla\Core\BusinessBase.cs -- LoanPropertyValue</b> the following code exists:</p>
<p><b>if (typeof(IEditableBusinessObject).IsAssignableFrom(propertyInfo.Type))</b></p>
<p>Obviously our IProduct does not inherit from IEditableBusinessObject even though Product does. &nbsp;This code is different through from the code used in <b>Csla\Core\BusinessBase.cs -- FieldDataDeserialized</b>. &nbsp;The logic in this method, including FieldManager.GetChildren() use the <b>is</b>&nbsp;and <b>as</b>&nbsp;operators to check if the object inherits from IEditableBusinessObject.</p>
<p>Was this implementation intentional as it seems rather inconsistent. &nbsp;After a save the Product returned from the property has the Parent set correctly but before the same it does not. &nbsp;I was able to work around the issue by changing our implementation to use Product in the PropertyInfo and then implement an explicit interface property to expose the IProduct.</p>
<p>Also, I did check the latest codebase for CSLA and the code still exists the same as it did in 4.3.13.0 for this logic.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
