<html><header><title>BrokenRules Sample for root and children like Visual Studio</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BrokenRules Sample for root and children like Visual Studio</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4454.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB posted on Monday, March 03, 2008</h2><font face="Tahoma" size="2">You can take this sample app and do with it what you want. This is my way of giving something back to the group.<br><br><b>Disclaimer</b>: There are many ways to do what I did. It is certainly not meant to be perfect but just one of many ways to 'skin the cat'.<br><br><b>Application Structure</b>: Csla 3.0.3, VS2005, no database required. I spiced it up a little using the WeifenLuo panels. You should only need to update your Csla reference path.<br><br><b>BrokenRulesSample Application</b><br>1) <b>MainForm </b>- The main form for the application and also the container for the message panel what we will use to display broken rules to the user.<br>2) <b>MessagePanel </b>- Used to display broken rules to the user as they occur with changes made to the data.<br>3) <b>ContentEdit </b>- Where all the data editing takes place. All user interaction.<br>4) <b>BaseForm </b>- All ContentEdit forms would inherit from the base form. The reason I did this was so that I could 'hide' the broken rules plumbing from the developer. Nothing gets missed this way...<br>5) <b>BrokenRulesCollectionHelper </b>- Used to retrieve the broken rules collections from the Csla objects. Read the docs inside the file for more information and many props to Andrés (Xal on the forum) for his work here.<br><br><b>SampleLib<br></b>1) <b>SubClassClsa </b>- Again, nothing more than the standard subclassing of Csla with the addition of a few files.<br><b>MyBrokenRulesCollection </b>- Esentially a subclass of the Csla BrokenRulesCollection class. Again, read the notes inside the file for more details.<br><br><b>MyBrokenRule</b> - Subclass of Csla BrokenRule.<br><br><b>BrokenRulesChangedEventArgs </b>- Used for custom event to pass around broken rules collection for refreshing or initing.<br><br>2) <b>Customer (BB), Addresses (BLB), Address (BB)</b>. Standard Csla business objects. Nothing fancy, no database required.<br><br>3) <b>CslaTypeHelper </b>- Again, many thanks to Andrés for his work.<br><br>Hopefully this little project will help someone out as much as the help I have received here. I figure this is the least that I can do given how much Rocky has given us.<br><br>Please feel free to ask any questions, comments, likes, dislikes, bugs I have missed or whatever! I take criticism well!<br><br>John</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Tuesday, March 04, 2008</h2>Someone let me know that I forgot to include the assembly for the panels. I did a build and uploaded again. Total download is 4meg.<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, March 05, 2008</h2><P>John,</P>
<P>I just downloaded it and ran through it quickly.</P>
<P>1. Very nice job.</P>
<P>2. Good of you to give Andres credit so prominently in the code.</P>
<P>It was not&nbsp;immediately clear that the buttons in the panel were clickable filters that allow you to see only those errors that apply to the ones that are selected. It is a nice touch though.</P>
<P>In VS 2005 I could not open the ContentEdit.vb [Design] file. I cannot see the form where you lay out all the controls. I get this error:</P>
<P>
<TABLE id=table1 cellSpacing=0 cellPadding=0>

<TR>
<TD align=left><B><FONT face=Arial size=2>One or more errors encountered while loading the designer. The errors are listed below. Some errors can be fixed by rebuilding your project, while others may require code changes.</FONT><FONT face=Arial size=2></FONT></B></TD></TR>
<TR>
<TD align=left colSpan=2>
<DIV class=ErrorStyle id=div1><SPAN><BR>Error HRESULT E_FAIL has been returned from a call to a COM component. </SPAN><BR></DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>If I close the Message Panel there is no way to re-open it.</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>In <FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Module</FONT><FONT size=2> BrokenRulesCollectionHelper</FONT></DIV>
<DIV class=ErrorStyle><FONT color=#0000ff size=2>
<P>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> LoadPropertyData(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> objectType </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type)</P></FONT></DIV>
<DIV class=ErrorStyle>The code loops until <FONT size=2>pCurrentType </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT></DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>The test inside the loop is for IsBusinessBase. It seems that the loop should stop once IsBusinessBase is True. I thought it continued working its way up the inheritance chain past BusinessBase. (I only looked once and could be mistaken though.)</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>Joe</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV>
<DIV class=ErrorStyle>&nbsp;</DIV></TD></TR></TABLE></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Wednesday, March 05, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>In VS 2005 I could not open the ContentEdit.vb [Design] file. I cannot see the form where you lay out all the controls.</div></BLOCKQUOTE>Try rebuilding the project. That should fix your issues. There is nothing special in the form.<br><br><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>If I close the Message Panel there is no way to re-open it.</div></BLOCKQUOTE>You need to restart the application. My intention was that this was a demo and I did not bother to wire that part up. I can added it though.<br><br><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>The test inside the loop is for IsBusinessBase. It seems that the loop should stop once IsBusinessBase is True.</div></BLOCKQUOTE>It will continue. Notice the recursive call to the InitializeBrokenRules method again.<br><br>For Each pMethodInfo As MethodInfo In _propertyData.Item(pType)<br>&nbsp;&nbsp;&nbsp; Dim pChildObjectInfo As Object<br>&nbsp;&nbsp;&nbsp; pChildObjectInfo = pMethodInfo.Invoke(businessObject, Nothing)<br><br>&nbsp;&nbsp;&nbsp; If pChildObjectInfo Is Nothing Then Exit For<br><br>&nbsp;&nbsp;&nbsp; <b>InitializeBrokenRules</b>(editForm, pChildObjectInfo, False)<br>Next<br><br><br>Other than that, thanks! I hope others find it useful.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Friday, March 07, 2008</h2>Just wanted to provide an update. I modified the project to also include grandchild objects. Check it out from the link on the first post.<br><br>Thanks,<br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Friday, March 07, 2008</h2><P>&nbsp;</P>
<P>On the codeplex site they have created something similar. It is called ErrorTreeView.</P>
<P>There is not much explanation of it, but they have created a nice example.</P>
<P>You can download it from:</P>
<P><A href="http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx">http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx</A></P>
<P>You have to extract the file because there is more in it.</P>
<P>They have created a treeview. So in the treeview you see a visual representation of root, children and grandchildren. By clicking on the error you arrive at the control where you can fix the problem.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Friday, March 07, 2008</h2>Alef,<br><br>Thanks for the information. I actually used some of the code from Xal's project, so now we have two examples of how to do this.<br><br>The more examples we have the better it is for the community.<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Monday, March 10, 2008</h2>Just curious if anyone had any other examples or comments to share about this topic?<br><br>Thanks<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, March 10, 2008</h2>Hey John!<br>It looks great!! I'm glad you could reuse some of my code.<br><br>It's been a while since I've been around the forum, as you may realize. But I'm trying to catch up. I've been quite busy (and still am).<br><br>Again: great work!<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>snakebyteme replied on Wednesday, February 03, 2010</h2>Here is a simpler approach that will not recurse forever if you have grandchildren that are the same type as the Parent:<br><br>Imports Csla<br>Imports System.Reflection<br>Imports System.ComponentModel<br>Imports System.Text<br><br>Public Class BrokenRulesExtractor<br><br>&nbsp; Private mBrokenRules As List(Of Csla.Validation.BrokenRule)<br><br>&nbsp; Public ReadOnly Property BrokenRulesCollection() As List(Of Csla.Validation.BrokenRule)<br>&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mBrokenRules<br>&nbsp;&nbsp;&nbsp; End Get<br>&nbsp; End Property<br><br>&nbsp; Public Sub GetBrokenRules(ByVal target As Object)<br>&nbsp;&nbsp;&nbsp; Dim inspectedObjects As New Collections.Generic.List(Of String)<br>&nbsp;&nbsp;&nbsp; mBrokenRules = New List(Of Csla.Validation.BrokenRule)<br>&nbsp;&nbsp;&nbsp; GetBrokenRules(target, inspectedObjects)<br>&nbsp; End Sub<br><br>&nbsp; Private Sub GetBrokenRules(ByVal target As Object, ByVal inspectedObjects As Collections.Generic.List(Of String))<br>&nbsp;&nbsp;&nbsp; Dim returnValue As New StringBuilder<br>&nbsp;&nbsp;&nbsp; Dim targetID As String = String.Empty<br>&nbsp;&nbsp;&nbsp; If target IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; targetID = target.GetType.ToString &amp; ":" &amp; target.GetHashCode().ToString<br>&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; If target IsNot Nothing AndAlso Not inspectedObjects.Contains(targetID) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inspectedObjects.Add(targetID)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim myType As Type = target.GetType<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If myType.BaseType.Name.Contains("BusinessListBase") Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If target.IsDirty Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' check error messages for each row in the list<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For oneItem As Integer = 0 To CType(target, IBindingList).Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If TypeOf CType(target, IBindingList)(oneItem) Is Csla.Core.BusinessBase Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GetBrokenRules(CType(target, IBindingList)(oneItem), inspectedObjects)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If TypeOf target Is Csla.Core.BusinessBase Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If target.IsDirty Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' run through broken rules collection for this object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each oneBrokenRule As Csla.Validation.BrokenRule In CType(target, Csla.Core.BusinessBase).BrokenRulesCollection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' if we do not have this message already, add it<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not mBrokenRules.Contains(oneBrokenRule) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mBrokenRules.Add(oneBrokenRule)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' get list of properties for this object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim properties() As System.Reflection.PropertyInfo = target.GetType.GetProperties()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each oneProperty As System.Reflection.PropertyInfo In properties<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' get object that sits on this property<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not oneProperty.PropertyType.IsPrimitive AndAlso oneProperty.GetIndexParameters().Length = 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim propTarget As Object = oneProperty.GetValue(target, Nothing)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' call this procedure resursively to get error for property based object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GetBrokenRules(propTarget, inspectedObjects)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' if we do not have this message already, add it<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp; End Sub<br><br>End Class<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
