<html><header><title>Clone an object and mark childrens as New</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Clone an object and mark childrens as New</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6289.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Antonio Sandoval posted on Thursday, January 29, 2009</h2>I have a class Root named Invoice, and a child list named InvoiceDetailList<br>BussinesBase&lt;Invoice&gt;<br>&nbsp;&nbsp;&nbsp; BussinesListBase&lt;InvoiceDetailList, InvoiceDetail&gt;<br><br>class Invoice{<br><blockquote>public InvoiceDetailList GetInvoiceDetailList {<br><blockquote>get {<br><blockquote>&nbsp;return _InvoiceDetailList;<br></blockquote>}<br></blockquote>}<br></blockquote>}<br><br>The user can cancel an Invoice, and also can duplicate and cancel at the same time:<br>The clone method must cancel the Old Invoice, so I wrote a custom Clone method:<br><br>public Invoice DuplicateInvoice(){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanExecuteMethod("CancelInvoice", true); //Same command for CancelInvoice()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Run Cancel Invoice Command<br><div>CancelInvoiceCommand result;<br>Invoice newInvoice=null;<br>result = DataPortal.Execute&lt;CancelInvoiceCommand&gt;(new CancelInvoiceCommand(_InvCode));<br></div><blockquote>if(result.Cancelled){<br><blockquote>newInvoice = base.Clone();<br>newInvoice.MarkNew();<br>//How to mark new all the childrens?<br></blockquote>}<br></blockquote><blockquote>return newInvoice;<br></blockquote>}<br><br>Now, the problem is that the InvoiceDetail does not mark as New, I was thinking on write an Internal method to do that, but maybe there is a better way.<br><br>Thank you in advance<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, January 29, 2009</h2><P>Another way to do this that avoids side-effects like this is to actually create a new object, and then use the Csla.Data.DataMapper class to copy the corresponding fields from the source object to the new target. </P>
<P>I've done it both ways. Cloning might be faster, but then you have an object that may have unwanted baggage from the original like autonumber keys, etc. You can pass properties to be ignored to Csla.Data.DataMapper when copying from one object to another. Note that DataMapper only appears to copy browsable properties, if that is a consideration. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, January 29, 2009</h2><P>I agree. I do it this way too. Create a new object and set its properties from the source object.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Antonio Sandoval replied on Thursday, January 29, 2009</h2>Perfect, it works, thank you.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Invoice cloned = Invoice.NewInvoice();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Data.DataMapper.Map(this, cloned, new string[] { "AccCode", "InvoiceDetailsList" });<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (InvoiceDetail detail in this.InvoiceDetailsList)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InvoiceDetail clonedDetail = InvoiceDetail.NewInvoiceDetail();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Data.DataMapper.Map(detail,clonedDetail ,new string[] {"AccCode"});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cloned.InvoiceDetailsList.Add(clonedDetail );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
