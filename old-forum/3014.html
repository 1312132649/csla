<html><header><title>Why SmartXYZ.DBValue?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Why SmartXYZ.DBValue?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3014.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate posted on Sunday, June 10, 2007</h2><P>I have a two part question - one for clarification and one for education.</P>
<P>I understand that the various SmartXYZ types that have been created expose a DBValue property to overcome the "No mapping exists from object type Csla.SmartXYZ to a known managed provider native type" exception.&nbsp; But why go this route and not implement whatever it takes to provide this mapping so that the type can be used outright like their System counter-parts?</P>
<P>And with that in mind, what is it that the framework classes do or implement that allow them to be mapped?&nbsp; Is it via an interface, a type converter or something else?</P>
<P>I implemented IConvertible.GetTypeCode and return System.TypeCode.DateTime then tried to use the SmartDate type directly but it still failed.&nbsp; Placing a breakpoint in GetTypeCode never broke execution, telling me this isn't the key.&nbsp; So how do the built-in classes do it?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, June 12, 2007</h2><P>No one has any feedback/thoughts on this?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Tuesday, June 12, 2007</h2>The .DBValue property is there to provide a DBNull to the DbCommand when .Empty == true.&nbsp; Without it, I imagine that there is not much reason to have the SmartXYZ in the first place...<br><br>I imagine that the Data Providers are what map the built in .NET types to the data types of the data provider.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, June 19, 2007</h2><P>Sorry for the delay responding...</P>
<P>I realize what purpose the DBValue properties serve, what I would like to know is if they are really necessary or if some other means is available to accomplish the same requirement.</P>
<P>In tracing through the SqlClient classes using ILDASM to see what is done with property values, I found that there is a GetMetaDataFromType method that appears to use the specified type's GetTypeCode() value in a switch statement (Select Case in VB) to translate the type to the applicable SqlType.&nbsp; If the return type code is not one of the switch cases, the aforementioned exception is thrown.</P>
<P>It appears, but I'm not sure, that there is a second test to validate the type of the specified object with an exception thrown if it doesn't match.&nbsp; For instance, if GetTypeCode returns TypeCode.DateTime there is a test to verify that (obj is System.DateTime).&nbsp; This may be where the problem lies - even though I still don't get a hit when I set a breakpoint in the GetTypeCode method for the SmartDateTime struct.&nbsp; So, can we return the Object type code instead and circumvent this?</P>
<P>Or am I barking up the wrong tree entirely?</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
