<html><header><title>Using Roles and the Identity objects to allow a user to perform actions for another user.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Using Roles and the Identity objects to allow a user to perform actions for another user.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4149.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms posted on Thursday, January 10, 2008</h2>Greetings to all,<br>I have successfully used CSLA on my current project and believe to be an excellent framework.&nbsp; Of course, as always seems to come along at the end of the project, an additional 'requirement' came&nbsp; up.&nbsp; What I need to do is to allow the application administrator to assign a user the abilty to act for another user.&nbsp; This is for a specified time frame and will be recorded in the user actions log (both the delegation of the role and each use of the delegation).<br><br>Is there an underlaying mechanism in the CSLA framework to perform?<br><br>At this time, I foresee creating a class/object that inherits from role and adding&nbsp; the needed information the class.&nbsp; This means a re-defintion of the IsInRole method to handle the extra work.<br><br>Any ideas or guidance is appreciated.<br><br>Best Regards, <br>Bill<br><br>P.S.<br>My thanks to those who contributed my last conundrum.&nbsp; I have it on my ToDo list to update the thread with my final solution.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, January 11, 2008</h2><P>I approached it differently. In my DB table for users I added a column for AlternateApprover and foa given user the Administrator can assign their alternate. Then if the main user is "out of the office" the alternate can view and take action on the workflow that normally went to the main user. The actions of the alternate are logged as their own so that you can see who really did what. With Sarbanes-Oxley I am pretty sure you would not want to hide that data and make it look like the main user did something when in fact someone else did it for him.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, January 15, 2008</h2>Indeed, with SOX tracability is needed. There will a GUI for the Admin to assign delegates for&nbsp; agiven period of time and the user log will note that delegator acting for the delegate.<br><br>Unfortunately almost all the code and database for the project is written and grossly changing it not an option, however adding to it is an available option.&nbsp; <br><br>Right now, I am looking at using a second BO identity and assigning it all the roles of the delegator. That identity becomes available to the delegate when they log in (actually a list of delegator identities that they may use).&nbsp; All logged actions are then logged as the delgate/delegator combination.&nbsp; <br><br>The question in my mind is whether to use inheritence from the normal application identity, WODBIdentity,&nbsp; or to simply subclass the&nbsp; Identity object.&nbsp; I am thinking the first as a Decorator Pattern and the&nbsp; latter as polymorphism.<br><br>However, what I was mostly wondering was if there was inherently some in the CSLA framework which addressed this issue already?<br><br>Regards,<br>Bill <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Wednesday, January 16, 2008</h2><P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>BillArms:</strong></div><div>Indeed, with SOX tracability is needed. There will a GUI for the Admin to assign delegates for&nbsp; agiven period of time and the user log will note that delegator acting for the delegate.<BR><BR>Unfortunately almost all the code and database for the project is written and grossly changing it not an option, however adding to it is an available option.&nbsp; <BR><BR>Right now, I am looking at using a second BO identity and assigning it all the roles of the delegator. That identity becomes available to the delegate when they log in (actually a list of delegator identities that they may use).&nbsp; All logged actions are then logged as the delgate/delegator combination.&nbsp; <BR><BR>The question in my mind is whether to use inheritence from the normal application identity, WODBIdentity,&nbsp; or to simply subclass the&nbsp; Identity object.&nbsp; I am thinking the first as a Decorator Pattern and the&nbsp; latter as polymorphism.<BR><BR>However, what I was mostly wondering was if there was inherently some in the CSLA framework which addressed this issue already?<BR></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>First,&nbsp;I'll answer&nbsp;the "easy" question.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />&nbsp; There isn't anything within CSLA to support this.&nbsp; CSLA will work with the standard .NET IPrincipal/IIdentity model of security, but that's all it will do.&nbsp; Since delegation isn't built into that, you're on your own.</FONT></P>
<P><FONT face=Tahoma size=2>As for how to implement delegation, I'll tell you what I usually do, and you can decide whether it's too intrusive of a change to make.</FONT></P>
<P><FONT face=Tahoma size=2>I typically store the delegation information in a separate table.&nbsp; This table can get as specific as you need it to - for one project, I had to get down to specific data in the database that could be delegated.&nbsp; In any event, this table would store the date range, the source user, the delegated user, and what functionality was to be delegated.&nbsp; Depending on how the delegation functionality needs to be done, you might need more than one table - I did for the project I just mentioned - but that's usually pretty rare.&nbsp; I didn't change anything else in the database.</FONT></P>
<P><FONT face=Tahoma size=2>Then I would create my custom IIdentity object to load both the user's roles and the roles delegated to the user.&nbsp; I&nbsp;keep the two lists separate, so that it's possible to tell whether the rights were intrinsic or delegated.&nbsp; This can be useful if&nbsp;it's important to know within the application whether the rights that are being exercised are delegated - maybe you need to show something on the UI to reflect that.</FONT></P>
<P><FONT face=Tahoma size=2>Anyway, the "IsInRole"&nbsp;code checks both lists, and since it's a string value, I can basically pass whatever I want.&nbsp; Since&nbsp;the&nbsp;database stores who made the change to the database and when, I could use the delegation table to quickly determine whether the change was authorized or not, and who delegated the authority to make the change.</FONT></P>
<P><FONT face=Tahoma size=2>Given this model, I don't see a need to create a second Identity object, or even to subclass the existing one.&nbsp; The modifications to your existing Identity object&nbsp;should be rather minimal.&nbsp; What may be a larger change is if you need to change all the "IsInRole" code calls, but you should be able to get at those fairly quickly with a search-and-replace.&nbsp; In any case, all the changes are basically additive to the system, and if you never need/use them, no one will ever notice the difference.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, January 22, 2008</h2>Scott, thank you for your reply.<br><br>I understand your elegant solution and see it as simple and efficient.&nbsp; Unfortunately, it allows both sets of permissions to be used at once.&nbsp; Due to workflow interactions, I need to seperate each user's actions and can not rely on the user to do that.&nbsp; In addition, another goal is to allow testing using the delegator's role.&nbsp; (Possibly automating the testing with NUnit and the SWExplorer Automation Designer by Webius)<br><br>I might be able to adapt your solutuion using a switching mechanism between the sets of delegated roles.<br><br>Once again thanks to Scott and Joe for their ideas and recommendations.<br><br>Regards,<br>Bill<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, January 22, 2008</h2><P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>BillArms:</strong></div><div>I understand your elegant solution and see it as simple and efficient.&nbsp; Unfortunately, it allows both sets of permissions to be used at once.&nbsp; Due to workflow interactions, I need to seperate each user's actions and can not rely on the user to do that.&nbsp; In addition, another goal is to allow testing using the delegator's role.&nbsp; (Possibly automating the testing with NUnit and the SWExplorer Automation Designer by Webius)</div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>Thanks for the compliment!</FONT></P>
<P><FONT face=Tahoma size=2>I guess I'm a little confused.&nbsp; It sounds like you're saying that once I delegate my rights to someone else, I can't perform those rights anymore?&nbsp; Or are you saying that your system shouldn't allow both me and those I've delegated&nbsp;rights to access to the same workflows at the same time?</FONT></P>
<P><FONT face=Tahoma size=2>If it's the first one - well, that sounds a little odd to me, but what the heck do I know?&nbsp; If it's the second one, that doesn't strike me as an implementation detail for the delegation system.&nbsp; That sounds more like a check-out/check-in type of thing, which would be implemented separately from user-security access.</FONT></P>
<P><FONT face=Tahoma size=2>I can't speak to using delegation for testing, though at first blush I'd scratch my head a little on that.&nbsp; NUnit tests shouldn't care a whit about user access - those are run using test fixtures that you write.&nbsp; User security shouldn't enter into that&nbsp;equation, unless you're testing the security objects.&nbsp; And&nbsp;I know almost nothing about UI testing frameworks, so I can't speak knowledgably about that.</FONT></P>
<P><FONT face=Tahoma size=2>Obviously, you know the system better than I do, and if you can adapt something to fit what you need, more power to you!</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
