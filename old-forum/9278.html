<html><header><title>Need to implement custom authorization rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need to implement custom authorization rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9278.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>breakphreak posted on Monday, July 26, 2010</h2><p>&nbsp;</p>
<p>Hey there - I am new to the forum and here is my first (hopefully answerable) question <img src="http://forums.lhotka.net/emoticons/emotion-15.gif" alt="Geeked" /></p>
<p>Need to implement custom authorization rule(s).</p>
<p><strong>Examples</strong>:</p>
<ul>
<li>The logged-in principal or admin can update her details, not anyone else.</li>
<li>The last user in the system can&#39;t be deleted.</li>
</ul>
<p>Currently I know that rules can be applied during setup phase:</p>
<pre class="prettyprint"><code><span class="typ">BusinessRules</span><span class="pun">.</span><span class="typ">AddRule</span><span class="pun">(</span><span class="kwd">typeof</span><span class="pun">(</span><span class="pln">myClass</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IsInRole</span><span class="pun">(</span><span class="typ">AuthorizationActions</span><span class="pun">.</span><span class="typ">GetObject</span><span class="pun">,</span><span class="pln"> new [] {</span><span class="str">&quot;role1&quot;</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;role2&quot;}</span><span class="pun">));</span><span class="pln"><br /></span></code></pre>
<p>This approach is insufficient and less flexible then required. The rules should be probably applied during&nbsp;<code>DataPortal&lt;T&gt;.Update()</code>&nbsp;(did I missed anything from the source, please?). Any advice will be warmly welcomed.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, July 26, 2010</h2><p>I assume you&#39;ve read this post: <a href="http://www.lhotka.net/weblog/CSLA4AuthorizationRules.aspx">http://www.lhotka.net/weblog/CSLA4AuthorizationRules.aspx</a></p>
<p>The AddRule() method doesn&#39;t actually run the rule - it just associates the rule with the business object type. The rules are actually applied (executed) when appropriate (such as when a property is read or changed, or an attempt is made to retrieve an object).</p>
<p>Per-type and per-instance rules are enforced by the data portal, so when Save() is called, the relevant authz action is checked (Create/Get/Edit/Delete) and an exception is thrown if the user isn&#39;t authorized. The various meta-state properties (like IsSavable) also check the relevant authz permission to calculate their value.</p>
<p>You will need to implement custom rules to do what you describe, because that goes beyond just &quot;is the user in role X&quot;. That&#39;s fine - just create a subclass of Csla.Rules.AuthorizationRule, do your checks and return true/false as appropriate.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>breakphreak replied on Monday, July 26, 2010</h2><p>Thanks a lot for so quick and elaborative answer.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
