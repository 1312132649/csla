<html><header><title>Remove vs Delete in BusinessCollectionBase (v1.5)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Remove vs Delete in BusinessCollectionBase (v1.5)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2056.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kayakheaven posted on Monday, January 01, 2007</h2><P>I'm using CSLA v1.5 to implement two collections containing the same child class. I want to move object instances from one collection to the other and save / update to persist the changes. So I write</P>
<P>col1.Remove(obj1);</P>
<P>col2.Add(obj1);</P>
<P>col1.Save();</P>
<P>col2.Save();</P>
<P>I don't want col1 to try to delete obj1 from the database, but I do want col2 to&nbsp;update it. BusinessCollectionBase doesn't work this way, .Remove leads to a delete from persistent storage.</P>
<P>Looks like I could achieve this enhancement by extending BusinessCollectionBase.OnInsert to check if object val _isDeleted and resetting that flag and separately purge the object instance from col1.deletedList, or implementing a new method .RemoveNoDelete that provides this behavior. Too bad System.Collections.IList doesn't distinguish between Remove and Delete.</P>
<P>Does anyone have any comments on this, am I on the right track or off base?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, January 01, 2007</h2>What are you trying to do from a business object standpoint (i.e. what scenario is this technical solution trying to fulfill)?&nbsp; It may be possible that a different technical solution would work better here, such as applying a pair of filters to the same underlying list, one showing the unaltered items and the other showing the moved items.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kayakheaven replied on Monday, January 01, 2007</h2>Hi Brian, thanks for your interest, here is my scenario: RegionalOffices collection contains Office objects which each contain LocalOffices collection each of which contains Office objects. These are displayed in a UI screen, e.g. two linked grids or a hierarchical grid. User can promote a local office to be a regional office or vice versa demote regional office to local office. <br><br>In either case I want to remove the office object from its current collection and add it to the other collection, without the object being considered "deleted" since it isn't. The office object properties modified as a result of this move are "is regional office" and "parent regional office code".<br><br>Yes I could use a hidden master Office collection that is filtered to obtain the RegionalOffices collection and each child LocalOffices collection, but that seems less intuitive than removing from one collection and adding to the other and having the interals manage that. Shouldn't there be a difference between Remove and Delete?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, January 01, 2007</h2>From a .NET framework perspective there is only IList.Remove().&nbsp; So Rocky made BusinessCollectionBase do what would work in 99% of the cases.&nbsp; So you have two options here:<br><ol><li>Modify the framework.</li><li>Modify your objects.</li></ol>It is something that many people run into at some point or another.&nbsp; I think that if you searched for a bit you could even find a discussion in the forums discussing a similar issue to what you are experiencing.<br><br>This seems similar to discussions that pop up every so often where someone has made an object that does two different things because the data is so similar.&nbsp; However, the behaviour is different, and it is conceptually slightly different.&nbsp; Only regional offices can have local offices whereas local offices cannot have there own local offices.&nbsp; This suggests at least three different objects:<br><ul><li>RegionalOffice, which can have a LocalOfficeCollection</li><li>LocalOfficeCollection, a collection of LocalOffice objects</li><li>LocalOffice, a basic office object</li></ul>However, that does not solve the issue of being able to promote and demote offices.&nbsp; So the object model changes slightly:<br><ul><li>Office, which has a LocalOfficeCollection</li><li>LocalOfficeCollection, a collection of LocalOffice objects</li><li>LocalOffice, an object that contains the id of an office, the id is useful for binding against an OfficeCollection to get the full office details<br></li></ul>This allows you to have a single OfficeCollection that contains all of your objects.&nbsp; A RegionalOffices filter shows only the Office objects that are marked as regional.&nbsp; Another filter LocalOffices would give the option of adding a local office to the list of offices for a regional office.&nbsp; The Office object would have a Promote() and Demote() methods coupled with CanPromote and CanDemote properties.&nbsp; CanPromote would return true for local offices.&nbsp; CanDemote would return true for regional offices that had no local offices.&nbsp; The corresponding methods would throw InvalidOperationExceptions when they were run and their corresponding properties returned false.<br><br>Obviously this example does not exactly fill your need, but hopefully it gives you some ideas as to other options you could choose.&nbsp; Their are other people on these boards who are better than I at designing objects based on use cases, but I think most of them are still on holiday over the new year.&nbsp; If you do decide to go about modifying the framework, I would suggest instead that you look at how The CSLA collection base classes handle OnRemove and RemoveAt.&nbsp; You could have your OfficeCollection override one or both of those methods to have it avoid marking the removed object for deletion.<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 02, 2007</h2>A regional office doesn't sound the same as a local office.&nbsp; Moving the object from one list to another doesn't sound like the proper way to do this.&nbsp; Instead, there should be a method that promotes the local office to the regional office.&nbsp; This might have to be done outside any existing buisiness objects, and would probably have to force a reload of the object being edited.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pelinville replied on Friday, January 05, 2007</h2><DIV>I often want to remove an object without deleting it.&nbsp; Especially in my one to many or many to many cases.</DIV>
<DIV>&nbsp;</DIV>
<DIV>I have this little&nbsp;method in a subclass.</DIV>
<DIV>&nbsp;</DIV>
<DIV>
<P><FONT color=#0000ff>Public</FONT> <FONT color=#0000ff>Overridable</FONT> <FONT color=#0000ff>Sub</FONT> Exclude(<FONT color=#0000ff>ByVal</FONT> item <FONT color=#0000ff>As</FONT> SFBusinessBase)</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;If</FONT> item <FONT color=#0000ff>Is</FONT> <FONT color=#0000ff>Nothing</FONT> <FONT color=#0000ff>Then</FONT> <FONT color=#0000ff>Return</P></FONT>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim</FONT> itemMarkedDeleted <FONT color=#0000ff>As</FONT> <FONT color=#0000ff>Boolean</FONT> = item.IsDeleted</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT> <FONT color=#0000ff>Me</FONT>.List.Contains(item) <FONT color=#0000ff>Then</P></FONT>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me</FONT>.List.Remove(item)<FONT color=#008000></P></FONT>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT> <FONT color=#0000ff>If</P></FONT>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me</FONT>.deletedList.Remove(item)</P>
<P><FONT color=#008000>'If this item was not marked for deletion before the above calls then unmark it for deletion.</FONT></P>
<P><FONT color=#008000>'Otherwise keep it as it was since something else marked it for a reason.</P></FONT>
<P>
<P><FONT color=#008000></P></FONT><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT> <FONT color=#0000ff>Not</FONT> itemMarkedDeleted <FONT color=#0000ff>Then</FONT> item.SetNotDeleted()</P>
<P><FONT color=#0000ff>End</FONT> <FONT color=#0000ff>Sub</P></FONT>&nbsp;</DIV>
<DIV>&nbsp;</DIV>
<DIV>The SetNotDeleted is in a derived class of BusinessBase and all it does is set the deleted variable to false.</DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp;</DIV></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
