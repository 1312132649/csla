<html><header><title>CSLA 3.6.3 BUG: Linq query on nullable of guid type property failed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.6.3 BUG: Linq query on nullable of guid type property failed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7207.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Baumus posted on Wednesday, July 01, 2009</h2>Hi,<br><br>first of all I would like to say, I am really faszinated by the CSLA framework, its ongoing development and enhancements, it is really some great piece of work!<br><br>I have used CSLA 3.6.2 so far. After having upgradet to CSLA 3.6.3 the following LINQ query on a BusinessListBase object, failed:<br><br>Dim mGuid = mBusinessListBase.Last.mGuid<br><br>The Property mGuid is defined as follows in the child object (Inherited from BusinessBase):<br><br>&nbsp;Private Shared mGuidProperty As PropertyInfo(Of Guid?) = RegisterProperty(Of Guid?)(GetType(ChildObject), New PropertyInfo(Of Guid?)("mGuid", "mGuid"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;Summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' Gets and sets the mGuid value.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;/Summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Property mGuid() As Guid?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of Guid?)(mGuidProperty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As Guid?)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of Guid?)(mGuidProperty, value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>Returning back to CSLA 3.6.2 the same code works perfectly. Am I correct assuming there is a bug in CSLA 3.6.3 because of that result? If yes, would it be possible to correct it?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Baumus replied on Wednesday, July 01, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Baumus:</strong></div><div><br>I have used CSLA 3.6.2 so far. After having upgradet to CSLA 3.6.3 the following LINQ query on a BusinessListBase object, failed:<br><br>Dim mGuid = mBusinessListBase.Last.mGuid<br><br>The Property mGuid is defined as follows in the child object (Inherited from BusinessBase):<br><br>&nbsp;Private Shared mGuidProperty As PropertyInfo(Of Guid?) = RegisterProperty(Of Guid?)(GetType(ChildObject), New PropertyInfo(Of Guid?)("mGuid", "mGuid"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;Summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' Gets and sets the mGuid value.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''' &lt;/Summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Property mGuid() As Guid?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of Guid?)(mGuidProperty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As Guid?)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of Guid?)(mGuidProperty, value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>Returning back to CSLA 3.6.2 the same code works perfectly. Am I correct assuming there is a bug in CSLA 3.6.3 because of that result? If yes, would it be possible to correct it?<br></div></BLOCKQUOTE><br><br>I would just like to add some other odd behavior probably related somewhat to what I mentioned above. When I mark the above described property as indexable then I get the following exception:<br><br>NullReferenceException in System.Linq.Index&lt;T&gt;<br><br>&nbsp;private void DoAdd(T item)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_theProp != null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000"> int hashCode = _theProp.GetValue(item, null).GetHashCode();</font> // &lt;--- this line is producing the error<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_index.ContainsKey(hashCode))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _index[hashCode].Add(item);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;T&gt; newList = new List&lt;T&gt;(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newList.Add(item);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _index.Add(hashCode, newList);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _countCache++;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>This error occurs in both CSLA 3.6.2 and CSLA 3.6.3 - what can be done about it?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Sunday, July 05, 2009</h2>Hi there-<br /><br />I have created a test in the CSLA test project that adds getting the last item when a property is a Nullable Guid - and there seems to be no issues.<br /><br />I suspect there is something else going on here, as I added CslaQueryProviderTests.TestLastWithNullableGuid to exercise this.<br /><br />Simply having a property that is a Nullable and adding it to a BLB and/or querying it's last item is not a problem - as the test would fail if it were.<br /><br />I suspect we will need to see what else is going on here to solve this.  For fastest response, please provide a self-contained failing test which exercises the issue.  If that is not possible, we will need to make further arrangements which will take longer to get set up and tested.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
