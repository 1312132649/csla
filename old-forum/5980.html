<html><header><title>Crash with object in BeginEdit followed by object's parent in BeginEdit</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Crash with object in BeginEdit followed by object's parent in BeginEdit</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5980.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>wmkew posted on Thursday, December 11, 2008</h2><P><FONT face="Courier New" size=2>Hello,</FONT></P>
<P><FONT face="Courier New" size=2>We're&nbsp;using CSLA .NET 3.5.2, and&nbsp;we&nbsp;have the following code that produces a Csla.Core.UndoException as noted below in the code comment.&nbsp; The exception message is, "Edit level mismatch in CopyState".&nbsp; I'm pretty sure that we're simply misusing the framework in this case; my question is, would the exception be expected behavior?&nbsp; Note that if we flip the order of the two BeginEdit() calls, the crash doesn't occur.&nbsp; Any thoughts?&nbsp; Thanks in advance!</FONT></P>
<P><FONT face="Courier New" size=2>- Whitney</FONT></P>
<P><FONT face="Courier New" size=2>using System;<BR>using Csla;</FONT></P>
<P><FONT face="Courier New" size=2>namespace CslaTest<BR>{<BR>&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp; class A : BusinessBase&lt;A&gt;<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public readonly BCollection Coll = new BCollection();<BR>&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp; [Serializable]<BR>&nbsp;&nbsp; class B : BusinessBase&lt;B&gt;<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [NotUndoable]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public readonly A TheParent = new A();</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public B()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TheParent.Coll.Add(this);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp; class BCollection : BusinessListBase&lt;BCollection, B&gt;<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp; }</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp; class Program<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B b = new B();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b.BeginEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b.TheParent.BeginEdit(); // causes UndoException<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp; }<BR>}<BR></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 11, 2008</h2>Well, databinding has to be done in a very particular way, or it won't work.&nbsp; The exception you're getting is to bring these errors to light, so that you can more easily find the problem.&nbsp; You should never get the exception if you're databinding is setup properly... the order does matter.&nbsp; See the ptracker, which should illistrate what the rules are.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
