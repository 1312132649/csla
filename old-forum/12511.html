<html><header><title>SafeDataReader returning null values?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SafeDataReader returning null values?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12511.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>GaryG posted on Wednesday, March 19, 2014</h2><p>I had assumed that SafeDataReader would convert any null strings coming from SQL Server into String.Empty.<br /><br />But after finding some app exceptions logged, I have confirmed that null values from the database are being set to Nothing (vb.net) in their properties. I don&#39;t want to have to deal with null/Nothing in string properties.<br /><br />Am I doing something wrong?<br /><br />The code I am using was generated by CodeSmith, using encapsulated implementation. It uses a SafeDataReader, and in this case it passes it to a Map routine. <br /><br />Something like this:<br /><br />LoadProperty(_LongDescriptionProperty, reader.Item(&quot;LongDescription&quot;))</p>
<p>Will break my app if I try something like:<br /><br />Foo.LongDescription.Trim, because it will throw an exception.<br /><br />Am I doing something wrong? I&#39;d hate to have to write a bunch of code to check for null values, and convert them to empty strings.</p>
<p>Thanks.<br /><br />FWIW, I&#39;m a longtime user of CSLA (since VB6 days). Not on every project, but on quite a few, in different industries. It&#39;s a great tool.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, March 19, 2014</h2><p>Hi,</p>
<p>I would like to see more of your code and how you use SafeDataReader. </p>
<p>If you use <b><i>reader[&quot;LongDescription&quot;]</i></b> - the method returns an object and YOUR CODE is responsible for conversion and/or null check.<br />If you use <b><i>reader.GetString(&quot;LongDescription&quot;)</i></b> - the method knows which type to return and will always return a string value (assuming the underlying DataReader correctly identifies the value as null, ie IsDBNull returns true). </p>
<p>This is the actual code: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">object</span>&nbsp;<span style="color:blue;">this</span>[<span style="color:blue;">string</span>&nbsp;name]
{
&nbsp;&nbsp;<span style="color:blue;">get</span>
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">object</span>&nbsp;val&nbsp;=&nbsp;_dataReader[name];
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(<span style="color:#2b91af;">DBNull</span>.Value.Equals(val))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;val;
&nbsp;&nbsp;}
}<br /><br /><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;GetString(<span style="color:blue;">string</span>&nbsp;name)
{
&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;GetString(_dataReader.GetOrdinal(name));
}
 
<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">virtual</span>&nbsp;<span style="color:blue;">string</span>&nbsp;GetString(<span style="color:blue;">int</span>&nbsp;i)
{
&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(_dataReader.IsDBNull(i))
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">string</span>.Empty;
&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;_dataReader.GetString(i);
}</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GaryG replied on Wednesday, March 19, 2014</h2><p>Thanks, JonnyBee. I&#39;ll test that out when I get back to my office, but I&#39;m pretty sure that&#39;s exactly the problem.<br /><br />The CodeSmith template generated code like this:</p>
<p>LoadProperty(_FooProperty, reader.Item(&quot;Foo&quot;))</p>
<p>Instead of:</p>
<p>LoadProperty(_FooProperty, reader.GetString(&quot;Foo&quot;))</p>
<p>Looks like I&#39;ll have to modify the CodeSmith template for this too.</p>
<p>fyi, I&#39;m new to version 4.3 (coming from 2.x a few years ago), and still learning the Ins and Outs.<br /><br />Thanks for the heads-up.</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
