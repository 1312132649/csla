<html><header><title>Exposing rules of child to the parent.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Exposing rules of child to the parent.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3267.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Santa posted on Thursday, July 26, 2007</h2>Hi<br><br>I have read through many posts on this forum on the subject and am still unclear on the best way to do this.<br><br>Basically I have a parent object A and Child B.&nbsp; B is a list of items say C.<br><br>I have created rules for A and C and want to display errors on my UI if A is not valid ( A is invalid if any of C is invalid).<br><br>After testing for A is valid I want to loop through the BrokenRulesCollection and display the appropriate errors.&nbsp; But I dont want to have to go through the broken rule collection for each of the children.&nbsp; So my question is how store brokenrulecollection for all of my child objects inside A.<br><br>Thanks<br><br>Santa<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, July 26, 2007</h2><P>There was a post somewhere were Rocky was explaining why he he did not return the broken rules of children (can't find the post but it did exist :-) ).<BR>But the questions is why don't you want to loop through all the broken rules of your children? Your object A knows all its children (B, &lt;other children&gt;&nbsp;etc) so you can just override the BrokenRules property or you can provide a public method that returns a string with the description of all your errors (including these of the children) to be displayed on your UI.<BR>If you do that on object A, you only do so once (if you want to be fancy you can have a base class and with reflection check for broken rules on all your children but I can imagine that complicated) and in 1 location so that's not so bad...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Santa replied on Thursday, July 26, 2007</h2>hmmm, thanks, I think I read Rocky's post.<br><br>I dont really want to return the broken rules as a string.&nbsp; I want to return the BrokenRuleCollection itself as my UI template is designed around this.<br><br>Rocky mentions to subclass BusinessBase to try and add this functionality.&nbsp; Now some of principles of OO are still a bit above me so this might be a load of rubbish, but here is what I was thinking.<br><br>I could subclass BusinessBase and in here use the singleton pattern to create a BrokenRuleCollection and have all my objects add rules to this collection.&nbsp; The problem is that the BrokenRuleCollection class cannot be instanciated because it is internal.&nbsp; So would I have to create my own BrokenRuleCollection which inherits from the Csla BrokenRuleCollection but has a public constructor?&nbsp; Any help appreciated.<br><br>Maybe I should just settle for returning a string I've been looking at this for too long, but I think this will create other issues later on.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, July 26, 2007</h2><P>I think Joe's advice is sound but since I am also not fluent with some OO principles just a piece of advice. Extedning BusinessBase, though very important, is not that trivial and if not done properly (I am still paying the price&nbsp;for old design mistakes and trying to get them right) can lead to the need to refactor at some stage. It might be worth you reading the relevant posts about extending BusinessBase before embarking on your venture. They will be useful for your case but also prepare you for other issues you might encounter :-)<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, July 26, 2007</h2><P>I use the base class method to list out all the broken rules of a root BO and all of its contained BOs. I think I have posted it before. It was based on the 1.x implementation of AllRules.vb. I think I might have called it GetAllBrokenRulesString or something like that (if you want to look for it.)</P>
<P>Your Root BO can get the list of broken rules from its children by looping over each of them and getting the string. Your requirement for NOT looping is artificial and you should forget it.</P>
<P>There is a small framework problem though.</P>
<P>Rocky's IsValid stops evaluating the broken rules for a collection the moment it finds a problem.</P>
<P>So if you have 10 items in the list and the 1st item is invalid you won't know the real state of the next 9 items if you use the framework. I sometimes add calls to CheckRules in my child BOs IsValid method so that a final check is done before determing the list of broken rules. (e.g. a user could have changed a value to unbreak a general rule.)</P>
<P>In my base class that inherits from the framework I override IsValid like this:</P><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'JF 9/14/2006 - override CSLA2 code to look like this - no short circuiting involved here.<BR></FONT><FONT color=#008000 size=2>'run through all the child objects and if any are invalid then the collection is invalid<BR></FONT><FONT color=#008000 size=2>'call IsValid on all children so that when we examine Broken Rules we get the right set of values.<BR></FONT><FONT color=#008000 size=2>'Rocky stopped looping after he found the first invalid child.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> IsValid() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2>&nbsp;<BR></FONT><FONT size=2>&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> result </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>True<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> child </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> C </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> child.IsValid </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>result = </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Next<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> result<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
