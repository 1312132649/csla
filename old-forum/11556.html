<html><header><title>CSLA unit testing MVC no DAL</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA unit testing MVC no DAL</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11556.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend posted on Tuesday, August 28, 2012</h2><p>I&#39;m new to CSLA, and also unit testing in general, yet I&#39;m newly assigned to a project that uses CSLA and they want to now write unit tests for it, and I&#39;m lost. </p>
<p>The project is a ASP.NET MVC 3 (c#) application, with a csla library that has umm inline? dataportal methods. The actual data fetching is done in the csla business object itself, there is no DAL, just calls to SQL stored procedures right in the object that then call LoadProperty. It seems like this is not possible to unit test I can&#39;t mock the csla objects and I have no DAL, is this true does it need to be totally refactored\rewritten? Or am I missing some approach? To get a bit more specific, I have an HTML helper method that takes one of my csla objects and returns and MVCHtmlString, I want to test what the helpers is doing how can I accomplish this? Any help, or samples you can post me to is appreciated.</p>
<p>&nbsp;</p>
<p>------</p>
<p>Not to get off topic but I&#39;m also failing to see the point of using CSLA in a scenario like this where it will always be an asp.net web app connecting to a MSSQL database, its not using any of the power of the dataportal and its ntier-ed abbstraction-ness right? It could use some of the authorization stuff or validation rules of CSLA (but it doesn&#39;t appear to be) I feel like if I&#39;m allowed to refactor\rewrite it I would be better off not using CSLA at least for this app and given my unfamiliarity with CSLA, thoughts? Thanks.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, August 28, 2012</h2><p>You are correct that you&#39;ll need to refactor the DataPortal_XYZ methods to invoke a DAL so you can create a mock DAL for testing. That is usually not terribly difficult, but it does require repetative effort.</p>
<p>In terms of the value of CSLA, there are a few primary benefits. CSLA</p>
<ul>
<li>helps shield you from changes to data access technologies over time</li>
<li>helps shield you from UI technology changes over time</li>
<li>imposes a consistent architecture and coding approach that improves maintainabilty through consistency</li>
<li>allows switching from your current 2-tier to a 3-tier deployment without code changes (sometimes important if you get audited for SOX or HIPPA or similar regulatory requirements)</li>
<li>defines a formal &quot;home for business logic&quot; including validation, business rules, calculations, authorization rules, etc.</li>
<li>helps you create a reusable business layer that is often useful when your future requirements end up including a service interface or mobile interface in addition to your existing web interface</li>
</ul>
<p>I recognize that many of those benefits are long-term. Personally I&#39;m OK with that, because the real cost of software isn&#39;t in its original creation. It is in the cost of maintaining and updating the software over&nbsp;the typical 7-15 year timeframe during which that software is in use.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend replied on Tuesday, August 28, 2012</h2><p>Thanks very much for the reply!,</p>
<p>Still a little unclear how I would test my HTML Helper example thouhg. My CSLA obejct would be using the mock DAL thats cool, but how would I get an instance of my CSLA object for the helper or should I rework the helper to take a DTO? I could make an instance with the &#39;top&#39; object, but it has children objects that don&#39;t really &nbsp;have a creation method, if that makes sense. So my top object has a topObject.NewTop(); but its children I just call topObject.Childrens.AddNew(), so I&#39;d have to create a top object then call its .Childrens.AddNew() to get my child csla instance. Is that the right approach or should I use the DTO?</p>
<p>Thanks.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, August 29, 2012</h2><p>Hi, </p>
<p>You may want to look at the MEF Sample projects in CslaContrib that show sample on how to plug in DataAccess in either DataPortal_XYZ methods or use the ObjectFactory pattern. This sample shows usage of Repository pattern and ObjectFactory pattern. Goto source code and download the latest source code.</p>
<p>In order to achieve this - be prepared to refactor the SQL code to another layer and just return a IDataReader - that can be mock&#39;ed to return fake data.You can create a mockable datalayer by using IDataReader as a contract to the database. (This is not shown in the MEF sample tho&#39; - but search the forum as there has been a few threads on this.)</p>
<p>You can get a child object also by either using <i>DataPorta.CreateChild with parameters</i> or add <i>public static factory methods</i> or <i>public constructor.</i> CSLA has typically had private constructor to force the use of factory methods but with the limits imposed from SL we now tend to make all the constructors public.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend replied on Wednesday, August 29, 2012</h2><p>Great, thanks for all the help,&nbsp;&nbsp;it&nbsp;sounds like&nbsp;I have a fair amount of work to do, simple and repetative as it may be, but it makes sense to me now, Thanks!</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
