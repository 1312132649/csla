<html><header><title>How to let users make changes that need approval before comitted?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to let users make changes that need approval before comitted?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8795.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 posted on Monday, April 12, 2010</h2><p>Hi Everyone,</p>
<p>This isn&#39;t directly CSLA related, but I&#39;m using the framework and I know there are a lot of smart people here.&nbsp; My scenario is the following.&nbsp; I have two types of users in a system &quot;Admin&quot; and &quot;Researcher&quot;.&nbsp; The researcher is allowed to make changes to an existing record in a database, but the change should not show up in the official record until it has been &quot;approved&quot; by and admin.&nbsp; </p>
<p>Has anyone dealt with something like this in the past?&nbsp; I&#39;m not sure where to start.&nbsp; Any suggestions greatly appreciated.</p>
<p>Here is a scenario.&nbsp; There is a Person table and Person object.&nbsp; The Person table has a record that looks like the following</p>
<p>ID&nbsp;&nbsp;&nbsp;&nbsp; FirstName&nbsp;&nbsp;&nbsp; LastName<br />1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; John&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Doe</p>
<p>The Researcher changes &quot;John&quot; to &quot;Jane&quot;, but this change shouldn&#39;t show up until it has been approved.</p>
<p>Thanks for any insight!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ozitraveller replied on Monday, April 12, 2010</h2><p>Hi&nbsp;<span>reagan123</span></p>
<p>There is also the problem with concurrency around this issue and how long can a record stay in a dirty state waiting for &#39;approval&#39;?</p>
<p>There are probably a number of ways to do this:</p>
<p>1. duplicate table (BO) and the duplicate is used to lock the original from change until the updated record is approved or rejected.</p>
<p>2. another table that only contains the diff (fields that have been changed) also used for locking the original record.</p>
<p>3. flag the record, with a new field, that when approved/rejected is set off</p>
<p>&nbsp;</p>
<p>cheers</p>
<p>Just a few thoughts :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, April 13, 2010</h2><p>From a generic standpoint, the easiest way to manage this is to have a set of &quot;staging tables&quot; that hold the pending changes.&nbsp; Then when your administrator approves the change, it&#39;s copied over to your final tables.&nbsp; Those staging tables can take a couple&nbsp;different forms, from copies of your originals to a single table that holds&nbsp;nothing but changes.&nbsp;&nbsp;But&nbsp;I would have some questions:</p>
<p>1. Do you allow unapproved changes to &quot;stack up&quot;?&nbsp; For example, if I change the record from &quot;John&quot; to &quot;Jane&quot;, and then - before my change is approved - someone else changes it from &quot;John&quot; to &quot;Jack&quot;, what happens?</p>
<p>2. Or, what happens if the person after me changes &quot;Doe&quot; to &quot;Smith&quot;?</p>
<p>3.&nbsp;As an alternative, if someone wants to change something that has a pending change already, do they see other users&#39; pending changes (thus eliminating the potential concurrency issue)?&nbsp; And thus, would a researcher be allowed to change my &quot;John-to-Jane&quot; change to a &quot;John-to-Jack&quot; change?&nbsp; Or would it have to be a &quot;John-to-Jane-to-Jack&quot; change?&nbsp; That may be a semantic thing, but it could be an important difference.</p>
<p>4. What happens to pending changes after they are approved?&nbsp; Do they need to be kept around for auditing/history purposes?</p>
<p>Yes, some of these are basic concurrency questions.&nbsp; But the answers to them could provide some insight on what the staging tables might look like.</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Tuesday, April 13, 2010</h2><p>This is also a good scenario for using workflow.&nbsp; Workflows work great for long lived objects that contain state (such as approved/pending), etc.&nbsp; At the database level you could add a status column and when the user requests approval, change the status to pending approval.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Tuesday, April 13, 2010</h2><p>Thanks for the input so far.&nbsp; I&#39;m definitely still trying to work out all of the different scenarios.&nbsp; I&#39;ll come back with some more details.</p>
<p>Thanks so far!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 14, 2010</h2><p>In line with the workflow concept, you&#39;d likely have some objects who&#39;s only job is to move the item from one stage of the workflow to the next.&nbsp; Each stage in the workflow may actually have different objects.&nbsp; For example, I have&nbsp;a workflow which starts with Quotes to Orders to Invoices, and to move from one to the next I have a QuoteConverter and OrderConverter, which are BOs in their own rights with validation rules (usually tied to the state of the relevent document).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
