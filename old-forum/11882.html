<html><header><title>DalFactory NullReferenceException - Type.GetType(&quot;string type&quot;) returning null</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DalFactory NullReferenceException - Type.GetType(&quot;string type&quot;) returning null</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11882.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mar72Vin posted on Friday, March 15, 2013</h2><p>Hi All,</p>
<p>I&#39;m am using a DalFactory (shown below) but Type.GetType(dalTypeName); always returns null. The only way I am able to make it work is by adding a reference to the &quot;MyProject.DalSql&quot; project from &quot;MyProject.Dal&quot;</p>
<p>I also need to instantiate an object of the type first; e.g. MyProject.DalSql.DalManager _dalmanager = new MyProject.DalSql.DalManager(); before the Type.GetType will work as expected.</p>
<p>&nbsp;</p>
<p>Does anyone have any idea why this might be happening?</p>
<p>&nbsp;</p>
<p>Thanks in advance!</p>
<p>&nbsp;</p>
<p>//from web.config file.</p>
<p>&lt;add key=&quot;.DalManagerType&quot; value=&quot;MyProject.DalSql.DalManager, MyProject.DalSql, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot;/&gt;</p>
<p>// I have also simply tried with the same result</p>
<p>&lt;add key=&quot;.DalManagerType&quot; value=&quot;MyProject.DalSql.DalManager, MyProject.DalSql/&gt;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>(namespace MyProject.Dal)</p>
<p>public static class DalFactory<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static Type _dalType;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;Gets the&nbsp; DAL manager type that must be set<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// in the &lt;strong&gt;appSettings&lt;/strong&gt; section of the application .config file.&lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;returns&gt;A new &lt;see cref=&quot;IDalManager&quot;/&gt; instance&lt;/returns&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static IDalManager GetManager()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_dalType == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //dodgy work around//MyProject.DalSql.DalManager _dalmanager = new MyProject.DalSql.DalManager(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dalTypeName = ConfigurationManager.AppSettings[&quot;.DalManagerType&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!string.IsNullOrEmpty(dalTypeName))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _dalType = Type.GetType(dalTypeName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new NullReferenceException(&quot;.DalManagerType&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_dalType == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new ArgumentException(string.Format(&quot;Type {0} could not be found&quot;, dalTypeName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (IDalManager) Activator.CreateInstance(_dalType);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mar72Vin replied on Tuesday, July 02, 2013</h2><p>Has anyone else experienced anything like this?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, July 02, 2013</h2><p><div style='padding-left: 50px;background-color:silver'><b>Mar72Vin<br></b></p>
<p>I&#39;m am using a DalFactory (shown below) but Type.GetType(dalTypeName); always returns null. The only way I am able to make it work is by adding a reference to the &quot;MyProject.DalSql&quot; project from &quot;MyProject.Dal&quot;</p>
<p></div></p>
<p>When you have no direct reference to the DalSql assembly it is not copied to your bin folder and thus not available for your application. Then when you add a reference it will be copied to the output folder by the compiler. You must make sure to get all the necessary assemblies into the bin folder of your app - with the correct build/version number so they can be loaded.&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mar72Vin replied on Thursday, July 04, 2013</h2><p>JonnyBee, you are absolutely right! I can&#39;t believe I missed that.</p>
<p>What method do you use to ensure the correct version is copied to your bin folder during development? </p>
<p>e.g. in an MVC application an easy solution would be to just add MyProject.DalSql project as a reference, but that kind of defeats the purpose of separating the data access from the front end developer.</p>
<p>Adding the reference to MyProject.Dal creates a circular reference.</p>
<p>Do you just use a Post Build event and copy the file to the correct location?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, July 04, 2013</h2><p>Yes,either a post build script or as part of the build script (I typically use TFS). </p>
<p>If you crate an installer package you must also make sure to add the DAL to the deploy assemblies.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mar72Vin replied on Thursday, July 04, 2013</h2><p>Thanks JonnyBee! your a champion!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
