<html><header><title>Alternative to timestamp for Optimistic Concurrency for MySql ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Alternative to timestamp for Optimistic Concurrency for MySql ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2295.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>antoan posted on Wednesday, February 07, 2007</h2>The database of the sample project PTracker,  in the book,  makes use of tables with 'timestamp' columns to implement optimistic concurrency control. <br /><br />Can anyone suggest a way to do the same on mysql, since it does not support the same kind binary timestamp datatype?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, February 07, 2007</h2><P>Does it have any sort of trigger concept. That's the old-style solution: put an update trigger on the table to increment a column value on each update. In concept that's all the "timestamp" type does in SQL Server, though it is far more performant than using triggers.</P>
<P>Failing that, you might need to just ensure that all your stored procedures do an increment of a column value. That not ideal, because forgetting to include that in a sproc will result in badness, but technically it could work.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam replied on Thursday, February 08, 2007</h2><P>Hi there,</P>
<P>Here's information for MySql. From version 5.0.* there are triggers&nbsp;so you can do as Rocky said, but if you don't need high resolution (less then one second) you can use DateTime or TimeStamp field and treat it as other columns. Just pay attention what happens if you don't have application server or time synchronisation on clients, because of the problem with different clock settings.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vaidal replied on Friday, February 09, 2007</h2><P>We don't use timestamp because we don't need it. We use a byte datatype and the update sproc look like this:</P><FONT color=#0000ff>
<P></FONT><FONT size=2><FONT face="Courier New"><FONT color=#0000ff>PROCEDURE</FONT> usp_MyTable_UPD <FONT color=#808080>(</FONT>@IdMyTable int, @Description nvarchar(100)<FONT color=#808080>,&nbsp;</FONT>@RowVersion <FONT color=#0000ff>tinyint</FONT> <FONT color=#0000ff>OUTPUT</FONT><FONT color=#808080>) </FONT></FONT></FONT><FONT color=#0000ff><FONT face="Courier New" size=2>AS</FONT></P>
<P><FONT face="Courier New" size=2>DECLARE <FONT color=#000000>@NewRowVersion</FONT> </FONT></P>
<P><FONT size=2><FONT face="Courier New">SET <FONT color=#000000>@NewRowVersion = (</FONT><FONT color=#0000ff>CASE WHEN</FONT> <FONT color=#000000>@RowVersion </FONT><FONT color=#000000>= </FONT><FONT color=#000000>255</FONT> THEN <FONT color=#000000>0 </FONT>ELSE <FONT color=#000000>@RowVersion</FONT><FONT color=#000000>+</FONT><FONT color=#000000>1</FONT> END<FONT color=#808080>)</FONT></FONT></FONT></P>
<P><FONT face="Courier New" size=2>UPDATE</FONT></FONT><FONT size=2><FONT face="Courier New"> MyTable <FONT color=#0000ff>SET </FONT>Description <FONT color=#808080>= </FONT>@Description <FONT color=#808080>,</FONT> RowVersion <FONT color=#808080>= @<FONT color=#000000>NewRowVersion </FONT></FONT><FONT color=#808080></P></FONT></FONT></FONT><FONT color=#0000ff>
<P><FONT face="Courier New" size=2>WHERE </FONT></FONT><FONT face="Courier New" color=#000000 size=2>IdMyTable </FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000>= @</FONT><FONT color=#000000>IdMyTable</FONT></FONT></FONT></A><FONT size=2><FONT face="Courier New"><FONT color=#000000>&nbsp;</FONT><FONT color=#0000ff>AND</FONT><FONT color=#000000> RowVersion = </FONT><FONT color=#000000>@RowVersion</FONT> </FONT></FONT></P><FONT color=#0000ff>
<P><FONT face="Courier New" size=2>IF</FONT></FONT><FONT size=2><FONT face="Courier New">&nbsp;<FONT color=#ff00ff>@@rowcount</FONT><FONT color=#808080>&gt;</FONT>0 <FONT color=#0000ff>SET </FONT><FONT color=#000000>@RowVersion</FONT></FONT></FONT></A><FONT size=2><FONT face="Courier New"> <FONT color=#808080>= </FONT>@NewRowVersion</FONT><FONT color=#0000ff> </FONT></FONT></P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P>
<P><FONT color=#000000>As you can figure, we have a DAL layer that checks if RowVersion changes on every update.</FONT></P>
<P><FONT size=2><FONT color=#0000ff></FONT><FONT color=#808080>&nbsp;</P></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
