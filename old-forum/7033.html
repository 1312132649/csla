<html><header><title>WPF Datagrid validation throw &quot;Edit level mismatch in UndoChanges&quot; exception when cancel</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WPF Datagrid validation throw &quot;Edit level mismatch in UndoChanges&quot; exception when cancel</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7033.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>steven99 posted on Monday, June 01, 2009</h2>I found a problem when binding with Datagrid(WPF ToolKit).<br>If I make a validation error in one of the cell. It will throw "Edit level mismatch in UndoChanges" exception when I click Cancel. <br><br>It can be reproduced in ProjectTracker sample: <br>Add reference to WPFToolKit to PTWpf project<br>Add this namespace to beginning of RolesEdit.xaml<br>xmlns:toolkit="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit"<br>Then add the following code to RolesEdit.xaml<br>&lt;toolkit:DataGrid AutoGenerateColumns="False" ItemsSource="{Binding}"/&gt;<br>&nbsp; &lt;toolkit:DataGrid.Columns&gt;<br>&nbsp;&nbsp;&nbsp; &lt;toolkit:DataGridTextColumn Binding="{Binding Id,ValidatesOnDataErrors=True}" /&gt;<br>&nbsp;&nbsp;&nbsp; &lt;toolkit:DataGridTextColumn Binding="{Binding Name,ValidatesOnDataErrors=True}" /&gt;<br>&nbsp; &lt;/toolkit:DataGrid.Columns&gt;<br>&lt;/toolkit:DataGrid&gt;<br><br>Run the project and "Log in", and then "Edit roles"<br>First edit the role Name so that Cancel button is enabled<br>Then edit the role Id to same value as another row. <br>Click Cancel button, an exception will be thrown in this line:<br>if (this.EditLevel - 1 != parentEditLevel)<br>&nbsp; throw new UndoException(string.Format(Resources.EditLevelMismatchException, "UndoChanges"));<br>where this.EditLevel=2 but parentEditLevel=0<br><br>I think it is the problem of Datagrid. But maybe a workaround in CslaDataProvider or UndoableBase may fix that. <br>Does anyone have any workaround?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 02, 2009</h2><P>It sounds like a problem in the datagrid control - they should be calling IEditableObject.CancelEdit() (or EndEdit()) when focus leaves the row, thus bringing the child object's edit level to the same as the collection.</P>
<P>This sort of issue usually can't be fixed by CSLA, because it is a UI layer bug. If the UI doesn't tell the business object what it is doing (which would be done by calling one of those methods) then the business layer really can't do anything.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
