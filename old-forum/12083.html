<html><header><title>Run rule only if property value has changed since loaded</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Run rule only if property value has changed since loaded</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12083.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, July 22, 2013</h2><p>I have a rule that should only run if the property value has changed since the object was fetched from the database.&nbsp; I do need to call CheckRules though before the end of the DP_F method.</p>
<p>Is there a way to suppress just this one rule from CheckRules?&nbsp; </p>
<p>If not, I was thinking of creating a PropertyInfo field and private instance property who&#39;s only purpose is to hold the value from the DB, and the rule would use this value as one of the input properties to determine if it should run or not.&nbsp; Would there be anything wrong with such an approach?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cfarren replied on Monday, July 22, 2013</h2><p>Hey,</p>
<p>You can use the FieldManager.IsFieldDirty method. The rule will still run but if you add this check in the rule before any validation occurs you can exit the rule unless the field has been changed and is marked as dirty.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, July 23, 2013</h2><p>
<p><span>If your rule inherits from CommonBusinessRule you can set</span></p>
<p><span>CanRunOnServer = &nbsp;false</span></p>
<p><span>and the rule will be excluded when called in the logical serverside of the DataPortal (Data Access layer)</span></p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, July 23, 2013</h2><p>Thanks Jonny, that&#39;s good to know.&nbsp; If the rule has to be a ValidationAttribute (so that I can write an adapter to emit JS validation in MVC), do you see any problem with the BO storing the original value as a property?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, July 23, 2013</h2><p>Well, the problem is that you cannot set CanRunOnServer on a DataAnnotation rule. </p>
<p>DataAnnotation rules is wrappen in a Csla rule and the automated add will add these with all default values (including Priority = 0).</p>
<p>You _could_ however create the rule as a CSLA rule and then add a Dummy/Empty DataAnnotation rule to emit the JS Validation.&nbsp;</p>
<p>You may also want to look at the CustomFieldData from Jason Bock. One of the implementations is to have a BackingField that stores the old original field and the edited value to make a proper check if the field has been changed. An updated version of this is available in source of CslaContrib. &nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
