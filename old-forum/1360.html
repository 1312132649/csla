<html><header><title>OnSaved event in CSLA.NET 2.1 RC</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OnSaved event in CSLA.NET 2.1 RC</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1360.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom posted on Friday, September 29, 2006</h2><P>I'm having a difficult time getting the Saved event from the BusinessBase to fire (or capture it anyway)</P>
<P>I have a Customer object with the Save method overridden</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2> Save()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (IsDeleted &amp;&amp; !CanDeleteObject())</P>
<P></FONT><FONT color=#0000ff size=2>throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2>SecurityException</FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2>"User not authorized to remove a Customer"</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (IsNew &amp;&amp; !CanAddObject())</P>
<P></FONT><FONT color=#0000ff size=2>throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2>SecurityException</FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2>"User not authorized to add a Customer"</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!CanEditObject())</P>
<P></FONT><FONT color=#0000ff size=2>throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2>SecurityException</FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2>"User not authorized to update a Customer"</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>base</FONT><FONT size=2>.Save();</P>
<P>}</P>
<P>In my form I wire up the event like this</P><FONT size=2>
<P>_customer.Saved += </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>EventHandler</FONT><FONT size=2>&lt;Csla.Core.</FONT><FONT color=#2b91af size=2>SavedEventArgs</FONT><FONT size=2>&gt;(_customer_Saved);</FONT></P><FONT size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> _customer_Saved(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> sender, Csla.Core.</FONT><FONT color=#2b91af size=2>SavedEventArgs</FONT><FONT size=2> e) {</P>
<P></FONT><FONT color=#0000ff size=2>throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Exception</FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2>"The method or operation is not implemented."</FONT><FONT size=2>);</P>
<P>}</P>
<P>When I make changes to the customer and save, it saves fine, but does not call the _customer_Saved method.</P>
<P>Am I doing anything wrong here?</FONT></FONT><FONT size=2></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Friday, September 29, 2006</h2><P>Ok, I found my problem.&nbsp; I was following the recommended save routing in the book.</P><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>Customer</FONT><FONT size=2> temp = _customer.Clone();</P>
<P>temp.ApplyEdit();</P>
<P></FONT><FONT color=#0000ff size=2>try</FONT><FONT size=2> {</P>
<P>_customer = temp.Save();</P>
<P>_customer.BeginEdit();</P>
<P>So I'm actually calling the save on the clone which hasn't been wired up.&nbsp; So now I just need to figure the best way to wire the save event up in some usercontrols on the form that also have the customer object passed to them.</P>
<P>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 29, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Curelom:</strong></div><div><p>Ok, I found my problem.&nbsp; I was following the recommended save routing in the book.</p><font size="2"></font></div></BLOCKQUOTE><br><br>Ahh, you should know, then, that there's errata about that. There are some issues with data binding when following that approach, and so you probably want to look at PTWin in version 2.1 and follow the new model in ProjectEdit.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Friday, September 29, 2006</h2>Thanks for the heads up.<img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />&nbsp; I've created an EndEdit method for each of my controls on the form that I call before I save, to EndEdit any bindingsources in them.&nbsp; I then listen for the DataSourceChanged event that fires when I rebind.&nbsp; It's working good so far.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 29, 2006</h2>I just tested both the VB and C# frameworks, and the event does work.<br><br>My guess is that you aren't hooking the event properly - or from the correct object. You can't hook the event until after you've created the instance of the object with which you are going to work, and of course you need to rehook the event after the Save() call, because you then have a new object with a new event hookup.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
