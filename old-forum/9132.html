<html><header><title>CSLA 3.8.4 beta release</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.8.4 beta release</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9132.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka posted on Friday, June 25, 2010</h2><div>
<p>CSLA .NET 3.8.4 is now available as a beta download. This is mostly a bug fix 
release to address a few issues from 3.8.3, plus some ASP.NET MVC work.</p>
<p>Version 3.8.4 targets .NET 3.5 and Silverlight 3 (though with a little effort 
it works with Silverlight 4 as well).</p>
<p>See the change log for a list of changes. There aren&rsquo;t many, but if they 
affect you then they are important.</p>
<p>The only feature change in 3.8.4 is that most of the new ASP.NET MVC 2 
support from CSLA 4 has been back-ported to 3.8. This means that the 
Csla.Web.Mvc project now targets and supports ASP.NET MVC 2, and provides more 
features and functionality that was there in 3.8.3.</p>
<ul>
<li><a href="http://www.lhotka.net/cslanet/download.aspx">Download for 
Windows</a></li>
<li><a href="http://www.lhotka.net/cslalight/download.aspx">Download for 
Silverlight</a></li>
</ul>
<p>This is a stable beta, given the small number of changes (other than the MVC 
support). So if you are affected by any of the issues listed in the change log I 
strongly recommend moving from 3.8.3 to 3.8.4 beta to test and utilize the 
changes.</p>
</div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Friday, June 25, 2010</h2><p>Well done with all the hard work and the excellent improvements that come with CSLA4 !!<br />We really appreciate your efforts and commitment to CSLA.</p>
<p>I have a quick question, regarding your blog post regarding CSLA v3.8.4. You stated that v3.8 targets Silverlight 3 &ldquo;(though with a little effort it works with Silverlight 4)&rdquo;.</p>
<p>Where can I find more information about specifically what the changes for Silverlight 4 is? I was unable to track down what I need to do to move a CSLA 3.8 project targeting Silverlight 3 to Silverlight 4 from a CSLA perspective. </p>
<p>Thanks,<br />Jaans</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, June 29, 2010</h2><p>*Bump*</p>
<p>I&#39;m using 3.8.x in Silverlight 4 and would really appreciate any input on any work I need to do better support this version of CSLA in SL4.</p>
<p>Although I haven&#39;t seen any obvious issues and it appears to be working fine, I&#39;d really like to avoid them before I&#39;ve deployed to my customers.</p>
<p>Many thanks</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 29, 2010</h2><p>If it works then it works <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>3.8 officially targets .NET 3.5 SP1 and SL3. Using it in .NET 4 and SL4 is fine, but isn&#39;t something I currently plan to spend time on myself.</p>
<p>(though I&#39;ve given some thought to a 3.9 that does target .NET 3.5 SP1 and SL4 in VS10 - but even that will be a straight update done to save people the trouble of doing the solution upgrade necessary to use 3.8 now)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, July 01, 2010</h2><p>Did&nbsp;a deployment today and it turns out there we&#39;re quite a couple issues:</p>
<ul>
<li>Had to change the scope of my Static PropertyInfo variables to public. This doesn&#39;t potentially expose information that should be private does it?<br />(as per <a href="http://forums.lhotka.net/forums/t/8914.aspx">http://forums.lhotka.net/forums/t/8914.aspx</a>)</li>
<li>Took me a wasted 4 hours to figure out that my code using the Csla.Data.ConnectionManager&lt;T&gt; to manage my database connections wasn&#39;t working correctly in Release builds. Strangely, it didn&#39;t throw an exception, but my application kept giving me an invalid password for the sa user account. Not sure what the connection&#39;s value ended up as, but it&#39;s definitely screwed up in release builds.<br /><br />Rocky: Any idea here?<br /><br />PS: This may be something else that I&#39;m just not spotting. This is some annoying issue that works in Debug build but not Release, but not sure how it&#39;s relevant since it&#39;s server side .NET code (as far as the ConnectionManager&lt;T&gt; is concerned), so I may be missing something here. </li>
</ul></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 01, 2010</h2><p>My recommendation in CSLA 4 is that the PropertyInfo&lt;T&gt; fields be public. This is basically a requirement for Silverlight, and should be done in .NET for consistency.</p>
<p>It is likely that there is an exception from the connection issue, but somewhere your code isn&#39;t checking the async e.Error result value. I sometimes forget to check it too - just use e.Object and don&#39;t check e.Error - but that&#39;s actually a bug, because when an error does occur it is basically invisible...</p>
<p>This is a case, btw, where having a custom ViewModel&lt;T&gt; base class is helpful. Once you know how your UI works (in terms of displaying error info), you can override the on error method in your viewmodel base class and properly handle the error. That covers almost all the async data portal error issues you are likely to encounter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, July 01, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>My recommendation in CSLA 4 is that the PropertyInfo&lt;T&gt; fields be public.</div></p>
<p>Should we go ahead and start making the PropertyInfo&lt;T&gt; fields Public in Csla 3 also?&nbsp; Sooner or later I have to move to Csla 4.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 01, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>Jav<br></b></p>
<p>[quote user=&quot;RockfordLhotka&quot;]My recommendation in CSLA 4 is that the PropertyInfo&lt;T&gt; fields be public.</div></p>
<p>Should we go ahead and start making the PropertyInfo&lt;T&gt; fields Public in Csla 3 also?&nbsp; Sooner or later I have to move to Csla 4.</p>
<div style="clear:both;"></div>
<p></div></p>
<p>I make them public in 3.8 when building SL apps, yes. It is simpler/safer than the _forceInit hack.</p>
<p>In 3.8 there&#39;s a tiny risk - if someone tampered with the Index property (I think that&#39;s the one) they&#39;d mess up serialization or worse. In CSLA 4 that property isn&#39;t public, so that risk is essentially eliminated. But I think it is a small risk anyway - who&#39;s really going to start messing around with those fields?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Thursday, July 01, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>who&#39;s really going to start messing around with those fields?</div></p>
<p>Not me - no way.&nbsp;:)&nbsp; And&nbsp;I am SL all th way.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Wednesday, July 14, 2010</h2><p>Hi Rocky</p>
<p>I just came across another issue that popped up as a result of making the static PropertyInfo&lt;T&gt; fields public.</p>
<p>I get the following exception:</p>
<p style="padding-left:30px;">Csla.PropertyLoadException was unhandled by user code<br />&nbsp; Message=Property load or set failed for property WorkOrderId (Attempt by method &#39;Csla.Core.FieldManager.FieldDataManager.ForceStaticFieldInit(System.Type)&#39; to access field XXXX+Criteria.IdProperty&#39; failed.)<br />&nbsp; StackTrace:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.ManagedObjectBase.LoadProperty[P](PropertyInfo`1 propertyInfo, P newValue)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at XXXX.Criteria.set_Id(Int32 value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at XXXX.Criteria..ctor(Int32 Id, Nullable`1 ______Date)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at XXXX.GetChild(YYYY yyyy, EventHandler`1 callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at YYYY.RefreshXXXXAfter______DateChange(YYYY yyyy, RuleArgs ruleArgs)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Validation.RuleMethod`2.Invoke(T target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Validation.RuleMethod`2.Csla.Validation.IRuleMethod.Invoke(Object target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Validation.ValidationRules.CheckRules(List`1 list)</p>
<p>We have for quite some time now, been declaring our Criteria classes as nested classes inside our business object and have it scoped to be internal. Also, we use managed PropertyInfo&lt;T&gt; properties for our Criteria classes also (as opposed to the old private fields with OnGetState/OnSetState overrides).</p>
<p>This is happening inside the private setter of a Criteria : CriteriaBase object. In this a scenario where a business rule might trigger the updating of a child object, so the call stack originals from&nbsp;a ValidationRule (not that I&#39;m sure whether that bit is relevant). The trigger for the validation rule originates from Silverlight, so that obviously may be the reason for the scoping issue because&nbsp;when<strong> I change my criteria class declaration to be scoped public&nbsp;the exception goes away.</strong> </p>
<p>Could&nbsp;there be a bug LoadProperty implementation, or should we change our ways and rather declare our criteria classes to be scoped public since using publicly scoped PropertyInfo&lt;T&gt; declarations for our properties when used in Silverlight?</p>
<p>I hope this makes sense,<br />Jaans<br /><br />PS: Just ordered the MVVM video series.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 15, 2010</h2><p>Jaans, is this occurring when you are using 3.8.4?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, July 15, 2010</h2><p>Gulp...I got an earie and embarassing feeling when I read your reply.<br />Turns out that it wasn&#39;t the latest version 3.8.4. </p>
<p>My apologies, I&#39;ll check that again with the latest version first en revert back when I have a result either way.</p>
<p>Thanks for helping</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 15, 2010</h2><p>It is still possible you&#39;ll encounter the problem with 3.8.4.</p>
<p>Silverlight 4 appears to have changed the way static fields are initialized, and also the SL4 JIT compiler appears to be smart enough to &quot;optimize away&quot; the _forceInit code trick.</p>
<p>So in SL4 the only truly reliable way to get your PropertyInfo&lt;T&gt; fields initialized appears to be to make them public. I suspect the type they are contained within (your criteria type) needs to be public as well - this is all due to reflection limitations with Silverlight.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, July 15, 2010</h2><p>Thanks Rocky</p>
<p>Yep... it still happens with 3.8.4 (and will likely happen with CSLA 4.0.0 too I guess).</p>
<p>I can definitely say that it&#39;s a SL4 thing because this piece of functionatlity worked perfectly fine when it was still running as a Silverlight 3 application. Clearly it relates to the more aggressive SL4 JIT compiler as you say. </p>
<p>It&#39;s a pity that it breaks this, because now our public API is about to get a significant increase in members as we change the criteria classes to be scoped public. Hmmm, will need to make changes to our code generation too.</p>
<p>Thanks for the help,<br />Jaans</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 15, 2010</h2><p>I suppose you could try and make the forceInit code more complex - try and trick the JIT compiler into thinking you are actually using the field for something?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
