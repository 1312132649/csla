<html><header><title>Custom Attributes, Shared methods &amp; reflection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Attributes, Shared methods &amp; reflection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/767.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jemmer posted on Monday, July 31, 2006</h2><P>Hi,</P>
<P>We're currently using CSLA version 1.0.&nbsp; We're in the process of converting a couple of apps to 2.0.</P>
<P>We'd like to modify BusinessBase (in both versions, if possible) just a bit to allow for a Custom Attribute to be defined for classes which derive from BusinessBase.&nbsp; This attribute would be used to define a "Friendly Name" for the class.&nbsp; This seems to be simple enough to do, for instances of derived classes, via code in BusinessBase like:</P>
<P>-----</P><FONT color=#000000><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> FriendlyName() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp; Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim</FONT><FONT size=2> classtype </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type = Me.</FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2></P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim</FONT><FONT size=2> attr </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> FriendlyNameAttribute = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(Attribute.GetCustomAttribute(classtype, </FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>&nbsp;(FriendlyNameAttribute)), FriendlyNameAttribute)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If</FONT><FONT size=2> attr </FONT><FONT color=#0000ff size=2>IsNot</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</FONT><FONT size=2> attr.FriendlyName</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</FONT><FONT size=2> classtype.Name</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp; End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT></FONT>
<P><FONT color=#000000>-----</FONT></P>
<P><FONT size=2>where FriendlyNameAttribute is a straightforward attribute class implementing a FriendlyName string property, and the derived class's definition is decorated appropriately with&nbsp;the FriendlyName attribute.</FONT></P>
<P>The problem is that we'd like to be able to access this attribute via a <EM>shared</EM> method in BusinessBase. This is because there are situations where no instance of the derived class may be available, but we'd still like to display something in the UI using the "Friendly Name" of that class.&nbsp; For example, it may not be possible to create an instance of the class (e.g, because some error has occurred, or the user is not authorized to do so, etc.), so we'd like to display an informational message with a more user friendly description of the class which is at the root of whatever the problem may be.</P>
<P>For example, as a programmer I might define a class called EntLOB.&nbsp; A more friendly name for this class might be "Enterprise Line of Business".&nbsp; Thus I'd like the error display to read something like:</P>
<P>&nbsp;&nbsp; Unable to retrieve the Enterprise Line of Business because ...</P>
<P>rather than</P>
<P>&nbsp;&nbsp;&nbsp;Unable to retrieve the EntLOB because ...</P>
<P>Creating the error string might be done as :</P>
<P>&nbsp;&nbsp;&nbsp;errormsg = string.format("Unable to retrieve the {0} because ...", SomeEntLOB.FriendlyName, ...) ...</P>
<P>I would define the derived class like:</P>
<P>&lt;Serializable, FriendlyName("Enterprise Line of Business")&gt; _</P>
<P>Public Class EntLOB</P>
<P>&nbsp;&nbsp;&nbsp;Inherits BusinessBase ...</P>
<P>As I said, this all works when I have an instance, but if I try to define the FriendlyName property in BusinessBase as shared, of course, the Me.GetType no longer works.</P>
<P>The creation of the error message when there is no instance presumably would be:</P>
<P>&nbsp;&nbsp;&nbsp;errormsg = string.format("Unable to retrieve the {0} because ...", EntLOB.FriendlyName, ...) ...</P>
<P>So, the question is, is it possible to use reflection in a shared method in a base class to retrieve an attribute which decorates the class definition on a derived class of that base? Sure feels like I ought to be able to do that, but I just don't see how.</P>
<P>Thanks for any help and insight anyone can offer.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, July 31, 2006</h2>May I suggest that you take a look at the string resources for your business object library?&nbsp; You could then add strings to that table with a lookup key such as MyApp.Library.Type1 which could point to a string that said "Type 1".&nbsp; A single method could then be accessible from within your library to the outside world that would take an object, get its type, and use the type name to lookup up the friendly name in the resources table.&nbsp; This would then also be localizable.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jemmer replied on Monday, July 31, 2006</h2><P>Hi Brian,</P>
<P>Thanks for your reply.</P>
<P>As I stated in my original post, my problem is that I may not have an instance of the derived class to get its Type (if I do, this is easy and my problem goes away).&nbsp; The method in BusinessBase (or elsewhere) would have to be shared, and I can't figure out what sort of reflection incantation I need to get the type of a derived class from within&nbsp;that shared method.</P>
<P>It turns out that we originally dealt with this by defining a MustImplement property in BusinessBase.&nbsp; This seems to me, on some level, to be equivalent to your suggestion of using a string resource by the typename. The author of a derived class is then&nbsp;required to implement&nbsp;the FriendlyName method that BusinessBase insisted on.&nbsp; That was OK, but we found that in the majority of the classes that we defined,&nbsp;the Friendly Name was the same as the class name (e.g. Customer).&nbsp; Thus, most of our class definitions were "cluttered" with what appeared to be redundant FreindlyName property implementations.</P>
<P>Assuming I can get the type name of the derived class, then it seems to me that the string resource would also be "cluttered" with redundant entries in a similar way.</P>
<P>I came up with the bright idea of a Custom Attribute, and figured that the developer would only need to provide the attribute in the case where the Friendly Name was different than the class name.&nbsp; The implementation of (my modified) BusinessBase's FriendlyName would return the Type's ClassName property in the case where no attribute was defined.</P>
<P>Works great when I have an instance of the derived class.&nbsp; I can't figure out how to do it when there is none...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, July 31, 2006</h2>Well, in your example you know the Type of the class.&nbsp; So you could just use GetType(<font color="#000000"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="3">SomeEntLOB).</font></font></font></font></font></font></font></font></font></font></font></font><font color="#000000"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="2"><font size="3"></font></font></font></font></font></font></font></font></font></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jemmer replied on Monday, July 31, 2006</h2><P>But this FriendlyName method would be implemented in BusinessBase.</P>
<P>I certainly can't encode&nbsp;a GetType()&nbsp;in that method for all the classes which might inherit from BusinessBase...</P>
<P>Is there no way to use reflection in a base class to get the Type of a class derived from that base when there is no instance of the derived class, i.e in a shared method of the base?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, July 31, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>jemmer:</strong></div><div><p>But this FriendlyName method would be implemented in BusinessBase.</p>
<p>I certainly can't encode&nbsp;a GetType()&nbsp;in that method for all the classes which might inherit from BusinessBase...</p>
<p>Is there no way to use reflection in a base class to get the Type of a class derived from that base when there is no instance of the derived class, i.e in a shared method of the base?</p></div></BLOCKQUOTE><br><br>Um, no.&nbsp; No instance == No polymorphism, which is what you need for the base class to pull behaviour from the derived class.&nbsp; You could do something like this:<br><br>public class MyBase&lt;T&gt; :&nbsp; BusinessBase&lt;T&gt;<br>&nbsp;&nbsp;&nbsp; where T : MyBase&lt;T&gt;<br>{<br>&nbsp;&nbsp;&nbsp; public string GetFriendlyName()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; return ResourceManager.GetString(this.GetType().FullName, System.Globalization.CultureInfo);<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; // Not exactly sure of the syntax on this one... If it does not work use GetFriendlyName(Type type)<br>&nbsp;&nbsp;&nbsp; public static string GetFriendlyName&lt;T&gt;()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  return ResourceManager.GetString(typeof(T).FullName, System.Globalization.CultureInfo);<br>&nbsp;&nbsp;&nbsp; }<br>}<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
