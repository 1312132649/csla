<html><header><title>DataPortal CPU spike</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal CPU spike</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9708.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChaseC posted on Thursday, November 04, 2010</h2><p>Hello all,</p>
<p>We have a winForms smart client application using CSLA 2.1.4 that has been running for a few years now.&nbsp; Within the past week or so, our dataportal process has starting using 100% CPU two or three times a day.&nbsp; </p>
<p>We&#39;ve had a lot of cooks in the kitchen lately, so debugging has been interesting to say the least.</p>
<p>Any ideas on how to troubleshoot this?&nbsp; I found this thread that mentions large object graphs being de/serialized:&nbsp; </p>
<p>http://forums.lhotka.net/forums/p/486/2409.aspx#2409</p>
<p>Any other ideas?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Friday, November 05, 2010</h2><p>Hard to say without more information, it&#39;s an older csla version. Maybe&nbsp;you should think about upgrading the application using a newer version of csla.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChaseC replied on Friday, November 05, 2010</h2><p>Yeah, that is the plan.&nbsp; Unfortunately we have to stabilize the legacy app before we can focus on the rewrite.&nbsp; </p>
<p>What&#39;s happening is that the dataportal process is running fine for 4 or 5 hours, and then the cpu climbs to 100% within a minute.&nbsp; It sounds like an infinite loop, but we haven&#39;t been able to isolate it yet.&nbsp; </p>
<p>Our infrastructure guy started recycling the app pool every hour, which seems to minimize the impact for now.&nbsp; But we still need to figure out the root cause.</p>
<p>I realize it&#39;s a vague scenario.&nbsp; Is there any additional information I could provide that would help?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Friday, November 05, 2010</h2><p>Hello,</p>
<p>I would run this under a Performance Profiler like the one <a href="http://www.red-gate.com/products/ants_performance_profiler/index.htm">RedGate has</a>. Also it would not hurt to add some <a href="http://msdn.microsoft.com/en-us/library/aa373209(v=VS.85).aspx">Windows Performance Counters</a> and check the Windows event logs for more information.</p>
<p>Thanks<br />-Blake Niemyjski</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Saturday, November 06, 2010</h2><p>It sounds like you have a good workaround in place.&nbsp; Perhaps just focus on doing the minimal work needed to move to a more recent Csla, and then test if the problem still occurs in when using the new version of Csla.&nbsp; maybe even just get to 3.0.5 to see if that resolves it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, November 07, 2010</h2><p>Odds are that it isn&#39;t CSLA code. It sounds like this was working for a long time, and recently started having the issue. So the most likely cause is some new business object code that&#39;s doing something bad&nbsp;- infinite loop, accidental recursion, etc.</p>
<p>If you have a custom base classes, you could insert logging code in the pre- and post-processing methods for the data portal, thus instantly gaining visibility into every data portal call.</p>
<p>Or you could modify Csla.Server.DataPortal to do pre- and post-processing logging. (something that&#39;s on the wishlist for 4.2 perhaps)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChaseC replied on Sunday, November 07, 2010</h2><p><span style="font-family:Times;font-size:small;">
<p>Oh yeah. &nbsp; Pretty certain CSLA isn&#39;t the cause. &nbsp;I &nbsp;didn&#39;t mean to imply that. &nbsp;It&#39;s just been difficult to pinpoint the problem because so much is going on within the remote dataportal and we haven&#39;t been able to reproduce the problem locally. &nbsp;</p>
<p>For now, we&#39;re going to keep recycling the app pool so that we can get to work on the new version. &nbsp;Although it seems like you&#39;d be just as likely to hit an infinite loop within an hour? &nbsp;I don&#39;t really understand how that keeps us running. &nbsp; Whatever works I guess. &nbsp;</p>
<p>Many thanks to everyone for the suggestions. &nbsp;</p>
</span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
