<html><header><title>Code generation hooks for property changing/changed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Code generation hooks for property changing/changed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/641.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Monday, July 17, 2006</h2><P>I apologize if this is a little off-topic, but I know a few here have probably tackled this problem. </P>
<P>I am continuing to go into the process of code generation using partial classes with the codesmith templates for C#. </P>
<P>The trick with the usage of partial classes being the various hooks necessary to extend behavior of generated code - the current issue I'm running across is with the setting of properties - both prior to the value change and immediately afterwards. </P>
<P>One example of the prior to change is with, for instance, social security numbers - I want to allow various formats to be assigned to the social security number, but to have it automatically formatted to the proper format within the setter. Here, I'd want this to occur before _socialSecurityNumber = value. </P>
<P>An example of after the change is with name components. When a user has various name parts (first/last/middle/suffix/prefix), changes to these will affect the "derived names" (including a sort name). The user has the ability to modify this derived name and hence it has its own state in the object. So, after a name part is changed and for instance _lastName = value, I want to DeriveNames(). </P>
<P>I considered including as meta-data of the objects (in the xml definition file) a includePropertyChanging and includePropertyChanged boolean flags, and when explicitly set to true I would include the necessary call to a specific and properly typed function for the handcrafted class to implement. Clearly, the class wouldn't compile with these functions not implemented, but I'd be explicitly saying that they will be implemented by utilizing the flags. </P>
<P>With respect to the property changing method, it would return a value of the same type and would cause the "value" in the setter to potentially change - that is - my SocialSecurityNumberPropertyChanging() would end up returning the properly formatted value, and assignment would occur to the formatted value. </P>
<P>I'm sure at a minimum this gets my general problem across... I could also have a single "PropertyChanging()" and "PropertyChanged()" method (not strongly typed and using a switch statement). </P>
<P>Appreciate any advice - thanks! </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 17, 2006</h2><P>You could also use private events for this purpose. In VB this is an excellent option, because you can use WithEvents/Handles to automantically hook the events - meaning in the user code the only code required are the event handlers. In C# this isn't as nice, but is still workable, and is why I added the Initialize() method to all the base classes (so you can insert the event hookup code).</P>
<P>Another option is to end up with THREE classes (two genned, one user):</P>
<P>CustomerBase.xx (genned)<BR>Customer.genned.xx (genned)<BR>Customer.xx (user)</P>
<P>In CustomerBase you would define protected virtual/Overridable methods for all your pre/post get/set scenarios. Then in Customer.genned your property implementations would invoke those methods - which would always work, but would do nothing. Then the developer could override them in Customer on an as-needed basis.</P>
<P>I like this option because it avoids the overhead of events, and allows the user code to only implement methods they care about with no extra work - even in C# - so the user code is very focused. It is also strongly typed.</P>
<P>The only drawback is that you need to code-gen the base class as well as the partial class, so it is like a combination of the standard inheritance technique with the new partial class technique.</P>
<P>But if you think about why partial classes work so well for Windows Forms and Web Forms, it is not in small part because Microsoft's base classes (Form and Page) provide useful hooks. On the other hand, it is also the case that partial classes were designed for event-driven scenarios, with the basic assumption being that the user code could just handle a set of events to do its work...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, July 17, 2006</h2>I'm not sure If I get what you're trying to say, but BusinessBase has a method you can override:<br><br><br>&nbsp;&nbsp;&nbsp; Protected Overrides Sub OnPropertyChanged(ByVal propertyName As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.OnPropertyChanged(propertyName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If propertyName = "Name" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>Of course, in order for this to work you have to code your props somewhat like this:<br><br>Public Property Name As String<br>&nbsp;&nbsp;&nbsp; Get <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CanReadProperty("Name", True)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return m_Name<br>&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; Set (ByVal value As String)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CanWriteProperty("Name", True)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If m_Name &lt;&gt; value Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; m_Name = value<br><b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PropertyHasChanged("Name")</b><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End Set<br>End Property<br><br><br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, July 17, 2006</h2><P>I&nbsp;think the route Andres is suggesting is a nice simple approach that gets me through everything I need to worry about at this point. Your post, Rocky, is useful in thinking about future hooks that may need to be added to accomodate more flexibility. </P>
<P>Good replies both, thank you. </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Monday, July 17, 2006</h2><P>Chris,</P>
<P>When creating the partial class, I was debating whether I need to add hooks before and after value assignment in property set.</P>
<P>I figured that hook after value assignment is not needed since you can either override the OnPropertyChanged (just like Andres has shown) or override PropertyHasChanged if you need to inject the code before validation take place.</P>
<P>I ended up not implementing hook before value assignment.&nbsp;&nbsp;The only time I see this is needed when you need to add code that need to use the original value.&nbsp; In my experience this is rarely happening, and by not adding this hook I could make the code less complex and possibly (yet to test) avoid performance issue.</P>
<P>Of course, somebody might&nbsp;experience this differently.&nbsp; If you do, I would like to hear your experience.</P>
<P>Ricky</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, July 18, 2006</h2><P>Ricky,</P>
<P>As I took Andres suggestion to override OnPropertyChanged and I went through and implemented my handcrafted pieces, I found no requirements that necessitated an extra hook before the property changed (like you say, the only reason is to need to know what the original value is).</P>
<P>That's not to say that perhaps there won't be a case like that, but since I didn't encounter one I didn't want to pursue it. </P>
<P>Thanks for your input</P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, July 18, 2006</h2>I strongly believe that if you have something that escapes the scope of code generation, you shouldn't generate it. So if I find myself needing to do something special before a property changes I will most likely not generate that property and hand code it. You can use hooks in fetch methods to fill it's value anyway.<br><br>Either way, even if you wanted to generate that you could just have another variable that holds the "previous value", and you can still handle things inside OnPropertyChanged and keep that "previous value" field up to date.<br><br>I've been working on CslaGen for a long time now, and I believe that sort of stuff is out of the scope of code generation (at least for cslagen's part). I don't think a project of this nature should try to be everything to everyone.<br><br>Andrés<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
