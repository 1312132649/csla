<html><header><title>Displaying business rules on the Web UI (Validation Controls)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Displaying business rules on the Web UI (Validation Controls)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3606.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw posted on Thursday, September 27, 2007</h2><P>I know this has been done before, but I wanted to post some of the code that I used to do this.&nbsp; My goal was to take some of the simple business rules such as required, value range, string length, and regex expressions and express them as client validated rules so the postback does not occur before validation.</P>
<P>Can anything tell me if there is a better or more efficient way than this?</P>
<P>First, I had to get the rules from the data source.&nbsp; Then I took the string() of rule descriptions and converted it to&nbsp;the RuleDescription class (until it is built into the call for getting the descriptions).</P>
<P>Then I iterated through the rules and matched known rule types with validation controls and created them.&nbsp; I extended FormView control for my test of this functionality.</P>
<P>Sorry if you are C# folks.&nbsp; I usually write in C#, but this time it had to be VB.NET</P>
<P>The following code gets the data from the CSLA data source.</P><PRE><FONT color=#0000ff size=2><FONT color=#0000ff size=2><P><FONT color=#000000>If</FONT></FONT><FONT color=#000000><FONT size=2> </FONT><FONT size=2>Not</FONT><FONT size=2> dataSource </FONT><FONT size=2>Is</FONT><FONT size=2> </FONT><FONT size=2>Nothing</FONT><FONT size=2> </FONT><FONT size=2>Then</P></FONT></FONT><FONT size=2><P></FONT><FONT size=2><FONT color=#000000>&nbsp;&nbsp;&nbsp;' Instantiate Object</FONT></P></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> result </FONT><FONT size=2>As</FONT><FONT size=2> Type = </FONT><FONT size=2>Nothing</P></FONT></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> </FONT><FONT size=2>Not</FONT><FONT size=2> </FONT><FONT size=2>String</FONT><FONT size=2>.IsNullOrEmpty(dataSource.TypeAssemblyName) </FONT><FONT size=2>Then</P></FONT></FONT><FONT size=2><P></FONT><FONT size=2><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' explicit assembly name provided</FONT></P></FONT><FONT size=2><P><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = Type.GetType(</FONT></FONT><FONT color=#000000><FONT size=2>String</FONT><FONT size=2>.Format(</FONT><FONT size=2>"{0}, {1}"</FONT><FONT size=2>, dataSource.TypeName, dataSource.TypeAssemblyName), </FONT><FONT size=2>True</FONT><FONT size=2>, </FONT><FONT size=2>True</FONT></FONT><FONT size=2><FONT color=#000000>)</FONT></P><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;ElseIf</FONT><FONT size=2> dataSource.TypeName.IndexOf(</FONT><FONT size=2>","</FONT><FONT size=2>) &gt; 0 </FONT><FONT size=2>Then</P></FONT></FONT><FONT size=2><P></FONT><FONT size=2><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' assembly qualified type name provided</FONT></P></FONT><FONT size=2><P><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = Type.GetType(dataSource.TypeName, </FONT></FONT><FONT color=#000000><FONT size=2>True</FONT><FONT size=2>, </FONT><FONT size=2>True</FONT></FONT><FONT size=2><FONT color=#000000>)</FONT></P><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT size=2>If</P></FONT></FONT><FONT size=2><P></FONT><FONT size=2></FONT><FONT color=#000000>&nbsp;</FONT></P><P><FONT size=2><FONT color=#000000>&nbsp;&nbsp;&nbsp;' Read rules and save them in a collection</FONT></P></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> (</FONT><FONT size=2>Not</FONT><FONT size=2> result </FONT><FONT size=2>Is</FONT><FONT size=2> </FONT><FONT size=2>Nothing</FONT><FONT size=2>) </FONT><FONT size=2>Then</P></FONT></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> obj </FONT><FONT size=2>As</FONT><FONT size=2> </FONT><FONT size=2>Object</FONT></FONT><FONT size=2><FONT color=#000000> = result.Assembly.CreateInstance(result.FullName)</FONT></P><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> method </FONT><FONT size=2>As</FONT><FONT size=2> MethodInfo = result.GetMethod(</FONT><FONT size=2>"GetRules"</FONT></FONT><FONT size=2><FONT color=#000000>)</FONT></P><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> </FONT><FONT size=2>Not</FONT><FONT size=2> method </FONT><FONT size=2>Is</FONT><FONT size=2> </FONT><FONT size=2>Nothing</FONT><FONT size=2> </FONT><FONT size=2>Then</P></FONT></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return</FONT><FONT size=2> </FONT><FONT size=2>CType</FONT><FONT size=2>(method.Invoke(obj, </FONT><FONT size=2>Nothing</FONT><FONT size=2>), </FONT><FONT size=2>String</FONT></FONT><FONT size=2><FONT color=#000000>())</FONT></P><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT size=2>If</P></FONT></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT size=2>If</P></FONT></FONT><FONT size=2><P></FONT><FONT color=#000000><FONT size=2>End</FONT><FONT size=2> </FONT></FONT><FONT color=#0000ff size=2><FONT color=#000000>If</FONT></P><P></FONT></FONT>&nbsp;</P></PRE>The next block goes in the CreateChildControls of the custom control.&nbsp; Keep in mind that if the code is called more than once, your code must be smart enough to not create multiples of the same validators (I checked for the existing control ID and reset all the properties to what they should be): <PRE><FONT size=2><P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> CreateChildControls()</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;MyBase</FONT><FONT size=2>.CreateChildControls()</P><P></FONT><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;' Get the CSLA business rules</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> rules </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>()</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> ViewState(</FONT><FONT color=#800000 size=2>"RuleList"</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rules = GetRuleList()</P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ViewState(</FONT><FONT color=#800000 size=2>"RuleList"</FONT><FONT size=2>) = rules</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Else</P></FONT><FONT size=2><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rules = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(ViewState(</FONT><FONT color=#800000 size=2>"RuleList"</FONT><FONT size=2>), </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>())</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2><P></FONT><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;' The rule description class is not serializable, so we have to recreate it based on the CSLA Rule string()</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> ruleList </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> System.Collections.Generic.List(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> RuleDescription)</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> rule </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> rules</P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ruleList.Add(</FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> RuleDescription(rule))</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Next</FONT></P><P><FONT color=#0000ff size=2>&nbsp;</P></FONT><FONT size=2><P>&nbsp;&nbsp;&nbsp;AddRulesToPage(ruleList)</P><P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P></PRE>
<P>Posting all of the code&nbsp;is not neccesary, so the following is just a snip of the functionality (I skipped lines including error handling, comments,&nbsp;and other specific implementation: </P><PRE><P><FONT color=#0000ff size=2>For</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Each</FONT><FONT size=2> rule </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> RuleDescription </FONT><FONT color=#0000ff size=2>In</FONT><FONT size=2> ruleList</P></FONT><FONT size=2></FONT><FONT color=#0000ff size=2><P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> <FONT color=#000000>baseRule</FONT> </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> <FONT color=#000000>BaseValidator</FONT> = </FONT><FONT color=#0000ff size=2>Nothing</P><P></FONT>&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> validatedControl </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Control = FindControl(rule.PropertyName + suffix)</P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> validatedControl </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2></FONT><FONT color=#008000 size=2><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim</FONT><FONT size=2> <FONT color=#000000>ruleType</FONT> </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> <FONT color=#000000>SupportedRuleType</FONT> = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2><FONT color=#000000>([Enum].Parse</FONT>(</FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2><FONT color=#000000>(SupportedRuleType), rule.MethodName,</FONT> </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2><FONT color=#000000>), SupportedRuleType</FONT>)</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Case</FONT><FONT size=2> <FONT color=#000000>ruleType</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case</FONT><FONT size=2> <FONT color=#000000>SupportedRuleType.StringRequired</FONT></P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>&nbsp;&nbsp;baseRule = GetRequiredRule(validatedControl, rule, ruleType, caption)</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case</FONT><FONT size=2> <FONT color=#000000>SupportedRuleType.StringMinLength, SupportedRuleType.StringMaxLength</FONT></P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>baseRule = GetLengthRule(validatedControl, rule, ruleType, caption)</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case</FONT><FONT size=2> <FONT color=#000000>SupportedRuleType.IntegerMaxValue, SupportedRuleType.IntegerMinValue, SupportedRuleType.MaxValue, SupportedRuleType.MinValue</FONT></P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>baseRule = GetValueRule(validatedControl, rule, ruleType, caption)</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case</FONT><FONT size=2> <FONT color=#000000>SupportedRuleType.RegExMatch</FONT></P><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>baseRule = GetRegExRule(validatedControl, rule, ruleType, caption)</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Select</P></FONT><FONT size=2></FONT><FONT color=#0000ff size=2><P><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Set common rule properties</FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P><P>      If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> <FONT color=#000000>baseRule </FONT></FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>SetCommonRuleProperties(validatedControl, baseRule)</FONT></P><P></FONT><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' If the validator is not already on the page, then add it. Some validators are used by multiple rules </P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> <FONT color=#000000>control.Parent.Controls.Contains(baseRule))</FONT> </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2><P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000000>validatedControl.Parent.Controls.AddAt(validatedControl.Parent.Controls.IndexOf(validatedControl) + 1, baseRule)</FONT></P><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P><P></FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2><P></FONT><FONT color=#0000ff size=2>Next</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>' Rule</P></FONT></PRE>
<P>Each call to Get___Rule returns the specific configured validation rule. Each rule has different requirements and properties set so I have not found a way to combine the methods.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cwgraves replied on Wednesday, October 10, 2007</h2><P>Thanks for posting the snippet of code. I am trying to do the same thing that you discuss in this post. </P>
<P>Any chance of you attaching the complete code? It would be GREATLY appreciated!</P>
<P>Thanks,</P>
<P>Curtis</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Wednesday, October 10, 2007</h2>Hi Curtis.&nbsp; I don't think I would be allowed to post some of the other code as it gets into details that I worked with on the client.&nbsp; However, I don't believe there would be any reason I couldn't answer any questions that you have or help you through it.&nbsp; It is probably good to talk here, but you could also contact me via email.&nbsp; <A href="mailto:chrisw@do_not_spam_magenic.com_do_not_spam">chrisw@do_not_spam_magenic.com_do_not_spam</A>. Just take the do_not_spam parts out ;)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Monday, October 15, 2007</h2>Did you solve the problem of adding comparison rules between properties?<br><br>It's a bit of a chicken and egg problem, in that the other field might not be initialized on the screen when this control is being pre-rendered.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrislw replied on Tuesday, October 16, 2007</h2>No.&nbsp; Actually, as for rendered controls, I call the code from the CreateChildControls and make sure that all the child controls are created first.&nbsp; However, I only did basic rules such as required, value range, and regular expressions (standard validators).&nbsp; Everything else is done by the business object.&nbsp; Another option though, might be to call ASP AJAX to call the BO validate method and display an error to the user.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, June 13, 2008</h2><P>I know this is months old, but Can someone help me on this? Where does the code that gets the data from the CSLA datasource need to go?&nbsp;</P>
<P>Plus, what is this "SupportedRuleType"?&nbsp; Is this something that only relates to VB?</P>
<P>Plus, how is the SetCommonRuleProperties() function implemented???</P>
<P>Any help would be greatly appreciated! :P</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Monday, June 16, 2008</h2><P>Kay', I got&nbsp;most of that figured out now except&nbsp;1 thing,&nbsp;I could really use some help regarding what "SupportedRuleType" is, it's the only thing I'm stuck with now.... I can't seem to find it anywhere in the Csla framework, and there's no documentation about this anywhere.&nbsp; Can someone lend a hand? :/</P>
<P>The only thing I can find in CSharp that possibly could be used is the CommonRules class..... but it's of static tye and can't be used like is shown here....&nbsp; anyone?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Tuesday, June 17, 2008</h2><P>Perhaps I'm talking alone here, but I have made progress with working around this mysterious "SupportedRuleType" class.&nbsp; However now I have a new question :) </P>
<P>Can anyone tell me how to overcome this issue with the FindControl( rule.PropertyName ) line in the AddRulesToPage function??? I can't seem to find any of the controls to validate in my Extended Contol at runtime and I'm at a loss&nbsp;on how else this could be done&nbsp;:(&nbsp; </P>
<P>Any help would be greatly appreciated.&nbsp;If I get this working I can post all my code in Csharp for all to benefit.&nbsp; I feel I'm getting closer if I could just overcome this.</P>
<P>&nbsp;</P>
<P>p.s. rule.PropertyName is returning correctly.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
