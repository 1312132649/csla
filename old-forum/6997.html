<html><header><title>Big editable collections</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Big editable collections</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6997.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Slayer posted on Monday, May 25, 2009</h2>I have a question regarding big collections. In the past I have used one of 2 methods :<br /><br />1.) I used the EditableRootListBase for a list of Editable Customer objects. This works fine if you have a limited amount of Customers. Editable Customer objects get quite big so having 10000 of them in a list would not be efficient. I like this method because you get a list first approach and when you modify a object, the original list gets updated.<br /><br />2.) Whenever the collection gets 2 big, I do what Rocky does in his sample app - I build a compact read-only collection of CustomerInfo objects. Because this list is read-only you need to close it after you select the customer for editing.<br /><br />My Question :<br /><br />This project that i am currently working on uses products instead of customers and there are at least 20000 records. The master file changes a lot, meaning the user would modify +- 10 records in one sitting. Method 1 is perfect but would consume tons of memory(need to keep 20000 business objects in memory) and method 2 is tedious because you would need to populate the read-only collection for each edit.<br /><br />Is there a mid-way with CSLA, If not does anyone have design tips on the matter?<br /><br />Thanks</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, May 25, 2009</h2><P>In your #2, when you say "close it after you select the customer", you mean discard the read-only list?</P>
<P>You don't necessarily need to do that. You can keep the read-only list in memory on the client - perhaps in a static cache field. Basically in a global cache.</P>
<P>If you that, you can have CustomerEdit tell the read-only CustomerList that a customer has changed, and CustomerList can update the changed CustomerInfo. The only trick to this is that a ReadOnlyBase object won't normally raise PropertyChanged events, so if you are maintaining a bound form against this read-only list then you'll need to add an INotifyPropertyChanged implementation to your CustomerInfo class.</P>
<P>But basically do something like this:</P>
<BLOCKQUOTE dir=ltr>
<P>public class CustomerList : ReadOnlyListBase<BR>{<BR>&nbsp; private static CustomerList _cache;<BR>&nbsp; public void ClearCache()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; _cache = null;<BR>&nbsp; }</P>
<P>&nbsp; public static CustomerList GetList()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; if (_cache == null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _cache = DataPortal.Fetch&lt;CustomerList&gt;();<BR>&nbsp;&nbsp;&nbsp; return _cache;<BR>&nbsp; }</P>
<P>&nbsp; internal static void CustomerSaved(CustomerEdit cust)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; if (_cache != null)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var info = this.SingleOrDefault(c =&gt; c.Id == cust.Id);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (info != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.CustomerSaved(cust);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR>}</P>
<P>public class CustomerInfo : ReadOnlyBase<BR>{<BR>&nbsp; internal void CustomerSaved(CustomerEdit cust)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // refresh property values from cust<BR>&nbsp;&nbsp;&nbsp; // and maybe add OnPropertyChanged() to<BR>&nbsp;&nbsp;&nbsp; // refresh bindings in the UI<BR>&nbsp; }<BR>}</P>
<P>public class CustomerEdit : BusinessBase<BR>{<BR>&nbsp; public override CustomerEdit Save()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; var result = base.Save();<BR>&nbsp;&nbsp;&nbsp; CustomerList.CustomerSaved(result);<BR>&nbsp;&nbsp;&nbsp; return result;<BR>&nbsp; }<BR>}</P></BLOCKQUOTE>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Slayer replied on Tuesday, May 26, 2009</h2>Thank you for the prompt response Rocky...<br /><br />Yes, you understood my question perfectly. I will certainly try this approach. <br /><br />I will also add some code(to the CustomerSaved() method) to add a new CustomerInfo object to the read-only collection in case a new customer gets added.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
