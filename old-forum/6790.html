<html><header><title>Custom Validation rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom Validation rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6790.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jigjosh posted on Tuesday, April 14, 2009</h2>I have very simple BusinessBase Objects like  City,  state , country , employee and so on,  I want to validate that Name is not duplicate <br />i mean when user enter duplicate name at same time the object become invalid  <br /><br />pl let me know how to make common rule for the same<br /><br />thanks<br /><br />jignesh</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, April 14, 2009</h2><P>This is a very complex problem, if I understand your question correctly.</P>
<P>You want to make sure that two different users are notified that they are entering the same Name value at the same time?</P>
<P>This has been discussed on the forum numerous times, and it is very complex.</P>
<P>To solve this problem, you obviously need a way for the computers of the two users to interact with each other in real time. So every computer using your application must be connected to all other computers using your application, so they can all send the keystrokes of every user to every other computer.</P>
<P>That's pretty unrealistic. So the closest thing to this is to have a central "message server" that all the computers connect to, and instead of sending every keystroke, they send every field value as the user tabs off the field.</P>
<P>Even then, the communication level is pretty unrealistic. So a publish-subscribe model is used, so when a user starts adding a Customer, the application asks the message server for all messages related to "add or edit customer data". And the application starts sending all changed field values to the message server with the "add or edit customer data" tag.</P>
<P>The problem of course, is that Windows has no built-in mechanism to do any of this. So you'll need to invent your message server, your communication protocol and deal with all sorts of error cases (like what happens when a subscriber computer just disappears off the network - how do you detect this and clean up any open communication channels, etc).</P>
<P>And what's even worse, is all this work is really just for a <EM>hint</EM> that there might be a problem. You really don't know if a value is a duplicate until the point when you try to commit the update into the database. That is the only point you <EM>know for sure</EM> that there's a duplicate value. Everything else is just a hint, but due to timing issues it is absolutely possible for two users to enter duplicate values and never know it until the second user's value is known to be a duplicate in the database.</P>
<P>In short - this is not a CSLA validation rule issue - this is an issue dealing with concurrent computing, publisher/subscriber message patterns, network communication and data concurrency.</P>
<P>If you have a pub/sub messaging server, <EM>then</EM> it can become a CSLA validation rule, and it really isn't that hard to do.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, April 14, 2009</h2>Rocky's answer is comprehensive.<br /><br />If you just want to add a rule to do the check in your BO you could use code like this in your BO:<br /><br />  ValidationRules.AddRule(AddressOf ActiveRecordExists, New ActiveRecordExistsRuleArgs("Vendno", "vend"), 1)<br /><br />And code like this in your Rules class:<br /><br /> 'New records must exist.<br />    'Edited records must exist unless it is the originally saved value.<br />    Public Function ActiveBuyerExists(ByVal target As Object, ByVal e As RuleArgs) As Boolean<br />      Dim ruleArg As ActiveRecordExistsRuleArgs = DirectCast(e, ActiveRecordExistsRuleArgs)<br />      Dim propertyName As String = ruleArg.PropertyName<br />      Dim propertyDescription As String = ruleArg.PropertyDescr<br />      Dim tableName As String = ruleArg.TableName<br /><br />      Dim value As String = CStr(CallByName(target, propertyName, Microsoft.VisualBasic.CallType.Get))<br />      Dim origvalue As String = CStr(CallByName(target, "Orig" &amp; propertyName, Microsoft.VisualBasic.CallType.Get))<br /><br />      Dim bizObject As Csla.Core.BusinessBase = DirectCast(target, Csla.Core.BusinessBase)<br /><br />      If (bizObject.IsNew) OrElse (Not bizObject.IsNew AndAlso value <> origvalue) Then<br /><br />        If CheckValue.ActiveBuyerExists(tableName, value) Then<br />          Return True<br />        Else<br />          e.Description = GetDescription(target, propertyName, propertyDescription) &amp; " does not exist or is not active."<br />          Return False<br />        End If<br /><br />      Else<br />        Return True<br />      End If<br />    End Function<br /><br /><br /> Public Class ActiveRecordExistsRuleArgs<br />      Inherits MyRuleArgs<br /><br />      Private mTableName As String<br />      Private mLineNoFieldName As String<br /><br />      Public ReadOnly Property TableName() As String<br />        Get<br />          Return mTableName<br />        End Get<br />      End Property<br /><br />      Public ReadOnly Property LineNoFieldName() As String<br />        Get<br />          Return mLineNoFieldName<br />        End Get<br />      End Property<br /><br />      Public Sub New(ByVal propertyName As String, ByVal tableName As String, Optional ByVal lineNoFieldName As String = "lnno", Optional ByVal propertyDescription As String = "")<br />        MyBase.New(propertyName, propertyDescription)<br />        mTableName = tableName<br />        mLineNoFieldName = lineNoFieldName<br />      End Sub<br /><br />      Public Overrides Function ToString() As String<br />        Return MyBase.ToString &amp; "?tableName=" &amp; mTableName &amp; "&amp;lineNoFieldName=" &amp; mLineNoFieldName.ToString<br />      End Function<br /><br />    End Class<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
