<html><header><title>FieldDataManager.GetChildren returns only IEditableBusinessObject and IEditableCollection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>FieldDataManager.GetChildren returns only IEditableBusinessObject and IEditableCollection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11799.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ngm posted on Monday, January 21, 2013</h2><p>I was going through the options how to enumarate through object&#39;s children with managed properties. As per Jonny&#39;s advise ( <a href="http://forums.lhotka.net/forums/t/11038.aspx">http://forums.lhotka.net/forums/t/11038.aspx</a>&nbsp;), FieldManager.GetChildren should accomplish it.</p>
<p>However, I was wondering why does it returns only IEditableBusinessObject and IEditableCollection objects?</p>
<p>In case of BusinessBase -&gt; ReadOnlyBase aggregation, GetChildren method will not return ReadOnlyBase child.</p>
<p>This might be related to the fact that ReadOnlyBase and read-only lists are not so welcome as children in CSLA. Example of&nbsp;it is that they have no MarkAsChild implementations.</p>
<p>Rocky, any insight on the anticipated compositions between CSLA stereotypes?</p>
<p>Thanks,</p>
<p>- ngm</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, January 22, 2013</h2><p>FieldManager.GetChildren returns the editable objects owned by this instance (owning reference) that must also be updated / saved. </p>
<p>A readonly base should never be saved - hence it doesn&#39;t matter if it is a child or not.</p>
<p>For editable objects you are only allowed to call Save on the &quot;root&quot; object - and if you call Save on an object that is child the DataPortal will throw an exception.&nbsp;</p>
<p>So an EditableObject may contain readonly objects - and it doesn&#39;t make sense to have MarkAsChild or even loop through it during a save as it is not a savable object.&nbsp;</p>
<p>ReadOnlyObjects are welcome as children.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ngm replied on Tuesday, January 22, 2013</h2><p>If editable object -&gt; read-only object(s) aggregation is allowed in CSLA then the goal I want to achieve is to enumerate through all managed properties of editable object (parent) and get all children whether editable or not. </p>
<p>It really has nothing to do with persistance mechanism.&nbsp;I completely understand&nbsp;that you can invoke Save only on the parent and that it&#39;s responsible to control the process. But in&nbsp;this case it&nbsp;should simply ignore read-only object(s) in its&nbsp;graph when saving, as it should do with n-level undo.</p>
<p>Also I don&#39;t see GetChildren method being used for update process but rather UpdateChildren method. It&#39;s interesting that BusinessBase uses GetChildren in its FieldDataDeserialized method to subscribe back certain events from its children. In this case, if editable object -&gt; read-only object(s) is allowed I think&nbsp;it should take care about that kind of children for BusyChanged event hooks in particular.</p>
<p>Additionally ReadOnlyBase implements IManageProperties interface by&nbsp;calling FieldManager.GetChildren method for IManageProperties.GetChildren. This brings me to the question, what kind of parent/child relation is allowed when ReadOnlyBase is parent? Certainly, it should not be editable object(s) because there would be no parent to control the persistance. If so, then it looks like the only viable option is read-only object(s) as children, but in that case GetChildren will return empty list.</p>
<p>I would argue whether MarkAsChild on read-only object make sense because IsChild is very valuable context for a lot of logic beside persistance.</p>
<p>As you see the question is beyond object saving and more toward possible compositions within CSLA. </p>
<p>I&#39;ll appreciate if Rocky can provide some list of parent/child relations that work.</p>
<p>Thank you Jonny,</p>
<p>- ngm</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, January 22, 2013</h2><p>It is not generally a good idea to have a read-only child contained in an editable parent. This is because child objects are part of the state of the parent, and when an editable root is saved the entire object graph is transferred to and from the server. As a result, your read-only child is transferred to/from the server and that&#39;s just a waste of bandwidth and serialization effort.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ngm replied on Tuesday, January 22, 2013</h2><p>It shouldn&#39;t be hard to imagine scenarios that have editable parent and read-only stereotype as child or children.</p>
<p>The issue you described is&nbsp;well-known for non-dirty editable child as well. I used to solve it by having lazy-loaded child that&#39;s &quot;nullified&quot; if it&#39;s read-only or editable but non-dirty. Even if that part of graph is needed on the Data Portal, it usually is more efficient to fetch it from there than to carry it over network.</p>
<p>However, I didn&#39;t find a way to &quot;nullify&quot; child in FieldManager. There&#39;s RemoveField method, but that one is internal and still doesn&#39;t remove actual FieldData but rather set it&#39;s value to null.</p>
<p>Any guideline on how to reset lazy-loaded field if it&#39;s read-only or editable but non-dirty?</p>
<p>Thanks,</p>
<p>- ngm</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 22, 2013</h2><p>For &quot;child&quot; objects that aren&#39;t really part of the object graph I recommend using private backing fields instead of managed properties. This allows you to mark the private fields as NotUndoable and NonSerialized, easily preventing them from incurring all that overhead.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ngm replied on Tuesday, January 22, 2013</h2><p>Speaking of private backing fields, can you specify what are pieces of functionality that need to be manually taken care of when using them?</p>
<p>As long as I see, dirtiness metastate (marking BO as dirty when such property is changed), authorization, broken rules and property changed notifications are all still supported.</p>
<p>Dirty is not tracked on the field level. IsDirty and IsValid have to be overriden. Updates won&#39;t be covered by invoking UpdateChildren on FieldDataManager. Those fields have to be explicitly set during serialization in SerializationInfo.</p>
<p>Is there anything else I&#39;m missing?</p>
<p>Thanks,</p>
<p>- ngm</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 22, 2013</h2><p>I assume you&#39;ve read the &#39;Using CSLA 4&#39; books?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ngm replied on Tuesday, January 22, 2013</h2><p>Big time.</p>
<p>- ngm</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
