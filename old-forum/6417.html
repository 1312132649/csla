<html><header><title>Trying to replace SortedBindingList with LINQ</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Trying to replace SortedBindingList with LINQ</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6417.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Blarm posted on Friday, February 13, 2009</h2><P>As per page 74 of the 2008 book I am trying to replace the obsolete&nbsp;SortedBindingList with LINQ.</P>
<P>However I commonly use a SortedBindingList of ReadOnlyList (ROL)&nbsp;so that I can bind to a WIndows DataGridView and have sorting on column headers become automatic.</P>
<P>When using LINQ on a ROL it returns a IEnumerable which is not sortable and so the user can no longer use the grid headings to sort the column.</P>
<P>Is there a way to get LINQ to use the LINQ to CSLA tto get a LinqBindingList which I presume will give me sorting on the grid by default.</P>
<P>Bill</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, February 13, 2009</h2><P>Yes. There is a way. I have been working on this for a while now.</P>
<P>As you noted ReadOnlyLists return IEnumerable(Of T). EditableLists return LinqBindingList(Of T). </P>
<P>The key is that you want to be able to pass in a String column name and Sort Direction.</P>
<P>In order to accomplish this you need to:</P>
<P>#1. Download the Microsoft Dynamic Query Library and add it to your project. This will handle String values and turn them into LINQ Expressions for you.</P>
<P>#2. Add this method to the MS code:</P><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'JF - 1/5/09 added this extension: <BR>'http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2666544&amp;SiteID=1#2670101</P></FONT></FONT><FONT size=2>
<P>&lt;Extension()&gt; _<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Function</FONT></FONT><FONT size=2> ToList(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> query </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> IQueryable) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> IList<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Return</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>DirectCast</FONT></FONT><FONT size=2>(Activator.CreateInstance(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>GetType</FONT></FONT><FONT size=2>(List(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Of</FONT></FONT><FONT size=2> )).MakeGenericType(query.ElementType), query), IList)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Function</P></FONT></FONT>
<P>#3. Use code like this for ReadOnlyLists:</P>
<P>Page level variable:<BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Private</FONT></FONT><FONT size=2> mSortedList </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> System.Linq.IQueryable</P></FONT><FONT size=2>
<P><FONT size=3>In a method like doDataBind&nbsp;which gets called from various places like:</FONT><BR>&nbsp; &nbsp;PageLoad, <FONT size=2>dg_SortCommand, </FONT><FONT size=2>dg_PageIndexChanged</FONT></P>
<P><FONT size=2>Dim sortDir As String =&nbsp; <FONT size=2>ListSortDirection.Ascending&nbsp; '(Or Descending)<BR></FONT></FONT>mSortedList = mROList.AsQueryable.OrderBy(<FONT size=2>strGridSortExpression</FONT>&nbsp;&amp; </FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>" "</FONT></FONT><FONT size=2> &amp; <FONT size=2>sortDir </FONT>)<BR></FONT><FONT size=2><FONT size=2>dg.DataSource = mSortedList.ToList</P></FONT>
<P></P></FONT>
<P>In other methods you can refer to items in the sorted list like this:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> dg_ItemDataBound(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> System.Object, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> System.Web.UI.WebControls.DataGridItemEventArgs) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Handles</FONT></FONT><FONT size=2> dg.ItemDataBound</P>
<P></FONT>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2></P></FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</FONT></FONT><FONT size=2> e.Item.ItemType = ListItemType.Item </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>OrElse</FONT></FONT><FONT size=2> e.Item.ItemType = ListItemType.AlternatingItem </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Dim</FONT></FONT><FONT size=2> mIndex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Integer</FONT></FONT><FONT size=2> = e.Item.DataSetIndex<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Dim</FONT></FONT><FONT size=2> item </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> mROList.Info = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CType</FONT></FONT><FONT size=2>(mSortedList(mIndex), ROList.Info )<BR></FONT><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub 
<P></P></FONT></FONT></FONT>
<P>==============================================================</P>
<P>Alternatively you could strongly type things and use code like this:</P>
<P><FONT size=2><FONT size=2>'One issue you have to resolve though is:<BR></FONT></FONT><FONT size=2><FONT size=2>'AllowCustomPaging must be true and VirtualItemCount must be set for a DataGrid with ID 'dg' <BR></FONT></FONT><FONT size=2><FONT size=2>'when AllowPaging is set to true and the selected data source does not implement ICollection.</P></FONT>
<P></P></FONT>
<P><FONT size=2><FONT color=#0000ff>Private</FONT> mSortedList <FONT color=#0000ff><FONT color=#0000ff>As</FONT></FONT> System.Linq.IQueryable(Of ROList.Info)</FONT></P><FONT size=2>
<P><FONT size=2>Dim sortDir As String =&nbsp; <FONT size=2>ListSortDirection.Ascending&nbsp; '(Or Descending)<BR></FONT></FONT>mSortedList = mROList.AsQueryable.OrderBy(<FONT size=2>strGridSortExpression</FONT>&nbsp;&amp; <FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>" "</FONT></FONT><FONT size=2> &amp; <FONT size=2>sortDir </FONT>)<BR></FONT><FONT size=2><FONT size=2>dg.DataSource = mSortedList&nbsp; ' Note: no need for .ToList anymore</FONT></FONT></P><FONT size=2>
<P></P></FONT></FONT>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> dg_ItemDataBound(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> sender </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> System.Object, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> System.Web.UI.WebControls.DataGridItemEventArgs) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Handles</FONT></FONT><FONT size=2> dg.ItemDataBound</P>
<P></FONT>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2></P>
<P></FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If</FONT></FONT><FONT size=2> e.Item.ItemType = ListItemType.Item </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>OrElse</FONT></FONT><FONT size=2> e.Item.ItemType = ListItemType.AlternatingItem </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Dim</FONT></FONT><FONT size=2> mIndex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Integer</FONT></FONT><FONT size=2> = e.Item.DataSetIndex<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Dim</FONT></FONT><FONT size=2> item </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> mROList.Info = </FONT><FONT size=2>mSortedList(mIndex) ' Note: no need to cast anymore.<BR></FONT><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT></FONT></P>
<P>==============================================================</P>
<P>I think sorting and filtering for ReadOnly lists works with the MS Dynamic Query Library.</P>
<P>I am working with Rocky and Aaron to get it to work for Editable Lists. Right now a normal LINQ query works for multi-column sorting as long as there is no Where clause.</P>
<P>Single column sorting and filtering of normal LINQ queries works for Where and OrderBy.</P>
<P>MS Dynamic query works for single column sorting only. No filtering yet. We are still resolving the differences in implementation of Expressions that get passed from LINQ and MS Dyn. Query.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Blarm replied on Monday, February 16, 2009</h2><P>Thanks Joe.</P>
<P>It would be nice if a ROL returned a LinqBindingList so that the DatGridView sort worked automatically.</P>
<P>Instead I have also had to wire up the grids ColumnHeaderMouseClick event to display the correct sort glyph.</P>
<P>Bill</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, February 16, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Blarm:</strong></div><div><BR>It would be nice if a ROL returned a LinqBindingList so that the DatGridView sort worked automatically.<BR><BR>Bill<BR></div></BLOCKQUOTE>
<P>&nbsp;</P>
<P>Bill,</P>
<P>I suggested the same thing to Rocky and got shot down. I just wanted it for the sake of consistency throughout my code: when you write a Linq query you get back a LinqBindingList. But now I have to keep track if it is a ROC or ECC.</P>
<P>BTW - how would a LinqBindingList resolve this issue for you? The column header is still a String value which varies at run time - so how can you write&nbsp;a real&nbsp;LINQ query at design time? You still need the MS Dynamic Query Library unless I am missing something. If so, please let me know.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
