<html><header><title>Can't Convert Oracle DataReader to SafeDataReader</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Can't Convert Oracle DataReader to SafeDataReader</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3863.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>elfstoneUK posted on Thursday, November 08, 2007</h2><P><FONT face=Tahoma>Ladies and Gentlemen,</FONT></P>
<P><FONT face=Tahoma>your help please. </FONT></P>
<P><FONT face=Tahoma>I have been using CSLA for about three weeks now and read most of the book (up to chapter 9). I'm using VB 2005 and an Oracle 10g DB in a Windows Forms design. </FONT></P>
<P><FONT face=Tahoma>I'm in the process of building a prototype for the rest of the team. This is very much in the line with the Project Tracker example from the download.</FONT></P>
<P><FONT face=Tahoma>So far so good. But I have hit a brick wall. I can't seem to convert from OracleDataReader to the SafeDataReader. I want to take advantage of the implicit null checking.</FONT></P>
<P><FONT face=Tahoma>I have searched the forum but I can't see any resolution to this.</FONT></P>
<P><FONT face=Tahoma color=#800080>Can anyone tell if this can be done and how?</FONT></P>
<P><FONT face=Tahoma>I have tried <FONT color=#0000ff>CType</FONT>, <FONT color=#0000ff>DirectCast</FONT> which compile but give an InvalidCast error at runtime!</FONT></P>
<P><FONT face=Tahoma>Thanks for reading.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>elfstoneUK replied on Thursday, November 08, 2007</h2><P><FONT face=Tahoma>Here is the error:</FONT></P><FONT size=1>
<P><FONT color=#ff0000 size=2>Unable to cast object of type 'Oracle.DataAccess.Client.OracleDataReader' to type 'Csla.Data.SafeDataReader'."}</FONT></P>
<P><FONT color=#ff0000 size=2>System.InvalidCastException: {"Unable to cast object of type 'Oracle.DataAccess.Client.OracleDataReader' to type 'Csla.Data.SafeDataReader'</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>McManus replied on Thursday, November 08, 2007</h2><P>Hi,</P>
<P>You&nbsp;cannot&nbsp;create a SafeDataReader by casting. You should call the constructor of SafeDataReader and pass in the OracleDataReader:</P>
<P><FONT face="Courier New" size=2>Dim&nbsp;command as OracleCommand<BR>Dim safeReader as SafeDataReader</FONT></P>
<P><FONT face="Courier New" size=2>safeReader = New SafeDataReader(command.ExecuteReader)</FONT></P>
<P>Cheers,<BR>Herman</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>elfstoneUK replied on Thursday, November 08, 2007</h2><P>Herman,</P>
<P>Thanks for your reply. It worked! &nbsp;Fantastic. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P>
<P>So we get SafeDataReader and Smartdate all from a few lines of code. </P>
<P>I understand what's happening but I couldn't see in until you explained it. Simple really.&nbsp; <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, November 08, 2007</h2><P>You can create a subclass of SafeDataReader in your BO project so that you can override methods to help you work with Oracle. As I recall, Oracle does not have Bit field like SQL Server does so there is a problem with GetBoolean in SafeDataReader. I use a config file setting to switch between SQL Server and Oracle. I also code my DAL to use IDataReader and return SQLDataReader or OracleDataReader based on the same setting.</P>
<P>Here is my version:</P><FONT size=2>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MySafeDataReader<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> SafeDataReader</P>
<P>#</FONT><FONT color=#0000ff size=2>Region</FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2>" Class Variable Declarations "<BR>&nbsp; <BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mDBType </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = WebConfigurationManager.AppSettings(</FONT><FONT color=#ff00ff size=2>"DBType"</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> dataReader </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IDataReader)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.New(dataReader)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Region</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>Region</FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2>" Properties and Methods "</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetBoolean(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> i </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mDBType = </FONT><FONT color=#ff00ff size=2>"SQL Server"</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> DataReader.IsDBNull(i) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> DataReader.GetBoolean(i)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>ElseIf</FONT><FONT size=2> mDBType = </FONT><FONT color=#ff00ff size=2>"Oracle"</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> DataReader.IsDBNull(i) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>CStr</FONT><FONT size=2>(DataReader(i)) = </FONT><FONT color=#ff00ff size=2>"1"</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Region</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>elfstoneUK replied on Thursday, November 08, 2007</h2><P>Thanks Joe <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>I'm interested to learn how would you do this for the app.config?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, November 08, 2007</h2><P>I am not sure what you are asking here.</P>
<P>It is just a setting in the config file which you read on app startup.</P>
<P><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#a31515 size=2>appSettings</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>file</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>user.config</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>&gt; <BR>&nbsp; </FONT><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Authentication</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>CSLA</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;<BR>&nbsp; </FONT><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>DBType</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>SQL Server</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;<BR>&nbsp; &lt;!--</FONT><FONT color=#008000 size=2> &lt;add key="DBType" value="Oracle" /&gt; </FONT><FONT color=#0000ff size=2>--&gt;<BR>&nbsp;</FONT><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#a31515 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>ConnectionString</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>data source=joe;database=myDB;uid=myUser;password=myPwd</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;<BR></FONT><FONT color=#0000ff size=2>&lt;/</FONT><FONT color=#a31515 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P></P></FONT>
<P>Joe</P>
<P><FONT size=1>Public Shared ReadOnly Property <B>AppSettings</B>() As </FONT><B><U><FONT color=#215dc6 size=1>System</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>Collections</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>Specialized</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>NameValueCollection</P></B></U></FONT><FONT size=1>
<P>Member of: </FONT><B><U><FONT color=#215dc6 size=1>System</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>Web</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>Configuration</B></U></FONT><FONT size=1>.</FONT><B><U><FONT color=#215dc6 size=1>WebConfigurationManager</P></U></FONT><FONT size=1>
<P>Summary:</P></B>
<P>Gets the System.Configuration.AppSettingsSection data for the current Web application's default configuration.</P><B>
<P>Return Values:</P></B>
<P>A System.Collections.Specialized.NameValueCollection object containing the System.Configuration.AppSettingsSection object for the current Web application's default configuration.</P><B>
<P>Exceptions:</P></B><I>
<P>System.Configuration.ConfigurationErrorsException</I>: A valid System.Collections.Specialized.NameValueCollection object could not be retrieved with the application settings data.</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>elfstoneUK replied on Wednesday, November 14, 2007</h2><P class=MsoNormal><SPAN>Of course it is, thanks Joe <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></SPAN></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
