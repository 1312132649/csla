<html><header><title>contract operation 'Create' requires Windows identity for automatic impersonation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>contract operation 'Create' requires Windows identity for automatic impersonation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10610.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF posted on Friday, August 12, 2011</h2><p>Trying to implement a WCF service on an app server (IIS7 with WAS / AppFabric) using netTcpBinding endpoints within the intranet with impersonation enabled.&nbsp; I am getting the following error:</p>
<p>
<p><em>The contract operation &#39;Create&#39; requires Windows identity for automatic impersonation. A Windows identity that represents the caller is not provided by binding (&#39;NetTcpBinding&#39;,&#39;http://tempuri.org/&#39;) for contract (&#39;IWcfPortal&#39;,&#39;http://ws.lhotka.net/WcfDataPortal&#39;. </em></p>
</p>
<p>I&#39;ve looked at the WASHost example project, as well as the Authentication/Windows example project.&nbsp; But neither shows an example of both Win authentication and TcpBinding at the same time.</p>
<p>Am I missing something in the web.config file on the server that could cause this?&nbsp; If I set impersonateCallerForAllOperations to <em>false</em> I don&#39;t get the exception.&nbsp; But I would imagine this wouldn&#39;t impersonate correctly...is that right?&nbsp;&nbsp;&nbsp;Thanks.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, August 13, 2011</h2><p>Are you setting the credentials in the client-side WCF proxy (your WcfProxy subclass)? The Windows authentication example from the ebook should show how that&#39;s done.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Monday, August 15, 2011</h2><p>That must be it.&nbsp; I assume you&#39;re referring to the following code.&nbsp; That makes sense why impersonation is still working then even though I don&#39;t have it in the wcf config settings.&nbsp; Thanks.</p>
<p style="padding-left:30px;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Arial;"></span>factory.Credentials.Windows.AllowedImpersonationLevel = System.Security.Principal.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">TokenImpersonationLevel</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.Impersonation;
<p>&nbsp;</p>
</span></span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
