<html><header><title>Adding item to child collection not making parent Dirty</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Adding item to child collection not making parent Dirty</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10073.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM posted on Tuesday, February 15, 2011</h2><p>I&#39;m using CSLA 4.1 in a SL/MVVM+Dataportal config.&nbsp; I&#39;ve got an editable root with a child collection.&nbsp; When I add a new item to the child collection it does not make the editable root dirty.&nbsp; If I modify the new item in any way then the editable root gets marked dirty.&nbsp; It is almost like the isdirty check is not happening when I add the item to the collection.&nbsp; When the child is added to the collection it is marked as &#39;dirty&#39; and &#39;isnew&#39;.&nbsp; Any ideas?&nbsp; I&#39;m just calling&nbsp;a&nbsp; Root.ChildCollection.Add(ChildItem.NewChild(criteria)).&nbsp;&nbsp; Should I be adding items in a different way?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 15, 2011</h2><p>Since this is SL, is it possible you are hitting an async timing issue? What does your NewChild factory method do exactly? Call DataPortal.CreateChild, or DataPortal.Create?</p>
<p>The IsDirty implementation in BusinessBase is pretty simple - it gets the IsDirty value from its child (the collection). The implementation in the collection gets its value by looping through all the child objets in the collection. Nothing is cached or event-driven - it is calculated based on the actual values of the objects when the property is checked.</p>
<p>This means that async scenarios can be confusing, because if the new child has yet to be created and added when IsDirty is called, it could easily return false because the new child object isn&#39;t in the collection yet.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Tuesday, February 15, 2011</h2><p>I think I figured it part way out.&nbsp; I had a custom rule that was throwing an error.&nbsp; I put some extra checks in and that seems to have fixed it.&nbsp; Weird.&nbsp; So it looks like the rules manager swallows exceptions and sort of considers the object invalid?</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
