<html><header><title>BusinessBase Update Fails without Error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessBase Update Fails without Error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6563.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>davidc posted on Thursday, March 05, 2009</h2><P>My insert works but my update does not. When I call the save it comes back saying that it is dirty and valid never gets to the DataPortal_Update(). </P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>override</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Customer</FONT></FONT><FONT size=2> Save()<BR>{<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"1"</FONT></FONT><FONT size=2>;<BR><BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (IsDeleted &amp;&amp; !CanDeleteObject())<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SecurityException</FONT></FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"User not authorized to remove a project"</FONT></FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (IsNew &amp;&amp; !CanAddObject())<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SecurityException</FONT></FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"User not authorized to add a project"</FONT></FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!CanEditObject())<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.Security.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SecurityException</FONT></FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"User not authorized to update a project"</FONT></FONT><FONT size=2>);</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"2"</FONT></FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.IsDirty == </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"3"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.IsSavable == </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"4"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.IsValid == </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"5"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.Save();<BR>}<BR></FONT></P><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P dir=ltr>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>override</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DataPortal_Update()<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"6"</FONT></FONT><FONT size=2>;<BR><BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.IsDirty)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SqlConnection</FONT></FONT><FONT size=2> cn = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SqlConnection</FONT></FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Database</FONT></FONT><FONT size=2>.cmsConnection))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cn.Open();<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SqlCommand</FONT></FONT><FONT size=2> cm = cn.CreateCommand())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"7"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandText = </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"updateUser"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoInsertUpdate(cm);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"9"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DoInsertUpdate(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>SqlCommand</FONT></FONT><FONT size=2> cm)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastname = _lastname + </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"8"</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandType = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CommandType</FONT></FONT><FONT size=2>.StoredProcedure;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@UserId"</FONT></FONT><FONT size=2>, _userid);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Pwd"</FONT></FONT><FONT size=2>, _pwd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@FirstName"</FONT></FONT><FONT size=2>, _firstname);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Middle"</FONT></FONT><FONT size=2>, _middle);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@LastName"</FONT></FONT><FONT size=2>, _lastname);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Phone"</FONT></FONT><FONT size=2>, _phone);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Email"</FONT></FONT><FONT size=2>, _email);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Street"</FONT></FONT><FONT size=2>, _street);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@City"</FONT></FONT><FONT size=2>, _city);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@State"</FONT></FONT><FONT size=2>, _state);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@Zip"</FONT></FONT><FONT size=2>, _zip);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@CompanyName"</FONT></FONT><FONT size=2>, _companyname);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@TemplateId"</FONT></FONT><FONT size=2>, _templateId);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"@LogoType"</FONT></FONT><FONT size=2>, _logotype);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.ExecuteNonQuery();<BR>}</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P></FONT>I output the last name and it makes it all the way to the number 5.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Thursday, March 05, 2009</h2>Have you tried putting a break on your DataPortal_Insert() method? <br /><br />The only reason I can think of is if you object thinks that it is still new.<br /><br />Is this an object that you are retrieving via a dataportal_fetch() and then making changes and then attempting to save; or is a new object, you save changes and then make more changes to fire the update?<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>davidc replied on Friday, March 06, 2009</h2><P>Yes I use the same object to fetch and populate a FormView. Then I edit the last name and click update and it comes back saying updated successfull and "LastName12345". </P>
<P>Also I don't have any maxlength set on the last name and even when I put test in for the last name it comes back "test12345". It is a string in the BO and a varchar(50) in the database</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>IanK replied on Friday, March 06, 2009</h2><P>It may not be a&nbsp;great idea to change property in object after you call the save as 1 appending to field may in fact be breaking a rule such as a MaxLength you may have set and you also may be affecting the editlevel the object is at which in turn will cause your save to fail.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
