<html><header><title>Caching Pattern</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Caching Pattern</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3631.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>jgk1701 posted on Monday, October 01, 2007</h2><P>You will have to forgive this question&nbsp;as I am not experienced with multi-threading.&nbsp; I have been using the caching&nbsp;pattern outlined in&nbsp;the VB 2005 book on pages 405, 453, and 454.&nbsp; I am confused as to why the code in the GetList and InvalidateCache methods are not within Synclock blocks.&nbsp; I can see how this would not be an issue on the client side, but on the server side couldn't multiple threads (ie server side data portals) be trying to call these methods at the same time?</P>
<P>Thanks,</P>
<P>jk</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 02, 2007</h2>That's right, the sample is not threadsafe.&nbsp; Just like many code samples don't show error handling in each example, Rocky's example doesn't show a threadsafe way of caching data.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jgk1701 replied on Tuesday, October 02, 2007</h2><P>I have been experimenting with the Enterprise Library Caching Application Block and I am considering using this for caching.&nbsp; My code for the GetList and InvalidateCache methods would look something like this:</P>
<P>Public Shared Function GetList() As NameValueList<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim cm As CacheManager = CacheFactory.GetCacheManager<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim mList As&nbsp;NameValueList<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mList = DirectCast(cm.GetData("Key"), NameValueList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mList Is Nothing Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mList = DataPortal.Fetch(Of NameValueList)(New Criteria)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Add("Key", mList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return mList<BR>End Function<BR><BR>Public Shared Sub InvalidateCache()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim cm As CacheManager = CacheFactory.GetCacheManager<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Remove("Key")<BR>End Sub</P>
<P>Since the CacheManager is itself thread-safe (according to the Enterprise Library documentation), then there is no need for Synclock blocks in these methods, correct?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 02, 2007</h2>I use the caching block as well, and it is my understanding the CacheManager is threadsafe.&nbsp; Your code is similar to mine (I use the Exists method before fetching or removing a cached item).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jgk1701 replied on Tuesday, October 02, 2007</h2><P>OK, great.&nbsp; Thanks for your help.</P>
<P>jk</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Tuesday, October 02, 2007</h2>I cannot see the benefit of the code you posted above in a remote DataPortal scenario.<br>Using the CacheManager inside the shared/static GetList method usually affects only <br>clientside code, as I understand it. Of course we can call GetList() from within DataPortal_XYZ, <br>then you would manage a cache for all clients.<br><br>I don't know the Caching Application Block, so I might be wrong with my assumptions here.<br>For a perfect solution we would need to manage a CacheManager on the serverside (from within <br>DataPortal_Fetch) that would feed a local CacheManager. These two CacheManagers would have <br>to communicate with each other and somehow notify the clientside of any 'refresh' events...<br><br>Maybe Andy was indicating something like this with his Exists() hint...?<br><br>Just my two cents<br><br>Stefan<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, October 02, 2007</h2>The code will cache where ever it ends up being used.&nbsp; So if the client side uses it, it will cache there.&nbsp; If that same code (that is, the list is gotten through the code he posted) is also used in the DP_xzy methods (and RunLocal is not set), then it will cache on the server as well.&nbsp; <br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jgk1701 replied on Tuesday, October 02, 2007</h2><P>For the most part, caching will occur on the client side.&nbsp; However, we&nbsp;have some objects&nbsp;with business rules&nbsp;which require look ups in read-only collections.&nbsp; Since we check business rules in DataPortal_Create and DataPortal_Fetch calls, these read-only collections will be loaded and cached on the server side.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
