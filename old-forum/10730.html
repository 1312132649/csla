<html><header><title>Other User for new Thread</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Other User for new Thread</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10730.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>t.kehl posted on Saturday, October 01, 2011</h2><p>Hi.
I have a WPF-Application. There i start a seperate Thread, when the application starts. Now, I should set a other User for this Thread then the Application has. I have seen, that this works for non-WPF-Application. But in WPF-Application, the User (principal) will be stored in the ApplicationContext for WPF and always this is used. Is there a way, that I can set a other User for one thread in a WPF-Application?</p>
<p>&nbsp;</p>
<p>Thank you.</p>
<p>Best Regards, Thomas</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>t.kehl replied on Saturday, October 01, 2011</h2><p>Hi.</p>
<p>I have now tried something. When I change GetUser() of Csla.Xaml.ApplicationContextManager to this:</p>
<p>&nbsp;&nbsp;&nbsp; public IPrincipal GetUser()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPrincipal current;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (System.Windows.Application.Current != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_principal == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ApplicationContext.AuthenticationType != &quot;Windows&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _principal = new Csla.Security.UnauthenticatedPrincipal();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _principal = new WindowsPrincipal(WindowsIdentity.GetCurrent());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Thread.CurrentPrincipal is Csla.Security.CslaPrincipal &amp;&amp; !(Thread.CurrentPrincipal is Csla.Security.UnauthenticatedPrincipal)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current = Thread.CurrentPrincipal;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current = _principal;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current = Thread.CurrentPrincipal;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return current;<br />&nbsp;&nbsp;&nbsp; }</p>
<p>It is working for me. Now my question: Does I have problems which I don&#39;t see now, with this solution? Can this solution work general or would it be possible to change Csla, that I can change this logic from outside - for example with an Event?</p>
<p>Best Regards, Thomas</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
