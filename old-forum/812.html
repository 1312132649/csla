<html><header><title>How to Refresh a shared list</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to Refresh a shared list</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/812.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>David posted on Thursday, August 03, 2006</h2><P><FONT face=Arial>I have a Read Only List object that is used by multiple objects in my application. I want all objects to use the one instance of the list so I use the following shared function to access it:</FONT></P>
<P><FONT face=Arial>Private Shared mList As ReferenceList<BR>Public Shared Function GetList() As ReferenceList<BR>&nbsp; If mList Is Nothing Then<BR>&nbsp;&nbsp;&nbsp; mList = DataPortal.Fetch(Of ReferenceList)(New Criteria())<BR>&nbsp; End If<BR>&nbsp; Return mList<BR>End Function</FONT></P>
<P><FONT face=Arial>Basic stuff, and this works fine. However,&nbsp;I want to add a Refresh method to my list object that will cause the list to be refetched from the database. When this method is called, ALL the objects referencing the shared list need to see that it has been updated.</FONT></P>
<P><FONT face=Arial>I tried this:</FONT></P>
<P><FONT face=Arial>Public Sub Refresh()<BR>&nbsp; Dim NewList As ReferenceList<BR>&nbsp; mList = Nothing<BR>&nbsp; NewList = ReferenceList.GetList()<BR>End Sub</FONT></P>
<P><FONT face=Arial>This does cause the list to be refetched from the database, but I now have two instances of my list in memory with all the existing objects continuing to reference the old instance.</FONT></P>
<P><FONT face=Arial>Is there some obvious way to do this, or do I have to resort to manually reconstructing the existing list object?<BR></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, August 03, 2006</h2>I would do this in your list:<br><br>Private mInstance as <font face="Arial">ReferenceList</font><br>Public Shared ReadOnly Property List () As <font face="Arial">ReferenceList</font> <br>Get<br>&nbsp;&nbsp;&nbsp; If mInstance Is Nothing Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  mInstance = GetList()<br>&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; return mInstance<br>End Get<br>End Property<br><br>Public Shared Sub Invalidate()<br>&nbsp;&nbsp;&nbsp; mInstance = Nothing<br>End Sub<br><br><br><br>So instead of storing the list in a field in your bo, you always call that property and you always get the better version. You also don't keep old references around...<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>David replied on Thursday, August 03, 2006</h2><P><FONT face=Arial>Thanks for the quick reply.</FONT></P>
<P><FONT face=Arial>mInstance would&nbsp;need to be declared 'Shared', but I still don't think this would solve the problem.</FONT></P>
<P><FONT face=Arial>My understanding is that because the data portal returns a new object, you need to somehow get all existing references to point to the new object. Accessing the list through a property doesn’t really change this, unless the existing objects periodically update their reference by calling this property.</FONT></P>
<P><FONT face=Arial>I tried clearing all the items from my old list and then adding all the items from the new list as follows:</FONT></P>
<P><FONT face=Arial>&nbsp; Public Sub Refresh<BR>&nbsp;&nbsp;&nbsp; Dim OldList As ReferenceList = Me<BR>&nbsp;&nbsp;&nbsp; mList = Nothing<BR>&nbsp;&nbsp;&nbsp; Dim NewList As ReferenceList = GetList()<BR>&nbsp;&nbsp;&nbsp; OldList.IsReadOnly = False<BR>&nbsp;&nbsp;&nbsp; For Each r As ReferenceListInfo In NewList<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OldList.Add(r)<BR>&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp; OldList.IsReadOnly = True<BR>&nbsp; End Sub</FONT></P>
<P><FONT face=Arial>This worked and all the visible grids refreshed themselves, but it seems a bit of an arduous approach.<BR></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, August 04, 2006</h2>Sorry about that... I didn't compile the sample. Damn forum ;)<br><br>I was thinking of BOs referencing the property, not grids, so I see your point.<br>Another possible approach would be to have a shared event in your list that you would have to listen wherever you use your list. When you catch the event, you would then update your references.<br><br>Anyway, I don't think that what you're currently doing is wrong anyway, but you'll have different references that way, which in most cases is ok, but remember that if you reference 2 different objects (or more if this is done with frequence), you're going to be allocating more and more memory and the GC will not get rid of those...<br>Which in your case is probably not that big of a problem since the items in all list will be the same, so only the list object will be different which isn't a memory waster.<br>Keep in mind though that lists usually call SetParent in the children, I don't know if and how that could affect you in any way. I believe this is not the case for name value lists, but I'm not 100% sure.<br><br><br>Andrés</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
