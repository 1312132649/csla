<html><header><title>Wish / Bug with CurrentUICulture?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Wish / Bug with CurrentUICulture?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7782.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Wednesday, October 14, 2009</h2><P>The CheckRules() on the ObjectFactory is executed in the&nbsp;background worker from the dataportal, the .NET ResourceManager looks at the CurrentThread CurrentUICulture to find the correct resource.<BR><BR>We have the need to force the culture to dutch in every situation, however a backgroundworker process does create a new thread and the CheckRules in the ObjectFactory does the checking in the default system language instead of the language which is set at application startup:<BR><BR><FONT color=#008000 size=2><FONT color=#008000 size=2>// globalization forceren op nederlands<BR></FONT></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CultureInfo</FONT></FONT><FONT size=2> culture = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CultureInfo</FONT></FONT><FONT size=2>.CreateSpecificCulture(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"nl-NL"</FONT></FONT><FONT size=2>);<BR>System.Threading.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Thread</FONT></FONT><FONT size=2>.CurrentThread.CurrentCulture = culture;<BR>System.Threading.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Thread</FONT></FONT><FONT size=2>.CurrentThread.CurrentUICulture = culture;</P>
<P></FONT>I've found someone else with the same problem, but he has access to the backgroundworker and could solve it himself.<BR><BR></P><A href="http://stackoverflow.com/questions/1460023/how-can-i-change-the-currentculture-of-the-entire-process-not-just-current-threa">http://stackoverflow.com/questions/1460023/how-can-i-change-the-currentculture-of-the-entire-process-not-just-current-threa</A><BR><BR>Hereby my request to set the culture in the DataPortal and DataPortalT classes like above</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv replied on Wednesday, October 14, 2009</h2><P>Does putting the following in your App static constructor help?</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>partial</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>class</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>App</FONT></FONT><FONT size=2> : </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Application</P></FONT></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> App()</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// Ensure the current culture passed into bindings is the OS culture.</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// By default, WPF uses en-US as the culture, regardless of the system settings.</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>//</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>FrameworkElement</FONT></FONT><FONT size=2>.LanguageProperty.OverrideMetadata(</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>typeof</FONT></FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>FrameworkElement</FONT></FONT><FONT size=2>),</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>FrameworkPropertyMetadata</FONT></FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>XmlLanguage</FONT></FONT><FONT size=2>.GetLanguage(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CultureInfo</FONT></FONT><FONT size=2>.CurrentCulture.IetfLanguageTag)));</P>
<P>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 14, 2009</h2><P>The data portal (client-side, .NET only) raises some static events you can use for pre- and post-processing.</P>
<UL>
<LI>DataPortalInitInvoke</LI>
<LI>DataPortalInvoke</LI>
<LI>DataPortalInvokeComplete</LI></UL>
<P>You should be able to use DataPortalInitInvoke to set up your thread's context before the data portal copies the context into the message that is sent to the server.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 14, 2009</h2>Hi, <br><br>Are you using the BackgroundWorker component or the async DataPortal&lt;T&gt; <br><br>If you are using the DataPortal&lt;T&gt; then your request may be about extending the DataPortalAsyncRequest to include the CurrentCulture and CurrentUICulture. This seems perfectly reasonable to me as the DataPortal does transfer the culture info to the server DataPortal and the DataPortal&lt;T&gt; should (imo) not be locked down to system default culture on the client. <br><br>And I strongly recommend to use the async DataPortal&lt;T&gt; rather than BackgroundWorker. DataPortal&lt;T&gt; today sets the following values on the background thread: <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.User = request.Principal;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.SetContext(request.ClientContext, request.GlobalContext);<br><br>If you use the BackgroundWorker you will loose theClientContext and GlobalContext (when accesed will create new ones) and the background thread will run on WindowsPrincipal. LocalContext is always Thread specific and will not be transferred to another Thread. <br><br><b>I'd vote for this extension/change as well - we will probably be using another culture than system default in our applications in the future. </b><br><br>An alternative workaround/fix may be to:<br>- set the culture name in ClientContext variable (when you set custom culture on UI thread)<br>- make sure to use the DataPortal&lt;T&gt; for async DataPortal calls<br>- use your own intermediate baseclasses <br>- set the tread culture in Invoke method in your ObjectFactory base class (gets the DataPortalContext as parameter)<br><br>This will allow you to transfer the client custom UI culture to ObjectFactory base clas and set the culture on the "logical serverside"&nbsp; before the actual Factory method is called. No change required in your Factory classes other than make sure to inherit from your intermediate base class. <br><br>Although more complex than Rockys suggestion I expect this would work for Silverlight too. <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 14, 2009</h2><P>Added to wish list (though my suggested workaround should be fine as well).</P>
<P><A href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=599">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=599</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Thursday, October 15, 2009</h2>Thanks for adding this to the wishlist, we have a workaround to put this in our own layer and use the application context or something which is being read in&nbsp;our U4AObjectFactory.<BR><BR>@<A HREF="/members/JonnyBee.aspx">JonnyBee</A> <BR>About the dataportal, we use it always ASync except when calling business factory methods from the server. When calling from the client it's like this:<BR><BR><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> GetVoorwaarde(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> prdVoorwaardeID, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortalResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Voorwaarde</FONT></FONT><FONT size=2>&gt;&gt; completed)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortal</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Voorwaarde</FONT></FONT><FONT size=2>&gt; dp = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortal</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Voorwaarde</FONT></FONT><FONT size=2>&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp.FetchCompleted += completed;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp.BeginFetch(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>VoorwaardeCriteria</FONT></FONT><FONT size=2>(prdVoorwaardeID, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>NaarVoorwaarde</FONT></FONT><FONT size=2>.Bestaand));<BR>}</P></FONT><BR>The BeginFetch starts a backgroundworker in csla code under DataPortalT.cs BeginFetch.<BR><BR><FONT size=2>
<P></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;summary&gt;<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> Called by a factory method in a business class or<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> by the UI to retrieve an existing object, which is loaded <BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> with values from the database.<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/summary&gt;<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;param name="criteria"&gt;</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>Object-specific criteria.</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/param&gt;<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;param name="userState"&gt;</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>User state data.</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/param&gt;<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> BeginFetch(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> criteria, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> userState)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> bw = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.ComponentModel.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BackgroundWorker</FONT></FONT><FONT size=2>();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bw.RunWorkerCompleted += Fetch_RunWorkerCompleted;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bw.DoWork += Fetch_DoWork;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bw.RunWorkerAsync(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortalAsyncRequest</FONT></FONT><FONT size=2>(criteria, userState));<BR>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Tuesday, April 13, 2010</h2><p>issue not found?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, April 13, 2010</h2><p>I think it was a duplicate and was merged into another issue - Jonny changed the data portal to pass culture through on async requests for CSLA 4, so I expect that this issue has been resolved.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Hossain replied on Tuesday, October 15, 2013</h2><p>Hi,</p>
<p style="margin:0cm 0cm 0pt;" class="MsoNormal"><span style="font-size:9pt;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;">Is this problem solved. I was doing diffrent aproach but no progress. I there a way to set the culture from client side and taking corrent Resources?</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, October 15, 2013</h2><p>Hi,.</p>
<p>Can you provide us with a code sample that reproduce the issue?&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
