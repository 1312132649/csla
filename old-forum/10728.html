<html><header><title>Business Rules, Generics and inheritance</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Business Rules, Generics and inheritance</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10728.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom posted on Friday, September 30, 2011</h2><p>I&#39;m trying to get an authorization rule to work with multple objects.  Within the Execute method, I use the Parent property derived from the BusinessBase object.</p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% white;"><span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute(<span style="color:#2b91af;">AuthorizationContext</span>&nbsp;context)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(_roles.Count&nbsp;&gt;&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">FullyLoadedCost</span>&nbsp;flc&nbsp;=&nbsp;context.Target&nbsp;<span style="color:blue;">as</span>&nbsp;<span style="color:#2b91af;">FullyLoadedCost</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(flc&nbsp;!=&nbsp;<span style="color:blue;">null</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">FullyLoadedCostList</span>&nbsp;fl&nbsp;=&nbsp;flc.Parent&nbsp;<span style="color:blue;">as</span>&nbsp;<span style="color:#2b91af;">FullyLoadedCostList</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(fl&nbsp;!=&nbsp;<span style="color:blue;">null</span>&nbsp;&amp;&amp;&nbsp;fl.WhatIf)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.HasPermission&nbsp;=&nbsp;<span style="color:blue;">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />...<br /><br />In the current example this is specific to the FullyLoadedCost object.<br /><br />I&#39;d like to make the authorization rule more generic.<br />I can use an interface for the boolean WhatIf property, but I can&#39;t <br />quite figure how to get BusinessBase&lt;T&gt; out of the context Target property.<br /><br />The below doesn&#39;t work as it is requiring T to be defined.<br />Csla.<span style="color:#2b91af;">BusinessBase</span>&lt;T&gt;&nbsp;myBase&nbsp;=&nbsp;context.Target&nbsp;<span style="color:blue;">as</span>&nbsp;Csla.<span style="color:#2b91af;">BusinessBase</span>&lt;T&gt;;
<br />Perhaps I could do this if the AuthorizationRule was generic itself.<br /><br />Any ideas?</pre></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>tiago replied on Friday, September 30, 2011</h2><p>Hi Curelom,</p>
<p>Have a look at NoDuplicates business rule. You can find it at <a href="http://cslagenfork.codeplex.com/">http://cslagenfork.codeplex.com/</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, October 01, 2011</h2><p>Hi, </p>
<p>You could also look at Csla.Rules.RuleExtensions and how it&nbsp; &quot;wrap&quot; a lambda expression into a rule. </p>
<p><a href="http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Source/Csla/Rules/BusinessRulesExtensions.cs?view=markup">http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Source/Csla/Rules/BusinessRulesExtensions.cs?view=markup&nbsp; </a></p>
<p>I suppose you could create generic Authz rule with a lamda &quot;WhatIf&quot;. (I haven&#39;t tried this on Authz rules myself). </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Saturday, October 01, 2011</h2>Interesting.  I&#39;ll have to give this a try.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
