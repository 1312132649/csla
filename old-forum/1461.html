<html><header><title>Should this logic be in the BO or the proc?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Should this logic be in the BO or the proc?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1461.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rhinoishere posted on Wednesday, October 11, 2006</h2><P>Lets say I'm doing a delete on a "Users" table, but before I delete a user, I have to check if they have any associated rows in the "Assignments" table. If no rows are found in Assignments, the User is deleted. If rows are found in the Assignments table, nothing is done. </P>
<P>In the past, all this logic was handled in a proc. However... whether the user should be deleted or not is business logic, correct?&nbsp;So I'm assuming it should go in the BO instead of the proc. </P>
<P>This means I'll have to create a seperate proc to get the count on the Assignments table. The count would then be returned to the BO.&nbsp; If the count is greater than zero, no delete will be done. </P>
<P>If this sounds correct, then where do I put the method that gets the count from the Assignments table? </P>
<P>Should I just add a GetUserAssignmentCount(UserID) method inside the User business object?</P>
<P>Please tell me where I am going wrong.</P>
<P>thanks</P>
<P>(and, sorry, this question did end up being a bit similar to one I posted earlier)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Thursday, October 12, 2006</h2><DIV>I&nbsp;will write this logic directly in&nbsp;the stored procedure or SQL statement because it is more efficient than checking the count in Assignments table (separate query) for each user. It might look like this (in non-optimized way):</DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face="Courier New" size=2>DELETE [User]</FONT></DIV>
<DIV><FONT face="Courier New" size=2>WHERE&nbsp; UserID = @UserID</FONT></DIV>
<DIV><FONT face="Courier New" size=2>AND&nbsp;&nbsp;&nbsp;&nbsp;NOT EXIST ( SELECT&nbsp;UserID FROM Assignments WHERE UserID = @UserID )</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV>Then, you check the affected row count from your code after ExecuteNonQuery().</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV>
<DIV>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rhinoishere replied on Thursday, October 12, 2006</h2><P>Ok, that's exactly how we have done it in the past.</P>
<P>That is essentially putting business logic into a proc though, correct?&nbsp; I thought that was a no no. I'm sure there is a line that you don't want to put business logic into the proc, but it seems like a blurry line to me at this point.</P>
<P>thanks for your help!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Thursday, October 12, 2006</h2><DIV>Well, you can put all your logic in code, if&nbsp;this is your policy. In&nbsp;this case, you&nbsp;can create a private helper function in your BO that first executes&nbsp;a query to perform the count then the delete query. In a more critical case, you might encounter concurrency issue as you are executing two queries where the count might be invalid when your are about to execute your delete query.</DIV>
<DIV>&nbsp;</DIV>
<DIV>I my opinion, it is always a good practise to centralize business logic at one location. However, what I have encountered in most real world projects, I don't think you can "practically" centralize ALL logic in one place; but I will try my best to&nbsp;achive&nbsp;centralization whenever possible. A good example would be on reporting and searching, which always involves a large data set in result. Thus, I would choose to write most of the query/logic in SQL/stored procedure for practical purposes.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, October 13, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rhinoishere:</strong></div><div>
<P>Ok, that's exactly how we have done it in the past.</P>
<P>That is essentially putting business logic into a proc though, correct?&nbsp; I thought that was a no no. I'm sure there is a line that you don't want to put business logic into the proc, but it seems like a blurry line to me at this point.</P>
<P>thanks for your help!</P>
<P></div></BLOCKQUOTE></P>
<P>This isn't a religion, it's just a job.&nbsp; That's a guideline, not a commandment.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JHurrell replied on Thursday, October 12, 2006</h2>First off, I think you need to do a little work before you call the procedure that deletes a user and it should start in the UI.<br><br>You shouldn't even be able to delete a user unless that user is in a state that allows them to be deleted. You're probably already checking to see if the current user has the necessary authorization rules and roles required to allow them to delete users.<br><br>What you might want to consider is creating some object that retrieves information about the user and their relationship to other objects, in your case Assignments. If they have assignments and this precludes them from being deleted, don't even display the delete link or button.<br><br>For example, you might provide a grid that displays users. One of the columns could display a summary of the number of Assignments. If the number of Assignments is zero, display the delete link, if greater than zero, don't display the delete link.<br><br>If there were no Assignments associated with the user when you displayed the grid but are when you delete, the database can tell you that with an error and you can decide whether to update the grid, display an error, take the user to a page that alllows them to administer the relationships between users and Assignments or any other paths.<br><br>- John<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jkellywilkerson replied on Thursday, October 12, 2006</h2><P>You could also setup a CommandObject for the User BO similar to the "Exists" class that would return a bool, like "HasAssignments" or something.&nbsp; That way the delete button's enabled prop could be set to !(User.HasAssignments(USERID)).&nbsp; This works&nbsp;well and is somewhat close to your thought of adding a GetAssignmentCount.</P>
<P>Hope it helps.</P>
<P>Kelly.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
