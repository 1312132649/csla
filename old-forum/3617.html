<html><header><title>Saving Multiple Children Transaction / IsDirty Problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Saving Multiple Children Transaction / IsDirty Problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3617.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rahulbpatel posted on Friday, September 28, 2007</h2><P>I have an Order root object that has three child objects:</P>
<P>&nbsp;&nbsp;&nbsp; Order Root BO</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Items Child 1 BO (collection)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Shipping Info Child 2 BO</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Payment Info Child 3 BO</P>
<P>I am having a problem where in the Order&nbsp;DataPortal_Insert the insert calls to&nbsp;children 1 and 2&nbsp;are successful, but&nbsp;child&nbsp;3 fails&nbsp;with an exception&nbsp;because it also calls an external&nbsp;payment processor to authorize payment on an insert.&nbsp; The exception is caught by the ASP.NET UI code and presented to the user and the Data_PortalInsert is marked with [Transactional(TransactionalTypes.TransactionScope)] so&nbsp;nothing is&nbsp;committed in the database.&nbsp; The problem is that if the user corrects the payment information and then re-saves, children 1 and 2 updates are not called because they were marked as old in the first save.&nbsp;</P>
<P>Is there a way to handle this situation?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, September 28, 2007</h2><P>I think you are supposed to Clone the Root BO as part of the Save. And if there is an Exception you re-set your local variable to the Cloned copy so that your object state is back to what it was prior to calling Save the first time. Rocky has discussed this many times. Check the books and his blog and other threads here for a sample.</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
