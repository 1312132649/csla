<html><header><title>CSLA and JSON (serialization for lists)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA and JSON (serialization for lists)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8473.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Thursday, February 04, 2010</h2>I've just recently started using my CSLA objects along with JSON in my AJAX. It's been working great for single objects, but I'm struggling with lists. When I get my list to the presentation layer and send it back I keep running into walls with the serialization from json back to the csharp csla object. <br /><br />Has anyone had a lot of experience with this? Maybe someone could nudge me in the right direction.<br /><br />I've been using the JavaScriptSerializer to get it to and from. Having trouble deserializing lists though.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 04, 2010</h2><P>You should never directly serialize business objects into XML or JSON for external consumption. I've discussed this numerous times, including in Chapter 21 of the <EM>Expert 2008 Business Objects</EM> book and in the FAQ</P>
<P><A href="http://www.lhotka.net/cslanet/faq/ObjectsAsServiceContract.ashx">http://www.lhotka.net/cslanet/faq/ObjectsAsServiceContract.ashx</A></P>
<P>Instead, you should define a data contract for the external interface, and load/unload the data contract proxy objects from your business objects (possibly using DataMapper).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 04, 2010</h2>ack. I see what you're saying: couples the presentation layer. <br /><br />Sigh. It was so clean and easy that way tho.... ah well<br /><br />But isn't databinding to webforms essentially the same concept??? Changing your objects breaks that 'consumer' as well. Isn't coupling ultimately inevitable to some degree?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 04, 2010</h2><P>I think data binding (web forms, windows forms and especially XAML) provides a layer of indirection and decoupling between the view and model; between the UI and business layers.</P>
<P>Data binding uses reflection to do its work, and isn't actually type-specific. In other words, you can typically provide <EM>any object</EM> that has the right shape and it will work. As long as the object exposes the properties required by data binding (whatever is bound to the UI) all is good.</P>
<P>So yes, there's a level of coupling, but it is generally pretty low.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 04, 2010</h2>For others interested: <br /><br />Rocky, your quote from http://forums.lhotka.net/forums/thread/37549.aspx really helped<br /><br /><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Rocky:</strong></div><div><br />Yes, you should create another object that maps the business layer information to the interface layer.<br /> <br />This is what an ASP.NET Page (aspx, etc) does to get business object properties into HTML, and is exactly what you should do for a service.<br /><br />You can do this as you suggest, with an aspx page that writes out the stream. Or an asmx page. Or as you say, an HttpHandler.<br /><br />But a lot of people do this sort of thing with an aspx page.<br /><br />Technically you don’t need some other object either – the generation of XML or JSON can be done in the aspx page.<br /><br />Which almost makes sense if you think about it – an aspx page usually renders HTML, you are just having it render JSON or XML.<br /><br />And if you want a page with a different format you create a different aspx page right? So if you need different XML or JSON you’d just create a different aspx page for that too. Otherwise how does the calling app know what it is asking for?<br /></div></BLOCKQUOTE><br /><br />So now I'll just make some simple dto classes and load/unload at the interface of the service and only expose those classes instead. I can then use JavaScriptSerializer on THOSE classes, coupling presentation only to the interface like suggested.<br /><br />A little bit more code but a LOT less coupling.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Thursday, February 04, 2010</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>decius:</strong></div><div>So now I'll just make some simple dto classes and load/unload at the interface of the service and only expose those classes instead. I can then use JavaScriptSerializer on THOSE classes, coupling presentation only to the interface like suggested.

A little bit more code but a LOT less coupling.</div></BLOCKQUOTE><br><br>Great choice and also from security perspective too.&nbsp; This way you only expose the properties you want to expose and not allowing anybody calling your webservice with tempered json object.<br><br>Ricky<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Thursday, February 04, 2010</h2>Cool. My only question now is for when I get back to loading changed values to my csla object when receiving changed data on the interface. <br /><br />Specifically for lists. Will I have to loop through each object performing object something like below?? I've never had to do more than simple tasks with the datamapper.<br /><br />foreach (var copyFrom in receivedDto)<br />				{<br />					var copyTo = serverCslaList.Where(x => x.Id == copyFrom.Id).Single();<br />				<br />	Csla.Data.DataMapper.Map(copyFrom.Values, copyTo);<br />				}</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
