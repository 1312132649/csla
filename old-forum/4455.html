<html><header><title>CSLA 3.5 SetProperty&lt;P&gt;()</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.5 SetProperty&lt;P&gt;()</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4455.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>damo posted on Tuesday, March 04, 2008</h2><font face="Tahoma" size="2">Hi All,<br></font><font face="Tahoma" size="2">I've just read &amp; commented Rocky's <a href="http://www.lhotka.net/weblog/CSLANET35PropertyCodeReduction.aspx">post</a> regarding the Property Code reduction and it looks good.<br></font><font face="Tahoma" size="2">I find a lot of the time, in my property setter, I may need to set the private backer of another property or do some calulation <b>before</b> PropertyHasChanged() is called. Otherwise the UI won't pick up the change to the other property. For instance:</font><blockquote><font face="Tahoma" size="2">set {<br>&nbsp; if(_field1 != value){<br>&nbsp;&nbsp;&nbsp; _field1 = value;<br>&nbsp;&nbsp;&nbsp; _field2 = field1 / 2;<br>&nbsp;&nbsp;&nbsp; RecalculateSomething();<br>&nbsp;&nbsp;&nbsp; PropertyHasChanged();<br>}<br></font></blockquote><font face="Tahoma" size="2">Looking at CSLA3.5Beta 2 it would appear that this is not possible if using:</font><blockquote><font face="Tahoma" size="2">set { SetProperty&lt;double&gt;(Field1Property, value); }<br></font></blockquote><font face="Tahoma" size="2">So I propose overloading SetProperty to allow a callback delegate to be passed in:</font><blockquote><font face="Tahoma" size="2">protected void SetPropertyCallback();<br>protected void SetProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo, P newValue, SetPropertyCallback </font><font face="Tahoma" size="2">setPropertyCallback</font><font face="Tahoma" size="2">);<br></font></blockquote><font face="Tahoma" size="2">And modify BusinessBase.LoadPropertyValue&lt;P&gt;():</font><blockquote><font face="Tahoma" size="2">if (markDirty) {<br>&nbsp;&nbsp;&nbsp; OnPropertyChanging(propertyInfo.Name);<br>&nbsp;&nbsp;&nbsp; FieldManager.SetFieldData&lt;P&gt;(propertyInfo, newValue);<br>&nbsp;&nbsp;&nbsp; if(setPropertyCallback!= null)<br>&nbsp;&nbsp; &nbsp;&nbsp; setPropertyCallback();<br>&nbsp;&nbsp;&nbsp; PropertyHasChanged(propertyInfo.Name);<br>}<br></font></blockquote><font face="Tahoma" size="2">(I also propose refactoring the instances where the above code appears into a single private function).<br><br></font><font face="Tahoma" size="2">So from a callers perspective, we can do things like this:</font><blockquote><font face="Tahoma" size="2">set { SetProperty&lt;double&gt;(Field1Property, value, delegate {RecalculateSomething();} ); }</font></blockquote><font face="Tahoma" size="2">Any thoughts on this?</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives replied on Tuesday, March 04, 2008</h2><P>If your using managed fields, it's possible to call one of the protected overloads of LoadProperty.&nbsp; These overloads do not call PropertyHasChanged.&nbsp; So, you can set your fields using a call to LoadProperty for each field and then call PropertyHasChanged.&nbsp; The LoadProperty methods do not automatically do any authorization checking, so you might also need to make a call to CanWriteProperty.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>damo replied on Tuesday, March 04, 2008</h2>Actually, the overloads seem to be calling the private LoadProperty implementation, so PropertyHasChanged will get called. <br><br>Rocky suggested that I create a rule to perform the calculation, but to me, that doesn't seem right - they are called ValidationRules...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives replied on Tuesday, March 04, 2008</h2><P>The LoadProperty overloads call the private LoadPropertyValue method with the last parameter, markDirty, equal to false, which prevents the call to PropertyHasChanged.&nbsp; I haven't actually run any code to test what I suggested, so maybe I'm missing something else.</P>
<P>&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>damo replied on Wednesday, March 05, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>damo:</strong></div><div>Rocky suggested that I create a rule to perform the calculation, but to me, that doesn't seem right - they are called ValidationRules...<br></div></BLOCKQUOTE><br>I've looked further into this. There is definitely situations where I only want RecalculateSomething() to run only once - when the property private backer has changed. It may be for performance reasons - defining it as a validation rule means that it'll get run whenever CheckRules() is called and if there are several properties doing this there be several unrequired recalculations performed.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
