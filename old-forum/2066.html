<html><header><title>Bug or optimization for DeleteChild()?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Bug or optimization for DeleteChild()?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2066.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>marklindell posted on Tuesday, January 02, 2007</h2><P>I have a scenario with CSLA v1 and v2 that requires some reflection by the community.</P>
<P>I have a business collection class where I am not using BeginEdit so my edit level is always 0.&nbsp; I am adding and removing many new objects from the collection during my use case.&nbsp; So many objects that when I serialize my state to disk it very quickly grows larger than 2MB.&nbsp;&nbsp; This is greatly impacting the performance of the application unnecessarily.</P>
<P>What would be the purpose of adding new edit level zero objects to the deleted list in the DeleteChild method?</P>
<P>Does this seem like a solid optimization to add the following if statement to the DeleteChild method in BusinessCollectionBase?</P>
<P><SPAN>private</SPAN><SPAN> <SPAN>void</SPAN> DeleteChild(C child)<BR>{<BR>&nbsp;&nbsp;&nbsp; <SPAN>// mark the object as deleted<BR>&nbsp;&nbsp;&nbsp; </SPAN>child.DeleteChild();<BR>&nbsp;&nbsp;&nbsp; <SPAN>if</SPAN> (_editLevel &gt; 0 &amp;&amp; !child.IsNew)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeletedList.Add(child);<BR>}</SPAN></P>
<P>What would be the risk?&nbsp; Am I missing any scenarios?&nbsp; I reviewed CSLA 1.0 Pages 236-246 but everything centers around BeginEdit scenarios.</P>
<P>I tend to shy away from changes to CSLA but this one might be necessary unless I am just missing something.</P>
<P>Any feedback would be greatly appreciated.</P>
<P>D. Mark Lindell<o:p><FONT face=Calibri>&nbsp;</FONT></o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 02, 2007</h2>That seems like it would work, although it seems odd you'd have so many new, deleted objects in a collection.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>marklindell replied on Wednesday, January 03, 2007</h2><P>Thanks for the response.&nbsp; My logic was wrong in my suggested "if" statement.</P>
<P>It should be:</P>
<P>if (_editLevel &gt; 0 || !child.IsNew)</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, January 03, 2007</h2>That would still add the new child to the deleted list, which I thought you were trying to prevent.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Wednesday, January 03, 2007</h2>Not if the edit level is zero and the item is new.&nbsp; The rest of the time it would need to be added to the deleted list.&nbsp; Edit level greater than zero would need to place the item back in the main list and items that are not new would need to be deleted.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
