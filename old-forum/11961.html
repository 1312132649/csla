<html><header><title>TimeZoneInfo Property Will not Serialize</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>TimeZoneInfo Property Will not Serialize</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11961.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>thaehn posted on Monday, April 29, 2013</h2><p>I&nbsp;am getting an error when my business object is being returned from the server to Silverlight:</p>
<p style="PADDING-LEFT:30px;"><strong>Type &#39;System.TimeZoneInfo&#39; with data contract name &#39;TimeZoneInfo:http://schemas.datacontract.org/2004/07/System&#39; is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.</strong></p>
<p>I have a property that is of type TimeZoneInfo which is needed for a Telerik control (it is in the implementation of an interface):</p>
<p>&nbsp;<span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">public</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">static</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">readonly</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">PropertyInfo</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">&lt;</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">TimeZoneInfo</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">&gt; TimeZoneProperty = RegisterProperty&lt;</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">TimeZoneInfo</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">&gt;(c =&gt; c.TimeZone);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">public</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">TimeZoneInfo</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> TimeZone</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">get</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> { </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">return</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> GetProperty(TimeZoneProperty); }</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">set</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> { SetProperty(TimeZoneProperty, </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">value</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">); }</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;"></span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;"><span style="font-family:Calibri;font-size:small;">I don&#39;t really know how to&nbsp;resolve this issue.&nbsp; Can someome offer some&nbsp;help?&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 10pt;">Todd</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, May 04, 2013</h2><p>It is obviously a known problem. See these links: </p>
<p><a href="http://stackoverflow.com/questions/7704891/c-sharp-timezoneinfo-serialization">com/questions/7704891/c-sharp-timezoneinfo-serialization</a></p>
<p><a href="http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/f164f185-ae18-4775-a2ff-a814813d262d">http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/f164f185-ae18-4775-a2ff-a814813d262d <br /></a></p>
<p>So my best suggestion would be to make TimeZoneInfo property with a private backing field markes as [NonSerialized] and either </p>
<ul>
<li>add a proxy property </li>
<li>add custom code to OnSetState/OnGetState</li>
</ul>
<p>For example:</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:#2b91af;">TimeZoneInfo</span>&gt;&nbsp;TimeZoneProperty&nbsp;=&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegisterProperty&lt;<span style="color:#2b91af;">TimeZoneInfo</span>&gt;(c&nbsp;=&gt;&nbsp;c.TimeZone,&nbsp;<span style="color:#2b91af;">RelationshipTypes</span>.PrivateField);
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">NotUndoable</span>,&nbsp;<span style="color:#2b91af;">NonSerialized</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:#2b91af;">TimeZoneInfo</span>&nbsp;_timeZone =&nbsp;TimeZoneProperty.DefaultValue;
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">TimeZoneInfo</span>&nbsp;TimeZone
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;GetProperty(TimeZoneProperty,&nbsp;_timeZone);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;SetProperty(TimeZoneProperty,&nbsp;<span style="color:blue;">ref</span>&nbsp;_timeZone,&nbsp;<span style="color:blue;">value</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;OnSetState(Csla.Serialization.Mobile.<span style="color:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;<span style="color:#2b91af;">StateMode</span>&nbsp;mode)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.OnSetState(info,&nbsp;mode);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _timeZone = <span style="color:#2b91af;">TimeZoneInfo</span>.FromSerializedString(<br />                     info.GetValue&lt;<span style="color:blue;">string</span>&gt;(<span style="color:#a31515;">&quot;myTimeZoneInfoProperty&quot;</span>)));
&nbsp;&nbsp;&nbsp; }
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;OnGetState(Csla.Serialization.Mobile.<span style="color:#2b91af;">SerializationInfo</span>&nbsp;info,&nbsp;<span style="color:#2b91af;">StateMode</span>&nbsp;mode)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.OnGetState(info,&nbsp;mode);
&nbsp;&nbsp;&nbsp;&nbsp;  info.AddValue(<span style="color:#a31515;">&quot;myTimeZoneInfoProperty&quot;</span>, _timeZone.ToSerializedString());
&nbsp;&nbsp;&nbsp; }</pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
