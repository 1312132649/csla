<html><header><title>Using EditableRootListBase without a grid and trapping errors</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Using EditableRootListBase without a grid and trapping errors</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2744.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>frankhoffy posted on Friday, April 20, 2007</h2>First off, I love the EditableRootListBase class.&nbsp; It's exactly what I needed when dealing with grids.&nbsp; The DataError event of the grid fires when a validation exception occurs, and I can trap the user in that grid row.&nbsp; Perfect.<br><br>I also have a form with a binding navigator that is just a bunch of text boxes (Details versus DataGridView).&nbsp; Since the row is auto-saving, I don't see a good way to trap the errors that happen on Save like I can with the grid.&nbsp; I'd like to prevent the user from moving off of the current record if the data is not valid.&nbsp; Does anybody have some suggestions for me?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, April 20, 2007</h2>Have you looked at the ErrorProvider control?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>frankhoffy replied on Friday, April 20, 2007</h2>I did, and that works great as far as notifying what the errors are before the save occurs.&nbsp; When moving from one row to the next though, the Save method will be called and will generate the exception "Object is invalid and can not be saved", which I <i>suppose </i>is OK.&nbsp; However, it is an unhandled exception.&nbsp; What I usually do in that case is loop through the broken rules collection to display a more useful error message.<br><br>The ErrorProvider control doesn't seem to give me the events I need when an error occurs, but I may be missing something.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, April 20, 2007</h2>I think there is a validating event on the form itself you can handle. Otherwise look for events on the bindingsource control to see if there is a useful one there.<br /><br />Rocky <br /><br />-----Original Message-----<br />From: "frankhoffy" <br />To: "rocky@lhotka.net" <br />Sent: 4/20/2007 6:33 PM<br />Subject: Re: [CSLA .NET] Using EditableRootListBase without a grid and trapping errors<br /><br />I did, and that works great as far as notifying what the errors are before the save occurs.  When moving from one row to the next though, the Save method will be called and will generate the exception "Object is invalid and can not be saved", which I suppose is OK.  However, it is an unhandled exception.  What I usually do in that case is loop through the broken rules collection to display a more useful error message.<br /><br />The ErrorProvider control doesn't seem to give me the events I need when an error occurs, but I may be missing something.<br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Devi replied on Tuesday, March 25, 2008</h2>Which event that of BindingSourse, we can used for catching exception while saving through an EditableRootListBase ??</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Tuesday, March 25, 2008</h2>What type of exception are you attempting to catch? You can override SaveItem() of the ERLB to insert your own exception handling code if you like.<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Devi replied on Thursday, March 27, 2008</h2><P>Hii.. John..</P>
<P>I tried Try-catch block in the RemoveItem() of ERLB to remove an item from the DataGridView..</P>
<P>But how can users view the Exception message ??</P>
<P>Regards..</P>
<P>Devi..</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Thursday, March 27, 2008</h2>What exception are attempting to catch? General exceptions, Csla validation exceptions?<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Devi replied on Thursday, March 27, 2008</h2><P>I am trying to catch DataPortalException and sqlException while deletion.</P>
<P>Regards</P>
<P>Devi</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Friday, March 28, 2008</h2>Devi,<br><br>I override SaveItem so that I can control when my object is saved. This is what I have in my ERLB.<br><br>Public Sub SaveMyItem(ByVal busObjTosave As MyBusinessObject)<br><br>&nbsp;&nbsp;&nbsp; If Not Berth.CanWriteObject() Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New SecurityException(String.Format("Cannot write object: {0}", "MyBusinessObject"))<br>&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; '-- Capture the objects index value within the collection which we will use to later save the object<br>&nbsp;&nbsp;&nbsp; Dim pItemIndex As Int32 = Me.IndexOf(busObjTosave)<br><br><br>&nbsp;&nbsp;&nbsp; '-- We need to clone the object before applying any edits so that we can recover the original object should the save fail for<br>&nbsp;&nbsp;&nbsp; '-- any reason. General exception, validation or data portal exception.<br>&nbsp;&nbsp;&nbsp; Dim pbusObjClone As Berth = busObjTosave.Clone<br><br>&nbsp;&nbsp;&nbsp; '-- Apply any edits<br>&nbsp;&nbsp;&nbsp; busObjTosave.ApplyEdit()<br><br>&nbsp;&nbsp;&nbsp; '-- Attempt to save the object<br>&nbsp;&nbsp;&nbsp; Try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.SaveItem(pItemIndex)<br><br>&nbsp;&nbsp;&nbsp; Catch ex As Csla.Validation.ValidationException<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(pItemIndex) = DirectCast(ex.BusinessObject, MyBusinessObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw ex<br><br>&nbsp;&nbsp;&nbsp; Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '-- Saved failed for some reason. Set the object back to the original clone and bubble up the exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(pItemIndex) = pbusObjClone<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw ex<br>&nbsp;&nbsp;&nbsp; End Try<br><br>End Sub<br><br>Public Overrides Sub SaveItem(ByVal index As Integer)<br>&nbsp;&nbsp;&nbsp; '-- Do nothing<br>End Sub<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Devi replied on Saturday, March 29, 2008</h2><P>Hello,</P>
<P>I am just started a project in CSLA.net. I am new in CSLA. With ERLB, i am not using specific Event for save, edit or delete. Hence how can i&nbsp;call this method SaveMyItem() ? In wich event i can call this ?</P>
<P>And if threw the exception, the user cannot view the exception message. Can i show the message to the user ?</P>
<P>Regards</P>
<P>Devi</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Saturday, March 29, 2008</h2>Devi,<br><br>I would recommend purchasing Rocky's books. They're invaluable for getting up to speed with the framework. What I did for ERLB was to change the default behavior of how it was meant to work.<br><br>John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>phm replied on Saturday, March 29, 2008</h2><P>JohnB,</P>
<P>At the end of your catch blocks, you should probably rethrow the exception with</P>
<P>Throw</P>
<P>instead of</P>
<P>Throw ex</P>
<P>The first one rethrows the exception with the original stack trace, the second recreates a stack trace corresponding to this instruction, thus loosing the place where the original exception occured.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Saturday, March 29, 2008</h2>Thanks!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Saturday, April 21, 2007</h2>Hi,<br><br>I would like to point you to a particular property on the Binding class: DataSourceUpdateMode. It is an enumerated value which you can also set to DataSourceUpdateMode.OnPropertyChanged. When set this will make your binding stay in sync as you type, as opposed to the default where the value is only copied when you leave the control. People often overlook it since it is not visible in the designer. <br>
<br>This is not a solution to your problem, I am aware of that. But perhaps it is one of the ingredients towards one. One thing that may help you is that validation occurs after every keystroke and thus that the ErrorProvider will appear/disappear as you type as well. You could also enable/disable the Next/Previous buttons by monitoring the IsSavable property as the user types.<br><br>Hope this helps.<br><br>Bayu<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Sunday, April 22, 2007</h2>Good call .. One bonus is also that you dont need to play around so
much with&nbsp; KeyPress events to do things like controlling&nbsp;
numeric input , triming&nbsp; and Ucase etc when using this attribute.
Users get a better experience when they dont have to leave the control
for validation to fire. Another benefit is in (for example) a combo
where&nbsp; the index changed event will fire at a more useful time.
Other wise it fires too soon if you are waiting for the binding
validation event.<br>
Make sure you have the BindingSourseRefreshControl extender to see the full benefits.<br>
<br>
Jim<br>
<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
