<html><header><title>CSLA.NET object stored in ASP.NET session</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA.NET object stored in ASP.NET session</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11914.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend posted on Friday, March 29, 2013</h2><p>I&#39;ve inherited an ASP.NET MVC project that uses CSLA. Its storing a couple CSLA objects in session, I think this may be part of the problems its running into with hanging\thread locking, but I&#39;m not sure how to explain and convince people that, this is the case so we can make the investment in reworking that. Basically am I right? Or what are commin scenarios or miss uses of CSLA with ASP.NET that can lead to thread locking and such? Any help is appreciated!! Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ColourHaze replied on Friday, March 29, 2013</h2><p>Hi zbend,</p>
<p>I dont know the exact scenario of course, but as csla is not threadsafe it might be the cause.</p>
<p>Maybe not explain, but prove it? An possible option is to store a simple dto instead of an bo?</p>
<p>I wonder though, why store a whole csla in the session in the first place? What are you trying to accomplish?</p>
<p>could you provide us with more info please?</p>
<p>&nbsp;</p>
<p>colour haze</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend replied on Friday, March 29, 2013</h2><p>I may just have to prove it, it will just a take a fair amount of reworking and then putting it under proper load to reproduce it. Its a project I&#39;ve inherited with many imperfections to put it nicely, as far as I can tell its stored in session just to avoid loading it from the db each request which I think would be better here. I know session is copied for each asp.net thread but I&#39;m guessing that still doesn&#39;t jive with the unique way csla operates? Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ColourHaze replied on Saturday, March 30, 2013</h2><p>Hi zbend,</p>
<p>I don&#39;t know if the session is programmed as an abstraction used via an interface or just by its concrete class. Perhaps you could make it easier by applying an adapter pattern. This way you can program against an interface and&nbsp;maybe divide the transition into smaller portions, like per ER, where you can simply move from session to database.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, March 29, 2013</h2><p>Do you mean the CPU is going to 100% when you say &quot;thread locking&quot;?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend replied on Friday, March 29, 2013</h2><p>Yes.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>skagen00 replied on Saturday, March 30, 2013</h2><p>This is a good thread&nbsp;to read though - </p>
<p><a href="http://forums.lhotka.net/forums/t/11836.aspx">http://forums.lhotka.net/forums/t/11836.aspx</a></p>
<p>The short answer is that our solution which resolved the 100% cpu spikes was simply to override CanReadProperty to return true (not base behavior).&nbsp; I may be missing something as a colleague made the changes and got more into this.&nbsp; Jaans (think it was him) reproduced the issue and you can see the repro video in that thread.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>zbend replied on Saturday, March 30, 2013</h2><p>That seems like that has to be it, checking it out, Thanks!!!!&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Saturday, March 30, 2013</h2><p>The site I&#39;m doing this in is not heavy load, but I&#39;ve been storing Csla objects in Asp.Net sessions without any issue.&nbsp; In general you should be fine as each Asp.Net request is served by a single thread, so unless you&#39;re doing multiple Ajax calls which end up pulling the object out of session and changing values, you should be ok.&nbsp; You may want to include more information about the scenario where you&#39;re encountering an issue.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, March 30, 2013</h2><p>There are no problems putting CSLA objects into Session. That is a supported scenario that has been working since 2001.</p>
<p>There ARE problems with any scenario where a CSLA object instance is used from multiple threads at the same time. That is NOT&nbsp;a supported scenario. Like the majority of the .NET framework, CSLA is not threadsafe (except in very specific cases).</p>
<p>If you are trying to use the same object instances from multiple threads you will need to rethink your implementation to avoid such a situation.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>zbend replied on Saturday, March 30, 2013</h2><p>So what skagen00 pointed too was my real problem, but since I did ask about storing CSLA objects in session and that is fine (although maybe not the best practice) I also marked Rocky&#39;s answer. Simply overriding the CanReadProperty appears to have resolved this for me, it appears to be that you don&#39;t have to do anything special but use a ReadOnlyBase object in an ASP.NET app and you would have this issue under load.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
