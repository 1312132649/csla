<html><header><title>Transaction Scope on multiple object saves</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Transaction Scope on multiple object saves</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10293.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 posted on Thursday, April 21, 2011</h2><p>Hi,</p>
<p>I&#39;m not sure if this has been asked a million times or not, but I can&#39;t seem to find anything yet so I thought I would post here :) We are building a vb.net app using CSLA 3.8.4, SQL Server 2005 and an MVC pattern.</p>
<p>On many of our pages, we are performing multiple saves or updates to different obejcts that are not children of parents or anything RI related. I need to wrap all of my saves and updates inside of a transaction... However I haven&#39;t been able to figure out if I can leverage the existing Transaction code in the classes&nbsp;since not all of my obejcts are related.&nbsp;</p>
<p>Is anyone here familiar with how I can do this? Just old fashioned Transaction Scope coding and then I might need to alter the data access to manage the connection strings with the transaction or..?</p>
<p>Any help or guidance would be appreciated. I keep going in circles as I&#39;m not sure the best way to do this.</p>
<p>Thanks in advance :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>thaehn replied on Thursday, April 21, 2011</h2><p>Have you tried creating one parent&nbsp;business object for the whole page and make all the others children?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, April 21, 2011</h2><p>Typically you&#39;d use a <em>unit of work</em> pattern (and object) to do this.</p>
<p>There&#39;s some info in the FAQ: <a href="http://www.lhotka.net/cslanet/faq/CslaObjectFaq.ashx">http://www.lhotka.net/cslanet/faq/CslaObjectFaq.ashx</a></p>
<p>And this is discussed in the <em>Using CSLA 4</em> ebook series in some depth.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Tuesday, April 26, 2011</h2><p>Hi,</p>
<p>Don&#39;t have access to the books or video, but I am wondering, with UoW, are you suggesting making like a custom class that would do all my saves inside and the transaction should be started there? I&#39;m not entirely sure what I am supposed to do with this (relative newbie to csla 3)</p>
<p>The problem I&#39;m currently working on is I have a new Plan object being created. I need to take the new plan ID and create relationships between the plan and the provisions the plan is related to. Then for each of these plan / provision relationship IDs,&nbsp;I need to make more relationships with features that relate to the plan/provisions... </p>
<p>I don&#39;t really want to make page level objects for each page, but I&#39;m thinking that is what this UoW basically is... I was hoping to&nbsp;make minimal changes to the generated files... however I&#39;m having problems with each data access object creating a new connection string... does CSLA not share connection strings for the transactions? I&#39;ve implemented TransactionScope several times before but this was quite confuses me...</p>
<p>Thanks for any more input you might possibly provide :)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, April 26, 2011</h2><p>A UoW is typically a read-only (for object retrieval) or command object (for object updates) that simply manages server-side interactions with multiple normal root objects.</p>
<p>This is extremely common in Silverilght, because server calls are async. So it is normal to create a read-only UoW to retrieve all the objects necessary for a given screen (often the editable business object, and one or more NVL or other list objects).</p>
<p>It is far less common to update multiple objects at the same time, but that&#39;s done using a command object.</p>
<p>A&nbsp;UoW is almost never very complex. They typically have a property for each root object they retrieve/update. And they have a DP_Fetch method that invokes the normal root object factories (on the server) to set the properties. In a command UoW there&#39;s a DP_Execute that calls the normal sync Save methods on each root object - all within a transaction (usually through the [Transactional] attribute on the DP_Execute method).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Wednesday, April 27, 2011</h2><p>Hi, thanks for the reply... sooo what you;re saying is that I should be using a common object to do multiple saves on different objects and that UoW is not what I need?</p>
<p>My problem is that CSLA is creating a new connection string for each data access method so if I try to start a parent transaction around all of my inserts and updates it fails on the second one because my transaction needs to use the same connection... I&#39;ve been trying to see if there is another way to do this with CSLA without butchering the generated classes... is there or is CSLA not really the right framework to be using for what I need?</p>
<p>Thanks again, I&#39;m finding there is a lot to learn and I&#39;m just trying to sift through it all :)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, April 27, 2011</h2><p>To be a little blunt, I&#39;m not going to copy-paste the sections of the <em>Using CSLA 4: Data Access</em> ebook that answers your question completely :)&nbsp; Although I give the framework away, I do have to fund all this work somehow.</p>
<p>Fortunately, all that information is lurking somewhere in the archives of this forum, or in the Samples download - you&#39;ll need to dig it out manually to avoid spending the money on the consolidated documentation in the ebook(s).</p>
<p>If you need to save multiple root objects within the context of a single transaction, you need a UoW command object.</p>
<p>Additionally, if you are using TransactionScope transactions, you should be using the connection or context manager classes from Csla.Data. This is because the .NET TransactionScope object will use the DTC if you attempt to open more than one database connection within a single transaction, and most environments don&#39;t have the DTC configured (and even if you do - the perf hit is something to avoid).</p>
<p>The connection and context manager types in Csla.Data help keep the database connection open so you automatically reuse it across all the objects within a given data portal call.</p>
<p>There&#39;s a specific coding pattern you should use when building data access code for CSLA objects, where each object uses a connection/context manager to get at the database connection. If you follow that pattern, then the UoW command object can wrap all the Save calls for the multiple root objects, and they&#39;ll run within the same transaction, and reuse the same connection.</p>
<p>For example, in the command object (pseudocode):</p>
<p>[Transactional(TransactionScope)]<br />private void DataPortal_Execute()<br />{<br />&nbsp; using (var ctx = ConnectionManager&lt;SqlConnection&gt;.GetManager(&quot;mydatabase&quot;))<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; Customer = Customer.Save();<br />&nbsp;&nbsp;&nbsp; Product = Product.Save();<br />&nbsp; }<br />}</p>
<p>That assumes the UoW command object has Customer and Product properties - each containing an editable root object you want to save.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Wednesday, April 27, 2011</h2><p>LOL Rocky :) I do own several incarnations of your books, but someone at the office has borrowed it and I have not gotten it back yet and haven&#39;t even had a chance to get through all of the latest one before I got trust upon this new project :) But I completely understand, sorry for being such a brat!</p>
<p>Thanks for the reply, this is much more for me to chomp on and better than most of the other threads have have found so far... Now to get it to work :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 27, 2011</h2><p>fwiw, only the <em>Using CSLA 4</em> ebook series and the <em>Core 3.8</em> video series provide any real coverage of the UoW technique.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Thursday, May 05, 2011</h2><p>Hey, I know I marked as answer but I have another question (and I&#39;m sure it will seem dumb)...</p>
<p>I am making a Unit of Work class that does a </p>
<p><span class="pln">using </span><span class="pun">(</span><span class="typ"><span style="color:#2b91af;">SqlConnection</span></span><span class="pln"> conn </span><span class="typ"><span style="color:#2b91af;">ConnectionManager</span></span><span class="pun">&lt;</span><span class="typ"><span style="color:#2b91af;">SqlConnection</span></span><span class="pun">&gt;.</span><span class="typ"><span style="color:#2b91af;">GetManager</span></span><span class="pun">(</span><span class="str"><span style="color:#800000;">&quot;Db&quot;</span></span><span class="pun">).</span><span class="typ"><span style="color:#2b91af;">Connection</span></span><span class="pun">)</span><span class="pln">&nbsp;<br /></span><span class="pun">{</span><span class="pln">&nbsp;<br />&nbsp; &nbsp; connectionTransaction </span><span class="pun">=</span><span class="pln"> conn</span><span class="pun">.</span><span class="typ"><span style="color:#2b91af;">BeginTransaction</span></span><span class="pun">();</span><span class="pln">&nbsp;<br />&nbsp;<br />&nbsp; &nbsp; objectRef </span><span class="pun">=</span><span class="pln"> objectRef</span><span class="pun">.</span><span class="typ"><span style="color:#2b91af;">Save</span></span><span class="pun">();</span><span class="pln">&nbsp;<br />&nbsp;<br />&nbsp; &nbsp; </span><span class="com"><span style="color:#808080;">//other logic here</span></span><span class="pln">&nbsp;<br />&nbsp;<br />&nbsp; &nbsp; objectRef </span><span class="pun">=</span><span class="pln"> objectRef</span><span class="pun">.</span><span class="typ"><span style="color:#2b91af;">Save</span></span><span class="pun">();</span><span class="pln">&nbsp;<br />&nbsp; &nbsp; connectionTransaction</span><span class="pun">.</span><span class="typ"><span style="color:#2b91af;">Commit</span></span><span class="pun">();</span><span class="pln">&nbsp;<br /></span><span class="pun">}</span><span class="pln">&nbsp;<br /></span></p>
<p><span class="pln">But my objectRef.Save() logic that goes to the Data Access layer either creates a new connection int he Update/Insert or does it&#39;s own </span></p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p>Using&nbsp;</p>
</font></font></font></span><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p>&nbsp;</p>
</font></font></span><font size="2" color="#0000ff" face="Consolas">
<p>&nbsp;</p>
</font></span>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">ctx = </span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">ContextManager</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">(</span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">Of</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> CUMISCCR.Dal.</span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">CCRDataContext</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">).GetManager(CUMISCCR.Dal.</span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">Database.</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">CCR)</span></span></p>
</p>
<p><span style="font-size:x-small;font-family:Consolas;">Which will only use the connection until the using is done or the connection is closed. </span><span style="font-size:x-small;font-family:Consolas;">Any advice on how the pattern should actually work? We got the CSLA 3.8.4 templates from a co-worker, but I&#39;m not sure where he got them from and your samples all seem to use context manager. </span></p>
<p><span style="font-size:x-small;font-family:Consolas;">Also I was using conmnection manager as we are using stored procs and not LINQ to SQl.</span></p>
<p><span style="font-size:x-small;font-family:Consolas;">Thanks again :)</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 05, 2011</h2><p>The problem is that your using block is using the connection, not the connectionmanager. So the connectionmanager exsits for the duration of a single line of code, not the whole block.</p>
<p>I&#39;m surprised this works - I think CSLA 4 would have closed the connection instantly...</p>
<p>Also, you can&#39;t do the transaction like that, because the command objects used in each of the Save methods (actually the DataPortal_XYZ methods) must attach that transaction.</p>
<p>You really need to use the TransactionManager class to make the transaction object available throughout the code.</p>
<p>The <em>Using CSLA 4: Data Access</em> ebook covers these objects in pretty good detail.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Thursday, May 05, 2011</h2><p>Thanks rocky :)</p>
<p>Actually the first blurb i posted was an example I was working off of and yeah, doesn&#39;t work... </p>
<p>I have put in a request with my company to purchse the ebooks :) Until then, I have one more question... </p>
<p>I made a UoW and am using the connectionManager (properly this time I hope)... When I call obj.Save, I am wondering, what should my&nbsp; obj DataPortal_XYZ&#39;s look like. Currently one of mine looks like</p>
<p>&nbsp; &lt;Transactional(TransactionalTypes.TransactionScope)&gt; _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Insert()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim cancel As Boolean = False<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnInserting(cancel)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If (cancel) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>Using connection As New SqlConnection(ADOHelper.ConnectionString)<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connection.Open()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using command As New SqlCommand(&quot;[dbo].[CSLA_Client_Insert]&quot;, connection)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command.CommandType = CommandType.StoredProcedure<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//paramters go here&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command.ExecuteNonQuery()<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using (BypassPropertyChecks)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConcurrencyCheck = DirectCast(command.Parameters(&quot;@p_ConcurrencyCheck&quot;).Value, System.Byte())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _clientID =&nbsp; DirectCast(command.Parameters(&quot;@p_ClientID&quot;).Value,System.Int32)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.UpdateChildren(Me, connection)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>End Using<br /></strong>&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnInserted()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</p>
<p>So I&#39;m wondering, should I make all of my data access methods accept an optional paramter of connection, and if it exists use it, otherwise continue to use the <strong>new</strong> connection? The fact that we have a new connection in every method is what&#39;s killing me. Also every example I have found so far all use the &quot;using someManager&quot; code so once the using is done, the transaction is done too, which is not what i want<br /><br />Thanks again and don&#39;t worry, books will be purchased :) Especially since I can&#39;t seem to find what i need (yet) :) Thanks for the hard work and help.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superservo15 replied on Thursday, May 05, 2011</h2><p>Actually I think I finally found what I need in Chapter 16 of your Expert 2008 Business Objects book... I didn&#39;t realize that multiple nexted usings have a counter and don&#39;t close the ConnectionManager object if there are nested usings... I think I just need to switch all my DataPortal_XYZs to use</p>
<p>&nbsp;Using ctx = ConnectionManager(Of SqlConnection).GetManager(&quot;MyDb&quot;)<br />&#39; insert object&#39;s data here using ctx.Connection<br />End Using</p>
<p>And have my UoW start the transaction from within it&#39;s own using. <br />Thanks for all the help and great framework :)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Santosh Wavare replied on Tuesday, April 23, 2013</h2><p><span style="color:green;">&#39;Usage</span><br /><span style="color:blue;">Public</span> <span style="color:blue;">Function</span> Transfer(<span style="color:blue;">ByRef</span> transactionAmount <span style="color:blue;">As</span> <span style="color:blue;">Integer</span>, <span style="color:blue;">ByRef</span> sourceAccount <span style="color:blue;">As</span> <span style="color:blue;">Integer</span>, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">ByRef</span> destinationAccount <span style="color:blue;">As</span> <span style="color:blue;">Integer</span>) <span style="color:blue;">As</span> <span style="color:blue;">Boolean</span><br /><br />&nbsp; <span style="color:blue;">Dim</span> result <span style="color:blue;">As</span> <span style="color:blue;">Boolean</span> = <span style="color:blue;">False</span><br /><br />&nbsp; <span style="color:green;">&#39; Create the database object, using the default database service. The</span><br />&nbsp; <span style="color:green;">&#39; default database service is determined through configuration.</span><br />&nbsp; <span style="color:blue;">Dim</span> db <span style="color:blue;">As</span> Database = DatabaseFactory.CreateDatabase()<br /><br />&nbsp; <span style="color:green;">&#39; Two operations: one to credit an account and one to debit another account.</span><br />&nbsp; <span style="color:blue;">Dim</span> sql <span style="color:blue;">As</span> <span style="color:blue;">String</span> = <span style="color:#a31515;">&quot;CreditAccount&quot;</span><br />&nbsp; <span style="color:blue;">Dim</span> creditCommand <span style="color:blue;">As</span> DbCommand = db.GetStoredProcCommand(sql)<br /><br />&nbsp; db.AddInParameter(creditCommand, <span style="color:#a31515;">&quot;AccountID&quot;</span>, DbType.Int32, sourceAccount)<br />&nbsp; db.AddInParameter(creditCommand, <span style="color:#a31515;">&quot;Amount&quot;</span>, DbType.Int32, transactionAmount)<br /><br />&nbsp; sql = <span style="color:#a31515;">&quot;DebitAccount&quot;</span><br />&nbsp; <span style="color:blue;">Dim</span> debitCommand <span style="color:blue;">As</span> DbCommand = db.GetStoredProcCommand(sql)<br />&nbsp; db.AddInParameter(debitCommand, <span style="color:#a31515;">&quot;AccountID&quot;</span>, DbType.Int32, destinationAccount)<br />&nbsp; db.AddInParameter(debitCommand, <span style="color:#a31515;">&quot;Amount&quot;</span>, DbType.Int32, transactionAmount)<br /><br />&nbsp; <span style="color:blue;">Using</span> conn <span style="color:blue;">As</span> DbConnection = db.CreateConnection()<br /><br />&nbsp;&nbsp;&nbsp; conn.Open()<br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">Dim</span> trans <span style="color:blue;">As</span> DbTransaction = conn.BeginTransaction()<br /><br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">Try</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">&#39; Credit the first account.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.ExecuteNonQuery(creditCommand, trans)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">&#39; Debit the second account.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.ExecuteNonQuery(debitCommand, trans)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">&#39; Commit the transaction.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.Commit()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = <span style="color:blue;">True</span><br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">Catch</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">&#39; Roll back the transaction. </span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.Rollback()<br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">End</span> <span style="color:blue;">Try</span><br />&nbsp;&nbsp;&nbsp; conn.Close()<br /><br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">Return</span> result<br /><br />&nbsp; <span style="color:blue;">End</span> <span style="color:blue;">Using</span><br /><br /><span style="color:blue;">End</span> <span style="color:blue;">Function</span><br /></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
