<html><header><title>DB save problem for remote user</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DB save problem for remote user</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8959.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cydl posted on Wednesday, May 19, 2010</h2><p>Hi all -</p>
<p>I have a bit of a vexing problem that I&#39;m hoping someone out there has seen and diagnosed and fixed...</p>
<p>We have a remote user who is running our forms-based application off of a laptop that connects to our database via a VPN connection.&nbsp; She is pulling up a record and editing several fields in the record.&nbsp;These fields span across several business objects - a base object with several children.&nbsp; When she saves her edits she gets a &#39;successful&#39; message, but none of the edits are saved.&nbsp; No errors on her end or on the logging on our end.&nbsp; If she goes into the record and edits ONE field and saves it, it saves fine.&nbsp;</p>
<p>We have not been successful in reproducing the problem here in-house.&nbsp; We can edit a hefty number of fields in the record (more than any of our users would routinely edit), save the thing, and all is happy.</p>
<p>I&#39;ve double-check the error messaging, the transaction time-outs, the connection time-outs, etc.&nbsp; but I&#39;m at a real loss to try and figure this out since we can&#39;t reproduce the problem!</p>
<p>Has anyone out there seen this behavior?</p>
<p>TIA,</p>
<p>Cyd</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, May 19, 2010</h2><p>What kind of UI? And what kind of exception handling do you have around the data portal and/or Save() method call? Sometimes, especially with any async code, exceptions from Save() get swallowed by .NET unless you have explicit exception handling and logging code.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cydl replied on Wednesday, May 19, 2010</h2><p>The UI is home-made&nbsp;Visual Studio 2008 (c#) using Infragistics Controls.&nbsp; I&#39;m using a try...catch block around the save:</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><font size="2" color="#0000ff"><font size="2" color="#0000ff">
<p>try</p>
</font></font></span><font size="2" color="#0000ff">
<p>&nbsp;</p>
</font></span>
<p><span style="font-size:x-small;">{<br /></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Cursor</span></span><span style="font-size:x-small;">.Current = </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Cursors</span></span><span style="font-size:x-small;">.WaitCursor;<br /></span><span style="font-size:x-small;">mBaseObject = mBaseObject.Save();<br />RefreshCommonObjects();<br />}<br /></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">catch</span></span><span style="font-size:x-small;"> (Csla.</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">DataPortalException</span></span><span style="font-size:x-small;"> ex)<br />{<br /></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">MessageBox</span></span><span style="font-size:x-small;">.Show(ex.Message, c_SaveErr, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">MessageBoxButtons</span></span><span style="font-size:x-small;">.OK, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">MessageBoxIcon</span></span><span style="font-size:x-small;">.Error);<br />result = </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">false</span></span><span style="font-size:x-small;">;<br />}<br /></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">finally<br /></span></span><span style="font-size:x-small;">{<br /></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Cursor</span></span><span style="font-size:x-small;">.Current = </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Cursors</span></span><span style="font-size:x-small;">.Default;<br />}</span></p>
<p><span style="font-size:x-small;">Should I be doing this differently?</span></p>
<p><span style="font-size:x-small;">And thanks!</span></p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 19, 2010</h2><p>No, that looks fine. So we can be pretty confident that the data portal isn&#39;t encountering a network error, and that no exception is thrown from the server then.</p>
<p>So that really leaves some issue with server-side code. Are you letting CSLA handle the transactions (using the Transactional attribute) or are you doing transactions yourself?</p>
<p>Normally the only way CSLA would do a rollback is with an exception, and if that&#39;s the case the exception would flow back to the client. Since the client isn&#39;t seeing an exception, it seems unlikely that the server is throwing an exception?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cydl replied on Wednesday, May 19, 2010</h2><p>Well, that&#39;s good to hear.&nbsp; I&#39;ve been working with the CSLA for a few years now (btw bless you!&nbsp; I love it!), but that sure doesn&#39;t preclude me from doing something boneheaded!</p>
<p>I&#39;m letting the CSLA handle the transactions, so I&#39;m thinking that that&#39;s fairly safe.</p>
<p>The server-side is all stored procs, and very simple CRUD at that.&nbsp; But whenever anything is edited, a copy of the original object is inserted to a history table for audit trail and the new info is updated, so there&#39;s a lot going on.&nbsp; The history object is a child of the&nbsp;&quot;live&quot; object. &nbsp;The only thing that I can think of is some sort of transaction time-out that is rolling everything back; but as you say, I would think that that would cause an exception to come back.&nbsp; </p>
<p>I spent the better part of yesterday and today breaking the history object out into their own base/child structure and am now saving those separately (and in a separate transaction) from the &quot;live&quot; objects.&nbsp; Didn&#39;t really want to do that, and since I still can&#39;t replicate the problem I can&#39;t really prove anything with it.&nbsp; But I thought that that would decrease the time spent in the transactions and perhaps clear up the problem for her.</p>
<p>One thing I did observe yesterday is that I sent the user an email at around 12:30 MDT.&nbsp; She did not receive it until nearly 4:00 MDT.&nbsp; Of course, when she clicks the &#39;Save&#39; in the app the success message came back in a reasonable amount of time (about a second).&nbsp; What I don&#39;t know about network packet flow could fill a book - so that may mean nothing.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Wednesday, May 19, 2010</h2><p>I feel your pain having dealt with these sorts of problems on occasion. You tend to spend hours trying to reproduce unlikely situations to no avail.</p>
<p>Anyway, why don&#39;t you add some textual logging on your server side when the save begins and ends - say using log4net, then at least when the user says that the problem occurred you can at least take a look at the logs and see whether it makes sense, or they&#39;re making it all up <img src="http://forums.lhotka.net/emoticons/emotion-2.gif" alt="Big Smile" /></p>
<p>Good luck!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cydl replied on Wednesday, May 19, 2010</h2><p>Yeah - this kind of stuff makes me crazy!&nbsp; Maybe I could just score a winning Power Ball ticket tomorrow... ;-D</p>
<p>But thanks for the sympathy - and the suggestion.&nbsp; I think I&#39;ll do that.&nbsp; Right after I buy a couple of quick picks...</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
