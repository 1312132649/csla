<html><header><title>BindingSource.DataSource and EndEdit() issues</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BindingSource.DataSource and EndEdit() issues</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4801.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>opedog posted on Monday, May 05, 2008</h2>This isn't per se a CSLA specific question, but I wasn't sure where else to turn.&nbsp; What I have is a very simple set of processes all conspiring against me.&nbsp; Here goes:<br><br>In my UI I have a display only control with a BindingSource that just shows some of the members of one of my business objects.&nbsp; As such, I set the BindingSource.DataSource to be my business object and voila, the control is populated.&nbsp; However, since the control is readonly I immediately call BindingSource.EndEdit().&nbsp; There's no reason to keep the edit level incremented in this case because for some reason setting BindingSource.DataSource calls BeginEdit().<br><br>Then I open a modal to actually edit my original business object.&nbsp; This modal also contains the same control as above to display the data of my business object.&nbsp; Upon opening the modal, I call BeginEdit() on my business object to increment it's EditLevel.&nbsp; Later on I populate the readonly control above.&nbsp; This time, however, after I set BindingSource.DataSource to be my business object, the BindingSource does NOT increment the EditLevel.&nbsp; I then immediately call BindingSource.EndEdit() again assuming the BindingSource on the readonly control has again incremented the EditLevel, only to have it decrement the EditLevel (since it's applying the changes that were made).<br><br>My question is, how do I know whether or not the EditLevel of my business object was incremented by my readonly control?&nbsp; I can obviously do some ugly reflection to get the EditLevel out, but surely there is a better solution.&nbsp; Maybe a better question is, once I set BindingSource.DataSource, doesn't my business object get put into a synchronization object?&nbsp; If so, can't I check it to see if it's already in there and to not call BindingSource.EndEdit() since it didn't increment the EditLevel?&nbsp; Hopefully someone has dealt with this before so my rambling actually makes sense to them.&nbsp; :)<br><br>Any help is greatly appreciated as this is really stumping me.<br><br>Thanks!<br><br>Oh, and I'm using CSLA v2.0.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Tuesday, May 06, 2008</h2><P>Here are a couple of suggestions, I hope they are of some help:</P>
<P>- Upgrade to CSLA 3.x. I beleive a lot of enhancements were made from 2.x to 3.x regarding edit levels, which made debugging them a lot easier. Since there are no major breaking changes, you might want to consider upgrading first and then retackling this issue.<BR>- In the caseof your modal window. I take it you pass your object as a parameter to your window and bind/edit it in there. What you might be better off doing is call the <FONT face="Courier New">UnbindBindingSource</FONT> method (as per the PTracker example) on your parent window to unhook the object from any bindings. You could pass the <FONT face="Courier New">apply</FONT> flag as true/false, it shouldnt really matter. Then within your modal window bind and eventually unbind the object following the proven guidlines and finally, after closing the modal window bind the modified object back on your parent form.</P>
<P>Hope this helps...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>opedog replied on Tuesday, May 06, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>triplea:</strong></div><div>Here are a couple of suggestions, I hope they are of some help:
<p>- Upgrade to CSLA 3.x. I beleive a lot of enhancements were made from 2.x to 3.x regarding edit levels, which made debugging them a lot easier. Since there are no major breaking changes, you might want to consider upgrading first and then retackling this issue.<br>- In the caseof your modal window. I take it you pass your object as a parameter to your window and bind/edit it in there. What you might be better off doing is call the <font face="Courier New">UnbindBindingSource</font> method (as per the PTracker example) on your parent window to unhook the object from any bindings. You could pass the <font face="Courier New">apply</font> flag as true/false, it shouldnt really matter. Then within your modal window bind and eventually unbind the object following the proven guidlines and finally, after closing the modal window bind the modified object back on your parent form.</p>
<p>Hope this helps...</div></BLOCKQUOTE></p><p>Thanks.&nbsp; :)&nbsp; I've mentioned to my boss about upgrading to CSLA 3.0.4.&nbsp; We'll see if that goes through.</p><p>Another thing I noticed in my testing.&nbsp; I did the ugly reflection stuff to see if I should call EndEdit(), so my EditLevels are now working correctly, however, sometimes when CancelEdit() is called explicitly on the business object it doesn't decrement the EditLevel.&nbsp; Is this a CSLA 2.1.1 bug as well?<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>opedog replied on Tuesday, May 06, 2008</h2>I think this is the answer to my problem.&nbsp; :)<br><br>From the CSLA 3.0.2 change log:<br><BLOCKQUOTE><div><span id="ctl00_ContentPlaceHolder1_BodyLabel">The subtle change is this: prior to this change, a manual call to <span class="CodeInline"><span><font color="#008000" face="Courier New">BeginEdit()</font></span></span> would prevent a subsequent <span class="CodeInline"><span><font color="#008000" face="Courier New">IEditableObject.BeginEdit()</font></span></span> call from having any effect, leaving the object at edit level 1. With this change <i>both</i> the manual and <span class="CodeInline"><span><font color="#008000" face="Courier New">IEditableObject</font></span></span>
calls will take effect, putting the object at edit level 2. In reality,
this change makes the behavior more clear and consistent, but since it
is a change it could break some code.</div></BLOCKQUOTE></span></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
