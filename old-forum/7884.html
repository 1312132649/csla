<html><header><title>accessing wcfhost on remote computer - SecurityNegotiationException </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>accessing wcfhost on remote computer - SecurityNegotiationException </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7884.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pillesoft posted on Tuesday, October 27, 2009</h2>i have problem accessing the WCF host service in another machine.<br>it is working fine if the wcf service is teh vs development server, or it is under my local IIS, but i have this exception when i try with remote computer.<br><br>can you help what shall i modify in my case? i made many googling, but i cannot get a solution.<br>i use wsHttpBinding.<br><br>thanks<br>Ivan<br><br><font face="Courier New">System.ServiceModel.Security.SecurityNegotiationException was unhandled<br>&nbsp; Message="The caller was not authenticated by the service."<br>&nbsp; Source="mscorlib"<br>&nbsp; StackTrace:<br>&nbsp;&nbsp;&nbsp; Server stack trace: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.IssuanceTokenProviderBase`1.DoNegotiation(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SspiNegotiationTokenProvider.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.WrapperSecurityCommunicationObject.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.CommunicationObjectSecurityTokenProvider.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SecurityUtils.OpenTokenProviderIfRequired(SecurityTokenProvider tokenProvider, TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SymmetricSecurityProtocol.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.WrapperSecurityCommunicationObject.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.SecurityChannelFactory`1.ClientSecurityChannel`1.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SecuritySessionSecurityTokenProvider.DoOperation(SecuritySessionOperation operation, EndpointAddress target, Uri via, SecurityToken currentToken, TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SecuritySessionSecurityTokenProvider.GetTokenCore(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.IdentityModel.Selectors.SecurityTokenProvider.GetToken(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SecuritySessionClientSettings`1.ClientSecuritySessionChannel.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.OnOpen(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.CallOpenOnce.System.ServiceModel.Channels.ServiceChannel.ICallOnce.Call(ServiceChannel channel, TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.CallOnceManager.CallOnce(TimeSpan timeout, CallOnceManager cascade)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.EnsureOpened(TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs, TimeSpan timeout)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannelProxy.InvokeService(IMethodCallMessage methodCall, ProxyOperationRuntime operation)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannelProxy.Invoke(IMessage message)<br>&nbsp;&nbsp;&nbsp; Exception rethrown at [0]: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Server.Hosts.IWcfPortal.Fetch(FetchRequest request)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy.Fetch(Type objectType, Object criteria, DataPortalContext context) in D:\PilleSoft\cslacs-370\cslacs\Csla\DataPortalClient\WcfProxy.cs:line 130<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in D:\PilleSoft\cslacs-370\cslacs\Csla\DataPortal.cs:line 262<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in D:\PilleSoft\cslacs-370\cslacs\Csla\DataPortal.cs:line 173<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at pmsnet.Library.Security.PmsIdentity.GetIdentity(String username, String password) in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\pmsnet.Library\Security\PmsIdentity.cs:line 21<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at pmsnet.Library.Security.PmsPrincipal.Login(String username, String password) in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\pmsnet.Library\Security\PmsPrincipal.cs:line 18<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Win.LoginForm.OK_Click(Object sender, EventArgs e) in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\win\LoginForm.cs:line 20<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.OnClick(EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.OnClick(EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.OnMouseUp(MouseEventArgs mevent)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmMouseUp(Message&amp; m, MouseButtons button, Int32 clicks)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ButtonBase.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG&amp; msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.RunDialog(Form form)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.ShowDialog(IWin32Window owner)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Win.MainForm.DoLogin() in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\win\MainForm.cs:line 97<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Win.MainForm.MainForm_Load(Object sender, EventArgs e) in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\win\MainForm.cs:line 39<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.OnLoad(EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.OnCreateControl()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.CreateControl()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmShowWindow(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ScrollableControl.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ContainerControl.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.WmShowWindow(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.SafeNativeMethods.ShowWindow(HandleRef hWnd, Int32 nCmdShow)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.SetVisibleCore(Boolean value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Form.SetVisibleCore(Boolean value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.set_Visible(Boolean value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.Run(Form mainForm)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Win.Program.Main() in D:\Documents and Settings\ihorvath\My Documents\Visual Studio 2008\Projects\pmsnet\win\Program.cs:line 18<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()<br>&nbsp; InnerException: System.ServiceModel.FaultException<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Message="The request for security token could not be satisfied because authentication failed."<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Source="System.ServiceModel"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Action="http://www.w3.org/2005/08/addressing/soap/fault"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StackTrace:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SecurityUtils.ThrowIfNegotiationFault(Message message, EndpointAddress target)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Security.SspiNegotiationTokenProvider.GetNextOutgoingMessageBody(Message incomingMessage, SspiNegotiationTokenProviderState sspiState)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InnerException: <br></font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 27, 2009</h2><P>There's a WCF configuration topic in the FAQ</P>
<P><A href="http://www.lhotka.net/cslanet/faq/DataPortalFaq.ashx">http://www.lhotka.net/cslanet/faq/DataPortalFaq.ashx</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ludwigs3rd replied on Monday, November 16, 2009</h2>I have my service working in Vista and Windows 7 but when I install it on an XP machine I get the same problem from REMOTE clients only. Windows Firewall is OFF. ;) Any advice?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pillesoft replied on Tuesday, November 17, 2009</h2>unfortunately i don't have too many time to deal with this. this is only a "free time" project.<br>anyway i followed the guideline in Expert C# 2008 Business Objects.<br>i only succeeded in local machine. i didn't have time to test with a real client/server environment.<br>Ivan<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
