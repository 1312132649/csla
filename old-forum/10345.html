<html><header><title>Child_Update/Child_Insert from 3.8 &gt; 4.0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child_Update/Child_Insert from 3.8 &gt; 4.0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10345.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>NemisisJedi posted on Thursday, May 05, 2011</h2><p>Hi all, hope you are all doing well.</p>
<p>We have just upgraded to .NET 4 and thought we might as well go full steam ahead and update to Csla 4.0 as well.</p>
<p>One of the problem i have though is that when i populate a child item i would usually pass it a DataReader like so</p>
<p>Dim lList As New List(Of ChildItem)</p>
<p>Dim lChild as ChildItem = ChildItem.GetChild(dr) &nbsp; &#39; dr is my data reader</p>
<p>Within this child i would have the following factory method<br /><br />Friend Shared Function GetChild(ByRef dr As Object) As ChildItem<br />&nbsp; &nbsp;DataPortal.ChildFetch(Of ChildItem)(dr)<br />End Function&nbsp;<br /><br />Private Sub Child_Fetch(ByRef dr As Object)&nbsp;<br />.........<br /><br /><br />But in version 4 i get errors with this code and i have to pass everything ByVal instead of ByRef which is bad for memory etc.<br /><br />I dont really want to pass a whole DataReader by value in each function, so i can only think that i have to pass each value as a separate parameter??<br /><br />Am i missing something or was this done for a reason??&nbsp;<br /><br />You get the following error by using ByRef</p>
<p><span>
<h2><i>xpression of type &#39;System.Object&amp;&#39; cannot be used for parameter of type &#39;System.Object&#39; of method &#39;Void Child_Fetch(System.Object ByRef)&#39;</i></h2>
</span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, May 05, 2011</h2><p>ByVal and ByRef are essentially meaningless when passing reference types like a data reader.</p>
<p>When you pass an object reference ByVal, you are passing the reference pointer (basically an int) by value to the method. The actual referenced object (the data reader) isn&#39;t passed at all - only a pointer is passed.</p>
<p>When you pass an object reference ByRef, you are still passing the reference pointer (basically an int) by reference. The only difference here, is that the method can change the reference to point to a new object, and the calling code would see that as a side-effect.</p>
<p>Anyone who did any FORTRAN in the past knows that side-effect-based APIs are almost always a disaster, which is why you rarely see the use of ByRef semantics in anyone&#39;s code, or in the .NET APIs.</p>
<p>CSLA actually does use a ByRef semantic in the LoadProperty and SetProperty methods that support private backing fields. This was a concious choice on my part - but having used FORTRAN years ago, I can tell you I thought twice before implementing that API!!</p>
<p>In any case, my ramblings aside, you are misunderstanding the way ByVal works, and since a data reader is a reference type you shouldn&#39;t worry about it having negative consequences.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
