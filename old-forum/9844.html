<html><header><title>Problem with EditLevel caused by IsAssignableFrom</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with EditLevel caused by IsAssignableFrom</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9844.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrancoisB posted on Wednesday, December 08, 2010</h2><p>Hi everyone, we recently upgraded from CSLA 2.1.3 to 3.6.0... I know, that&#39;s a big step and honestly we haven&#39;t change anything in our&nbsp;classes to accomodate this migration since the application is running fine and no time is allocated to its maintenance.</p>
<p>Our problem is that the UndoException is raised in the call to BeginEdit(); in a child class.&nbsp;Tracing the code made me realise that the call to <strong>UndoableHandler.GetCachedFieldHandlers(currentType);</strong> gets a lot of handlers and that <strong>IsAssignableFrom</strong> returns true for a class that has nothing to do with the child being&nbsp; modified. It&#39;s the call to CopyState for that handler that&nbsp;raises the&nbsp;exception, since they&#39;re not on the same EditLevel.</p>
<p>Can someone tell me how that handlers list is populated and why we encounter this problem?</p>
<p>If needed I could provide the use case, which is a bit complicated... but we need&nbsp;a fix soon so any help will be greatly appreciated.</p>
<p>Thanks!</p>
<p>Francois</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, December 08, 2010</h2><p>Edit level exceptions are almost always due to a bug in the UI code, where a child object is left at an elevated edit level (has an outstanding BeginEdit) and some code tries to do any apply/cancel at a higher level in the object graph.</p>
<p>The stricter checks were introduced in version 3.0, and are probably the single biggest upgrade challenge for most people moving from 2.x to 3.x (when using Windows Forms).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrancoisB replied on Thursday, December 09, 2010</h2><p>Thanks Rocky for your quick response. The thing is, we don&#39;t have any explicit calls to BeginEdit on the UI side. The only place where we use BeginEdit is when the user makes a action that modify certain properties of a child object. We do so to be able to undo those changes, which is triggered by another action. There&#39;s no other use of the undoable mechanism (i.e. user pressing Escape) since data is not presented in a editable way.</p>
<p>My question remains... what makes the CopyState use another list as a parent when IsAssignableFrom is called? Would calling BeginEdit at appropriate moments on my parent object make a difference? I understand the stricter checks may be necessary, but what&#39;s the best practice regarding the use of Begin/Apply/Cancel edits? I read about n-level implementation in your Expert C# 2005 Business Objects book... is there a more recent practice I should know of?</p>
<p>Thanks again for your help. In the meantime, I&#39;ll probably look for a workaround that implies making my own undo approach. Since my use case is just going back to the previous version of my child object (one level), it might be my best choice...</p>
<p>Francois</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 09, 2010</h2><p>Are you using Windows Forms? If so, data binding invokes IEditableObject automatically, and there are specific steps you MUST TAKE in your UI code/design for this to work properly. There&#39;s an entire chapter covering how this works in the Using CSLA .NET 3.0 ebook (<a href="http://store.lhotka.net/">http://store.lhotka.net/</a>).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrancoisB replied on Thursday, December 09, 2010</h2><p>We are indeed using Windows Forms. I guess it&#39;s time for us at work to go and order that book...we already have 2005 and 2008 versions of your book on business objects (I did&#39;nt read the latter though). Hope I find answers to my problem in that chapter you say, but it will be a good read notheless.</p>
<p>Thanks again for your support and keep up your great work. It was an honor being answered by no other than CSLA&#39;s founder :)</p>
<p>Francois</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
