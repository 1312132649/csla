<html><header><title>SL ReadOnlyListBase not a collection?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SL ReadOnlyListBase not a collection?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9994.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM posted on Thursday, January 27, 2011</h2><p>Using CSLA 4.1, SL 4.</p>
<p>I&#39;ve created a simple ReadOnlyList with two properties.&nbsp; I&#39;ve got it to load up and work across the dataportal (yea!).&nbsp; As a test I wanted to loop through the items or simply bind them to an listbox.ItemSource.&nbsp; VS complains that it is not an IEnumerable.&nbsp; What gives? Is this not really a list?!&nbsp; It seems like I&#39;ve missed a step somewhere.&nbsp; Any ideas?</p>
<p>&nbsp;</p>
<div class="WordSection1">
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> System;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"></span><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">System.ComponentModel.DataAnnotations</span>;</span></p>
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">Csla</span>;</span></p>
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">Csla.Serialization</span>;</span></p>
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">System.Diagnostics</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="GramE">if<span style="color:windowtext;"> !SILVERLIGHT</span></span></span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">using</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">System.Data.SqlClient</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="SpellE">endif</span></span><span style="font-size:9.5pt;font-family:Consolas;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span class="GramE"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">namespace</span></span><span style="font-size:9.5pt;font-family:Consolas;"> <span class="SpellE">CSLA</span></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>[<span class="SpellE"><span class="GramE"><span style="color:#2b91af;">Serializable</span></span></span><span class="GramE">(</span>)]</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">class</span> <span class="SpellE"><span style="color:#2b91af;">CustomerListItem</span></span> : <span class="SpellE"><span style="color:#2b91af;">ReadOnlyBase</span></span>&lt;<span class="SpellE"><span style="color:#2b91af;">CustomerListItem</span></span>&gt;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">private</span></span> <span style="color:blue;">static</span> <span class="SpellE"><span style="color:#2B91AF;">PropertyInfo</span></span>&lt;<span class="SpellE"><span style="color:blue;">int</span></span>&gt; <span class="SpellE">CustomerIDProperty</span> = <span class="SpellE">RegisterProperty</span>&lt;<span class="SpellE"><span style="color:blue;">int</span></span>&gt;(o =&gt; <span class="SpellE">o.CustomerID</span>, <span style="color:#A31515;">&quot;<span class="SpellE">CustomerID</span>&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span class="SpellE"><span style="color:blue;">int</span></span> <span class="SpellE">CustomerID</span></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">get</span></span> { <span style="color:blue;">return</span> <span class="SpellE">GetProperty</span>(<span class="SpellE">CustomerIDProperty</span>); }</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">set</span></span> { <span class="SpellE">LoadProperty</span>(<span class="SpellE">CustomerIDProperty</span>, <span style="color:blue;">value</span>); }</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">private</span></span> <span style="color:blue;">static</span> <span class="SpellE"><span style="color:#2B91AF;">PropertyInfo</span></span>&lt;<span style="color:blue;">string</span>&gt; <span class="SpellE">CustomerNameProperty</span> = <span class="SpellE">RegisterProperty</span>&lt;<span style="color:blue;">string</span>&gt;(o =&gt; <span class="SpellE">o.CustomerName</span>, <span style="color:#A31515;">&quot;<span class="SpellE">CustomerName</span>&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">string</span> <span class="SpellE">CustomerName</span></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">get</span></span> { <span style="color:blue;">return</span> <span class="SpellE">GetProperty</span>(<span class="SpellE">CustomerNameProperty</span>); }</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">set</span></span> { <span class="SpellE">LoadProperty</span>(<span class="SpellE">CustomerNameProperty</span>, <span style="color:blue;">value</span>); }</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">override</span> <span style="color:blue;">string</span> <span class="SpellE">ToString</span>()</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">return</span></span> <span class="SpellE">CustomerName</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>[<span class="SpellE"><span class="GramE"><span style="color:#2b91af;">Serializable</span></span></span><span class="GramE">(</span>)]</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">class</span> <span class="SpellE"><span style="color:#2b91af;">CustomerList</span></span> : <span class="SpellE"><span style="color:#2b91af;">ReadOnlyListBase</span></span>&lt;<span class="SpellE"><span style="color:#2b91af;">CustomerList</span></span>, <span class="SpellE"><span style="color:#2b91af;">CustomerListItem</span></span>&gt;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="GramE">if<span style="color:windowtext;"> !SILVERLIGHT</span></span></span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">static</span> <span class="SpellE"><span style="color:#2B91AF;">CustomerList</span></span> <span class="SpellE">GetCustomerList</span>()</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">return</span></span> <span class="SpellE"><span style="color:#2b91af;">DataPortal</span>.Fetch</span>&lt;<span class="SpellE"><span style="color:#2b91af;">CustomerList</span></span>&gt;();</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="SpellE">endif</span></span><span style="font-size:9.5pt;font-family:Consolas;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">public</span></span> <span style="color:blue;">static</span> <span style="color:blue;">void</span> <span class="SpellE">GetCustomerList</span>(<span class="SpellE"><span style="color:#2B91AF;">EventHandler</span></span>&lt;<span class="SpellE"><span style="color:#2B91AF;">DataPortalResult</span></span>&lt;<span class="SpellE"><span style="color:#2B91AF;">CustomerList</span></span>&gt;&gt; callback)</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE"><span style="color:#2b91af;">DataPortal</span>.BeginFetch</span>&lt;<span class="SpellE"><span style="color:#2B91AF;">CustomerList</span></span><span class="GramE">&gt;(</span>callback);</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;"><span style="mso-spacerun:yes;"></span>#region</span><span style="font-family:Consolas;font-size:9.5pt;"> Data Access</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="GramE">if<span style="color:windowtext;"> !SILVERLIGHT</span></span></span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">private</span></span> <span style="color:blue;">void</span> <span class="SpellE">DataPortal_Fetch</span>()</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">using</span></span> (<span class="SpellE"><span style="color:#2b91af;">SqlCommand</span></span> <span class="SpellE">sqlcmd</span> = Csla.Data.<span style="color:#2B91AF;">ConnectionManager</span>&lt;<span style="color:#2b91af;">SqlConnection</span>&gt;.GetManager(<span style="color:#a31515;">&quot;DB&quot;</span>).Connection.CreateCommand())</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE">sqlcmd.CommandType</span> = <span class="SpellE">System.Data.<span style="color:#2B91AF;">CommandType</span>.StoredProcedure</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE">sqlcmd.CommandText</span> = <span style="color:#A31515;">&quot;<span class="SpellE">fetchCustomers</span>&quot;</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE"><span class="GramE">sqlcmd.Parameters.AddWithValue</span></span><span class="GramE">(</span><span style="color:#a31515;">&quot;@<span class="SpellE">OperatorID</span>&quot;</span>, ((Console.CSLA.<span style="color:#2B91AF;">ConsoleIdentity</span>)Csla.<span style="color:#2b91af;">ApplicationContext</span>.User.Identity).OperatorID);<span style="mso-spacerun:yes;"> </span></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">using</span></span> (<span class="SpellE"><span style="color:#2b91af;">SqlDataReader</span></span> <span class="SpellE">sqldr</span> = <span class="SpellE">sqlcmd.ExecuteReader</span>())</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE">IsReadOnly</span> = <span style="color:blue;">false</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="GramE"><span style="color:blue;">while</span></span> (<span class="SpellE">sqldr.Read</span>())</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE"><span class="GramE"><span style="color:blue;">this</span>.Add</span></span><span class="GramE">(</span><span style="color:blue;">new</span> <span class="SpellE"><span style="color:#2b91af;">CustomerListItem</span></span>()</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>{</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span style="mso-spacerun:yes;"></span><span class="SpellE">CustomerID</span> = <span class="GramE">sqldr.GetInt32(</span><span class="SpellE">sqldr.GetOrdinal</span>(<span style="color:#a31515;">&quot;<span class="SpellE">CustomerID</span>&quot;</span>)),</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE">CustomerName</span> = <span class="SpellE"><span class="GramE">sqldr.GetString</span></span><span class="GramE">(</span><span class="SpellE">sqldr.GetOrdinal</span>(<span style="color:#a31515;">&quot;<span class="SpellE">CustomerName</span>&quot;</span>))</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>);</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span><span class="SpellE">IsReadOnly</span> = <span style="color:blue;">true</span>;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;">#<span class="SpellE">endif</span></span><span style="font-size:9.5pt;font-family:Consolas;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;color:blue;"><span style="mso-spacerun:yes;"></span>#<span class="SpellE">endregion</span></span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span>}</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;"><span style="mso-spacerun:yes;"></span></span></p>
<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;">}</span></p>
<p class="MsoNormal">&nbsp;</p>
</div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 27, 2011</h2><p>I don&#39;t know. The only thing I can think of, is that if your test was using LINQ that you are missing the &#39;using System.Linq&#39; statement.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>stefan replied on Friday, January 28, 2011</h2><p>Hi,</p>
<p>maybe this is related to a breaking change from .NET 3.5 to&nbsp; .NET 4, mentioned by Frans Bouma <a target="_blank" title="Breaking change in .NET4?" href="http://weblogs.asp.net/fbouma/archive/2011/01/21/unknown-breaking-change-in-net-4.aspx">here</a>...</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
