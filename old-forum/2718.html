<html><header><title>Need advice for &quot;Are You Sure&quot; condition</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need advice for &quot;Are You Sure&quot; condition</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2718.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert posted on Tuesday, April 17, 2007</h2>I would like a particular business object to ask for validation when a property is set to a specific value. In this case, I have a TimeStart property and a TimeEnd property. When creating a new object, the default for these properties is Now. However, saving the data with both values set to now would be highly unusual, so I'd want the class to ask for verification. I think this rule should be maintained by the class and not the UI.<br><br>One thought I had is to expose a boolean property called ZeroTimeAllowed. The default would be False. If the rule found that the time properties are the same and ZeroTimeAllowed is false, it would be a broken rule. The UI could then show a messagebox and then change the ZeroTimeAllowed to True if the response is Yes.<br><br>I know this is more of a generic OO question, but I'm looking for the best practice.<br><br>Thanks,<br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, April 17, 2007</h2>Well you could create a rule that is just a warning, and have the UI check for any warnigns and display them before it calls save.&nbsp; The UI wouldn't know anything about the rule or how its enforced, it would simply display them.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Tuesday, April 17, 2007</h2>Andy,<br><br>Thanks for the response. I must've missed the severity property in my 2.1 docs. I think it helps, but I'm still not clear on how to use it at the UI level.<br><br>The result I'm looking for is that the UI displays a msgbox with an "Are you sure?" message in the form's Save button. I can have the UI look into the BrokenRulesCollection and look for Warnings, but I would still need to interpret the warning messages through a Select Case, show a Yes/No/Cancel messagebox. The problem is, how does the UI signal back to the business object that the user is, in fact, sure?<br><br>As an aside, Warning and Information broken rules don't seem to show up in the DataGridView the way they do with Errors.<br><br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Wednesday, April 18, 2007</h2><P>I think the answer to your question lies in the understanding that the business layer should not know anything about the specifics that go on in the UI.&nbsp; That is to say, the business object can't possibly be responsible for doing anything in the UI.</P>
<P>I think the broken rules method could be made to work, but you'd end up with some fragile link with the UI looking for some specific wording in a broken rule.</P>
<P>As an alternative, the business object could either raise an event indicating a "suspicious" value was selected, or have an additional property indicating the value is currently suspicious.&nbsp; The UI could do whatever it wants with that information.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, April 18, 2007</h2>Thanks for your reply.<br><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DansDreams:</strong></div><div><p>I think the answer to your question lies in the understanding that the business layer should not know anything about the specifics that go on in the UI.&nbsp; That is to say, the business object can't possibly be responsible for doing anything in the UI.</p><p></div></BLOCKQUOTE></p><p>I certainly agree with this, which is what makes this a challenge.</p><p><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DansDreams:</strong></div><div></p>

<p>As an alternative, the business object could either raise an event indicating a "suspicious" value was selected, or have an additional property indicating the value is currently suspicious.&nbsp; The UI could do whatever it wants with that information.</p></div></BLOCKQUOTE><br><br>Yes, I could raise an event, throw an exception, or return a broken rule. The question remains: when the UI gets this message, displays a messagebox, a recieves a reply, how does it signal back to the business object that, the second time around, it should ignore the warning and not raise/throw again?<br><br>I'm convinced that the only tool I have is something like a ZeroTimeAllowed property.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Wednesday, April 18, 2007</h2><P>I don't understand why you would want to add the complexity of a ZeroTimeAllowed proeprty.&nbsp; In the UI you check if there are any brokenrules that are warnings (see my post above).&nbsp; If there are you display the user a messagebox with the warnings and ask if they would like to continue with the save.&nbsp; There is no need to raise any events or throw any exceptions.&nbsp; </P>
<P>The way I see your problem,&nbsp; it is a UI issue not a business object issue.&nbsp; The business object should not care that there are warnings when saving the business object.&nbsp; In my opinion, the warnings are there for the UI to do with what they want.&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 18, 2007</h2>The BO doesn't do that; your UI, when save is clicked, checks the warnings and displays them and offers the user a chance to back out.&nbsp; If they choose to back out, you simply do nothing.&nbsp; If they do want to continue, then you simply call save on the BO.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, April 18, 2007</h2>Andy and mr_lassiter,<br><br>I see that now. One thing I think I'll need is to have my collection class expose a list of all warnings in its child objects. Does this make sense? Something like:<br><br>&nbsp;&nbsp;&nbsp; Public Function WarningList() As ArrayList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim returnList As New ArrayList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each emp As Employee In Me<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each brokenRule As Csla.Validation.BrokenRule In emp.BrokenRulesCollection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If brokenRule.Severity = Validation.RuleSeverity.Warning Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; returnList.Add(brokenRule.Description)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return returnList<br>&nbsp;&nbsp;&nbsp; End Function<br><br>This way the UI could just have:<br>Dim empWarnings as ArrayList=_employees.WarningList<br>If empWarnings.Count &gt; 0 then<br>&nbsp;&nbsp;&nbsp; Dim strMsg as String=""<br>&nbsp;&nbsp;&nbsp; For each item as string in empWarnings <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  strMsg += item &amp; Environment.NewLine<br>&nbsp;&nbsp; Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim returnVal as DialogResult = Messagebox.Show(strMsg &amp; "Save anyway?")<br>&nbsp;&nbsp;&nbsp; SelectCase returnVal<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  blah,blah...<br>End If<br><br>Does this make most sense?<br><br>Thanks again for you help.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 18, 2007</h2>I think there's already a way to get warnings from Csla; check out the BrokenRulesCollection class, I believe there's a ToArray overload that will take a Severity parameter so you can get only the warnings.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Wednesday, April 18, 2007</h2><P>Wouldn't the following logic in your UI work for you?</P>
<P>&nbsp;If _bill.BrokenRulesCollection.WarningCount &gt; 0 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '&nbsp; Display Warnings to the user - but still allow them to save<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim displayMessage As New StringBuilder()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayMessage.Append(CChar(Environment.NewLine), 2)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayMessage.Append(_bill.BrokenRulesCollection.ToString(Validation.RuleSeverity.Warning))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayMessage.Append(CChar(Environment.NewLine), 2)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Messages.Question(String.Format(My.Resources.WarningsFound, displayMessage)) Then Exit Sub<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using New StatusBusy("Saving Bill....")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;_bill.Save()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Messages.Critical("Error Saving.", ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Thursday, September 13, 2007</h2>For posterity, I found a better solution that moves the majority of the logic into my business class. I created a custom event and a new event args class that has properties to contain the question and the response. I then raise the event that the UI subscribes to. It sets the response property based on a msgbox response.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Thursday, September 13, 2007</h2><P>I'm a little unclear about what you actually did.&nbsp; At the end of the day, you still need something similar to what you originally described, except for the decoupling of the alert to the UI (accomplished by using an event).</P>
<P>So, the BO has an event ZeroTimeSpanSet.</P>
<P>BO has a bool property ZeroTimeSpanNeedsVerify which is false by default</P>
<P>Whenever the TimeStart or TimeEnd properties are set, the BO raises the event and sets the property to&nbsp;true if necessary based on examining the time span.</P>
<P>IsValid checks to make sure the property is false.</P>
<P>UI should provide way to set the property to false when the event is raised.</P>
<P>Is that close to what you did?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Thursday, September 13, 2007</h2>I was able to do away with the property. I have a validation rule wired to both of the time properties. In the rule handler, if the two time properties are the same, I raise the event. If the response passed back in the event args is that this is an acceptable condition, I return true. Otherwise I return false.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
