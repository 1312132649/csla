<html><header><title>IsDirty stack overflow with managed field ref to parent</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>IsDirty stack overflow with managed field ref to parent</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5268.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv posted on Tuesday, August 19, 2008</h2><P>I am using CSLA 3.5 for a project in which I&nbsp;have a multi-level object graph where the children may have references pointing back up the chain.&nbsp; This is primarily so that I can access some common data I do not want to replicate in each and every child, and which is needed for updates to the database.&nbsp; </P>
<P>I ran into an issue with the&nbsp;implementation of IsDirty where it queries the FieldManager.&nbsp; Since there is currently no way to mark a managed field as NotUndoable, I was getting a circular reference.&nbsp; </P><PRE>    public bool IsDirty()
    {
      foreach (var item in _fieldData)
        if (item != null &amp;&amp; item.IsDirty)
          return true;
      return false;
    }
</PRE>
<P>There is already an entry in BugTracker (<A href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=30">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=30</A>), so this is some added ammunition to move it up the priority list ;-).&nbsp; My workaround is to manage the field explicitly and bypass FieldManager, however I dislike having the dual code constructs.</P>
<P>If others have handled this in a different manner, I would love to hear.</P>
<P>Thanks, Fintan</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 19, 2008</h2>I'm really unclear on when not to use managed properties.&nbsp; Currently I'm not using managed properties for anything the user can't edit or view, and is only needed as part of the objects state.&nbsp; So my database id, which is always hidden, is just a normal field inside the BO.&nbsp; This seems right to be because the field shouldn't participate in Undo related operations, never needs to have security checks done, doesn't get validated in anyway.. so I'm opting to save the ovehead for those kinds of fields.<br><br>I could be wrong though... I'm interested to see what the new book will have to say on the topic.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 19, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>I'm really unclear on when not to use managed properties.&nbsp; Currently I'm not using managed properties for anything the user can't edit or view, and is only needed as part of the objects state.&nbsp; So my database id, which is always hidden, is just a normal field inside the BO.&nbsp; This seems right to be because the field shouldn't participate in Undo related operations, never needs to have security checks done, doesn't get validated in anyway.. so I'm opting to save the ovehead for those kinds of fields.<BR><BR>I could be wrong though... I'm interested to see what the new book will have to say on the topic.<BR></div></BLOCKQUOTE></P>
<P>Unless you use the NotUndoable attribute, your fields (private or managed) are subject to undo. That's not new with managed properties.</P>
<P>Managed properties should <EM>always</EM> be used for child references. That saves you a huge amount of code and avoids a lot of common bugs made where people forget to add this or that bit of plumbing around child references.</P>
<P>Managed fields may be used for normal public properties, or you may use private backing fields. That's really your choice. Managed fields are a little slower, private fields won't serialize as easily to CSLA Light if you ever move to Silverlight (though they <EM>will</EM> work, you just have to do extra work in your code).</P>
<P>I don't use managed fields for non-public values like a timestamp or private id value. I'm perfectly happy to put them in private fields. Though there too, that will require extra work to make the object serialize properly to/from Silverlight.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, August 20, 2008</h2>Thanks for the clarification!&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 19, 2008</h2>Oh, more relevant to your post...&nbsp; you already should have a Parent reference already, you just need to cast it properly.&nbsp; So you shouldn't need to maintain the parent reference yourself.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv replied on Tuesday, August 19, 2008</h2><P>Unfortunately I need access to the containing object one level higher than the parent collection, hence the stored ref.</P>
<P>ex. BO1 -&gt; COL2 -&gt; BO2&nbsp; : where BO2 needs access to data in BO1.</P>
<P>W.r.t. your earlier post: Since the read only base class also includes the managed field concept, I have been implementing the read-only properties as managed fields as well.&nbsp; Maybe my usage is overkill?&nbsp; I do prefer the cleanliness of having a single way of treating all properties, plus since I utilize grids alot, I like the ability to supply a friendly name via the PropertyInfo (very clean way to support internationalization as well).&nbsp;</P>
<P>-- Fintan</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Tuesday, August 19, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Fintanv:</strong></div><div> 
<P>Unfortunately I need access to the containing object one level higher than the parent collection, hence the stored ref.</P>
<P>ex. BO1 -&gt; COL2 -&gt; BO2&nbsp; : where BO2 needs access to data in BO1.</div></BLOCKQUOTE></P>
<P>You can still do that with the built in reference. You just need to add a property but not a field so you don't have to worry about NotUndoable or NotSerializable attributes, that's already done correctly. See&nbsp;<A HREF="/forums/thread/24850.aspx">http://forums.lhotka.net/forums/thread/24850.aspx</A>&nbsp; I've used it and it works nicely.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
