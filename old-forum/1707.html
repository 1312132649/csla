<html><header><title>CslaDataSource TypeAssembyName &amp; TypeName could not be set?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataSource TypeAssembyName &amp; TypeName could not be set?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1707.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna posted on Tuesday, November 07, 2006</h2>Hello,<br><br>I'm having a strange problem with the CslaDataSource. <br><br>I have a MessageInfoList of class ReadOnlyListBase with child class MessageInfo. Both classes have basic fetch functionality and that's it. <br>The classes are placed in a separate Library dll.<br><br>For the webapp I use Windows authentication, I've added the namespace shortcut for Csla.Web. Furthur I have manually added the CslaDataSource and set the properties TypeAssemblyName and TypeName. However when setting the TypeAssemblyName property the Designer shows the following error:<br><br> 
Error Creating Control - MessageInfoListDataSource<br>'Project.Library' could not be set on property 'TypeAssemblyName'<br><br>What am I doing wrong?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Tuesday, November 07, 2006</h2>They can be set programmatically I found...however I can't use the visual databinding features this way...or is this default behaviour?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Wednesday, November 08, 2006</h2>After settings the properties and choosing the "Refresh Schema" of the CslaDataSource the properties were successfully set.<br><br>When binding the datasource to, for example, a datalist I would expect the TypeName to be that of the ReadOnlyBaseList, however this fails raising an error that the type could not be loaded.<br><br>So I tried the ReadOnlyBase class used by the ReadOnlyBaseList and that did the magic trick. I was suprised to see the datalist immediately showed the ReadOnlyBaseList items! How does the list or the datasource know to use the list, even when specifying the items class??<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 08, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>cultofluna:</strong></div><div><br>So I tried the ReadOnlyBase class used by the ReadOnlyBaseList and that did the magic trick. I was suprised to see the datalist immediately showed the ReadOnlyBaseList items! How does the list or the datasource know to use the list, even when specifying the items class??<br></div></BLOCKQUOTE><br><br>All I can say is "read chapter 5" <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Friday, November 10, 2006</h2>ok... I admit re-reading did help :D thanks!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, December 07, 2006</h2><P>Sorry for the lateness of this post, but I just ran into the same problem and found this thread while searching for an answer.&nbsp; However, I'm not finding one.&nbsp; I did re-read chapters 5 and 10 and do not see anything that mentions the behavior that I am seeing and was reported earlier in this thread.</P>
<P>I created a web page yesterday with an Infragistics' UltraWebGrid.&nbsp; I added the CslaDataSource to the page and setup the TypeAssemblyName and TypeName properties along with the OnSelectObject event handler.&nbsp; Everything worked great, as promised and I was thrilled and showing off just how quickly and easily this was accomplished.&nbsp; I was able to go right into the UltraWebGrid designer and setup the column order, etc. and within 5 minutes had the page up and running.&nbsp; This was great!</P>
<P>Today I attempted to setup a second such page.&nbsp; This time I quickly added the controls manually in the Source View following the same pattern as the previous page.&nbsp; When I switched to the Design View so that I could use the UltraWebGrid designer, the CslaDataSource control failed, reporting that the TypeName property could not be set.</P>
<P>I tried deleting the control and adding it anew.&nbsp; Same problem.</P>
<P>So, just for kicks - and comparison - I opened up the page that I had created yesterday (the one that worked great!) and it had the same error message!</P>
<P>To further troubleshoot the problem, I ran the app so that I could see if the pages would come up and they both came up fine.&nbsp; This tells me we are dealing with strictly a design-time problem.&nbsp; However, because I could not get the schema setup, the second UltraWebGrid had its default settings (column order, etc).</P>
<P>That brought me here.&nbsp; I read this thread and discovered that I could eliminate the error by removing the TypeName and TypeAssemblyName values in Source View, switch back to the Design View, set the properties in the Properties Grid and click the Refresh Schema link as described above.&nbsp; This worked, the error went away, the UltraGrid updated to reflect the schema and I was able to use the UltraWebGrid designer to setup the columns as desired.</P>
<P>Unfortunately, when I went back to the original page (the one I set up yesterday) and followed the same steps, the UltraWebGrid was restored to its default settings and I had to go through and re-order all the columns, etc. again.&nbsp; I imagine this is by design as the grid probably doesn't know that the schema is just a refreshed version of the same - I'm sure it assumes nothing.&nbsp; So, the fact that this happened isn't so much a problem other than the need to do so.</P>
<P>When I come in tomorrow will I have to go through all of my pages and redo all of these steps again?!?!?&nbsp; In an application where I will have no less than 20 such views, this will get ridiculous fast.</P>
<P>So, can you tell me specifically why this error is occurring and what can be done to fix it short of following these steps for each and every instance in the application?</P>
<P>Thanks.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 07, 2006</h2><P>I don't know why this is happening, and I've been unable to replicate the issue, so debugging is challenging...</P>
<P>If you can reliably replicate the behavior you could help me out - though it is a bit complex.</P>
<P>What you need to do is </P>
<OL>
<LI>Open your failing solution in VS.</LI>
<LI>Then open a second instance of VS and load the CSLA .NET solution into it.</LI>
<LI>Set break points in the CslaDataSource class in the TypeName property set block.</LI>
<LI>Then, in that second instance, attach the debugger to the first instance of VS.</LI>
<LI>Now return to the first instance of VS and make it fail. That should get you into the breakpoint in the second instance of VS and you can step through the code to find the actual exception/issue that occurs.</LI></OL>
<P>As you can see, without a failing project, this is impossible to debug - but if you can follow these steps it may give us a valuable clue as to why it occurs and then I can try and resolve it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 07, 2006</h2>There's a slightly easier way, as long as you have the pdb files available for all your assemblies (including Csla).<br><br>Run the program in question.&nbsp; Then goto the Debug menu, Windows, Modules.&nbsp; Find yoru assemblies, and right clilck on them.&nbsp; Choose the option to load symbols.&nbsp; It will ask you where to find the pdb.&nbsp; Locate it.&nbsp; It will also ask you to locate the source code.. locate that as well.&nbsp; You can then step through, all in one IDE session.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, December 07, 2006</h2><P>Okay, now I'm stumped.</P>
<P>Worked on&nbsp;5 different pages with&nbsp;5 different grids and&nbsp;5 different data sources and all of them were repeatable and consistent in their failure.&nbsp; I couldn't even switch from Design view to Source view and back without them failing.</P>
<P>Shut everything down &amp; came home.&nbsp; Powered up just now and walked through the steps Rocky suggested and all of them are working perfectly fine!&nbsp; No error messages.&nbsp; Data sources and grid come up as expected!?!</P>
<P>So, now I'm stumped.&nbsp; I'll have to wait and see if I can get it to fail then try this again.&nbsp; If so, I'll post the results.</P>
<P>On the brighter side, was actually worth the time to walk through how the control is setup and see the objects interact.&nbsp; Thanks for the insight on how to debug design-time behavior - that will come in handy in the future, I'm sure.</P>
<P>I'll let you know if I get it to fail again.</P>
<P><img src="/emoticons/emotion-42.gif" alt="Confused [*-)]" /></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 07, 2006</h2>




<DIV align=left><SPAN class=782424402-08122006><FONT face=Arial color=#0000ff size=2>This works to debug IDE hosted 
controls?</FONT></SPAN></DIV>
<DIV align=left><SPAN class=782424402-08122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=782424402-08122006><FONT face=Arial color=#0000ff size=2>I don't think this will wrok - because you aren't actually 
running the first IDE in debug mode. The bug occurs when the IDE is still in 
design time, so that particular IDE's debugger isn't active.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=782424402-08122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=782424402-08122006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV><BR>
<BLOCKQUOTE>
  <DIV class=OutlookMessageHeader align=left>
  <HR>
  <FONT face=Tahoma size=2><B>From:</B> ajj3085 [mailto:cslanet@lhotka.net] 
  <BR><B>Sent:</B> Thursday, December 07, 2006 3:59 PM<BR><B>To:</B> 
  rocky@lhotka.net<BR><B>Subject:</B> Re: [CSLA .NET] SOLVED?? Re: 
  CslaDataSource TypeAssembyName &amp; TypeName could not be 
  set?<BR></FONT><BR></DIV>
  <DIV></DIV>There's a slightly easier way, as long as you have the pdb files 
  available for all your assemblies (including Csla).<BR><BR>Run the program in 
  question.&nbsp; Then goto the Debug menu, Windows, Modules.&nbsp; Find yoru 
  assemblies, and right clilck on them.&nbsp; Choose the option to load 
  symbols.&nbsp; It will ask you where to find the pdb.&nbsp; Locate it.&nbsp; 
  It will also ask you to locate the source code.. locate that as well.&nbsp; 
  You can then step through, all in one IDE 
  session.<BR><BR>HTH<BR>Andy<BR><BR><BR><BR></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 08, 2006</h2>Sorry, missed that this was a design time error.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, December 12, 2006</h2><P>Got it to repeat!</P>
<P>Stepped through debugging as suggested and the code broke in the CslaDataSource class TypeName property setter on the statement:</P>
<P><CODE>((CslaDataSourceView)this.GetView("Default")).TypeName = value;</CODE></P>
<P>The error message was:</P>
<P>"Unable to cast object of type 'Csla.Web.CslaDataSourceView' to type 'Csla.Web.CslaDataSourceView'."</P>
<P>Stepping into the code, the view is returned from the GetView method and (obviously) failing on the cast.</P>
<P>I had to manually remove the TypeName and TypeAssemblyName attributes from the control in the web page, switch back to Design View and enter them into the Properties window to restore the control.</P>
<P>Any ideas?</P>
<P>I can tell you that this occurred after a rebuild of the complete solution - including the Csla assembly.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 12, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>"Unable to cast object of type '<font color="#000080">Csla.Web.CslaDataSourceView</font>' to type '<font color="#ff0000">Csla.Web.CslaDataSourceView</font>'."</div></BLOCKQUOTE><br><br>Hmm... the only thing I can think of that would cause an error message like that would be a version mismatch on the assembly.&nbsp; So the version of the assembly the component in blue comes from is not the same as the version of the assembly the red is from.&nbsp; That's just a guess though.. but its odd you couldn't cast a type to itself..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, December 12, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>
<P>I can tell you that this occurred after a rebuild of the complete solution - including the Csla assembly.</P>
<P></div></BLOCKQUOTE></P>
<P>So do you have the Csla project as part of your business solution?</P>
<P>That's not a supported scenario, and may not be something we can fix. The IDE loads <EM>a version</EM> of Csla.dll into the AppDomain owned by the IDE and you are stuck with that version. But since I do dynamic loading of assemblies into a temporary AppDomain to reflect against your business assembly, it could be loading <EM>a different version</EM> of Csla.dll at that point - which would cause no end of confusion...</P>
<P>It is not supported to have the Csla project and your business/UI projects in the same solution in VS.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, December 12, 2006</h2><P>The source was added to simply debug and testing and toying with changes/customization/tweaks.&nbsp; but, this makes sense.&nbsp; I believe that it occurred after I recompiled the source assembly the last time as well.&nbsp; It is understandable that the versions are out-of-whack then, which would obviously lead to the casting error.</P>
<P>I will have the assembly removed from the solution.&nbsp;&nbsp;I think our understanding is thorough enough at this point that there's no benefit versus a reference any longer.</P>
<P>Thanks for the help understanding what has happened.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChristianPena replied on Tuesday, May 01, 2007</h2><P>A little late in my response here, but I encountered the same issue just now. This was caused by having a web app running in 1.5 and then attempting to run another one (the one that failed) in 2.0.</P>
<P>I shut down the 1.5 application and the issue was resolved.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
