<html><header><title>VB NonSerialized on eventhandler ignored?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>VB NonSerialized on eventhandler ignored?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9628.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh posted on Wednesday, October 13, 2010</h2><p>Hi all,</p>
<p>Simple one...</p>
<p>Here&#39;s my code which is almost a carbon copy of Rockys code posted a while back </p>
<p><blockquote style="overflow-x: scroll;"><pre style="margin: 0px;"></p>
<p>&lt;NonSerialized()&gt; _<br />&nbsp;&nbsp;&nbsp; Private mNonSerializable As EventHandler<br /><br />&nbsp;&nbsp;&nbsp; Private mSerializable As EventHandler<br /><br />&nbsp;&nbsp;&nbsp; Public Custom Event RecalculateNeeded As EventHandler<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler(ByVal value As EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Target.GetType.IsSerializable Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializable = CType([Delegate].Combine(mSerializable, value), EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializable = CType([Delegate].Combine(mNonSerializable, value), EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End AddHandler<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveHandler(ByVal value As EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value.Target.GetType.IsSerializable Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSerializable = CType([Delegate].Remove(mSerializable, value), EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mNonSerializable = CType([Delegate].Remove(mNonSerializable, value), EventHandler)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RemoveHandler<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent(ByVal sender As Object, ByVal e As EventArgs)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mNonSerializable IsNot Nothing Then mNonSerializable(sender, e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mSerializable IsNot Nothing Then mSerializable(sender, e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End RaiseEvent<br />&nbsp;&nbsp;&nbsp; End Event</p>
<p></pre></blockquote></p>
<p>And then the wire-up</p>
<p><blockquote style="overflow-x: scroll;"><pre style="margin: 0px;"></p>
<p>&nbsp; AddHandler BookAccomm.RecalculateNeeded, AddressOf RecalculateNeeded<br /></pre></blockquote></p>
<p>However, when trying to bind the object I still get an error that the object which is handling the event is not marked as serializable. I&#39;ve checked and the addhandler definitely combines the delegate with the nonserialized eventhandler</p>
<p>I&#39;m pulling my hair out here! Any ideas?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Wednesday, October 13, 2010</h2><p>Doing digging with FomatterServices.GetSerializableMembers() does not return the field marked as NonSerialized.</p>
<p><br />So somewhere there is a ref to the form which I&#39;ve used to handle the event which the serializer is trying to package, yet if I remove the event wire-up code, the form binds fine</p>
<p><br />Argh!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Wednesday, October 13, 2010</h2><p>Aha, added NotUndoable attribute to the eventhandlers and everything is OK</p>
<p>Does this mean that somewhere in the framework CSLA is trying to serialize undoable members regardless if NonSerialized is set?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, October 13, 2010</h2><p>The undo feature is separate from serialization, but it is similar. And so it is controlled by its own attribute, and yes, you typically need to use both attributes to block serialization and undo.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
