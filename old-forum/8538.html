<html><header><title>Why no INotifyPropertyChanged on BusinessListBase?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Why no INotifyPropertyChanged on BusinessListBase?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8538.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gstempeck posted on Tuesday, February 16, 2010</h2><p>Greetings,</p>
<p>This is probably a question specifically for Rocky regarding CSLA.&nbsp; We&#39;ve recently encountered an issue with memory leaks, and they were related to this specific Microsoft Article:</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><a href="http://support.microsoft.com/kb/938416"><span style="font-family:Calibri;font-size:small;">http://support.microsoft.com/kb/938416</span></a></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">Anytime you Bind to a BusinessListBase.SomeProperty in WPF, there is a potential for a memory leak because CSLA&rsquo;s BusinessListBase does not implement Property Changed events.&nbsp; </p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">For example, we have had issues with binding to SomeList.Count, to hide/show UI components based on whether or not the list has any data.&nbsp;&nbsp;This can&nbsp;result in substantial&nbsp;memory leaks, especially if you have a large object graph and&nbsp;any one of your objects gets bound in this manner.&nbsp;WPF&nbsp;will try&nbsp;to attach its own events, which can root the entire object in memory.</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">So, i&#39;m mostly curious - was there *good reason* not to implement INotifyPropertyChanged on the BusinessListBase?&nbsp; Because even the &quot;ReadOnlyBase&quot; has this implemented, and given that it&#39;s read-only, it should never change, right?</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">We&#39;re thinking of just implementing this in our subclass but I want to make sure there wasn&#39;t some specific reason not to do this before we get to crazy.</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">Thanks in advance,</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">&nbsp;</p>
<p class="MsoNormal" style="margin:0in 0in 0pt;">GS</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 16, 2010</h2><p>BusinessListBase is a list, and it derives from BindingList&lt;T&gt;.</p>
<p>In CSLA 4 it derives from ObservableCollection&lt;T&gt; - which is more WPF friendly.</p>
<p>So CSLA doesn&#39;t implement the Count property - Microsoft does that in the base classes.</p>
<p>And, fwiw, ObservableCollection&lt;T&gt; doesn&#39;t implement INotifyPropertyChanged either - so their WPF-oriented collection base class apparently violates their own recommendation based on that article.</p>
<p>The short answer though - is that prior to XAML it wasn&#39;t valid to bind to properties on a list/collection. Windows Forms doesn&#39;t have a provision for doing such a thing. So a collection type would never implement INotifyPropertyChanged, because nothing would listen for it. Implementing it would be silly.</p>
<p>Clearly XAML changes the rules - but even in .NET 4 ObservableCollection&lt;T&gt; doesn&#39;t implement INPC - so clearly Microsoft doesn&#39;t consider that an important or desirable scenario to address.</p>
<p>Fwiw, you can&#39;t solve this in a subclass. You&#39;ll need to start with something that inherits from System.Object and implement all the collection interfaces by hand. Have fun - I&#39;ve done that and it is an interesting challenge!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gstempeck replied on Tuesday, February 16, 2010</h2><p>Thanks Rocky for the swift response and insight -</p>
<p>It sounds like CSLA 4 may resolve the issue, because looking over the ObservableCollection on MSDN, it appears that Microsoft does implement INotifyPropertyChanged.</p>
<p><a href="http://msdn.microsoft.com/en-us/library/ms668604.aspx">http://msdn.microsoft.com/en-us/library/ms668604.aspx</a></p>
<p><span style="color:blue;">public</span> <span style="color:blue;">class</span> ObservableCollection&lt;T&gt; : Collection&lt;T&gt;, <br />&nbsp;&nbsp;&nbsp; INotifyCollectionChanged, INotifyPropertyChanged</p>
<p>The memory-leak article reads like stereo instructions for sure.&nbsp; It&#39;s not the .Count that is a problem, its any property that could be bound on an object that doesn&#39;t implement the interface that can cause an issue.&nbsp; The root problem is that Microsoft wires up the events automatically&nbsp;by creating a property descriptor that gets stored in a static hash-table.&nbsp; I know this isn&#39;t CSLA&#39;s problem, it seems&nbsp;clearly like&nbsp;an oversight on Microsoft&#39;s part, yet gets described as &quot;by design&quot;.</p>
<p>Anyway, I realize that binding to a property of a list seems silly, but when WPF lets you do crazy things and bind to whatever you want - and a common school of thought is to &quot;do everything in WPF instead with no code-behind&quot;, it sure makes it simple to get leaky, real quick.</p>
<p>Thanks again for the added insight!</p>
<p>GS</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 16, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>gstempeck<br></b></p>
<p>Anyway, I realize that binding to a property of a list seems silly, but when WPF lets you do crazy things and bind to whatever you want - and a common school of thought is to &quot;do everything in WPF instead with no code-behind&quot;, it sure makes it simple to get leaky, real quick.</p>
<p></div></p>
<p>I think that&#39;s the key - XAML changed the rules - it is no longer silly to think about these things, because they are now meaningful and valuable.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
