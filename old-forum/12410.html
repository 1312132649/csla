<html><header><title>Private Backing Field - FieldManager.IsDirty()</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Private Backing Field - FieldManager.IsDirty()</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12410.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>keithv posted on Thursday, February 27, 2014</h2><p>I am seeing a behavior I do not understand with BusinessBase. When changing a property with a private backing field BusinessBase.IsDirty is true but FieldManager.IsDirty() = false.</p>
<p>Here is my property:</p>
<p>public static readonly PropertyInfo&lt;bool&gt; HasImageProperty = RegisterProperty&lt;bool&gt;(c =&gt; c.HasImage, RelationshipTypes.PrivateField);<br /><br />[NotUndoable, NonSerialized]<br />protected bool _HasImage = false;<br />public bool HasImage<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(HasImageProperty, _HasImage); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(HasImageProperty, ref _HasImage, value); }<br />}</p>
<p>Code:</p>
<p>MarkClean();<br /><br />// At This Point:<br />// HasImage = false<br />// base.IsDirty = false;<br />// FieldManager.IsDirty() = false;<br /><br />HasImage = true;<br /><br />// At This Point:<br />// HasImage = true<br />// base.IsDirty = true<br />// FieldManager.IsDirty() = false; // How??</p>
<p><b>Csla 4.5.40.0</b></p>
<p>This has me very confused. Isn&#39;t BusinessBase.IsDirty driven off of FieldManager.IsDirty?</p>
<p>For some background the business scenario I am trying to work out is having required business rules based on a child list. If an item is added to the child list I want three other non-list properties on the parent to be required. Since business rules do not get executed when items are added/removed I added the rules to a new boolean property HasImage and set HasImage in the OnChildChanged override. When HasImage = true the three non-list properties are required. Only if you add an item to the list and then remove it the item stays marked as IsDirty since HasImage has changed. I cannot work out how to have a property with business rules that does not effect IsDirty.</p>
<p>Thank you!</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Thursday, February 27, 2014</h2><p style="color:#000000;font-family:Arial, Helvetica, sans-serif;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;orphans:auto;text-align:start;text-indent:0px;text-transform:none;white-space:normal;widows:auto;word-spacing:0px;-webkit-text-stroke-width:0px;">Hi,</p>
<p style="color:#000000;font-family:Arial, Helvetica, sans-serif;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;orphans:auto;text-align:start;text-indent:0px;text-transform:none;white-space:normal;widows:auto;word-spacing:0px;-webkit-text-stroke-width:0px;">FieldManager only has knowledge of the status on &quot;managed&quot; properties - not properties with private backing fields.&nbsp;</p>
<p style="color:#000000;font-family:Arial, Helvetica, sans-serif;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;orphans:auto;text-align:start;text-indent:0px;text-transform:none;white-space:normal;widows:auto;word-spacing:0px;-webkit-text-stroke-width:0px;">And so BusinessBase has a private field for _isDirty and this is the actual code:</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;">[<span style="color:#2b91af;">Browsable</span>(<span style="color:blue;">false</span>)]
[<span style="color:#2b91af;">Display</span>(AutoGenerateField&nbsp;=&nbsp;<span style="color:blue;">false</span>)]
<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">virtual</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;IsDirty
{
&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;IsSelfDirty&nbsp;||&nbsp;(_fieldManager&nbsp;!=&nbsp;<span style="color:blue;">null</span>&nbsp;&amp;&amp;&nbsp;FieldManager.IsDirty());&nbsp;}
}<br /><br />and<br /><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">virtual</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;IsSelfDirty
{
&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;_isDirty;&nbsp;}
}</pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
