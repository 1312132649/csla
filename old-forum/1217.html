<html><header><title>Help needed with BindingList&lt;T&gt; behaviour</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Help needed with BindingList&lt;T&gt; behaviour</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1217.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell posted on Thursday, September 14, 2006</h2>AAAAAAAAAGGGGHHHHH!!!!!!<br><br>Okay, got that out of my system.&nbsp; Maybe I am just doing things wrong but....<br><br>I have been working on the ObjectListView, and one thing it does is have the individual ObjectView objects (the rows) implement IEditableObject.&nbsp; What this should allow you to do is the following:<br><br>// Private fields<br>private Csla.ObjectListView _view;&nbsp;&nbsp;  // List of items to edit<br><br>private void addButton_Click(object sender, System.EventArgs e)<br>{<br>&nbsp;&nbsp;&nbsp; using (EditForm edit = new EditForm())<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; ObjectView child = _view.AddNew();&nbsp;&nbsp;  // Automatically calls BeginEdit() on the ObjectView<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  edit.ChildObject = (ChildObject)child.Object;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  if (edit.ShowDialog() == DialogResult.OK)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  child.EndEdit();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  child.CancelEdit();&nbsp; // Would remove the new item from the underlying list except it throws an exception<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>The reason that it throws an exception is that the edit form has called BeginEdit on the child object and calls CancelEdit on the child object if it is closed through any other means than clicking OK.&nbsp; This calls UndoChanges on the business object which calls OnUnknownPropertyChanged which calls OnPropertyChanged(string.Empty).&nbsp; So, can you guess what the underlying BindingList&lt;T&gt; in BusinessListBase does when it sees that?&nbsp; It fires a ListChangedType.Reset event!&nbsp; It turns an unknown change on a single item into a reset of the entire list.&nbsp; This causes an exception on the child.CancelEdit(); line because the ObjectListView has seen the ListChangedType.Reset and rebuilt the sorted list without the ObjectView that is in an edit.&nbsp; So child no longer exists in the ObjectListView and it throws an IndexOutOfRange exception.<br><br>Any ideas of ways around this?&nbsp; I am thoroughly frustrated.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, September 15, 2006</h2>Okay, so I got around that issue by implementing the code below.<br><br>private void addButton_Click(object sender, System.EventArgs e)<br>{<br>&nbsp;&nbsp;&nbsp; using (EditForm edit = new EditForm())<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  edit.ChildObject = (ChildObject)_childList.AddNew();<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  if (edit.ShowDialog() != DialogResult.OK)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp; _childList.Remove(edit.ChildObject);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>This works, but it is unfortunate to use this method as being able to use ObjectListView.AddNew() would have suppressed all ListChanged events pointing to that row and the item would not have sorted until the entire edit was accepted or cancelled.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
