<html><header><title>ValidationRules.AddInstanceRule Question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ValidationRules.AddInstanceRule Question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3160.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DanielBarla posted on Tuesday, July 10, 2007</h2>Hi Guys, <br><br>I have a scenario where a specific business object must behave in different ways w.r.t. validations, essentially based on which screen / part of a process it is being accessed from.&nbsp; Essentially what happens is that I have a method on the business object which can be called in order to apply additional sets of validation rules.&nbsp; This allows the calling screens to apply the relevant validations to the object (at runtime) when these validations are needed for specific points in a process.&nbsp; There are two questions I have:<br><br>1)&nbsp; When I use the above mentioned method, I call ValidationRules.AddInstanceRule, as expected.&nbsp; However, if something has already triggered validation on the object prior to the AddInstanceRule call, the new rules do not reflect / take effect on the object, since the&nbsp; framework's code caches the list of rules to apply, and will effectively not&nbsp; "un-cache" them until the object is destroyed.&nbsp; This means that I'm stuck having to initialise the validations in, or right after the constructor, and this is not ideal. I'm wondering if anyone's run into this problem, and whether you've come up with some creative solutions to it.<br><br>2) I'm aware that allowing screens to add validation rules is generally considered to be bad practice, since a degree of control regarding the validation rules is removed from the business object.&nbsp; A cleaner approach would be for me to create a base class from which specific implementations could inherit, and each of these could then apply the relevant validations.&nbsp; Unfortunately, the project in question already has a large number of business classes, and I'm not looking to multiply them just for the purposes of validation.&nbsp; Do you have a clean solution which doesn't require multiple classes, and remains relatively dynamic?<br><br>Thanks,<br><br>Daniel Barla-Szabo<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, July 10, 2007</h2>It sounds like you should have multiple classes, one for each use case.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, July 10, 2007</h2><P>I think you need to re-think your rule definitions, not add or subtract rules after-the-fact!</P>
<P><STRONG>Example (in your terms, as I understand them):</STRONG></P>
<P>From screen "InitialEntry", the property "BirthDate" is optional.</P>
<P>From screen "PrepareToPay", the property "BirthDate" is required.</P>
<P>So, you've framed the solution as "Add a Field Required rule on BirthDate when on screen "PrepareToPay".</P>
<P><STRONG>Same example, in business rule&nbsp;terms:</STRONG></P>
<P>The business object has two states, InitialEntry and ReadyToPay.&nbsp; This is denoted by a read/write property called, imaginatively enough, BusinessProcessState.</P>
<P>The PrepareToPay screen is responsible for setting the BusinessProcessState to ReadyToPay.</P>
<P>The business rule is:</P>
<P>BirthDate is required when BusinessProcessState = "ReadyToPay".</P>
<P>The above rule checks the BusinessProcessState and if it is not ReadyToPay, it returns success.</P>
<P>If BusinessProcessState = ReadyToPay, then it checks to see whether the BirthDate is filled in, and returns success or failure as appropriate.</P>
<P>&nbsp;</P>
<P>In this example, the rule is always present.&nbsp; And it's much cleaner to code and understand than adding/subtracting rules at runtime, or having lots of different (but mostly the same) classes with different rules in them.</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DanielBarla replied on Wednesday, July 11, 2007</h2>Thanks for the reply.&nbsp; Yepp, your example is quite similar to my requirements, so you understood correctly.<br><br>I like your solution, so far I've stayed away from doing it that way since it requires implementing custom validation rules for each case (where the standard ones typically would have done just fine).&nbsp; However hearing other people's opinion is starting to nudge me in that direction :)<br><br>I'm thinking that perhaps I should look into creating a set of validations that implement the specification pattern (In short, a way of selecting objects as well as composing these criteria, using AND, OR, NOT, etc. One of the better explanations I've seen is on DNRTV, <a href="http://www.dnrtv.com/default.aspx?showNum=71">here</a>). This would allow easily re-using the basic validations whilst also providing composability at the same time.<br><br>In either case, thanks for the the ideas!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Wednesday, July 11, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>DanielBarla:</strong></div><div></P>
<P>I like your solution, so far I've stayed away from doing it that way since it requires implementing custom validation rules for each case (where the standard ones typically would have done just fine).&nbsp; However hearing other people's opinion is starting to nudge me in that direction :)<BR><BR></div></BLOCKQUOTE></P>
<P>Learning how to do custom validation rules is "time well spent".&nbsp; :)</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
