<html><header><title>how can I run checks before deleting. IsDeletable method</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>how can I run checks before deleting. IsDeletable method</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7436.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>McKay posted on Monday, August 10, 2009</h2>Hi<br /><br />My senario is this. I have book shop shop. My database contains customers that owe money. I donâ€™t want to delete a customer from the database if they owe money or if they have a book on order. The calculation to determine if money is owed etc is complex so I only wish to run these calculations on delete.<br />Does the CSLA business object have an approach that I can use?<br />My idea would be to create a static method on the client business object that runs my required checks and returns a message when the checks fail. From my windows delete button I would call the static method and only continue to delete if the message is empty, otherwise I would display the message.<br />example:<br />//Business objects static method<br />   public static bool IsDeletable(int contactId, out string message)<br />   {<br />       message = string.Empty;<br /><br />       // Run owes money check <br />       ...<br />       if (failed)<br />       {<br />           message = "Unable to delete as this customer owes you money!";<br />           return false;<br />       }<br />       // Run other check <br />       ...<br />       if (failed)<br />       {<br />           message = "Unable to delete as this customer has books on order";<br />           return false;<br />       }<br />        Code    <br />       return true;<br />   }<br /><br />//Code in window <br />void DeleteButtonPressed(...)<br />{<br />int contactId = ..get the contactId;<br />      string message;<br />     if (ContactBo.IsDeletable(contactId, out message))<br />         ContactBo.Delete(contactId);<br />      else<br />          MessageBox.Show(message, "Unable to delete");<br />}<br /><br />Is there a better way to do this?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Tuesday, August 11, 2009</h2>You can overwrite DataPortal_Update method and provide your own implementation and can perform all the check there..<br /><br />In case of invalid operation (for eg. trying to del customer which owes then you can throw exception).. something like this <br /><br />foreach (MyObj child in DeletedList)<br /><br />                    if (!child.DelAllowed)<br />                    throw new exception("Del not allowed");<br />else<br />                        child.Child_DeleteSelf();<br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, August 11, 2009</h2>Hi, <br><br>Typicially this is a combination of "roles based" authorization and "state" your business objects. <br><br>I would look probably overload CanExecuteMethod and if roles based authorization is required that can easily be applied. <br><br>Example<br>&nbsp;&nbsp;&nbsp; // add roles based authorixzation rules <br>&nbsp;&nbsp;&nbsp; protected override void AddAuthorizationRules()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.AllowExecute(Delete, "ProjectManager");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationRules.DenyExecute("Delete", "Guest");<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public override bool CanExecuteMethod(string methodName)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!base.CanExecuteMethod(methodName)) return false;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (mehodName == "Delete") {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (BypassPropertyChecks()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Execute command to check if customer can be delete <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CustomerOwesMoneyCommand.Execute(new SingleCriteria&lt;Customer, int&gt;(this.CustomerId) return false;<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CustomerHasUnprocessedOrderCommand.Execute(new SingleCriteria&lt;Customer, int&gt;(this.CustomerId) return false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public void DeleteCustomer(int id)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Throws execption if not allowed to delete customer <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanExecuteCommand("Delete", true)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Execute delete <br> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; DataPortal.Delete(new SingleCriteria&lt;Customer, int&gt;(id));<br>&nbsp;&nbsp;&nbsp; }<br><br><br>/jonnybee<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
