<html><header><title>Custom PropertyInfo with mutable values?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Custom PropertyInfo with mutable values?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10082.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane posted on Wednesday, February 16, 2011</h2><p>We have a WinForms project using CSLA 3.0.5 and are finally able to consider supporting technology beyond .NET Framework 2.0. I have been reading about 3.8 (do not have the 2008 book yet) and also 4.0. The idea of managed fields and eliminating string-based property references is very appealing, but we have some roll-your-own customizations that won&#39;t work with managed fields.</p>
<p>Properties are exposed as string, boolean, etc. Internally, the values are passed to custom classes (CSLA-based) for each data type (StringField, IntegerField, etc.). With managed fields, I do not think we can use these &quot;Field&quot; classes.</p>
<p>The field classes are holding original and current values, and have additional properties such as IsRequired, IsReadOnly, MaxLength (for string), Min/Max values (for integers and doubles) and scale/precision values. </p>
<p>IsDirty is overridden to compare old and new values. I have seen how other people have implemented that with managed fields by subclassing PropertyInfo&lt;T&gt;.</p>
<p>These &quot;Field&quot; classes are also exposed through dictionaries and used by custom controls. The custom controls get the appropriate &quot;Field&quot; classes when the datasource changes. The &quot;Field&quot; class is used to configure the control&#39;s behavior, such as disabling the control for read-only properties, showing an indicator for required fields, etc.</p>
<p>I think we can subclass PropertyInfo&lt;T&gt; and FieldInfo&lt;T&gt; to include some of the metadata properties that are not already included. However, the values of these properties are mutable and can change at runtime. For example, when a customer ID is entered on an order entry screen, customer-specific settings may dictate that the shipping method is set to a certain default and cannot be overridden, or they may require that a PO number be entered on the order, or the total order value should be represented in 4 decimals vs 2 decimals.</p>
<p>Because our custom &quot;Field&quot; classes are based on CSLA, the custom controls can observe the PropertyChanged event and update their behavior. This does not appear possible with PropertyInfo or FieldInfo.</p>
<p>One idea I had is to define an event that provides an updated PropertyInfo&lt;T&gt; object. All custom controls would handle that event and respond only if the property name matched.</p>
<p>I am interested in ideas from people who may have tackled this issue already. What might be a good way to push out changes to the controls? </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, February 17, 2011</h2><p>No, you should use PropertyInfo objects for this funtionality. The PropertyInfo objects is a static registered list for all instances of an object type. </p>
<p>I&#39;d rather look at encapsulation this by using more of the &quot;standard&quot; methods in BO&#39;s toslave the UI like: </p>
<p>CanExecuteMethod<br />CanReadProperty<br />CanWriteProperty <br /><br />And use custom rules that cehcks the metadata and property values.</p>
<p>This would enable you to use Csla.Windows.ReadWriteAuthorization and Csla.Xaml.PropertyStatus controls in your WinForm/WPF/SL app.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Thursday, February 17, 2011</h2><p>Thanks, JonnyBee. I presume you meant that we should <b>not</b> use PropertyInfo objects for this purpose. I will continue to look for other alternatives. The CanReadProperty method and authorization rules can take care of the read-only state.</p>
<p>It looks like my core problem is that we have rolled up value state with other metadata. We can move value state into the managed property technique, yet still maintain our other metadata as we are currently doing.</p>
<p>I think I may have also been confused by only skimming Jason Bock&#39;s article about implementing a smarter IsDirty method. I skimmed over the reference to IPropertyInfoFactory and translated it into IPropertyInfo. Now that I have read his article, I realize he is talking about changing internal behavior by using customized FieldData&lt;T&gt; classes. Those are private, so would not be useful for exposing metadata to the UI.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 17, 2011</h2><p>The property info object contains metadata for the property definition or declaration. It can&#39;t store per-instance data.</p>
<p>The field info object contains (at a minimum) the field value for a managed backing field. However, you can extend it to contain other metadata or data.</p>
<p>The field info object is available to your object through the FieldManager.GetFieldData method. This means you can expose the metadata from a field data object out through your business object if you desire.</p>
<p>To do that I would recommend creating a custom base class that implements some standard mechanism by which external code can ask a business object for that metadata - probably some interface that your base class (and therefore all business objects) would implement.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 17, 2011</h2><p>I should point out that this scenario is &quot;supported&quot; in that I <em>envisioned</em> this being done, but to my knowledge no-one has implemented such a solution.</p>
<p>When Jason implemented the alternate IsDirty behavior that was the same thing: envisioned but not implemented. He did find a couple oversights in the CSLA codebase that I had to fix to enable the scenario. </p>
<p>You might find the same thing, but it probably helps to know that this <em>should be possible</em>, so if it isn&#39;t, that&#39;s a bug.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
