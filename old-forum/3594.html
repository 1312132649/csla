<html><header><title>Possible to fetch and update data while inserting?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Possible to fetch and update data while inserting?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3594.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Remoray posted on Wednesday, September 26, 2007</h2><P><FONT face="Courier New" size=2>I have some business logic I would like to execute prior to/while&nbsp;saving a BusinessObject. I tried to to this in the DataPortal_Insert() method.</FONT></P>
<P><FONT face="Courier New" size=2>Unfortunately, because of "[<FONT color=#2b91af>Transactional</FONT>(<FONT color=#2b91af>TransactionalTypes</FONT>.TransactionScope)]" I cannot use any other calls to DataPortal_Fetch(), because these lead to "System.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first."</FONT></P>
<P><FONT face="Courier New" size=2>Is there any other way around this besides using the logic on the server (say e.g. stored procedures)? Plus: I would, of course, wanted the other calls/updates to run in this transaction, too... but these updates are not really child objects of the object I am trying to persist.</FONT></P>
<P><FONT face="Courier New" size=2>TIA,<BR>Remoray</FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 26, 2007</h2>Hi, <br><br>You can read in your DP_I or DP_U, but the same rules apply to datareaders; only one can be open at a time.&nbsp; So you'll have to rework your code around this.&nbsp; You could also use MARS in your connection string, but I'm not sure what other changes that would introduce.&nbsp; MARS = Multiple Active Result Sets.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Remoray replied on Friday, September 28, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Hi, <BR><BR>You can read in your DP_I or DP_U, but the same rules apply to datareaders; only one can be open at a time.&nbsp; So you'll have to rework your code around this.&nbsp; You could also use MARS in your connection string, but I'm not sure what other changes that would introduce.&nbsp; MARS = Multiple Active Result Sets.<BR></div></BLOCKQUOTE></P>
<P>Thank you, I will have to rework the code then... ;-)<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, September 26, 2007</h2>You may try removing [Transactional(TransactionalTypes.TransactionScope)] from the fetch method.&nbsp; It is seldom needed for a fetch.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 26, 2007</h2>I think the means the Transactional is on the DP_I or DP_U.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Friday, September 28, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Remoray:</strong></div><div>
<P><FONT face="Courier New" size=2>I have some business logic I would like to execute prior to/while&nbsp;saving a BusinessObject. I tried to to this in the DataPortal_Insert() method.</FONT></P>
<P><FONT face="Courier New" size=2>Unfortunately, because of "[<FONT color=#2b91af>Transactional</FONT>(<FONT color=#2b91af>TransactionalTypes</FONT>.TransactionScope)]" I cannot use any other calls to DataPortal_Fetch(), because these lead to "System.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first."</FONT></P>
<P><FONT face="Courier New" size=2>Is there any other way around this besides using the logic on the server (say e.g. stored procedures)? Plus: I would, of course, wanted the other calls/updates to run in this transaction, too... but these updates are not really child objects of the object I am trying to persist.</FONT></P>
<P><FONT face="Courier New" size=2>TIA,<BR>Remoray</FONT></P>
<P></div></BLOCKQUOTE></P>
<P>...maybe work on using another method that cascades the connection or transaction so it can be shared but use a new command...</P>
<P>private... DP_Fetch(criteria)<BR>using (connection with transaction conn){<BR>&nbsp;&nbsp;&nbsp; using(command cmd){<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // to&nbsp;stuff<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doMoreStuff(conn);<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
