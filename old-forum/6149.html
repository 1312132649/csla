<html><header><title>Problems with CodeSmith C# Template</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problems with CodeSmith C# Template</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6149.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rizshe posted on Wednesday, January 14, 2009</h2>Hi, <br />I'm working with CSLA2.0 for sometime. <br />In a recent project we tried to use CodeSmith to generate C# templates and I'm having problems.<br />Maybe its my understanding OR my lack of knowledge, either way I need some serious help.<br /><br />This is the actual code which I wrote a while back.<br /><br />namespace BDD.MyImpact.Library.BO<br />{<br />    using System;<br />    using System.Collections.Generic;<br />    using System.Text;<br />    using System.Data;<br />    using System.Data.SqlClient;<br />    using Csla;<br />    using Csla.Data;<br />    using BDD.MyImpact.Library.Data;<br /><br />    /// <br />    /// Readonlylist of a Person Publications<br />    /// <br />    [Serializable]<br />    public class PersonPublicationList : ReadOnlyList<br />    {<br />        String _user = String.Empty;<br />        public String User<br />        {<br />            get<br />            {<br />                return this._user;<br />            }<br />        }<br /><br />        #region Factory Methods<br />        private PersonPublicationList()<br />        {<br /><br />        }<br /><br />        public static PersonPublicationList GetPublicationList(String user)<br />        {<br />            return DataPortal.Fetch(new Criteria(user));<br />        }<br />        #endregion<br /><br />        #region Criteria<br />        [Serializable()]<br />        private class Criteria<br />        {<br />            private String _user;<br /><br />            public String User<br />            {<br />                get<br />                {<br />                    return this._user;<br />                }<br />            }<br /><br />            public Criteria(String login)<br />            {<br />                this._user = login;<br />            }<br /><br />        }<br /><br />        #endregion<br /><br />        #region Data Access<br /><br />        private void DataPortal_Fetch(Criteria criteria)<br />        {<br />            using (SqlConnection cn = new SqlConnection(Database.MyImpactConnection))<br />            {<br />                cn.Open();<br />                using (SqlCommand cm = cn.CreateCommand())<br />                {<br />                    cm.CommandType = CommandType.StoredProcedure;<br />                    cm.CommandText = "miapp.pc_get_PersonPublicationList";<br />                    cm.Parameters.AddWithValue("@user", criteria.User);<br />                    using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<br />                    {<br />                        IsReadOnly = false;<br />                        while (dr.Read())<br />                        {<br />                            PublicationInfo info = new PublicationInfo(dr.GetInt32("pub_id"),<br />                                                                      dr.GetString("Title").ToString(),<br />                                                                      dr.GetInt16("Year"),<br />                                                                      dr.GetString("web_html"),<br />                                                                      dr.GetString("journal"));<br />                            this.Add(info);<br /><br />                        }<br />                        IsReadOnly = true;<br />                    }<br />                }<br />            }<br /><br />        }<br />        #endregion<br />    }<br />}<br />---------------------------------------<br />I already have a child object for this class which is already in use by another parent class that is why I don't want to generate the child.<br /><br />---------------------------------------------<br />I tried to do SplitPartial but disregard it after I find it a bit rigid in terms of modification as I regarded the generated classes not to be touched and user classes are the ones to be modifiable.<br />I then sort of go towards the SplitBase as I can easily override the methods but here again I'm having problems.<br />Here is the code the XML template above generated.<br /><br />using System;<br />using System.Data;<br />using System.Data.SqlClient;<br />using Csla;<br />using Csla.Data;<br />using BDD.MyImpact.Library.Data;<br /><br />namespace BDD.MyImpact.Library.BO<br />{ <br />	[Serializable()] <br />	public abstract class PersonPublicationListBase : Csla.ReadOnlyListBase<br />		where T : PersonPublicationListBase<br />		where C : PublicationInfoBase<br />	{<br /><br />		#region Factory Methods<br />		public static T GetPersonPublicationList()<br />		{<br />			return DataPortal.Fetch(new FilterCriteria());<br />		}<br />		#endregion //Factory Methods<br /><br />		#region Data Access<br /><br />		#region Filter Criteria<br />		[Serializable()]<br />		protected class FilterCriteria : Csla.CriteriaBase<br />		{<br /><br />			public FilterCriteria() : base(typeof(T))<br />			{<br /><br />			}<br />		}<br />		#endregion //Filter Criteria<br /><br />		#region Data Access - Fetch<br />		[Transactional(TransactionalTypes.TransactionScope)] <br />		private void DataPortal_Fetch(FilterCriteria criteria)<br />		{<br />			RaiseListChangedEvents = false;<br />			IsReadOnly = false;<br /><br />			using (SqlConnection cn = new SqlConnection(Database.MyImpactConnection))<br />			{<br />				cn.Open();<br /><br />				ExecuteFetch(cn, criteria);<br />			}//using<br /><br />			IsReadOnly = true;<br />			RaiseListChangedEvents = true;<br />		}<br /><br />		protected virtual void ExecuteFetch(SqlConnection cn, FilterCriteria criteria)<br />		{<br />			using (SqlCommand cm = cn.CreateCommand())<br />			{<br />				cm.CommandType = CommandType.StoredProcedure;<br />				cm.CommandText = "pc_get_PersonPublicationList";<br /><br /><br />				using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<br />				{<br />					while (dr.Read())<br />						this.Add(PublicationInfoBase.GetPublicationInfo(dr));<br />				}<br />			}//using<br />		}<br />		#endregion //Data Access - Fetch<br />		#endregion //Data Access<br />	}<br />}<br /><br />------------------------------------<br />Now If you take a look at the code which I wrote and the code which is generated there are differences and I couldn't find a way to sort of get rid of those differences which is essential to let me work?<br />Any ideas?<br /><br />Thanks</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Rizshe replied on Friday, January 16, 2009</h2>Isn't there anyone who explain as all I need is an explanation :)<br /><br />Regards,<br />Rizwan</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Wednesday, January 21, 2009</h2>Hello,<br><br>To make the changes in the generated code you would need to open up the CodeSmith Template in CodeSmith Studio or notepad and make the changes and regenerate. For the current CodeSmith CSLA templates, I would log all bugs on the <a href="http://www.codeplex.com/CSLAcontrib">CSLA CodePlex Site</a>.<br><br>Just a heads up that we are currently creating new CSLA 3.6.x templates for CodeSmith. If you have any suggestions please let me know.<br><br>Thanks<br>-Blake Niemyjski</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gort replied on Thursday, February 25, 2010</h2><p>Blake-</p>
<p>I have grabbed your templates from the nightly build and am attempting to use them.&nbsp; What I am not seeing is the child properties being created for an object.&nbsp; For example, I have a &#39;Patient&#39; table and am creating a ReadOnlyRoot for it.&nbsp; The Patient table has a couple of tables that have PatientId as their foreign key and are set up to be 1 to many with Patient.&nbsp; So, a Patient can have several addresses, i.e. PatientAddress.&nbsp; But, the PatientAddress property is not getting created in my PatientInfo class.&nbsp; Should it?</p>
<p>Tks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Thursday, February 25, 2010</h2><p>
<p>Hello,</p>
<p>Currently read only stereo types do not have any child properties generated. I wasn&#39;t sure if this was standard practice or not. My thoughts were that read only stereo types were usually used one deep. What are your thoughts on this?</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
<div></div>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jamie.clayton replied on Thursday, February 25, 2010</h2><p>Gort,</p>
<p>I&#39;m working with the nightly builds of Codesmiths CSLA.&nbsp; I must admit to have only generated one readonly list at this stage and had to do some manual code changes to the generated output to make it compile. </p>
<p>When I get to migrating my existing Readonly CSLA objects to the new Codesmith templates I&#39;ll report any errors to <a title="Codemith Template Issues" href="http://code.google.com/p/codesmith/issues/list">http://code.google.com/p/codesmith/issues/list</a>. Blake and Codesmith have been outstanding at template changes to fix issues identified.</p>
<p>From a design perspective I&#39;ve only ever design parent readonly lists and readonly child items, so I can populate combo boxes or search lists.&nbsp; I&#39;m assuming your suggesting that the Codesmith templates should also generate Grandchildren + any other database relationships when you create a readonly stereotype via codesmiths templates. Is that what you are suggesting?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Tuesday, August 03, 2010</h2><p>
<p>Hello,</p>
<p>If you are interested in upgrading to CSLA 3.8 or CSLA 4.0. We now have a solid set of templates located <a href="http://www.codesmithtools.com/generate-csla-code-with-templates.aspx">here</a>. We also have unit tests for all the collections and&nbsp;child&#39;s&nbsp;that can be downloaded <a href="http://community.codesmithtools.com/Product_Updates/b/csla_releases/archive/2010/07/24/csla-3-0-0.aspx">here</a>. They are a great learning resource and go great with Rocky&#39;s Videos!</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Sunday, August 29, 2010</h2><p>Blake,</p>
<p>The 3.8 templates are great news.&nbsp; In fact, they are finally motivating me to adopt CodeSmith, so I&#39;ll be getting in the next couple of days and taking a much closer look at your admirable work here.</p>
<p>One quick question.&nbsp; I saw a blog entry you offered very recently about using the IS_GENERIC SQL Extended Proprty.&nbsp; I&#39;m like most developers and can&#39;t control all aspects of the databases with which my programs operate.&nbsp; I&#39;ll be lucky to get the DBAs to let me have my own Extended Properties at all.&nbsp; But I sure won&#39;t be able to name them anything like IS_GENERIC.&nbsp; (They have naming conventions for other db objects I&#39;m allowed to create and I&#39;m pretty sure I&#39;ll have to follow them here, too).</p>
<p>So, finally getting to the question &lt;g&gt;, is it a fairly simple matter for me to alter the template(s) to trigger off an Extended Property with a name of my own choosing, rather than IS_GENERIC&nbsp;to accomplish the same rendering goal?</p>
<p>Thanks for all your work.&nbsp; I look forward to diving into it </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Sunday, August 29, 2010</h2><p>
<p>Hello,</p>
<p>It is an extended property that has nothing to do with the data or the table names. What naming convention will they follow? We will be releasing a new version of the templates very soon. Yeah this would be an easy change. I don&#39;t think it is currently configurable in configuration (which I&#39;ll make sure it is moved there <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" />. But it would be a replace a line of code quick change.&nbsp;</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Monday, August 30, 2010</h2><p>The naming convention they use is to prefixe ANY name you want to use with &quot;sip&quot; (for a now-defunct program they had with their third party developers called &quot;system integrator partners&quot;.&nbsp; Then, for our own self preservation, we in the 3rd party also add our own company abbreviation to the &quot;actual&quot; name.&nbsp; Some put theirs at the end, I like to put ours at the beginning.&nbsp; Since our company name is TeamNFP, we call our sProc to get employee data sip_tnfp_getEmployee, for example.</p>
<p>This doesn&#39;t&nbsp;seem like something you should try and cater to with your new release.&nbsp; But if you could make it configurable, that would be super.&nbsp; Then I wouldn&#39;t even have to rely on that company respecting the Extended Properties I create when they perform the programatic updates to their databases with each version release.&nbsp; They&#39;re kind enough to bring along the tables and views and sProcs that start with &#39;sip&#39; when they are doing their own.&nbsp; But I don&#39;t have a committment from them yet on Extended Properties.</p>
<p>The change of the line of code looks like fine control to me.&nbsp; And couldn&#39;t I just configure it as a template Property and then change the code in the template to look for that instead of the extended property?&nbsp; That might be easiest of all.&nbsp; Then you don&#39;t really have to do anything.&nbsp; But before I go recommending much in the way of support, I better get a good feel for the scope of those Property values in templates and projects and where that generic tooling will be useful (e.g., will it by good for use on parent objects but not children?).&nbsp; If I get a strong feeling about it after studying your tutorials and the CSLA templates and sub-templates, you&#39;ll hear back from me.</p>
<p>Thanks for the reply,</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Monday, August 30, 2010</h2><p>
<p>Hello,</p>
<p>I&#39;d like to get the configuration to the point where its just driven from an app.config. I wouldn&#39;t change the templates for this as it is one place in code where this is checked and its a property in code not in the template itself. </p>
<p>Too be honest with you, I haven&#39;t used the Generic Property, just added it into the templates as it was a patch and I asked a few CSLA users if they would find it useful and they said yes. If you find any bugs with it, please let me know (we have an issue tracker located <a href="http://code.google.com/p/codesmith/issues/list">here</a>).</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jamie.clayton replied on Thursday, February 25, 2010</h2><p>Rizshe,</p>
<p>I&#39;m using the latest nightly build of Codemiths CSLA templates and have this working. </p>
<p>If you are using the Entities.cst and the resulting Entity.csp file in Visual Studio you need to do the following.</p>
<ol>
<li>Right click on the Entity.csp file in Visual Studio.</li>
<li>Select Manage menu option.</li>
<li>Goto 1.Data Source</li>
<li>Edit the &quot;IgnoreExpression&quot; list.</li>
<li>Add all the related tables you want &quot;ignored&quot; or skipped when generating the templates. Codesmiths templates will then not generate the properties relationships&nbsp; for those tables you defined in IgnoreExpression.</li>
</ol>
<p>I&#39;ve found I create a series of entries in the Entity.csp Codesmith project file pointing to the Entity.cst template and use these options so codesmith generates my CSLA business objects to suit my requirements.&nbsp; Often the Codesmith templates are too aggressive creating the relationships, especially in highly normalized databases (which isn&#39;t codesmiths templates fault, more the database relationships your working with).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>daisyfreya123 replied on Monday, August 30, 2010</h2><p>I&#39;ll try the code very soon and reply you with some new content.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>daisyfreya123 replied on Monday, August 30, 2010</h2><p>I&#39;ll will try the code provided by you and reply you soon.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
