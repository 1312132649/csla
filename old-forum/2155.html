<html><header><title>Button events not being raised after PropertyHasChanged</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Button events not being raised after PropertyHasChanged</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2155.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>C_J posted on Wednesday, January 17, 2007</h2><P>I am using CLSA 2.0.3 WinForm 2.0.</P>
<P>I have a Save button on a form that is wired to a saveButton_Click event. This event&nbsp;gets periodically raised after an object property has changed. e.g If I update the&nbsp;FirstName textbox in the UI then&nbsp;click the Save button&nbsp;the objects FirstName property setter gets&nbsp;executed and raises the PropertyHasChanged method. However, the button click event will&nbsp;sometimes get raised and won't other times (I cannot find a pattern to the&nbsp;raising of the button click event).</P>
<P>If I modify the FirstName textbox in the UI and then tab out of the textbox and then click the Save button everything works fine. As long as the setting of the property and clicking of the button are not in the same action then all is fine.</P>
<P>Can anyone help?</P>
<P>I do re-populate the Binding Controls datasource as shown below&nbsp;with a Get otherwise the objects&nbsp;ModifiedDate property doesn't get updated and throws an exception statiing that another user is editing the object.</P><FONT color=#0000ff size=2>
<P>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> SaveSubmission(</FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> rebind)<BR>{<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;this</FONT><FONT size=2>.submissionBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;<BR></FONT><FONT color=#008080 size=2>&nbsp;&nbsp;&nbsp;Submission</FONT><FONT size=2> temp = submission.Clone();<BR><BR>&nbsp;&nbsp;&nbsp;temp.ApplyEdit();</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;try<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;submission = temp.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;submission.BeginEdit();</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (rebind)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>&nbsp;//rebind the UI<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.submissionBindingSource.DataSource = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;//re-populate datasource so modified date is updated.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.submissionBindingSource.DataSource = </FONT><FONT color=#008080 size=2>Submission</FONT><FONT size=2>.GetSubmission(submission.SubmissionId);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//not updated when re-populated&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>&nbsp;&nbsp;&nbsp;submissionIdTextEdit.Text = submission.SubmissionId.ToString();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApplyAuthorizationRules();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2></FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (Csla.</FONT><FONT color=#008080 size=2>DataPortalException</FONT><FONT size=2> ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</FONT><FONT size=2>}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>Exception</FONT><FONT size=2> ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</FONT><FONT size=2>}<BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.submissionBindingSource.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2><FONT color=#0000ff size=2>this</FONT><FONT color=#000000 size=2>.submissionBindingSource.ResetBindings(</FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2><FONT color=#000000>);<BR>&nbsp;&nbsp;&nbsp;</FONT></FONT></FONT><FONT size=2>}<BR></FONT><FONT size=2>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Wednesday, January 17, 2007</h2><P>Hi CJ</P>
<P>That does seem a little weird (actually, a lot!), and I don't know what is wrong, but just looking at your code, you will have no idea if any exceptions are being thrown during the save as both of your catch blocks are empty, so the save could be failing and you'd have no idea. </P>
<P>At least put something in there, even a Debug.WriteLine to let you know what is going on.</P>
<P>Just my 2 cents...</P>
<P>Craig</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>C_J replied on Wednesday, January 17, 2007</h2><P>Hi Craig</P>
<P>I do have exception code in my catch blocks, I just didn't include it in the post for verbose reasons. <BR><BR>To add a little more complexity&nbsp;to the problem. It seems to&nbsp;raise the button click event&nbsp;consistently after property change&nbsp;has occurred <STRONG>and</STRONG> it is the first time the button is clicked. From then on it is hit and miss.</P>
<P>If no property change has occured it is called every time. It is also called everytime&nbsp;if I tab out of the UI control so the property setter is called, and then I click the Save button.</P>
<P>CJ</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>C_J replied on Wednesday, January 17, 2007</h2><P>Ok..here is some more, vey weird effects.</P>
<P>The problem I am describing only seems to occur when I have a break point set on the object property setter method and a breakpoint on the click event. If I remove the breakpoint on the objects property setter method then it hits the buttons click event every time. I have tested this on two computers using 2.0.3 and 2.1.1 using two different projects. </P>
<P>If someone else can test this out and let me know if this occurs and why it occurs it would be greatly appreciated. Is it me, VS2005, CSLA ??</P>
<P>On to&nbsp;another point...I have noticed that when calling&nbsp;the Save&nbsp;method you need to pass in a rebind bool value of true if you want&nbsp;to update the forms data&nbsp;twice or more without navigating away.&nbsp;If&nbsp;you pass in a value of false&nbsp;and&nbsp;make a change to the forms data (twice) and call&nbsp;the&nbsp;Save method, the second time the BusinessBase&nbsp;IsDirty flag&nbsp;always returns false and never persists the data back to the database. Looking at the code I cannot see how setting the rebind variable to true has anything to do with persisting&nbsp;the data back to the database.&nbsp;I can only see that it is used to rebind the object to the&nbsp;bindingsource object.</P>
<P>Can someone please explain why setting the bool value rebind when calling the Save method forces the BusinessBase IsDirty flag to return the correct result?</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> SaveEmployee(</FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> rebind)<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// do the save<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.EndEdit();<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>try<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2>Employee</FONT><FONT size=2> temp = employee.Clone();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;employee = temp.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (rebind)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// rebind the UI<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.DataSource = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.DataSource = employee;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (Csla.</FONT><FONT color=#2b91af size=2>DataPortalException</FONT><FONT size=2> ex)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2>MessageBox</FONT><FONT size=2>.Show(ex.BusinessException.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#a31515 size=2>"Error saving"</FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2>MessageBoxButtons</FONT><FONT size=2>.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2>MessageBoxIcon</FONT><FONT size=2>.Exclamation);<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>Exception</FONT><FONT size=2> ex)<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2>MessageBox</FONT><FONT size=2>.Show(ex.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#a31515 size=2>"Error Saving"</FONT><FONT size=2>, </FONT><FONT color=#2b91af size=2>MessageBoxButtons</FONT><FONT size=2>.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2>MessageBoxIcon</FONT><FONT size=2>.Exclamation);<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>finally<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.bindingSource1.ResetBindings(</FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;}<BR>}</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
