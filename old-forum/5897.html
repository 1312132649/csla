<html><header><title>Problem about saving properties</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem about saving properties</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5897.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tian'en Gu posted on Friday, November 28, 2008</h2><P><FONT size=1>Hi Rockford and other brothers,<BR>i have problem about saving properties.<BR>Several monthes ago i use CSLA 3.0.4 to create a business class, I write the following code in DataPortal_Insert:</FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecipeEntity recipeEntity = new RecipeEntity();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.RecipeGUID = this._recipeGUID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.Id = this._iD;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.Name = this._name;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this._modifiedBy = ApplicationContext.User.Identity.Name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.ModifiedBy = this._modifiedBy;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new RecipeDAL().Add(recipeEntity);</FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UpdateChildren();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld();</FONT></P>
<P><FONT size=1>and i wrote the following to invoke DataPortal_Insert:<BR>&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Recipe RecipeNew = Recipe.NewRecipe();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecipeNew.ID = 38;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecipeNew.Name = "Tax";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecipeNew.Save();&nbsp; <BR>I used to assign value to property '_modifiedBy' in method DataPortal_Insert, and after saving the object RecipeNew can get the value of </FONT><FONT size=1>'_modifiedBy', and i dont need to use the return value of RecipeNew.Save(), because i debug into the source code and find in BusinessBase.Save</FONT><FONT size=1>() that the method pass 'this' into Client.DataPortal.Update(), and the porperty value of 'this' can be changed and saved after invoking Save</FONT><FONT size=1>(), right?</FONT></P>
<P><FONT size=1>Now I want to use CSLA 3.5.2 to update the original code, and i dont want to change the code invoke DataPortal_Insert, i just use the new </FONT><FONT size=1>LoadProperty and ReadProperty features to make the business code more simple:</FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecipeEntity recipeEntity = new RecipeEntity();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.RecipeGUID = ReadProperty&lt;Guid&gt;(RecipeGUIDProperty);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.Id = ReadProperty&lt;int&gt;(IDProperty);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recipeEntity.Name = ReadProperty&lt;string&gt;(NameProperty);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.ModifiedBy = ApplicationContext.User.Identity.Name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this line: problem<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;recipeEntity.ModifiedBy = ReadProperty&lt;string&gt;(ModifiedByProperty);</FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;new RecipeDAL().Add(recipeEntity);</FONT></P>
<P><FONT size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UpdateChildren();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld();</FONT></P>
<P><FONT size=1>But this time after invoking DataPortal_Insert(), I found the outside object RecipeNew can not keep the value of 'ModifiedByProperty', i also debug in the source code but not found any strange places ('this' is passed into Client.DataPortal.Update as usual), I get confused. I know&nbsp;I can assign the value outside DataPortal_Insert but this is a big project and should try to avoid modifying the code which invoke the BLL, or i will spend plenty of time on it and need to pay much attention on testing work. </FONT></P>
<P><FONT size=1>So are there any ideas to 'save' me successfully this time?&nbsp; Any help are appreciated.</FONT></P>
<P><FONT size=1></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Friday, November 28, 2008</h2><P>Just a thought. Is your ModifiedBy definition for correct? E.g. in the get/set you are not setting the value to the wrong property?</P>
<P>Also, I would recommend instead of:</P>
<P><FONT size=1>this.ModifiedBy = ApplicationContext.User.Identity.Name;</FONT></P>
<P>to do this:</P>
<P><FONT size=1>LoadProperty(ModifiedByProperty, ApplicationContext.User.Identity.Name);</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, November 29, 2008</h2><P>This code is almost always wrong:</P>
<P><FONT size=1>RecipeNew.Save();&nbsp; </FONT><BR></P>
<P>It should almost always be:</P>
<P><FONT size=1>myBo = RecipeNew.Save();&nbsp; </FONT><BR></P>
<P>About the only time you can "just call .Save"&nbsp; is if you immediately discard the BO and close the screen. There was a change in the way CSLA handles this code from 3.0 to 3.5 and later so that old code will now break - because it was mistaken code anyway. Rocky is now forcing the issue after giving warning about it in 3.0.</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
