<html><header><title>Handling variable connection strings</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Handling variable connection strings</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1224.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mikeclimbs posted on Friday, September 15, 2006</h2><P>I'm using CSLA 2.1.</P>
<P>I have an app that will be deployed at multipe sites and&nbsp;users will be able to add multiple databases.&nbsp; I already have a method for users to select their databases and to create connection strings&nbsp;based on their selections.</P>
<P>What is the best way to pass&nbsp;the connection string from the UI to the BO's.&nbsp; I was thinking of setting the app.config based on there selection like the project tracker example.&nbsp; Using app.config is problemmatic for development since soure control keeps setting it read only.</P>
<P>I'm hoping there is a better way.</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fabio replied on Friday, September 15, 2006</h2>I think you can use LocalContext..<br>See the "change log" of 2.1..:<br>"<b>Csla – ApplicationContext.LocalContext<o:p></o:p></b>
<p class="MsoNormal">Add a <span class="CodeInline"><span><font color="#008000" face="Courier New">LocalContext</font></span></span> property to <span class="CodeInline"><span><font color="#008000" face="Courier New">Csla.ApplicationContext</font></span></span>. <span class="CodeInline"><span><font color="#008000" face="Courier New">LocalContext</font></span></span> works like <span class="CodeInline"><span><font color="#008000" face="Courier New">ClientContext</font></span></span> and <span class="CodeInline"><span><font color="#008000" face="Courier New">GlobalContext</font></span></span>, but it does not get moved across the network by the data portal. This means that both the client and server have a <span class="CodeInline"><span><font color="#008000" face="Courier New">LocalContext</font></span></span> that is truly local to each location. <span class="CodeInline"><span><font color="#008000" face="Courier New">LocalContext</font></span></span> exists at the thread or <span class="CodeInline"><span><font color="#008000" face="Courier New">HttpContext</font></span></span> level and so is local to a user’s session on a server.</p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal">You can envision using <span class="CodeInline"><span><font color="#008000" face="Courier New">LocalContext</font></span></span>
to globally transfer objects such as database connections or ADO.NET
transaction objects throughout an entire data access session on a
server. I’m sure other uses may be found as well, but this one is a key
motivator for the addition of the functionality."<br></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 15, 2006</h2>Not LocalContext - that doesn't flow from client to server.<br><br>But ClientContext should work - that flows from client to server, and so is a good way to get client-side context data (like which database the user wants) to the server along with every data portal call.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kids_pro replied on Monday, December 04, 2006</h2>Dear Rocky,<br><br>I am using Csla 2.0.3<br>In the login code I load some properties from the database upon successful login.<br>.... some code here ....<br>&nbsp;&nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new SafeDataReader(cmd.ExecuteReader())) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (dr.Read()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _uniqueid = dr.GetGuid("UserID");<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _name = dr.GetString("Firstname") + ", " + dr.GetString("Lastname");<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.ClientContext["ProvGIS"] = dr.GetInt32("ProvGIS");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.ClientContext["lang"] = dr.GetString("Lang");<br><br>.... some code here ....<br><br>I watch the value of the Csla.ApplicationContext.ClientContext["lang"] it return the value from the database - so far so good. Then I create a Utilities.cs with Language properties<br><br>namespace PID.BusinessObject {<br>&nbsp;&nbsp;&nbsp; public static class Utilities {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static string Language {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string lang;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lang = (string)Csla.ApplicationContext.ClientContext["lang"];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch { lang = "EN"; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return lang;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>in my ContractInfo.cs<br>I got an exception: Object reference not set to an instance of an object.<br>if(Utilities.Language.Equals("EN")){<br>&nbsp;&nbsp;&nbsp;&nbsp; ..... read English fields ...<br>}<br><br>And the stack trace:<br><font face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif "><pre>[NullReferenceException: Object reference not set to an instance of an object.]<br>   PID.BusinessObject.Contract.ReadOnly.ContractInfo.Fetch(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractInfo.cs:180<br>   PID.BusinessObject.Contract.ReadOnly.ContractInfo..ctor(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractInfo.cs:127<br>   PID.BusinessObject.Contract.ReadOnly.ContractInfo.GetContractInfo(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractInfo.cs:120<br>   PID.BusinessObject.Contract.ReadOnly.ContractList.DataPortal_Fetch(Criteria criteria) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractList.cs:114<br><br>[CallMethodException: DataPortal_Fetch method call failed]<br>   Csla.MethodCaller.CallMethod(Object obj, MethodInfo info, Object[] parameters) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\MethodCaller.cs:68<br>   Csla.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\MethodCaller.cs:49<br>   Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Server\SimpleDataPortal.cs:102<br><br>[DataPortalException: DataPortal.Fetch failed]<br>   Csla.DataPortal.Fetch(Type objectType, Object criteria) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Client\DataPortal.cs:191<br>   Csla.DataPortal.Fetch(Object criteria) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Client\DataPortal.cs:138<br>   PID.BusinessObject.Contract.ReadOnly.ContractList.GetContractList(Int32 giscode, Int32 budgetyear) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractList.cs:47<br>   RILGP_Payment.ddlCommune_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:103<br>   RILGP_Payment.ddlDistrict_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:89<br>   RILGP_Payment.ddlProvince_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:74<br>   RILGP_Payment.ddlBYear_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:59<br>   RILGP_Payment.Page_Load(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:31<br>   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +15<br>   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +34<br>   System.Web.UI.Control.OnLoad(EventArgs e) +99<br>   System.Web.UI.Control.LoadRecursive() +47<br>   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1061</pre></font><br>But I do not get this error if I running in WinApp mode.<br>This only happen in WebApp and after I authenticate myself only, if I don't authenticate everything work just fine.<br><br>For your information here is my Logout() code:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void Logout() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PIDIdentity identity = PIDIdentity.UnauthenticatedIdentity();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PIDPrincipal principal = new PIDPrincipal(identity);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* set default language */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.ClientContext["lang"] = "EN";<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* set default province */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.ClientContext["ProvGIS"] = 1000;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.User = principal;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><font face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif "><pre>Any idea why I got this <font face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif ">System.NullReferenceException</font></pre></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 04, 2006</h2>You should probably upgrade to 2.1.1, because there are bug fixes from 2.0.3 to 2.1.1.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, December 04, 2006</h2>




<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>You do realize that ClientContext DOES NOT get returned 
from server to client right? This is discussed in Chapter 4 - read the section 
covering GlobalContext and ClientContext for details.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>In your description you say you watch ClientContext["lang"] 
get set from the database. Is this on the server? If so, that value is most 
certainly NOT returned to the client, and so of course you'd get a null 
reference exception on the client when trying to access this 
item.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>Solutions:</FONT></SPAN></DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>You can get your values via a ReadOnlyBase-derived object 
and THEN set them into the ClientContext (on the client). The value will then 
become global to both client and server, because ClientContext flows from client 
to server on each call.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>Or you can put the values into GlobalContext, and then 
they'll flow back and forth between client and server on every data portal 
call.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=689532615-04122006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV><BR>
<BLOCKQUOTE>
  <DIV class=OutlookMessageHeader align=left>
  <HR>
  <FONT face=Tahoma size=2><B>From:</B> kids_pro [mailto:cslanet@lhotka.net] 
  <BR><B>Sent:</B> Monday, December 04, 2006 7:07 AM<BR><B>To:</B> 
  rocky@lhotka.net<BR><B>Subject:</B> Re: [CSLA .NET] Handling variable 
  connection strings<BR></FONT><BR></DIV>
  <DIV></DIV>Dear Rocky,<BR><BR>I am using Csla 2.0.3<BR>In the login code I 
  load some properties from the database upon successful login.<BR>.... some 
  code here ....<BR>&nbsp;&nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new 
  SafeDataReader(cmd.ExecuteReader())) 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if 
  (dr.Read()) 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  _uniqueid = dr.GetGuid("UserID");<BR>&nbsp;&nbsp; 
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  _name = dr.GetString("Firstname") + ", " + 
  dr.GetString("Lastname");<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  Csla.ApplicationContext.ClientContext["ProvGIS"] = 
  dr.GetInt32("ProvGIS");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  Csla.ApplicationContext.ClientContext["lang" ] = 
  dr.GetString("Lang");<BR><BR>.... some code here ....<BR><BR>I watch the value 
  of the Csla.ApplicationContext.ClientContext["lang"] it return the value from 
  the database - so far so good. Then I create a Utilities.cs with Language 
  properties<BR><BR>namespace PID.BusinessObject {<BR>&nbsp;&nbsp;&nbsp; public 
  static class Utilities {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public 
  static string Language 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  string 
  lang;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  try 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  lang = 
  (string)Csla.ApplicationContext.ClientContext["lang"];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  } catch { lang = "EN"; 
  }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  return 
  lang;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; 
  }<BR>}<BR><BR>in my ContractInfo.cs<BR>I got an exception: Object reference 
  not set to an instance of an 
  object.<BR>if(Utilities.Language.Equals("EN")){<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
  ..... read English fields ...<BR>}<BR><BR>And the stack trace:<BR><FONT face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif "><PRE>[NullReferenceException: Object reference not set to an instance of an object.]<BR>   PID.BusinessObject.Contract.ReadOnly.ContractInfo.Fetch(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractInfo.cs:180<BR>   PID.BusinessObject.Contract.ReadOnly.ContractInfo..ctor(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.Busi
 nessObject\Contract\ReadOnly\ContractInfo.cs:127<BR>   PID.BusinessObject.Contract.ReadOnly.ContractInfo.GetContractInfo(SafeDataReader dr) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractInfo.cs:120<BR>   PID.BusinessObject.Contract.ReadOnly.ContractList.DataPortal_Fetch(Criteria criteria) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractList.cs:114<BR><BR>[CallMethodException: DataPortal_Fetch method call failed]<BR>   Csla.MethodCaller.CallMethod(Object obj, MethodInfo info, Object[] parameters) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\MethodCaller.cs:68<BR>   Csla.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\MethodCaller.cs:49<BR>   Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Server\SimpleDataPortal.cs:
 102<BR><BR>[DataPortalException: DataPortal.Fetch failed]<BR>   Csla.DataPortal.Fetch(Type objectType, Object criteria) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Client\DataPortal.cs:191<BR>   Csla.DataPortal.Fetch(Object criteria) in D:\CSLA.NET 2.0.3\csla20cs\Csla\DataPortal\Client\DataPortal.cs:138<BR>   PID.BusinessObject.Contract.ReadOnly.ContractList.GetContractList(Int32 giscode, Int32 budgetyear) in D:\Documents\Visual Studio 2005\Projects\PID2007\PID.BusinessObject\Contract\ReadOnly\ContractList.cs:47<BR>   RILGP_Payment.ddlCommune_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:103<BR>   RILGP_Payment.ddlDistrict_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:89<BR>   RILGP_Payment.ddlProvince_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:7
 4<BR>   RILGP_Payment.ddlBYear_SelectedIndexChanged(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:59<BR>   RILGP_Payment.Page_Load(Object sender, EventArgs e) in d:\Documents\Visual Studio 2005\WebSites\PIDWeb\RILGP\Payment.aspx.cs:31<BR>   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +15<BR>   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +34<BR>   System.Web.UI.Control.OnLoad(EventArgs e) +99<BR>   System.Web.UI.Control.LoadRecursive() +47<BR>   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1061</PRE></FONT><BR>But 
  I do not get this error if I running in WinApp mode.<BR>This only happen in 
  WebApp and after I authenticate myself only, if I don't authenticate 
  everything work just fine.<BR><BR>For your information here is my Logout() 
  code:<BR><BR>&nbsp;&nbsp;&nbsp;&amp;n bsp;&nbsp;&nbsp;&nbsp; public static 
  void Logout() 
  {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  PIDIdentity identity = 
  PIDIdentity.UnauthenticatedIdentity();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  PIDPrincipal principal = new 
  PIDPrincipal(identity);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  /* set default language 
  */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  Csla.ApplicationContext.ClientContext["lang"] = 
  "EN";<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  /* set default province 
  */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  Csla.ApplicationContext.ClientContext["ProvGIS"] = 
  1000;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
  Csla.ApplicationContext.User = 
  principal;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR><FONT face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif&#13;&#10;  "><PRE>Any idea why I got this <FONT face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif ">System.NullReferenceException</FONT></PRE></FONT><BR><BR><BR></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kids_pro replied on Monday, December 04, 2006</h2>Dear Rocky,<br><br>Yes, after review the chapter I realized that I should use GlobalContext.<br>However after login even GlobalContext become null reference even I set it value in the PIDIDentity.cs <br>To make it works I need to reset it value in Global.asa<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (principal == null) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID.BusinessObject.Security.PIDPrincipal.Logout();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.User = principal;<br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.GlobalContext["Language"] = "KH";</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mikeclimbs replied on Friday, September 15, 2006</h2><P>Thanks,</P>
<P>I'll take a look and let you know my results.</P>
<P>Mike</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
