<html><header><title>Different Validation Rules Based on Action</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Different Validation Rules Based on Action</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3680.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mcwb25 posted on Tuesday, October 09, 2007</h2><P>I am relatively new to CSLA, so forgive my ignorance.&nbsp; My question deals with needing different validation rules depending what database action I am performing, update, insert, or delete.</P>
<P>Lets say I have a business class for a User.&nbsp;&nbsp; The user has different properties such as user ID, first name, last name, etc.</P>
<P>I have Validation Rules that apply in all cases.&nbsp; For example, user ID is always required regardless of insert, update, or delete.&nbsp;&nbsp; However, what if I wanted to do a check on whether the user ID already exists in the database?&nbsp;&nbsp; On insert, I would want this to make the object invalid, however, on update, is should be valid.&nbsp; The way I understand the process now, this validation rule would react the same way in both cases.&nbsp;&nbsp; Is there an existing&nbsp;way to customize the validation rules to to accomodate for this?</P>
<P>Thanks,</P>
<P>Barry</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 09, 2007</h2><P>Here is how I code that:</P>
<P>In a BO:</P><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>Region</FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2>" Validation Rules "</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> AddBusinessRules()<BR>&nbsp; </FONT><FONT size=2>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> RecordDoesNotExist, </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> RecordExistsRuleArgs(</FONT><FONT color=#ff00ff size=2>"Acctcode"</FONT><FONT size=2>, </FONT><FONT color=#ff00ff size=2>"acct"</FONT><FONT size=2>, </FONT><FONT color=#ff00ff size=2>""</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>), 1)</P></FONT>
<P>&nbsp;</P>
<P>In my rule class I call a command object to test if the data exists but only for New objects:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> RecordDoesNotExist(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> target </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> RuleArgs) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> ruleArg </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> RecordExistsRuleArgs = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(e, RecordExistsRuleArgs)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> propertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = ruleArg.PropertyName<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> propertyDescription </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = ruleArg.PropertyDescr<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> tableName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = ruleArg.TableName<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> fieldValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = ruleArg.FieldValue<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> testWhenNew </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = ruleArg.TestWhenNew<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = CallByName(target, propertyName, CallType.Get).ToString<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> bizObject </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Core.BusinessBase = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(target, Csla2.Core.BusinessBase)<BR><BR>&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> (testWhenNew = </FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> bizObject.IsNew) </FONT><FONT color=#0000ff size=2>OrElse</FONT><FONT size=2> (testWhenNew = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> CheckValue.RecordDoesNotExists(tableName, value, fieldValue) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>True<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>e.Description = GetDescription(target, propertyName, propertyDescription) &amp; </FONT><FONT color=#ff00ff size=2>" already exists."<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Else</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>'testWhenNew = True AndAlso Not bizObject.IsNew<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>True<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2><BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>=================================================================</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> RecordExistsRuleArgs<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> PNIRuleArgs<BR><BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mTableName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mFieldValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mTestWhenNew </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp; <BR>&nbsp; </FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> TableName() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mTableName<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> FieldValue() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mFieldValue<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> TestWhenNew() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mTestWhenNew<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> propertyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> tableName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> fieldValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>""</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> testWhenNew </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>Optional</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> propertyDescription </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>""</FONT><FONT size=2>)</FONT><FONT color=#0000ff size=2><BR>&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; MyBase</FONT><FONT size=2>.New(propertyName, propertyDescription)<BR>&nbsp;&nbsp;&nbsp; mTableName = tableName<BR>&nbsp;&nbsp;&nbsp; mFieldValue = fieldValue<BR>&nbsp;&nbsp;&nbsp; mTestWhenNew = testWhenNew<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> ToString() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.ToString &amp; </FONT><FONT color=#ff00ff size=2>"?tableName="</FONT><FONT size=2> &amp; mTableName &amp; </FONT><FONT color=#ff00ff size=2>"&amp;fieldValue="</FONT><FONT size=2> &amp; mFieldValue &amp; </FONT><FONT color=#ff00ff size=2>"&amp;testWhenNew="</FONT><FONT size=2> &amp; mTestWhenNew<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function<BR><BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P></FONT>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
