<html><header><title>BusinessBase - Request For Change (Sourcecode)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BusinessBase - Request For Change (Sourcecode)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8957.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Wednesday, May 19, 2010</h2><p>We have the need to override IsBusy, IsSelfBusy and IsPropertyBusy in each of the business types. If i don&#39;t override it and use the new keyword instead the reintroduced properties won&#39;t be called when accessing the business object using by interface INotifyBusy.<br />I could ofcourse introduce an own interface and use that one, but then BusyChanged and other things are not as usefull as they are now. It&#39;s alot easier (and better imho) if the properties are marked virtual so i can override them and add my own restrictions to them.<br /><br />I changed the source code in Csla myself and added virtual to the 3 properties.</p>
<p>Can this be changed?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 19, 2010</h2><p>I don&#39;t understand your scenario, can you explain what you are trying to do?</p>
<p>I don&#39;t casually make properties and methods virtual, because that just asks for disaster as people override things incorrectly. I need to understand the scenario, and make sure there isn&#39;t another less invasive solution - and frankly to make sure the scenario is compelling enough to all CSLA users to be worth the expansion of the API.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Wednesday, May 19, 2010</h2><p>I&#39;ll try to keep it short, if u want more detail please ask.</p>
<p>As i implemented an custom adornerlayer as busy / loadingpanel it listens for BusyChanged events. The implementation is more complex and blocks users to access components which are databinded to a business object or it&#39;s properties. Properties can be marked as loading (being busy). I didn&#39;t use the LoadPropertyASync and instead used a custom PropertyManager instead of the LoadManager.<br /><br />Anyway the overriden property IsSelfBusy adds an extra conditional requesting our LoadManager if a property is loading or not, incase it&#39;s true it will return a IsSelfBusy state true. Also the property IsPropertyBusy will need the extra conditional beside the base.IsPropertyBusy.<br /><br />In the eventhandling of BusyChanged i ask if the sender impliments INotifyBusy and ask it if IsSelfBusy.<br />Reintroducing the properties using the new keyword won&#39;t make the being invoked.</p>
<p>PS: It&#39;s the BusinessBase and the ReadOnlyBase, not the Lists versions as they are already virtual there.</p>
<p>Oh and the code in ReadOnlyListBase has some strange comment <img src="http://forums.lhotka.net/emoticons/emotion-3.gif" alt="Surprise" /></p>
<p>&nbsp;&nbsp; &nbsp;public override bool IsBusy<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp; &nbsp;get<br />&nbsp;&nbsp; &nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;// any non-new deletions make us dirty<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;foreach (C item in DeletedList)<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (item.IsBusy)<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return true;</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;// run through all the child objects<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;// and if any are dirty then then<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;// collection is dirty<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;foreach (C child in this)<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (child.IsBusy)<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return true;</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;return false;<br />&nbsp;&nbsp; &nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;}&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Saturday, May 22, 2010</h2><p>Do u agree to make it IsBusy and IsSelfBusy virtual?<br /><br />Another option might be something like:<br /><br />- add a new virtual method where additional IsBusy and IsSelfBusy conditions can be asked.<br />But i think this will be more complex to explain, making methods virtual is more meaningfull and a developer really should know not to override it without calling the base for sure. Right? :)</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, May 24, 2010</h2><p>Why don&#39;t the MarkBusy and MarkIdle methods work for you?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Wednesday, May 26, 2010</h2><p>MarkBusy on a child bubbles up the chain and every parent fires a BusyChanged where the sender can be casted to an INotifyBusy.<br /><br />When getting the properties INotifyBusy.IsBusy and INotifyBusy.IsSelfBusy they will have invalid values if at least there isn&#39;t an additional condition possible&nbsp;either by overriding if it&#39;s virtual or by an extra function.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Wednesday, May 26, 2010</h2><p>Oh.. and the BusyChangedEventArgs.Busy isn&#39;t enough in our case because one or more properties might be busy with being async loaded. We also added an MarkPropertyBusy and MarkPropertyIdle. Ofcourse i can choose for several another solutions like creating an own event and firing that one or creating an own interface and implement and cast to that one. But it will require testing and either way it feels like a workaround while making the IsBusy and IsSelfBusy virtual feels more pure to me.</p>
<p>I do understand the risk that a developer can override it in each business object, but won&#39;t that be something the developer must understand? Always call the base class.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Tuesday, June 01, 2010</h2><p>I&#39;ve the feeling i&#39;m not clear enough <img src="http://forums.lhotka.net/emoticons/emotion-7.gif" alt="Tongue Tied" /></p>
<p>Does anyone even understand what i mean in the post above?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 01, 2010</h2><p>Sorry I didn&#39;t get back to this thread - the holiday weekend and various work things have really had me busy, and this has required some time and thought.</p>
<p>I do understand what you are trying to accomplish. I want to consider whether there are ways to make this more abstract conceptually. It is one thing to make the methods virtual and force everyone to implement some complex thing on their own. It is better (generally) if the concept can be abstracted and automated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, June 24, 2010</h2><p>I did decide to mark the three properties/methods as virtual:</p>
<p><a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=780">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=780</a></p>
<p>This change will be in beta 3 - thanks for the help on this issue!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Friday, June 25, 2010</h2><p>Thanks, that&#39;ll make it easier for me to upgrade to a new version.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
