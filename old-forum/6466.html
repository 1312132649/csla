<html><header><title>Arranging ER objects hierarchically.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Arranging ER objects hierarchically.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6466.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell posted on Friday, February 20, 2009</h2>Hi.<br>I have ER objects, which I would like to present hierarchically by means of Folder ER objects. The objects are editable, because the user should be able to rename any object in place (exactly as in Windows Explorer).<br>On the other hand, the objects are root objects.<br>I have browsed the forum looking for proposals on how to implement it. Unfortunately, I have only discovered, that:<br><ul><li>CSLA has builtin support for just the child-parent relationship.</li><li>Some propose to make Folder ER be a parent of FolderInfo and FileInfo ROC. However, if they are read-only, then how can one employ data binding to allow inplace renaming?</li></ul>In short, I do not see any way out, except keep the object references in bare members, avoiding the Field Manager and implement the logic from scratch. Which brings me to another question - can I use ERLB to keep the Folder children (yes, they are children, but not in the CSLA sense of the word)?<br><br>Thanks.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Sunday, March 01, 2009</h2>Bump, bump, bump....<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Sunday, March 08, 2009</h2>Anyone?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ash002 replied on Sunday, March 08, 2009</h2>Hi, why are these ER objects instead of EC/ECL? Presumming you wish to save one at a time? Cloning the object to be saved would include all its children, so thats no good. Is just assigning its data into a saver BO an option?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Sunday, March 15, 2009</h2>I am sorry, I did not understand your statement.<br>ER is an editable root object, they are saved one at a time.<br>EC is an editable child object, they are saved all at once.<br>My Folders are ERs, because they are saved one at a time. <br><br>I am sorry, I do not seem to grasp your idea. Can you explain it?<br>Thanks.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ash002 replied on Sunday, March 15, 2009</h2><P><FONT face=Tahoma size=2>As I read your problem,&nbsp;saving the ER will save all BO properties of the ER.&nbsp;Saving one would save&nbsp;the BO and its children, and their children's children. Even if a BO is not marked as child, it is still caught by the serialisation.<BR><BR>Suggesting do the display as databound EC.&nbsp;To save, copy&nbsp;the changed Folder EC's&nbsp;contents (only those to be saved, and clones of any BO properties) to a new Folder ER (or FolderUpdater ER containing a new&nbsp;Folder EC, Folders BLB,&nbsp;hence&nbsp;more Folder EC), and save the new ER. When save is successful, mark the databound ECs as clean. <BR><BR>The principle being to use ECs as normal for display, but for the&nbsp;blasphemous function of saving only a portion of the data graph, create new objects and copy&nbsp;in the data to be saved, then mark the bound objects as clean.&nbsp;Any properties which are BOs (other than Folder, eg FolderSecurity) could be cloned.<BR></FONT></P><FONT face=Tahoma size=2><BR></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Monday, March 16, 2009</h2>Well, I must have explained a bit more about how I am doing it right now.<br>Of course, I am aware of the serialization process, however, the children collection is marked with the NonSerialized attribute. When a Folder BO is saved, the new instance before being returned to the user is passed the children from the old one, like this:<br><br><b><font face="Courier New" size="1">[NonSerialized]<br>private FolderList m_children;<br><br>protected override void OnSaved(Folder newObject, Exception e, object userState)<br>{<br>&nbsp;&nbsp; if (newObject != null)<br>&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newObject.m_children = m_children;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (IsNew &amp;&amp; IsParentLoaded &amp;&amp; Parent.AreChildrenLoaded)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Parent.Children.Add(newObject);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; base.OnSaved(newObject, e, userState);<br>}<br></font></b><br>Where Folder.Parent shadows the BusinessBase&lt;T&gt;.Parent property.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Thursday, January 28, 2010</h2>Is it possible to provide a full working example?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Friday, January 29, 2010</h2>@Alef, it is not that easy. We do not have a small standalone solution. Instead, we have developed an extra level on top of the CSLA framework. This layer supports folder like parent-children relationship as well as other things, that we needed, like in-place saving of entities (the idea of returning a new object on each save does not suit very well our needs) or supporting multiple data portal proxies. To do these and more we had to make minor changes to the CSLA code.<br><br>Unfortunately, I do not have the time to create a simply concise example - my time does not belong to me :-(.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Sunday, March 08, 2009</h2>You could attempt to implement a Composite pattern on your BB subclass.&nbsp; I'm not sure you can use the newer FieldManager to manage the child collection though.&nbsp; It's a fair amount of work.&nbsp; <br><br>I'm not sure how you'd implement this though having each instance as a root.&nbsp; Perhaps the entire tree should be read-only objects ,and when the tree value is changed, you can execute a command to hit the db and update, and then update the read-only instance.&nbsp; That might be the best way to go.. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>markell replied on Sunday, March 15, 2009</h2>Hi.<br>Can you elaborate a bit on this Composite pattern thing? I know what the patter is, but I find it hard to see how it is applicable to my situation.<br><br>As I have mentioned, the user should be able to rename the folders in place, which is done through the WPF data binding - binding the Folder.Name property to the Text property of the TextBox, which becomes visible when the user clicks the tree item. Your suggestion implies that I should maintain two sets of BOs - ROC FolderInfo and ER Folder in the same context (unlike the ProjectTracker's RoleInfo and Role BOs, which were used in different contexts).<br><br>It seems to me that this is not a very good solution. Is there a working example of this approach?<br>Thanks.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
