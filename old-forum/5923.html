<html><header><title>Format measurements (imperial/metric)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Format measurements (imperial/metric)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5923.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bromden posted on Tuesday, December 02, 2008</h2><P class=MsoNormal><SPAN><FONT face=Calibri>I need some guidance concerning an application that I am working on that enables the user to view and enter measurements in inches or centimeters depending on culture. Measurement data is always stored in metric. Today the conversion takes place in the presentation layer. The conversion is handled by simple functions that are applied before binding and before data is saved to the business object. I believe itâ€™s correct to handle the conversion in the presentation layer but at the same time it screws up any type of smooth databinding. Has anyone else faced this issue and come up with a solution? <SPAN>&nbsp;</SPAN>Any suggestion would be helpful.</FONT></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, December 02, 2008</h2><P>Why not just implement a specific property for this purpose e.g. CultureSensitiveMeasurement?</P>
<P>Your property getter/setter could interpret the actual internal value based on the culture, and the presentation layer can just directly bind to this property. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, December 02, 2008</h2><P>Depending on how you have structured your application, this could be the best solution.&nbsp; I recently developed an application with similar requirements (although we allowed the user to select the system rather than discerning it from the culture).&nbsp; We following the MVP design pattern for our application.&nbsp; Doing this allowed us to manage our business objects using a single, standard system (also metric).&nbsp; The presentation components handled any conversion necessary.&nbsp; This decouples the rigors of conversion from our BOs.</P>
<P>The other option, as suggested, would be to abstract the conversion within your BO's properties.&nbsp; In this manner, the value retrieved would be in the appropriate units based on the culture much like a resource string will be localized.&nbsp; The reason we did not go this route in our application was because it was calculation intensive.&nbsp; To perform a calculation, we either had to access the private variables containing the raw values or deal with possible variations in the equations (such as constants that would be different in metric vs. standard/english units).&nbsp; It seemed easier to make our business logic entirely metric and support standard units in the presentation layer.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Wednesday, December 03, 2008</h2><P>Hi</P>
<P>In my view the conversion is purely a UI concern as you say. I handle the Binding's Parse and Format events and perform the conversions there. This does not interupt the the Binding mechanism and works well. Mind you, there is additional work to set this up in the UI. I am using winforms not webforms</P>
<P>HTH</P>
<P>Simon</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Wednesday, December 03, 2008</h2><P>You can do this in the presentation layer, but that means it has to be redone in every UI you support. You'll need separate implementations for WinForms, WPF, ASP.NET, etc. </P>
<P>If you encapsulate the conversion in a single implemented property, then you get all the supported UI's for "free". </P>
<P>Just my $0.02... </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, December 03, 2008</h2><P>Actually, the intent of the MVP pattern is so that the SAME presenter is used for ANY UI.&nbsp; By handling the conversion in the presenter, whatever UI you slap onto the app will display the desired units.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon_may replied on Thursday, December 04, 2008</h2><P>My primary reason for for placing conversion&nbsp; in the presentation layer is that the UI is different for each measurement system. Imperial is not a decimal system and is best presented&nbsp; with two seperate imputs for each value.&nbsp;For example, pounds and ounces, feet and inches. Thus the work has to be done in the&nbsp;UI regardless of any convenient property on the business object.</P>
<P>I take SonOfPirate's point but creating a presenter that will coexist with the different data bindings is a challenge.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bromden replied on Thursday, December 04, 2008</h2><P><SPAN>Thanks for all the input. I must say that I also like the MVP pattern, mostly from a test perspective. I have at times been doubtful towards test driven development mainly because you end up creating a lot of test code which also needs to be maintained and in the end you only test half of the application (service layer down). With MVP patterns in place that really changes things.<o:p></o:p></SPAN></P>
<P><SPAN>My dilemma this time is that the application is already in place&nbsp;and I will have a hard time arguing the introduction of the&nbsp;MVP pattern since it will probably take&nbsp;a fair amount of time. </SPAN>But we have all been there :-)</P>
<P>Staying Alive</P>
<P>/Bromden</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, December 05, 2008</h2><P>There is a hybrid approach of sorts.</P>
<P>Your BO could simply expose both an InchesMeasurement and CentimetersMeasurement property, and the UI could reconfigure itself based on the culture (e.g. have both controls on the screen, hide the one not being used, etc). </P>
<P>Purists might cringe at such a suggestion, but if your case is limited to a few instances of this, it might not be so bad. It still avoids doing the conversion in the presentation layer. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 05, 2008</h2>Maybe I missed it, but has anyone suggested a new value type class that "knows" the units and proper conversion?&nbsp; I'd think you'd use it in a similar manner to SmartDate.&nbsp; Don't directly expose it in the UI, but maybe a string UnitAmount and UnitType property which affects the stored SmartUnit type?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bromden replied on Friday, December 05, 2008</h2>In that case I like your first suggestion better mainly because it concentrates everything to the property. In this scenario both the business object and the presentation layer has to get involved. Eventhough the presentation layer has minor imvolment (you can probably bind the visible property in&nbsp; a lot of cases). In some cases though, it can become somewhat complex with the hiding and showing of controls and for the GUI to present itself neatly.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
