<html><header><title>BeginEdit/CancelEdit and all-object gragh</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BeginEdit/CancelEdit and all-object gragh</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4698.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>d3vil posted on Wednesday, April 16, 2008</h2>hey,<br>I'm using CSLA (3.X) in a non-traditional way, beside the fact that I use DTO's and NHibernate, my relations between objects (in the BO level) are objects and not Id's fields (e.g. Project has a user object , not Project has a UserId field).<br><br>the problem in BeginEdit/CancelChanges is that I have different copyState behavior for different relations: <br>A relation of a simple foreign key as lookup (like project and user, or Post and Tag).<br>A relation of Parent-Child (like Test and result),<br><br>The difference in behaviors should be something like this:<br><ul><li>when in a lookup relation, I don't need nor want that the looked-up object will save its own state because I'm treating it as an whole (I don't care about a specific field in it, because any moment the user may change the all object, so the BeginEdit should save the whole object (and more on the problem that introduces me, later in this post) - like currently treating UserId field (I really care for the id). When I hit the cancel button, I don't care on any changes made on the looked-up object , only on my main object.</li></ul><ul><li>on the other hand, when in a parent-child relation, the child object isn't going to change (instance wise - id wise) but only its fields, so here the normal BeginEdit/CancelEdit works fine (meaning will go into the object and tell it to save/undo its state).</li></ul><br>The problem I talked about was deserialize a NHibernate object. because deserialize creates a new instance then the current NH-Session won't be associate with it, and that is just a recipe for other problems (I don't really want to re-associate objects each time i hit cancel edit).<br><br>currently I refactored the CopyState/UndoChanges/AcceptChanges so each logical question can be overridden and each logical Copy/Undo action can be overridden also,<br>in my domain's BO-Base class I decide what is the relation according to an attribute on the field. When I need to cancel changes on a looked-up object, I just re-load it from the DB (in copyState I save its Id).<br>Also I don't have the option to switch to CSLA 3.5 (.Net 3.5 etc..., or want to, personally i just don't like the heavy use of refraction every where) of that will be to much of&nbsp; breaking changes.<br>I don't like this solution very much, and I wonder if anyone else stumbled upon this problem, and how you think is the best way to solve it?<br><br>10x,<br>d3vil.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 16, 2008</h2><P>Doesn't the NotUndoable attribute get you what you want? Mark the fields you don't want serialized as NotUndoable and they will be ignored by UndoableBase.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>d3vil:</strong></div><div>hey,<BR>Also I don't have the option to switch to CSLA 3.5 (.Net 3.5 etc..., or want to, personally i just don't like the heavy use of refraction every where) of that will be to much of&nbsp; breaking changes.<BR>I don't like this solution very much, and I wonder if anyone else stumbled upon this problem, and how you think is the best way to solve it?<BR></div></BLOCKQUOTE></P>
<P>CSLA 3.5 doesn't require any increase in the use of reflection. The primary place reflection is used more than in the past is if you use the new data portal features that simplify child object persistence - and that is entirely optional (so you can choose between saving lots of code vs getting optimal performance). And even there, the reflection is minimal because the data portal in 3.5 now uses dynamic method invocation, and thus is substantially faster than 3.0 in many cases.</P>
<P>Arguably the object-level authorization scheme increases the use of reflection by making one reflection call per type per instance of your application. So if you have 100 business types, you <EM>might</EM> incur 100 reflection calls - which is no big deal at all.</P>
<P>You must remember that any use of data binding has <EM>always</EM> involved tons of reflection. All Microsoft's data binding infrastructures (Windows, Web, WPF) are very reflection-intensive. CSLA's use of reflection is very, very minor compared to Microsoft's use of the technology <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>d3vil replied on Thursday, April 17, 2008</h2>hi Rocky,<br><br>One thing at a time.<br>First, the NotUndoable: <br>No.. it doesn't help me because I don't want the field to be saved...<br>think of this both Post and Tag are BusinessBase&lt;T&gt;:<br>Post p = Post.get(id);<br>// p.Tag == HelloWorld <br>p.BeginEdit();<br>p.Text = "blab alba bla";<br>p.Tag = Tag.Get("C#_Tag");<br>p.CancelEdit();<br>///more stufff<br><br>In that case I would expect that Tag will reference an HelloWorld tag and not C# tag...<br>in a prefect world I would serialize Tag as an whole and in CancelChanges deserialize it back to p.Tag, but in NH that isn't a possibility. - BTW it would be nice to add to the IUndoable methods points to expend or replace some of the logic. (as I said, I'm currently modified it myself in CSLA whice is a thing I don't like to do..)<br><br>I hope you understand my problem now.<br><br>Now about the reflection stuff.<br>I used to allow my BO programmers to use CanReadProperty(), CanWriteProperty() and PropertyHasChanged() - with no parameters...<br>those method use callstack and reflection to get the properties names (which can be very nice when a big change is done to the data model). <br>I have several use-cases when the user edit/create hundreds or thousands of object, I took a .Net profiler and you won't believe how much time is "wasted" on those methods (and not only with&nbsp; hundreds object, even much less (tens...) - I'm sorry that I don't have any number to give you, but that was long ago and on a performance sprint to ship the version.<br><br>as for data_portal, I looked briefly on the thread that discussed the dynamics methods and stuff and didn't yet had the chance to fully read and review the new design (will do as soon as I have the time) - I'm seriously consider to make my own CSLA hybrid with taking the new data-portal design and implement it in my current modified CSLA3.X without the parent-child code.<br><br>I always wondered why you didn't use interfaces over there(data-portal) instead of reflecting on the object several times (which looks very redundant....)<br><br>anyway now when using NH the use of data portal is very very different because NH saves all the object graph in one save call.<br><br>and last but not list, Binding.<br>yes.. I know MS binding is a bunch of reflection on top of more reflection and I hate that, and when I can I prefer not to use it.<br><br><br>anyway this thread is just for the sake of discussion because I don't really belive that my original problem has a better soltion then the one I implemented, but if there is.... I will gladly apply it to my code.<br><br>d3vil.<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
