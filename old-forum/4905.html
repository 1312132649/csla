<html><header><title>TransactionScope question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>TransactionScope question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4905.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Valentin_Valve posted on Wednesday, May 28, 2008</h2>Hello.<br>I wrote a stored procedure that contains try\catch blocks (raiserror is thrown from the catch block). When I try to call this proc inside a transaction scope I end up with '<i>Transaction count after EXECUTE indicates that a COMMIT or ROLLBACK TRANSACTION 
statement is missing. Previous count = 1, current count = 0</i>'.<br>I get this message only when sproc db transaction is rolled back in catch block and original error is rethrown by '<i>raiserror' </i>statement. What am I doing wrong?<br>Please help.<br><br>~Valentin Vasiliev (Valve).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 28, 2008</h2>I thought that stored procedure transactions and TransactionScope were incompatible - you had to use one or the other?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Valentin_Valve replied on Wednesday, May 28, 2008</h2>Hi Rocky,<br>The reason why I need this is to create a sproc which would 'know' if it is being called from TransactionScope or independently. I think I managed to do this by checking the current trancount. If it is greater than zero, then we're called from withing the transaction scope.<br>So the code would look like:<br>create proc MyProc<br>as<br>if @@trancount&gt;1 -- call from TransactionScope<br>&nbsp; save tran -- saving tran<br>else -- called independently<br>&nbsp; begin tran<br>bla<br>bla<br><br>commit or rollback.<br><br>Thanks,<br><br>Valentin Vasiliev (Valve)<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
