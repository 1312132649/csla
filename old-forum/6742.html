<html><header><title>Editable root lists in a tree structure (silverlight)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Editable root lists in a tree structure (silverlight)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6742.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>James Thomas posted on Sunday, April 05, 2009</h2>Hi,<br><br>I have a tree structure (saved as a self-joined table in the database) in which my object contains a dynamic editable root list of other objects of the same type. Each of these objects can, of course, contain editable root lists of the same type, etc... This gives me a nice tree structure that can all be loaded in one go, passed to the client and databound in a treeview (as the objects themselves, not using dataproviders).<br><br>Adding, deleting and editing text in the nodes works fine, but I'm having difficulty in implementing drag and drop efficiently.<br><br>When a node is dragged and dropped, it needs removing from its original list and inserting into another. How do I go about doing this though? If it simply involved one node then I guess it would be easy enough to delete from one list (this works fine) and create a new object in another list (works fine). However, the node I'm dragging might have a complex structure of nodes below it which also need to move, ideally without reloading them all. In my days of programming in c, I'd have just changed the pointers in the lists and the job would be done. In CSLA though, when I remove an object from a list, it's marked as 'deleted' and isn't much good for then inserting into another list.<br><br>I'm sure there's a way of doing this, I just don't know CSLA well enough I guess.<br><br>Any pointers ;-) would be much appreciated.<br><br>Thanks, James.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Sunday, April 05, 2009</h2><P>The common response I see to questions like this is that EditableRootListBase (ERLB) was designed for a very specific use case -- editing root objects in a grid -- and that it was not intended&nbsp;for ______. (fill in whatever poster was trying to do here). </P>
<P>That being said, I too find it useful for related purposes. </P>
<P>In this case, maybe even though the list marked the object as "deleted" -- and in fact may have even really tried to delete the object from the database, you might be able to intercept the delete call to prevent the database deletion. If an object has been marked as deleted, you can also "undelete" it. You would probably have to do this in derived classes since this would involve protected properties or overriding virtual methods.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, April 05, 2009</h2><P>I think he's asking about BLB lists, not ERLB lists.</P>
<P>It is often the case that a tree is best represented as a set of read-only objects, not editable objects. In other words, ROLB instead of BLB.</P>
<P>You can then have a set of Command objects that are used to perform operations on the read-only objects. The Command object can change the server-side data (in the database) and if that succeeds it can alter the client-side object graph (or at least coordinate the updates to the object graph - I'm not advocating breaking encapsulation).</P>
<P>As a brief example, suppose I have ListA and ListB. The UI allows the user to move items from one list to the other, and these changes are immediate (no 'Save' button - the move is auto-committed to the database). If you implement both lists as ROLB, their implementation is pretty easy, as is the UI.</P>
<P>When the user drops an item from B into A, the UI can invoke an AddFrom() command:</P>
<P>_listA.AddFrom(_listB, item);</P>
<P>or something like that. This AddFrom() method would invoke a Command object to do the actual work:</P>
<P>public void AddFrom(ListType list, ItemType item)<BR>{<BR>&nbsp; ItemMover.DoMove(this, list, item);<BR>}</P>
<P>the Command object is ItemMover, and would look like this pseudocode:</P>
<P>[Serializable]<BR>internal class ItemMover : CommandBase<BR>{<BR>&nbsp; // declare id key value properties here</P>
<P>&nbsp; public static void DoMove(<BR>&nbsp;&nbsp;&nbsp; ListType fromList, ListType toList, ItemType item)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; var cmd = new ItemMover {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FromListId = fromList.Id,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ToListId = toList.Id,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ItemId = item.Id };<BR>&nbsp;&nbsp;&nbsp; DataPortal.Execute&lt;ItemMover&gt;(cmd);</P>
<P>&nbsp;&nbsp;&nbsp; // we get here because the server update worked<BR>&nbsp;&nbsp;&nbsp; fromList.RemoveMovedItem(item);<BR>&nbsp;&nbsp;&nbsp; toList.AddMovedItem(item);<BR>&nbsp; }</P>
<P>&nbsp; protected override void DataPortal_Execute()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // update database to reflect change by using<BR>&nbsp;&nbsp;&nbsp; // the id key value properties</P>
<P>&nbsp;&nbsp;&nbsp; // throw exception if this can't be done<BR>&nbsp; }<BR>}</P>
<P>Note that this does require that you implement internal RemoveMovedItem() and AddMovedItem() methods on your read-only list class. These would look like this:&nbsp;&nbsp;&nbsp;</P>
<P>internal void RemoveMovedItem(ItemType item)<BR>{<BR>&nbsp; IsReadOnly = false;<BR>&nbsp; try<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; this.Remove(item);<BR>&nbsp; }<BR>&nbsp; finally<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; IsReadOnly = true;<BR>&nbsp; }<BR>}</P>
<P>This technique means you don't break encapsulation on any object. It provides a model by which you can implement discrete methods on what would otherwise be read-only lists, and is often the best model for implementing things list selection lists, treeviews and so forth.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>James Thomas replied on Friday, April 10, 2009</h2>Thanks! Just what I needed to get on the right track.<br>Thanks for your help, James.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
