<html><header><title>CSLA in search form</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA in search form</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/219.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kucing posted on Monday, May 29, 2006</h2>Does the framework supports searching for objects? For example, at the moment, I would like to create a search form and functionality for a web application. Is there a CSLA way to do it? Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Tuesday, May 30, 2006</h2><P>Morning,</P>
<P>This is absolutely possible.</P>
<P>You would handle it something like this...</P>
<P>1) Build a read only list object that accepts criteria objects holding the criteria the user can search by.</P>
<P>2) pass those criteria in and return the list object.</P>
<P>You can even go as far as returning a Read only list of the PK values of the objects that meet the search criteria which can then be passed into a main form allowing user to navigate thriough and edit each selected record.</P>
<P>Hope that helps and get back in touch if you need more info.</P>
<P>Cheers</P>
<P>ChrisD</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kucing replied on Wednesday, May 31, 2006</h2>Thanks for that guys!<br><br>But let's say I have around 10 fields (all optional) that the user can enter as a search criteria. How can I build the Criteria class properly? Similarly, how can I create my stored procedure properly?<br><br>In my mind, these are the constructors for the criteria class:<br>Criteria(name)<br>Criteria(name, size)<br>Criteria(size)<br>Criteria(name, size, colour)<br>Criteria etc....<br><br>Which will be extremely long. Similarly for the stored procedures, I will need to create stored procedures for all of those combinations, e.g.<br><br>sp_GetAnimalGivenName @name<br>sp_GetAnimalGivenNameSize @name, @size<br>sp_GetAnimalGivenSize @size<br>sp_GetAnimalGivenNameSizeColour @name, @size, @colour<br>....<br><br>I know I am missing something or misunderstand how it will work. Can anyone enlighten me?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, May 31, 2006</h2>I have search support built into my DAL.&nbsp; My BO takes its search criteria and translates that into DAL criteria.&nbsp; The DAL does searches by building an ad hoc Sql statement.&nbsp; I don't use stored procedures for selecting data exactly for the reasons you describe; you end up with a complex SP, or you have to make a bunch of them.&nbsp;&nbsp; So my DAL builds a Sql statement which just does a select from a view.&nbsp; (For security reasons, tables cannot be touched directly, they can only be modified by procs, and selected from via views).<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, May 31, 2006</h2>Oh, for your Criteria class... don't provide all those overloads on the constructor.<br><br>Just provide a default constructor, and allow the 'parameters' to be set via properties.&nbsp; Your BO will determine which properties have values and use the DAL to filter on those properties.&nbsp; <br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, May 31, 2006</h2>If anyone's interesting, here is my data access code which actually performs the search:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void DataPortal_Fetch( SearchCriteria criteria ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataSearcher&lt;Data.Contacts.Contact&gt; searcher;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Data.Contacts.Contact&gt; results;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SelectionCriteria crit;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher = new DataSearcher&lt;Data.Contacts.Contact&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.AddressLine1 ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Line1", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.AddressLine1 ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.AddressLine2 ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Line2", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.AddressLine2 ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.AddressLine3 ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Line3", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.AddressLine3 ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.City ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "City", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.City ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.Country ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "CountryName", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.Country ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.Email ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Email", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.Email ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.FirstName ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "FirstName", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.FirstName ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.LastName ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "LastName", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.LastName ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.PostalCode ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "PostalCode", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.PostalCode ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.Salutation ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Salutation", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.Salutation ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.State ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "StateName", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.State ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.Title ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "Title", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.Title ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !string.IsNullOrEmpty( criteria.Organization ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "OrganizationName", Operator.Like );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( string.Format( "*{0}*", criteria.Organization ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; results = searcher.Find();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach ( Data.Contacts.Contact p in results ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Add( ContactInfo.GetContactInfo( p ) );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = true;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>DataSearcher is part of my custom DAL.&nbsp; Data.Contacts.Contact is a view behind the scenes, but isn't tied to a specific database server; the db server type is set in a config file.&nbsp; (Well, currently my DAL only supports Sql Server, but I could add other providers in the future).<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JHurrell replied on Thursday, August 10, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>If anyone's interesting, here is my data access code which actually performs the search:<br><br>...<br><br>DataSearcher is part of my custom DAL.&nbsp; Data.Contacts.Contact is a view behind the scenes, but isn't tied to a specific database server; the db server type is set in a config file.&nbsp; (Well, currently my DAL only supports Sql Server, but I could add other providers in the future).<br></div></BLOCKQUOTE><br><br>Andy,<br><br>That's pretty cool. Would you be willing to share the DataSearcher code with us?<br><br>- John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 10, 2006</h2>I could, but it'd be rather pointless.&nbsp; The class itself delegates the actual find logic to the Provider for the DataEntity subclass.&nbsp; Provider uses an internal class called EntityReflector to find out about the DataEntity subclass.&nbsp; The Provider then uses this information to build the Select and From clauses of the Sql statement, and uses the SelectionCriteria list and OrderCriteria list to build the Where and Order by clauses.<br><br>That said, I am working on the solution at home, and will post when I've finished it.&nbsp; The problem is that the code itself really isn't anything that's not obvious, but I built it at work... so I'll need to start at scratch at home to 'rebuild' the library again before I can feel comfortable with posting it. <br><br>It's a project I am pursuing, but since its in my off time (of which I don't have much) its going slow.&nbsp; The idea is that next time I start a new .Net position (which hopefully won't be for a while) I can bring in my library and let them use it under alicense I choose.&nbsp; I've already built the library twice now and I'm sick of it.. this would help me in that regard. <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JHurrell replied on Thursday, August 10, 2006</h2>Gotcha.<br><br>- John<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Wednesday, August 16, 2006</h2><P>FYI - there is another topic where Andy describes his process in more detail: <A HREF="/forums/thread/2781.aspx">http://forums.lhotka.net/forums/thread/2781.aspx</A></P>
<P>We've implemented something along the lines of what Andy described into our CSLA-based framework.&nbsp; It too uses dynamic SQL to perform the search but even though it is a frowned upon practice to not use stored procedures, dynamic searches are outside the spectrum for which this rule applies.&nbsp; One of the big reasons you'd want to try to stick to stored procedures is the performance gain achieved with having the execution plan 'compiled' into the database.&nbsp; You only realize this with static code.&nbsp; A dynamic search, by its very nature, can't be pre-compiled into an execution plan - unless you get into writing some really nasty SQL with case statements, etc. (which can be done if you're into migraines).</P>
<P>Of course, the other big reason for sprocs is security/isolation which is violated with dynamic SQL, but having an object in your framework responsible for generating the SQL and interacting with the database via a CommandObject helps get some of this back.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidDilworth replied on Thursday, August 17, 2006</h2><P>I'd just like to add something here for anyone that's interested.&nbsp; As I've mentioned on other posts we're using NHibernate as our DAL/ORM mechanism.&nbsp; And we've used that in conjunction with the the new nullable types in .NET 2.0 in our Criteria objects to achieve the following.</P>
<P>We can define a nullable criterion inside the Criteria class.&nbsp; This means it can take an explicit value (meaning we want to use it in the filter search) or be left null (meaning we don't want to use it in the filter search).&nbsp; For example:</P>
<P>public partial class Criteria : CriteriaBase<BR>{<BR>&nbsp;private int? _noOfCovers = null;</P>
<P>&nbsp;/// &lt;remarks&gt;&lt;code&gt;null&lt;/code&gt; is used to indicate no filter constraint is required.&lt;/remarks&gt;<BR>&nbsp;public int? NoOfCovers<BR>&nbsp;{<BR>&nbsp;&nbsp;get { return _noOfCovers; }<BR>&nbsp;&nbsp;set { _noOfCovers = value; }<BR>&nbsp;}<BR>}</P>
<P>Then inside the DataPortal_Fetch() we convert the passed in Criteria class to NHibernate criteria, but only for those criterions which have been given a value.&nbsp; For example</P>
<P>...<BR>// NoOfCovers<BR>if (criteria.NoOfCovers.HasValue))<BR>&nbsp;AddCriteriaNoOfCovers(criteria.NoOfCovers.Value, nhibernateCriteria);<BR>...</P>
<P>And then the final piece in the jigsaw is the actual bit of code that builds up the NHibernate expression to be added to the NHibernate criteria.&nbsp; For example, the following method adds a simple equals expression.</P>
<P>private void AddCriteriaNoOfCovers(int noOfCovers, ICriteria nhibernateCriteria)<BR>{<BR>&nbsp;EqExpression expression = new EqExpression("NoOfCovers", noOfCovers);<BR>&nbsp;nhibernateCriteria.Add(expression);<BR>}</P>
<P>Obviously, our Criteria classes are more complex than this simple example and have multiple criterions.&nbsp; But this pattern (which is very similar to the one shown by Andy), allows for easy extension to add as many different criterion as there are properties in your BO.&nbsp; And NHibernate takes care of working out the correct SQL required in your chosen dialect (MS SQL, Oracle, MySQL, etc).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 17, 2006</h2>Same basic concept as what we've done and Andy's approach, just a different implementation that satisfies the need to make it work with NHibernate.&nbsp; I agree that Nullables make this process (among others) a whole lot easier.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, August 17, 2006</h2>I make use of Nullable in my DAL as well (just not in this particular functionality).&nbsp; Its been a godsend... nothing has felt worse to me than picking an arbitrary value out of a limited set to represent null..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, August 17, 2006</h2>Yea, I'm all for MS making ValueTypes nullable by default.&nbsp; What a difference that would make!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>abhicbsa replied on Tuesday, September 23, 2008</h2><strong>hi ajj3085,<br><br>can you share how this DataSearcher class has been implemented.<br>I mean can you give a brief description of your custom DAL.<br><br>thank<br>abhi<br></strong></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, September 24, 2008</h2>Well, it's the same concept as anything you'd find on codeplex or codeproject.&nbsp; Actually it was very similar to Linq (as far as defining classes to map to tables, and using attributes to map properties to columns), except in mine you had to inherit from a base class as well.<br><br>At any rate, I'm not sure if it'd be worth going into further, given that I've ditched my DAL in favor of Linq to Sql.&nbsp; It didn't do anything that L2S couldn't do, and if you can't use L2S it may be worth learning about NHibernate.&nbsp; I just didn't learn about it until after I had done mine.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kucing replied on Thursday, June 01, 2006</h2>Thanks. I realized about the my idiotic idea of having many constructors a few minutes after posting.<br><br>However, you said that you constructed the SQL query manually. I also had that in mind but I thought it is a bad practice. I guess, dynamic string construction is not so bad.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, June 01, 2006</h2>Well, its sort of manually.<br><br>I have a custom DAL layer which I wrote (and created tests for) which builds the SQL for me.&nbsp; I never hand code SQL myself, I creating the DataSearcher, SelectionCriteria and OrderCriteria classes for this purpose.&nbsp; When Find is called on the DataSearcher, it looks at the type (in the code I posted, Data.Contacts.Contact, which is a class that represents a View in Sql Server), build the SELECT columns FROM vContact, and then loops through the collection of SelectionCriteria and OrderCriteria to add on WHERE and ORDER BY clauses.<br><br>So my DAL builds the sql statement for me, I never craft it by hand.&nbsp; <br><br>Inherently there's nothing wrong with ad-hoc queries; i think there IS something wrong with hardcoding "SELECT * FROM vContact WHERE x = 1" in the code.&nbsp; <br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rhoeting replied on Tuesday, May 30, 2006</h2><P>And to take things a bit further....&nbsp;you can get fancy with search criteria.&nbsp; Suppose your search criteria is first name, last name and address.&nbsp; But you do want them to enter in a something on your search form.&nbsp; In other words, all fields blank is not allowable.&nbsp; </P>
<P>You can make your criteria object a BO in it's own right and add rules to it.&nbsp; You can bind the controls to the BO props, and bind the "Search" button to the IsValid flag of your Criteria object.</P>
<P>Rob</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
