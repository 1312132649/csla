<html><header><title>CSLA WCF Proxy and WCF ConcurrencyMode.Multiple</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA WCF Proxy and WCF ConcurrencyMode.Multiple</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9601.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DazedAndConfused posted on Tuesday, October 05, 2010</h2><p>Hi,</p>
<p>I am using the WCF Dataportal Proxy to run the data portal fetch methods on the server. I want to make use of the ConcurrencyMode in WCF but cannot see how to configure this in my server code. I have configured by xml but I believe I need to decorate the method in C# with </p>
<p><span style="font-size:x-small;">[</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">ServiceBehavior</span></span><span style="font-size:x-small;">(InstanceContextMode = </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">InstanceContextMode</span></span><span style="font-size:x-small;">.Single,ConcurrencyMode = </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">ConcurrencyMode</span></span><span style="font-size:x-small;">.Multiple)]</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Is it possible to do this?</p>
<p>Thanks</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, October 05, 2010</h2><p>I am not familiar with this option, what does it do?</p>
<p>I ask, because the data portal makes certain assumptions about the environment in which it runs - not many assumptions, but some - so if this option violates an assumption the results might be undesirable.</p>
<p>The answer to your question though, is that you&#39;ll need to create a custom host type. That is not very difficult, since the service contract is already defined - you just need to create a new implementation of the IWcfPortal interface.</p>
<p>Now if you need to set attributes on the service contract itself, that&#39;s a little harder since you&#39;ll need to create your own interface and implementation, and that will force you to create your own client-side proxy (obviously, because the existing proxy talks to an IWcfPortal).</p>
<p>But even that is entirely realistic - the data portal is completely flexible in this regard, as long as you understand both WCF and the data portal.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DazedAndConfused replied on Wednesday, October 06, 2010</h2><p>Hi Rocky,</p>
<p>It basically allows the service to run multiple treads, i.e. so that a client can call the service several times on multiple treads, and the WCF service runs then async, rather than the default behaviour of sync. The single flag dictates how many instances of the service are created.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 06, 2010</h2><p>OK, that may be a problem, or maybe not.</p>
<p>The data portal assumes a <i>synchronous service</i>. You can&#39;t use async WCF channels with the data portal,. So this may work, but only if, from the client&#39;s perspective, the service is synchronous. If it is only async on the server, but the client call is blocked until completion, then you&#39;d be OK.</p>
<p>The data portal also assumes each client call is handled by the server in an isolated context. That means either a single consistent thread (the default) or within a single HttpContext per request. Either way, Csla.ApplicationContext isn&#39;t threadsafe (just like the rest of CSLA and most of .NET), and it is stored on the thread or HttpContext.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Wednesday, October 06, 2010</h2><p>I&#39;m curious as to why you&#39;re wanting to develop a DataPortal proxy with this configuration.&nbsp; The settings you&#39;re applying are essentially creating a singleton service that requires you to manage all thread synchronization.&nbsp; From a scalability perspective, this isn&#39;t ideal, and as Rocky has already mentioned, parts of CSLA aren&#39;t threadsafe (which could cause you problems).&nbsp; Given what you say you&#39;re doing, why is the per-call setup not working for you?</p>
<p>- Scott</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
