<html><header><title>NameValue list parameter</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>NameValue list parameter</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/480.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dstarkey posted on Tuesday, June 27, 2006</h2><P>Hello,&nbsp; is it possible to pass a parameter to the static method of a name value list collection.&nbsp; </P>
<P>For example, if you want a list of &lt;employees&gt;&nbsp;name&nbsp;and &lt;employee number&gt; value for a specific location.&nbsp; How would you pass in this location parameter to retrieve this data??&nbsp; Pardon my ignorance, but hope to come up to speed soon.&nbsp; I looked at the criteria object but it seems that it is already accounted for in the stmt: </P>
<P>_list = DataPortal.Fetch&lt;NameValueList&gt;(new Criteria(typeof(NameValueList)));</P>
<P>Any help, example is greatly appreciated.&nbsp; </P>
<P>Would this work:</P>
<P>NameValueList NVLbyLoc = GetNameValueList(locNo);</P>
<P>Thanks</P>
<P>Don</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RanceDowner1234 replied on Tuesday, June 27, 2006</h2>I had the same problem... solved it by creating my own Private class called <font color="#ff0000">FilteredCriteria</font>, instead of using the stock Criteria.&nbsp; Since you pass it in by Object it works.&nbsp; <br><br>Rance<br><br>P.S.&nbsp; To explain what I'm doing here.&nbsp; I'm loading the object as a Singleton (so it's only instatiated once for the entire application lifecycle).&nbsp; But upon initial instantiation it loads a version of the nvList with a Blank Line at the beggining, which is useful for combo boxes with a blank value at the top, and then it loads another instance without a Blank value at the top, which is useful for validation.&nbsp; Nevertheless, my "FilteredCriteria" decides which list to return.&nbsp; You can ignore all the Singleton/Blank Line stuff when you port to your own needs.&nbsp; The most important piece in your case is the FilteredCriteria Object code.<br><br>Option Compare Text<br>Option Explicit On<br>Option Strict On<br><br>Imports Csla<br>Imports System.Data.SqlClient<br>Imports SharedLibrary.Data<br><br>Public Class OrgActionDescriptionNVList<br>&nbsp;&nbsp;&nbsp; Inherits NameValueListBase(Of String, String)<br><br>#Region " Module Variables "<br>&nbsp;&nbsp;&nbsp; Private Shared mInstance As OrgActionDescriptionNVList<br>&nbsp;&nbsp;&nbsp; Private Shared mInstanceWithBlank As OrgActionDescriptionNVList<br>#End Region<br><br>#Region " Factory Methods "<br><br>&nbsp;&nbsp;&nbsp; Private Sub New()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Private: Forces Factory<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Public Shared Function GetValueList(ByVal showBlank As Boolean) As OrgActionDescriptionNVList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Note: Singleton Pattern<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mInstance Is Nothing Or mInstanceWithBlank Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mInstance = DataPortal.Fetch(Of OrgActionDescriptionNVList)(New FilteredCriteria(False))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mInstanceWithBlank = DataPortal.Fetch(Of OrgActionDescriptionNVList)(New FilteredCriteria(True))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If showBlank = True Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mInstanceWithBlank<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mInstance<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End Function<br><br>#End Region<br><br>#Region " Data Access "<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Private Class FilteredCriteria<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private _showBlank As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public ReadOnly Property ShowBlank() As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _showBlank<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Sub New(ByVal showBlank As Boolean)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _showBlank = showBlank<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; End Class<br><br>&nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Fetch(ByVal criteria As Object)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.IsReadOnly = False<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim c As FilteredCriteria = DirectCast(criteria, FilteredCriteria)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If c.ShowBlank Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add(New NameValuePair("", ""))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim data As New SQLConnector<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As SqlConnection = data.Connection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "usp_UTIL_OrgActionDescriptionNVList_Select"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New Data.SafeDataReader(cm.ExecuteReader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; While dr.Read()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With dr<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim id As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim desc As String<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id = .GetString("Key")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; desc = .GetString("Description")<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add(New NameValuePair(id, desc))<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End While<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.IsReadOnly = True<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>#End Region<br><br>End Class<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pradeep replied on Tuesday, June 27, 2006</h2><DIV>I dont think, you can do this with just NameValueList object. But you could extend the NameValueList object and write your own collection.</DIV>
<DIV>&nbsp;</DIV>
<DIV>What I did was, I created a new collection called Lookup, inheriting from NameValueList. This new object will have a new criteria object, that will take in parameter's like employee No, etc. Also, you will have to&nbsp;overwrite the DataPortal_Fetch method to query the database by your new criteria's.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Anotherway would be to extend from&nbsp;ReadOnlyCollectionBase object.&nbsp;But&nbsp;&nbsp;you would have to create a struct to hold the data.</DIV>
<DIV>&nbsp;</DIV>
<DIV>HTH</DIV>
<DIV>Pradeep</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 27, 2006</h2>The solution Rance puts forward is correct. NameValueListBase is just a base class, like BusinessBase. When you create your subclass, you can implement your own criteria class if you desire. I only provide the built-in Criteria class to support the simple case - you should create your own criteria class for anything beyond that simple case.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fabiousa7 replied on Friday, September 29, 2006</h2><P>I had the same problem, I took the solution Rance presented, translated to&nbsp;C# and modified it a little.</P>
<P>I made this to list available website&nbsp;localization languages for specific companies.</P>
<P>Works great!</P>
<P>Fabio</P>
<P>//codeSample</P>
<P><FONT color=#0000ff size=2>using</FONT><FONT size=2> System;</FONT></P>
<P><FONT color=#0000ff size=2>using</FONT><FONT size=2> System.Data;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> System.Data.SqlClient;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> Csla;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> Csla.Data;</P></FONT><FONT color=#0000ff size=2>
<P>namespace</FONT><FONT size=2> GTA.Library</P>
<P>{</P>
<P>[</FONT><FONT color=#008080 size=2>Serializable</FONT><FONT size=2>()]</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>LanguageList</FONT><FONT size=2> : Csla.</FONT><FONT color=#008080 size=2>NameValueListBase</FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>&gt;</P>
<P>{</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Factory Methods</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> LanguageList()</P>
<P>{ </FONT><FONT color=#008000 size=2>/* require use of factory method */</FONT><FONT size=2> }</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>LanguageList</FONT><FONT size=2> _list;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>LanguageList</FONT><FONT size=2> GetLanguageList(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> organizationId)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (_list == </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>)</P>
<P>_list = </FONT><FONT color=#008080 size=2>DataPortal</FONT><FONT size=2>.Fetch&lt;</FONT><FONT color=#008080 size=2>LanguageList</FONT><FONT size=2>&gt;(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>FilterCriteria</FONT><FONT size=2>(organizationId));</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _list;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> InvalidateCache()</P>
<P>{</P>
<P>_list = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>//Factory Method</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> Data Access</P>
<P>[</FONT><FONT color=#008080 size=2>Serializable</FONT><FONT size=2>()]</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>FilterCriteria</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> OrganizationId;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> FilterCriteria(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> organizationId)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.OrganizationId = organizationId;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#008080 size=2>FilterCriteria</FONT><FONT size=2> criteria)</P>
<P>{</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2> cn = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SqlConnection</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>Database</FONT><FONT size=2>.GTA))</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SqlCommand</FONT><FONT size=2> cm = cn.CreateCommand())</P>
<P>{</P>
<P>cn.Open();</P>
<P>cm.CommandType = </FONT><FONT color=#008080 size=2>CommandType</FONT><FONT size=2>.StoredProcedure;</P>
<P>cm.CommandText = </FONT><FONT color=#800000 size=2>"SP_GetLanguageList"</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (criteria.OrganizationId &gt; 0)</P>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@OrganizationId"</FONT><FONT size=2>, criteria.OrganizationId);</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#008080 size=2>SafeDataReader</FONT><FONT size=2> dr = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>SafeDataReader</FONT><FONT size=2>(cm.ExecuteReader()))</P>
<P>{</P>
<P>IsReadOnly = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>while</FONT><FONT size=2> (dr.Read())</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Add(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>NameValuePair</FONT><FONT size=2>(dr.GetInt32(</FONT><FONT color=#800000 size=2>"Id"</FONT><FONT size=2>), dr.GetString(</FONT><FONT color=#800000 size=2>"Name"</FONT><FONT size=2>)));</P>
<P>IsReadOnly = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>//Data Access</P></FONT><FONT size=2>
<P>}</P>
<P>}</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
