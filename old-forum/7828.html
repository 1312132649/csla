<html><header><title>Problem with Filtering in LINQ to EF</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with Filtering in LINQ to EF</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7828.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CyclingFoodmanPA posted on Tuesday, October 20, 2009</h2>Ok, I have a LINQ query utilizing EF as follows:<BR><FONT size=2>
<P></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>NYMEXProduct</FONT></FONT><FONT size=2> data = (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> record </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> context.ObjectContext.NYMEXProducts.Include(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"NYMEXHistories"</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>where</FONT></FONT><FONT size=2> record.NYMEXProductId == criteria.Value <BR>&amp;&amp; record.NYMEXHistories.Any((h) =&gt; h.NYMEXDate &gt; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DateTime</FONT></FONT><FONT size=2>(2009,10,13))<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>select</FONT></FONT><FONT size=2> record).FirstOrDefault();</P>
<P>MapEntityToObject(data);</P>
<P>LoadProperty&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BLNYMEXProductNYMEXHistory</FONT></FONT><FONT size=2>&gt;(_NYMEXHistoryCollection, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BLNYMEXProductNYMEXHistory</FONT></FONT><FONT size=2>.GetChildren(data.NYMEXHistories)); </P>
<P>context.ObjectContext.Detach(data); </P>
<P>What I want to have happen, is I only receive the particular NYMEXHistory records retrieved that have a NYMEXDate &gt; 10/13/2009 which would be 1,280 rows.&nbsp; However, I am getting 181725 rows back and here is the SQL that is being generated as acquired by SQL Server Profiler:</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>SELECT</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductShortName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductShortName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChanged] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChanged]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChangedBy] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChangedBy]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[C1] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[C3] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C2]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[C2] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistoryId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXHistoryId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXDate] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXDate]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[ForwardDate] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [ForwardDate]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[ForwardMonth] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [ForwardMonth]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXLow] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXLow]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHigh] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXHigh]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXSettle] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXSettle]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChanged1] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChanged1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChangedBy1] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChangedBy1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId1] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductId1]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>FROM</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>SELECT</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductShortName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductShortName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChanged] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChanged]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChangedBy] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChangedBy]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[C1] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistoryId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXHistoryId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXDate] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXDate]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductId1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[ForwardDate] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [ForwardDate]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[ForwardMonth] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [ForwardMonth]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXLow] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXLow]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHigh] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXHigh]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXSettle] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXSettle]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR></FONT><FONT size=2>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChanged] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChanged1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChangedBy] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChangedBy1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CASE</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>WHEN</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistoryId] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>IS</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>NULL)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>THEN</FONT></FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>CAST</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(NULL</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ELSE</FONT></FONT><FONT size=2> 1 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>END</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C2]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CASE</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>WHEN</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>[Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistoryId] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>IS</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>NULL)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>THEN</FONT></FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>CAST</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(NULL</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ELSE</FONT></FONT><FONT size=2> 1 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>END</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C3]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>FROM</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>SELECT</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>TOP</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>1</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> <BR>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductShortName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductShortName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductName] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [NYMEXProductName]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChanged] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChanged]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[LastChangedBy] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [LastChangedBy]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> <BR>1 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C1]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>FROM</FONT></FONT><FONT size=2> [dbo]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProduct] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [Extent1]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>WHERE</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>=</FONT></FONT><FONT size=2> 4</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>AND</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>EXISTS</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>SELECT</FONT></FONT><FONT size=2> <BR></FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>cast</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>1 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>as</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bit</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [C1]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>FROM</FONT></FONT><FONT size=2> [dbo]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistory] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [Extent2]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>WHERE</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>[Extent1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>=</FONT></FONT><FONT size=2> [Extent2]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>AND</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT size=2>[Extent2]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXDate] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&gt;</FONT></FONT><FONT size=2> </FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>convert</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>(</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>datetime</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>'2009-10-13 00:00:00.000'</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> 121</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>))<BR></FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>))</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [Limit1]<BR></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>LEFT</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>OUTER</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>JOIN</FONT></FONT><FONT size=2> [dbo]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXHistory] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [Extent3] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ON</FONT></FONT><FONT size=2> [Limit1]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>=</FONT></FONT><FONT size=2> [Extent3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId]<BR></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>)</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2> [Project3]<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ORDER</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>BY</FONT></FONT><FONT size=2> [Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[NYMEXProductId] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ASC</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> [Project3]</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>[C3] </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ASC</P></FONT></FONT>
<P>When I type:<BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2>SELECT</FONT></FONT><FONT size=2> np</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.*,</FONT></FONT><FONT size=2> nh</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.*<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>FROM</FONT></FONT><FONT size=2> dbo</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXProduct np<BR></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>INNER</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>JOIN</FONT></FONT><FONT size=2> dbo</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXHistory nh </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ON</FONT></FONT><FONT size=2> nh</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXProductId </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>=</FONT></FONT><FONT size=2> nh</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXProductId<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>WHERE</FONT></FONT><FONT size=2> nh</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXDate </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&gt;</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>'10/12/2009'</FONT></FONT><FONT size=2> </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>AND</FONT></FONT><FONT size=2> np</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXProductId </FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>=</FONT></FONT><FONT size=2> 4<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ORDER</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>BY</FONT></FONT><FONT size=2> nh</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXDate</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>,</FONT></FONT><FONT size=2> np</FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>.</FONT></FONT><FONT size=2>NYMEXProductName</FONT></P>
<P><FONT size=2>I get the 1280 rows, which is what I want.&nbsp; Will someone please tell me what I am doing wrong with my LINQ sql.&nbsp; Any recomendations would be most appreciated.</FONT></P>
<P><FONT size=2>CyclingFoodmanPA</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, October 20, 2009</h2><P><FONT size=2 face=Tahoma>"Any" and "All"&nbsp;are not filtering operations - they are existence checks.&nbsp; If you look at the SQL, you'll see&nbsp;your&nbsp;"Any"&nbsp;translating into an EXISTS clase.</FONT></P>
<P><FONT size=2 face=Tahoma>Presuming you want both the Product record and the associated history records, try switching your ".Any" to a ".Where" and see if that gets you what you want.&nbsp; You shouldn't have to change&nbsp;anything else.&nbsp; I think there may be a "more elegant" solution using Entity SQL, but I don't have my book handy, and I haven't done enough EF yet to have it committed to memory.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P>
<P><FONT size=2 face=Tahoma>HTH</FONT></P>
<P><FONT size=2 face=Tahoma>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CyclingFoodmanPA replied on Wednesday, October 21, 2009</h2><P>Scott,</P>
<P>Thanks for the info.&nbsp; You were right.&nbsp; I rechecked page 94 of Julia's book and sure enough it was an existance check.&nbsp; I have written the following utilizing the where method, but am getting a number of errors.&nbsp; If anyone could steer me in the right direction, I would be most greatful.&nbsp; I am trying to return a particular NYMEXProduct record and a number of NYMEXHistory records after a certain date.&nbsp; The NYMEXHistory table has a FK to NYMEXProduct.&nbsp; Here is my LINQ query with errors:<BR><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2><BR>DateTime</FONT></FONT><FONT size=2> dt = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DateTime</FONT></FONT><FONT size=2>.Now.AddDays(-7);<BR></FONT></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>NYMEXProduct</FONT></FONT><FONT size=2> data = (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> record </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> context.ObjectContext.NYMEXProducts.Include(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"NYMEXHistories"</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where</FONT></FONT><FONT size=2> record.NYMEXProductId == criteria.Value <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; record.NYMEXHistories.Where((NDate) =&gt; NDate.NYMEXDate &gt; dt))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select record).FirstOrDefault();</FONT></P>
<P><FONT size=2>I know by the error messages that I am incorrectly building the LINQ query, but not sure how to correctly do it.&nbsp; My SQL query is as follows that work:<BR>SELECT np.*, nh.*<BR>FROM dbo.NYMEXProduct np<BR>INNER JOIN dbo.NYMEXHistory nh ON nh.NYMEXProductId = np.NYMEXProductId<BR>WHERE np.NYMEXProductId = 4<BR>AND nh.NYMEXDate &gt; '10/14/2009'<BR><BR>Any recomendations for my LINQ Query would be most appriciated.&nbsp; I know I am close and have been searching for an example but cannot find one.&nbsp; Essentially, I am filtering an Entity Collection.</FONT></P>
<P><FONT size=2>CyclingFoodmanPA</FONT></P>
<P><FONT size=2>&nbsp;</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
