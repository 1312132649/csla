<html><header><title>Edit level mismatch in CopyState</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Edit level mismatch in CopyState</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4745.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies posted on Thursday, April 24, 2008</h2><P><FONT face=Arial size=2>Hello all.</FONT></P>
<P><FONT face=Arial size=2>I have been tryin out CSLA for a new project and like it very much indeed, so much to offer for LOB applications which is major plus, especially the reduced amount of code for the UI developer!&nbsp;So far so good, but i suspect databinding might make it a tad bit unpleasant if not applied correctly. :)</FONT></P>
<P><FONT face=Arial size=2>I have run into one error that i just cannot seem to get around especially when saving child objects as a property of a parent object.</FONT></P>
<P><FONT face=Arial size=2>When trying to save my parent object (Businessbase) with the child objects(BusinessListbase) i get a error "<STRONG>Edit level mismatch in CopyState".</STRONG></FONT></P>
<P><FONT face=Arial size=2>When saving a parent object&nbsp;that does not have any childobjects, then the the save is successfull</FONT></P>
<P><FONT face=Arial size=2>I am currently using cslavb-3.5.0-080403.</FONT></P>
<P><FONT face=Arial size=2>Thanks for your help!</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bmmathe replied on Thursday, April 24, 2008</h2><P>Are you using WinForms binding? You have to make sure to set the binding sources RaiseListChangeEvents to false.&nbsp; Also in 3.5 Rocky uses a method called UnbindBindingSource that sets the datasource of the root's binding source to null and calls EndEdit() on the bindingsource before the save takes place.&nbsp; Check out PTracker.&nbsp; </P>
<P>I got around this issue but now I'm having the exact same error when saving a root object that has a grand children.&nbsp; Parent &gt; Child Collection &gt; Child &gt; Child Collection &gt; Child.&nbsp; When a grandchild is present the exception is thrown.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Thursday, April 24, 2008</h2><P><FONT face=Arial size=2>I am actually using the PTracker as a sample and do infact use the UnbindBindingSource helper method. The root object saves when using the helper method, but when saving a root object with a&nbsp;child collection&nbsp;it fails with the mismatch in copyState.</FONT></P>
<P>&nbsp;</P>
<P><FONT face=Arial size=2></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AzStan replied on Thursday, April 24, 2008</h2><P>Here's an obscure thing to check:&nbsp; If you have an error provider on your bound form, make sure it is properly hooked up to the business object.</P>
<P>I tore my hair out for a week trying to find this one - my winform base class had an error provider on it, but I was sloppy&nbsp;and didn't always&nbsp;hook it up.&nbsp; For some reason, it interacted with the data binding and caused the edit level mismatch with the child objects.&nbsp; I never figured out why, but the results were black and white.&nbsp; Other data bound UI controls might have similar interactions.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Friday, April 25, 2008</h2><P><FONT face=Arial size=2>Very obscure thing indeed and i find it hard to believe that the lack of an error provider would cause the error as&nbsp;I do have an error provider on my windows form.</FONT></P>
<P><FONT face=Arial size=2>The issue seems to be after saving or undoing what I have changed and then rebinding the UI and setting the BeginEdit method on the root object.&nbsp; I use the exact same approach as the PTracker sample for 3.5.</FONT></P>
<P><FONT face=Arial size=2></FONT>&nbsp;</P><FONT face=Arial size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>Private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> BindUI()<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;<FONT color=#ff0000>&nbsp;</FONT></FONT><FONT size=2><FONT color=#ff0000>_user.BeginEdit()&nbsp;&nbsp; &lt;&lt;&lt;&lt;--</FONT><FONT color=#ff0000>-----</FONT><BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.UserBindingSource.DataSource = _user</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT></FONT>
<P><FONT face=Arial size=2></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Monday, April 28, 2008</h2><P><FONT face=Arial size=2>I am guessing it must be something that I am doing wrong as I am replicating whats been done in the PTraker application. Will investigate more closely and hopefully spot what I am doing wrong.</FONT></P>
<P><FONT face=Arial size=2>The Error provider next to the field updated does indicate "index 0 does not have a value"</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Joffies replied on Monday, April 28, 2008</h2><P><FONT face=Tahoma size=2>After a closer inspection it turns out i did not add a second bindingsource for my Roles property on my windows form. It all works now. :)&nbsp;A seperate bindingsource is needed for each property that represents child objects.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Tuesday, June 09, 2009</h2><P>I am in a similar situation and thought I would ask for some help.&nbsp; We have a typical Client object with Child objects (Contacts, Contact, Addresses, Address).&nbsp; Our main WinForm contains a split container.&nbsp; Panel 1 has a TreeView which we populate it with Applicant Name (Root), "Address Summary" (Child Node&nbsp;of Applicant Name), Individual Address (Child Node&nbsp;of Address Summary), Contact Summary&nbsp;(Child Node of Applicant Name) and Individual Contact (Child Node of Contact Summary).</P>
<P>Panel 2 populates custom Controls (WinParts) based on which node is selected on the TreeView.&nbsp; The WinForm contains the Bind(), ReBuid() routines for the Parent CSLA object.&nbsp; The controls are created and passed in the respective object for modification.</P>
<P>When we modify the parent object Applicant it successfully saves and updates.&nbsp; When we select a child object in the TreeView (i.e. a specific contact) and attempt to save we recieve "Edit Level Mismatch in CopyState" error in the call the BindUI() when it executes Applicant.BeginEdit().</P>
<P>We want to be able to modify any object (parent, child, grandchild) but only save the details when the user clicks on the Save Icon/Menu/Button.</P>
<P>Each custom control has Binding Source Controls but only in the WinForm do we call the BeginEdit.&nbsp; I've traced the error to BusinessListBase.CopyState.&nbsp; The EditLevel + 1 &gt; parentEditLevel.&nbsp; Any idea how the current EditLevel was assigned 1?</P>
<P>Any other design or alternative ideals?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 10, 2009</h2><P>Data binding will elevate your edit levels (and decrease them too) following its own rules.</P>
<P>When using Windows Forms, it is critical that you understand how data binding interacts with your objects or you'll have a very rough time.</P>
<P>There's a thread from perhaps 2-3 years ago where several people on this forum worked very hard to isolate all the rules. I took that information, applied it to CSLA 3.0 and also wrote a chapter summarizing the findings in the <A href="http://store.lhotka.net">Using CSLA .NET 3.0</A> ebook.</P>
<P>Miguel Castro subsequently took that information and created the CslaActionExtender control that you'll find in CSLA 3.6, and that control is discussed in the <EM>Expert 2008 Business Objects</EM> book.</P>
<P>Even CslaActionExtender isnt' a silver bullet - it doesn't automate every type of UI layout. But it does automate the more common UI layouts (single object, list of objects, master-detail, master-detail-detail and so forth).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Wednesday, June 10, 2009</h2><P>Thanks Rocky,</P>
<P>I'll have another look at the eBook (it's been some time since I've read that section).</P>
<P>We haven't (yet) upgraded to the latest version of CSLA as we are still utilizing 3.5 but I might have a quick gander at the CslaActionExtender and the details in your latest book.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
