<html><header><title>Having Problems with ObjectFactory</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Having Problems with ObjectFactory</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10362.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Wednesday, May 11, 2011</h2><p>So far I have worked exclusively with In-Object ADO dataaccess with tremendous success.<br />I am now confronted with a situation where nothing but an ObjectFactory would do for data access.&nbsp; I only need to Fetch - no updates or inserts are needed.&nbsp; Pretty simple, I&#39;d say.</p>
<p>&nbsp;I have followed the InventoryDemo exactly, but my Fetch method in the DAL project is never called.&nbsp; I am now using a tiny &quot;test&quot; Solution with EFrameServer and EFrameClient libraries with a single class: EFrame and a Data access library called DAL with one class called PersomName.&nbsp; Here&#39;s the code in all.</p>
<p><strong>EFrame:<br /></strong>namespace FrameLibrary<br />{<br />&nbsp;&nbsp;&nbsp; [Serializable]<br />&nbsp;&nbsp;&nbsp; [Csla.Server.ObjectFactory(&quot;DAL.PersonName, DAL&quot;)]<br />&nbsp;&nbsp;&nbsp; public partial class EFrame : ReadOnlyBase&lt;EFrame&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;string&gt; DefaultNameProperty = RegisterProperty&lt;string&gt;(c =&gt; c.DefaultName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string DefaultName<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(DefaultNameProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br />}</p>
<p><strong>EFrame.Client:<br /></strong>namespace FrameLibrary<br />{<br />&nbsp;&nbsp;&nbsp; public partial class EFrame : Csla.ReadOnlyBase&lt;EFrame&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void GetEFrame(EventHandler&lt;DataPortalResult&lt;EFrame&gt;&gt; callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.BeginFetch&lt;EFrame&gt;(callback);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p><strong>EFrame.Server:</strong><br />namespace FrameLibrary<br />{<br />&nbsp;&nbsp;&nbsp; public partial class EFrame : Csla.ReadOnlyBase&lt;EFrame&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p><strong>DAL:</strong><br />namespace DAL<br />{<br />&nbsp;&nbsp;&nbsp; public class PersonName : ObjectFactory<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public EFrame Fetch()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var frm = new EFrame();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(frm, EFrame.DefaultNameProperty, &quot;Name Is Object Factory&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return frm;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p><strong>The error I am getting is:</strong><br />An Error Has Occured<br />DataPortal.Fetch failed (Factory type or assembly could not be loaded (DAL.PersonName, DAL))<br /><br />What am I missing?&nbsp; Thanks.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, May 11, 2011</h2><p>.NET is quirky in how you specify a fully qualified class name. </p>
<p>There can be no whitespaces after comma before assemblyname:</p>
<p>&nbsp; Must be:&nbsp; [Csla.Server.ObjectFactory(&quot;DAL.PersonName,DAL&quot;)]</p>
<p>If ObjectFactory still fails try to add a criteria parameter to Fetch method (I believe this should not&nbsp; be required) and change return type to object</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public object Fetch(object criteria)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var frm = new EFrame();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(frm, EFrame.DefaultNameProperty, &quot;Name Is Object Factory&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return frm;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>Thanks Johny,</p>
<p>Removing the space and adding the criteria parameter did not help - I still get the same exact error.&nbsp; </p>
<p>I have been pouring over Rocky&#39;s Csla4 Series of DataAccess book.&nbsp; On Page 8 he says:</p>
<p><span style="font-size:small;">&quot;As with the encapsulated models, if you implement an object factory that will run on Silverlight or WP7 the methods must accept a callback parameter that is invoked when the method is complete. &quot;</span></p>
<p>He also gives an example:<br />public void Fetch(int id, Csla.DataPortalClient.LocalProxy&lt;PersonEdit&gt;.CompletedHandler handler)<br />{</p>
<p>}<br />&nbsp;But from Csla 4.2 sample I do not see that being done. So I am confused.</p>
<p>Javed</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>I thought I will try what the book says.&nbsp; But the following line was not acceptable:</p>
<p>public EFrame Fetch(Csla.DataPortalClient.LocalProxy&lt;EFrame&gt;.CompletedHandler handler)<br />{<br />}</p>
<p>The error says: <br />The non-generic type &#39;Csla.DataPortalClient.LocalProxy&#39; cannot be used with type atguments</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 11, 2011</h2><p>You should only worry about the CompletedHandler parameter if your factory code is running on the Silverlight client. If your factory code is running on a .NET application server (even if called by a SL client) then there&#39;s no such parameter.</p>
<p>If the data portal can&#39;t create the factory object or call the method, it will throw an exception. Do you have proper exception handling set up so you are notified about the failure? That would help debugging quite a lot.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>Here is the more complete error.&nbsp; </p>
<p>An Error Has Occured</p>
<p>Csla.DataPortalException: DataPortal.Fetch failed (Factory type or assembly could not be loaded (DAL.PersonName,DAL))</p>
<p>&nbsp;&nbsp; at Csla.Server.ObjectFactoryLoader.GetFactory(String factoryName) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\ObjectFactoryLoader.cs:line 55</p>
<p>&nbsp;&nbsp; at Csla.Server.FactoryDataPortal.InvokeMethod(String factoryTypeName, String methodName, DataPortalContext context) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\FactoryDataPortal.cs:line 58</p>
<p>&nbsp;&nbsp; at Csla.Server.FactoryDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\FactoryDataPortal.cs:line 138</p>
<p>&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\DataPortal.cs:line 245</p>
<p>&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\DataPortal.cs:line 186</p>
<p>&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.SilverlightRequestProcessor.Fetch(SilverlightCriteriaRequest request) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\Hosts\Silverlight\SilverlightRequestProcessor.cs:line 144</p>
<p>System.InvalidOperationException: Factory type or assembly could not be loaded (DAL.PersonName,DAL)</p>
<p>&nbsp;&nbsp; at Csla.Server.ObjectFactoryLoader.GetFactory(String factoryName) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\ObjectFactoryLoader.cs:line 55</p>
<p>&nbsp;&nbsp; at Csla.Server.FactoryDataPortal.InvokeMethod(String factoryTypeName, String methodName, DataPortalContext context) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\FactoryDataPortal.cs:line 58</p>
<p>&nbsp;&nbsp; at Csla.Server.FactoryDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in E:\MyDocuments\Visual Studio 2010\Projects\Csla4.0\Source\Csla\Server\FactoryDataPortal.cs:line 138</p>
<p>Javed</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 11, 2011</h2><p>It sounds like the assembly containing your factory class isn&#39;t in the web server&#39;s bin folder.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>It looks like the issue may be related to the old crossdomain / clientaccesspolicy issue.&nbsp; </p>
<p>The code I posted above was from a tiny test project.&nbsp; Originally I had not referenced the DAL project in my Web project.&nbsp; But now I can see the DAL dll in the bin folder and still I see the error.</p>
<p>When working with my original project, as I was walking through the csla code just now, I came across an error that talks about this being a crossdomain access issue.&nbsp; I saw this error many a month ago (still remember the headaches it caused then)&nbsp;and have always had both those files in my web project.&nbsp; I have now copied both files in the test web project also, and I am getting the same exact error.</p>
<p>In the test project I am using the CslaDataProvider.&nbsp; But in my main Solution the call for the data originates from a ViewModel&#39;s constructor.</p>
<p>Javed</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>Here is the complete text of the error.&nbsp; The crossdomain thing must be a red herring since I am working on my local machine, and not even in iis but in the development server.&nbsp; What I am trying to get from the ObjectFactory is a ReadOnlyList.&nbsp; I see this error in:</p>
<p>dp.FetchCompleted += (o, e) =&gt;<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp; }</p>
<p>Here e.Object is null and bring the mouse over e displays the following as the DataPortalResult err:</p>
<p>{: An error occurred while trying to make a request to URI &#39;http://localhost:7371/WcfPortal.svc&#39;. This could be due to attempting to access a service in a cross-domain way without a proper cross-domain policy in place, or a policy that is unsuitable for SOAP services. You may need to contact the owner of the service to publish a cross-domain policy file and to ensure it allows SOAP-related HTTP headers to be sent. This error may also be caused by using internal types in the web service proxy without using the InternalsVisibleToAttribute attribute. Please see the inner exception for more details.<br />&nbsp;&nbsp; at System.ServiceModel.AsyncResult.End[TAsyncResult](IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.EndCall(String action, Object[] outs, IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.ChannelBase`1.EndInvoke(String methodName, Object[] args, IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.WcfPortalClientChannel.EndFetch(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.Csla.WcfPortal.IWcfPortal.EndFetch(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnEndFetch(IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.OnAsyncCallCompleted(IAsyncResult result)<br />: <br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelAsyncRequest.CompleteGetResponse(IAsyncResult result)<br />: Security error.<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.&lt;&gt;c__DisplayClass5.&lt;EndGetResponse&gt;b__4(Object sendState)<br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.&lt;&gt;c__DisplayClass4.&lt;BeginOnUI&gt;b__1(Object sendState)<br />}</p>
<p>The innerexception is null.</p>
<p>Javed</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>My little demo project is now working.&nbsp; Looks like it was just a matter of getting ALL my ducks in a row - not a trivial thing sometimes.&nbsp; Now on to my &quot;real thing&quot; project.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, May 11, 2011</h2><p>What is the UI and runtime framework for your client? </p>
<p>Also&nbsp; make sure that DAL.dll is present in the bin folder on the server side code (WCF Service) ?.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Wednesday, May 11, 2011</h2><p>Rocky,</p>
<p>I will set up exception handling to see where the error is.&nbsp; When I tried to step through the Csla code, however, I did not come accross any exception.&nbsp; In fact it is as if there was no attempt to go to the factory class.&nbsp; I have a breakpoint in the factory method and it is never hit.&nbsp; The silverlight page displays with no data (whiich is expected) and there is a little box with the error that I reported on my first post.</p>
<p>Johny,</p>
<p>I am using VS 2010 (Not SP 1), Framework 4, SL 4,&nbsp; VS Delopment Sever.&nbsp; The Solution I am using is absolutely the minimal SL App you can ever create.&nbsp; It works fine&nbsp;when the DataPortal_Fetch is not .Server code.</p>
<p>Javed</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
