<html><header><title>Lazy Loading Example</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Lazy Loading Example</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1799.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ltgrady posted on Monday, November 20, 2006</h2><P>I have a Product Object.&nbsp; The object has about 350 properties.&nbsp; Now before we go further let me justify that consider the threads I've ready through on the forum that pertain to lazy loading.&nbsp; Each of our products has the potential to use these fields.&nbsp; Shipping fields, pricing fields, sales and shipping policies, manufacturing information, electronic standards information, product dimensions and weights, etc., etc., etc..&nbsp; In our industry distributors have spec sheets that may have anywhere from a half dozen to a fifty pieces of information they ask for and each sheet is different (there are over 100 spec sheets in the system currnetly and growing all the time).&nbsp; </P>
<P>Our suppliers, who maintain their prodcut information all ask for different sets of information.&nbsp; Someone selling sporting goods uses many different fields than someone selling electronics or silverware or food packages.&nbsp; They're using an asp.net interface that uses dynamically built GridView bound to CSLA objects.&nbsp; They select from 170 different "groupings" of these fields (the same field can be in many groups) to enter and maintain the data that they want to use.&nbsp; It's a lot of information and it takes a lot of work to group it logically in a way that makes things easy for our users to find.&nbsp; </P>
<P>We can't have a diferent object for each field group because people can create custom groups themselves with a field picker (plus there are already 170 of them).&nbsp; The grids binds to the Product object that contains every field.&nbsp; The Field Group they choose uses SQL data to dynamically create the GridView and validation controls which is then bound to that Product object.</P>
<P>We have a single field that is&nbsp;probalby only going to be used perhaps 20% of the time.&nbsp; This field&nbsp;is a&nbsp;very complicated calculation that will require us to add three or four tables to our _Select stored procedure and use dynamic sql in the stored procedures to calculate the value.</P>
<P>I would REALLY like to lazy load the field so that when I call a collection of 100 products, all with those 350 fields already loading, I don't have to add this very costly field unless it's absolutely necessary.</P>
<P>Does anyone have a decent example of this.&nbsp; I see a lot of lazy load discussion and some examples for loading a child collection (which I do elsewhere in teh app) but I'm unsure of the "right" way of going about this.&nbsp; I'm not sure whether to call teh _Fetch command again when the Get on this property is called and run a different SProc, or whether to create an object whose only function is to retrieve this value and use that?&nbsp; Any advice on how I should do this?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Monday, November 20, 2006</h2>How about decomposing this huge monolithic thing in a workflow? <br><br>From your story I get the impression things are spiraling out of control rapidly. And your request for a lazy-loaded property is just the first sign of much more worse stuff yet to come.<br><br>Apparently you are trying to cover ALL dynamics of your system in just 1 object and 1 view. <br><br>What if you would (massively) decompose this single view in a number of separate use cases (i.e. interaction steps) where the user gets from to the desired end-result in a step-by-step fashion ...? <br><br>With a workflow you would be able to capture the dynamics and then you can also ensure that only those (heavy-weight) routines run that actually need to run.<br><br>Bayu<br><br>Edit:<br>I forgot to answer your original question. Sorry for that!<br><br>You would need a local boolean variable that tells you if a particular property has been fetched from the DB yet or not. Upon first request you would execute a specific command to your DB that does what you need.<br><br>As an example, see my function that checks if a particular instance (defined by ID) exists in the DB. It uses an inner class that derives from CommandBase. Modifying it to your needs should be trivial:<br><br>&nbsp;&nbsp;&nbsp; Public Shared Function Exists(ByVal id As Guid) As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim result As ExistsCommand = DataPortal.Execute(Of ExistsCommand)(New ExistsCommand(id))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return result.Exists<br>&nbsp;&nbsp;&nbsp; End Function<br><br>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<br>&nbsp;&nbsp;&nbsp; Private Class ExistsCommand<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Inherits CommandBase<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Private _ID As Guid<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Private _Exists As Boolean<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Public Sub New(ByVal id As Guid)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Me._ID = id<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Public ReadOnly Property Exists() As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return Me._Exists<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Protected Overrides Sub DataPortal_Execute()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New MySqlConnection(Database.CrmDBConnection(True))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As MySqlCommand = cn.CreateCommand<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.Text<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = "SELECT COUNT(CustomerID) FROM Customer WHERE CustomerID = @id"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Add("?id", Me._ID)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim count As Integer = CInt(cm.ExecuteScalar)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me._Exists = (count &gt; 0)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; End Class<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Monday, November 20, 2006</h2>In addition to my previous post:<br><br>Last week dotnet 3.0 was released. It comes with the Windows Workflow Foundation. You might draw inspiration from it in case you would want to try out a more interactive design. <br><br>See also:<br>- <a href="http://wf.netfx3.com/">http://wf.netfx3.com/</a><br>- <a href="http://www.netfxguide.com/">http://www.netfxguide.com/</a><br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Monday, November 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ltgrady:</strong></div><div>
<P>I have a Product Object.&nbsp; The object has about 350 properties.&nbsp;</div></BLOCKQUOTE></P>
<P>Um...&nbsp; Do you really have 350 properties, with 350 getters and setters?&nbsp; </P>
<P>I'm wondering if this couldn't be designed as a collection instead of hard-coded properties.</P>
<P>(Or is that what you already have?)</P>
<P>The collection would have "Group Header" and "Field Label" and "Field Value".&nbsp; The user would enter in the "Field Value".&nbsp; With a bit of cleverness, the collection could actually feed a some type of tree control so the user would&nbsp;be able to focus on different Group Headers at a time.</P>
<P>This would have the advantage of being way more dynamic, as the list of Fields needed for that could be loaded in from some meta-data tables.</P>
<P>With the addition of a "LoadedYet" property to the collection, your UI could know whether to ask for those values to be loaded or not when the group with your "slow-loading values" gets expanded.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
