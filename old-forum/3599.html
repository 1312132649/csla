<html><header><title>server side processing question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>server side processing question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3599.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets posted on Wednesday, September 26, 2007</h2><P>Hello,</P>
<P>I searched the forum for about 2 hours, and didn't find any answer. My application should be prepared for getting to be used in a network with an application server and maybe in the future a database server.</P>
<P>To do this, I need to know how I can create&nbsp;a document number that is unique. Not a Guid. It going to be&nbsp;something like doc001, doc002, doc003&nbsp;and so on. This number&nbsp;is&nbsp;will&nbsp;be created with a business object, and should be accessed by all clients to retrieve that document number with a static method. The business object then increases the number by 1.When the application shuts down, the object writes the last used document number to the database. When the application starts up, the object fetches the number from the database.</P>
<P>This sounds like a simple business object, but&nbsp;I cann't figure out where I must place it in my code. The business object has to run on the application server, but should also work on a stand alone computer.</P>
<P>Can I call&nbsp;the factory method from&nbsp;such an&nbsp;object within the DataPortal_Create() factory-method? And can I still do this when the dataportal runs local?</P>
<P>Thanks.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, September 26, 2007</h2>There are a couple of options for doing this.&nbsp; I believe the most common&nbsp;is to have the create method assign a negative number for the document and when the dataportal insert is called, it would then assign a permanent number to the document.&nbsp; Another option would work if your application can always connect to the server, would be to create a web service that would&nbsp;give out unique ids.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets replied on Wednesday, September 26, 2007</h2><P>I'm not talking about a primary key or id. Just a property that gets its value from another object using a factory method. That object holds the last given number and creates a new number by&nbsp;incrementing the last used number with 1. </P>
<P>The purpose here is to serve multiple clients with a sequence of unique numbers. Something like global static properties. And it should run on either the application server or on a stand alone computer.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, September 26, 2007</h2>Maybe I'm not understanding what you are trying to do completely.&nbsp;The methods I stated would work for any property.&nbsp; It would be difficult to implement something like this without interaction with a server.&nbsp; You would hit the server each time you need a document number via dp_execute, web service, db call.&nbsp; If you want to wrap that in a factory, that would work too.&nbsp; If you are working away form a server, you would have to come up with a different naming convention for each client, or have each client reserve some numbers.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets replied on Wednesday, September 26, 2007</h2><P>Well, I'm gone try to explain what I am looking for. Imagin a dozen clients working with an application server. All these clients can create a shipping document. That document is not an object, just a printed document. That document should have a number on it. The only way I can think off&nbsp;having a&nbsp;sequential range of numbers created when all these clients print documents, is to have an object on the application server that calculates a new document number every time a client asks for that number. Beside this, the user of my programm should be able to change that document number when he/she starts using my programm. Maybe the user wants to start with a document number 4123, for what reason he may have. </P>
<P>I'm trying to figure out how i can use an object on the application server that stays alive as long as the server runs. It shoult use static values, or factory methods to pass values back to the client. I just don't now how to create that object on te server and how to keep it running. I never&nbsp;programmed a server side before. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Wednesday, September 26, 2007</h2><P>Think about it like.... all code you put in the DataPortal_XYZ methods will be ran on the serverside, this thought&nbsp;extends to methods called by these DataPortal_XYZ methods, like the ExecuteFetch(), FetchChildren(), etc... (<EM><FONT>as long as these same methods are not called by other methods that are NOT DataPortal_XYZ!!</FONT></EM>)</P>
<P>so just code the class that serves the number like follows:&nbsp;(stick to only using this on the DP_XYZ methods)</P>
<P>_docNumberProperty = NumberGenerator.GetNextNumber();<BR><FONT color=#006400>// this class does not even need to inherit from BusinessBase because it will never use the dataportal, it is already always in the server.</FONT></P>
<P><FONT color=#000000>that should cover both Local and n-tier configurations</FONT></P>
<P>... about letting the end user specify the beginning number, then my proposal needs some kind of override to not use the .GetNextNumber() static method.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, September 26, 2007</h2><P>Ah, that makes more sense.&nbsp;&nbsp;</P>
<P>If you are using remoting with csla, any code being run in the dataportal&nbsp;is run on the server.</P>
<P>If you aren't using remoting, probably the simplest way would be to create a web service on the server (This option is only available if you have a web server on your server).&nbsp; Web service projects are simple to create and there are plenty of examples out there.&nbsp; This takes care of the server staying alive, etc.&nbsp; On the web service you would have a method such as GetNextDocNumber.</P>
<P>Your client objects would&nbsp;then connect to the web service and call that method which would return the next number.&nbsp; This takes just a few lines of code.</P>
<P>Now for the nuts and bolts of the GetNextDocNumber.</P>
<P>You need a place to store the current number, in case the server goes down, when it starts up again, you don't want it to start at 1 again.&nbsp; You could put the number in an xml document, or in a database.</P>
<P>When the user calls GetNextDocNumber, you would grab the number from whatever location you are storing it, save the incremented number, then return the number to the user.&nbsp; If you are putting the number in an xml doc, you will need to be careful with threading issues, such as 2 clients getting a number at the same time.</P>
<P>There are a number of things you could do to optimize this, but this should get you started.&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ton Smeets replied on Thursday, September 27, 2007</h2><P>The application server should run in a LAN. And its now clear&nbsp;when using the dataportal the code should run on the server. But when there is no client logged in, the server should keep these static variables in memory. It should remain state.</P>
<P>Is this going to happen, or do&nbsp;I need some programming for this?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Friday, September 28, 2007</h2><P>on my previous proposal, the .GetNextNumber() method would take care of that persistence, </P>
<P>I would go for updating a table or updating a text file instead of leaving it to the app server memory, which I think could end up with more IFs and Catches in the long run...</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
