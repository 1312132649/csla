<html><header><title>CSLA load on demand</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA load on demand</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6824.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Slayer posted on Monday, April 20, 2009</h2>Hi everybody,<br /><br />I have a Customer(parent)  object which contains a collection of Orders(child) objects. I would like to load the Order collection on demand. So the Orders collection is loaded only when Customer.Orders property is invoked. My IsDirty code would look something like this:<br /><br />public override bool IsDirty<br />{<br />        bool isOrdersDirty = false;<br /><br />        if(_Orders != null)<br />        {<br />                isOrdersDirty = _Orders.IsDirty;<br />        }<br /><br />        return base.isDirty || isOrdersDirty;<br />}<br /><br />I am having problems with my Customer.BeginEdit() however.<br />When the BeginEdit method is invoked before the Orders collection is loaded, this could result in a mess. <br /><br />Does anybody have any ideas on this matter.<br /><br />Thanks</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, April 20, 2009</h2>Search the forum for lazy loading.  Csla supports lazy loading, you just have to follow the proper pattern (and since I don't use lazy loading, I can't tell you exactly :-)  )</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Paul Czywczynski replied on Monday, April 20, 2009</h2>Here is the pattern we're using on CSLA 3.0.x. In this example we are doing three things. First we declare a private property to cache the branch list so we don't have to fetch it again. Second we mark the private property as NonSerialized so it isn't shuttled across the wire back to the dataportal in 3 tier mode on insert, update, delete operations. Learned that one the hard way. Third we lazy load the branch list by calling GetBranchCollection only when the BranchList getter is called and our _branchList cached property is null.<br><pre><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [NonSerialized()]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private BranchCollection _branchlist;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public BranchCollection BranchList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty("BranchList");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_branchlist == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _branchlist = BranchCollection.GetBranchCollection();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _branchlist;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</pre><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, April 20, 2009</h2><P>That isn't sufficient in 3.0.x though, if the parent object is at EditLevel &gt; 0.</P>
<P>I've discussed this on other threads as well, but what you need to do (prior to 3.5 with the field manager) is manually ensure that the new child's edit level is the same as the parent before you return it. This is a couple while loops like</P>
<P>while (this.EditLevel &gt; newChild.EditLevel) newChild.BeginEdit();<BR>while (this.EditLevel&nbsp;&lt; newChild.EditLevel) newChild.ApplyEdit();</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
