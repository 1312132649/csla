<html><header><title>Utilities.CallByName method with CallType.Set fails with ArgumentNullException</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Utilities.CallByName method with CallType.Set fails with ArgumentNullException</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2040.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>twistedstream posted on Thursday, December 28, 2006</h2><P>I'm attempting to use the CallByName method in the CSLA.NET 2.0 Utilities class to set the value of a property in a late-bound fashion:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New" size=2>Utilities.CallByName(myBo, CallType.Set, "PropertyName", "my value");</FONT></P></BLOCKQUOTE>
<P>No matter how I invoke CallByName with CallType.Set, it always throws an ArgumentNullException.&nbsp; Digging into the CSLA.NET source, I think I can see why:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New" size=2>case CallType.Set:<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;PropertyInfo p = target.GetType().GetProperty(methodName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;object[] index = null;<BR>&nbsp;&nbsp;&nbsp;&nbsp;args.CopyTo(index, 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;p.SetValue(target, args[0], index);<BR>&nbsp;&nbsp;&nbsp;&nbsp;return null;<BR>&nbsp; }</FONT></P></BLOCKQUOTE>
<P>The variable&nbsp;<FONT face="Courier New" size=2>index</FONT> is never referencing an array instance, yet is passed into the CopyTo method of the <FONT face="Courier New" size=2>args </FONT>array.&nbsp; According to the documentation for <A href="http://msdn2.microsoft.com/en-us/library/06x742cw.aspx">Array.CopyTo</A>, passing null for the destination array will cause this exception to be thrown.</P>
<P>Is this a bug?</P>
<P>~pete</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gbahns replied on Tuesday, March 27, 2007</h2><P>Pete,</P>
<P>I just ran into this same problem.&nbsp; It appears that it's a bug in the CallByName method, but not a bug in CSLA per se since the method is never used to set property values.&nbsp; You probably answered this for yourself three months, but for the benefit of others, the "index" local variable and associated "args.CopyTo" statement are not needed, and "null" can be passed as the third argument to p.SetValue.</P>
<P>Alternatively, I think what was originally intended was the following:</P><FONT size=1></FONT><FONT size=1>
<P></FONT><FONT color=#0000ff size=1>case</FONT><FONT size=1> </FONT><FONT color=#2b91af size=1>CallType</FONT><FONT size=1>.Set:<BR>{<BR></FONT><FONT color=#2b91af size=1>PropertyInfo</FONT><FONT size=1> p = target.GetType().GetProperty(methodName);<BR></FONT><FONT color=#0000ff size=1>object</FONT><FONT size=1>[] index = </FONT><FONT color=#0000ff size=1>null</FONT><FONT size=1>;<BR></FONT><FONT color=#0000ff size=1>if</FONT><FONT size=1> (args.Length &gt; 1)<BR>{<BR>index = </FONT><FONT color=#0000ff size=1>new</FONT><FONT size=1> </FONT><FONT color=#0000ff size=1>object</FONT><FONT size=1>[args.Length - 1];<BR>args.CopyTo(index, 1);<BR>}<BR>p.SetValue(target, args[0], index);<BR></FONT><FONT color=#0000ff size=1>return</FONT><FONT size=1> </FONT><FONT color=#0000ff size=1>null</FONT><FONT size=1>;<BR>}</P></FONT>
<P>I haven't tested this because I don't need it, so if you use it please test it first.</P>
<P>Greg</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
