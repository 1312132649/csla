<html><header><title>Best practice for creating a ReadOnlyListBase object for a unit test</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Best practice for creating a ReadOnlyListBase object for a unit test</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10436.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Doug Ramirez posted on Monday, June 13, 2011</h2><p>I&#39;m interested to hear about what other people have done when instantiating a ReadOnlyListBase object for a unit test. &nbsp;For example, I have a couple of command objects that use readonly lists. &nbsp;I am finally getting around to creating unit tests for the command objects. &nbsp;The command object accepts a readonly list as a param, so I need to create a readonly list with some test data, but I can&#39;t because, well, it&#39;s readonly.</p>
<p>I tried using private accessors but that really doesn&#39;t work because the command object doesn&#39;t accept MyList_Accessor as a param, for example.</p>
<p>I thought about adding some test helpers methods to the RO list, but that is clearly a hack that I don&#39;t want to propagate.</p>
<p>Any advise is greatly appreciated. &nbsp;Code snippets, if applicable, are much appreciated too.</p>
<p>Doug</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Doug Ramirez replied on Tuesday, June 14, 2011</h2><p>Anyone have any good ideas about this?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, June 14, 2011</h2><p>You could build &quot;test&quot; objects using an ObjectFactory derived class to generate the lists or different versions of the list. </p>
<p>Rocky recommends to use &quot;public&quot; constructors and when combined with ObjectFatory will give you easy code.</p>
<p>ObjectFactory class provides access to: </p>
<ul>
<li>LoadProperty</li>
<li>SetIsReadOnly </li>
</ul>
<p>and more ....</p>
<p>Example: </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">class</span>&nbsp;MyReadOnlyList : ReadOnlyListBase<span style="color:#006400;">&lt;</span>MyReadOnlyList<span style="color:#006400;">,</span>&nbsp;MyReadOnlyChild<span style="color:#006400;">&gt;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">class</span>&nbsp;MyReadOnlyChild : Csla<span style="color:#006400;">.</span>ReadOnlyBase<span style="color:#006400;">&lt;</span>MyReadOnlyChild<span style="color:#006400;">&gt;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#a52a2a;">static</span>&nbsp;<span style="color:#a52a2a;">readonly</span>&nbsp;PropertyInfo<span style="color:#006400;">&lt;</span><span style="color:#ff0000;">string</span><span style="color:#006400;">&gt;</span>&nbsp;NameProperty = RegisterProperty<span style="color:#006400;">&lt;</span><span style="color:#ff0000;">string</span><span style="color:#006400;">&gt;(</span>c =<span style="color:#006400;">&gt;</span>&nbsp;c<span style="color:#006400;">.</span>Name<span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">string</span>&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">get</span>&nbsp;<span style="color:#006400;">{</span>&nbsp;<span style="color:#000080;">return</span>&nbsp;<span style="color:#191970;font-weight:bold;">GetProperty</span><span style="color:#006400;">(</span>NameProperty<span style="color:#006400;">);</span>&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#a52a2a;">static</span>&nbsp;<span style="color:#a52a2a;">readonly</span>&nbsp;PropertyInfo<span style="color:#006400;">&lt;</span><span style="color:#ff0000;font-weight:bold;">int</span><span style="color:#006400;">&gt;</span>&nbsp;Num1Property = RegisterProperty<span style="color:#006400;">&lt;</span><span style="color:#ff0000;font-weight:bold;">int</span><span style="color:#006400;">&gt;(</span>c =<span style="color:#006400;">&gt;</span>&nbsp;c<span style="color:#006400;">.</span>Num1<span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;font-weight:bold;">int</span>&nbsp;Num1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8b4513;">get</span>&nbsp;<span style="color:#006400;">{</span>&nbsp;<span style="color:#000080;">return</span>&nbsp;<span style="color:#191970;font-weight:bold;">GetProperty</span><span style="color:#006400;">(</span>Num1Property<span style="color:#006400;">);</span>&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;<span style="color:#ff0000;">class</span>&nbsp;MyTestGenerator : ObjectFactory<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;font-weight:bold;">public</span>&nbsp;MyReadOnlyList&nbsp;<span style="color:#191970;font-weight:bold;">GetTestList1</span><span style="color:#006400;">()</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000080;">var</span>&nbsp;list =&nbsp;<span style="color:#008b8b;font-weight:bold;">new</span>&nbsp;<span style="color:#191970;font-weight:bold;">MyReadOnlyList</span><span style="color:#006400;">();</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#191970;font-weight:bold;">SetIsReadOnly</span><span style="color:#006400;">(</span>list<span style="color:#006400;">,</span>&nbsp;<span style="color:#008b8b;font-weight:bold;">false</span><span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000080;">var</span>&nbsp;child1 =&nbsp;<span style="color:#008b8b;font-weight:bold;">new</span>&nbsp;<span style="color:#191970;font-weight:bold;">MyReadOnlyChild</span><span style="color:#006400;">();</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#191970;font-weight:bold;">LoadProperty</span><span style="color:#006400;">(</span>child1<span style="color:#006400;">,</span>&nbsp;MyReadOnlyChild<span style="color:#006400;">.</span>NameProperty<span style="color:#006400;">,</span>&nbsp;<span style="color:#0000ff;">&quot;jonny&quot;</span><span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#191970;font-weight:bold;">LoadProperty</span><span style="color:#006400;">(</span>child1<span style="color:#006400;">,</span>&nbsp;MyReadOnlyChild<span style="color:#006400;">.</span>Num1Property<span style="color:#006400;">,</span>&nbsp;<span style="color:#00008b;">99</span><span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list<span style="color:#006400;">.</span><span style="color:#191970;font-weight:bold;">Add</span><span style="color:#006400;">(</span>child1<span style="color:#006400;">);</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#191970;font-weight:bold;">SetIsReadOnly</span><span style="color:#006400;">(</span>list<span style="color:#006400;">,</span>&nbsp;<span style="color:#008b8b;font-weight:bold;">true</span><span style="color:#006400;">);</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000080;">return</span>&nbsp;list<span style="color:#006400;">;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#006400;">}</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Doug Ramirez replied on Tuesday, June 14, 2011</h2><p>Thank you so much for the quick answer. &nbsp;</p>
<p>I see how this will work. &nbsp;It will require adding test code to the production library. &nbsp;And subsequently making the child object&#39;s properties public. &nbsp;Other than that, I think this will work. &nbsp;</p>
<p>In my case I created a separate MyReadOnlyTestList class file (.cs) and placed the class in it. &nbsp;I also had to use the factory methods to create the list and child object since those constructors are private (make sense?) and so I couldn&#39;t new them up.</p>
<p>I&#39;d still be interested in knowing if someone has a clever way to do this without doing anything to the BOs. &nbsp;I envision a scenario where someone would hand me a .dll and say &quot;Here ya&#39; go, write some tests for my library&quot;.</p>
<p>Doug</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, June 14, 2011</h2><p>The <em>Using CSLA 4: Data Access</em> ebook shows a couple ways to load objects using mock data - and the reason for that is to enable test scenarios.</p>
<p>The object factory approach is one - and if you are using modern coding styles you don&#39;t need to have public setters. You can also use a pluggable data layer with the DataPortal_XYZ methods, and so preserve encapsulation in a more obvious way.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, June 15, 2011</h2><p>Even if your BO&#39;s constructor is private you can still create instances using:</p>
<p>var list = (MyReadOnlyList) Activator.CreateInstance(typeof(MyReadOnlyList);<br />or<br />var list = (MyReadOnlyList) MethodCaller.CreateInstance(typof(MyReadOnlyList));</p>
<p>or you could even make all your constructor public.</p>
<p>I&#39;d still recommend to make the static <b>PropertyInfo </b>objects<i><b> public readonly</b></i> in scope.</p>
<p>The MyTestGenerator class can be places in your unit test project so you shouldn&#39;t need to add test code in the production library..</p>
<p>With ordinary editable objects - ObjectFactory exposes the BypassPropertyChecks that will allow you to load values into the BO as well as LoadProperty. <br />ReadOnly objects on the other will either have to use LoadProperty or expose a method to set internal field values. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
