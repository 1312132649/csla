<html><header><title>CSLA .NET 3.5 enhancement - property declarations</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA .NET 3.5 enhancement - property declarations</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3939.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka posted on Monday, November 26, 2007</h2><P>I mentioned this in a recent blog post, and it generated some discussion, so I want to post it here because my blog isn't really a good discussion forum.</P>
<P>In CSLA .NET 3.5 I am planning to simplify the way properties are declared. In most of my business objects the majority of lines of code are in property declarations. While they are almost all the same, I have always thought they were too long.</P>
<P>Additionally, the fact that the System.Diagnostics trick to get the property name has become increasingly problematic, and I am marking the overloads of CanReadProperty(), CanWriteProperty() and PropertyHasChanged() that use the trick as obsolete in 3.5 - so you'll get compiler warnings/errors when you try to use them.</P>
<P>So I want to do two things: simplify/reduce the code and require explicit property names (but without requiring the use of string literals).</P>
<P>As a side-issue, I want to make it easier to manage property friendly names in a manner such that they are available to the object, to the UI (optionally) and are localizable via string resources in your business assembly.</P>
<P>The result is a property (in class Customer) like this:</P>
<BLOCKQUOTE dir=ltr>
<P>Private Shared NameProperty As PropertyInfo(Of String, Customer) = _<BR>&nbsp; RegisterProperty("Name", "Customer name")<BR>Private _name As String = NameProperty.DefaultValue<BR>Public Property Name() As String<BR>&nbsp; Get<BR>&nbsp;&nbsp;&nbsp; Return GetProperty(Of String)(NameProperty, _name)<BR>&nbsp; End Get<BR>&nbsp; Set(ByVal value As String)<BR>&nbsp;&nbsp;&nbsp; SetProperty(Of String)(NameProperty, _name, value)<BR>&nbsp; End Set<BR>End Property</P></BLOCKQUOTE>
<P>GetProperty() and SetProperty() take care of authoriziation and calling PropertyHasChanged(), reducing all the old-style code down to these few lines. The Shared/static NameProperty field (an idea borrowed loosely from Microsoft's DependencyProperty scheme) minimizes the use of string literals throughout the code.</P>
<P>This scheme saves&nbsp;6 lines of code and adds 1 - so there's a net savings of&nbsp;5 lines of code per property. Over&nbsp;30% code savings per property. I think that's awesome! There's no room to trim anything at this point (well, none I see at the moment anyway).</P>
<P>Notice that the field is still declared as an instance field in the object. I could have managed the "fields" in a Dictionary&lt;string, object&gt; in the base class, but that'd incur boxing/unboxing overhead on each use of the "field" and that seems too expensive to me. This technique maintains almost the same exact performance of the existing model, but improves maintainability a lot.</P>
<P>Also in class Customer:</P>
<BLOCKQUOTE dir=ltr>
<P>Protected Overrides Sub AddBusinessRules()<BR>&nbsp; ValidationRules.AddRule(AddressOf MyRule, NameProperty)<BR>End Sub<BR><BR>Protected Overrides Sub AddAuthorizationRules()<BR>&nbsp; AuthorizationRules.AllowWrite(NameProperty, "Supervisor")<BR>End Sub</P></BLOCKQUOTE>
<P>Again, NameProperty minimizes the use of string literals for both the property name and the property's friendly name. The new AddRule() overload uses the values from NameProperty to populate the fields in the RuleArgs object.</P>
<P>Also, note that the Shared/static NameProperty field could be Public in scope, thus providing the UI with the friendly property name as well. And notice that the friendly name is set in executed code (not attributes) and so it can be set from a resource string or from a database table or whatever.</P>
<P>The primary comment on the blog post was a dislike of this Shared/static field at all. And I don't plan to eliminate the exisitng overloads that accept a normal string literal. So if you don't like the Shared/static PropertyInfo field, you don't need to use it - but in that case it is up to you to figure out how to avoid scattering string literals throughout your code.</P>
<P>The other two primary schemes are:</P>
<OL>
<LI>Declare a constant for each property - which gets you the property name, but not the friendly name</LI>
<LI>Declare an enum with all your property names - which again gets you the property name, but not the friendly names</LI></OL>
<P>If anyone has a better overall solution than the Shared/static field concept, I'm open to ideas. But any solution must:</P>
<UL>
<LI>Minimize the use of string literals for the property name</LI>
<LI>Minimize the use of string literals for the property friendly name</LI>
<LI>Allow for localization of the property friendly name</LI>
<LI>Not have a negative impact on performance</LI></UL>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Monday, November 26, 2007</h2>That's funny I <u>just </u>wanted to ask about this when I saw your post.<br><br>I think it is a very good move to have a centralized method. This allows for a central location to get and set values as well as have a central place for auditing and validation.<br><i><br>I could have managed the "fields" in a Dictionary&lt;string, object&gt;
in the base class, but that'd incur boxing/unboxing overhead on each
use of the "field" and that seems too expensive to me.<br><br></i>I am not sure about the performance hit this would bring to the BO. <br>One <u>big advantage</u> though would be if it was a collection of field objects instead of Dictionary&lt;string, object&gt;. Then each field object could hold extra meta data about the field (e.g. current value, original value, isDirty etc.). It would be easily extensible e.g. to add support for dynamic fields, to cycle through the fields to persist and load them etc.<br><br><i>Declare an enum with all your property names - which again gets you the property name, but not the friendly names</i><br><br>If the collection of fields were to always be in the same order you could use the enum values to access the fields directly by index (and incurring no overhead to search the collection).<br><br>Thanks for considering it,<br>Patrick<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Tuesday, November 27, 2007</h2>Re-posted my comments from Rocky's blog.<br><br>I don't have good knowledge on Microsoft's DependencyProperty. However,
for RegisterProperty, I am thinking if it is possible to further
simplify the code by providing an "alternative" through the use of
attribute. Thus, might help to eliminate too many static/instance
variables in a class. For example,
<br>
<br><font face="Courier New" size="2">[PropertyInfoAttribute&lt;string, Customer&gt;("Name")]
<br>private string _name = String.Empty;
<br><br>public string Name
<br>{
<br>&nbsp; get { return GetProperty&lt;string, Customer&gt;("Name", _name); }
<br>&nbsp; set { SetProperty&lt;string, Customer&gt;("Name", _name, value); }
<br>}</font>
<br><br>My concern is that it will introduce additional boilerplate code to
CSLA business object development that a business developer needs to
deal with. For example, the idea for static authorization methods
CanRead(), CanDelete(), CanExecute(), etc. Although these are optional
to business objects, it is good, if possible, to have these standard
methods available in all business objects through inheritance. However,
it is not possible because they are static methods, which forces the
developer to explicitly write them manually using a consistent naming
convention. Similarly, for the case of PropertyInfo object, developer
needs to explicitly declare two variables per property as a "rule",
although this is strictly optional.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 27, 2007</h2>Sounds like a good scheme.&nbsp; I still don't code gen yet, and this would save me some time. <br><br>Regardles of changing the property declarations, its probably best to obsolete the no paramter versions of CanReadProperty, etc.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Tuesday, November 27, 2007</h2><P>How about using attributes?&nbsp; Would something like this work?</P>
<P>[CslaField] //&nbsp;optionally specify various parameters to dictate friendly name, CanRead/CanWrite, etc...<BR>private string _name;</P>
<P>public string Name { <BR>&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;string&gt;(_name); } <BR>&nbsp;&nbsp;&nbsp; set { SetProperty&lt;string&gt;(_name, value); } <BR>}</P>
<P>Then your Get/SetProperty would simply read the CslaField attribute to determine authorization rules, dependency rules, update notifications, etc...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, November 27, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Bob Matthew:</strong></div><div>
<P>How about using attributes?&nbsp; Would something like this work?</P>
<P>[CslaField] //&nbsp;optionally specify various parameters to dictate friendly name, CanRead/CanWrite, etc...<BR>private string _name;</P>
<P></div></BLOCKQUOTE></P>
<P>That's basically what William is suggesting as well.</P>
<P>The problem with attributes is that they can't be localized. Their values are set at compile time, not runtime.</P>
<P>Also, one of the slowest (I've heard THE slowest) reflection operation is reading custom attributes. So reading them on every property get/set would be a bad thing. It would probably be possible to do some sort of caching of the values in a Dictionary or something, so as to minimize the reflection overhead, but then you'd have at least the Dictionary lookup on every get/set.</P>
<P>Finally, this doesn't remove the string literals used in AddBusinessRules() or AddAuthorizationRules(). Though I suppose you could do something like:</P>
<BLOCKQUOTE dir=ltr>
<P>ValidationRules.AddRule(MyRule, GetPropertyName(_name));</P></BLOCKQUOTE>
<P>where GetPropertyName() did the reflection call to get the attribute value. But you want the friendly name too, so it would be:</P>
<BLOCKQUOTE dir=ltr>
<P>ValidationRules.AddRule(MyRule, GetPropertyName(_name), GetFriendlyName(_name));</P></BLOCKQUOTE>
<P>or something along that line.</P>
<P>And even with all this, there's still no way for the UI to gain access to the friendly name, because it can't access the private fields.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 27, 2007</h2>Not that I think the attribute route is the way to go, but the refelection hit can be lessened by caching the reflection results.&nbsp; I use custom attributes for my data layer, and I have a class which handles actually doing the reflection that does this.&nbsp; It works reasonably well.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>honus replied on Tuesday, November 27, 2007</h2><P><FONT face=Arial size=2>Thinking about the set method, I often found myself doing something like the following:</FONT></P>
<P><FONT face=Arial size=2>Public Property childObject() as&nbsp;childObjectType<BR>&nbsp;&nbsp;&nbsp;Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanReadProperty(True)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return mChildObject<BR>&nbsp;&nbsp;&nbsp;End Get<BR>&nbsp;&nbsp;&nbsp;Set(ByVal value As childObjectType)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanWriteProperty(True)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If mChildObject.Equals(Nothing) OrElse Not mChildObject.Equals(value) Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mChildObject = value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<BR>&nbsp;&nbsp;&nbsp;End Set<BR>End Property</FONT></P>
<P><FONT face=Arial size=2>If I did not do this check, and the object had not been instantiated, I would get an exception (NullReference??).&nbsp; This would not be an issue for simple properties like strings and integers, but as&nbsp;business objects become nested within&nbsp;other objects, it can become an issue.&nbsp; </FONT></P>
<P><FONT face=Arial size=2>For my own purposes, I have created a shared set method (using Reflection, thanks to Rocky for introducing it to me <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" />) that all of my properties now use, and this is one of the checks included.&nbsp; This check might be a nice inclusion in your SetProperty.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, November 27, 2007</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Yes, my implementation checks both the field and value to make
sure they are non-null before trying to do an equality comparison. It also
replaces any null input value with string.Empty if the field type is string.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>You can actually see the code in svn (VB) at <o:p></o:p></span></p>

<p class=MsoNormal><span><a href="http://www.lhotka.net/cslacvs/viewvc.cgi/trunk/cslavb/Csla/Core/BusinessBase.vb?view=markup">http://www.lhotka.net/cslacvs/viewvc.cgi/trunk/cslavb/Csla/Core/BusinessBase.vb?view=markup</a><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Just look for the SetProperty() implementation.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> honus
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Tuesday, November 27, 2007 6:03 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p><span>Thinking
about the set method, I often found myself doing something like the following:</span><o:p></o:p></p>

<p><span>Public
Property childObject() as&nbsp;childObjectType<br>
&nbsp;&nbsp;&nbsp;Get<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanReadProperty(True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return mChildObject<br>
&nbsp;&nbsp;&nbsp;End Get<br>
&nbsp;&nbsp;&nbsp;Set(ByVal value As childObjectType)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanWriteProperty(True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If mChildObject.Equals(Nothing) OrElse Not
mChildObject.Equals(value) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mChildObject = value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<br>
&nbsp;&nbsp;&nbsp;End Set<br>
End Property</span><o:p></o:p></p>

<p><span>If I did not
do this check, and the object had not been instantiated, I would get an
exception (NullReference??).&nbsp; This would not be an issue for simple
objects like strings and integers, but as&nbsp;business objects become nested
within&nbsp;other objects, it can become an issue.&nbsp; </span><o:p></o:p></p>

<p><span>For my own
purposes, I have created a shared set method (using Reflection, thanks to Rocky
for introducing it to me <img border=0 id="_x0000_i1025" src="/emoticons/emotion-5.gif" alt="Wink <img src=" />">) that all of my properties now
use, and this is one of the checks included.&nbsp; This check might be a nice
inclusion in your SetProperty.</span><o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jtgooding replied on Thursday, November 29, 2007</h2><P>This one is fairly long, but I think I have it stripped down to the minimum I can.&nbsp;</P>
<P>First attributes as much as I love them I don't think are the way to go, I use them extensively on enums to get 'friendly' names, but unless you do caching the reflection hits can add up over time.</P>
<P>Secondly, true enums are NOT the way to go, basically because it provides no way to inherit an enum or do partial enums for codegen fields versus custom fields.</P>
<P>I use my own home brew enum class which then gives me the ability to write partial classes for codegen and also allows for inheritence of business classes.</P>
<P>I've stripped this down to the bare minimum, and specialized it towards my field info class (used by my dynamic SQL generator.</P>
<P>[<FONT color=#2b91af>Serializable</FONT>]<BR><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#2b91af>DBFieldInfo</FONT> <BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> DBFieldInfo(<FONT color=#0000ff>string</FONT> propertyName, <FONT color=#2b91af>PersistTypes</FONT> persist, <FONT color=#2b91af>SqlDbType</FONT> dbFieldType, <FONT color=#0000ff>string</FONT> dbFieldName, <FONT color=#0000ff>int</FONT> maxLength, <FONT color=#0000ff>bool</FONT> isPrimaryKey, <FONT color=#0000ff>bool</FONT> isIdentity)<BR>{}</P>
<P><FONT color=#0000ff>public</FONT> DBFieldInfo(<FONT color=#0000ff>string</FONT> propertyName, <FONT color=#2b91af>PersistTypes</FONT> persist, <FONT color=#2b91af>SqlDbType</FONT> dbFieldType, <FONT color=#0000ff>string</FONT> dbFieldName, <FONT color=#0000ff>int</FONT> maxLength, <FONT color=#0000ff>bool</FONT> isPrimaryKey, <FONT color=#0000ff>bool</FONT> isIdentity, <FONT color=#2b91af>EncryptionType</FONT> encryptionMode)<BR>{}</P>
<P><FONT color=#0000ff>public</FONT> DBFieldInfo(<FONT color=#0000ff>string</FONT> propertyName, <FONT color=#2b91af>PersistTypes</FONT> persist, <FONT color=#2b91af>SqlDbType</FONT> dbFieldType, <FONT color=#0000ff>string</FONT> dbFieldName, <FONT color=#0000ff>int</FONT> maxLength, <FONT color=#0000ff>bool</FONT> isPrimaryKey, <FONT color=#0000ff>bool</FONT> isIdentity, <FONT color=#2b91af>EncryptionType</FONT> encryptionMode, <FONT color=#0000ff>string</FONT> certificate, <FONT color=#0000ff>string</FONT> encryptionKey)<BR>{}</P><FONT color=#008000>
<P>// public string Certificate { get { return "Cert"; } }<BR>// public string DBFieldName { get{ return "dbfieldname";} }<BR>// public SqlDbType DBFieldType { get { return SqlDbType.VarChar; } }<BR>// public string EncryptionKey { get; set; }<BR>// public EncryptionType EncryptionMode { get; }<BR>// public bool IsIdentity { get; }<BR>// public bool IsPrimaryKey { get; }<BR>// public int MaxLength { get; }<BR>// public PersistTypes Persist { get; }<BR>// public string PropertyName { get; }<BR>// public string TableAlias { get; }<BR>// public string TableName { get; }<BR>//<BR>// public string FormatFieldName(QueryMode mode);<BR>// public string FormatFieldName(string alias, QueryMode mode);<BR>// public string FormatParameterKeyName(QueryMode mode);<BR>// public string FormatParameterName(QueryMode mode);<BR>// public void PopulateEncryptionMethods();</P>
<P>// public void SetEncryptionType(EncryptionType encryptionType);<BR>// public void SetMaxLength(int Length);<BR></FONT>}</P>
<P><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>struct</FONT> <FONT color=#2b91af>EnumEntry</FONT> <BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>int</FONT> _Ordinal;<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>string</FONT> _Name;<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>int</FONT> Ordinal<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get&nbsp;</FONT>{ <FONT color=#0000ff>return</FONT> _Ordinal; }<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set </FONT>{_Ordinal = <FONT color=#0000ff>value</FONT>; }<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>string</FONT> Name<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get </FONT>{ <FONT color=#0000ff>return</FONT> _Name; }<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set </FONT>{ _Name = <FONT color=#0000ff>value</FONT>; }<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> EnumEntry(<FONT color=#0000ff>int</FONT> ordinal, <FONT color=#0000ff>string</FONT> name)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Ordinal = ordinal;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Name = name;<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>int</FONT> ToOrdinal()<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> Ordinal;<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>override</FONT> <FONT color=#0000ff>string</FONT> ToString()<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> Name;<BR>&nbsp;&nbsp;&nbsp;}<BR>}</P>
<P><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#2b91af>EnumList</FONT> : <FONT color=#2b91af>Dictionary</FONT>&lt;<FONT color=#2b91af>EnumEntry</FONT>, <FONT color=#2b91af>DBFieldInfo</FONT>&gt;<BR>{}</P>
<P><FONT color=#0000ff>abstract</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#2b91af>EnumBase</FONT>&lt;T&gt;<BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>SortedDictionary</FONT>&lt;<FONT color=#0000ff>string</FONT>, <FONT color=#2b91af>EnumList</FONT>&gt; _EnumCollections = <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>SortedDictionary</FONT>&lt;<FONT color=#0000ff>string</FONT>, <FONT color=#2b91af>EnumList</FONT>&gt;();</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> CreateEntry(<FONT color=#0000ff>string</FONT> name, <FONT color=#2b91af>DBFieldInfo</FONT> fieldInfo)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</FONT> EnumType = <FONT color=#0000ff>typeof</FONT>(T).ToString();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateCollection(EnumType);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int</FONT> Ordinal = GetNextOrdinal(EnumType);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestExists(EnumType, Ordinal, name);<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnumEntry</FONT> NewEnumEntry = <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>EnumEntry</FONT>(Ordinal, name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_EnumCollections[EnumType].Add(NewEnumEntry, fieldInfo);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> NewEnumEntry;<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> CreateEntry(<FONT color=#0000ff>string</FONT> name, <FONT color=#0000ff>int</FONT> ordinal, <FONT color=#2b91af>DBFieldInfo</FONT> fieldInfo)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</FONT> EnumType = <FONT color=#0000ff>typeof</FONT>(T).ToString();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateCollection(EnumType);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestExists(EnumType, ordinal, name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#2b91af>EnumEntry</FONT> NewEnumEntry = <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>EnumEntry</FONT>(ordinal, name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_EnumCollections[EnumType].Add(NewEnumEntry, fieldInfo);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> NewEnumEntry;<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#0000ff>void</FONT> CreateCollection(<FONT color=#0000ff>string</FONT> enumType)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT> (!_EnumCollections.ContainsKey(enumType))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_EnumCollections.Add(enumType, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>EnumList</FONT>());<BR>&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#0000ff>int</FONT> GetNextOrdinal(<FONT color=#0000ff>string</FONT> enumType)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int</FONT> BiggestKey = -1;<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach</FONT> (<FONT color=#2b91af>EnumEntry</FONT> Key <FONT color=#0000ff>in</FONT> _EnumCollections[enumType].Keys)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT> (Key.Ordinal &gt; BiggestKey)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BiggestKey = Key.Ordinal;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> ++BiggestKey;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;private</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#0000ff>void</FONT> TestExists(<FONT color=#0000ff>string</FONT> enumType, <FONT color=#0000ff>int</FONT> ordinal, <FONT color=#0000ff>string</FONT> name)<BR>&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach</FONT> (<FONT color=#2b91af>EnumEntry</FONT> Key <FONT color=#0000ff>in</FONT> _EnumCollections[enumType].Keys)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT> (Key.Ordinal == ordinal)<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT> <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>ApplicationException</FONT>(<FONT color=#0000ff>string</FONT>.Format(<FONT color=#a31515>"Ordinal [{0}] already exists in EnumBase"</FONT>, ordinal));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT> (<FONT color=#0000ff>string</FONT>.Compare(Key.Name,name, <FONT color=#0000ff>true</FONT>) == 0)<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT> <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>ApplicationException</FONT>(<FONT color=#0000ff>string</FONT>.Format(<FONT color=#a31515>"Name [{0}] already exists in EnumBase"</FONT>, name));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;}<BR>} </P>
<P>&nbsp;</P>
<P>And here is a sample using it in the various ways.</P>
<P><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>void</FONT> TestEnums()<BR>{<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"RealEnum.x&nbsp; "</FONT> + <FONT color=#2b91af>RealEnum</FONT>.x);<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum.Internal&nbsp;"</FONT> + <FONT color=#2b91af>MyEnum</FONT>.Internal);<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum.Internal.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum</FONT>.Internal.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum.External.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum</FONT>.External.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum.Unknown.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum</FONT>.Unknown.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum.Custom.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum</FONT>.Custom.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum3.XXX.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum3</FONT>.XXX.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum3.YYY.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum3</FONT>.YYY.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum3.ZZZ.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum3</FONT>.ZZZ.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum3.ZZA.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum3</FONT>.ZZA.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum4.Internal.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum4</FONT>.Internal.ToOrdinal());<BR><FONT color=#2b91af>&nbsp;&nbsp;&nbsp;Console</FONT>.WriteLine(<FONT color=#a31515>"MyEnum4.ZZAA.ToOrdinal() "</FONT> + <FONT color=#2b91af>MyEnum4</FONT>.ZZAA.ToOrdinal());<BR>}</P>
<P><FONT color=#0000ff>private</FONT> <FONT color=#0000ff>enum</FONT> <FONT color=#2b91af>RealEnum<BR></FONT>{<BR>&nbsp;&nbsp;&nbsp;x = 1,<BR>&nbsp;&nbsp;&nbsp;y = 2,<BR>&nbsp;&nbsp;&nbsp;Z = 3<BR>}</P>
<P><FONT color=#0000ff>//Note that when using partial classes it is recommended that&nbsp; you use the overload that takes an ordinal to enforce numbering if using the enums as a true enum to guarantee ordering consistency in this sample i didn't since I'm name driven not ordinal driven.<BR></FONT><FONT color=#0000ff>partial</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#2b91af>MyEnum</FONT> : <FONT color=#2b91af>EnumBase</FONT>&lt;<FONT color=#2b91af>MyEnum</FONT>&gt;<BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> Internal = <FONT color=#2b91af>MyEnum</FONT>.CreateEntry(<FONT color=#a31515>"Internal"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"Internal"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> External = <FONT color=#2b91af>MyEnum</FONT>.CreateEntry(<FONT color=#a31515>"External"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"External"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> Unknown = <FONT color=#2b91af>MyEnum</FONT>.CreateEntry(<FONT color=#a31515>"Unknown"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"Unknown"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR>}</P>
<P><FONT color=#0000ff>partial</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#2b91af>MyEnum</FONT> <BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> Custom = <FONT color=#2b91af>MyEnum</FONT>.CreateEntry(<FONT color=#a31515>"Custom"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"Custom"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR>}</P>
<P><FONT color=#0000ff>class</FONT> <FONT color=#2b91af>MyEnum3</FONT> : <FONT color=#2b91af>EnumBase</FONT>&lt;<FONT color=#2b91af>MyEnum3</FONT>&gt;<BR>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> XXX = <FONT color=#2b91af>MyEnum3</FONT>.CreateEntry(<FONT color=#a31515>"XXX"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"XXX"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> YYY = <FONT color=#2b91af>MyEnum3</FONT>.CreateEntry(<FONT color=#a31515>"YYY"</FONT>, 11, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"YYY"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> ZZZ = <FONT color=#2b91af>MyEnum3</FONT>.CreateEntry(<FONT color=#a31515>"ZZZ"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"ZZZ"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> ZZA = <FONT color=#2b91af>MyEnum3</FONT>.CreateEntry(<FONT color=#a31515>"ZZA"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"ZZA"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR>}</P>
<P><FONT color=#0000ff>class</FONT> <FONT color=#2b91af>MyEnum4</FONT> : <FONT color=#2b91af>MyEnum<BR></FONT>{<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>EnumEntry</FONT> ZZAA = <FONT color=#2b91af>MyEnum3</FONT>.CreateEntry(<FONT color=#a31515>"ZZAA"</FONT>, <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>DBFieldInfo</FONT>(<FONT color=#a31515>"ZZAA"</FONT>, SHIP.Framework4.<FONT color=#2b91af>PersistTypes</FONT>.Database, <FONT color=#2b91af>SqlDbType</FONT>.VarChar, <FONT color=#a31515>"Internal"</FONT>, 32, <FONT color=#0000ff>false</FONT>, <FONT color=#0000ff>false</FONT>));<BR>}</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 29, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>jtgooding:</strong></div><div>
<P>I use my own home brew enum class which then gives me the ability to write partial classes for codegen and also allows for inheritence of business classes.</P>
<P></div></BLOCKQUOTE></P>
<P>That is very interesting, thank you for sharing!</P>
<P>I don't think your approach is all that different from what I'm doing, though my approach wouldn't allow for externalizing the PropertyInfo objects into an object outside the business object itself.</P>
<P>But you have me thinking.</P>
<P>The RegisterProperty current requires the containing type (business object type) as a generic parameter. That parameter is unused (I kept the concept from DependencyProperty), and if I removed that parameter then a PropertyInfo would be effectively decoupled from any specific business object type.</P>
<P><EM>Also</EM>, I haven't yet posted on a related concept, that I think is at least as important: a ChildManager.</P>
<P>In my current vision, child properties would be similar, but slightly different from, regular properties. The reason is that child references really <EM>will</EM> be managed by CSLA. So you won't maintain your own fields to reference a child - the reference will be managed by CSLA.</P>
<P>There'll be a RegisterChild() method that will require the containing type parameter, because it will use it to index into a dictionary of dictionaries. The result is still a PropertyInfo object - but this one can't be decoupled from the containing business object type.</P>
<P>The reason for this ChildManager thing is that it allows CSLA to better automate things like the parent reference, cascading PropertyChanged events up the chain, etc. It also means you no longer need to override IsValid and IsDirty in the normal case. In short, it saves a lot of code in parent objects and reduces the potential for related bugs.</P>
<P>But I already don't like the inconsistencies between "normal properties" and "child properties" in what I'm doing, and would really prefer to bring them closer together. This is one of the motivations for leaving the unused type parameter in RegisterProperty() - to keep closer parity with RegisterChild(), in the hopes that as this evolves I can bring them closer to parity.</P>
<P>One solution would be to bite the bullet and have CSLA manage all field values - like DependencyObject does with DependencyProperty fields. That would allow me to provide complete parity between these concepts, but would incur boxing/unboxing on each "field" use.</P>
<P>And that would entirely eliminate the idea of externalizing PropertyInfo objects from a business object implementation.</P>
<P>Hmm. Unless we flip it around. Suppose it were like this:</P>
<BLOCKQUOTE dir=ltr>
<P>private static PropertyInfo&lt;string&gt; NameProperty = <BR>&nbsp; new PropertyInfo&lt;string&gt;("Name", "Customer name");<BR>private static PropertyInfo&lt;Addresses&gt; AddressesProperty =<BR>&nbsp; new PropertyInfo&lt;Addresses&gt;("Addresses");<BR><BR>static Customer()<BR>{<BR>&nbsp; RegisterProperty&lt;Customer&gt;(NameProperty, PropertyValue.Field);<BR>&nbsp; RegisterProperty&lt;Customer&gt;(AddressesProperty, PropertyValue.Managed);<BR>}<BR><BR>private string _name = NameProperty.DefaultValue;<BR>public string Name<BR>{<BR>&nbsp; get { return GetProperty&lt;string&gt;(NameProperty, _name);<BR>&nbsp; set { SetProperty&lt;string&gt;(NameProperty, _name, value);<BR>}<BR><BR>public Addresses Addresses<BR>{<BR>&nbsp; get { return GetProperty&lt;Addresses&gt;(AddressesProperty);<BR>}</P></BLOCKQUOTE>
<P>This might work. This way the PropertyInfo instances are decoupled, and could potentially be externalized into some other class. Also, it isn't sealed, so you could extend it with extra stuff that you might want. </P>
<P>The two different overloads for GetProperty() would allow distinguishing between field-based and managed (child) values.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jtgooding replied on Thursday, November 29, 2007</h2><P>Yeah it isn't light years different, I&nbsp;like the enum style coding my enum class gives vs the fields approach, it provides a more logical intellisense approach,&nbsp;also having the persistence data in a centralized static collection reduces footprint given we can have a lot of managers in memory at times, and I can gain access to 'sub managers' for my dynamic SQL generator.</P>
<P>I've already done the changes you are looking to do in my own customized version of CSLA, I'm hoping the solution you end up with will mesh fairly well and be extensible enough to include all of my own custom metadata as well to bring me more back in line with yours than push me farther away.</P>
<P>Currently the biggest stuff I've done is:<BR>Persistence metadata<BR>Dynamic SQL generator<BR>Context sensitive rules (i.e. create/insert/update/delete rules collections)<BR>Realtime vs Save time rules (this is big for us, we have rules that are very SQL intensive and we want to only check them at save time)<BR>Reflection caching system (I sent you an early version of this awhile ago)<BR>AsyncBindingList (An almost feature complete version of list that is thread safe.)<BR>All Criteria objects must inherit from IUniqueCriteria (We ran into developers passing an int instead of a Criteria class and due to the parameters being type object would compile and create runtime errors, so we created this flag to put on all criteria classes to catch it at compile time)<BR>Some additional CommonRules (StringExactLength, NotEqualValue, MustEqualValue)</P>
<P>&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Friday, November 30, 2007</h2><P>Just a quick FYI and comments:</P>
<P>We've been using centralized GetProperty/SetProperty methods for a couple of years now with great success.&nbsp; Glad to see you're going the same route.&nbsp; It certainly saves on the code, makes the code-gen templates a bit smaller and ramping up a new developer easier.</P>
<P>With that, we have handled the string literals issue with resource files.&nbsp; I don't think I saw this option mentioned in any of the posts and am not sure why.&nbsp; But, it allows us to strongly type the reference throughout our code while eliminating string literals, gives us global changes (for type-o's, etc) and has localization support.</P>
<P>Finally, we also have several custom attributes that are based on the "built-in" classes adding localization support.&nbsp; So, it is certainly possible to have localization with attributes.&nbsp; You are required to create your own and I am in complete agreement with Rocky that the performance overhead far outweighs the benefits of using attributes in many cases, especially for behavior such as what's being discussed here.</P>
<P>Just my two cents...</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Thursday, December 06, 2007</h2>Rocky,<br>
<br>
What becomes of the no - inlining statements that we have been using ?&nbsp; Or has that been covered somewhere else ? <br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, December 06, 2007</h2><P><FONT face=Tahoma size=2>From Rocky's first post:</FONT></P>
<P><FONT face=Tahoma size=2><BLOCKQUOTE><div></FONT></P>
<P><FONT face=Tahoma size=2>Additionally, the fact that the System.Diagnostics trick to get the property name has become increasingly problematic, and I am marking the overloads of CanReadProperty(), CanWriteProperty() and PropertyHasChanged() that use the trick as obsolete in 3.5 - so you'll get compiler warnings/errors when you try to use them.</FONT></P>
<P><FONT face=Tahoma size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>Basically, in the 3.5 version, you won't use them anymore.</FONT></P>
<P><FONT face=Tahoma size=2>EDIT: Should probably provide some clarification on that.&nbsp; Since the NoInlining attribute was used to make the System.Diagnostics code work properly, you wouldn't need it for 3.5.&nbsp; I don't expect it would hurt if you left it in, but you don't need it anymore.&nbsp; Sorry...</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 06, 2007</h2><P>Here's the latest syntax for what I'm doing - looking for comments.</P>
<P><STRONG>Option 1 - private backing field</STRONG></P>
<P>private static PropertyInfo&lt;string&gt; NameProperty = <BR>&nbsp; new PropertyInfo&lt;string&gt;("Name", "Customer name");<BR>private string _name = NameProperty.DefaultValue;<BR>public string Name<BR>{<BR>&nbsp; get { return GetProperty&lt;string&gt;(NameProperty, _name); }<BR>&nbsp; set { SetProperty&lt;string&gt;(NameProperty, _name, value); }<BR>}</P>
<P><STRONG>Option 2 - managed (by BusinessBase ) backing field</STRONG></P>
<P>private static PropertyInfo&lt;string&gt; NameProperty = <BR>&nbsp; new PropertyInfo&lt;string&gt;("Name", "Customer name");<BR>public string Name<BR>{<BR>&nbsp; get { return GetProperty&lt;string&gt;(NameProperty); }<BR>&nbsp; set { SetProperty&lt;string&gt;(NameProperty, value); }<BR>}</P>
<P><STRONG>Variation for SmartDate</STRONG></P>
<P>private static PropertyInfo&lt;SmartDate&gt; HireDateProperty = <BR>&nbsp; new PropertyInfo&lt;SmartDate&gt;("HireDate", "Hire date");<BR>public string HireDate<BR>{<BR>&nbsp; get { return GetProperty&lt;string, SmartDate&gt;(HireDateProperty); }<BR>&nbsp; set { SetProperty&lt;string, SmartDate&gt;(HireDateProperty, value); }<BR>}</P>
<P><STRONG>Variation for child object (managed field)</STRONG></P>
<P>private static PropertyInfo&lt;LineItems&gt; LineItemsProperty = <BR>&nbsp; new PropertyInfo&lt;LineItems&gt;("LineItems", "Line items");<BR>public string LineItems<BR>{<BR>&nbsp; get <BR>&nbsp; { <BR>&nbsp;&nbsp;&nbsp; if (!PropertyManager.FieldExists(LineItemsProperty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;LineItems&gt;(LineItemsProperty, LineItems.NewList());<BR>&nbsp;&nbsp;&nbsp; return GetProperty&lt;LineItems&gt;(LineItemsProperty); <BR>&nbsp; }<BR>}</P>
<P><STRONG>Variation I am considering for reflection-based loading of property metadata</STRONG></P>
<P>private static PropertyInfo&lt;string&gt; NameProperty = <BR>&nbsp; new PropertyInfo&lt;string&gt;(typeof(Customer), "Name");</P>
<P>The idea here is that this constructor overload would reflect against the business object to get the Name property, and would then read an attribute to get the display name for the property, which would be used as the friendly name. I'd also call a virtual protected method like OnInitializing() so subclasses would have an opportunity to initialize themselves as well (using the System.Reflection.PropertyInfo object I'd have already retrieved).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 07, 2007</h2>So option two is the BB actually has the field?&nbsp; That feels like its breaking encapsulation somewhat.. but I'm probably wrong.<br><br>As a side note, do you think we can take advantage of automatic properties in .Net 3.5?&nbsp; It would be nice if there was a way to use that feature, but be able to modify the compiler generated code template to match Csla.&nbsp; That would be awesome.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 07, 2007</h2>






 





<div class=Section1>

<p class=MsoNormal><span>Yes, Option 2 has BB managing the value in a
Dictionary&lt;string, object&gt; - pretty much the same as Microsoft does with
DependencyProperties for WFP and WF objects. That does sort of break
encapsulation, but not really. The value is still private to your object instance,
and BB internally delegates the responsibility for managing child field values
to a PropertyManager class.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I did look at automatic properties, but the compiler has no
template-based generation scheme &#8211; they hard-coded the syntactic sugar,
limiting its value. I&#8217;ve even talked to some compiler people at
Microsoft, but there&#8217;s just no support for customizing the way this
works. It is intended to simplify the creation of DTOs and that&#8217;s that&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Friday, December 07, 2007</h2>I prefer "Option 2 - managed (by BusinessBase ) backing field" <br><br>I was wondering what your thoughts are on adjusting <br>Dictionary&lt;String, Object&gt; to Dictionary&lt;String, FieldData&gt; <br><br>There are many benefits like IsDirty on a field level, current value&nbsp; vs. original value etc.<br><br>Please see below for some sample code..<br><br>Thanks,<br>Patrick<br><br>// ---------------------------------------------------<br>Please see my next post below for the sample code<br>// ----------------------------------------------------</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, December 07, 2007</h2><P>I really like Patrick's suggestion a lot.</P>
<P>If we are going to manage this, then let's go all the way.</P>
<P>Patrick's suggestion opens up all sorts of possibilties. Dynamic SQL being one of them. Concurrency checking is another. I am sure there are more.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 07, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div> 
<P>I really like Patrick's suggestion a lot.</P>
<P>If we are going to manage this, then let's go all the way.</P>
<P>Patrick's suggestion opens up all sorts of possibilties. Dynamic SQL being one of them. Concurrency checking is another. I am sure there are more.</P>
<P></div></BLOCKQUOTE></P>
<P>Seriously? That's a big (HUGE) breaking change if I really pursued it - because things like IsDirty would change, etc.</P>
<P>Would you go the rest of the way? Elevate the "property" concept to a first-class citizen?</P>
<P>What I mean by that is that some things, like validation and authorization rules, are really property concepts, not object concepts. So AddBusinessRules() should exist at the property level, not the object level - at least for associating rules to properties. You can envision that cross-property dependencies are still object concepts.</P>
<P>I'm not entirely sure what this would look like, but it would be interesting because it would allow you to define a property and then use that property in different objects.</P>
<P>I thought about this long and hard, and decided the break was too big - but heck, let's discuss it briefly anyway.</P>
<P>You'd define a property like this:</P>
<BLOCKQUOTE dir=ltr>
<P>Public Class NameProperty<BR>&nbsp; Inherits PropertyBase(Of String)<BR><BR>&nbsp; Friend Sub New()<BR>&nbsp;&nbsp;&nbsp; MyBase.New("Name", "Customer name")<BR>&nbsp; End Sub<BR><BR>&nbsp; Protected Overrides Sub AddBusinessRules()<BR>&nbsp;&nbsp;&nbsp; ' associate&nbsp;rules here<BR>&nbsp; End Sub<BR><BR>&nbsp; Protected Overrides Sub AddAuthorizationRules()<BR>&nbsp;&nbsp;&nbsp;&nbsp;' allow/deny read/write here<BR>&nbsp; End Sub<BR>End Class</P></BLOCKQUOTE>
<P>Then in your business class you'd use it:</P>
<BLOCKQUOTE dir=ltr>
<P>Public Class Customer<BR>&nbsp; Inherits BusinessBase(Of Customer)<BR><BR>&nbsp; Private Shared NameProperty As New NameProperty<BR>&nbsp; Public Property Name() As String<BR>&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of String)(NameProperty)<BR>&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(Of String)(NameProperty, value)<BR>&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp;End Property<BR><BR>&nbsp; Protected Overrides Sub AddBusinessRules()<BR>&nbsp;&nbsp;&nbsp; ' associate dependent properties here<BR>&nbsp; End Sub<BR>End Class</P></BLOCKQUOTE>
<P>The important thing is that you'd be able to use NameProperty in <EM>some other business class</EM> if that class requires a customer name property, but the business/authorization rules for the property would be in one location.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GeorgeG replied on Monday, December 10, 2007</h2><P>Another yes vote for Patrick's and JoeFallon1's suggestion for IsDirty and even original values at field level.</P>
<P>It sounds pretty interesting for properties being first class citizen. I do like the fact that we will be able to inherit code. Will we be able to use composition of property classes ie <BR>Class Address<BR>&nbsp;Address<BR>&nbsp;&nbsp;City<BR>&nbsp;&nbsp;Zip <BR>&nbsp;&nbsp;AddBusinessRules()</P>
<P>Class Customer <BR>&nbsp;address=new Address<BR>&nbsp;<BR>&nbsp;Public Property City() As String<BR>&nbsp;&nbsp;&nbsp; &nbsp;Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Return GetProperty(Of String)(address.City)<BR>&nbsp;&nbsp;&nbsp; &nbsp;End Get<BR>&nbsp;&nbsp;&nbsp; &nbsp;Set(ByVal value As String)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;SetProperty(Of String)(City, address.City)<BR>&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;End Property<BR>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 10, 2007</h2>I'm not sure I like properties as first class citizens.&nbsp; I don't have a lot of code I'm re-using right now, and all these objects would add a huge amount of overhead.&nbsp; My application already sends enough data across the wire.. all these objects (which need to be passed when remoting even if the "property" is not dirty) would kill performance I'd think.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Monday, December 10, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>I don't have a lot of code I'm re-using right now, and all these objects would add a huge amount of overhead.&nbsp; My application already sends enough data across the wire.. all these objects (which need to be passed when remoting even if the "property" is not dirty) would kill performance I'd think.</div></BLOCKQUOTE><br>I'm sure Rocky would be aware of optimizing it but in regards to my suggestion it would just substitute instance fields with a Dictionary:<br>&nbsp;&nbsp; private Dictionary&lt;String, FieldData&gt; propertyData;<br><br>Where FieldData in most cases is just made up of<br>&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>&nbsp;&nbsp;&nbsp; private bool _isDirty = false;<br><br>I wouldn't think that this adds a lot to the size of the serialized object.<br>As well all the PropertyInfo fields are static and wouldn't be serialized.<br>
<br>All the best,<br>Patrick<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 10, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Patrick:</strong></div><div><br>Where FieldData in most cases is just made up of<br>&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>&nbsp;&nbsp;&nbsp; private bool _isDirty = false;<br><br>I wouldn't think that this adds a lot to the size of the serialized object.<br>As well all the PropertyInfo fields are static and wouldn't be serialized.</div></BLOCKQUOTE><br><br>Well, that adds one boolean for each property.&nbsp; Does .Net serialize a boolean to a bit or a larger data structure?&nbsp; Also, I assume there needs to be markers as to what class is in the stream, which includes type name, assembly, version, etc.&nbsp; I don't think it would just be the field data for an object, it would need to know more.&nbsp; When you start talking about a hundred or so objects, all that information can quickly add up.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Blarm replied on Thursday, December 13, 2007</h2><P>I like Patrick's idea.</P>
<P>Now, just thinking out loud (and shoot me down if I'm being stupid).</P>
<P>Could the property IsDirty be reset to false when a property is changed back to the original value, say when a name is "Smith" and gets changed to "Jones" by operator mistake who then changes it back to "Smith". At the moment IsDirty is still true, but should be false. </P>
<P>The IsDirty at the property level could add/subtract from an IsDirtyCount at the object level when it changes to true/false. Then IsDirty at the object level could check IsDirtyCount &lt;&gt; 0 (or without the IsDirtyCount it could loop through all the properties to check thier IsDirty - which I think would be less efficient).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Monday, December 10, 2007</h2><div><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>because things like IsDirty would change, 
etc.&nbsp; </div></BLOCKQUOTE><br>If we replaced <br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dictionary&lt;String, FieldData&gt; 
propertyData;</i><br>with <br><i>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; FieldsData property<span class="851540419-10122007">Data</span><span class="851540419-10122007">;</span></i><br><br>and FieldsData would be a FieldData 
collection which implements IsDirty by looking at the IsDirty properties of the 
contained FieldData.<br>Then we could override IsDirty in the BO with<span class="851540419-10122007">:<br></span><i>public bool IsDirty {<br>&nbsp;&nbsp;&nbsp; get{ return property<span class="851540419-10122007">Data</span>.IsDirty;}<br>}<br></i><br>Wouldn't this allow 
IsDirty to stay nearly the same?<br><br></font></div>
<div><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>What I mean by that is that some things, like 
validation and authorization rules, are really property concepts, not object 
concepts. So AddBusinessRules() should exist at the property level, not the 
object level..<br></div></BLOCKQUOTE><br><span class="851540419-10122007">That</span> sounds 
very interesting because e.g. customer name should always have the same length 
regardless of what business case it is used in. So the business rules regarding 
the customer name could get <span class="851540419-10122007"></span>encapsulated as well.<br><br></font></div>
<div><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>Seriously? That's a big (HUGE) breaking change 
if I really pursued it.....&nbsp; I thought about this long and hard, and decided the 
break was too big </div></BLOCKQUOTE><br>I guess one question is how many running CSLA.NET 
projects get actually upgraded to the latest version of CSLA.NET<span class="851540419-10122007"> vs how big the long term benefit might 
be.</span><br><br>If they use code generation they might but then they could 
upgrade the generated code to reflect the changes.<br>If they don't use code 
generation and it's a bigger project it might be less likely that they will 
upgrade anyway. But rather that they would use the latest version on their next 
project.</font></div>
<div>
<div><font face="Arial" size="3">&nbsp;</font></div>
<div>
<div><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>Would you go the rest of the way? Elevate the 
"property" concept to a first-class citizen?</div></BLOCKQUOTE></font></div>
<div><font face="Arial" size="3"><span class="851540419-10122007">If that is too much of a jump then 
wouldn't</span></font></div>

<div><font face="Arial" size="3"><span class="851540419-10122007">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i>Dictionary&lt;String, FieldData&gt; 
propertyData </i><br>OR&nbsp; <i>FieldsData propertyFields </i><br>be </span><span class="851540419-10122007">still very close to your 
original suggestion?</span> <br></font></div>
<div><font face="Arial" size="3"><span class="851540419-10122007"></span><span class="851540419-10122007"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><strong>Option 2 - managed (by BusinessBase ) backing 
field</strong></span></font></div>
<div><font face="Arial" size="3"><span class="851540419-10122007">private static PropertyInfo&lt;string&gt; 
NameProperty = <br>&nbsp; new PropertyInfo&lt;string&gt;("Name", "Customer 
name");<br>public string Name<br>{<br>&nbsp; get { return 
GetProperty&lt;string&gt;(NameProperty); }<br>&nbsp; set { 
SetProperty&lt;string&gt;(NameProperty, value); 
}<br>}</div></BLOCKQUOTE><br><br>Thanks a lot <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br>Patrick<br></span></font></div></div></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 10, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Patrick:</strong></div><div>I guess one question is how many running CSLA.NET 
projects get actually upgraded to the latest version of CSLA.NET vs how big the long term benefit might 
be.<br><div><br>If they use code generation they might but then they could 
upgrade the generated code to reflect the changes.<br>If they don't use code 
generation and it's a bigger project it might be less likely that they will 
upgrade anyway. But rather that they would use the latest version on their next 
project.</div></BLOCKQUOTE><br><br>I try to stay with the latest Csla whenever possible.&nbsp; I'm also trying to stay up with the latest .Net framework, although I haven't done any .Net 3.0, I am planning soon on moving up to 3.5.&nbsp; Linq by itself will help me emmensely.<br><br>Also, I don't really use code gen; the only "code gen" I do is using VS snippits.&nbsp; <br></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Tuesday, December 11, 2007</h2><P>I like Patrick's solution as well - it solves a lot of problems of determing if an object really is dirty or not.</P>
<P>Regarding the concern of too much data across the wire and performance, why not have store some sort of computationally-lightweight hash in the BusinessBase?</P>
<P>Example:</P>
<P>1. When the object is loaded from the DB, a simple CRC32 (or&nbsp;other algo)&nbsp;is computed against the business object and then stored into two member variables _originalHash and _currentHash.</P>
<P>2. When any property is modified, _currentHash is cleared.</P>
<P>3. When IsDirty is called, it first checks to see if _currentHash is empty and if so, it computes it and then stores that value into the _currentHash variable.&nbsp; Finally we return _originalHash == _currentHash to indicate if the object is dirty.</P>
<P>In this way we determine if the object is truly dirty (within a reasonable mathematical probability) without incurring significant computational or network overhead.</P>
<P>The only caveat is how to compute a hash on&nbsp;a non-native type (something other than int, string, DateTime, etc) - perhaps we would just call the GetHash() method implemented on all .NET objects?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, December 11, 2007</h2>I don't see how a hash solves the problem of lots of objects (representing properties) moving across the wire.&nbsp; Remember, whatever is contained in BusinessBase WILL travel the wire (unless its not serialized).&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Tuesday, December 11, 2007</h2><P>I'm with ajj3085 on this one.&nbsp; It sure seems like an awful lot of overhead to determine if the user changed a value then changed the value back to the orginal object.&nbsp; And if it is marked as NonSerialized then it doesn't really do much good since the child objects cannot make use of it once they are on the server side.&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Tuesday, December 11, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>I don't see how a hash solves the problem of lots of objects (representing properties) moving across the wire.&nbsp; Remember, whatever is contained in BusinessBase WILL travel the wire (unless its not serialized).&nbsp; <BR></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>Obviously the current state or data of&nbsp;an object would have to be transferred across the wire - there's no getting around that.&nbsp; Patrick's post talks about keeping a copy of the&nbsp;old, saved&nbsp;data when it differs from the current, unsaved data for each property to determine if that property is dirty.&nbsp; The solution that I proposed above is a way to maintain only the current data and still be able to tell if the entire object truly IsDirty while only transferring a few extra bytes across the wire.&nbsp; In my case, I don't particularly care if any one property is dirty, I just want to ensure that the object doesn't go back across the wire when Save gets called and the object hasn't actually changed.</P>
<P>Example:</P>
<P>As it currently exists in the CSLA:</P>
<P>1. User object - has username "test" when loaded. (IsDirty = false)</P>
<P>2. username is updated to be "testing123". (IsDirty = true)</P>
<P>3. username is changed back to "test" - IsDirty is still true and a Save() call would serialize the object, send it to the data portal to be saved even though it's not truly dirty.</P>
<P>Using the solution I've proposed:</P>
<P>1. User object - has username "test" when loaded. (IsDirty = false)</P>
<P>2. username is updated to be "testing123". (IsDirty = true)</P>
<P>3. username is changed back to "test". (IsDirty = false) a Save() call would exit before going to the Data Portal.</P>
<P>Rocky: I like Patrick's idea of being able to&nbsp;tell if the&nbsp;object IsDirty, but I don't think we need to make Properties first-class citizens either.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, December 11, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Bob Matthew:</strong></div><div>
<P>Regarding the concern of too much data across the wire and performance, why not have store some sort of computationally-lightweight hash in the BusinessBase?</P>
<P></div></BLOCKQUOTE></P>
<P>The problem is that this isn't safe. It will work usually, but could fail (silently). The reason is that a hash value is not guaranteed to be unique, and it is possible that an original and new value will hash to the same value.</P>
<P>This is the same reason that timestamp concurrency is good, while CRC (hash) concurrency is not recommended - it will typically work, but if it doesn't work it fails silently.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Tuesday, December 11, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Bob Matthew:</strong></div><div> 
<P>Regarding the concern of too much data across the wire and performance, why not have store some sort of computationally-lightweight hash in the BusinessBase?</P>
<P></div></BLOCKQUOTE></P>
<P>The problem is that this isn't safe. It will work usually, but could fail (silently). The reason is that a hash value is not guaranteed to be unique, and it is possible that an original and new value will hash to the same value.</P>
<P>This is the same reason that timestamp concurrency is good, while CRC (hash) concurrency is not recommended - it will typically work, but if it doesn't work it fails silently.</P>
<P>&nbsp;</P>
<P></div></BLOCKQUOTE></P>
<P>Statistically speaking it is true that the hash values could be identical - an easy solution would be to introduce an additional set of hash values based upon another algorithm and thus maintain dual hashes.&nbsp; In this scenario the probability of a collision would approach zero.</P>
<P>Even so, what are the consequences of IsDirty not being correct?&nbsp; If Save() is called, it saves to the database.&nbsp; This is exactly the way that it functions now as pointed out from the example I posted earlier.</P>
<P>Remember, the objective is to determine if an object has truly changed and thus avoid excess or unnecessary calls to the portal, but also to do so without introducing significant network/CPU overhead.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Wednesday, December 12, 2007</h2><font face="Arial" size="2">Hi, it would be a pity if the discussion evaporates due 
to concerns for the size of the data structure when in reality the difference 
might be very small<span class="820442200-13122007"> (and I am not sure if we really got 
any statistics right now)</span>... especially compared to the benefits which 
could be quite large. </font>
<div>&nbsp;</div>
<div><font face="Arial" size="2">Having collections of </font></div>
<div><font face="Arial" size="2">&nbsp;&nbsp;&nbsp;PropertyInfo fields which hold meta data about 
the fields</font></div>
<div><font face="Arial" size="2">and</font></div>
<div><font face="Arial" size="2">&nbsp;&nbsp;&nbsp;PropertyData (or FieldData) which hold the field 
values and possibly some meta data</font></div>
<div><font face="Arial" size="2">can<span class="820442200-13122007"> 
basically</span>&nbsp;be very helpful. </font></div><br><div><font face="Arial" size="2">Just having this type of structure in place in CSLA.NET allows developers to extend it if they need to and if they don't they can just 
leave it as it is.</font></div>
&nbsp;
<div><font face="Arial" size="2">The current <span class="820442200-13122007">way of using instance 
properties </span>makes it difficult to: </font></div>
<div><font face="Arial" size="2">a) keep meta data about property e.g. friendly 
names, default value, primary key etc.</font></div>
<div><font face="Arial" size="2">b) keep meta data about property values e.g. 
original value, is dirty as well as adding field type specific methods 
</font></div>
<div> <br></div>
<div><font face="Arial" size="2"><span class="820442200-13122007">Having collections on the other hand allows very easily to add all of these and more. Either in the core 
framework or later on by the individual developer.</span></font></div>
<div>&nbsp;<br></div>
<div><font face="Arial" size="2">I thought bringing up some of the original questions might help the discussion:&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /> <br></font></div>
<div><font face="Arial" size="2"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>Here's the latest 
syntax for what I'm doing - looking for comments.</font></div>
<div><font face="Arial" size="2">Option 1 - private backing field</font></div>
<div><font face="Arial" size="2">Option 2 - managed (by BusinessBase ) backing 
field</font></div>
<div><font face="Arial" size="2">Variation for SmartDate</font></div>
<div><font face="Arial" size="2">Variation for child object (managed 
field)</font></div>
<div><font face="Arial" size="2">Variation I am considering for reflection-based 
loading of property metadata</div></BLOCKQUOTE></font></div>

<div><font face="Arial" size="2"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Patrick:</strong></div><div>I prefer "Option 2 - managed 
(by BusinessBase ) backing field"</font></div>
<div><font face="Arial" size="2">I was wondering what your thoughts are on 
adjusting</font></div>
<div><font face="Arial" size="2">Dictionary&lt;String, Object&gt; to 
Dictionary&lt;String, FieldData&gt;</font></div>
<div><font face="Arial" size="2"></div></BLOCKQUOTE></font></div>

<div><font face="Arial" size="2"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>I thought about this 
long and hard, and decided the break was too big - but heck, let's discuss it 
briefly anyway.</font></div>
<div><font face="Arial" size="2">.....The important thing is that you'd be able to 
use NameProperty in some other business class if that class requires a customer 
name property, but the business/authorization rules for the property would be in 
one location.</div></BLOCKQUOTE></font></div>
<div>&nbsp;</div>
<div><font face="Arial" size="2">Thanks a lot,</font></div>
<div><font face="Arial" size="2">Patrick</font></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dctc42 replied on Wednesday, December 12, 2007</h2><P>Hi all,</P>
<P>Just read Buisness Objecs C# 2005. I've tried several BO approaches in my work and what I liked about CSLA was that is was a pretty light weight framework. Once you start getting into the 'field info' concept and metadata and all that, you core buisness object class starts getting bloated. I guess this is unavoidable since developers are always looking for more features per line of application code.</P>
<P>At what point do BuisnessBase and BuisnessBaseList become as generic and bloated (general puporse/feature rich) as a DataSet or and ADO.NET EO? What do we really gain besides a cozy feeling that we are using BUISNESS OBJECTS?</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 13, 2007</h2>No, discussion is a good thing.<br><br>I see where you're coming from, but since Csla is geared to be able to easily switch from 2 tier to 3 tier, how much information that goes across the wire is important.&nbsp; From my reading of Rocky's though, it sounded like these PropertyInfo fields could be stored staticly and created in a static constructor or on demand.&nbsp; As long as the objects aren't tied to any specific instance of a type, that information can stay where it is, no need to move things around.&nbsp; Adding the old value in eliminates that, and suddely a lot more information must be transmitted. <br><br>My application has become too chatty in the current 2-tier deployment, so I'm switching to 3-tier.&nbsp; I'm considered that if we start adding features which make the data stream larger, 3-tier would not perform any better than the 2-tier.&nbsp; <br><br>The other point that Rocky raises about hashing is valid; its not that a hash collision will cause an object to save across the wire if its wrong, its that an object WON'T report dirty when in fact it is.&nbsp; I'm not in favor of a solution where that can happen, even if its remote. Because I know that during the lifetime of my application, it WILL happen, and I (and my users) will be left wondering why sometimes they can't save.&nbsp; Adding another layer of hashes is adding further memory requirements.&nbsp; A BO can have a complex type as a child property as well.<br><br>All of this for what, getting rid of a boolean flag and saying "yes, this is EXACTLY what's in the database."&nbsp; It doesn't seem worth the effort and added overhead.&nbsp; Open almost any application, and you'll get the same results that Csla produces.&nbsp; Cut some text out, type it back in... Word still says you've changed it.&nbsp; <br><br>I like the idea Rocky proposed though, because it doesn't add as much overhead and it increases the code's maintainablity.&nbsp; Also, nothing is stopping anyone right now from tracking original values and using that instead of the flag for IsDirty.&nbsp; Those that want to will have to add more code, but I'm not sure it's come up a lot here, and those that don't shouldn't have all that extra overhead added.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Thursday, December 13, 2007</h2><div><font face="Arial"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>No, discussion is a good thing.</div></BLOCKQUOTE><br><span class="937533419-13122007">Nice</span>.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div><br>From my 
reading of Rocky's though, it sounded like these PropertyInfo fields could be 
stored staticly and created in a static constructor or on demand. 
</div></BLOCKQUOTE><br>This is one of Rocky's suggestions: <strong>Option 2 - managed (by 
BusinessBase ) backing field<br></strong>based on: Dictionary&lt;String, 
Object&gt; <br><br>The only real suggestion I had was to replace this with 
<br>Dictionary&lt;String, FieldData&gt; <br>because it avoids the issues with 
boxing and unboxing of value types and because it is very easy to extend it if 
need be.<br><br><u>So it could start out in the core framework with:</u><br>&nbsp;&nbsp;&nbsp; 
public class FieldData { }<br>&nbsp;&nbsp;&nbsp; public class FieldData&lt;T&gt; : 
FieldData<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T 
CurrentValue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return 
_CurrentValue;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { _CurrentValue = 
value;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>But this could be extended by each developer 
without breaking compatibility with future version of CSLA.NET.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>if we start adding features which make the data stream 
larger</div></BLOCKQUOTE><br>I wonder by how much the data stream would really grow based 
on the sample above.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>The other point that Rocky 
raises about hashing is valid;</div></BLOCKQUOTE><br>I fully agree<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>All of this for what, getting rid of a boolean flag and saying 
"yes, this is EXACTLY what's in the database." </div></BLOCKQUOTE><br>No the main reason 
for suggesting it, is to be able to extend CSLA easily without breaking 
compatibility with future version of CSLA.NET.<br><br><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Also, nothing is stopping anyone right now from tracking original 
values and using that instead of the flag for IsDirty. </div></BLOCKQUOTE><br>Sure but 
since there is no place for it in the current framework everybody who needs this 
or other features has to come up with there own solution. </font></div>
<div><font face="Arial">While if there&nbsp;<span class="937533419-13122007">is </span>something like 
FieldData it is extremely easy to&nbsp;<span class="937533419-13122007">just 
</span>extend the&nbsp;<span class="937533419-13122007">class </span>without breaking 
compatibility.<br><br>Thanks,<br>Patrick<br></font></div></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 13, 2007</h2>Sorry, yes I think that is a good idea.&nbsp; It's the tracking of original values automatically that I'm not really liking.&nbsp; Although I'm not sure how Csla will use static PropertyInfo though and still have those objects move with the BO.&nbsp; Hmm..<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GeorgeG replied on Friday, December 14, 2007</h2><P>May be Rocky can have two BusinessBase. One regular BusinessBase and the other one "BusinessBaseMoreFunctionaly" where BusinessBaseMoreFunctionaly will inherit from BusinessBase do some overides. BusinessBaseMoreFunctionaly will give us more functionality as per Patrick's suggestion. Developers will be able to choose one or the other. Having Rocky maintain it in the framework would mean consistency across the board and everybody can use it if they need the extra functionality.</P>
<P>What others and Rocky think?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, December 14, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Patrick:</strong></div><div><FONT face=Arial size=2>Hi, it would be a pity if the discussion evaporates due to concerns for the size of the data structure when in reality the difference might be very small<SPAN class=820442200-13122007> (and I am not sure if we really got any statistics right now)</SPAN>... especially compared to the benefits which could be quite large. </FONT>
<DIV>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Having collections of </FONT></DIV>
<DIV><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;PropertyInfo fields which hold meta data about the fields</FONT></DIV>
<DIV><FONT face=Arial size=2>and</FONT></DIV>
<DIV><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;PropertyData (or FieldData) which hold the field values and possibly some meta data</FONT></DIV>
<DIV><FONT face=Arial size=2>can<SPAN class=820442200-13122007> basically</SPAN>&nbsp;be very helpful. </FONT></DIV><BR>
<DIV><FONT face=Arial size=2>Just having this type of structure in place in CSLA.NET allows developers to extend it if they need to and if they don't they can just leave it as it is.</FONT></DIV>&nbsp; 
<DIV><FONT face=Arial size=2>The current <SPAN class=820442200-13122007>way of using instance properties </SPAN>makes it difficult to: </FONT></DIV>
<DIV><FONT face=Arial size=2>a) keep meta data about property e.g. friendly names, default value, primary key etc.</FONT></DIV>
<DIV><FONT face=Arial size=2>b) keep meta data about property values e.g. original value, is dirty as well as adding field type specific methods </FONT></DIV>
<DIV><BR></DIV>
<DIV><FONT face=Arial size=2><SPAN class=820442200-13122007>Having collections on the other hand allows very easily to add all of these and more. Either in the core framework or later on by the individual developer.</SPAN></FONT></DIV>
<P></div></BLOCKQUOTE></P>
<P>I am very excited about the possibility of having property meta-data available upon request.&nbsp; I've been getting very good use out of making business rule meta-data available to users.&nbsp; I would love to have a built-in way to do that with properties (and business objects themselves, for that matter!)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Sunday, December 16, 2007</h2>Just a quick question regarding the proposed property changes.<br>What will be the situation when using csla net 3 with the NET20 directive?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, December 16, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>I do not believe the NET20 directive will work in CSLA .NET 3.5.
If I can pull it off I will, but the reality is that I&#8217;m using new
language features and other capabilities and so CSLA .NET 3.5 will almost
certainly require .NET 3.5&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>This means 3.0.x will be the .NET 2.0/3.0 version of choice.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Also, if I did/do try to avoid using all the new features of
.NET, I&#8217;d almost certainly have to include a NET30 directive, and
probably NET20a and NET30a directives too (because of the SP1 versions of both
prior framework).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The permutations start to get ridiculous.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>But take INotifyPropertyChanging for example. It is a .NET 2.0a
feature. So technically it should compile in for NET20, but it can&#8217;t. So
do I need a NET20a directive too? I&#8217;m not up for that much pain &#8211;
especially when I&#8217;m doing this all in VB and C#, and soon in CSLA .NET and
CSLA Light. Four code bases, all of which have 5 permutations is clearly
impractical.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Jimbo
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Sunday, December 16, 2007 5:09 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Just a quick question regarding the proposed property
changes.<br>
What will be the situation when using csla net 3 with the NET20 directive?<br>
<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, December 20, 2007</h2><P>Rocky,</P>
<P>1. I warned you about those compiler directives! &lt;g&gt; <BR>&nbsp;&nbsp;&nbsp; I vote you abandon them for 3.5.</P>
<P>2. I can see both sides of the debate of the enhanced Property code you are proposing. My choice would be that you somehow make it an optional feature that can be switched on/off on a per BO basis. In other words if I inherit from BusinessBase(Of T) let me set a switch in the BO to use the original field tracking mechanism. e.g. UseFieldTracking = True.</P>
<P>3. It turns out that in many of my BOs I do have to track the original field value. (For some subset of the fields.) I even have rules that require knowing the current value vs. the original value. So I can definitely see the value in this.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DCottle replied on Thursday, December 20, 2007</h2><P>This is a great discussion.&nbsp; Conversations like this I think have greatly contributed the the quality of the frameworks that have been put out thus far.&nbsp; That and Rocky is a stud...</P>
<P>My 2 cents:&nbsp;&nbsp; I think most of us have customized the framework in some way or another...a new interface, a new method, something.</P>
<P>Could we not have the FieldData used as Patrick has suggested and simply add our own partial class to the Field Data object to expand it to track information that we deem necessary as a developer?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 21, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Partial classes only work when both parts of the code are in the
same project. If FieldData is declared in Csla.dll you can&#8217;t partial
class off it, only inherit from it.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I am considering two models at the moment &#8211; a base class
model like that, or an interface-based model like IFieldData.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Either way, my current thinking is to NOT track original values
in core CSLA, but to enable doing so in a custom base class. If I have time, I
might include such a variant in CSLA itself, so there&#8217;d be
BusinessBase&lt;T&gt; and EnhancedBusinessBase&lt;T&gt; or something like that.
But at a minimum I intend to allow <i>you</i> to create a custom base class
that enables original value tracking or other enhanced (if sometimes costly)
behaviors.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> DCottle
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Thursday, December 20, 2007 2:37 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>This is a great discussion.&nbsp; Conversations like this I think have
greatly contributed the the quality of the frameworks that have been put out
thus far.&nbsp; That and Rocky is a stud...<o:p></o:p></p>

<p>My 2 cents:&nbsp;&nbsp; I think most of us have customized the framework in
some way or another...a new interface, a new method, something.<o:p></o:p></p>

<p>Could we not have the FieldData used as Patrick has suggested and simply add
our own partial class to the Field Data object to expand it to track
information that we deem necessary as a developer?<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Friday, December 21, 2007</h2><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><br>I am considering two models at the moment – a base class model like that, or an interface-based model like IFieldData. <br>...<br>But at a minimum I intend to allow you to create a custom base class that enables original value tracking or other enhanced (if sometimes costly) behaviors.<br></div></BLOCKQUOTE>Nice <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />. <br>So would you use:<br></font><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><br></font><font face="Arial" size="3"><strong>Option 2 - managed (by 
BusinessBase ) backing field<br></strong>based on: Dictionary&lt;String, 
Object&gt; <br>
</font><font face="Arial" size="3"></div></BLOCKQUOTE></font><font face="Arial" size="3"><br>but instead with </font><font face="Arial" size="3">Dictionary&lt;String, FieldData&gt; or Dictionary&lt;String, IFieldData&gt;?<br></font><font face="Arial" size="3"><br>And if you go with the base class model would it be something along these lines?<br></font><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Patrick:</strong></div><div><br></font><font face="Arial" size="3">&nbsp;&nbsp;&nbsp; public class FieldData { }<br>&nbsp;&nbsp;&nbsp; public class FieldData&lt;T&gt; : FieldData<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T CurrentValue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get&nbsp; { return _CurrentValue; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set&nbsp; { _CurrentValue = value; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font><font face="Arial" size="3"></div></BLOCKQUOTE></font><font face="Arial" size="3"><br></font><font face="Arial" size="3">Thanks,<br>Patrick</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 21, 2007</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Yes, though the base class will probably also track changes –
using the same fast-but-not-too-smart technique used in BusinessBase today.
Odds are that I’ll do both an interface and base class. Interface for
flexibility, base class for simplicity.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I’ll probably also introduce an ITrackStatus interface that
implements IsNew, IsDirty, IsValid and IsDeleted. This will allow BB to easily
loop through all items in the dictionary (fields, child objects, child
collections) to find out if the object is dirty and/or valid (FieldData will always
return true for IsValid).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>(In that case IEditableBusinessObject, IEditableCollection and
IFieldData would all implement ITrackStatus)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Haven’t actually implemented this particular approach yet
though, so no guarantees on what may or may not happen.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Patrick
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Friday, December 21, 2007 12:01 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: RE: CSLA .NET 3.5 enhancement -
property declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<blockquote>

<div>

<p class=MsoNormal><span><img id="_x0000_i1025" src="/Themes/basicblue/images/icon-quote.gif"><strong><span>RockfordLhotka:</span></strong><o:p></o:p></span></p>

</div>

<div>

<p class=MsoNormal><span><br>
I am considering two models at the moment â€“ a base class model like that, or
an interface-based model like IFieldData. <br>
<br>
Either way, my current thinking is to NOT track original values in core CSLA,
but to enable doing so in a custom base class. If I have time, I might include
such a variant in CSLA itself, so thereâ€™d be BusinessBase&lt;T&gt; and
EnhancedBusinessBase&lt;T&gt; or something like that. But at a minimum I intend
to allow you to create a custom base class that enables original value tracking
or other enhanced (if sometimes costly) behaviors.<o:p></o:p></span></p>

</div>

</blockquote>

<p class=MsoNormal><span><br>
<br>
Nice. So would it be something along the lines of Dictionary&lt;String,
FieldData&gt; or Dictionary&lt;String, IFieldData&gt;?<br>
<br>
And if you go with the base class model would it be something along these
lines?<o:p></o:p></span></p>

<div>

<p class=MsoNormal><span><img id="_x0000_i1026" src="/Theme%20s/basicblue/images/icon-quote.gif"><strong><span>Patrick:</span></strong><o:p></o:p></span></p>

</div>

<div>

<p class=MsoNormal><span><br>
&nbsp;&nbsp;&nbsp; public class FieldData { }<br>
&nbsp;&nbsp;&nbsp; public class FieldData&lt;T&gt; : FieldData<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T CurrentValue<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get&nbsp; {
return _CurrentValue; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set&nbsp; {
_CurrentValue = value; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>

</div>

<p class=MsoNormal><span><br>
<br>
Thanks,<br>
Patrick</span><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Friday, December 21, 2007</h2>Exciting. Sounds even better than I had imagined it <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>Thanks for being open to suggestions,<br>Patrick<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Monday, December 31, 2007</h2><P>Hey guys <BR>Just wondering if any more progress has been made here in terms of a design or&nbsp;concept of how things are actually going to work.<BR><BR>Also I was just thinking that because of the Undo features that&nbsp;the businessbase class have, I was wondering how this would impact the design. In that, if the dictionary approach was taken would the whole dictionary be subject to the undo (including all the proposed metadata which is the same from undo point to undo point) or just the actual field value that dictionary item represents. Likewise if the field route is chosen would the situation be similar???<BR><BR>One thing that could be done is that this system is run using three different dictionaries. One that is &lt;string, object&gt; which holds the property name and the current value (maybe a little more and not just the value but to be able to hold the value and a type which indicates whether the property has changed). The next being &lt;string, object&gt; which holds the property name and the original value (so it can be used to determine if the value has changed and because its separate if would be easy to turn on and off if performance is a concern with holding the original value) and this field would not be undoable. And the last being &lt;string, PropertyMetaData&gt; or something similar which holds all the metadata for that property which the metadata&nbsp;data may be instance or static based (meaning that some of the meta data may be set specifically for this instance of the object and some may be static) and this too would be marked as not undoable. <BR><BR>An update would be good on the current design that you are working on and I thought I would share the idea.<BR>Thanks <BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Tuesday, January 01, 2008</h2><P>Hi again <BR>Other people have probably already thought of this, but if the data is kept in a dictionary it makes undo processes considerably easier, potentially more flexible and should be more efficient. In that, at the moment it uses reflection to loop through all the different sub classes, to find all the fields and copy them for each undo. If the dictionary was used, the only thing that would need to happen is that the dictionary is copied. The fields that are needed to be copied are already known and hence don’t need to be discovered through reflection. Meaning that for the whole process you don’t need to use reflection (besides maybe GetType)&nbsp;when it comes doing the copy (note you will still need the Serialization to deal with reference types). This does mean that every field that wants to be subject to the undo must be in the dictionary but I don’t think that this is a bad idea. <BR><BR>Physically i imagine that this would work by the system looping through each item in the dictionary when a copy is required, adding each of the current values to a new dictionary except where the type of the current item is of baseundo. If it is the later then it calls the undo dictionary copy process on it, just like the current model does.<BR><BR>Also it opens up some interesting possibilities of conducting differential undo copies. In that when a copy occurs, it only stores what values have changed (I see this feature as possibly one that could be turned on and off by config and that an attribute can be used to do a forced copy in some situations regardless of change). It also adds some interesting ideas that a user could just undo changes for a partial field and another idea where the user could undo the history of one of the histories that are not current, just like Photoshop does. It allows you to remove the third last change you did without undoing the last two. Now granted these two things are not features that every user interface would have, but imagine some of the UI possibilities where the user could have a panel on the left which allows them to track the changes as they make then and see what they had and what it now is and undo just particular changes in history if required.<BR><BR>It might also mean that some of the limitations that you have previously mentioned with porting the undo functionality to silverlight won’t be a problem because it no longer relies on reflection in the way it did.<BR><BR>Also in terms of the initial base/default data being stored of what the object was, if memory serves me correctly peoples main objection was the about of extra data that this would mean that was travelling over the wire. What if the default data was stored in the dictionary like i have mentioned above and that dictionary is marked as nonserializable and that that dictionary only gets populates after the data comes back from the data portal on the fetch. Meaning that it adds no extra overhead to what’s going across the wire. It still means that more memory will be taken up on the client because of the copy but maybe if the copy was optional and an attribute was able to be set to say don’t take a default snapshot for this value.&nbsp;This might&nbsp;be used in cases where you have lots of text in a field or something. If that attribute is chosen then the system which checks whether the value has changed would have to conclude that a value has changed if the property is updated once (regardless of whether it was put back to what it was).<BR><BR>Just thought I would share a few more ideas I had.<BR>If anyone has any ideas on this I would be more than happy to see what you think.<BR>Thanks <BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Wednesday, January 02, 2008</h2><P>Any updaes or ideas on this topic yet??<BR>Thanks <BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 03, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>vdhant:</strong></div><div>
<P>It might also mean that some of the limitations that you have previously mentioned with porting the undo functionality to silverlight won’t be a problem because it no longer relies on reflection in the way it did.<BR></div></BLOCKQUOTE></P>
<P>Yes, this is a potential benefit. Though based on recent ScottGu comments, it may be a non-issue. I think they ended up implementing more reflection in Silverlight than they originally planned, because data binding is incredible reflection-heavy, and they are implementing data binding (or a large subset of it anyway) in Silverlight.</P>
<P>Which is good news imo!</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>vdhant:</strong></div><div></P>
<P>Also in terms of the initial base/default data being stored of what the object was, if memory serves me correctly peoples main objection was the about of extra data that this would mean that was travelling over the wire. What if the default data was stored in the dictionary like i have mentioned above and that dictionary is marked as nonserializable and that that dictionary only gets populates after the data comes back from the data portal on the fetch. Meaning that it adds no extra overhead to what’s going across the wire. It still means that more memory will be taken up on the client because of the copy but maybe if the copy was optional and an attribute was able to be set to say don’t take a default snapshot for this value.&nbsp;This might&nbsp;be used in cases where you have lots of text in a field or something. If that attribute is chosen then the system which checks whether the value has changed would have to conclude that a value has changed if the property is updated once (regardless of whether it was put back to what it was).</P>
<P></div></BLOCKQUOTE></P>
<P>I'm not sure this is so clear. The dictionary will store IFieldData objects - which could be child collections, child objects or FieldData&lt;T&gt; objects (that contain a field and related metadata). Or they could be a custom-created implementation of IFieldData that stores original values or does other fancy things like you are describing.</P>
<P>But when the business object flows through the data portal, the dictionary must go too, because it now contains the object's state. The child objects, field values and so forth must all be available to the clone on the other end of the wire or we lose location transparency.</P>
<P>It is important to remember that the data portal is <EM>not designed as a datagram replacement</EM>. The data portal is all about location transparency and giving you the illusion that your objects didn't actually move (as much as possible).</P>
<P>If the goal is <EM>not</EM> location transparency, then the data portal should not be used. Instead, the data portal should always be run in local mode and a datagram-based DAL should be invoked to get across the wire. That provide architectural clarity, because such a DAL is clearly not trying to clone the object graph across the wire, it is merely moving optimized datagrams from the client to&nbsp;a server-side component.</P>
<P>So the data portal will clone the dictionary as part of the object. What I am hoping however, is that I can implement ISerializable by hand - either at the FieldDataManager level or more likely at the FieldData&lt;T&gt; level to minimize the size of the byte array. Unfortunately I am skeptical that this will work, because there's always the potential for&nbsp;a subclass of FieldData&lt;T&gt; or a custom implementation of IFieldData.</P>
<P>The primary reason the byte stream expands is that the type of each child object in the dictionary must be serialized, in addition to the data inside the child object. If I <EM>knew</EM> that all child objects were FieldData&lt;T&gt; I could optimize. But to support custom classes I can't know that.</P>
<P>I'm also leery of the premature optmization anti-pattern, and so I'll probably finish the prototype code without worrying about this issue overmuch, and then see if I believe it is a serious issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Thursday, January 03, 2008</h2><P class=MsoNoSpacing><FONT face=Arial>I’ve been able to save a little bit on serialization through implementing a static dictionary and an instance array of values:</FONT></P>
<P class=MsoNoSpacing><o:p><FONT face=Arial>&nbsp;</FONT></o:p></P>
<P class=MsoNoSpacing><FONT face=Arial>private static Dictionary&lt;string, int&gt; _properties = new Dictionary&lt;string, int&gt;(); // property name as key, value = index of FieldData value in _value array.</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial>private FieldData[] _values = new FieldData[_properties.Count];</FONT></P>
<P class=MsoNoSpacing><o:p><FONT face=Arial>&nbsp;</FONT></o:p></P>
<P class=MsoNoSpacing><FONT face=Arial>protected static PropertyInfo&lt;TProperty&gt; RegisterProperty&lt;TProperty&gt;( string name, string display )</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial>{</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>var prop = new PropertyInfo&lt;TProperty&gt;(name, display);</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>_properties[prop] = _properties.Count;</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>return prop;</FONT></P>
<P class=MsoNoSpacing><FONT face=Arial>}</FONT></P>
<P class=MsoNoSpacing><o:p><FONT face=Arial>&nbsp;</FONT></o:p></P>
<P class=MsoNoSpacing><FONT face=Arial>By using the RegisterProperty function ( instead of "= new PropertyInfo&lt;&gt;()" ), we add all the properties the dictionary in the same order which will ensure that the properties are stored in the same location in the array on both sides of the data portal.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 03, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>That seems dangerous to me. I am not sure the order in which
static methods are called (e.g. RegisterProperty()) is defined, and if it is
not then you could run into odd issues on different CPUs that use different JIT
compilers and scenarios like that.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Also, the big size issue comes from serializing the FieldData
object itself – not because of the fields it contains as much as that the type
information for each FieldData must be included. As long as I allow for
extensibility (subclasses of FieldData) this is an issue. And I must allow for
subclasses or we lose the ability for people to add original value tracking and
other advanced concepts.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I also have the issue that PropertyInfo itself can be
subclassed. So a RegisterProperty() method would need you to create and pass in
your PropertyInfo object. The result would look like:<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>private static PropertyInfo&lt;string&gt;  NameProperty = <o:p></o:p></span></p>

<p class=MsoNormal><span>  RegisterProperty&lt;string&gt;(new PropertyInfo&lt;string&gt;(“Name”));<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>or something like that. I can’t create the PropertyInfo object,
because I want to allow you to create custom subclasses that contain addition
property metadata beyond the few fields CSLA itself requires.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Bob Matthew
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Thursday, January 03, 2008 11:40 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNoSpacing><span>Iâ€™ve
been able to save a little bit on serialization through implementing a static
dictionary and an instance array of values:</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>private
static Dictionary&lt;string, int&gt; _properties = new Dictionary&lt;string,
int&gt;(); // property name as key, value = index of FieldData value in _value
array.</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>private
FieldData[] _values = new FieldData[_properties.Count];</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>protected
static PropertyInfo&lt;TProperty&gt; RegisterProperty&lt;TProperty&gt;( string
name, string display )</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>{</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
var prop = new PropertyInfo&lt;TProperty&gt;(name, display);</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
_properties[prop] = _properties.Count;</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return prop;</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>}</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>&nbsp;</span><o:p></o:p></p>

<p class=MsoNoSpacing><span>By using
the RegisterProperty function ( instead of &quot;= new
PropertyInfo&lt;&gt;()&quot; ), we add all the properties the dictionary in the
same order which will ensure that the properties are stored in the same
location in the array on both sides of the data portal.</span><o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Friday, January 04, 2008</h2><FONT face=Arial>
<P><FONT face=Arial>Your above comments show why you're the framework designer and I'm not.</FONT></P>
<P><FONT face=Arial>As far as the bulk of serialized data is concerned, I can definitely see that it comes from - I’ve enabled WCF tracing on my application requests to the portal and I can see the messages to and from the portal.</FONT></P>
<P><FONT face=Arial>My understanding is that when a particular class is serialized, the serialization mechanism will store the type of the main class in the serialized data, but then each member value it serializes doesn't need its type stored as the type is retrieved from the class definition.</FONT></P>
<P><FONT face=Arial>The problem is when the type in the class definition is "object" or IWhatever - the serializer has to store the type so that it can reconstitute the data on the other side into the appropriate object.&nbsp; I too, am having a hard time seeing a solution.&nbsp; I wonder if Patrick has any ideas.</FONT></P>
<P><FONT face=Arial>In the meantime, one thing I've seen is that little bits of overhead can be trimmed here and there.&nbsp; The one magic parameter I've seen that can help with this for those of us that use WCF is found in the [DataMember] attribute.&nbsp; It's called EmitDefaultValue - set it to false (the default is true) and it will cut down on the size of everything from the GlobalContext to BusinessBase to BusinessListBase.</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 04, 2008</h2><P>The whole serialization thing is troublesome. Necessary of course, but troublesome.</P>
<P>I spent a lot of time yesterday, for example, trying to work around the fact that a dictionary's OnDeserialized method is called before the <EM>contents of the dictionary have been deserialized</EM>. Unfortunately the dictionary itself is apparently "deserialized" before its contents. Then there's no way to know when the contents do finally get deserialized.</P>
<P>I did come up with a workaround, but I'm not sure I like it. So now I'm considering switching to a more complex data structure to avoid using a dictionary. Well "complex" isn't the right word - the data structure isn't complex, but the fact that I have to manually create the data structure is complex compared to just using a pre-built type...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 04, 2008</h2><P>I put&nbsp;up a new preview release of 3.5 just now. The VB version has the new property functionality, which passes my tests and looks pretty good.</P>
<P>You can see the primary <A href="http://www.lhotka.net/cslacvs/viewvc.cgi/trunk/cslatest/Csla.Test/PropertyGetSet/EditableGetSet.cs?view=markup">test business root class</A>.</P>
<P><STRONG>Declare a property with private backing field:</STRONG></P>
<P>private static PropertyInfo&lt;string&gt; NameProperty = new PropertyInfo&lt;string&gt;("Name");<BR>private string _name&nbsp;= NameProperty.DefaultValue;<BR>public string Name<BR>{<BR>&nbsp; get { return GetProperty&lt;string&gt;(NameProperty, _name); }<BR>&nbsp; set { SetProperty&lt;string&gt;(NameProperty, ref _name, value); }<BR>}</P>
<P><STRONG>Declare a property with a managed backing field:</STRONG></P>
<P>private static PropertyInfo&lt;string&gt; NameProperty = new PropertyInfo&lt;string&gt;("Name");<BR>public string Name<BR>{<BR>&nbsp; get { return GetProperty&lt;string&gt;(NameProperty); }<BR>&nbsp; set { SetProperty&lt;string&gt;(NameProperty, value); }<BR>}</P>
<P><STRONG>Declare a SmartDate string property with private backing field:</STRONG></P>
<P>private static PropertyInfo&lt;SmartDate&gt; BDateProperty = new PropertyInfo&lt;SmartDate&gt;("BDate");<BR>private SmartDate _bDate = BDateProperty.DefaultValue;<BR>public string BDate<BR>{<BR>&nbsp; get { return GetProperty&lt;SmartDate, string&gt;(BDateProperty, _bDate); }<BR>&nbsp; set { SetProperty&lt;SmartDate, string&gt;(BDateProperty, ref _bDate, value); }<BR>}</P>
<P><STRONG>Declare a SmartDate string property with managed backing field:</STRONG></P>
<P>private static PropertyInfo&lt;SmartDate&gt; BDateProperty = new PropertyInfo&lt;SmartDate&gt;("BDate");<BR>public string BDate<BR>{<BR>&nbsp; get { return GetProperty&lt;SmartDate, string&gt;(BDateProperty); }<BR>&nbsp; set { SetProperty&lt;SmartDate, string&gt;(BDateProperty, value); }<BR>}</P>
<P><STRONG>Declare a single child object property:</STRONG></P>
<P>private static PropertyInfo&lt;Child&gt; ChildProperty = new PropertyInfo&lt;Child&gt;("Child");<BR>public Child Child<BR>{<BR>&nbsp; get <BR>&nbsp; { <BR>&nbsp;&nbsp;&nbsp; if (!FieldManager.FieldExists(ChildProperty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;Child&gt;(ChildProperty, Child.NewChild());<BR>&nbsp;&nbsp;&nbsp; return GetProperty&lt;Child&gt;(ChildProperty); <BR>&nbsp; }<BR>}</P>
<P><STRONG>Declare a single <EM>lazy loaded</EM>&nbsp;child object property:</STRONG></P>
<P>private static PropertyInfo&lt;Child&gt; ChildProperty = new PropertyInfo&lt;Child&gt;("Child");<BR>public Child Child<BR>{<BR>&nbsp; get <BR>&nbsp; { <BR>&nbsp;&nbsp;&nbsp; if (!FieldManager.FieldExists(ChildProperty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;Child&gt;(ChildProperty, Child.GetChild(this.Id));<BR>&nbsp;&nbsp;&nbsp; return GetProperty&lt;Child&gt;(ChildProperty); <BR>&nbsp; }<BR>}</P>
<P><STRONG>Declare a child list object property:</STRONG></P>
<P>private static PropertyInfo&lt;ChildList&gt; ChildListProperty = <BR>&nbsp; new PropertyInfo&lt;ChildList&gt;("ChildList");<BR>public ChildList ChildList<BR>{<BR>&nbsp; get <BR>&nbsp; { <BR>&nbsp;&nbsp;&nbsp; if (!FieldManager.FieldExists(ChildListProperty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;ChildList&gt;(ChildListProperty, ChildList.NewList());<BR>&nbsp;&nbsp;&nbsp; return GetProperty&lt;ChildList&gt;(ChildListProperty); <BR>&nbsp; }<BR>}</P>
<P><STRONG>Declare a <EM>lazy loaded</EM>&nbsp;child list object property:</STRONG></P>
<P>private static PropertyInfo&lt;ChildList&gt; ChildListProperty = <BR>&nbsp; new PropertyInfo&lt;ChildList&gt;("ChildList");<BR>public ChildList ChildList<BR>{<BR>&nbsp; get <BR>&nbsp; { <BR>&nbsp;&nbsp;&nbsp; if (!FieldManager.FieldExists(ChildListProperty))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty&lt;ChildList&gt;(ChildListProperty, ChildList.GetList(this.Id));<BR>&nbsp;&nbsp;&nbsp; return GetProperty&lt;ChildList&gt;(ChildListProperty); <BR>&nbsp; }<BR>}</P>
<P>That covers all the variations currently supported in the VB version of the framework. Whether you develop in VB or C#, I'd appreciate it if you can write some code against the VB framework and let me know what you think, whether you encounter issues, etc. </P>
<P><STRONG>Your feedback now is critical</STRONG>, as I intend on effectively finalizing this by January 11. Gotta move onto other areas, and also allow time to port all these changes to C#. Thanks!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Friday, January 04, 2008</h2>In FieldData maybe this could test a config setting before simply setting the dirty as true if the object data changes. It might make things easier if people want to enhance the field isDirty.<br /><FONT size=2>
</FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> T Value<br />
{<br />
</FONT><FONT color=#0000ff size=2>get<br /></FONT><FONT size=2>
{<br />
</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>._Value;<br />
}<br />
</FONT><FONT color=#0000ff size=2>set<br /></FONT><FONT size=2>
{<br />
</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>._Value == </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>)<br />
</FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2>;<br />
</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>._Value = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;<br />
</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>ApplicationContext</FONT><FONT size=2>.UseSimpleFieldIsDirty)<br />
</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>._IsDirty = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<br />
}<br />
} <br /></FONT>
<BR>&nbsp;<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 04, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>vdhant:</strong></div><div>In FieldData maybe this could test a config setting before simply setting the dirty as true if the object data changes. It might make things easier if people want to enhance the field isDirty.<BR>&nbsp;<BR><FONT size=2></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Value() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T<BR></FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mData<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)<BR>mData = value<BR><STRONG><FONT color=#0000ff>If</FONT> ApplicationContext.UseSimpleFieldIsDirty <FONT color=#0000ff>Then</FONT>&nbsp; mIsDirty = </STRONG></FONT><FONT color=#0000ff size=2><STRONG>True</STRONG><BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property<BR></FONT></div></BLOCKQUOTE></P>
<P>The extensibility model isn't done, but the basic concept is that if you want to extend/change the default behaviors you need to create custom IPropertyInfo and IFieldData classes of your own design. These two interact to make it all work.</P>
<P>So you'd (at a minimum) create a subclass of PropertyInfo&lt;T&gt; that returns the right kind of IFieldData as needed.</P>
<P>And you'd create an IFieldData like my FieldData&lt;T&gt; that does things like store original values, or provides alternate implementations of IsDirty.</P>
<P>But to be honest, I haven't thought all the way through that, so there could be holes I haven't figured out yet. My goal thus far has been to get the core functionality working, which I've now done. Next I'll work through extensibility in detail.</P>
<P>But I'm not overly worried about making this "simple". Extensibility can be complex - it is an advanced scenario. Common usage must be simple, because that's a common scenario.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Friday, January 04, 2008</h2><P>That’s fine. Off the top of my head one thing to consider is that if you are imagining that if people want to record the default data and that FieldData is the place to do that, one thing to consider is that I cannot see a scenario where I would want that to be copied with each undocopy. All being equal and this is the place where you imagine that you would want the default data to go, with my understanding of the default process and the way it walks the object tree structure there would be no way to get it not to copy this data for each undocopy, is that correct??? That’s the one thing that comes to mind and it may be something that you have already catered for.<BR>Thanks for the quick feedback on the above.<BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, January 05, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>The default value is in PropertyInfo, and is optionally set in
its constructor:<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>private static PropertyInfo&lt;string&gt; NameProperty =<o:p></o:p></span></p>

<p class=MsoNormal><span>  new PropertyInfo&lt;string&gt;(“Name”, “Customer name”, “&lt;unknown&gt;”);<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>This is the full form, where the property name, friendly name
and default value are provided.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>FieldData is simpler than PropertyInfo. It is only required to
track two things: the current value and IsDirty. You can track other things if
you’d like, but those two are the minimum required.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I see what you are saying about not storing the default value in
an enhanced FieldData if the initial was the default. However, I think there’s
a workable answer.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The FieldData object is created by the ProperytInfo object. As I
say, PropertyInfo is more complex, and one of its tasks is to create FieldData
objects when requested. Since it creates the FieldData for a given property
instance, it can initialize that FieldData as necessary. You could, therefore,
set up a back-link from your FieldData to the PropertyInfo “parent” so it would
be able to find the default value at any time. I suppose the FieldData Value
property would then look like this (assuming both initial value and parent
fields exist, and ignoring null value issues):<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>    Public Property Value() As T<o:p></o:p></span></p>

<p class=MsoNormal><span>      Get<o:p></o:p></span></p>

<p class=MsoNormal><span>        Return mData<o:p></o:p></span></p>

<p class=MsoNormal><span>      End Get<o:p></o:p></span></p>

<p class=MsoNormal><span>      Set(ByVal value As T)<o:p></o:p></span></p>

<p class=MsoNormal><span>        mData = value<o:p></o:p></span></p>

<p class=MsoNormal><b><span>        mIsDirty = Not (mData.Equals(mPropertyInfo.DefaultValue)
OrElse mData.Equals(mInitialValue))<o:p></o:p></span></b></p>

<p class=MsoNormal><span>      End Set<o:p></o:p></span></p>

<p class=MsoNormal><span>    End Property<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The only trick with that (beyond null checking) is that
mInitialValue would still have <i>some</i> value, and so you’d probably need an
extra flag to know whether it was ever set to something. <o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>    Public Property Value() As T<o:p></o:p></span></p>

<p class=MsoNormal><span>      Get<o:p></o:p></span></p>

<p class=MsoNormal><span>        Return mData<o:p></o:p></span></p>

<p class=MsoNormal><span>      End Get<o:p></o:p></span></p>

<p class=MsoNormal><span>      Set(ByVal value As T)<o:p></o:p></span></p>

<p class=MsoNormal><span>        mData = value<o:p></o:p></span></p>

<p class=MsoNormal><b><span>        mIsDirty = Not (mData.Equals(mPropertyInfo.DefaultValue)
OrElse _<o:p></o:p></span></b></p>

<p class=MsoNormal><b><span>          (mInitialValueSet AndAlso mData.Equals(mInitialValue)))<o:p></o:p></span></b></p>

<p class=MsoNormal><span>      End Set<o:p></o:p></span></p>

<p class=MsoNormal><span>    End Property<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>That’d add another bool to the size of each FieldData, so you’d
have to carefully weigh what’s worse: storing duplicate default values or
storing that extra bool. Assuming that most default values are 0 or null or
string.Empty then the bool would be worse than storing the default, because
mInitialValue would <i>already</i> be storing the default even if you didn’t
explicitly set it.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>In fact, the <i>only</i> time you’d save space by not copying
the initial value is for non-zero length strings. For value types (primitives,
etc) mInitialValue consumes the space to store the value whether you initialize
it or not.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> vdhant
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Friday, January 04, 2008 11:37 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Thatâ€™s fine. Off the top of my head one thing to consider is that if you
are imagining that if people want to record the default data and that FieldData
is the place to do that, one thing to consider is that I cannot see a scenario
where I would want that to be copied with each undocopy. All being equal and
this is the place where you imagine that you would want the default data to go,
with my understanding of the default process and the way it walks the object
tree structure there would be no way to get it not to copy this data for each
undocopy, is that correct??? Thatâ€™s the one thing that comes to mind and it
may be something that you have already catered for.<br>
Thanks for the quick feedback on the above.<br>
Anthony<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Sunday, January 06, 2008</h2><P>I recall reading about the dictionary serialization timing bug a while back. I'm not sure if you pointed it out or Rick Strahl did. It is pretty nasty. You'd think it would be fixed by now as it makes no sense.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Tuesday, February 12, 2008</h2>

<p class="MsoNormal">Hi,<br>
<br>
I was just wondering if the naming of LoadProperty is a bit counter intuitive?<br>
</p><p class="MsoNormal"><br><u>At the moment it is:<br></u>GetProperty (with checks)<br>
SetProperty (with checks)<br>
ReadProperty (without checks)<br>
LoadProperty (without checks)<br>
<br><u>
Wouldn't this be more intuitive?<br></u>
GetProperty (with checks)<br>
SetProperty (with checks)<br>
ReadProperty (without checks)<br>
WriteProperty (without checks)<br>
<br>
For me <b>Read </b>and <b>Load </b>are just too similar (nearly the same thing).<br>
<br>
To change it at the moment would just be search and replace for a few people
but once it's released it’s set in stone.<br>
<br>
Thanks for considering it, <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br>
Patrick<o:p></o:p></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Wednesday, February 13, 2008</h2><P>Load makes senesce to me as when you call load it marks the property as not being dirty... thus one would know that when "loading" a value the field will marked as not dirty. I don’t think that Write gives this same impression. If anything you would have read, load and write, where the difference between load and write is that load sets the property as not dirty and write sets it as dirty...</P>
<P>Just a thought.<BR>Anthony </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Friday, January 11, 2008</h2><font face="Arial" size="3"><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Bob Matthew:</strong></div><div></font><font face="Arial" size="3">I wonder if Patrick has any ideas.</font><font face="Arial" size="3"></div></BLOCKQUOTE><br>
<BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><strong>Your feedback now is critical</strong>,
as I intend on effectively finalizing this by January 11. Gotta move
onto other areas, and also allow time to port all these changes to C#.
Thanks!</div></BLOCKQUOTE><br>
Sorry I have been too snowed under at work and didn't have a chance yet to look what magic you came up with Rocky.... so </font><font face="Arial" size="3">unfortunately I </font><font face="Arial" size="3">couldn't give any feedback.<br><br>I trust though that it is very good <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br>Thanks &amp; all the best,<br>Patrick</font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 03, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div> 
<P>1. I warned you about those compiler directives! &lt;g&gt; <BR>&nbsp;&nbsp;&nbsp; I vote you abandon them for 3.5.</P>
<P></div></BLOCKQUOTE></P>
<P>Yes, you did <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>And I do plan to abandon them in 3.5, because it is impractical to use the new language features and allow for &lt;3.5 support. And there's no way I'm going to avoid using the new language features - they are far too cool/useful.</P>
<P>But I do think that using the NET20 directive for CSLA 3.0 was the right choice, because it means 3.0.x supports .NET 2.0-3.0 and so a single code base covers a wide range of users.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div></P>
<P>2. I can see both sides of the debate of the enhanced Property code you are proposing. My choice would be that you somehow make it an optional feature that can be switched on/off on a per BO basis. In other words if I inherit from BusinessBase(Of T) let me set a switch in the BO to use the original field tracking mechanism. e.g. UseFieldTracking = True.</P>
<P>3. It turns out that in many of my BOs I do have to track the original field value. (For some subset of the fields.) I even have rules that require knowing the current value vs. the original value. So I can definitely see the value in this.</P>
<P></div></BLOCKQUOTE></P>
<P>My current plan/prototype makes it optional - though not by a switch. You either use the feature or you don't. If you don't use the feature you don't pay the cost, nor do you reap the reward. If you do use the feature you pay the cost and get the benefit.</P>
<P>More specifically, I'm implementing two overloads of GetProperty() and SetProperty() - one that accepts a private field and one that manages the "field" value for you. </P>
<P>If you opt for a private field you'll get better performance and smaller serialized data over the data portal.</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New">GetProperty&lt;string&gt;(NameProperty, _name);<BR>SetProperty&lt;string&gt;(NameProperty, ref _name, value);</FONT></P></BLOCKQUOTE>
<P>If you opt for a managed field you'll get the <EM>potential</EM> for original value tracking and more intelligent IsDirty behavior. </P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New">GetProperty&lt;string&gt;(NameProperty);<BR>SetProperty&lt;string&gt;(NameProperty, value);</FONT></P></BLOCKQUOTE>
<P>But just storing the field values in a Dictionary&lt;string, IFieldData&gt; increases the size of the serialized object byte stream - even before you add in the original value and any other meta-data you want to store on a per-property basis... I'm still trying to figure out how to minimize this impact. The next step is to manually implement ISerializable in my FieldData&lt;T&gt; class to see if that helps - but I'm a bit skeptical at this point.</P>
<P>I want to be clear though - I am <EM>not doing original value tracking in CSLA</EM>. I am <EM>enabling</EM> the concept by allowing you to subclass something called FieldDataManager and/or to provide your own implementation of IFieldData. To be honest, the specifics of how you'll do this are a bit vague just now, as my focus has been on getting the basic implementation working in a way I like. Once that's done I'll focus on extensibility.</P>
<P>In all cases, you will be able to (and should) store <EM>child references</EM> using the managed overload. The benefits there are tremendous and the serialization overhead is minimal. The benfits include:</P>
<UL>
<LI>No need to manually override IsDirty or IsValid in the parent 
<LI>No need to cascade child events through the parent (no hooking and rehooking events manually) 
<LI>Automatic edit level fix-ups for lazy loaded child objects 
<LI>More standardized code structure for a child property implementation - making code-gen easier</LI></UL>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 04, 2008</h2><P>Well Bob, I did end up doing something similar to what you are doing. I'm storing the values in a List&lt;IFieldData&gt; and manually maintaining a keyed Dictionary to index back into it. My implementation isn't order-dependant and so I think it is safe.</P>
<P>I had to do this due to that nasty deserialization issue with Dictionary&lt;&gt; where the dictionary claims to be deserialized before the children it is supposed to contain are actually restored to the dictionary. Since I need to walk through and reset the parent reference and rehook child events on deserialization this was a serious issue.</P>
<P>I'm not sure that the new scheme makes the serialized object much (any) smaller on the wire, but at least it actually works <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 07, 2007</h2>






 





<div class=Section1>

<p class=MsoNormal><span>I currently am supporting both options 1-3 btw. Option 1 is nice
because it is performant, option 2 is nice because it saves some code. The
management of child objects will, I think, become normal for everyone, because
that saves a lot of code.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I have so far rejected tracking original values, primarily
because of the bloat it incurs over the wire. Doing this doubles the size of the
object graph as it moves from app server to/from client.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>It is true that having the original value is a really nice and
powerful feature, but it isn&#8217;t clear to me that it is valuable enough (to
everyone) to be worth the costs.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>That said, if I can enable the <i>concept</i> without forcing the
overhead on everyone that&#8217;s a good idea.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I&#8217;ve been considering factoring the implementation such
that the &#8220;PropertyManager&#8221; object is pluggable, for a variety of
reasons. I think doing that might allow you to do what you want, because the
PropertyManager is responsible for storing and interpreting each property&#8217;s
value.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>My primary motivation for making PropertyManager pluggable though,
is the possibility of building a manager that stores the values in a DTO
instead of a dictionary. Then, when you get a DTO back from a web service, LINQ
or ADO.NET EF, you might be able to just plop it into the PropertyManager and
not copy field-by-field. The only drawback I see with that, is that the
PropertyManager would almost certainly need to use reflection to retrieve the
values from the DTO&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Patrick
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Friday, December 07, 2007 2:35 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>I prefer &quot;Option 2 - managed (by BusinessBase ) backing
field&quot; <br>
<br>
I was wondering what your thoughts are on adjusting <br>
Dictionary&lt;String, Object&gt; to Dictionary&lt;String, FieldData&gt; <br>
<br>
There are many benefits like IsDirty on a field level, current value&nbsp; vs.
original value etc.<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Friday, December 07, 2007</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><div class="Section1"><span>I have so far rejected tracking original values, primarily
because of the bloat it incurs over the wire. Doing this doubles the size of the
object graph as it moves from app server to/from client.</span>

</div>

</div></BLOCKQUOTE><br><br>Glad you are interrested. I changed the class so that the current value always points to the original value as long as IsDirty == false.. This means that only if the current value is different to the original one will we incur more memory overhead.<br><br>Thanks,<br>Patrick<br><br>Here is the sample output:<br>Friendly Name: Customer name<br>Current Name: Bernhard<br>Is field dirty?: False<br>Current Name: Peter<br>Is field dirty?: True<br>Original Name: Bernhard<br>Current Age: 34<br>Is field dirty?: False<br>Current Age: 50<br>Is field dirty?: True<br>Original Age: 34<br><br>Here is the adjusted sample class:<br><br>---------------------------------------------<br>using System;<br>using System.Collections.Generic;<br><br>namespace CSLA.TestCase<br>{<br>&nbsp;&nbsp;&nbsp; public class TestCase<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void Test()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Customer customer = Customer.GetCustomer(1);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Friendly Name: " + Customer.NameProperty.FriendlyName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Current Name: " + customer.Name);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Is field dirty?: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;string&gt;(Customer.NameProperty).IsDirty.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.Name = "Peter";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Current Name: " + customer.Name);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Is field dirty?: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;string&gt;(Customer.NameProperty).IsDirty.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Original Name: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;string&gt;(Customer.NameProperty).OriginalValue);<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Current Age: " + customer.Age.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Is field dirty?: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;int&gt;(Customer.AgeProperty).IsDirty.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.Age = 50;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Current Age: " + customer.Age.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Is field dirty?: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;int&gt;(Customer.AgeProperty).IsDirty.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Original Age: " +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.GetPropertyField&lt;int&gt;(Customer.AgeProperty).OriginalValue);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // or as an alternative<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //customer.NameField.PropertyInfo.FriendlyName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //customer.NameField.OriginalValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //customer.NameField.CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //customer.NameField.IsDirty;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class BusinessBase<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Dictionary&lt;String, FieldData&gt; propertyData = new Dictionary&lt;string, FieldData&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FieldData&lt;T&gt; GetPropertyField&lt;T&gt;(PropertyInfo&lt;T&gt; nameProperty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldData fielDataObj;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldData&lt;T&gt; fieldData;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!propertyData.TryGetValue(nameProperty.Name, out fielDataObj))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldData = (FieldData&lt;T&gt;)fielDataObj;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return fieldData;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T GetProperty&lt;T&gt;(PropertyInfo&lt;T&gt; nameProperty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldData&lt;T&gt; fieldData = GetPropertyField&lt;T&gt;(nameProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (fieldData == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return default(T);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return fieldData.CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void SetPropertyField&lt;T&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyInfo&lt;T&gt; nameProperty, FieldData&lt;T&gt; fieldData)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!propertyData.ContainsKey(nameProperty.Name))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyData.Add(nameProperty.Name, fieldData);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyData[nameProperty.Name] = fieldData;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void SetProperty&lt;T&gt;(PropertyInfo&lt;T&gt; nameProperty, T value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldData&lt;T&gt; fieldData = GetPropertyField&lt;T&gt;(nameProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (fieldData == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPropertyField&lt;T&gt;(nameProperty, new FieldData&lt;T&gt;(nameProperty, value));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldData.CurrentValue = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class Customer : BusinessBase<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;string&gt; NameProperty =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new PropertyInfo&lt;string&gt;("Name", "Customer name");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;string&gt;(NameProperty); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty&lt;string&gt;(NameProperty, value); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Optional<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FieldData&lt;string&gt; NameField<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetPropertyField&lt;string&gt;(NameProperty); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;int&gt; AgeProperty =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new PropertyInfo&lt;int&gt;("Age", "Customer age");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Age<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;int&gt;(AgeProperty); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty&lt;int&gt;(AgeProperty, value); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Optional<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FieldData&lt;int&gt; AgeField<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetPropertyField&lt;int&gt;(AgeProperty); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Initializes a new instance of the ClassRocky class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Customer() { }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static Customer GetCustomer(int id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Customer customer = new Customer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.SetProperty&lt;string&gt;(NameProperty, "Bernhard");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.SetProperty&lt;int&gt;(AgeProperty, 34);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return customer;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class FieldData { }<br><br>&nbsp;&nbsp;&nbsp; public class FieldData&lt;T&gt; : FieldData<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private T _CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T CurrentValue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (IsDirty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _CurrentValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _OriginalValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (EqualityComparer&lt;T&gt;.Default.Equals(_CurrentValue, value))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _isDirty = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _CurrentValue = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private T _OriginalValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public T OriginalValue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _OriginalValue; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private PropertyInfo&lt;T&gt; _propertyInfo;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public PropertyInfo&lt;T&gt; PropertyInfo<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _propertyInfo; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private bool _isDirty = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public bool IsDirty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _isDirty; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Initializes a new instance of the FieldData class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="originalValue"&gt;&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FieldData(T originalValue)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _OriginalValue = originalValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Initializes a new instance of the FieldData class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="originalValue"&gt;&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="propertyInfo"&gt;&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FieldData(PropertyInfo&lt;T&gt; propertyInfo, T originalValue)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _OriginalValue = originalValue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _propertyInfo = propertyInfo;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; // Dummy should be replaced with CSLA PropertyInfo class<br>&nbsp;&nbsp;&nbsp; public class PropertyInfo&lt;T&gt;<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string _Name;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _Name; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string _FriendlyName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string FriendlyName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _FriendlyName; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Initializes a new instance of the PropertyInfo class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="name"&gt;&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="friendlyName"&gt;&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public PropertyInfo(string name, string friendlyName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _Name = name;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _FriendlyName = friendlyName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}<br>---------------------------------------------<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Friday, December 14, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> 

<DIV class=Section1>
<P class=MsoNormal><SPAN>It is true that having the original value is a really nice and powerful feature, but it isn’t clear to me that it is valuable enough (to everyone) to be worth the costs.<o:p></o:p></SPAN></P>
<P class=MsoNormal></div></BLOCKQUOTE></P>
<P class=MsoNormal>(I don't want to derail the topic, I solved the above&nbsp;problem a different way because I had a specific purpose in mind.&nbsp; If people want to discuss it, start a new thread and link to it from here.)</P>
<P class=MsoNormal>If I just want to go back to the original values, I can ask the database for the values again.&nbsp; No need to tote them around everywhere until then.</P>
<P class=MsoNormal>However, I did want to know which business rules were already broken when the object was instantiated from the database.&nbsp; They might be broken because of severity levels allow it, or they might be broken because it's a new (or newly-debugged)&nbsp;rule and the users haven't corrected the data yet.</P>
<P class=MsoNormal>For example, let's say that we have three new required fields for the Person business object, but those fields have not been filled in.&nbsp; We now need to know their nickname, their hair color and their favorite band.&nbsp; Typically, if a user tried to change the person's address, they would not be able to, until they also filled in the 3 new fields.&nbsp;</P>
<P class=MsoNormal>Because I know that those three rules were broken before the user fiddled with the record, it's ok for them to save the data as long as they don't break a new rule.&nbsp; The concept of "incremental improvement" is missing from most business rule frameworks.&nbsp; Plus, of course, the UI can direct the user to fix stuff BEFORE they try to save the data.</P></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 06, 2007</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>A side-effect of the new approach is that those attributes are
no longer required. That&#8217;s part of the code savings from the new
technique.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Jimbo
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Thursday, December 06, 2007 8:00 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Rocky,<br>
<br>
What becomes of the no - inlining statements that we have been using ?&nbsp; Or
has that been covered somewhere else ? <br>
<br>
<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RRorije replied on Monday, January 28, 2008</h2><P>Hi,</P>
<P>This architecture reminds me of the structure JP boodhoo (<A href="http://www.jpboodhoo.com">www.jpboodhoo.com</A>) uses in his project (<A href="http://code.google.com/p/jpboodhoo/">http://code.google.com/p/jpboodhoo/</A>) for his&nbsp;table-classes. I do not know whether it completely resembles this structure given by Rocky. But it might be worthwhile to take a look at it. </P>
<P>Below I have given some sample code, which I just copied and pasted out of the source of JP Boodhoo. I think the FieldData which is discussed in this thread and TableColumn do have some similarities.<BR><BR>Take a look at the code from JP, I think it is very nice!!!</P>
<P>Here a (shortened) table class:</P>
<P>public class CustomersTable{<BR>&nbsp;&nbsp;&nbsp;public static readonly string TableName = "Customers";</P>
<P>&nbsp;&nbsp;&nbsp;public static readonly TableColumn&lt;string&gt; LastName = new TableColumn&lt;string&gt;("LastName");<BR>&nbsp;&nbsp;&nbsp;public static readonly TableColumn&lt;string&gt; FirstName = new TableColumn&lt;string&gt;("FirstName");<BR>}<BR></P>
<P>And the Tablecolumn class.</P>
<P>public class TableColumn&lt;ColumnType&gt;{<BR>&nbsp;&nbsp;&nbsp;private string columnName;<BR>&nbsp;&nbsp;&nbsp;public TableColumn(string columnName){this.columnName = columnName; }<BR>&nbsp;&nbsp;&nbsp;public static implicit operator string(TableColumn&lt;ColumnType&gt; column)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return column.columnName;<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;public string ColumnName{ get { return columnName; } }<BR>&nbsp;&nbsp;&nbsp;public object RetrieveRawValueFrom(DataRow row){<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return row[columnName];<BR>&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;public ColumnType MapFrom(DataRow row) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (ColumnType) RetrieveRawValueFrom(row);<BR>&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;public bool IsNullFor(DataRow row)&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return RetrieveRawValueFrom(row) == DBNull.Value;<BR>&nbsp;&nbsp;&nbsp;}<BR>}<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Saturday, January 05, 2008</h2>Rocky,<br>
In your reckoning for code lines gains and losses.<br>
Only the section where you declare the private field has gained a line (or two):<br>
<br>
Private Shared NameProperty As PropertyInfo(Of String, Customer) = _<br>
&nbsp; RegisterProperty("Name", "Customer name")<br>
Private _name As String = NameProperty.DefaultValue<br>
<br>
Conventionally we declare private fields in the fields declarations
region at the head of the class.&nbsp; Presumably _name can still be
declared in that location along with other private fields. Thus the
properties region can be even more compact if you look at it that way..<br>
<br>
Also I don't&nbsp; understand RegisterProperty("Name", "Customer name") versus NameProperty<br>
what do the nasty "string literals" mean here ? and where do you set a
default value like EmptyString&nbsp; or "Some Preferred Name" etc ?<br>
<br>
I notice also that your pseudo code examples always seems to be vb ... <br>
<br>
Jimbo<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, January 05, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Make sure to look at the latest status post in this thread &#8211;
the syntax is different (no RegisterProperty()), and the example code is C# :)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Jimbo
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Saturday, January 05, 2008 1:07 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Rocky,<br>
In your reckoning for code lines gains and losses.<br>
Only the section where you declare the private field has gained a line (or
two):<br>
<br>
Private Shared NameProperty As PropertyInfo(Of String, Customer) = _<br>
&nbsp; RegisterProperty(&quot;Name&quot;, &quot;Customer name&quot;)<br>
Private _name As String = NameProperty.DefaultValue<br>
<br>
Conventionally we declare private fields in the fields declarations region at
the head of the class.&nbsp; Presumably _name can still be declared in that
location along with other private fields. Thus the properties region can be
even more compact if you look at it that way..<br>
<br>
Also I don't&nbsp; understand RegisterProperty(&quot;Name&quot;, &quot;Customer
name&quot;) versus NameProperty<br>
what do the nasty &quot;string literals&quot; mean here ? and where do you set
a default value like EmptyString&nbsp; or &quot;Some Preferred Name&quot; etc ?<br>
<br>
I notice also that your pseudo code examples always seems to be vb ... <br>
<br>
Jimbo<br>
<br>
<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmostert replied on Friday, January 18, 2008</h2><font face="Verdana" size="2">I have a slightly different suggestion:<br><br>Some suggestions allow for Properties to be re-used by different objects - which can be good.<br>But, what if you "registered" the property in the class? Use a static method and list and "register as you declare" - this will take care of the dictionary lookup and the only penalty is the boxing / unboxing:<br><br>The code is incomplete and just a indication of what is possible:<br><br><font face="Courier New">&nbsp;&nbsp;&nbsp; public interface IPropertyInfo<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class PropertyInfo&lt;T&gt;: IPropertyInfo<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private string FName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private string FFriendlyName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private T FDefaultValue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private int FID;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; internal PropertyInfo(string Name, string FriendlyName, T DefaultValue)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FName = Name;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FFriendlyName = Name;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FDefaultValue = DefaultValue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public string Name<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return FName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public string FriendlyName<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return FFriendlyName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public T DefaultValue<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return FDefaultValue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public Type Type<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return typeof(T);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //stores the Property's ID in the Entity Property List<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; internal int ID<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return FID;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FID = value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br><br>&nbsp;&nbsp;&nbsp; [Serializable]<br>&nbsp;&nbsp;&nbsp; public abstract class EntityBase&lt;TEntity&gt; : INotifyPropertyChanged, INotifyPropertyChanging<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; where TEntity: EntityBase&lt;TEntity&gt;<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private static List&lt;IPropertyInfo&gt; FProperties = new List&lt;IPropertyInfo&gt;();<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected static PropertyInfo&lt;T&gt; AddProperty&lt;T&gt;(string Name)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return AddProperty&lt;T&gt;(Name, Name);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected static PropertyInfo&lt;T&gt; AddProperty&lt;T&gt;(string Name, string FriendlyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PropertyInfo&lt;T&gt; prop = new PropertyInfo&lt;T&gt;(Name, FriendlyName, default(T));<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; prop.ID = FProperties.Count;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FProperties.Add(prop);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return prop;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private List&lt;object&gt; FFieldData = new List&lt;object&gt;(EntityBase&lt;TEntity&gt;.FProperties.Count);<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected T GetValue&lt;T&gt;(PropertyInfo&lt;T&gt; Property)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return(T)FFieldData[Property.ID];<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected void SetValue&lt;T&gt;(PropertyInfo&lt;T&gt; Property, T Value)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; object valobj = FFieldData[Property.ID];<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (valobj == null || (Value != null &amp;&amp; !valobj.Equals(Value)))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; OnPropertyChanging(Property.Name);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FFieldData[Property.ID] = Value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; OnPropertyChanged(Property.Name);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #region INotifyPropertyChanged Members<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [NonSerialized]<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private PropertyChangedEventHandler FNoSerPropertyChanged;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private PropertyChangedEventHandler FPropertyChanged;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event PropertyChangedEventHandler INotifyPropertyChanged.PropertyChanged<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; add<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (value.Method.IsPublic &amp;&amp; (value.Method.DeclaringType.IsSerializable || value.Method.IsStatic))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanged += value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanged += value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; remove<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (value.Method.IsPublic &amp;&amp; (value.Method.DeclaringType.IsSerializable || value.Method.IsStatic))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanged -= value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanged -= value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected virtual void OnPropertyChanged(string PropertyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (FNoSerPropertyChanged != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanged(this, new PropertyChangedEventArgs(PropertyName));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (FPropertyChanged != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanged(this, new PropertyChangedEventArgs(PropertyName));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #endregion<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #region INotifyPropertyChanging Members<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [NonSerialized]<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private PropertyChangingEventHandler FNoSerPropertyChanging;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private PropertyChangingEventHandler FPropertyChanging;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event PropertyChangingEventHandler INotifyPropertyChanging.PropertyChanging<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; add<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (value.Method.IsPublic &amp;&amp; (value.Method.DeclaringType.IsSerializable || value.Method.IsStatic))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanging += value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanging += value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; remove<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (value.Method.IsPublic &amp;&amp; (value.Method.DeclaringType.IsSerializable || value.Method.IsStatic))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanging -= value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanging -= value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected virtual void OnPropertyChanging(string PropertyName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (FNoSerPropertyChanging != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FNoSerPropertyChanging(this, new PropertyChangingEventArgs(PropertyName));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (FPropertyChanging != null)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FPropertyChanging(this, new PropertyChangingEventArgs(PropertyName));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #endregion<br>&nbsp;&nbsp;&nbsp; }<br></font><br><br>And an example of how to use it:<br><br><br><font face="Courier New">&nbsp;&nbsp;&nbsp; class TestData: EntityBase&lt;TestData&gt;<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; FNameProp = TestData.AddProperty&lt;string&gt;("Name");<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public string Name<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return GetValue(FNameProp);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetValue(FNameProp, value);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;DateTime&gt; FDOBProp = TestData.AddProperty&lt;DateTime&gt;("DOB", "Date of Birth");<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public DateTime DOB<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return GetValue(FDOBProp);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetValue(FDOBProp, value);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br></font><br><br>Please give feedback!<br><br><br>Regards,<br>D.<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 18, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>dmostert:</strong></div><div><FONT face=Verdana size=2>I have a slightly different suggestion:<BR><BR>Some suggestions allow for Properties to be re-used by different objects - which can be good.<BR>But, what if you "registered" the property in the class? Use a static method and list and "register as you declare" - this will take care of the dictionary lookup and the only penalty is the boxing / unboxing:<BR></FONT></div></BLOCKQUOTE></P>
<P>I originally did implement a static RegisterProperty() approach (more like the DependencyProperty idea in WPF/WF). But when I was done I found that I wasn't actually "registering" anything. The "resgister" process was simply adding the PropertyInfo&lt;T&gt; to a dictionary, and that was never used for anything.</P>
<P>So, as an optimization, I removed RegisterProperty() and that (essentially useless) dictionary of PropertyInfo&lt;T&gt; objects.</P>
<P>One thing that <EM>did</EM> occur to me was to go even further than what I'm doing here. Something so radical it would pretty much eliminate any upgrade path.</P>
<P>The idea is to make a "property" a first-class citizen. An object in its own right. Each property would have its own authorization and business rules. You'd write each property as a class, including code much like a current business object (to set up authorization and validation rules, etc). Then a business object would look much like it does today, but would register properties with a static RegisterProperty() so when an object instance is created it could loop through that list and create instances of each property object.</P>
<P>The amount of code you'd write would go <EM>up</EM> quite a lot (I think I showed some of it earlier in this thread), and the memory footprint on a per-business object basis would also go up, both in RAM on when serialized on the wire (though I think I could solve the issue on the wire by implementing custom serialization).</P>
<P>But the <EM>model</EM> is extremely elegant <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>On the whole though, my focus for 3.5 was to <EM>reduce</EM> the code needed to define a business object, not to increase the code required, so I decided (with input from the forum) to go with the current scheme.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Saturday, January 26, 2008</h2><P>Hi Rocky <BR>I just noticed something that may be a posible problem. In a couple of places you are doing the following:<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <EM><STRONG>OnPropertyChanging(propertyName);</STRONG></EM><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; field = newValue;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged(propertyName);<BR><BR>And then within PropertyHasChanged you are doing:<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG><EM>OnPropertyChanging(propertyName);</EM></STRONG><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules(propertyName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkDirty(true);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged(propertyName);<BR><BR>Which means OnPropertyChanging is fireing twice. Now this might be by design but if it is it&nbsp;would seem rather strange. My first instinct was to think that the two OnPropertyxyz method calls should be removed from the method since now the control within CSLA over when properties are set you could always have the OnPropertyChanging fireing before the value changes and OnPropertyChanged after. But in saying this I am not sure if there are other situations where people might need to all propertyhaschanged and need the OnPropertyxyz methods&nbsp; to run. So maybe you could create an overload that has a bool as the second param that can be used to switch whether the OnPropertyxyz methods should run (i.e. suppressEvent).<BR><BR>Also just wondering with the advent of OnPropertyChanging &amp; OnUnknownPropertyChanging shouldn't these type of methods now have OnUnknownPropertyChanging included or perhaps they could be changed to OnPropertyXyz and have "isDirty"&nbsp;passed in (maybe that could have a few issues thought when changing multiple fields in these methods)?<BR><BR>&nbsp;&nbsp;&nbsp; protected void MarkDirty(bool suppressEvent)<BR>&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!suppressEvent)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnUnknownPropertyChanging();</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _isDirty = true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!suppressEvent)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnUnknownPropertyChanged();<BR>&nbsp;&nbsp;&nbsp; }<BR><BR><BR>Just an idea if this is a problem.<BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 28, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Sounds like a problem &#8211; I&#8217;ll investigate. Thanks for
pointing this out!!!<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> vdhant
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Saturday, January 26, 2008 4:23 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Hi Rocky <br>
I just noticed something that may be a posible problem. In a couple of places
you are doing the following:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
OnPropertyChanging(propertyName);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
field = newValue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PropertyHasChanged(propertyName);<br>
<br>
And then within PropertyHasChanged you are doing:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanging(propertyName);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules(propertyName);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkDirty(true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnPropertyChanged(propertyName);<br>
<br>
Which means OnPropertyChanging is fireing twice. Now this might be by design
but if it is it&nbsp;would seem rather strange. My first instinct was to think
that the two OnPropertyxyz method calls should b e removed from the method
since now the control within CSLA over when properties are set you could always
have the OnPropertyChanging fireing before the value changes and
OnPropertyChanged after. But in saying this I am not sure if there are other
situations where people might need to all propertyhaschanged and need the
OnPropertyxyz methods&nbsp; to run. So maybe you could create an overload that
has a bool as the second param that can be used to switch whether the
OnPropertyxyz methods should run.<br>
<br>
Just an idea if this is a problem.<br>
Anthony<br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 28, 2008</h2><P>I hate to do something like this at the 11th hour, but the benefits are too great to ignore...</P>
<P>Specifically, I'm going back to the use of a RegisterProperty() method:</P>
<P>private static PropertyInfo&lt;string&gt; NameProperty =<BR>&nbsp; RegisterProperty&lt;string&gt;(new PropertyInfo&lt;string&gt;("Name"));</P>
<P>Private Shared NameProperty As PropertyInfo(Of String) = _<BR>&nbsp; RegisterProperty(Of String)(New PropertyInfo(Of String)("Name"))</P>
<P>To allow for external creation/maintenance of the PropertyInfo objects, notice how I'm requiring that you create the object. The RegisterProperty() method itself is generic so you don't have the cast the result. It returns the object you passed in, which is required because this must be used as shown - on the declaration of a static field (or I suppose in a static constructor, in which case you could probably technically ignore the result of RegisterProperty).</P>
<P>The core reason for the change is a 30% performance improvement. This technique means I can store managed field values in an array rather than a dictionary, so all get/set operations avoid a dictionary lookup (a couple in many cases) and this increases performance just a lot.</P>
<P>A side-effect is that I should be able to (though this won't be in Beta 1) do some cool stuff in DataMapper as well, since I'll be able to directly get a list of properties in an object without needing to use reflection, attributes or other slower technologies.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Monday, February 04, 2008</h2><P>I am trying to follow through the discussions in this thread, and have the following questions and comments.</P>
<P>1) Comparing the usage syntax of "Declare a property with private backing field" and "Declare a property with a managed backing field", the only different is the declaration of the private variable. Thus, can I make the assumption that when using private backing field, BO has duplicated state in the storage. One on the private backing field; another one on the managed backing field. This would increase the size of the serialized stream?</P>
<P>2) When using "Declare a property with a managed backing field", neither GetProperty() nor SetProperty() is given any reference to the current object. How does CLSA knows which set of field values belong to which BO instance? My first guess would be that GetProperty() and SetProperty() are using reflection or stack tracing? Would this a good practice?</P>
<P>3) In term of syntax, I am thinking that the field declaration syntax is a bit too long. Not very significant but just a comment.</P>
<P>&nbsp;&nbsp;&nbsp;<FONT face="Courier New" size=2>private static PropertyInfo&lt;string&gt; NameProperty =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegisterProperty&lt;string&gt;(new PropertyInfo&lt;string&gt;("Name"));</FONT></P>
<P>&nbsp;&nbsp;&nbsp;When compare with regular private field declaration, which is sort and concise.</P>
<P>&nbsp;&nbsp;&nbsp;<FONT face="Courier New" size=2>private static string _name = String.Empty;</FONT></P>
<P>I haven't go through the actual code for GetProperty() and SetProperty() but these are my first take.</P>
<P>Thanks.</P>
<P><BR>Regards,<BR>William<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 04, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>#1 is an incorrect assumption. If you use a private backing
field you manage the data, not CSLA &#8211; that&#8217;s the whole point of you
declaring a private backing field :)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The bigger difference isn&#8217;t size of the serialized data
stream, it is performance. It is quite a lot faster to use a private backing
field, because that avoids any lookups necessary to find the managed field, and
it avoids getting/putting the field into the IFieldData container. On the other
hand, some of the cool (future) features of DataMapper only work with managed fields,
and CSLA Light will almost certainly support only managed fields (no
serialization means I need access to the fields, which I get through the
managed approach).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>2) GetProperty/ReadProperty/SetProperty/LoadProperty are all
instance methods, so they intrinsically have access to the object&#8217;s type.
The RegisterProperty() method has a parameter you are missing &#8211; its first
parameter is the type of the containing object (just like the Register() method
for dependency properties).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>3) I wish it were shorter. But I don&#8217;t see a way to make
it shorter and still preserve the flexibility people have asked for (with good
justification) over the past few weeks.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>The primary goal of RegisterProperty and the PropertyInfo object
is to consolidate all string literals into one location. This elevates the
overall maintainability of the application, even though there is this one long
line per property. And let&#8217;s face it, this is short compared to declaring
a dependency property, and as we move toward WPF/WF we&#8217;ll all be writing
lots of those&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> William
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Monday, February 04, 2008 8:49 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>I am trying to follow through the discussions in this thread, and have the
following questions and comments.<o:p></o:p></p>

<p>1) Comparing the usage syntax of &quot;Declare a property with private backing
field&quot; and &quot;Declare a property with a managed backing field&quot;,
the only different is the declaration of the private variable. Thus, can I make
the assumption that when using private backing field, BO has duplicated state
in the storage. One on the private backing field; another one on the managed
backing field. This would increase the size of the serialized stream?<o:p></o:p></p>

<p>2) When using &quot;Declare a property with a managed backing field&quot;,
neither GetProperty() nor SetProperty() is given any reference to the current
object. How does CLSA knows which set of field values belong to which BO
instance? My first guess would be that GetProperty() and SetProperty() are
using reflection or stack tracing? Would this a good practice?<o:p></o:p></p>

<p>3) In term of syntax, I am thinking that the field declaration syntax is a
bit too long. Not very significant but just a comment.<o:p></o:p></p>

<p>&nbsp;&nbsp;&nbsp;<span>private
static PropertyInfo&lt;string&gt; NameProperty =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegisterProperty&lt;string&gt;(new
PropertyInfo&lt;string&gt;(&quot;Name&quot;));</span><o:p></o:p></p>

<p>&nbsp;&nbsp;&nbsp;When compare with regular private field declaration, which
is sort and concise.<o:p></o:p></p>

<p>&nbsp;&nbsp;&nbsp;<span>private
static string _name = String.Empty;</span><o:p></o:p></p>

<p>I haven't go through the actual code for GetProperty() and SetProperty() but
these are my first take.<o:p></o:p></p>

<p>Thanks.<o:p></o:p></p>

<p><br>
Regards,<br>
William<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Tuesday, February 05, 2008</h2>Rocky, thanks for your clarifications.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Wednesday, February 06, 2008</h2>Hi,&nbsp; all the changes look very cool. Thanks Rocky.<br>&nbsp;<br>I was wondering how virtual / dynamic fields fit into the changes you are making.<br>&nbsp;<br>Basically in our application we need to allow the end user to add arbitrary fields to extend a BO.<br>Like adding the name of a spouse to a customer object which didn't provide for it.<br>&nbsp;<br>It seems like that the RegisterProperty method etc. could be very helpful for this:<br>&nbsp;<br>* On application startup retrieve virtual property settings from database<br>* Register virtual properties<br>....<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch(propertyTypeName) {&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case "string":<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RegisterProperty&lt;string&gt;(typeof(typeName), new VirtualPropertyInfo&lt;string&gt;(propertyName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case "int":<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RegisterProperty&lt;int&gt;(typeof(typeName), new VirtualPropertyInfo&lt;int&gt;(propertyName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>....<br>* Override GetItemProperties from ITypedList in the BusinessBase class so that it can obtain and return the VirtualPropertyInfos from the PropertyInfoManager when GetItemProperties is called.<br>&nbsp;<br>* Extend the Get method of the BO to retrieve object from database including the virtual fields.<br>* On GetValue, SetValue of the virtual property descriptor use the given field name to retrieve the PropertyInfo object for the field from the PropertyInfoManager.<br>* When the PropertyInfo is obtained use it to get or set the value.<br>* Extend the Save method of the BO to persist the virtual fields.<br>&nbsp;<br>This is just a rough outline for now to find out if there is any interest in implementing something along these lines.<br><br>Thanks a lot for considering it, <br>Patrick <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br>
<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Wednesday, February 06, 2008</h2><P>Sounds interesting... <BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bob Matthew replied on Thursday, February 14, 2008</h2><P><FONT face=Arial size=2>Rocky,</FONT></P>
<P><FONT face=Arial size=2>I noticed in your example you had the RegisterProperty signature as follows:</FONT></P>
<P><FONT face=Arial size=2>private static PropertyInfo&lt;string&gt; NameProperty =<BR>&nbsp; RegisterProperty&lt;string&gt;(new PropertyInfo&lt;string&gt;("Name"));</FONT></P>
<P><FONT face=Arial size=2>Whereas in the Csla.Core.BusinessBase class it had an additional parameter of Type objectType.</FONT></P>
<P><FONT face=Arial size=2>I was wondering if would be possible for you to add an overload in the Csla.BusinessBase class that simply did this:</FONT></P>
<P><FONT face=Arial size=2>protected static PropertyInfo&lt;P&gt; RegisterProperty&lt;P&gt;( PropertyInfo&lt;P&gt; info)</FONT></P>
<P><FONT face=Arial size=2>{</FONT></P>
<P><FONT face=Arial size=2>&nbsp; return RegisterProperty( typeof(T), info ); // where T is the&nbsp;generic parameter provided to BusinessBase.</FONT></P>
<P><FONT face=Arial size=2>}</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 14, 2008</h2>Interesting idea - I'll consider that.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, February 16, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>Added this to BB and ROB in svn &#8211; great suggestion!!<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> Bob Matthew
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Thursday, February 14, 2008 10:54 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: CSLA .NET 3.5 enhancement - property
declarations<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p><span>Rocky,</span><o:p></o:p></p>

<p><span>I noticed in
your example you had the RegisterProperty signature as follows:</span><o:p></o:p></p>

<p><span>private
static PropertyInfo&lt;string&gt; NameProperty =<br>
&nbsp; RegisterProperty&lt;string&gt;(new
PropertyInfo&lt;string&gt;(&quot;Name&quot;));</span><o:p></o:p></p>

<p><span>Whereas in
the Csla.Core.BusinessBase class it had an additional parameter of Type
objectType.</span><o:p></o:p></p>

<p><span>I was
wondering if would be possible for you to add an overload in the
Csla.BusinessBase class that simply did this:</span><o:p></o:p></p>

<p><span>protected
static PropertyInfo&lt;P&gt; RegisterProperty&lt;P&gt;( PropertyInfo&lt;P&gt;
info)</span><o:p></o:p></p>

<p><span>{</span><o:p></o:p></p>

<p><span>&nbsp;
return RegisterProperty( typeof(T), info ); // where T is the&nbsp;generic
parameter provided to BusinessBase.</span><o:p></o:p></p>

<p><span>}</span><o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ben replied on Thursday, October 16, 2008</h2><P class=MsoNormal>Hi all,</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal><SPAN>We are using CSLA v3.0.2. In our application we have implemented property accessors following some considerations related to business logic, security and performance. <o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>We are studding to jump to CSLA v3.6.0 and it would be very helpful for us your opinion about these considerations and your advise about how to implement properties accessors with the new philosophy of PropertyInfo and our requirements.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Thanks in advance<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Benjamin<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><B><SPAN>Protecting object’s surface<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><B><SPAN><o:p>&nbsp;</o:p></SPAN></B></P>
<P class=MsoNormal><B><SPAN>Security considerations<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Any business object provides business logic through its properties and methods. That business logic may be used by the user or by other process. A business process may be composed by other sub processes.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Security authorizations must guarantee the user only access those properties and methods allowed to him/her. But there may be a conflict when some business process may be called by the user and by other processes. Let see an example:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><I><SPAN>There is a business rule that say: “When a customer is assigned to an order, all billing data associated with that customer must be set (copied) to the new order”.<o:p></o:p></SPAN></I></P>
<P class=MsoNormal><I><SPAN><o:p>&nbsp;</o:p></SPAN></I></P>
<P class=MsoNormal><I><SPAN>There may be an actor (an administrative) than can create an order but can’t see or change the billing data from the customer (it may be sensitive data).<o:p></o:p></SPAN></I></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>In this example the user must assign the customer to the order and the customer billing data must be copied to the order without letting the user seeing or changing that information.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>The properties accessors must guarantee the user can’t read and write their values but there is a process that needs to access those values to copy them from the customer to the order.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><B><SPAN>Performance considerations<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Before starting any process (by the user) the security system must be checked to see the user rights. But after the process is initialized the security system should not be rechecked for every sub process required by the main process.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>In the example explained above, the process that copy the billing data from the customer to the order may need an authorization to read every property from the customer and to write the same properties to the order. Those security checks may affect performance with no need.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><B><SPAN>Conclusion<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>These considerations illustrate the need of having two surfaces for the business logic. One for the user, protected by the security system, and other for internal processes, protected by “Friend” members.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><B><SPAN>Example code<o:p></o:p></SPAN></B></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Public</SPAN><SPAN> <SPAN>Class</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Inherits</SPAN> Csla.BusinessBase(<SPAN>Of</SPAN> Customer)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> mCustomerID <SPAN>As</SPAN> Guid = Guid.Empty<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> mBillingData <SPAN>As</SPAN> <SPAN>String</SPAN> = <SPAN>String</SPAN>.Empty<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>ReadOnly</SPAN> <SPAN>Property</SPAN> CustomerID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanReadProperty(<SPAN>"CustomerID"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.get__CustomerID()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Property<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Function</SPAN> get__CustomerID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.mCustomerID<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Property</SPAN> BillingData() <SPAN>As</SPAN> <SPAN>String<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanReadProperty(<SPAN>"BillingData"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.get__BillingData()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Set</SPAN>(<SPAN>ByVal</SPAN> value <SPAN>As</SPAN> <SPAN>String</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanWriteProperty(<SPAN>"BillingData"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>set__BillingData(value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Set<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Property<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Function</SPAN> get__BillingData() <SPAN>As</SPAN> <SPAN>String<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.mBillingData<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Sub</SPAN> set__BillingData(<SPAN>ByVal</SPAN> Value <SPAN>As</SPAN> <SPAN>String</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> <SPAN>Me</SPAN>.mBillingData <SPAN>Is</SPAN> <SPAN>Nothing</SPAN> <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> Value <SPAN>IsNot</SPAN> <SPAN>Nothing</SPAN> <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mBillingData = Value<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"BillingData"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>ElseIf</SPAN> <SPAN>Not</SPAN> <SPAN>Me</SPAN>.mBillingData.Equals(Value) <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mBillingData = Value<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"BillingData"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>#<SPAN>Region</SPAN> <SPAN>" Factory Methods "<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Shared</SPAN> <SPAN>Function</SPAN> NewCustomer() <SPAN>As</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>' Security checks go here<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Security.AccessControl.GoingTo(<SPAN>"CreateCustomer"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> Do_NewCustomer()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Shared</SPAN> <SPAN>Function</SPAN> Do_NewCustomer() <SPAN>As</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Dim</SPAN> obj <SPAN>As</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>obj = Csla.DataPortal.Create(<SPAN>Of</SPAN> Customer)()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> obj<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Shared</SPAN> <SPAN>Function</SPAN> GetCustomer(<SPAN>ByVal</SPAN> CustomerID <SPAN>As</SPAN> Guid) <SPAN>As</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>' Security checks go here<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Security.AccessControl.GoingTo(<SPAN>"GetCustomer"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> Do_GetCustomer(CustomerID)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Shared</SPAN> <SPAN>Function</SPAN> Do_GetCustomer(<SPAN>ByVal</SPAN> CustomerID <SPAN>As</SPAN> Guid) <SPAN>As</SPAN> Customer<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>CType</SPAN>(Csla.DataPortal.Fetch(<SPAN>New</SPAN> Criteria(CustomerID)), Customer)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>#<SPAN>End</SPAN> <SPAN>Region</SPAN> <SPAN>' Factory Methods<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> <SPAN>Sub</SPAN> <SPAN>New</SPAN>()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mCustomerID = Guid.NewGuid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mBillingData = <SPAN>"This is an example."<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Protected</SPAN> <SPAN>Overrides</SPAN> <SPAN>Function</SPAN> GetIdValue() <SPAN>As</SPAN> <SPAN>Object<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> mCustomerID<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>End</SPAN><SPAN> <SPAN>Class<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Public</SPAN><SPAN> <SPAN>Class</SPAN> Order<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Inherits</SPAN> Csla.BusinessBase(<SPAN>Of</SPAN> Order)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> mOrderID <SPAN>As</SPAN> Guid = Guid.Empty<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> mCustomerID <SPAN>As</SPAN> Guid = Guid.Empty<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> mBillingData <SPAN>As</SPAN> <SPAN>String</SPAN> = <SPAN>String</SPAN>.Empty<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>ReadOnly</SPAN> <SPAN>Property</SPAN> OrderID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanReadProperty(<SPAN>"OrderID"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.get__OrderID()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Property<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Function</SPAN> get__OrderID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.mOrderID<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Property</SPAN> CustomerID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanReadProperty(<SPAN>"CustomerID"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.get__CustomerID()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Set</SPAN>(<SPAN>ByVal</SPAN> value <SPAN>As</SPAN> Guid)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanWriteProperty(<SPAN>"CustomerID"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>set__CustomerID(value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;</SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Set<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Property<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Function</SPAN> get__CustomerID() <SPAN>As</SPAN> Guid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.mCustomerID<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Sub</SPAN> set__CustomerID(<SPAN>ByVal</SPAN> Value <SPAN>As</SPAN> Guid)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> <SPAN>Not</SPAN> <SPAN>Me</SPAN>.mCustomerID.Equals(Value) <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mCustomerID = Value<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>&nbsp;&nbsp;</SPAN><SPAN>' copy customer's billing data.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Dim</SPAN> cust <SPAN>As</SPAN> Customer = Customer.Do_GetCustomer(<SPAN>Me</SPAN>.mCustomerID)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mBillingData = cust.get__BillingData<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"CustomerID"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"BillingData"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp; </SPAN><SPAN>&nbsp;</SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Property</SPAN> BillingData() <SPAN>As</SPAN> <SPAN>String<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanReadProperty(<SPAN>"BillingData"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.get__BillingData()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Get<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Set</SPAN>(<SPAN>ByVal</SPAN> value <SPAN>As</SPAN> <SPAN>String</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CanWriteProperty(<SPAN>"BillingData"</SPAN>, <SPAN>True</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>set__BillingData(value)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Set<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Property<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Function</SPAN> get__BillingData() <SPAN>As</SPAN> <SPAN>String<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>Me</SPAN>.mBillingData<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Friend</SPAN> <SPAN>Sub</SPAN> set__BillingData(<SPAN>ByVal</SPAN> Value <SPAN>As</SPAN> <SPAN>String</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> <SPAN>Me</SPAN>.mBillingData <SPAN>Is</SPAN> <SPAN>Nothing</SPAN> <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> Value <SPAN>IsNot</SPAN> <SPAN>Nothing</SPAN> <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mBillingData = Value<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"BillingData"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>ElseIf</SPAN> <SPAN>Not</SPAN> <SPAN>Me</SPAN>.mBillingData.Equals(Value) <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Me</SPAN>.mBillingData = Value<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>PropertyHasChanged(<SPAN>"BillingData"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> <SPAN>Sub</SPAN> <SPAN>New</SPAN>()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mOrderID = Guid.NewGuid<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Protected</SPAN> <SPAN>Overrides</SPAN> <SPAN>Function</SPAN> GetIdValue() <SPAN>As</SPAN> <SPAN>Object<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> mOrderID<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>End</SPAN><SPAN> <SPAN>Class<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Namespace</SPAN><SPAN> Security<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Class</SPAN> AccessControl<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Shared</SPAN> <SPAN>Function</SPAN> CanI(<SPAN>ByVal</SPAN> PermissionName <SPAN>As</SPAN> <SPAN>String</SPAN>) <SPAN>As</SPAN> <SPAN>Boolean<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>'TODO: Implement this method.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Return</SPAN> <SPAN>False<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Function<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Public</SPAN> <SPAN>Shared</SPAN> <SPAN>Sub</SPAN> GoingTo(<SPAN>ByVal</SPAN> PermissionName <SPAN>As</SPAN> <SPAN>String</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>'TODO: Implement this method.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Throw</SPAN> <SPAN>New</SPAN> System.Security.SecurityException( _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>"TODO: Implement security cecks"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> <SPAN>Sub</SPAN> <SPAN>New</SPAN>()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Class<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>End</SPAN><SPAN> <SPAN>Namespace<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 23, 2008</h2>This is the purpose behind GetProperty()/SetProperty() for public access, and ReadProperty()/LoadProperty() for internal access. And it is the purpose behind the new BypassPropertyChecks feature in version 3.6.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ben replied on Thursday, October 23, 2008</h2><P class=MsoNormal><SPAN>Many thanks Rocky. I’m going to start studying CSLA version 3.6.</SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I’m looking forward reading your new book. <o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Thanks again.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Benjamin<o:p></o:p></SPAN></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
