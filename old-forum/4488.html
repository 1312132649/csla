<html><header><title>System out of memory exception on row change</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>System out of memory exception on row change</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4488.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kumar.harsh posted on Wednesday, March 12, 2008</h2>Hi,<br>I am new to CSLA and am using v2.0.50727. I am getting a strange SystemOutOfMemoryException in my grids.<br><br>The basic structure is - <br><br>Class A1 : BusinessBase&lt;A1&gt;<br>{//some properties}<br><br>Collection A1Collection : BusinessListBase&lt;A1Collection, A1&gt;<br>{//childs A1}<br><br>Class A2 : BusinessBase&lt;A2&gt;<br>{//some properties<br>A1collection a1 = new A1collection(); <br>}<br><br>collection A2collection : BusinessListBase&lt;A2Collection, A2&gt;<br>{//childs A2}<br><br>Now I bind A2Collection to a third party grid(Infragistics v7.3).On row change, i get a system out of memory exception.<br>The log says - <br><br>------------------------------------------------------------<br>&nbsp;&nbsp; &nbsp;Type : System.OutOfMemoryException, mscorlib, Version=2.0.0.0, Culture=neutral, <br><br>PublicKeyToken=b77a5c561934e089<br>&nbsp;&nbsp; &nbsp;Message : Exception of type 'System.OutOfMemoryException' was thrown.<br>&nbsp;&nbsp; &nbsp;Source : mscorlib<br>&nbsp;&nbsp; &nbsp;Help link : <br>&nbsp;&nbsp; &nbsp;Data : System.Collections.ListDictionaryInternal<br>&nbsp;&nbsp; &nbsp;TargetSite : Void set_Capacity(Int32)<br>&nbsp;&nbsp; &nbsp;Stack Trace :&nbsp;&nbsp;&nbsp; at System.IO.MemoryStream.set_Capacity(Int32 value)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.IO.MemoryStream.EnsureCapacity(Int32 value)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.IO.BinaryWriter.Write(Byte[] buffer)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.__BinaryWriter.WriteSingleArray(NameInfo <br>memberNameInfo, NameInfo arrayNameInfo, WriteObjectInfo objectInfo, NameInfo arrayElemTypeNameInfo, Int32 length, Int32 lowerBound, Array array)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteArray(WriteObjectInfo <br>objectInfo, NameInfo memberNameInfo, WriteObjectInfo memberObjectInfo)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Write(WriteObjectInfo <br>objectInfo, NameInfo memberNameInfo, NameInfo typeNameInfo)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.Serialize(Object graph, <br>Header[] inHeaders, __BinaryWriter serWriter, Boolean fCheck)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream <br>serializationStream, Object graph, Header[] headers, Boolean fCheck)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize(Stream <br>serializationStream, Object graph)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.CopyState()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.BeginEdit()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.System.ComponentModel.IEditableObject.BeginEdit()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridRow.BeginEdit()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridCell.OnAfterCellEnterEditMode()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridLayout.OnEditorAfterEnterEditMode(Object sender, <br>EventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EmbeddableEditorBase.OnAfterEnterEditMode()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EditorWithText.OnAfterEnterEditMode()<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EmbeddableEditorBase.EnterEditMode(EmbeddableUIElementBase <br>embeddableElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridCell.EnterEditorIntoEditMode(Boolean byMouse)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridCell.EnterEditMode(Boolean byMouse, Boolean <br>showingDropDown)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridCell.SetFocusAndActivate(Boolean byMouse, Boolean enterEditMode, Boolean byTabKey)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.UltraGridCell.SetFocusAndActivate(Boolean byMouse, Boolean enterEditMode)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraWinGrid.CellUIElementBase.OnEmbeddableElementMouseDown(Object sender, EmbeddableMouseDownEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at <br>Infragistics.Win.UltraWinGrid.GridEmbeddableEditorOwnerInfoBase.OnEditorMouseDown(EmbeddableUIElementB<br>ase embeddableElem, EmbeddableMouseDownEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EmbeddableUIElementBase.RaiseMouseDownEvent(EmbeddableMouseDownEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EmbeddableUIElementBase.OnMouseDown(EmbeddableMouseDownEventArgs e, Boolean adjustableArea, UIElement&amp; captureMouseForElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EditorWithTextUIElement.OnMouseDown(MouseEventArgs e, Boolean adjustableArea, UIElement&amp; captureMouseForElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UIElement.OnMouseDown(MouseEventArgs e, Boolean adjustableArea, <br>UIElement&amp; captureMouseForElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.TextUIElementBase.OnMouseDown(MouseEventArgs e, Boolean adjustableArea, UIElement&amp; captureMouseForElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.EditorWithTextDisplayTextUIElement.OnMouseDown(MouseEventArgs e, <br>Boolean adjustableArea, UIElement&amp; captureMouseForElement)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.ControlUIElementBase.ProcessMouseDownHelper(Object sender, <br>MouseEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.ControlUIElementBase.ProcessMouseDown(Object sender, MouseEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.Utilities.ProcessEvent(Control control, ProcessEvent eventToProcess, EventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at Infragistics.Win.UltraControlBase.OnMouseDown(MouseEventArgs e)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmMouseDown(Message&amp; m, MouseButtons button, Int32 clicks)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br><br>------------------------------------------------------------<br><br>What could be possibly going wrong?<br><br>Also if I do not fill the child collection, and only bind the main A2collection with A2.A1collection = null, it takes a few row change clicks before this error appears again, and keeps on popping on subsequent rowchange events.<br>Can somebody please help me on this?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>csanchez replied on Wednesday, March 12, 2008</h2>Hi:<br><br>Don't know if this would help you but I had a similar problem.<br><br>In my framework I was maintaining a parent field. That parent field was being copied in the CopyState method everytime my grid interface call BeginEdit. The parent include my actual object which was copied again and again during this process throwing eventually a OutOfMemory exception. <br><br>What I did was mark that parent field as [NotUndoable]. That fixed my problem.<br><br>Hope this helps you.<br>Christian.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kumar.harsh replied on Thursday, March 13, 2008</h2>Hi thr,<br>I am not using a parent field anywhere. the structure only has a child collection.The child has no reference of parent.&nbsp; <br>Also have seen the RAM usage go up on clicking on rows. If I do not click on any other row, the usage does not go up. So it is surely not recursive. <br>I also wanted to ask...how does undo work in such structure? Does it copy whole collection onto the stack while only one variable in a child is edited ? If its so, it is bound to take so much memory.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MichaelWaihenya replied on Tuesday, November 18, 2008</h2><P>Hi</P>
<P>Dis you ever find a solution for this?</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
