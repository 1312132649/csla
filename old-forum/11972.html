<html><header><title>DataPortal_Create</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal_Create</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11972.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tom posted on Thursday, May 09, 2013</h2><p><span style="font-size:9pt;font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;">I am trying to code a unit test for one of our business objects but I had a question about the way I am calling the dataprotal create method.<span style="mso-spacerun:yes;">&nbsp; </span>Here is a code snippets.<span style="mso-spacerun:yes;">&nbsp; </span>Should I not use a criteria class?<span style="mso-spacerun:yes;">&nbsp; </span>It passes in another business object that is inherited form the csla framework.</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Serializable()]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class Criteria<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string RecordNo = string.Empty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Person LoggedInPerson;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Criteria(string recordNo, Person LoggedInPerson)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.RecordNo = recordNo;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoggedInPerson = LoggedInPerson;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [RunLocal()]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void DataPortal_Create(object criteria)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Criteria crit = (Criteria)criteria;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //...</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, May 09, 2013</h2><p>Which version of CSLA do you use?&nbsp;</p>
<p>For Csla 4.x you should use CriteriaBase as the base class for your Criteria object and use &quot;managed properties&quot; for properties/values.&nbsp;</p>
<p>This is to ensure that your code will work on all platforms and in N-tier deployment.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tom replied on Thursday, May 09, 2013</h2><p>I am using the csla 3.x</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>tom replied on Friday, May 10, 2013</h2><p>Here is my code that I am using to test.&nbsp; what can I do better here?&nbsp; Does this look right?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ///A test for DataPortal_Create<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ///&lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestMethod()]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [DeploymentItem(&quot;Cit.Library.dll&quot;)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void DataPortal_CreateTest()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Cit expected = null; // TODO: Initialize to an appropriate value</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cit_Accessor target = new Cit_Accessor();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object criteria = new Cit_Accessor.Criteria(1, null);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target.DataPortal_Create(criteria);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Assert.AreEqual(expected, actual);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Assert.Inconclusive(&quot;A method that does not return a value cannot be verified.&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Sunday, May 12, 2013</h2><p>Well - anyway you are likely to do an integration test here and it depends on what you REALLY want to test.&nbsp;</p>
<p>Lets just look at what DataPortal_Create does.</p>
<p><ol>
<li>Initialize field values&nbsp;</li>
<li>Optionally set which RuleSet to use</li>
<li>Check rules (and may also run async rules)&nbsp;</li>
</ol></p>
<p>And starting in CSLA 4.5 the DataPortal_Create may also return a Task and be called asynchronously.&nbsp;<br />The process of setting Initial values may also require &nbsp;variables from Csla.ApplicationContext.&nbsp;</p>
<p>So the test for DataPortal_Create should:</p>
<p>
<ul>
<li>Setup Csla.ApplicationContext and (variables and user principal)</li>
<li>Verify that default values have been set (and note also that many properties may be not be initialized in DataPortal_Create and will be initialized when read (get) is called first time by UI or LazyLoaded&nbsp;&nbsp;or BusinessRules execution)</li>
<li>Verify that rules have been run and initial broken rules is correct as per the default field values</li>
</ul>
</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
