<html><header><title>4.1 Custom validation rules: how do I access the previous value of the property?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>4.1 Custom validation rules: how do I access the previous value of the property?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10129.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina posted on Friday, March 04, 2011</h2><p>I&#39;m just porting an old CSLA 1.x app over to 4.1 and am now at my first set of validation rules and I realized I used to make *heavy* use of the old value in a property in many areas, however in 4.1 it appears my custom rule is called *after* the property has already been changed, not immediately before changing.</p>
<p>In the old CSLA rules system it was trivially easy because we controlled it during the setting of the property right in the Set code so we could inspect the value of &quot;value&quot; and of the property and use the two for the rule.</p>
<p>In the 4.1 CSLA I have to make a custom rule for even the simplest of these scenarios.</p>
<p>Unfortunately I don&#39;t have access to the equivalent of the old property value only the newly changed property value.</p>
<p>This is a completely different take on things and wouldn&#39;t be a big deal if I could, in my custom validation rule, get access to the previous value of the property before it was set.</p>
<p>I have the CSLA 4 objects ebook and the rule section makes no mention of accessing prior values, is this possible?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, March 04, 2011</h2><p>Before we get into any suggestions, does the rule always need the &quot;last&quot; value, or the what the value was at the time the object was loaded from the database.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Friday, March 04, 2011</h2><p>Hi Andy the last value.</p>
<p>I can think of many workarounds, I just wanted to know if it was an integral feature somehow that I&#39;m missing because it seems like there would be common real world scenarios where you would need this.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>tmg4340 replied on Friday, March 04, 2011</h2><p>Ever since managed properties entered the picture, access to previous values (whether that be the most-recently-previous or the original value from the database) has been an issue.&nbsp; Rocky made a design choice not to store previous values as part of his managed-property system, largely to keep the size of the object graph down.&nbsp; There is also a potential issue when dealing with the undo stack as well, though that&#39;s easily solved by simply putting those values on the stack as well (with another attendant size increase).&nbsp; The size issue, along with the simplification of the property-declaration system, won out.</p>
<p>Rocky typically points to a blog article (which escapes me now, but should be somewhat easy to find by searching the forums) showing a custom PropertyInfo implementation that saves previous values.&nbsp; From what I remember, while it isn&#39;t entirely straightforward, it&#39;s not hard either.&nbsp; I also know of one other user (whose name escapes me - sorry) who had developed a system for storing values only on changed properties, thus reducing the size issues.</p>
<p>As for the &quot;commonality of need&quot; - well, I don&#39;t think that comes up nearly as often as you might think.&nbsp; Most folks who have asked for it on the forum do so for performance reasons - reducing property-change events on properties that don&#39;t really change, not updating DB fields that don&#39;t change, etc.&nbsp; Finally, developing something to manage all the possibilities in a generic fashion is fairly non-trivial.&nbsp; Some people want most-previously-recent value, others want original DB value, and others don&#39;t care (and likely wouldn&#39;t want to pay the space penalty either).</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, March 05, 2011</h2><p><a href="http://www.jasonbock.net">Jason Bock </a>wrote the article on CustomPropertyInfo and the code is also available from <a href="http://forums.lhotka.net/forums/AddPost.aspx/NS-45E">http://cslacontrib.codeplex.com</a>.</p>
<p>His custom PropertyInfo will keep the original value (not the last value) but you should be able to alter it into saving the last value too.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Saturday, March 05, 2011</h2><p>As I said before I can think of *many* workarounds I just wanted to know if it&#39;s an integral feature already.&nbsp; Thanks anyway.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
