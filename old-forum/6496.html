<html><header><title>How to validate value in child object against value in another child object?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to validate value in child object against value in another child object?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6496.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 posted on Monday, February 23, 2009</h2>Okay,<br>I'll see if I can describe this issue.&nbsp; I have a parent object that has a child collection.&nbsp; I need to be able to validate the a value in one of the child objects is less than the value in the other child object.<br><br>Is there a way to do this?<br><br>I hope that made sense. :)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jasona22 replied on Tuesday, February 24, 2009</h2><P>I have a similar scenario.&nbsp; I have a collection of child objects and I need to compare values between them.&nbsp; Since the children don't know anything about one another (as it should be), when the custom validation fires, I need to get a reference to the parent so I can have the parent compare values on the children.</P>
<P>Calling "Parent" on the child only provides "AcceptEdit" and "RemoveChild".&nbsp; So, since the value that needs to fire validation is on the child, the child doesn't know about its siblings and the only parent reference doesn't seem to give access to the child collection, I have created my own.</P>
<P>This sounds easy, but apparently not.&nbsp; I added a parameter to the ctor of my child and upon creation the parent sends a reference to the child.&nbsp;I take this reference and set a public property on the child (ParentReference).</P>
<P>When the custom validation function fires, I am able to access my ParentReference property and get a reference to the parent.&nbsp; At that point, I can iterate over my collection of children and do my validation.</P>
<P>Where the problem occurs is when the custom function does fire and the rule fails, the code seems to go into an endless loop over the ParentCollection property on the child and the call stack says external.&nbsp; Since I just added this property and only for the purpose of validation, nothing external should be calling it; so I presume it is something in the CSLA engine that is.</P>
<P>Has anyone attempted something similar and have any suggestions or hints?</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, February 24, 2009</h2><P>I thought Rocky added a Parent property in CSLA 3.5 or 3.6 to resolve this sort of thing. It did not exist in 1.x or 2.x.</P>
<P>So a Root BO with a Child Collection filled with Child objects would look like this when inverted:</P>
<P>Child</P>
<P>&nbsp; Child.Parent&nbsp; (the collection)</P>
<P>&nbsp;&nbsp;&nbsp; Child.Parent.Parent&nbsp;&nbsp; (the root BO)</P>
<P>Not sure if any casting is required though. Plus I have not actually tried this kind of code yet.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 24, 2009</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>jasona22:</strong></div><div>Calling "Parent" on the child only provides "AcceptEdit" and "RemoveChild".&nbsp; So, since the value that needs to fire validation is on the child, the child doesn't know about its siblings and the only parent reference doesn't seem to give access to the child collection, I have created my own.</div></BLOCKQUOTE><br><br>That's true, but you can also cast Parent to the appropriate type and access all of that types members.<br><p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>jasona22:</strong></div><div>When the custom validation function fires, I am able to access my ParentReference property and get a reference to the parent.&nbsp; At that point, I can iterate over my collection of children and do my validation.</p>
<p>Where the problem occurs is when the custom function does fire and the rule fails, the code seems to go into an endless loop over the ParentCollection property on the child and the call stack says external.&nbsp; Since I just added this property and only for the purpose of validation, nothing external should be calling it; so I presume it is something in the CSLA engine that is.</div></BLOCKQUOTE></p><p>Depending on where I want validation errors to show (in the grid, or a message outside the grid), I usually put the rule into the parent... or at the very least have the parent ask the children to recheck themselves.&nbsp; I think to avoid endless loops, you can turn off RaiseListChangedEvents, run your rules then re-enable it.&nbsp; Alternately, you can have a flag that indicates you're checking rules and to ignore other processing.<br></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
