<html><header><title>RemotingPortal fails when CSLA is moved from bin to GAC</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>RemotingPortal fails when CSLA is moved from bin to GAC</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12058.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>martinjd posted on Wednesday, July 03, 2013</h2><p>I have a RemotingPortal configured and it works as it should. I have the following reference in the web,config:</p>
<p>&lt;add assembly=&quot;Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&quot; /&gt;</p>
<p>I believe we are still on the older version because there are so many different solutions in place that utilize CSLA and we have not had an opportunity to evaluate the impact of changing versions across the board.</p>
<p>As noted above the RemotingPortal works but we have recently had an&nbsp;issue occur that requires us to move out assemblies out of the web application&#39;s bin folder and into the GAC. When CSLA is moved to the GAC the RemotingPortal no longer works. As soon as I move CSLA back to the bin it works again. Below is the error that occurs when CSLA is moved to the GAC. Is there a setting I am missing somewhere that will tell the RemotingPortal that CSLA is now in the GAC?</p>
<p>This is the output when I navigate to</p>
<p><a href="https://www.site.com/RemotingPortal.rem?wsdl">https://www.site.com/RemotingPortal.rem?wsdl</a></p>
<p>System.IO.FileNotFoundException: Could not load file or assembly &#39;Csla&#39; or one of its dependencies. The system cannot find the file specified.<br />File name: &#39;Csla&#39;<br />&nbsp;&nbsp; at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)<br />&nbsp;&nbsp; at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)<br />&nbsp;&nbsp; at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)<br />&nbsp;&nbsp; at System.Reflection.Assembly.Load(String assemblyString)<br />&nbsp;&nbsp; at System.Runtime.Remoting.RemotingConfigHandler.RemotingConfigInfo.LoadType(String typeName, String assemblyName)<br />&nbsp;&nbsp; at System.Runtime.Remoting.RemotingConfigHandler.RemotingConfigInfo.GetServerTypeForUri(String URI)<br />&nbsp;&nbsp; at System.Runtime.Remoting.RemotingServices.GetServerTypeForUri(String URI)<br />&nbsp;&nbsp; at System.Runtime.Remoting.Channels.Http.HttpRemotingHandler.CanServiceRequest(HttpContext context)<br />&nbsp;&nbsp; at System.Runtime.Remoting.Channels.Http.HttpRemotingHandler.InternalProcessRequest(HttpContext context)</p>
<p>Assembly manager loaded from:&nbsp; C:\Windows\Microsoft.NET\Framework64\v2.0.50727\mscorwks.dll<br />Running under executable&nbsp; c:\windows\system32\inetsrv\w3wp.exe<br />--- A detailed error log follows. </p>
<p>=== Pre-bind state information ===<br />LOG: User = DOMAIN\user<br />LOG: DisplayName = Csla<br />&nbsp;(Partial)<br />LOG: Appbase = <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/</a><br />LOG: Initial PrivatePath = C:\inetpub\wwwroot\wss\VirtualDirectories\www.site.com443\bin<br />Calling assembly : (Unknown).<br />===<br />LOG: This bind starts in default load context.<br />LOG: Using application configuration file: C:\inetpub\wwwroot\wss\VirtualDirectories\www.site.com443\web.config<br />LOG: Using host configuration file: C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Aspnet.config<br />LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v2.0.50727\config\machine.config.<br />LOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).<br />LOG: Attempting download of new URL <a>file:///C:/Windows/Microsoft.NET/Framework64/v2.0.50727/Temporary</a> ASP.NET Files/root/f8305cdb/d34d5b87/Csla.DLL.<br />LOG: Attempting download of new URL <a>file:///C:/Windows/Microsoft.NET/Framework64/v2.0.50727/Temporary</a> ASP.NET Files/root/f8305cdb/d34d5b87/Csla/Csla.DLL.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/bin/Csla.DLL</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/bin/Csla/Csla.DLL</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/_app_bin/Csla.DLL</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/_app_bin/Csla/Csla.DLL</a>.<br />LOG: Attempting download of new URL <a>file:///C:/Windows/Microsoft.NET/Framework64/v2.0.50727/Temporary</a> ASP.NET Files/root/f8305cdb/d34d5b87/Csla.EXE.<br />LOG: Attempting download of new URL <a>file:///C:/Windows/Microsoft.NET/Framework64/v2.0.50727/Temporary</a> ASP.NET Files/root/f8305cdb/d34d5b87/Csla/Csla.EXE.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/bin/Csla.EXE</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/bin/Csla/Csla.EXE</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/_app_bin/Csla.EXE</a>.<br />LOG: Attempting download of new URL <a>file:///C:/inetpub/wwwroot/wss/VirtualDirectories/www.site.com443/_app_bin/Csla/Csla.EXE</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>Hi,</p>
<p>Is the CSLA assembly signed and is the certificate still valid?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>martinjd replied on Wednesday, July 03, 2013</h2><p>It is signed and I assume that the certificate is valid. I don&#39;t have any issues if the file that I move to the GAC is copied back to the bin.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>Try this: </p>
<p>After you have added the assembly to GAC. </p>
<ul>
<li>Go download this file: <a href="http://www.linqpad.net/GetFile.aspx?LINQPad.exe">http://www.linqpad.net/GetFile.aspx?LINQPad.exe</a>&nbsp; </li>
<li>Start the application and press F4</li>
<li>Verify that CSLA.dll is available from GAC</li>
</ul>
<p>(and remember that .NET 4 and .NET 2.0/3.0/3.5 have different GAC storages)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>martinjd replied on Wednesday, July 03, 2013</h2><p>It is available to select. I should also add that we have other&nbsp;code within this same&nbsp;Web&nbsp; / SharePoint application&nbsp;that make calls to CSLA locally and not through the RemotingPortal service&nbsp;that are working correctly after&nbsp;moving CSLA&nbsp;to the GAC. It seems to be only the RemotingPortal that is affected which in turn prevents the application that uses the RemotingPortal service from working.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>Could this be the reason?&nbsp;</p>
<p><a href="http://stackoverflow.com/questions/1487218/wcf-service-unable-to-load-referenced-assemblies-from-the-gac">http://stackoverflow.com/questions/1487218/wcf-service-unable-to-load-referenced-assemblies-from-the-gac</a>&nbsp;</p>
<p>I noticed from from the assembly load trace that the assembly loader did not look into GAC to get the assembly.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>And also a nice articel from Scott Hanselman on debugging loader errors</p>
<h2 class="blogTitle"><a href="http://www.hanselman.com/blog/BackToBasicsUsingFusionLogViewerToDebugObscureLoaderErrors.aspx" rel="bookmark" class="TitleLinkStyle">Back to Basics: Using Fusion Log Viewer to Debug Obscure Loader Errors</a></h2></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>martinjd replied on Wednesday, July 03, 2013</h2><p>I already have the assembly referenced in the web.config and my WCF services work just not the RemotingPortal. Unfortunately Fusion doesn&#39;t show anything related to the CSLA assembly. I appreciate your help.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>martinjd replied on Thursday, July 04, 2013</h2><p>When I access the web site default entry page I can see the w3wp process access CSLA as shown below in Fusion which does not use the remoting portal.</p>
<p>*** Assembly Binder Log Entry&nbsp; (7/4/2013 @ 7:01:06 PM) ***<br /><br />The operation was successful.<br />Bind result: hr = 0x0. The operation completed successfully.<br /><br />Assembly manager loaded from:&nbsp; C:\Windows\Microsoft.NET\Framework64\v2.0.50727\mscorwks.dll<br />Running under executable&nbsp; c:\windows\system32\inetsrv\w3wp.exe<br />--- A detailed error log follows. <br /><br />=== Pre-bind state information ===<br />LOG: User = JEMS\spadmin<br />LOG: DisplayName = Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30<br />(Fully-specified)<br />LOG: Appbase = file:///C:/inetpub/wwwroot/wss/VirtualDirectories/jclglocal.jacobstechnology.com443/<br />LOG: Initial PrivatePath = C:\inetpub\wwwroot\wss\VirtualDirectories\jclglocal.jacobstechnology.com443\bin<br />LOG: Dynamic Base = C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\f8305cdb<br />LOG: Cache Base = C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\f8305cdb<br />LOG: AppName = d34d5b87<br />Calling assembly : (Unknown).<br />===<br />LOG: This bind starts in default load context.<br />LOG: Using application configuration file: C:\inetpub\wwwroot\wss\VirtualDirectories\jclglocal.jacobstechnology.com443\web.config<br />LOG: Using host configuration file: C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Aspnet.config<br />LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v2.0.50727\config\machine.config.<br />LOG: Binding succeeds. Returns assembly from C:\Windows\assembly\GAC_MSIL\Csla\2.0.0.0__93be5fdc093e4c30\Csla.dll.<br />LOG: Assembly is loaded in default load context.</p>
<p>&nbsp;</p>
<p>When I then attempt to start the application that accesses the remoting portal Fusion reports that CSLA is found by that application&nbsp;as shown below.</p>
<p>&nbsp;</p>
<p>*** Assembly Binder Log Entry&nbsp; (7/4/2013 @ 7:54:52 PM) ***<br /><br />The operation was successful.<br />Bind result: hr = 0x0. The operation completed successfully.<br /><br />Assembly manager loaded from:&nbsp; C:\Windows\Microsoft.NET\Framework64\v2.0.50727\mscorwks.dll<br />Running under executable&nbsp; D:\RADWorkspace\JETS\main\src\Core\bin\JTSEstimator.vshost.exe<br />--- A detailed error log follows. <br /><br />=== Pre-bind state information ===<br />LOG: User = JEMS\James.Martin<br />LOG: DisplayName = Csla<br />(Partial)<br />LOG: Appbase = file:///D:/RADWorkspace/JETS/main/src/Core/bin/<br />LOG: Initial PrivatePath = NULL<br />LOG: Dynamic Base = NULL<br />LOG: Cache Base = NULL<br />LOG: AppName = JTSEstimator.exe<br />Calling assembly : Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30.<br />===<br />LOG: This bind starts in default load context.<br />LOG: Using application configuration file: D:\RADWorkspace\JETS\main\src\Core\bin\JTSEstimator.vshost.exe.Config<br />LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v2.0.50727\config\machine.config.<br />LOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).<br />LOG: Attempting download of new URL file:///D:/RADWorkspace/JETS/main/src/Core/bin/Csla.DLL.<br />LOG: Assembly download was successful. Attempting setup of file: D:\RADWorkspace\JETS\main\src\Core\bin\Csla.dll<br />LOG: Entering run-from-source setup phase.<br />LOG: Assembly Name is: Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30<br />LOG: A partially-specified assembly bind succeeded from the application directory. Need to re-apply policy.<br />LOG: Using application configuration file: D:\RADWorkspace\JETS\main\src\Core\bin\JTSEstimator.vshost.exe.Config<br />LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v2.0.50727\config\machine.config.<br />LOG: Post-policy reference: Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30<br />LOG: Binding succeeds. Returns assembly from C:\Windows\assembly\GAC_MSIL\Csla\2.0.0.0__93be5fdc093e4c30\Csla.dll.<br />LOG: Assembly is loaded in default load context.</p>
<p>&nbsp;</p>
<p>The application fails to load because it is expecting certain data from the remoting portal and is instead receiving the error message. When I attempt to access the remoting portal by url Fusion reports:</p>
<p>&nbsp;</p>
<p>*** Assembly Binder Log Entry&nbsp; (7/4/2013 @ 8:00:06 PM) ***<br /><br />The operation failed.<br />Bind result: hr = 0x80070002. The system cannot find the file specified.<br /><br />Assembly manager loaded from:&nbsp; C:\Windows\Microsoft.NET\Framework64\v2.0.50727\mscorwks.dll<br />Running under executable&nbsp; c:\windows\system32\inetsrv\w3wp.exe<br />--- A detailed error log follows. <br /><br />=== Pre-bind state information ===<br />LOG: User = JEMS\spadmin<br />LOG: DisplayName = Csla<br />(Partial)<br />LOG: Appbase = file:///C:/inetpub/wwwroot/wss/VirtualDirectories/jclglocal.jacobstechnology.com443/<br />LOG: Initial PrivatePath = C:\inetpub\wwwroot\wss\VirtualDirectories\jclglocal.jacobstechnology.com443\bin<br />LOG: Dynamic Base = C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\f8305cdb<br />LOG: Cache Base = C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\f8305cdb<br />LOG: AppName = d34d5b87<br />Calling assembly : (Unknown).<br />===<br />LOG: This bind starts in default load context.<br />LOG: Using application configuration file: C:\inetpub\wwwroot\wss\VirtualDirectories\jclglocal.jacobstechnology.com443\web.config<br />LOG: Using host configuration file: C:\Windows\Microsoft.NET\Framework64\v2.0.50727\Aspnet.config<br />LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v2.0.50727\config\machine.config.<br />LOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).<br />LOG: The same bind was seen before, and was failed with hr = 0x80070002.<br />ERR: Unrecoverable error occurred during pre-download check (hr = 0x80070002).</p>
<p>&nbsp;</p>
<p>Which is also what is displayed in Internet Explorer when I access the remoting portal.</p>
<p>&nbsp;</p>
<p>I noticed that when I access the web application default page or the remoting portal url they both look to the same web.config but the latter of the two fails.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>martinjd replied on Thursday, July 11, 2013</h2><p>While researching another issue I ran across a post that made me revisit your comments above. The actual fix was to add the following to the web.config in addition to the assembly reference which had already been added. Thanks again for your help.</p>
<p>&lt;runtime&gt;<br />&nbsp;&nbsp;&nbsp; &lt;assemblyBinding xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em>&lt;qualifyAssembly partialName=&quot;Csla&quot; fullName=&quot;Csla, Version=2.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&quot;/&gt;</em><br />&nbsp;&nbsp;&nbsp; &lt;/assemblyBinding&gt;<br />&lt;/runtime&gt;</p>
<p>&nbsp;</p>
<p><a href="http://entlib.codeplex.com/discussions/395784">http://entlib.codeplex.com/discussions/395784</a></p>
<p><a href="https://entlib.codeplex.com/workitem/26903">https://entlib.codeplex.com/workitem/26903</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
