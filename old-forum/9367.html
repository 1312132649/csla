<html><header><title>offline document format for CSLA objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>offline document format for CSLA objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9367.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>matt tag posted on Thursday, August 12, 2010</h2><p>We have 50+ users in remote locations running our CSLA/SQL Server application with a local copy of SQL Server. A ton of work is done to get data moving from these clients back to the main head office SQL Server and back out again to other users.</p>
<p>I have (finally) convinced management that the internet is ubiquitous enough to get rid of the local SQL Server and require users to be interent/VPN connected to run my app.&nbsp; Hooray!&nbsp; This gets rid of all the data synchronization code, and all of the local SQL Server deployment (including backing up the master database and restoring it on 50+ laptops every year) .</p>
<p>The users have ONE request if we go this route - they want the ability to &quot;check out&quot; the data they are working on (which are already conveniently CSLA classes) and work on them in offline mode.&nbsp; The rest of the application except for this document editing would be available only while connected.</p>
<p>I figured I would just serialize the CSLA objects to disk somehow and this would be a piece of cake.&nbsp; After reading about serialization, though - maybe this might be harder than I thought. </p>
<p>The sample code below seems to work for saving to disk (and the similar load as well) - are there any &quot;gotchas&quot; I need to worry about, though? It sure sounds like there might be after reading the forum/FAQ. Is there a better serialization class to use?</p>
<p>thanks much</p>
<p>matt tag</p>
<p>&nbsp;</p>
<p style="padding-left:30px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim f As Csla.Serialization.BinaryFormatterWrapper<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim p As PlayerProperties&nbsp;&nbsp;&nbsp; &lt;--- CSLA class<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p = PlayerProperties.GetObject(New Guid(&quot;CDA77E4B-46AC-11D5-9F36-0090273C1D4C&quot;))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using fs As New System.IO.FileStream(&quot;c:\temp.txt&quot;, IO.FileMode.Create)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f = New Csla.Serialization.BinaryFormatterWrapper<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f.Serialize(fs, p)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fs.Flush()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br /></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, August 12, 2010</h2><p>You should absolutely not use serialization for anything beyond transient data transfer.</p>
<p>Or to put it another way, if there is <i>any chance</i> of changing your assemblies while serialized data is floating around out there, then you shouldn&#39;t use serialization - because you may be unable to deserialize the data after you update your assemblies.</p>
<p>So serialization is great for over-the-network stuff - that&#39;s transient. It is often OK for caching, since you can just discard the cache if deserialization fails.</p>
<p>But it is not good for maintaining editable data over a period of time - unless your users are ok with just losing whatever they have taken offline in the case of an app update.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RedShiftZ replied on Thursday, August 12, 2010</h2><p>Personally, I would keep the local SQLServer (or MSDE) on the machine and store the offline data there. your objects already know how to talk to it, they just need a way to differentiate between offline and online. The Serialization issue goes away and you only have to change the Sync code into some sort of check-out/check-in code.&nbsp; With the proper thought, this could be very powerful.</p>
<p>To counter the app update issue, I would suggest that all offline data must check in before an app update could proceed. </p>
<p>Just a thought.</p>
<p>Jeff Young</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>matt tag replied on Thursday, August 12, 2010</h2><p>thanks for the feedback.&nbsp; I stumbled across the MobileFormatter, which requires me to implement a field-by-field read/write to the XML stream (assuming I don&#39;t have managed backing fields for everything, which I do not).&nbsp; Does this formatter suffer from the same &quot;will break if new versions are deployed&quot; problems as BinaryFormatter?&nbsp; </p>
<p>I suppose if I&#39;m already doing field-by-field reading/writing, I can just create my own local file format and read/write to it, so not much difference.</p>
<p>&nbsp;</p>
<p>As far as keeping MSDE on the local machine, that is probably an option, but I would save our machine deployment guys HOURS AND HOURS of work every year if I could get rid of it, which is one of the the primary reasons for pushing an &quot;almost exclusive online app&quot; type of architecture (the other reason would be getting rid of data synchronization efforts).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 12, 2010</h2><p>MobileFormatter is designed to provide comparable functionality to BinaryFormatter/NetDataContractSerializer without the need for reflection. It is the only serializer available for Silverlight or WP7. It may become the primary serializer for web apps in the future as well, partly because it can run in medium trust, and partly because it may be a practical way to do some interesting HTML5 json serialization (that&#39;s very speculative!!).</p>
<p>While you could maybe misuse MobileFormatter for your purpose, you&#39;d never be able to move to Silverlight, because it wouldn&#39;t be actually doing what&#39;s necessary.</p>
<p>If you don&#39;t want to use a client-side SQL database your best bet is to use a pluggable DAL (options 2-4 from <a href="http://www.lhotka.net/cslanet/faq/DataFaq.ashx">http://www.lhotka.net/cslanet/faq/DataFaq.ashx</a>), and have a client-side DAL that maybe stores the data into XML files or something like that. If you use a DTO-based interface between your business objects and the DAL you&#39;d be well on your way - by definition a DTO can be easily serialized into XML using DataContractSerializer. And the DCS has provisions for versioning the XML/DTO schema over time.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Friday, August 13, 2010</h2><p>Maybe take a look at SqlLite or Sql CE 4 (beta), they are embedded databases that don&#39;t require configuration. It doesn&#39;t require maintenance like MSDE and it is still a reliable data store so you don&#39;t have to write your own methods to store/retrieve data.</p>
<p>HTH.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
