<html><header><title>BindableBase errata?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BindableBase errata?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/878.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell posted on Friday, August 11, 2006</h2>Debugging a change in code upgraded from CSLA 1.52 to 2.0.3 caused me to stumble upon a changed to BindableBase that was different from the book but did not seem to be listed in any errata.<br><br>protected virtual void OnPropertyChanged(string propertyName)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000"> PropertyChangedEventHandler nonSerializableHandlers =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _nonSerializableHandlers;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (nonSerializableHandlers != null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonSerializableHandlers.Invoke(this,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new PropertyChangedEventArgs(propertyName));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000"> PropertyChangedEventHandler serializableHandlers =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _serializableHandlers;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (serializableHandlers != null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; serializableHandlers.Invoke(this,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new PropertyChangedEventArgs(propertyName));<br>}<br><br>The <font color="#008000">green</font> lines are not in the book's code, and I could not find an errata article regarding it.&nbsp; Instead, in the book, the instances of the event handlers are invoked directly.&nbsp; The reason I bring this up is that the act of assigning another reference to the event handlers seems to cause spurious calls to the add and remove blocks of the event.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, August 11, 2006</h2>Ahh, excellent! I think you've just helped me solve a problem that's been nagging me for some time now...<br><br>That change came late in the game, as a result of some discussions around thread safety. But I think what you are seeing is causing a duplicate eventing issue I've been chasing off and on - I'll test and see.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>PeterRow replied on Monday, August 14, 2006</h2><P>Hi,</P>
<P>In a (related?)&nbsp;query/problem,&nbsp;I have updated the code in Brian's code to directly use the member variables that store the references. </P>
<P>I have a collection of editable child objects (Entries) exposed as a property of&nbsp;a dictionary BO within my app&nbsp;that the user can edit. When the [Save] button is bound to the IsSavable property then it all works fine and dandy the first time, i.e. I edit one of the entries in the collection (in a databound listview) via a pop-up dialog, the Save button becomes enabled when changes are made to the entry, click [OK] and then [Save]. The change to the entry is saved fine and the save button becomes disabled again.</P>
<P>However, if I then change another entry (or even the same one) then the save button does not become become enabled. The event handler added to the Entries collection property of my Dictionary BO does not appear to be fired (and hence attached).</P>
<P>If I then edit another entry, change the same 2 fields as before (simple textboxes) then when I tab off the 2nd one I get a NullReferenceException on the:&nbsp; if (_serializableHandlers != null) line in the OnPropertyChanged eventhandler in BindableBase. The _serializableHandlers member is null, but why it should cause a NullReferenceException is strange, can't a null be compared to a null?</P>
<P>I guess the real problem is why is it null in the first place. Any ideas on what to look into would be much appreciated. I've probably left out some saliant piece of info' so please ask if your looking to help and need extra details.</P>
<P>Regards,</P>
<P>Peter</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>PeterRow replied on Tuesday, August 15, 2006</h2><P>As a side note, if I drop on a BindingSource and set the DataSource to my object and then add bindings with code such as:</P>
<P>fromQuarterComboBox.DataBindings.Add(<FONT color=#0000ff>New</FONT> Binding(<FONT color=#800000>"SelectedValue"</FONT>, entryBindingSource, <FONT color=#800000>"FromQuarterId"</FONT>, <FONT color=#0000ff>True</FONT>))</P>
<P>... which replaced original bind code which called this custom method:</P>
<P><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#0000ff>void</FONT> BindField(<BR><FONT color=#008080>Control</FONT> control, <FONT color=#0000ff>string</FONT> propertyName, <FONT color=#0000ff>object</FONT> dataSource, <FONT color=#0000ff>string</FONT> dataMember, <FONT color=#008080>ConvertEventHandler</FONT> formatHandler, <FONT color=#008080>ConvertEventHandler</FONT> parseHandler)<BR>{<BR><FONT color=#008080>&nbsp;&nbsp;&nbsp; Binding</FONT> binding = control.DataBindings[propertyName];<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; if</FONT>(binding != <FONT color=#0000ff>null</FONT>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; control.DataBindings.Remove(binding);<BR>&nbsp;&nbsp;&nbsp; binding = <FONT color=#0000ff>new</FONT> <FONT color=#008080>Binding</FONT>(propertyName, dataSource, dataMember);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; if</FONT>(formatHandler != <FONT color=#0000ff>null</FONT>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding.Format += <FONT color=#0000ff>new</FONT> <FONT color=#008080>ConvertEventHandler</FONT>(formatHandler);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; if</FONT>(parseHandler != <FONT color=#0000ff>null</FONT>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding.Parse += <FONT color=#0000ff>new</FONT> <FONT color=#008080>ConvertEventHandler</FONT>(parseHandler);<BR>&nbsp;&nbsp;&nbsp; control.DataBindings.Add(binding);<BR>}</P>
<P>.. excuse the formatting, then I don't get the error. The binding source must obviously be doing something differently but what is the key to this I guess.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
