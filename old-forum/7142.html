<html><header><title>Dynamic business objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic business objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7142.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong posted on Monday, June 22, 2009</h2><P>In a new project we'll have to make dynamic views:<BR><BR>A user configuration in the database will cause a view to have controls.<BR>This control has to be databinded to a dynamic property.<BR>That property will have dynamic authorization and dynamic validation.<BR><BR>It means that we don't know much at designtime...<BR><BR>- Dynamic authorization isn't a problem at all;<BR>- Simple dynamic validation rules aren't a problem as well;<BR>- Dependend dynamic validation rules will be harder, but not impossible;<BR>- Dynamic properties are another thing.<BR><BR>I'm thinking about using the codedom to create dynamic business objects, generate an assembly in memory depending on the content defined by the user in&nbsp;the database. It might also be a mix of non-generic /&nbsp;pre-defined properties together with the dynamic properties.<BR><BR>How would u guys do this? Is there anyone with any practical experience?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, June 22, 2009</h2><P>I suppose a lot of it depends on what information is in your configuration file, how the end-user manages the dynamic content, etc.</P>
<P>I recently finished a project with similar requirements.&nbsp; We opted not to go the code-dom route only becuase we needed to support a GUI that allowed the user to manipulate the view.&nbsp; Plus, we wanted an extensibility point.</P>
<P>In the end, we went with the idea of a compiled pseudo-base class that would be instantiated at run-time along with an XML document that contained all of the dynamic content which would be deserialized into the base class.&nbsp;&nbsp;We can&nbsp;declare property values, etc. in the XML file which then override the preset values from the base class when deserialized into the instance.</P>
<P>For extensibility, we actually allow the XML document to specify what "base" class to use - similar to defining a code behind page in ASP.NET.&nbsp; We first read the XML document, find what class to instantiate, create an instance of that class, then deserialize the rest of the XML into the class.&nbsp; This gives us an -in-memory instance of the desired class.&nbsp; Plus, we can easily extend or customize the application by changing the "base" class used with the view.</P>
<P>Another nice feature is that we can use the same XML to render the view in our GUI at "design" time.</P>
<P>It's actually a bit complicated, but hopefully this gives you an idea of the approach.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 22, 2009</h2><P>It may be possible to create a subclass of Csla.Core.BusinessBase (not generic) that implements ICustomTypeDescriptor (I think that is the interface), along with the functionality in BusinessBase&lt;T&gt;, to create a dynamic object class.</P>
<P>I know people have tried doing this, and I think some have succeeded. </P>
<P>Obviously you'd need to do the same for ReadOnlyBase.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, June 22, 2009</h2><P>Ah, good point, Rocky.&nbsp; I wasn't thinking of it in those terms.&nbsp; I worked for a company not too long ago that allowed the user to define custom "attributes" on business objects.&nbsp; We did accomplish this using a property bag and a custom type descriptor that would make the object "appear" as if the custom attributes were properties on the object.&nbsp; So, when the business object was bound to a grid, for instance, it would have columns for the custom attributes right alongside the hard-coded properties from the business object.</P>
<P>Our approach at the time was to create a subclass of BusinessBase, as Rocky indicated, with an interface defining the access point for&nbsp;defining and managing the attributes and&nbsp;a custom type descriptor doing the work.&nbsp; I can probably dig up some old code if requested.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CodeSmartNotHard replied on Wednesday, June 24, 2009</h2><P>Hi,</P>
<P>We have some similar requirements where we need to add dynamic properties.&nbsp; Would you mind digging up some code to demonstrate this?</P>
<P>Thanks,</P>
<P>Mike</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Thursday, June 25, 2009</h2><P>We haven't used it yet, but found some interesting links after hearing about ICustomTypeDescriptor:</P>
<P class=MsoNormal><SPAN><A href="http://msdn.microsoft.com/en-us/magazine/cc163816.aspx"><SPAN>http://msdn.microsoft.com/en-us/magazine/cc163816.aspx</SPAN></A></SPAN></P><SPAN></SPAN><SPAN><o:p>
<P class=MsoNormal><SPAN><A href="http://zcoder.blogspot.com/2007/11/icustomtypedescriptor.html">http://zcoder.blogspot.com/2007/11/icustomtypedescriptor.html</A></SPAN></P>
<P class=MsoNormal><SPAN></SPAN>&nbsp;</P>
<P class=MsoNormal><SPAN>I think that'll work for us.</SPAN></P></o:p></SPAN></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Friday, August 21, 2009</h2><P>This topic is from 2 months ago and meanwhile i added dynamic properties support in our subclasses with validation and authorization on it.<BR><BR>I didn't use ICustomTypeDescriptor but instead i used ITypedList, the only problem is that this isn't supported in Silverlight (yet) so no dynamic properties in Silverlight :(<BR>The reason for implementing ITypedList is that somehow the infragistics grid doesn't support ICustomTypeDescriptor.<BR><BR>In our ObjectFactory&nbsp;subclass (colleagues tent to name it DataFactory) dynamic properties can be registered, loaded and readed. <BR><BR>I wrote a custom PropertyDescriptor which checks the type of the PropertyInfo and incase it's a DynamicPropertyInfo then my code is called and else csla code. Not using the FieldManager nor it's data, since the FieldManager is designed for&nbsp;the&nbsp;type of&nbsp;the business object not&nbsp;a instance.<BR><BR>It's a bit complex, but not as complex as using the codedom with emits.<BR><BR><BR>RegisterDynamicProperty in CSLA would be a nice feature</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
