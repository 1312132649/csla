<html><header><title>CSLA performance (CheckRules)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA performance (CheckRules)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2566.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CaymanIslandsCarpediem posted on Wednesday, March 21, 2007</h2><P>In my last post about CSLA performance (<A HREF="/forums/thread/13330.aspx">http://forums.lhotka.net/forums/thread/13330.aspx</A>), I found that calling ValidationRules.CheckRules() on&nbsp;each item&nbsp;after they are fetched resulted in more than doubling the time required to return those objects even for a small number of very simple rules.&nbsp; </P>
<P>I realize in many cases calling ValidationRules.CheckRules() on a previously saved item may not make sense as if it was previously saved all rules must have been passed.&nbsp; However, in a number of my cases items could have some of thier rules broken by changes to other objects, etc, etc&nbsp;and I have been calling ValidationRules.CheckRules() during each fetch "just to be safe".&nbsp; After seeing the performance impact of this, I'm considering moving away from this practice in most cases, however I still want to ensure EVERY rule is checked before I would actually edit any of those items.&nbsp; Below I'll outline my thoughts on what I'm thinking of doing and would appreciate any thoughts.&nbsp; Maybe this could even make it into the default CSLA framework?&nbsp; Not sure that this functionality is needed in enough cases to make that worth while, just thought I'd mention it ;-)</P>
<P>My goal is to avoid calling ValidationRules.CheckRules() on each item fetch for the performance hit that it can cause.&nbsp; However, if an item is going to be edited I do want all rules checked even if its a rule for a property that isn't being edited.&nbsp; I seems I can accomplish this with a VERY simple change to two CSLA classes.</P>
<P>1) In Csla.Validation.ValidationRules I'll create a properly like IsAllRulesChecked.&nbsp; Then in the public void CheckRules() method (just that one which calls all rules) set IsAllRulesChecked to true.</P>
<P>2) In Csla.Core.BusinessBase add this to public void BeginEdit():</P>
<P>if (!this.ValidationRules.IsAllRulesChecked) ValidationRules.CheckRules();</P>
<P>So for each item it will track if the CheckRules method which checks all rules has been called and if not it will call it on BeginEdit().&nbsp; I could also add additional logic to all CheckRules methods to see if all rules have been checked individually, etc but I cannot imagine the gain of possibly avoiding one extra CheckRules() call would justify the overhead of checking for this.</P>
<P>Any thoughts appreciated!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>joshpainter replied on Thursday, March 22, 2007</h2><P>I don't have the CSLA framework source in front of me, but you could subclass BusinessBase with a class that overrides PropertyHasChanged.&nbsp; In your method, you would check a local bool field similar to your "isAllRulesChecked".&nbsp; If it is false, call&nbsp;ValidationRules.CheckRules() which will force all rules to be checked, then set the local bool field to true.&nbsp; If true, just call base.PropertyHasChanged(propertyName).&nbsp; This way, the first time a property is changed on a freshly fetched object, all rules are checked for all properties instead of just that one.</P>
<P>This is mainly from memory, so I may not have the override signatures correct...but it should work if you can override that method.&nbsp; Anything I'm not thinking of?</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
