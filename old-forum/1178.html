<html><header><title>Address Line Disappearing on Datagrid</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Address Line Disappearing on Datagrid</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1178.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes posted on Monday, September 11, 2006</h2><P>I created a contact object which has and Addressess Collection which contain a series of Address objects.&nbsp; I wanted to bind my address collection to a datagrid, so I had to add the following code to the ContactAddresses collection so that when a person starts entering data in the new line in the data grid, this code will create a new object.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>override</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> AddNewCore()</P>
<P>{</P>
<P></FONT><FONT color=#008080 size=2>ContactAddress</FONT><FONT size=2> result;</P>
<P>result = </FONT><FONT color=#008080 size=2>ContactAddress</FONT><FONT size=2>.NewContactAddress();</P>
<P>OnAddingNew(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>AddingNewEventArgs</FONT><FONT size=2>(result));</P>
<P>Add(result);</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> result;</P>
<P>}</P>
<P>My problem is this.&nbsp; When I type the new line into the datagrid everything is fine until I get to the last item.&nbsp; If I just hit enter, the focus will move to ANOTHER new line and the previous line I just got done typing disappears.&nbsp; If I tell it to save the Contact, it tries to save an address with all fields set to null.</P>
<P>However, if after I finishing typing in the last field for a new line, I then click on an already existing address record.&nbsp; The new address line stays on the datagrid and when I go to save it, things work like normal.&nbsp; </P>
<P>These are my objects</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>Contact</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>BusinessBase</FONT><FONT size=2>&lt;</FONT><FONT color=#008080 size=2>Contact</FONT><FONT size=2>&gt;</FONT></P><FONT size=2><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ContactAddress</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>BusinessBase</FONT><FONT size=2>&lt;</FONT><FONT color=#008080 size=2>ContactAddress</FONT><FONT size=2>&gt;</FONT></P><FONT size=2><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ContactAddresses</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>BusinessListBase</FONT><FONT size=2>&lt;</FONT><FONT color=#008080 size=2>ContactAddresses</FONT><FONT size=2>, </FONT><FONT color=#008080 size=2>ContactAddress</FONT></P>
<P><FONT color=#008080 size=2><FONT color=#000000>I have not done any modifications to the basic CSLA code except to implement my classes.&nbsp; Anyone have any ideas?</FONT></P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 11, 2006</h2><P>Further specifications.&nbsp; </P>
<P>Record A is an existing record.&nbsp; Record B is going to be my new record, so I go down to the new record line and start typing it.&nbsp; Everthing works fine as long as I don't type go to the new record line after entering Record B.&nbsp; If for any reason I go to the new record line without typing in a new record, as soon as I leave that line, I loose data.&nbsp; So here is what I have done so far.</P>
<P>1.&nbsp; Type in a new record but don't go to the new record line after the last field.&nbsp; Instead I click on the first record.&nbsp; All is fine.</P>
<P>2.&nbsp; Type in a new record and allow it to go to the next, blank&nbsp;new record line.&nbsp; All is ok until focus leaves the blank new record line.&nbsp; Then I loose the record I just typed in.&nbsp; The object still exists but all the data fields are set to null.</P>
<P>3.&nbsp; Typed in two new record in a row and let the focus move to the blank new record line.&nbsp; All is ok until focus leaves the blank new record line, then the first new record I typed in disappears from the DataGrid.&nbsp; The object is still there but it has null values.</P>
<P>&nbsp;</P>
<P>The Id for my Address objects are an int which is an Identity from the SQL2005 server.&nbsp; So when a new object is created, there is no object Id.&nbsp; Do you think that may have something to do with it?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 11, 2006</h2><P>I am thinking the issue is in this code.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> System.ComponentModel.</FONT><FONT color=#008080 size=2>IEditableObject</FONT><FONT size=2>.CancelEdit()<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (_bindingEdit)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CancelEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (IsNew &amp;&amp; _neverCommitted &amp;&amp; EditLevel &lt;= EditLevelAdded)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// we're new and no EndEdit or ApplyEdit has ever been<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// called on us, and now we've been cancelled back to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// where we were added so we should have ourselves<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// removed from the parent collection<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (Parent != </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parent.RemoveChild(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></P>
<P><FONT size=2>This is in Core.BusinessBase in the <FONT size=2>System.ComponentModel.IEditable section.&nbsp; I think that If I can find an event in the datagrid after entering a record and then make it do a snapshop, then I would resolve my problem.</FONT></FONT></P>
<P><FONT size=2><FONT size=2>P.S.&nbsp; I notice nobody is responding to my post, but I figured I may as well go through the semantecs so the next person has some reference.</P></FONT></FONT>
<P><FONT size=2>&nbsp;</P></FONT><FONT size=2></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 11, 2006</h2><P>&nbsp;&nbsp;&nbsp;I found the problem.&nbsp; Because my ID for my object is the Primary Key from a table in Ms SQL2005, I didn't put a value in for the Object Id.&nbsp; So every new object had an Id of zero (0).&nbsp; So when ever you were on a new line and you went into edit mode and cancelled it, the code would remove every object with an Id of zero because that Id matched the object that was created for the line that you started editing.&nbsp; </P>
<P>&nbsp;&nbsp;&nbsp;I corrected the problem by putting a private static int value in my Address Class.&nbsp; </P><FONT color=#0000ff size=2>
<P>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> NewAddressUniqueValue = 0;</P></FONT>
<P>When anything calls the NewContactAddress method to get a Contact Address, it calls decrements the value in NewAddressUniqueValue and assigns it to the Id of the ContactAddress object.&nbsp; Now the ContactAddress has a unique Id and won't disappear when deleting empty objects from the collection.&nbsp; There is no possibility of mix up with the real object Ids because they are values greater than 0 and the temporary ones are values less than or equal to zero.&nbsp; Also when the object is persisted to the database, it doesn't pass it's Object Id along and thus it gets a real one when that happens.</P>
<P>So I hope this helps anyone who comes accross it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vitorsilva replied on Sunday, September 24, 2006</h2>THANK YOU SO MUCH!<br>i spent nearly 3 hours trying to understand what was happening and looking for some help here in the foruns... <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 25, 2006</h2>Glad I could help.&nbsp; :)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Sakelun replied on Friday, October 27, 2006</h2>Thanks! I almost spent 3 hours trying to find this problem myself, but I'm a wimp - before I go delving too deep I always check the forums to see if anyone else has run into what I have.<br><br>All of that said, I have an alternative solution that may help some. Rather than allow the datagrid to compare objects based on key data fields, I override Equals to force it to do a reference comparison instead when I know the object to be new:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">&nbsp;&nbsp;&nbsp; public override bool Equals(object obj)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (IsNew)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this == obj;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return base.Equals(obj);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Since I'm using an auto-incrementing key, a default value that duplicates across new datagrid rows is perfectly acceptable as long as the proper key is reflected back upon successful insertion. <br><br>- Scott<br><br></font><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 27, 2006</h2>Probably a better solution is to assign the temporary id.&nbsp; What happens if you want to override == for one of your objects?&nbsp; You're back to square one then..<br><br>Its easy enough to subclass BusinessBase (which you should be doing anyway) tohandle this for you automatically.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
