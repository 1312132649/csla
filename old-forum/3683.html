<html><header><title>Multiple Users</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Multiple Users</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3683.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>culprit posted on Wednesday, October 10, 2007</h2><P>Does anyone have a suggestion on how I might log in two users at once. The application should allow the following login scenarios:</P>
<P>1. Clerk only</P>
<P>2. Manager only</P>
<P>3. Clerk and Manager</P>
<P>In scenario three we would probably default to using the clerk's permissions but might combine the two. I would preload all the permission groups on login so would not need access to these again but would want access to the user(s) and their id(s) in the database so that they can be attached to edits throughout the BOs.</P>
<P>Also, on this same line where would I store the current user's ID in the csla.applicationcontext so that I could write this in the data routines in the BOs?</P>
<P>Thanks, Rob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 10, 2007</h2>Have the application run as two distinct users at once?&nbsp; I think that'd be very difficult.&nbsp; If that's not what you mean though, you could have a role Clerk and another role Manager.&nbsp; A user then could belong to either or both roles.&nbsp; Your code would only check for which ever role would be appopriate.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>culprit replied on Wednesday, October 10, 2007</h2><P>Well, I don't think I necessarily need two distinct users. Maybe there is some place within the applicationcontext I could just store the IDs for the two users and this would allow the application to store these IDs with every edit. I would then use roles to handle permissions for the user(s).</P>
<P>Do you have any suggestions where I might store this data?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 10, 2007</h2>Probably in the application context, or a custom principal if you're not going to use Windows authentication.<br><br>I'm curious though.. whats wrong with having one user belong to two roles?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>culprit replied on Wednesday, October 10, 2007</h2><P>For permission issues I think I will use multiple roles but I just wanted a way so that when I modified records I could insert both the manager and clerk IDs. I guess I could do this in a global shared object but thought it would be cleaner to do this in the same space as was storing the user. </P>
<P>If you were to store this in the application context how would you do this? Would you store this in the CSLA.ApplicationContext where the user is being stored?</P>
<P>Thanks,</P>
<P>Rob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Wednesday, October 10, 2007</h2><P>..so, are the two users in front of the same computer at the same time ?</P>
<P>is this a requirement so the Edit be effective ?</P>
<P>because if the requirement not necessarily needs the two persons in the same place at the same time, then a more appropriate approach would be to make a "workflow" like implementation...</P>
<P>... pend the commit until the two approvals are successful / not rejected ...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>culprit replied on Wednesday, October 10, 2007</h2><P>No, the two users do not have to be in front of the computer at the same time. But in this particular business it is quite common for a manager to sign in and then let the clerk do everything but for legal reasons we need to save any record changed with both the clerk's id and the manager's id. </P>
<P>We actually have several variations using workflow. For instance in some settings the system may require the manager to sign off on the record before it is finalized or printed. Another scenario allows only a clerk to be signed in but absolutely requires the manager to sign off (biometric, login, etc...) before it is finalized or printed. The workflow for this application can get complex I am just pulling out this one scenario where both individuals are logged in and the record would be saved with both IDs attached (clerk and manager).</P>
<P>I think I could do this by storing the IDs for the users in a global shared class but thought I might be able to place this in the CSLA.ApplicationContext since to me that seemed to make more sense.</P>
<P>Thanks, Rob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, October 11, 2007</h2><P><FONT face=Tahoma size=2>OK - I guess I'm confused here.&nbsp; You're asking about a situation where both users are logged in to the same application at the same time (which is, honestly, a head-scratcher to me), but you're also saying it's quite common for the manager to log in, but let the clerk do all the work?&nbsp; Where do you get the clerk's ID?</FONT></P>
<P><FONT face=Tahoma size=2>Honestly, this seems like a situation ripe for some formalized delegation within the application.&nbsp; If the manager has the rights to do certain tasks, but wants to let others do it, that&nbsp;concept really&nbsp;should be baked into the application.&nbsp; Then the clerk can log in, but when they do tasks that have been delegated to them by their manager, the manager's ID can be retrieved from the database&nbsp;and stored along with the clerk's.</FONT></P>
<P><FONT face=Tahoma size=2>I realize this isn't exactly a direct answer to your question, but I think it's a concept you might want to look into.&nbsp;&nbsp;Unless your delegation&nbsp;rules are extremely complex, it's not hard to set up within the database and application.&nbsp; Delegation is usually set up and left alone, so it's not like it's a huge impact on the user's daily process.&nbsp; Plus, it allows for better visibility of who's doing what, and for whom - something that seems to be fairly important for your project.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Thursday, October 11, 2007</h2><P><STRONG>great suggestion tmg</STRONG>....&nbsp; a module where the manager would go on [example]&nbsp;vacation so he had to assign thru the delegation part of the application, someone to take care of his direct reports during his absence...</P>
<P>and the system would have to inspect if the action is done "on behalf of" and store the appropriate info...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ReadOnlyChild replied on Thursday, October 11, 2007</h2><P>great suggestion tmg.... </P>
<P>like have a module to specify who will be responsible for a manager's tasks for a period of time, say the manager goes on vacation, so he needs to appoint someone to take care of his workflows during his absence,</P>
<P>and the application would have to know if actions are being done "on behalf of" and store the appropriate info...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, October 11, 2007</h2><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ReadOnlyChild:</strong></div><div></FONT>
<P><FONT face=Tahoma size=2>like have a module to specify who will be responsible for a manager's tasks for a period of time, say the manager goes on vacation, so he needs to appoint someone to take care of his workflows during his absence,</FONT></P>
<P><FONT face=Tahoma size=2>and the application would have to know if actions are being done "on behalf of" and store the appropriate info...</FONT></P>
<P><FONT face=Tahoma size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>That's the idea - you allow an individual to grant their access rights to other individual(s) as necessary.&nbsp; You can do it for a period of time, split rights among multiple people... however you need to set it up.</FONT></P>
<P><FONT face=Tahoma size=2>In our example here, when the clerk logs in, the sytem collects two sets of roles: those directly assigned to the clerk, and those (s)he inherits through delegation.&nbsp; This allows the application to easily tell whether the action is allowed through direct rights or delegated rights.&nbsp; Optionally, the delegated role list&nbsp;also provides who delegated the role to the clerk.&nbsp; In&nbsp;.NET, this would ideally all be contained in custom Principal/Identity objects.</FONT></P>
<P><FONT face=Tahoma size=2>Then the application can either send the manager's ID along with the clerk's, or send the action to the database and let it collect the ID.&nbsp; I personally would collect the list of delegators in the application - being able to display who&nbsp;the clerk is&nbsp;doing the work for is probably helpful, and on the chance that two people delegate the same authority to the clerk,&nbsp;the clerk&nbsp;would need to select for whom this action applies.</FONT></P>
<P><FONT face=Tahoma size=2>Again, a lot depends on how complex your delegation needs to be.&nbsp; We set up a system at my last job that had a&nbsp;fairly complex&nbsp;level of delegation, with multiple levels, inheritance of delegation rights, date ranges,&nbsp;and the ability to delegate rights down&nbsp;beyond the&nbsp;"can you perform this action"&nbsp;to "what objects can you perform this action on?"&nbsp; The whole thing took us about two weeks to code and test.&nbsp; We were lucky in that we did it up-front, but retro-fitting that kind of thing wouldn't necessarily be a huge PITA.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>culprit replied on Thursday, October 11, 2007</h2><P>I think I understand. I am new to .Net and don't think I understand how to program this delegate you are referring to.</P>
<P>Also, you said you would store the User and IDs for display throughout the program which is what I wish to do. Would I somehow store them in the User space, <FONT size=2></P>
<P>Csla.ApplicationContext.User? If so, could you give me an example of how to do this?</P>
<P>I appreciate your help. Rob.</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, October 12, 2007</h2><P><FONT face=Tahoma size=2>I'm not talking about a .NET delegate, nor is this a .NET-specific concept.&nbsp; I'm talking about the delegation of responsibilities within your application.&nbsp; The idea is that your managers can grant the rights they have&nbsp;in the application to other people.&nbsp; This allows your clerk, for example, to log into the system using their ID, but be able to do&nbsp;the manager's tasks, since the manager would have delegated them to the clerk.&nbsp; It also closes a fairly big hole in the&nbsp;security of your application (allowing&nbsp;a user&nbsp;to use the system under someone else's ID), allows your managers to more tightly control which of their tasks their subordinates can do for them, and allows for you to more easily track who is doing what.</FONT></P>
<P><FONT face=Tahoma size=2>It would require an additional table (or multiple tables, depending on the level of complexity) in your database, as well as some code changes/additions in your application.&nbsp; Unfortunately, I can't give any real concrete examples, as I don't really know your requirements.&nbsp; But I can lay out how I'd probably do it.</FONT></P>
<P><FONT face=Tahoma size=2>What I would probably do is to wrap the functionality within custom Principal and Identity objects (and if you don't have them, you'll need them.)&nbsp;&nbsp;These objects would feed directly into ApplicationContext.User, and thus would be readily available to you.&nbsp;&nbsp;They would store the list of roles the user directly has, as well as a second list of roles that have been granted to them by other users (along with the ID of the person(s) who granted each role.)&nbsp; </FONT><FONT face=Tahoma size=2>Then, your "IsInRole" implementation would check both lists to determine whether the user can do the specified action.</FONT></P>
<P><FONT face=Tahoma size=2>You'll also probably want&nbsp;a method to determine whether a role has been delegated by someone, as well as a method to return the ID&nbsp;of the delegator (or list of ID's, if the same role has been delegated to the user by multiple people.)&nbsp; That way, you can easily populate your BO with the appropriate Manager ID if you need it, and provide the list of managers to choose from if the user needs to select which manager they are doing work for.&nbsp; Using these methods would require a downcast of ApplicationContext.User to your custom Principal object, but there's not a lot of choice there, and that's not the end of the world.</FONT></P>
<P><FONT face=Tahoma size=2>Beyond that, you'll need a module within your application that allows users to delegate their rights to other users.&nbsp; You don't necessarily have to restrict it to manager/clerk - realistically, anyone can delegate their rights to anyone else.&nbsp; This allows for flexibility when people are sick, go on vacation, etc.&nbsp; Again, a lot depends on the level of complexity in your application's security model, and the needs of your users.</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
