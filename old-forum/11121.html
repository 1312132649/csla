<html><header><title>Unable to serialize...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Unable to serialize...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11121.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Hurty posted on Thursday, February 02, 2012</h2><p>Hello nice people out there :)</p>
<p>I&#39;ve run into very interesting problem.</p>
<p>So far I am using CSLA 4.1 and have built WCF Service (the standart CSLA built-in service) so I can use CommandBase to execute code on the server (n-tier appliation).</p>
<p>Most of the CommandBase objects are working fine.</p>
<p>The interesting part is...</p>
<p><b>I have LINQ 2 SQL </b>classes which perform database updates. The program was working locally and was working just fine... the problem is ... when I put the LINQ code in CommandBase I had to make them serializable... so did I.</p>
<p>But the program rised exception about coulnd serialize some of the objects (although I have set the serialization mode to Unidirectional)!??</p>
<p>Any Ideas how I can use LINQ 2 SQL with Dataportal and CommandBase to execute code on server-side ?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 02, 2012</h2><p>Is this .NET or Silverlight?</p>
<p>I&#39;ll assume .NET, or you wouldn&#39;t have gotten anywhere at all.</p>
<p>In .NET, the <em>entire object graph</em> must be serializable. That means the classes that define all the objects in the entire graph must be serializable. Any object referenced from a field must be serializable, or that field must be marked as NotSerialized.</p>
<p>I&#39;m not sure what you mean by &quot;Unidirectional&quot; - perhaps that&#39;s a relatively new parameter to [Serializable] I&#39;m unaware of?</p>
<p>BUT, and this is the important part.</p>
<p>I strongly recommend against allowing data layer types or concepts to leak into the business or presentation layers of the application. That&#39;s just asking for trouble. Any types created by or composing LINQ to SQL (L2S) are data layer types, and shouldn&#39;t be used by business layer code (except <em>maybe</em> in the DataPortal_XYZ methods).</p>
<p>One reason for this strong recommendation is to avoid the complexity you are now facing. Another important reason is to avoid fragility in your application over time. L2S is generally considered to be deprecated, so it is a good bet that you&#39;ll eventually need to replace all use of L2S with something more supported. The less of your code that uses L2S types, the easier it will be to get rid of L2S at that time.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Hurty replied on Friday, February 03, 2012</h2><p>Thank you Rocky... and yes.. I am working under .NET 4.0 and CSLA 4.1</p>
<p>I agree with you Rocky, about the maintenance complexity L2S adds along with CSLA, but the trouble is that I have a lot of L2S code inside the project and I am trying to move that code to work over the APP Server using the CommandBase and the DataPortal.Execute() method.</p>
<p>The &quot;Unidirectinal&quot; parameter is a parameter that sets the <i>serialization mode</i> of the L2S entities. Although I set it to that value it still gives me error?</p>
<p>It says:<br /><b>ChangeTracker+StandardChangeTracker is not marked serializable...</b></p>
<p>I am totally lost... should I replace the L2S with standart SQL queries (as I am sure that standart SQL queries work 100% with Dataportal.XYZ() ) ?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Hurty replied on Friday, February 03, 2012</h2><p>Actually I just found the answer myself... DataPortal.XYZ methods works just fine with L2SQL but one have to do some very UNCOMMENTED (from Microsoft side) <b>devil settings:</b></p>
<p><b>1. If you want to send L2S over the wire you <i>should made them serializable </i>as setting the [Serialization] attribute to &quot;Unidirectinal&quot; (use the designer&quot;</b></p>
<p><b>2. You have to manually put [Serializable] attribute on each of the generated classes the designer generates...</b></p>
<p><b>3. You have to mark all th <i>EntitySet </i>and <i>EntittyRef </i>fields of the generated class as [NonSerializable]</b></p>
<p><b>4. You have to <i>comment all the events</i> (such as NotifyPropertyChanging and NotifyPropertyChanged) to allow the serialization engine to do its work properly</b></p>
<p><b>5. You have to delete all corresponding interfaces to pt.4 to allow serialization engine to catch only generated classes (not to climb above the graph), so delete INotifiyPropetyCahnging and INotifyPropertyChanged events..</b></p>
<p>So these are the required steps if you want to use LINQ2SQL with CSLA built-in WCF Service and make the code run server-side..</p>
<p><i>I hope this post will help other in trouble :)</i></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, February 03, 2012</h2><p>Hi,</p>
<p>The only serialization supported by L2S is using DataContract and DataMember so the classes can be serialised by the WCF Data Contract Serializer.</p>
<p>CSLA requires a binary serialization and these are not compatible.</p>
<p>You should be able to create a separate WCF Portal for the Linq2Sql queries that use WCF and Data Contract Serializer or make the objects work with BinarySerializer.&nbsp; I haven&#39;t done this myself but you might start with this article <a title="http://www.codeproject.com/Articles/22291/LINQ-to-SQL-Serialization" href="http://www.codeproject.com/Articles/22291/LINQ-to-SQL-Serialization">http://www.codeproject.com/Articles/22291/LINQ-to-SQL-Serialization</a> that show how to make L2S objects serialize with BinaryFormatter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Hurty replied on Friday, February 03, 2012</h2><p>Yes.. that&#39;s the point. So following the steps in my answer will <b>enable</b> the CSLA to serialize the L2S entities, although you will face some limitations I had no time to think of potential workaround. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
