<html><header><title>Web form thread casting error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Web form thread casting error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3215.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CMoreno posted on Tuesday, July 17, 2007</h2><H2><SPAN>We just started creating our web interface using the CSLA framework. Because our windows application gets the UserID out of the windows thread, we are having the following casting exemption: <I>Unable to cast object of type 'System.Security.Principal.WindowsIdentity' to type 'XE700.Library.Security.XEIdentity'.</I> <o:p></o:p></SPAN></H2><PRE><SPAN>Line: int CurrentUserLevel = ((XEIdentity)Thread.CurrentPrincipal.Identity).UserLevel;<o:p></o:p></SPAN></PRE>
<H2><SPAN>On XE700\XE700.Library\XEBusinessListBase.cs &nbsp;&nbsp;<o:p></o:p></SPAN></H2>
<P><SPAN>How can we go around this? I will appreciate any feedback<o:p></o:p></SPAN></P>
<P><SPAN>Thanks<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 17, 2007</h2><P>If you are using Windows authentication then you should be using a WindowsIdentity, not a custom identity.</P>
<P>If you are using a custom identity then you need to set the current principal on every page request (in global.asax). See Chapter 10 for details.</P>
<P>If you are trying to do both, then you <EM>still</EM> need to set the current principal on every page request, you'll just pull the username from the WindowsIdentity when creating your custom principal.</P>
<P>In any case, I recommend you use Csla.ApplicationContext.User rather than directly interacting with either HttpContext.Current.User or System.Threading.Thread.CurrentPrincipal, because (as discussed in the book) ApplicationContext.User addresses some scenarios where either of those other two locations may be incorrect at times.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
