<html><header><title>Upgrading from 1.1 to 2.0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Upgrading from 1.1 to 2.0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1075.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>danielw posted on Wednesday, August 30, 2006</h2><P>We have previous written a form that will automatically check if a business object is dirty when the form that the business object is on &nbsp;is closed and prompt the user to save the changes if required.</P>
<P>However the use of generics has scotched our plans in version 2.0.</P>
<P>Can anybody give a pointer/ advice on how we could write the following code in 2.0</P>
<P>Cheers</P>
<P>Daniel Wood</P>
<P><EM><FONT color=#808080>Imports System.Windows.Forms<BR>Imports CSLA</FONT></EM></P>
<P><EM><FONT color=#808080>Public Class BusinessBaseForm<BR>&nbsp;&nbsp;&nbsp; Inherits System.Windows.Forms.Form</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; Protected mBizObj As BusinessBase<BR>&nbsp;&nbsp;&nbsp; ' Set this field to TRUE on the inherited form in the<BR>&nbsp;&nbsp;&nbsp; ' cancel button's click event<BR>&nbsp;&nbsp;&nbsp; Protected cancelledByUser As Boolean = False</FONT></EM></P>
<P><BR><EM><FONT color=#808080>#Region " Windows Form Designer generated code "</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; Public Sub New()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New()</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'This call is required by the Windows Form Designer.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent()</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Add any initialization after the InitializeComponent() call</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; End Sub</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; 'Form overrides dispose to clean up the component list.<BR>&nbsp;&nbsp;&nbsp; Protected Overloads Overrides Sub Dispose(ByVal disposing As Boolean)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If disposing Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not (components Is Nothing) Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; components.Dispose()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.Dispose(disposing)<BR>&nbsp;&nbsp;&nbsp; End Sub</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; 'Required by the Windows Form Designer<BR>&nbsp;&nbsp;&nbsp; Private components As System.ComponentModel.IContainer</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; 'NOTE: The following procedure is required by the Windows Form Designer<BR>&nbsp;&nbsp;&nbsp; 'It can be modified using the Windows Form Designer.&nbsp; <BR>&nbsp;&nbsp;&nbsp; 'Do not modify it using the code editor.<BR>&nbsp;&nbsp;&nbsp; &lt;System.Diagnostics.DebuggerStepThrough()&gt; Private Sub InitializeComponent()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'BusinessBaseForm<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.AutoScaleBaseSize = New System.Drawing.Size(5, 13)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ClientSize = New System.Drawing.Size(328, 206)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Name = "BusinessBaseForm"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Text = "BusinessBaseForm"</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; End Sub</FONT></EM></P>
<P><EM><FONT color=#808080>#End Region<BR>&nbsp;&nbsp;&nbsp; ' Set the main buisness object of the form<BR>&nbsp;&nbsp;&nbsp; ' so if the user closes the form by clicking<BR>&nbsp;&nbsp;&nbsp; ' the X, we can decide if the Business object is savable<BR>&nbsp;&nbsp;&nbsp; ' and prompt the user accordingly<BR>&nbsp;&nbsp;&nbsp; ' Note, this only works if the main Business object on a form inherits from<BR>&nbsp;&nbsp;&nbsp; ' Businessbase, not if it inherits from a CollectionBase!</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; Public Property Bizobj() As BusinessBase<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mBizObj<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal Value As BusinessBase)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Value Is mBizObj Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mBizObj = Value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp;&nbsp; End Property</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; Private Sub BusinessBaseForm_Closing(ByVal sender As Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles MyBase.Closing</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Me.DialogResult = DialogResult.OK Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Bizobj.IsValid Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(Bizobj.BrokenRulesString)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Cancel = True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Sub<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Sub<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Bizobj.IsDirty Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not cancelledByUser Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim saveChanges As DialogResult = MessageBox.Show("Do you wish to save changes ?", "Save Changes", MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button3)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If saveChanges = DialogResult.Yes Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' If the bizobj is dirty but not valid<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Inform the user of the broken rules<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Bizobj.IsValid Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(Bizobj.BrokenRulesString)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Cancel = True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Sub<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.DialogResult = DialogResult.OK<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bizobj.ApplyEdit()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bizobj.Save()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf saveChanges = DialogResult.No Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.DialogResult = DialogResult.Cancel<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf saveChanges = DialogResult.Cancel Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Cancel = True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; End Sub</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; Private Sub BusinessBaseForm_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load</FONT></EM></P>
<P><EM><FONT color=#808080>&nbsp;&nbsp;&nbsp; End Sub<BR>End Class</FONT></EM><BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 30, 2006</h2>The Csla.Core.IEditableBusinessObject interface (version 2.0.1+) exposes the IsDirty property, along with various other properties.<br><br>The Csla.Core.ISavable interface (version 2.1+) exposes a non-generic Save() method you can use to save any root object.<br><br>The Csla.Core.BusinessBase class (version 2.0+) exposes everything you need except the Save() method, which is the reason for adding ISavable.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
