<html><header><title>Mulitple Languages for my Objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Mulitple Languages for my Objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3696.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MADCookie posted on Thursday, October 11, 2007</h2><font face="Arial">Admittedly I'm a bit nervous posting here. I have read a ton of posts and there are a bunch of sharp developers here. Forgive my ignorance, please.<br><br>I have a current class library using CSLA 2.1.0-061003. My objects return data in English from my SQL Server. I now have to support Spanish. <br><br>I understand ASP.NET mechanisms regarding culture and globalization as it applies to resource files, but I need to better understand the concept as it applies to my data living in cells in my database. Could anyone give me a gentle kick in butt to point me in the right direction as to how to start this adventure? I have read Ch.4 regarding DataPortalContext and it providing my ClientUICulture, but I'm not sure how to use this knowledge.<br><br>I appreciate your patience<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 12, 2007</h2>Hi,<br><br>No need to feel nervous posting here.<br><br>If your database contains stuff you need to localize, you'll need to come up with a scheme there.&nbsp; Its similar to how you'd use a resource file in .Net.&nbsp; Basically, you need a list of strings which are identified by some key which is language neutral.&nbsp; Since you're starting in english, some english key would be fine.&nbsp; Then you have a table of supported locales, and another table which uses a the locale and "string id" to look up translated strings.<br><br>Something like this:<br>Locale<br>&nbsp; LocaleId int<br>&nbsp; Locale varchar( 5 )<br><br>String<br>&nbsp; StringId int<br>&nbsp; StringKey varchar( 10 )<br><br>LocalizedString<br>&nbsp;&nbsp; LocaleId int<br>&nbsp;&nbsp; StringId int<br>&nbsp;&nbsp; LocalizedString nvarchar(max)<br><br>If you have a DocumentStatus table, it might look like this<br>DocumentStatus<br>&nbsp;&nbsp; DocumentStatusId int<br>&nbsp;&nbsp; StringId int<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MADCookie replied on Friday, October 12, 2007</h2><font face="Arial">Thank you ajj3085. That is nearly the exact db scheme I was thinking. I feel good that you confirmed my idea.<br><br>When I was learning about localization in ASP.NET, I made a test web site where I played around switching my browser's language choice and also making UI on a web page so, as a user, I could change my culture (overriding page's <font face="Courier New">InitializeCulture() </font>method).<br><br>Today, I will try to apply the same concept for my CSLA objects. Do I need to code my CSLA objects differently once I have a database schema? Specifically, I'm wondering if at some point I have to get the user's culture choice and pass it in to ... I don't know what -- the dataportal_xyz methods?? Sorry. It is not connecting in my brain, hence the reason I have to just play with it. Do you have any tips or land minds to avoid?<br><br>Thanks again for your help. I appreciate your time on help me.<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 12, 2007</h2>I can't think of any reason why localizatino would affect your BOs.&nbsp; Your name value lists may need to take into account localization when loading.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MADCookie replied on Friday, October 12, 2007</h2><font face="Arial">Hopefully, this will be my last confirmation post.<br><br>Here is my BO's dataportal fetch<br><br><font face="Courier New">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Public Shared Function GetQuestionInfo(ByVal QuestionId As Integer) As QuestionInfo<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If Not CanGetObject() Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New System.Security.SecurityException("User not authorized to view a QuestionInfo")<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return DataPortal.Fetch(Of QuestionInfo)(New Criteria(QuestionId))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Function<br><br></font>Going deeper into the covers, I have this method that basically sets up the SPROC and command for execution<br><br><font face="Courier New">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Private Sub ExecuteFetch(ByVal criteria As Criteria, ByVal cn As SqlConnection)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">Dim currentCultureName As String = System.Globalization.CultureInfo.CurrentUICulture.Name<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' i.e. currentCultureName = "en"</font><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim cm As SqlCommand = cn.CreateCommand()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandText = "up_srvy_Question_Get"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@QuestionId", criteria.QuestionId)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<font color="#0000ff"> cm.Parameters.AddWithValue("@Culture", currentCultureName)</font><br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim dr As ASH2.Data.ASHDataReader = New ASH2.Data.ASHDataReader(cm.ExecuteReader())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If dr.Read() Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FetchObject(dr)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Sub</font><br><br>Would you all use <font face="Courier New">System.Globalization <font face="Arial">or </font>System.Threading</font> or something (magic is CSLA?) to get the culture info? <br><br>Confirmation needed: <font face="Courier New">Csla.Server.DataPortal Fetch() </font>is setting the <font face="Courier New">System.Threading</font> culture info based on the client, so it is "safe" for my BO to request <font face="Courier New">System.Globalization</font> culture because it will be set with the client's desire?<br><br>Thanks again everyone for sharing your experience!<br><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Friday, October 12, 2007</h2><P>Both return a similar object, the difference is where they get it. From the Threading namespace you'll get info from within that thread's context, the Globalization namespace will get it from the system's defined/selected object. If you need to allow the user to select a language, then use the thread. Depending on your users, they may want to keep their formats eventhough they are working in a different language. You can accomodate them without too much trouble. (Note: not too much trouble, but you'll always find some lout who wants their "I"s doted differently: like a proportional dingbat heart or something. That's line in the sand time.)</P>
<P>_E</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, October 12, 2007</h2>I think you'll be alright.&nbsp; As you noticed, the DataPortal will set the UICulture and Culture to match the culture settings of the client, so everything should work just fine.&nbsp; I believe your sitution is why Rocky transmits the culure info from client to server.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MADCookie replied on Friday, October 12, 2007</h2><font face="Arial">I hope I'm not responding too soon-- I don't want to invoke <font face="Courier New">Murphys.Law(of MyApplication)</font>. So far everything looks great! I appreciate all of your help! My changes are working beautiful.<br><br>In case anyone else tries this or needs details like me, here is some of my specific elements<br><font face="Courier New"><br><b><font face="Arial">Tables</font></b><br><br>Question<br>&nbsp;&nbsp;&nbsp; QuestionId INT (PK)<br>&nbsp;&nbsp;&nbsp; CategoryPageId INT<br>&nbsp;&nbsp;&nbsp; Visible BIT<br>&nbsp;&nbsp;&nbsp; DisplayText VARCHAR(400)<br>&nbsp;&nbsp;&nbsp; DisplaySubText VARCHAR(400)<br><br>Question_Culture<br>&nbsp;&nbsp;&nbsp; QuestionId INT<br>&nbsp;&nbsp;&nbsp; Culture VARCHAR(15)<br>&nbsp;&nbsp;&nbsp; DisplayText NVARCHAR(4000)<br>&nbsp;&nbsp;&nbsp; DisplaySubText NVARCHAR(4000)<br></font><br><b>SPROC snippet</b><br></font><font face="Arial"><br><font face="Courier New">SELECT<br>&nbsp;&nbsp;&nbsp; A.[QuestionId],<br>&nbsp;&nbsp;&nbsp; A.[CategoryId],<br>&nbsp;&nbsp;&nbsp; A.[Visible],<br><br>&nbsp;&nbsp;&nbsp; -- Culture checking<br>&nbsp;&nbsp;&nbsp; ISNULL(B.DisplayText, A.DisplayText) AS 'DisplayText',<br>&nbsp;&nbsp;&nbsp; ISNULL(B.DisplaySubText, A.DisplaySubText) AS 'DisplaySubText'<br><br>FROM [dbo].[Question] A WITH (NOLOCK)<br>&nbsp;&nbsp;&nbsp; LEFT OUTER JOIN QUestion_Culture B ON <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; A.QuestionId = B.QuestionId<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AND B.Culture = @Culture<br>WHERE <br>&nbsp;&nbsp;&nbsp; A.[QuestionId] = @QuestionId<br></font><br><br><b>My BO's command action</b><br></font><font face="Arial"><font face="Courier New">Dim currentCultureName As String = System.Globalization.CultureInfo.CurrentUICulture.Name<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ' i.e. currentCultureName = "en"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim cm As SqlCommand = cn.CreateCommand()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandText = "up_srvy_Question_Get_Culture"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@QuestionId", criteria.QuestionId)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@Culture", currentCultureName)<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Dim dr As ASH2.Data.ASHDataReader = New ASH2.Data.ASHDataReader(cm.ExecuteReader())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If dr.Read() Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FetchObject(dr)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br><br><font face="Arial">There is composite key on the _Culture table for the Id and Culture text. I will probably create a look up table for the culture strings and use a CultureId as Andy suggested.<br><br>I also need to deal with the differences in "es" versus "es-MX". I have the elements in my database specifically set to "es-MX" because my control is setting the thread that way. I think that is fine since I need the "MX" part for ASP.NET to deal with currency and dates automatically on my static resource-file based text.<br><br><font color="#0000ff"><b>Again, THANKS!</b></font><br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Friday, October 12, 2007</h2><P>If the data living in your cell is numeric, the globalization will affect formatting in your presentation, i.e.&nbsp;commas instead of decimal point. If your data is text, then that text needs to be translated and stored by language and called for based on the UI language. You can get that info from the ClientUICulture object... and more.</P>
<P>_E</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MADCookie replied on Friday, October 12, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>esteban404:</strong></div><div><p>If the data living in your cell is numeric, the globalization will affect formatting in your presentation, i.e.&nbsp;commas instead of decimal point. If your data is text, then that text needs to be translated and stored by language and called for based on the UI language. You can get that info from the ClientUICulture object... and more.</p>
<p>_E</p></div></BLOCKQUOTE><br><br><font face="Arial">Ah, good points. I just replied to Andy asking about land minds. I'm glad you mentioned this.<br><br>Specifically, do you know if I have to write code to make the globalization of the numeric data reformat? In standard ASP.NET static text, I would not have to. I would just set the thread to use whatever CultureInfo and then the rendered HTML would pop out appropriately -- dates &amp; currency were the easy to see.<br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Friday, October 12, 2007</h2><P>Nah, you don't need to do anything beyond&nbsp;that except support&nbsp;the stuff as Andy writes about. I ususally use a tag in the form that's translated to the appropriate language and just verify the GUI if field size gets tight. Easier in ASP.NET than winforms.</P>
<P>_E</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
