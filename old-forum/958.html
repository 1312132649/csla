<html><header><title>Table Driven Validation?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Table Driven Validation?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/958.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cruachan posted on Sunday, August 20, 2006</h2>Would it be possible to create a validation object which would cache the validation rules for the system?&nbsp; For example, this object could be referenced in the AddBusinessRules section of a BusinessBase object, and because the rules are stored in a database table, one could adjust the validation rules without recompiling their applicaiton.<br><br>The hard part, is that the handler parameter in the call Validation.AddRule(handler, property) needs to be an actual method, and cannot really be passed as a string value from a table.<br><br>Am I wasting my time thinking about this?&nbsp; Is there a way to satisfy the "handler" parameter above by calling some type of C# function that can return a pointer to a Csla.Validation.RuleHandler from a string search?<br><br>I'm a bit new to C#, and even newer to Csla.<br><br>Any comments?&nbsp; Ideas?&nbsp; Waste of time?&nbsp; Thanks!<br><br>-Cruachan<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Sunday, August 20, 2006</h2>what should be in the string? c# code? some kind of pattern?<br><br>you can make a custom validation rule and define a set of rules in your database, which that rule uses.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cruachan replied on Sunday, August 20, 2006</h2>Ok, I think I have answered my question.<br><br>I think I was mistaken a bit in my post.&nbsp; I took a break and realized that I must have been getting tired.<br><br>I was working on making the validation and authorization table driven... so, I was trying to load the business rules dynamically at runtime, and realized that I was going to have a problem.&nbsp; After taking my break, I realized that there was no reason to do that whatsoever... <br><br>Although it might be valuable to to change which business rules load or do not load... one shouldn't have a problem getting that done.&nbsp; For some reason, I was missing the point of what I was trying to do.<br><br>I have however, made the Authorization rules of my business objects table driven... all the authorization rules are going to be loaded into another object at runtime... when an object gets created, it will check the authorization object for what fields it has to secure and for what roles.&nbsp; This way, I can change the roles and fields in the table, and not have to rebuild my app to account for them.<br><br>Anyway... looks like I ended up asking a question that was incorrect to begin with.<br><br>Thanks,<br><br>-cru<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Monday, August 13, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>cruachan:</strong></div><div>Ok, I think I have answered my question.<br><br></div></BLOCKQUOTE><br><br>You might have answered it for YOURSELF, but not for ME!<br><br>How did you get ValidationRules.AddRule() to accept the name of a rule from the database?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, August 14, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>david.wendelken:</strong></div><div><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>cruachan:</strong></div><div>Ok, I think I have answered my question.<BR><BR></div></BLOCKQUOTE><BR><BR>You might have answered it for YOURSELF, but not for ME!<BR><BR>How did you get ValidationRules.AddRule() to accept the name of a rule from the database?<BR></div></BLOCKQUOTE></P>
<P>I spent yesterday trying to figure out the syntax to do this.&nbsp; </P>
<P>Let's just say that I know a whole lot more about lots of ways that do not work. :(</P>
<P>This appears to be a really nasty syntax problem just waiting for someone to point out an easy, elegant way to do this!</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, August 14, 2007</h2><P>Ok, here is an example of a failed attempt.&nbsp; Feel free to provide the solution! :)</P>
<P>(FYI, I have my own common rules library derived from the csla version.&nbsp; <BR>&nbsp;Use your own values for typeName.<BR>)</P><FONT color=#008000 size=2><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// What we need to create...</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// public delegate bool RuleHandler(object target, RuleArgs e);</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// A hard-coded way to create it.</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// rh = new RuleHandler(CslaSrd.Validation.StdRules.StringRequired);</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// Pretend the type and rule come from a database and are loaded into strings...</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> <FONT color=#000000>typeName </FONT>= </FONT><FONT color=#800000 size=2>"CslaSrd.Validation.StdRules, CslaSrd, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> <FONT color=#000000>ruleName</FONT> = </FONT><FONT color=#800000 size=2>"StringRequired"</FONT><FONT size=2>;</P>
<P></P>
<P></FONT><FONT color=#008000 size=2>// Use Reflection to find the rule method.</P></FONT><FONT size=2>
<P></FONT><FONT color=#008080 size=2>Type</FONT><FONT size=2> <FONT color=#000000>t =</FONT> </FONT><FONT color=#008080 size=2>Type</FONT><FONT size=2><FONT color=#000000>.GetType(typeName);</FONT></P>
<P></FONT><FONT color=#008080 size=2>MethodInfo</FONT><FONT size=2> <FONT color=#000000>mi = t.</FONT><FONT color=#000000>GetMethod</FONT><FONT color=#000000>(</FONT></FONT><FONT color=#800000 size=2>"StringRequired"</FONT><FONT size=2><FONT color=#000000>);</FONT></P>
<P></FONT><FONT color=#008000 size=2>// Use Reflection to find a pointer to the method to create a RuleHandler with.</FONT></P>
<P><FONT color=#008000 size=2>// Which will fail :( with a "Method Name expected" error.</P></FONT><FONT size=2><FONT size=2>
<P><FONT color=#000000>rh =</FONT> </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>RuleHandler</FONT><FONT size=2><FONT color=#000000>( mi.MethodHandle.GetFunctionPointer);</FONT></P>
<P></FONT></FONT><FONT size=2></FONT><FONT color=#008000 size=2>// Add the rule.</P></FONT><FONT size=2>
<P><FONT color=#000000>ValidationRules.AddRule(rh,</FONT> </FONT><FONT color=#800000 size=2>"Code"</FONT><FONT size=2><FONT color=#000000>);</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, August 15, 2007</h2><P>David,</P>
<P>I got something to compile. I don't know if it actually works though. Give it a try and let us all know.</P><FONT size=2></FONT><FONT color=#008000 size=2>
<P>'==========================================================================<BR>'hard coded solution works:<BR></FONT><FONT color=#008000 size=2>'Dim rh As RuleHandler<BR></FONT><FONT color=#008000 size=2>'rh = New RuleHandler(AddressOf StringRequired)<BR></FONT><FONT color=#008000 size=2>'ValidationRules.AddRule(rh, "<FONT color=#ff00ff>MyProperty</FONT>")<BR>'==========================================================================</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'try strings instead of actual methods and then use reflection:<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> typeName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>"My.BO.MyRules, My.BO, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> ruleName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>"StringRequired"<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> t </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type = Type.GetType(typeName)<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> mi </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Reflection.MethodInfo = t.GetMethod(</FONT><FONT color=#ff00ff size=2>"StringRequired"</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> rh </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> RuleHandler<BR>rh = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(<FONT size=2>System.Delegate</FONT>.CreateDelegate(t, mi), RuleHandler)<BR>ValidationRules.AddRule(rh, </FONT><FONT color=#ff00ff size=2>"MyProperty"</FONT><FONT size=2>)<BR></FONT><FONT color=#006400 size=2>'==========================================================================</P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Wednesday, August 15, 2007</h2><P><FONT size=5><STRONG>Joe, you da man!&nbsp; :)</STRONG></FONT></P>
<P>It wasn't exactly right, but it was close enough to get me to a solution in 15 minutes! :) :) :)</P>
<P>Here's a tested c# version:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> typeName = </FONT><FONT color=#800000 size=2>"My.BO.MyRules, My.BO, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</FONT><FONT size=2>;<BR></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ruleName = </FONT><FONT color=#800000 size=2>"StringRequired"</FONT><FONT size=2>;<BR></FONT><FONT color=#008000 size=2><BR>// Use Reflection to find the rule method.<BR></FONT><FONT color=#008080 size=2>Type</FONT><FONT size=2> t = </FONT><FONT color=#008080 size=2>Type</FONT><FONT size=2>.GetType(typeName);<BR></FONT><FONT color=#008080 size=2>MethodInfo</FONT><FONT size=2> mi = t.GetMethod(</FONT><FONT color=#800000 size=2>"StringRequired"</FONT><FONT size=2>);<BR></FONT><FONT color=#008080 size=2>RuleHandler</FONT><FONT size=2> <FONT size=2>rh = (</FONT><FONT color=#008080 size=2>RuleHandler</FONT><FONT size=2>)System.</FONT><FONT color=#008080 size=2>Delegate</FONT><FONT size=2>.CreateDelegate(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#008080 size=2>RuleHandler</FONT><FONT size=2>), mi)</FONT>;<BR></FONT><FONT size=2>ValidationRules.AddRule(rh, </FONT><FONT color=#800000 size=2>"Code"</FONT><FONT size=2>);</FONT></P>
<P><FONT size=2>In visual basic, I think this line you gave:</FONT></P>
<P><FONT size=2>rh = <FONT color=#0000ff>CType</FONT>(System.Delegate.CreateDelegate(t, mi), RuleHandler)</FONT></P>
<P><FONT size=2>should be:</FONT></P>
<P><FONT size=2>rh = <FONT color=#0000ff>CType</FONT>(System.Delegate.CreateDelegate(typeof(RuleHandler), mi), RuleHandler)<BR></FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Wednesday, August 15, 2007</h2><P>It looks like there may be ways to not have to know the version, culture and publickeytoken in order to get the Type t assigned correctly.&nbsp; I'll post later when I do some more testing and refactoring.</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, August 15, 2007</h2><P>I use code like this to get the type from another assembly:</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetSomeType(</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> result </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Type<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> methodName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = "<FONT color=#ff00ff>someMethod</FONT>"<BR></FONT><FONT color=#0000ff size=2>&nbsp; Dim</FONT><FONT size=2> assemblyName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#ff00ff size=2>"MyAssembly.Namespace"</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>&nbsp; 'the call to Assembly.Load does nothing extra if the assembly is already loaded. <BR>&nbsp; 'It just returns the loaded assembly.<BR></FONT><FONT color=#0000ff size=2>&nbsp; Dim</FONT><FONT size=2> loAssembly </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> System.Reflection.Assembly = System.Reflection.Assembly.Load(assemblyName)<BR>&nbsp; result = loAssembly.GetType(assemblyName &amp; </FONT><FONT color=#ff00ff size=2>"."</FONT><FONT size=2> &amp; methodName )<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> result<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000 size=3>Joe</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dmccrory replied on Monday, August 13, 2007</h2><P>cruachan,</P>
<P>&nbsp;</P>
<P>I am working on the exact type scenario and would be interested in knowing the process you are going to use to accomplish this task. I don't really need details, just an overview of how you think the process will flow....</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
