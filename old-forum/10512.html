<html><header><title>Generic Root Object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Generic Root Object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10512.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Randar posted on Monday, July 11, 2011</h2><p>For various reasons, I am trying to create 3 base objects that all root, list and business objects inherit from.&nbsp; So I would have:</p>
<p>For Business Objects: BusinessBase(Of T)&lt;-CSLAComponentBase(Of T As BusinessBase(Of T))&lt;-ConcreteBO<br />For Lists of Business Objects: BusinessBindingListBase(Of L, C)&lt;-CSLAListBase(Of L As BusinessBindingListBase(Of L, C), C As CSLAComponentBase(Of C))&lt;-ConcreateListOfBOs<br />For Root Business Object: BusinessBase(Of CSLARootBase(Of L, C))&lt;-CSLARootBase(Of L As {CSLARootBase(Of L, C), New}, C As CSLAComponentBase(Of C))&lt;-ConcreateRootBO</p>
<p>I have confirmed that when I want to load just a BO, it works.&nbsp; But when I try to load the RootBO, it fails.<br />Exception: {&quot;The type initializer for &#39;JonasNET.Master.CSLARootBase`2&#39; threw an exception.&quot;}<br />Inner Exception: {&quot;The type initializer for &#39;JonasNET.Master.CSLARootBase`2&#39; threw an exception.&quot;}<br />Inner Inner Exception: {&quot;Not a member access Parameter name: member&quot;}</p>
<p>I get this when calling rootBO.MaintainList, which calls FieldManager.FieldExists(MaintainListProperty).&nbsp; I&#39;ve included all the important bits of the CSLARootBase.&nbsp; If there are other bits anybody needs, I can add them to the post.</p>
<p>Public MustInherit Class CSLARootBase(Of L As {CSLARootBase(Of L, C), New}, C As CSLAComponentBase(Of C))<br />&nbsp;&nbsp;&nbsp; Inherits BusinessBase(Of CSLARootBase(Of L, C))</p>
<p>&nbsp;&nbsp;&nbsp; Public Sub New(Optional ByVal RootCompany As Long = Nothing)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If (Not RootCompany = 0) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompanyId = RootCompany<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;&nbsp;&nbsp; Public Shared CompanyIdProperty As PropertyInfo(Of Integer) = RegisterProperty(Of Integer)(Function(p) p.CompanyId)<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Gets or sets the company id.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;value&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; The company id.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/value&gt;<br />&nbsp;&nbsp;&nbsp; Public Property CompanyId() As Integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(CompanyIdProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As Integer)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(CompanyIdProperty, value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Gets the children.&nbsp; Called from CSLA<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; <br />&nbsp;&nbsp;&nbsp; Public ReadOnly Property Children() As SortedBindingList(Of C)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New SortedBindingList(Of C)(MaintainList)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp; End Property</p>
<p>&nbsp;&nbsp;&nbsp; Public Shared MaintainListProperty As PropertyInfo(Of L) = RegisterProperty(Of L)(Function(p) p.MaintainList, RelationshipTypes.LazyLoad)</p>
<p>&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; Gets the list of BOs which is accessed by the maintain controls.<br />&nbsp;&nbsp;&nbsp; &#39;&#39;&#39; &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp; Public Overridable Function MaintainList(Optional ByVal CompanyID As Long = Nothing, Optional ByVal SortColumn As String = Nothing, Optional ByVal StartRecord As Integer = 0, Optional ByVal MaxRecords As Integer = 0) As L<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39; TODO: Do something with all the optional parameters.&nbsp; Add criteria<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not FieldManager.FieldExists(MaintainListProperty) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(Of L)(MaintainListProperty, New L())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return GetProperty(Of L)(MaintainListProperty)<br />&nbsp;&nbsp;&nbsp; End Function</p>
<p>End Class</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Randar replied on Monday, July 11, 2011</h2><p>So as an experiment, I actually changed my code so that it no longer used the Generic root object, just to see if it worked.&nbsp; So now it (temporarily) looks like:</p>
<p>For Lists of Business Objects: BusinessBindingListBase(Of L, C)&lt;-CSLAListBase(Of L As BusinessBindingListBase(Of L, C), C As CSLAComponentBase(Of C))&lt;-ConcreateListOfBOs<br />For Root Business Object: <strong>BusinessBase(Of ConcreateRootBO)&lt;-ConcreteRootBO.</strong></p>
<p>I was surprised, but I actually got a similar exception.</p>
<p>Exception: {&quot;DataPortal.Create failed (System.ArgumentException: Not a member access<br />Parameter name: member<br />&nbsp;&nbsp; at Csla.Reflection.Reflect`1.GetMemberInfo(Expression member)<br />&nbsp;&nbsp; at Csla.Reflection.Reflect`1.GetProperty(Expression`1 property)<br />&nbsp;&nbsp; at Csla.BusinessBase`1.RegisterProperty[P](Expression`1 propertyLambdaExpression, RelationshipTypes relationship)<br />&nbsp;&nbsp; at JonasNET.GL.BL.GLAccountTypeRoot..cctor() in C:\TFS\JonasNET-CSLA\JonasNET.GL.BL\Classes\GLAccountTypeRoot.vb:line 79)&quot;}</p>
<p>Inner Exception: {&quot;The type initializer for &#39;JonasNET.GL.BL.GLAccountTypeRoot&#39; threw an exception.&quot;}</p>
<p>Inner Inner Exception: {&quot;Not a member access<br />Parameter name: member&quot;}</p>
<p>So I guess the error is not because it&#39;s generic, but something else.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, July 16, 2011</h2><p>You should always make sure to call the default constructor&nbsp; (that in turn should call base class contructor).<br />This is vital to init the object like registering properties/business rules and initializing FieldDataManager. </p>
<p>&nbsp;&nbsp;&nbsp; Public Sub New(Optional ByVal RootCompany As Long = Nothing)<br /><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.New()</b>&nbsp; &#39; or MyBase.New()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If (Not RootCompany = 0) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompanyId = RootCompany<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp; End Sub</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
