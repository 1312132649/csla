<html><header><title>Databind IsDirty All of the Time</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Databind IsDirty All of the Time</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7613.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell posted on Saturday, September 12, 2009</h2>I've got a BusinessListBase Collection that i'm binding to a DevExpress grid. For some reason all of the objects come into the grid marked IsDirty. I therefore can't make save/apply buttons work properly. Can anyone think of a reason why all of the objects in a collection would be marked as dirty from instantiation? Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell replied on Saturday, September 12, 2009</h2>Upon further examination it looks like the objects are being marked dirty when the collection is assigned to a bindingsource. So in the following code:<br /><br />  _custs = _custs.GetCustomers<br />#1)<br />   BSCustomers.DataSource = _custs<br />#2)<br />   grdCusts.DataSource = BSCustomers<br />--------------------------------<br /><br />At #1 the _custs collection are not dirty. But when we get to #2 all of the objects are marked as dirty. So the grid is not the problem but i'm still at a loss.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Saturday, September 12, 2009</h2>U say that at #1 the items in the collection aren't dirty, u sure? Else it would had been a MarkClean() issue.<br /><br />But what is the BSCustomers?<br /><br />U could set breakpoints in each property setter and watch at the call stack who is to blame for it.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell replied on Saturday, September 12, 2009</h2>Yes, I see the change as I step through the code. BSCustomers is a binding source that I later set as the datasource of a datagrid.<br /><br />So i guess the question is if there's any reason that setting a csla collection to the datasource of a winforms binding source would cause the items to become dirty?<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, September 13, 2009</h2>Hi,<br><br>When you connect the databinding you may also trigger changing of properties. <br><br>That is especially true if you use ComboBox'es in your form. The sequence of Bind/Unbind is critical an you must bind the datasource for the list items first - and if not  you will find that the ComboBox resets the datavalue to the defaultvalue of the datatype. <br><br>Attach a OnPropertyChanged/OnChildChanged eventhandler to your BO and you will find which property that gets changed. <br><br>If you are using managed fields you can also look into the FeldList in FieldManager a find the field that is Dirty. <br><br>/jonnybee<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Sunday, September 13, 2009</h2>ComboBoxes are evil !!!<img src="/emoticons/emotion-14.gif" alt="Devil [6]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bcrowell replied on Monday, September 14, 2009</h2>Yes, I think you've got it. It's when I bind the datasource to the DevExpress datagrid that some properties are changed and thus everything becomes dirty. <br /><br />This is really lousy. I don't see a way around this while still using this grid control. I guess I'll have to use a readonly collection in the grid and then load up an editable object from the database for the detail form once a selection is made.<br /><br />If anyone has a better idea that would be great. If the clean/dirty functionality is flaky then it may be time to just go to a WCF Rest data access model and forget CSLA. I hope not.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fintanv replied on Tuesday, September 15, 2009</h2><P>So the question I would have is "Why are the properties changing?"</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Tuesday, September 15, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>bcrowell:</strong></div><div>when I bind the datasource to the DevExpress datagrid that some properties are changed and thus everything becomes dirty. </div></BLOCKQUOTE><br><br>One thing to note is that I don't think setting a property to the
same value it had previously causes a business object to become dirty
in CSLA.&nbsp; (I just tested this in our code by re-typing the existing value for
a field over the existing value for that field in both a text box and
the grids, and the record didn't become dirty.)&nbsp; That would strongly
suggest that the data in your collection is actually changing and therefore the collection is correctly reporting that it is dirty.<br>

<br>Which properties go dirty, is it all of them or just some, and if so what is common to the dirty ones (i.e. are they all combos, dates, nullable types etc?).<br><br>
That should be easy enough to test, just look at the values of the
collection before and after stage 2 (in your earlier post) and see if
they are definitely still the same.&nbsp; If not, as Fintanv says, what's
changed and why is the key question.<br>

<br>Could this be an issue with how the grid is handling null values in your collection?&nbsp; We use the infragistics grids and nulls can be problematic.&nbsp; If  for example you havea dropdown list (i.e. one where the value of the underlying field must match an entry in the list) and the value in the underlying field is a null, but the list doesn't allow a null, then the list can sometimes change the value of the underlying field (because null isn't an entry the list permits).&nbsp; This will obviously cause the collection to become dirty.<br><br>Other potential null issues are what the grid (or the editor controls within the grid) do when they encounter a null value, in the Infragistics grids you can set what value the editor controls set for a 'null' value (e.g. empty string, null, dbnull, etc) - is there any chance that the grid could be swapping the types of your nulls and causing a change to the data.&nbsp; That can be hard to spot as at first glance it doesn't look like the data has changed.<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
