<html><header><title>CSLA  .NET 4.1.0 C# WIndows Application is tool slow</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA  .NET 4.1.0 C# WIndows Application is tool slow</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10104.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Raghav posted on Friday, February 25, 2011</h2><p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Dear All,</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">I have developed a multi-tier windows application. I have few transactions where it would take more than 2~3 minutes on saving of data, I am using stored procedure where I am trying to create multiple rows on single transaction. <span style="mso-spacerun:yes;">&nbsp;</span></span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Earlier I was getting SQL client time out error, so I have increased timeout in connection string (app.config file). </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Then I was getting CSLA transaction timeout error, so I have increased data context&rsquo;s command timeout in all the places where I am calling Fetch, Insert or Update. (My problem was not solved at this point)</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Then I have increased transaction timeout in app.config file. So my transaction timeout problem had been sorted out.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">But my application became too slow. <span style="mso-spacerun:yes;">&nbsp;</span>Even fetching, inserting or updating of small amount of data (very simple data, like fetching single row) also taking too much of time.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="font-size:small;"><span style="font-family:Calibri;">Development environment:</span></span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Framework: Microsoft .NET 4.0</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">CSLA.NET: 4.1.0</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Language: C#</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Reporting Tool: Crystal Reports</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Controls: Infragistics 2010 Vol 3</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="font-size:small;"><span style="font-family:Calibri;">Client Machine Hardware and Software information:</span></span></span></b></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Laptop: HP Mini</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Processor: Intel&reg; Atom&trade; CPU N450 @ 1.6GHz<span style="mso-tab-count:1;">&nbsp;&nbsp;&nbsp; </span>1.67 GHz</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Memory: 2.00 GB</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">System Type: 32- bit</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">OS: Windows 7 </span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">DB: SQL Server 2008 R2 Express with Advanced Services.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="font-size:small;"><span style="font-family:Calibri;">Connection String:</span></span></span></b></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:Consolas;color:red;font-size:9.5pt;">name</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:Consolas;font-size:9.5pt;">&quot;<span style="color:blue;">MyDb</span>&quot;<span style="color:blue;"> </span><span style="color:red;">connectionString</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Data Source=.;Initial Catalog=MyDb;Integrated Security=SSPI;Connect Timeout = 600;</span>&quot;<span style="color:blue;"> </span><span style="color:red;">providerName</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">System.Data.SqlClient</span>&quot;<span style="color:blue;"> /&gt;</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="font-size:small;"><span style="font-family:Calibri;">Command Timeout:</span></span></span></b></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;">ctx.DataContext.CommandTimeout = 600;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><b style="mso-bidi-font-weight:normal;"><span style="text-decoration:underline;"><span style="font-size:small;"><span style="font-family:Calibri;">Transaction Timeout:</span></span></span></b></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">system.transactions</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:Consolas;font-size:9.5pt;"></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">defaultSettings</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:Consolas;color:red;font-size:9.5pt;">timeout</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:Consolas;font-size:9.5pt;">&quot;<span style="color:blue;">00:30:00</span>&quot;<span style="color:blue;"> /&gt;</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp; </span>&lt;/</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">system.transactions</span><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&gt;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;"><span style="mso-spacerun:yes;">&nbsp;</span>I have 30 forms at present in my application, it would increase later on. </span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Could anyone please help me out to increase the performance of my application. It is too slow now, it takes too much time to fetch, insert and update even small amount of data.</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Thanks in advance</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">Raghav</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Friday, February 25, 2011</h2><p>A fetch would not normally have a transaction attribute on it, and since you&#39;ve mentioned this is a multi-tier application I assume you are using some form of application server, assuming that any time-outs that you are getting would be better traced back to that.</p>
<p>Can you advise if you are running this using an application server, and if so what sort of server (IIS, WCF, etc)?</p>
<p>What sort of object are giving you the most problem, we&#39;ve had some problems with really massive lists causing timeout issues (e.g &gt;= 10,000 children items) but these are rare and other than the odd database performance issue or a really massive object with MANY children haven&#39;t ran into many transaction issues. Is this a list object causing you grief or a root level object with any or many children?</p>
<p>Before we can assist any further, need a bit more information about the objects themselves rather than system specs (though they may come in handy later)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Raghav replied on Friday, February 25, 2011</h2><p>Currently i am not using any application server, both db server and application&nbsp;installed on&nbsp;client system. (SQL server 2008 R2 Express)</p>
<p>I am using 4 databases in my application. Its working fine with other&nbsp;3 databases, like fetching, inserting, updating are too fast in other databases (db size is around 150 MB)</p>
<p>But, i am getting problem in 4th db (db size is approx 650 MB), like fetching, inserting, and updating are too slow. like fetching would take 2~3 minutes or more, even if it is small amount of data.</p>
<p>Actually the db server and application both run on client machine, because client will work stand by (individually, without network, or offline) later on they replicate with main server, &nbsp;and later on this application will act as multi tier application where db sever, and application server will be configured and stand by client remain same.</p>
<p>As i know this may not be the problem of application, this could be the DB issue. </p>
<p>I am using SQL Server 2008 R2 Standard 64bit edition on Server and SQL Server 2008 R2 Express 32bit edition on client machine, and i am using merge replication</p>
<p>Client mahcine OS : Windows 7, XP</p>
<p>Server OS : Windows Server 2008 R2</p>
<p>Thanks</p>
<p>Raghav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vinodonly replied on Saturday, February 26, 2011</h2><p>try 2 things&nbsp;:-</p>
<p>1. Reduce the connection time out to something like 120 or less.. Do you need 600 for all queries, i doubt.. if it is for selective queries/updations then change ur code accordingly.</p>
<p>2. For all fetch operations wherever you are sure you don&#39;t need to update db. use <span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">
<p>Enlist=false</p>
</span></span></span></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Saturday, February 26, 2011</h2><p>Have you done any profiling to see where the application is slowest?&nbsp; That would give you the best answer.</p>
<p>However, you indicate that data portal related operations are slow.&nbsp; This may be because your application is in 2-tier mode and database communications are often &quot;chatty.&quot;&nbsp; One thing to try would be setting up an application server (IIS on the database server) where all of your data portal code will run (as opposed to the client).&nbsp; This would reduce the network use down to two steps; on to serialize the Csla objects to send the the server, and one back.&nbsp; The DB may be doing much more back and forth.&nbsp; Be sure to enable compression to minimize the amount of data transmitted as well.</p>
<p>On the server side things can improve too; since the code actually talking to the database is on the same physical machine, all the database chatter will be done via a direct memory connection (i.e., the connection can use Shared Memory instead of tcp/ip).&nbsp; </p>
<p>Also, I&#39;d certainly profile your stored procedure as it shouldn&#39;t be taking that long to generate a few rows.&nbsp; Profile all interactions with the db actually; your updates in&nbsp;a multi-user environment maybe commonly be getting stuck into deadlocks.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
