<html><header><title>Binding IsValid with DataGridView</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Binding IsValid with DataGridView</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/838.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai posted on Monday, August 07, 2006</h2><P>We have a hit a slightly annoying problem where we want to enable/disable a form's Save button based on whether or not the collection object bound to it is valid or not.&nbsp; With a non-collection object this is a simple case of using the CurrentItemChanged event and code such as </P>
<P>btnSave.Enabled = myObject.IsValid;</P>
<P>Even better is that you can set your bound control's Data Source Update Mode to trigger the event on PropertyChanged rather than on Validation - meaning that the Save button reacts straight away to an edit rather than having to tab out of the control for the button to update.&nbsp; With a DataGridView you can delete the content of a cell thus violating a validation rule that says the field concerned is required.&nbsp; But the CurrentItemChanged event will not fire until the user presses enter or clicks another cell,&nbsp; and this means the user can click Save when the object is not valid.&nbsp; I realise we can easily check the objects state within the code behind the save button, but it is so much better to be able to disable the button the moment the object becomes not Valid.&nbsp; There doesn't seem to be a way to set the Data Source Update Mode for a DataGridView, so is there some other solution?&nbsp; </P>
<P>TIA</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 07, 2006</h2>Maybe there's an event on the grid itself that you can use to know when the value has changed? But I'm guessing that the user-entered value doesn't get put into the data source until they change cells, so even that may be problematic...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steve Graham replied on Tuesday, June 17, 2008</h2><P>Hi everyone,</P>
<P>I spent several hours trawling forums and threads in an attempt to solve this one. Now I have something that appears to work, thought that I would share the solution, in view of all of the help that this forum has given me.</P>
<P>The solution applies to VS2005 with SP1 and CSLA 2.1.4. Haven't tested yet with VS2008 or CSLA 3.0 and above. Initially I went down the wrong road of&nbsp;attempting to change&nbsp;the data source update mode for the datagridview to OnPropertyChanged, soon realising that&nbsp;the mode applies to properties&nbsp;at the grid level, and not on individual&nbsp;rows, columns and cells. In particular I wanted to enable/disable command&nbsp;buttons when&nbsp;a list became dirty/invalid.</P>
<P>The first step is to code the ListChanged event of the binding source control in a similar fashion to Rocky's article <A href="http://www.lhotka.net/Article.aspx?area=4&amp;id=5faaee8e-8496-4845-86f7-787c6b64096c"><FONT color=#99aa99>http://www.lhotka.net/Article.aspx?area=4&amp;id=5faaee8e-8496-4845-86f7-787c6b64096c</FONT></A>.</P>
<P><SPAN><SPAN>&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Private</SPAN> <SPAN>Sub</SPAN> bdgAccountClosedReasons_ListChanged( _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>ByVal</SPAN> sender <SPAN>As</SPAN> <SPAN>Object</SPAN>, _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>ByVal</SPAN> e <SPAN>As</SPAN> System.ComponentModel.ListChangedEventArgs) _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Handles</SPAN> _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>bdgAccountClosedReasons.ListChanged<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>If</SPAN> AccountClosedReasons.CanEditObject <SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>DisableControls()<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Else<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>Throw</SPAN> <SPAN>New</SPAN> System.Security.SecurityException( _<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>"User not authorized to edit an account closed reason"</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN><SPAN><SPAN>&nbsp;&nbsp;&nbsp; </SPAN><SPAN>End</SPAN> <SPAN>Sub</SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN></SPAN></SPAN>&nbsp;</P>
<P class=MsoNormal><SPAN><SPAN><FONT face="Times New Roman" color=#000000 size=3>The next step is to use the CurrentCellDirtyStateChanged event of the datagridview to&nbsp;allow an immediate update to the underlying datasource.&nbsp;Credit for this&nbsp;goes to one particular&nbsp;MS forum thread that I am still trying to relocate <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />. The handling of atomic operations (checkbox/combobox) is straightforward, but I have four validation rules that I wanted to trigger&nbsp;on&nbsp;a text field in the grid, particularly the&nbsp;StringRequired rule. I wanted the OK/Apply buttons to become enabled as soon as user entered a value.&nbsp;The solution that seems to work&nbsp;follows:</FONT></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN></SPAN></SPAN>&nbsp;</P><SPAN><SPAN>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>Private</SPAN><FONT color=#000000> </FONT><SPAN>Sub</SPAN><FONT color=#000000> dgvEditAccountClosedReasonList_CurrentCellDirtyStateChanged( _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>ByVal</SPAN><FONT color=#000000> sender </FONT><SPAN>As</SPAN><FONT color=#000000> </FONT><SPAN>Object</SPAN><FONT color=#000000>, _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>ByVal</SPAN><FONT color=#000000> e </FONT><SPAN>As</SPAN><FONT color=#000000> System.EventArgs) _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>Handles</SPAN><FONT color=#000000> _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>dgvEditAccountClosedReasonList.CurrentCellDirtyStateChanged<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><o:p><FONT color=#000000>&nbsp;</FONT></o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>If</SPAN><FONT color=#000000> dgvEditAccountClosedReasonList.IsCurrentCellDirty </FONT><SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>If</SPAN><FONT color=#000000> </FONT><SPAN>TypeOf</SPAN><FONT color=#000000> dgvEditAccountClosedReasonList.CurrentCell </FONT><SPAN>Is</SPAN><FONT color=#000000> DataGridViewCheckBoxCell _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>Or</SPAN><FONT color=#000000> </FONT><SPAN>TypeOf</SPAN><FONT color=#000000> dgvEditAccountClosedReasonList.CurrentCell </FONT><SPAN>Is</SPAN><FONT color=#000000> DataGridViewComboBoxCell </FONT><SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>' Commit the changes to the data source.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>dgvEditAccountClosedReasonList.CommitEdit( _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>DataGridViewDataErrorContexts.Commit)<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>ElseIf</SPAN><FONT color=#000000> </FONT><SPAN>TypeOf</SPAN><FONT color=#000000> dgvEditAccountClosedReasonList.CurrentCell </FONT><SPAN>Is</SPAN><FONT color=#000000> DataGridViewTextBoxCell </FONT><SPAN>Then<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>' Temporarily halt events raised from data changes.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>bdgAccountClosedReasons.RaiseListChangedEvents = </FONT><SPAN>False<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>' Commit the changes to the data source.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>dgvEditAccountClosedReasonList.CommitEdit( _<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>DataGridViewDataErrorContexts.Commit)<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>' Manually call the event method to enable/disable command buttons.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>bdgAccountClosedReasons_ListChanged(</FONT><SPAN>Nothing</SPAN><FONT color=#000000>, </FONT><SPAN>Nothing</SPAN><FONT color=#000000>)<o:p></o:p></FONT></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>' Re-enable binding source events.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><FONT color=#000000><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>bdgAccountClosedReasons.RaiseListChangedEvents = </FONT><SPAN>True<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>End</SPAN><FONT color=#000000> </FONT><SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>End</SPAN><FONT color=#000000> </FONT><SPAN>If<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN><SPAN><FONT color=#000000>&nbsp;&nbsp;&nbsp; </FONT></SPAN><SPAN>End</SPAN><FONT color=#000000> </FONT><SPAN>Sub</SPAN></SPAN></P>
<P class=MsoNormal><FONT face="Times New Roman" color=#000000 size=3>I am approaching this with a certain amount of trepidation as I am aware that I am effectively validating a text field on every keypress. However, in my favour is the fact that my object is small, six&nbsp;business properties only (four of which are readonly), with a total of only four validation rules, all on the text field.&nbsp;In&nbsp;the real world I would not expect&nbsp;more than a couple dozen records in the list. So far testing has not revealed any perceptible slow down in responsiveness to keypresses, though I would hesitate before applying the solution to larger, more complex business objects.</FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" color=#000000 size=3></FONT>&nbsp;</P>
<P class=MsoNormal><FONT face="Times New Roman" color=#000000 size=3>Steve</FONT></SPAN></SPAN></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
