<html><header><title>Selective Addition of Business Rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Selective Addition of Business Rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8742.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MadGerbil posted on Tuesday, March 30, 2010</h2><p>I&#39;ve an object that comes in two varieties.<br /><br />Both varieties use about 50 business rules and they share about 40 of them. I&#39;d like to be able to load up the business rules selectively, based upon a property value, however the business rules are added before any object properties are loaded, that is, during hte intialization of the base class.<br /><br />Is there a way to load the object first (property values), then add the rules, and then check them?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Tuesday, March 30, 2010</h2><p>Just off the top of my head, you could create a base class (inheriting from BusinessBase&lt;T&gt;) and create 2 subclasses, each one overriding AddBusinessRules().&nbsp; </p>
<p>Don&#39;t forget to call base.AddBusinessRules()!</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, March 30, 2010</h2><p>The idea behind the rules system is that you&#39;d load the 50 rules, and the rules would be smart enough to adapt to the state of the object.</p>
<p>In other words, rather than making the process of adding rules smarter, make the rules themselves smarter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MadGerbil replied on Tuesday, March 30, 2010</h2><p>Yeah, I was afraid I&#39;d have to do that, but it does seem to be the very best answer.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, March 30, 2010</h2><p>I agree with Rocky on this for the most part, except that I really did find what I think is a use case for the per instance rules that the per type rules don&#39;t handle well at all. </p>
<p>I also found the per-instance rules were added by the base class constructuctor. which as you noted means you can&#39;t use property values to decide what rules to add.&nbsp; It turns out, however, that you can add&nbsp;your own&nbsp;instance rules &quot;later&quot; and it works well for the most part.&nbsp; </p>
<p>There are some gotchas, though. If you are using a remote data portal, the rules don&#39;t get serialized across with the object. Instead, it calls InitializeBusinessRules() again in OnDeserializedHandler(), so you have to plan for this if it matters in your particular case. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, March 30, 2010</h2><p>For better or worse however, per-instance rules will not be in CSLA 4. On the upside, the new flexibility in the rules system should allow for &quot;gate rules&quot; - a rule that evaluates whether to allow some other rule to run, thus acting as a gate. It is one application of the broader concept of rule chaining, where one rule can invoke other rules, consolidating the results and returning them to the framework when complete.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, March 30, 2010</h2><p>^^^^ </p>
<p>I think I could safely refactor my current implementation to use a different derived class for the special cases where I need instance rules. I actually know what rules are needed at the time the object is constructed, so this would be a straightforward (if only slightly tedious) transformation. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MadGerbil replied on Tuesday, March 30, 2010</h2><p>I tried creating a AddBusinessRulesAfterLoad() method which gets called after the business object is loaded. Inside of that I call base.AddBusinessRules() but for some reason only the first object in the collection gets it&#39;s rules loaded.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, March 30, 2010</h2><p>I have an object that comes in three varieties and share numerous rules. A few years ago I did something like this:</p>
<p>1. Place as many common rules as possible in the base class.</p>
<p>2. Inherit the final type for the 1stBO&nbsp;from the base class and then use code like this:</p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Protected</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Overrides</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Sub</span></span><span style="font-size:x-small;">&nbsp;AddBusinessRules()<br /></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">&nbsp; MyBase</span></span><span style="font-size:x-small;">.AddBusinessRules()<br /></span><span style="font-size:x-small;"><br />&nbsp; </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">If</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">TypeOf</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Me</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Is</span></span><span style="font-size:x-small;"> 2ndBO </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">OrElse</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">TypeOf</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Me</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Is</span></span><span style="font-size:x-small;"> 3rdBO </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Then<br />&nbsp;&nbsp;&nbsp; </span></span><span style="color:#008000;font-size:x-small;"><span style="color:#008000;font-size:x-small;">&#39;Do not add 1stBO Type rules<br />&nbsp; </span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Else<br />&nbsp;&nbsp;&nbsp; </span></span><span style="color:#008000;font-size:x-small;"><span style="color:#008000;font-size:x-small;">&#39;Add more rules here that are just for 1stBO type<br />&nbsp; <span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">End If<br /><br /></span></span></span></span><span style="color:#008000;font-size:x-small;"><span style="color:#008000;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">End Sub<br /></span></span><br /></span></span></span></span><span style="font-size:x-small;">3. Inherit the 2nd and 3rd BO types from the 1stBO type. Then they can have code like this:</span></p>
<p><span style="font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">
<p>Protected</p>
</span></span><span style="font-size:x-small;"></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Overrides</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Sub</span></span><span style="font-size:x-small;"> AddBusinessRules()<br />&nbsp; </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">MyBase</span></span><span style="font-size:x-small;">.AddBusinessRules()<br /><br />&nbsp; <span style="color:#008000;font-size:x-small;"><span style="color:#008000;font-size:x-small;">&#39;Add more rules here that are just for 2nd or 3rd BO types.<br /></span></span><br /><span style="color:#0000ff;">End Sub</span></span></span></span></span><span style="font-size:x-small;">
<p><span style="font-size:x-small;"><br />Notice that by inheriting from the 1st BO type the 2nd and 3rd types get the common rules only. They do not get the rules that are specific to the 1st BO type due to the line that reads:&nbsp;&nbsp; <span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">If</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">TypeOf</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Me</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Is</span></span><span style="font-size:x-small;"> 2ndBO </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">OrElse</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">TypeOf</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Me</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Is</span></span><span style="font-size:x-small;"> 3rdBO </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">Then<br /></span></span></span></p>
</span></span>
<p><span style="font-size:x-small;"><br />This trick worked correctly because it relied on the type of the BO (not the value of a Property which has not been loaded yet.) So these are still per type rules, not Instance rules.</span></p>
</p>
<p>
<p><span style="font-size:x-small;">Joe</span></p>
</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
