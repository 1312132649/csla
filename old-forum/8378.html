<html><header><title>Editable Root Collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Editable Root Collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8378.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>st3fanus posted on Tuesday, January 19, 2010</h2>Hi All...<br><br>I've tried to create two classes : <b>Editable Root Collection</b> and their child But in my case i make that <b>child class as ROOT </b>Object. I'm sorry about my post which is too long before :)<br><br>Editable Root Collection : <b>TableList</b><br>Root Object : <b>Table </b>which is <b>child </b>of <b>TableList</b>, BUT the scenario is below :<br>I need to create a lot of Table object once --&gt; So I used DataPortal_Create() in TableList to create them.<br><br>After retrieved Tables object and manipulated those table object, I need to save them all in once click.<br><br>My Decision in this situation is : I create DP_Create(), DP_Fetch(), DP_Insert(), DP_Update(),DP_Delete() so I suppose Table&nbsp; as Root Object although it's Child of TableList ( I choose this way because I still not found a way to save Table object as Child under TableList), And then I HAVE TO OVERRIDE DP_UPDATE() on TableList object (cause i have tried to save them without override but error)<br><br>Is there any another solution which is better than I choose OR may be any feed back about my decision ??<br>Is My Decision is suitable with Csla Stereotype is created for ?? ( Or Is any another suitable stereotype?)<br><br>Thanks a lot <br><br>Stefanus<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Tuesday, January 19, 2010</h2>Hi Stefanus,<br /><br />I've not seen your previous post(s), but I think you may be getting confused as to how to when to use the EditableRootCollection. This is specifically designed to handle saving each item directly within a grid as the user makes changes and then moves away from a row. In this scenario you cannot think of the Root object as a child as it does behave like one, the normal Save() method is called on the object to perform it's save and call the standard DP methods as required.<br /><br />Because you want to save all the items that have been created / edited at once you need to create a class that inherits from BusinessListBase and within that class you will override the DP_Create() method just like you've done and then will probably override DP_Update to add the transactional attribute, open your connection and depending on which version of CSLA you are using will do one of the following:<br /><br />If you are on CSLA 3.2 or above (from memory) create Child_Insert, Child_Update, Child_Delete methods on the child object and then within you DP_Update in the list call Mybase.ChildUpdate()<br /><br />If you are on an older version of CSLA then you will need to create your own methods on the child object and then call them manually as you loop through the deletedList and then through the items within the list and check if they need to be inserted/updated.<br /><br />I would recommend either getting the latest CSLA training videos as they go into explaining how to do all of the above and when to use each business stereotype; the other option is the Expert Business Object book, which is an excellent resource but the videos are much easier to absorb especially if you are new to the framework.<br /><br />If you need any other assistance, please feel free to email me directly at john.kennison@sybiz.com and can send you an example; just not at work at the moment.<br /><br />John</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>st3fanus replied on Tuesday, January 19, 2010</h2>Hi John..<br>I'm very appreciate your respond and your welcome for me.. :)<br>I used Csla 3.7<br><br>Yes I'm still confuse to use Csla correctly... I just have Business Object Book 2008 but i don't have video (I don't have enough money to buy it now :(<br><br>Sorry John I have wrote a mistake in my post probably..<br>What I mean with Editable Root Collection is same as what you suggest to me ( I take Editable Root Collection term from Business Object Book 2008 page 187 , as stereotype terms that Csla is support.)<br><br><font color="#0000ff">"Because you want to save all the items that have been created / edited
at once you need to create a class that inherits from BusinessListBase
and within that class you will override the DP_Create() method just
like you've done and then will probably override DP_Update to add the
transactional attribute, open your connection and depending on which
version of CSLA you are using will do one of the following:
</font><br><font color="#0000ff">If you are on CSLA 3.2 or above (from memory) create Child_Insert,
Child_Update, Child_Delete methods on the child object and then within
you DP_Update in the list call Mybase.ChildUpdate()
</font>"<br><br>I acctually want to do this way first, but&nbsp; I don't know a way to called Child_Insert, Child_Update, Child_Delete from my TableList which is inherit from BusinessListBase as you suggest for me ( call MyBase.ChildUpdate() ) So I force my design to change my Table class to act as a Root that become a child of TableList. So within my Table class I implement DP_Create, DP_Fetch,DP_Insert, DP_Update, DP_Delete. And then in TableList within DP_Update() I call :<br><br>This Code is located in Table Class :<br><font color="#0000ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000ff"> protected override void&nbsp; DataPortal_Update()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int _noT = ReadProperty(NoProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string _nameT = ReadProperty(NameProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; short _floorT = ReadProperty(FloorProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (var ctx = ConnectionManager&lt;SqlConnection&gt;.GetManager("Resto_DB"))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (TableDal dal = new TableDal(ctx))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dal.UpdateTable(new TableDTO(_noT, _nameT, _floorT));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font><br><br>This Code is Located In TableList:<br><font color="#0000ff">[Transactional(TransactionalTypes.TransactionScope)]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Update()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Table tbl in this)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tbl.Save();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font><br><br>Sorry John I just want to get a confirmation ChildUpdate() you wrote above , Is it Child_Update() ?<br>Am I really can contact you privately ? :)<br><br>Thanks a lot John&nbsp; about your respond and your welcome :)<br><br><br>stefanus <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Wednesday, January 20, 2010</h2>You can feel free to contact me privately if you'd like, but have made some changes below. I apologize that the formatting isn't very nice. The Child_Insert, Child_Update, Child_Delete methods are just methods that you create yourself and are called on your behalf by the parent list (TableList) .<br /><br />This Code is located in Table Class :<br />        internal void Child_Update()<br />        {<br />            int _noT = ReadProperty(NoProperty);<br />            string _nameT = ReadProperty(NameProperty);<br />            short _floorT = ReadProperty(FloorProperty);<br />            using (var ctx = ConnectionManager.GetManager("Resto_DB"))<br />            {<br />                using (TableDal dal = new TableDal(ctx))<br />                {<br />                    dal.UpdateTable(new TableDTO(_noT, _nameT, _floorT));<br />                }<br />            }<br />        }<br /><br />This Code is Located In TableList:<br />[Transactional(TransactionalTypes.TransactionScope)]<br />        protected override void DataPortal_Update()<br />        {<br />             using (var ctx = ConnectionManager.GetManager("Resto_DB"))<br />            {<br />                base.ChildUpdate()<br />            }<br />        }<br /><br />An object that is marked as a child can never be saved with a call like tbl.Save(), the framework will not allow it. The above example, will only allow an object to be updated, never actually inserted or considered new. This may be perfectally fine for your application, but should be highlighted none the less.<br /><br />Depending on how you are creating your table objects to begin with you may have code similar to this:<br /><br /><br />This Code is located in Table Class :<br />        protected override void  Child_Fetch()<br />        {<br />           //do whatever you need to as part of your fetch<br />        }<br /><br />This Code is Located In TableList:<br />        protected override void DataPortal_Create()<br />        {<br />            //This is not a complete example, do you use verbatim<br />            using (var ctx = ConnectionManager.GetManager("Resto_DB"))<br />            {<br />                this.Add(DataPortal.FetchChild<Table>())<br />            }<br />        }<br /><br />The important part is the use of the DataPortal.FetchChild which will call your Child_Fetch method on the Table object and return (and you can provide paramaters if required).</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
