<html><header><title>upgrading from Csla 3.8.2 to 4.0 using Silverlight 4 and VB</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>upgrading from Csla 3.8.2 to 4.0 using Silverlight 4 and VB</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9394.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie posted on Tuesday, August 17, 2010</h2><p>im watching the CSLA 4 MVVM video series. i need to build a silverlight app similar to the one shown in the CSLA .NET for Silverlight video series in VB using wcf to access data on our server. trying to use the .Client, .Server and DataAccess project approach but not too sure what Csla Dlls to use in each project. what i did so far is put the Client Dlls in the DataAccess and .Server projects. the Silverlight Dlls in the .Client and Silverlight projects. and the Server Dlls in the .Web project. all this is being done in VS 2010, Silverlight 4 and Csla 4.</p>
<p>when i run the app if fails at the EmployeeEdit.Client.vb class at db.BeginCreate()</p>
<p>Public Shared Sub GetEmployeeEdit(ByVal callback As EventHandler(Of DataPortalResult(Of EmployeeEdit)))<br />&nbsp;&nbsp; Dim db = New DataPortal(Of EmployeeEdit)<br />&nbsp;&nbsp; AddHandler db.CreateCompleted, callback<br />&nbsp;&nbsp; db.BeginCreate()<br />End Sub</p>
<p>i get this error</p>
<p>System.InvalidOperationException was unhandled by user code<br />&nbsp; Message=Could not find default endpoint element that references contract &#39;WcfPortal.IWcfPortal&#39; in the ServiceModel client configuration section. This might be because no configuration file was found for your application, or because no endpoint element matching this contract could be found in the client element.<br />&nbsp; StackTrace:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.Description.ConfigLoader.LoadChannelBehaviors(ServiceEndpoint serviceEndpoint, String configurationName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ChannelFactory.ApplyConfiguration(String configurationName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ChannelFactory.InitializeEndpoint(String configurationName, EndpointAddress address)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ChannelFactory`1..ctor(String endpointConfigurationName, EndpointAddress remoteAddress)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.EndpointTrait`1.CreateSimplexFactory()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.EndpointTrait`1.CreateChannelFactory()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.CreateChannelFactoryRef(EndpointTrait`1 endpointTrait)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.InitializeChannelFactoryRef()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ServiceModel.ClientBase`1..ctor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient..ctor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.GetProxy()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.BeginCreate()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortal`1.BeginCreate()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Demo.EmployeeEdit.GetEmployeeEdit(EventHandler`1 callback)<br />&nbsp; InnerException:</p>
<p>after getting this i changed the endpoint contract in the ServiceReferences.ClientConfig from contract =&quot;Csla.WcfPortal.IWcfPortal&quot; to contract =&quot;WcfPortal.IWcfPortal&quot; </p>
<p>when i run it like this the Visual Studio Just-In-Time Debugger comes up stating &quot;An unhandled exception (&#39;Unhandled Error in Silverlight Application Code:4004 Category: ManagedRuntimeError Message: System.Reflection.targetInvocationException: An exception occurred during the operation, making the result invalid. Check&quot;. i cant use any of the Possible Debuggers. it just states &quot;Unable to attach to the crashing process. A debugger is already attached. i do get this error in IE.</p>
<p>Webpage error details</p>
<p>User Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E)<br />Timestamp: Tue, 17 Aug 2010 21:01:05 UTC</p>
<p>Message: Unhandled Error in Silverlight Application <br />Code: 4004&nbsp;&nbsp;&nbsp; <br />Category: ManagedRuntimeError&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />Message: System.Reflection.TargetInvocationException: An exception occurred during the operation, making the result invalid.&nbsp; Check InnerException for exception details. ---&gt; System.ServiceModel.CommunicationException: An error occurred while trying to make a request to URI &#39;http://localhost:5678/DemoService.svc&#39;. This could be due to attempting to access a service in a cross-domain way without a proper cross-domain policy in place, or a policy that is unsuitable for SOAP services. You may need to contact the owner of the service to publish a cross-domain policy file and to ensure it allows SOAP-related HTTP headers to be sent. This error may also be caused by using internal types in the web service proxy without using the InternalsVisibleToAttribute attribute. Please see the inner exception for more details. ---&gt; System.Security.SecurityException ---&gt; System.Security.SecurityException: Security error.<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.&lt;&gt;c__DisplayClass5.&lt;EndGetResponse&gt;b__4(Object sendState)<br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.&lt;&gt;c__DisplayClass2.&lt;BeginOnUI&gt;b__0(Object sendState)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelAsyncRequest.CompleteGetResponse(IAsyncResult result)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.ServiceModel.AsyncResult.End[TAsyncResult](IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.EndCall(String action, Object[] outs, IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.ChannelBase`1.EndInvoke(String methodName, Object[] args, IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.WcfPortalClientChannel.EndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.Csla.WcfPortal.IWcfPortal.EndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnEndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.OnAsyncCallCompleted(IAsyncResult result)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary()<br />&nbsp;&nbsp; at Csla.WcfPortal.CreateCompletedEventArgs.get_Result()<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_CreateCompleted(Object sender, CreateCompletedEventArgs e)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnCreateCompleted(Object state)&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>Line: 56<br />Char: 13<br />Code: 0<br />URI: <a href="http://localhost:1032/SlDemo_VBTestPage.aspx">http://localhost:1032/SlDemo_VBTestPage.aspx</a></p>
<p>dont know what to do at this point. are there any examples out there?&nbsp;please help!<br />thank you<br />germie</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, August 18, 2010</h2><p>Microsoft changed something in the way the client config file works. Generally, you just need to remove the &quot;Csla.&quot; from the type name of the contract and it should work. Why? Who knows - something quirky between WCF in SL3 and SL4...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Wednesday, August 18, 2010</h2><p>thnx for the reply rocky,</p>
<p>i did try that, then got a different error. did i put the dlls in the right place? are there any code examples?</p>
<p>&nbsp;</p>
<p>&quot;</p>
<p>after getting this i changed the endpoint contract in the ServiceReferences.ClientConfig from contract =&quot;Csla.WcfPortal.IWcfPortal&quot; to contract =&quot;WcfPortal.IWcfPortal&quot; </p>
<p>when i run it like this the Visual Studio Just-In-Time Debugger comes up stating &quot;An unhandled exception (&#39;Unhandled Error in Silverlight Application Code:4004 Category: ManagedRuntimeError Message: System.Reflection.targetInvocationException: An exception occurred during the operation, making the result invalid. Check&quot;. i cant use any of the Possible Debuggers. it just states &quot;Unable to attach to the crashing process. A debugger is already attached. i do get this error in IE.</p>
<p>Webpage error details</p>
<p>User Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E)<br />Timestamp: Tue, 17 Aug 2010 21:01:05 UTC</p>
<p>Message: Unhandled Error in Silverlight Application <br />Code: 4004&nbsp;&nbsp;&nbsp; <br />Category: ManagedRuntimeError&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />Message: System.Reflection.TargetInvocationException: An exception occurred during the operation, making the result invalid.&nbsp; Check InnerException for exception details. ---&gt; System.ServiceModel.CommunicationException: An error occurred while trying to make a request to URI &#39;http://localhost:5678/DemoService.svc&#39;. This could be due to attempting to access a service in a cross-domain way without a proper cross-domain policy in place, or a policy that is unsuitable for SOAP services. You may need to contact the owner of the service to publish a cross-domain policy file and to ensure it allows SOAP-related HTTP headers to be sent. This error may also be caused by using internal types in the web service proxy without using the InternalsVisibleToAttribute attribute. Please see the inner exception for more details. ---&gt; System.Security.SecurityException ---&gt; System.Security.SecurityException: Security error.<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.&lt;&gt;c__DisplayClass5.&lt;EndGetResponse&gt;b__4(Object sendState)<br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.&lt;&gt;c__DisplayClass2.&lt;BeginOnUI&gt;b__0(Object sendState)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.Net.Browser.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)<br />&nbsp;&nbsp; at System.Net.Browser.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelAsyncRequest.CompleteGetResponse(IAsyncResult result)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.ServiceModel.AsyncResult.End[TAsyncResult](IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.Channels.ServiceChannel.EndCall(String action, Object[] outs, IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.ChannelBase`1.EndInvoke(String methodName, Object[] args, IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.WcfPortalClientChannel.EndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.Csla.WcfPortal.IWcfPortal.EndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnEndCreate(IAsyncResult result)<br />&nbsp;&nbsp; at System.ServiceModel.ClientBase`1.OnAsyncCallCompleted(IAsyncResult result)<br />&nbsp;&nbsp; --- End of inner exception stack trace ---<br />&nbsp;&nbsp; at System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary()<br />&nbsp;&nbsp; at Csla.WcfPortal.CreateCompletedEventArgs.get_Result()<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_CreateCompleted(Object sender, CreateCompletedEventArgs e)<br />&nbsp;&nbsp; at Csla.WcfPortal.WcfPortalClient.OnCreateCompleted(Object state)&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>Line: 56<br />Char: 13<br />Code: 0<br />URI: <a href="http://localhost:1032/SlDemo_VBTestPage.aspx"><span style="color:#3366cc;">http://localhost:1032/SlDemo_VBTestPage.aspx</span></a></p>
<p>dont know what to do at this point. are there any examples out there?&nbsp;please help!<br />thank you<br />germie</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Tuesday, August 24, 2010</h2><p>looks like im on my own figuring this one out. a good example ive found is here &quot;<a href="http://www.lhotka.net/cslanet/download.aspx">http://www.lhotka.net/cslanet/download.aspx</a>&quot;. just download the Samples for CSLA Version 4.0.0. the SimpleApp.sln gives you the .Server .Client examples similar to the ones given in the &quot;CSLA .NET for Silverlight video series&quot;. through trial and error ive discovered that the Silverlight Dlls go in to the .Client and the Silverlight projects and the Client Dlls go in the .Server and .Web projects. the naming is a little confusing cause you would think that client would go into client and sever into server. now its just a matter of figuring out how to merge this example with the mvvm example in the &quot;CSLA 4 MVVM video series&quot; and ive got what i need. :)</p>
<p>germie</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, August 24, 2010</h2><p>I&#39;ve mentioned this in a couple threads now, but here&#39;s the layout of the CSLA 4 binaries:</p>
<ul>
<li>\Client
<ul>
<li>Contains .NET assemblies for use in building projects using the Client Profile.</li>
</ul>
</li>
<li>\Server
<ul>
<li>Contains .NET assemblies for use in building server-side projects using the Full Profile - <i>except</i> that it also includes Csla.dll, <i>which is the exact same as the one in the \Client folder</i> - the reason it is here in the \Server folder is because the other server assemblies reference it.</li>
</ul>
</li>
<li>\Silverlight
<ul>
<li>Contains Silverlight assemblies for use in building Silverlight projects.</li>
</ul>
</li>
</ul>
<p>It doesn&#39;t matter if you use the Csla.dll from Client or Server - they are the same. All the other assemblies are different as described above.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Wednesday, August 25, 2010</h2><p>thank you for your explanation.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
