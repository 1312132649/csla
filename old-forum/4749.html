<html><header><title>Need help with WCF DataPortal channel and Authentication</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need help with WCF DataPortal channel and Authentication</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4749.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan posted on Friday, April 25, 2008</h2>Hi!<br><br>I implemented the WCF dataportal channel according to the CSLA 3.0 ebook.<br><br>My app.config contains this:<br><br><font size="2">&nbsp; &lt;appSettings&gt;<br>&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp; &lt;add key="CslaAuthentication" value="Csla" /&gt;<br>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalProxy" value="Csla.DataPortalClient.WcfProxy, Csla"/&gt;<br>&nbsp; &lt;/appSettings&gt;<br></font><br><font size="2">&nbsp;&nbsp;&nbsp; &lt;system.serviceModel&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;client&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;endpoint name="WcfDataPortal"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; address="http://xxx.xxx.xxx.xxx/WcfHost/WcfPortal.svc"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_IWcfPortal"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; contract="Csla.Server.Hosts.IWcfPortal"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/client&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/system.serviceModel&gt;<br></font><br>In addition to the PTracker example I had to add this section, as already shown in some posts <br>(search for <font size="2">maxReceivedMessageSize)</font>:<br><br><font size="2">(The numeric values are copied from a post I found here, saying it would work, so don't ask me...)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;bindings&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;wsHttpBinding&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;binding name="WSHttpBinding_IWcfPortal" closeTimeout="00:01:00"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;bypassProxyOnLocal="false" transactionFlow="false" <br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; hostNameComparisonMode="StrongWildcard"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;maxBufferPoolSize="2147483647" maxReceivedMessageSize="2147483647"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;allowCookies="false"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;readerQuotas maxDepth="32" maxStringContentLength="655360" maxArrayLength="2147483647"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; maxBytesPerRead="4096" maxNameTableCharCount="16384"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;reliableSession ordered="true" inactivityTimeout="00:10:00" enabled="false"/&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;security mode="Message"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;message clientCredentialType="None" negotiateServiceCredential="false" <br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; establishSecurityContext="false" /&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/security&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/binding&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/wsHttpBinding&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/bindings&gt;<br></font><br><br>First question: Is this binding configuration section also needed on the server side (Web.config)?<br><br>What's bothering me ist the &lt;security&gt; section. I don't know how to configure the WcfHost service to accept anonymous client connections. As I see it, the authentication/authorization in the case of the WCF data portal channel is happening on the application level, and not on the WCF configuration level.<br><br>My current situation is this: The WcfHost service only accepts connections from clients where the current Windows user is also available as a local user on the server machine.<br>I already enabled anonymous access to the virtual root directory, but there must be something else.<br>The server is a Windows Server 2003 RC2 fresh installation...<br><br>Any help would be appreciated<br><br>Stefan<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
