<html><header><title>OT:  A Question of Communication</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT:  A Question of Communication</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/190.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai posted on Wednesday, May 24, 2006</h2><P>Hi guys.</P>
<P>This is slightly off topic but I know there is a lot of clever folk hanging around here so I thought I'd bounce it off the forum.&nbsp; This is a long one, so hope someone can be bothered to read it.</P>
<P>We have a requirement to be able to view information about the Csla activity both in respect to the Dataportal XYZ calls on the server and the Dataportal XYZ calls on the client.&nbsp; Fortunately the framework supports this very nicely with some events.</P>
<P>In the client DataPortal we have two events we can hook up to from the UI</P><FONT size=2>
<P>DataPortalInvoke<BR><FONT size=2>DataPortalInvokeComplete</FONT></P>
<P><FONT size=2><FONT size=3>In the server DataPortal we have two events we can catch in our object base classes</FONT></FONT></P><FONT size=2><FONT color=#800000 size=2>
<P><FONT color=#000000>DataPortal_OnDataPortalInvoke<BR><FONT size=2>DataPortal_OnDataPortalInvokeComplete</FONT></FONT></P>
<P><FONT size=2><FONT color=#000000 size=3>This means we could effectively record information about what calls were made and when for both an individual client app on a user's PC and for the server side code for multiple users.&nbsp; I have customised DataPortalEventArgs slightly to pass more information about what method is being processed and what the class of the BO concerned is.&nbsp; So far so good.&nbsp; The question is how to extract this information.&nbsp; </FONT></FONT><FONT color=#800000 size=2><FONT color=#000000 size=3>I don't want just a simple log file, ideally the event data should be extracted to some sort of live viewer so we can see an (almost) real time view of our apps/dataportals.&nbsp; We should like to be able to choose a client app on another PC, connect to it and receive data from the events above.&nbsp; Ideally the connection should trigger the&nbsp;event hookup&nbsp;to start so we don't have a performance hit when not connected.&nbsp; Not entirely sure how to deal with the server side, as the objects reside within IIS.</FONT></FONT></P>
<P><FONT color=#800000 size=2><FONT color=#000000 size=3>I have looked at a number of different technologies so far in terms of the connection to a client app concept.&nbsp; </FONT></FONT><FONT color=#800000 size=2><FONT color=#000000 size=3>First off I looked at TcpListener and TcpClient.&nbsp; This works relatively well, except things get a little complicated if you allow more than one monitor to connect to the same application at once.&nbsp; I also had issues trying to read an object from a network stream.&nbsp; Secondly I looked at remoting with client activated objects, but was put off by Ingo Rammer suggesting in an article in his website that we basically should not use remote delegates - the very concept I was thinking of using to pass the Dataportal event data across.&nbsp; Finally I have been looking at pumping the data into an MSMQ and reading it from there.&nbsp; This has been the best approach so far but I have issues trying to deal with multiple monitors looking at the same queue at the same time.</FONT></FONT></P>
<P><FONT color=#000000 size=3>If anyone has any thoughts on any of these or a different approach to this problem I would love to hear them as I have been fighting with this for over a week and need to make some progress.</FONT></P>
<P><FONT color=#000000 size=3>Many thanks for reading!</FONT></P>
<P><FONT color=#000000 size=3>John.</FONT><FONT color=#800000 size=2></P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gwinsee replied on Wednesday, May 24, 2006</h2><P>Razor,</P>
<P>If you don't mind dipping into the Win32 API (specifically OutputDebugString), you might want to take a look at DebugView from sysinternals.com (<A href="http://www.sysinternals.com/Utilities/DebugView.html">http://www.sysinternals.com/Utilities/DebugView.html</A>).&nbsp; I'm not sure if it will handle multiple client monitors but it's an idea for you to toss around.</P>
<P>- Gwin&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Saturday, May 27, 2006</h2>Hello,<br><br>For our server we use something incredulously simple: RSS. <br><br>Although we do not comply with any standard, we were inspired by the simplicity of this Really Simple Syndication. All logged data is simply made available over a (secured) custom-format xml-feed which can be read extremely easy, it's all plain xml.<br><br>This is not applicable to client apps of course as there is no trivial way to service an RSS feed on an arbitrary client.<br><br>The reason I wanted to mention the above though is because you mention some difficulty with getting your recorded events to remote machines. Maybe consider xml as a carrier? It's all just read-only, right? <br><br>I'm going to think about this some more, maybe I can think of a more elaborate solution which would provide a single way to get the logs both from servers and clients.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Wednesday, June 07, 2006</h2><P>Bayu.</P>
<P>Any further developments here?&nbsp; I am interested in your thoughts on this.&nbsp; How do you output your RSS feed?&nbsp; What I mean is do you always output the feed regardless of whether somone is listening and does this affect performance at all?</P>
<P>John.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rkelley replied on Wednesday, June 28, 2006</h2><P>John,</P>
<P>Are you still working on this or did you find a solution? I am interested in doing the same thing. If you are still working on it maybe two heads will be better than one, if not and you did not find a solution if I continue down this path I will let you know what I find.</P>
<P>Ryan</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 28, 2006</h2><P>I would recommend looking at log4net or Enterprise Library (which has a logging component). Or just directly using the trace/log capabilities of .NET 2.0 itself. If you are using VB, the My namespace includes some nice logging abstractions.</P>
<P>All three solutions offer a great deal of flexibility, since they all work with the concept of a "listener". Your code is the source of log events, and you can hook listeners to the events (with control over what listeners "hear" what events). These listeners might write to a log file, the system event log, MSMQ, whatever.</P>
<P>I like log4net because it is the most mature of the three, and thus has the most pre-existing listeners that you can just use. This includes some listeners that provide centralization through queues, remoting, etc.</P>
<P>In short, why re-invent the wheel when both open-source and Microsoft are hard at work solving the problem?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, June 29, 2006</h2><P>In the end I did write my own custom TraceListener that writes data out to an MSMQ.&nbsp; I looked at log4net but did not have the time to read all the docs and it seemed easier to just do it myself.&nbsp; The only thing that I regret is that I had to modify the Csla code to get more information from the DataPortal events.&nbsp; This makes applying the frequent updates a bit of a pain as I have to merge them in.&nbsp; At present I am using this method to log server side calls only as it was decided that this was the priority.&nbsp; It turned out that this was relatively easy.&nbsp; I have added a webservice to my remote DataPortal that allows me to turn profiling on and off.&nbsp; The service actually adds/removes an instance of my custome tracelistener from the server side process.&nbsp; My custom BO base classes all check for the existence of a specifically named TraceListener before outputting any information.&nbsp; This all works nicely.&nbsp; It is invisaged that it will be extended to monitor the actual client apps at some point.&nbsp; I would certainly be interested in anything you come up with Ryan, as the solution we have is still not ideal.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jurjen replied on Thursday, June 29, 2006</h2><P>Hi,</P>
<P>This type of &nbsp;functionality is standard available in Petar's ActiveObjects extension of CSLA. <BR>Check out :&nbsp;<A href="http://csla.kozul.info/">http://csla.kozul.info/</A></P>
<P>HTH<BR>Jurjen.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, June 29, 2006</h2><P>Hi Jurgen.</P>
<P>Specifically what functionallity are you referring to. I have briefly looked at Active Objects several times but not found anything of particular interest.</P>
<P>John.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jurjen replied on Thursday, June 29, 2006</h2><P><FONT face=Verdana size=2>John,</FONT></P>
<P><FONT face=Verdana size=2>You''re right, this is not documented on the site, but if you search the archives of the old forum on </FONT><A href="http://www.searchcsla.com"><FONT face=Verdana size=2>www.searchcsla.com</FONT></A><FONT face=Verdana size=2> searching for ActiveLog you'll find several references to it. <BR></FONT><FONT face=Verdana size=2><BR>It's some sort of monitor wich shows how much data is being transferred between your app and the dataportal.</FONT></P>
<P><FONT face=Verdana size=2>As I understand it, this feature is implemented in the ActiveTracker application wich you can download from the above mentioned site.<BR></FONT><BR><FONT face=Verdana size=2>Jurjen.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rkelley replied on Thursday, June 29, 2006</h2>Thanks Jurjen, I will look into the ActiveLog a bit further. I am already using ActiveObjects just for other reasons, and I had forgotten it was there.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 29, 2006</h2>




<DIV align=left><SPAN class=619442215-29062006><FONT face=Arial color=#0000ff size=2>I am interested in exactly what extra information you chose 
to put into the args parameter? I realize that the info provided today is very 
minimal, and am open to adding extra info in future 
versions.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=619442215-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=619442215-29062006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, June 29, 2006</h2><P>The info I have added fully describes the call that the DataPortal is processing&nbsp;.&nbsp; The current Csla can let you know through an event (OnDataPortalInvoke &amp; OnDataPortalInvokeComplete) that a DataPortal xyz method has been called and when it has completed, but not what the call was.&nbsp; Stuff like </P>
<P>BusinessObject class<BR>name of the static method that was called<BR>parameters passed in<BR>time the call started</P>
<P>etc</P>
<P>I will attach my modified DataPortalEventArgs class in case you are interested.&nbsp; Some of it may not make sense without seeeing how it is used, but it will give you an idea.&nbsp; The code all seems to work nicely, but is far from production ready and has not been fully tested.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 29, 2006</h2>




<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>That is interesting, thanks.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>I don't think, in the general case, that I'd choose to 
quite follow the same path. Instead, I think I'd rather do less work in the data 
portal itself, and just provide references so you could do more work in your 
OnDataPortal/Complete method implementaitons.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>For instance, rather than stripping the property values out 
of the object, I think I'd rather pass the object reference. That way there's no 
real cost in the case that you don't do anything with that 
data.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>I'm also not keen on walking the stack trace like you do. I 
think there's got to be a better way to find and identify the method that is 
being invoked - one that doesn't require liberal use of the NoInlining attribute 
and the expense of the stack walk.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>But on the whole, I see the value in all the information 
you added and it helps me understand what you are after - thank 
you!</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Thursday, June 29, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> 
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>I'm also not keen on walking the stack trace like you do.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=291044815-29062006></SPAN></div></BLOCKQUOTE></DIV>
<P>Nether am I &lt;g&gt;.&nbsp;</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> </P>
<DIV align=left><SPAN class=291044815-29062006><FONT face=Arial color=#0000ff size=2>I think there's got to be a better way to find and identify the method that is being invoked - one that doesn't require liberal use of the NoInlining attribute and the expense of the stack walk.</FONT></SPAN></DIV>
<P></div></BLOCKQUOTE></P>
<P>As yet I haven't figured out another way to get that information.&nbsp; I'm all ears if someone else can suggest how it could be done.....</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nemaroller replied on Thursday, September 07, 2006</h2>"<span class="291044815-29062006"><font color="#0000ff" face="Arial" size="2">I'm also not keen on walking the stack trace like you do. I 
think there's got to be a better way to find and identify the method that is 
being invoked - one that doesn't require liberal use of the NoInlining attribute 
and the expense of the stack walk."</font></span><br><br>Rocky, Its funny you mention this - because the property get/set examples for a root business class in the CSLA framework make heavy use of NoInlining and forces the framework to use System.Diagnostics.StackTrace to find the property name in a call to CanRead, CanWrite, PropertyHasChanged, etc. The alternative being supplying the literal string name of the property to those methods.<br><br>Which makes me wonder if something is fundamentally flawed about how that's structured. I have concerns about this - and if at some point you did too - I would like to know how or for what reason you calmed those fears.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, September 07, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>nemaroller:</strong></div><div>"<span class="291044815-29062006"><font color="#0000ff" face="Arial" size="2">I'm also not keen on walking the stack trace like you do. I 
think there's got to be a better way to find and identify the method that is 
being invoked - one that doesn't require liberal use of the NoInlining attribute 
and the expense of the stack walk."</font></span><br><br>Rocky, Its funny you mention this - because the property get/set examples for a root business class in the CSLA framework make heavy use of NoInlining and forces the framework to use System.Diagnostics.StackTrace to find the property name in a call to CanRead, CanWrite, PropertyHasChanged, etc. The alternative being supplying the literal string name of the property to those methods.<br><br>Which makes me wonder if something is fundamentally flawed about how that's structured. I have concerns about this - and if at some point you did too - I would like to know how or for what reason you calmed those fears.<br><br></div></BLOCKQUOTE><br><br>Oh, that's easy <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>If you look at the way data binding works in both Windows and Web Forms, you'll find that they make liberal use of various non-performant, but highly flexible and dynamic, technologies - most notably reflection. The overhead of my little System.Diagnostics call is trivial when stacked up against all the other overhead involved in the data binding model...<br><br>Beyond which, I specifically put the overloads that accept the string property name so you can avoid that overhead if desired. And if you are using code generation I absolutely recommend using the string literal overloads, because a code generator won't do a typo like a human coder.<br><br>Now if we had our own programming language, rather than C# or VB, then we could solve this problem. And to some degree, code generators are just fancy compilers, so you can argue that we <i>do</i> have our own language in a sense. And if you use one of these custom langauges, you can avoid the issue.<br><br>But if you want to use a lower-level language like VB or C#, then you have to play by their rules - and so the tradeoff is between maintainability and performance. My default is that maintainability wins unless performance is proven to be a problem...<br><br>The templates in the book are all designed around the idea of a human programmer writing all the code. Since my default priority is maintainability, that's why I use the auto-detecting overloads in the templates and snippets.<br><br>If I implemented a code generator in the book, my code generation templates would use the string literal overloads, because that's the clear choice for code that is not written or touched by human beings.<br><br>But what I'd <i>really</i> like to do (in a universe where I had infinite time) is create a true programming language at a higher level than VB or C#. One where you never have to write that ~14 lines of code per property, but instead just write one line. To me that would be the ideal solution!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nemaroller replied on Thursday, September 07, 2006</h2>Thanks for the reply.<br><br>I personally suggested we drop the NoInlining attribute - mostly because it would not be clear to new developers or developers that would later maintain the code for what reason it was applied - plus the stack inspection hit would be removed.<br><br>Additionally, modifying your DefineACSLAProperty snippet allows designing a snippet that replaces the literals with the property name,&nbsp; the error that would typically be introduced in hand-typing or copy/pasting the property name is eliminated. <br><br>public $PropertyType$ $PropertyName$<br>{<br>&nbsp; get<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; CanReadProperty("$PropertyName$",true) ;<br>&nbsp;&nbsp;&nbsp; return $PrivateVariable$;<br>&nbsp; }<br>&nbsp; set<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; CanWriteProperty("$PropertyName$",true);<br>&nbsp;&nbsp;&nbsp; if (!$PrivateVariable$.Equals(value))<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $PrivateVariable$ = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged("$PropertyName$");<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp; }<br>}<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, September 07, 2006</h2>




<DIV align=left><SPAN class=468000319-07092006><FONT face=Arial color=#0000ff size=2>That's just fine - this is the type of flexibility I built 
into the framework, with the intent that people could make up their own minds 
about which approach to take.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=468000319-07092006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=468000319-07092006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV><BR>
<BLOCKQUOTE>I 
  personally suggested we drop the NoInlining attribute - mostly because it 
  would not be clear to new developers or developers that would later maintain 
  the code for what reason it was applied - plus the stack inspection hit would 
  be removed.<BR><BR>Additionally, since the power of snippets allows designing 
  a snippet that replaces the literals with the property name,&nbsp; the error 
  that would typically be introduced in hand-typing or copy/pasting the property 
  name is eliminated. <BR></BLOCKQUOTE></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
