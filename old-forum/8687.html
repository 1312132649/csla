<html><header><title>conceptual/architectural advice needed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>conceptual/architectural advice needed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8687.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak posted on Thursday, March 18, 2010</h2><p>Hi,</p>
<p>my first CSLA-project&#39;s near to completition and I want to add a &quot;small&quot; functionality which worked out to be a little more complex than thougth at first:</p>
<p>I&#39;s about a tool for user-/permission-management. It knows users, roles and permissions. Users and roles could be edited by users(admins in this case), permissions are fixed, since they are used in the main-apps and therefore only to be defined by the developers. Users can have n-roles and even n-permissions can be assigned to users. It all works and even vice versa (i.e. not only &quot;What roles is a user assigned to?&quot;, but also &quot;Which users are assigned to a certain role?&quot;) A little like PTracker&#39;s Project/ressource relationship, only with three actors.</p>
<p>Now it get&#39;s a little more complex: Permissions could be hierachical. That means, if a user (or role) has the permission &quot;editWidget&quot; he should be granted &quot;viewWidget&quot; automatically. The main apps-application Identity-object reflects that through it&#39;s fetch method, since the called sproc retrieves a list (based on a self-linked table in DB), incorporating the inherited permissions. Now, in the managment app I want to show the users which permissions they EFFECTIVLY assigned to a user when assigning &quot;deleteGadget&quot;. For that it should&#39;nt be afforded to retrieve the self-linked-list from the DB more than once, since it never changes(s.above)!<br />But how to handle this list to the BO&#39;s (without unneccessary db-connects)&nbsp;and how to hook the algorithm to recalc the effective Permissions to the BO? Is it odd to handle the list through the factory methods and give it to the fetch methods thereafter?</p>
<p>Not sure...</p>
<p>Greetings</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Thursday, March 18, 2010</h2><p>I don&#39;t think this will be as simple as you think.&nbsp; But to get an idea of where start, I think <a href="http://www.lhotka.net/weblog/PermissionbasedAuthorizationVsRolebasedAuthorization.aspx">this blog post</a> from Rocky is very useful.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Thursday, March 18, 2010</h2><p>Hi Andy,</p>
<p>thank you for your time.</p>
<p>I know Rocky&#39;s blog post quite well. Unfortunatly this isn&#39;t my problem at all! For authorization/authentification issues I wrap my permissions into the principals IsInRole method, which works fine. Those a/a issues are solved, so no prob over there. Those objects are totally different from those used in the user-management-app (although they retrieve their info from the same db-Table)</p>
<p>In short my prob is how to create a list off hierachical structured elements, in this case all inherited permissions that are implicitly assigned. The linked-list (two fields: permission, inheritedPermission) should be retrieved only once from the db, since it never changes.</p>
<p>Any idea?</p>
<p>Thx for any help.</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, March 20, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>vschaak<br></b></p>
<p>In short my prob is how to create a list off hierachical structured elements, in this case all inherited permissions that are implicitly assigned. The linked-list (two fields: permission, inheritedPermission) should be retrieved only once from the db, since it never changes.</p>
<p></div></p>
<p>So this information is not user-specific, and it needs to be loaded once and cached for the life of the application?</p>
<p>You can use a ReadOnlyBase or ReadOnlyListBase object to get the data and put it into Csla.ApplicationContext.LocalContext if that&#39;s the case.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Sunday, March 21, 2010</h2><p>Hi Rocky,</p>
<p>exactly that&#39;s the way it is! This list definitly never changes, since we (the developers) define the permissions, so that loading it once in a lifetime of the app&#39;s session fits the need.</p>
<p>Are objects, stored in LocalContext accessible from my BO&#39;s directly? Then it would be the right place for the list...</p>
<p>Is there any sample of how to use LocalContext in PTracker or the other app&#39;s you can point me to?</p>
<p>Thanks for answering and greetings over the big pond</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, March 21, 2010</h2><p>LocalContext is much like ASP.NET Session:</p>
<p>Csla.Application.LocalContext is a dictionary that is maintained for you and is globally accessible to all code in your thread (it is stored per-thread, or (I think) in WPF it is per-AppDomain and for sure on Silverlight it is per-AppDomain).</p>
<p>The only thing to watch for is events. If something handles an event from your object, that means your object has a reference to whatever is handling the event. Since your object wiill never go away (because it is in LocalContext), that reference will never go away, which means the listener won&#39;t go away. Obviously this is a horribly easy way to create a memory leak.</p>
<p>So be very careful not to hook any events from the list - either explicitly or implicitly (like through data binding).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Monday, March 22, 2010</h2><p>Hi Rocky,</p>
<p>well, that sounds good (at least at first sight <img src="http://forums.lhotka.net/emoticons/emotion-5.gif" alt="Wink" />). My plan is that there will be a private method in my BO (so not in the never changing list), which references the list, generating the effective list through recursion and writing these to a property in the BO. This method will be hooked to events of the BO, not the list stored in LocalContext.<br />This should work, without danger of creating memory leaks, shouldn&#39;t it?</p>
<p>Unfortunatly PTracker doesn&#39;t include a sample of using this dictonary. What type of objects can be stored there? What to take care of?</p>
<p>Kind regards</p>
<p>Volker</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, March 22, 2010</h2><p>If I remember right it is a Dictionary&lt;string, object&gt;, or maybe &lt;object, object&gt;. So it is pretty standard.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vschaak replied on Sunday, March 21, 2010</h2><p>Hi Dan,</p>
<p>thanks for answering.</p>
<p>Yes, I need a method like this, and it would be private, so it has to populate he ListOfEffectivePermission. It will be executed at fetching and oher events, that changes users roles and/or diectly assigned permissions (which together result in he EffectivePermissions). The implementation of this method should be almost trivial...</p>
<p>Greetings</p>
<p>Volker</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
