<html><header><title>Csla.ApplicationContext.User.Identity.Name blank after page re-direction</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csla.ApplicationContext.User.Identity.Name blank after page re-direction</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6157.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff posted on Wednesday, January 14, 2009</h2>Hi<br />I am having problems with :HttpContext.Current.User.Identity.Name and Csla.ApplicationContext.User.Identity.Name.<br />After logging in to my app they appear to work but once I redirect away from the page after login they are set to blank..<br />I have used the code from Project Tracker global.asx to populate principal/identity.<br /><br />This works okay when I run locally but once the web site is copied to host provider is fails as explained. This is seriously messing up my development - due to go live soon.  Can anyone shed some light on this (I am using csla principal/identity provider as opposed to asp membership provider).<br />Regards<br />Griff</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 14, 2009</h2><P>Did you catch that there's code in global.asax too?</P>
<P>Remember that the web is stateless, so the server forgets everything between page requests. If you don't explicitly restore the principal object on each page request, it won't be there.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff replied on Thursday, January 15, 2009</h2>Hi<br /><br />Rocky, sorry for the delay in reply. I use (I think I meant global.asax) the following code - I assume this loads on every page fetch<br /><br />Protected Sub Application_AcquireRequestState( _<br />    ByVal sender As Object, ByVal e As System.EventArgs)<br /><br />    Dim principal As System.Security.Principal.IPrincipal<br />    Try<br />      principal = _<br />        CType(Session("CslaPrincipal"), System.Security.Principal.IPrincipal)<br /><br />    Catch<br />      principal = Nothing<br />    End Try<br />    <br />    If principal Is Nothing Then<br />      ' didn't get a principal from Session, so<br />      ' set it to an unauthenticted PTPrincipal<br />      ProjectTracker.Library.Security.PTPrincipal.Logout()<br />      <br />    Else<br />      ' use the principal from Session<br />      Csla.ApplicationContext.User = principal<br />    End If<br /><br />As I say it works fine on my pc, simply once uploaded to hosted site it appear not to work.  Am I missing anything else???<br /><br />Richard</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 15, 2009</h2>Hard to say without doing some debugging, etc. Are you sure Session is working properly and actually exists when this code runs?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, January 16, 2009</h2><P>We use a Session State Server.</P>
<P>Whenever we get weird problems like this we first check that the State Server Service is actually running on the server that we just tested the app on. Usually it is off and that is the source of the problem.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff replied on Monday, January 19, 2009</h2>Can you explain Session State Server.  Do you mean to check whether the host server allows sessions objects - if this is what you mean then yes, as far as I can tell, session("myclassobject") works.<br /><br />Richard</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff replied on Monday, January 19, 2009</h2>Hi <br /><br />Managed to sort. Global.asax code was not firing.  I was using VS2008 web deployment project to deploy...this did not create global.asax file in deployment package.  <br />I manually uploaded, still did not work, but then uploaded the App_global.asax.compiled as well and this seems to have sorted it.<br /><br />Thanks<br />Richard</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
