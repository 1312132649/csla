<html><header><title>Dynamic List Base Removing Items Never Calls DataPortal</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamic List Base Removing Items Never Calls DataPortal</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11985.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>thaehn posted on Thursday, May 16, 2013</h2><p>When I remove an item from a Dynamic List, Shouldn&#39;t the Update be called right away?&nbsp; Here is the code from the View Model:</p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">private</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">void</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> OnDeleteSessionConfirmDialogClosed(</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">IMessageBox</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> messageBox)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">if</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> (messageBox.WasSelected(</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">MessageBoxButtons</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">.Yes))</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Model.SessionList.Remove(Session);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p>
<p>I tried to save after it was removed, but the object was marked as busy and I couldn&#39;t apply edits:</p>
</p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">private</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">void</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> OnDeleteSessionConfirmDialogClosed(</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">IMessageBox</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> messageBox)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">if</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> (messageBox.WasSelected(</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">MessageBoxButtons</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">.Yes))</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Model.SessionList.Remove(Session);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Session.ApplyEdit();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Session.BeginSave((o, e) =&gt;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">if</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> (e.Error != </span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">null</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">)</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:Consolas;background:white;color:blue;font-size:9.5pt;mso-highlight:white;">throw</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"> e.Error;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} <span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}); </span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p>
<p>I don&#39;t think I need to do this as the Dynamic List should save automatically...Correct?&nbsp; It does dissappear off the list in the datagrid, but it never disappears from the database...any help would be appreciated!&nbsp; I am using Silverlight 5 with CSLA 4.3 (I believe).</p>
<p>Todd</p>
<p>&nbsp;</p>
</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, May 18, 2013</h2><p>If I remember correctly, the dynamic root list class only triggers insert/update/delete operations due to data binding behaviors, not arbitrary method calls. In other words, to trigger its automatic behavior through code your code will need to simulate normal datagrid method/event calls.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, May 19, 2013</h2><p>No, it&#39;s not just the data binding behaviors. But you must make sure to set the correct metastate of the object. </p>
<p>Look at the code from DynamicListBase:</p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;RemoveItem(<span style="color:blue;">int</span>&nbsp;index)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;item&nbsp;=&nbsp;<span style="color:blue;">this</span>[index];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(item.IsDeleted&nbsp;==&nbsp;<span style="color:blue;">false</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;only&nbsp;delete/save&nbsp;the&nbsp;item&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;new</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(!item.IsNew)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.Delete();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SaveItem(index);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SafeRemoveItem(index);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnSaved(item,&nbsp;<span style="color:blue;">null</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>If the <strong>item.IsNew</strong> is true or item is already deleted then nothing needs to be done - right!</p>
<p>So make sure that your object has the correct metatate and if you override RemoveItem in our implementation make sure to call base.RemoveItem.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>thaehn replied on Tuesday, May 21, 2013</h2><p>I found the solution.&nbsp; I had the Object Factory attribute on the dynamic&nbsp;list object, but not on the business object.&nbsp; The other functions worked, but the removing did not.&nbsp; I use copied the attribute form the dynamic list object to the business object and it worked perfectly:</p>
<p class="MsoNormal" style="line-height:normal;margin:0in 0in 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>[Csla.Server.</span><span style="font-family:Consolas;background:white;color:#2b91af;font-size:9.5pt;mso-highlight:white;">ObjectFactory</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">(</span><span style="font-family:Consolas;background:white;color:#a31515;font-size:9.5pt;mso-highlight:white;">&quot;OagInvoice.OagInvoiceSessionDal&quot;</span><span style="font-family:Consolas;background:white;color:black;font-size:9.5pt;mso-highlight:white;">)]</span></p>
<p>Todd</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
