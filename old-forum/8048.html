<html><header><title>How to make Parent Object invalid if child collection is empty</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to make Parent Object invalid if child collection is empty</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8048.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>shawndewet posted on Thursday, November 26, 2009</h2>In the typical scenario of orderheader having a MyLines Property As OrderDetailCollection.<br /><br />What businessrule can I add to OrderHeader that makes it InValid (for saving) if the count of MyLines = 0?<br />I was thinking along the use of a CommonRules.IntegerMinValue rule set to 0, but to which property of OrderHeader could I attach it, such that it is re-evaluated when the MyLines property has a line added to it, and of course reflects as being broken if the last object in MyLines is removed?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Thursday, November 26, 2009</h2>You could always just override the IsVslid() property and have it do the following:<br />           return MyBase.IsValid AndAlso _OrderLines.Count > 0</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>peteisace replied on Thursday, November 26, 2009</h2>i've done this, but i'm not sure how much of a hack it is...<br /><br />declare a new custom rule<br /><br />private static bool ValidateMyLines(object target, RuleArgs e)<br />{<br />     OrderDetail detail = (OrderDetail)target;<br />     if(detail.ReadProperty(myLinesProp).Count == 0)<br />     {<br />         e.Description = "There must be at least one line for the order.";<br />         return false;<br />      }<br />  <br />      return true;<br />}<br /><br />// Add the rule to the business rules<br /><br />protected override void AddBusinessRules()<br />{<br />    this.ValidationRules.AddRule(ValidateMyLines, new RuleArgs(myLinesProp));<br />}<br /><br />// Ensure it's called when the collection changes<br /><br />protected override void OnChildChanged(ChildChangedEventArgs e)<br />{<br />     base.OnChildChanged(e);<br />     this.ValidationRules.CheckRules("MyLines");<br />}<br /><br />like i said, probably a bit hacky, but it works :)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Sunday, November 29, 2009</h2><P>With the solution of <A HREF="/members/Marjon.aspx">Marjon</A> you have less code but you have no information why the object is not saved. The object is just invalid and will not be saved.</P>
<P>With the solution of <A HREF="/members/peteisace.aspx">peteisace</A> a brokenrule will be added to the BrokenRulesColection. When using the ErrorTreeView from CslaContrib this information will be displayed. Also when using the cslaActionExtender (AutoShowBrukenRules = True) you'll have a messagebox of the broken rules.</P>
<P>Maybe you need to call also&nbsp;CheckRules() in the dataportal_create method.</P>
<P>&nbsp;</P>
<P>Lhotka: is this the correct way to implment this?</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
