<html><header><title>How to Disable N-Level undo on Editable Class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to Disable N-Level undo on Editable Class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5037.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>handaajay15 posted on Monday, June 30, 2008</h2><P>Hello,</P>
<P>We would like to&nbsp;disable N-Level undo on Editable Class i.e. for class derived from BusinessBase.</P>
<P>Instead of N-Level undo, Can we make it just 1 level undo ? i.e. undo to Original version that was fetched from database.</P>
<P>If the above is not possible, can we disable the undo ? If the user hits cancel, we can always re-fetch the data from the Database. </P>
<P>Another que: We frequently need to compare original value fetched from the database with current value of a property and based on the comparision, we write our business logic. Where and how to store the original value of the object fetched from the database. The old value is required on client as well on server. We do not want to serialize these old values between client and server to avoid the overhead.</P>
<P>Any help in the regard is highly appreciated....</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, June 30, 2008</h2><P>1. There is a setting which allows you to not use N level undo. It is discussed here: <A HREF="/forums/thread/16652.aspx">http://forums.lhotka.net/forums/thread/16652.aspx</A></P>
<P>2. "The old value is required on client as well on server. We do not want to serialize these old values between client and server."</P>
<P>You can't really have it both ways! </P>
<P>You have to "carry the old value around" if you later want to compare it to the current value. The alternative is hitting the DB with it or pulling a copy of the originally fetched BO from cache. But that really complicates things. It is much simpler to create mOrigValue and compare it to mValue in the same BO. You would only expose OrigValue as a readOnly property (if at all.)</P>
<P>I recall that it is also possibel to extend the new managed fields concept to include metadata like OrigValue and IsDirty at the field level. Rocky does not support this in CSLA itself - but he allows you to extend CSLA to get this behavior if you want to pay that cost.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Monday, June 30, 2008</h2><P><FONT face=Tahoma size=2>Disabling&nbsp;the undo capabilities depends on how you intend to use your objects.&nbsp; You can disable the IEditableObject support, which would turn off the automatic undo capabilities of your objects.&nbsp; <FONT face=Tahoma size=2>Once you've disabled that, the amount of undo is totally up to you.&nbsp; If you only want 1 level, then you only call "BeginEdit" once.</FONT></FONT></P>
<P><FONT face=Tahoma><FONT size=2>Having said that, there are some potential caveats.&nbsp; </FONT></FONT><FONT face=Tahoma size=2><FONT face=Tahoma size=2>If this is a web app, then you don't have to do anything -&nbsp;you're not getting automatic undo, and if you don't want any undo behavior (and almost every web site I've seen doesn't), just don't call the Begin/End/ApplyEdit methods.</FONT></FONT></P>
<P><FONT face=Tahoma size=2>If you're working with a Windows Forms app - well, that becomse more complicated.&nbsp; Disabling IEditableObject means that the automatic data-binding you get from the Forms architecture doesn't happen, and you're on your own.&nbsp; Essentially, you would turn your Windows app into a web app, from a data-binding perspective.&nbsp; You would be required to call the Begin/End/ApplyEdit methods as appropriate.&nbsp; But y</FONT><FONT face=Tahoma size=2>ou'll also encounter some potentially strange behaviors in certain areas, mostly related to grids.</FONT></P>
<P><FONT face=Tahoma size=2>If you're in a WPF app - well, I can't help you there, as I'm not into WPF yet, so I don't know how that would be affected.</FONT></P>
<P><FONT face=Tahoma size=2>As for your original/current question, there isn't a built-in way to manage that within a CSLA object, so you're pretty much on your own to manage that.&nbsp; But I'm a little confused about your comment about not wanting to serialize the original values.&nbsp; I understand the overhead concerns, but you have to get the data to the client somehow, so it has to be serialized the one way.&nbsp; And once you have the data, why would you then disregard it and re-query the database on the server side?&nbsp; The server objects are not generally stateful, so there&nbsp;wouldn't be&nbsp;an instance of your business object sitting on the server holding those original values - the server object is completely reconstituted from the byte stream sent to it by the client.&nbsp; That's the crux of the "mobile object" concept.&nbsp; You can't mark your original value fields as NonSerialized, because they then wouldn't make it to your client.&nbsp; So if you want the original values on the client, you'll be sending them back and forth anyway.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>handaajay15 replied on Monday, June 30, 2008</h2><P>Thanks for comments guys.</P>
<P>Platform: WPF/WCF/LINQ</P>
<P>Product: Our product targets wholesale fashion industry with full EDI support. We may have anyway from 100 to 10,000 lines per production order. So, If we keep the original values with in the BO, we are potentially making 20,000 objects travel instead of 10,000. To make things worse, every production line is a matrix of Sizes, Dimension&nbsp;and Colors as grand children. </P>
<P>For Client side, When we have fetched the object from the database, can we store in the client side for reference? If yes, then what is the best way of storing the retreiving the properties on client side?</P>
<P>For Server side, we can re-fetch from the database, i think....</P>
<P>Regarding undo,</P>
<P>On one form, We have 8 collections/lists, where data is moved by user between one collection/list to another. Size of each list is just about 1000 string variables. They are all binding lists though. So Whe we are moving data between collection in UI, its very slow, and after 6,7 attempts the system goes out of memory. </P>
<P>We disabled the undo behaviour as you have suggested, and the system is responding very fast and out of memory problem has gone away, but we are not sure what exactly will stop working. </P>
<P>Again, Thanks for any help.!</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Monday, June 30, 2008</h2><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div></FONT><FONT face=Tahoma size=2>Product: Our product targets wholesale fashion industry with full EDI support. We may have anyway from 100 to 10,000 lines per production order. So, If we keep the original values with in the BO, we are potentially making 20,000 objects travel instead of 10,000. To make things worse, every production line is a matrix of Sizes, Dimension&nbsp;and Colors as grand children.</FONT><FONT face=Tahoma size=2></div></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma size=2>I'm not sure I follow this.&nbsp; If you keep the original values of your properties in the BO, why does that double the number of objects you send?&nbsp; Yes, it will make your BO's bigger, but it shouldn't create more of them to send back and forth.&nbsp; Sending the original values to the client inside your BO is going to be a lot smaller (and faster) then trying to send two copies...</FONT></P>
<P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div>For Client side, When we have fetched the object from the database, can we store in the client side for reference? If yes, then what is the best way of storing the retreiving the properties on client side?</div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>Would you be storing them on the client in order to create your "original value" BO's?&nbsp; Sure, you can do that - but with an object&nbsp;graph of that size, you're going to notice the performance hit.&nbsp; Also, you can't really keep that large an object graph sitting in memory (see your out-of-memory problems), so you'd probably need to serialize it to disk.&nbsp; But you'd then have to load it back into memory to do your field comparisons, so that doesn't seem to help too much.</FONT></P>
<P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div>For Server side, we can re-fetch from the database, i think....</div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>Maybe I'm not understanding you, but I don't know why you would re-fetch from the database on the server side.&nbsp; If you have to have your original database values on the client, then they will be sent in the serialized byte stream to the client, <STRONG>as well as from the client to the server.</STRONG>&nbsp; There is no need to re-fetch from the database, and doing so will not make your objects smaller as they travel over the wire.</FONT></P>
<P><FONT face=Tahoma size=2>Besides, what's to guarantee that the data you re-fetch from the database is the same as when you&nbsp;initially created&nbsp;your BO's?</FONT></P>
<P><FONT face=Tahoma size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div></FONT><FONT face=Tahoma size=2>On one form, We have 8 collections/lists, where data is moved by user between one collection/list to another. Size of each list is just about 1000 string variables. They are all binding lists though. So Whe we are moving data between collection in UI, its very slow, and after 6,7 attempts the system goes out of memory. </FONT></P>
<P><FONT face=Tahoma size=2>We disabled the undo behaviour as you have suggested, and the system is responding very fast and out of memory problem has gone away, but we are not sure what exactly will stop working.</FONT><FONT face=Tahoma size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT face=Tahoma size=2>I can't say what disabling IEditableObject will do to a WPF app - no experience there.&nbsp; I have heard that WPF doesn't completely rely on existing data-binding infrastructure, so you may be OK.&nbsp; I also can't really speak to the performance/memory issue either, at least not without seeing more of how the screen is designed.&nbsp; 8,000 strings is a fair number, and certainly disabling the undo stack will help.&nbsp; But if you're just moving them from list to list, you shouldn't be gobbling up more and more memory.</FONT></P>
<P><FONT face=Tahoma size=2>HTH</FONT></P>
<P><FONT face=Tahoma size=2>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 01, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div>
<P>Platform: WPF/WCF/LINQ</P>
<P></div></BLOCKQUOTE></P>
<P>In WPF you don't really need to disable n-level undo, as it isn't used automatically by WPF.</P>
<P>The CslaDataProvider control <EM>will</EM> automatically use n-level undo if you set ManageObjectLifetime=true - but the default is to <EM>not</EM> use n-level undo.</P>
<P>In other words, in WPF you shouldn't need to worry about this issue at all - it only gets used if you explicitly use it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Monday, June 30, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>handaajay15:</strong></div><div>
<P>Another que: We frequently need to compare original value fetched from the database with current value of a property and based on the comparision, we write our business logic. Where and how to store the original value of the object fetched from the database. The old value is required on client as well on server. We do not want to serialize these old values between client and server to avoid the overhead.</P>
<P>Any help in the regard is highly appreciated....</P>
<P></div></BLOCKQUOTE></P>
<P>We implemented a valuecache in our BO's. It's initially empty, but all the property setters will instantiate the cache (if necessary) and save the original value anytime a new value is provided for a property -- it wasn't very hard to implement, but would be tedious without a code generator for your objects.</P>
<P>It really helps to have though. We use it for database concurrency (e.g. detecting collisions), and also being able to tell if a property is "really" dirty (e.g. change a property, then change it back to original value. It's not actually changed any more). </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>handaajay15 replied on Monday, June 30, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsbaker0:</strong></div><div></P>
<P>We implemented a valuecache in our BO's. It's initially empty, but all the property setters will instantiate the cache (if necessary) and save the original value anytime a new value is provided for a property -- it wasn't very hard to implement, but would be tedious without a code generator for your objects.</P>
<P>It really helps to have though. We use it for database concurrency (e.g. detecting collisions), and also being able to tell if a property is "really" dirty (e.g. change a property, then change it back to original value. It's not actually changed any more). </P>
<P></div></BLOCKQUOTE></P>
<P>Yes, I think thats what we need. Any code samples would be highly appreciated to understand how to do it .</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 01, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsbaker0:</strong></div><div>
<P>We implemented a valuecache in our BO's. It's initially empty, but all the property setters will instantiate the cache (if necessary) and save the original value anytime a new value is provided for a property -- it wasn't very hard to implement, but would be tedious without a code generator for your objects.</P>
<P></div></BLOCKQUOTE></P>
<P>One way to do this in CSLA 3.5 is to subclass FieldData and PropertyInfo. You can then extend FieldData to store original values or other metadata about the field behind each property. </P>
<P>I didn't do this directly in CSLA because the overhead is obviously quite high (doubling the size of the serialized byte stream to/from the server), but the design of the field manager is such that you should be able to add this functionality in a pretty seamless manner by just extending those two classes through inheritance.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, July 02, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><BR>One way to do this in CSLA 3.5 is to subclass FieldData and PropertyInfo. You can then extend FieldData to store original values or other metadata about the field behind each property. <BR></div></BLOCKQUOTE></P>
<P>Rocky, <BR>Assuming someone chooses to subclass and extend FieldData to contain original values they may also want to modify the way that IsDirty is handled. If the original value is 1 and it is changed to 2 then it IsDirty. But if it is later changed back to 1 then they may consider that to be NOT dirty.</P>
<P>I made a quick attempt at subclassing FieldData and I was not very successful. Could someone please explain how to improve this code? Or are framework changes required?</P>
<P>Issues:<BR>1. I cannot Override the&nbsp;Value or IsDirty&nbsp;property. I used Overloads here to remove the compiler warning.</P>
<P>2. This line of code does not even compile. How can I compare the new value to the&nbsp;Original value.<BR>&nbsp;&nbsp;<FONT size=2><FONT color=#0000ff>&nbsp;If</FONT> <FONT color=#0000ff>MyBase</FONT>.Value = _origdata <FONT color=#0000ff>Then</FONT> </FONT><FONT color=#008000 size=2>'Operator '=' is not defined for types 'T' and 'T'.</FONT></P>
<P><FONT color=#008000><FONT color=#000000>3. How do you make sure </FONT><FONT color=#000000>the original value is only set once? Will the idea shown below work for Integers?<BR></FONT></P></FONT><FONT color=#0000ff size=2>
<P>Imports</FONT><FONT size=2> Csla.Core<BR></FONT><FONT color=#0000ff size=2>Imports</FONT><FONT size=2> Csla.Core.FieldManager</P></FONT><FONT color=#0000ff size=2>
<P>Namespace</FONT><FONT size=2> BO</P>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MustInherit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MyFieldData(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> FieldData(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IFieldData(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> T)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Private</FONT><FONT size=2> _origdata </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T = </FONT><FONT color=#0000ff size=2>Nothing</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> name </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.New(name)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Value() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value = value </FONT><FONT color=#008000 size=2>'sets IsDirty = True<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> _origdata </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>'only set the original value once. Will this work for non-reference values of type T?<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>_origdata = value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value = _origdata </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>'Operator '=' is not defined for types 'T' and 'T'.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>MarkClean() </FONT><FONT color=#008000 size=2>'sets IsDirty to False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> OrigValue() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> _origdata<BR>&nbsp; &nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> IsDirty() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> child </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> ITrackStatus = </FONT><FONT color=#0000ff size=2>TryCast</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value, ITrackStatus)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> child </FONT><FONT color=#0000ff size=2>IsNot</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> child.IsDirty<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value = _origdata </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>'Operator '=' is not defined for types 'T' and 'T'.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.IsDirty<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>&nbsp;</FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</P>
<P>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Namespace</P></FONT>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Wednesday, July 02, 2008</h2>









 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>On second issue&#8230;.&nbsp; <o:p></o:p></span></p>

<p class=MsoNormal><span>This should compile and work:<o:p></o:p></span></p>

<p class=MsoNormal><span>If</span><span> <span>MyBase</span>.Value.Equals(
_origdata) <span>Then</span></span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>On third issue I would use a variable &#8220;HasOrigianlValueBeenSet&#8221;
because Nothing could be a valid original value, technically&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Senior Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899</span><span><o:p></o:p></span></p>

<p class=MsoNormal><span><img width=119 height=26 id="Picture_x0020_1" alt="cid:_2_0648EA840648E85C001BBCB886257279"><br>
</span><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> JoeFallon1
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Wednesday, July 02, 2008 10:21 AM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] How to Disable N-Level undo on Editable Class<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<blockquote>

<div>

<p class=MsoNormal><img id="_x0000_i1025" src="/Themes/default/images/icon-quote.gif"><strong>RockfordLhotka:</strong><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><br>
One way to do this in CSLA 3.5 is to subclass FieldData and PropertyInfo. You
can then extend FieldData to store original values or other metadata about the
field behind each property. <o:p></o:p></p>

</div>

</blockquote>

<p>Rocky, <br>
Assuming someone chooses to subclass and extend FieldData to contain original
values they may also want to modify the way that IsDirty is handled. If the
original value is 1 and it is changed to 2 then it IsDirty. But if it is later
changed back to 1 then they may consider that to be NOT dirty.<o:p></o:p></p>

<p>I made a quick attempt at subclassing FieldData and I was not very
successful. Could someone please explain how to improve this code? Or are
framework changes required?<o:p></o:p></p>

<p>Issues:<br>
1. I cannot Override the&nbsp;Value or IsDirty&nbsp;property. I used Overloads
here to remove the compiler warning.<o:p></o:p></p>

<p>2. This line of code does not even compile. How can I compare the new value
to the&nbsp;Original value.<br>
&nbsp;&nbsp;<span>&nbsp;If</span><span> <span>MyBase</span>.Value = _origdata
<span>Then</span> <span>'Operator '=' is
not defined for types 'T' and 'T'.</span></span><o:p></o:p></p>

<p><span>3. How do you make sure the original value is only
set once? Will the idea shown below work for Integers?</span><span><o:p></o:p></span></p>

<p><span>Imports</span><span> Csla.Core<br>
<span>Imports</span> Csla.Core.FieldManager<o:p></o:p></span></p>

<p><span>Namespace</span><span> BO<o:p></o:p></span></p>

<p><span>&lt;Serializable()&gt; _<br>
<span>Public</span> <span>MustInherit</span>
<span>Class</span> MyFieldData(<span>Of</span>
T)<br>
&nbsp; <span>Inherits</span> FieldData(<span>Of</span> T)<br>
&nbsp; <span>Implements</span> IFieldData(<span>Of</span> T)<o:p></o:p></span></p>

<p><span>&nbsp; Private</span><span> _origdata <span>As</span> T = <span>Nothing<o:p></o:p></span></span></p>

<p><span>&nbsp; Public</span><span> <span>Sub</span> <span>New</span>(<span>ByVal</span> name <span>As</span> <span>String</span>)<br>
&nbsp;&nbsp;&nbsp; <span>MyBase</span>.New(name)<br>
&nbsp; <span>End</span> <span>Sub<o:p></o:p></span></span></p>

<p><span>&nbsp; Public</span><span> <span>Overloads</span> <span>Property</span> Value() <span>As</span> T<br>
&nbsp;&nbsp;&nbsp; <span>Get<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> <span>MyBase</span>.Value<br>
&nbsp;&nbsp;&nbsp; <span>End</span> <span>Get<br>
&nbsp;&nbsp;&nbsp; Set</span>(<span>ByVal</span> value <span>As</span> T)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>MyBase</span>.Value =
value <span>'sets IsDirty = True<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>If</span>
_origdata <span>Is</span> <span>Nothing</span>
<span>Then</span> <span>'only set the
original value once. Will this work for non-reference values of type T?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_origdata = value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>End</span> <span>If<o:p></o:p></span></span></p>

<p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If</span><span> <span>MyBase</span>.Value =
_origdata <span>Then</span> <span>'Operator
'=' is not defined for types 'T' and 'T'.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>MarkClean() <span>'sets IsDirty to False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>End</span> <span>If<br>
&nbsp;&nbsp;&nbsp; End</span> <span>Set<br>
&nbsp; End</span> <span>Property<o:p></o:p></span></span></p>

<p><span>&nbsp; Public</span><span> <span>ReadOnly</span> <span>Property</span> OrigValue() <span>As</span>
T<br>
&nbsp;&nbsp;&nbsp; <span>Get<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> _origdata<br>
&nbsp; &nbsp; <span>End</span> <span>Get<br>
&nbsp; End</span> <span>Property<o:p></o:p></span></span></p>

<p><span>&nbsp; Public</span><span> <span>Overloads</span> <span>ReadOnly</span> <span>Property</span>
IsDirty() <span>As</span> <span>Boolean<br>
&nbsp;&nbsp;&nbsp; Get<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim</span> child <span>As</span>
ITrackStatus = <span>TryCast</span>(<span>MyBase</span>.Value,
ITrackStatus)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>If</span> child <span>IsNot</span> <span>Nothing</span> <span>Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> child.IsDirty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>Else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If</span> <span>MyBase</span>.Value
= _origdata <span>Then</span> <span>'Operator
'=' is not defined for types 'T' and 'T'.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>Return</span> <span>False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> <span>MyBase</span>.IsDirty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>End</span> <span>If<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End</span> <span>If<br>
&nbsp;&nbsp;&nbsp; End</span> <span>Get<br>
&nbsp; End</span> <span>Property<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Class<o:p></o:p></span></span></p>

<p><span>End</span><span> <span>Namespace<o:p></o:p></span></span></p>

<p>Joe<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, July 02, 2008</h2><P>Sergey,</P>
<P>Thanks for the quick response. Both ideas worked fine.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> _hasBeenSet </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Value() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Set</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> value </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> T)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value = value </FONT><FONT color=#008000 size=2>'sets IsDirty = True<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> _hasBeenSet = </FONT><FONT color=#0000ff size=2>False</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then</FONT><FONT size=2> </FONT><FONT color=#008000 size=2>'only set the original value once. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>_origdata = value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _hasBeenSet = </FONT><FONT color=#0000ff size=2>True<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp; If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value.Equals(_origdata) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=2>MarkClean() </FONT><FONT color=#008000 size=2>'sets IsDirty to False<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Set<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT></P><FONT color=#0000ff size=2><FONT color=#000000><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> IsDirty() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.Value.Equals(_origdata) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.IsDirty<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff><FONT size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT></FONT></FONT>
<P><FONT color=#0000ff size=2><FONT color=#000000>So now all we need is some advice on the Override vs. Overload issue.</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#000000>Joe</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Wednesday, July 02, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>They this for your overloads problem.&nbsp; Use Shadows instead
of Overloads.&nbsp; The only problem with this approach is that there is no equivalent
to Shadows in C#.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>&nbsp; Public</span><span> <span>Shadows ReadOnly</span> <span>Property</span> IsDirty() <span>As</span>
<span>Boolean<br>
&nbsp;&nbsp;&nbsp; Get<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim</span> child <span>As</span>
ITrackStatus = <span>TryCast</span>(<span>MyBase</span>.Value,
ITrackStatus)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>If</span> child <span>IsNot</span> <span>Nothing</span> <span>Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> child.IsDirty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>Else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If</span> <span>MyBase</span>.Value
= _origdata <span>Then</span> <span>'Operator
'=' is not defined for types 'T' and 'T'.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>Return</span> <span>False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return</span> <span>MyBase</span>.IsDirty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>End</span> <span>If<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End</span> <span>If<br>
&nbsp;&nbsp;&nbsp; End</span> <span>Get<br>
&nbsp; End</span> <span>Property</span><o:p></o:p></span></p>

<p class=MsoNormal><span>&nbsp;End</span><span> <span>Class</span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b><span>Sergey Barskiy<o:p></o:p></span></b></p>

<p class=MsoNormal><b><i><span>Senior Consultant<o:p></o:p></span></i></b></p>

<p class=MsoNormal><span>office: 678.405.0687 |
mobile:&nbsp;404.388.1899<o:p></o:p></span></p>

<p class=MsoNormal><b><i><span>Magenic</span></i></b><span> </span><span>&reg;</span><b><i><span><o:p></o:p></span></i></b></p>

<p class=MsoNormal><b><span>Microsoft Worldwide Partner of the Year |</span></b><span> </span><b><span>Custom
Development Solutions, Technical Innovation</span></b><span><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> JoeFallon1
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Wednesday, July 02, 2008 10:42 AM<br>
<b>To:</b> Sergey Barskiy<br>
<b>Subject:</b> Re: [CSLA .NET] RE: How to Disable N-Level undo on Editable
Class<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p>Sergey,<o:p></o:p></p>

<p>Thanks for the quick response. Both ideas worked fine.<o:p></o:p></p>

<p><span>Private</span><span> _hasBeenSet <span>As</span> <span>Boolean</span> = <span>False<o:p></o:p></span></span></p>

<p><span>Public</span><span> <span>Overloads</span> <span>Property</span> Value() <span>As</span> T<br>
&nbsp; <span>Get<br>
&nbsp;&nbsp;&nbsp; Return</span> <span>MyBase</span>.Value<br>
&nbsp; <span>End</span> <span>Get<br>
&nbsp; Set</span>(<span>ByVal</span> value <span>As</span> T)<br>
&nbsp;&nbsp;&nbsp; <span>MyBase</span>.Value = value <span>'sets IsDirty = True<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp; </span><span>If</span> _hasBeenSet = <span>False</span> <span>Then</span> <span>'only set the original value once. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_origdata = value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _hasBeenSet = <span>True<br>
&nbsp;&nbsp;&nbsp; End</span> <span>If<o:p></o:p></span></span></p>

<p><span>&nbsp;&nbsp;&nbsp; If</span><span> <span>MyBase</span>.Value.Equals(_origdata)
<span>Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>MarkClean() <span>'sets
IsDirty to False<br>
&nbsp;&nbsp;&nbsp; </span><span>End</span> <span>If<br>
&nbsp; End</span> <span>Set<br>
End</span> <span>Property</span></span><o:p></o:p></p>

<p><span>So now all we need is some adivce
on the Override vs. Overload issue.</span><o:p></o:p></p>

<p><span>Joe</span><span><o:p></o:p></span></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 02, 2008</h2><P>It could be that those properties should be virtual. I think I erred on the side of caution, figuring I could relax the restriction later.</P>
<P>In the short term you can always implement IFieldData directly - don't subclass at all.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, July 02, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>
<P>It could be that those properties should be virtual. I think I erred on the side of caution, figuring I could relax the restriction later.</P>
<P>In the short term you can always implement IFieldData directly - don't subclass at all.</P>
<P></div></BLOCKQUOTE></P>
<P>Yup. That was what I was getting at when I asked if framework changes were required. Any plans to make them Overriddable in 3.5.1?</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 02, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>I am willing to consider making them overridable.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>You&#8217;ve done more research into this than I have (I just
considered it in the design and never prototyped it). Do you think it is
sufficient to make those two overridable?<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, July 02, 2008</h2><P>Yes. I think that making those 2 Overridable would make it easier/possible to implement the inheritance strategy you recommended. Re-creating the entire class without inheritance would work but a developer should not have to do that.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 03, 2008</h2><P>Yes, changed in svn in 3.5.1.</P>
<P>My only real worry here, is that a subclass will need to detect that it contains a child object and handle that correctly - so it still isn't necessarily trivial to write a subclass.</P>
<P>But then again, your PropertyInfo subclass could make that determination and return a standard FieldData rather than a custom FieldData for child objects.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, July 01, 2008</h2><P>Here is an excerpt from our value cache implementation. We have two different kinds of objects, one of which tracks changed values by backing field name (long story) and the other which uses the property names, so I kept the same interface for both. This code uses the property names.</P>
<P>To make this work correctly, you have to do two things in your property setter:</P>
<P>(1) Make the setter a "no-op" if the value passed in matches the current property value.</P>
<P>(2) Call "OnPropertyChanging(..)" below with the previous value of the property before updating your backing field with the new value. </P>
<P>&nbsp;</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>#region</FONT></FONT><FONT size=2> Changed Value Support</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// Changed Value Support modeled after WOMapperBusinessBase implementation, except it </P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// uses property names only and ignores member fieldnames</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// Similar OnPropertyChanging() interface kept for consistency/switchability</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>virtual</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> OnPropertyChanging(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> propertyName, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> oldValue, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> memberfieldName)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// Enforce authorization rules</P></FONT></FONT><FONT size=2>
<P>CanWriteProperty(propertyName, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>);</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// When editing existing object, cache original value on first property change </P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// for dirty field/concurrency support. </P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>// NOTE: Differs from WORMapperBusinessBase implementation because uses property and not field names</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!IsNew &amp;&amp; !</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>String</FONT></FONT><FONT size=2>.IsNullOrEmpty(propertyName))</P>
<P>{</P>
<P>CacheValue(propertyName, oldValue);</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CacheValue(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> propertyName, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> oldValue)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!ValueCache.Contains(propertyName))</P>
<P>ValueCache.Add(propertyName, oldValue);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> ClearConcurrencyCache()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!ReferenceEquals(_valueCache, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>))</P>
<P>_valueCache.Clear();</P>
<P>_valueCache = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> System.Collections.Specialized.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HybridDictionary</FONT></FONT><FONT size=2> _valueCache;</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> System.Collections.Specialized.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HybridDictionary</FONT></FONT><FONT size=2> ValueCache</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>get</P></FONT></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (ReferenceEquals(_valueCache, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>))</P>
<P>_valueCache = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> System.Collections.Specialized.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HybridDictionary</FONT></FONT><FONT size=2>();</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> _valueCache;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> T ReconstructOriginal()</P>
<P>{</P>
<P>T copy = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>.Clone();</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!ReferenceEquals(_valueCache, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>) &amp;&amp; _valueCache.Count &gt; 0)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>foreach</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> key </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> _valueCache.Keys)</P>
<P>{</P>
<P>Util.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ReflectHelper</FONT></FONT><FONT size=2>.SetPropertyValue(</P>
<P>copy, key.ToString(), _valueCache[key]);</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> copy;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CopyChangedFields(T target)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!ReferenceEquals(_valueCache, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>) &amp;&amp; _valueCache.Count &gt; 0)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>foreach</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> key </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> _valueCache.Keys)</P>
<P>{</P>
<P>Util.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ReflectHelper</FONT></FONT><FONT size=2>.SetPropertyValue(</P>
<P>target, key.ToString(), _valueCache[key]);</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P>&nbsp;</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> IsDirtyProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> fieldMember)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> original;</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> IsDirtyProperty(fieldMember, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>out</FONT></FONT><FONT size=2> original);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> IsDirtyProperty(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> fieldMember, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>out</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> original)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> bDirty = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>false</FONT></FONT><FONT size=2>;</P>
<P>original = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (_valueCache != </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2> &amp;&amp; _valueCache.Contains(fieldMember))</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> cachedValue = _valueCache[fieldMember];</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> currentValue = </FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>Util.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ReflectHelper</FONT></FONT><FONT size=2>.GetPropertyValue(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>, fieldMember);</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (!</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2>.Equals(cachedValue, currentValue))</P>
<P>{</P>
<P>original = cachedValue;</P>
<P>bDirty = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> bDirty;</P>
<P>}</P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>#endregion</P></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
