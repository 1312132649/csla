<html><header><title>Persisting Dirty, New, Deleted in a local database.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Persisting Dirty, New, Deleted in a local database.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3300.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pelinville posted on Monday, July 30, 2007</h2><P><FONT face=Arial>Currently we have a number of applications that must operate offline.&nbsp;To accomplish this I have created a scaled down version of the ObjectAdapter that will save the normal fields along with the&nbsp;Dirty, New, Deleted and Valid state of all loaded objects.&nbsp;The resultant dataset is encrypted and stored in a file.</FONT></P>
<P><FONT face=Arial size=3>We have chosen this route because we&nbsp;host data for&nbsp;our customers and there is no way we are going to allow db synchronization through the internet from desktops we have absolutly no control over.&nbsp; By forcing the persisted data to be loaded from the local store into our business objects we can look for irregularities and bad/tampered with data.</FONT></P>
<P>&nbsp;</P>
<P><FONT face=Arial size=3>There are some limitations with this design, of course.&nbsp; After playing with the compact edition of SQL server I really like the small foot print combined with the power and ease of deployment.</FONT></P>
<P><FONT face=Arial size=3></FONT>&nbsp;</P>
<P><FONT face=Arial size=3>The problem is I can't figure out an EASY way of creating the database schema and BO's that also includes the fields to persist the dirty, new etc state.&nbsp; With the ObjectAdapter approach all I had to do was create a new attribute (ForObjectAdaptation) and add it to the various properties in CodeGen and in the base classes.&nbsp; Since the file is created on every save the schema is automagically created.</FONT></P>
<P><FONT face=Arial size=3></FONT>&nbsp;</P>
<P><FONT face=Arial size=3>Actually, even if I had to create a new db with schema with every update it would be fine. But how do I add the other fields such that I don't have to have two versions of every stored proc/sql statement to account for the other fields? (This is thousands of stored procs.) And how do I get the objects to know which stored proc to use?</FONT></P>
<P><FONT face=Arial size=3></FONT>&nbsp;</P>
<P><FONT face=Arial size=3>Any ideas?</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Tuesday, July 31, 2007</h2>I like the idea you are going for.&nbsp; The real problem I see with the compact version is that is does not support SPROCs at all (at least not the last time I played with it version 3.1).&nbsp; Now if they do support SPROCs then you have a decisiion to make.&nbsp; Do you add all of those extra fields to your main database tables so that the same SPROCs still work (but you simply ignore the values) or do you write a block of code that checks the table schema and inserts/updates those columns only if they exist.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pelinville replied on Tuesday, July 31, 2007</h2><P>I can easily get over the lack of stored procedures.&nbsp; In fact I only have about 10 stored procedures and they are not applicable to offline work.</P>
<P>You brought up the problem.&nbsp; Adding the fields to the main DB just to support the offline operation seems plain wrong.</P>
<P>I thought of something that might work.&nbsp; Take the object adapter concept&nbsp;and, instead of generating a DataSet/DataTable, generate the SQL DDL to generate the schema.&nbsp; </P>
<P>Take it one step further and also generate the sql to insert and retrieve&nbsp;the data.&nbsp; Since the local store is ONLY used to insert and retrieve.&nbsp; And the object fields to persist&nbsp;are already marked with my attribute. </P>
<P>I think that will work.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
