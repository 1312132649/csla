<html><header><title>&quot;Forgotten&quot; value?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>&quot;Forgotten&quot; value?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7587.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Tuesday, September 08, 2009</h2>Hi,<br /><br />I'm hitting a really wierd problem.  The issue is that I have a collection of EmailAddresses on a main Contact object.  There are business rules setup to check that the email address is not empty using the standard StringRequired from Csla.  This rule has a priorty of 1.  A rule with priority 0 performs a Trim of the address, and a rule with priority 2 checks that itx in x@y.com format. <br /><br />All these checks seem to pass, and the save makes its way to the app server where it's processed.  I then get an error because the column for the email address doesn't accept nulls.<br /><br />The update is simple, and I didn't forget to actually pass the value to the Linq2Sql instance, because the update works most of the time.  heres the code:<br /><br />		private void Child_Update( Data.Shared.Person person ) {<br />			ContextManager mgr;<br />			Data.Contacts.SalesContactEmail sce, dummy;<br /><br />			using ( mgr = ContextManager.GetManager() ) {<br />				sce = new Data.Contacts.SalesContactEmail();<br />				sce.SalesContactEmailId = salesContactEmailId;<br />				sce.SalesContact = person.SalesContact;<br /><br />				dummy = new Data.Contacts.SalesContactEmail();<br />				dummy.SalesContactEmailId = salesContactEmailId;<br />				dummy.SalesContact = person.SalesContact;<br /><br />				sce.SalesContact = person.SalesContact;<br /><br />				using ( BypassPropertyChecks ) {<br />					sce.IsPrimary = IsPrimary;<br />					sce.EmailAddress = Email;<br />				}<br /><br />				mgr.DataContext.SalesContactEmail.Attach( sce, dummy );<br />			}<br />		}<br /><br />Any ideas?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Saturday, September 12, 2009</h2>1. Is the property in the businessobject a string? If not then the StringRequired rule won't work.<br /><br />PS:<br />What do u mean with a rule performing a Trim? I suppose it's checking if the string is not empty after trimming?<br /><br />Else i don't have another idea, it should be something simple hehe.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rfcdejong replied on Saturday, September 12, 2009</h2>Or maybe a strange value as e-mail address that causes the update to fail. With L2S it shouldn't be a problem, but for example using raw sql it would hick up on comma's.<br /><br />Is it going wrong in production code? Any logs?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, September 14, 2009</h2>I finally found the issue.  I had forgotten some attributes on the stored procedure method signature.<br /><br />What was throwing me is that the update sometimes WOULD work... how I can't figure out, but it would only happen if the user change some of child records, nothing that had to do with the emails collection itself.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
