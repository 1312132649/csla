<html><header><title>Authentication and MySQL</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authentication and MySQL</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4090.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ataylorm posted on Wednesday, December 26, 2007</h2><P>I don't know why, but for some reason I just can't get my head around this CSLA framework, so I have yet another really stupid question...</P>
<P>I have my identity and principal classes setup, but I need to tell the system to check the database for users.&nbsp; Where do I do this at?&nbsp; I can't even find where I am supposed to tell it what table to look at?&nbsp; We are using MySQL and no stored procs, so I need to find where to put in the select statements and such.</P>
<P>Thanks,</P>
<P>Completely Lost</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, December 26, 2007</h2><P>In your custom identity clss you should have a shared method like this:</P>
<P>&nbsp;Friend Shared Function LoadIdentity(ByVal UserName As String, ByVal Password As String) As MyBusinessIdentity<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return CType(DataPortal.Fetch(New Criteria(UserName, Password)), MyBusinessIdentity)<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; &lt;Serializable()&gt; _<BR>&nbsp;&nbsp;&nbsp; Private Class Criteria<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Username As String<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Password As String</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Sub New(ByVal Username As String, ByVal Password As String)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Username = Username.ToUpper<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Password = Password<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; End Class</P>
<P>DataPortal.Fetch will run through the CSLA framework and end up calling a method named DataPortal_Fetch in your Identity class.</P>
<P>The Fetch method should have some code to retrieve the list of roles (and any other values you want to track.)</P>
<P>e.g.</P>
<P>&nbsp;Protected Overrides Sub DataPortal_Fetch(ByVal Criteria As Object)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mRoles.Clear()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim crit As Criteria = CType(Criteria, Criteria)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim dr As SafeDataReader</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'my DAL class knows the connection string for the SQL Server database.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'your ADO.Net code can just provide the connection string here if needed. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Or you can read it from the config file.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Then you execute a SQL statement which uses the table in your DB:<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr = New SafeDataReader(DAL.ExecuteReader(MySQLCLASS.GetRoles(crit.Username)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'add roles to mRoles here<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Close()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<BR>&nbsp; End Sub</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
