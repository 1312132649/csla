<html><header><title>runtime errors might occur when converting 'String' to 'Csla.core.ipropertyInfo'</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>runtime errors might occur when converting 'String' to 'Csla.core.ipropertyInfo'</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9815.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mrisher posted on Tuesday, November 30, 2010</h2><p>This may sound like a silly question, but I am getting a runtime error when I get/set a property.&nbsp; I am using Visual Studio 2010 and CSLA 4.0.&nbsp; The CanReadProperty and the PropertyHasChanged calls are where it bombs.&nbsp; I understand some things were changed somewhere around CSLA 3.5 and 4.0.&nbsp; I have looked everywhere on the forum and can&#39;t find this answer.&nbsp; Do I need to convert/cast my property name to type iPropertyInfo?&nbsp; If so, how?&nbsp; Here&#39;s my code.&nbsp; </p>
<p>Public Property Description() As String<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(&quot;Description&quot;, True)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _description<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanWriteProperty(&quot;Description&quot;, True)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If value Is Nothing Then value = String.Empty<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not _description.Equals(value) Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _description = value<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged(&quot;Description&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, November 30, 2010</h2><pre id="code-result" class="brush:vbnet">Your code looks like legacy code from Csla 2.x/3.x and will not be able to work with Csla 4 without a certain amount of changes. <br /><br /><b>Sorry - there is no workaround for having your legacy code work in CSLA 4.0 without changing the property declarations. <br />You will also have o rewrite all of your custom validation rules and authorization rules to conform with new syntax and new rule engine. </b><br /><br />I&#39;d recommend to look at the new snippets and class templates that is  included with Csla 4.  You should also read the release notes for <br />all newer version from your original version to catch all breaking changes. These are available at <a title="http://www.lhotka.net/cslanet/Download.aspx" href="http://www.lhotka.net/cslanet/Download.aspx">http://www.lhotka.net/cslanet/Download.aspx</a><br /><br />In newer versions of Csla the property declaration syntax has been greatly simplified so this is how a property should be declared now:</pre>
<pre id="code-result" class="brush:vbnet">Public Shared ReadOnly DescriptionProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(Function(c) c.Description)<br />Public Property Description() As String<br />	Get<br />		Return GetProperty(DescriptionProperty)<br />	End Get<br />	Set<br />		SetProperty(DescriptionProperty, value)<br />	End Set<br />End Property<br /><br />or to use a private backing field:<br /><br />Dim _description As String<br />Public Shared ReadOnly DescriptionProperty As PropertyInfo(Of String) = RegisterProperty(Of String)(Function(c) c.Description, RelationshipTypes.PrivateField)<br />Public Property Description() As String<br />	Get<br />		Return GetProperty(DescriptionProperty, _description)<br />	End Get<br />	Set<br />		SetProperty(DescriptionProperty, _description, value)<br />	End Set<br />End Property<br /><br />I think that <a title="Structural Search And Replace" href="http://blogs.jetbrains.com/dotnet/2010/04/introducing-resharper-50-structural-search-and-replace/">Structural Search and Replace</a> function of R# may help you but I haven&#39;t tried this on VB.NET code. <br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, December 01, 2010</h2><p>Hi</p>
<p>If you wish to do only minor/minimum of changes to your code then&nbsp;I would only upgrade to Csla 3.8.x.&nbsp;&nbsp; <br />Your property declarations and rules should run in Csla 3.8.x without any major workover. </p>
<p>The inner workings of Csla 4 has changed so much that you will have to rewrite much of your properties, rules and&nbsp;authorization to make it run. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
