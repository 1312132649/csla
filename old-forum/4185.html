<html><header><title>Sanity Check -Mixed Authentication and Authorization</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Sanity Check -Mixed Authentication and Authorization</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4185.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Diz posted on Thursday, January 17, 2008</h2>Background:<br>I'm working on porting a large legacy application into .net, using CSLA for the business layer.&nbsp;&nbsp; <br><br>This is an intranet app - all users will be using the app from PCs which are on the domain; all users have domain accounts.&nbsp;&nbsp;&nbsp; There are about 2,200 users of the legacy application so we'll have at least that.<br><br>We are building a web UI first, but eventually there will be a Windows Forms or WPF UI that cover certain areas of functionality for different groups of users.&nbsp; <br><br>We're using CSLA 3.01, and .net 3.5.&nbsp; <br><br>The web server communicates with an app server (hosting the business objects) using WCF.&nbsp;&nbsp; <br><br>Database is Oracle.<br><br>As all users have domain accounts, our plan is to use Windows Authentication.&nbsp;&nbsp;&nbsp; <br><br>Questions: <br>I have and have read the majority of the 2005 CSLA book, and both of the subsequent e-books.&nbsp; I'm still confused however about the effect of different settings for CslaAuthentication tag.&nbsp;&nbsp; All of the examples use Forms authentication so I don't know how this plays into Windows Authentication other than the notes in the book about Windows auth means removing the custom principal and identity classes.&nbsp;&nbsp;&nbsp; <br><br>The legacy application has an existing set of tables which contain user names, roles, and a mapping table.&nbsp;&nbsp; I'd like to use those tables if possible to control authorization in the business layer.&nbsp; I've got some code that reads from there now and applies the rules in the business objects, and all is fine.&nbsp; <br><br>Can I mix the two - Win Authentication and custom, db driven authorization?&nbsp;&nbsp; Any gotchas that come to mind?<br><br>The desire is for us to create functionality allowing admins to tweak a role's&nbsp; permissions for areas of the app, so I can't hard code the role checks on the business object methods like in the examples.&nbsp;&nbsp;&nbsp; Mapping BOs to roles in the database just doesn't seem like the thing to do.&nbsp; Has anyone been in the situation where these permissions had to be data driven?<br><br>Or am I thinking too granular - should I do the granular and dynamic authorization at the site map level and do some basic, coarse grained re-authorization in the business objects?<br><br>Lots of questions I know.&nbsp;&nbsp; Thanks!<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 17, 2008</h2><P>CslaAuthentication works much like the ASP.NET Authentication switch in web.config.</P>
<P>That is to say that setting the value to Windows tells CSLA to totally ignore the principal (other than returning it from Csla.ApplicationContext.User). In this mode CSLA assumes Windows (or something) is automatically authenticating the user and creating the principal and performing impersonation across any data portal calls. CSLA is hands-off.</P>
<P>Setting the value to Csla tells CSLA to do its own impersonation for data portal calls, so CSLA will move the principal from client to server on every call. A side-effect is that the principal must inherit from the CSLA base class.</P>
<P>If you want a hybrid, you'd want to use Windows authentication so CSLA is hands-off the principal. But then you'd still need to take steps to ensure that the default WindowsPrincipal is replaced by your custom principal (after Windows authentication/impersonation) so you get the hybrid principal.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, January 17, 2008</h2><P>I use Windows for single sign on - but I am not reading any app level roles or permissions from it.</P>
<P>In my Web app I allow both Windows log-in and standard UID/PWD log-in.</P>
<P>I have a&nbsp;derived class for Principal and Identity and 2 (or more) factory methods to fetch the Identity.</P>
<P>In my other code I check to see if they are using Windows to log in and I trap the networkID and domain values and pass them to my factory method. Then when I log-in the user I validate those values against my app's security database and read out the roles and permissions.</P>
<P>This way they do not have to enter a UID/PWD combination.</P>
<P>If they are not using Windows then they do have to enter these values. And then I do a standard log-in. </P>
<P>The end result of the 2 log-ins is the same - a CSLA principal filled with roles and permissions and user information.</P>
<P>This means that my security DB must have the same networkId and domain values that the user has in Windows. And they must be unique. The same row maps to the UID/PWD combination.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rvlc05 replied on Friday, February 29, 2008</h2><P>Joe,</P>
<P>Could you provide some specifics on your handling this.&nbsp; I'm facing a similar problem and would appreciate some input.</P>
<P>Paul</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, March 03, 2008</h2><P>Paul,</P>
<P>You can drop me a line with more specific questions if you like.</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
