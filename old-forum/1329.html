<html><header><title>Change CslaDataPortalUrl Setting at runtime?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Change CslaDataPortalUrl Setting at runtime?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1329.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>brembot posted on Monday, September 25, 2006</h2><font size="2"><font face="Tahoma">Hello All,<br><br>Does anyone know this? I want to change the <font color="#0000ff">CslaDataPortalUrl </font>at runtime. Why i'm doing this because we have many servers running. We have to setup .net remoting in our application in each server. Each servers has its own <font color="#0000ff">CslaDataPortalUrl </font>Setting. How am i going to achieve this goal without hacking the ApplicationContext of DataPortal. Here's the sample setup below.<br><br><font color="#000080">Click Once deployment (all users can access this and install the application)</font><br><b>http://SharedLocation:6040/publish.htm</b><br><br><font color="#000080">.NET Remoting setup in all servers (New Zealand, Japan, Philippines, Usa, etc...)</font><br><b>MyProject.exe<br></b></font></font><font size="2"><font face="Tahoma"><b>MyProject.dll<br>Csla.dll<br></b></font></font><font size="2"><font face="Tahoma"><b>MyProject</b></font></font><font size="2"><font face="Tahoma"><b>.exe.config<br>Web.config<br><br></b></font></font><font size="2"><font face="Tahoma">Users for <b><font color="#006400">New Zealand</font></b> will connect thru this Url<br></font></font><font size="2"><font face="Tahoma"><font color="#0000ff"><font color="#0000ff">&lt;</font><font color="#a52a2a">add</font> <font color="#ff0000">key</font>=<font color="#000000">"</font>CslaDataPortalUrl<font color="#000000">"</font> <font color="#ff0000">value</font>=<font color="#000000">"</font>http://NewZealand:6040/RemotingPortal.rem<font color="#000000">"</font>/<font color="#0000ff">&gt;</font></font></font></font><br><font size="2"><font face="Tahoma"><br></font></font><font size="2"><font face="Tahoma">Users for </font></font><b><font color="#006400" size="2"><font face="Tahoma">Japan</font></font></b><font size="2"><font face="Tahoma"><b><font color="#006400"> </font></b>will connect thru this Url<br></font></font><font size="2"><font face="Tahoma"><font color="#0000ff"><font color="#0000ff">&lt;</font><font color="#a52a2a">add</font> <font color="#ff0000">key</font>=<font color="#000000">"</font>CslaDataPortalUrl<font color="#000000">"</font> <font color="#ff0000">value</font>=<font color="#000000">"</font>http://Japan:6040/RemotingPortal.rem<font color="#000000">"</font>/<font color="#0000ff">&gt;</font></font></font></font><br><font size="2"><font face="Tahoma"><br></font></font><font size="2"><font face="Tahoma">Users for </font></font><b><font color="#006400" size="2"><font face="Tahoma">Philippines</font></font></b><font size="2"><font face="Tahoma"><b><font color="#006400"> </font></b>will connect thru this Url<br></font></font><font size="2"><font face="Tahoma"><font color="#0000ff"><font color="#0000ff">&lt;</font><font color="#a52a2a">add</font> <font color="#ff0000">key</font>=<font color="#000000">"</font>CslaDataPortalUrl<font color="#000000">"</font> <font color="#ff0000">value</font>=<font color="#000000">"</font>http://Philippines:6040/RemotingPortal.rem<font color="#000000">"</font>/<font color="#0000ff">&gt;</font></font></font></font><br><font size="2"><font face="Tahoma"><br></font></font><font size="2"><font face="Tahoma">Users for </font></font><b><font color="#006400" size="2"><font face="Tahoma">Usa</font></font></b><font size="2"><font face="Tahoma"><b><font color="#006400"> </font></b>will connect thru this Url<br></font></font><font size="2"><font face="Tahoma"><font color="#0000ff"><font color="#0000ff">&lt;</font><font color="#a52a2a">add</font> <font color="#ff0000">key</font>=<font color="#000000">"</font>CslaDataPortalUrl<font color="#000000">"</font> <font color="#ff0000">value</font>=<font color="#000000">"</font>http://Usa:6040/RemotingPortal.rem<font color="#000000">"</font>/<font color="#0000ff">&gt;<br><br><br></font></font></font></font><font size="2"><font face="Tahoma">Thanks,<br>Marlon<br></font></font><font size="2"><font face="Tahoma"><font color="#0000ff"><font color="#0000ff"></font><br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 25, 2006</h2>This has been discussed before on the forum. The data portal channels provided in the book do not support this concept. However, using the information in chapters 4 and 12, you can create your own data portal channel (the WcfChannel on my web site is a useful guide too).<br><br>If I recall the previous threads, it seems to me that one or two people did, in fact, go down that road with success. If you adapt the RemotingProxy to your needs, you can typically have it just call the existing RemotingHost class, and so it isn't really very hard to do. Just copy RemotingProxy to your own assembly, alter it to find the URL using your new scheme and configure the client to use your new class from your assembly.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS replied on Monday, August 13, 2007</h2><P>Hi Rockford and Marlon</P>
<P>&nbsp;</P>
<P>Marlon, if you're still around, would you be kind enough to tell us how did you resolve your problem? Thank you very much.</P>
<P>Rockford, do you mean that in the CSLA\DataPortal\Client\RemotingProxy.cs file, we have to change those lines :</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HttpChannel channel = new HttpChannel(properties, formatter, null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ChannelServices.RegisterChannel(channel, EncryptChannel);</FONT></P>
<P>to choose the server? Or did I misundertand?</P>
<P>&nbsp;</P>
<P>And that can work while the client is running? We need to change the server while the client is running. The idea is that the client can work without interruption if the server goeds down.</P>
<P>Thank you a lot for your help</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS replied on Monday, September 03, 2007</h2><P>Anyone :) ?</P>
<P>&nbsp;</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 03, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RichardETVS:</strong></div><div>
<P>Rockford, do you mean that in the CSLA\DataPortal\Client\RemotingProxy.cs file, we have to change those lines :</P>
<P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HttpChannel channel = new HttpChannel(properties, formatter, null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ChannelServices.RegisterChannel(channel, EncryptChannel);</FONT></P>
<P>to choose the server? Or did I misundertand?</P>
<P></div></BLOCKQUOTE></P>
<P>I mean that you would <EM>copy RemotingProxy.cs into your project</EM> and then alter it as needed to allow selection of different endpoint URLs. You don't need to change CSLA itself to do this.</P>
<P>See Chapter 4 for discussion on how RemotingProxy works. But some pointers are that it gets the URL from the config file - you need to change that somehow. Also, it caches the server proxy and you can't do that if you want to dynamically switch (or you must clear the cache if you change the URL).</P>
<P>The lines you point out probably won't change, no. But many other lines will need to change, and you'll need to figure out&nbsp;how to change the URL at runtime, etc.</P>
<P>Remember that none of <EM>your</EM> code ever has a reference to RemotingProxy. The data portal creates it behind the scenes. So the only real way to communicate with it is through static methods.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, September 03, 2007</h2>Well, if all you need to do is change the setting when the application loads instead of changing it dynamically, you can directly change the url in your app settings like this:<br><br>System.Configuration.ConfigurationManager.AppSettings("CslaDataPortalUrl") = "http://..."<br><br>Doing that before calling the dataportal for the first time will do.<br><br>If you need something more complex that can dynamically change dataportals as you go, you can take a look at <a href="http://www.softwarethinking.com/blogs/xal/archive/2007/04/23/3.aspx">this</a>. It shows you how to use different proxys and you can use the same technique i showed you before to load standard remoting proxies and keep them cached.<br><br>I hope that helps.<br><br>Andr√©s<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
