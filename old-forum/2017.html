<html><header><title>Updated ObjectListView available</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Updated ObjectListView available</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2017.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell posted on Thursday, December 21, 2006</h2>I have published a new version of the ObjectListView to the CSLAcontrib site.<br><br>New features/fixes:<br><ul><li>Improved filtering speed</li><li>Fixed index returned by ListChanged event when adding an item to a filtered list<br></li><li>Improved detection of underlying object type<br></li></ul></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, December 22, 2006</h2><P>Brian,</P>
<P>Thanks for posting this.</P>
<P>I just ran into a problem with detecting the underlying object type for a Csla2 Read Only Collection and was looking to drop you a line about it. If you are open to private emails then please send me one at </P>
<P>jfallon at purchasingnet dot com&nbsp; (relace the words at and dot with the appropriate symbols.)</P>
<P>I will check out the new code ASAP.</P>
<P>Joe</P>
<P>Update: The new code does not work correctly either. The List Property set has code like this:</P><FONT size=2>
<P></FONT><FONT color=#008000 size=2>//JF 12/22/06 - this code does not work for Csla2.ROC.<BR></FONT><FONT color=#008000 size=2>//_indexedType = System.Windows.Forms.ListBindingHelper.GetListItemType(value);<BR></FONT><FONT color=#008000 size=2>//props = System.Windows.Forms.ListBindingHelper.GetListItemProperties(value, null);</P></FONT><FONT size=2>
<P>_indexedType = System.Windows.Forms.</FONT><FONT color=#2b91af size=2>ListBindingHelper</FONT><FONT size=2>.GetListItemType(</FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>);<BR></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (_indexedType.Equals(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>)))<BR>{<BR>props = System.Windows.Forms.</FONT><FONT color=#2b91af size=2>ListBindingHelper</FONT><FONT size=2>.GetListItemProperties(</FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>);<BR></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (props.Count &gt; 0)<BR>{<BR>_indexedType = props[0].ComponentType;<BR>}<BR>}<BR>props = </FONT><FONT color=#2b91af size=2>TypeDescriptor</FONT><FONT size=2>.GetProperties(_indexedType);</P></FONT>
<P>===========================================================</P>
<P>But a few months ago you used code like this (which worked):</P><FONT size=2>
<P>_indexedType = _list.GetType().GetProperty(</FONT><FONT color=#ff00ff size=2>"Item"</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2>[] { </FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2>) }).PropertyType;<BR></FONT>============================================================</P>
<P>Why was it changed?</P>
<P>Have you tested it against Csla2 objects?</P>
<P>============================================================</P>
<P>Here are some values from my BO:<BR>TransROC.TransInfo</P>
<P>This ROC has 2 records in it.<BR>==============================================================================================================<BR>&nbsp;&nbsp;<BR>base<BR>BO.MyReadOnlyBase&lt;BO.TransROC.TransInfo&gt; <BR>{BO.TransROC.TransInfo}</P>
<P>==============================================================================================================</P>
<P>? System.Windows.Forms.ListBindingHelper.GetListItemType(value);</P>
<P>{Name = "IReadOnlyObject" FullName = "Csla2.Core.IReadOnlyObject"}<BR>&nbsp;&nbsp;&nbsp; [System.RuntimeType]: {Name = "IReadOnlyObject" FullName = "Csla2.Core.IReadOnlyObject"}<BR>&nbsp;&nbsp;&nbsp; base {System.Reflection.MemberInfo}: {Name = "IReadOnlyObject" FullName = "Csla2.Core.IReadOnlyObject"}<BR>&nbsp;&nbsp;&nbsp; Assembly: {Csla2, Version=2.1.0.0, Culture=neutral, PublicKeyToken=7cda65b4773872e9}<BR>&nbsp;&nbsp;&nbsp; AssemblyQualifiedName: "Csla2.Core.IReadOnlyObject, Csla2, Version=2.1.0.0, Culture=neutral, PublicKeyToken=7cda65b4773872e9"<BR>&nbsp;&nbsp;&nbsp; Attributes: Public | ClassSemanticsMask | Abstract<BR>&nbsp;&nbsp;&nbsp; BaseType: null<BR>&nbsp;&nbsp;&nbsp; ContainsGenericParameters: false<BR>&nbsp;&nbsp;&nbsp; DeclaringMethod: 'System.Windows.Forms.ListBindingHelper.GetListItemType(value).DeclaringMethod' threw an exception of type 'System.InvalidOperationException'<BR>&nbsp;&nbsp;&nbsp; DeclaringType: null<BR>&nbsp;&nbsp;&nbsp; FullName: "Csla2.Core.IReadOnlyObject"<BR>&nbsp;&nbsp;&nbsp; GenericParameterAttributes: 'System.Windows.Forms.ListBindingHelper.GetListItemType(value).GenericParameterAttributes' threw an exception of type 'System.InvalidOperationException'<BR>&nbsp;&nbsp;&nbsp; GenericParameterPosition: 'System.Windows.Forms.ListBindingHelper.GetListItemType(value).GenericParameterPosition' threw an exception of type 'System.InvalidOperationException'<BR>&nbsp;&nbsp;&nbsp; GUID: {ed6826ef-59b7-3a57-a538-c69ac3002083}<BR>&nbsp;&nbsp;&nbsp; HasElementType: false<BR>&nbsp;&nbsp;&nbsp; IsAbstract: true<BR>&nbsp;&nbsp;&nbsp; IsAnsiClass: true<BR>&nbsp;&nbsp;&nbsp; IsArray: false<BR>&nbsp;&nbsp;&nbsp; IsAutoClass: false<BR>&nbsp;&nbsp;&nbsp; IsAutoLayout: true<BR>&nbsp;&nbsp;&nbsp; IsByRef: false<BR>&nbsp;&nbsp;&nbsp; IsClass: false<BR>&nbsp;&nbsp;&nbsp; IsCOMObject: false<BR>&nbsp;&nbsp;&nbsp; IsContextful: false<BR>&nbsp;&nbsp;&nbsp; IsEnum: false<BR>&nbsp;&nbsp;&nbsp; IsExplicitLayout: false<BR>&nbsp;&nbsp;&nbsp; IsGenericParameter: false<BR>&nbsp;&nbsp;&nbsp; IsGenericType: false<BR>&nbsp;&nbsp;&nbsp; IsGenericTypeDefinition: false<BR>&nbsp;&nbsp;&nbsp; IsImport: false<BR>&nbsp;&nbsp;&nbsp; IsInterface: true<BR>&nbsp;&nbsp;&nbsp; IsLayoutSequential: false<BR>&nbsp;&nbsp;&nbsp; IsMarshalByRef: false<BR>&nbsp;&nbsp;&nbsp; IsNested: false<BR>&nbsp;&nbsp;&nbsp; IsNestedAssembly: false<BR>&nbsp;&nbsp;&nbsp; IsNestedFamANDAssem: false<BR>&nbsp;&nbsp;&nbsp; IsNestedFamily: false<BR>&nbsp;&nbsp;&nbsp; IsNestedFamORAssem: false<BR>&nbsp;&nbsp;&nbsp; IsNestedPrivate: false<BR>&nbsp;&nbsp;&nbsp; IsNestedPublic: false<BR>&nbsp;&nbsp;&nbsp; IsNotPublic: false<BR>&nbsp;&nbsp;&nbsp; IsPointer: false<BR>&nbsp;&nbsp;&nbsp; IsPrimitive: false<BR>&nbsp;&nbsp;&nbsp; IsPublic: true<BR>&nbsp;&nbsp;&nbsp; IsSealed: false<BR>&nbsp;&nbsp;&nbsp; IsSerializable: false<BR>&nbsp;&nbsp;&nbsp; IsSpecialName: false<BR>&nbsp;&nbsp;&nbsp; IsUnicodeClass: false<BR>&nbsp;&nbsp;&nbsp; IsValueType: false<BR>&nbsp;&nbsp;&nbsp; IsVisible: true<BR>&nbsp;&nbsp;&nbsp; MemberType: TypeInfo<BR>&nbsp;&nbsp;&nbsp; Module: {Csla2.dll}<BR>&nbsp;&nbsp;&nbsp; Namespace: "Csla2.Core"<BR>&nbsp;&nbsp;&nbsp; ReflectedType: null<BR>&nbsp;&nbsp;&nbsp; StructLayoutAttribute: null<BR>&nbsp;&nbsp;&nbsp; TypeHandle: {System.RuntimeTypeHandle}<BR>&nbsp;&nbsp;&nbsp; TypeInitializer: null<BR>&nbsp;&nbsp;&nbsp; UnderlyingSystemType: {Name = "IReadOnlyObject" FullName = "Csla2.Core.IReadOnlyObject"}<BR>==============================================================================================================</P>
<P><BR>props&nbsp;{System.ComponentModel.PropertyDescriptorCollection}&nbsp;System.ComponentModel.PropertyDescriptorCollection<BR>&nbsp;Count&nbsp;0&nbsp;int</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Saturday, December 23, 2006</h2>Hi Joe,<br><br>I made that change as it allowed me to get away from depending on an IList implementing an Item property.&nbsp; Arrays do not do that, although I have a special case for arrays.&nbsp; I started using ListBindingHelper as it allowed for design time support.<br><br>I have only ever used this with CSLA 2 because IBindingListView was added in .NET 2.0.&nbsp; I just tried the ObjectListView on a ReadOnlyListBase with a ReadOnlyBase and it worked fine. What type is your indexer on your read only list defined as?&nbsp; The debug messages you provided suggest that it is defined as<br><br>public IReadOnly this[int index]<br>{ get; }<br><br>Also, the code that you pasted suggests that it is not the code that I posted a couple of days ago.<br><br>If you want to send me messages, just use the private message functionality of the boards.&nbsp; It emails me whenever I get a private message.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, December 28, 2006</h2><P>Brian,</P>
<P>I looked for the Private Message link before and missed it. I will drop you a line tomorrow.</P>
<P>BTW, My BO is named:<BR>TransROC.TransInfo</P>
<P>and it has a standard Integer Item property inherited from the framework.</P>
<P>The big problem is that your new code thinks the BO is IReadOnly instead of TransROC.TransInfo.</P>
<P>I have no idea why it is doing that.</P>
<P>I will send you more details in the morning.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, December 30, 2006</h2><P>Brian,</P>
<P>I sent you a PM on this.</P>
<P>The issue is that I have implemented an Interface that includes an overloaded Item Property. See the PM for details.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>maurera replied on Tuesday, January 09, 2007</h2><P class=MsoNormal>Hey Brian, first let me start by thanking you.&nbsp; Many of your posts have lent themselves well to understanding some of the nuances of the CSLA.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>That being said, most of us here at my office are VB .NET developers, and would find it very useful to have a VB version of your <SPAN>ObjectListView.<SPAN>&nbsp; </SPAN></SPAN>It appears that some of the CSLA Contrib code has a VB version, but I was unable to locate a VB version of your ObjectListView.<SPAN>&nbsp; </SPAN>Do you know of anyone that may have such a version?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Tuesday, January 09, 2007</h2>There is currently not a VB.NET version.&nbsp; Someone could port it (a lot of code) or you can create a second project in your CSLA solution for C# code, compile and just include the second assembly in your applications.<br><br>As the ObjectListView has stabilised, I could port it, but that probably will not happen for a couple of weeks at least.&nbsp; So you may want to start with the C# version and use the VB version when it becomes available.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>maurera replied on Tuesday, January 09, 2007</h2><P>You would do that for us lowly VB.NET developers ;-)</P>
<P>You, my friend, truly are a rock star.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gort replied on Wednesday, May 09, 2007</h2><P>Where can I download the latest ObjectListView classes?&nbsp; I found them for 1.5.x, is this the latest version?&nbsp; For some reason I can't find any information on the ObjectListView classes on the contrib site.</P>
<P>Thanks.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Wednesday, May 09, 2007</h2><a href="http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx">http://www.codeplex.com/CSLAcontrib/SourceControl/ListDownloadableCommits.aspx</a><br>Go there and download the most recent version.&nbsp; You should be able to find the necessary files in there.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Saturday, June 30, 2007</h2><P>Brian,</P>
<P>I had an instance of an ObjectListView inside one of my BOs and that broke its ability to be serialized. Is there any reason the ObjectListView is not marked as Serializable?</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Saturday, June 30, 2007</h2>he DataView did not have it, so I did not add it to the ObjectListView.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Sunday, July 01, 2007</h2><P>OK.<BR>I worked around the issue anyway.</P>
<P>===================================================================</P>
<P>I found a small problem with the ObjectListView this morning.</P>
<P>The ObjectViewLibrary is not sorting the way I expect it to.</P>
<P>If all the values are different then it sorts perfectly.</P>
<P>But if some of the values on the original collection are “tied” with each other (e.g. all have the same code) then the sorted view of the collection had the ties in inverted order.</P>
<P>For example:<BR>Original collection has 6 BOs with codes:&nbsp; A,B, C(1), C(2), C(3), D.</P>
<P>The sorted collection inverts the C’s so it looks like this:&nbsp; A,B, C(3), C(2), C(1), D.</P>
<P>This makes new rows on the screen get added above existing rows and then screws up databinding as the indexes are out of sequence between the original collection and the sorted list.</P>
<P>I modified the code so that ties are placed at the end of the list and now the sorted list is in the same sequence as the original list.<BR></P>
<P>In the method <FONT size=2>InsertInOrder I changed:</FONT></P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (comparison == 0)<BR>{<BR></FONT><FONT color=#008000 size=2>//_sortIndex.Insert(testIndex, item);<BR></FONT><FONT color=#008000 size=2>//return testIndex;</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>//By changing it to continue comparing tied objects we should be able to keep the right order.<BR></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.InsertInOrder(item, testIndex + 1, highIndex);<BR>}</P>
<P></P></FONT>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Sunday, July 01, 2007</h2>Thanks.&nbsp; I will add this to CSLAcontrib when I get a chance.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
