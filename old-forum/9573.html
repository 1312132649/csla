<html><header><title>How to invalidate Dependancy rule for Silverlight unit test?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to invalidate Dependancy rule for Silverlight unit test?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9573.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rault posted on Friday, September 24, 2010</h2><p>Has anyone tried setting a Dependency property in your business rules and then tried to unit test the rule? I&#39;m having trouble figuring this out because we already have a rule that the dependency is triggering. <br /><br />What I need to do in my Silverlight unit test is disable the first rule, set the first property so that it violates the rule, then enable the first rule again without running it. After that I can set my second property that has the first property as a dependency. Since the dependency exists it should trigger the rules for the first property proving that the first properties value is invalid. <br /><br />Like this in the BO class:<br /><br />public static PropertyInfo&lt;int&gt; PropOneProperty = RegisterProperty&lt;int&gt;(c =&gt; c.PropOne);<br />public int PropOne<br />{<br />&nbsp;&nbsp;&nbsp; get { return GetProperty(PropOneProperty); }<br />&nbsp;&nbsp;&nbsp; private set { SetProperty(PropOneProperty, value); }<br />}<br /><br />public static PropertyInfo&lt;int&gt; PropTwoProperty = RegisterProperty&lt;int&gt;(c =&gt; c.PropTwo);<br />public int PropTwo<br />{<br />&nbsp;&nbsp;&nbsp; get { return GetProperty(PropTwoProperty); }<br />&nbsp;&nbsp;&nbsp; private set { SetProperty(PropTwoProperty, value); }<br />}<br /><br />protected override void AddBusinessRules()<br />{<br />&nbsp;&nbsp;&nbsp; base.AddBusinessRules();<br />&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new IsPropOneDuplicate(PropOne)); //just checks to see if it already exists in the mock data<br />&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.Dependency(PropOne, PropTwo)); //if PropTwo gets changed then we run the rules for PropOne as well<br />}<br /><br />And like this in the Silverlight unit test:<br /><br />[TestMethod, Asynchronous]<br />public void DependancyTest()<br />{<br />&nbsp;&nbsp;&nbsp; Project.ViewModels.EditViewModel viewModel = null;<br />&nbsp;&nbsp;&nbsp; Login();<br />&nbsp;&nbsp;&nbsp; EnqueueConditional(() =&gt; _loginComplete); //class bool set from Login method<br />&nbsp;&nbsp;&nbsp; EnqueueCallback(() =&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // construct from mock data<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewModel = new Project.ViewModels.EditViewModel(1);<br />&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; EnqueueConditional(() =&gt; !viewModel.IsBusy &amp;&amp; viewModel.Model != null);<br />&nbsp;&nbsp;&nbsp; EnqueueCallback(() =&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.&nbsp;&nbsp;&nbsp; Create a valid object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.&nbsp;&nbsp;&nbsp; Turn off the duplicate PropOne rule temporarily (how?)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.&nbsp;&nbsp;&nbsp; Set its PropOne duplicate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.&nbsp;&nbsp;&nbsp; Enable the duplicate rule but don&rsquo;t run it (how?)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.&nbsp;&nbsp;&nbsp; Set the PropTwo to a new ID, which should then run the duplicate PropOne rule invalidating the object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //set property, should fire Dependancy rule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&lt;-- turn off duplicate rule here<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewModel.Model.PropOne = &quot;Test Name&quot;; //a duplicate name in the mock data for PropOne<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&lt;-- turn on duplicate rule here but don&#39;t run it<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewModel.Model.PropTwo = 1; //a new id for PropTwo &lt;-- dependency rule should fire and make this object invalid because the PropOne is duplicate<br />&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; EnqueueConditional(() =&gt; !viewModel.IsBusy &amp;&amp; viewModel.Model.PropOne == &quot;Test Name&quot;);<br />&nbsp;&nbsp;&nbsp; EnqueueCallback(() =&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string brokenRules = viewModel.Model.BrokenRulesCollection.ToString();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //it&#39;s not valid<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.IsFalse(viewModel.Model.IsValid); <br />&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; EnqueueTestComplete();<br />}</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, September 24, 2010</h2><p>Hi, </p>
<p>You have the parameters in the wrong order for Dependency rule:</p>
<p><i>&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.Dependency(PropOne,
 PropTwo)); //if PropTwo gets changed then we run the rules for PropOne 
as wel</i></p>
<p>This line actually means:<b><br />When PropOne changes the rules for PropTwo must also be run</b></p>
<p>You can even specify multiple properties like this<br /><i>new CommonRules.Dependency(PropOne,
 PropTwo, PropThree, PropFour));</i></p>
<p>result:&nbsp; When PropOne changes - check rules for properties PropTwo, PropThree and PropFour. </p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Monday, September 27, 2010</h2><p>Hi, </p>
<p>Back to your orignal question -&nbsp; How to disable rule checking:</p>
<p>

<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cc7832;">var</span>&nbsp;icr <span style="font-weight:400;">=</span>&nbsp;(<span style="color:#6897bb;">ICheckRules</span>) viewModel.Model;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ic<span style="font-weight:400;">r.</span>SuppressRuleChecking();<br /><br />      // set the properties of Model <br />      // No rules will be exected <br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ic<span style="font-weight:400;">r.</span>ResumeRuleChecking();<br />      // set property here - rules wll be called <br /><br />      // check valid/invalid<br /><br /></pre>
</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rault replied on Tuesday, September 28, 2010</h2><p>Outstanding, thank you!</p>
<p>I hope the new book comes out ahead of schedule.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
