<html><header><title>CSLA 4 - using LoadProperty in Child_Fetch</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4 - using LoadProperty in Child_Fetch</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9931.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mr X posted on Tuesday, January 11, 2011</h2><p>Hello all,</p>
<p>I have a question regarding database access in the Child_Fetch method.&nbsp; </p>
<p>I have a root object containing a NVL which is loaded in the DataPortal_Fetch using the following statement (in bold):</p>
<p><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">private</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> </span><span style="COLOR:blue;">void</span><span style="color:#000000;"> DataPortal_Fetch(</span><span style="COLOR:#2b91af;">RootEditUserCriteria</span><span style="color:#000000;"> criteria)</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:green;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">//// TODO: load values</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (</span><span style="COLOR:blue;">var</span><span style="color:#000000;"> ctx = </span><span style="COLOR:#2b91af;">ConnectionManager</span><span style="color:#000000;">&lt;</span><span style="COLOR:#2b91af;">SqlConnection</span><span style="color:#000000;">&gt;.GetManager(</span><span style="COLOR:#a31515;">&quot;MyConnection&quot;</span><span style="color:#000000;">))</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (</span><span style="COLOR:blue;">var</span><span style="color:#000000;"> cm = ctx.Connection.CreateCommand())</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt 1in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.CommandType = System.Data.</span><span style="COLOR:#2b91af;">CommandType</span><span style="color:#000000;">.StoredProcedure;</span></span></p>
<p style="MARGIN:0in 0in 0pt 1in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.CommandText = </span><span style="COLOR:#a31515;">&quot;MyProcedureName_Fetch&quot;</span><span style="color:#000000;">;</span></span></p>
<p style="MARGIN:0in 0in 0pt 1in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.Parameters.AddWithValue(</span><span style="COLOR:#a31515;">&quot;@MyParam&quot;</span><span style="color:#000000;">, criteria.MyParam);</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="DISPLAY:none;FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;mso-hide:all;"><span style="mso-tab-count:1;"></span><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="COLOR:blue;">using</span><span style="color:#000000;"> (</span><span style="COLOR:blue;">var</span><span style="color:#000000;"> dr = </span><span style="COLOR:blue;">new</span><span style="color:#000000;"> </span><span style="COLOR:#2b91af;">SafeDataReader</span><span style="color:#000000;">(cm.ExecuteReader()))</span></span></p>
<p style="MARGIN:0in 0in 0pt 1in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt 1.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">dr.Read();</span></span></p>
<p style="MARGIN:0in 0in 0pt 1.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (BypassPropertyChecks)</span></span></p>
<p style="MARGIN:0in 0in 0pt 1.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">Id = dr.GetInt32(</span><span style="COLOR:#a31515;">&quot;ID&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">ProfileID = dr.GetInt32(</span><span style="COLOR:#a31515;">&quot;ProfileID&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">UserName = dr.GetString(</span><span style="COLOR:#a31515;">&quot;DisplayName&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">LoginName = dr.GetString(</span><span style="COLOR:#a31515;">&quot;LoginName&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">LastUpdated = dr.GetSmartDate(</span><span style="COLOR:#a31515;">&quot;LastUpdated&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 2in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">UpdatedBy = dr.GetString(</span><span style="COLOR:#a31515;">&quot;UpdatedBy&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="MARGIN:0in 0in 0pt 1.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt 1in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:green;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">//Load NVL</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><strong><span style="color:#000000;">LoadProperty(RoleListProperty, Business.</span><span style="COLOR:#2b91af;">NVLSecurityProfile</span></strong><span style="color:#000000;"><strong>.GetNVLSecurityProfile(criteria.Language))</strong>;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>
<span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
</font></font></font></font></font></font></span></span><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></font></font></font></font></span></span><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></font></font></font></span></span><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></font></font></span></span><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></font></span></span><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></span></span></span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
<p>&nbsp;Tthis&nbsp;works fine when I&nbsp;retrieve my root object directly.&nbsp; However, my root object is also a &quot;switchable object&quot; with dual factory&nbsp;and data access methods.&nbsp; therefore I also call &nbsp;</p>
<p style="MARGIN:0in 0in 0pt 0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><strong><span style="color:#000000;">LoadProperty(RoleListProperty, Business.</span><span style="COLOR:#2b91af;">NVLSecurityProfile</span></strong><span style="color:#000000;"><strong>.GetNVLSecurityProfile(criteria.Language))</strong>;</span></span></p>
<p>&nbsp;in the Child_Fetch method of the root (when used as a list item) as followed:</p>
<p class="MsoNormal"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">private</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> </span><span style="COLOR:blue;">void</span><span style="color:#000000;"> Child_Fetch(</span><span style="COLOR:#2b91af;">ChildEditUserCriteria</span><span style="color:#000000;"> Criteria)</span></span>
<p>&nbsp;</p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (BypassPropertyChecks)</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.Id = Criteria.ID;</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.UserName = Criteria.UserName;</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.ProfileID = Criteria.ProfileID;</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.LoginName = Criteria.LoginName;</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.LastUpdated = Criteria.LastUpdated;</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">this</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">.UpdatedBy = Criteria.UpdatedBy;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="mso-spacerun:yes;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="COLOR:green;">//Load NVL</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><strong><span style="color:#000000;">LoadProperty(RoleListProperty, </span><span style="COLOR:#2b91af;">NVLSecurityProfile</span><span style="color:#000000;">.GetNVLSecurityProfile(Criteria.Language));</span></strong></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"></span></span>&nbsp;</p>
<font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"></span></span></p>
</font></font></font></span><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></font></span><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;</p>
</font></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal">&nbsp;For some reason, the trace goes as far as calling the database access code in the NVL&#39;s DataPortal_Fetch bu breaks when executing the cm.ExecuteReader.</p>
<p>&nbsp;</p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">private</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> </span><span style="color:blue;">void</span><span style="color:#000000;"> DataPortal_Fetch(</span><span style="color:#2b91af;">SingleCriteria</span><span style="color:#000000;">&lt;</span><span style="color:#2b91af;">NVLSecurityProfile</span><span style="color:#000000;">, </span><span style="color:blue;">int</span><span style="color:#000000;">&gt; criteria)</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">RaiseListChangedEvents = </span><span style="color:blue;">false</span><span style="color:#000000;">;</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">IsReadOnly = </span><span style="color:blue;">false</span><span style="color:#000000;">;</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:green;font-family:Consolas;mso-bidi-font-family:Consolas;">//// TODO: load values</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (</span><span style="color:blue;">var</span><span style="color:#000000;"> ctx = </span><span style="color:#2b91af;">ConnectionManager</span><span style="color:#000000;">&lt;</span><span style="color:#2b91af;">SqlConnection</span><span style="color:#000000;">&gt;.GetManager(</span><span style="color:#a31515;">&quot;MyConnection&quot;</span><span style="color:#000000;">))</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (</span><span style="color:blue;">var</span><span style="color:#000000;"> cm = ctx.Connection.CreateCommand())</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.CommandType = System.Data.</span><span style="color:#2b91af;">CommandType</span><span style="color:#000000;">.StoredProcedure;</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.CommandText = </span><span style="color:#a31515;">&quot;stp_NameValueList_Fetch&quot;</span><span style="color:#000000;">;</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.Parameters.AddWithValue(</span><span style="color:#a31515;">&quot;@ListName&quot;</span><span style="color:#000000;">, </span><span style="color:#a31515;">&quot;ROLES&quot;</span><span style="color:#000000;">);</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">cm.Parameters.AddWithValue(</span><span style="color:#a31515;">&quot;@Language&quot;</span><span style="color:#000000;">, criteria.Value);</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">using</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (</span><span style="color:blue;">var</span><span style="color:#000000;"> dr = </span><span style="color:blue;">new</span><span style="color:#000000;"> </span><span style="color:#2b91af;">SafeDataReader</span><span style="color:#000000;">(<strong>cm.ExecuteReader()</strong>))</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="margin:0in 0in 0pt 1.5in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;color:blue;font-family:Consolas;mso-bidi-font-family:Consolas;">while</span><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (dr.Read())</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></p>
<p style="margin:0in 0in 0pt 1.5in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt 147pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">Add(</span><span style="color:blue;">new</span><span style="color:#000000;"> </span><span style="color:#2b91af;">NameValueListBase</span><span style="color:#000000;">&lt;</span><span style="color:blue;">int</span><span style="color:#000000;">, </span><span style="color:blue;">string</span><span style="color:#000000;">&gt;.</span><span style="color:#2b91af;">NameValuePair</span><span style="color:#000000;">(dr.GetInt32(</span><span style="color:#a31515;">&quot;Key&quot;</span><span style="color:#000000;">), dr.GetString(</span><span style="color:#a31515;">&quot;Value&quot;</span><span style="color:#000000;">)));</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></p>
<p style="margin:0in 0in 0pt 1in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="margin:0in 0in 0pt 0.5in;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">IsReadOnly = </span><span style="color:blue;">true</span><span style="color:#000000;">;</span></span></p>
<p style="margin:0in 0in 0pt;text-indent:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">RaiseListChangedEvents = </span><span style="color:blue;">true</span><span style="color:#000000;">;</span></span></p>
<p style="margin:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="margin:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;color:#000000;font-family:Times New Roman;">&nbsp;</span></p>
<font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p>&nbsp;</p>
</font></font></font></span><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p>&nbsp;</p>
</font></font></span><font size="2" color="#0000ff" face="Consolas">
<p>&nbsp;</p>
</font></span></p>
<p>
<p>&nbsp;</p>
<p>&nbsp;</p>
&nbsp;</p>
<p>Is this error happening because I &quot;call the database in a Child_Fetch&quot; method&nbsp;in my root object (even through a separate object)?&nbsp;&nbsp;If so, what would be the simplest way to load the NVL along&nbsp;with the root to eliminate the number of calls to the server?&nbsp; I considered lazy loading the list within the root&#39;s list property but I am not sure&nbsp;how this will impact my existing code&nbsp;(MVVM, databinding).&nbsp; Actually, at this stage, I am open to any suggestions.</p>
<p>Any help or guidelines&nbsp;would be greatly appreciated.&nbsp; &nbsp; Thanks,</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, January 11, 2011</h2><p>What type of exception do you get?</p>
<p>Does your connecttion string set MultipleActiveResultSets (MARS) to true?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mr X replied on Tuesday, January 11, 2011</h2><p>Hi JonnyBee, thanks for the quick reply.</p>
<p>No I do not explicitly set MultipleActiveResultSets anywhere in my code.&nbsp;&nbsp;The EditUserList DataPortal_Fetch&nbsp;only returns&nbsp;1 recordset,&nbsp;the list of users.&nbsp;Since the EditUser is a root, I need (maybe not if I can find a better way) to return a list of profiles&nbsp;(NVL) and eventually a list of destinations associated to the user which I expect to retrieve on the root&#39;s DataPortal_Fetch.&nbsp; But the EditUser can also be accessed through a list, therefore the use of its Child_Fetch.&nbsp; The behaviour of the EditUser should remain the same in both cases.&nbsp; Maybe I am wrong.</p>
<p>Here is the error message I am getting when I put a break point in my EditUserList client side factory method as such:</p>
<p>&nbsp;<span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">public</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> </span><span style="COLOR:blue;">static</span><span style="color:#000000;"> </span><span style="COLOR:blue;">void</span><span style="color:#000000;"> GetEditUserList(</span><span style="COLOR:blue;">int</span><span style="color:#000000;"> Language, </span><span style="COLOR:#2b91af;">EventHandler</span><span style="color:#000000;">&lt;</span><span style="COLOR:#2b91af;">DataPortalResult</span><span style="color:#000000;">&lt;</span><span style="COLOR:#2b91af;">EditUserList</span><span style="color:#000000;">&gt;&gt; callback)</span></span>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">var</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> dp = </span><span style="COLOR:blue;">new</span><span style="color:#000000;"> </span><span style="COLOR:#2b91af;">DataPortal</span><span style="color:#000000;">&lt;</span><span style="COLOR:#2b91af;">EditUserList</span><span style="color:#000000;">&gt;();</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">dp.FetchCompleted += (o, e) =&gt;</span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">{</span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><strong><span style="text-decoration:underline;"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">if</span><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"> (e.Error == </span><span style="COLOR:blue;">null</span><span style="color:#000000;">)</span></span></span></strong></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>
<p style="MARGIN:0in 0in 0pt 0.5in;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">callback(o, e);</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></p>
<p style="MARGIN:0in 0in 0pt;TEXT-INDENT:0.5in;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">dp.BeginFetch(</span><span style="COLOR:blue;">new</span><span style="color:#000000;"> </span><span style="COLOR:#2b91af;">SingleCriteria</span><span style="color:#000000;">&lt;</span><span style="COLOR:#2b91af;">EditUserList</span><span style="color:#000000;">,</span><span style="COLOR:blue;">int</span><span style="color:#000000;">&gt;(Language));</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">}</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;"><span style="color:#000000;">&nbsp;</span></span></p>
<p style="MARGIN:0in 0in 0pt;mso-layout-grid-align:none;" class="MsoNormal"><span style="FONT-SIZE:9.5pt;COLOR:blue;FONT-FAMILY:Consolas;mso-bidi-font-family:Consolas;">#endregion</span></p>
<font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal"><span style="font-size:small;color:#000000;font-family:Times New Roman;">&nbsp;</span></p>
</font></font></font></span><font size="2" color="#0000ff" face="Consolas"><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal">&nbsp;</p>
</font></font></span><font size="2" color="#0000ff" face="Consolas">
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal">&nbsp;</p>
</font></span></p>
<p style="MARGIN:0in 0in 0pt;" class="MsoNormal">&nbsp;</p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"></span></span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>e.Error =</p>
<p>{Csla.DataPortalException: DataPortal.Fetch failed (ChildDataPortal.Fetch failed on the server)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 170<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.GetNVLSecurityProfile(Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 22<br />&nbsp;&nbsp; at Business.EditUser.Child_Fetch(ChildEditUserCriteria Criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 365<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 126<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 155<br />&nbsp;&nbsp; at Csla.DataPortal.FetchChild[T](Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 842<br />&nbsp;&nbsp; at Business.EditUser.GetEditUserChild(Int32 ID, String UserName, String LoginName, Int32 ProfileId, SmartDate LastUpdated, String UpdatedBy, Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 41<br />&nbsp;&nbsp; at Business.EditUserList.DataPortal_Fetch(SingleCriteria`2 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUserList\EditUserList.Server.cs:line 46<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.SilverlightRequestProcessor.Fetch(SilverlightCriteriaRequest request) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\Hosts\Silverlight\SilverlightRequestProcessor.cs:line 146<br />Csla.Reflection.CallMethodException: DataPortal_Fetch method call failed<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 170<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.GetNVLSecurityProfile(Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 22<br />&nbsp;&nbsp; at Business.EditUser.Child_Fetch(ChildEditUserCriteria Criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 365<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 126<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 155<br />&nbsp;&nbsp; at Csla.DataPortal.FetchChild[T](Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 842<br />&nbsp;&nbsp; at Business.EditUser.GetEditUserChild(Int32 ID, String UserName, String LoginName, Int32 ProfileId, SmartDate LastUpdated, String UpdatedBy, Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 41<br />&nbsp;&nbsp; at Business.EditUserList.DataPortal_Fetch(SingleCriteria`2 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUserList\EditUserList.Server.cs:line 46<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />Csla.DataPortalException: ChildDataPortal.Fetch failed on the server<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 170<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.GetNVLSecurityProfile(Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 22<br />&nbsp;&nbsp; at Business.EditUser.Child_Fetch(ChildEditUserCriteria Criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 365<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 126<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 155<br />&nbsp;&nbsp; at Csla.DataPortal.FetchChild[T](Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 842<br />&nbsp;&nbsp; at Business.EditUser.GetEditUserChild(Int32 ID, String UserName, String LoginName, Int32 ProfileId, SmartDate LastUpdated, String UpdatedBy, Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 41<br />&nbsp;&nbsp; at Business.EditUserList.DataPortal_Fetch(SingleCriteria`2 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUserList\EditUserList.Server.cs:line 46<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />Csla.Reflection.CallMethodException: Child_Fetch method call failed<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 170<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.GetNVLSecurityProfile(Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 22<br />&nbsp;&nbsp; at Business.EditUser.Child_Fetch(ChildEditUserCriteria Criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 365<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\ChildDataPortal.cs:line 126<br />Csla.DataPortalException: DataPortal.Fetch failed (<strong>There is already an open DataReader associated with this Command which must be closed first.</strong>)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 245<br />&nbsp;&nbsp; at Csla.DataPortal.Fetch[T](Object criteria) in C:\Visual Studio Projects\csla\40\Source\Csla\DataPortal.cs:line 170<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.GetNVLSecurityProfile(Int32 Language) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 22<br />&nbsp;&nbsp; at Business.EditUser.Child_Fetch(ChildEditUserCriteria Criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\User\EditUser\EditUser.Server.cs:line 365<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />Csla.Reflection.CallMethodException: DataPortal_Fetch method call failed<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 549<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 413<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject.CallMethod(String method, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\LateBoundObject.cs:line 93<br />&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.Fetch(Type objectType, Object criteria, DataPortalContext context) in C:\Visual Studio Projects\csla\40\Source\Csla\Server\SimpleDataPortal.cs:line 133<br />System.InvalidOperationException: <strong>There is already an open DataReader associated with this Command which must be closed first.<br /></strong>&nbsp;&nbsp; at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)<br />&nbsp;&nbsp; at System.Data.SqlClient.SqlCommand.ExecuteReader()<br />&nbsp;&nbsp; at Business.NVLSecurityProfile.DataPortal_Fetch(SingleCriteria`2 criteria) in C:\CSLA\CSLA Projects\CSLA 4.0.1 Projects\ARDAppMaintenance\Business.Server\Profiles\NVL\NVLSecurityProfile.Server.cs:line 52<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Object[] parameters) in C:\Visual Studio Projects\csla\40\Source\Csla\Reflection\MethodCaller.cs:line 545<br />}</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>I just spotted this message (in bold above in the error description).&nbsp;&nbsp;&nbsp;This should not be the case since both the EditUserList and the NVL have their own statement (see below).&nbsp; However, I suspect CreateCommand does not create a new command if one is currently opened (as described in the message above).&nbsp;</p>
<p>using<span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> (</span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">var</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> cm = ctx.Connection.CreateCommand())</span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p>
<p>&nbsp;And since the DataReader (or the command)&nbsp;is opened by the parent, the child can not reuse it. This may be the reason why I should not use Child_Fetch.&nbsp;&nbsp;So if I can not use the&nbsp;Child_Fetch of the EditUser (Switchable Root object with dual factory and data access methods) to access the server to load my root&#39;s child lists,&nbsp;what is the work around? Can I force the use of DataPortal_Fetch of my root object by its parent list?<span style="font-size:x-small;color:#0000ff;font-family:Consolas;">&nbsp;</span></p>
<p>Mr X</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, January 11, 2011</h2><p>The problem is that you are reusing the same connection and that connection already has an open DataReader. </p>
<p>So you should set MultipleActiveresultSets=true in your connection string.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mr X replied on Wednesday, January 12, 2011</h2><p>This was indeed the reason the Child_Fetch LoadProperty() was generating this error.&nbsp; it works fine now. &nbsp;Many thanks, your help was very valuable (especially since&nbsp;this is a SQL setting and not CSLA implementation).&nbsp; </p>
<p>Problem solved.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
