<html><header><title>FieldManager Errors</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>FieldManager Errors</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6640.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AndrewBurns posted on Thursday, March 19, 2009</h2>I have a rather strange issue that I am not sure how it is occurring.<br /><br />I am running 3.6.1 and all of the sudden the FieldManager is returning incorrect FieldData instances.<br /><br />Has anyone else experienced anything like this?  If I am able to isolate it then I will write a test and patch it.<br /><br />Andrew</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AndrewBurns replied on Thursday, March 19, 2009</h2>OK long story short, PEBKAC.<br /><br />Turns out I was registering the property on the wrong type and I am using a custom property loader that requires the class type to be correct otherwise I probably wouldn't have noticed.<br /><br />To help prevent this in the future and to clean up property registrations I wrote some methods on my BusinessBase class that could easily be put on Csla.BusinessBase:<br /><br /><br />		protected static PropertyInfo<P> RegisterProperty<P>(PropertyInfo<P> info)<br />		{<br />			Type objectType = typeof(T);<br />			return RegisterProperty<P>(objectType, info);<br />		}<br /><br /><br />		protected static PropertyInfo<P> RegisterProperty<P>(string name)<br />		{<br />			PropertyInfo<P> info = new PropertyInfo<P>(name);<br />			return RegisterProperty(info);<br />		}		<br /><br /><br />		protected static PropertyInfo<P> RegisterProperty<P>(string name, string friendlyName)<br />		{<br />			PropertyInfo<P> info = new PropertyInfo<P>(name, friendlyName);<br />			return RegisterProperty(info);<br />		}<br /><br /><br />		protected static PropertyInfo<P> RegisterProperty<P>(string name, P defaultValue)<br />		{<br />			PropertyInfo<P> info = new PropertyInfo<P>(name, "", defaultValue);<br />			return RegisterProperty(info);<br />		}<br /><br /><br />		protected static PropertyInfo<P> RegisterProperty<P>(string name, string friendlyName, P defaultValue)<br />		{<br />			PropertyInfo<P> info = new PropertyInfo<P>(name, friendlyName, defaultValue);<br />			return RegisterProperty(info);<br />		}</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, March 19, 2009</h2><P>3.6.2 throws an exception if you attempt to register a property for a type that's already been used.</P>
<P>That's about as far as I can go, because it is totally legal to register properties for one class from within another class (there's a thread about this that's active right now actually).</P>
<P>In all cases (except CriteriaBase and CslaIdentity subclasses) I recommend people use the proper overload of RegisterProperty() - that doesn't accept the object type:</P>
<P>RegisterProperty&lt;string&gt;(c =&gt; c.Name);</P>
<P>or</P>
<P>RegisterProperty&lt;string&gt;(new PropertyInfo&lt;string&gt;("Name"));</P>
<P>Skip the typeof() parameter and let the compiler do the work for you to make sure the right type is being used.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
