<html><header><title>Debugging Editlevels using Hierarchy</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Debugging Editlevels using Hierarchy</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4613.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlabar posted on Thursday, April 03, 2008</h2><P>I seem to have frequent issues with edit levels not being kept in sync.&nbsp; VS can show you the edit level on an object, but it gets annoying having to search through and get the protected property for each object that I'm concerened about in my BO hierachy.</P>
<P>As a helpful solution, I have created these Extension methods to get the edit level of an object, and the edit level of all objects within this object.&nbsp;&nbsp; Now in VS, I can just call BO.GetEditLevelHierachy, and see the edit level of all objects in the collection.</P>
<P>Please use at your own risk, and please submit anything I've done wrong.&nbsp; This is my first experiance with using Reflection and I didn't put much effort into cleaning it up.&nbsp; The Output should look something like:</P>
<P>&lt;Namespace&gt;.&lt;Class Name&gt;:&lt;edit level&gt;</P>
<P>BusinessObjects.CustomerWorkflowSteps:1<BR>&nbsp;&nbsp;&nbsp;BusinessObjects.CustomerWorkflowStep:2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessObjects.CustomerWorkflowStepEvaluations:1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessObjects.CustomerWorkflowStepServiceActions:1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessObjects.CustomerWorkflowStepEscalations:1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BusinessObjects.CustomerWorkflowStepRoles:1<BR></P>
<P>Enjoy!</P>
<P><img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>&nbsp;</P>
<P><FONT face=Arial>public static string GetEditLevelHierarchy(this Csla.Core.IBusinessObject root){<BR>&nbsp;&nbsp;&nbsp; string message = "";</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp; message = root.GetType().FullName + ":" + root.GetEditLevel();<BR>&nbsp;&nbsp;&nbsp; message += GetChildEditLevelHierarchy(root, 0);</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp; return message;<BR>}</FONT></P>
<P><FONT face=Arial>public static string GetEditLevel(this Csla.Core.IBusinessObject obj) {<BR>&nbsp;&nbsp;&nbsp; System.Reflection.MethodInfo theMethod = obj.GetType().GetProperty("EditLevel", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance).GetGetMethod(true);<BR>&nbsp;&nbsp;&nbsp; return ((int)theMethod.Invoke(obj, null)).ToString();<BR>}</FONT></P>
<P><FONT face=Arial>private static string GetChildEditLevelHierarchy(this Csla.Core.IBusinessObject parent, int tabLevel) {<BR>&nbsp;&nbsp;&nbsp; string message = "";<BR>&nbsp;&nbsp;&nbsp; string tab = "\n" + GetTab(tabLevel);<BR>&nbsp;&nbsp;&nbsp; System.Reflection.PropertyInfo[] properties = parent.GetType().GetProperties(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance);</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp; foreach (System.Reflection.PropertyInfo property in properties) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (property.Name) {</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case "Item":<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Handle each Child in my collection<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int count = (int)parent.GetType().GetProperty("Count", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance).GetGetMethod(false).Invoke(parent, null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; count; i++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.Core.IBusinessObject child = (Csla.Core.IBusinessObject)parent.GetType().GetProperty("Item", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance).GetGetMethod(false).Invoke(parent, new object[1] { i++ });<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Get Child Edit Level<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message += tab + child.GetType().FullName + ":" + ((Csla.Core.IBusinessObject)child).GetEditLevel();</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Get Child Hierarchy<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message += GetChildEditLevelHierarchy(child, tabLevel + 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case "BrokenRulesCollection":<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Skip<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object value = property.GetGetMethod(true).Invoke(parent, null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (value != null) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type propertyType = value.GetType();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (propertyType.GetInterface(typeof(Csla.Core.IBusinessObject).FullName) != null) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Get Edit Level<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message += tab + value.GetType().FullName + ":" + ((Csla.Core.IBusinessObject)value).GetEditLevel();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (propertyType.GetInterface(typeof(Csla.Core.IParent).FullName) != null) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message += GetChildEditLevelHierarchy((Csla.Core.IBusinessObject)value, tabLevel + 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</FONT></P>
<P><FONT face=Arial>&nbsp;&nbsp;&nbsp; return message;<BR>}</FONT></P>
<P><FONT face=Arial>private static string GetTab(int tabLevel) {<BR>&nbsp;&nbsp;&nbsp; string tab = "";<BR>&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt;= tabLevel; i++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tab += "\t";<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; return tab;<BR>}</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DavidP replied on Wednesday, November 18, 2009</h2>Thanks for this! I used this while debugging my own EditLevel woes.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
