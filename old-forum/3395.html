<html><header><title>channelsink error caused by issue with memorystream object passing accross remoting boundary</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>channelsink error caused by issue with memorystream object passing accross remoting boundary</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3395.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>phillipjohnson posted on Friday, August 17, 2007</h2><P>Hi,</P>
<P>I am using CSLA set up to use dotnet remoting with a binary formatter.</P>
<P>I have a property that returns a memorystream that has had a file loaded <BR>into it.</P>
<P>When I try to access this property though I get an error regarding "the <BR>proxy has no channel sink....[]...or no suitable Client channel to talk to <BR>the server."</P>
<P>I have investigated a bit and have come to the conclusion that the <BR>memorystream object can itself be serialized with a binary formatter, but <BR>when it is deserialized it throws an exception stating that </P>
<P>"End of Stream encountered before parsing was completed."</P>
<P>Can anybody suggest a way around this, or indeed a different way than the <BR>memorystream to pass file data trhough remoting boundaries using the <BR>binaryformatter?</P>
<P>In case its of use, this is the code I used to try out my <BR>serialize/deserialize test...</P>
<P>//&nbsp;SEEMS TO SERIALIZE ok BUT THROWS AN ERROR ON DESIERIALIZE!!!!<BR>BinaryFormatter objSerializer = new BinaryFormatter();<BR>BinaryFormatter objDeserializer = new BinaryFormatter();<BR>FileStream fst = File.OpenRead(Path.GetFullPath(file));<BR>System.IO.MemoryStream objStream = GetMemoryStream(fst);<BR>System.IO.MemoryStream objSerializedStream = new System.IO.MemoryStream();<BR>objSerializer.Serialize(objSerializedStream, objStream);<BR>System.IO.MemoryStream objReturnStream = new System.IO.MemoryStream();<BR>try<BR>{<BR>&nbsp;//objReturnStream = <BR>(MemoryStream)(objDeserializer.Deserialize(objSerializedStream));<BR>&nbsp;object objDeserialisedFile = <BR>objDeserializer.Deserialize(objSerializedStream);<BR>}<BR>catch(Exception ex)<BR>{<BR>&nbsp;MessageBox.Show("Exception: " + ex.Message);<BR>}</P>
<P>-- </P>
<P>I originally posted my problem at <A HREF="/forums/thread/16892.aspx">http://forums.lhotka.net/forums/thread/16892.aspx</A>&nbsp;which might be of use to people who are picking this up, but I felt that the problem had now been identified so it was worth posting a new, more specific thread.</P>
<P><BR>Regards,</P>
<P>Phil Johnson </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>phillipjohnson replied on Friday, August 17, 2007</h2><P>I added this call to set the memory stream back to the start before it was deserialized and it showed that the memorystream can indeed be serialised and deserialised by the binary formatter.</P>
<P>objSerializedStream.Seek(0, SeekOrigin.Begin);</P>
<P>SO does anybody have any idea why my remoting is failing on the property <BR>that exposes a MemoryStream object?</P>
<P>I can set the property itself to a memory stream object on the client, but <BR>in the next line when I try to get the data out of the object I get this <BR>error:</P>
<P>Error<BR>====<BR>This remoting proxy has no channel sink which means either the server has no <BR>registered server channels that are listening, or this application has no <BR>suitable client channel to talk to the server.</P>
<P>StackTrace<BR>===========<BR>Server stack trace: <BR>&nbsp;&nbsp; at <BR>System.Runtime.Remoting.Proxies.RemotingProxy.InternalInvoke(IMethodCallMessage reqMcmMsg, Boolean useDispatchMessage, Int32 callType)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RemotingProxy.Invoke(IMessage reqMsg)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; <BR>msgData, Int32 type)<BR>&nbsp;&nbsp; at System.IO.Stream.Write(Byte[] buffer, Int32 offset, Int32 count)<BR>&nbsp;&nbsp; at System.IO.MemoryStream.WriteTo(Stream stream)<BR>&nbsp;&nbsp; at <BR>System.Runtime.Remoting.Messaging.StackBuilderSink.PrivateProcessMessage(MethodBase <BR>mb, Object[] args, Object server, Int32 methodPtr, Boolean fExecuteInContext, <BR>Object[]&amp; outArgs)\r\n&nbsp;&nbsp; at <BR>System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(IMessage <BR>msg, Int32 methodPtr, Boolean fExecuteInContext)\n\nException rethrown at <BR>[0]: <BR>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage <BR>reqMsg, IMessage retMsg)<BR>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; <BR>msgData, Int32 type)<BR>&nbsp;&nbsp; at System.IO.MemoryStream.WriteTo(Stream stream)<BR>&nbsp;&nbsp; at ConsoleApplication1.Class1.SaveMemoryStream(MemoryStream ms, String <BR>FileName) in <BR>c:\\hexagon\\hexagon.mycontainer\\consoleapplication\\class1.cs:line 160<BR>&nbsp;&nbsp; at ConsoleApplication1.Class1.Main(String[] args) in <BR>c:\\hexagon\\hexagon.mycontainer\\consoleapplication\\class1.cs:line <BR>85"&nbsp;string</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
