<html><header><title>Which object is responsible for this...?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Which object is responsible for this...?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5765.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 posted on Friday, November 07, 2008</h2>Hello.<br>Hopefully someone can help me out.&nbsp; <br><br>Lets say we have the following scenario.&nbsp; <br><br>A Car object.<br><br>A CarEvent object<br><br>Basically a car has its basic properties which includes a property for miles. <br><br>A CarEvent is basically information stating that someone is going to drive the car and captures details about the event (like how many miles will be driven).<br><br>When the CarEvent is submitted as completed, the mileage count on the car is incremented automatically.<br><br>My question is this... If I delete a CarEvent, I need to "rollback" the mileage on the Car.&nbsp; Which object is responsible for the rollback.&nbsp; I'm assuming it would be the Car.&nbsp; If this is the case, would I just add code to the DataPortal_Delete method on the CarEvent that asks the Car to roll its counts back?&nbsp; If not, where is the best place for this type of code?<br><br>I'm still trying to grasp the concept on how to do some of this stuff.<br><br>Any help greatly appreciated?<br><br>Hope this makes sense.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlambert replied on Friday, November 07, 2008</h2>There's a time element here that I'm not quite grasping yet.<br><br>I understand that you can create a CarEvent to "reserve" a car for usage that's going to happen in the future, right?&nbsp; So if you delete the CarEvent before it's been driven, there's no work to be done re: mileage, right?<br><br>When the trip is taken, you've probably got some sort of method on car like Car.RecordTrip(CarEvent) that takes the info in CarEvent and applies it to its properties, such that mileage is racked up, and so on.<br><br>I get the sense you're also interested in deleting a CarEvent after it's been recorded, and it might help to have you clarify your intent here, as well.&nbsp; Are you trying to actually roll back state, as if the trip never happened?&nbsp; If so, do you intend to be able to roll back more than one trip?&nbsp; What happens if you try to delete a CarEvent that's not the most recent?&nbsp; Don't you end up with a Car object in a pretty goofy state if you start doing this?<br><br>Sorry if I'm missing something here...<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Friday, November 07, 2008</h2>"I get the sense you're also interested in deleting a CarEvent after it's been recorded,"<br><br>Yes, That is exactly the scenario.&nbsp; It nees to roll back state.&nbsp; You are also correct in the fact that they can only delete the most recent trip.<br><br>Thanks for the quick reply :)<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, November 08, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>reagan123:</strong></div><div>"I get the sense you're also interested in deleting a CarEvent after it's been recorded,"<BR><BR>Yes, That is exactly the scenario.&nbsp; It nees to roll back state.&nbsp; You are also correct in the fact that they can only delete the most recent trip.<BR><BR>Thanks for the quick reply :)<BR></div></BLOCKQUOTE></P>
<P>It sounds to me then, like you are confusing two different use cases. One use case is to reserve the car, another use case is to record the results of a trip.</P>
<P>Objects should be designed on a <EM>per use case basis</EM>. So CarEvent would be for one or the other use case, but not both.</P>
<P>Once you've designed <EM>separate objects for each use case</EM> you can look at the resulting objects and decide if you can achieve reuse. If you have an object in each use case that has <EM>exactly the same responsibility</EM> and which wouldn't need to be altered to be used in both use cases, then you can reuse it.</P>
<P>Odds are you'll have a read-only CarInfo object that can be reused, but that you'll end up with a TripReservation object in the first use case, and a TripRecord object in the second use case.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Friday, November 07, 2008</h2>If I take a "purist" approach, I would suggest that you compute the effective mileage by summing the values of the currently relevant CarEvents each time that you need it; that is, there is no "summed mileage" property in the Car class.&nbsp; If you do that, your problem, as stated, goes away.&nbsp; The sum operation will only consider those CarEvents that exist at the time of the sum operation. <br><br>On the other hand, that sum operation could chew up a lot of resources.&nbsp; If the summing does need to occur very often and you can afford to spend the resources, then you are done.&nbsp; There is no need to handle the delete condition.&nbsp; This would be the case if you only needed the sum for periodic reporting.&nbsp;&nbsp;&nbsp; You might also want to consider performing the calculation with a CSLA command that calls the database to do the summing with SQL.&nbsp; If you make the make the GetSum method (property or function) of the Car class a "lazy" method, it would check to see if it already had the sum.&nbsp; If it did not have the sum, it would compute it (by calling the command object).&nbsp; If it did have the sum (perhaps just computed), it would return that sum.&nbsp; If this needs to be more dynamic, you could add an event to the CarEvents Collection that signalled any change in the collection.&nbsp; The event handler for that event would reset the "I have already computed the sum" indicator.&nbsp; The next time that you asked for the sum, it would be recomputed as above.<br><br>There are a lot of other ways to handle this.&nbsp; Unless you have very exacting requirements for timeliness, I would not use any way that requires you to maintain the sum in the Car class.&nbsp; It will just drive you nuts.&nbsp; Been there, done that.<br><br>Jon Stonecash<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Friday, November 07, 2008</h2>Jon,<br>Thank you so much for your reply as well.&nbsp; I only had a chance to skim it, but I'll take the time to think about both of these responses.<br><br>Thanks once again to both of you. :)<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, November 08, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>reagan123:</strong></div><div>Hello.<BR><BR>My question is this... If I delete a CarEvent, I need to "rollback" the mileage on the Car.&nbsp; Which object is responsible for the rollback.&nbsp; I'm assuming it would be the Car.&nbsp; If this is the case, would I just add code to the DataPortal_Delete method on the CarEvent that asks the Car to roll its counts back?&nbsp; If not, where is the best place for this type of code?<BR><BR></div></BLOCKQUOTE></P>
<P>In real life I think you can go to jail for mileage fraud if you do this :)</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
