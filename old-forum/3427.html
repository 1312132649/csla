<html><header><title>Dynamically change connection string</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Dynamically change connection string</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3427.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nicholas Trevatt posted on Sunday, August 26, 2007</h2><font color="#000000"><font face="Verdana"><font size="2">Hi,<br><br>I'm building an application that I intend to sell as an off the shelf product and I need to set the connection string after installation so the end user can select a local or remote database server.&nbsp; Once chosen I need to update the readonly connection string accordingly to reflect her selection.&nbsp; </font></font></font><font color="#000000"><font face="Verdana"><font size="2">I would prefer to do this in the application and refresh the data without a restart.</font></font></font><br><font color="#000000"><font face="Verdana"><font size="2"><br>What is the best practice for this surely common task?&nbsp; <br>I'm thinking along the path of manually editing the app.config in code but this seems archaic to me!<br><br>Also, any ideas why MS made application scoped settings readonly anyway?&nbsp; <br><br>Cheers,<br>Nicholas<br></font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Sunday, August 26, 2007</h2><font face="Arial"><font size="2">We have implemented the ability for the end-user is able to change their database connection string within the app.config file by using the ConfigurationManager library; the following code changes the connection string:<br><br><font face="Courier New">&nbsp; <span><span>Dim</span> </span>config <span>As</span> System.Configuration.Configuration = _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>If</span> config.ConnectionStrings.ConnectionStrings(<span>"</span></font></font></font><font face="Arial"><font size="2"><font face="Courier New">Common</font></font></font><font face="Arial"><font size="2"><font face="Courier New"><span>"</span>) <span>Is Nothing Then</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; config.ConnectionStrings.ConnectionStrings.Add(New System.Configuration.ConnectionStringSettings(<span>"Common"</span>, _ConnectionString))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>Else</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; config.ConnectionStrings.ConnectionStrings(<span>"Common"</span>).ConnectionString = _ConnectionString<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>End If</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; config.Save(ConfigurationSaveMode.Modified)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConfigurationManager.RefreshSection(<span>"connectionStrings"</span>)<br></font></font></font><br><font face="Arial"><font size="2">This is then accessed through a shared property on a class called Database, CommonConnection which is passed through to all SQL connection constructor. <br><br>Assuming that there is no security stored within the database, the only other thing to then do would be to refresh all the objects and/or invalidate all cached lists (assuming this is done while actually logged in to a database and wishing to change).</font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nicholas Trevatt replied on Tuesday, August 28, 2007</h2>Excellent!&nbsp; Thanks very much for this very helpful reply code and all.&nbsp; I'll be giving it a try soon.<br><br>Cheers,<br>Nicholas <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Flippsie replied on Tuesday, June 10, 2008</h2><P>Hi,</P>
<P>I'm trying this in c# and I have a problem reading this new configuration setting.&nbsp; I can create the new connection string and it is present and correct&nbsp;in the config file after I have executed my code, but when I try and read it the value is null!</P>
<P>I create the new connection string, I save it, I refresh the section, but I can't read it back.&nbsp; Can you help?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
