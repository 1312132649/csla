<html><header><title>Using validation rule</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Using validation rule</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2359.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kids_pro posted on Friday, February 16, 2007</h2>Dear Rocky,<br><br>I have had a problem when I tried to use business rule as follow:<br>&nbsp;&nbsp;&nbsp; protected override void AddBusinessRules() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule(ValidatePaymentDate, "PayDate");<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; private bool ValidatePaymentDate(object target, Csla.Validation.RuleArgs e) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* prevent payment in future date */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (_payDate.Date &gt; DateTime.Today) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Please do not make payment in the future date.";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Here is the factory method:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static Payment GetPayment(<i>Int32 payment_id</i>) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!CanGetObject())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new System.Security.SecurityException(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "You are not authorized to view payment information.");<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> return DataPortal.Fetch&lt;<font color="#ff0000">Payment</font>&gt;(new Criteria(payment_id)); // error raised here ...</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><b>Error:</b><br>DataPortal.Fetch failed (System.InvalidOperationException: Invalid rule method (instance methods of the target object not allowed): ValidatePaymentDate<br><br>How is that happen?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RRorije replied on Friday, February 16, 2007</h2>Hi, <br><br>Your problem is that you are trying to add an instance rule as a type rule.<br><br>If you have the 2.1 csla e-book you might check that because it explains why this is not possible.<br><br>In short there are 2 options to solve this.<br>1. Add this rule as an instance rule (using ValidationRules.AddInstanceRule).<br>2. Make this rule static. <br><br>Number 2 is preferred, because this rule then will be loaded once per AppDomain, I.e. it will be loaded once for all businessobjects. But check the book for a more in-depth discussion.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
