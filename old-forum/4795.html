<html><header><title>Openning and Closing DB Connection with every DB Access !! Problem ?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Openning and Closing DB Connection with every DB Access !! Problem ?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4795.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf posted on Monday, May 05, 2008</h2><P>After I worked a while with CSLA Samples, and got a basic understanding of this great framework, I prepared a sample application for use within our environment, by re-writing small existing programs using CSLA.NET, and already use small parts of CSLA&nbsp;with one live application.</P>
<P>I passed the sample applications and all related material to my colleagues, and they started using them too.</P>
<P>One of my colleague, he is an experienced Java Developer with 10 years of experience. He has some concerns about the techniques applied in the Sample Applications for Opening and Closing Database Connections. He told me that in order to have more efficient code, the connection must be opened once, used as much as possible, and close it when it is no longer needed. Meaning, the life span of the connection must pass through multiple calls&nbsp;from the client to&nbsp;the web&nbsp;server.</P>
<P>In other words, we need to implement some kind of connection pooling, probably within the scope single user session, not across all sessions, or something like that.</P>
<P>According to what I remember, this kind of work is already taken care of by the Server, but I am not sure about the details.</P>
<P>My question:</P>
<P>1. Do we have to follow this method: Open Connection ... Do the Work.... Close the Connection, in a single call to the server&nbsp;?</P>
<P>2. Is there any method provided by CSLA to help in that regard ?</P>
<P>3. Do we "the programmer" have to worry about connection pooling stuff and ensure efficient use/reuse of connections ?</P>
<P>Any comments/feedback will be greatly appreciated.</P>
<P>Tarek.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, May 05, 2008</h2>In Clsa 3.5, there's a ConnectionManager or something like that, which you can use to ensure only one connection is opened and reused until the operations are complete.<br><br>Prior to Csla 3.5, you can open a connection and store it in the ApplicationContext.LocalContext.&nbsp; Your instances can look there to see if there's an existing connection and use it, or create a new one and place it in the context.&nbsp; <br><br>Connection pooling occurs automatically if you're using Ado.Net, provided the connection strings are identical.&nbsp; So if that's the case, you won't need worry as much about opening and closing connections, because in reality the connection won't really be closed, just put back onto the pool.&nbsp; <br><br>Of course if you're doing things within a transaction, you CAN'T open and close connections.&nbsp; Also, if you intend to use TransactionScope transactions, you need to make sure you only open the connection once to avoid the transactions being promoted to a DTC transaction.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, May 05, 2008</h2><P>When a web server accesses a database using the same credentials it automatically sets up and uses a connection pool. You can configure the size of this pool if the default is not big enough. This means that when CSLA code opens a connection, uses it and closes it that it really gets a connection from this pool. If there is no open connection then one is created and opened for you. When CSLA calls, "close connection" the connection is actually returned to the pool and is kept open by the web server. So the overhead of creating and opening connections is managed for you by the connection pool. Thus there is no need to handle this by yourself in your code.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, May 05, 2008</h2>Joe,&nbsp; that's a feature of Ado.net and has nothing to do with whether or not the code is run on a web server.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Monday, May 05, 2008</h2>So, the connections used in CSLA .NET Sample Applications are ADO.NET ?<br><br>I always thought that I should never worry about connection re-use because this is handled else where for me. Even when I was involved in developing a huge application using ASP and SQL Server about 6 years ago (in my previous work), we had the same concern. I remember that we did a research, and based on the results, we decided not to worry about this issue, because once you enable pooling, it is taken care for you automatically.<br><br>Connection Pooling can even be defined on the ODBC Level in Administrative Tools in Control panel. But I do not really know much about the technical details in that regards.<br><br>So, I can say that it is a good practice to open the connection use it, and close it as soon as I am done with it.<br><br>Tarek.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Monday, May 05, 2008</h2><P>In general, it is good practice to open the connection, use it, then immediately free it.&nbsp; This allows other threads to use the connection so that the server doesn't have to open as many connections for&nbsp;db access.&nbsp; I've heard of people opening a connection and storing it in the session on the server.&nbsp; It seems that Java developers are more likely to do this.&nbsp; This would&nbsp;NOT be a scalable solution.&nbsp; It would require at least one database connection per application/user.&nbsp; When you get lots of users, you system comes to a crawl.</P>
<P>If you are doing a lot of database work all at once, it's&nbsp;good to keep the connection open until all the work is done.&nbsp; You don't need to open and close the connection for each operation.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
