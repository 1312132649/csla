<html><header><title>Persisting biz object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Persisting biz object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8967.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ltgrady posted on Friday, May 21, 2010</h2><p>
<div>
<p>We have an asp.net forms based Order system. &nbsp;The user starts at Orders_Create form and then each step in the process (enter billing info, select products, shipping choices, etc..) is a seperate .aspx page. &nbsp;As we step through we&#39;re loading all of the data into a CSLA businessbase Order object. &nbsp;At the very end we call mObject.Save() and all of the data from the object is saved into the various Order tables in SQL.</p>
<p>We&#39;re trying to do two things. 1 is to persist this object form form to form. &nbsp;So in the start form I want to initialize myOrder object and load the creation date and userID. &nbsp;Then I want to pass that object to the bill to form, load the billing information. &nbsp;Then pass the object to the products form and fill the product child collection etc.. Then in the final form where it says Create Order we save it to SQL. &nbsp;I don&#39;t want to hit the sql database writing out partial orders on each load and unload like we&#39;re doing now &nbsp;What is the best practice for persisting this object from page to page? &nbsp;I could chuck it in the session variable but i&#39;m worried about multiple browsers being open and someone working two orders at once?</p>
<p>Second, if the user closes their browser or they crash or whatever else, I would like to save their state. &nbsp;I&#39;m not sure if I should serialize the object and stash the xml somewhere? &nbsp;Maybe I should write something in the Session_End that serializes the object and writes it to an SQL table or their user system folder as an .xml file. &nbsp;Then when I load next time i check for an abandoned session object? &nbsp;What is the best practice for that? &nbsp;thanks</p>
</div>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ltgrady replied on Tuesday, May 25, 2010</h2><p>I just can&#39;t decide. &nbsp;I am leaning towards dumping object into a session variable on each Next_Click of each page and then in the page load re-loading object. &nbsp;Also creating a session_end event that will save the data out to the dbase in case they crash or close browser, then check for it the next time they load the page. &nbsp;<br /><br />I&#39;m concerned about performance. &nbsp;We&#39;re anticipating quite a few concurrent users and we already have hour long sessions in our app.</p>
<p>&nbsp;</p>
<p>I was also considering a Multi-view asp.net control but i&#39;m afraid the viewstate is going to get huge and it has a large initial load time to pull all the controls of all the pages down.</p>
<p>&nbsp;</p>
<p>The last idea was to serialize the object between each step in the wizard and storing the data in a temporary record in our SQL dbase. &nbsp;Then on the next page we deserialize and load the objects up in the page_load. &nbsp;This keeps the memory free but requires this large object round trip at each step of the wizard. &nbsp;Is there a good alternative I&#39;m missing. </p>
<p>&nbsp;</p>
<p>I just can&#39;t decide where to pay the performance price. &nbsp;Session variable, dbase roundtrips, large viewstate...&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Tuesday, May 25, 2010</h2><p>From personal experience, I would consider Session as a last resort.&nbsp; Session can&#39;t really be considered durable in any form - aside from session timeouts, it&nbsp;can die on an app-pool recycle, which happens an awful lot more often than you might think.&nbsp; Also, I have found that Session_End is less than reliable in ASP.NET, even in the InProc mode (whic the VS docs say is the only officialy supported session scenario where Session_End even has a chance to fire.)</p>
<p>I wouldn&#39;t consider ViewState either, for exactly the reasons you mentioned.</p>
<p>To my mind, if you need anything even remotely reliable, you will need to implement something more durable.&nbsp; Moving your session state to a state server/state database should be relatively simple, and would probably be the &quot;least pain&quot; for your existing codebase.&nbsp; Other than that, you&#39;re looking at developing some of your own code to persist what you need.&nbsp; From a performance perspective, I wouldn&#39;t think writing your &quot;session state&quot; to a database would be a terribly expensive operation, unless your object graph is&nbsp;really ungainly.&nbsp; I know you say &quot;large object&quot;, but how large is large?&nbsp; And honestly, you may be prematurely optimizing - you don&#39;t really know what writing your object graph to a database is going to take until you try it.</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, May 26, 2010</h2><p>I recommend to never use InProc sessions for real apps. I have used a State Server to handle sessions in a web farm. It is a pretty good solution and you avoid the appdomain recycle problem for InProc.</p>
<p>I had a large web app where we used session variables and passed them from form to form exactly as you described. The only thing to add is that once you save the order then simply clear the session variable to reduce memory usage. It will also speed up all the other pages that user goes to as their session state is no longer as large on each page access.</p>
<p>Joe</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, May 27, 2010</h2><p>Hi,</p>
<p>And now that Windows Server AppFabric is almost here (RC is available and requires WS 2008 R2) you will soon have AppFabric Caching Services (formerly project &quot;Velocity&quot;) for&nbsp; high-speed access, scale, and high availability to application data.</p>
<p><i>&quot;The first release of Windows Server AppFabric has two parts: </i></p>
<ul>
<li><i>AppFabric Caching Services, which can speed up access to frequently accessed information such as session data used by an ASP.NET application. <br /></i></li>
<li><i>AppFabric Hosting Services, making it easier to run and manage services created with Windows Communication Foundation, especially those built using Windows Workflow Foundation.&quot;</i></li>
</ul>
<p>Look at the white paper from David Chappel available on MSDN:<a title="Introducing Windows Server AppFabric" href="http://forums.lhotka.net/forums/AddPost.aspx/high-speed%20access,%20scale,%20and%20high%20availability%20to%20application%20data."> Introducing Windows Server AppFabric</a>.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
