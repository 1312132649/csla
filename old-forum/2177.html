<html><header><title>Design or Template question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design or Template question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2177.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux posted on Friday, January 19, 2007</h2><P>Hello all:</P>
<P>I am currently generating my stored procedures and business objects with CodeSmith. An issue I now face is that my templates for business objects is looking at all unique fields in the database and treating them as an identity (passing it in as a parameter to the Insert stored procedure). However, my stored procedure does not account for this new parameter.</P>
<P>For instance, I have an ApplicationRequest object that inherits Request. In the database the ApplicationRequest table has a Request_ID field that is a foreign key into the Request table.</P>
<P>In my business object I simply want to store the integer of the Request_ID in the ApplicationRequest and lazy load the base Request object if/when I need it (actually right now I am not lazy-loading but just loading it).</P>
<P>So, should be business object ApplicationRequest be trying to send in thie NewRequest_ID parameter (as an OUTPUT parameter)&nbsp;to the stored procedure (since NewRequest_ID is NOT the primary key on the table)? How do you guys work with this in code generation?</P>
<P>As far as I know, CSLA will first create the base Request object when I try to Save the ApplicationRequest. This would give me access to the Request_ID when CSLA then attempts to save the ApplicationRequest. There is no need to wait for a NewRequest_ID from the database since I already know the value. However, this parameter is generated in the business object and I'm not sure how to prevent it in the template other than by NOT adding these parameters unless the field is the Primary Key only.</P>
<P>Thoughts?</P>
<P>Thanks, Will</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux replied on Friday, January 19, 2007</h2><P>It seems to be that TemplateBase line 459 (if your version is the same as mine)</P>
<P>if (!prop.IsDbComputed)</P>
<P>is showing that the column IsDbComputed which makes the code fall through to the else statement below</P>outputStatement += GetParameterStatement(prop, "New", "", false, level);
<P>This causes a parameter to be sent into the InsertProcedure of "New" + Column_Name by generating the C# code</P><FONT size=2>
<P>cm.Parameters.AddWithValue(</FONT><FONT color=#a31515 size=2>"@New22Request_ID"</FONT><FONT size=2>, _request_ID);</P>
<P>cm.Parameters[</FONT><FONT color=#a31515 size=2>"@New22Request_ID"</FONT><FONT size=2>].Direction = </FONT><FONT color=#2b91af size=2>ParameterDirection</FONT><FONT size=2>.Output;</P></FONT>
<P>In my case NewRequest_ID when all I want is to send in the Request_ID (which also gets generated).</P>
<P>For now I will comment out this line and see what happens but I'd like some clarification on what is going on here.</P>
<P>Thanks, Will</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux replied on Monday, January 22, 2007</h2><P>Commenting out the line in the template causes a wealth of other problems that I didn't really want to work through, as it's obviously not the best solution. My other alternative would be to remove the unique index on that column in the database (across multiple tables)&nbsp;which would then mean that the database no longer enforces referential integrity (I would not be able to guarantee that the Request_ID in the NewApplication table matches one from the Request table).</P>
<P>Does anyone have a solution to this? I can see both sides of the coin here but I am not sure how to derive a resolution and this is a big show-stopper for me with code generation.</P>
<P>Thanks, Will</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>thomasjrr replied on Monday, January 22, 2007</h2><P>Will,</P>
<P>&nbsp; The referential integrity you refer to is "business logic" in a sense and if you are wanting to fully embrace CSLA, you would want all your logic in the business object to begin with.&nbsp; As long as your object ensures that the appropriate keys are being created, the database integrity check is in my opinion just a redundant step.&nbsp; If however you are not the only system using this database and you cannot trust other programs to enforce the rule, then you are forced to leave the integrity checks in the database.&nbsp; Just my 2 cents...</P>
<P>&nbsp;</P>
<P>Bob</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux replied on Monday, January 22, 2007</h2><P>Bob, you were spot-on with the multiple systems idea. I am writing a new set of business objects but the data and other applications are already in place so I can't really just delete the unique index here. I can in theory as I BELIEVE the other code around this database also handles the new ID rules but I can't be positive. Nor can I be positive that the next guy to come along will automagically know these rules. Therefore I really need a solution where I can have my business rules in the BOs and also still have referential integrity in the database. Ohh, and I'm lazy so I don't want to code all of this by hand. Plus if I tell me boss we can't use CodeSmith he might blow a seal.</P>
<P>So, what now. There has to be a way for the CodeSmith templates to accomodate this behavior.&nbsp;I find it difficult to believe that people are just abandoning there database constraints.</P>
<P>Thoughts?</P>
<P>Will</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
