<html><header><title>CslaDataSource does not contain items</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataSource does not contain items</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8663.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb posted on Monday, March 15, 2010</h2><p>I am struggling setting up a web interface using a regular ASP.NET project. I am trying to follow the instructions in the book. So I have a very simple business library with security set up. I have created the ASP.NET and managed to get the login functionality working. I also have set up a CslaDataSource pointing to a business object. This datasource is used by a DetailsView. The properties of the BO show up fine in the designer, but when I run the page in IIS, the DetailsView remains empty. I use the following code behind the view page:</p>
<p>using System;<br />using System.Collections;<br />using System.Configuration;<br />using System.Data;<br />using System.Linq;<br />using System.Web;<br />using System.Web.Security;<br />using System.Web.UI;<br />using System.Web.UI.WebControls;<br />using System.Web.UI.WebControls.WebParts;<br />using System.Web.UI.HtmlControls;<br />using System.Xml.Linq;<br />using SimpleFormularium.Library;<br /><br />namespace SimpleFormularium.ASPNET<br />{<br />&nbsp;&nbsp;&nbsp; public partial class ApotheekEdit : System.Web.UI.Page<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void Page_Load(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Session[&quot;currentObject&quot;] == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session[&quot;currentObject&quot;] = Apotheek.GetApotheek(1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApotheekEditView.DefaultMode = DetailsViewMode.Edit;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if (Session[&quot;currentObject&quot;] == null) throw new Exception(&quot;Dammit&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if (ApotheekEditView.Rows.Count == 0) throw new Exception(&quot;Damm: &quot; + ((SimpleFormularium.Library.Apotheek)Session[&quot;currentObject&quot;]).Naam + ApotheekEditView.DataItemCount);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //this.ApotheekEditView.Rows[0].Visible = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ApotheekEditView.Rows.Count == 0) ApotheekEditView.DefaultMode = DetailsViewMode.Insert;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>Excuse the curses, gotten&nbsp; a bit frustrated. Anyway, if I uncomment the exceptions, the object has just loaded fine, only the datasource seems to remain empty. </p>
<p>Must be something very stupid and simple as these mistakes are the hardest to find.</p>
<p>Any help will be greatly appreciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, March 16, 2010</h2><p>The data source control has events you must handle. At the very least you need to handle the select event (SelectObject I think?), and in that event is where you call the business object factory method to get the business object and return it:</p>
<p>e.BusinessObject = Customer.GetCustomer(123);</p>
<p>or something like that.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb replied on Tuesday, March 16, 2010</h2><p>First of all, thank you&nbsp; very much for taking the time to answer such a newbie like me.</p>
<p>Unfortunately, that did not work yet. Maybe I got the set up wrong. The control shows up like a blank white square, no fields or labels. So, I am not sure it&#39;s the code.</p>
<p>Regards -- Casper</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb replied on Tuesday, March 16, 2010</h2><p>By the way, my intention was to load a default object, so if I use the select event, this is not happening upon loading of the page. In short, I want to have a root business object visible for editing right at the start of opening the web page. </p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, March 16, 2010</h2><p>Web Forms data binding dictates how this works, and you pretty much have to conform to the way Microsoft has this set up.</p>
<p>When the form loads, the form binds. When the form binds it asks the data source control for data (this is true for any data source control, not just CslaDataSource). When the data source needs data it does something to get data. The CslaDataSource raises the select object event to get its data.</p>
<p>So in the end, you must handle that event and set e.BusinessObject to a value - this is the way it works.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>halcwb replied on Tuesday, March 16, 2010</h2><p>I&#39;m sorry to keep bothering you, but I did implement a handler for the select object event to get the data like:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void CslaDataSource1_SelectObject(object sender, Csla.Web.SelectObjectArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.BusinessObject = Apotheek.GetApotheek(1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FormView1.DefaultMode = FormViewMode.Edit;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Page.Title = &quot;Event fired&quot;;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>However, the problem is, this method is never run as I do not seen the page title change.</p>
<p>I must be doing something very stupid. I also tried to set a very basic standalone webform to test the function of the datasource. Same problem though.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jerrycurl replied on Tuesday, March 16, 2010</h2><p>Did you set the OnSelectObject property of the CslaDataSource to be &quot;CslaDataSource1_SelectObject&quot;?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>halcwb replied on Tuesday, March 16, 2010</h2><p>Thank you so kindly!! Visual Studio is a great tool, but sometimes these things are so hidden. I have checked the properties page of the datasource many times, just know I discovered the events tab. I think I have got it.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
