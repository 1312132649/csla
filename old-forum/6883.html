<html><header><title>LoadProperty Not Triggering PropertyHasChanged</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LoadProperty Not Triggering PropertyHasChanged</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6883.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>thaehn posted on Thursday, April 30, 2009</h2><P>Hi -</P>
<P>I am loading a property that was null with a value based upon a user's select in the UI (Using a business rule).&nbsp; I make a call to LoadProperty like this:</P>
<P>&nbsp;</P><FONT size=2>
<P><FONT face="Courier New">target.LoadProperty&lt;</FONT></FONT><FONT face="Courier New"><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DateTime</FONT></FONT><FONT size=2>?&gt;(EndedProperty, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DateTime</FONT></FONT><FONT size=2>.Now);</FONT></FONT></P>
<P><FONT face="Courier New" size=2></FONT>&nbsp;</P>
<P>What is interesting is that the value after being loaded doesn't display in the UI.&nbsp; I need to tell the UI that the property is changed :<BR></P><FONT size=2><FONT size=2>
<P><FONT face="Courier New">target.OnPropertyChanged(</FONT></FONT><FONT face="Courier New"><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Ended"</FONT></FONT><FONT size=2>);</FONT></FONT></P>
<P><FONT face="Courier New"></FONT>&nbsp;</P>
<P><FONT size=2><FONT size=3>The LoadProperty method's header comment says that it calls PropertyHasChanged, but&nbsp;in the call to LoadPropertyValue the markDirty parameter is passed as false, so the PropertyhasChanged doesn't get called:</FONT></P></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> Loads a property's managed field with the </P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> supplied value <FONT>calling PropertyHasChanged</FONT> </P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> if the value does change.</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;typeparam name="P"&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> Type of the property.</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/typeparam&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;param name="propertyInfo"&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> PropertyInfo object containing property metadata.</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/param&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;param name="newValue"&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> The new value for the property.</FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/param&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;remarks&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> No authorization checks occur when this method is called,</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> and no PropertyChanging or PropertyChanged events are raised.</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> Loading values does not cause validation rules to be</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> invoked.</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#808080 size=2><FONT color=#808080 size=2>///</FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2> </FONT></FONT><FONT color=#808080 size=2><FONT color=#808080 size=2>&lt;/remarks&gt;</P></FONT></FONT></FONT><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> LoadProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo, P newValue)</FONT></P>
<P><FONT face="Courier New">{</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;try</FONT></P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P oldValue = </FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New" color=#0000ff size=2>default</FONT></FONT><FONT size=2><FONT face="Courier New">(P);</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT face="Courier New" color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var</FONT></FONT><FONT size=2><FONT face="Courier New"> fieldData = FieldManager.GetFieldData(propertyInfo);</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (fieldData == </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">)</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldValue = propertyInfo.DefaultValue;</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldData = FieldManager.LoadFieldData&lt;P&gt;(propertyInfo, oldValue);</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</FONT></P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var</FONT></FONT><FONT size=2> fd = fieldData </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>as</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> FieldManager.IFieldData&lt;P&gt;;</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (fd != </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">)</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldValue = fd.Value;</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</FONT></P></FONT></FONT><FONT size=2>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldValue = (P)fieldData.Value;</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadPropertyValue&lt;P&gt;(propertyInfo, oldValue, newValue, </FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New" color=#0000ff size=2>false</FONT></FONT><FONT size=2><FONT face="Courier New">);</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;}</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;catch</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Exception</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> ex)</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;{</FONT></P>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT></FONT><FONT size=2><FONT face="Courier New"> PropertyLoadException(</FONT></P>
<P></FONT><FONT color=#0000ff size=2><FONT face="Courier New" color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</FONT></FONT><FONT size=2><FONT face="Courier New">.Format(Properties.Resources.PropertyLoadException, propertyInfo.Name, ex.Message), ex);</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT face="Courier New">}</FONT></P>
<P>&nbsp;</P>
<P><FONT size=3>Should I be calling something else besides LoadProperty() to change a value from null to DateTime.Now?</FONT></P>
<P><FONT size=3>Todd</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 30, 2009</h2><P>LoadProperty() does not raise PropertyChanged, or check validation or authorization or run business rules. It is as close as possible to just "setting a field".</P>
<P>SetProperty() does all the normal "setting a property" processing.</P>
<P>If you want to set a field (LoadProperty()) and <EM>also</EM> raise PropertyChanged, then you should manually call OnPropertyChanged() after LoadProperty().</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
