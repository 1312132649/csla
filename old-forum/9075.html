<html><header><title>DataPortal CreateCompleted Not Raised</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal CreateCompleted Not Raised</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9075.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mcalhoun posted on Sunday, June 13, 2010</h2><p>Hi Everyone,</p>
<p>I have am trying to work with CSLA Silverlight v4 Beta 2 and when I create the async factory methods, the CreateCompleted event never seems to be raised. Is this something that should be done automatically, or do I have to do something in my code to trigger the Event being raised? Below is the code I&#39;m having issues with.</p>
<p>Thanks,<br />Matt</p>
<p>[Serializable]<br />[ObjectFactory(&quot;MyApp.CustomerFactory, MyApp.Domain&quot;)]<br />public class Customer : BusinessBase&lt;Customer&gt;<br />{</p>
<p>&nbsp;&nbsp; [Obsolete(&quot;required by Silverlight Serialization. Do not call manually&quot;, true)]<br />&nbsp;&nbsp; public Customer()<br />&nbsp;&nbsp; {&nbsp; <br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp; ...</p>
<p>&nbsp;&nbsp; public static void NewCustomer(EventHandler&lt;DataPortalResult&lt;Customer&gt;&gt; callback)<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dp = new DataPortal&lt;Customer&gt;(DataPortal.ProxyModes.LocalOnly);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.CreateCompleted += callback;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.BeginCreate();<br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p>public class CustomerFactory : ObjectFactory<br />{<br />&nbsp;&nbsp; public Customer Create()<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var entity = (Customer)Activator.CreateInstance(typeof(Customer), null);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (BypassPropertyChecks(entity))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty&lt;Guid&gt;(entity, Customer.IdProperty, Guid.NewGuid());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entity.Name = &quot;Default Name&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CheckRules(entity);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkNew(entity);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return entity;<br />&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; <br />}</p>
<p><br />[TestMethod, Asynchronous]<br />public void Can_Create_Customer()<br />{<br />&nbsp;&nbsp; DateTime startTime = DateTime.Now;<br />&nbsp;&nbsp; bool created = false;</p>
<p>&nbsp;&nbsp; Customer entity = null;<br />&nbsp;&nbsp; Customer.NewCustomer(delegate(object sender, DataPortalResult&lt;Customer&gt; result)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(result.Error==null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entity = (Customer) result.Object;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; created = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p>&nbsp;&nbsp; EnqueueConditional(() =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.IsTrue((DateTime.Now - startTime) &lt; TimeSpan.FromSeconds(10), &quot;Timeout waiting for DataPortal to create object&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return created;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; EnqueueCallback(() =&gt; Assert.IsNotNull(entity));<br />&nbsp;&nbsp; EnqueueCallback(() =&gt; Assert.IsInstanceOfType(entity, typeof(Customer)));<br />}</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, June 13, 2010</h2><p>If you are using the local data portal, then your factory methods must accept a callback parameter, and must invoke that callback - otherwise the data portal has no way of knowing when your factory method has completed (since it assumed to be async).</p>
<p>If you are using a remote data portal, then your code should work, since the factory object would be running on the .NET side, where (at that level) all data portal calls are synchronous.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
