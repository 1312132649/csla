<html><header><title>Reporting Off CSLA.NET Business Objects</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Reporting Off CSLA.NET Business Objects</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2962.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmanders posted on Thursday, May 31, 2007</h2><P>Hi All</P>
<P>I've been trying to create RDLC reports (ie. for ReportViewer), but my CSLA.NET based business objects do not appear in the data sources window.</P>
<P>From the book and from my investigations on the web it looks as though it should be possible.&nbsp; I'm wondering if having put SP1 of VS is the issue why it doesn't work for me.&nbsp; This is my first attempt at reporting off CSLA.NET based business objects - previously I had collections based off CollectionBase which worked fine (and still do).&nbsp; In this project, if I create a collection class that inherits from CollectionBase then this appears in the data sources window.&nbsp; If I change it to BindingList&lt;T&gt; (which the BusinessListBase inherits from) then the classes no longer appear in the data sources window.&nbsp; Same project, same namespace, both supporting the IEnumerable interface.&nbsp; Doesn't make sense to me - does anyone have any ideas?&nbsp; I'm guessing there is no easy way, but I thought I might ask anyway.&nbsp; I know I can use the ObjectAdaptor class to populate a dataset and report off that instead, but I don't really want to have to create datasets for each of my objects if I don't have to, incurring extra overhead and reducing the&nbsp;maintainability of my project.</P>
<P>I'm using SP1 of VS2005, with the reports in a ASP.NET Web Application project.&nbsp; I'm using V2.1.4 of the CSLA.NET framework.</P>
<P>Any help would be much appreciated.</P>
<P>Regards</P>
<P>Chris Anderson</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Thursday, May 31, 2007</h2><P>I haven't even done my first VS2005 / CSLA 2.x app yet.&nbsp; But the experience I had with reports in 1.x may be useful for you.&nbsp;</P>
<P>The interface that the report programs seemed to need to work with was IList, rather than IEnumerable.&nbsp; And when I needed to do a quick report on an Editable Root Object (one that didn't support the IList interface), all I did was create an ArrayList and make&nbsp;my BO&nbsp;the only member.&nbsp; I know it sounds incredibly trivial, but that worked perfectly.</P>
<P>So while you're waiting for another answer, you might give this a try in your circumstance.</P>
<P>Hope it helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Thursday, May 31, 2007</h2><P>I've become quite a fan of local rdlc reports driven from objects. I've built a few quite complex reports this way using objects built specially for the report. I think you've figured this out but for each "Table" in your report (often there is only one) you need to present a single collection. This means that&nbsp;you need to handle relationships in your objects.</P>
<P>I usually have one single ReadOnlyRoot which calls a stored procedure&nbsp;which often returns multiple result sets. I throw the data into collections of plain objects contained within the ROR. They don't need to be CSLA objects. My main "details" collection which is to be presented in a report table is usually a generic List(Of T). Related collections are usually added to a Dictionary(<SPAN class=keyword>Of</SPAN> TKey, TValue). That way I can, for example, easily and efficiently provide CustomerName in my details table when my details are invoice line items. The CustomerName property of LineItem looks up related info by key quickly in the Dictionary. Sometimes I even use a Dictionary for my main details collection because I need to get back to the same object (report row) later in my DP_Fetch with data from another result set. Then I expose the .Values property of the dictionary. I connect to the objects with an object data source.</P>
<P>I really like the ability to massage the data in C# rather than in kludgy functions in the report or&nbsp;messy SQL. Of course any of my object properties can be used in the report to sort,&nbsp;group or filter on.&nbsp;All this is&nbsp;overkill if you just want to report&nbsp;on a simple table but its really not that difficult&nbsp;and I've managed to do complex things that would be a real PITA to do by traditional direct reporting from the db. It obviously has its (memory) limits for big reports with large amounts of data.</P>
<P>Cheers<BR>Ross</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pirithoos replied on Friday, June 01, 2007</h2>Dear Chris,<br><br>I not sure if this is a solution, as I am not very familiar with RDLC reports.<br>But I faced assumeably the same problem with crystal-reports. <br>The BO were not shown as data source. <br>But when I created the reports in the same assembly where my BO were<br>stored CrystalReports did allow to bind to those BO's<br><br>Let me know if this helps.<br><br>Best Regards<br><br>Frank<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tetranz replied on Friday, June 01, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>pirithoos:</strong></div><div><BR>I not sure if this is a solution, as I am not very familiar with RDLC reports.<BR>But I faced assumeably the same problem with crystal-reports. <BR>The BO were not shown as data source. <BR>But when I created the reports in the same assembly where my BO were<BR>stored CrystalReports did allow to bind to those BO's</div></BLOCKQUOTE></P>
<P>rdlc is more flexible than this. You create an object datasource in the project / assembly where your rdlc file is but that datasource can use objects in any assembly.</P>
<P>The only location restriction I've noticed is when you embed the rdlc in the assembly and use the ReportViewer then the statement where you set the ReportEmbeddedResource&nbsp;needs to be in the same assembly as the rdlc. This means that the viewer and rdlc need to be in the same assembly or the rdlc&nbsp;assembly needs a reference to the viewer which implies that it also needs references to System.Windows.Forms or System.Web.</P>
<P>viewer.LocalReport.ReportEmbeddedResource = "&lt;NameSpace&gt;.MyReport.rdlc"<BR><BR>Ross</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cmanders replied on Monday, June 04, 2007</h2><P>Thanks for your replies guys.&nbsp; Unfortunately none of them help.&nbsp; The business objects I'm trying to report off are based upon IList.&nbsp; I can copy the data into new non-csla objects (those objects do show up), but I'd rather avoid double handling the data if I can - it just seems messier and more maintenance to do it that way.&nbsp; My business objects are based in the same assembly as the reports also, but they just don't show up.</P>
<P>Thanks for your help anyway - looks like I'll just have to work around it by copying the data to datasets and building my reports off those.</P>
<P>Chris Anderson</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RSB replied on Monday, June 04, 2007</h2><P>Hi</P>
<P>I am tyring to serialize a business object using XML serializer.&nbsp; My objective it to generalize the ToXML( ) method for any BO.&nbsp; I pass in the object to the below code, the error I get is as follows:</P>
<P>There was an error reflecting type of the business object type.</P>
<P><BR>Cannot serialize member 'Csla.Core.BusinessBase.BrokenRulesCollection' of type 'Csla.Validation.BrokenRulesCollection', see inner exception for more details.</P>
<P>Csla.Validation.BrokenRule cannot be serialized because it does not have a parameterless constructor.</P>
<P>My question is:&nbsp; How to ignore the Csla.Validation.BrokenRule member? I can use XMLIgnore attribute?&nbsp; </P>
<P>Or any other suggestions to overcome this error?</P>
<P>Code as follows:</P><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> System.IO;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> System.Xml.Serialization;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> System.Xml;</P></FONT><FONT color=#0000ff size=2>
<P>using</FONT><FONT size=2> System.Text;</P></FONT>
<P>//calling code</P>
<P>//set the object and its properties which need to be converted to XML document</P>
<P>string x = SerializeObject(CSLAobject);</P>
<P>&nbsp;</P>
<P>//method used for serializing</P><FONT color=#0000ff size=2>
<P>public</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>String</FONT><FONT size=2> SerializeObject(</FONT><FONT color=#2b91af size=2>Object</FONT><FONT size=2> pObject)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>try</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>String</FONT><FONT size=2> XmlizedString = </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2> memoryStream = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#2b91af size=2>XmlSerializer</FONT><FONT size=2> xs = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlSerializer</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(CSLAObject</FONT><FONT size=2>));</P>
<P></FONT><FONT color=#2b91af size=2>XmlTextWriter</FONT><FONT size=2> xmlTextWriter = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlTextWriter</FONT><FONT size=2>(memoryStream, </FONT><FONT color=#2b91af size=2>Encoding</FONT><FONT size=2>.UTF8);</P>
<P>xs.Serialize(xmlTextWriter, pObject);</P>
<P>memoryStream = (</FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2>)xmlTextWriter.BaseStream;</P>
<P>XmlizedString = UTF8ByteArrayToString(memoryStream.ToArray());</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> XmlizedString;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>Exception</FONT><FONT size=2> e)</P>
<P>{</P>
<P>System.</FONT><FONT color=#2b91af size=2>Console</FONT><FONT size=2>.WriteLine(e);</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> To convert a Byte Array of Unicode values (UTF-8 encoded) to a complete String.</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;param name="characters"&gt;</FONT><FONT color=#008000 size=2>Unicode Byte Array to be converted to String</FONT><FONT color=#808080 size=2>&lt;/param&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;returns&gt;</FONT><FONT color=#008000 size=2>String converted from Unicode Byte Array</FONT><FONT color=#808080 size=2>&lt;/returns&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>String</FONT><FONT size=2> UTF8ByteArrayToString(</FONT><FONT color=#2b91af size=2>Byte</FONT><FONT size=2>[] characters)</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>UTF8Encoding</FONT><FONT size=2> encoding = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>UTF8Encoding</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#2b91af size=2>String</FONT><FONT size=2> constructedString = encoding.GetString(characters);</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> (constructedString);</P>
<P>}</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cslah replied on Monday, June 04, 2007</h2><P>We're using rdlc files for all of our reports on top of the Csla 2.1.4 framework. A great resource for reporting is <A href="http://www.gotreportviewer.com">www.gotreportviewer.com</A>. They've got tons of samples that will get you up and going. </P>
<P>I will report one 'gotcha' with the reportviewer control that caused me to lose lots of hair. You won't see the Reports menu in the designer unless you click on the report. This might have been fixed in VS SP1. Also, for sub-report processing you'll need to trap an event that's tossed when the subreport is being loaded. Within the event you load (if you need) your BO &amp; bind it there.</P>
<P>We bind directly to the objects, no problem, no changes needed. IList is all you need. I'm using winforms, not ASP.net, but it should be the same. What you do is create a data source for your object, same as what you'll do with databinding. Use that same datasource, create an rdlc file and just drag/drop the items you want onto the report. The datasource will be hooked up automatically, or you can click on Reports menu-Data Sources to see them. Then, you have to load the datasource similar to databinding. For us, this is done within the winform that contains the reportviewer control, yours will probably be the same in the ASP page:<BR></P><FONT color=#0000ff size=1>
<P></FONT><FONT size=1><FONT color=#008000><FONT face="Courier New" size=2>' Reset report viewer (for when user clicks refresh button)<BR></FONT></FONT><FONT face="Courier New" size=2>rptViewer.Reset()</FONT></P>
<P><FONT color=#008000><FONT face="Courier New" size=2>' Set processing to local<BR></FONT></FONT><FONT face="Courier New" size=2>rptViewer.ProcessingMode = ProcessingMode.Local</FONT></P>
<P><FONT color=#008000><FONT face="Courier New" size=2>' Put settings in report mode, this controls formatting of names<BR></FONT></FONT><FONT face="Courier New"><FONT size=2><FONT color=#0000ff>My</FONT>.Settings.ReportMode = <FONT color=#0000ff>True</FONT></FONT></FONT></P><FONT color=#0000ff size=1>
<P><FONT size=2><FONT face="Courier New"><FONT color=#0000ff><FONT color=#008000>'&nbsp;Load your Csla collection or list object&nbsp;<BR></FONT>Dim</FONT> custs <FONT color=#0000ff>As</FONT></FONT><FONT face="Courier New"> YourCollection<BR></FONT></FONT><FONT face="Courier New" size=2>custs = YourCollection.GetYourCollection()</FONT></P>
<P><FONT color=#008000><FONT face="Courier New" size=2>' Point viewer at report (we store these in a \reports\ folder)<BR></FONT></FONT><FONT size=2><FONT face="Courier New">rptViewer.LocalReport.ReportPath = </FONT><FONT face="Courier New"><FONT color=#0000ff>My</FONT>.Application.Info.DirectoryPath &amp; <FONT color=#a31515>"\Reports\YourReport.rdlc"</P></FONT></FONT></FONT>
<P><FONT color=#008000><FONT face="Courier New" size=2>' Load the datasource (this is the name from the report d.s. properties)<BR></FONT></FONT><FONT size=2><FONT face="Courier New">rptViewer.LocalReport.DataSources.Add(</FONT><FONT face="Courier New"><FONT color=#0000ff>New</FONT> ReportDataSource(<FONT color=#a31515>"Library_YourCollection"</FONT><FONT size=1><FONT size=2>, custs))</FONT></FONT></FONT></FONT></P>
<P><FONT size=2><FONT face="Courier New"><FONT size=1><FONT face=Arial size=2></FONT>&nbsp;</P></FONT></FONT></FONT></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
