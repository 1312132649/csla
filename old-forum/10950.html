<html><header><title>CSLA 4.x how to implement an Async List &quot;factory&quot;?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4.x how to implement an Async List &quot;factory&quot;?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10950.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina posted on Tuesday, December 06, 2011</h2><p>I think I&#39;m getting lost in generics and delegate land here somewhere, any pointers greatly appreciated:</p>
<p>I have a scenario where I have&nbsp; a *lot* of ReadOnlyListBase objects in my app.&nbsp; </p>
<p>I have a grid to display them in and the user chooses the list to view and the app makes the relevant grid columns and then populates the grid using a string key name for the list.</p>
<p>I accomplish this with a list factory that returns the correct list object based on the grid key name passed in.</p>
<p>All is well in my factory using the synchronous static method to retrieve the list by key name, i.e.:</p>
<p>&nbsp;public static dynamic Get(string GridKey, string ListCriteria, long Offset, long Rows)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (GridKey)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case GridKeyNames.ClientList:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ClientList.Get(ListCriteria, Offset, Rows);//Easy peasy</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case etc etc etc</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>However, I&#39;m stumped as to how to do this with the Asynch static methods of the lists.&nbsp;&nbsp; </p>
<p>I need to pass a callback delegate but that normally requires a DataPortalResult which requires a generic parameter of the list info type and the whole point of the factory is to not know the type in advance:</p>
<p>For example: this is a working async getter for the same client list:</p>
<p>public static void Get(string ListCriteria, long Offset, long Rows, EventHandler&lt;DataPortalResult&lt;ClientList&gt;&gt; callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.BeginFetch&lt;ClientList&gt;(new Utility.GridListParameters(ListCriteria, Offset, Rows, typeof(ClientListInfo)), callback);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>How do I call this async form in a factory method?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, December 07, 2011</h2><p>You could easily rewrite the callback to be a non generic callback using your own non-generic MyDataPortlResult that inherits from AsyncEventArgs. </p>
<pre style="font-family:Consolas;background:#fafafa;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">MyDataPortalResult</span>&nbsp;:&nbsp;<span style="color:#2b91af;">AsyncCompletedEventArgs</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">object</span>&nbsp;Result&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;MyDataPortalResult(<span style="color:#2b91af;">Exception</span>&nbsp;error,&nbsp;<span style="color:blue;">object</span>&nbsp;result,&nbsp;<span style="color:blue;">object</span>&nbsp;state)&nbsp;:&nbsp;<span style="color:blue;">base</span>(error,&nbsp;<span style="color:blue;">false</span>,&nbsp;state)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;=&nbsp;result;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;BeginExecute(<span style="color:blue;">int</span>&nbsp;customerId,&nbsp;<span style="color:#2b91af;">EventHandler</span>&lt;<span style="color:#2b91af;">MyDataPortalResult</span>&gt;&nbsp;callback,&nbsp;<span style="color:blue;">object</span>&nbsp;userState = null)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;cmd&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CustomerId&nbsp;=&nbsp;customerId;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">DataPortal</span>.BeginExecute&lt;<span style="color:#2b91af;">LookupCustomerCommand</span>&gt;(cmd,&nbsp;(o,&nbsp;e)&nbsp;=&gt;&nbsp;callback(e.Object,&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">MyDataPortalResult</span>(e.Error,&nbsp;e.Object,&nbsp;e.UserState)),&nbsp;userState);
&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Wednesday, December 07, 2011</h2><p>Thank you Jonny, I appreciate that.&nbsp; I wasn&#39;t thinking of it that way at all.&nbsp; That looks perfect, I&#39;ll try it out.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 07, 2011</h2><p>You can also look at the PagedList sample app (I think in the Silverlight folder). It uses a recursive async factory to load pages of the list in the background so the user doesn&#39;t have to wait for the entire list to arrive before they can start using it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Thursday, December 08, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b></p>
<p>You can also look at the PagedList sample app (I think in the Silverlight folder). It uses a recursive async factory to load pages of the list in the background so the user doesn&#39;t have to wait for the entire list to arrive before they can start using it.</p>
<div style="clear:both;"></div>
<p></div></p>
<p>That example appears to be for retrieving just one type of list, my scenario is different in that I need to retrieve different read only list objects based on a passed in string key.&nbsp; I was hoping to do that without modifying the CSLA code at all but so far no luck.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Thursday, December 08, 2011</h2><p>Hi Jonny, just took a detailed look at your suggestions I misunderstood it the first time I looked, I thought you were referring to changes in the business object itself but I see now that I think you&#39;re proposing I change the CSLA dataportal code itself?&nbsp; I&#39;m really trying to avoid making any changes to the stock CSLA implementation and BeginFetch isn&#39;t a virtual method so I can&#39;t replace it without modifying the source code.</p>
<p>Any other way of accomplishing a factory style async retrieval of Read only list objects without modifying the CSLA source?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>Hi, </p>
<p>I&#39;m suggesting changes to the BO itself - NOT to CSLA DataPortal code. <br />My sample has BeginExecute method on a CommandObject - no intention to suggest a change to CSLA itself. </p>
<p>Generics is great to get strong typed code - but can be a hassle when you make common code like your sample. </p>
<p>After digging into the CSLA code you can actually do this without any modification to your business objects as you can use a non-generic callback:</p>
<pre style="font-family:Consolas;background:#fafafa;color:black;font-size:13px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AsyncPortalCompleted(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2baaaf;">IDataPortalResult</span>&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(e.Error&nbsp;==&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;show&nbsp;the&nbsp;error&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;databind e.Object to the UI</span></pre>
<pre style="font-family:Consolas;background:#fafafa;color:black;font-size:13px;"><span style="color:green;"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>IDataPortalResult should also provide access to.UserState. </p>
<p><a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=999">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=999</a>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Friday, December 09, 2011</h2><p>Thanks again Jonny, I&#39;ll take another look!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Friday, December 09, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>JonnyBee<br></b>After digging into the CSLA code you can actually do this without any modification to your business objects as you can use a non-generic callback</div></p>
<p>Sorry Jonny but I&#39;m just not seeing what you&#39;re seeing.&nbsp; There are 4 method signatures for BeginFetch:</p>
<p><b>public static void BeginFetch&lt;T&gt;(EventHandler&lt;DataPortalResult&lt;T&gt;&gt; callback) where T : Csla.Serialization.Mobile.IMobileObject;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /></b></p>
<p><b> public static void BeginFetch&lt;T&gt;(EventHandler&lt;DataPortalResult&lt;T&gt;&gt; callback, object userState) where T : Csla.Serialization.Mobile.IMobileObject; <br /></b></p>
<p><b>public static void BeginFetch&lt;T&gt;(object criteria, EventHandler&lt;DataPortalResult&lt;T&gt;&gt; callback) where T : Csla.Serialization.Mobile.IMobileObject;<br /></b></p>
<p><b>public static void BeginFetch&lt;T&gt;(object criteria, EventHandler&lt;DataPortalResult&lt;T&gt;&gt; callback, object userState) where T : Csla.Serialization.Mobile.IMobileObject;</b></p>
<p>None of them appear to support a non generic callback.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 09, 2011</h2><p>The Silverlight CslaDataProvider is an example of a &#39;factory&#39; that understands how to create/retrieve an instance of any type of business object. If I recall, it uses some reflection to invoke the appropriate generic factory method on the business class, allowing each business class to properly encapsulate its own creation process.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>I believe this is the Liskov substitution in practice: </p>
<p>Take this CommandObject for LookupCustomer: </p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;">&nbsp;&nbsp;[<span style="color:#2b91af;">Serializable</span>]
&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>&nbsp;:&nbsp;<span style="color:#2b91af;">CommandBase</span>&lt;<span style="color:#2b91af;">LookupCustomerCommand</span>&gt;
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:blue;">int</span>&gt;&nbsp;CustomerIdProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:blue;">int</span>&gt;(c&nbsp;=&gt;&nbsp;c.CustomerId);
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">int</span>&nbsp;CustomerId
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;ReadProperty(CustomerIdProperty);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;LoadProperty(CustomerIdProperty,&nbsp;<span style="color:blue;">value</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:blue;">string</span>&gt;&nbsp;NameProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:blue;">string</span>&gt;(c&nbsp;=&gt;&nbsp;c.Name);
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;Name
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;ReadProperty(NameProperty);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;LoadProperty(NameProperty,&nbsp;<span style="color:blue;">value</span>);&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>&nbsp;Execute(<span style="color:blue;">int</span>&nbsp;customerId)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;cmd&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CustomerId&nbsp;=&nbsp;customerId;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd&nbsp;=&nbsp;<span style="color:#2b91af;">DataPortal</span>.Execute&lt;<span style="color:#2b91af;">LookupCustomerCommand</span>&gt;(cmd);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;cmd;
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;BeginExecute(<span style="color:blue;">int</span>&nbsp;customerId,&nbsp;<span style="color:#2b91af;">EventHandler</span>&lt;<span style="color:#2b91af;">DataPortalResult</span>&lt;<span style="color:#2b91af;">LookupCustomerCommand</span>&gt;&gt;&nbsp;callback)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;cmd&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CustomerId&nbsp;=&nbsp;customerId;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">DataPortal</span>.BeginExecute&lt;<span style="color:#2b91af;">LookupCustomerCommand</span>&gt;(cmd,&nbsp;callback);
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;The&nbsp;data&nbsp;portal_&nbsp;execute.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;DataPortal_Execute()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;wait&nbsp;for&nbsp;500&nbsp;ms</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Threading.<span style="color:#2b91af;">Thread</span>.Sleep(500);
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;simulate&nbsp;llokup&nbsp;and&nbsp;set&nbsp;customer&nbsp;name&nbsp;&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">this</span>.Name&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#a31515;">&quot;Name&nbsp;(</span><span style="color:mediumseagreen;">{0}</span><span style="color:#a31515;">)&quot;</span>,&nbsp;<span style="color:blue;">this</span>.CustomerId);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}<br /><br />And used in a Rule<br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute(<span style="color:#2b91af;">RuleContext</span>&nbsp;context)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;id&nbsp;=&nbsp;(<span style="color:blue;">int</span>)&nbsp;context.InputPropertyValues[PrimaryProperty];
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;uses&nbsp;the&nbsp;async&nbsp;methods&nbsp;in&nbsp;DataPortal&nbsp;to&nbsp;perform&nbsp;data&nbsp;access&nbsp;on&nbsp;a&nbsp;background&nbsp;thread.</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">LookupCustomerCommand</span>.BeginExecute(id,&nbsp;AsyncPortalCompleted);
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;AsyncPortalCompleted(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2baaaf;">IDataPortalResult</span>&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(e.Error&nbsp;==&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;show&nbsp;the&nbsp;error&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">// do something with the object returned</span> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />This will compile and run just fine.<br /><br />And the reason it works (Liskovs substitution) is that DataPortalResult&lt;T&gt; implements IDataPortalResult:<br />&nbsp; <span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">DataPortalResult</span>&lt;T&gt;&nbsp;:&nbsp;<span style="color:#2b91af;">EventArgs</span>,&nbsp;<span style="color:#2baaaf;">IDataPortalResult</span><br /><br /> <br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JCardina replied on Friday, December 09, 2011</h2><p>Aha!&nbsp; Thanks Jonny for being persistent.&nbsp; I see what you mean now, I went back to your first idea of a custom DataPortalResult and it works perfectly.<br />I thought I&#39;d post the important bits for anyone else in future who needs to do this with a read only list<br /><br />My replacement for the stock CSLA DataPortalResult<br /><br />public class MyDataPortalResult : System.ComponentModel.AsyncCompletedEventArgs<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public object Result { get; set; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public MyDataPortalResult(Exception error, object result, object state)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(error, false, state)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Result = result;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br /><br /><br /><br />Async static get method in my CSLA ReadOnlyListBase based object<br /><br />&nbsp;public static void Get(string ListCriteria, EventHandler&lt;MyDataPortalResult&gt; callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.BeginFetch&lt;TListClass&gt;(ListCriteria, (o, e) =&gt; callback(e.Object, new MyDataPortalResult(e.Error, e.Object, e.UserState)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br /><br /><br /><br />Fragment from list factory get method showing it in action<br /><br />&nbsp;public static void Get(string GridKey, string ListCriteria, EventHandler&lt;MyDataPortalResult&gt; callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (GridKey)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case GridKeyNames.ClientList:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ClientList.Get(ListCriteria, callback);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ... etc etc etc ...<br /><br /><br /><br />My unit test to ensure it works and showing how to call it<br /><br />&nbsp;[TestMethod()]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void AsyncGetListFromFactoryWorks()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TestUtil.LogOnAdmin();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dynamic d = null;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ListFactory.Get(&quot;ClientList&quot;, &quot;&quot;, (o, e) =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (e.Error != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw e.Error;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d = e.Result;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.DateTime StartOfTest = DateTime.Now;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (d == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TimeSpan ts = DateTime.Now - StartOfTest;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ts.Seconds &gt; 5)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.Inconclusive(&quot;Async method test taking longer than 5 seconds&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.IsTrue(d is ClientList, &quot;Incorrect list retrieved&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.IsTrue(d.TotalRecords &gt; 0, &quot;Empty list retrieved, should have had more than zero records&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TestUtil.LogOff();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
