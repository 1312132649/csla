<html><header><title>DateTime Serialization - Across Timezones</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DateTime Serialization - Across Timezones</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7288.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DCottle posted on Thursday, July 16, 2009</h2><P class=MsoNormal><FONT face=Calibri>One of our business users just sent the following scenario to us.&nbsp; They are using DataSets via WCF, and are seeing this problem.&nbsp; We are using CSLA via WCF and they want to make sure we will not have the same problem.&nbsp; Can anyone address whether or not CSLA will have this same bug?</FONT></P>
<P class=MsoNormal><FONT face=Calibri>------------------------------------------------------------------------</FONT></P>
<P class=MsoNormal><FONT face=Calibri>User1 is in the mountain time zone and we are in the central time zone.&nbsp; When User1 adds a record that is expecting a date only, the data getting saved in the database gets posted with that date plus 1 hour – the time zone difference between her and us.&nbsp; This has become a bigger issue since she is in testing deals now and deals are NOT making it on to the board because of this issue.&nbsp; There are about 15 traders in a different time zone than us.&nbsp; This will certainly spill on to areas being developed in CSLA as well…</FONT></P>
<P class=MsoNormal><o:p><FONT face=Calibri>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT face=Calibri>PROBLEM</FONT></P>
<P class=MsoNormal><FONT face=Calibri>The problem is NOT the custom controls – they are operating the same as the M$ datetime picker control – sorry to spoil some peoples fun.&nbsp; The issue is the serialization (client side packaging of the WCF methods) and deserialization (server side unpackaging of the WCF methods) of the <STRONG>datasets</STRONG>.&nbsp; When a <STRONG>dataset</STRONG> with a <STRONG>date</STRONG> gets serialized, the time portion of the attribute includes the local time with the time offset according to UTC values (i.e. &lt;TestDate&gt;2009-07-13T00:00:00-05:00&lt;/TestDate&gt;).&nbsp; When you deserialize, the time portion takes that local time and applies the offset plus the UTC offset for the receiving machine. </FONT></P>
<P class=MsoNormal><FONT face=Calibri></FONT>&nbsp;</P>
<P class=MsoNormal><FONT face=Calibri>Thus, we end up with the hours being different if in different timezones.</FONT></P>
<P class=MsoNormal><FONT face=Calibri></FONT>&nbsp;</P>
<P class=MsoNormal><FONT face=Calibri>-----------------------------------------------------</FONT></P>
<P class=MsoNormal><FONT face=Calibri></FONT>&nbsp;</P>
<P class=MsoNormal><FONT face=Calibri>Thanks,</FONT></P>
<P class=MsoNormal><FONT face=Calibri></FONT>&nbsp;</P>
<P class=MsoNormal><FONT face=Calibri>David</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Thursday, July 16, 2009</h2><P><FONT size=2 face=Tahoma>If you continue to transmit your dates as you are, then CSLA will have the same issues that your DataSets do, because the behavior is specific to&nbsp;how dates are handled in&nbsp;.NET, not the technology that contains them.</FONT></P>
<P><FONT size=2 face=Tahoma>The generally-recommended procedure in this case is to deal with dates&nbsp;as UTC and translate on either end to/from the local timezone.&nbsp; That's pretty much the only way to reliably deal with this, and there are still some gotchas surrounding daylight savings time.&nbsp; Those are usually minimized in most scenarios, since users aren't entering/viewing data in the wee hours of the night.&nbsp; But it could be an issue for automated processes.&nbsp; The new TimeZone class in .NET 3.5 is also the preferred option over the DateTime methods, because it's better tuned to timezone offsets and daylight savings times, and gives more options to deal with these date issues.&nbsp; But that's only available in 3.5.</FONT></P>
<P><FONT size=2 face=Tahoma>HTH</FONT></P>
<P><FONT size=2 face=Tahoma>- Scott</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, July 20, 2009</h2>Yes, probably best to do this translation when the data its being moved to or from the business layer into the data layer.<br /><br />I had tweaked my Linq 2 Sql classes to do just this.  There's a property, which is readonly which returns the datetime in UTC.  Another property has a getter that will translate to the current timezone (this is setup by Csla as part of the context, so it works nicely) and the setter assumes its getting a local time and converts to UTC.  <br /><br />This works pretty well for me.  Although I don't deal with users crossing timezones, I did setup something with NotificationServices... and it seems easier to always store UTC times so that NS works properly.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bt1 replied on Monday, July 20, 2009</h2><P>I have worked on translation of UTC to Local and back before.&nbsp; You can take a look at the following post to see if this help you.</P>
<P><A HREF="/forums/thread/25721.aspx">http://forums.lhotka.net/forums/thread/25721.aspx</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
