<html><header><title>Support Multiple Concurrent Data Portals?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Support Multiple Concurrent Data Portals?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4413.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlabar posted on Tuesday, February 26, 2008</h2><P>My application touches multiple databases on multiple servers, that will be in different levels of development (some with newer columns, some without).&nbsp; I'm planning on having a seperate dataportal for each environment running on different machines.&nbsp; The Application itself, should be able to access different environments without the user having to touch the app.Config file.&nbsp; This presents a problem because it is assumed that you would have a single dataportal in the app.Config file and this is what CSLA uses to know where to communicate.</P>
<P>&nbsp;</P>
<P>What changes will I have to make, so that CSLA will support going to a different server when making a DataPortal call depending on what environment the user has selected?</P>
<P>Would it be easier to progamatically update the App.Config file when they select a different environmnet, or would it be easier to edit the CSLA framework so it checks to see what environment is selected before determining what dataportal settings to use?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 26, 2008</h2><P>Search the forum for phrases like "custom data portal proxy" or "custom data portal channel".</P>
<P>The simplest and most direct solution is to create a custom data portal proxy that gets your server URL using whatever technique you choose, and then uses that URL to contact the server.</P>
<P>The WcfProxy can be subclassed to do this one way, because your subclass can set the EndPoint property to control the name of the endpoint used from the config file.</P>
<P>Alternately, you can simply copy the CSLA proxy into your project, change the namespace, modify the proxy to use your new config scheme and then tell the data portal to use your proxy instead of the standard one. Since the data portal is all interface-based this is pretty easy to do. Just read through Chapter 4 to see how the proxies work and are created and you should be able to make your own.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlabar replied on Friday, March 14, 2008</h2><P>This was a lot easier than I thought it would be.</P>
<P>There were two things I wanted to be&nbsp;able to accomplish.&nbsp; </P>
<P>1.&nbsp; Connect to multiple WCF endpoints</P>
<P>2. Be able to control whether I was going to be doing it locally, or remotely by setting a true/false value in the config, not by which proxy I was using which means one proxy class was going to have to handle both.</P>
<P>The solution to #1 was to Inherit Csla.DataPortalClient.WcfProxy.&nbsp; The code need for this is shown below</P>
<P>Public Class G2WcfProxy<BR>&nbsp;&nbsp;&nbsp; Inherits Csla.DataPortalClient.WcfProxy</P>
<P>&nbsp;&nbsp;&nbsp; Public Sub New()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.New()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyBase.EndPoint =&nbsp;Settings.GetCurrentWcfEndPoint()<BR>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>End Class</P>
<P>&nbsp;</P>
<P>The solution to #2 was to create my own Proxy that implements the IDataPortalProxy class, and contains a pointer to another IDataPortalProxy that would be either the LocalProxy, or my own proxy.&nbsp; </P>
<P>Imports Csla.DataPortalClient<BR>Imports Csla.Server</P>
<P>Public Class G2Proxy<BR>&nbsp;&nbsp;&nbsp; Implements Csla.DataPortalClient.IDataPortalProxy</P>
<P>&nbsp;&nbsp;&nbsp; Private _proxy As IDataPortalProxy<BR>&nbsp;&nbsp;&nbsp; Protected Property Proxy() As IDataPortalProxy<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal value As IDataPortalProxy)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _proxy = value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp;&nbsp; End Property</P>
<P>&nbsp;&nbsp;&nbsp; Public ReadOnly Property IsServerRemote() As Boolean Implements Csla.DataPortalClient.IDataPortalProxy.IsServerRemote<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy.IsServerRemote<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp; End Property</P>
<P>&nbsp;&nbsp;&nbsp; ''' &lt;summary&gt;<BR>&nbsp;&nbsp;&nbsp; ''' 'Constructor to Initialize the Proxy to use remoting or not based off of the config file settings<BR>&nbsp;&nbsp;&nbsp; ''' &lt;/summary&gt;<BR>&nbsp;&nbsp;&nbsp; ''' &lt;remarks&gt;&lt;/remarks&gt;<BR>&nbsp;&nbsp;&nbsp; Sub New()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Settings.UseRemoting Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Proxy = New G2WcfProxy()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Proxy = New Csla.DataPortalClient.LocalProxy()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; End Sub</P>
<P>&nbsp;&nbsp;&nbsp; Public Function Create(ByVal objectType As System.Type, ByVal criteria As Object, ByVal context As Csla.Server.DataPortalContext) As Csla.Server.DataPortalResult Implements Csla.Server.IDataPortalServer.Create<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy.Create(objectType, criteria, context)<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; Public Function Delete(ByVal criteria As Object, ByVal context As Csla.Server.DataPortalContext) As Csla.Server.DataPortalResult Implements Csla.Server.IDataPortalServer.Delete<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy.Delete(criteria, context)<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; Public Function Fetch(ByVal objectType As System.Type, ByVal criteria As Object, ByVal context As Csla.Server.DataPortalContext) As Csla.Server.DataPortalResult Implements Csla.Server.IDataPortalServer.Fetch<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy.Fetch(objectType, criteria, context)<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>&nbsp;&nbsp;&nbsp; Public Function Update(ByVal obj As Object, ByVal context As Csla.Server.DataPortalContext) As Csla.Server.DataPortalResult Implements Csla.Server.IDataPortalServer.Update<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _proxy.Update(obj, context)<BR>&nbsp;&nbsp;&nbsp; End Function<BR>End Class</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>A&nbsp;total of a whopping 59 lines of code were needed.&nbsp; Heck Yah!</P>
<P>&nbsp;</P>
<P>Thanks Rocky.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, February 26, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>dlabar:</strong></div><div>
<P>My application touches multiple databases on multiple servers, that will be in different levels of development (some with newer columns, some without).&nbsp; I'm planning on having a seperate dataportal for each environment running on different machines.&nbsp; ...</div></BLOCKQUOTE></P>
<P>It is possible to support multiple databases from a single data portal without making any changes&nbsp;-- our application supports 3 different databases using just one portal.</P>
<P>Essentially what we did is that each business object is associated with a named schema, and the connection strings for the schema are retrieved from the config file by a layer that sits between the BO and CSLA. </P>
<P>With a 2-tier deployment, the local data portal just reads the database directly. With a 3-tier configuration, the client connects to a single application server. The application server has it's own configuration which retrieves the object from the appropriate back-end. </P>
<P>If you need multiple application servers, then you have to do some of your own custom legwork, but it's possible to support multiple databases out of the box</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
