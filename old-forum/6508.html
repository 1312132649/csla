<html><header><title>Populate EditableRootListBase</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Populate EditableRootListBase</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6508.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Slayer posted on Wednesday, February 25, 2009</h2>Hi<br /><br />I use C# and SQL Server 2005 and I need a recommendation on how to populate my objects.<br /><br />I have a Customers collection containing a collection of customer objects. Each customer object contains a Orders collection, containing a collection of orders.<br /><br />I use a public Fetch() method on my Customers collection to populate the customers and their orders.<br /><br />You can only have one DataReader open per connection, right. So that would mean that I need one connection for the 'SELECT * Customers WHERE Id = @Id' reader, and while I iterate through the customers reader I would need another connection for each 'SELECT * Orders WHERE CustomerId_fk = @Id'.<br /><br />My question : Would you recommend I use the above way or just plain DataSets ?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>PeterRigbye replied on Thursday, February 26, 2009</h2><P>I think what you need to do is return multiple result sets from the one stored procedure, as in</P>
<P>SELECT F1, F2 from CUSTOMERS where CustomerID= @ID</P>
<P>SELECT F1, F2 from ORDERS where CustomerID = @ID</P>
<P>in the Root collection B.O. use the dr.nextresult&nbsp; and pass this to the Orders collection to populate.</P>
<P>Or you could have each Customer BO fetch it's own orders directly from the database.</P>
<P>However I would caution that you woudl end up with a potentially large object and data traffic doing this - all customer with all orders!. Instead you might consider a light-weight read-only colection of customers, and when selected, retrieve just the orders for that customer.</P>
<P>If you've gone to the trouble to implement CSLA/object-based approach, don;t go back to using datasets IMHO.</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, February 26, 2009</h2><P>Hi,</P>
<P>I have each BO fetch its own children. To do that you need a 2nd datareader.</P>
<P>I use code like this:</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> Fetch(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> dr </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> SafeDataReader)<BR></FONT><FONT size=2>&nbsp; SetDefaults()<BR>&nbsp; FetchData(dr)<BR>&nbsp; PostFetchData()<BR>&nbsp; FetchChildren()<BR>&nbsp; MarkOld()<BR>&nbsp; ValidationRules.CheckRules()<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> FetchData(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> dr </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> SafeDataReader)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; With</FONT></FONT><FONT size=2> dr<BR></FONT><FONT size=2>&nbsp;&nbsp;&nbsp; mKey = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CLng</FONT></FONT><FONT size=2>(.GetValue(</FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>"key"</FONT></FONT><FONT size=2>))<BR>&nbsp;&nbsp;&nbsp; 'etc.<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>With<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> PostFetchData()<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp; 'marker method that can be overridden in child class<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> FetchChildren()<BR>&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'load child objects here if there are any using a second datareader<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Dim</FONT></FONT><FONT size=2> dr2 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> SafeDataReader = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Nothing<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>dr2 = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2> SafeDataReader(DAL.ExecuteReader(xyzDAO.SelectByKey(mKey)))<BR>&nbsp;&nbsp;&nbsp; mColl2 = Coll2.GetColl2(dr2)<BR>&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Finally<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>dr2.Close()<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><BR>&nbsp; Try<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>dr2 = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2> SafeDataReader(DAL.ExecuteReader(abcDAO.SelectByKey(mKey)))<BR>&nbsp;&nbsp;&nbsp; mColl3 = Coll3.GetColl3(dr2)<BR>&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Finally<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>dr2.Close()<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try<BR><BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Slayer replied on Friday, April 03, 2009</h2>Hey Joe, this sounds good. But, the dr passed to the fetch method is still open, so this will throw an exception if you attempt to open another reader in the FetchChildren method. You will first need to close dr, in order to query the children.<br /><br />Or are you creating a new db connection for each reader ?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, April 03, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Slayer:</strong></div><div>Hey Joe, this sounds good. But, the dr passed to the fetch method is still open, so this will throw an exception if you attempt to open another reader in the FetchChildren method. You will first need to close dr, in order to query the children.<br /><br />Or are you creating a new db connection for each reader ?</div></BLOCKQUOTE><br /><br />If you read the code closely you will see that the first datareader is a variable named dr. <br /><br />I am creating a 2nd datareader named dr2 which uses a different connection to fetch the child objects. <br /><br />Then I close it and re-use it for the next child, etc.<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andy replied on Friday, April 03, 2009</h2><P>I would suggest to watch dnrtv where Rocky shows how to&nbsp;use DeepData approach&nbsp;to load <FONT face=Arial size=2><SPAN class=812395113-03042009>hierarchical </SPAN></FONT>data</P>
<P><A href="http://perseus.franklins.net/dnrtvplayer/player.aspx?ShowNum=0060">http://perseus.franklins.net/dnrtvplayer/player.aspx?ShowNum=0060</A></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
