<html><header><title>Other action on data in datasource?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Other action on data in datasource?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7192.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham posted on Monday, June 29, 2009</h2><P>First off, excuse my ignorance of both&nbsp;ASP.NET&nbsp;and CSLA.NET 3.x.&nbsp; I am a religious user of CSLA.NET 2.x with WinForms and am working on upgrading and learning ASP.NET at the same time.</P>
<P>I want to provide the users a list of records (events for sake of discussion) in a grid view.&nbsp; I have two thoughts on approaches but just need one solution for now.&nbsp; I want to allow the user to select an event from the list to have it copied.</P>
<P>One approach would be to provide a "Copy" command next to each record.&nbsp; Frist, I'm not sure how to create that in the grid.&nbsp; Second, I'm not sure how to fire an event for the code-behind to process.&nbsp; I noticed the EventsDataSource_SelectObject event that is used to populate the gridview.&nbsp; That seems to work fine.&nbsp; And, I know there are insert, update and delete buttons/commands and events in the datagrid view that tie to CSLADataSource events.&nbsp; But, how do&nbsp;I do a different command?&nbsp; I suppose I could "use" one of the other commands and change the display text but that just doesn't feel right.&nbsp; Am I missing a fairly simple solution here?</P>
<P>Another approach would be to have one "Copy" button on the page at the top or bottom (multi-selecting would also be nice).&nbsp; Then, the button can process the selected event.&nbsp; However, I see no easy way of selecting an event without having the user first click a "select" command (with a postback) then click the Copy button.&nbsp; Further, is the business object available from the databinding at this point?</P>
<P>If either or both of these answers are trivial and just require a little training/research on my part of a certain area, just give me some keywords to point me in the right direction.&nbsp; Regardless, I'm taking any and all responses.</P>
<P>Please help!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, June 29, 2009</h2><P>I have been using CSLA with ASP.Net for about 5 years now. I have been happy using a standard DataGrid for a long time. I do not use the newer Gridview or the CSLA DataSource.</P>
<P>You are asking for a couple of different things here. Select one or multi-select.</P>
<P>Mutli-select is another topic.</P>
<P>For "select one" I like to add a column labeled Action at the end of the grid with one or more buttons in it (depending on how many actions you want to take for the current row.)</P>
<P>The .aspx page with the datagrid has this as the last column:</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>&lt;</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>asp</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>:</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>TemplateColumn</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>HeaderText</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="Action"&gt;<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>HeaderStyle</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>CssClass</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="MyCssClass1"&gt;&lt;/</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>HeaderStyle</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>ItemStyle</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>CssClass</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="MyCssClass2"&gt;&lt;/</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>ItemStyle</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>ItemTemplate</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;<BR>&nbsp; </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>&amp;nbsp;<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>asp</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>:</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>imagebutton</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>CommandName</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="btnAmend"</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>id</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="btnAmend"</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>Visible</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="True"</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>runat</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="server"</FONT></FONT><FONT size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>ImageUrl</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="img/Amend.gif" </FONT></FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>ToolTip</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="Amend Record"&gt;&lt;/</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>asp</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>:</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>imagebutton</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; &lt;/</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>ItemTemplate</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&lt;/</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>asp</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>:</FONT></FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>TemplateColumn</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&gt;</FONT></FONT></P>
<P>The .aspx page datagrid declaration has this (plus a lot more)&nbsp;in it:<BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>id</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="dgResults"</FONT></FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>runat</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="server"</FONT></FONT><FONT color=#000000 size=2>&nbsp;</FONT><FONT color=#ff0000 size=2><FONT color=#ff0000 size=2>OnItemCommand</FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>="GetRowInfo"</FONT></FONT></FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#000000 size=3>The&nbsp;code behind page has this code in it to trap the selected row and store the key value in Session and call the next page:</FONT></FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>Protected</FONT></FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT color=#000000 size=2> GetRowInfo(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT color=#000000 size=2> source </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Object</FONT></FONT><FONT color=#000000 size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT color=#000000 size=2> e </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2><FONT color=#000000> DataGridCommandEventArgs)<BR></FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp; 'Grid paging causes this event to fire and e.Item.ItemIndex=-1 so we should avoid an error by coding for this case.<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; If</FONT></FONT><FONT size=2> e.Item.ItemIndex &gt;= 0 </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Then<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp; Dim</FONT></FONT><FONT size=2> mIndex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Integer</FONT></FONT><FONT size=2> = e.Item.DataSetIndex<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp; Dim</FONT></FONT><FONT size=2> item </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> myROC.Info = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>CType</FONT></FONT><FONT size=2>(mSortedList(mIndex), myROC.Info )<BR>&nbsp;&nbsp;&nbsp; Session("someKey) = item.Key<BR>&nbsp;&nbsp;&nbsp; Response.Redirect(</FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>"~/Amend.aspx"</FONT></FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>If<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#000000 size=3>The&nbsp;main idea is that on postback of the page (by clicking <FONT color=#0000ff size=2>btnAmend</FONT>&nbsp;in the row) you pull the Read Only Collection (ROC) from Session and then use the index of the row to find the item in the collection. Since I use LINQ for sorting I re-bind the ROC to a variable named mSortedList - this way the index of the item in the page lines up with the sorted index of the collection and you easily find the item. (Note e.Item.Index is different from e.Item.DatasetIndex! The first is only good for 1 page - it starts over at 0 on each subsequent page. The datasetindex continues incrementing and matches the index of your collection.)</FONT></FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#000000 size=3>HTH<BR></FONT></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#000000 size=3>Joe</FONT></FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2><FONT color=#000000 size=3></FONT>&nbsp;</P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sgraham replied on Tuesday, June 30, 2009</h2><P>Thanks for the quick response.&nbsp; However, I'd prefer to stick with the GridView.</P>
<P>Some of your comments are very helpful though.&nbsp; I need to look at the TemplateColumn further.</P>
<P>I'm used to WinForms data binding where the "code behind" has access to the business object (via Row.DataBoundItem).&nbsp; Then, I can peform all my actions against the business object rather than the actual controls.</P>
<P>With that said, I'm wondering how to use the CSLADataSource for something other than Select, Insert, Update or Delete.&nbsp; I actually got it to work properly by using the Delete functionality (since it provides access to the data key) but renamed it&nbsp;to say "Copy".&nbsp; I don't feel like this is best practice but I don't know of any other way of doing it.</P>
<P>I suppose I could extend the control as well but I would have thought this extended functionality would be feasible already.</P>
<P>Additional input please?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
