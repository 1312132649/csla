<html><header><title>FieldManager and Serializing objects to file with BinaryFormatter</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>FieldManager and Serializing objects to file with BinaryFormatter</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10691.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Friday, September 16, 2011</h2><p>I&#39;m working on a project where I&#39;d like to serialize my business object to a file. I used the BinaryFormatter to serialize without problem, but I&#39;ve noticed that sometimes, when my project changes,and I try to load files saved from the past, the FieldManager had stored properties differently and I receive invalid cast exceptions <span style="text-decoration:underline;"><i><b>here</b></i></span> (below) where it&#39;s confused as to what property info it&#39;s really trying to read. What&#39;s a work around for this problem?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; protected P ReadProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (((propertyInfo.RelationshipType &amp; RelationshipTypes.LazyLoad) == RelationshipTypes.LazyLoad) &amp;&amp; !FieldManager.FieldExists(propertyInfo))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new InvalidOperationException(Resources.PropertyGetNotAllowed);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P result = default(P);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.IFieldData data = FieldManager.GetFieldData(propertyInfo);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (data != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.IFieldData&lt;P&gt; fd = data as FieldManager.IFieldData&lt;P&gt;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (fd != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = fd.Value;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i><b><span style="text-decoration:underline;">result = (P)data.Value;</span></b></i><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = propertyInfo.DefaultValue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.LoadFieldData&lt;P&gt;(propertyInfo, result);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Friday, September 16, 2011</h2><p>Don&#39;t use BinaryFormatter.&nbsp; <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p>
<p>This is a relatively common issue with binary formatting - version, type, and other information that&#39;s very sensitive to project changes is serialized into the binary stream.&nbsp; So when you do change your project, your binary-formatted stream no longer works.</p>
<p>If you want to save this information to a file, then you have to develop a specific format (XML is often used) that isn&#39;t version-sensitive.&nbsp; That requires you to write your own serialization code, but then you have control over what&#39;s serialized and how.&nbsp; Plus, you can deal with version changes, since you&#39;re writing the code.&nbsp; You can make this easier by developing a DTO-style object graph of your business objects and utilize the XML serializers in .NET to serialize/deserialize the DTO graph.&nbsp; Then all you have to do is get your BO data into and out of the DTO graph.&nbsp; That&#39;s an object-mapping exercise, which is easier to solve (and in many cases already has).</p>
<p>HTH</p>
<p>- Scott</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
