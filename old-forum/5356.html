<html><header><title>Call for design change in codegen templates</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Call for design change in codegen templates</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5356.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>WMeints posted on Saturday, September 06, 2008</h2>Although the codegen templates that are out there are all pretty good there is something which I think is a great miss at the moment.<br><br>In my projects I always work with a pattern where the Business Objects make use of a data repository class to retrieve raw record data from the database and perform other CRUD related operations. The contract for the repository class is pretty simple. Each method accepts a Data Transfer Object with the data and returns either a collection of DTO's or a single DTO as result or in the case of a delete operation nothing.<br><br>The repository classes are seperated by using an interface and letting a separate factory class construct the actual instance for me. This enables the use of Inversion Of Control mechanics like Spring.NET or recently Unity.<br><br>A typical DataPortal_Select method may look like this:<br><br>private void DataPortal_Select(SingleObjectCriteria x) {<br>&nbsp; IMyDataRepository repository = RepositoryFactory.CreateMyDataRepository();<br>&nbsp; MyData rawData = repository.SelectById(x.Id);<br><br>&nbsp; LoadObjectData(rawData); //Load the raw object data from the DTO<br>}<br><br>What I would like to see in more codegen templates is something similar to this. The factory in this case may be a simple matter of just returning a new instance of the right repository by using the new operator. This will provide developers with an even better way to extend the possibilities of the generated code and more importantly you can provide mockups for the repository classes and test the business objects seperately. <br><br>I would love to hear your thoughts on this and I hope that more people see the advantages of this pattern.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>IanK replied on Wednesday, September 10, 2008</h2><P>You might want to check out Miguel Castro from Steelblue (See link on Website) CSLAex library. He uses a single DataAccess layer similar to what you are discussing and his codegenerator default templates target towards this.&nbsp; </P>
<P>I adopted his code and for example have a fetch something like this:</P><FONT color=#0000ff size=2>
<P>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Criteria)</P>
<P></FONT><FONT color=#0000ff size=2>Using</FONT><FONT size=2> reader </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> SafeDataReader = _</P>
<P></FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> DAC.CentralDataAccess(</FONT><FONT color=#0000ff size=2>True</FONT><FONT size=2>).ReaderFromProcedureById(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>)(</FONT><FONT color=#a31515 size=2>"ProcName"</FONT><FONT size=2>, criteria.ID)</P>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> reader.Read() </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Try</P></FONT><FONT size=2>
<P>PopData(reader)</P>
<P></FONT><FONT color=#0000ff size=2>Catch</FONT><FONT size=2> ex </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Exception</P>
<P></FONT><FONT color=#0000ff size=2>Throw</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Try</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
