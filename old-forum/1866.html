<html><header><title>Newbie: Validation question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Newbie: Validation question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1866.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert posted on Wednesday, November 29, 2006</h2>I'm very new to CSLA, so forgive me if this is an overly simple question.<br><br>It appears that validation rules methods are only called when setting a property. However, if a property set is not called, there is no broken rule. If I then do an insert to the database, it's up to the database to validate values. <br>As an example, in PTracker's Edit Roles form, you can create a new record (changing the key field), leave the name property blank, and save the record, even though there is StringRequired rule on the name property. Calling ValidationRules.CheckRules doesn't seem to trap this.<br><br>Any help is appreciated.<br><br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, November 29, 2006</h2>Barry,<br><br>Not exactly sure what the problem is, but that should work fine.&nbsp; Have you changed anything in the sample?<br><br>I use stringrequired and ValidationRules.CheckRules all the time, and it works fine for me.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, November 29, 2006</h2>Andy,<br>Thanks for your reply.<br>No, we didn't change anything in PTracker. <br><br>Maybe I don't completely understand how this would work. Does CheckRules check all properties even if the Property Set methods haven't been called? In other words, does it evaluate the rules against the default values?<br><br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, November 29, 2006</h2>You should always define a default value in the variable's declaration.<br>CheckRules() checks the rules for ALL properties, regardless they were set by the user or not.<br><br>If I understand correctly, your problem araises with new objects. In that case, you should define a DataPortal_Create and call CheckRules() there.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, November 29, 2006</h2>Yes, we always initialize variable when they're declared. We've chosen not to use DataPortal_Create because we have no need to initialize objects with defaults other than from their declarations.<br><br>I know this is simple and I'm probably missing something. If you have a minute, please try this test:<br>In PTracker, open the RolesEdit form.<br>Go to a new row in the DataGridView. It fills a default id. Modify this id to anything other than any existing id.<br>Click on a different row in the grid. Notice that it doesn't un-dirty the new row.<br>Click the Save button. In our tests, it saves the new record even though the name property is blank and there is a StringRequired rule on the property.<br><br>If anyone gets a different result, I've obviously mucked something up and I apologize for wasting your time.<br><br>Thanks in advance,<br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, November 29, 2006</h2>If you don't want to use dp_create you could do the same thing in your factory method:<br><br>Public Shared Function NewItem()&nbsp; As Item<br>Dim obj as New Item<br>obj.MarkNew()<br>obj.CheckRules()<br>Return obj<br>End Function<br><br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, November 29, 2006</h2>Thanks again for your suggestions. Just to confirm that this isn't the result of something I screwed up, I re-downloaded the current versions of CSLA &amp; PTracker. The test I mentioned previously still fails. Here's the test:<br><br>1-In the RolesEdit form, add a new row in the grid. <br>2-Change the Id value of the new row to anything new. Leave the name field blank.<br>3-Click on a different row in the grid.<br>4-Click Save.<br><br>It saves the record without a name value. Is this an oversight in PTracker, an oversight in CSLA, or something I'm just not understanding? <br><br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, November 30, 2006</h2>I'll fire up the sample later, but I'm inclined to think its something with the sample, since I'm using 2.1.1 (I assume that's the version you're looking at?) and my string required fields are correctly preventing a save.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Sunday, December 03, 2006</h2>There may be a connection between the behaviour you are reporting and the problem that I presented in post 9590<br>
"BusinessBase.PropertyHasChanged calling ValidationRules.CheckRules in Version 2.1.1"<br>
<br>
That is essentially:&nbsp; Validation.CheckRules works fine when you
call it direct but not when it is called from PropertyHasChanged.<br>
<br>
Jimbo.<br>
<br>
<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, November 29, 2006</h2>It may be a problem with the sample application itself; do as Andres suggests and see if the DP_C for the class in question is calling ValidationRules.CheckRules.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Sunday, December 03, 2006</h2>I'm not so sure. What I'm talking about is that it seems that, in<br />PTracker, the CheckRules method isn't called when no property sets are<br />called. I've tried putting in a CheckRules at the beginning of the Roles<br />class's Insert method and it calls the validation routines, but it never<br />bubbles a broken rule back to the UI.<br /><br />Being still somewhat unfamiliar with all the details of the CSLA, I'm<br />not sure if it is just something to do with the sample app or with my<br />understanding.<br /><br />Barry<br /><br />>>> "Jimbo"   12/03/06 5:07 AM >>><br />There may be a connection between the behaviour you are reporting and<br />the problem that I presented in post 9590<br /> "BusinessBase.PropertyHasChanged calling ValidationRules.CheckRules in<br />Version 2.1.1"<br /><br /> That is essentially:  Validation.CheckRules works fine when you call it<br />direct but not when it is called from PropertyHasChanged.<br /><br /> Jimbo.<br /><br /><br /><br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Sunday, December 03, 2006</h2>Barry,<br>
<br>
The problem is with the sample app.&nbsp; When the role class is created thier is no call to the CheckRules Function.<br>
<br>
&nbsp;&nbsp;&nbsp; Friend Shared Function NewRole() As Role<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return New Role<br>
<br>
&nbsp;&nbsp;&nbsp; End Function<br>
<br>
Should be:<br>
<br>
&nbsp;&nbsp;&nbsp; Friend Shared Function NewRole() As Role<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim newRole as New Role<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRole.CheckRules<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return newRole<br>
<br>
&nbsp;&nbsp;&nbsp; End Function<br>
<br>
Mike<br>
<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
