<html><header><title>Parent property was not initialized during DataPortal_Create() when CheckRules() is called</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent property was not initialized during DataPortal_Create() when CheckRules() is called</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6576.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>William posted on Saturday, March 07, 2009</h2>I am using CSLA .NET version 3.0.5 in my project. I have the following parent-child class structure.<br><br>RootBO -&gt; ChildBOList -&gt; ChildBO<br><br>In ChildBO, there is a factory method to create a new ChildBO instance.<br><br><font size="2" face="Courier New">// ChildBO<br>internal static ChildBO NewChildBO()<br>{<br>&nbsp;&nbsp; &nbsp;return DataPortal.Create&lt;ChildBO&gt;(new Criteria());<br>}</font><br><br>And, in ChildBOList, I overriden AddNewCore() so that the client application can use AddNew() to get/add a new instance of ChildBO.<br><br><font size="2" face="Courier New">// ChildBOList<br>protected override object AddNewCore()<br>{<br>&nbsp;&nbsp; &nbsp;ChildBO obj = ChildBO.NewChildBO();<br>&nbsp;&nbsp; &nbsp;Add(obj);<br>&nbsp;&nbsp; &nbsp;return obj;<br>}<br></font><br>Back in ChildBO, as the factory method is calling DataPortal.Create(), it has the corresponding DataPortal method:<br><br><font size="2" face="Courier New">protected virtual void DataPortal_Create(object critera)<br>{<br>&nbsp;&nbsp; &nbsp;// Initialize object variables.<br>&nbsp;&nbsp; &nbsp;_property1 = 0;<br>&nbsp;&nbsp; &nbsp;...<br><br>&nbsp;&nbsp; &nbsp;this.ValidationRules.CheckRules();<br>}<br></font><br>The last statement in DataPortal_Create() executes all the validation rules. What happens in my scenario is that some of the validation methods depends on certain information in RootBO for proper validation. For instance, I use the following:<br><br><font size="2" face="Courier New">private static bool ValidationRule1(ChildBO sender, RuleArgs e)<br>{<br>&nbsp;&nbsp; &nbsp;RootBO parent = sender.Parent as RootBO;<br>&nbsp;&nbsp; &nbsp;if (parent != null)<br>&nbsp;&nbsp; &nbsp;{<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (parent.Field1 == 0)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;...<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}<br>}<br></font><br>This does not work well because the Parent property was not set when the validation rule is invoked during object instantiation, i.e. DataPortal_Create() but only after ChildBO is added into the ChildBOList collection.<br><br>What is the recommended approach to design/handle this scenario?<br><br>Please advise.<br>Thanks.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, March 08, 2009</h2><P>There's not much CSLA could do differently. Since you are using the data portal to create the child, the child could be created on a server - totally disconnected from the rest of your object graph - and so it can't be connected to the object graph until the creation process is complete and the object is known to be in the same physical location as the rest of the object graph.</P>
<P>You'll probably need to make your rules smart enough to realize the parent reference isn't there so they don't blow up, and then re-invoke CheckRules() after you've integrated the new child into your object graph.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Monday, March 09, 2009</h2>Rocky,<br><br>This is the approach I am using my project to connect back the disconnected objects.<br>Again, thanks for the comments.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Tuesday, September 29, 2009</h2><font size="2" color="#000000" face="Tahoma">Hi Rocky<br><br>I often need to initialise values for new and fetched objects based on parent values. In <font face="Courier New">Core.BusinessBase</font> I would appreciate something like <font face="Courier New">protected virtual void OnParentSet()</font></font><font size="2" color="#000000" face="Tahoma">.</font><font color="#000000"><br></font><font size="2" color="#000000" face="Tahoma"><br>Regards<br>Michael</font><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
