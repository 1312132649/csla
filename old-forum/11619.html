<html><header><title>Silverlight using WebAPI with local DataPortal?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Silverlight using WebAPI with local DataPortal?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11619.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM posted on Wednesday, October 03, 2012</h2><p>We&#39;ve got an internal HTTP REST (using webapi) service.&nbsp; I want to wrap that with a CSLA object in Silverlight so I get the fancy databinding and business rule tracking.&nbsp; I&#39;ve code running that can do the requests.&nbsp; So my question is, Can I make silverlight csla use a &quot;local&quot; dataportal?&nbsp; The local dataportal just makes webapi commands.&nbsp; It is working great on my full .NET desktop app.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 03, 2012</h2><p>Yes, you can do that in Silverlight (and WinRT). </p>
<p>Pre-Csla 4.5 you must specify ProxyModes.LocalOnly on the DataPortal call.</p>
<p>From Csla 4.5 you can use Task&lt;T&gt; and and the [RunLocal] attribute pretty much the same as in .NET.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Thursday, October 04, 2012</h2><p>I&#39;ve got the&nbsp;dataportal_fetch method to&nbsp;execute locally&nbsp;but now the&nbsp;callback&nbsp;won&#39;t fire.&nbsp; It is like I&#39;m not getting a FetchCompleted event.&nbsp;&nbsp;I&#39;m using 4.3.13.&nbsp; Here is how I&#39;m calling the local only portal.&nbsp; Is there another/better way to do it?&nbsp; <span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">static</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> GetMachineList(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">EventHandler</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DataPortalResult</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">MachineList</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt;&gt; callback)
<p>{</p>
<font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">var</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> dp = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DataPortal</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">MachineList</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt;(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">DataPortal</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ProxyModes</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.LocalOnly);
<p>dp.FetchCompleted += callback;</p>
<font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">dp.BeginFetch();</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;">}</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, October 04, 2012</h2><p>It is your responsibility to call the callback funtion from within the DataPortal_Fetch method after the async data access is completed.</p>
<p>Look at the SL samples for CSLA 4.3.13.&nbsp;</p>
<p>In a .NET app you typically do sync DataAccess so the DataPortal will make the callback for you. <br />In a SL app the DataAccess is async so your DataAccess methods must accept a callback parameter and is responsible for making the callback.</p>
<p>Somewhat similar to this:</p>
<p><i>public void DataPortal_Fetch(object criteria Csla.DataPortalClient.LocalProxy&lt;businessObject&gt;.CompletedHandler handler)<br />{<br />&nbsp;&nbsp; // Call webservice asynchronously,<br />&nbsp;&nbsp; // and make sure to always invoke handler when completed or error!!<br />}</i></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Friday, October 05, 2012</h2><p>I can do that.&nbsp; When doing SL apps in the past that called WCF dataportal I used the .FetchCompleted event and then raised by callback from there.&nbsp; So the FetchCompleted apparently doesn&#39;t fire when you do a local running dataportal.&nbsp; I also can&#39;t find anyway to raise it myself.&nbsp; I can convert my dataportal calls to take a callback and do it there.&nbsp; Thanks!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Friday, October 05, 2012</h2><p>That worked!&nbsp; I never did that on a remote dataportal with SL+WCF before.&nbsp; Thanks again!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Friday, October 05, 2012</h2><p>That worked for fetch and delete.&nbsp; How do I get the insert and update to work?&nbsp; I just call Save() on the Editable root object and I can errors about a missing ServiceReferences.ClientConfig file.&nbsp; I had one of these in my last SL project talked to WCF.&nbsp;&nbsp; Do I need to put something in here for a local dataportal or is that set somewhere else?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, October 05, 2012</h2><p>Look for a Save/Delete method that accept ProxyMode as parameter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Saturday, October 06, 2012</h2><p>I don&#39;t see a BeginSave() overload that takes a proxy mode.&nbsp; It looks like I can override the BeginSave in my business object class.&nbsp; I could use the same type of code I&#39;m using to call delete locally but install call update (I don&#39;t see an insert, so I don&#39;t know how that will work).&nbsp; Is there another way or is the BeginSave override the way to go in 4.3?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, October 07, 2012</h2><p>Hmm, </p>
<p>Yes, it seems we have missed on that one - however you can add these overloads yourself to your baseclasses or business objects. </p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Monday, October 08, 2012</h2><p>If you do no want to mix remote and local proxy - ie: only run local proxy you only need to set:&nbsp; </p>
<p><b>&nbsp;Csla.DataPortal.ProxyTypeName ==&nbsp;<span style="color:#0000ff;">&quot;Local&quot;;</span></b></p>
<p>and this will force SL DataPortal to only use local proxy mode.<img style="position:absolute;visibility:visible;color:transparent;margin:0px;border:medium none;z-index:2147483647;left:557px;top:70px;" alt="" /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Monday, October 08, 2012</h2><p>That did it!&nbsp; Thanks again for all of your help!</p>
<p>Jon</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
