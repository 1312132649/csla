<html><header><title>SmartDate, SetPropertyConvert, and PropertyLoadException: invalid cast from string </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SmartDate, SetPropertyConvert, and PropertyLoadException: invalid cast from string </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10967.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Thursday, December 08, 2011</h2><p>I&#39;m trying to gain a better understanding of the concept design behind using SetPropertyConvert&lt;SmartDate, string&gt;.</p>
<p>It doesn&#39;t make sense to me why SetPropertyConvert throws and exception if the string can&#39;t convert to a date - for some reason I&#39;m expecting the &quot;ill formatted&quot; string value would just not change the pre-existing date value...&nbsp;</p>
<p>So, since the CSLA design instead throws an exception, how should one handle the scenario of when you bind the string property of the SmartDate to a text box? If the user keys in an invalid date, an exception will be thrown - is there some sort of event that needs to be subscribed to?</p>
<p>Can someone point me to the book and page number explaining this design decision and how to handle it?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, December 08, 2011</h2><p>This is no different than when you bind a text box control to a numeric property and then enter something like &quot;abc&quot;. The behavior is intentionally comparable.</p>
<p>In WPF/SL this is solved by telling the binding to handle binding exceptions. I don&#39;t remember if there was a decent solution in Windows Forms - perhaps not?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, December 08, 2011</h2><p>You can hook into Windows Forms databinding but it&#39;s not obvious. </p>
<p>Similar to a&nbsp;ValueConverter in WPF/SL you can hook into the Parse/Format events to do your own value conversion. </p>
<p>You can hook into the Binding.BindingComplete event to do your own error handling <br /><a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.bindingcomplete.aspx">http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.bindingcomplete.aspx</a>&nbsp;<br />or hook into BindingSource.BindingComplete that is called for all controls that are attached to the BindingSource. </p>
<p>Events on the BindingSource are visible in the property designer and the &quot;suggested&quot; hook from Microsoft. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, December 09, 2011</h2><p>Thanks Rocky &amp; JonnyBee for your help. This solves my question about binding. </p>
<p>I do have one other question though. A lot of the time, in the DAL I will use the SetPropertyConvert method to load values from the database (or where ever). </p>
<p>In the event that somehow the data has been dirtied with &quot;ill formatted&quot; data, I suppose best practice is to NOT to use the SetPropertyConvert in the DAL and to convert data manually?</p>
<p>&nbsp;</p>
<p>For example, suppose the business object is being loaded from a file format like a csv or something and a string conversion is necessary in the DAL from string to smartdate. Would a simple helper method be required for me to write like below or is there something in the framework I&#39;m not tapping into here?...</p>
<p>private void SetSmartDateProperty(PropertyInfo&lt;SmartDate&gt; p, string date)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DateTime d;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (DateTime.TryParse(date, out d))<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetPropertyConvert(p, d);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>EDIT: </p>
<p>Another approach might be to use string values for all my properties as strings, and then expose a property with GetPropertyConvert for the date values needed during operations. That seems like a lot of work though...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Monday, December 12, 2011</h2><p>Am I going about this completely the wrong way? It just seems like there&#39;s something I&#39;m not utilizing in the framework for this kind of situation here...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, December 16, 2011</h2><p>Anyone? Perhaps my question is phrased poorly.&nbsp;</p>
<p>My problem is that I&#39;m reading dates from a datastore (a csv document) that are string values and I am wanting to store this data in my objects as a SmartDate. &nbsp;I can&#39;t use SetPropertyConvert because it throws an exception, so do I need to manually convert values like this myself with a method like the above or is there something in the framework that I&#39;m not understanding/using?</p>
<p>Any help is appreciated, thanks again.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 16, 2011</h2><p>There is nothing in CSLA for parsing text files, no.</p>
<p>But SmartDate has comparable parse and tryparse methods to DateTime, and you should be able to use those to help parse the sting values.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
