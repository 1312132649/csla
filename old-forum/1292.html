<html><header><title>Instance Authorization Rules method fired on creation problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Instance Authorization Rules method fired on creation problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1292.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Grant.Argy posted on Wednesday, September 20, 2006</h2><P>The comapny I work for is building an application using the CSLA framework and an issue I have come up with and would like some help with is as follows:</P>
<P>We have a User business object and 2 built in system users that we want to stop the setting of to inactive and a number of other fields, so I created some authorization instance rules, but the user object is never completed before the AddInstanceAuthorizationRules method is called. </P>
<P>On the following shared function the dataportal fetch occurs after AddInstanceAuthorizationRules method is called and I test whether the instance is a system user. The problem is the Is System User field is not set at this stage.</P><FONT color=#0000ff size=2>
<P>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetUser(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> UserId </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> User<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> CanViewObject() </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> System.Security.SecurityException(</FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>.Format(Constants.NotAuthorizedMessage, Constants.ExecuteAction_View, </FONT><FONT color=#0000ff size=2>GetType</FONT><FONT size=2>(User).Name))<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> DataPortal.Fetch(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> User)(</FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> CriteriaId(UserId))<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT color=#0000ff size=2>
<P>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> AddInstanceAuthorizationRules()<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> _IsSystemUser </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>With</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>.AuthorizationRules<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.InstanceDenyWrite(</FONT><FONT color=#800000 size=2>"Active"</FONT><FONT size=2>, Constants.GenericRole)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>With<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2>Thanks</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, September 21, 2006</h2>Hmm..<br><br>I think you may want to subclass these 'special' users.&nbsp; Their behaviors are different.&nbsp; Properties by themselves are not behavior, but whether or not the property can be changed is.&nbsp; At least, that's my take.&nbsp; Someone please correct me if I'm wrong.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, October 30, 2008</h2><P>Sorry about resurrecting this old post but I have a similar question... Why is AddInstanceAuthorizationRules fired before a (dataportal) fetch? I fully agree with the above statement&nbsp;about properties but in my case I have a following structure:</P>
<P>Customer : BusinessBase&lt;Customer&gt;<BR>|-------&gt;ShortCustomer : Customer<BR>|-------&gt;FullCustomer : Customer</P>
<P>And I have lots of branches that have customers. So each customer has a Branch property and there are security checks on what users can edit on customers of&nbsp;specific branches. All other behaviour is common accross branches.</P>
<P>I&nbsp; can add the checks in CanWriteProperty but thought it would be neater to be placed in AddInstanceAuthorizationRules. </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
