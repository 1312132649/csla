<html><header><title>ApplicationContext.User problem if the server side hosted in WPF application</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ApplicationContext.User problem if the server side hosted in WPF application</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7698.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>alexsychev posted on Tuesday, September 29, 2009</h2>Hi,<br>in our project we&nbsp; host our server side CSLA either in WPF application (for debug purposes, use it in development) or in Windows Service (for production).<br><br>Recently we came across annoying and hard to reproduce or debug issue in which server side code loses the ApplicationContext.User from time to time.<br><br>Can it be related to CSLA 3.6 fix of the way ApplicationContext.User is handled for WPF? <br>It is cached in static field ApplicationContext._principal.<br><br>So if two requests come simultaneously on two threads:<br>Request1.SetPrincipal --&gt;&gt; Request1.DoWork --&gt;&gt; Request2.SetPrincipal --&gt;&gt; <i>Request1.RESETPrincipal </i>--&gt; Request2.DoWork failure, because the principal is null.<br><br>In general in means that CSLA server component should never be hosted in WPF application.<br><br>Is my understanding correct?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 29, 2009</h2><P>That is correct. This was debated at some length a few years ago, and the general concencus was that making WPF work in the 99.999% case was more important than having it work in the incredibly rare (unique to you so far) case where WPF is used to host a multi-user server.</P>
<P>I take it you are creating some sort of peer-to-peer app or something?</P>
<P>Otherwise, in general you should never host server components in client applications like WPF or Windows Forms. The .NET runtime itself knows whether it is running in client or server mode and acts differently (in terms of garbage collection, etc), and the client mode really won't perform or scale well when used as a server.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alexsychev replied on Wednesday, September 30, 2009</h2>Thanks for reply.<br>I agree that making WPF properly work with CSLA authentication is much more important. <br>Actually the side-effect I described in my post is not a problem for us, because we&nbsp; use WPF-hosted server in development only (it produces some useful output on the fly) and both client and server are located on each developer's machine. <br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
