<html><header><title>Comments on DP_Fetch with invalid data</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Comments on DP_Fetch with invalid data</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6166.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gravy posted on Thursday, January 15, 2009</h2><P>Hi,</P>
<P>I'm wondering what peoples comments are on what is the best way of handling the DP_Fetch where the data requested doesn't exist. For example, fetching a Project where the Guid ID field doesn't match in the database. Should I throw an exception or silently ignore it and return an empty object?</P>
<P>I'm guessing this is going to be a 'depends' answer. Any pitfalls either way?</P>
<P>Thanks guys.</P>
<P>Graham</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 15, 2009</h2><P>There are a couple very extensive threads on this topic on the forum - hopefully you can search and find them (<A href="http://www.lhotka.net/search.aspx">www.lhotka.net/search.aspx</A> may be helpful).</P>
<P>It is a 'depends' answer - mostly it depends on your views about how it should work :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, January 15, 2009</h2><P>This question has come up many times over the past 5 years.</P>
<P>It depends. &lt;g&gt;</P>
<P>5 years ago about half the forum users thought one way and half the other. </P>
<P>I went with the idea of returning a New object with default values. My code in DP_Fetch has a branch to check if the record exits, and if not it calls DataPortal_Create instead.</P>
<P>I think I am in the minority now though. I believe the recommended practice is for the DataPortal to throw an exception. Your UI should expect this behavior and so should have a Try Catch block to present the user with a nice message that the record does not exist.</P>
<P>I cannot modify 5 years of work to accomodate this behavior so I am sticking with my existing pattern.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>maxal replied on Thursday, January 15, 2009</h2>I would agree that this is the matter of personal preferences. However, couple of general comments about exceptions.<br><br>I would argue that exceptions should be used for what they are, exceptions. Every rule has an exception (here we have a pun :) but what I mean is that it depends on what are you intentions.<br><br>There are two options, here. One is you are going to use your Get (Fetch) method to check if the object exists in database. In that case it is normal behavior and I would not use exception. For one, it is not an exception anymore but documented behavior, for another exceptions are costly.<br><br>There is another approach. You are not going to use Get (Fetch) to check object existence, so if it is not found it is indeed an exception, as something is wrong. In this case I would use exception, probably.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gravy replied on Friday, January 16, 2009</h2><P>Thanks guys for your input, all comments are very helpful.</P>
<P>I have decided to go ahead with throwing an exception in the Fetch as it is not used for checking object existance. However, I now find myself with another dilema...</P>
<P>If in the DP_Fetch method I throw a custom RecordNotFoundException I find that by the time the client UI&nbsp;gets it, it is wrapped in a DataPortalException. I see I have a few options available to me and was wondering what other people thought:</P>
<P>My client code could catch(DataPortalException ex) and check the BusinessException property. The thing I'm not keen on here is that is doesn't seem a 'logical' exception to catch.</P>
<P>I could catch the DataPoralException in the factory Get method and rethrow the inner BusinessException. Is there an easier way of doing this instead of in every factory method?</P>
<P>Can anyone suggest a better way?</P>
<P>Thanks again for your help.</P>
<P>Graham</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, January 16, 2009</h2>I think Csla move favors the approach you decided to take.. since it calls MarkOld after a fetch.&nbsp; You could add some code to then call MarkNew after a fetch though.<br><br>Anyway...<br><br>It might not seem logical to catch a DataPortalException.. but that's how it works.&nbsp; Usually my code looks like this:<br><br>catch( DataPortalException ex ) {<br>&nbsp;&nbsp;&nbsp; if ( ex.BusinessException is RecordNotFoundException ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show( "Couldn't find specified record" );<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; else {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw;&nbsp; // I typically have global exception handlers setup to display a custom error message.<br>&nbsp;&nbsp;&nbsp; }<br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>maxal replied on Friday, January 16, 2009</h2>Since you indicated that exceptions will be thrown in the rear case of some inconsistency in database, I assume it could happen in multi-user environment only, my preference would be to handle DataPortalException on very high level and save time going through every Get method. After all, there may be other DataPortalExceptions to handle.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, January 16, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Gravy:</strong></div><div>
<P>Thanks guys for your input, all comments are very helpful.</P>
<P>I have decided to go ahead with throwing an exception in the Fetch as it is not used for checking object existance. However, I now find myself with another dilema...</P>
<P>If in the DP_Fetch method I throw a custom RecordNotFoundException I find that by the time the client UI&nbsp;gets it, it is wrapped in a DataPortalException. I see I have a few options available to me and was wondering what other people thought:</P>
<P>My client code could catch(DataPortalException ex) and check the BusinessException property. The thing I'm not keen on here is that is doesn't seem a 'logical' exception to catch.</P>
<P>I could catch the DataPoralException in the factory Get method and rethrow the inner BusinessException. Is there an easier way of doing this instead of in every factory method?</P>
<P>Can anyone suggest a better way?</P>
<P>Thanks again for your help.</P>
<P>Graham</P>
<P></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>Well -&nbsp; you can't have it both ways!</P>
<P>The trade off is that your UI *has* to be prepared to get an excpetion back on every fetch. So you *have* to catch it. And you know that 99.9% of the time it is going to be a DataPortalException so that should be first in your list. You can catch general exceptions after that (like network errors or something.).</P>
<P>If you returned a New BO instead then you wouldn't have to bother with excpetions but you would have to check if it was the BO you asked for or a new one. </P>
<P>So bottom line - neither solution is free of side effects and you just have to adopt a model and move forward with it consistently.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 16, 2009</h2><P>I do think it is totally valid to do factory methods like this:</P>
<BLOCKQUOTE dir=ltr>
<P>public static CustomerEdit GetObject(int it)<BR>{<BR>&nbsp; try<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;CustomerEdit&gt;(...);<BR>&nbsp; }<BR>&nbsp; catch (DataPortalException ex)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; throw ex.BusinessException;<BR>&nbsp; }<BR>}</P></BLOCKQUOTE>
<P>The purpose behind DataPortalException is to provide extra information about the exception. It does this by indicating what data portal method failed, and by providing access to the business object as it was when the exception occurred (in the case of an insert/update/delete).</P>
<P>It may be the case that your UI doesn't need any of this extra information. It may be that your UI would be simplified if it only got the original failure. In that case, this approach provides that behavior.</P>
<P>And this is probably still OK for development, because if you encounter exceptions and can't figure out what's going on, you can always use a debugger breakpoint to get into the factory method so the developer can see the full DataPortalException (which includes the complete stack trace).</P>
<P>Personally I allow the DataPortalException to go to the UI, because I think that makes debugging and troubleshooting easier - primarily because the full stack trace is right there where the exception is handled - but I can see arguments either way.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rasupit replied on Saturday, January 17, 2009</h2>While I understand Rocky's point of view on wrapping all exceptions thrown by business object's code inside dp methods within DataPortalException.&nbsp; I feel that this makes catching csla bo exception become a little bit unnatural compare to catching other .net object exception.&nbsp; <br><br>The consequence is that we need to add additional instruction (in method comment) on how to access the exception through DataPortalException so developer that not familiar with CSLA does not get trip by this when consuming csla objects.&nbsp; This issue become more noticable when you have (we have) diverse group of developer and not all your BOs are CSLA based.<br><br>Similar to Rocky's solution; In our shop, we decided extract the actual exception thrown by DataPortalException when the source for this exception is not CSLA framework (our DP code).&nbsp; So when the exception is not from CSLA Framework, we re-throw the actual exception.&nbsp; If the exception is from CSLA framework we just simply rethrow DataPortalException.<br><br>All our factory methods looks similart to this.&nbsp; We also do the same with Save method by overriding this method in our base class.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;MyBo&gt;(new Criteria(myKey));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (DataPortalException ex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ex.BusinessException != null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw ex.BusinessException;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>We found that this approach makes csla business objects behave more natural therefore user does not have to be aware/deal with this gotcha.<br><br>BTW: I found that new CSLA does not always return bo exception on BusinessException. see <a HREF="/forums/post/28526.aspx">here</a>. Can anybody confirm with this?<br><br>Ricky<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gravy replied on Wednesday, January 21, 2009</h2><P>I thank you all for your help.</P>
<P>Right now, I'm going to take the route of re-throwing&nbsp;any Business&nbsp;&nbsp;exceptions in the factory/Save methods. As I'm fairly new to CSLA.NET then this is all a bit of a learning exercise :-(</P>
<P>Regards</P>
<P>Graham</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
