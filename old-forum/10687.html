<html><header><title>Collections</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Collections</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10687.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>San posted on Thursday, September 15, 2011</h2><p>Hi, All</p>
<p>I am new to CSLA. Actually I can access child collections in parent page but how can i access child collection in child validation class.</p>
<p>E..g., I have a requirement based on previous data entered i have to run some validations.</p>
<p>&nbsp;</p>
<p>Thanks,</p>
<p>San</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 15, 2011</h2><p>I&#39;m not quite sure what you are asking.&nbsp; Could you provide some more details?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>San replied on Thursday, September 15, 2011</h2><p>Actually I have a requirement where it should trigger some validation rules.</p>
<p>for e.g., user can enter multiple records for a month.</p>
<p>Let say user entered 3 records for jan month, each record has a unique id.</p>
<p>On 1st record user entered age as 67 and on 2nd record there is a drop-down list which user picked 1st record unique id and entered age as 34. so I should throw and error message saying age is not equal.</p>
<p>Thanks!</p>
<p>San</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Curelom replied on Thursday, September 15, 2011</h2><p>I have done something similar to this. I had a scenario where the start date and end date values couldn&#39;t intersect. Don&#39;t know if my solution is the prefered way to do it. Structure of my objects is Transportation - TransportationRateList - TransportationRate. I made a object Business Rule like below. Note that it isn&#39;t a property business rule, but a rule to be used on the TransportationRate object. <span style="COLOR:blue;"></span>In the transportation Rate object I add the rule</p>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"><span style="COLOR:blue;">public</span> <span style="COLOR:blue;">class</span> <span style="COLOR:#2b91af;">DateSpansDoNotIntersectRule</span> : <span style="COLOR:#2b91af;">BusinessRule</span> {
        <span style="COLOR:blue;">protected</span> <span style="COLOR:blue;">override</span> <span style="COLOR:blue;">void</span> Execute(<span style="COLOR:#2b91af;">RuleContext</span> context) {
            <span style="COLOR:blue;">var</span> target = (<span style="COLOR:#2b91af;">TransportationRate</span>)context.Target;
            <span style="COLOR:#2b91af;">TransportationRateList</span> targetList = target.Parent <span style="COLOR:blue;">as</span> <span style="COLOR:#2b91af;">TransportationRateList</span>;
            <span style="COLOR:#2b91af;">DateSpan</span> ds = <span style="COLOR:blue;">new</span> <span style="COLOR:#2b91af;">DateSpan</span>(target.StartDate, target.EndDate);
 
            <span style="COLOR:blue;">if</span> (targetList != <span style="COLOR:blue;">null</span>) {
                <span style="COLOR:green;">//get list of datespans that we need to check</span>
                <span style="COLOR:blue;">var</span> q = (<span style="COLOR:blue;">from</span> t <span style="COLOR:blue;">in</span> targetList
                         <span style="COLOR:blue;">where</span> t != target
                               &amp;&amp; t.FreightMethod == target.FreightMethod
                               &amp;&amp; t.Pallet == target.Pallet
                               &amp;&amp; ds.Intersect(<span style="COLOR:blue;">new</span> <span style="COLOR:#2b91af;">DateSpan</span>(t.StartDate, t.EndDate)) != <span style="COLOR:blue;">null</span>
                         <span style="COLOR:blue;">select</span> t).FirstOrDefault();
 
                <span style="COLOR:blue;">if</span> (q != <span style="COLOR:blue;">null</span>)
                    context.AddErrorResult(<span style="COLOR:#a31515;">&quot;Effective Date spans cannot intersect.&quot;</span>);
            }
        } 
    }</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"></pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">BusinessRules.AddRule(<span style="COLOR:blue;">new</span> <span style="COLOR:#2b91af;">DateSpansDoNotIntersectRule</span>());
</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">One of the problems with the PropertyStatus control is that it doesn&#39;t work for object Business Rules, only rules on properties.  </pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">For me to get this to work I had to expose the accessiblity of Broken Rules Collection</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"><pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">public</span>&nbsp;<span style="COLOR:#2b91af;">IEnumerable</span>&lt;<span style="COLOR:#2b91af;">BrokenRule</span>&gt;&nbsp;BusinessObjectErrors&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">get</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">if</span>&nbsp;(<span style="COLOR:blue;">this</span>.BrokenRulesCollection.Where(b&nbsp;=&gt;&nbsp;<span style="COLOR:#2b91af;">String</span>.IsNullOrEmpty(b.Property)).Count()&nbsp;&gt;&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">return</span>&nbsp;<span style="COLOR:blue;">this</span>.BrokenRulesCollection.Where(b&nbsp;=&gt;&nbsp;<span style="COLOR:#2b91af;">String</span>.IsNullOrEmpty(b.Property));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:blue;">return</span>&nbsp;<span style="COLOR:blue;">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">then I bound a column to the BusinessObjectErrors and set the data template for the column</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"><pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;"><span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">DataTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsControl</span><span style="COLOR:red;">&nbsp;ItemsSource</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">Binding</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:red;">&nbsp;Margin</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;4&quot;</span><span style="COLOR:red;">&nbsp;Padding</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;4&quot;</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsControl.Template</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ControlTemplate</span><span style="COLOR:red;">&nbsp;TargetType</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">x</span><span style="COLOR:blue;">:</span><span style="COLOR:#a31515;">Type</span><span style="COLOR:red;">&nbsp;ItemsControl</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:blue;">&nbsp;&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsPresenter</span><span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ControlTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ItemsControl.Template</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsControl.ItemTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">DataTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">Border</span><span style="COLOR:red;">&nbsp;BorderBrush</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">StaticResource</span><span style="COLOR:red;">&nbsp;BorderErrorBrush</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:red;">&nbsp;BorderThickness</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;1&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:red;">&nbsp;CornerRadius</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;10&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR:red;">&nbsp;Background</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">StaticResource</span><span style="COLOR:red;">&nbsp;BackgroundErrorBrush</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">StackPanel</span><span style="COLOR:red;">&nbsp;Orientation</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;Horizontal&quot;</span><span style="COLOR:red;">&nbsp;Background</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;Transparent&quot;</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">Image</span><span style="COLOR:red;">&nbsp;Source</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">StaticResource</span><span style="COLOR:red;">&nbsp;Horizon_Image_Error</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:red;">&nbsp;ToolTip</span><span style="COLOR:blue;">=&quot;{</span><span style="COLOR:#a31515;">Binding</span><span style="COLOR:red;">&nbsp;Path</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">Description</span><span style="COLOR:blue;">}</span><span style="COLOR:blue;">&quot;</span><span style="COLOR:red;">&nbsp;MaxHeight</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;12&quot;</span><span style="COLOR:red;">&nbsp;MaxWidth</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;12&quot;</span><span style="COLOR:blue;">/&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">StackPanel</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">Border</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">DataTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ItemsControl.ItemTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsControl.ItemsPanel</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">ItemsPanelTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;</span><span style="COLOR:#a31515;">WrapPanel</span><span style="COLOR:red;">&nbsp;IsItemsHost</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;True&quot;</span><span style="COLOR:red;">&nbsp;Orientation</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;Vertical&quot;</span><span style="COLOR:red;">&nbsp;Margin</span><span style="COLOR:blue;">=</span><span style="COLOR:blue;">&quot;4&quot;</span><span style="COLOR:blue;">&nbsp;/&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:green;">&lt;!--Background=&quot;Yellow&quot;--&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ItemsPanelTemplate</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ItemsControl.ItemsPanel</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">ItemsControl</span><span style="COLOR:blue;">&gt;</span>
<span style="COLOR:#a31515;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR:blue;">&lt;/</span><span style="COLOR:#a31515;">DataTemplate</span><span style="COLOR:blue;">&gt;</span></pre>
</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">&nbsp;</pre>
</pre>
<pre style="FONT-FAMILY:Consolas;BACKGROUND:white;COLOR:black;FONT-SIZE:13px;">You will also have to take into account property status changes.</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>San replied on Thursday, September 15, 2011</h2><p>I really appreciate your reponse, but i would like to get previous data through collections.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 15, 2011</h2><p>You can&#39;t have business rules on the collections themselves.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>San replied on Monday, September 19, 2011</h2><p>Is there any other way to implement the functionality.</p>
<p>&nbsp;</p>
<p>-San</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Monday, September 19, 2011</h2><p>I haven&#39;t found another way except for what I detailed earlier in these posts.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
