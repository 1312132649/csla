<html><header><title>Some Questions Regarding Custom Authentication and WinForms Validation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Some Questions Regarding Custom Authentication and WinForms Validation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3237.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>white_shark posted on Friday, July 20, 2007</h2>Hello,<br><br>First of all I am new to the framework, so please excuse if some of the questions are overly simple.<br><br>Anyways, here I go.<br><br>1) I am trying to implement a custom authentication scheme. As I was trying to follow the approach Rocky used in the book (separate security database) I discovered that my security requirements are different than the ones in the sample application.<br><br>The main difference is the fact that there are no publicly browsable areas of the application. In other words, the user has got log in before entering the application. <br><br>In Rocky's example there was no validation of data entry and if the user couldn't be authenticated then no porblem just display the app but keep him logged out. In my case I want data to be validated, and to open the application only if the user is succesfully authenticated. <br><br>I had a bit of problem with this since the real BO in the example was the PTIdentity object and not the publicly callable PTPrincipal. <br><br>I thought about builiding an UserInfo class on top of the clasess in the example that implemented the mentioned feutures but I consider that it is a bit of an overhead. However, I would not like to implement this logic in the UI. Do you think there is a cleaner approach to doing this?<br><br>BTW, While I am in the same subject I would like to know what was the of delegating the IsInRole behaviour to the PTIdentiy project, since it was not specifically stated in the book.<br><br>2) Windows Forms Validation.<br><br>I am trying to implement validation in such a way that the error provider messages do not show up at form load. <br><br>I tried using the traditional technique used on "traditional" win forms validation (playing with the CausesValidation and AutoValidate properties) but I have obtained no results. <br><br>As I was studying why this happens, tt seems to be that when attaching the object to the appropriate BindingSource, the IDataErrorInterface methods get called several times and that causes the ErrorProvider to display the errors. Btw, Do any of you know why does this get called so often and if this behaviour is random or if there's any way to know when and why this is called?<br><br>However I am lost into how to go about implementing a different validation scheme that does not show the errors to the user until he/she submits bad data and if so then highlights the errors through the ErrorProvider Control. What approach do you suggest?<br><br>If you got this far thanks for reading, I am sorry. I&nbsp; know it is a long post and that I should have probably divided it in two. <br><br>Thanks for all your help and to Rocky for provding a great book and the framework.<br><br>Oswaldo.<br><br>PS: Sorry for my English, I am not a native speaker.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, July 20, 2007</h2><P>Hi Oswaldo,</P>
<P>Your English is very good.</P>
<P>Some things to consider:</P>
<P>1. The Identity class does all of the data access to retrieve the data for the user so it makes sense to store the information there. Since the Identity is conatined by the Principal it is simplest to expose IsInRole at the principal level and just forward the call to the Identity object.</P>
<P>2. You should write your own Principal and Identity classes that fetch the information you need for your app.</P>
<P>e.g.</P><FONT size=2>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MyUser<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> Csla.Security.BusinessPrincipalBase<BR></FONT><FONT size=2><BR>#</FONT><FONT color=#0000ff size=2>Region</FONT><FONT size=2> </FONT><FONT color=#a31515 size=2>" Constructor "</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> identity </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IIdentity)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; MyBase</FONT><FONT size=2>.New(identity)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Region</FONT></P>
<P><FONT color=#0000ff size=2>etc. (See the book)</FONT></P>
<P><FONT color=#0000ff size=2>==============================================================================</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;</P></FONT><FONT size=2>
<P>&lt;Serializable()&gt; _<BR></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Class</FONT><FONT size=2> MyBusinessIdentity<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Inherits</FONT><FONT size=2> Csla.ReadOnlyBase(</FONT><FONT color=#0000ff size=2>Of</FONT><FONT size=2> MyBusinessIdentity)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IIdentity</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp; Private</FONT><FONT size=2> mRoles </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> ArrayList<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mIsAuthenticated </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>False<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> mUsername </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#a31515 size=2>""</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>Region</FONT><FONT size=2> </FONT><FONT color=#a31515 size=2>" IIdentity "</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> IsAuthenticated() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IIdentity.IsAuthenticated<BR></FONT><FONT color=#0000ff size=2>&nbsp; Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mIsAuthenticated<BR></FONT><FONT color=#0000ff size=2>&nbsp; End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> AuthenticationType() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IIdentity.AuthenticationType<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#a31515 size=2>"CSLA"<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>ReadOnly</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</FONT><FONT size=2> Name() </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Implements</FONT><FONT size=2> IIdentity.Name<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Get<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> mUsername<BR>&nbsp; </FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Get<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Property</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Region</FONT></P>
<P><FONT color=#0000ff size=2>etc.</P></FONT>
<P>&nbsp;</P>
<P>3. As far as validation - I think if you skip the call to ValidationRules.CheckRules() during the Fetch or Create then the BO will not have any broken rules when the screen opens. Most developers make those calls and they usually exist in the CodeSmith templates. But if you don't want them then just comment them out. Be sure you set the fields during Fetch and not the Properties - this also avoids running the rules (one at a time.)</P>
<P>4. Finally, Rocky has said many times that databinding makes multiple calls and the CSLA framework is designed to only honor the first call. See the book.</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>white_shark replied on Monday, July 23, 2007</h2>Hi Joe,<br><br>Thanks for the tips. I will try your approach towards validation.<br><br>Thanks again.<br><br>Oswaldo.<br><br>PS: Thanks for the comment about my English. It seems that alll those English lessons are paying off. :-D<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
