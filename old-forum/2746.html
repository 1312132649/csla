<html><header><title>CAB, CSLA , AND Serialization</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CAB, CSLA , AND Serialization</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2746.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ntownsley posted on Friday, April 20, 2007</h2><P>Using the Composite Application Block, we have a module that is loaded dynamically that references CSLA and our Business Object Library.&nbsp; </P>
<P>Calling CancelEdit against a business object, we receive a serialization exception in the UndoableBase.UndoChanges method.&nbsp; </P>
<P>The following line of code is the culprit - </P><FONT color=#0000ff size=2>
<P>Dim</FONT><FONT size=2> formatter </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> BinaryFormatter()</P>
<P>state = _</P>
<P></FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(formatter.Deserialize(buffer), HybridDictionary)</FONT></P>
<P><FONT size=2>The exception thrown is "unable to locate assembly XXXXX" which is our Business Object Library using CSLA.</FONT></P>
<P><FONT size=2>Everything appears to work fine outside of the CAB....</FONT></P>
<P><FONT size=2>using CSLA 2.1, VS2005, .NET 2.0 </P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, April 20, 2007</h2><P>I'm guessing here (having not looked at how CAB works) that they are using dynamic assembly loading.</P>
<P>There's a "feature" (Microsoft won't call it a bug no matter how hard I try) of .NET where dynamically loaded assemblies don't always find loaded assemblies during deserialization.</P>
<P>This "feature" is a problem in many scenarios, including Enterprise Services, IE and various other dynamic containers for code.</P>
<P>If you look at the EnterpriseServicesPortal in CSLA .NET (discussed in Chapter 4), you'll find code for a "Serialization bug workaround", including a SerializationWorkaround() method. If this method is called once, at the start of your AppDomain, it will resolve the issue.</P>
<P>Again, I don't know that this is your issue - but it is a good bet that it is - and this workaround solves that particular issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Saturday, April 21, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><p>I'm guessing here (having not looked at how CAB works) that they are using dynamic assembly loading.</p>
<p>There's a "feature" (Microsoft won't call it a bug no matter how hard I try) of .NET where dynamically loaded assemblies don't always find loaded assemblies during deserialization.</p>
<p>This "feature" is a problem in many scenarios, including Enterprise Services, IE and various other dynamic containers for code.</p>
<p>If you look at the EnterpriseServicesPortal in CSLA .NET (discussed in Chapter 4), you'll find code for a "Serialization bug workaround", including a SerializationWorkaround() method. If this method is called once, at the start of your AppDomain, it will resolve the issue.</p>
<p>Again, I don't know that this is your issue - but it is a good bet that it is - and this workaround solves that particular issue.</p></div></BLOCKQUOTE><br><br>I wish to underwrite that this bug is indeed occurring at times in CAB.<br><br>For diagnosis: try explicitly referencing the assemblies in your app and see if the error disappears. You can keep the dynamic loading in place, no changes needed. The references will simply assure that your app knows about the assemblies. If this solves your problem: welcome to the club. ;-)<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ntownsley replied on Saturday, June 30, 2007</h2>Rocky - this solution worked out very well.&nbsp; Thanks for the help and all that you do for the .NET community.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
