<html><header><title>Notify when object saved and if new, modified, or deleted</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Notify when object saved and if new, modified, or deleted</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2929.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrisb posted on Tuesday, May 22, 2007</h2><P>I need to perform an action when an object is saved.&nbsp; I need to know also if the object was new, modified, or deleted.&nbsp; Is there an event I can wire up or a method to override to perform this?</P>
<P>Something like this:</P>
<P>&nbsp; public override MyObject Save()<BR>&nbsp;{</P>
<P>&nbsp;&nbsp;&nbsp; MyObject newObject = base.Save();<BR>&nbsp;&nbsp;&nbsp; if (object was new)<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do something<BR>&nbsp;&nbsp; }<BR>&nbsp;&nbsp; else if (object was deleted)<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do something different<BR>&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp; ...<BR>}<BR></P>
<P>Or subscribe to an event?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, May 22, 2007</h2>What about the Saved event from ISavable?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Tuesday, May 22, 2007</h2>Try checking the state of the object before you call the base.Save method. If it inherited from CSLA, it has IsNew and IsDeleted properties. Since CSLA objects save themselves, you have access to these properties. <br><br>You should also consider the case that an object is both new and deleted.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrisb replied on Wednesday, May 30, 2007</h2><P>My class derives from&nbsp;Csla.BusinessBase&lt;MyClass&gt;.&nbsp; I don't know how to override BusinessBase&lt;MyClass&gt;.Save().&nbsp; That would be ideal.</P>
<P>In the ISaveable.Saved event, I cannot tell if the object was originally Deleted, New, etc.&nbsp; Example: I delete, call Save(), and ISaveable.Saved fires with&nbsp;SavedEventArgs.NewObject.IsDeleted == false.</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrisb replied on Wednesday, May 30, 2007</h2><P>I see why I can't override BusinessBase.Save().&nbsp; It is already overridden in the partial class generated using the CodeSmith templates.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, May 30, 2007</h2>You should be able to move the override of save out of the generated code file into your own, so that you can customize it.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, May 30, 2007</h2>Ahh, I see what you're getting at.<br><br>I would add a new interface, MyBusiness.ISavable define as:<br><br><font color="#0000ff">public interface</font> <font color="#008000">ISavable </font>: Csla.<font color="#008000">ISavable </font>{<br>&nbsp;&nbsp;&nbsp; <font color="#0000ff">event</font> <font color="#008000">EventHandler</font>&lt;<font color="#008000">SavingEventArgs</font>&gt; Saving;<br>}<br><br><br>SavingEventArgs can be whatever you need it to be.&nbsp; Then on your custom BusinessBase (you did subclass BB and others, and use those as all your bases, right?) simply have BB implement your new interface.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 30, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Ahh, I see what you're getting at.<BR><BR>I would add a new interface, MyBusiness.ISavable define as:<BR><BR><FONT color=#0000ff>public interface</FONT> <FONT color=#008000>ISavable </FONT>: Csla.<FONT color=#008000>ISavable </FONT>{<BR>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>event</FONT> <FONT color=#008000>EventHandler</FONT>&lt;<FONT color=#008000>SavingEventArgs</FONT>&gt; Saving;<BR>}<BR><BR><BR>SavingEventArgs can be whatever you need it to be.&nbsp; Then on your custom BusinessBase (you did subclass BB and others, and use those as all your bases, right?) simply have BB implement your new interface.<BR></div></BLOCKQUOTE></P>
<P>Just remember that if you declare an event, and you want to ever use serialization, you must use the custom event declaration syntax - you can NOT use the one-line event declaration syntax. Look at the existing ISavable implementations in BusinessListBase or BusinessBase for examples.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrisb replied on Thursday, May 31, 2007</h2><P>Rocky,</P>
<P>&nbsp; I was also&nbsp;thinking in of using static events that fire whenever any MyClass object changes:</P>
<P>public class MyClass : BusinessBase&lt;MyClass&gt;<BR>{</P>
<P>&nbsp; &nbsp;&nbsp;&nbsp; public static event MyClassSavedEventHandler MyClassSaved;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override MyClass Save()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... Populate Event Args ....<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClass newClass = base.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnMyClassSaved(this, eventArgs);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return newClass;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>}</P>
<P>Any problems with this approach?</P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chrisb replied on Wednesday, May 30, 2007</h2><P>&nbsp;We did not subclass BusinessBase etc (yet)&nbsp;because we took what the CodeSmith templates gave us by default. I like your solution since it solves the problem in general of performing tasks based on deletions, addition, etc.&nbsp; </P>
<P>Thanks for all the help.</P>
<P>Chris</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
