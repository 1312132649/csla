<html><header><title>CSLA transactions not working for static methods (non DataPortal_xyz methods)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA transactions not working for static methods (non DataPortal_xyz methods)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9734.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>krishna_navuduri posted on Tuesday, November 09, 2010</h2><p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="color:#1f497d;"><span style="font-size:small;"><span style="font-family:Calibri;">Hi,</span></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="color:#1f497d;"><span style="font-size:small;"><span style="font-family:Calibri;">I am using CSLA in my current project and running into some issues with transactions, I have a static method with in CSLA object in this method </span></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="color:#1f497d;"><span style="font-size:small;"><span style="font-family:Calibri;">I am calling different stored procedures, when exception happens my transactions are not working, could you please check below code and let me know</span></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="color:#1f497d;"><span style="font-size:small;"><span style="font-family:Calibri;">What I am doing wrong. Thanks</span></span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="color:#1f497d;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">[<span style="color:#2b91af;">Transactional</span>(<span style="color:#2b91af;">TransactionalTypes</span>.TransactionScope)]</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;">public</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt;"> <span style="color:blue;">static</span> <span style="color:blue;">bool</span> PurgeFinalization_CSLA(<span style="color:blue;">int</span> personnelJobOrderID)</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">{</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">bool</span> bRetVal = <span style="color:blue;">true</span>;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">try</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">using</span> (<span style="color:blue;">var</span> cn = <span style="color:#2b91af;">ConnectionManager</span>&lt;<span style="color:#2b91af;">SqlConnection</span>&gt;.GetManager(<span style="color:#2b91af;">SqlDatabase</span>.ScoutConnection, <span style="color:blue;">false</span>))</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">using</span> (<span style="color:#2b91af;">SqlCommand</span> cm = cn.Connection.CreateCommand())</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">//purge finalization record//////////////////////////</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Clear();</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = System.Data.<span style="color:#2b91af;">CommandType</span>.StoredProcedure;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = <span style="color:#2b91af;">CommandType</span>.StoredProcedure;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = <span style="color:#a31515;">&quot;sp_JO_JobOrders_Personnel_Finalizations_Clean&quot;</span>;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Add(<span style="color:#2b91af;">SqlDatabase</span>.ParameterFactory(<span style="color:#a31515;">&quot;jobOrder_Personnel_ID&quot;</span>, personnelJobOrderID, <span style="color:#2b91af;">DbType</span>.Int32));</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.ExecuteNonQuery();</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">//calling twice to check commit/rollback</span></span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Clear();</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = System.Data.<span style="color:#2b91af;">CommandType</span>.StoredProcedure;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cm.CommandType = <span style="color:#2b91af;">CommandType</span>.StoredProcedure;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = <span style="color:#a31515;">&quot;sp_JO_JobOrders_Personnel_Finalizations_Clean_not_exists&quot;</span>;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.Add(<span style="color:#2b91af;">SqlDatabase</span>.ParameterFactory(<span style="color:#a31515;">&quot;jobOrder_Personnel_ID&quot;</span>, personnelJobOrderID, <span style="color:#2b91af;">DbType</span>.Int32));</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.ExecuteNonQuery();</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">catch</span> (<span style="color:#2b91af;">Exception</span> ex)</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bRetVal = <span style="color:blue;">false</span>;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span style="color:blue;">throw</span>;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span> bRetVal;</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:&#39;Courier New&#39;;font-size:10pt;">&nbsp;}</span></p>
<p class="MsoNormal" style="margin:0in 0in 0pt 0.5in;"><span style="font-family:&#39;Courier New&#39;;color:#1f497d;font-size:10pt;">&nbsp;</span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, November 09, 2010</h2><p>The Transactional attribute can be applied to</p>
<ul>
<li>DataPortal_XYZ methods</li>
<li>Object factory methods</li>
</ul>
<p>In short, this attribute is used by the data portal to set up an appropriate transactional context before the data portal invokes your method. If your method isn&#39;t invoked by the data portal, the attribute has no meaning.</p>
<p>Your method is not something the data portal will invoke, so the attribute has no meaning.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
