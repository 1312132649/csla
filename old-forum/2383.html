<html><header><title>Localizing BOs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Localizing BOs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2383.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, February 19, 2007</h2>Hi,<br><br>I'd like to start storing information such as date / time's in my database as UTC, mainly for the future that will need to display that information in the user's local date / time.&nbsp; I also am in the very near future going to be rolling out Notification Services, which expects most things to be in UTC.. so I'd like my datetime fields to use UTC for consistency there too.&nbsp; <br><br>On the BO side, users should work as they do now in their local time.&nbsp; Going to and from the database should be UTC.&nbsp; <br><br>Should the BO keep UTC internally and through the properties handle the translation from local to UTC?&nbsp; Should the BO work only in local time and let the DAL translate the values?&nbsp; <br><br>What is everyone else doing?<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Monday, February 19, 2007</h2><P>The approach I have taken thus far is to try and be as consistent as possible when applying globalization/localization to my BO's.&nbsp; And since all of the string values that I use are managed in the base/default english language in my BO's and localized via resource files when displayed, I've leaned the same way when it comes to date/time properties.&nbsp; The date/time value is maintained in UTC and translation into the user's local time is analagous to retrieving a localized text string, imo.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 19, 2007</h2>Pirate,<br><br>So where do you translate between UTC and local time?&nbsp; Do the BOs assume the DateTime / SmartDate is Local?&nbsp; Do you set the Kind property at all?<br><br>Thinking about it, I'm not sure doing the translation in the DAL is a good idea, because in a remoting environment I guess its possible that the server isn't running in the same culture as the client... unless I send the client culture.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, February 20, 2007</h2><P>I have the BO handle the translating when setting or getting the property.&nbsp; In other words, the private internal variable used within the BO to store the value is in UTC.&nbsp; Then, when the value is used by the client (via the get accessor), the client's culture is used to translate to local time.&nbsp; Likewise when the value is set.&nbsp; I believe this is consistent with how other aspects of localization are applied like resource strings plus puts the logic into the BO so the back-end database doesn't care what is being stored.&nbsp; This way the BO decides the format being persisted.</P>
<P>I've&nbsp;thought about&nbsp;implementing a config switch to indicate whether all dates are stored in local versus UTC but that would only be applicable if I did implement it in the DAL where it would be global to the whole application.&nbsp; I'm still considering this then I'd have a way to set it for the whole application or on a per-BO basis as I'm doing now.&nbsp; But, you raise a good point about passing the client culture into the DAL in order for this to work.&nbsp; So, for now, I think I will just continue using the same approach I've been using (above).</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fellmer Lloyd replied on Tuesday, February 20, 2007</h2>Hi<br /><br />Interesting thread!<br /><br />SonOfAPirate, isn't it bad for the performance if the private DateTime is "calculated" on every property-get?<br />Yeah, it isn't a big operation, but imagine a DataGridView with a lot of data in it...<br /><br />Fellmer<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 20, 2007</h2>Fellmer,<br><br>Yes, it does impact performance... but at the same time the calculation is simple addition or subtraction, something computers excel at! <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" />&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 20, 2007</h2>Pirate,<br><br>Thanks for clarifying.&nbsp; This is the approach I was leaning toward.<br><br>My only concern is simply forgetting to do the translation.. this feels like something that should be encapsulated.. perhaps a SmartDateUTC class or some custom attribute scheme?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, February 20, 2007</h2><P>Andy,</P>
<P>You're one step ahead of me.&nbsp; After posting my last message, it occurred to me that the more appropriate place to centralize this logic would be within the date itself.&nbsp; I'm not sure if it should be a separate class or not, though.</P>
<P>Having it encapsulated would allow the use of a global "switch" such as what I mentioned unless it was a dedicated class, as you stated.&nbsp; Not sure cuz I have to consider the complexity of having yet another data type to work with since I deal with a team development environment with on-site, off-site and off-shore resources.&nbsp; As is, I had to rename SmartDate to simply DateTime so that it was more obvious that this was to be used in lieu of the System.DateTime type.</P>
<P>I was also thinking of some way to integrate the System.ComponentModel.LocalizableAttribute that already exists into the mix somehow.&nbsp; Since the purpose of this attribute is to mark a property as...well, localizable... I thought that it could be what triggers the translation at the DAL level.&nbsp; This would simplify the code by encapsulating the logic outside of the BO's while allowing the flexibility to determine which, if any, dates exhibit this behavior.</P>
<P>I agree completely that it would be totally undesirable to repeat the logic in each property that requires this behavior (which I am doing at the moment!).&nbsp; Question is where&nbsp;it is&nbsp;best to put the code...</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 20, 2007</h2>Pirate,<br><br>I'm not sure the LocalizableAttribute will help us here.&nbsp; I read up on it, and it seems to enable you to localize control properties to a resx automatically.&nbsp; For example, the Text property on a button.&nbsp; The framework will automatically pull the value from the appropriate resx file based on the current culture.&nbsp; Given that we don't want to store the dates into a resx, that path seems a dead end.<br><br>In your situation, you could probably just add the functionality to the DateTime class you now have and no one would be the wiser.&nbsp; I think a class which manages this is a good idea and then simply using that class everywhere to handle the translation.<br><br>I'm going to explore that option I think... i'm just going to add a UtcValue to the SmartDate class.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 23, 2007</h2>Pirate,<br><br>Just wanted to update on my findings.<br><br>One of the things I had forgotten is that the DP attempts to keep a consistent context between server and client for the BO.&nbsp; The DP will actually properly set the CurrentCulture and CurrentUICulture on the thread before letting the BO continue.<br><br>Because I can rely on this, I'm thinking I'll have the UTC to local time conversions handled by my data access layer.&nbsp; Now, is that a valid thing to do, or should the BOs really be responsible for translating from local to UTC and back?<br><br>Suggestions?<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Saturday, January 19, 2008</h2>

<p class="MsoNormal"><span>I am in
the process of essentially implementing the same design with regards to UTC
handling. We're looking to store all dates in the database in UTC and have the
business objects convert the date to the userâ€™s local time.<br>
<br>
I was wondering if you guys had run into any issues creating reports with date filtering
where the dates were in UTC format? Crystal
reports or reporting services etc.<br>
<br>
Thanks, <br>
John</span><span><o:p></o:p></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, January 21, 2008</h2>John,<br><br>All of my reports are requested through the business layer as well; I have Csla objects which contain the report data, so my DAL ends up handling the date translation for me.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JohnB replied on Monday, January 21, 2008</h2><font face="Verdana" size="2">Andy,<br><br>I can certainly see using Csla for 
my report data but I was thinking that I would not be able to use it effectively as a data 
source for my reporting solution. I have not worked with any of the reporting 
tools to know if I will have any issues but I just thought that I might. May I 
ask what type of reporting system you are using?<br><br>Regards,<br>John</font><font face="Verdana" size="2"></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, January 21, 2008</h2><P>I use Active Reports .Net with CSLA BOs and it works fine.</P>
<P>The only minor issue is that the data has to be pre-sorted. For some reason they did not build a Sort option into their report designer. Otherwise it is a fine product. </P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
