<html><header><title>CSLA 4 - Csla.Core.BusinessBase.AddBusinessRules() gives exception &quot;Sequence contains no elements&quot;</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4 - Csla.Core.BusinessBase.AddBusinessRules() gives exception &quot;Sequence contains no elements&quot;</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10013.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Tuesday, February 01, 2011</h2><p>I have a non-CSLA Property with a [Required] data annotation that is causing CLSA to freak out.</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:darkblue;">DataObjectField</span>(&nbsp;<span style="color:blue;">true</span>,&nbsp;<span style="color:blue;">false</span>&nbsp;)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="text-decoration:underline;"><strong>[<span style="color:darkblue;">Required</span>]</strong></span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;<span style="color:purple;">DateString</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkcyan;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:purple;">InternalDate</span>.<span style="color:purple;">Text</span>;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkcyan;">set</span>&nbsp;{&nbsp;<span style="color:purple;">InternalDate</span>&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">SmartDate</span>(&nbsp;<span style="color:blue;">value</span>&nbsp;);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>It&#39;s a runtime issue, that happens in my business object when it calls &quot;base.AddBusinessRules&quot; which calls to Core.BusinessBase.AddBusinessRules()</p>
<pre style="font-family:consolas;">		<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">AddBusinessRules</span>()<br />		{<br />			<span style="text-decoration:underline;"><strong><span style="color:blue;">base</span>.<span style="color:darkcyan;">AddBusinessRules</span>();</strong><br /></span><br />			<span style="color:darkcyan;">AddCustomRules</span>();<br /><br />		}</pre>
<p><strong><span style="text-decoration:underline;">Here is the exception:</span></strong><br />System.InvalidOperationException {&quot;Sequence contains no elements&quot;}<br />&nbsp;&nbsp; at System.Linq.Enumerable.First[TSource](IEnumerable`1 source)<br />&nbsp;&nbsp; at Csla.Rules.BusinessRules.AddDataAnnotations()<br />&nbsp;&nbsp; at Csla.Core.BusinessBase.AddBusinessRules()<br />&nbsp;&nbsp; at XXXXXXXXXXX.BusinessRules.AAAAA.BBBBBB.AddBusinessRules() in&nbsp;__________<br />&nbsp;&nbsp; at Csla.Core.BusinessBase.InitializeBusinessRules()<br />&nbsp;&nbsp; at Csla.Core.BusinessBase..ctor()<br />&nbsp;&nbsp; at Csla.BusinessBase`1..ctor()<br />&nbsp;&nbsp; at XXXXXXXXXXX.BusinessRules.AAAAA.BBBBBB..ctor() in&nbsp;__________<br />&nbsp;&nbsp; at lambda_method(Closure )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CreateInstance(Type objectType)<br />&nbsp;&nbsp; at Csla.Reflection.LateBoundObject..ctor(Type objectType)<br />&nbsp;&nbsp; at Csla.Server.ChildDataPortal.Fetch(Type objectType, Object[] parameters)</p>
<p><span style="text-decoration:underline;"><strong>Workaround:</strong></span><br />If I add the following it works (but the point is I don&#39;t need this):</p>
<pre style="font-family:consolas;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:darkblue;">PropertyInfo</span>&lt;<span style="color:blue;">string</span>&gt;&nbsp;<span style="color:purple;">DateStringProperty</span>&nbsp;=&nbsp;<span style="color:darkcyan;">RegisterProperty</span>&lt;<span style="color:blue;">string</span>&gt;(&nbsp;c&nbsp;=&gt;&nbsp;c.<span style="color:purple;">DateString</span>&nbsp;);<br /></pre>
<p>I&#39;m expecting that I should be able to use .NET data annotations on &quot;custom&quot; properties that do not need to be CSLA PropertyInfo properties?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 01, 2011</h2><p>I&#39;m not sure Csla supports properties which it doesn&#39;t know about.&nbsp; And I&#39;m not really sure why you&#39;d not want Csla to know about this property; if it did work, what you&#39;d be doing is have a validation rule that is ONLY enforced by the client.&nbsp; And depending on client (web, for example) it&#39;s trivially easy to get around client side validation.</p>
<p>Of course if you want to go down that road, don&#39;t call the base.AddBusinessRules.&nbsp; Then Csla won&#39;t pick up ANY validation attributes on your properties though.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, February 01, 2011</h2><p>Thanks guys.</p>
<p>My motivations for such&nbsp;properties are&nbsp;precisely that - it&#39;s specific for the the consumer of the business object and mostly on the UI, and almost always wraps over an existing property. It&#39;s purposefully not something I would like to subscribe into CSLA&#39;s field manager, nor it&#39;s business rules. Plainly, it&#39;s a convenience property and I do not want to incur additional cost for it&#39;s convenience by increasing the FieldManager payload, etc. </p>
<p>Fair enought, it isn&#39;t the major use case and it&#39;s mostly for&nbsp;edge-cases, but something that I&#39;ve been able to use with substantial value since CSLA 2.</p>
<p>The code in Csla.Core.BusinessBase.AddBusinessRules() is using a linq statement that assumes all properties decorated with DataAnnotations attributes will be managed properties. All I&#39;m suggesting is that for some scenarios (that I have at least) this isn&#39;t always so, and I&#39;m just asking the question whether it is reasonable for a code tweak to check if there is no corresponding&nbsp;managed property to&nbsp;simply skip over it, instead of throwing the exception in question. </p>
<p>I have a simple enough work around, but it does use yet another slot in the field manager.</p>
<p>Thanks again for your input</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, February 01, 2011</h2><p>Hi.</p>
<p>DataAnnotation rules is wrapped into an ordinary Csla BusinessRule and all field rules require a PropertyInfo object to identify the property the rule is linked to. This is by design in the rule engine. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
