<html><header><title>Passing BrokenRules to ModelState</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Passing BrokenRules to ModelState</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8562.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic posted on Monday, February 22, 2010</h2><p>I am working on an MVC project and want to make use of the BrokenRules to show errors on the view.</p>
<p>Within my objects, I am using the DataAnnotation and in AddBusinessRules() I am calling the base method (base.AddBusinessRules) so it links up the DataAnnotation error with the BrokenRules collection.</p>
<p>One difference I have is that instead of providing the BusinessBase object that has this broken rule, I am creating a DTO (which only has the BusinessBase properties) and returning it to the controller.&nbsp; I want to make sure the controller always goes through the Service layer and does not have access to any of the BusinessBase object&#39;s methods.<br /><br />The DTO that is passed back does have a list similar to BrokenRules collection, but I do not know what I&#39;m suppose to do with the list so that the ModelState gets updated to show the error messages.</p>
<p>- Andy</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, February 22, 2010</h2><p>You are certainly going a different direction than we are with MVC support in CSLA.</p>
<p>CSLA is designed with the idea that the UI (whatever kind of UI that is) will interact with the rich domain object model. So the objects (via CSLA) implement all sorts of features to support UI development - including rich access to the broken rules collection.</p>
<p>If you want to put an abstraction layer between your business layer and the UI, that&#39;s probably fine, but it defeats much of the value of CSLA.</p>
<p>CSLA 3.8 has a CslaModelBinder that helps you bind objects in the model, taking care of the otherwise duplicated DataAnnotations invocations.</p>
<p>CSLA 4 will have a more powerful CslaModelBinder, along with a controller base class that exposes protected methods to simplify the creation of at least the common CRUD operations a controller usually contains.</p>
<p>But all that is based on the assumption that the UI is interacting directly with the domain model.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ballistic replied on Monday, February 22, 2010</h2><p>The main reason I was thinking of using the DTO was to force the 
controller to go through the Service layer.&nbsp; I would still do the 
validation in one place (the BusinessBase object), and then copy the 
broken rules to the DTO.<br /><br />I&#39;ll take a look at the CslaModelBinder.</p>
<p>Thank you!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 22, 2010</h2><p>In the CSLA model the data portal is the &quot;service layer&quot;. And if you actually do have services, they should be treated as data sources and would be invoked in your DataPortal_XYZ or object factory methods.</p>
<p>This, at least, is the model around which CSLA is designed.</p>
<p>UI -&gt; domain objects -&gt; data portal -&gt; domain objects -&gt; DAL -&gt; database/services/files/etc</p>
<p>In the case of an MVC pattern, the &quot;UI&quot; is composed of Controller and View constructs, both of which have access to the domain objects.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
