<html><header><title>silverlight 4 combo box</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>silverlight 4 combo box</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8535.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie posted on Monday, February 15, 2010</h2><p>i know this is&nbsp;more a silverlight/xaml question but maybe someone here has had the same issue. i am using two CslaDataProviders in my Xaml. </p>
<p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;csla:CslaDataProvider x:Key=&quot;data&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectType=&quot;Business.bizMaintUsers, Business&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FactoryMethod=&quot;GetUsers&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataChangedHandler=&quot;{StaticResource DataErrorDialog}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsInitialLoadEnabled=&quot;True&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;csla:CslaDataProvider x:Key=&quot;plantsData&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectType=&quot;Business.bizPlants, Business&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FactoryMethod=&quot;GetPlants&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataChangedHandler=&quot;{StaticResource DataErrorDialog}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsInitialLoadEnabled=&quot;True&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataChanged=&quot;CslaDataProvider_plantsDataChanged&quot; /&gt;</strong></p>
<p>one to load info into a DataGrid (data)&nbsp;and one to load info into a Combo Box (plantsData)&nbsp;with value/key info. i have the DataGrid bound like this</p>
<p><strong>DataContext=&quot;{Binding Data, Source={StaticResource data}}&quot;</strong></p>
<p>and the Combo Box inside the DataGrid</p>
<p><strong>&lt;swcd:DataGridTemplateColumn Header=&quot;Plant&quot;&gt;<br />&nbsp;&nbsp; &lt;swcd:DataGridTemplateColumn.CellEditingTemplate&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DataTemplate&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ComboBox x:Name=&quot;cboUsers&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ItemsSource=&quot;{Binding Source={StaticResource plantsData},Path=Data, Mode=TwoWay}&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DisplayMemberPath=&quot;PlantName&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SelectedValuePath=&quot;Sysid&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SelectedValue=&quot;{Binding Mode=TwoWay, Path=PlantId}&quot;&nbsp; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br />&nbsp;&nbsp; &lt;/swcd:DataGridTemplateColumn.CellEditingTemplate&gt;<br />&lt;/swcd:DataGridTemplateColumn&gt;</strong></p>
<p>the problem i am having is that the combo box will get loaded with the correct info but it does not get set automatically. the only way i got it to work is by using the</p>
<p><strong>DataChanged=&quot;CslaDataProvider_plantsDataChanged&quot;</strong></p>
<p>and in the code behind i refresh the DataGrid info</p>
<p><strong>Private Sub CslaDataProvider_plantsDataChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)<br />&nbsp; Dim dp As Csla.Silverlight.CslaDataProvider = Resources(&quot;data&quot;)<br />&nbsp; dp.Refresh()<br />End Sub</strong></p>
<p>after the data is refreshed the Combo Box is set correctly but there seems to be a more efficient way to do this so im not making two calls to get the data. any ideas?</p>
<p>germie</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>
<p><span style="font-family:Consolas;color:#ffffff;font-size:x-small;"><span style="font-family:Consolas;color:#ffffff;font-size:x-small;"><span style="font-family:Consolas;color:#ffffff;font-size:x-small;"><font face="Consolas" size="2" color="#ffffff"><font face="Consolas" size="2" color="#ffffff"><font face="Consolas" size="2" color="#ffffff">
<p>&nbsp;</p>
</font></font></font></span><font face="Consolas" size="2" color="#ffffff"><font face="Consolas" size="2" color="#ffffff">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2" color="#ffffff">
<p>&nbsp;</p>
</font></span>
<p>&nbsp;</p>
</p>
</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 15, 2010</h2><p>Could it be a bug in the SL4 combobox? In SL2 and SL3 they didn&#39;t have a way to bind to the selected id value, so everyone had to write their own subclass (see some of the CSLA samples for example). I&#39;d heard they fixed this in SL4, but haven&#39;t had time to look - but since it is a new feature, perhaps it doesn&#39;t totally work yet?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Peran replied on Tuesday, February 16, 2010</h2><p>I had a similar issue in Silverlight 3 using MVVM rather than DataProviders.&nbsp; Essentially you need to make sure your NameValueList is bound to the combobox before you bind the BusinessObject, with 2 asynchronous data fetches you have no idea which one will be bound to the combobox first, so you may get inconsistent results.&nbsp; This is probably correct behaviour for the ComboBox because if a value is bound to a combobox and that value is not in the combobox list an exception would be generated (which is currently being swallowed by the UI).</p>
<p>In my ViewModel I ensure all my NameValueLists have been fetched before I fetch the BusinessObject. It looks like you are doing something similar with the event handler and I think if you made <strong>IsInitialLoadEnabled=&quot;False&quot;</strong>on <strong>x:Key=&quot;data&quot;</strong> you would only be making one call to fetch the data.</p>
<p>Thinking about my solution now, I have modified my ViewModel to solve a particular UI issue which may not be in the spirit of MVVM...maybe an alternative would be extend the combobox to force a rebind of SelectedItem/Value whenever the Items list changes???</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Peran</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 16, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>Peran<br></b></p>
<p>Thinking about my solution now, I have modified my ViewModel to solve a particular UI issue which may not be in the spirit of MVVM...maybe an alternative would be extend the combobox to force a rebind of SelectedItem/Value whenever the Items list changes???</p>
<p></div></p>
<p>I&#39;m not sure you violated the spirit of the pattern. The viewmodel is part of the UI layer, and so is by definition UI-specific. As long as your viewmodel doesn&#39;t use any XAML or view-specific types you are good.</p>
<p>It seems like a perfectly reasonable idea that the viewmodel might control the order in which data is retrieved.</p>
<p>Another solution is to use a unit of work object to get all required data for the view. Often this is a ReadOnlyBase object that, on the server, calls the factory methods of all the required business objects and returns them to the UI as a unit. That avoids the ordering issue (somewhat) because all required objects arrive on the client at the same time.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Tuesday, February 16, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>Another solution is to use a unit of work object to get all required data for the view. </div></p>
<p>are there any UOW samples? that sounds like it will work the best</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, February 16, 2010</h2><p>It would just be a command object with properties containing the various data.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 16, 2010</h2><p>I use a ROB for fetching data and a Command object for updates. ROB is more efficient if all you are doing is retrieving data.</p>
<p>I have a full sample as part of the code in the <a href="http://store.lhotka.net">CSLA .NET Core 3.8 video series. </a></p>
<p>The basic structure is:</p>
<p>public class UoW : ReadOnlyBase&lt;UoW&gt;<br />{<br />&nbsp; private Customer _customer;<br />&nbsp; public Customer Customer<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; get { return _customer; }<br />&nbsp; }<br /><br />&nbsp; private void DataPortal_Fetch()<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; _customer = Customer.GetCustomer();<br />&nbsp; }<br />}</p>
<p>Just add a static factory, more properties and more factory calls in the DP_Fetch() method. In many cases you&#39;ll also pass a criteria object that contains enough criteria to know which objects to actually get in DP_Fetch().</p>
<p>Note that other types, like Customer in this example, are entirely normal - you don&#39;t do anything different in their implementation.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>germie replied on Tuesday, February 16, 2010</h2><p>thanks rocky, i havent had a chance to see those videos yet. but i did get it working right by changing the</p>
<p><strong>Private Sub CslaDataProvider_plantsDataChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)<br />&nbsp; Dim dp As Csla.Silverlight.CslaDataProvider = Resources(&quot;data&quot;)<br />&nbsp; dp.Refresh()<br />End Sub</strong></p>
<p>to <strong>dp.Rebind()</strong> and the CB loads and gets set with only one call <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /> don&#39;t know why i didn&#39;t think of that first. but thanks for your responces (peran and andy too)&nbsp;and i will be checking out your Core 3.8 videos soon.</p>
<p>germie</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
