<html><header><title>Error in CslaQueryProvider?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Error in CslaQueryProvider?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5465.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Thursday, September 25, 2008</h2>Hi,<br><br>I'm trying to write a business rule in a child object, which scans its peers in the parent collection for duplicate location numbers.&nbsp; I have the following rule method:<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<font color="#0000ff"> private static bool</font> EnsureUnique( <font color="#008000">Location </font>target, <font color="#008000">RuleArgs </font>e ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">bool </font>result;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#008000">Locations </font>parent;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">string </font>location;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; parent = (<font color="#008000">Locations</font>)target.Parent;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">if </font>( parent == <font color="#0000ff">null </font>) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; result = <font color="#0000ff">true</font>;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">else </font>{<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; location = target.ReadProperty( LocationNumberProperty );<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">try </font>{<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; result =<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; (<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">from </font>others <font color="#0000ff">in </font>parent<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">where </font>others.locationId != target.locationId<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">select </font>others<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ).Any();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">catch </font>( <font color="#008000">Exception </font>ex ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">throw </font>ex;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">if </font>( !result ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; e.Description =<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">string</font>.Format(<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Properties.<font color="#008000">Resources</font>.LocationsNotUnique,<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; location<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; );<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#0000ff">return </font>result;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>Now, obviously the Linq query in the try block isn't the final rule method... but I'm curious as to why this is throwing an exception.<br><br>ArgumentOutOfRangeException:&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Message&nbsp;&nbsp;&nbsp; "Index was out of range. Must be non-negative and less than the size of the collection.\r\nParameter name: index"&nbsp;&nbsp;&nbsp; string<br><br><br>stack trace:<br>"&nbsp;&nbsp; at System.ThrowHelper.ThrowArgumentOutOfRangeException(ExceptionArgument argument, ExceptionResource resource)\r\n&nbsp;&nbsp; at System.ThrowHelper.ThrowArgumentOutOfRangeException()\r\n&nbsp;&nbsp; at System.Collections.Generic.List`1.get_Item(Int32 index)\r\n&nbsp;&nbsp; at System.Collections.ObjectModel.Collection`1.get_Item(Int32 index)\r\n&nbsp;&nbsp; at Csla.LinqBindingList`1.CopyTo(T[] array, Int32 arrayIndex)\r\n&nbsp;&nbsp; at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)\r\n&nbsp;&nbsp; at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)\r\n&nbsp;&nbsp; at Csla.Linq.CslaQueryProvider`2.Execute(Expression expression)\r\n&nbsp;&nbsp; at Csla.Linq.CslaQueryProvider`2.Execute[TResult](Expression expression)\r\n&nbsp;&nbsp; at System.Linq.Queryable.Any[TSource](IQueryable`1 source)\r\n&nbsp;&nbsp; at MedAssociates.Inventory.Location.EnsureUnique(Location target, RuleArgs e) in C:\\source\\MedInventory.Business\\MedInventory.Business\\Location.cs:line 118"<br><br>So... anyone have any ideas?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronErickson replied on Thursday, September 25, 2008</h2>Can you tell me what version you are using?  I just wrote the following test, attempting to re-create the issue, which passes:<br /><br />    [TestMethod]<br />    public void TestQueryProviderAnyOnEmpty()<br />    {<br />      CollectionExtendingIQueryable random = new CollectionExtendingIQueryable();<br /><br />      var filteredResult = from r in random<br />                           where r.SomeVal                            select r;<br /><br />      bool hasNot = filteredResult.Any();<br /><br />      Assert.IsFalse(hasNot);<br />    }<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, September 25, 2008</h2>I'm on 3.5.1.<br><br>Of course now, after lunch, it seems to be working fine now.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
