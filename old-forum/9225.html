<html><header><title>Slowly Inching to Csla4.0. Question about the final step</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Slowly Inching to Csla4.0. Question about the final step</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9225.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Monday, July 19, 2010</h2><p>From VS2008, SL3.0, .Net3.5 and Csla3.8.4, I have arrived at VS2010, SL4.0, .Net4.0 and Csla3.8.4</p>
<p>So far so good.&nbsp; The App runs fine in my development server.&nbsp; I have downloaded Csla4.0 and &quot;installed&quot; it.</p>
<p>I know about the issue of changing PropertyInto stuff from Private to Public, which I am starting on rigt now.&nbsp; My&nbsp;Validation Rules have not been set up yet, nor authorization rules - I wanted to get to 4.0 before starting on those.</p>
<p>Is there any other preparatory change I need to make before &quot;crossing over&quot;?</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, July 19, 2010</h2><p>I think the big things when moving from 3.8 to 4 include:</p>
<ol>
<li>Understanding the new CSLA assemblies (Csla,dll, Csla.Web.dll, Csla.Xaml.dll, etc)</li>
<li>If doing Silverlight 4, making the PropertyInfo&lt;T&gt; fields public</li>
<li>Changing business rules to the new model</li>
<li>Changing authorization rules to the new model</li>
<li>Updating any use of LINQ to CSLA for the new implementation</li>
<li>Switch from non-generic data portal to generic data portal (if necessary)</li>
</ol>
<p>Then there are the things you can choose to exploit:</p>
<ol>
<li>New MVVM support in Silverlight/WPF</li>
<li>New ASP.NET MVC support</li>
<li>Support for SL 4 data binding UI features</li>
<li>Simplified criteria passing</li>
<li>Simplified data portal configuration</li>
<li>and more...</li>
</ol>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Monday, July 19, 2010</h2><p>Thank you.&nbsp; That would be very helpful.</p>
<p>One interesting observation (for all I know it may be expected)</p>
<p>While still working with Csla 3.8.4, I changed all PropertyInfo declarations from private to public.&nbsp;To Create my Root object, I need to send 4 parameters, which I do with an old style Criteria class, which is implemented as shown below.&nbsp; The observation was that when the PropertyInfo items within the Criteria class were changed from private to public, it generated a runtime&nbsp;error as shown below.</p>
<p>Here is my Root object factory method:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void NewEncounter(Int32 personKey, Int32 param2, Int32 param3, Int32 param4, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EventHandler&lt;DataPortalResult&lt;Encounter&gt;&gt; callback)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dp = new DataPortal&lt;Encounter&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.CreateCompleted += callback;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dp.BeginCreate(new Encounter.Criteria(personKey, param2, param3, param4));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Here is the Criteria Class:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Serializable()]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class Criteria : Csla.CriteriaBase<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="text-decoration:underline;">public</span> </strong>static PropertyInfo&lt;Int32&gt; PersonKeyProperty = RegisterProperty&lt;Int32&gt;(typeof(Criteria), new PropertyInfo&lt;Int32&gt;&nbsp;(&quot;PersonKey&quot;,&quot;PersonKey&quot;));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Int32 PersonKey<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return ReadProperty(PersonKeyProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { LoadProperty(PersonKeyProperty, value); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...........&nbsp; Other Properties ..........................</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Criteria(Int32 personKey, Int32 argument2, Int32 argument3, Int32 argument4)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.PersonKey = personKey;<br />&nbsp;..................&nbsp;&nbsp; other criteria arguments ..................<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><br />---------------------------<br />Data error<br />---------------------------<br />Csla.Reflection.CallMethodException: NewEncounter method call failed ---&gt; Csla.PropertyLoadException: Property load or set failed for property PersonKey (Attempt by method &#39;Csla.Core.FieldManager.FieldDataManager.ForceStaticFieldInit(System.Type)&#39; to access field &#39;VisitLibrary.Encounter+Criteria.PersonKeyProperty&#39; failed.)<br />at Csla.Core.ManagedObjectBase.LoadProperty[P](PropertyInfo`1 propertyInfo, P newValue)<br />at VisitLibrary.Encounter.Criteria.set_PersonKey(Int32 value)<br />at VisitLibrary.Encounter.Criteria..ctor(Int32 personKey, Int32 param2, Int32 param3, Int32 param4)<br />at VisitLibrary.Encounter.NewEncounter(Int32 personKey, Int32 param2, Int32 param3, Int32 param4, EventHandler`1 callback)<br />&nbsp;--- End of inner exception stack trace ---<br />at Csla.Reflection.MethodCaller.CallFactoryMethod(Type objectType, String method, Object[] parameters)at Csla.Silverlight.ViewModelBase`1.BeginRefresh(String factoryMethod, Object[] factoryParameters)</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 19, 2010</h2><p>Your RegisterProperty() call isn&#39;t using the lambda syntax, and your first parameter (the typeof() parameter) is incorrect.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, July 20, 2010</h2><p>Aah!</p>
<p>That was the first and only multi-argument Criteria class I wrote almost 8 months, don&#39;t even know where I got that code.&nbsp; Amazingly it&#39;s been working all these months.</p>
<p>In VS2010, I am using:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class Criteria : Csla.BusinessBase&lt;Criteria&gt;</p>
<p>In VS2008 I have already tried:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private class Criteria : Csla.BusinessBase&lt;Criteria&gt;, ICriteria<br />and it appears to work fine</p>
<p>I have now also&nbsp;learnt that in Csla4, ICriteria is neither available nor necessary.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>b1tburn3r replied on Tuesday, February 25, 2014</h2><p>I need a second pair of eyes on this...</p>
<p>I am using RegisterProperty with the Lambda syntax (see my example below), I also have the PropertyInfo set as a public static instance, however; I am getting the exact same error he is describing in his original question. &nbsp;The exception is thrown in my code by CSLA when I call LoadProperty with the value to set (I am just setting it inside my constructor as shown below). &nbsp;FWIW - this is on a SilverLight application happening on the client side.</p>
<p>I must be missing something somewhere because I am using the built in Csla.Security.UsernameCriteria class in my own custom identity implementation and LoadProperty works fine in there...</p>
<p>[Serializable]<br />private class CustomerCriteria : CriteriaBase&lt;CustomerCriteria&gt;<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public static PropertyInfo&lt;Guid&gt; CustomerIdProperty = RegisterProperty&lt;Guid&gt;(p =&gt; p.CustomerId);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;internal CustomerCriteria(Guid custId)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CustomerId = custId;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public Guid CustomerId<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get { return ReadProperty(CustomerIdProperty);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;private set { LoadProperty(CustomerIdProperty, value); }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br />}</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>b1tburn3r replied on Tuesday, February 25, 2014</h2><p>Spent some time poking around the CSLA codebase to see if I could figure out what I was doing wrong in my code...</p>
<p>Interesting - the problem seems to be that I cannot have a private nested criteria class in my business object, and I need a public parameterless constructor on the Silverlight side as well - once I made the criteria class public and added the constructor was able to call LoadProperty without issue.</p>
<p>It would seem that I am going to have to unlearn some habits I got used to doing in the earlier versions of Csla...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, February 25, 2014</h2><p>The Silverlight runtime imposes some limitations on what can be done, and CSLA had to be altered to accommodate them.</p>
<p>The &quot;Using CSLA 4&quot; ebook series, and the Silverlight video series touch on most of the difference points.</p>
<p>The upside to adapting though, is that WinRT imposes similar limitations (I think of it as basically being Silverlight 6 :) ), so if you get used to programming for Silverlight you should be all set for WinRT.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
