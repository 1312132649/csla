<html><header><title>Parent BO calculated property value using Child BO's</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Parent BO calculated property value using Child BO's</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2966.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna posted on Thursday, May 31, 2007</h2>Hello,<br><br>I have a parent BO that has a list of child BO's. For each child BO the user can manually enter a weight. The parent BO has a property that calculates the sum of the weights for the child BO's.<br>I use Winforms to present the BO's and the parent BO is known by it's child BO's.<br><br>When I change the weight of a child BO the parent BO should be informed that a change has been made and fire a PropertyHasChanged for the user to see the weight of the parent changed.<br><br>However what is the correct way to implement? How can I let the parent BO know a child BO has changed? Using PropertyChanged event?<br><br>Any thoughts?<br><br>Regards,<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, May 31, 2007</h2><P>In order for WinForms databinding to refresh the parent "sum" I suppose you could attach a handler in the parent object&nbsp;to the listchanged event of the list of children&nbsp;- capture deletes and itemchanged for the weight property and then do as you say - fire the property changed for the parent's property (which I assume sums up the child weights).</P>
<P>The insert case&nbsp;probably doesn't matter since I imagine their default value is 0 or null. </P>
<P>Chris</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Thursday, May 31, 2007</h2><P>I don't have real knowledge of your use case here, of course.&nbsp; </P>
<P>But it usually seems to me that functionality that needs access to all the <STRONG>members </STRONG>of a <STRONG>List </STRONG>is properly the <STRONG>responsibility of that List </STRONG>(rather than the EditableRoot object of which&nbsp;that List&nbsp;object is a property).&nbsp; If the parent object needs the value of the weight of the entire collection, it can retrieve as simply as it gets the .Count propert of the List, right?</P>
<P>If you see it the same way, you just need to wire the handler suggested in&nbsp;Chris' post to the List object.&nbsp;&nbsp;The handler&nbsp;would presumably update the value of the List's new property (.Weight).&nbsp; When Parent needs it, they just&nbsp;use &lt;ChildListName&gt;.Weight.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, May 31, 2007</h2><P>Yeah, the parent would be respondent to the list saying "I've changed!".</P>
<P>The reason why the parent needs to know the list has changed isn't so much to do with object design per say in this case (the list could definitely have the sum too) but rather with Winforms databinding I believe - the parent's sum display won't automatically refresh unless you tell it to - so the parent needs to be able to subscribe to something that'll tell it when the sum changes so it can trigger this refresh. </P>
<P>(I work entirely in the Web but this is how I remember the issues in Win)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cultofluna replied on Thursday, May 31, 2007</h2>Hey, thanks for the answers so far!<br><br>That's exactly what I did. I've created a .Sum like property that simply sums all the weights of the child BO's. This property is exposed through the parent BO.<br><br>The problem is as Chris says, the Winform won't refresh. Isn't the list changed event a pretty expensive event? As it seems to respond to every change in the child BO?<br><br>Regards,<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 01, 2007</h2>You're on the right track.&nbsp; As others have pointed out, there's no meaningful way to databind to a property on a list object.. so your sumation which DOES belong on that class should be there, but internal.<br><br>What you need to do in the object which contains the list object is have the parent listen to the ListChanged event.&nbsp; The ListChanged event is no more expensive than any other event.&nbsp; Yes it will respond to every change in the child, but you're limited by how fast a user may change each property of a child.&nbsp; So the parent's ListTotal property changed will be fired more often, but in reality its only two bindings that would be affected.<br><br>Here's how I typically handle this:<br>public MyBLB Children {<br>&nbsp;&nbsp; get { return children; }<br>&nbsp;&nbsp; private set {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  if ( children != value ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  if ( children != null ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  children.ListChanged -= Children_ListChanged;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  children = value;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  if ( children != null ) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  children.ListChanged += Children_ListChanged;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}<br>}<br><br>private void Children_ListChanged( object sender, ListChangedEventArgs e ) {<br>&nbsp;&nbsp;&nbsp; PropertyHasChange( "ListTotal" );<br>}<br><br>I always use the list Property when initalizing, so that the event handlers get unhooked / hooked properly.<br><br>protected override void DataPortal_Create() {<br>&nbsp;&nbsp;&nbsp; // Other code<br>&nbsp;&nbsp;&nbsp; Children = MyBLB.New();<br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ward0093 replied on Wednesday, July 25, 2007</h2><P>i need to bring this topic back up because I have a very similiar issue...&nbsp; I have a parent BO with child collection of childBOs... I have a property in my Parent BO cause LineItemsTotal that simply references the child collection property called LineItemsTotal which interns does the sumation of all the childrens LineItemTotal.</P>
<P>Now I can trap the ListChanged Event of the child collection&nbsp;object&nbsp;in my ParentBO... but there is no way to tell which property had changed?&nbsp; I do not want to fire off a PropertyHasChanged("LineItemsTotal") in my parent BO for every single item changed event in the child collection... the event would be fire thousands of times.</P>
<P>how do you find out which child bo property did the listchange event firing?</P>
<P>ward0093</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 25, 2007</h2><P>ListChanged will tell you the property that changed, I'm pretty sure. </P>
<P>You'd also want to accomodate it for when an item is removed (and added if the default amount for that line is somehow non-zero).</P>
<P>edit: <FONT size=2>System.ComponentModel.</FONT><FONT color=#008080 size=2>ListChangedEventArgs</FONT><FONT size=2> e</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ward0093 replied on Thursday, July 26, 2007</h2><P>i thought e.PropertyDescriptor was set to nothing but that is not true&nbsp;with the ItemChanged ListChanged Event arg type so that should work.</P>
<P>thanks,<BR>ward0093</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ward0093 replied on Thursday, July 26, 2007</h2><P>why is e.PropertyDescriptor is set to null&nbsp;when ListChangedType = ItemChanged?&nbsp; I can not evalulate it if the PropertyDescriptor is not set!</P>
<P>anyone have an answer to this?</P>
<P>ward0093</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
