<html><header><title>Problem running Sample App - DataPortal_Fetch method call failed</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem running Sample App - DataPortal_Fetch method call failed</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1435.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TravelinMan posted on Tuesday, October 10, 2006</h2><P>Hello,</P>
<P>I was intrigued and excited by the walkthrough videos Rocky did and decided to dive in and see what I could do. I've gotten the Expert C# book and am trying to run the Project Tracker demo app. I've followed the steps outlined in the Instructions To Build CSLA.NET 2.0 and the ProjectTracker Sample but when I run the PTWeb and select either the Project or Resource options I get the error below.</P>
<P>I ran regsvcs on the EnterpriseServicesHostcs dll and setup the ApplicationRootDirectory in COM+. Also, this is running against SQL 2005 so I modified the connection string to the following:</P><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>name</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>PTracker</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>connectionString</FONT><FONT color=#0000ff size=2>= </FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>server=&lt;ServerName&gt;;database=PTracker;uid=PTUser;pwd=PT</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>providerName</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>System.Data.SqlClient</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>name</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Security</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>connectionString</FONT><FONT color=#0000ff size=2>= </FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>server=&lt;ServerName&gt;;database=Security;uid=PTUser;pwd=PT</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>providerName</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>System.Data.SqlClient</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</P></FONT>
<P>I feel like Im running around in circles for something that might be pretty simple but without knowing yet too much whats under the covers I'm not really sure what else to look for. </P>
<P>If anyone can point me in the right direction I would greatly appreciate it.</P>
<P>Thanks, Mark</P>
<P><FONT size=2>[NullReferenceException: Object reference not set to an instance of an object.]<BR><BR>[CallMethodException: DataPortal_Fetch method call failed]<BR><BR>[DataPortalException: DataPortal.Fetch failed (System.NullReferenceException: Object reference not set to an instance of an object.<BR>&nbsp;&nbsp; at ProjectTracker.Library.Database.get_PTrackerConnection() in C:\csla20cs\ProjectTracker20cs\ProjectTracker.Library\Database.cs:line 14<BR>&nbsp;&nbsp; at ProjectTracker.Library.ProjectList.Fetch(String nameFilter) in C:\csla20cs\ProjectTracker20cs\ProjectTracker.Library\ProjectList.cs:line 75<BR>&nbsp;&nbsp; at ProjectTracker.Library.ProjectList.DataPortal_Fetch(Criteria criteria) in C:\csla20cs\ProjectTracker20cs\ProjectTracker.Library\ProjectList.cs:line 64)]<BR>&nbsp;&nbsp; Csla.DataPortal.Fetch(Type objectType, Object criteria) in C:\csla20cs\csla20cs\Csla\DataPortal\Client\DataPortal.cs:192<BR>&nbsp;&nbsp; Csla.DataPortal.Fetch(Object criteria) in C:\csla20cs\csla20cs\Csla\DataPortal\Client\DataPortal.cs:140<BR>&nbsp;&nbsp; ProjectTracker.Library.ProjectList.GetProjectList() in C:\csla20cs\ProjectTracker20cs\ProjectTracker.Library\ProjectList.cs:22<BR>&nbsp;&nbsp; ProjectList.GetProjectList() in c:\csla20cs\ProjectTracker20cs\www\PTWeb\ProjectList.aspx.cs:88<BR>&nbsp;&nbsp; ProjectList.ProjectListDataSource_SelectObject(Object sender, SelectObjectArgs e) in c:\csla20cs\ProjectTracker20cs\www\PTWeb\ProjectList.aspx.cs:77<BR>&nbsp;&nbsp; Csla.Web.CslaDataSource.OnSelectObject(SelectObjectArgs e) in C:\csla20cs\csla20cs\Csla\Web\CslaDataSource.cs:150<BR>&nbsp;&nbsp; Csla.Web.CslaDataSourceView.ExecuteSelect(DataSourceSelectArguments arguments) in C:\csla20cs\csla20cs\Csla\Web\CslaDataSourceView.cs:94<BR>&nbsp;&nbsp; System.Web.UI.DataSourceView.Select(DataSourceSelectArguments arguments, DataSourceViewSelectCallback callback) +17<BR>&nbsp;&nbsp; System.Web.UI.WebControls.DataBoundControl.PerformSelect() +149<BR>&nbsp;&nbsp; System.Web.UI.WebControls.BaseDataBoundControl.DataBind() +70<BR>&nbsp;&nbsp; System.Web.UI.WebControls.GridView.DataBind() +4<BR>&nbsp;&nbsp; System.Web.UI.WebControls.BaseDataBoundControl.EnsureDataBound() +82<BR>&nbsp;&nbsp; System.Web.UI.WebControls.CompositeDataBoundControl.CreateChildControls() +69<BR>&nbsp;&nbsp; System.Web.UI.Control.EnsureChildControls() +87<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +41<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +161<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +161<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +161<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +161<BR>&nbsp;&nbsp; System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1360</FONT></P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>twistedstream replied on Wednesday, October 25, 2006</h2><P>Mark,</P>
<P>I had this same problem to after downloading the new CLSA.NET 2.1 code and running through the instructions PDF to set up the Project Tracker demo.&nbsp; I'm not sure if this issue only manifests itself on Windows Server 2003, but that's what I'm running as well (not Windows XP or 2000).</P>
<P>The good news is I finally figured it out.</P>
<P>It turns out that the EnterpriseServicesHostcs component is unable to read from the <STRONG>application.config</STRONG> file, as was intended.&nbsp; The error occurs because the <STRONG>PTrackerConection</STRONG> property of the <STRONG>Database</STRONG> class in the Project Tracker library is attempting to access a connection string (in this case, one named "PTracker") that can't be found.&nbsp; Why can't it be found?&nbsp; The main reason is that the code is running within Enterprise Services as a hosted COM+ object.&nbsp; The host process for Enterprise Services is <STRONG>dllhost.exe</STRONG>, which lives in your <STRONG>system32</STRONG> directory.&nbsp; By default, the CLR looks for an application config file by the name of your host process + .config, in this case <STRONG>dllhost.exe.config</STRONG>.&nbsp; If no such file exists (which in our case it doesn't), then you're left with whatever default configuration the CLR gives you and you certainly don't get anything from the desired <STRONG>application.config</STRONG> file.</P>
<P>I found the solution to this problem <A href="http://staff.newtelligence.net/clemensv/PermaLink.aspx?guid=0615b3cc-0fbf-4cf5-9d49-ae95b50f7e8d">here</A>, where it explains how to configure the associated COM+ application to look in a different directory than <STRONG>system32</STRONG> for a specific file named <STRONG>application.config</STRONG>.&nbsp; Once you do that, the CLR is able to find your <STRONG>application.config</STRONG> and life is good.</P>
<P>Now, since the <STRONG>application.config</STRONG> and associated <STRONG>application.manifest</STRONG> files are present in the EnterpriseServicesHostcs project in Visual Studio, but not necessarily in the bin\Debug folder, I modified the <STRONG>Copy to Output Directory</STRONG> property of both files from <STRONG>Do not copy</STRONG> (the default) to <STRONG>Copy if newer</STRONG>.&nbsp; That way I could point the COM+ application at the bin\Debug folder (where the assembly itself lives) instead of the VS project's folder.</P>
<P>Hope this helps.</P>
<P>~pete</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>twistedstream replied on Wednesday, October 25, 2006</h2><P>By the way, I just noticed that Rocky talks about this exact situation in chapter 12 of his new Expert <A href="http://www.apress.com/book/bookDisplay.html?bID=10091">C# 2005 Business Objects </A>book, starting on page 615.&nbsp; Rocky also makes the disclaimer in the setup PDF to read that chapter if you decide to use any of the DataPortal proxies besides the local one for further setup instructions.</P>
<P>~pete</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TravelinMan replied on Friday, November 03, 2006</h2><P>Pete</P>
<P>Thanks for the reply. I came upon much the same solution (I am running XP Pro). After I finally figured out which directory I was supposed to point the Application Root directory to everything works fine.</P>
<P>Thanks,</P>
<P>Mark</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>agohsa replied on Tuesday, November 28, 2006</h2>If you have found a solution to your issue please post it. I ran into the same issue. Thanks.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>twistedstream replied on Tuesday, November 28, 2006</h2><P>I think the solution was posted.&nbsp; See posts 8312 and 8313 above.&nbsp;</P>
<P>~pete</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>agohsa replied on Tuesday, November 28, 2006</h2>Resolved.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
