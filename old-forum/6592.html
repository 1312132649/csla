<html><header><title>CodeSmith VB Templates for CSLA 3.6</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CodeSmith VB Templates for CSLA 3.6</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6592.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>nj609eagle posted on Wednesday, March 11, 2009</h2><P>I spent some time converting the existing C# templates from CSLAContrib to VB.</P>
<P>The biggest change in these templates is that we are not using LINQ to SQL for our data access nor are we using a DataAccess Layer object.</P>
<P>We place a files called DBConnections on our web servers, but not within the wwwroot folder.&nbsp; this usually resides on a separate drive than the web site.&nbsp; We place two entries in our web.config files that&nbsp; help locate the proper db sonnection strings.&nbsp; We add a key called&nbsp; <FONT color=#a31515 size=2>ConnectionString_Config_File <FONT color=#000000><FONT size=3>which will contain the</FONT> </FONT></FONT>physical path of the file that contains the connection strings.&nbsp; The second key is <FONT color=#a31515 size=2>EnvironmentMode <FONT color=#000000 size=3>.&nbsp; This allows us to have Development, QA and production sections within our DBConnections file.</FONT></FONT></P>
<P>Within our own Application Framework classes we have a utility function called <FONT color=#0000ff>GetConnectionString. </FONT><FONT color=#000000>You will see refrences to this in the dataAccess Templates attached. That function is here:</FONT></P>
<P><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> GetConnectionString(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> databaseName </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</P></FONT><FONT size=2>
<P></FONT>
<P><FONT size=2></P></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> configFile </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> configXmlDocument </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> XmlDocument<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> databaseNode </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> XmlNode<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> databaseQuery </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> StringBuilder<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> xPath </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>.Empty<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> connectionString </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> configMode </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>String<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> mode </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> EnvironmentMode 
<P></P>
<P>configMode = ConfigurationManager.AppSettings(</FONT><FONT color=#a31515 size=2>"EnvironmentMode"</FONT><FONT size=2>)<BR>mode = </FONT><FONT color=#0000ff size=2>CType</FONT><FONT size=2>(configMode, EnvironmentMode) <FONT color=#008000>'An Enum for Pro, QA, Dev</FONT></P>
<P></FONT><FONT color=#008000 size=2>' read config to determine if connection string is encrypted<BR></FONT><FONT size=2>configFile = ConfigurationManager.AppSettings(</FONT><FONT color=#a31515 size=2>"ConnectionString_Config_File"</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> File.Exists(configFile) </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>configXmlDocument.Load(configFile)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xPath = </FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>.Format(</FONT><FONT color=#a31515 size=2>"/root/connectionstring[translate(@mode,'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz')='{0}']/database[translate(@name,'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz')='{1}']"</FONT><FONT size=2>, mode.ToString.ToLower, databaseName.ToLower)</P>
<P></FONT><FONT size=2>databaseNode = configXmlDocument.SelectSingleNode(xPath)<BR></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> databaseNode </FONT><FONT color=#0000ff size=2>Is</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Nothing</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Exception(</FONT><FONT color=#0000ff size=2>String</FONT><FONT size=2>.Format(</FONT><FONT color=#a31515 size=2>"The connection string could not be found in {0}. Database key = {1}"</FONT><FONT size=2>, configFile, databaseName))<BR></FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>connectionString = databaseNode.Attributes(</FONT><FONT color=#a31515 size=2>"value"</FONT><FONT size=2>).Value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> connectionString = </FONT><FONT color=#a31515 size=2>""</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Exception(</FONT><FONT color=#a31515 size=2>"The connection string cannot blank."</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> FileNotFoundException(</FONT><FONT color=#a31515 size=2>"The database connection string configuration file could not be found at "</FONT><FONT size=2> &amp; configFile &amp; </FONT><FONT color=#a31515 size=2>"."</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> connectionString<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT>
<P>&nbsp;</P>
<P>Other changes to the templates include adding the Select, Insert, update, and Delete stored procedures the object will use.&nbsp; We have several DB's with existing stored procedures so it was key for us to reuse them.&nbsp; Additionaly these are used to help build the parameter statements for the appropiate command objects.&nbsp; You'll see then in a include file called InitializeInsertUpdateParams.</P>
<P>I removed all of the Indent() calls.&nbsp; This was becoming very confusing during the conversion and since CodeSmith takes your physical indents to and uses them, this I found was cleaner.</P>
<P>I also removed the ability to base the object from an XML file.&nbsp; This was done so that we had a clean template and allowed us to have a little less confusion in the TemplateBase.vb file.</P>
<P>Since most of the TemplateBase file was done using a code converter tool, there are still some elements in C# because they were contained with a string.Format function and enclosed in quotes.&nbsp; I'm sure some may find these templaetes usefull, others may find them lacking key points for their development.&nbsp; But I think it's a strong start and easily updated for those that are more comfortable with vb than c#</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Wednesday, March 11, 2009</h2>Thanks!<br>I'm going to check these out today.<br><br>I appreciate the work on converting these templates.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Wednesday, March 11, 2009</h2>Hmm.. I'm fairly new to CodeSmith, but I can't get any of the templates to open without compile errors.&nbsp; I tried opening&nbsp; EditableRoot.cst, EditableChild.cst, ReadOnlyChild.cst and they all fail.<br><br>I'm currently using CodeSmith 2.6.<br><br>Any Ideas?<br><br>---------------- Compile started -----------------<br><br>(54,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(57,0): error BC30035: Syntax error.<br>(58,0): error BC30689: Statement cannot appear outside of a method body.<br>(59,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(60,0): error BC30035: Syntax error.<br>(61,0): error BC30689: Statement cannot appear outside of a method body.<br>(62,0): error BC30188: Declaration expected.<br>(63,0): error BC30087: 'End If' must be preceded by a matching 'If'.<br>(64,0): error BC30188: Declaration expected.<br>(65,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(66,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(70,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(73,0): error BC30035: Syntax error.<br>(74,0): error BC30689: Statement cannot appear outside of a method body.<br>(75,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(76,0): error BC30035: Syntax error.<br>(77,0): error BC30689: Statement cannot appear outside of a method body.<br>(78,0): error BC30188: Declaration expected.<br>(79,0): error BC30087: 'End If' must be preceded by a matching 'If'.<br>(80,0): error BC30188: Declaration expected.<br>(81,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(82,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(86,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(89,0): error BC30035: Syntax error.<br>(90,0): error BC30689: Statement cannot appear outside of a method body.<br>(91,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(92,0): error BC30035: Syntax error.<br>(93,0): error BC30689: Statement cannot appear outside of a method body.<br>(94,0): error BC30188: Declaration expected.<br>(95,0): error BC30087: 'End If' must be preceded by a matching 'If'.<br>(96,0): error BC30188: Declaration expected.<br>(97,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(98,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(106,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(108,0): error BC30035: Syntax error.<br>(109,0): error BC30689: Statement cannot appear outside of a method body.<br>(110,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(111,0): error BC30035: Syntax error.<br>(112,0): error BC30188: Declaration expected.<br>(113,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(114,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(117,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(119,0): error BC30035: Syntax error.<br>(120,0): error BC30689: Statement cannot appear outside of a method body.<br>(121,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(122,0): error BC30035: Syntax error.<br>(123,0): error BC30188: Declaration expected.<br>(124,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(125,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(130,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(132,0): error BC30035: Syntax error.<br>(133,0): error BC30689: Statement cannot appear outside of a method body.<br>(134,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(135,0): error BC30035: Syntax error.<br>(136,0): error BC30188: Declaration expected.<br>(137,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(138,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(150,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(152,0): error BC30035: Syntax error.<br>(153,0): error BC30689: Statement cannot appear outside of a method body.<br>(154,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(155,0): error BC30035: Syntax error.<br>(156,0): error BC30188: Declaration expected.<br>(157,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(158,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(161,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(163,0): error BC30035: Syntax error.<br>(164,0): error BC30689: Statement cannot appear outside of a method body.<br>(165,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(166,0): error BC30035: Syntax error.<br>(167,0): error BC30188: Declaration expected.<br>(168,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(169,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(172,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(174,0): error BC30035: Syntax error.<br>(175,0): error BC30689: Statement cannot appear outside of a method body.<br>(176,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(177,0): error BC30035: Syntax error.<br>(178,0): error BC30188: Declaration expected.<br>(179,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(180,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(183,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(185,0): error BC30035: Syntax error.<br>(186,0): error BC30689: Statement cannot appear outside of a method body.<br>(187,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(188,0): error BC30035: Syntax error.<br>(189,0): error BC30188: Declaration expected.<br>(190,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(191,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(200,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(202,0): error BC30035: Syntax error.<br>(203,0): error BC30689: Statement cannot appear outside of a method body.<br>(204,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(205,0): error BC30035: Syntax error.<br>(206,0): error BC30188: Declaration expected.<br>(207,0): error BC30632: 'End Set' must be preceded by a matching 'Set'.<br>(208,0): error BC30431: 'End Property' must be preceded by a matching 'Property'.<br>(211,0): error BC32035: Attribute specifier is not a complete statement. Use a line continuation to apply the attribute to the following statement.<br>(213,0): error BC30035: Syntax error.<br>(214,0): error BC30689: Statement cannot appear outside of a method body.<br>(215,0): error BC30630: 'End Get' must be preceded by a matching 'Get'.<br>(0,0): error BC30041: Maximum number of errors has been exceeded.<br><br>Build complete -- 102 errors, 0 warnings<br><br>---------------------- Done ----------------------<br><br>Build failed<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>nj609eagle replied on Wednesday, March 11, 2009</h2><P>An additional modification I made was to change teh attributes on the properties within the TemplateBase.vb file.&nbsp; I'm using CodeSmith 4 so there attribute tages were depreciated.&nbsp; It was bothering me to see these warnings when other errors were causing the compile to fail.</P>
<P>Change the attributes on the properties back to the 2.6 format:</P>
<P><FONT color=#0000ff>&lt;CodeTemplateProperty(CodeTemplatePropertyOption.Required), Category("3. Options"), Description("What type of Transaction should this Business Object use?")&gt; _ </FONT></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>reagan123 replied on Wednesday, March 11, 2009</h2>Thanks... I'll give it a shot.&nbsp; I appreciate the response.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
