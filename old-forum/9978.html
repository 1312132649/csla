<html><header><title>DynamicListBase and WPF lost exception</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DynamicListBase and WPF lost exception</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9978.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough posted on Tuesday, January 25, 2011</h2><p>We are trying to use the DynamicListBase stereotype with WPF view model bound to a listbox. &nbsp;In the view model we are manually calling Model.Remove and passing it our selected item. &nbsp;This works when the factory doesn&#39;t throw an exception, however if the factory raises an exception then we have no way of seeing that exception in the UI. &nbsp;The OnError is never called on the view model and a try-catch around the Model.Remove(SelectedItem) never gets hit.</p>
<p>Any ideas on how to handle the exceptions in this case.</p>
<p>Regards</p>
<p>Kevin</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, January 25, 2011</h2><p>The fetch factory throws an exception, and OnError isn&#39;t invoked?</p>
<p>Is this a sync or async factory? If it is a sync factory you may need a try..catch around the DoRefresh call, otherwise OnError should surely be invoked.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Wednesday, January 26, 2011</h2><p>The fetch factory works ok as expected.</p>
<p>This is a DynamicListBase object and I&#39;m calling Model.Remove(SelectedItem) via a delete action in the UI which directly calls the DataPortal&nbsp;(probably&nbsp;asynchronously). &nbsp;If this fails in the ObjectFactory there is no exception back on the client. &nbsp;OnError is not invoked and I cannot try...catch around it.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Wednesday, January 26, 2011</h2><p>We have tried hooking up to the Saved event on the SelectedItem;&nbsp;SelectedItem.Saved += (s,e) =&gt; { ...e.Error is null here } &nbsp;This gets called on return from the data portal but e.Error is null.</p>
<p>We have tried hooking up Model.Saved event in the view model: Model.Saved += (s,e) =&gt; { e.Error is correct here} &nbsp;this works. &nbsp;However this would suggest a problem somewhere because the Error property on the view model itself is null.</p>
<p>Edit: Also tried DoRemove(SelectedItem) in the view model, no exception</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, January 26, 2011</h2><p>I see. I think this is a mismatch between ViewModelBase and DynamicListBase. Not necessarily a bug either, just a side-effect of the way things work.</p>
<p>DLB doesn&#39;t ever get saved itself, and the object saving infrastructure in VMB is all around saving the root object. So the viewmodel&#39;s OnSaved and OnError methods (for example) relate to the saving of the root object, which never happens with a DLB.</p>
<p>So I think when your model is a DLB, you&#39;ll need to write your own code in the viewmodel to handle the Model.Saved event. If you want, you could set the VMB Error property because its setter is protected.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Thursday, January 27, 2011</h2><p>It still seems a little odd however because we are wiring up the Saved on the Model which is the DLB not the individual items of the collection.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kevin Fairclough replied on Thursday, January 27, 2011</h2><p>We are also having problems with visual binding. &nbsp;It seems that OnModelChanged is only ever called on population, not when adding/deleting/editing&nbsp;the items, this screws up our UI. &nbsp;We are using Caliburn but I don&#39;t think this is affecting the situation as its our Model that is bound to the listbox.</p>
<p>The only solution we can find that behaves correctly is on the Model.Saved to clear the ItemsSource.</p>
<p>&nbsp;</p>
<pre><span>var _itemSource = lb.ItemsSource as IList;
                                   lb.ItemsSource = null;
                                   lb.ItemsSource = _itemSource;</span></pre>
<pre><span><br /></span></pre>
<pre><span>I don&#39;t think this ViewModelBase can be used easily with DLB stereotype <img src="http://forums.lhotka.net/emoticons/emotion-6.gif" alt="Sad" />.</span></pre>
<pre><span>Kevin</span></pre>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, January 27, 2011</h2><p>That is possible. The ViewModelBase class was designed around BB and BLB, with support for ROB and ROLB.</p>
<p>DLB is a very different construct, with very different behaviors. And at the time we wrote this code Microsoft didn&#39;t have a WPF datagrid control that actually worked with any rich collection. I don&#39;t know if they&#39;ve fixed all the issues or not. The last time I tried using it <em>most</em> things did seem to work, but I didn&#39;t build out a comprehensive scenario.</p>
<p>The thing you should ask, is what VMB is getting you. It exists to manage a single root (object or list). That&#39;s it. DLB is not that.</p>
<p>So the only thing VMB can give you then is DoRefresh and BeginRefresh behaviors&nbsp;- which are nice, but not all that critical.</p>
<p>My apps typically have a mix of viewmodel types that subclass ViewModel&lt;T&gt; and DependencyObject depending on whether I actually need anything that is in VMB. If I don&#39;t need what it offers, I don&#39;t subclass VMB.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
