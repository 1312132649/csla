<html><header><title>Edit Level Mismatch - Single Child Object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Edit Level Mismatch - Single Child Object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7049.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W posted on Thursday, June 04, 2009</h2>Hopefully this is me being stupid...<br><br>I have an EditableRoot Contact object that has a single child ProfileCustomer (EditableChild) object.<br><br>I have databound both objects onto a ContactEdit form and this all populates nicely.&nbsp; However, when I call mContact.CancelEdit I get a 'Edit level mismatch in UndoChanges' message from UndoableBase.<br><br>The code I'm calling to cancel the edit is:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnbindBindingSource(Me.ContactBindingSource, saveObject, True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact.CancelEdit()<br><br>Debugging through shows the issue, the EditLevel is getting decreased on the Contact but not on the child ProfileCustomer.<br><br>I'm guessing this is a databinding issue, anyone experienced this when using an aggregated child object?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Friday, June 05, 2009</h2>Sorry, should have also said that I did the databinding by dragging both the Contact fields and the child ProfileCustomer fields onto the form from the Contact datasource.&nbsp; I.e. there is only one bindingsource.&nbsp; Is that OK?<br><br>I tried adding a ProfileCustomerBindingSource and setting it's data souce to the ContactBindingSource and its data member to to the ProfileCustomer property, but this also caused an Edit Level Mismatch - although I think that was actually for a different reason (in this case it seemed like begin edit was getting called on the child ProfileCustomer as part of the action of cancelling the parent's edit).<br><br>Which is the right way to deal with single child objects - or should it not matter?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, June 05, 2009</h2>Well, if possible, I'd try the facada pattern; don't expose the child object directly, add properties onto the root object and have those properties delegate to the child object.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Friday, June 05, 2009</h2>Hi Andy<br><br>I was waiting for someone to say that!&nbsp;&nbsp; There's a reason for this approach unfortunately, the use case here is that there's a main contact edit form (ContactEdit) that then has 'plug-in' customer specific profile classes.. so the idea is that the ContactEdit form doesn't know the exact details of the the ProfileCustomer and hence a facade would be less appropriate I think?<br><br>Anyway, before we trigger another OO design thread (<img src="/emoticons/emotion-14.gif" alt="Devil [6]" />), regardless of whether the above design is good or bad, there must be some scenarios where there would be a one-to-zero-or-one relationship between a Root and Child class and it is desirable to edit both the Root and Child objects on the same form.&nbsp; <br><br>Someone must have done this I'm sure, all I really need to know is that it's possible?<br><br>I guess my specific questions would be:<br><ul><li>One or two binding sources?</li><li>Do I need to manually call begin/cancel/end edit on the child as well as the root?&nbsp; <br>(I guess I probably do, normally the child objects would be in an editable list and so the datagridview control would take care of triggering begin/end/cancel edit.&nbsp; I guess now this is a single object on the same edit form, I need to trigger begin/end/cancel edit for it, unless calling begin/end/cancel edit on the root triggers this on the child too?)<br></li></ul><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Friday, June 05, 2009</h2>Well, it's 10pm and I still can't figure it out!&nbsp; Clearly the answer is to post a lot of code in the hope that one of the brighter minds can assist...<br><br>So, this form is just a reworking of the VB version of ProjectTracker's ProjectEdit form, with the key difference that the child object is a single object (ProfileCustomer) rather than a collection (Resources).<br><br>The key bits of the code are:<br><br><font size="2" face="Courier New"><br><br>Imports Vision.BLL<br><br>Public Class ContactEdit<br><br>&nbsp;&nbsp;&nbsp; Private WithEvents mContact As Contact<br><br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property Contact() As Contact<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mContact<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; Public Sub New(ByVal Contact As Contact)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact = Contact<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BindUI()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplyAuthorizationRules()<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub ApplyAuthorizationRules()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim canEdit As Boolean = _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Vision.BLL.Contact.CanEditObject<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not canEdit Then _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(False, True)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' have the controls enable/disable/etc<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ReadWriteAuthorization1.ResetControlAuthorization()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' enable/disable appropriate buttons<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.OKButton.Enabled = canEdit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ApplyButton.Enabled = canEdit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Cancel_Button.Enabled = canEdit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Me.AssignButton.Enabled = canEdit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Me.UnassignButton.Enabled = canEdit<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' enable/disable role column in grid<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Me.ResourcesDataGridView.Columns(2).ReadOnly = Not canEdit<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub OKButton_Click(ByVal sender As System.Object, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As System.EventArgs) Handles OKButton.Click<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub ApplyButton_Click(ByVal sender As System.Object, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As System.EventArgs) Handles ApplyButton.Click<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using busy As New StatusBusy("Saving...")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(True, True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub Cancel_Button_Click(ByVal sender As System.Object, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As System.EventArgs) Handles Cancel_Button.Click<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(False, True)<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub CloseButton_Click(ByVal sender As System.Object, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As System.EventArgs) Handles CloseButton.Click<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(False, False)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Close()<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub BindUI()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact.BeginEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ContactBindingSource.DataSource = mContact<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ProfileCustomerBindingSource.DataSource = mContact.ProfileCustomer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub RebindUI(ByVal saveObject As Boolean, ByVal rebind As Boolean)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ProfileCustomerBindingSource.RaiseListChangedEvents = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' disable events<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ContactBindingSource.RaiseListChangedEvents = False<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' unbind the UI<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnbindBindingSource1(Me.ProfileCustomerBindingSource, saveObject, False)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnbindBindingSource1(Me.ContactBindingSource, saveObject, True)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ProfileCustomerBindingSource.DataSource = mContact.ProfileCustomer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' save or cancel changes<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If saveObject Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact.ApplyEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact = mContact.Save()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Csla.DataPortalException<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString(), _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error saving", MessageBoxButtons.OK, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString(), _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error Saving", MessageBoxButtons.OK, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mContact.CancelEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Finally<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' rebind UI if requested<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rebind Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BindUI()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' restore events<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ContactBindingSource.RaiseListChangedEvents = True<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ProfileCustomerBindingSource.RaiseListChangedEvents = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If rebind Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' refresh the UI if rebinding<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ContactBindingSource.ResetBindings(False)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mContact.IsCustomer Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.ProfileCustomerBindingSource.ResetBindings(False)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Try<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br><br>&nbsp;&nbsp;&nbsp; Protected Sub UnbindBindingSource1( _<br>&nbsp; ByVal source As BindingSource, ByVal apply As Boolean, ByVal isRoot As Boolean)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim current As System.ComponentModel.IEditableObject = _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TryCast(source.Current, System.ComponentModel.IEditableObject)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If isRoot Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source.DataSource = Nothing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If current IsNot Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If apply Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current.EndEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current.CancelEdit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub ContactBindingSource_CurrentItemChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.OKButton.Enabled = mContact.IsSavable<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br>End Class</font><br><br><br>The errors I get are.. <br><br>If I open the edit form and then just press the Cancel or Close button on the form I get:<br><br>Csla.Core.UndoException occurred<br>&nbsp; Message="Edit level mismatch in UndoChanges"<br>&nbsp; Source="Csla"<br>&nbsp; StackTrace:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.UndoChanges(Int32 parentEditLevel) in D:\Work\Visual Studio 2008\Projects\CSLA362\cslacs\Csla\Core\UndoableBase.cs:line 203<br>&nbsp; InnerException: <br><br><br>Debugging through shows that the parent Contact object's edit level is 0, but the child Profile object's edit level is still 2.<br><br>Any help very gratefully received!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Monday, June 08, 2009</h2>>> I.e. there is only one bindingsource.  Is that OK? <br />Try using two binding sources, then set the datamember. Also, can you post the code for the child business object property. You can also try using the debugger and watch the edit levels when databinding, applying edit, etc...</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Wednesday, June 10, 2009</h2>Hi Avail<br><br>Many thanks for your response.&nbsp; I tried the dual binding sources approach, and set the datamember of the second binding source to the ProfileCustomer property of the Contact object referenced by the first bindingsource.&nbsp; Unfortunately that didn't work.<br><br>The child object ProfileCustomer property in the contact object looks like this:<br><font face="Courier New"><font size="2"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region One to Manys unhandled by code gen<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;ProfileCustomer&gt; ProfileCustomerProperty = RegisterProperty(new PropertyInfo&lt;ProfileCustomer&gt;("ProfileCustomer", "ProfileCustomer"));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Returns the ProfileCustomer for this contact.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// NB: This field should not be lazy instantiated as <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// not all contacts will have this profile.&nbsp; To create<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// a profile use the relevant AddProfileXXX method.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ProfileCustomer ProfileCustomer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {return GetProperty(ProfileCustomerProperty);&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(ProfileCustomerProperty, value); }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Adds a customer profile to this contact.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;returns&gt;&lt;/returns&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ProfileCustomer AddProfileCustomer()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (FieldManager.FieldExists(ProfileCustomerProperty))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty&lt;ProfileCustomer&gt;(ProfileCustomerProperty, ProfileCustomer.NewProfileCustomer());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //todo:&nbsp; Should we throw an error here if the user tries to add a customer profile<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to a contact that already has a customer profile?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ProfileCustomer;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion //one to manys</font><br></font><br><br>Any other thoughts?&nbsp; They would be very gratefully received, I'm at my wits end with it!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Wednesday, June 10, 2009</h2>In what scenario do you get the mismatch error? when adding a new contact? You may want to put in your watch window the edit levels so you can monitor when they get added/removed, that may help you debug. <br /><br />I have a similar scenario in which I am binding to a "child" property but I have 6 different child subtypes and I was able to get it working using Winforms, CSLA 3.6.2, .Net 3.5. <br /><br />I did end up using the BindingSourceNode class, but that was mostly out of convenience so didn't have to manually bind/unbind 6 different bindingsources :)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Saturday, June 13, 2009</h2>Thanks for the reply and for all your help.&nbsp; I've switched over to the bindingsourcenode (using the code from the book as a basis) and that's sorted the problem above - weeks of tearing hair out resolved :-).&nbsp; <br><br>All the edit levels seem to be behaving correctly now except when I call Cancel then Apply, which is causing an 'Object is still being edited and cannot be saved' error.&nbsp; I will dig into the code and try and work out why this is happening.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon replied on Friday, November 20, 2009</h2>I have the same problem.<br /><br />any progress? can you shared with me?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon replied on Friday, November 20, 2009</h2><P>anybody have a solution?</P>
<P>I am unhinged about this.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tom_W replied on Monday, November 23, 2009</h2>Hi Simon<br><br>In answer to your question:&nbsp; In truth I'm not sure exactly what we did to fix the problem (I'm assuming you are having an issue with the Cancel then Apply scenario?) or even if we actually have fixed it.&nbsp; Our UI design now uses the ribbon toolbar, so there is no longer an explicit Cancel button on our forms and we aren't calling BindingTree.Cancel anywhere in code, only BindingTree.Close.<br><br>Sorry not to be of more help.<br><br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
