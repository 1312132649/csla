<html><header><title>CommandBase Authorizaition binding to UI</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CommandBase Authorizaition binding to UI</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10563.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini posted on Tuesday, July 26, 2011</h2><p>Please refer to this posting as a starting point - <a href="http://forums.lhotka.net/forums/p/10540/49324.aspx#49324">http://forums.lhotka.net/forums/p/10540/49324.aspx#49324</a></p>
<p>The suggestion to add a rule on the EditObject authorizationaction worked perfectly. However, I am now tryign to show/hide a UI link based on whether the execute action on the commandbase object is permitted. In order to do this, I added the following </p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">static</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">bool</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CanEditObject () <font face="Consolas" size="2"><font face="Consolas" size="2">
<p>{ </p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span>
<p>&nbsp;</p>
<span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">return</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> Csla.Rules.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">BusinessRules</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.HasPermission(Csla.Rules.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AuthorizationActions</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.EditObject, </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">typeof</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CommandName</span></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">)); }</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">However when using CanEditObject , it throws the following exception</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&nbsp;&#39;Business.CommandName.CanEditObject()&#39; threw an exception of type &#39;System.MethodAccessException&#39;&nbsp;bool {System.MethodAccessException}<br />
<p>&nbsp;</p>
</span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, July 26, 2011</h2><p>Not sure of what could be wrong here - but this code and unit test runs OK: </p>
<pre style="font-family:Consolas;font-size:13px;color:white;background:none repeat scroll 0% 0% #39322d;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#85bbcc;">Serializable</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#d29d60;">public</span>&nbsp;<span style="color:#d29d60;">class</span>&nbsp;<span style="color:#85bbcc;">LookupCustomerCommand</span>&nbsp;:&nbsp;<span style="color:#85bbcc;">CommandBase</span>&lt;<span style="color:#85bbcc;">LookupCustomerCommand</span>&gt;
&nbsp;&nbsp;&nbsp;&nbsp;{
<span style="color:#a06a2c;">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#d29d60;">public</span>&nbsp;<span style="color:#d29d60;">static</span>&nbsp;<span style="color:#d29d60;">bool</span>&nbsp;<span style="color:#e8e8e8;">CanEditObject</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#d29d60;">return</span>&nbsp;<span style="color:#85bbcc;">BusinessRules</span>.<span style="color:#e8e8e8;">HasPermission</span>(<span style="color:#e8e8e8;">Csla</span>.<span style="color:#e8e8e8;">Rules</span>.<span style="color:#85bbcc;">AuthorizationActions</span>.<span style="color:#e8e8e8;">EditObject</span>,&nbsp;<span style="color:#d29d60;">typeof</span>(<span style="color:#85bbcc;">LookupCustomerCommand</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#d29d60;">protected static</span>&nbsp;<span style="color:#d29d60;">void</span>&nbsp;<span style="color:#e8e8e8;">AddObjectAuthorizationRules</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#85bbcc;">BusinessRules</span>.<span style="color:#e8e8e8;">AddRule</span>(<span style="color:#d29d60;">typeof</span>(<span style="color:#85bbcc;">LookupCustomerCommand</span>),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#d29d60;">new</span>&nbsp;<span style="color:#e8e8e8;">Csla</span>.<span style="color:#e8e8e8;">Rules</span>.<span style="color:#e8e8e8;">CommonRules</span>.<span style="color:#85bbcc;">IsInRole</span>(<span style="color:#85bbcc;">AuthorizationActions</span>.<span style="color:#e8e8e8;">EditObject</span>,&nbsp;<span style="color:#eee190;">&quot;role1&quot;</span>,&nbsp;<span style="color:#eee190;">&quot;role2&quot;</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />    }<br /><br />&nbsp;&nbsp;&nbsp; [<span style="color:#85bbcc;">TestMethod</span>()]
&nbsp;&nbsp;&nbsp; <span style="color:#d29d60;">public</span>&nbsp;<span style="color:#d29d60;">void</span>&nbsp;<span style="color:#e8e8e8;">CanNotEditCommand</span>()
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#85bbcc;">Assert</span>.<span style="color:#e8e8e8;">IsFalse</span>(<span style="color:#85bbcc;">LookupCustomerCommand</span>.<span style="color:#e8e8e8;">CanEditObject</span>());
&nbsp;&nbsp;&nbsp; }<br /><br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Wednesday, July 27, 2011</h2><p>Is this v4.1.0? That is what I am running and I am continuing to run into this problem.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 27, 2011</h2><p>Which platform and UI technology do you get the exception on?&nbsp;&nbsp; .NET 4 or SL4 or WP?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Wednesday, July 27, 2011</h2><p>Silverlight 4/ CSLA 4.1.0</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, July 28, 2011</h2><p>Hi Ranjini, </p>
<p>I believe the solution for your problem is to change the AddObjectAuthorizationRules to be a <b>public </b>method rather than protected. </p>
<p>Limitations in reflection in Silverlight throws the exception when a method is not accessible for other classes (ie: protected and private).</p>
<p>Read more here: <a title="http://msdn.microsoft.com/en-us/library/stfy7tfc%28v=vs.95%29.aspx " href="http://msdn.microsoft.com/en-us/library/stfy7tfc%28v=vs.95%29.aspx%20">http://msdn.microsoft.com/en-us/library/stfy7tfc%28v=vs.95%29.aspx </a></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, August 02, 2011</h2><p>Thanks!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
