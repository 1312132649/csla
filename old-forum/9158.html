<html><header><title>Having trouble wiring up login for Silverlight.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Having trouble wiring up login for Silverlight.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9158.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dane posted on Thursday, July 01, 2010</h2><p>CSLA 4 beta 3, Silverlight 4, .net 4</p>
<p>I&#39;ve been trying to mimic the login mechanism in the Rolodex application but I&#39;m having no luck.&nbsp; My principle class has a Login method (in Silverlight)&nbsp;as follows:</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">public static void Login(UsernameCriteria criteria, EventHandler&lt;EventArgs&gt; eventHandler)<br />{<br />&nbsp;AppIdentity.GetIdentity(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; criteria,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (o, e) =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (e == null) { SetPrincipal(null); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else { SetPrincipal(e.Object); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eventHandler(null, EventArgs.Empty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />}<br /></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">AppIdentity.GetIdentity in Silverlight looks like this:</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;">public static void GetIdentity(UsernameCriteria criteria,&nbsp;EventHandler&lt;DataPortalResult&lt;AppIdentity&gt;&gt; eventHandler)<br />{<br />&nbsp;&nbsp;&nbsp; DataPortal&lt;AppIdentity&gt; dataPortal = new DataPortal&lt;AppIdentity&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;dataPortal.FetchCompleted += eventHandler;<br />&nbsp;&nbsp;&nbsp;&nbsp;dataPortal.BeginFetch(criteria);<br />}<br /></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">I&#39;m using ObjetFactories and I&#39;ve verified that the Fetch method of the IdentityFactory is indeed getting called however the EventArgs (e) in the Priciple&#39;s Login method is always coming back null.&nbsp; It appears the callback isn&#39;t wired up correctly.&nbsp; I&#39;m obviously missing something but I&#39;m at a loss.</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">Any help you can provide will be greatly appreciated.</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">Thanks,</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Arial;font-size:x-small;">Dane R. Vinson</span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Dane replied on Friday, July 02, 2010</h2><p>Well, either I haven&#39;t provided enough information for anyone to make a guess, I&#39;ve done something so stupid that no one wants to respond or everyone else is on vacation as well but I&#39;m the only one who likes to program on vacation.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, July 04, 2010</h2><p>You are saying that the &#39;e&#39; parameter in the callback lambda is null? That should never happen. I just scanned through the relevant code in DataPortal&lt;T&gt; and WcfProxy, and I can&#39;t see where it is possible that this would occur.</p>
<p>Can you put a breakpoint in Csla.DataPortalClient.WcfProxy.proxy_FetchCompleted() and walk through that code - that&#39;s where that object is created.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Dane replied on Sunday, July 04, 2010</h2><p>I went back and starting looking as you suggested and discovered e was indeed returning a value (I swore it wasn&#39;t at one point) but e.Object is always null.&nbsp; After several hours more debugging I suddenly got and exception&nbsp;from&nbsp;the AppIdendity&nbsp;ObjectFactory&#39;s Fetch method.&nbsp; I put a try/catch around the Activator.CreateInstance call and found this exception relating to a property I&#39;d implemented on AppIdentity:</p>
<p>&quot;Can not register property UserId after containing type (CslaIdentity) has been instantiated&quot;</p>
<p>After further searching on the forums I found that calling RegisterProperty with a different overload solved the exception (something to do with CslaIdentity, the base class, not being generic).&nbsp; There are two strange pieces of data in this whole process.&nbsp; 1.&nbsp; ASP.net Developer Server was only catching the exception about 1% of the time (I&#39;ve only see in twice in hundreds of test runs).&nbsp; 2. This exception ONLY occurs when called from Silverlight.&nbsp; I have a console app entry point that allowed me to log in without exception.&nbsp; This second condition is very perplexing to me as the exception is occuring in the ObjectFactor which is server side only.</p>
<p>Anyway, it appers I&#39;m finally able to log in from a Silverlight app now as well.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
