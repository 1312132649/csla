<html><header><title>How to: Password change use case (or any property change requiring confirmation)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to: Password change use case (or any property change requiring confirmation)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5181.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 posted on Thursday, July 31, 2008</h2><P>How do the CSLA veterans handle this particular use case?</P>
<P>I'm editing a user profile (in an ERLB), and there is a edit field for the password. If I change the password, I need to be prompted to confirm the password change before the object is saved.&nbsp;&nbsp; (Moreover, the actual stored password might need to be encrypted, etc., but that's a side issue). </P>
<P>The more general form of this scenario (and we have 5-10 of these in our application) is that a user has made a data change that requires additional data not displayed in the grid or original screen to be supplied via a secondary prompt screen before the data is saved. </P>
<P>The obvious possibility is to actually not allow direct entry of any such field and provide a specific function for making the change that presents a screen with all the needed data, but I hoping to find a good pattern for handling this scenario in general that would not require this restriction. </P>
<P>Another thought would be to (1) have some sort of event that the UI could hook to catch the property change, coupled with (2) some sort of validation rule that renders the object invalid until the additional data is supplied. For the user scenario above, a user object&nbsp;with a changed password value is invalid unless a password change confirmation has also been provided to the same user object, or something similar. In our case, we actually have a "Password Changer" BO that validates the password hasn't been reused, meets complexity requirements, sets the expiration date in the user, logs the password change operation, etc., so it occurred to me to just attach such an object as a child to the user object, and the user object will save it as part of it's own processing. </P>
<P>Other ideas welcome...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 31, 2008</h2>Well, my view is that prompting is a purely UI thing, so if you need a prompt, the UI should be built to do it.&nbsp; The BO shouldn't care, it should assume the UI is communicating with the user properly.<br><br>As for secondary information, I have some places where if for example a value on the BO is true, another field MUST be entered.&nbsp; That's a business rule, so the BO has a rule to enforce this.&nbsp; The UI's job is to let the user know about the broken rule.&nbsp; The BO can help out the UI to some extent; for example, if the box isn't checked, CanWriteProperty can return false for the secondary fields.&nbsp; But if you have a rule that those fields must be empty, you may need to blank the other fields automatically.&nbsp; So in that case, it really depends on what you want to do.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, July 31, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Well, my view is that prompting is a purely UI thing, so if you need a prompt, the UI should be built to do it.</div></BLOCKQUOTE></P>
<P>I completely agree -- the problem is I don't know what the best way to build such a UI thingy is. </P>
<P>For the sake of discussion, say you have the password in a grid in the ERLB. </P>
<P>The user types in new password, then immediately clicks on the next row. ApplyEdit gets called on the user object and ERLB will try to save it. </P>
<P>How do you get the opportunity (or what is the best way) to prompt the user after the password change is detected but before an attempt is made to save the object?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, July 31, 2008</h2>If the grid supports it, you could listen for the grids BeforeExitEdit (which is how you'd do it using the Infragistics WinGrid).&nbsp; Other grids may or may not support a similar concept.&nbsp; If you're using .Net 3.5 / Csla 3.5, you might be able to extend BusinessBase to implement IPropertyChanging.&nbsp; I'm not 100% sure about that scenario though, because I've not gotten to look at providing my own IPropertyInfo implementation... but you could look at that, and see if you can't add behavior that way.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, July 31, 2008</h2><P>OK, I have a running prototype, but I'm not so sure about it as a general model. </P>
<P>(1) My "user" BO has a static event that it fires when a new password value has been supplied. This is just a helper for a UI, and&nbsp;avoids serialization issues.</P>
<P>(2) I haven't done a the grid yet, but my user&nbsp;form subscribes to the password changed event</P>
<P>(3) When password change occurs, the event handler in the user&nbsp;form inspects the sender to see if it is a reference to the same object being edited, if so, it constructs a PasswordChanger and displays&nbsp;a "Confirm Password Change" screen bound to the PasswordChanger. </P>
<P>(4) If the change is successfully confirmed, then the PasswordChanger is provided to the user object (otherwise, the original value of the password is put back).</P>
<P>(5) When the user object is Saved(), it applies the data from the PasswordChanger as part of its database update (encrypts user-supplied value, sets password expiration date, logs password change in separate table, etc.) </P>
<P>The user BO logic doesn't require this particular UI model, it just requires that a PasswordChanger accompany any password change. </P>
<P>Again, I'm new at this, so I'm not sure what perils are hidden in this approach. </P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
