<html><header><title>Invalidating object if collection count is zero</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Invalidating object if collection count is zero</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8282.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>timchandler posted on Monday, January 04, 2010</h2>I'm looking at a way to invalidate an object if the collection count is zero.<br /><br />Let's say I have a class Foo, with two properties.  Name, which is a string, and MyItems, which is a collection of child items.  <br /><br />What I would like to do is have an error display on the Name Textbox (I'm using silverlight, fyi), indicating that the object is invalid until the user adds a MyItem.  <br /><br />So I have created a custom error routine as such:<br />private static bool OneOrMoreMyItemsRequired(T target, RuleArgs e) where T : Foo<br />        {<br />            if (target.ReadProperty(MyItems).Count == 0)<br />            {<br />                e.Description = "A Foo Object must have at least one MyItems";<br />                return false;<br />            }<br /><br />            return true;<br />        }<br /><br />In the override of AddBusinessRules, I add the following:<br />ValidationRules.AddRule(OneOrMoreMyItemsRequired, NameProperty, 2);<br /><br />The priority of the rule is 2 because I have a name required rule I want to display first.<br /><br />Everything seems to work as expected.  I get a nice validation display error that I need at least one MyItems.  However, when I add the MyItem, the Name property validation error doesn't update.  If though I go into the Name textbox and change the name slightly, it does update and my errors go away.<br /><br />Is there a way to get this message to disappear when I add the MyItem?<br /><br />Is there a better way to do this?<br /><br />Thanks in advance!<br />Tim </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, January 04, 2010</h2><P>Generally your thinking is correct. As you note, the trick is to trigger the rules when the collection changes. The easiest way to do this is to override the OnChildChanged() method - something like this:</P>
<P>&nbsp;&nbsp;&nbsp; protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.OnChildChanged(e);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules(NameProperty);<BR>&nbsp;&nbsp;&nbsp; }<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timchandler replied on Monday, January 04, 2010</h2>Thanks for the reply.  <br /><br />Yeah, I was thinking that would work too.  But for some reason it doesn't seem to like that.<br /><br />Embarassingly, I tried the following and it did work.<br /><br />protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<br />        {<br />            base.OnChildChanged(e);<br />            base.OnPropertyChanged("IsDirty");<br /><br />            // TODO: Fix hack with better code.<br />            string tmpName = Name;<br />            Name = String.Empty;<br />            Name = tmpName;<br /><br />        }<br /><br />As you can see, I'm not particularly proud of this solution.  But it seems like I need to actually change the text of the silverlight textbox in order for the error message to clear.<br /><br />Any thoughts on that?  </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>McManus replied on Monday, January 04, 2010</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><P>Generally your thinking is correct. As you note, the trick is to trigger the rules when the collection changes. The easiest way to do this is to override the OnChildChanged() method - something like this:</P><br /><P>    protected override void OnChildChanged(Csla.Core.ChildChangedEventArgs e)<BR>    {<BR>      base.OnChildChanged(e);<BR>      ValidationRules.CheckRules(NameProperty);<BR>    }<BR></P></div></BLOCKQUOTE><br /><br />Probably you should call OnPropertyChanged("Name") after the checking the rules. This way, databinding is notified that it needs to update the binding to the Name property.<br /><br />HTH,<br />Herman</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>timchandler replied on Monday, January 04, 2010</h2>Yeah, I initially coded the OnPropertyChanged("Name") event, but that didn't seem to have any effect.<br /><br />What else would be going on besides that event when i change the value using the assignment to and from the tempoary variable?  I figure something else is going on behind the scenes?  Or maybe some specific event isn't firing if I do an OnPropertyChanged event if the text of the old and new values match?<br /><br />Tim</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 05, 2010</h2><P>Have you tried using the IdentityConverter on the binding?</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
