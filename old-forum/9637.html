<html><header><title>Calculated field doesn't update UI</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Calculated field doesn't update UI</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9637.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh posted on Thursday, October 14, 2010</h2><p>Hi all,</p>
<p>I have a list of children on my object, let&#39;s call them costs. I&#39;ve got 2 &#39;views&#39; for the costs for the end user, one of which shows the actual list, the other which shows a calculated list which is based on the original list.</p>
<p>I&#39;ve added a new readonly property to my object and written code to calculate the items which should be in the list by building a new costs collection on the fly (when the source list changes), however, when I bind this to my control, the changes to the underlying list are not reflected in the calculated property.</p>
<p>This wasn&#39;t a suprise, as&nbsp;when the underlying list changes, it doesn&#39;t tell the readonly property that any values have changed. I thought I&#39;d need to get the bindingsource to notify the UI that&nbsp;a property had changed and this would cause it to re-read (and re-build) the readonly property.&nbsp;I added&nbsp;a call to OnPropertyChanged() when the source list changes. This gets fired when I add/remove items from the list but the UI still doesn&#39;t update.</p>
<p>Do I need to register the field with FieldManager for the databinding to work properly with the UI?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, October 14, 2010</h2><p>Is this calculated property on the BLB or a parent BB?</p>
<p>It needs to be on the parent BB. Properties on list objects don&#39;t generally bind properly - data binding isn&#39;t set up to bind to list properties.</p>
<p>If the property is on the BB, then it is that object that needs to call OnPropertyChanged for that property. Since this is calculated based on child objects changing, you&#39;d typically override OnChildChanged in this parent object, and that&#39;s where you&#39;d trigger the rule that calculates the value.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Thursday, October 14, 2010</h2><p>Hi Rocky,</p>
<p>Yes that&#39;s exactly what I&#39;ve done: I&#39;ve got the following</p>
<p>Parent - costs property (collection of costs)</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;- &nbsp;&nbsp; Child Collection of Costs</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Cost 1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Cost 2</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp; Calculated Collection of Costs</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Virtual cost 1 etc</p>
<p>The parent handles ChildChanged and looks at type of e.ChildObject to decide what to do,&nbsp;but I don&#39;t have the calculated property registered on the field manager. Would calling PropertyHasChanged(&quot;fieldName&quot;) cause the UI to be updated even if the field had not been registered?</p>
<p>I&#39;m currently changing the implementation so that the fieldmanager registers the property and my ChildChanged event regens the property and calls SetProperty on the new field - I know this will raise a property changed event so if that doens&#39;t work it must be&nbsp;something else that&#39;s not right</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 14, 2010</h2><p>Typically for a purely calculated field where you don&#39;t store the value you don&#39;t need to register the property with the field manager. You can just use OnPropertyChanged(&quot;PropertyName&quot;) to get the UI to re-read the property value.</p>
<p>However, if you are storing the calculated value, it is probably best to create a normal read-only property using the field manager. And in that case you might (at least in CSLA 4) implement the calculation as a business rule, attach that rule to the property and then in OnChildChanged just call BusinessRules.CheckRules(MyCalculatedProperty) to run the rule.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Thursday, October 14, 2010</h2><p>I&#39;ve now registered the field in the fieldmanager and regenerated the field when needed - however&nbsp;I still have the issue with the form not updating - I&#39;m going to build a couple of test forms to check this out as I think somewhere down the line the usercontrol I&#39;m binding to must be looking at a copy of the object. </p>
<p>Maybe another dev threw a layer of complexity in for job security :)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Thursday, October 14, 2010</h2><p>Yep, looks like there&#39;s an issue with the usercontrol nested on the form I&#39;m using. If I throw a datagrid on top and bind it to the collection it&#39;s receiving the updates without issue!</p>
<p>Back to the drawing board!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
