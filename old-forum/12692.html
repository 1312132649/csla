<html><header><title>DAL exception always leads to System.OutOfMemoryExcetion in Silverlight</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DAL exception always leads to System.OutOfMemoryExcetion in Silverlight</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12692.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>keithv posted on Thursday, July 03, 2014</h2><p>Hello,</p>
<p>I have a silverlight application that is in a stable (production) state running Csla 4.5.40. I am using the Factory Implementation (ObjectFactory).</p>
<p>I needed to make some changes today so I&nbsp;updated all&nbsp;NuGet packages&nbsp;on&nbsp;the application&nbsp;and all of it&#39;s libraries. This upgraded the application to 4.5.600. I only made one code change to&nbsp;handle DataPortalException.ErrorInfo is now HttpErrorInfo instead of WCFErrorInfo. This change isn&#39;t impacting my issue as a DataPortalException is never received.</p>
<p>After updating the NuGet packages however&nbsp;if there is an exception&nbsp;(any exception)&nbsp;in the DAL leads to the following exception in Silverlight:</p>
<p>Property load or set failed for property Message (Exception of type &#39;System.OutOfMemoryException&#39; was thrown.)&nbsp;&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccess(Task task)<br />&nbsp;&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task)<br />&nbsp;&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at Csla.DataPortal`1.&lt;BeginFetch&gt;d__1e.MoveNext()</p>
<p>I cannot figure out the cause. Even doing &quot;throw new Exception(&quot;Test&quot;);&quot; immediatly in the DAL&nbsp;fetch method&nbsp;leads to this.&nbsp;None of my code runs between&nbsp;exception being raised&nbsp;in the DAL&nbsp;and receiving the above&nbsp;exception in Silverlight. I am stumped. If there is a DAL&nbsp;exception in the version running Csla 4.5.40&nbsp;I get a &nbsp;DataPortalException object&nbsp;as expected.</p>
<p>Thank you for your help.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>keithv replied on Monday, July 07, 2014</h2><p>Reverting back to v4.5.501 with no changes to our applications fixed the issue.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Igor Deinekin replied on Friday, July 18, 2014</h2><p>There is a bug in a new 4.5.600 version of CSLA. It is placed in the Source\Csla\Server\Hosts\HttpChannel\HttpErrorInfo.cs. There is a <b>while</b> statement in the constructor that turns into an endless loop when there is at least one InnerException in the&nbsp;WcfErrorInfo object received as a parameter.</p>
<p>We solved our problem by rebuilding Csla.dll with the HttpErrorInfo fixed.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
