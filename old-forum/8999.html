<html><header><title>EF: update root object when add/update a child</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EF: update root object when add/update a child</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8999.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>roberto posted on Thursday, May 27, 2010</h2><p>Hi, I was looking SQL Server Profiler&#39;s trace output, and I noticed that,when I add (update) a child object, I see INSERT (UPDATE) sp call (of course!),<br />but I see also UPDATE sp call of root object (not dirty!).<br />I took an old Rolodex solution as guideline while developing my app; I&#39;ll have a deeper look at latest version of RolodexUsingPrism solution, in order to understand if it&#39;s my code, o something else..<br /><br />Did anyone noticed same behavoiur ?</p>
<p>Thank you very much.<br /><br />ps: sorry for my poor english.hope it&#39;s clear enough.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>roberto replied on Thursday, May 27, 2010</h2><p>I understood where the bug was. <br />Tomorrow I&#39;ll tell more about it. ;)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>roberto replied on Friday, May 28, 2010</h2><p>Well, here I am.<br />II coded my classes (root &amp; child) following Rolodex-EF samples.
<br />In RolodexUsingPrism solution, \Rolodex.Server\BusinessClasses\Company.cs, method DataPortal_Update, <i>newCompany </i>is created ... and <i>CompanyName </i>setted with CSLA&#39;s company property (<i>newCompany.CompanyName = ReadProperty(CompanyNameProperty);</i>).
<br /><br />In my root object, I query EF in order to get <i>newCompany </i>instead of create a new one, then set all properties with CSLA object properties.<br />This last step, caused EF invoke UPDATE sp.<br />I didn&#39;t change EF company get instance (via query), and encapsulated properties setting in &quot;if (CSLA_object.IsSelfDirty) { // ... set all properties... }&quot;.<br />This prevent EF UPDATE sp call.</p>
<p>That&#39;s all. :)</p>
<p>ps: I haven&#39;t test it yet on RolodexUsingPrism solution.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 28, 2010</h2><p>Do you have Julie Lerman&#39;s <i>Programming Entity Framework</i> book? I find this to be an invaluable resource for figuring out EF issues. Julie has really specialized in EF, and probably knows more about it than anyone outside the EF product team at Microsoft.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>roberto replied on Friday, May 28, 2010</h2><p>I&#39;ll get it asap.<br />Thank you very much.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
