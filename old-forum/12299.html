<html><header><title>CSLA 4 version 4.5.500 released</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4 version 4.5.500 released</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12299.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka posted on Tuesday, January 07, 2014</h2><p>CSLA 4 version 4.5.500 is released and is available via nuget or from <a href="http://www.cslanet.com">www.cslanet.com</a></p>
<p>For more details read this blog post: </p>
<p><a href="http://www.lhotka.net/weblog/CSLA4Version45500Released.aspx">http://www.lhotka.net/weblog/CSLA4Version45500Released.aspx</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, January 09, 2014</h2><p>Introduced it into our solution, and am looking to see how our unit tests (12k) do against it.</p>
<p>Interestingly I found a couple read-only info lists that were failing to populate in Child_Fetch because IsReadOnly hadn&#39;t been turned off.&nbsp; I don&#39;t understand why it was not failing before 4.5.500 and maybe there&#39;s something else&nbsp;going on.&nbsp; I had to turn off and restore the IsReadOnly setting in a couple of my read-only lists (as I should have been doing).&nbsp; I was on the other hand turning off RaiseListChangedEvents - so maybe in 4.1 that prevented the IsReadOnly check&nbsp;... anyway, kind of interesting.</p>
<p>Less interestingly is that the tests that hit the database (about 25% of them are like that) are now having cases where some of them time out and fail to complete.&nbsp; We structure these tests in a way such that we start a transaction that gets rolled back at the end of the test.&nbsp;&nbsp; I&#39;m not sure why it&#39;s happening, but I swapped back in the prior CSLA version (not too old, 4.5.10) and I didn&#39;t have any problems with the tests hanging.</p>
<p>If there is any insight as any changes in the way transactional behavior occurs within 4.5.500 that is different than 4.5.10 that would be really helpful... </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, January 09, 2014</h2><p>I should have probably just started a new thread for the prior post,&nbsp;but the problem for us involved this code, which worked prior to 4.5.500 -&nbsp;the logic is effectively something like this -</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Handles the customer save.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;forceUpdate&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// If &lt;see langword=&quot;true&quot;/&gt;, triggers overriding IsNew and IsDirty. <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// If &lt;see langword=&quot;false&quot;/&gt; then it is the same as calling Save().<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;userState&quot;&gt;User state data.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name=&quot;isSync&quot;&gt;True if the save operation should be synchronous.&lt;/param&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected async override Task&lt;Customer&gt; SaveAsync(bool forceUpdate, object userState, bool isSync)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; await RefreshRequestLockStatusAsync();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // BusinessBase doesn&#39;t care about validity when deleting. It&#39;s important in this case.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!IsValid &amp;&amp; IsDeleted)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new Csla.Rules.ValidationException(Resources.NoSaveInvalidException);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return await base.SaveAsync(forceUpdate, userState, isSync);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Basically, it provided a way to inject some &quot;do some stuff before saving&quot; after Save was no longer virtual.&nbsp; In this case it checks to see if the record should be considered locked, which could have conceivably&nbsp;changed since the user got the record.</p>
<p>It happens that this is edge-case logic that I&#39;m inclined to just drop rather than drill down to figure out what might have changed in this scenario.&nbsp; </p>
<p>So basically just wanted to mention that while something has changed in some capacity, it was quite limited in scope and I&#39;m planning on just adjusting my functionality because what&#39;s lost is pretty trivial stuff.&nbsp; I&#39;m not sure it&#39;ll affect others as when I run the test outside the scope of a transaction (i.e. not roll state back) it works... </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ayubu replied on Monday, January 13, 2014</h2><p>I am building the winrt 8.1 application&nbsp;using visual basic 2013 ultimate. a sample project attached.</p>
<p>I am building in a normal laptop with windows 8.1 installed.</p>
<p>I use the latest csla from nugget (this one you have posted)&nbsp;but I get an error for a trivial async create method with null reference expection with a stack race</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp; at Csla.Server.SimpleDataPortal.&lt;Create&gt;d__0.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.ConfiguredTaskAwaitable`1.ConfiguredTaskAwaiter.GetResult()<br />&nbsp;&nbsp; at Csla.Server.DataPortalSelector.&lt;Create&gt;d__0.MoveNext()<br />&nbsp;&nbsp; at Csla.DataPortal`1.HandleDataPortalException(String operation, DataPortalException ex, Boolean isSync, IDataPortalProxy proxy)<br />&nbsp;&nbsp; at Csla.DataPortal`1.HandleCreateDataPortalException(DataPortalException ex, Boolean isSync, IDataPortalProxy proxy)<br />&nbsp;&nbsp; at Csla.DataPortal`1.&lt;DoCreateAsync&gt;d__2.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at Csla.DataPortal`1.&lt;CreateAsync&gt;d__c.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at Csla.DataPortal`1.&lt;CreateAsync&gt;d__9.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at Csla.DataPortal.&lt;CreateAsync&gt;d__0`1.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at App2.Entry.Form.VB$StateMachine_0_NewForm.MoveNext()<br />--- End of stack trace from previous location where exception was thrown ---<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)<br />&nbsp;&nbsp; at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()<br />&nbsp;&nbsp; at App2.MainPage.VB$StateMachine_1_MainPage_Loaded.MoveNext()</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ayubu replied on Monday, January 13, 2014</h2><p>By referencing the project against the csla code I have established that&nbsp;that the Error comes from the DynamicMethodHandlerFactory class which is used by the DefaultDataPortalActivator to create instance of object in the create method of simpledataportal.</p>
<p>Just replaced it with the code</p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">
<p>obj =</p>
</span></span></span><span style="font-size:x-small;font-family:Consolas;">
<p>&nbsp;</p>
</span></span>
<p><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">LateBoundObject</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">(System.</span></span><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">Activator</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">.CreateInstance(objectType));</span></span></p>
</p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">from <span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">
<p>obj = </p>
</span></span></span><span style="font-size:x-small;font-family:Consolas;">
<p>&nbsp;</p>
</span></span>
<p><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;"><span style="font-size:x-small;font-family:Consolas;color:#0000ff;">new</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">LateBoundObject</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">(</span></span><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">ApplicationContext</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">.DataPortalActivator.CreateInstance(objectType));</span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"></span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">at least it worked. ( now I am thinking to use the custom <span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;"><span style="font-size:x-small;font-family:Consolas;color:#2b91af;">IDataPortalActivator)</span></span></span></span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">May be there is a setting I am forgeting</span></span></p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">On the other note in the supplied sample if I remove the child Property it works correctly</span></span></p>
</span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 16, 2014</h2><p>I&#39;ve done some research on the null reference exception issue. There is an issue, but I believe it to be primarily cosmetic - in that the data portal is working as expected, but the outer exception (the BusinessException property in particular) is inaccurate. The InnerException graph is correct, at least in my replication of the issue.</p>
<p><a href="https://github.com/MarimerLLC/csla/issues/249">https://github.com/MarimerLLC/csla/issues/249</a></p>
<p>As a result I&#39;ll work on solving the problem, but it is tricky to debug because the NullReference issue appears to be in the process of returning the exception to the client, not in the actual server-side data portal behavior itself.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
