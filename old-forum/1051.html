<html><header><title>2.1 Validation Rules - must they be Shared?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>2.1 Validation Rules - must they be Shared?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1051.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 posted on Monday, August 28, 2006</h2><P><FONT size=2>Using code like this works as far as loading the rule goes. But is it mandatory to Share functions like this?</FONT></P>
<P><FONT size=2>Note that the Function is not Shared. Must it be? Is there a reason Rocky does not check the IsStatic property when loading the rules? I would think that an Exception should be thrown if a non-Shared rule was added to the per Type Business rules. </FONT></P>
<P><FONT size=2>&nbsp;Protected Overrides Sub AddBusinessRules()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule(AddressOf NoDuplicates, "Id")&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT></P>
<P><FONT size=2>End Sub<BR></P></FONT><FONT size=2></FONT>
<P><FONT size=2>Private Function NoDuplicates(ByVal target As Object, ByVal e As Validation.RuleArgs) As Boolean</FONT></P>
<P><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If 1 = 2 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Id must be unique"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</FONT></P>
<P><FONT size=2>End Function</P></FONT><FONT size=2>
<P>Joe</P>
<P></FONT><FONT size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 28, 2006</h2>If you want shared rules yes, NoDuplicates must be Shared (static in C#).&nbsp; You'd probably want it shared anyway, so that you are thread safe (as long as you don't use any other Shared fields).<br><br>Of course if you need instance rulse for some reason, override AddInstanceBusinessRules and keep the method non-shared.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, August 28, 2006</h2><P>I agree that I do want it to be Shared&nbsp; especially since it is loaded from within AddBusinessRules. I just thought there would be some sort of exception if I added an instance rule to the wrong list. </P>
<P>Deeper in the code, Rocky combines both lists (Shared and Instance) if rules for both exist. So I guess it really doesn't matter if it is Shared or not - it matters which method loads the rule. AddBusinessRules will still only add the rule once per type. AddInstanceBusinessRules should add it once per instance.</P>
<P>Comments?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, August 28, 2006</h2>There won't be any exceptions, but you may have 'weird' results if you're looking at the instance instead of the target parameter, which can be different.&nbsp; I had this happen when I moved to the 2.1 beta refresh.. I had two objects in a&nbsp; list, and the rule was looking at the 'first' object's properties even though it was the second object which was supposed to be running rule's checks..<br><br>Because of this I would now always recommend your rule methods are shared / static, even if they are implementing instance rules... that way you avoid any weird bugs like I've experienced.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, August 28, 2006</h2>It's not mandatory that the rule methods are static...<br>The thing to keep in mind is that if you add shared rules, you must use the target in order to validate it.<br>This is obvious if the method is shared, but not if it's an instance method.<br><br>I questioned Rocky about the same subject not long ago... His reason for allowing instance methods was that he didn't want to restrict the way rules work or the programmer's creativeness :).<br>He had a "validator object" in his mind, of which you could have an instance as a singleton and use that to validate different objects.<br><br>Maybe a good way out would be disallow instance methods is the method is owned by the same type as the object being validated.... although that would add some overhead.<br><br>Anyway, I don't think it's bad to allow instance rule methods, but it should be well clarified that those methods _should_ be static if they are inside the bo.<br><br><br>One thing I usually do when I have many rules inside my bo is create a class named Rules inside my bo that has all the static methods for validation. That allows me to have them all handy, and I can also access my bo's private members.<br><br><br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, August 28, 2006</h2><P>That is good advice.</P>
<P>I will be sure to have all my Rule methods declared as Shared.</P>
<P>Thanks.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 29, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>xal:</strong></div><div>
					It's not mandatory that the rule methods are static...</div></BLOCKQUOTE><br><br>Right.. it was just my advise that rule methods are static.&nbsp; If you always make them static, you MUST use the target parameter, and you won't make silly mistakes like I did.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, August 29, 2006</h2>Well, it's definitely something more than one will suffer.<br>I know I did all my rules in my classes and accessed private fields... and it will cause grief to anyone updating to 2.1 because they'll see that their rules won't work. It should be noted very very clearly in the release.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, August 29, 2006</h2><P>"I know I did all my rules in my classes and accessed private fields... and it will cause grief to anyone updating to 2.1 because they'll see that their rules won't work."</P>
<P>Andres, could you clarify what you're saying? Where is the problem here? Are you saying that if you have a shared/static rule handler that you can't access private fields? That isn't the case now is it, as long as the handler is within the class definition? </P>
<P>(I just want to make sure I'm not missing something here!) </P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 29, 2006</h2>If you have rule methods that are instance methods of your business class, and those methods directly access instance fields in the object, then when you move from 2.0 to 2.1 you'll need to rename AddBusinessRules() to AddInstanceBusinessRules() and inside that method rename calls to AddRule() to AddInstanceRule() for your application to continue to work properly.<br><br>Alternately, you can change your rule methods to be static/Shared, which means they can no longer use instance fields directly, but rather must rely on the target parameter to get the values.<br><br>I am looking into throwing an exception if you call AddRule() where the rule method is a non-static method of the business object type. That is the most common area of concern, and I think Xal is right - throwing an exception in this case will be the biggest possible help for people moving from 2.0 to 2.1, because it is really the only place you can get in serious trouble.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, August 29, 2006</h2>skagen00:<br><br>It means that I used to do this:<br><br>Public Class MyBO<br>&nbsp;&nbsp;&nbsp; Private mField As String<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; Private Function MyRule(target As Object, e As Csla.Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  e.Description = "Field cannot be empty"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  Return Not <b><font color="#ff0000">mField</font></b>.Equals(String.Empty)<br>&nbsp;&nbsp;&nbsp; End Function<br><br><br>End Class<br><br>And now it should be:<br><br>&nbsp;&nbsp;&nbsp; Private Function MyRule(target As Object, e As Csla.Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  e.Description = "Field cannot be empty"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  Return Not <b><font color="#ff0000">DirectCast(target, MyBO).</font><font color="#ff0000">mField</font></b>.Equals(String.Empty)<br>&nbsp;&nbsp;&nbsp; End Function<br><br><br>The last one will work fine whether it's an instance or a static method.<br>The problem with the instance method is that it will keep an instance of the object alive throughout the lifespan of your application, and that could be potentialy bad if your object is very big, but it's not a terrible situation.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 29, 2006</h2>




<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2>Except that I just added the exception code, Xal, so your 
code won't run anymore :)&nbsp;&nbsp; But don't blame me - you talked me into 
it! &lt;evil laughter&gt;</FONT></SPAN></DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2>Starting with the next 2.1 release/refresh, it won't be 
valid to add a non-static/Shared rule method from your business class as a 
per-type rule. You'll be able to add shared/Static methods from anywhere, and 
even instance methods from _other_ objects, but not from your actual business 
class.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2>The reason is that, as you pointed out Xal, the fallout 
from a 2.0 to 2.1 upgrade could be quite great if people don't upgrade their 
code properly - and this new exception very clearly spells out any missed 
upgrades.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2>But your upgade example is great, as long as the method is 
marked as Shared/static.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=633401318-29082006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV><BR>
<BLOCKQUOTE>And 
  now it should be:<BR><BR>&nbsp;&nbsp;&nbsp; Private Function MyRule(target As 
  Object, e As Csla.Validation.RuleArgs) As Boolean<BR>&nbsp;&nbsp;&nbsp; 
  &nbsp;&nbsp; &nbsp;&nbsp; e.Description = "Field cannot be 
  empty"<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Return Not <B><FONT color=#ff0000>DirectCast(target, MyBO).</FONT><FONT color=#ff0000>mField</FONT></B>.Equals(String.Empty)<BR>&nbsp;&nbsp;&nbsp; End 
  Function<BR><BR></BLOCKQUOTE></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, August 29, 2006</h2><img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><br><br>Well, here's an even better example:<br><br>Public Class MyBO<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessBase(Of MyBO)<br><br>&nbsp;&nbsp;&nbsp; Protected Overrides Sub AddBusinessRules()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  MyBase.AddBusinessRules()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  ValidationRules.AddRule<b><font color="#ff0000">(Of MyBO, RuleArgs)</font></b>( _<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AddressOf MyRule, New RuleArgs("Field"))<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Shared Function MyRule(target As <font color="#ff0000"><b>MyBO</b></font>, e As Csla.Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp; 
  &nbsp;&nbsp; &nbsp;&nbsp; e.Description = "Field cannot be 
  empty"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Return Not <b><font color="#ff0000">target.</font><font color="#ff0000">mField</font></b>.Equals(String.Empty)<br>&nbsp;&nbsp;&nbsp; End 
  Function<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; Private mField As String<br>&nbsp;&nbsp;&nbsp; Public Property Field() As String<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp; End Property<br><br>End Class<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, August 29, 2006</h2><P>I have to admit I haven't really given this any thought, but is there a way to leverage generics to enable the target to be of the appropriate type and avoid the need to do a cast? </P>
<P>Edit // Nevermind! </P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
