<html><header><title>How do I get the role I am in?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How do I get the role I am in?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4381.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CyclingFoodmanPA posted on Wednesday, February 20, 2008</h2><P>I am creating a fairly large application utilizing CSLA 3.0 and have created a number of reports utilizing SQL Server 2005 Reporting Services.&nbsp; The user will be able to select the reports appropriate to his role.&nbsp; I have a stored procedure usp_csla_SelectRoleSpecificReports that accepts a parameter and that is the role as I have a table called tblReports, a table called tblRoles and a table tblReportRole.&nbsp; My usp queries those tables and only returns the reports which a particular role can see, i.e. (Accounting, Operations, Marketing, etc.)&nbsp; What I am trying to figure out is how do I get the role that the current user is logged in as.&nbsp; All the other methods Csla.ApplicationContext.User.IsInRole() checks to see if the user is in a particular role, but, how do I get the role to be able to pass to my usp?</P>
<P>Thanks in advance for your help.</P>
<P>Keith</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Wednesday, February 20, 2008</h2>If you are using a custom identity object, you could add a property to retrieve the list of roles for that user.&nbsp; To use them you would then cast the identity as the custom identity object, then call the property/method.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, February 21, 2008</h2>The following code shows how to retrieve the Group (role) names from a WindowsIdentity:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Gets the windows roles for current user .<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;returns&gt;&lt;/returns&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static string[] GetWindowsRoles() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;string&gt; rolelist = new List&lt;string&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WindowsIdentity id = WindowsIdentity.GetCurrent();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (IdentityReference ir in id.Groups) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NTAccount name = (NTAccount)ir.Translate(typeof(NTAccount));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rolelist.Add(name.ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // return array of roles <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return rolelist.ToArray();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Beware tho' - this may be a litte timeconsuming to execute as it iterates the users roles (SID's) and tranlates to clear text names. Text name is on format "domain\groupname".<br><br>Is this what you were looking for? <br><br>/jonny <br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
