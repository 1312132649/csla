<html><header><title>Migration to Csla4 RC1 almost complete, but now a strange runtime error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Migration to Csla4 RC1 almost complete, but now a strange runtime error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9245.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Wednesday, July 21, 2010</h2><p>When I run my newly converted project from Csla3.8.4 to Csla4.0 RC1, I am getting&nbsp;this strange error (Notice the Csla3.8 references in error):</p>
<p>System.IO.FileLoadException: Could not load file or assembly &#39;Csla, Version=4.0.0.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&#39; or one of its dependencies. The located assembly&#39;s manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)</p>
<p>&nbsp;&nbsp; at System.RuntimeTypeHandle._GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark&amp; stackMark, Boolean loadTypeFromPartialName)</p>
<p>&nbsp;&nbsp; at System.RuntimeTypeHandle.GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark&amp; stackMark)</p>
<p>&nbsp;&nbsp; at System.RuntimeType.PrivateGetType(String typeName, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark&amp; stackMark)</p>
<p>&nbsp;&nbsp; at System.Type.GetType(String typeName)</p>
<p>&nbsp;&nbsp; at Csla.Reflection.MethodCaller.GetType(String typeName) in E:\MyDocuments\Visual Studio 2008\Projects\<strong>Csla3.8\</strong>Source\cslacs\Csla\Reflection\MethodCaller.cs:line 130</p>
<p>&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.GetTypeFromCache(String typeName) in E:\MyDocuments\Visual Studio 2008\Projects\<strong>Csla3.8</strong>\Source\cslacs\Csla\Serialization\Mobile\MobileFormatter.cs:line 218</p>
<p>&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.DeserializeAsDTO(List`1 deserialized) in E:\MyDocuments\Visual Studio 2008\Projects<strong>\Csla3.8</strong>\Source\cslacs\Csla\Serialization\Mobile\MobileFormatter.cs:line 289</p>
<p>&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(Byte[] data) in E:\MyDocuments\Visual Studio 2008\Projects\<strong>Csla3.8</strong>\Source\cslacs\Csla\Serialization\Mobile\MobileFormatter.cs:line 428</p>
<p>&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.WcfPortal.GetCriteria(Byte[] criteriaData) in E:\MyDocuments\Visual Studio 2008\Projects\<strong>Csla3.8</strong>\Source\cslacs\Csla\Server\Hosts\Silverlight\WcfPortal.cs:line 190</p>
<p>&nbsp;&nbsp; at Csla.Server.Hosts.Silverlight.WcfPortal.Create(CriteriaRequest request) in E:\MyDocuments\Visual Studio 2008\Projects\<strong>Csla3.8</strong>\Source\cslacs\Csla\Server\Hosts\Silverlight\WcfPortal.cs:line 34</p>
<p>I have checked and rechecked all my references again and again, they appear to be okay.&nbsp; I have walked through the code in the debugger.&nbsp; There are a couple of BeginRefresh() calls from my ViewModels (I do not use any DataProviders).&nbsp; When the code comes back to the FetchCompleted method in WcfProxy.cs, it jumps to the Catch block from the following very first line in the Try block:</p>
<p>&nbsp;&nbsp; private void proxy_FetchCompleted(object sender, Csla.WcfPortal.FetchCompletedEventArgs e)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong> var response = ConvertResponse(e.Result)</strong>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (e.Error == null &amp;&amp; response.ErrorData == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...............................................<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OnFetchCompleted(new DataPortalResult&lt;T&gt;(default(T), ex, e.UserState));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>I did not use the Csla Installer, resorting to the familiar old fashioned way.&nbsp; I had 3.8.4 in Csla3.8 folder and installed the 4.0 RC1 in Csla4.0 folder.&nbsp; I used 3.8.4 as I was bringing the project from VS08, SL3, .Net 3.5 to VS2010, SL4, .Net4.0&nbsp; At that point I switched to Csla 4.0.&nbsp; I have now removed the Csla3.8 folder completely and still get the errror.</p>
<p>Jav</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Jav replied on Thursday, July 22, 2010</h2><p>I discovered the reason for this error.&nbsp; One of my ClientConfig files was pointing at the VS2008 website(ASP.Net 2.0.50727)&nbsp;instead of the proper website(ASP.Net4.0)<br />Now I have a different error, but I&#39;m still working on it.</p>
<p>Jav</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
