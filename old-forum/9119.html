<html><header><title>DeletedList contains objects after .clear</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DeletedList contains objects after .clear</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9119.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh posted on Tuesday, June 22, 2010</h2><p>I have a simple test project which consists of a database with the following relationship</p>
<p>ParentObject -&gt; ChildObject</p>
<p>I have classes to represent my objects in my c# project that look like:</p>
<p>ParentObjectCollection -&gt; ParentObject -&gt; ChildObjectCollection -&gt; ChildObject</p>
<p>I&#39;ve created a form with 2 gridviews - one bound to the parent collection, and the second bound to the &#39;children&#39; datamember of this collection.</p>
<p>This works fine - I&#39;ve handled the AddingNew event of the BindingSource for each databound object so that the dataportal_create method can be used instead of the constructor when a new row is created on the grid. I can also save multiple parents-&gt;children without an issue.</p>
<p>I&#39;ve used a cascade delete from the parent to kill the child rows when a parent is deleted, this also works well.</p>
<p><em>The issue I have is this:</em></p>
<p>When I have deleted some items from the parent collection and then run a save on the parent collection, this deletes the parent and the children from the list. I can see that the DeletedList on BusinessListBase is being cleared after the objects have been deleted (via DeleteSelf). However, when I add or remove more items from the grid and try to save again the DeletedList contains all the items which were cleared from the last time I saved, plus any items I deleted since. Of course I could ignore this behaviour as the key being deleted on is a unique integer, however, when I use a table with keys that are not auto generated, I may run into issues.</p>
<p>Is it usually the practice to rebind or refresh the bindings manually after a save operation or is this something databinding should be handling?</p>
<p>Also another quick question - I mentioned before I was handling BindingSource.AddingNew. Should I be using the constructor and letting the BindingSource handle the adds instead of handling AddingNew?&nbsp;As far as I can see I will be adding extra code on forms which shouldn&#39;t be there. I see business logic on forms on some of our projects and I think the reason we don&#39;t have any segregation between business login and UI code is due to the way we are using CSLA</p>
<p>We used CSLAGen in the past when CSLA 2.0 was out - however, work on the project has pretty much dried up, and without the source there&#39;s only so much I can do by template editing</p>
<p>Some of the latest CSLA examples (such as the RootGrandchildWinForms project) seem to be overriding AddNewCore - which I assume is being handled within the CSLA libraries - is this what should be handling databinding adds on the grids?</p>
<p>p.s. I&#39;m currently&nbsp;using CSLA 3.6.1</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Tuesday, June 22, 2010</h2><p>So rebinding the objects after a save seems to work - I would have thought the object was updated on the bindingsource after&nbsp;a CSLA save - it seems like I&#39;m doing an extra trip to the database to get the object list again even though all I&#39;ve done in is modified the objects in memory and persisted those modifications to the DB. Surely I shouldn&#39;t be making another round trip to the database to get all the objects since the communication was Update from App -&gt; Database</p>
<p>Does this make sense? </p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, June 22, 2010</h2><p>You should use the result of the Save() method - that&#39;s the object you should rebind to at the UI level. There is no need to re-fetch the data - Save() returns the updated values.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Charleh replied on Tuesday, June 22, 2010</h2><p>Ah, that explains it - after using the returned object everything is working as it should, thanks Rocky</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
