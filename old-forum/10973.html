<html><header><title>Factory Command object failing in e-book sample</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Factory Command object failing in e-book sample</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10973.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>blc303 posted on Friday, December 09, 2011</h2><p>Hi,</p>
<p>I&#39;m getting back into CLSA after a long pause (last used 2.0). I was working through the samples from the e-book and noticed that the PersonsUpdater file was missing in the FactoryImplementation from the DataAccess book.</p>
<p> I tried to recreate it, but the tests are still failing.</p>
<p>Here is my implementation.</p>
<p>namespace Library<br />{<br />&nbsp; [Csla.Server.ObjectFactory(&quot;PersonDal&quot;)]<br />&nbsp; [Serializable]<br />&nbsp; public class PersonsUpdater : CommandBase&lt;PersonsUpdater&gt;<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; public static readonly PropertyInfo&lt;PersonEdit&gt; Person1Property = RegisterProperty&lt;PersonEdit&gt;(c =&gt; c.Person1);<br />&nbsp;&nbsp;&nbsp; public PersonEdit Person1<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return ReadProperty(Person1Property); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private set { LoadProperty(Person1Property, value); }<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; public static readonly PropertyInfo&lt;PersonEdit&gt; Person2Property = RegisterProperty&lt;PersonEdit&gt;(c =&gt; c.Person2);<br />&nbsp;&nbsp;&nbsp; public PersonEdit Person2<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return ReadProperty(Person2Property); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private set { LoadProperty(Person2Property, value); }<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; public static void Update(PersonEdit person1, PersonEdit person2, EventHandler&lt;DataPortalResult&lt;PersonsUpdater&gt;&gt; callback)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var cmd = new PersonsUpdater { Person1 = person1, Person2 = person2 };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataPortal.BeginExecute&lt;PersonsUpdater&gt;(cmd, callback);<br />&nbsp;&nbsp;&nbsp; }<br /><br />#if !SILVERLIGHT<br />&nbsp;&nbsp;&nbsp; public static PersonsUpdater Update(PersonEdit person1, PersonEdit person2)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var cmd = new PersonsUpdater { Person1 = person1, Person2 = person2 };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Execute&lt;PersonsUpdater&gt;(cmd);<br />&nbsp;&nbsp;&nbsp; }<br />#endif<br />&nbsp; }<br />}</p>
<p>The test is failing with the following exception</p>
<p>Test method Test.Library.Net.PersonsUpdaterTest.PersonsUpdaterUpdateTest threw exception: <br />Csla.DataPortalException: DataPortal.Update failed (System.ArgumentException: Target object must implement IManageProperties<br />&nbsp;&nbsp; at Csla.Server.ObjectFactory.LoadProperty[P](Object obj, PropertyInfo`1 propertyInfo, P newValue)<br />&nbsp;&nbsp; at DataAccess.SqlCe.PersonDal.Execute(PersonsUpdater obj) in C:\Programme\Marimer LLC\CSLA .NET\Books\Using CSLA\Samples\03-DataAccess-110311\03-DataAccess-110311\FactoryImplementation\DataAccess.SqlCe\PersonDal.cs:line 186<br />&nbsp;&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp;&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Boolean hasParameters, Object[] parameters)) ---&gt; Csla.Reflection.CallMethodException: Execute method call failed ---&gt; System.ArgumentException: Target object must implement IManageProperties</p>
<p>What am I missing?</p>
<p>Thanks </p>
<p>Ben</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>It&#39;s a known issue that CommandBase does not implement IManageProperties (yet). </p>
<p><a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=890">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=890</a> </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>blc303 replied on Friday, December 09, 2011</h2><p>Thank you. I&#39;ll look into what that is going to take.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>blc303 replied on Friday, December 09, 2011</h2><p>So as I see it, it looks a little like trying to find the lesser of two evils.</p>
<p>You can do a copy and paste implementation of the BusinessBase implemenation with a couple of &#39;tweeks&#39;. First you are not doing any BusinessRule or Authorisation checks. Argueably, that&#39;s OK, because the CommandBase is, by definition, controlled by the CanExecute authorisation.</p>
<p>Thus, here the implentation in the hope that it gets into the next release.</p>
<p>&nbsp;&nbsp;&nbsp; #region IManageProperties Members<br /><br />&nbsp;&nbsp;&nbsp; bool IManageProperties.HasManagedProperties<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return (<b>FieldManager </b>!= null &amp;&amp; <b>FieldManager</b>.HasFields); }<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; List&lt;IPropertyInfo&gt; IManageProperties.GetManagedProperties()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return <b>FieldManager</b>.GetRegisteredProperties();<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; object IManageProperties.GetProperty(IPropertyInfo propertyInfo)<br />&nbsp;&nbsp;&nbsp; {<br /><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty(propertyInfo);</b><br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; object IManageProperties.ReadProperty(IPropertyInfo propertyInfo)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty(propertyInfo);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; P IManageProperties.ReadProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty&lt;P&gt;(propertyInfo);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; void IManageProperties.SetProperty(IPropertyInfo propertyInfo, object newValue)<br />&nbsp;&nbsp;&nbsp; {<br /><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FieldManager.SetFieldData(propertyInfo, newValue);</b><br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; void IManageProperties.LoadProperty(IPropertyInfo propertyInfo, object newValue)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(propertyInfo, newValue);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; List&lt;object&gt; IManageProperties.GetChildren()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return <b>FieldManager</b>.GetChildren();<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; #endregion</p>
<p>&nbsp;</p>
<p>Differences are bolded.</p>
<p>Have a nice day.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>blc303 replied on Friday, December 09, 2011</h2><p>Sorry, forgot two Interfaces</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; bool IManageProperties.FieldExists(Core.IPropertyInfo property)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return <b>FieldManager</b>.FieldExists(property);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp; P IManageProperties.ReadProperty&lt;P&gt;(PropertyInfo&lt;P&gt; propertyInfo)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ReadProperty&lt;P&gt;(propertyInfo);<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>Thanks,&nbsp;</p>
<p> issue 890 is now checked in to repository and will be included with Csla 4.3. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cwinkelmann replied on Tuesday, November 04, 2014</h2><p>Did this ever get fixed? I re-downloaded the v1.0 source file/examples and the file is still missing. So to use the example you have to implement this solution? </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, November 04, 2014</h2><p>Which version of CSLA did you download?&nbsp;</p>
<p>CommandBase does implement managed properties from CSLA 4.3 and later.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
