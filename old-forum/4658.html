<html><header><title>Did someone ever think of this ... </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Did someone ever think of this ... </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4658.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>manulisa posted on Thursday, April 10, 2008</h2><P>Hi all !</P>
<P>First of all i'm a big fan of CSLA ! But there's one thing which bothers me ... notably : what is the data access code # Data Region # doing in the business object. This should be separate classes only known in the DAL Layer, one for each BO, like this&nbsp; (i take customer object as example):</P>
<P><U>Business Layer : </U></P>
<P>Customer.cs (contains properties, methods, validation, authorization, factory methods)</P>
<P><U>DataAccesslayer:</U></P>
<P>CustomerDataService.cs (contains the DataPortal_XYZ methods for DataRetrieval).</P>
<P>Why ? For sake of abstraction of course : then in large teams business developpers are abstracted from the specific Data Access Layer and dedicated DAL programmers can write there Data Access Code in separate code-block.</P>
<P>From the current implementation, this isn't possible, as all code resides in the object it self, just separated by some region identifier ....</P>
<P>Of course there should be some adaptions on the CSLA framework to make this work i guess ...</P>
<P>Anyone had the same feeling ?</P>
<P>&nbsp;</P>
<P>Thx for any response.</P>
<P>&nbsp;</P>
<P>manulisa.</P>
<P>&nbsp;</P>
<P><U></U>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Thursday, April 10, 2008</h2><P>You know, no one has ever brought up this subject before! ;)</P>
<P>Rocky discusses this in his book - the idea of keeping business logic separate from the data access logic is largely achieved by having well defined methods where you put your data access code. You simply don't put data access code outside of the DataPortal methods and the methods that they call. </P>
<P>There are various threads if you do a search which talk about trying to abstract away the data access. The discussion including DeepData that was recently asked about (look for a recent thread looking for the video on this) includes a link to the DeepData discussion (among other subjects). </P>
<P>So yes it can be done and yes people have discussed it before. Me, I'm perfectly content keeping my data access in the same classes as the business logic provided they were well segmented into well defined areas of the code. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, April 10, 2008</h2>I prefer the DA code within my object too. You could of course use a partial class for aesthetic and/or code gen reasons but thats probably as far as I would go...</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andrewem replied on Wednesday, May 07, 2008</h2><P>Hi,</P>
<P>Did you ever get a response to this question? I have the exact same question. I don't understand how something so blatently obvious is not addressed formally. I understand that Rocky is a Microsoft Regional Director, but, we have very large clients that use Oracle (when I say large, I mean cities). They are not going to switch to SQL Server just to use our application. So it is important that this is addressed formally.</P>
<P>A</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, May 07, 2008</h2><P>CSLA is designed to give you a framework to architect your business objects. There is place where you put whatever data access code you want in order to do CRUD for your business objects. Whether you do that code using DTOs, without DTOs, with SQL Server, to XML files, with Oracle -- that's all up to you. </P>
<P>What do you mean by&nbsp;addressing formally? I'm not sure I understand your question. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andrewem replied on Wednesday, May 07, 2008</h2><P>Hi,</P>
<P>We'll lets say your application supports three DBMSs: SQL Server, Oracle, and MySql. </P>
<P>Are you suggesting that all of the code for these three different DBMSs must be placed into your one business object? </P>
<P>I was asking if anyone has a simple answer that says yes, they all go in there or no, you can have a pluggable architecture so you don't have to embed everything into your business objects. </P>
<P>A</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, May 08, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>andrewem:</strong></div><div>
<P>We'll lets say your application supports three DBMSs: SQL Server, Oracle, and MySql. </P>
<P>Are you suggesting that all of the code for these three different DBMSs must be placed into your one business object? </P>
<P>I was asking if anyone has a simple answer that says yes, they all go in there or no, you can have a pluggable architecture so you don't have to embed everything into your business objects. </P>
<P></div></BLOCKQUOTE></P>
<P>This is the 3rd thread you asked this question. It has already been answered twice.</P>
<P>See: <A HREF="/forums/thread/23394.aspx">http://forums.lhotka.net/forums/thread/23394.aspx</A> for my response.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>smiley riley replied on Monday, May 12, 2008</h2>Yes you can have a 'pluggable architecture so you don't have to embed everything into your business objects', but from what I have seen do&nbsp;not use CSLA.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, May 12, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>smiley riley:</strong></div><div>Yes you can have a 'pluggable architecture so you don't have to embed everything into your business objects', but from what I have seen do&nbsp;not use CSLA.</div></BLOCKQUOTE></P>
<P>CSLA is intentionally neutral on data access. This is to say that CSLA does not care how you get at your data.</P>
<P>The assumption is that the people using CSLA are intelligent professionals who can make good decisions that best fit their application's needs. That they can balance performance, coupling, complexity and various other factors to come up with a solution that meets their needs.</P>
<P>It sounds, on the whole, like you are looking for something more prescriptive and thus less flexible. For a framework that takes control away from you and makes more choices for you. That's fine, but that's not the purpose of CSLA so much.</P>
<P>Yes, parts of CSLA are very prescriptive. But when it comes to interacting with the UI and with data storage CSLA is very intentionally neutral and flexible.</P>
<P>So it is absolutely possible to use a pluggable architecture. In fact there are several different ways you might construct such a pluggable architecture - all of which work with CSLA. Or you might choose the simpler, faster technique of putting the data code in the DP_XYZ methods. Or you might choose to use a DTO-based data layer (as per one of your comments in another thread).</P>
<P>The point here, is that I've tried to make CSLA as flexible as I can in this regard, so each user of CSLA can apply their own intelligence and skills and experience to make the best overall solution to meet their particular requirements.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>smiley riley replied on Monday, May 12, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>smiley riley:</strong></div><div>Yes you can have a 'pluggable architecture so you don't have to embed everything into your business objects', but from what I have seen do&nbsp;not use CSLA.</div></BLOCKQUOTE></P>
<P>CSLA is intentionally neutral on data access. This is to say that CSLA does not care how you get at your data.</P>
<P>The assumption is that the people using CSLA are intelligent professionals who can make good decisions that best fit their application's needs. That they can balance performance, coupling, complexity and various other factors to come up with a solution that meets their needs.</P>
<P>It sounds, on the whole, like you are looking for something more prescriptive and thus less flexible. For a framework that takes control away from you and makes more choices for you. That's fine, but that's not the purpose of CSLA so much.</P>
<P>Yes, parts of CSLA are very prescriptive. But when it comes to interacting with the UI and with data storage CSLA is very intentionally neutral and flexible.</P>
<P>So it is absolutely possible to use a pluggable architecture. In fact there are several different ways you might construct such a pluggable architecture - all of which work with CSLA. Or you might choose the simpler, faster technique of putting the data code in the DP_XYZ methods. Or you might choose to use a DTO-based data layer (as per one of your comments in another thread).</P>
<P>The point here, is that I've tried to make CSLA as flexible as I can in this regard, so each user of CSLA can apply their own intelligence and skills and experience to make the best overall solution to meet their particular requirements.</P>
<P></div></BLOCKQUOTE></P>
<P>Sorry, It probably looks like i have come on here to bad mouth all your good work, which is not the case. Its a subject that interests me and I like thinking about new ideas.</P>
<P>Very interesting,&nbsp;because that was not how I percieved csla. Just shows how wrong you can be. ;-) I saw it more as a framework to try to constrain developers in re-use and not re-creating the wheel everytime a new project came along.</P>
<P>I think I probably need to approach CSLA at a time with fresh eyes where I have not had anothers implementation tint my spectacles as it were.</P>
<P>I think this is very apt, and probably one of the hardest things to do.&nbsp;</P>
<P><EM>'balance performance, coupling, complexity'</EM></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 13, 2008</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>smiley riley:</strong></div><div></P>
<P>I think this is very apt, and probably one of the hardest things to do.&nbsp;</P>
<P><EM>'balance performance, coupling, complexity'</EM></P>
<P></div></BLOCKQUOTE></P>
<P>There's no doubt that achieving balance is very hard.</P>
<P>It is certainly true that parts of CSLA are very prescriptive. The framework is focused on helping you build a domain business layer, and within that context it is reasonably prescriptive. It specifies the structure of each object stereotype, and how various stereotypes interact with each other. It specifies how you implement properties, validation rules, business rules and authorization rules. It specifies how you are allowed to move objects between client and app server (mobile objects).</P>
<P>But it expressly does <EM>not</EM> specify how you create the UI or other interface. It enables data binding in Windows, Web and WPF, but doesn't require it.</P>
<P>And it expressly does not specify how you talk to the database or other data store. It specifies the control points for data operations (the DataPortal_XYZ methods), but doesn't specify how you write them, or what technologies you use.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Wednesday, May 07, 2008</h2>Have you seen this? There are examples of using dtos between the business layer and data access layer.&nbsp; In the Data Access Layer you can pull the data from anywhere you want...<br><br>http://www.lhotka.net/Article.aspx?area=4&amp;id=7fbb619a-ba81-4157-b434-8756b68ccbd0</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>andrewem replied on Wednesday, May 07, 2008</h2><P>Hi,</P>
<P>We've looked at that, but&nbsp;our existing methodology is must cleaner. We were hoping to use inheritance and just implement the data access methods in another assembly. That's what we are doing now and it works. But we are looking to use something that more closely ressembles the book, but it seems like nothing has been established as the best method yet. </P>
<P>Thanks for your help.</P>
<P>A</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Wednesday, May 07, 2008</h2>Using dtos you have much better separation of concerns, you can make any changes directly to your&nbsp; data access layer without ever having to touch your business object layer directly.&nbsp; As opposed to the inheritance, where changes in the superclass could have a direct effect to&nbsp; its subclasses.<br><br>In my application I acutally went a different route. I did all the database code in the data portals like normal, but I programmed interfaces rather than the acutal implementations.&nbsp; So my implementation looks like the following:<br><br>private void DataPortal_Fetch(ByIdCriteria criteria)<br>{<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; const string sp = "gsp_IN_PagerView_GetById";<br>&nbsp;&nbsp;&nbsp; using (BaseConnection cn = ConnectionFactory.GetConnection(Database.ConnectionName))&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; using (IDbCommand cm = cn.GetCommand(sp, CommandType.StoredProcedure))<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;cn.AddParameter(cm, "a_id", DbType.Int32, criteria.Id);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LoadData(dr);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>}<br><br>The ConnectionFactory takes care of creating the correct connection and command types, which is determined from reading the config file.&nbsp; The business object knows nothing about what backend database is being used.&nbsp; The problem with this is the data must come from a database.&nbsp; With the dtos the information could come from anywhere (Web Services, XML Files, etc).&nbsp; I think in the long run dtos give you much better separation of concerns and cleaner code in data portal.&nbsp; The code below looks much cleaner, IMO.<br><br><br>private void DataPortal_Fetch(ByIdCriteria criteria)<br>{&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; DtoDepartment departmentDto = DepartmentsRepository.GetDepartment(criteria.Id);<br>&nbsp;&nbsp;&nbsp; LoadData(departmentDto);&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>}<br>&nbsp;</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 07, 2008</h2><P>You can look at the CSLA .NET 3.5 ProjectTracker code - it uses an external DAL created using LINQ to SQL. The model itself doesn't allow for swapping out different DAL implementations, but it is&nbsp;a relatively small step to get there. I am hopeful that ADO.NET EF will allow a similar implementation where you don't need to worry about swapping out the DAL at the DataPortal_XYZ level, because EF will better encapsulate the solution - time will tell.</P>
<P>In terms of getting the business object's fields loaded with data, there are many options. ProjectTracker 3.5 uses a model not unlike previous versions, and quite similar to the DeepData example on my web site.</P>
<P>Or you can use partial classes (especially if you create separate projects for your client and server assemblies - using Visual Studio's linked file capability to share the actual core code files). Or you can use an inheritance model to do the same basic thing. Or you can use an interface-based model. Or you can use reflection. There are <EM>many</EM> options.</P>
<P>One thing I'm doing in my CSLA Light prototype is allowing the business object to specify that the data portal should call a "factory object" rather than creating/initializing the business object directly. You specify the factory object type, and you must implement a factory object for each root business type. </P>
<P>The model is required for CSLA Light, because you can't necessarily trust the Silverlight client (I don't think) and so there is a need for the business developer to get deeper into the middle of the data portal processing. Obviously this requires more coding, because the data portal is doing less work, but that's the tradeoff.</P>
<P>When doing this with the CSLA Light data portal you'll typically have your factory simply call the real business object's static factory methods:</P>
<BLOCKQUOTE dir=ltr>
<P>[MobileFactory("MyDll.CustomerFactory,MyDll", "Create", "Load")]<BR>public class Customer : BusinessBase&lt;Customer&gt;<BR>{ ... }</P>
<P>public class CustomerFactory<BR>{<BR>&nbsp; public Customer Create()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // make sure Silverlight caller is allowed to do this<BR>&nbsp;&nbsp;&nbsp; return Customer.NewCustomer();<BR>&nbsp; }<BR><BR>&nbsp; public Customer Load(SingleCriteria&lt;Customer, int&gt; criteria)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; // make sure Silverlight caller is allowed to do this<BR>&nbsp;&nbsp;&nbsp; return Customer.GetCustomer(criteria.Value);<BR>&nbsp; }<BR>}</P></BLOCKQUOTE>
<P>I might implement something similar for the .NET data portal too. It would require more work on the business developer's part though, because the .NET factory (unlike the Silverlight one) would have to do <EM>everything</EM> the data portal does today:</P>
<OL>
<LI>Create an instance of the object (probably using Activator.CreateInstance())</LI>
<LI>Trigger the data load or initialization or delete or update or insert</LI>
<LI>Call MarkNew() or MarkOld() as appropriate</LI>
<LI>Call the pre- and post- operation methods if you care (like the DataPortal_OnDataPortalComplete)</LI></OL>
<P>Luckily CSLA .NET 3.5 exposes the same helpers in Csla.Reflection that are used by the data portal itself (including all the cool dynamic method invocation and caching stuff), so you really can replicate what SimpleDataPortal does for you just the way it is done by CSLA - or you can invent your own scheme as long as the result is the same.</P>
<P>I'm not entirely sure I'll go down this road for .NET. For Silverlight it is very important. For .NET it mostly provides a very complicated alternative where people can really mess up the data portal if they do it wrong. On the upside though, it offers some pretty impressive flexibility in terms of invoking various advanced types of DAL.</P>
<P>It might help you, because your factory would be able to create an instance of a subclass of the real object - the subclass that implements the data access logic and loads the protected fields. That might look something like this:</P>
<BLOCKQUOTE dir=ltr>
<P>[DataFactory("MyDataDll.CustomerFactory,MyDataDll", "Create", "Load")]<BR>public class Customer : BusinessBase&lt;Customer&gt;<BR>{ ... }</P>
<P>public class CustomerDal : Customer<BR>{ ... }<BR><BR>public class CustomerFactory<BR>{<BR>&nbsp; public Customer Create()<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; var cust = new CustomerDal();<BR>&nbsp;&nbsp;&nbsp; cust.LoadWithDefaults();<BR>&nbsp;&nbsp;&nbsp; return cust;<BR>&nbsp; }<BR><BR>&nbsp; public Customer Load(SingleCriteria&lt;Customer, int&gt; criteria)<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; var cust = new CustomerDal();<BR>&nbsp;&nbsp;&nbsp; cust.LoadWithData(criteria.Value);<BR>&nbsp;&nbsp;&nbsp; return cust;<BR>&nbsp; }<BR>}</P></BLOCKQUOTE>
<P>Presumably LoadWithDefaults() and LoadWithData() would not only load the object's fields, but would call MarkNew() or MarkOld() as appropriate.</P>
<P>I don't know if this would cause issues with serialization - though I suspect it probably would. The serializers would serialize a type of CustomerDal and be unable to serialize it back into something called Customer on the caller - so now that I think about this, it really won't work unless CustomerDal implements ISerializable and in that implementation tells the serializer to deserialize into a different type (Customer in this case). That's pretty complex code to expect a business developer to write into every DAL class - so I'm liking this option less and less the more I think about it...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>smiley riley replied on Monday, May 12, 2008</h2><P>Yes, and Im moving it all after taking over someones code.</P>
<P>To me its unmanageable, and causes coupling issues.</P>
<P>&nbsp;</P>
<P>I have to add it could just be the way the code I inherited has been written.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
