<html><header><title>ApplyEdit vs BeginSave</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ApplyEdit vs BeginSave</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8756.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH posted on Friday, April 02, 2010</h2><p>When using BusinessBase in Silverlight, why would one choose ApplyEdit over BeginSave, vice versa?&nbsp; ApplyEdit has no way of notifying a direct caller that the DP.Update() was successful like BeginSave can (via the delegate argument).&nbsp; It seems that with ApplyEdit, you invoke and forget it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Friday, April 02, 2010</h2><p>Ahh, I see what&#39;s going on.&nbsp; ApplyEdit doesn&#39;t really invoke any kind of Update, it checks to see whether a parent exists, and that parent may or may not invoke a&nbsp;DP.Update.&nbsp; This is the case of calling BusinessBase.ApplyEdit within the context of an EntityRootListBase (ERLB).</p>
<p>In a previous post, I have mentioned some of my struggles using a ERLB in conjunction with a ListBox.&nbsp; I&#39;m almost there, however, what I&#39;m attempting to do is grab the selected bound EditableRoot, and pass it into a popup view.&nbsp; When the user edits the ER and clicks &quot;OK&quot;, I want the save to be successful before closing the popup and returning control to the view that launched it (the view containing the ListBox).</p>
<p>Problem is, when using an EditableRoot contained within&nbsp;an ERLB, it expects ApplyEdit to be invoked, and ApplyEdit follows a fire-and-forget approach.&nbsp; So, unless I pass a reference to the entire ERLB to the popup, the popup will have no way of knowing whether the DP.Update was successful or not as a result of invoking ApplyEdit.</p>
<p>Anyone have any thoughts on this?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, April 02, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>AaronH<br></b>
<p>...Problem is, when using an EditableRoot contained within&nbsp;an ERLB, it expects ApplyEdit to be invoked, and ApplyEdit follows a fire-and-forget approach.&nbsp; So, unless I pass a reference to the entire ERLB to the popup, the popup will have no way of knowing whether the DP.Update was successful or not as a result of invoking ApplyEdit.</p>
<p>Anyone have any thoughts on this?</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>I think the Parent of your EditableRoot will be set to the ERLB, so at least in theory there is a way to get to it without explicitly passing a separate reference.&nbsp; (Not sure if ERLB is necessarily the right choice here, but you can probably resolve this particular issue without redoing what you already have with another list type)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, April 02, 2010</h2><p>As I mentioned once in the other thread, I&#39;m not really sure you should be using ERLB. I&#39;m just not sure it is making your life any easier, and it might be simpler to just retrieve a MobileList of root objects and then save them when you want to save them by calling BeginSave() on that item.</p>
<p>The only thing you need to handle in that case is to replace the old item in the list with the new item you get back from the server if the save is successful, so the list remains current with the actual item.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Saturday, April 03, 2010</h2><p>Rocky, could you point me to a demo that is currently using the MobileList of root objects?&nbsp; I cannot find one.</p>
<p>I&#39;m thinking either approach is a crap shoot at this point, however.&nbsp; ERLB is REALLY nice, I have to say.&nbsp; It&#39;s nice because the object reference to an edited object is properly updated in the bound list automatically.&nbsp; Compare this to a ObservableCollection of EditableRoots, where you have to manually remove an EditableRoot from the bound list, remember its position, and insert the updated ER passed back from the server after a&nbsp;successful DP.Update.&nbsp; Works, but it&#39;s a bit hackish as well.</p>
<p>So no perfect solution here.&nbsp; So it&#39;s a struggle to choose the lesser of two evils: between&nbsp;manual manipulation of an underlying bound list (OB, MobileList, etc.), or passing around an ERLB reference to other views/viewmodels that need to be notified when a EditableRoot was successfully saved so that it can return control to the caller..</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, April 03, 2010</h2><p>I don&#39;t have such a sample.</p>
<p>You are right about the implementation. MobileList&lt;T&gt; is just an ObservableCollection&lt;T&gt; that can flow through the Silverlight data portal. So it will take as much work to use as using a regular OC of root objects.</p>
<p>You&#39;ll have to decide if that is easier or harder than using ERLB in your situation.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Sunday, April 04, 2010</h2><p>Conceptually, how do you see a MobileList being created on the server?&nbsp; It doesn&#39;t contain any DP methods.&nbsp; Do you envision a list, such as an ERLB or BLB containing a static&nbsp;GetXXX method, whose return type is&nbsp;MobileList?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, April 05, 2010</h2><p>I&#39;d think you&#39;d use a CommandBase subclass to execute a command and get the mobile list back.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, April 05, 2010</h2><p>It is even easier than that.</p>
<p>The data portal works with any serializable types. You really don&#39;t need the 6 base classes from CSLA to use the data portal - though on Silverlight you do need to remember that &quot;serializable&quot; means that the type implements IMobileObject.</p>
<p>If you look at your typically business class, you&#39;ll probably notice that you rarely override DataPortal_Fetch(). Instead, you almost always just implement your own overload. In CSLA 4 there is no virtual DataPortal_Fetch(), because it has really become an inconvenience more than a help.</p>
<p>By extension then, you can infer that <em>any class can implement DataPortal_Fetch() methods</em> and the rest of the DP_XYZ methods too. And the data portal will talk to them just fine.</p>
<p>So all you need is something like this:</p>
<p style="padding-left:30px;">[Serializable]<br />public class MyList : Csla.Core.MobileList&lt;MyItem&gt;<br />{<br />#if !SILVERLIGHT<br />&nbsp; private void DataPortal_Create()<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules();<br />&nbsp; }</p>
<p style="padding-left:30px;">&nbsp; private void DataPortal_Fetch()<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; // load list here<br />&nbsp; }<br />#endif<br />}</p>
<p>You&#39;ll need a factory method too, along with whatever code is required to get the list to work the way you want. But the data portal will interact with this type just fine.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Monday, April 05, 2010</h2><p>Beautiful, thanks!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Monday, April 05, 2010</h2><p>I&nbsp;don&#39;t think I have my head around this like I thought I did.&nbsp; Basically, I need the SL client to bring me back a list of EditableRoots.&nbsp; From a SL client, typically this is done via a static call ObjectList.GetObjectList(id, handler);&nbsp;</p>
<p>With the MobileList, this construct is not exposed (The MobileList doesn&#39;t present me with any async callback methods).&nbsp; So it seems that I would need to produce the plumbing that would cause teh MobileList to go back to the server, load itself up with objects, and return to the SL client.</p>
<p>Is there any literature on the MobileList?&nbsp; A previous blog post, video segment, chapter in a book?</p>
<p>I think I&#39;m missing the point as to how or why you would leverage it.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, April 05, 2010</h2><p>I&#39;m not sure I understand what ObjectList.GetObjectList refers to.&nbsp; Is this something you&#39;re finding in Csla, or something else?</p>
<p>Rocky&#39;s suggetion was to create your own static method..&nbsp; MyMobileList.GetList() which in turn calls the async dataportal fetch method.&nbsp; Then you implement a DataPortal fetch overload with the same parameters you used to call Fetch (minus any callback of course).</p>
<p>Any object which supports the IMobileObject can be called through the dataportal in that matter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, April 05, 2010</h2><p>Right, the base classes (BusinessBase, BusinessListBase, etc) provide absolutely 0 (zero) support for create/fetch operations beyond the (typically unused) virtual DataPortal_Fetch() method.</p>
<p>If &quot;GetObjectList&quot; is a factory method, then that&#39;s <em>your code</em>, not framework code. And you&#39;d implement a factory in a MobileList <em>exactly as you would in a BusinessListBase</em>.</p>
<p>There are several base classes that implement IMobileObject - all of which are designed to be as light-weight as possible over the base .NET concepts:</p>
<ul>
<li>MobileList&lt;T&gt;</li>
<li>MobileBindingList&lt;T&gt;</li>
<li>MobileObservableCollection&lt;T&gt; (CSLA 4, effectively replaces MobileBindingList)</li>
<li>MobileDictionary&lt;K,V&gt;</li>
<li>MobileObject</li>
</ul>
<p>These are all in Csla.Core and you should be able to infer what they are wrapping by their name.</p>
<p>There&#39;s also ExtendedBindingList&lt;T&gt;, which is the immediate base class for BLB and ERLB. And ReadOnlyBindingList&lt;T&gt; which is the immediate base class for ROLB.</p>
<p>In .NET you can use the data portal to directly retrieve a List&lt;T&gt;. In SL you need to use MobileList&lt;T&gt;, but it is the same thing - just with support for MobileFormatter.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Monday, April 05, 2010</h2><p>Thanks Andy.&nbsp; I was using ObjectList as an example.&nbsp; So:</p>
<p>public class ObjectList : MobileList&lt;SomeEditableRoot&gt;</p>
<p>So I get that,&nbsp;expose a&nbsp;static method (GetObjectList).&nbsp; So then what?</p>
<p>It doesn&#39;t expose GetObjectList(id, handler) that takes a callback handler as an argument as the other CSLA classes do.&nbsp; So basically, I would need to provide my own plumbing to have the MobileList call back to the server, have the server load the MobileList, and send it back.&nbsp; No?&nbsp; </p>
<p>Am I making sense?&nbsp; If not, try the following.&nbsp; Create two .NET CSLA classes: one that derives EntityRootListBase and one that derives from MobileList.&nbsp; Give each one the same static method &quot;GetXYZ&quot; that returns an instance of itself.&nbsp; </p>
<p>Now, in your SL project, link those two classes, and call each one.&nbsp; You&#39;ll notice in the ERLB.GetXYZ() method, one of the arguments is a callback handler that is invoked when the DP call is complete.&nbsp; You&#39;ll also notice that the ML.GetXYZ() method does <span style="text-decoration:underline;">not</span> provide a callback handler as an argument.</p>
<p>So how am I to tell the ML.GetXYZ() method that it is supposed to make a call to the DP?</p>
<p>Hopefully I&#39;m making sense here?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, April 05, 2010</h2><p>Aaron, you wrote those GetXYZ() methods. They are your code, not CSLA code.</p>
<p>If you write your GetXYZ() as a synchronous method it will only work on .NET - that&#39;s true for ERLB, BLB or any other type.</p>
<p>If you write your GetXYZ() as an async method (with a callback parameter) it will work on SL and .NET. That&#39;s true for any type as well.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Monday, April 05, 2010</h2><p>Ohhhh, right.&nbsp; This back and forth between CSLA SL&nbsp;and WCF RIA is killing me.&nbsp; My apologies, I was thinking that a proxy was somehow being generated for me, and completely forgot that I&#39;ve been creating my own SL implementation for the static methods.&nbsp; It was a long weekend...</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
