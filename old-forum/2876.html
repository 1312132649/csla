<html><header><title>How to write to e.PropertyName in RuleArgs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to write to e.PropertyName in RuleArgs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2876.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert posted on Tuesday, May 15, 2007</h2>I have several business objects in which I'm using ITypedList to dynamically expose sub-properties (properties of contained objects). I have validation rules associated with the contained objects, but I want to return the e.Description to binding so that it's associated with a different property, one of the ones I'm dynamically creating. In other words:<br><br>ValidationRules.AddRule(AddressOf ActivityRequired, "Activity")<br><br>&nbsp;&nbsp;&nbsp; Protected Shared Function ActivityRequired(ByVal target As Object, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByVal e As Csla.Validation.RuleArgs) As Boolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If CType(target, RoutingStep).Activity Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Activity required"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True<br>&nbsp;&nbsp;&nbsp; End Function<br><br>In this example, I want the setting of the Activity object to trigger the validation rule, but I want a property called ActivityDescr to have the associated e.Descripition. I envision something like:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If CType(target, RoutingStep).Activity Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.PropertyName = "ActivityDescr"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = "Activity required"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>However, PropertyName is ReadOnly.<br><br>Is there any other way/workaround to accomplish this?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, May 15, 2007</h2><P>My first inclination is to ask you: "Which object <STRONG><EM>really </EM></STRONG>owns that business rule?"</P>
<P>Is it true that for an Activity to exist, it must have an Activity Description?</P>
<P>If so, the rule belongs to the ActivityDescr property inside of Activity, and not to the object that contains the Activity.</P>
<P>Activity (assuming it is subclassed from BusinessBase), has a collection of broken rules in it.</P>
<P>The object containing Activity can access that collection and display the concatenation of its own broken rules and Activity's broken rules.</P>
<P>Take a look at RuleBusinessBase in the CslaContrib project (link on the forum home page) for an example of how to modify BusinessBase to publically expose the broken rules collection.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, May 16, 2007</h2>David,<br><br>Thanks for your reply. I thiunk I probably didn't explain it well enough. The containing class needs to validate that it contains an Activity object. _activity is declared like this:<br>Private _activity As Activity = Nothing<br><br>When the containing class checks its rules, it only needs to check for the existence of an activity object. This cannot be done from within the activity class; it has to be done by the containing object. Once it determines that the activity object is nothing, I want it to return the e.Description through another property of the containing object, called ActivityDescr. This property is a "virtual" property in that it's created using a PropertyDescriptor. The PropertyDescriptor returns the Descr property of any contained activity object. However, since, when it fails, there is no activity object, there is also no Descr property. I want to somehow intervene in the BrokenRules' relationship with data binding so that my containing class can tell the UI, through the ActivityDescr property, that the object has not been set.<br><br>Thanks again for any help.<br><br>Barry<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Wednesday, May 16, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>bgilbert:</strong></div><div>David,<BR><BR>Thanks for your reply. I thiunk I probably didn't explain it well enough. The containing class needs to validate that it contains an Activity object. _activity is declared like this:<BR>Private _activity As Activity = Nothing<BR><BR>When the containing class checks its rules, it only needs to check for the existence of an activity object. This cannot be done from within the activity class; it has to be done by the containing object. Once it determines that the activity object is nothing, I want it to return the e.Description through another property of the containing object, called ActivityDescr. This property is a "virtual" property in that it's created using a PropertyDescriptor. The PropertyDescriptor returns the Descr property of any contained activity object. However, since, when it fails, there is no activity object, there is also no Descr property. I want to somehow intervene in the BrokenRules' relationship with data binding so that my containing class can tell the UI, through the ActivityDescr property, that the object has not been set.<BR><BR>Thanks again for any help.<BR><BR>Barry<BR></div></BLOCKQUOTE></P>
<P>Um, I think I understand... :)</P>
<P>There is a way to force dependencies between properties for a given rule,&nbsp; ValidationRules.AddDependentProperty. </P>
<P>I'm in the process of writing up some tests to see if it works the way I think it does.&nbsp; If I remember correctly, the ProjectTracker app has an example of it on a custom rule concerning the start and end dates.</P>
<P>If it works the way I suppose it does, you would put the rule on ActivityDescr and mark Activity as a dependent property.&nbsp;&nbsp; </P>
<P>Whoever figures it out first should post it. :)</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Wednesday, May 16, 2007</h2><P>Is ActivityDescr a denormalized access point to the underlying _activity.Description property?</P>
<P>If so, why not just put the rule on it to begin with?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bgilbert replied on Wednesday, May 16, 2007</h2>David,<br>Great. I had to use both techniques. Check the rules on the ActivityDescr property and also use AddDependentProperty with Activity. It now works like a charm.<br><br>Thanks for you help.<br><br>Barry<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
