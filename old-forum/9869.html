<html><header><title>accessing dataannotations display name in a business rule</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>accessing dataannotations display name in a business rule</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9869.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini posted on Tuesday, December 14, 2010</h2><p>I was wondering if from within a business rule, it would be possible to access the given input/affected property&#39;s dataannotation provided display name to help make my error message more meaningful and user friendly.</p>
<p>I understand from this post <a href="http://forums.lhotka.net/forums/p/8660/41322.aspx">http://forums.lhotka.net/forums/p/8660/41322.aspx</a>&nbsp;that Csla looks at dataannotations display name to generate its default error messages but what if i wanted my own error message but still wanted to use datannotations display name ?</p>
<p>Would appreciate any help!</p>
<p>Thanks</p>
<p>Ranjini</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, December 14, 2010</h2><p>I assume you are using CSLA 4.x?</p>
<p>If you register a propertyinfo with lambda expression without friendly name then the default PropertyInfoFactory will actually try to get the Display DataAnnotation attribute and insert this value as FriendlyName. </p>
<p>&nbsp;&nbsp;&nbsp; public static PropertyInfo&lt;string&gt; CustomerNameProperty = RegisterProperty&lt;string&gt;(p =&gt; p.CustomerName);</p>
<p>&nbsp;&nbsp;&nbsp; [Display(Name = &quot;Customer name&quot;)]<br />&nbsp;&nbsp;&nbsp; public string CustomerName<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(CustomerNameProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(CustomerNameProperty, value); }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>So in your own custom rule you should be able to get it straight from the IPropertyInfo.FriendlyName. </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, December 14, 2010</h2><p>Thanks for your response.</p>
<p>I am using CSLA 4.x and doing exactly what you have shown , but in my custom business rule, IPropertyInfo.FriendlyName still shows as &quot;CustomerName&quot; and not &quot;Customer name&quot;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, December 14, 2010</h2><p>Just to support what i said, here are peices of my code</p>
<p><strong>Property Registration - </strong></p>
<p>&nbsp;public static PropertyInfo&lt;double?&gt; _rawUnitsAtFullScaleProperty = RegisterProperty&lt;double?&gt;(c =&gt; c.RawUnitsAtFullScale);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Display(Name = &quot;Raw Units At Full Scale&quot;)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double? RawUnitsAtFullScale<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(_rawUnitsAtFullScaleProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(_rawUnitsAtFullScaleProperty, value); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><strong>Business Rule - </strong></p>
<p>public class CheckIfValid : Csla.Rules.BusinessRule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CheckIfValid (IPropertyInfo primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (InputProperties == null) InputProperties = new List&lt;IPropertyInfo&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties.Add(primaryProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute (RuleContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string ErrMsg = PrimaryProperty.FriendlyName + &quot; has to be greater than zero &quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (context.InputPropertyValues[PrimaryProperty] != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (((double)context.InputPropertyValues[PrimaryProperty]) &lt;= 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(ErrMsg);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(ErrMsg);</p>
<p><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;</p>
<p><strong>Adding BusinessRule to Property -</strong> </p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">protected</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">override</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">void</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> AddBusinessRules ()</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">{<font face="Consolas" size="2"><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">base</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.AddBusinessRules();</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>BusinessRules.AddRule(</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> CheckIfValid(_rawUnitsAtFullScaleProperty));</span></span><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"><span style="font-family:Consolas;color:#008000;font-size:x-small;"></span></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p>}</p>
</span></span></p>
<p>&nbsp;<strong>Result</strong></p>
<p>and here is the snapshot of what friendlyname returns on the propertyinfo in the business rule - <a href="https://docs.google.com/leaf?id=0B-Qwbn69ZX90YzVjMWQ4NGYtMTVkYi00ZmE0LWEwNGUtMDE0ZTZhODhlYzIx&amp;hl=en&amp;authkey=CNSbnaUJ">https://docs.google.com/leaf?id=0B-Qwbn69ZX90YzVjMWQ4NGYtMTVkYi00ZmE0LWEwNGUtMDE0ZTZhODhlYzIx&amp;hl=en&amp;authkey=CNSbnaUJ</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, December 14, 2010</h2><p>Which version of Csla and framework (Net/SL) are you using?</p>
<p>Checked in NET4 with latest CSLA 4.1 Beta code in repository and it works just fine.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Tuesday, December 14, 2010</h2><p>Mine is a silverlight app and uses CSLA 4.0.1</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, December 14, 2010</h2><p>Hmmm, I&#39;m running the latest Csla 4.1 Beta and in SL I get: </p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cda869;">public</span>&nbsp;<span style="color:#cda869;">static</span>&nbsp;<span style="color:#7587a6;">PropertyInfo</span>&lt;<span style="color:#cda869;">string</span>&gt;&nbsp;CustomerNameProperty&nbsp;=&nbsp;RegisterProperty&lt;<span style="color:#cda869;">string</span>&gt;(p&nbsp;=&gt;&nbsp;p.CustomerName);<br /> <br /><span style="color:#afc4db;"></span>&nbsp;&nbsp;&nbsp; [<span style="color:#7587a6;">Display</span>(Name&nbsp;=&nbsp;<span style="color:#8f9d6a;">&quot;Customer&nbsp;name&nbsp;xyz&quot;</span>)]<br /><span style="color:#afc4db;"></span>&nbsp;&nbsp;&nbsp; <span style="color:#cda869;">public</span>&nbsp;<span style="color:#cda869;">string</span>&nbsp;CustomerName<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cda869;">get</span>&nbsp;{&nbsp;<span style="color:#cda869;">return</span>&nbsp;GetProperty(CustomerNameProperty);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#cda869;">set</span>&nbsp;{&nbsp;SetProperty(CustomerNameProperty,&nbsp;<span style="color:#cda869;">value</span>);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />and I get:<br />?CustomerNameProperty<br />{Csla.PropertyInfo&lt;string&gt;}<br />    _defaultValue: &quot;&quot;<br />    _friendlyName: &quot;Customer name xyz&quot;<br />    _index: -1<br />    _name: &quot;CustomerName&quot;<br />    _relationshipType: None<br />    Csla.Core.IPropertyInfo.DefaultValue: &quot;&quot;<br />    Csla.Core.IPropertyInfo.Index: -1<br />    DefaultValue: &quot;&quot;<br />    FriendlyName: &quot;Customer name xyz&quot;<br />    Name: &quot;CustomerName&quot;<br />    RelationshipType: None<br />    Type: {System.String}<br /><br />And error string for Required rule contains &quot;Customer name xyz is required&quot;.<br /><br />BTW:This is the SimpleNTier sample in the Samples download and CustomerName property is in Order.cs. <br /><br />Could you try your code with the latest Beta? <br /></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, December 15, 2010</h2><p>I actually just added a unit test for this, and the test passes.</p>
<p>I have a TestValue property with a Display(Name=&quot;Test value&quot;) attribute. This test works</p>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">TestMethod</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;DisplayName()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;obj&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">Single</span>();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Assert</span>.AreEqual(<span style="color:#a31515;">&quot;Test&nbsp;value&quot;</span>,&nbsp;<span style="color:#2b91af;">Single</span>.TestValueProperty.FriendlyName);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, December 15, 2010</h2><p>Hi,</p>
<p>This is caused by a bug in BusinessBase in Silverlight that would not use the PropertyInfoFactory.</p>
<p><a title="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=803" href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=803">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=803</a> and was fixed on 6. september 2010.</p>
<p>The fix was made after&nbsp; Csla 4.0.1 was released so your options is to either update BusinessBase.cs in Csla.Siverlight or upgrade to the latest beta.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ranjini replied on Wednesday, December 15, 2010</h2><p>Thanks much for the thorough followup! Since I am not in a position to use the beta version, I just recompiled csla with the bug fix in businessbase.cs and it works. </p>
<p>Thanks again!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
