<html><header><title>Validation of objects with properties where CanReadProperty = false</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation of objects with properties where CanReadProperty = false</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2406.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>MonorailMan posted on Thursday, February 22, 2007</h2><P>I have an object with a string property that is required (CommonRules.StringRequired).&nbsp; Some users of my app will be able to read this property, while others will not.&nbsp; I am using CanReadProperty(true) in the property getter, as that seems to be the standard.&nbsp; If I am logged in as a user with no Get permission on this property, validation will always throw an exception because the property cannot be checked.&nbsp; How do I validate this object if the user is unable to Get it?</P>
<P>Thanks for your assistance</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 22, 2007</h2>First, a user without permission to read this property may be allowed to set it?&nbsp; That's unusual..<br><br>To get around your problem, I think you'll have to make your own StringRequired static method within the class that contains the property.&nbsp; In your own StringRequired method, you'd then check the value of the field, not the property.. something like this:<br><br><font color="#0000ff">private static bool</font> MyPropertyStringRequired( <font color="#008000">MyClass </font>target, <font color="#008000">RuleArgs </font>e ) {<br>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">bool </font>result;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">if </font>( <font color="#0000ff">string</font>.IsNullOrEmpty( target.myProperty ) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = <font color="#0000ff">false</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = <font color="#ff0000">"Required!"</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">else </font>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = <font color="#0000ff">true</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">return </font>result;<br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mr_lasseter replied on Thursday, February 22, 2007</h2><P>The user doesn't have to set it for the validation rules to be called.&nbsp; Think about the scenario where object is fetched from the database and then the Validation.CheckRules is called.&nbsp; </P>
<P>Also, wouldn't you want to call the CanReadProperty in the validation routine?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 22, 2007</h2>Yes, that's right... DP_F would check the rule.<br><br>You wouldn't want to call CanReadProperty in the validation routine though.&nbsp; The routine doesn't expose the value in the myProperty field to the user, it just checks if the value is empty or not.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MonorailMan replied on Thursday, February 22, 2007</h2>Exactly, and with the code sample above, it is still calling the public property to check the value, which will call CanReadProperty(true), throwing the exception.&nbsp; Should I move CanReadProperty to the UI, allowing validation to run, but checking the access in the UI instead?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 22, 2007</h2>Ahh, no, the code isn't clear I guess.<br><br>public class MyClass : BusinessBase&lt;MyClass&gt; {<br><br>&nbsp;&nbsp; private string myProperty;<br><br>&nbsp;&nbsp; public string MyProperty {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty( "MyProperty", true );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return myProperty;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br><br>So in the rule, you're checking the value via the <i>field </i>and not the <i>property</i>.&nbsp; Notice in my previous code posting the check is:<br>&nbsp;&nbsp;&nbsp; string.IsNullOrEmpty( target.<i>my</i>Property )<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MonorailMan replied on Thursday, February 22, 2007</h2><P>Ahhh...thank you for pointing that out.&nbsp; I hadn't thought of that.&nbsp; I just tested it, and it does work.</P>
<P>Thank you all for your help</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, February 22, 2007</h2>No problem, glad you got it working.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MonorailMan replied on Thursday, February 22, 2007</h2><P>One more thought: Is there a way to make this more generic?&nbsp; What if I would like to use the same method for checking multiple private fields?&nbsp; I tried target.GetType().GetFields(), but that only returns public fields.&nbsp; Is there another way?</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 22, 2007</h2><P>Sure, but you must use reflection (late binding). It is a very good idea to normalize behavior by creating reusable rule methods!</P>
<P>Reflection does allow you access to private fields, though not by default. Read through the n-level undo implementation in Chapter 3 though, because I do exactly that in my implementation.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, February 22, 2007</h2>You need to pass the correct binding flags in order to get private fields.<br>If my memory doesn't fail it's the combination of (in vb):<br>Dim bFlags As BindingFlags = BindingFlags.Instance Or BindingFlags.NonPublic Or BindingFlags.Public<br><br>Now you could do:<br>target.GetType().GetField("fieldName", bFlags)<br><br><br>Andr√©s<br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
