<html><header><title>Question about Editable Assignment object similar to ProjectResource</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Question about Editable Assignment object similar to ProjectResource</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1752.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer posted on Monday, November 13, 2006</h2>I've got a use case that requires a situation very similar to situation in the ProjectTracker application which uses the ProjectResource object to implement an assignment of a resource to a project.&nbsp; I'm currently redesigning/rewriting this application using CSLA.Net and C# 2.0.&nbsp; In the&nbsp;old version of this software the database was not properly normalized and therefore it was very easy to allow the user to edit all of the information for a particular table&nbsp;in 1 grid.&nbsp; In order to normalize the database, I&nbsp;have split the table in question into two different tables similar to Resources and Assignments in the PTracker database.&nbsp; In my particular use case the user would like to be able to edit the&nbsp;actual details of the base resource object along with those details that are specific to the assignment of the resource to that project (i.e. the resource's role).&nbsp; To keep the functionality similar to that of the old system,&nbsp;the users would like to be able to modify, for example, &nbsp;the resource's first name and also the resource's role on a project on the same screen in the same grid.&nbsp; My problem arises when I try to setup these objects....I'm not sure how to modify the PTracker example to allow for the editing of both the assignment object (ProjectResource) and the "base" object (Resource).....Can anyone offer insight or&nbsp;point me in the right direction?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, November 14, 2006</h2>Hey there,<br><br>It looks like you fell in the classic trap of modeling objects after your datamodel .... while you _should_ be modeling them after your use-case.<br><br>In other words: if your use case is to allow the user to edit a resource's role and name, then create a business object Resource with a Role property and a Name property. In your dataportal_xxx methods you can put the normalization into effect by wrapping as many inserts/updates as needed to get the job done in a single transaction. <br><br>Or in case you are working with stored procedures: put multiple queries in the body of your proc.<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Tuesday, November 14, 2006</h2>I had previously thought about using a single business object to encompass this functionality but I guess I figured that since&nbsp;the&nbsp;ProjectTracker app&nbsp;used&nbsp;the Resource class, the ProjectResource class, and the Assignment class, that I should model my "assignments" in a similar fashion.... I guess the fact that I need to be able to edit information from both the original table and the assignment table in the&nbsp;same grid&nbsp;makes my scenario different from the ProjectTracker sample as it only allowed the user to modify the "assignment" information on one screen and the specific resource information on another.&nbsp; Thanks for the advice, I'll see if I can get it going with just one class.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, November 14, 2006</h2>Aha,<br><br>I can see why this is confusing. <br><br>However, you should note the following:<br>- Assignment is not a class .... it's just a module that provides functionality to Add/Remove/Update Assignments in a shared location<br>- the ProjectEdit view uses its own set of BOs (Project - ProjectResources - ProjectResource)<br>- and ResourceEdit also (Resource - ResourceAssignments - ResourceAssignment)<br>- both ProjectResource and ResourceAssignment deal with the same database table in the background: the assignments table, it is important to note that although there is 1 table, we still have different BOs for each view (i.e. BOs are modeled after use cases). <br>- the Assignment module is used by both ResourceAssignment and ProjectResource and I think the only reason for putting the assignment-crud functionality in this module is to avoid duplicate code.<br><br>Good luck refactoring! <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Tuesday, November 14, 2006</h2><P>I started implementing this functionality as one object/class based on use cases instead of database design and have run into the following situation....My database has the following tables (names were changed to protect the innocent):</P>
<P>Resource, Assignment</P>
<P>The problem comes about when I attempt to implement optimistic locking similar to what Rocky implemented in ProjectTracker.&nbsp; Basically I have a timestamp column in each of the tables that indicates when the last change was made.&nbsp;&nbsp;If I use one business object to handle this which is able to update information from both of the database tables, I will have to have two timestamp/ byte[] fields on my business object.&nbsp; Is there any better way to handle this, or is my approach acceptable?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 14, 2006</h2>I would say having both timestamps is fine, after all its information that the BO needs to complete its task.<br><br>The timestamp fields in your BO should be private, I can't think of a reason to expose them to the UI layer.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Tuesday, November 14, 2006</h2><P>Ok...That seems to have done the trick.&nbsp; I do have a sort of related question about how to handle update conflicts associated with optimistic locking in the UI/presentation layer.&nbsp; The user(s) will be modifiying a collection of objects in a grid.&nbsp;&nbsp;The saving of the collection&nbsp;is performed as the user attempts to close the form...I currently have it working where the objects w/o update collisions will save successfully while the objects with update conflicts will not save.&nbsp; I'm just trying to think of a good way to handle this update conflict situation in the UI....&nbsp; The objects in the collection are child objects, and therefore cannot be "refreshed" individually...Any ideas on how to handle this sort of thing "gracefully"&nbsp;in the UI?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 14, 2006</h2>Well, the typical route is to throw an exception if the optimistic locking fails.&nbsp; Your UI catches it, says the entire operation has failed...<br><br>What to do next is up to you.&nbsp; You can't save anything because part of the transaction has failed (which is fine)... so you may have to close the form, or have the UI reload from the database, which of course would lose all user changes.<br><br>If the latter is unacceptable to you, perhaps you need to rethink your design, because at that point it would seem that your children can be edited independantly and they should really be root objects.<br><br>Of course you can do something more sophisticated, like rollback the transaction after finding ALL the collisions, load up a 'diff' object, then show the user the collisions and allow them to attempt a merge.&nbsp; Of course that will be a tough thing to code.. but no one said merging was easy.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dshafer replied on Tuesday, November 14, 2006</h2>Ok...Thanks for the feedback... Now I have at least enough information to present to the team on this topic.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
