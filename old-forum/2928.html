<html><header><title>Cleaning up stale collections in Web Scenario</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Cleaning up stale collections in Web Scenario</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2928.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav posted on Tuesday, May 22, 2007</h2><P>In a WebForm the GridView is populated by a collection furnished by&nbsp;CslaDataSource.&nbsp; Other than setting up the GridView's DataSourceId, I have no other handle to the Collection.&nbsp; When the user closes the form, can I assume that the collection will somehow be disposed off also - or should I maintain a separate handle to the collection and do the disposing myself?</P>
<P>Will appreciate some insight.</P>
<P>Jav</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 22, 2007</h2><P>Remember that ASP.NET is stateless. So the data is gone from the server after each page request, unless you explicitly put the object into Session, Application, Caching or a Shared/static field.</P>
<P>If you do put the object into Session, there's an automatic timeout (default is 20 mins). If the user doesn't hit your site in 20 mins that Session object, and all the data it contains, is flushed.</P>
<P>So in general, no, you don't need to do anything to clean up after a collection.</P>
<P>But then I see you use the word "dispose". That implies that your object is holding an expensive system resource (file handle, db connection, graphics object, etc). If that is actually the case I'd first ask whether you are sane, because you should avoid doing that sort of thing&nbsp;<img src="/emoticons/emotion-5.gif" alt="Wink [;)]" />&nbsp; But assuming you are sane, and have a good reason for holding an expensive resource, then <EM>yes, you absolutely MUST dispose of that type of object</EM>.</P>
<P>That type of object should <EM>never</EM> be put into Session, because you could end up holding the expensive resource for 20+ mins. That type of object should <EM>only</EM> be used within page scope (or preferably method scope) so you can dispose it as early as possible. Ideally you'd use it only within method scope, so you can use a using block.</P>
<P>But I strongly doubt that is your issue - I certainly hope not...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, May 22, 2007</h2><P>Jav,</P>
<P>If you plan to sort and page the data in the grid using the collection data then you have to put the collection into Session while the user is performing these actions. When they navigate away from the page with the grid you can remove the collection from Session as they no longer need it. The advantage to this scenario is that you only fetch the collection once from the DB and then re-use while the user does paging and sorting. (Other alternatives exist - like fetching only the current set of pages needed for display purposes and always querying the DB to get a different set of pages.) But I am talking about the case where you have all of the data in hand.</P>
<P>Some things to be careful of - the user may not use your page controls to Navigate away from the page with the grid. They could click the Back button or something. You can consider writing a method that runs on each request to RemoveCollectionsFromState. You keep only the collection for the "current page" the user is on and remove all others. ( I am assuming these are ROCs and that you name them consistently so your general method can find them and remove them.)</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jav replied on Tuesday, May 22, 2007</h2><P>Thanks Rocky, Thanks Joe,</P>
<P>Rocky, I was indeed using the word dispose in its English sense (as in throw away, get rid off, put in the trash) sense <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" />, as opposed to its Programming sense.&nbsp; The collection in question&nbsp;is instantiated within a method and attached to the GridView.</P>
<P>Joe, thanks for your suggestions.&nbsp; We used to have all those discussions in the old forum&nbsp;about how to design our objects, and I don't think I fully grasped Rocky's advice when he&nbsp;told us to design our objects to handle the job at hand instead of bloating them up to do ten things.&nbsp; Working in the web environment has finally given me an appreciation of what he was saying.&nbsp; I am actually beginning to enjoy&nbsp;trying to see how&nbsp;lean and mean I can make my classes.&nbsp;I know that you have been doing web development from the beginning and must be an expert at it.&nbsp; With ASP 2.0, it finally seems to be coming of age.</P>
<P>Jav</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
