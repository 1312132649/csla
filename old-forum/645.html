<html><header><title>Declaring child collection in a collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Declaring child collection in a collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/645.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 posted on Monday, July 17, 2006</h2><P>I have a 1.53 base BusinessBase object&nbsp;Project which has a collection of OrderNumbers. I want these Order#s to retrieve their header and&nbsp;details for display&nbsp;in a grid. The details are coming from our main frame so they&nbsp;must be read only collections.</P>
<P>So the end result is Project(BusinessBase) &gt; Order# (BizCollectionBase)&nbsp;&gt; OrderHeader(ReadOnlyCollectionBase) &gt; OrderDetail(ReadOnlyCollectionBase)</P>
<P>Do I declare the collection for the detail in OrderHeader as a private member in the class&nbsp;outside the struct? Does it get populated by a datareader or with its own GetMethod then lock the Header list?</P>
<P>Sorry, I couldn't find an example. Here's my retrieval into the struct right now:<BR><FONT color=#0000ff size=2>using</FONT><FONT size=2> (SafeDataReader dr = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> SafeDataReader(cm.ExecuteReader()))<BR>{<BR>&nbsp; &nbsp;&nbsp; locked = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp; while</FONT><FONT size=2>(dr.Read())<BR>&nbsp;&nbsp;&nbsp; {<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT>SOInfo info = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> SOInfo();<BR><FONT color=#0000ff>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; </FONT>info.ShipTo = dr.GetDecimal(0);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </FONT>info.BillTo=dr.GetDecimal(1);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</FONT>info.Type = dr.GetString(2);<BR><FONT color=#0000ff>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; </FONT>info.PONbr = dr.GetString(3);<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </FONT>List.Add(info);<BR>&nbsp;&nbsp;&nbsp;&nbsp; }<BR>//dr.NextResult() here?<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp; </FONT>locked = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<BR>}</P></FONT>
<P>_E<FONT size=2><BR></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vargasbo replied on Monday, July 17, 2006</h2>

<p class="MsoNormal">Hmmm, how you design your classes will depend on the behavior
youâ€™re looking. In my case, I only go down one depth in my graph. So I would
load Project and Order, just like you have it now and not thee two other child
collections.<br>
<br>
The order object, it's what rocky calls a switchable object, meaning that you
need it to act like a root sometimes and a child another time depending on
who's calling it. In your order class, create a property and lazy load the
order header &amp; order details when this (order) class is acting as a child,
when it's acting as a root, you'll just load one depth below it graph tree.<br>
<br>
Hope that helps, if not, I can send you some code snippets.<br>
<br>
Regards,<br>
~Bo</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Monday, July 17, 2006</h2><P>Thanks for the reply ~Bo. The behavior. Hmm. That's a novella, but at the last, it is not switchable. It will never be a root object by internal law (SarBox constraints).&nbsp;I've used GreatGrandChildren in my stuff before, but this is just not behaving and I know I've seen this done.&nbsp;I just&nbsp;can't find the source.</P>
<P>I'm thinking a ROBusiness base would be better. I can build the detail collections inside those ROB objects&nbsp;and&nbsp;retrieve the children (or lazily). That's pretty much what's left over when the struct is removed from the ROCollectionBase. I haven't, but I think I can use ROBase.</P>
<P>See the Users can fill in some order number, but the details are not available until the following day. I think my ROBase idea may be better and lazy load the info. If the object IsNew, there's not use going to the db and I can use a creation date to determine if the data is available. There's a 24 hour delay. It's the situation I have, unfortunately. I'm thinkin that 24 hr delay would be a problem, too. What if they just forgot to enter it? Then it should actually be available. Guess I'll let the object try to load it and include a "failed date field" to prevent multiple hits to the server in the same 24 hr period.</P>
<P>What a kludge.</P>
<P>_E</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 17, 2006</h2><P>The short answer is that a collection can't directly contain a collection. You need an intermediate object to represent the child, and then that child can have a collection of children itself.</P><PRE><P>Project(BB)<BR>&nbsp; -&gt;OrderNumbers(BCB)<BR>&nbsp;&nbsp;&nbsp; -&gt;OrderHeader(ROB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;OrderDetails(ROCB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;OrderDetail(ROB)</P></PRE>
<P>Notice how I've added OrderHeader as an object in the middle here. Even if all it does is contain the collection, that's required.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>esteban404 replied on Monday, July 17, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> 
<P>The short answer is that a collection can't directly contain a collection. You need an intermediate object to represent the child, and then that child can have a collection of children itself.</P><PRE><P>Project(BB)<BR>&nbsp; -&gt;OrderNumbers(BCB)<BR>&nbsp;&nbsp;&nbsp; -&gt;OrderHeader(ROB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;OrderDetails(ROCB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;OrderDetail(ROB)</P></PRE>
<P>Notice how I've added OrderHeader as an object in the middle here. Even if all it does is contain the collection, that's required.</P>
<P></div></BLOCKQUOTE></P>
<P>Thanks, Rocky. I did something slightly different on the car ride back. I'll review it against your suggestion, but i think my intermediate object is the header object.</P>
<P>What&nbsp;I created is&nbsp;a base collection of header items&nbsp;so they can be added/edited/deleted from the Project. They use BB and BCB. In the BB header item, I used a ROC object for property lazy loading. We'll check it for best fit tomorrow.</P>
<P>The data I'm reading in is odd in that&nbsp;it's not normalized, I don't know why they store it like that, but that's what I discovered was there. I'm glad it is presentable now. I showed the prototype to the Sales Manager. She noted they used to enter data into about 15 fields for this piece of the&nbsp;process. CSLA has reduced it to about 1 or 2.</P>
<P>Happy campers indeed!</P>
<P>_E</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
