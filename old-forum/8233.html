<html><header><title>Developing a Business Object to Represent a Hierarchical Organization Structure.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Developing a Business Object to Represent a Hierarchical Organization Structure.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8233.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf posted on Wednesday, December 30, 2009</h2>I have to design a class, set of classes or Business Object to represent a Hierarchical Organization Structure (Tree-Like or Composite Structure).<br /><br />The Org. Struct of the company looks like the following:<br /><br />- Root<br />  - Complex<br />    - Departments<br />      - Divisions<br /><br /><br />The structure is stored in a very flat and simple table (only one table) which has 3 fields, something like:<br /><br />- OrgCode,<br />- ShortName,<br />- LongName.<br /><br />Where OrgCode is a string of fixed char length, divided in virtual segments, where each segment represent the code and the level (Depth).<br /><br />For example, the code:<br /><br />OrgCode = 0100305<br /><br />Is actually "01-003-05",<br /><br />where 01 is Operations Complex, 003 is Finance Department, and 05 is Customer Payments Division.<br /><br />The table is stored in Adabas/Unix Platform, and I can have read-only access to the table via OLE/ADO.NET or ODBC.<br /><br />I want to build a recursive structure using a Business Object to represent such Organization Hierarchy.<br /><br />I did some search, and found this website which describe a method for building composite objects:<br /><br />http://www.dofactory.com/patterns/patterncomposite.aspx#_self1<br /><br />Finally, I must wrap the completed Business Object Interfaces with a Web Service, so that such functionality could be access from nearly any front-end such as MS-Access, IE, Adobe LiveCycle PDF Forms, and/or Lotus Notes.<br /><br />I want to implement this project using CSLA approach.<br /><br />Appreciate your help and recommendations.<br /><br />Tarek.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 30, 2009</h2><P>I've implemented a composite pattern using Csla.&nbsp; It requires you to do some work that Csla would normally do, because you're really combining a BB with a BLB in a single class.&nbsp; It seems to work though, although the cavet is that I implemented this prior to Managed Properties / Fields, and I have yet to try to convert them.&nbsp; So everything is private backing.</P>
<P>My abstract base class inherits the normal generic BB.&nbsp; I've also impelemented the generic IEnumerable interface, Csla.Core.IParent, ICustomTypeDescriptor.&nbsp; You also need to track children and deletedChildren yourself, since you're inheriting BB (I just used an IList[T]) in your Node subclass.</P>
<P>In the Leaf subclass, I overrode all the child related methods (Add, Remove, ChildCount, etc) and simply call the base (which throws a NotSupportedException).&nbsp; I did this because I sealed those methods at the leaf level, so that leaf subclasses cannot override them, and it also removes them from Intellisense.&nbsp; </P>
<P>In the Node class, I have a private class which subclasses BindingList.&nbsp; The only need is to create a method which is decorated with an OnDeserialized attribute.&nbsp; You then loop through the collection and call base.SetItem for each item.&nbsp; This is one of the things Csla does for you I think.</P>
<P>That's the grand overview... but it does seem workable.&nbsp; I even have a Node subclass which take the heirarchy and flattens it for use in a DataGrid.&nbsp; </P>
<P>Design everything property, and your UIs should all be able to use the same BOs (assuming they have the same use cases, just different methods of accessing the business logic.</P>
<P>HTH</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Wednesday, December 30, 2009</h2>Hi Andy,<br><br>Thank you for your feedback. However, I feel I am a bit lost, or actually totally lost.<br><br>It sounds a lot of work to make it CSLA Compliant, right ?<br><br>I don't want to shoot myself in the foot, just to apply CSLA by force ?<br><br>Would you mind give me a samle code to show me how to make the following classes CSLA Compliant : <br><br>- Component,<br>- Composite, <br>- Leaf Node, and <br>- Child Nodes...<br><br>I need to see if it worth the effort to apply CSLA here, and what is the added value ?<br><br>Appreciate your feedback.<br><br>Tarek.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 31, 2009</h2><P>Actually most of the work is in implementing collection related functionality, since your abstract base class inherits BusinessBase, which is not a Csla collection type.&nbsp; Most of the composite patterns I've seen show Java code, and its the same there; you're not starting with a collection subtype, just a plain object.&nbsp; When I implemented it, I was using the Head First Design Patterns book as a guide.</P>
<P>You'd want to use Csla if the following are true (or most of them are):</P>
<P>Your use cases are the same in all your front ends, so you want a central business library.</P>
<P>You want a consistent way to build your business&nbsp;layers for applications.</P>
<P>You want to be able to replace the database backend or design with out changing your business rules and their UIs (in Csla you'd update the code in the DataPortal_xyz methods, and that would likely be all you need to do).</P>
<P>You need to be able to switch between two-tier and three-tier deployments easily.</P>
<P>It sounds like some of these might be true for you.&nbsp; In your case, you mention a web service and an IE front end (so I assume you'd use Asp.net).&nbsp; If the use cases are the same for both of those, your web service could use your&nbsp;csla based&nbsp;library, and your Asp.Net page would likely use the csla based library directly (there's little value in using a web service if you have control of everything).</P>
<P>HTH</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Thursday, December 31, 2009</h2>Thank again, Andy.<br><br>Is it possible that you give me sample code how to implement BB and BLB for the related composite design pattern ?<br><br>Thanks.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Sunday, January 03, 2010</h2>I found this article which shows how to implement composite patterns using ASP.NET (VB):<br /><br />http://wiki.asp.net/page.aspx/359/composite/<br /><br />I think this will make it easier to use CSLA since it does not user Abstract Classes. It uses Interfaces instead.<br /><br />Tarek.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Sunday, January 03, 2010</h2>I did some testing, and I realized that I really do not need to use Interfaces nor Abstract classes. They are just making the situaiton complex.<br /><br />I used the following model which is working fine:<br /><br />Public Class OrgComponentList(Of MyType)<br />    Inherits List(Of MyType)<br /><br />End Class<br /><br />    Public Class OrgNode2<br /><br />        Protected mOrgLevel As Integer<br />        Protected mOrgFlatCode As String<br />        Protected mOrgUnitCode As String<br />        Protected mOrgUnitDescEng As String<br />        Protected mOrgUnitDescArb As String<br />        Private mOrgNodeChildren As New OrgComponentList(Of OrgNode2)()<br /><br /><br />        Public ReadOnly Property OrgFlatCode() As String<br />            Get<br />                Return mOrgFlatCode<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property OrgLevel() As Integer<br />            Get<br />                Return mOrgLevel<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property OrgUnitCode() As String<br />            Get<br />                Return mOrgUnitCode<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property OrgUnitDescArb() As String<br />            Get<br />                Return mOrgUnitDescArb<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property OrgUnitDescEng() As String<br />            Get<br />                Return mOrgUnitDescEng<br />            End Get<br />        End Property<br /><br />        Public Sub New(ByVal OrgUnitDescEng As String)<br />            mOrgUnitDescEng = OrgUnitDescEng<br />        End Sub<br /><br />        Public Overridable Sub Add(ByVal c As OrgNode2)<br />            mOrgNodeChildren.Add(c)<br />        End Sub<br /><br />        Public Overridable Sub Remove(ByVal c As OrgNode2)<br />            mOrgNodeChildren.Remove(c)<br />        End Sub<br /><br />        Public Overridable Sub Display(ByVal depth As Integer)<br />            Console.WriteLine(New [String]("-"c, depth) + mOrgUnitDescEng)<br />            ' Recursively display child nodes<br />            For Each component As OrgNode2 In mOrgNodeChildren<br />                component.Display(depth + 2)<br />            Next<br />        End Sub<br /><br />    End Class<br /><br /><br />    Public Class OrgNodeLeaf2<br />        Inherits OrgNode2<br /><br />        ' Constructor<br />        Public Sub New(ByVal OrgUnitDescEng As String)<br />            MyBase.New(OrgUnitDescEng)<br />        End Sub<br /><br />        Public Overloads Overrides Sub Add(ByVal c As OrgNode2)<br />            Console.WriteLine("Cannot add to a leaf")<br />        End Sub<br /><br />        Public Overloads Overrides Sub Remove(ByVal c As OrgNode2)<br />            Console.WriteLine("Cannot remove from a leaf")<br />        End Sub<br /><br />        Public Overloads Overrides Sub Display(ByVal depth As Integer)<br />            Console.WriteLine(New [String]("-"c, depth) + mOrgUnitDescEng)<br />        End Sub<br /><br />    End Class<br /><br />In other words, the Composite Node is a normal class, which has everything. The Leaf Node, is inherited from the Composit Node, and it will overried some methods of the parent class. I think this approach will allow me to convert this model into CSLA more easily.<br /><br />I have done a test using console application and it works.<br /><br />Now the question is:<br /><br />- What I will loose if I do not use Abstract Classes nor Interfaces ?<br /><br />- Do you think this will make it easier to apply CSLA Model ?<br /><br />Tarek.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 05, 2010</h2><P>The abstract just lets you define some points where you force subclasses to implement something, if there's no sane default.&nbsp; Don't think you'd lose anything by not having one, but it can be a clue that the class is incomplete on its own (which your ultimate superclass will be, since its neither a node nor a leaf).</P>
<P>The interfaces I mentioned, some might be required, some might be handy (its been a while since I did the implementation).</P>
<P>IParent from Csla, I have an impelementation for RemoveChild, which I believe is required in some cases (at least, I likely implemented it for a reason, becaues I didn't implement ApplyChildEdit, that method just does nothing).</P>
<P>IEnumerable I would think is important, since composites usually mean you need to move through the collection some how.&nbsp; In this case, using some kind of tree traversal.&nbsp; Also, it lets you use the foreach construct.&nbsp; Also, don't forget about Linq, which only works on types which impelement IEnumerable.</P>
<P>ICustomTypeDescriptor I had to implement, or things won't work correctly, such as wrong values in databinding, and some other weirdness.&nbsp; I don't recall the exact problems, but without it things just wouldn't work.&nbsp; You'll have to reimplement this in subclasses too if you add properties which aren't on the base class (which I have for some special case line items used or reporting).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Wednesday, January 13, 2010</h2><P>I've completed the development of the CSLA BO and Web Services. Its really cool to do such a job.</P>
<P>I am thinking to share the code, if anyone is interested.</P>
<P>I now fully understand the&nbsp;Abstract Classes, the relation to the Composite Model, and how to implement CSLA approach in the Business Logic and Web Service Layers.</P>
<P>Tarek.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, January 13, 2010</h2><P>Hi,</P>
<P>I'd be curious to see the higher level&nbsp;solution you came up with.&nbsp; Did you end up using abstracts and / or implementing some of those interfaces?</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>james phe replied on Wednesday, January 13, 2010</h2><P>I'm very interested in your implement,please&nbsp;share your code to me.</P>
<P>my email is <A href="mailto:james_phe@126.com">james_phe@126.com</A></P>
<P>Thanks!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>larmister replied on Thursday, January 21, 2010</h2>I too am interested in how you implemented your solution using CSLA approach.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Thursday, January 21, 2010</h2><P>I am glad you are all interested.</P>
<P>I just finished Umbraco Level 1 Certification in the UK. I will post the details in within a couple of days.</P>
<P>Tarek.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tarekahf replied on Sunday, January 24, 2010</h2><P>I have attached the class and the web service code I developed. Also, I added the code I used in MS Access 2003 to consume the web service. And here is a snapshot of MS Access:</P><IMG src="http://lh6.ggpht.com/_Qhe6s0HOP8U/S1wDjJCtJ5I/AAAAAAAAAtI/DUvP8cueqFM/s800/GovRelSnapshot1.JPG"> 
<P>Hope it will be of value to you.</P>
<P>&nbsp;</P>
<P>Tarek.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
