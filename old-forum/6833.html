<html><header><title>DataGridView automatic sorting with LINQ</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataGridView automatic sorting with LINQ</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6833.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael posted on Tuesday, April 21, 2009</h2><font size="2"><font face="Arial">I know there are other posts around this topic, so my apologies for bringing it up again, but I can't work out how to get a DataGridView to sort using LINQ. The ProjectTracker is now using LINQ instead of SortedBindingList, but none of the grids are sortable by clicking the column headers. Wasn't that one of the main reasons for SortedBindingList?<br><br>My code is something like:</font><br><br></font><font size="2" face="Courier New"><font color="#0000ff">var </font>myBLB = <font color="#0000ff">MyBLB</font>.GetMyBLB();<br>bindingSource.DataSource = <font color="#0000ff">from </font>m <font color="#0000ff">in </font>myBLB <font color="#0000ff">orderby </font>m.Name <font color="#0000ff">select </font>m;</font><font size="2"><br><font face="Arial"><br>Thanks<br>Michael</font></font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Wednesday, April 22, 2009</h2>There are two kinds of LINQ queries.<br />1. Those where you know the sort and filter fields at compile time.<br /><br />2. This where you discover the sort and filter fields at run time.<br /><br />Most people think of LINQ as #1 above. In fact your code sample does too. <br /><br />But your code sample will not work at run time with clicking column names of a grid because the sort field name changes depending on which column you clicked.<br /><br />The advice is to implement the Microsoft Dynamic Query Library in one of your Utility classes. Then you can pass String values as sort field name and sort direction and it will "compile" them into LINQ expressions and use them dynamically.<br /><br />I have posted on this topic before - see if you can read some of the older posts for further tips.<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Friday, April 24, 2009</h2><font size="2" face="Arial">Thanks for your reply, Joe.<br><br>I have downloaded and included the static class DynamicQueryable (Dynamic.cs in the Microsoft LINQ samples), and added a ToList extension method as you suggested:<br><br></font><font color="#0000ff" size="2" face="Courier New">public static</font><font size="2" face="Courier New"> <font color="#800080">IList </font>ToList(</font><font color="#0000ff" size="2" face="Courier New">this <font color="#800080">IQueryable </font></font><font size="2" face="Courier New">query)<br>{<br>&nbsp; </font><font color="#0000ff" size="2" face="Courier New">return </font><font size="2" face="Courier New">(<font color="#800080">IList</font>)</font><font color="#000080" size="2" face="Courier New">Activator</font><font size="2" face="Courier New">.CreateInstance(</font><font color="#0000ff" size="2" face="Courier New">typeof</font><font size="2" face="Courier New">(</font><font color="#000080" size="2" face="Courier New">List</font><font size="2" face="Arial"><font face="Courier New">&lt;&gt;).MakeGenericType(query.ElementType), query);<br>}</font><br><br>But this is as far as I've gotten (my VB skills are sorely lacking). What's the recommended way to implement DataGridView column-header-click sorting from here?<br><br>Thanks again<br>Michael</font><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, April 24, 2009</h2>Here is one way:<br /><br />At the page level:<br />  Private mSortedList As System.Linq.IQueryable<br />  Private mSortDirection As ListSortDirection<br />  Private mSortExpr As String<br /><br />In a doDataBind Sub:<br />  mSortedList = mSomeList.AsQueryable.OrderBy(mSortExpr &amp; " " &amp; mSortDirection.ToString)<br />    dg.DataSource = mSortedList.ToList<br />    DataBind()<br /><br />Then in <br /> Private Sub dg_SortCommand(ByVal source As System.Object, ByVal e As System.Web.UI.WebControls.DataGridSortCommandEventArgs) Handles dg.SortCommand<br />    'assign the clicked sort expression to this variable so we can compare it to the previous sort value in Viewstate (or Session)<br /><br />    strGridSortExpression = e.SortExpression<br /><br />    'if user clicks same header then reverse the sort direction<br />    If String.Compare(mSortExpr, strGridSortExpression, True) = 0 Then<br />      If mSortDirection = ListSortDirection.Ascending Then<br />        mSortDirection = ListSortDirection.Descending<br />      Else<br />        mSortDirection = ListSortDirection.Ascending<br />      End If<br />    Else<br />      'user clicked a different header so start the sort as ASC<br />      mSortDirection = ListSortDirection.Ascending<br />    End If<br /><br />    mSortExpr = strGridSortExpression<br /><br />    doDataBind()<br />  End Sub<br /><br />You have to define a way to store the sort expr and direction values. (Session, Viewstae, some BO in Session, etc.)<br /><br />HTH<br />Joe<br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
