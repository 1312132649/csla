<html><header><title>Asynchronous Recursion And Headaches Ohh My!</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Asynchronous Recursion And Headaches Ohh My!</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8078.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux posted on Wednesday, December 02, 2009</h2><P>Well, we've got ourselves into a bit of a pickle. We have written a set of business objects that represent a generic hierarchy. The hierarchyNodes implement an interface that requires a CloneNode ability.</P>
<P>Now, in the Silverlight world we find ourselves needing this method to be asynchronous and that is proving quite difficult to implement.</P>
<P>Basically we would have a root node with n children each of which can also have n children and so on.</P>
<P>Calling myNode.CloneAsync should then do what is necessary to clone everything below it. However, I haven't figured out the proper syntax for what I need so far.<BR><BR>Here is my current code if anyone would like to lend a helping brain. I know the code below doesn't work, it's a work in progress. What I'm wondering is if this is even the correct approach to the problem at hand. Has anyone crossed this bridge? And if so, what car did you drive?</P>
<P>Thanks,<BR>Will (code below)</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>void</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IHierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;.CloneNodeAsync(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> iteratively, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;T&gt;&gt; handler)<BR>{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Clone this node<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloneNodeAsync((o, e) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (iteratively)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloneNodeChildrenAsync(e.Object.HierarchyNodeID, (o1, e1) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>}<BR><BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2></P>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CloneNodeAsync(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;&gt;&gt; handler)<BR>{<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt; clonedHierarchyNode;<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;.NewHierarchyNode((o, e) =&gt;<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode = e.Object;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode.BeginDateUTC = BeginDateUTC;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode.EndDateUTC = EndDateUTC;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode.ParentHierarchyNodeID = ParentHierarchyNodeID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.Invoke(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;&gt;(clonedHierarchyNode, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>));<BR>&nbsp;&nbsp;&nbsp;});<BR>}<BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2><BR>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CloneNodeAsync(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> parentHierarchyNodeID, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> iteratively, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;T&gt;&gt; handler)<BR>{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;//Clone this node but make it's parentNodeID the value passed to the function.<BR></FONT></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt; clonedHierarchyNode;<BR>&nbsp;&nbsp;&nbsp;CloneNodeAsync((o, e) =&gt;<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;)e.Object;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNode.ParentHierarchyNodeID = parentHierarchyNodeID;<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (iteratively)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloneNodeChildrenAsync(clonedHierarchyNode.HierarchyNodeID, (o1, e1) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;});<BR>}<BR><BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2></P>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CloneNodeChildrenAsync(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> newHierarchyNodeParentID, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNodeList</FONT></FONT><FONT size=2>&lt;T&gt;&gt;&gt; handler)<BR>{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;//Clone all children but use the id of the node passed in as the parentID<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;System.Collections.Generic.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>List</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;&gt; list = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp; System.Collections.Generic.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>List</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;&gt;();</P>
<P></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;HierarchyNodeList</FONT></FONT><FONT size=2>&lt;T&gt; childHierarchyNodeList;<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;HierarchyNodeList</FONT></FONT><FONT size=2>&lt;T&gt;.GetByParentHierarchyNodeID(HierarchyNodeID, (o, e) =&gt;<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;childHierarchyNodeList = e.Object;<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (childHierarchyNodeList.Count &gt; 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for</FONT></FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2> i = 0; i &lt; childHierarchyNodeList.Count; i++)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt; hierarchyNodeChild = childHierarchyNodeList<img src="/emoticons/emotion-55.gif" alt="Idea [I]" />;<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt; clonedHierarchyNodeChild;<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HierarchyNode</FONT></FONT><FONT size=2>&lt;T&gt;.NewHierarchyNode((o1, e1) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNodeChild = e1.Object;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNodeChild.BeginDateUTC = hierarchyNodeChild.BeginDateUTC;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNodeChild.EndDateUTC = hierarchyNodeChild.EndDateUTC;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNodeChild.ParentHierarchyNodeID = newHierarchyNodeParentID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedHierarchyNodeChild.BeginSave((o2, e2) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hierarchyNodeChild.CloneNodeChildrenAsync(clonedHierarchyNodeChild.HierarchyNodeID, (o3, e3) =&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.Invoke(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>HierarchyNodeList</FONT></FONT><FONT size=2>&lt;T&gt;&gt;(e.Object, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;});<BR>}</P></FONT></FONT></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
