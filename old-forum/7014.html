<html><header><title>Handling Authorization Rules</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Handling Authorization Rules</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7014.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>NickTaylor posted on Thursday, May 28, 2009</h2><P>Hi, </P>
<P>I wonder if anyone can help me with this please...?</P>
<P>I have just started implementing Authorization rules within my windows forms application. Its very simple at present, and for the purposes of experimentation I want to prevent a user from changing the contents of a textbox.</P>
<P>Within my BO I have overriden the AddAuthorizationRules() method and make a call to AuthorizationRules.AllowWrite on the appropriate field. Within the property definition I have also added the call to CanWriteProperty(true) within the set accessor. I understand that this will throw an exception when any user interaction takes place on the specified field.</P>
<P>When I run the form, any user interaction with that field fires the exception and in turn the form then displays the appropriate warning icon via the error provider. In short, this does exactly what I want it to do.</P>
<P>However....</P>
<P>I then can't tab off the field and the form is in effect stuck. So my question is how do I handle this within the UI ?? I deally I just want to revert the data for this field back to its clean state.</P>
<P>Can anyone off some suggestions / best practice advice as to how I should handle this...?</P>
<P>Thanks,</P>
<P>Nick</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, May 28, 2009</h2><P>This is Windows Forms?</P>
<P>You should consider changing the UI control to read-only, or disabling it, if the user is not allowed to change the value. This does two things: it avoids the issue you are seeing, and it gives the user a proactive visual cue that they can't change the value.</P>
<P>There's a control in Csla.Windows that helps you do this for all detail controls (not grids or lists) on your form - the ReadWriteAuthorization control.</P>
<P>If you have the <EM>Expert 2005 Business Objects</EM> book the control is covered in the Windows Forms chapter. If not, you should look at the PTWin project in the ProjectTracker reference app to see how it is used.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>NickTaylor replied on Thursday, May 28, 2009</h2><P>Hi Rocky,</P>
<P>Yes, its WinForms. And yes, I have your book, and very good it is too. :o)</P>
<P>So far I have found the CSLA framework excellent, but as I'm migrating an internal application from Visual Foxpro, the learning curve associated with the move to dotnet&nbsp;is steep!! Having said that I would not go back now as its far superior!!</P>
<P>Thanks for the advice, I will take a look at the ReadWriteAuthorization in more detail.</P>
<P>Cheers,</P>
<P>Nick</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, May 28, 2009</h2><P>Are you using Winforms or WPF? Ideally, you may want to disable fields that are not editable using the ReadWriteAuthorization control (Winforms) or equivalent (for WPF), otherwise you will have to handle the Validate events or play with the CanWriteProperty overloads (I noticed you skipped the property name - if this is the overload you use you should refactor). Setting the value back to the original one, well have a read here first: <A href="http://www.lhotka.net/weblog/WPF40DataBindingFix.aspx">http://www.lhotka.net/weblog/WPF40DataBindingFix.aspx</A></P>
<P>Also you may want to check this out: <A HREF="/forums/thread/24888.aspx">http://forums.lhotka.net/forums/thread/24888.aspx</A>&nbsp;I used that a couple of times when I had form elements the user should not be able to edit as enabled but it is a slight variation to the existing way of declaring properties...</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
