<html><header><title>How to remove a child completely from a collection?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to remove a child completely from a collection?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8640.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames posted on Wednesday, March 10, 2010</h2><p>Hello,</p>
<p>Is there any way to remove a child completely from a collection, without moving the child to the deleted list?</p>
<p>Thanks,</p>
<p>Jimmy</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, March 10, 2010</h2><p>You can do so; something like this was asked recently because the poster wanted to move the child from one collection to another.&nbsp; See <a href="http://forums.lhotka.net/forums/t/8574.aspx">this thread</a>.&nbsp; </p>
<p>Out of curiosity though, why are you looking to do this?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames replied on Wednesday, March 10, 2010</h2><p>Thanks for the link, I think I can use the directions there.</p>
<p>In my application (click once win form) when I&#39;m saving, I create a new collection with the children that can be saved. I save the collection with the cloned&nbsp;children and then put the saved children back into the original list. This works very good :)</p>
<p>I do&nbsp;it to avoid sending the whole collection (could contain 1000 children) back over the wire when only updating 1-3 children. I&#39;m saving the changed children on every row change.</p>
<p>Okay, the reson for removing childring was a test, where I would see if the child was updated on the server by another user, before trying to update it. If it was changed, I would not save it (and remove it from the collection of children to be saved) and notify the user that it was updated by someone else.</p>
<p>I hope the above ramblings made sense :)</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, March 10, 2010</h2><p>That&#39;s a different problem then. You should look at the Csla.DiffGram sample in the Samples download (cslanet\cs folder), which illustrates how to do diffgram updates of a list - so the list isn&#39;t sent to the server for insert/update operations, but instead only changed items are sent over.</p>
<p>I don&#39;t remember if I made the sample do delete operations or not - but you can check. The same basic principle should apply.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Wednesday, March 10, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>
<p>That&#39;s a different problem then. You should look at the Csla.DiffGram sample in the Samples download (cslanet\cs folder), which illustrates how to do diffgram updates of a list - so the list isn&#39;t sent to the server for insert/update operations, but instead only changed items are sent over.
<div style="CLEAR:both;"></div>
</div></p>
<p>Does this work even when said list is a child of another object? (Sounds like a very neat trick if it does... :)</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, March 10, 2010</h2><p>It absolutely works when the list is a child of another object.</p>
<p>The idea is simple, though the actual implementation isn&#39;t always simple.</p>
<p>The idea is to build a diffgram that contains all the data necessary for some server-side code to do insert/update/delete operations on some of your objects. All without ever sending the objects over the wire - just the minimum data needed.</p>
<p>The sample implements a visitor pattern, so every object in your object graph is visited and is asked whether it needs to send any data to the server as part of the diffgram. If so, the object gets to send whatever field values it wants to provide. If not, the object is not included in the diffgram at all.</p>
<p>The sample has an order with line items. The idea is to edit the line items and click save. The diffgram ends up containing the order id (foreign key) and the fields from each child object in the collection that&#39;s been changed. Oh, and of course the collection itself is represented in the diffgram, because something needs to contain the child objects.</p>
<p>The hard part isn&#39;t in the sample (because I needed to leave <i>something</i> as an exercise for the reader <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" />) - which is to take the bits and pieces of data that are in the diffgram and translate that into actual database updates. That&#39;s done in a command object, and of course could be quite complex (or simple) depending on how complex your object model and/or database might be.</p>
<p>The server-side code in the command object can update the diffgram too, and the diffgram comes back across to the client and is merged back into the objects - again by using the visitor pattern - asking each object in the graph if it wants its data back (so to speak).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, March 10, 2010</h2><p>I suppose - to sum up - this diffgram technique is great for the case where you have thousands of objects in an object graph, and only a few of them are changed.</p>
<p>If you have just a few objects - a couple dozen or something - in your object graph I think you&#39;d have a hard time justifying the complexity and losing the mobile object benefits.</p>
<p>Generally, I&#39;d recommend doing a standard mobile object implementation, and only incurring the complexity of using a diffgram if you hit perf issues.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames replied on Thursday, March 11, 2010</h2><p>Another problem was&nbsp;pushing the returned child object(s) into the binded list in the UI&nbsp;(when saving async) - The edit level would go out of sync and the application would break. But what I realized from the diffgram idea, is to only update Version (the timestamp) for each saved child object.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, March 11, 2010</h2><p>Yes, the diffgram results come back to the client and are merged into the existing object instances, so things like edit level are typically unaffected.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, March 11, 2010</h2><p>The diffgram sounds (very) interesting, but I have some cases now where I cascade changes to child objects from the root as part of the server side update. So, at the time of the Save() call, only the root is dirty, but then server side some of the child objects may end up being changed.</p>
<p>This is a specific case that I could probably figure out how to handle, &nbsp;but in general the problem is that many of the existing DataPortal_Update implementations were written with assumption that the entire object graph was available. So, it seems like with the diffgram approach you don&#39;t have as much knowledge server-side as you did before. This is probably not an issue 90%+ of the time, but it&#39;s something to consider.&nbsp; </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
