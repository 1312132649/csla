<html><header><title>Some changes I've made to CSLA</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Some changes I've made to CSLA</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7161.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux posted on Wednesday, June 24, 2009</h2><P>Hey guys. Below are a few changes that have been made to Csla to accomodate things we need to do. I'm looking for advice on maybe better ways to do this as well as insight on whether any of these changes might because unexpected side-effects.</P>
<P>1) Added FetchFailedException : Exception to the Csla library. We throw this whenever we try to get an object that doesn't exist. For our team this was the chosen method as opposed to returning a new object.</P>
<P>2) Added ICslaParent which exposes a single ParentId read only property. All parent objects implement this interface. This aids us in code generation because it's then very easy to get the proper ID column for the parent object during inserts and fetches.</P>
<P>3) Allowing nullable types. As far as Csla is concerned we've only added a set of validation rules we call NullableValidationRules and we've implemented them (for int and decimal) this way:<FONT size=2></P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>bool</FONT></FONT><FONT size=2> NullableIntMaxValue&lt;T&gt;(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>object</FONT></FONT><FONT size=2> target, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>RuleArgs</FONT></FONT><FONT size=2> e) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>where</FONT></FONT><FONT size=2> T : </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>struct<BR></FONT></FONT><FONT size=2>{<BR>&nbsp;&nbsp; e.Severity = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>RuleSeverity</FONT></FONT><FONT size=2>.Error;<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp; int</FONT></FONT><FONT size=2> max = ((</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CommonRules</FONT></FONT><FONT size=2>.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MaxValueRuleArgs</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2>&gt;)e).MaxValue;<BR>&nbsp;&nbsp; T? value = (T?)</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Utilities</FONT></FONT><FONT size=2>.CallByName(target, e.PropertyName, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CallType</FONT></FONT><FONT size=2>.Get);<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp; if</FONT></FONT><FONT size=2> (value.HasValue &amp;&amp; </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Convert</FONT></FONT><FONT size=2>.ToDecimal(value.Value) &gt; max)<BR>&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>String</FONT></FONT><FONT size=2>.Format(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"{0} must be less than or equal to {1}"</FONT></FONT><FONT size=2>,<BR></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RuleArgs</FONT></FONT><FONT size=2>.GetPropertyName(e), max.ToString());<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>false</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp; }<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp; return</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>true</FONT></FONT><FONT size=2>;<BR>}</FONT></P>
<P><FONT size=2><FONT size=3>So, do you guys see any "gotchas" with doing this. And if not, is this something we could get included in Csla? It's becoming a bit of a mess for us to manage the various versions of Csla we are using. We are using 3.6.1 I think in our production environment but are moving to the latest and starting with CslaLight for a Silverlight application.</FONT></FONT></P>
<P><FONT size=2><FONT size=3>Also, we have to investigate any breaking changes between 3.6.1 and the latest. The way our servers are managed we're only allowed to have one version of Csla in production (which drives me a bit bonkers at times).<BR><BR>Thanks,<BR>Will</FONT></FONT><FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Wednesday, June 24, 2009</h2><P>Why change CSLA? Create a base library which can be shared in all projects. In there add the FetchFailedException class (1) and nullable rules (3) and also create base classes that inherit from BusinessBase&lt;T&gt; etc (as discussed multiple times in other threads).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>wjcomeaux replied on Wednesday, June 24, 2009</h2><P>Well, the support for the nullable type validation rules seemed to fall inline with other validation rules. Use them if you want to. So I thought including them directly to csla might be an option.</P>
<P>For the other two topics I guess you're right. </P>
<P>Thanks,<BR>Will</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 24, 2009</h2><P>I'm sure CommonRules could be expanded to have many rules, but I don't have time to do that or to maintain a big rule library.</P>
<P>I had hopes that the CSLAcontrib project would end up containing a library of rule methods to share, but that's never really materialized.</P>
<P>So I see three options for you</P>
<OL>
<LI>Create your own library of rules (outside CSLA - this seems like a poor reason to create a custom version of CSLA)</LI>
<LI>Become a contributor to CSLAcontrib and create a library of rules - possibly eclipsing CommonRules (which would be fine with me)</LI>
<LI>Become a contributor to CSLA .NET itself and add the rules to CommonRules - which is fine with me as long as you are willing to maintain them into the future</LI></OL>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
