<html><header><title>What do you do when no records returned in Fetch, error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>What do you do when no records returned in Fetch, error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1251.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ltgrady posted on Monday, September 18, 2006</h2><P><FONT face=Arial>Using vs1.5.&nbsp; The object retrieves records based on the User's ID.&nbsp; So I pass that in and call the sproc in the object's Fetch.&nbsp; But some Users don't have this information.&nbsp; So in my page code I want to check if/null&nbsp;on something.</FONT></P>
<P><FONT face=Arial>When I run my object the dr.read() causes:</FONT></P>
<P><FONT face=Arial>Invalid attempt to read when no data is present</FONT></P>
<P><FONT face=Arial></FONT>&nbsp;</P>
<P><FONT face=Arial>Obviously I can just do a dr.recordsaffected = -1 and skip the dr.read section.&nbsp; However, what do you normally do&nbsp;with the object? Set the values to null?&nbsp; Somehow set the object to null?&nbsp; Is there any standard CSLA practice people are using?</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Monday, September 18, 2006</h2><P>I am not using version 1.5 but I use the following line to ensure I don't run into this situation.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>while</FONT><FONT size=2> (dr.Read())<BR>{<BR></FONT><FONT size=2><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Add(</FONT><FONT color=#008080 size=2>ProjectResource</FONT><FONT size=2>.GetResource(dr));<BR></FONT></FONT><FONT size=2>}</FONT></P>
<P><FONT size=2>This is an example from Rocky's Resources.cs object.</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChristianPena replied on Tuesday, September 19, 2006</h2><P>I am fairly new to CSLA so there may be some subtlety that I am missing. I guess I am wondering why the response posted by DeHaynes is not the right response. Typically you would do this in a parent object or list and so the code provided by Tim would ensure that the case does not happen. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, September 19, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ChristianPena:</strong></div><div>
<P>I am fairly new to CSLA so there may be some subtlety that I am missing. I guess I am wondering why the response posted by DeHaynes is not the right response. Typically you would do this in a parent object or list and so the code provided by Tim would ensure that the case does not happen. </P>
<P></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>That code is correct for a Parent/Child BO relationship.</P>
<P>The question should have stated that is was about a Root BO. Then you have the dilemma of what to do when the PK value you are searching for does not exist in the DB. Do you return Null, an Exception or a New BO?</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChristianPena replied on Tuesday, September 19, 2006</h2><P>That clears it up. Thanks Joe.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, September 18, 2006</h2>There was a big discussion about this a while ago. Search for the null object pattern to find that thread.<br><br>In general, I recommend letting the exception bubble up to where you can do something about it (like tell the user the data couldn't be found). Other people prefer to return a null object or take other steps.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, September 18, 2006</h2>I have a test in my code to see if the record exists before trying to fetch it. If it does then I do a normal Fetch. But if it does not, I branch the code&nbsp;and essentially run the DataPortal_Create code and return a new initialized BO. This pattern has worked fine for me. I can see where some people may not like this approach though. In that case you are back to Rocky's suggestions.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Monday, September 18, 2006</h2>I had the same kind of an issue recently, and I am using a separate factory object (e.g. UserFactory) for my object creation when I don't already know whether the data will exist. UserFactory is subclassed from ReadOnlyBase. UserFacotry contains a single read-only property, User, which returns a User object. <br><br>Inside the DataPortal_Fetch of the UserFactory, SQL is executed to check the existence of the ID. If the ID exists, the User object is instantiated and assigned to the backing field behing the User property. Otherwise, the User object is null/nothing.<br><br>The User object itself is designed as an editable root, except for how we code the factory methods and the constructors. Since the User object will always be instantiated inside the server-side data portal of the UserFactory object, it's more like a child object. In our case, the UserFactory fetches the data and passes a SafeDataReader to a Friend constructor on the User object. The User object has no factory methods. Of course, you could have factory methods (still with Friend scope), which is a little more consistent way to instantiate all business objects.<br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
