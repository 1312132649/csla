<html><header><title>Design Direction Opinions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design Direction Opinions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1208.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes posted on Wednesday, September 13, 2006</h2><P>&nbsp;&nbsp;&nbsp;I am designing this system from database to webpage.&nbsp; Subequently I have made decisions to make the database as open ended as possible.&nbsp; For instance I have a Contact Table to track people.&nbsp; There are seperate tables for NamePrefix, NameSuffix.&nbsp; I also have a seperate table for Addresses, EmailAddresses, PhoneNumbers and Relationships with a Many-to-many table for each.&nbsp; This allows me to have as many address, email address, phone numbers and relationships as I want.</P>
<P>&nbsp;&nbsp;&nbsp;The result of this is when I go to code objects in CSLA, I don't have a one-to-one relationship between records and objects.&nbsp; For instance, the tblAddresses table only contains addresses.&nbsp; The tblContactsM2MAddress table contains a foriegn key to point to the contact, a foriegn key to point to the address and a foriegn key that points to another table called tblAddressTypes.&nbsp; So for me a complete address object is actually based off of one record in the tblContactsM2MAddress combined with the associated record out of tblAddresses.</P>
<P>&nbsp;&nbsp;&nbsp;What I want to know is if this is common or am I heading down a road on my own?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 13, 2006</h2><P>First, your problem is definitely one a lot of us have gone through. In fact, I'm working in the "contact" portion of our system at this time as well. </P>
<P>People can have addresses. Certain people may end up sharing the same address instance or record in the database. But when looking at a person class, what do you have? Addresses (at least for me) don't stand on their own - they're "child" objects for me.</P>
<P>My approach is a little bit more involved but taking the concepts above I would have a person class along with a collection of addresses. </P>
<P>When it comes time for concurrency checking, I manage a modified datetime on each address as well on each person - so if I have two people that happen to share the same address and one modifies it and saves, the other cannot do the same without reretrieving the object. Every one of my objects (parent and child) do a concurrency check (which may not be the typical approach for everyone here). </P>
<P>In my system, a Profile (Individual or Organization) have a collection of Relationships, Names (primary and alternatives), etc. Some of these are many to many and some of these are one to many, but the schema in the database shouldn't dictate your object model - which may say a person has relationships and addresses, etc. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Wednesday, September 13, 2006</h2><P>I agree.&nbsp; My CSLA implementation is a Contact object with an Addresses Collection object that then contains Address objects.</P>
<P>1. When someone updates an address, my stored procedure checks to see if the old address was used by someone else.&nbsp; If it was, then I cannot change it and I create a new address record.&nbsp; If it was only used once, then I contine on.</P>
<P>2. Next the stored procedure checks if the new address already exists.&nbsp; If it does, then the many-to-many record is made to point at the already existing address.&nbsp; If it doesn't exist then it modifies the existing one or creates a new one depending what was decided in the above step.</P>
<P>3. If the new address already existed and the old address was only used by the current contact, then the old address record is removed from the table.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 13, 2006</h2><P>It seems to me like your approach might be a little challenging - and I'd like to understand how you're thinking because these are issues I have had to make decisions on as well. </P>
<P>In your cases:</P>
<P>1) So if two people are sharing an address (like husband and wife) aren't you effectively disconnecting the linkage and establishing two unrelated addresses that could be changed independently at this point (when you'd ideally like to keep them in synch?). If this is a concurrency issue where the husband changed the address while the wife had it open and then the wife was saved I'd simply not allow the wife save to be successful and require the user to reload the wife. </P>
<P>2) How are you determining that an address already exists? By comparing two string literals? Unless there is a very rigorous means that enforces entering of addresses in an extremely consistent manner I wonder if trying to compare string literals might not be a little tricky.&nbsp; </P>
<P>3) I'm not quite sure what you mean here. </P>
<P>Do address changes affect everyone using that address? In my system, they do - when looking at an address I give an indicator and a read-only list as to who is using the address - one changes the address with the knowledge that changing the address changes it for all persons using it.</P>
<P>In my system, iIf someone is truly moving, a person should delete that address (their hookup to that address essentially) and create a new address in the system. If everyone deletes their connection to an address, the address in the database should go away. </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Wednesday, September 13, 2006</h2><p class="MsoNormal"><span>What is the
relationship between the contacts that have the same address?<span>&nbsp; </span>Are they part of the same family, business,
customer (that can contain multiple contacts) etc?<span>&nbsp; </span>In this case the address does not belong to a
specific individual.<span>&nbsp; </span>It belongs to the
family, business or customer.&nbsp; </span><span>This eliminates the need to share addresses or
keep things in sync.<span>&nbsp; </span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 13, 2006</h2><P>In our system we are shying away with a concept from a full-fledged family record. A family is really a result of relationships between individuals. I don't want to go into great depth over it but there are real reasons why "families" get to be a problem when one starts attributing transactions to families and the families may act sometimes in a husband/wife way or a husband/wife/child/child&nbsp;way or a child/wife way, etc (or families break up, etc). </P>
<P>Any individuals and organizations can share an address, but typically this occurs as a result of a work relationship or a family relationship, and that's pretty much it.</P>
<P>In our system we will be providing means to help intuitively establish address sharing (likely as prompts as certain relationships are added/removed). </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Wednesday, September 13, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>skagen00:</strong></div><div> 
<P>It seems to me like your approach might be a little challenging - and I'd like to understand how you're thinking because these are issues I have had to make decisions on as well. </P>
<P>In your cases:</P>
<P>1) So if two people are sharing an address (like husband and wife) aren't you effectively disconnecting the linkage and establishing two unrelated addresses that could be changed independently at this point (when you'd ideally like to keep them in synch?). If this is a concurrency issue where the husband changed the address while the wife had it open and then the wife was saved I'd simply not allow the wife save to be successful and require the user to reload the wife. </P>
<P>2) How are you determining that an address already exists? By comparing two string literals? Unless there is a very rigorous means that enforces entering of addresses in an extremely consistent manner I wonder if trying to compare string literals might not be a little tricky.&nbsp; </P>
<P>3) I'm not quite sure what you mean here. </P>
<P>Do address changes affect everyone using that address? In my system, they do - when looking at an address I give an indicator and a read-only list as to who is using the address - one changes the address with the knowledge that changing the address changes it for all persons using it.</P>
<P>In my system, iIf someone is truly moving, a person should delete that address (their hookup to that address essentially) and create a new address in the system. If everyone deletes their connection to an address, the address in the database should go away. </P>
<P>&nbsp;</P>
<P></div></BLOCKQUOTE></P>
<P>1.&nbsp; Yes, the linkage would be broken temporarily.&nbsp; So if a user (non-technical) wants to change a husband &amp; wife address, they would first go and change the husband address.&nbsp; My stored procedure would see that A) The old address is&nbsp;used by someone else and B) the New Address doesn't already exist.&nbsp; So it would create a new record for the new address.</P>
<P>Then then the (non-technical) user would go to&nbsp;update the&nbsp;wife's address.&nbsp; My stored procedure would see that A) this is the only user using&nbsp;the old&nbsp;address and B) the new address already exists. (because the husband change created it).&nbsp; So it would point the wife at the existing address and delete the old address record since it is no longer needed by anyone.&nbsp; So now the linkage of a single address is complete again.</P>
<P>Part of the reason I did things this way is becuase non-technical uses see these addresses as individual entities.&nbsp; So they will think they have to go change both entries.&nbsp; Yes I could make it so that when you change one record, you change it for everyone but this is supposed to OOP, so in the real world there would be two different index cards.&nbsp; So the user expects to make two changes.&nbsp; So why spend time trying to explain things to them?&nbsp; Instead, I use their energy to help keep orphaned records from happening.</P>
<P>Now the downfall is that they could fat-finger one of the addresses and end up with a different address for each spouse.&nbsp; As soon as they realized it and corrected it, you would be back down to 1 address record for them and anyone else who uses that address.</P>
<P>2.&nbsp; I compare every field in the address.&nbsp; In my address table there is only one field that is not required.&nbsp; It is Address Line 2.&nbsp; In my object I fill that with an empty string if it is going to be NULL.&nbsp; It makes comparing simplier</P>
<P>3.&nbsp; In the example I gave above, when the wife changed addresses, it left an address that was unused by anyone in the tblAddress table.&nbsp; My stored procedure recognizes this and deletes these addresses so as not to have orphaned records.&nbsp; (In the future I plan on figuring out a way to inactivate them without deleting so I can keep history, but right now they just delete.)</P>
<P>I reserved the situation where an address change, changes it for everyone that uses that address, to special situations.&nbsp; My thinking is that some people who have no idea how relational databases work, might try to use it.&nbsp; I would rather code in a special case into a BO and UI or have them come to me rather than to misuse it.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Wednesday, September 13, 2006</h2><P>Yeah that's a pretty common scenario.</P>
<P>It's really helpful in CSLA development to divorce yourself from the thinking of business objects as 1-to-1 representatives of database tables.</P>
<P>I like the thinking behind your additional concurrency functionality on the address, but I'm not sure that would be helpful to the user.&nbsp; If I have two people living at "2342 Walnit Drive", and I understand the concept of two contacts sharing the same address (as I would have to), then I would think if I'm&nbsp;correcting that shared address to "2342 Walnut Drive" I'm changing it for both contacts.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, September 13, 2006</h2><P>Because multiple person can utilize a child object (Address), it isn't entirely true that a person fully contains an address and that the person concurrency&nbsp;checking&nbsp;protects the address information from simultaneous change. Adding the concurrency on the child level adds that protection. </P>
<P>Not that it's a huge deal but that's why I do it. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JZuerlein replied on Wednesday, September 13, 2006</h2><P>I've been down this road too.</P>
<P>Having two people share the same address is not a great idea unless you can provide a way for the user to understand what is at stake when they make the change.&nbsp; The best way I've seen this done, is to have business addresses shared by all the people who work at a business.&nbsp; When the business moves, that change can be applied to all the employees.&nbsp; The key is to have a UI prompt asking the user if the address change should apply to the person, or the business.&nbsp; If the change is for just the person, then create a new address, and delete the reference to the old business address.</P>
<P>The problem is that most users don't understand why the question is being asked.&nbsp; Which in my experience leads to some sort of administrator monitoring and "undo" functionality when the user makes the wrong choice.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DeHaynes replied on Wednesday, September 13, 2006</h2><P>Wow this is a popular question.&nbsp; I like it.&nbsp; :)&nbsp; </P>
<P>The reason I started this thread was because during the design of my database, I started running into&nbsp;resistance.&nbsp; You know the "I have been doing system design for 20 years and I have never seen&nbsp;anything that required&nbsp;THAT level of complexity!" type of thing.&nbsp; For the most part I have held it off because I can stand up and explain myself.&nbsp; But it is good to get objective opinions.&nbsp; In that vein, I will expand on how I implemented my Address BO (child) and see what you all think.&nbsp; My basic tables are.</P>
<P><STRONG><U>tblAddresses</U></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This contains the&nbsp;addresses<BR>AddressPK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int, identity<BR>AddressLine1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; varchar(50)<BR>AddressLine2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; varchar(50), nullable<BR>City&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar(50)<BR>StateFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char(2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;------- Federal 2 letter state abbreviation<BR>Zip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar(11)<BR>CountryFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;------- International ISO 3 letter country abbreviation<BR>LastChange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timestamp</P>
<P><STRONG><U>tblContacts</U></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This contains my contact info<BR>ContactPK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int, identity<BR>NameTitleFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int<BR>...etc<BR>LastChange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timestamp</P>
<P><STRONG><U>tblAddressTypes</U></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This stores the various types of addresses (Business, Home, Vacation, etc)<BR>AddressTypePK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int, identity&nbsp;<BR>AddressType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; varchar(150)<BR>LastChange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timestamp</P>
<P><STRONG><U>tblContactsM2MAddresses</U></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This is links my my contacts to my addresses and allows May-to-Many<BR>ContactM2MAddressPK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int, identity<BR>ContactFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int<BR>AddressTypeFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int<BR>AddrssFK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int<BR>LastChange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timestamp<BR></P>
<P>When looking at it as an object, I transfer the fields like this.</P>
<P>Object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;ContactAddress<BR>Properties&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp; Id&nbsp;&nbsp;&nbsp;&nbsp; &lt;-&nbsp; ContactM2MAddressPK from tblContactsM2MAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddressType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;- from tblAddressTypes<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddressLine1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddressLine2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;City&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Zip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Country&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- from tblAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_M2MLastChanged&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; - from tblContactsM2MAddresses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_AddressLastChanged&nbsp;&nbsp;&nbsp;&lt; - from tblAddresses<BR></P>
<P>It is my thought that the UNIQUE combination of the AddressType with the Address&nbsp;makes a complete address.&nbsp; The address record inside the address table is useless alone so the index off that address record in tblAddresses is not very useful.&nbsp; So I use the Primary Key field in tblContactsM2MAddresses as my Id for my address objects.&nbsp; </P>
<P>I use&nbsp;the same M2M&nbsp;layout for my Email Addresses and Phone Numbers.&nbsp; I plan on using a very similiar layout for Relationships.&nbsp; </P>
<P>The reason I chose this layout is because my company is notorious for coming to the IT department and saying, "Yea, we know we told you we only needed to do this, but now we gotta use your system to do this additional thing."&nbsp; So I cannot use a solution like they do in Ms Exchange 2003, which we use for e-mail.&nbsp; It&nbsp;only stores 3 addresses and 8 phone numbers in a contact.&nbsp; With this setup, I can store as many addresses of any address type they want to create.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, September 19, 2006</h2><P>I agree that this is a great discussion!&nbsp; With that in mind, here's my two cents with regards to the concept of linking and breaking addresses.</P>
<P>First, I share the same design with many-to-many relationships between addresses, phone numbers, etc. but that is mostly inherited from my previous work.&nbsp; My thoughts on this have changed as I have evolved to SOA and a behavior-based approach rather than busting my hump trying to optimize and normalize the database schema.&nbsp; Afterall, it is normalization that leads to this design.&nbsp; The goal being to eliminate redundancy from the address table as much as possible.&nbsp; And when you have multiple people sharing the same address, whether it is their business or home address, normalization rules dictate that you should establish a many-to-many relationship.</P>
<P>BUT...</P>
<P>When you start looking at this from a behavioral perspective and, more importantly, a real world point-of-view, things don't always agree with normalization standards.&nbsp; That is why you find most production databases aren't normalized to the extreme.</P>
<P>Fact of the matter is that an address and its owner do have a relationship.&nbsp; Where most developers get off-track, I believe, is in their interpretation that an address is just some attribute of the parent entity.&nbsp; This is not the case.&nbsp; An address is an entity in and of itself.&nbsp; It represents a physical location and has certain behaviors and attributes of its own and depending on your application, you may or may not tap into these but they do exist in the real-world model.&nbsp; These attributes, say the tax rate for instance, are independant (for the most part) of the parent entity.&nbsp; The same applies to phone numbers.</P>
<P>Instead, in the real-world, we establish relationships between people and these entities.&nbsp; When someone purchases a house, they establish their relationship as the new owner of that address.&nbsp; When the are assigned a phone number from the phone company, they establish their relationship with that number.&nbsp; When they move, does the address cease existance?&nbsp; No.&nbsp; When they change phone numbers, does the original disappear?&nbsp; No.</P>
<P>So, even though this may sound out in left field or like it makes for a complicated design, it really doesn't and all of the above discussion is pretty much on-track.&nbsp; The key is the symantics and getting everyone on the same page conceptually.</P>
<P>Following along with a couple of the use cases described previously, when a husband and a wife share a residence, both entities have a relationship to the same record in the Addresses table.&nbsp; When they move (change addresses), they don't actually change the address.&nbsp; Instead, they change their relationship from the previous address to the new one.&nbsp; The original address is still there.&nbsp; Presumably another person or family has established their own relationship with that address.&nbsp; Otherwise, is sits there unassigned (unoccupied).</P>
<P>Should the couple's new address not be in the system, then a new record is created for the new location and the relationship established.&nbsp; This allows for urban-sprawl.</P>
<P>Should the couple get divorced, (let's assume) only one of their addresses changes.&nbsp; You must break the pseudo-relationship between the "people" by establishing a new relationship between the spouse moving out and their new address.&nbsp; The old address remains intact and still has a relationship with the other spouse.</P>
<P>This change in direction was helped by a recent effort into a solution for a medical office.&nbsp; The system tracks each patient as a separate entity, each with their own billing address, phone numbers, insurance information, etc.&nbsp; But, a huge short-coming in their previous system was the inability to link information causing their office staff to re-enter information for each member of a family when changes were required.&nbsp; To accomodate this, we had to establish relationships between the family members - not the addresses!&nbsp; Fact it, nothing besides their particular business rules, or more appropriately, the insurance carrier's rules, dictated that each member of the family covered by the same policy had to reside at the same address - so the system didn't either.&nbsp; If the insurance company said they did, then that was their problem.&nbsp;&nbsp;For us, we didn't care if all or none of the family members shared a residence.&nbsp; But, if they did, a change of address could easily be carried over to the other family members through their relationship.&nbsp; And, yes, it required prompting to make sure that the change was for the whole family and not because lttle Bobby went off to college.&nbsp; In addition, because we allowed linkage between family members regardless of address, phone number and, yes, even insurance, our application became a great tool for the doctor's to track family history - a nice side affect that has since been exploited further.</P>
<P>The point is that the relationships you are talking about with regards to a group of people's business address, etc. are based on relationships between the people, not the addresses.&nbsp; If you want to be able to update all employee's addresses when their employer moves, you do so by relating the employee with the employer and changing the employer's address.&nbsp; The employee-employer relationship establishes your group and the change is carried through automatically.</P>
<P>In addition, this simplifies applications such as eCommerce packages where you need to have an accurate snapshot of the order information at the time the order was placed.&nbsp; Any of us who have developed one of these applications knows that you can't simply relate the customer to the order, you have to record the billing and shipping addresses at the time the order was placed.&nbsp; This is typically done by copying the information into text fields in the orders table because you can't trust that the original information in the Addresses table hasn't changed since the order was placed.&nbsp; However, by persisting the addresses as mentioned above, the relationship between the order and the address used at the time the order was placed won't change even though the customer's relationship to that address may have.</P>
<P>However, there is one short-coming to this approach which is why I still copy the address information into the Orders table (until I find a permanent fix for this).&nbsp; While you don't allow direct changes to the addresses as part of moves, you will still need to handle address corrections.&nbsp; For instance, were I am located we have had a number of zip code changes over the last 20 years as the population has expanded.&nbsp; The same applies to phone numbers where area codes change.&nbsp; As a result, there is a need to edit the address information.&nbsp; Having safe guards to ensure that the change in only a correction and not a full-fledged change is an issue.&nbsp; So, for instance, you want to allow the zip code to change from 12345 to 12354.&nbsp; You need a way to distinguish a correction from a change/relocation.</P>
<P>The way we've handled that is to allow only changes to specific fields and in a controlled manner.&nbsp; The postal code can be edited but only by selecting a value from a drop-down list of values held in the database relating the postal code to city and state.&nbsp; So as long as the address is for Springfield, only those postal codes are available.&nbsp; If a new postal code has been assigned to the area, than it needs to be added to the master list.&nbsp; Cities, States and Countries are all contained in look-up lists with relationships established.&nbsp; If Mississippi was misspelled, then the master entry is what gets changes, not the individual address (and only by an administrator).&nbsp; We even separate address numbers from street names for the same reason as the house number should not change unless the person or business has moved.</P>
<P>This model has proven to be a nice mix of the normalized approach and behavioral/real-world approach.&nbsp; While not fool-proof when it comes to corrections, it does model the true behavior that takes place in the real world where it is the relationship between the person, couple, family or business and the address that changes, not the address itself.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JHurrell replied on Tuesday, September 19, 2006</h2>Arrrr... Pirate. You know what today is don't you? <a href="http://www.talklikeapirate.com/">http://www.talklikeapirate.com/</a><br><br>I like your approach and think it's well thought out, but wanted to get a little more information. You indicated that Cities, States and Countries are all contained in lookup lists. How do you contend with cases when a user lives in a city that does not exist in your system? Say for example there's a small town somewhere, and a user from that town is the first one to use your system. How do they provide their city?<br><br>Do you include some kind of "Not In List" item that would then allow the user to enter the city into a textbox?<br><br>This pattern is one that I've used in the past and it works well for systems where you do not expect many custom entries. There is a flag on the record that indicates whether or not the custom entry has been reviewed. Reviewing allows us to check the entry for correctness and make sure that it actually IS new.<br><br>- John<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>MrPogo replied on Tuesday, September 19, 2006</h2><P>It really would be neat to see this design layout.&nbsp; It really sounds like a well though out approach to handle the most common scheme that almost everyone uses. </P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 19, 2006</h2>Excellent post SonOfPirate - your approach is very similar to ours but different in some aspects and gives us good stuff to chew on. Thanks for taking the time. </div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, September 19, 2006</h2><P>The "Not in list" case is something that has to be dealt with on an app by app basis and is dependant upon the interface and user-base.&nbsp; And, I've seen it handled as a wide-open field that allows users to freely enter any value and add it to the database if not already existing (which almost always leads to problems, but some people still insist on this way), allowing users to display the list in a popup window where they can add new items to the database or limiting access to only administrators so that users have to put that item to the side and request the item be added (believe it or not!).</P>
<P>If you are dealing with an internal application, either Win-based or on an intranet, you can usually rely on the users to do the job right or using role-based security to limit access to the master list.&nbsp; Public websites are the most troublesome because it is almost impossible to include every city that will possibly be used during the lifetime of the site.&nbsp; So, some measures need to be taken.&nbsp; Typically, in these cases, we allow the city to be entered manually and don't use a lookup list in that case unless we want to incorporate some kind of data management feature to reset references when invalid entries are found (which we've had to do more than once).</P>
<P>Where we use a greater number of master lists is in environments where the list changes infrequently or can be managed adequately by the customer and the user-base has a hard time entering a name the same way twice.&nbsp; We had a project where we had to migrate a customer's existing database over and found that less than 10% of the data was valid because it was not uncommon for the same city to be spelled as many as 3 or 4 different ways in the database - double that if the city has more than one word in its name!</P>
<P>So, I guess I should have preficed my comments with the fact that my example was an extreme case of fool-proofing and the average app probably won't go to that extreme.&nbsp; Although, I can tell you that we have been looking into address verification software and web services as well as various sources for address information (such as what is plugged into GPS systems) that we can use to build a "master" list that will reduce the likelihood that an address doesn't already exist.&nbsp; But, we are early in that investigation and have yet to decide if the benefits outweight the negatives such as performance hits, etc.</P>
<P>Hope that helps.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
