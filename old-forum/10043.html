<html><header><title>Problem with DataPortal.FetchChild and _guidID</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problem with DataPortal.FetchChild and _guidID</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10043.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mark Sulkowski posted on Tuesday, February 08, 2011</h2><p>I&#39;m evaluating CodeSmith, and I&#39;ve set up a test project in C# using the SQL&nbsp;AdventureWorks database with generated&nbsp;CSLA business objects.</p>
<p>It looks good, except for one problem.&nbsp;I get an exception thrown due to the existence of this in the generated&nbsp; code:</p>
<p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">private</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">readonly</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Guid</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> _guidID = </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Guid</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.NewGuid();</span></span></p>
</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">My approach, and correct me if you think this is a less than ideal approach, is to write a public static method on the List object (SalesOrderDetailList in my example) that in turn calls the&nbsp;generated&nbsp;internal static GetBySalesOrderID method, which in turn&nbsp;uses its generated code to call DataPortal.FetchChild.</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Here&nbsp;is the exception:</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">System.ArgumentException was unhandled<br />&nbsp; Message=Expression must be writeable<br />Parameter name: left<br />&nbsp; Source=System.Core<br />&nbsp; ParamName=left<br />&nbsp; StackTrace:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Linq.Expressions.Expression.RequiresCanWrite(Expression expression, String paramName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Linq.Expressions.Expression.Assign(Expression left, Expression right)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Reflection.DynamicMethodHandlerFactory.CreateFieldSetter(FieldInfo field) in C:\Projekt\CslaSource\Csla\Reflection\DynamicMethodHandlerFactory.cs:line 189<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Reflection.DynamicMemberHandle..ctor(FieldInfo info) in C:\Projekt\CslaSource\Csla\Reflection\DynamicMemberHandle.cs:line 44<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableHandler.BuildHandlers(Type type) in C:\Projekt\CslaSource\Csla\Core\UndoableHandler.cs:line 55<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableHandler.GetCachedFieldHandlers(Type type) in C:\Projekt\CslaSource\Csla\Core\UndoableHandler.cs:line 24<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.CopyState(Int32 parentEditLevel) in C:\Projekt\CslaSource\Csla\Core\UndoableBase.cs:line 130<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.BeginEdit() in C:\Projekt\CslaSource\Csla\Core\BusinessBase.cs:line 770<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.System.ComponentModel.IEditableObject.BeginEdit() in C:\Projekt\CslaSource\Csla\Core\BusinessBase.cs:line 695<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.OnCurrentChanged(EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.ChangeRecordState(Int32 newPosition, Boolean validating, Boolean endCurrentEdit, Boolean firePositionChange, Boolean pullData)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.CurrencyManager.List_ListChanged(Object sender, ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.OnListChanged(ListChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.ResetBindings(Boolean metadataChanged)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.SetList(IList list, Boolean metaDataChanged, Boolean applySortAndFilter)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.ResetList()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.BindingSource.set_DataSource(Object value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at AdventureWorksWinFormTest.Form1.btnLoad_Click(Object sender, EventArgs e) in C:\Users\Mark.DIGRAD-MARK8710\Documents\CodeSmith Generator\Templates\CSLA\AdventureWorks3\AdventureWorksWinFormTest\Form1.cs:line 30<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.OnClick(EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.OnClick(EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.OnMouseUp(MouseEventArgs mevent)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmMouseUp(Message&amp; m, MouseButtons button, Int32 clicks)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.ButtonBase.WndProc(Message&amp; m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Button.WndProc(Message&amp; m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG&amp; msg)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(IntPtr dwComponentID, Int32 reason, Int32 pvLoopData)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.Run(Form mainForm)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at AdventureWorksWinFormTest.Program.Main() in C:\Users\Mark.DIGRAD-MARK8710\Documents\CodeSmith Generator\Templates\CSLA\AdventureWorks3\AdventureWorksWinFormTest\Program.cs:line 18<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, String[] args)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()<br />&nbsp; InnerException: <br /></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Is there any graceful way of dealing with this problem aside from turning off the undo feature?&nbsp; (Which I&nbsp;would consider anyway.)</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">Mark Sulkowski</span></span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, February 08, 2011</h2><p>If you mark the field as readonly, you also need to mark it as NonSerialized and NotUndoable. It is readonly after all, so the serializers and undo features can&#39;t change it after the fact.</p>
<p>This would also mean that you assume responsibility for resetting that value (or avoiding its use) after any serialization or undo operation, because the value becomes meaningless from that point forward.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, February 08, 2011</h2><p>Hi,</p>
<p>I&#39;d just like to add that a field marked as readonly can only be set in the constructor or at declaration as you do. This causes problems for deserializers and undo. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>csmith1 replied on Tuesday, October 25, 2011</h2><p>In CodeSmith I changed the&nbsp;CompositeKeyMethods.cst script. Add the [NonSerialized] and [NotUndoable] attributte to the&nbsp;_guidID parameter.</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
