<html><header><title>About none reusable rules.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>About none reusable rules.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11085.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Tuesday, January 24, 2012</h2><p>Hello,</p>
<p>I was wondering what do you guys normally do when you have a property that requires a very specialized rule. The type of rule that is so limited in use to a particular property the chances that you would be able to reuse that same rule for a different property are basically none.</p>
<p>My thoughts right now are to go ahead and create my own class that inherits from &quot;IBusinessRule&quot; and leave the &quot;PrimaryProperty&quot; as read-only. This way, I can hardcode the &quot;PrimaryProperty&quot; value inside the rule&nbsp;therefore formalizing the fact that such rule was only intended to be used by that one property.</p>
<p>But I wonder if others have run into similar issues and curious about how you guys dealth with the &quot;problem&quot;. Perhaps I am going overboard with this? A simple comment on the rule may suffice..... but then again, maybe there is a better way.</p>
<p>Just curious,</p>
<p><br />Thanks.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, January 24, 2012</h2><p>Hi,</p>
<p>I would typically create that rule as an inner class, in the BO class. That way it&#39;s not reusable and the rule will also have access to inner variables in the BO. </p>
<p>When I have rules f.ex on lazy loaded properties I put them inside the&nbsp; BO class so the rule can have access to FieldManager and check if the field has been loaded or not. </p>
<p>I&#39;d allow the rule to inherit from BusinessRule or ProperyRule - and you could even set the PrimaryPropery as an hardcoded IPropertyInfo&nbsp; (rather than use a parameter to the constructor).</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Tuesday, January 24, 2012</h2><p>Thanks Jonny,</p>
<p><br />What you describe is exactly what I am currently doing and yet, for some reason I still feel the need to take it one step further. </p>
<p><br />I don&rsquo;t know, I guess that even as a private&nbsp;inner class I still feel that the CSLA is missing that business rule class people could inherit from that screams &ldquo;hey! I am a single property rule&rdquo;.</p>
<p>In any event, the current implementation of &ldquo;IBusinessRule&rdquo; exposes two public List&lt;IPropertyInfo&gt; properties (InputProperties and AffectedProperties). Since there is no way to make these properties read-only lists (to prevent modifications to the children), there is no way to create a truly sealed business rule class that can&rsquo;t be misused even internally.</p>
<p><br />I think I may be trying too bee to much of a purist here. Thanks for the feedback though, is good to know I am not the only one that has arrived to the same solution.</p>
<p><br />Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, January 25, 2012</h2><p>I find it hard for anyone to try and reuse this type of rule: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new ValidToMustBeLessThanOrEqualToday());<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; public class ValidToMustBeLessThanOrEqualToday : BusinessRule<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ValidToMustBeLessThanOrEqualToday() : base(ValidToProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;IPropertyInfo&gt;{ValidToProperty};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute(RuleContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var value = (IComparable)context.InputPropertyValues[ValidToProperty];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(value.CompareTo(new SmartDate(DateTime.Today)) &gt;= 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(string.Format(&quot;{0} must be earlier ot today&quot;, ValidToProperty.FriendlyName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Wednesday, January 25, 2012</h2><p>Correct, you could even make the business rule private to secure it even more.</p>
<p>But perhaps I should have been clearer in my post. My beef wasn&rsquo;t necessarily about preventing a developer from misusing the rule since a simple comment on the rule would make any developer aware of the purpose of the rule.</p>
<p>My issue had more to do with wanting to formalize the intent of the code through the code itself, and nothing would&nbsp;define the intent of a business rule designed for a single property&nbsp;than having&nbsp;the rule inherit from some specially designed &quot;SinglePropertyRule&quot; base class or something like that..... at least I think so.</p>
<p>Anyway, I am splitting hairs here. I just wanted to make sure I was on the same page (using best practices) as what other folks are doing.</p>
<p>Thanks again.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, January 25, 2012</h2><p>Yes, I absolutely recommend &quot;sandwich&quot;/intermediate base classes for both rules and business objects. </p>
<p>Myself, I use</p>
<ul>
<li>LookupRule&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (IsAsync=false, CanRunInCheckRules=false, CanRunAsAffectedProperty=false, CanRunOnServer = false)</li>
<li>AsyncLookupRule&nbsp;&nbsp;&nbsp; (IsAsync=true, CanRunInCheckRules=false, CanRunAsAffectedProperty=false, CanRunOnServer = false)</li>
<li>PrivatePropertyRule (private rule - only for this BO)</li>
</ul>
<p>and could probably have more types too. </p>
<p>By my definition - LookupRules should only run when user edits a field in UI.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
