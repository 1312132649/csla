<html><header><title>CancelEdit may throw exception if AllowRemove = False</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CancelEdit may throw exception if AllowRemove = False</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2199.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>amselem posted on Tuesday, January 23, 2007</h2><P>I've a BO derived from BusinessBase(Of T) wich has an editable&nbsp;child collection derived from BusinessListBase(Of T,C). </P>
<P>I've some code that toggles the AllowRemove value in this child collection, so I can add/remove childs and then set AllowRemove = False to block further editing<BR>In that case calling the root BO .CancelEdit method&nbsp;throws a "Method not supported" exception. I've found that the CancelEdit method may call BindingList.RemoveAt&nbsp;(index) wich fails if AllowRemove = False.</P>
<P>To solve this problem I've changed the method BusinessListBase.UndoChanges from:</P><FONT color=#0000ff size=4>
<P><FONT color=#000000 size=3>If</FONT></FONT><FONT color=#000000> child.EditLevelAdded &gt; mEditLevel Then</FONT><FONT color=#0000ff><BR></FONT>&nbsp;&nbsp;&nbsp;RemoveAt(index)<BR><FONT color=#000000>End If</FONT></P>
<P>to:</P>
<P><FONT color=#000000>If child.EditLevelAdded &gt; mEditLevel Then<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;Dim CurrentAllowRemove As Boolean = Me.AllowRemove<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;Try<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me.AllowRemove = True<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RemoveAt(index)<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;Finally<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Me.AllowRemove = CurrentAllowRemove<BR></FONT><FONT color=#000000>&nbsp;&nbsp;&nbsp;End Try<BR></FONT><FONT color=#000000>End If<BR></FONT></P>
<P><FONT color=#000000>This way I force&nbsp;AllowRemove=True when calling CancelEdit/UndoChanges (but not outside it,&nbsp;I think that the exception thrown is ok if Remove/RemoveAt gets called directly).<BR><BR>I'd like to discuss this issue, what do you think about that code change ? </FONT></P>
<P><FONT color=#000000>Regards,<BR>Jacobo</FONT><FONT color=#000000></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 25, 2007</h2>This seems like a reasonable change to me, I'll make it in 2.1.2. Probably the last change I'll make before this version goes live.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
