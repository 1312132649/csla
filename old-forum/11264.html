<html><header><title>ReadWriteAuthorization - Not disabling Controls within a TabControl</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ReadWriteAuthorization - Not disabling Controls within a TabControl</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11264.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar posted on Wednesday, March 28, 2012</h2><p>Hi All,</p>
<p>I&#39;ve encountered a strange behavioural issue with the ReadWriteAuthorization extender on a single WinForm.&nbsp; The WinForm contains a TabControl with a series of TextBox and ComboBox controls.&nbsp; We&#39;ve add the ReadWriteAuthorization extender and set each TextBox and ComboBox control&#39;s ApplyAuthorization on ReadWriteAuthorization property to true.</p>
<p>When we log in with a user account having the GetObject permission but not Edit/Delete/Create permissions on all other forms the controls are disabled.&nbsp; On this one Form they are still enabled.</p>
<p>Is there something I am missing?&nbsp; We are using CSLA 4.1.0 in VS2010.</p>
<p>Phlar</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, March 28, 2012</h2><p>ReadWriteAuthorization only check CanReadProperty / CanWriteProperty methods in the BO. </p>
<p> Get/Edit/Delete/Create permissions is not checked by CanReadProperty / CanWriteProperty. </p>
<p>CanReadProperty =&gt; AuthorizationActions.ReadProperty<br />CanWriteProperty =&gt; AuthorizationActions.WriteProperty</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Wednesday, March 28, 2012</h2><p>Hi JonnyBee,</p>
<p>Sorry I should have&nbsp;also indicated the series of WriteProperty&nbsp;details as well.&nbsp; For example on a Property BO we have the following for Authorization Rules:</p>
<p>BusinessRules.AddRule(new IsInRole(AuthorizationActions.WriteProperty, CityProperty, &quot;Address-Edit&quot;));</p>
<p>The user login details we are using does not have the &quot;Address-Edit&quot; role.</p>
<p>On the UI we have inserted a TabControl with a TextBox Control.&nbsp; We&#39;ve set the DataBindings Text Property to our BO - City property.&nbsp; We have also set the ApplyAuthorization on ReadWriteAuthoriztion property to true.&nbsp; The ApplyAuthorizationRules() method&nbsp; determines if the user has EditObject permissions (in this case no) and then Rebinds(false, true).&nbsp; Finally it calls the ResetControlAuthorizaiton method on the ReadWriteAuthorization extender.</p>
<p>We have utilized this in two dozen other forms/controls without any issue.&nbsp; However for some reason this one particular control is not properly disabling the controls.&nbsp; I had thought it was another issue as with DataGrids but that does not seem to be the case.</p>
<p>Any suggestions?</p>
<p>Phlar</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, March 28, 2012</h2><p>I have noticed a few&nbsp; times that the codebehind for ReadWriteAuthorization has become corrupted in &lt;form&gt;.Designer.cs. Possibly connected to copy / paste of controls in the form (but not sure) where the RWA control is owned by another container control than form. </p>
<p>You can also check this in the Document Outline window of the Form. RWA control assumes it is owned by the form and will &quot;hook&quot; into the controls of the parent container only (and thus will only know that containers child controls).The Windows Forms Designer will not acknowledge this and still allow the RWA control to (seemingly) extend all controls on the form.</p>
<p>So my first suggestion is to: </p>
<ul>
<li>delete the RWA control and everything connected to this that eventually remains in the &lt;form&gt;.designer.cs</li>
<li>save and close VS</li>
<li>open VS and the form </li>
<li>add RWA control and reset ApplyAuthorization on the controls.&nbsp;</li>
</ul>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Phlar replied on Wednesday, March 28, 2012</h2><p>Unfortunately I have not had any luck with your first suggestion.&nbsp; Is there anything else I could attempt (short of constructing a new Form and adding new controls to that form)?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, March 28, 2012</h2><p>Hmm, </p>
<p>Well you could check in the&nbsp; <b><i>Document Outline</i></b> window on where the RWA is placed within the sequence of controls and the owner container in the Form&nbsp; and compare to Forms where the RWA is working OK to see if there is differences and try to correct them. </p>
<p>You should also verify that the RWA is created like this: </p>
<p><i>&nbsp;this.readWriteAuthorization1 = new Csla.Windows.ReadWriteAuthorization(<b>this.components</b>);</i></p>
<p>I think I have also seen a couple of times that the default constructor (without parameters) is called without<i><b> this.components</b></i>.</p>
<p>If these suggestions don&#39;tsolve the issues then the only options I can suggest is to either debug the RWA control or try to make a new Form.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>Phlar replied on Friday, March 30, 2012</h2><p>Hi JonnyBee,</p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">Well the Document Outline window outlined the RWA in the same location across all our Forms.&nbsp; However, after much debugging and line by line review of the BO I did discover the error so I thought I would share the details with anyone else who may come across the problem.</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;">All of our property level business rules (Write/Read Property) are located in protected AddAuthorizationRules() method.&nbsp; I understand that this method is no longer utilized in the new CSLA but this project has been migrated from CSLA 3.X.&nbsp; For consistency we have left this convention in place.<span style="mso-spacerun:yes;">&nbsp; </span>What was missing was the call to this method in the overridden AddBusinessRules method.</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;">Unfortunately I had already begun reconstructing the Form to determine if it was due to a designer or other issue.</span></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
