<html><header><title>Why is IsDirty true for a new BO?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Why is IsDirty true for a new BO?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/49.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven posted on Tuesday, May 09, 2006</h2><P>When I create a new BO that inherits from BusinessBase my new BO starts off with IsDirty as true.&nbsp; </P>
<P>Why would a new instance of a BO start off dirty?</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Tuesday, May 09, 2006</h2><P>It's quite simple really - an object IsDirty if it's values/properties do not match a value in the database/datastore.</P>
<P>Since a new object does not yet exist in the datastore this implies that it IsDirty.</P>
<P>Easy, eh?</P>
<P>HTH</P>
<P>ChrisD</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>razorkai replied on Tuesday, May 09, 2006</h2>Beat me to it Chris <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven replied on Tuesday, May 09, 2006</h2><FONT size=2>
<P></FONT><FONT size=3>Thanks Chris that makes sense.</FONT></P>
<P>I guess my real problem is that the IsSavable is starting off as True because both IsDirty and &nbsp;IsValid is starting off as true.&nbsp; I have the following rule code and I was expecting IsValid to be false at start because I have StringRequired for "CODE" and the code property is empty at start.&nbsp; How can I tell why is is starting with IsValid true when I think it should be false?</P>
<P>Thanks for your help.</P>
<P><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> AddCommonRules()</FONT></P>
<P><FONT size=2>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> Validation.CommonRules.StringRequired, </FONT><FONT color=#800000 size=2>"CODE"</FONT><FONT size=2>)</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> Validation.CommonRules.StringMaxLength, </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> Validation.CommonRules.MaxLengthRuleArgs(</FONT><FONT color=#800000 size=2>"CODE"</FONT><FONT size=2>, 10))</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, May 09, 2006</h2>You should be calling CheckRules in dataportal create...<br>But make sure your shared method calls dataportal.create instead of doing <br>"return new ObjType()"<br><br><br>It should be something like:<br>Public Shared Function NewObjType(ByVal someValue As Integer) As ObjType<br>&nbsp;&nbsp;&nbsp; Return DataPortal.Create(Of ObjType)(New Criteria(someValue))<br>End Function<br><br>or if you don't have criteria:<br>Public Shared Function NewObjType() As ObjType<br>
&nbsp;&nbsp;&nbsp; Return DataPortal.Create(Of ObjType)()<br>
End Function<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven replied on Wednesday, May 10, 2006</h2><P>I see that ValidationRules.CheckRules is being called from PropertyHasChanged in BusinessBase but I don't see it being called from DataPortal.Create.&nbsp; So after I create a new BO that has a Code property which is required I get the following results.</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim cust As Customer = Customer.NewCustomer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' IsValid is True which is wrong since Code is required</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cust.Code = "A"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' IsValid is Still True which now is ok as far as Code is concerned.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cust.Code = ""<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' IsValid is now False, which is accurate since Code is required.</P>
<P>So modifying the property to trigger the PropertyHasChanged event will cause IsValid to initialize but is there a better way to do this.&nbsp; Are you saying I should modify the CSLA code to call CheckRules in the DataPortal.Create, if so where exactly is that done.</P>
<P>Thanks</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Mark replied on Wednesday, May 10, 2006</h2><P>You implement DataPortal_Create in your business object and call ValidationRules.CheckRules() from there.&nbsp; You don't have to modify CSLA itself.&nbsp; Here's an example from Rocky's ProjectTracker sample (Project class)...</P>
<P>[RunLocal()]<BR>private void DataPortal_Create(Criteria criteria)<BR>{<BR>&nbsp;&nbsp; _id = Guid.NewGuid();<BR>&nbsp;&nbsp; _started.Date = DateTime.Today;<BR>&nbsp;&nbsp; ValidationRules.CheckRules();<BR>}</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Steven replied on Wednesday, May 10, 2006</h2><P>Thanks Mark that was it.&nbsp; My DataPortal_Create was empty.</P>
<P>When I created this BO I made the wrong assumption that since I was not intializing any of the properties that the ValidationRules.CheckRules call was not needed.&nbsp; </P>
<P>I think I did that because the example Resources.vb shows DataPortal_Create empty like this:</P><FONT size=2>
<P>&lt;RunLocal()&gt; _</P>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Create(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Criteria)</P>
<P></FONT><FONT color=#008000 size=2>' nothing to initialize</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P>Does this mean Resource.vb DataPortal_Create is wrong or is the call to CheckRules not needed there for some reason?</P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P>
<P><FONT color=#0000ff size=2>&nbsp;</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, May 10, 2006</h2>I'd go for the code being wrong. If I recall correctly, the name properties are required and so CheckRules should be called... Oops...</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
