<html><header><title>.NET 4.0 / SL 4 upgrade error</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>.NET 4.0 / SL 4 upgrade error</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9108.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>normalham2 posted on Friday, June 18, 2010</h2><p>I have upgraded to the new version of CSLA for Silverlight&nbsp;a few days ago.&nbsp; I&#39;m getting the following exception we I do a build in Release mode.&nbsp; If I do a build in Debug mode, I don&#39;t get the exception.</p>
<p>I get the following exception:</p>
<p>Message: An item with the same key has already been added.<br />Stack Trace:&nbsp;&nbsp;&nbsp; at System.ThrowHelper.ThrowArgumentException(ExceptionResource resource)<br />&nbsp;&nbsp; at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)<br />&nbsp;&nbsp; at Csla.Core.FieldManager.FieldDataManager.GetConsolidatedList(Type type)<br />&nbsp;&nbsp; at Csla.Core.FieldManager.FieldDataManager.OnSetState(SerializationInfo info, StateMode mode)<br />&nbsp;&nbsp; at Csla.Core.MobileObject.Csla.Serialization.Mobile.IMobileObject.SetState(SerializationInfo info)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.DeserializeAsDTO(List`1 deserialized)<br />&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(XmlReader reader)<br />&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_FetchCompleted(Object sender, FetchCompletedEventArgs e)</p>
<p>So looking at the method that is throwing the exception, I&#39;m really not sure why it is happening.</p>
<p>private static List&lt;IPropertyInfo&gt; GetConsolidatedList(Type type)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;IPropertyInfo&gt; result = null;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!_consolidatedLists.TryGetValue(type, out result))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lock (_consolidatedLists)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!_consolidatedLists.TryGetValue(type, out result))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = CreateConsolidatedList(type);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _consolidatedLists.Add(type, result);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;<br />&nbsp;&nbsp;&nbsp; }</p>
<p>Does anyone have any ideas for fixing this?</p>
<p>Thanks,<br />Todd</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Thursday, July 01, 2010</h2><p>Did you ever find out what the root cause and/or fix is for this?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, July 01, 2010</h2><p>This sounds exactly like the kind of problem you&#39;d encounter if your PropertyInfo&lt;T&gt; fields are not public.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
