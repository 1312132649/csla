<html><header><title>Form is closing, user can't do anymore corrections</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Form is closing, user can't do anymore corrections</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5353.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef posted on Friday, September 05, 2008</h2><P>Hello,</P>
<P>I've a problem with the current implementation of the error handling.</P>
<P>Suppose the user is clicking on the OK button.(form ProjectEdit from the example of the book)&nbsp;Suppose the database throws an error because there is some incorrect data. The function RebindUI will catch the error (Csla.DataPortalException) and absorb the error. Then code continues to execute in the procedure OKButton_Click, the statement "this.Close()" will be called which will close the form without the user letting the possibility to&nbsp;correct the data. Is it possible to provide some code where it would be possible for the user to correct some things if the database is throwing an error?</P>
<P>Below follows the code:</P>
<P>Class ProjectEdit.cs</P>
<P>&nbsp;&nbsp;&nbsp; private void OKButton_Click(object sender, EventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (StatusBusy busy = new StatusBusy("Saving..."))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RebindUI(true, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Close();<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;private void RebindUI(bool saveObject, bool rebind)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // disable events<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // unbind the UI<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>// save or cancel changes</STRONG><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (saveObject)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.ApplyEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project = _project.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Csla.DataPortalException ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error saving", MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation);</STRONG><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error Saving", MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.CancelEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // rebind UI if requested<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 05, 2008</h2><P>Absolutely! This is just UI code, and is not part of CSLA at all. You can write your UI code however you'd like!</P>
<P>(keeping in mind that data binding imposes some strict rules you have to live with)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Saturday, September 06, 2008</h2><P>I've replaced the code with the following. So I've put the try catch statement in the OKButton_Click event. Apparently you are first trying to see if it is a Csla.DataPortalException. I've seen that this DataPortalException has an interesting property BusinessObject which gives access to the business object at the time of the exception. This is really interesting for a developer&nbsp;to know what data the user entered on the form in case of an exception.</P>
<P>Do you have some generic piece of code to log all the data of the businessobject?</P><FONT size=2>
<P>&nbsp;</P></FONT>
<P>&nbsp;&nbsp;&nbsp; private void OKButton_Click(object sender, EventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;<STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using (StatusBusy busy = new StatusBusy("Saving..."))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RebindUI(true, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Close();<BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Csla.DataPortalException ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.BusinessException.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error saving", MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(ex.ToString(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Error Saving", MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxIcon.Exclamation);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR></STRONG>&nbsp;&nbsp;&nbsp; }</P>
<P><BR>&nbsp;private void RebindUI(bool saveObject, bool rebind)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // disable events<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // unbind the UI<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // save or cancel changes<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (saveObject)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.ApplyEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project = _project.Save();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _project.CancelEdit();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finally<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // rebind UI if requested<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }</P>
<P><BR>&nbsp;<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Saturday, September 06, 2008</h2><P>On a related note, we had similar issues with "in grid" editing using the DevExpress XtraGrid. Once the user leaves the row, no further corrections are possible.</P>
<P>Most grid, including this one, provide for the capability to stop the row focus from changing, but we had all sorts of weird issues -- like you couldn't even click on some totally unrelated window. Validation exceptions where flying everywhere...</P>
<P>At least for the time being, we have resolved this problem by discarding the users changes if we ge a validation exception when no further correction is readily feasible. Not optimal, but if the user is ignoring errors displayed to them... </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Monday, September 08, 2008</h2>Is this for another subject?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Tuesday, September 09, 2008</h2>I've already a partial solution for the logging of the values of the BO in case of an exception.<br>
I've created a procedure PrintAllProperties which will do the work.<br>
Have somebody an idea to extend the code to print recursively also the properties of child objects, child collections?<br>
<br>
&nbsp;&nbsp;&nbsp; public void PrintAllProperties(object BO )<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Creates a new collection and assign properties for BO.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(BO);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (PropertyDescriptor property in properties)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Checks IsBrowsable Status, Properties like IsDirty() etc are filtered<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Also Checks Readonly Status<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // In short, If Property is Found and IsBrowsable is True &amp; Readonly is false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // then print this BO Property<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Type mtype = property.PropertyType;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (property.IsBrowsable &amp; !property.IsReadOnly)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
System.Diagnostics.Debug.Print(property.DisplayName + ":" +
property.GetValue(BO));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
The procedure PrintAllProperties can be called in the catch statement :<br>
&nbsp;&nbsp; catch (Csla.DataPortalException ex)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrintAllProperties(ex.BusinessObject);<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Wednesday, September 10, 2008</h2>I've found the following two interesting articles<br>
<br>
Adding DumpState to objects for debugging<br>
http://www.lhotka.net/Article.aspx?id=3967df85-ee82-4266-a131-7a3e8e08f5be<br>
<br>
XML Serialization of BusinessBase objects<br>
http://groups.msn.com/CSLANET/general.msnw?action=get_message&amp;mview=0&amp;ID_Message=20161&amp;LastModified=4675531561287839345<br>
<br>
<font face="Arial,Helvetica,Sans Serif" size="2"><br>
These articles are the solution to the problem.<br>
<br>
The following code is been used:<br>
&nbsp;&nbsp;&nbsp; If field.FieldType.IsSubclassOf(GetType(BusinessCollectionBase)) Then<br>
<br>
but in version 3.0.4 <b>BusinessCollectionBase </b>doesn' exist anymore. How do I have to do is in version 3.0.4?<br>
<br>
Lkotka do you have some code in C# which works against version 3.0.4?<br>
Can you add it again to your framework?<br>
<br>
</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Tuesday, September 16, 2008</h2><P>Hi Lothka,</P>
<P>I've added the following code and tested it and everything works as expected.</P>
<P>Can you review the code and maybe if you find it usefull at it for your next release? </P>
<P>I've added these new methods to the interface IUndoableObject or would you prefer to put these methods to another interface?</P>
<P>Below you can find the code which is needed:</P>
<P><STRONG><FONT size=4>1) Coded added to the class <FONT color=#2b91af size=2><FONT size=4>IUndoableObject</FONT></P></FONT></FONT></STRONG><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to the output window</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> in the VS.NET IDE while debugging</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;remarks&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> http://www.lhotka.net/Article.aspx?id=3967df85-ee82-4266-a131-7a3e8e08f5be</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/remarks&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpState();</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to human readable XML </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> (for logging purposes). </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;remarks&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> If an exception occurs during the normal data portal processing, a Csla.DataPortalException will be thrown. To get</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> at the original exception thrown by the business code, use the BusinessException property. Remember</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> that you can also use the BusinessObject property to get a reference to the business object as it</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> was when the exception was thrown — a fact that can be very useful for debugging.</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> We can use e.g. the following code in the UI to log the entire state of an object graph when an </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> exception occurs:</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> EnterpriseHelper.Log(((Csla.Core.IUndoableObject)ex.BusinessObject).ToXML(), "Exceptions");</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/remarks&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML();</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to human readable XML </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> (for logging purposes). </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;param name="objXmlWriter"&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> The XmlWriter object that you want to use as the underlying writer.</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/param&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> objXmlWriter);</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P><FONT size=4><STRONG>2) Coded added to the class <FONT color=#2b91af><FONT color=#2b91af>UndoableBase</FONT></FONT></STRONG></FONT><FONT color=#0000ff size=2><FONT size=2>
<P>#region</FONT><FONT size=2> "Alef: Logging/Debugging functions"</P>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.DumpState()</P>
<P>{</P>
<P>DumpState();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.ToXML()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> ToXML();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> objXmlWriter)</P>
<P>{</P>
<P>DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> objXmlWriter);</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> " To Output Window "</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to the output window</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> in the VS.NET IDE while debugging</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>EditorBrowsable</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>EditorBrowsableState</FONT><FONT size=2>.Never)]</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>internal</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpState()</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2> currentType = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.GetType();</P>
<P></FONT><FONT color=#2b91af size=2>Hashtable</FONT><FONT size=2> state = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Hashtable</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> fieldName;</P>
<P></FONT><FONT color=#2b91af size=2>FieldInfo</FONT><FONT size=2>[] fields;</P>
<P></P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.IndentSize = 2;</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> currentTypeName = currentType.Name;</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"OBJECT "</FONT><FONT size=2> + currentType.Name);</P>
<P></P>
<P></FONT><FONT color=#0000ff size=2>do</FONT><FONT size=2> {</P>
<P></FONT><FONT color=#008000 size=2>// get the list of fields in this type</P></FONT><FONT size=2>
<P>fields = currentType.GetFields(</FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.Public | </FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.NonPublic | </FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.Instance);</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>FieldInfo</FONT><FONT size=2> field </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> fields)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// make sure we process only our variables</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>.ReferenceEquals(field.DeclaringType, currentType)) </P>
<P>{</P>
<P>fieldName = field.DeclaringType.Name + </FONT><FONT color=#a31515 size=2>"!"</FONT><FONT size=2> + field.Name;</P>
<P></FONT><FONT color=#008000 size=2>// see if this field is marked as not undoable</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!NotUndoableField(field)) </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// the field is undoable, so it needs to be processed</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(Csla.Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>).IsAssignableFrom(field.FieldType))</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child collection or a child object, cascade the call</P></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.Indent();</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"CHILD "</FONT><FONT size=2> + fieldName);</P>
<P></FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> value = field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#008000 size=2>// make sure the variable has a value</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (value != </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>) </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child object, cascade the call</P></FONT><FONT size=2>
<P>((Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>)value).DumpState();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// variable has no value - store that fact</P></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"&lt;Nothing&gt;"</FONT><FONT size=2>);</P>
<P>}</P>
<P></P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.Unindent();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a normal field, simply trap the value</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> ((field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>) != </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>)) </P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(fieldName + </FONT><FONT color=#a31515 size=2>": "</FONT><FONT size=2> + field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>).ToString());</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(fieldName + </FONT><FONT color=#a31515 size=2>": &lt;Nothing&gt;"</FONT><FONT size=2>);</P>
<P>}</P>
<P></P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// field is not undoable</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> ((field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>) != </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>))</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"&lt;NotUndoable()&gt; "</FONT><FONT size=2> + fieldName + </FONT><FONT color=#a31515 size=2>": "</FONT><FONT size=2> + field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>).ToString());</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"&lt;NotUndoable()&gt; "</FONT><FONT size=2> + fieldName + </FONT><FONT color=#a31515 size=2>": &lt;Nothing&gt;"</FONT><FONT size=2>);</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P>currentType = currentType.BaseType;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>while</FONT><FONT size=2> (currentType != </FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>UndoableBase</FONT><FONT size=2>));</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.WriteLine(</FONT><FONT color=#a31515 size=2>"END OBJECT "</FONT><FONT size=2> + currentTypeName);</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</P>
<P>#region</FONT><FONT size=2> " ToXML "</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to human readable XML </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> (for debugging purposes)</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>EditorBrowsable</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>EditorBrowsableState</FONT><FONT size=2>.Never)]</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>internal</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> ToXML(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"CSLA_Object"</FONT><FONT size=2>);</P>
<P>}</P>
<P>&nbsp;</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML(</FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> includeDocumentTag, </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> rootElementName)</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2> objMS = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#2b91af size=2>XmlWriterSettings</FONT><FONT size=2> settings = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriterSettings</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#008000 size=2>// Write individual elements on new lines and indent</P></FONT><FONT size=2>
<P>settings.Indent = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#008000 size=2>// Indent with Tabs</P></FONT><FONT size=2>
<P>settings.IndentChars = </FONT><FONT color=#a31515 size=2>"\t"</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> writer = </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2>.Create(objMS, settings);</P>
<P></FONT><FONT color=#008000 size=2>// Write XML data.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (includeDocumentTag)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// Begin with our XML Header</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// Standalone: Dit attribuut is een aanwijzing voor de verwerker dat dit document wel of niet</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// het gebruik van een extern DTD-bestand of een extern entiteitenbestand vereist. Als je een </P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// goed opgesteld XML-document maakt, gebruik je geen externe DTD, dus dan wordt de waarde yes. </P></FONT><FONT size=2>
<P>writer.WriteStartDocument(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>);</P>
<P>}</P>
<P>writer.WriteStartElement(rootElementName);</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> writer);</P>
<P></FONT><FONT color=#008000 size=2>//RootElementName</P></FONT><FONT size=2>
<P>writer.WriteEndElement();</P>
<P></FONT><FONT color=#008000 size=2>//Commit everything to our underlying MemoryStream</P></FONT><FONT size=2>
<P>writer.Flush();</P>
<P></FONT><FONT color=#008000 size=2>// Set the position to the beginning of the stream</P></FONT><FONT size=2>
<P>objMS.Position = 0;</P>
<P></FONT><FONT color=#008000 size=2>//Create a streamreader object based on our Memory Stream</P></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>StreamReader</FONT><FONT size=2> objsr = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>StreamReader</FONT><FONT size=2>(objMS);</P>
<P></FONT><FONT color=#008000 size=2>// Return the entire contents of our MemoryStream</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> objsr.ReadToEnd();</P>
<P>}</P>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> Alef:Dump the entire state of an object graph (root object, its child objects, etc) to human readable XML </P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/summary&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;param name="objXmlWriter"&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> The XmlWriter object that you want to use as the underlying writer.</P></FONT><FONT size=2>
<P></FONT><FONT color=#808080 size=2>///</FONT><FONT color=#008000 size=2> </FONT><FONT color=#808080 size=2>&lt;/param&gt;</P></FONT><FONT size=2>
<P>[</FONT><FONT color=#2b91af size=2>EditorBrowsable</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>EditorBrowsableState</FONT><FONT size=2>.Never)]</P>
<P></FONT><FONT color=#0000ff size=2>protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>internal</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> objXmlWriter)</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>Type</FONT><FONT size=2> currentType = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.GetType();</P>
<P></FONT><FONT color=#2b91af size=2>Hashtable</FONT><FONT size=2> state = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Hashtable</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> fieldName;</P>
<P></FONT><FONT color=#2b91af size=2>FieldInfo</FONT><FONT size=2>[] fields;</P>
<P>objXmlWriter.WriteStartElement(currentType.Name);</P>
<P></FONT><FONT color=#0000ff size=2>do</FONT><FONT size=2> {</P>
<P></FONT><FONT color=#008000 size=2>// get the list of fields in this type</P></FONT><FONT size=2>
<P>fields = currentType.GetFields(</FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.Public | </FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.NonPublic | </FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.Instance);</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>FieldInfo</FONT><FONT size=2> field </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> fields) </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// make sure we process only our variables</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> ((field.DeclaringType == currentType)) </P>
<P>{</P>
<P>fieldName = field.Name;</P>
<P></FONT><FONT color=#008000 size=2>// see if this field is marked as not undoable</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!NotUndoableField(field)) </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// the field is undoable, so it needs to be processed</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(Csla.Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>).IsAssignableFrom(field.FieldType))</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child collection or a child object, cascade the call</P></FONT><FONT size=2>
<P>objXmlWriter.WriteStartElement(fieldName);</P>
<P></FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> value = field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#008000 size=2>// make sure the variable has a value</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (value != </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>) </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child object, cascade the call</P></FONT><FONT size=2>
<P>((Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>)value).DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> objXmlWriter);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// variable has no value - store that fact</P></FONT><FONT size=2>
<P>objXmlWriter.WriteElementString(</FONT><FONT color=#a31515 size=2>"Value"</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"Nothing"</FONT><FONT size=2>);</P>
<P>}</P>
<P>objXmlWriter.WriteEndElement();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a normal field, simply trap the value</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!(field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>) == </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>)) </P>
<P>{</P>
<P>objXmlWriter.WriteElementString(fieldName, field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>).ToString());</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P>objXmlWriter.WriteElementString(fieldName, </FONT><FONT color=#a31515 size=2>"Nothing"</FONT><FONT size=2>);</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> {</P>
<P></FONT><FONT color=#008000 size=2>// field is not undoable</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (!(field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>) == </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>)) </P>
<P>{</P>
<P>objXmlWriter.WriteElementString(fieldName, field.GetValue(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>).ToString());</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</FONT><FONT size=2> </P>
<P>{</P>
<P>objXmlWriter.WriteElementString(fieldName, </FONT><FONT color=#a31515 size=2>"Nothing"</FONT><FONT size=2>);</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P>currentType = currentType.BaseType;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>while</FONT><FONT size=2> (currentType != </FONT><FONT color=#0000ff size=2>typeof</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>UndoableBase</FONT><FONT size=2>));</P>
<P>objXmlWriter.WriteEndElement();</P>
<P>}</P>
<P></FONT><FONT color=#008000 size=2>// ToXML_Header and ToXML_Footer are not redundant because</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// we had some instances where we were using the methods to log the state of objects </P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// in the middle of a complex business operation, so we would create a single xml document</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// that had a "before" and "after" version of a business object. </P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// All in one xml doc. So, we needed that ability to write the header and footer seperately.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML_Footer(</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> RootElementName)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>//&lt;/CSLA_Object&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> (</FONT><FONT color=#a31515 size=2>"\r\n"</FONT><FONT size=2> + </FONT><FONT color=#a31515 size=2>"&lt;/"</FONT><FONT size=2> + RootElementName + </FONT><FONT color=#a31515 size=2>"&gt;"</FONT><FONT size=2> + </FONT><FONT color=#a31515 size=2>"\r\n"</FONT><FONT size=2>);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML_Header(</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> RootElementName)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>//&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>//&lt;CSLA_Object&gt;</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> (</FONT><FONT color=#a31515 size=2>"&lt;?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?&gt;"</FONT><FONT size=2> +</P>
<P></FONT><FONT color=#a31515 size=2>"\r\n"</FONT><FONT size=2> + </FONT><FONT color=#a31515 size=2>"&lt;"</FONT><FONT size=2> + RootElementName + </FONT><FONT color=#a31515 size=2>"&gt;"</FONT><FONT size=2> + </FONT><FONT color=#a31515 size=2>"\r\n"</FONT><FONT size=2>);</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</P>
<P>#endregion</P></FONT></FONT>
<P><STRONG><FONT size=4>3) Coded added to the class <FONT color=#2b91af><FONT color=#2b91af><FONT color=#2b91af size=2><FONT size=4>BusinessListBase</FONT></P></FONT></FONT></FONT></FONT></STRONG><FONT size=2><FONT color=#0000ff size=2>
<P>#region</FONT><FONT size=2> "Alef: Logging/Debugging functions"</P>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.DumpState()</P>
<P>{</P>
<P>DumpState();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.ToXML()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> ToXML();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>.DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> objXMLTW)</P>
<P>{</P>
<P>DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> objXMLTW);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpState()</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child collection, cascade the call</P></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.Indent();</P>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (C child </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>)</P>
<P>((Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>)child).DumpState();</P>
<P></FONT><FONT color=#2b91af size=2>Debug</FONT><FONT size=2>.Unindent();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML(</FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> includeDocumentTag, </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> rootElementName)</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2> objMS = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>MemoryStream</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#2b91af size=2>XmlWriterSettings</FONT><FONT size=2> settings = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriterSettings</FONT><FONT size=2>();</P>
<P></FONT><FONT color=#008000 size=2>// Write individual elements on new lines and indent</P></FONT><FONT size=2>
<P>settings.Indent = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#008000 size=2>// Indent with Tabs</P></FONT><FONT size=2>
<P>settings.IndentChars = </FONT><FONT color=#a31515 size=2>"\t"</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> writer = </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2>.Create(objMS, settings);</P>
<P></FONT><FONT color=#008000 size=2>// Write XML data.</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (includeDocumentTag)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// Begin with our XML Header</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// Standalone: Dit attribuut is een aanwijzing voor de verwerker dat dit document wel of niet</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// het gebruik van een extern DTD-bestand of een extern entiteitenbestand vereist. Als je een </P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// goed opgesteld XML-document maakt, gebruik je geen externe DTD, dus dan wordt de waarde yes. </P></FONT><FONT size=2>
<P>writer.WriteStartDocument(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>);</P>
<P>}</P>
<P>writer.WriteStartElement(rootElementName);</P>
<P>DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> writer);</P>
<P></FONT><FONT color=#008000 size=2>//RootElementName</P></FONT><FONT size=2>
<P>writer.WriteEndElement();</P>
<P></FONT><FONT color=#008000 size=2>//Commit everything to our underlying MemoryStream</P></FONT><FONT size=2>
<P>writer.Flush();</P>
<P></FONT><FONT color=#008000 size=2>// Set the position to the beginning of the stream</P></FONT><FONT size=2>
<P>objMS.Position = 0;</P>
<P></FONT><FONT color=#008000 size=2>//Create a streamreader object based on our Memory Stream</P></FONT><FONT size=2>
<P></FONT><FONT color=#2b91af size=2>StreamReader</FONT><FONT size=2> objsr = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>StreamReader</FONT><FONT size=2>(objMS);</P>
<P></FONT><FONT color=#008000 size=2>// Return the entire contents of our MemoryStream</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> objsr.ReadToEnd();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ToXML()</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> ToXML(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, </FONT><FONT color=#a31515 size=2>"CSLA_Collection"</FONT><FONT size=2>);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>XmlWriter</FONT><FONT size=2> objXMLTW)</P>
<P>{</P>
<P></FONT><FONT color=#008000 size=2>// this is a child collection, cascade the call</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>foreach</FONT><FONT size=2> (C child </FONT><FONT color=#0000ff size=2>in</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>)</P>
<P>((Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>)child).DumpToXML(</FONT><FONT color=#0000ff size=2>ref</FONT><FONT size=2> objXMLTW);</P>
<P>}</P></FONT><FONT color=#0000ff size=2>
<P>#endregion</P></FONT></FONT><FONT size=2>
<P><STRONG><FONT size=4>3) Code in the UI<FONT color=#2b91af><FONT color=#2b91af><FONT color=#2b91af size=2></P></FONT></FONT></FONT></FONT></STRONG></FONT><FONT size=2><FONT size=2></FONT><FONT size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>try</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>using</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>StatusBusy</FONT><FONT size=2> busy = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>StatusBusy</FONT><FONT size=2>(</FONT><FONT color=#a31515 size=2>"Saving..."</FONT><FONT size=2>))</P>
<P>{</P>
<P>RebindUI(</FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.Close();</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>catch</FONT><FONT size=2> (Csla.</FONT><FONT color=#2b91af size=2>DataPortalException</FONT><FONT size=2> ex)</P>
<P>{</P>
<P></FONT><FONT color=#2b91af size=2>EnterpriseHelper</FONT><FONT size=2>.Log(((Csla.Core.</FONT><FONT color=#2b91af size=2>IUndoableObject</FONT><FONT size=2>)ex.BusinessObject).ToXML(), </FONT><FONT color=#a31515 size=2>"Exceptions"</FONT><FONT size=2>);</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>EnterpriseHelper</FONT><FONT size=2>.HandleException(ex.BusinessException))</P>
<P></FONT><FONT color=#0000ff size=2>throw</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#008000 size=2>//MessageBox.Show(ex.BusinessException.ToString(),</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// "Error saving", MessageBoxButtons.OK,</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>// MessageBoxIcon.Exclamation);</P></FONT><FONT size=2>
<P>}</P></FONT></FONT><FONT size=2><FONT size=2></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Wednesday, October 22, 2008</h2><P>I've moved to version 3.5.2 of the csla framework.</P>
<P>I need again this possibility to dump the object state.</P>
<P>But in version 3.5.2 I now get an error:</P>
<P>type Csla.Core.FieldManager.FieldDataManager can't be casted to Csla.Core.<FONT color=#2b91af>IUndoableObject</FONT></P>
<P>Apparently FieldDataManager is something new in this version. Lhotka, can you tell what I have to&nbsp;change so that the code works again?<FONT size=2></P>
<P>Below an extract of the code where it fails: (see in previous reply for the whole code)</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>internal</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DumpToXML(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ref</FONT></FONT><FONT size=2> XmlWriter objXmlWriter)</P>
<P>{</P>
<P>....</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; object</FONT></FONT><FONT size=2> value = field.GetValue(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>);</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp; // make sure the variable has a value</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; if</FONT></FONT><FONT size=2> (value != </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>)</P>
<P>&nbsp; {</P>
<P></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp; // this is a child object, cascade the call</P></FONT></FONT><FONT size=2>
<P>&nbsp; ((Core.<FONT color=#2b91af>IUndoableObject</FONT>).DumpToXML(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ref</FONT></FONT><FONT size=2> objXmlWriter);&nbsp; &gt;&gt;&gt;&gt;&gt;&gt;&gt; it is failing here</P>
<P>&nbsp;}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>else</P></FONT></FONT><FONT size=2>
<P>{</P></FONT><FONT size=2>
<P>}</P></FONT>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 22, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>The field manager is new in 3.5, and offers an alternative to
storing your field data in private fields. I added this to simplify the
creation of CSLA .NET for Silverlight, which doesn&#8217;t allow reflection
against private fields (and so doesn&#8217;t have the BinaryFormatter or
NetDataContractSerializer).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>You are basically writing a serializer. And that&#8217;s fine in
.NET. But in CSLA 3.5 and higher you&#8217;ll need to serialize private fields
like you are doing, AND you&#8217;ll need to serialize the field manager in a
different manner. Look at Csla\Serialization\Mobile\MobileFormatter to get some
ideas.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Thursday, October 23, 2008</h2>Thanks for the clarification.<br>
<br>
So to have a complete view of the object I have to manage two things:<br>
1) the private fields in the old fashion way<br>
2) fields stored in the field manager<br>
<br>
The MobileFormatter does exist only in CSLA.NET for SilverLight and not
in CSLA.NET for Windows. What is the reason you didn't implement this
in CSLA.NET for Windows?<br>
<br>
By adding the following code (see further) in FieldDataManager.cs it is working again:<br>
(I've created a seperate interface ILogging in place of using the interface IUndoableObject)<br>
<br>
Lhotka : would it be possible to add this maybe in your latest version?<br>
I'm putting some error trapping into my WinForms application and I
think a helpful thing to record in a log file would be an XML version
of the object so I can get an idea of what the user was working with
when
then application crashes. <br>

So I'd like a way to cause an object and all of it's
children/collections to be converted to XML so it may be saved to a log file.&nbsp; This way I can examine the object in
instances of hard to crack bugs.<br>
<br>
Code:<br>
&nbsp;&nbsp;&nbsp; #region&nbsp; Alef: ILogging<br>
&nbsp;&nbsp;&nbsp; void Core.ILogging.DumpState()<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DumpState();<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; string Core.ILogging.ToXML()<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ToXML();<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; void Core.ILogging.DumpToXML(ref XmlWriter objXmlWriter)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DumpToXML(ref&nbsp; objXmlWriter);<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; #endregion<br>
<br>
&nbsp;&nbsp;&nbsp; #region "Alef: Logging/Debugging functions"<br>
<br>
&nbsp;&nbsp;&nbsp; #region " To Output Window "<br>
&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>
&nbsp;&nbsp;&nbsp; /// Alef:Dump the entire state of an object graph (root object, its child objects, etc) to the output window<br>
&nbsp;&nbsp;&nbsp; /// in the VS.NET IDE while debugging<br>
&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>
&nbsp;&nbsp;&nbsp; [EditorBrowsable(EditorBrowsableState.Never)]<br>
&nbsp;&nbsp;&nbsp; protected internal void DumpState()<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.IndentSize = 2;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IFieldData[] state = new IFieldData[_propertyList.Count];<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var index = 0; index &lt; _fieldData.Length; index++)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var item = _fieldData[index];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (item != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var child = item.Value as ILogging;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.Indent();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Debug.WriteLine("CHILD " +
item.Name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // cascade call to child<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.DumpState();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.Unindent();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.WriteLine(item.Name + ": " + item.Value.ToString());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; #endregion<br>
<br>
&nbsp;&nbsp;&nbsp; #region " ToXML "<br>
&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>
&nbsp;&nbsp;&nbsp; /// Alef:Dump the entire state of an object graph
(root object, its child objects, etc) to human readable XML <br>
&nbsp;&nbsp;&nbsp; /// (for debugging purposes)<br>
&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>
&nbsp;&nbsp;&nbsp; [EditorBrowsable(EditorBrowsableState.Never)]<br>
&nbsp;&nbsp;&nbsp; protected internal string ToXML()<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ToXML(true, "CSLA_Object");<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
<br>
&nbsp;&nbsp;&nbsp; private string ToXML(bool includeDocumentTag, string rootElementName)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemoryStream objMS = new MemoryStream();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XmlWriterSettings settings = new XmlWriterSettings();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Write individual elements on new lines and indent<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; settings.Indent = true;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Indent with Tabs<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; settings.IndentChars = "\t";<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XmlWriter writer = XmlWriter.Create(objMS, settings);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Write XML data.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (includeDocumentTag)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Begin with our XML Header<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Standalone: Dit attribuut
is een aanwijzing voor de verwerker dat dit document wel of niet<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // het gebruik van een
extern DTD-bestand of een extern entiteitenbestand vereist. Als je een <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // goed opgesteld
XML-document maakt, gebruik je geen externe DTD, dus dan wordt de
waarde yes.&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.WriteStartDocument(true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.WriteStartElement(rootElementName);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.DumpToXML(ref writer);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //RootElementName<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.WriteEndElement();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Commit everything to our underlying MemoryStream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.Flush();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Set the position to the beginning of the stream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objMS.Position = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Create a streamreader object based on our Memory Stream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StreamReader objsr = new StreamReader(objMS);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Return the entire contents of our MemoryStream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return objsr.ReadToEnd();<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<br>
&nbsp;&nbsp;&nbsp; /// Alef:Dump the entire state of an object graph
(root object, its child objects, etc) to human readable XML <br>
&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<br>
&nbsp;&nbsp;&nbsp; /// &lt;param name="objXmlWriter"&gt;<br>
&nbsp;&nbsp;&nbsp; /// The XmlWriter object that you want to use as the underlying writer.<br>
&nbsp;&nbsp;&nbsp; /// &lt;/param&gt;<br>
&nbsp;&nbsp;&nbsp; [EditorBrowsable(EditorBrowsableState.Never)]<br>
&nbsp;&nbsp;&nbsp; protected internal void DumpToXML(ref XmlWriter objXmlWriter)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IFieldData[] state = new IFieldData[_propertyList.Count];<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var index = 0; index &lt; _fieldData.Length; index++)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var item = _fieldData[index];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (item != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var child = item.Value as ILogging;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (child != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objXmlWriter.WriteStartElement(item.Name);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // cascade call to child<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child.DumpToXML(ref objXmlWriter);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objXmlWriter.WriteEndElement();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
objXmlWriter.WriteElementString(item.Name, item.Value.ToString());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; // ToXML_Header and ToXML_Footer are not redundant because<br>
&nbsp;&nbsp;&nbsp; // we had some instances where we were using the methods to log the state of objects <br>
&nbsp;&nbsp;&nbsp; // in the middle of a complex business operation, so we would create a single xml document<br>
&nbsp;&nbsp;&nbsp; // that had a "before" and "after" version of a business object. <br>
&nbsp;&nbsp;&nbsp; // All in one xml doc.&nbsp; So, we needed that ability to write the header and footer seperately.<br>
&nbsp;&nbsp;&nbsp; private string ToXML_Footer(string RootElementName)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&lt;/CSLA_Object&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ("\r\n" + "&lt;/" + RootElementName + "&gt;" + "\r\n");<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; private string ToXML_Header(string RootElementName)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&lt;CSLA_Object&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ("&lt;?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?&gt;" +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"\r\n" + "&lt;" + RootElementName + "&gt;" + "\r\n");<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; #endregion<br>
<br>
&nbsp;&nbsp;&nbsp; #endregion<br>
<br>
<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 23, 2008</h2>






 





<div class=Section1>

<p class=MsoNormal><span>The MobileFormatter exists in both Silverlight and Windows. The reason
for MobileFormatter is to allow the data portal to communicate between
Silverlight and Windows, and it is necessary because Silverlight doesn&#8217;t
have a powerful enough serializer to meet the data portal&#8217;s needs. This
blog post may help<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><a href="http://www.lhotka.net/weblog/CSLALightSerializationImplementation.aspx">http://www.lhotka.net/weblog/CSLALightSerializationImplementation.aspx</a><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I do not plan to add a DumpState() concept to the framework.
This could (and should) be constructed as an external tool (DLL), and isn&#8217;t
something that I think belongs in the framework itself.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>alef replied on Saturday, March 07, 2009</h2><P>Can you show me how to externalize this code?&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Geeky replied on Friday, October 24, 2008</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsbaker0:</strong></div><div>
<P>On a related note, we had similar issues with "in grid" editing using the DevExpress XtraGrid. Once the user leaves the row, no further corrections are possible.</P>
<P>Most grid, including this one, provide for the capability to stop the row focus from changing, but we had all sorts of weird issues -- like you couldn't even click on some totally unrelated window. Validation exceptions where flying everywhere...</P>
<P>At least for the time being, we have resolved this problem by discarding the users changes if we ge a validation exception when no further correction is readily feasible. Not optimal, but if the user is ignoring errors displayed to them... </P>
<P></div></BLOCKQUOTE></P>
<P>Sorry that this is a bit off topic and late ;-)</P>
<P>I'm working on a Dev Express based project atm and they seem to think that it is ok to just swallow every error :-(&nbsp; I have found that often you just need to handle BaseEdit.InvalidValue and throw the error yourself (or change the default behaviour to throw instead of swallow).</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
