<html><header><title>WPF PropertyStatus and Tabs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WPF PropertyStatus and Tabs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9590.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom posted on Wednesday, September 29, 2010</h2><p>I&#39;m using the Telerik Tab Control.&nbsp; I have controls on one tab which cause business rule validations to controls on a different tab, i.e. if a certain value in a dropdown is selected then a field on another tab is required.</p>
<p>Apparently the Telerik Tab Control doesn&#39;t initialize it&#39;s tabs until they are brought into view, so when I invalidate a field, then click on that tab, I only see the textbox with a red error border around it and DON&#39;T see a visible propertystatus with it&#39;s error icon and popup.&nbsp; Once I have been to the tab and go back to the drop down on the other tab, select a value to clear the broken rule, then select a value to break a rule again, I can select the other tab and I CAN see the propertystatus this time.&nbsp; What is the best way to get the propertystatus to reevaluate itself visually?&nbsp; I can see a protected GoToState method in the PropertyStatus code, but it has some checks in it so that if the state hadn&#39;t changed from the previous state, it won&#39;t reevaluate.&nbsp; I&#39;ve tried subclassing the PropertyStatus, but there are a number of private members that make this difficult.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, September 30, 2010</h2><p>The primary trigger PropertyStatus uses to know it should refresh is a PropertyChanged event from the data source object. It will also refresh if the DataContext is changed.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 30, 2010</h2><p>Yes it does, but it doesn&#39;t refresh if the status hasn&#39;t changed.&nbsp; If the status is already error, which it is, and I call a propertychanged, it checks if the status is the same, which it is, and doesn&#39;t refresh.</p>
<p>Code from the GoToState method</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newState != _lastState)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _lastState = newState;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DisablePopup(_lastImage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VisualStateManager.GoToState(this, newState, useTransitions);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newState != &quot;Busy&quot; &amp;&amp; newState != &quot;PropertyValid&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _lastImage = (FrameworkElement)FindChild(this, string.Format(&quot;{0}Image&quot;, newState.ToLower()));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EnablePopup(_lastImage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, September 30, 2010</h2><p>Are you using 4.0.1? We changed some of this behavior from 4.0 to 4.0.1 so there are more conditions under which it will refresh.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 30, 2010</h2><p>I&#39;m using 4.0.1</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Thursday, September 30, 2010</h2><p>So am I.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, September 30, 2010</h2><p>Fair enough. Let me put this another way then. What would you like to see? </p>
<p>I assume you&#39;d like the control to just automatically work in this scenario, though I&#39;m not entirely sure that&#39;s possible given the loading/rendering order of events.</p>
<p>Is there some (possibly optional) event the control could be listening for to do a forced refresh?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 30, 2010</h2><p>Ideally, if I could have the propertystatus forced refresh fire on a tab selection event, perhaps using a TriggerEvent, though the project I&#39;m working on hasn&#39;t been upgraded to MVVM yet, or I could handle each propertystatus individually in a tab selection event.&nbsp; So I believe what I would like is a public method which forces a state update.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, September 30, 2010</h2><p>If there was a &quot;public void Redraw()&quot; method, it would support code-behind and TriggerAction since both can invoke methods with no parameters.</p>
<p>Do you want to prototype this idea and see if it meets your needs?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 30, 2010</h2><p>Yes, I&#39;ll try to get to it this afternoon.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Thursday, September 30, 2010</h2><p>I think I&#39;ve come up with a better solution.&nbsp; I&#39;ve tested it,&nbsp;and it does work in my scenario.</p>
<p>I&#39;ve added and modified the following code to PropertyStatus.&nbsp; It can then be invoked by xaml &lt;csla:PropertyStatus IsForceRedraw=&quot;True&quot; ...</p>
<pre style="font-family:consolas;"><span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;_isForceRedraw&nbsp;=&nbsp;<span style="color:blue;">false</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Gets&nbsp;a&nbsp;value&nbsp;indicating&nbsp;whether&nbsp;PropertyStatus</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;will&nbsp;redraw&nbsp;even&nbsp;if&nbsp;the&nbsp;state&nbsp;remains&nbsp;the&nbsp;same</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">Category</span>(<span style="color:#a31515;">&quot;Property&nbsp;Status&quot;</span>)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;IsForceRedraw&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;_isForceRedraw;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_isForceRedraw&nbsp;=&nbsp;<span style="color:blue;">value</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<pre style="font-family:consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;Updates&nbsp;the&nbsp;status&nbsp;of&nbsp;the&nbsp;Property&nbsp;in&nbsp;UI</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/summary&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;param&nbsp;name=</span><span style="color:gray;">&quot;useTransitions&quot;</span><span style="color:gray;">&gt;</span><span style="color:green;">if&nbsp;set&nbsp;to&nbsp;</span><span style="color:gray;">&lt;c&gt;</span><span style="color:green;">true</span><span style="color:gray;">&lt;/c&gt;</span><span style="color:green;">&nbsp;then&nbsp;use&nbsp;transitions.</span><span style="color:gray;">&lt;/param&gt;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">virtual</span>&nbsp;<span style="color:blue;">void</span>&nbsp;GoToState(<span style="color:blue;">bool</span>&nbsp;useTransitions)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(_loading)&nbsp;<span style="color:blue;">return</span>;<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">BusyAnimation</span>&nbsp;busy&nbsp;=&nbsp;FindChild(<span style="color:blue;">this</span>,&nbsp;<span style="color:#a31515;">&quot;busy&quot;</span>)&nbsp;<span style="color:blue;">as</span>&nbsp;<span style="color:#2b91af;">BusyAnimation</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(busy&nbsp;!=&nbsp;<span style="color:blue;">null</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;busy.IsRunning&nbsp;=&nbsp;IsBusy;<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;newState;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(IsBusy)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newState&nbsp;=&nbsp;<span style="color:#a31515;">&quot;Busy&quot;</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span>&nbsp;<span style="color:blue;">if</span>&nbsp;(IsValid)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newState&nbsp;=&nbsp;<span style="color:#a31515;">&quot;PropertyValid&quot;</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newState&nbsp;=&nbsp;RuleSeverity.ToString();<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(_isForceRedraw&nbsp;||&nbsp;newState&nbsp;!=&nbsp;_lastState)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastState&nbsp;=&nbsp;newState;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisablePopup(_lastImage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">VisualStateManager</span>.GoToState(<span style="color:blue;">this</span>,&nbsp;newState,&nbsp;useTransitions);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(newState&nbsp;!=&nbsp;<span style="color:#a31515;">&quot;Busy&quot;</span>&nbsp;&amp;&amp;&nbsp;newState&nbsp;!=&nbsp;<span style="color:#a31515;">&quot;PropertyValid&quot;</span>)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lastImage&nbsp;=&nbsp;(<span style="color:#2b91af;">FrameworkElement</span>)FindChild(<span style="color:blue;">this</span>,&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#a31515;">&quot;{0}Image&quot;</span>,&nbsp;newState.ToLower()));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnablePopup(_lastImage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /></pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Friday, October 08, 2010</h2><p>Alas(who uses Alas), my above change doesn&#39;t work entirely.&nbsp; My window has a gridview and a detail control where&nbsp;the propertystatus controls are.&nbsp; Using this solution, I can see the propertystatus in error correctly, however, if I click on a different row in the&nbsp;grid, which changes the datacontext of the detail control, the&nbsp;propertystatus in the detail control still shows as error.&nbsp; I have also verified that&nbsp;the source it is still pointing to is still the old row.&nbsp; Here&#39;s the kicker,&nbsp;if I go and type something into the textbox in error and navigatge rows,&nbsp;the propertystatus finds itself again and shows properly for each row.&nbsp; I&#39;m completely baffled by this behavior.&nbsp; Any ideas on what is going on?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Curelom replied on Monday, October 11, 2010</h2><p>I&#39;ve narrowed down this latest issue I am having.&nbsp; It doesn&#39;t have anything to do with tabs or the changes I have made.&nbsp; I built a test app to duplicate the problem to put it out here, but the test app works perfectly. <img src="http://forums.lhotka.net/emoticons/emotion-6.gif" alt="Sad" />&nbsp; Anyway, enough of my rambling.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Russ replied on Thursday, September 30, 2010</h2><p>I have observed the same behaviour using the Microsoft Tab control in VS2010.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
