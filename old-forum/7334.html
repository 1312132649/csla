<html><header><title>Validation Rules Priority and Inheritance</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation Rules Priority and Inheritance</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7334.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cdkisa posted on Friday, July 24, 2009</h2>If I have a base class that has validation rules and I inherit that class and add even more validation rules, how do I know in which priority they will run?<br /><br />Will the base priorities run "seperately" in order before the derived rules run in order?<br /><br />Example:<br />Public Class MyBusinessBase(Of T As MyBusinessBase(Of T))<br />    ...<br />    Protected Overrides Sub AddBusinessRules()<br />        'ADD BASE VALIDATION RULES WITH PRIORITIES<br />		ValidationRules.AddRule(AddressOf Csla.Validation.CommonRules.StringRequired, _Name, 0)<br />		ValidationRules.AddRule(AddressOf Csla.Validation.CommonRules.StringMaxLength, New Csla.Validation.CommonRules.MaxLengthRuleArgs(_Name, 50), 1)<br />	Sub<br />End Class<br /><br />Public Class DerivedBusinessClass<br />    Inherits MyBusinessBase(Of DerivedBusinessBase)<br />    ...<br />    Protected Overrides Sub AddBusinessRules()<br />        'ADD VALIDATION RULES WITH PRIORITIES<br />		ValidationRules.AddRule(AddressOf Csla.Validation.CommonRules.StringRequired, _Prefix, 0)<br />		ValidationRules.AddRule(AddressOf Csla.Validation.CommonRules.StringRequired, _Suffix, 1)<br />    End Sub<br />End Class<br /><br />Cheers,<br />Pat</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, July 24, 2009</h2><P>All the priority 0 rules run first. Then all the priority 1 rules. Then 2,3,4, etc.</P>
<P>The inheritance level does not make any difference. All the rules are "gathered up" first and put in priority order.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cdkisa replied on Friday, July 24, 2009</h2>So I should create category ranges for the rules.<br /><br />I.E. <br /><br />Non-database lookups: 0 - 100<br />Database lookups: 101-200<br /><br />Thanks for the info.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Friday, July 24, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div><P>All the priority 0 rules run first. Then all the priority 1 rules. Then 2,3,4, etc.</P><br /><P>The inheritance level does not make any difference. All the rules are "gathered up" first and put in priority order.</P><br /><P>Joe</P><br /><P>&#160;</P></div></BLOCKQUOTE><br /><br />Just to be clear, I'm not sure this is true when rules fire for dependent properties. <br /><br />When a particular property changes, its own rules definitely execute in priority order, but I observed rules executing out of priorty order when rules fired for dependent properties.<br /><br />At the tiime, I was using short-circuiting and thought I could "guarantee" that a rule of lower priority would not execute by short-circuiting an earlier rule, but this didn't work. So, I try not to depend on the order of execution being absolute.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, July 24, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>rsbaker0:</strong></div><div><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>JoeFallon1:</strong></div><div>
<P>All the priority 0 rules run first. Then all the priority 1 rules. Then 2,3,4, etc.</P>
<P>The inheritance level does not make any difference. All the rules are "gathered up" first and put in priority order.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P></div></BLOCKQUOTE> Just to be clear, I'm not sure this is true when rules fire for dependent properties. When a particular property changes, its own rules definitely execute in priority order, but I observed rules executing out of priorty order when rules fired for dependent properties. At the tiime, I was using short-circuiting and thought I could "guarantee" that a rule of lower priority would not execute by short-circuiting an earlier rule, but this didn't work. So, I try not to depend on the order of execution being absolute.</div></BLOCKQUOTE></P>
<P>I just reviewed the book and then the code because I believe it does work correctly for dependent properties. The descriptive text in the book describes the various overloads for CheckRules pp327-330 in the VB book. The description say that the list is always sorted in priority order. Even for dependent properties. When I looked at the code the C# method</P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CheckRules(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ValidationRulesManager</FONT></FONT><FONT size=2> rules, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>string</FONT></FONT><FONT size=2> propertyName)</FONT></P>
<P><FONT size=2><FONT size=3>has the same body as the main method (with the exception of not calling for dependent propeties again so it is not recursive.)</FONT></FONT></P>
<P><FONT size=2><FONT size=3>I have to think that something else was happening which led you to believe it was not working correctly.</FONT></FONT></P>
<P><FONT size=2><FONT size=3>Joe</FONT></P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
