<html><header><title>WCF Timeouts when saving large collections</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>WCF Timeouts when saving large collections</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7925.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardmccavery posted on Monday, November 02, 2009</h2>I'm using the WCF data portal and I have noticed that whilst when calling Save() on a BusinessListBase collection of 87 objects (each object with child collections etc) I either get a :-<br /><br />CommunicationException "An error (The request was aborted: The request was canceled.) occurred while transmitting data over the HTTP channel." <br /><br />OR if using ReliableSession=true a<br /><br />TimeoutException "The request channel timed out while waiting for a reply after 00:00:57.9720000. Increase the timeout value passed to the call to Request or increase the SendTimeout value on the Binding. The time allotted to this operation may have been a portion of a longer timeout." <br /><br />I have discovered that essentially during my Save operation all 87 objects are being passed to the dataportal update WCF call, regardless of whether they are dirty or not.<br /><br />Can and should the WCF data portal be used for this type of update and if so, what is the best way to either make the Save() more efficient or prevent this error occuring ?<br /><br />Any thoughts would be most appreciated.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardmccavery replied on Monday, November 02, 2009</h2>I have set the value :-<br /><br /><br /><br />in my  web.config file for my WCF portal and no longer get the error messages.<br /><br />The save however is still slower than perhaps it should be because it's passing all 87 objects to the DataPortal_Update call.<br /><br />Is there any way of making this more efficient ?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, November 02, 2009</h2>Hi, <br><br>I guess you have another problem. If the save operation isn't completed with 1 minute (which you can increase tho)&nbsp; you should look at you DAL and how the save is performed. You could get into database deadlocks or other problems that stops the serverside thread for finishing. <br><br>Another issue is if you are doing MQ in you DAL and are not able to get a response - this will cause your thread to hang and the client will eventually get a timeout.<br><br>So - what I'm trying to say is that you must check what happends on the server during save. I'm assuming that it is not the transmission over "wire" that is&nbsp; the problem. <br><br>Csla by default does not use DiffGrams or transmits just the modified bits (as diskussed in Rockys book). There is tho a small sample in samples download that shows a possible way of doing Diffgrams. <br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DocJames replied on Monday, November 02, 2009</h2>Hi,<br /><br />If you take a look at the code found in this discussion: <a href="http://forums.lhotka.net/forums/thread/29681.aspx" target="_blank" title="http://forums.lhotka.net/forums/thread/29681.aspx">http://forums.lhotka.net/forums/thread/29681.aspx</a> you can see how to only update changed items.<br /><br />The code is old, but still works :)<br /><br />Also note the other posts - there is some discussion about only sending the Dirty objects when updating.<br /><br />Thanks,<br />Jimmy</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardmccavery replied on Monday, November 02, 2009</h2>The combination of the IIS setting change and the "only saving dirty items" code change you suggested have transformed my application !!!<br /><br />18 seconds down to sub second.  I knew it wasn't my data access layer !<br /><br />Many thanks guys !</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
