<html><header><title>Intermittent failure to Save Model from Silverlight Client</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Intermittent failure to Save Model from Silverlight Client</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11116.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gautamh posted on Thursday, February 02, 2012</h2><p>This is a really strange issue that I have not been able to reproduce on my development machinem but one that our QA team is regularly able to reproduce.</p>
<p>I have collection that is bound to a grid in silverlight. The user inserts a couple of new entries and update a few and clicks save. Sometimes, &quot;nothing&quot; happens. The button gets clicked but no request is reaching the server.</p>
<p>I have put debug statements on the silverlight client and can see that the collection is dirty and is savable. The Model is also savable.</p>
<p>However, the call fails to reach the data portal on the server side.</p>
<p>I have enabled wcf tracing on the server. But the data generated is huge and I&#39;m not sure what to look for. Is there anything in the IIS logs that I can look for or any area in the CSLA framework that I can put additional tracing to figure out why the call is failing to reach the server.</p>
<p>Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, February 02, 2012</h2><p>The first place I&#39;d put log/trace code is in the client-side callback code. I&#39;m assuming you always check e.Error, or in your viewmodel you override OnError?</p>
<p>There are (generally) three options:</p>
<ol>
<li>The button click event binding got disconnected and save wasn&#39;t called at all</li>
<li>Save was called and there was an error (e.Error or OnError will tell you what)</li>
<li>Save was called and WCF never returned the call (rare, and something I haven&#39;t seen since some beta of Silverlight long ago)</li>
</ol>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gautamh replied on Thursday, February 02, 2012</h2><p>Hi Rocky,</p>
<p>Thank you for the speedy reply.</p>
<p>I had already verified that:</p>
<p>(1) The button click event binding was connected and that Save was called.</p>
<p>(2) The Model was Dirty and Saveable.</p>
<p>(3) I do override the OnError and display the error messages on the screen.</p>
<p>However, I will put in additional tracing on the client callbacks to see if flow of control reaches the callback code. I will also put in a trace to check if the wcf proxy is being created.</p>
<p>Any other suggestions would be appreciated.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gautamh replied on Friday, February 03, 2012</h2><p>An update here. I managed to capture the exception that is being thrown. It is the dreaded &quot;Csla.Core.UndoException: Edit level mismatch in AcceptChanges&quot;.</p>
<p>However, I&#39;m at a complete loss to understand why this occurs <i>only </i>on the QA machine and not on any of the developers or end users machines. I cannot ignore this as any QA issue is a potential production issue.</p>
<p>Any help or suggestions here will be hugely appreciated.</p>
<p>ViewModelBase&lt;T&gt;.BeginSave().Catch -- Csla.Core.UndoException: Edit level mismatch in AcceptChanges &nbsp;&nbsp;&nbsp; <br />00000025&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Rules.BusinessRules.Csla.Core.IUndoableObject.AcceptChanges(Int32 parentEditLevel, Boolean parentBindingEdit) &nbsp;&nbsp;&nbsp; <br />00000026&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.BusinessBase.AcceptingChanges() &nbsp;&nbsp;&nbsp; <br />00000027&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.AcceptChanges(Int32 parentEditLevel) &nbsp;&nbsp;&nbsp; <br />00000028&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.Csla.Core.IUndoableObject.AcceptChanges(Int32 parentEditLevel, Boolean parentBindingEdit) &nbsp;&nbsp;&nbsp; <br />00000029&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.UndoableBase.ResetChildEditLevel(IUndoableObject child, Int32 parentEditLevel, Boolean bindingEdit) &nbsp;&nbsp;&nbsp; <br />00000030&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.BusinessListBase`2.InsertItem(Int32 index, C item) &nbsp;&nbsp;&nbsp; <br />00000031&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at System.Collections.ObjectModel.Collection`1.Add(T item) &nbsp;&nbsp;&nbsp; <br />00000032&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.MobileBindingList`1.OnSetChildren(SerializationInfo info, MobileFormatter formatter) &nbsp;&nbsp;&nbsp; <br />00000033&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.BusinessListBase`2.OnSetChildren(SerializationInfo info, MobileFormatter formatter) &nbsp;&nbsp;&nbsp; <br />00000034&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.MobileBindingList`1.Csla.Serialization.Mobile.IMobileObject.SetChildren(SerializationInfo info, MobileFormatter formatter) &nbsp;&nbsp;&nbsp; <br />00000035&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.DeserializeAsDTO(List`1 deserialized) &nbsp;&nbsp;&nbsp; <br />00000036&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(List`1 data) &nbsp;&nbsp;&nbsp; <br />00000037&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(XmlReader reader) &nbsp;&nbsp;&nbsp; <br />00000038&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Serialization.Mobile.MobileFormatter.Deserialize(Stream serializationStream) &nbsp;&nbsp;&nbsp; <br />00000039&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Core.ObjectCloner.Clone(Object obj) &nbsp;&nbsp;&nbsp; <br />00000040&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.BusinessListBase`2.GetClone() &nbsp;&nbsp;&nbsp; <br />00000041&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.BusinessListBase`2.Csla.ICloneable.Clone() &nbsp;&nbsp;&nbsp; <br />00000042&nbsp;&nbsp;&nbsp; 19.30083275&nbsp;&nbsp;&nbsp; [3904]&nbsp;&nbsp;&nbsp; at Csla.Xaml.ViewModelBase`1.BeginSave()</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, February 03, 2012</h2><p>The QA people must be following some steps that other people aren&#39;t following. This may be down to keystroke or mouse gesture level actions that somehow leaves focus on some control that keeps some edit level elevated or something.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
