<html><header><title>Use of delegates for Data Portal??</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Use of delegates for Data Portal??</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3908.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant posted on Friday, November 16, 2007</h2><P>Hi guys </P>
<P>I am relatively new to csla so please excuse me if this is a stupid question, but&nbsp;I was just wondering why delegates could not be used for determining which data layer method to execute from a given business layer method. Now Rocky/you might cover this reasoning in his/your book but i have not had a chance to read through it all yet, so if he/you does/do could you please point me in the direction as to why. </P>
<P>To qualify, when i say use delegates what I mean is as follows. It seems like if I am roughly following things correctly, at the moment when I want to fetch some data, the business method calls the fetch client data portal stub which then calls the fetch server data portal stub which then calls the data fetch method for the class in question. This requires that the all of the methods involved need to have a fetch method so that they can call the next required method. This makes it difficult if I want to add alternative list methods or any other methods to a class that have not been explicitly catered for by the framework. </P>
<P>So what I was wondering is, would it be possible to and if so why was this not done, to change the data portals to accept delegate references so that any methods could be called through the data portal and not just the ones that have been catered for? Now of course, if the system is setup to execute the data layer methods on a separate server, the client data portal would need to be able to pass the local delegate reference across to the server data portal and it would need to know how to hook it up so that the everything works (which might be easy said than done), but this seems like something that could be worthwhile. If this path was taken you might still need a couple different data portal methods to cater for different types of calls that can be made (like maybe one that excepts a criteria object, one that returns objects, I donâ€™t know what else some thought might need to go into that side of it but one would think that it would be achievable).</P>
<P>Now there might be a really good reason for not doing this or the idea might be really stupid as i said but the thought did occur to me as I was looking through the data portal code and how things connect and I thought it was worth asking.</P>
<P>
<P>Thanks<BR>Anthony</P></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Saturday, November 17, 2007</h2><P><SPAN>I know this is fairly simplistic and probably not very efficient but in theory it would look something like this</SPAN>:<BR><FONT size=2><FONT size=2></FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Program<BR></FONT><FONT size=2>{<BR></FONT></FONT><FONT size=2><FONT size=2><BR></FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Main(</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>[] args)<BR>{<BR></FONT><FONT color=#2b91af size=2>Client</FONT><FONT size=2> client = </FONT><FONT color=#2b91af size=2>Client</FONT><FONT size=2>.FetchClient(12);<BR>client.UpdateClient();<BR></FONT><FONT color=#2b91af size=2>Console</FONT><FONT size=2>.ReadLine();<BR>}<BR><BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Client<BR></FONT><FONT size=2>{<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> ClientId = -1;<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ClientName = </FONT><FONT color=#a31515 size=2>""</FONT><FONT size=2>;<BR><BR></FONT><FONT color=#008000 size=2>//Business Method<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Client</FONT><FONT size=2> FetchClient(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> clientId)<BR>{<BR></FONT><FONT color=#2b91af size=2>Client</FONT><FONT size=2> client = </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Client</FONT><FONT size=2>();<BR></FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.ExecuteRetrieveMethod(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.</FONT><FONT color=#2b91af size=2>RetrieveMethod</FONT><FONT size=2>(client.FetchClient_Data), </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Criteria</FONT><FONT size=2>(clientId));<BR></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> client;<BR>}<BR><BR></FONT><FONT color=#008000 size=2>//Business Method<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> UpdateClient()<BR>{<BR></FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.ExecutePersistMethod(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.</FONT><FONT color=#2b91af size=2>PersistMethod</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.UpdateClient_Data));<BR>}<BR><BR></FONT><FONT color=#008000 size=2>//Data Method<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> FetchClient_Data(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> criteria)<BR>{<BR></FONT><FONT color=#2b91af size=2>Criteria</FONT><FONT size=2> newCriteria = (</FONT><FONT color=#2b91af size=2>Criteria</FONT><FONT size=2>)criteria;<BR></FONT><FONT color=#008000 size=2>//Call to database <BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.ClientId = 12;<BR></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.ClientName = </FONT><FONT color=#a31515 size=2>"Hello World"</FONT><FONT size=2>; <BR>}<BR><BR></FONT><FONT color=#008000 size=2>//Data Method<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> UpdateClient_Data()<BR>{<BR></FONT><FONT color=#008000 size=2>//Call to database<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.ClientName = </FONT><FONT color=#a31515 size=2>"Hello World -- Update"</FONT><FONT size=2>;<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>Criteria<BR></FONT><FONT size=2>{<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> Criteria(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> clientId)<BR>{<BR></FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.ClientId = clientId;<BR>}<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> ClientId = -1;<BR>}<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ClientDataPortal<BR></FONT><FONT size=2>{<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>delegate</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>PersistMethod</FONT><FONT size=2>();<BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>delegate</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>RetrieveMethod</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> criteria);<BR></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> _IsUsingRemoteDataAccess = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<BR></FONT><FONT color=#0000ff size=2><BR>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecuteRetrieveMethod(</FONT><FONT color=#2b91af size=2>RetrieveMethod</FONT><FONT size=2> retrieveMethod, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> currentCriteria)<BR>{<BR></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>._IsUsingRemoteDataAccess)<BR></FONT><FONT color=#2b91af size=2>ServerDataPortal</FONT><FONT size=2>.ExecuteRetrieveMethod(retrieveMethod.Target, retrieveMethod.Method.Name, currentCriteria);<BR></FONT><FONT color=#0000ff size=2>else<BR></FONT><FONT size=2></FONT><FONT color=#2b91af size=2>ServerDataPortal</FONT><FONT size=2>.ExecuteRetrieveMethod(retrieveMethod, currentCriteria);<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecutePersistMethod(</FONT><FONT color=#2b91af size=2>PersistMethod</FONT><FONT size=2> persistMethod)<BR>{<BR></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>._IsUsingRemoteDataAccess)<BR></FONT><FONT color=#2b91af size=2>ServerDataPortal</FONT><FONT size=2>.ExecutePersistMethod(persistMethod.Target, persistMethod.Method.Name);<BR></FONT><FONT color=#0000ff size=2>else<BR></FONT><FONT size=2></FONT><FONT color=#2b91af size=2>ServerDataPortal</FONT><FONT size=2>.ExecutePersistMethod(persistMethod);<BR>}<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ServerDataPortal<BR></FONT><FONT size=2>{<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecuteRetrieveMethod(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> currentObject, </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> retrieveMethod, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> currentCriteria)<BR>{<BR>currentObject.GetType().InvokeMember(retrieveMethod, System.Reflection.</FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.InvokeMethod, </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>, currentObject, </FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2>[1]{ currentCriteria });<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecuteRetrieveMethod(</FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.</FONT><FONT color=#2b91af size=2>RetrieveMethod</FONT><FONT size=2> retrieveMethod, </FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> currentCriteria)<BR>{<BR>retrieveMethod(currentCriteria);<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecutePersistMethod(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> currentObject, </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> persistMethod)<BR>{<BR>currentObject.GetType().InvokeMember(persistMethod, System.Reflection.</FONT><FONT color=#2b91af size=2>BindingFlags</FONT><FONT size=2>.InvokeMethod, </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>, currentObject, </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>);<BR>}<BR><BR></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> ExecutePersistMethod(</FONT><FONT color=#2b91af size=2>ClientDataPortal</FONT><FONT size=2>.</FONT><FONT color=#2b91af size=2>PersistMethod</FONT><FONT size=2> persistMethod)<BR>{<BR>persistMethod();<BR>}<BR>}<BR></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Sunday, November 18, 2007</h2><P>Any feedback on this one??<BR>Thanks <BR>Anthony</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, November 19, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>vdhant:</strong></div><div>
<P>So what I was wondering is, would it be possible to and if so why was this not done, to change the data portals to accept delegate references so that any methods could be called through the data portal and not just the ones that have been catered for? </P>
<P></div></BLOCKQUOTE></P>
<P>What you are describing is a broader concept called an object portal. The data portal is a very specific implementation of this concept, designed to support data access.</P>
<P>CSLA is intententionally a prescriptive architecture, and CSLA .NET is a framework designed to assist and guide developers in following that architecture.</P>
<P>The object portal concept is very broad and very powerful, but is not very prescriptive. While I love the pattern and think it is very cool, I don't think the broader implementation has a place in CSLA .NET, because it would allow too much flexibility in how objects are created and that would defeat the benefits of a prescriptive architecture and of a highly consistent pattern for object creation and usage.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vdhant replied on Monday, November 19, 2007</h2><P class=MsoNormal><FONT face=Calibri>Thanks a lot for your reply. </FONT></P>
<P class=MsoNormal><FONT face=Calibri>I have been thinking about this concept for a while but never knew what name to put to it. <SPAN>Although there doesnâ€™t seem to be much on this topic, does this mean that there isnâ€™t many implementations?? </SPAN>It makes sense now that you explain it that CSLA would not necessarily go down this track. I think that a CSLA or like framework that supported this would be very interesting but i agree that broader implementation would mean that there are too many ways that you could "shoot yourself in the foot" and not release it. </FONT></P>
<P class=MsoNormal><FONT face=Calibri>I appreciate the response and on another topic I just wanted to thank you for your book it really made me think about things in a different way and is one of the only books that i have found that talks about how to create a framework for the ground up and the challenges that one faces. </FONT></P>
<P class=MsoNormal><FONT face=Calibri>Keep up the great workâ€¦</FONT></P>
<P class=MsoNormal><FONT face=Calibri>Anthony </FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, November 19, 2007</h2><P>In addition to Rocky's response - many people have asked in the past if they could add other "DataPortal" methods. I believe this is one of the reasons Rocky came up with the Command Object and DataPortal_Execute. This new method allows you to run arbitrary code against the DB while making sure the BO that contains the code moves throught the DataPortal when necessary. So now you have Create, Fetch, Insert, Update and Execute. Not sure why you would need something outside of these 5.</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
