<html><header><title>PTracker: View project doesn't filter by name (like %2005%) - C#</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>PTracker: View project doesn't filter by name (like %2005%) - C#</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2321.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago posted on Sunday, February 11, 2007</h2><P>Filter projects in the database, not in C#. When you are handling a very large collection of projects, this takes the load off the network.</P>
<P>1-Create new stored procedure</P><FONT color=#008000 size=2>
<P><FONT face="Courier New">/****** Object: </FONT></FONT><FONT size=2></FONT><FONT face="Courier New" color=#008000 size=2>StoredProcedure [dbo].[listProjects] </FONT><FONT size=2></FONT><FONT face="Courier New"><FONT color=#008000 size=2>Script Date: 02/12/2007 00:24:41 ******/<BR></FONT><FONT color=#0000ff size=2>IF </FONT><FONT size=2></FONT><FONT color=#0000ff size=2>EXISTS </FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>SELECT </FONT><FONT size=2>* </FONT><FONT color=#0000ff size=2>FROM </FONT><FONT size=2>sys.objects </FONT><FONT color=#0000ff size=2>WHERE object_id </FONT><FONT size=2>= </FONT><FONT color=#0000ff size=2>OBJECT_ID</FONT><FONT size=2>(N</FONT><FONT color=#800000 size=2>'[dbo].[listProjects]'</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>AND </FONT><FONT size=2>type </FONT><FONT color=#0000ff size=2>in </FONT><FONT size=2>(N</FONT><FONT color=#800000 size=2>'P'</FONT><FONT size=2>, N</FONT><FONT color=#800000 size=2>'PC'</FONT></FONT><FONT face="Courier New"><FONT size=2>))<BR></FONT><FONT color=#0000ff size=2>DROP PROCEDURE </FONT></FONT><FONT face="Courier New"><FONT size=2>[dbo].[listProjects]<BR>GO<BR></FONT><FONT color=#008000 size=2>/****** Object: </FONT><FONT size=2></FONT><FONT color=#008000 size=2>StoredProcedure [dbo].[listProjects] </FONT><FONT size=2></FONT></FONT><FONT face="Courier New"><FONT color=#008000 size=2>Script Date: 02/12/2007 00:24:41 ******/<BR></FONT><FONT color=#0000ff size=2>SET </FONT><FONT size=2>ANSI_NULLS </FONT></FONT><FONT face="Courier New" color=#0000ff size=2>ON<BR></FONT><FONT face="Courier New" size=2>GO<BR></FONT><FONT face="Courier New" color=#0000ff size=2>SET QUOTED_IDENTIFIER ON<BR></FONT><FONT face="Courier New"><FONT size=2>GO<BR></FONT><FONT color=#0000ff size=2>IF NOT EXISTS </FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>SELECT </FONT><FONT size=2>* </FONT><FONT color=#0000ff size=2>FROM </FONT><FONT size=2>sys.objects </FONT><FONT color=#0000ff size=2>WHERE object_id </FONT><FONT size=2>= </FONT><FONT color=#0000ff size=2>OBJECT_ID</FONT><FONT size=2>(N</FONT><FONT color=#800000 size=2>'[dbo].[listProjects]'</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>AND </FONT><FONT size=2>type </FONT><FONT color=#0000ff size=2>in </FONT><FONT size=2>(N</FONT><FONT color=#800000 size=2>'P'</FONT><FONT size=2>, N</FONT><FONT color=#800000 size=2>'PC'</FONT></FONT><FONT face="Courier New" size=2>))<BR></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>BEGIN<BR>EXEC </FONT><FONT size=2>dbo.sp_executesql @statement = N</FONT></FONT><FONT face="Courier New" color=#800000 size=2>'CREATE PROCEDURE [dbo].[listProjects]<BR></FONT><FONT face="Courier New" color=#800000 size=2>(<BR></FONT><FONT face="Courier New" color=#800000 size=2>&nbsp;&nbsp;&nbsp;@mask varchar(MAX)<BR></FONT><FONT face="Courier New" color=#800000 size=2>)<BR>AS<BR></FONT><FONT face="Courier New" color=#800000 size=2>&nbsp;&nbsp;&nbsp;SELECT Id, Name<BR></FONT><FONT face="Courier New" color=#800000 size=2>&nbsp;&nbsp;&nbsp;FROM Projects<BR></FONT><FONT face="Courier New" color=#800000 size=2>&nbsp;&nbsp;&nbsp;WHERE Name LIKE @mask<BR></FONT><FONT face="Courier New" color=#800000 size=2>&nbsp;&nbsp;&nbsp;RETURN<BR>' <BR></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>END<BR></FONT><FONT size=2>GO</FONT></FONT></P>
<P>2-Go to project <FONT face="Courier New">ProjectTracker.Library</FONT> and edit <FONT face="Courier New">ProjectList.cs</FONT>, method <FONT face="Courier New">Fetch</FONT><BR>2.1-By default, show everything. Don't do this if your collection is really large<BR>Replace</P><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Fetch(</FONT><FONT color=#0000ff size=2>string</FONT></FONT><FONT face="Courier New" size=2> nameFilter)<BR></FONT><FONT face="Courier New"><FONT size=2>{<BR></FONT><FONT size=2></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;this</FONT><FONT size=2>.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</P></FONT></FONT>
<P>with</P><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> Fetch(</FONT><FONT color=#0000ff size=2>string</FONT></FONT><FONT face="Courier New"><FONT size=2> nameFilter)<BR>{<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT face="Courier New"><FONT size=2> (nameFilter.Length == 0)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nameFilter = </FONT><FONT color=#800000 size=2>"%"</FONT></FONT><FONT face="Courier New" size=2>;<BR>&nbsp;&nbsp;&nbsp;}<BR><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;this</FONT><FONT size=2>.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</FONT></FONT></P>
<P><FONT color=#000000>2.2-Pass the filter to the new stored procedure<BR>Replace</FONT></P><FONT size=2>
<P><FONT face="Courier New">cm.CommandText = </FONT></FONT><FONT face="Courier New"><FONT color=#800000 size=2>"getProjects"</FONT><FONT size=2>;</FONT></FONT></P>
<P><FONT color=#000000>with</FONT></P>
<P><FONT face="Courier New"><FONT size=2>cm.CommandText = </FONT><FONT color=#800000 size=2>"listProjects"</FONT></FONT><FONT face="Courier New"><FONT size=2>;<BR>cm.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@mask"</FONT><FONT size=2>, nameFilter);</FONT></FONT></P>
<P><FONT color=#000000>2.3-Comment out un necessary code<BR>Replace</FONT></P><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#008000 size=2>// apply filter if necessary<BR></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> ((nameFilter.Length == 0) || (info.Name.IndexOf(nameFilter) == 0))</FONT></FONT></P>
<P>with (comment the second line)</P><FONT size=2><FONT size=2>
<P></FONT><FONT face="Courier New"><FONT color=#008000 size=2>// apply filter if necessary<BR></FONT><FONT color=#008000 size=2>//if ((nameFilter.Length == 0) || (info.Name.IndexOf(nameFilter) == 0))</FONT></FONT></P>
<P><FONT color=#008000 size=2><FONT color=#000000 size=3></FONT></FONT>&nbsp;</P>
<P><FONT color=#008000 size=2><FONT color=#000000 size=3>That's it!</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, February 12, 2007</h2><P>Of course, however as I've noted on this forum many times before, as an author it is my job to show various ways to accomplish the same task, because one way is not always correct for all situations.</P>
<P>Virtually everyone knows how to do the filter in the database, so showing that teaches few people anything of value. But illustrating that you can, if necessary, do some of the work on the application server is perhaps of more value.</P>
<P>This is especially true if you consider more complex scenarios than filtering, where it may be simpler to build or maintain the code in C#/VB than in SQL. I've worked on apps before where the SQL code was pages in length and took minutes to run, but the equivalent VB code was just a few lines and took seconds.</P>
<P>Now there's no doubt that some super-SQL-expert could have done as well with SQL. But those people are hard to find, and hard to retain. And when they leave (as they always do) then you have no one left to maintain that SQL code. But good C#/VB people are much easier to find, so there's a lot less risk in writing the code in these languages.</P>
<P>Again, for something trivial like filtering or sorting, obviously the issue is not great. But there are case where this really is an issue, and it is good to illustrate how such logic can fit into the overall CSLA .NET coding patterns.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
