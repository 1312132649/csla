<html><header><title>CanExecute() Authorization Design Scope Question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CanExecute() Authorization Design Scope Question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11033.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Thursday, January 05, 2012</h2><p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">Hello.<br /></span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">Suppose you have a class with a method called &ldquo;DoIt()&rdquo; and a property called &ldquo;IsLocked&rdquo;. Suppose also that &ldquo;DoIt()&rdquo; can only be called by a user belonging to a&nbsp;particular role and it should only be called when the object is not locked. How would you design your &ldquo;DoIt()&rdquo; method? </span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">Would you do this (approach number one)?</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;"><br />public void DoIt()<br />{<br />&nbsp;&nbsp;&nbsp; CanExecuteMethod(DoItMethod, true);</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">&nbsp;&nbsp;&nbsp; if (IsLocked)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new YouCantDoThisIfObjectIsLocked();</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">&nbsp;&nbsp;&nbsp; // Code that does whatever DoIt() needs to do goes here.<br />}</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">In the example above, The &ldquo;CanExecuteMethod()&rdquo; would run an authorization rule that only checks if the user is in role, it does not care if the object is locked or not. If user is in role the function would proceed&nbsp; else an authorization error would be raised.</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">
<p><br />Or would you do this (approach number two):</p>
<p><br />public void DoIt()<br />{<br />&nbsp;&nbsp;&nbsp; CanExecuteMethod(DoItMethod, true);</p>
</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">&nbsp;&nbsp;&nbsp; // Code that does whatever DoIt() needs to do goes here.<br />}</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">In the example above, The &ldquo;CanExecuteMethod()&rdquo; would run an authorization rule that would check if the user is in role plus if the object is locked or not. If user is in role and the object is not locked the function would&nbsp;proceed else an authorization error would be raised.</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">What approach would you take? My gut feeling tells me that the way to go is approach number one. The reason for this is because I see the &ldquo;CanExecuteMethod()&rdquo; strictly as something that tells me if a user has the permissions to do something or not.&nbsp;I kind of feel that the business requirement of not being able to run the function while the object is locked belongs somewhere else.</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">So what woudl you do?</span></p>
<p><span style="widows:2;text-transform:none;background-color:#ffffff;text-indent:0px;letter-spacing:normal;font:12px Arial, Helvetica, sans-serif;white-space:normal;orphans:2;float:none;color:#000000;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;">Thanks for your help.<br /></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, January 05, 2012</h2><p>I am not convinced that there&#39;s a right or wrong answer.</p>
<p>However, I view authorization rules as <em>business rules</em>, not just as a role-based security concept.</p>
<p>There are many examples where authorization depends on the state of the object, the context of the application, and the identity of the user. Authorization rules should be able to take all those things into account.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Thursday, January 05, 2012</h2><p>My choice would be #2. </p>
<p>AuthorizationRules included in CSLA is only for role checking but is designed and supposed to be used for business rules as your description here. </p>
<p>You could then easily create a bool property in f.ex a ViewModel to say whether DoIt can be enabled or not based on CanExecuteMethod. </p>
<p>So my code would look like this:</p>
<p>&nbsp;&nbsp;&nbsp; public MethodInfo DoItMethod = RegisterMethod(o =&gt; o.DoIt());<br />&nbsp;&nbsp;&nbsp; public void DoIt()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanExecuteMethod(DoItMethod, true);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // actual code goes here..... <br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; // here shown is a private inner AuthorizationRule.<br />&nbsp;&nbsp;&nbsp; private class DoItAccess : Csla.Rules.CommonRules.IsInRole<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DoItAccess(AuthorizationActions action, IMemberInfo memberInfo, params string[] roles) : base(action, memberInfo, roles)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override bool CacheResult<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return false; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void Execute(AuthorizationContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // not in role then no access<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.Execute(context);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!context.HasPermission) return;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; // check if object is locked <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var locked = (bool) ReadProperty(context.Target, Root.LockedProperty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.HasPermission = !locked;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Friday, January 06, 2012</h2><p>Thank you Rocky and Jonny for your feed back.</p>
<p>You know, the funny thing is that we were using &quot;approach&nbsp;number two&quot; first but we started&nbsp;over thinking&nbsp;the approach and&nbsp;decided&nbsp;to switch to &quot;approach number one&quot; but as we were switching we started once again over thinking the&nbsp;approach&nbsp;and we ended up running in circles and I finally decided to post for help.</p>
<p>I think we will stick with approach number two then.</p>
<p>Thank you very much.</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
