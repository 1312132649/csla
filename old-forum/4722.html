<html><header><title>Rebind BindingSource to another object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Rebind BindingSource to another object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4722.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kyle77 posted on Monday, April 21, 2008</h2><P>Note: I posted this same question at the following location, but have also posted here because it references something from Rocky's book that doesn't seem to be working correctly for us:</P>
<P><A href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3214089&amp;SiteID=1&amp;mode=1">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3214089&amp;SiteID=1&amp;mode=1</A></P>
<P>I've been running into a problem with data binding on a .NET Windows Forms application.&nbsp; I've found a couple work-arounds, but neither one really feels right to me -- it just seems like there should be a better way.&nbsp; So I guess I'm asking what is the best practice approach to solving the scenario I'll describe below?</P>
<P>First off, I have a business object, Customer, with several customer-related properties and an additional property to return a BindingList of another type of business object, we'll just call that property "MySubList".</P>
<P>Next, I have a UserControl, call it CustomerCtrl, that will display some of the various customer-related properties in Label controls and will display the BindingList property, "MySubList", in a DataGridView.&nbsp; I plan to accomplish this via data binding using a BindingSource intermediary.&nbsp; When I created the UserControl in the VS designer, I placed the Labels, DataGridView, and CustomerBindingSource on the control, so those controls are declared in the designer-generated code.</P>
<P>I intend to use the CustomerCtrl on the MainForm for the application.&nbsp; It will always be visible.&nbsp; There will be menu options to create a new customer, delete the current customer (displayed in the CustomerCtrl), and open a different customer (to replace the currently display customer in the CustomerCtrl).&nbsp; From the MainForm or application logic, I need to be able to tell the CustomerCtrl to now use a different Customer business object for its data binding.&nbsp; It is at that point where I run into problems.</P>
<P>The basics of what needs to happen for data binding the CustomerCtrl to a new Customer is something like the following:</P>
<P><BR>private Customer _Customer = null;</P>
<P>public CustomerCtrl()<BR>{<BR>&nbsp;&nbsp; InitializeComponent();<BR>}</P>
<P>public void SetCustomer(Customer customer)<BR>{<BR>&nbsp;&nbsp; _Customer = customer;<BR>&nbsp;&nbsp; CustomerBindingSource.DataSource = _Customer;<BR>&nbsp;&nbsp; MySubListGrid.DataSource = CustomerBindingSource;<BR>&nbsp;&nbsp; MySubListGrid.DataMember = "MySubList";<BR>}</P>
<P>public void SetupDataBindings()<BR>{<BR>&nbsp;&nbsp; // Setup the data bindings to the controls (most omitted for brevity)<BR>&nbsp;&nbsp; CustomerNameLbl.DataBindings.Add("Text", .....);<BR>}</P>
<P>&nbsp;</P>
<P>There are problems with that approach.&nbsp; If you try to pass in a null customer, you get an exception, I think due to the DataMember not being found.&nbsp; And even if you didn't get that, you can't set the data bindings on the controls multiple times.</P>
<P>You could somehow only call the SetupDataBindings() method once initially (or as necessary).&nbsp; That would prevent the control data bindings from being setup multiple times.&nbsp; But what about passing in a null customer?&nbsp; This will happen, for instance, when the delete customer option is selected.&nbsp; As part of our control data binding setup, we can establish a null string to be displayed, such as "No Customer", which is desirable.</P>
<P>I have seen a few pieces of advice / techniques that we have tried -- some that have worked, and some that haven't.&nbsp; In Rockford Lhotka's "Expert C# 2005 Business Objects" (second edition), page 492, he says that you rebind the BindingSource object to the new business object by adding these lines of code immediately after your operation that results in a new business object:</P>
<P><BR>this.rolesBindingSource.DataSource = null;<BR>this.rolesBindingSource.DataSource = _roles;<BR></P>
<P>He continues to say that you can't simply set the DataSource property to a new object.&nbsp; You must first set the property to null, and then to the new object.&nbsp; If you don't do this, the BindingSource will not bind to the new object and will silently remain bound to the old object, resulting in hard-to-debug problems in your application.</P>
<P>I tried this approach and it is essentially the same as when you pass in a null customer.&nbsp; The point at which the CustomerBindingSource.DataSource is set to null, an exception is thrown, complaining about the DataMember not being found.&nbsp; Is it necessary to somehow clear that MySubListGrid.DataMember prior to resetting the CustomerBindingSource.DataSource?</P>
<P>Also, I have tried removing all of the control data bindings prior to resetting the CustomerBindingSource and then setting them up again.&nbsp; That seems ridiculous that one should have to go to all of that work.&nbsp; It seems like there should be a much more elegant way of handling this, and I just don't know what it is.</P>
<P>I have also tried protecting against allowing a null customer.&nbsp; For instance, if a null customer is passed into the SetCustomer() method, then I create a new Customer and set that to the CustomerBindingSource.DataSource.&nbsp; Unfortunately, then I lose the control data binding null string text, such as the "No Customer".&nbsp; Also, we really don't want a new Customer in that situation.</P>
<P><BR>Any help / advice would be very much appreciated.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FrodeNilsen replied on Friday, April 25, 2008</h2>First of all, I think you'd get more replies if&nbsp; you condense your post a bit... To much to read! ;-)<br><br>The jist I'm getting is that you're unable to set the datasource to null - this should be no problem. Here is the code where you try to do that:<br><br>&nbsp;&nbsp; _Customer = customer;<br>&nbsp;&nbsp; CustomerBindingSource.DataSource = _Customer;<br>&nbsp;&nbsp; MySubListGrid.DataSource = CustomerBindingSource;<br>&nbsp;&nbsp; MySubListGrid.DataMember = "MySubList";<br><br>I have two issues with that code:<br>1. I think you should use the designer to set the DataSource of MySubListGrid. The datasource of the GRID is never changing, it's the BINDINGSOURCE's datasource that changes. This way, line 3 and 4 is uneccessary.<br>2.&nbsp; I would create a separate bindingsource for the sublist. That way, the DataMember property would be set on the new bindingsource in stead of on the grid directly. If you still want to initialize the bindingsources by code, your code above could be changed to something like this: <br><br>&nbsp;&nbsp; _Customer = customer;<br>&nbsp;&nbsp; CustomerBindingSource.DataSource = _Customer;<br>&nbsp;&nbsp; MySubListBindingSource.DataSource = CustomerBindingSource;<br>&nbsp;&nbsp; MySubListBindingSource.DataMember = "MySubList";<br>
&nbsp;&nbsp; MySubListGrid.DataSource = MySubListBindingSource;<br><br>..that said, if you use the GUI designer as suggested in (1), you will only need line 1,2 and 5 in the code above.<br><br>I just tested a similar case of the one you describe and I had no problems setting the datasource to null at runtime. I can upload the test project if you're interested.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Kyle77 replied on Friday, May 09, 2008</h2><P>Thanks for your reply.&nbsp; Sorry it took me so long to get back here...&nbsp; And sorry about the lengthy post.&nbsp; I guess I didn't want to put too little information, but probably did turn a few people away with so much to read.&nbsp; :)&nbsp; I'm going to be gone this weekend, but I'll give your suggestions a try next week and let you know how it goes.</P>
<P>In your second code listing, where you assign </P>
<P>_Customer = customer; </P>
<P>what happens if customer is null?&nbsp; It seems like you're saying that by adding in an additional intermediary BindingSource between the CustomerBindingSource and the MySubListGrid, that is what makes it possible to 'use' a null customer.&nbsp; Am I interpreting that correctly?&nbsp; If so, could you elaborate on why that is the case?&nbsp; I must be missing a key point...</P>
<P>Also, if you had an additional control on the form, like a TextBox bound to a property on the Customer object, such as FirstName, what would be the result of customer being null?&nbsp; I think that should be fine, and you can even set the text to be displayed in the control if the bound object is null when you establish the binding relationship.</P>
<P>Thanks,<BR>Kyle</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jobyspencer replied on Saturday, May 10, 2008</h2>I am also working on this issue of setting a BindingSource.DataSource = null.&nbsp; My "simple" implementation throws an ArgumentException with message "Cannot bind to the property or column FirstName on the DataSource. Parameter name: dataMember" when I set the BindingSource.DataSource = null.&nbsp; My small test app has a form with 2 textboxes (FirstNameText &amp; LastNameText) that are bound to a Customer object with the FirstName &amp; LastName properties.&nbsp; There's a "Set Customer" button that creates a Customer object and sets it as the DataSource to a BindingSource that the textboxes are bound to.&nbsp; There's also a "Null Customer" button that simply sets the BindingSource.DataSource = null.&nbsp; See the code below.<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private void Form1_Load(object sender, EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>/* Can not set data bindings here with the BindingSource.DataSource = null. You get an ArgumentException with msg:</span><br><span>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; * "Cannot bind to the property or column FirstName on the DataSource. Parameter name: dataMember" when</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * you try to add the binding between the FirstNameText textbox and the FirstName property of the Customer object. */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //this.SetupBindings();&nbsp; <span>// Throws ArgumentException.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void SetupBindings()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.FirstNameText.DataBindings.Add("Text", this.CustomerBindingSource, "FirstName", true, DataSourceUpdateMode.OnValidation);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.LastNameText.DataBindings.Add("Text", this.CustomerBindingSource, "LastName", true, DataSourceUpdateMode.OnValidation);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void SetCustomerBtn_Click(object sender, EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Customer c = new Customer { FirstName = "Joby", LastName = "Spencer" };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.CustomerBindingSource.DataSource = c;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.SetupBindings();&nbsp; <span>// Setting-up bindings is ok here after DataSource is non-null.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void NullCustomerBtn_Click(object sender, EventArgs e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span> /* Setting the BindingSource.DataSource = null AFTER the bindings to the textboxes have been set-up throws an ArgumentException with msg:</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * "Cannot bind to the property or column FirstName on the DataSource. Parameter name: dataMember" */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.CustomerBindingSource.DataSource = null;&nbsp; <span>// Throws ArgumentException.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>Ultimately, the reason I want to set the DataSource to be a null Customer is that I need to clear-out all of the Customer's info on the form. ie: Have the textboxes be blank or empty when no customer is "opened" or "selected" by the user.<br><br>I have tried to work around this ArgumentException with a null customer by suspending the binding on the BindingSource by calling:<br>BindingSource.SuspendBinding();<br>BindingSource.RaiseListChangedEvents = false;<br>... and then resuming binding when a non-null customer is set as the DataSource.&nbsp; Any advice or guidance on a better way to do this would be appreciated.&nbsp; Thank you.&nbsp; Joby<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, May 12, 2008</h2>Well, it's trying to bind and the object who's property it's trying to read is null.&nbsp; So that can't work.<br><br>You can set the datasource to null if you turn off change events, but you'll need to set it again before you resume binding.<br><br>Alternately, you could set the DataSource = typeof( MyBusinessObject ).&nbsp; That will also get you around the exception, but be sure to give it an actual object if you plan on letting the user continue editing a business object.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jobyspencer replied on Monday, May 12, 2008</h2>Thanks for your response.&nbsp; I was hoping the BindingSource could handle a null data source and would automatically not try to run the binding, but that is not the case.&nbsp; I am using the "suspending binding" strategy when the data source is null, and then resuming binding when the data source is reset to non-null.&nbsp; Thanks again.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
