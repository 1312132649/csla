<html><header><title>Principal must be of type BusinessPrincipal, not Nothing</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Principal must be of type BusinessPrincipal, not Nothing</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2462.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RichardETVS posted on Friday, March 02, 2007</h2><P>Well, after a failed attempt (of I speak about <A href="/forums/thread/12745.aspx">here</A>), I tried another approach.</P>
<P>So, I used an example application who works fine (it is your code, phucphlq) on local, with no remoting, configuration.</P>
<P><BR>I tried to make it as client server one, with the server in a console app. This time, I use a config file for the server side, here it is.<BR></P>
<P><BLOCKQUOTE><div><BR>&lt;configuration&gt;<BR>&nbsp; &lt;system.runtime.remoting&gt;<BR>&nbsp;&nbsp;&lt;application&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;service&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wellknown mode="SingleCall" objectUri="RemotingPortal.rem"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type="Csla.Server.Hosts.RemotingPortal, Csla"/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&lt;/service&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;channels&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;channel ref="http" port="3187"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;serverProviders&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;provider ref="wsdl"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;formatter ref="soap" typeFilterLevel="Full"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;formatter ref="binary" typeFilterLevel="Full"/&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/serverProviders&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/channel&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/channels&gt;<BR>&nbsp;&nbsp;&lt;/application&gt;<BR>&nbsp;&lt;/system.runtime.remoting&gt;<BR>&nbsp; &lt;connectionStrings&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add name="DatabaseFile" connectionString="Db4oCSLA.yap" /&gt;<BR>&nbsp; &lt;/connectionStrings&gt;<BR>&lt;/configuration&gt;<BR></div></BLOCKQUOTE><BR></P>
<P>And the server itself is very simple:<BR></P>
<P><BLOCKQUOTE><div><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String filename = "..\\..\\App.config";<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemotingConfiguration.Configure(filename);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("ServerStartup.Main(): Server started");</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the server will keep running until keypress.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ReadLine();<BR>&nbsp;&nbsp; }<BR></div></BLOCKQUOTE><BR></P>
<P>Here is the client config file:<BR></P>
<P><BLOCKQUOTE><div><BR>&lt;configuration&gt;<BR>&nbsp; &lt;appSettings&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaAuthentication" value="Windows" /&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalProxy"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value="Csla.DataPortalClient.RemotingProxy, Csla"/&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaDataPortalUrl"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value="<A href='http://localhost:3187/RemotingPortal.rem"/'>http://localhost:3187/RemotingPortal.rem"/</A>&gt;<BR>&nbsp; &lt;/appSettings&gt;&nbsp; <BR>&nbsp; &lt;connectionStrings&gt;<BR>&nbsp; &lt;/connectionStrings&gt;<BR>&lt;/configuration&gt;<BR></div></BLOCKQUOTE><BR></P>
<P>When I use the client, I get the error “<EM>Principal must be of type BusinessPrincipal, not Nothing</EM>” at the line “<EM>return Csla.DataPortal.Create&lt;EditableRootEmployee&gt;()</EM>;” from the public class <EM>EditableRootEmployee:Csla.BusinessBase&lt;EditableRootEmployee&gt;</EM>.<BR></P>
<P>Here is the code:<BR><BLOCKQUOTE><div><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static EditableRootEmployee New()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Csla.DataPortal.Create&lt;EditableRootEmployee&gt;();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Create()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkOld();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR></div></BLOCKQUOTE></P>
<P><BR>And the complete exception<BR></P>
<P><BLOCKQUOTE><div><BR>System.Security.SecurityException was unhandled<BR>&nbsp; Message="Principal must be of type BusinessPrincipal, not Nothing"<BR>&nbsp; Source="Csla"<BR>&nbsp; StackTrace:<BR>&nbsp;&nbsp;&nbsp; Server stack trace: <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.Server.DataPortal.SetContext(DataPortalContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.Server.DataPortal.Create(Type objectType, Object criteria, DataPortalContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.Server.Hosts.RemotingPortal.Create(Type objectType, Object criteria, DataPortalContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Runtime.Remoting.Messaging.StackBuilderSink._PrivateProcessMessage(IntPtr md, Object[] args, Object server, Int32 methodPtr, Boolean fExecuteInContext, Object[]&amp; outArgs)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Runtime.Remoting.Messaging.StackBuilderSink.PrivateProcessMessage(RuntimeMethodHandle md, Object[] args, Object server, Int32 methodPtr, Boolean fExecuteInContext, Object[]&amp; outArgs)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(IMessage msg, Int32 methodPtr, Boolean fExecuteInContext)<BR>&nbsp;&nbsp;&nbsp; Exception rethrown at [0]: <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.Server.IDataPortalServer.Create(Type objectType, Object criteria, DataPortalContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.DataPortalClient.RemotingProxy.Create(Type objectType, Object criteria, DataPortalContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.DataPortal.Create(Type objectType, Object criteria)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Csla.DataPortal.Create[T]()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Business.EditableRootEmployee.New() dans C:\Documents and Settings\PETITDM\Mes documents\Visual Studio 2005\Projects\Tests\db4oprogs\db4oCSLA\Test CS2\Business\EditableRootEmployee.cs:ligne 57<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Db4oAndCSLA.MainForm..ctor() dans C:\Documents and Settings\PETITDM\Mes documents\Visual Studio 2005\Projects\Tests\db4oprogs\db4oCSLA\Test CS2\Db4oAndCSLA\MainForm.cs:ligne 17<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Db4oAndCSLA.Program.Main() dans C:\Documents and Settings\PETITDM\Mes documents\Visual Studio 2005\Projects\Tests\db4oprogs\db4oCSLA\Test CS2\Db4oAndCSLA\Program.cs:ligne 17<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.AppDomain.nExecuteAssembly(Assembly assembly, String[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Threading.ThreadHelper.ThreadStart_Context(Object state)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; à System.Threading.ThreadHelper.ThreadStart()<BR></div></BLOCKQUOTE><BR></P>
<P>Again, any help would be welcome</P>
<P>Thanks </P>
<P>Richard</P>
<P>&nbsp;</P>
<P><STRONG>Edit: That's ok, I found the solution </STRONG><A href="/forums/thread/12402.aspx"><STRONG>here</STRONG></A><STRONG>&nbsp;, I added</STRONG></P>
<P><STRONG><BLOCKQUOTE><div></STRONG></P>
<P><STRONG>&nbsp;&lt;appSettings&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;add key="CslaAuthentication" value="Windows" /&gt;<BR>&nbsp; &lt;/appSettings&gt;<BR></div></BLOCKQUOTE></STRONG></P>
<P><STRONG>in the config file of the server.<BR></STRONG></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
