<html><header><title>Set default values in Editable Child Collection bound to DataGridView</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Set default values in Editable Child Collection bound to DataGridView</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11487.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton posted on Saturday, July 21, 2012</h2><p>I have read several blog posts and the e-books but I cant really implement it properly.</p>
<p>What are the basics of setting default property values of an object in an Editable Child Collection, which is bound to a DataGridView?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockyRocks replied on Saturday, July 21, 2012</h2><p>Your collection will have an AddNewCore method which will call a factory method on your child object when a new instance is added to the list.</p>
<p>That factory method makes the addition of an object in this case work the normal way; there is code in your child that gets called when a new object is created (called by the child data portal) and that is where you do your defaulting. Depending on your version of CSLA and data access decisions it could be in Child_Create method.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Saturday, July 21, 2012</h2><p>I typically define default values on the static PropertyInfo and then set default values in Child_Create method.</p>
<p>When defautvalues is defined in PropertyInfo&acute;s - the default value vill be set in the first Property Get method on a &quot;managed&quot; field.&nbsp;<br />For private backing fields you must set the default value - preferrably in Child_Create or use private field initializer.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>superkuton replied on Saturday, July 21, 2012</h2><p>Thank you RockyRocks and JonnyBee.</p>
<p>Kindly take a look on my code and see what I might be missing:</p>
<p><span style="text-decoration:underline;"><b>In my Editable Root Object:</b></span></p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public static readonly PropertyInfo&lt;PayableDetail&gt; PayableDetailsProperty = RegisterProperty&lt;PayableDetail&gt;(c =&gt; c.PayableDetails);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public PayableDetail PayableDetails<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (!(FieldManager.FieldExists(PayableDetailsProperty)))<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LoadProperty(PayableDetailsProperty, DataPortal.CreateChild&lt;PayableDetail&gt;());<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return GetProperty(PayableDetailsProperty);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private set { LoadProperty(PayableDetailsProperty, value); }<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p><span style="text-decoration:underline;"><b>In my Editable Child Collection:</b></span></p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; public static PayableDetail NewPayableEditDetail()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.CreateChild&lt;PayableDetail&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><span style="text-decoration:underline;"><b>And in my Editable Child Object:</b></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [RunLocal]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected void Child_Create()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LoadProperty&lt;int&gt;(PayableIDProperty, 1);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LoadProperty&lt;string&gt;(ProjectProperty, Budgeting.ProjectLookUp.DefaultValue());<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LoadProperty&lt;int&gt;(AccountIDProperty, 101);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BusinessRules.CheckRules();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>Please advise. Thank you.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, July 22, 2012</h2><p>I don&#39;t understand your comment on &quot;<strong>In my Editable Child Collection</strong>&quot; - it seems to me like your code is a root object that uses a lazy loaded editable child. I do not see a collection beeing used here at all!!! </p>
<p>I&acute;d first check what the values of PaymentDetail actually is. It could be your databing is not correct or not updating correctly.&nbsp;</p>
<p>Possible resons and tings to check out:</p>
<p>1. PayableDetail field may alreade&nbsp;be set. (ie<strong> FieldManager.Exists returns true</strong>). I field is set to null or anyt value then FieldManager.Exists will return true).</p>
<p>2. AuthorizationRule on PayableDetails property&nbsp;may not allow property get (in which case get&nbsp; retun null instead)&nbsp;</p>
<p>3. PayableDetail object may have authorization rules thet does not allow user to read values (in which case the default value for datatype is returned).</p>
<p>3. I assume&nbsp; the properties in PayableDetail are managed properties (no private backing fields).</p>
<p>4. I prefer to have lazy loading of properties like this (without property set method): </p>
<p>public static readonly PropertyInfo&lt;PayableDetail&gt; PayableDetailsProperty = RegisterProperty&lt;PayableDetail&gt;(c =&gt; c.PayableDetails);<br />public PayableDetail PayableDetails<br />{<br />&nbsp;&nbsp; get<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!(FieldManager.FieldExists(PayableDetailsProperty)))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(PayableDetailsProperty, PayableDetail.NewPayableEditDetail());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return GetProperty(PayableDetailsProperty);<br />&nbsp;&nbsp;&nbsp; }<br />}</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
