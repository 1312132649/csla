<html><header><title>SL DataProvider create locally</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>SL DataProvider create locally</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6735.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>davido_xml posted on Friday, April 03, 2009</h2><FONT size=2>
<P>I use a DataProvider like so</P>
<P><FONT face="Courier New">provider.FactoryParameters.Clear();</FONT></FONT><FONT size=2></P>
<P><FONT face="Courier New">provider.FactoryMethod = </FONT></FONT><FONT face="Courier New"><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"CreateMyBO"</FONT></FONT><FONT size=2>;</FONT></FONT></P>
<P><FONT face="Courier New" size=2>provider.Refresh();</FONT></P>
<P><FONT size=2>Where The factory method looks like:</FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P><FONT face="Courier New">public</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CreateMyBO(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortalResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyBO</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">&gt;&gt; handler)</FONT></P>
<P><FONT face="Courier New">{</FONT></FONT><FONT face="Courier New"><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;DataPortal</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyBO</FONT></FONT><FONT size=2>&gt; dp = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>new</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortal</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyBO</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">&gt;();</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;dp.CreateCompleted += handler;</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;dp.BeginCreate();</FONT><FONT face="Courier New">}</FONT></P></FONT>
<P><FONT size=2>I now have a situation where I want to create a new MyBO based on the MyBO currently in the DataProvider; so something like this</FONT></P>
<P><FONT face="Courier New" size=2>provider.FactoryParameters.Clear();</FONT></P>
<P><FONT size=2><FONT face="Courier New"><FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT></FONT><FONT face="Courier New"> exp = </FONT></FONT><FONT size=2><FONT face="Courier New">provider.Data </FONT><FONT face="Courier New"><FONT color=#0000ff><FONT color=#0000ff>as</FONT></FONT> <FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT>;</P></FONT></FONT>
<P><FONT face="Courier New" size=2>provider.FactoryParameters.Add(exp);</FONT></P>
<P><FONT size=2><FONT face="Courier New">provider.FactoryMethod = <FONT color=#a31515><FONT color=#a31515>"CreateMyBO"</FONT></FONT></FONT><FONT face="Courier New">;</FONT></FONT></P>
<P><FONT face="Courier New" size=2>provider.Refresh();</FONT></P>
<P><FONT size=2>So I rewrite my factory method like <FONT color=#0000ff size=2><FONT color=#0000ff size=2></P>
<P><FONT face="Courier New">public</FONT></FONT></FONT><FONT face="Courier New"><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> CreateMyBO(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyBO</FONT></FONT><FONT size=2> expense, </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>EventHandler</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataPortalResult</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>MyBO</FONT></FONT></FONT><FONT size=2><FONT face="Courier New">&gt;&gt; handler)</FONT></P>
<P><FONT face="Courier New">{.....</FONT></P>
<P>The question is what do I need to do inside this new overload to avoid a trip down the wire to the server side data portal? I'd&nbsp;like to create a new&nbsp;MyBO load the properties with the ones from the exisiting MyBO and raise the appropriate event for the DataProvider</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, April 03, 2009</h2><P>You have the data portal configured for remote use, and you want it to be remote (normally). But in this particular case, you want to run the data portal in local mode.</P>
<P>If that's the scenario, then the answer is that the constructor on DataPortal&lt;T&gt; has an overload where you can force the object to run in local mode. This is something you do in your factory method, so the choice between local and remote is encapsulated in the factory, and is transparent to the UI.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>davido_xml replied on Friday, April 03, 2009</h2><P>Thanks for the pointer.</P>
<P>That is the scenario remote normally but local in this case.</P>
<P>For others&nbsp;I created the following methods. I&nbsp;think I'm restricted to&nbsp;the <FONT size=2>DataPortal_Create being public because of MethodCaller.FindMethod. </FONT></P><FONT color=#0000ff><FONT color=#0000ff>
<P><FONT size=2>#if</FONT></FONT></FONT><FONT size=2> SILVERLIGHT</FONT></P>
<P><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>public</FONT></FONT> <FONT color=#0000ff><FONT color=#0000ff>static</FONT></FONT> <FONT color=#0000ff><FONT color=#0000ff>void</FONT></FONT> CreateMyBO(<FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT> myBO, <FONT color=#2b91af><FONT color=#2b91af>EventHandler</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>DataPortalResult</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT>&gt;&gt; handler)</FONT></P>
<P><FONT size=2>{<FONT color=#2b91af><FONT color=#2b91af>DataPortal</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT>&gt; dp = <FONT color=#0000ff><FONT color=#0000ff>new</FONT></FONT> <FONT color=#2b91af><FONT color=#2b91af>DataPortal</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>MyBO</FONT></FONT>&gt;(<FONT color=#2b91af><FONT color=#2b91af>DataPortal</FONT></FONT>.<FONT color=#2b91af><FONT color=#2b91af>ProxyModes</FONT></FONT>.LocalOnly);</FONT></P>
<P><FONT size=2>dp.CreateCompleted += handler;</FONT></P>
<P><FONT size=2>dp.BeginCreate(myBO);}</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P><FONT color=#0000ff><FONT color=#0000ff>
<P><FONT size=2><STRONG><U>public</U></STRONG></FONT></FONT></FONT><FONT size=2>&nbsp;<FONT color=#0000ff><FONT color=#0000ff>void</FONT></FONT> DataPortal_Create(<FONT color=#2b91af><FONT color=#2b91af>Expense</FONT></FONT> expense, Csla.DataPortalClient.<FONT color=#2b91af><FONT color=#2b91af>LocalProxy</FONT></FONT>&lt;<FONT color=#2b91af><FONT color=#2b91af>Expense</FONT></FONT>&gt;.<FONT color=#2b91af><FONT color=#2b91af>CompletedHandler</FONT></FONT> handler)</FONT></P>
<P><FONT size=2>{//do the work here}</FONT></P><FONT color=#0000ff><FONT color=#0000ff>
<P><FONT size=2>#endif</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>davido_xml replied on Friday, April 03, 2009</h2><P>I spoke too soon. I thought all I had to do was make a series of LoadProperty calls in the new (local) DataPortalCreate but that left the DataProvider with IsBusy = true and no new object.</P>
<P>What am I missing?<FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>davido replied on Sunday, April 05, 2009</h2><P>Answer found at</P>
<P><A href="http://www.lhotka.net/weblog/CSLALightDataPortalAndNlevelUndo.aspx">http://www.lhotka.net/weblog/CSLALightDataPortalAndNlevelUndo.aspx</A></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>public</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> DataPortal_Create(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Expense</FONT></FONT><FONT size=2> expense, Csla.DataPortalClient.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LocalProxy</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>Expense</FONT></FONT><FONT size=2>&gt;.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>CompletedHandler</FONT></FONT><FONT size=2> handler)</P>
<P>{</P>
<P></P>
<P>LoadProperty&lt;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2>&gt;(MyBOIdProperty, 0);</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.MarkNew();</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>base</FONT></FONT><FONT size=2>.ValidationRules.CheckRules();</P>
<P>handler(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>);</P>
<P>}</P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
