<html><header><title>example for NVL with MVVM</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>example for NVL with MVVM</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10816.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF posted on Wednesday, October 26, 2011</h2><p>I&#39;m trying to learn MVVM, and I&#39;ve been looking at some of the e-book example projects.&nbsp; The CslaMvvmSl solution shows some scenarios, but I&#39;m not sure what to do in the case of exposing a NVL object in my view model.&nbsp; This example project shows this view model (below), but the editor barks at me trying to use the Model.OrderBy line for a NVL object.&nbsp; Can someone point me in the right direction, or let me know of other sample MVVM projects that use NVL objects?&nbsp; Thanks.</p>
<p>public <span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ObservableCollection</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">PersonItemViewModel</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt; PersonList<br /></span></span>{<br />&nbsp;&nbsp; get<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var result = new ObservableCollection&lt;PersonItemViewModel&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Model != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var item in Model.OrderBy(c =&gt; c.Id))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result.Add(new PersonItemViewModel(item));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>StefanCop replied on Wednesday, October 26, 2011</h2><p>Did you declare</p>
<p><span style="font-family:courier new,courier;">using System.Linq;</span>&nbsp; ?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, October 26, 2011</h2><p>The current ProjectTracker code (in svn) uses a NVL in the ProjectEdit and ResourceEdit views/viewmodels.</p>
<p>In reality though, I find that fewer and fewer NVL types are being used in XAML, because people want more than simple text in the combobox dropdown. So the more common case is to return a read-only list with richer data so the combbox can include text+images or something like that.</p>
<p>Rarely do you need to wrap the combobox items in child viewmodels. You&#39;d only do that if you were adding buttons or hyperlinks to the content in the dropdown itself - and I&#39;m not even sure that would work (?)</p>
<p>I just expose the NVL or read-only list directly as a property off my viewmodel so the view can bind to the list.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Thursday, October 27, 2011</h2><p>Rocky, I think I understand what you&#39;re saying (about exposing the NVL as a property off the main VM), but being new to MVVM I&#39;m not sure how I would go about that.&nbsp; I&#39;m having a hard time thinking about what it should look like.&nbsp; If I have a ReadOnlyListBase class called AgentInfoList, and it is exposed via the following VM (which is the main VM for the user control):</p>
<p style="padding-left:30px;">public class AgentViewModel : ViewModel&lt;AgentInfoList&gt; {}</p>
<p>...then do I just do the following in this VM to expose the NVL object?</p>
<p style="padding-left:30px;">public MyNVL MyList<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp; get { return new MyNVL(); }<br />}</p>
<p>I guess that thing that is confusing me is that I&#39;ve been assuming that a VM exposes one and only one CSLA class, and if your window needs to display multiple sets of data then you have multiple VMs for that one window, with a separate VM for every object exposed.&nbsp; Is my understanding incorrect?&nbsp; Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 27, 2011</h2><p>A viewmodel is coupled to the view, and its job is to expose the properties and command/verb/methods required by the view.</p>
<p>So if the view uses an editable object, and a NVL, then the viewmodel should expose both objects for the view to use.</p>
<p>Additionally:</p>
<p>If the view has &quot;sub-views&quot; or &quot;sub-regions&quot;, each of those might have a viewmodel. The parent viewmodel should expose those child viewmodels as properties.</p>
<p>Just like the view contains the sub-view, the parent viewmodel contains the child viewmodel.</p>
<p>&nbsp;</p>
<p>In short, the viewmodel structure mirrors the <em>view and sub-views</em>, not the business object model.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>TSF replied on Thursday, October 27, 2011</h2><p>So if you want a ViewModel to expose two or more objects, which one do you put in the class definition?&nbsp; According to the example below, &lt;T&gt; in ViewModel&lt;T&gt; is AgentInfoList.&nbsp; But what if I need two other models exposed in this same view?&nbsp; How do I determine which model is referenced as T?</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p style="padding-left:30px;">&nbsp;</p>
</font></font></span><font face="Consolas" size="2">
<p style="padding-left:30px;">&nbsp;</p>
</font></span>
<p style="padding-left:30px;">&nbsp;</p>
<p style="padding-left:30px;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">public</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">class</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AgentViewModel</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> : </span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">ViewModel</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&lt;</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">AgentInfoList</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">&gt;</span></span></p>
<p>Sorry - some of uncertainty is also probably related to my newness to CSLA in general.&nbsp; Thanks for your help.</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, October 27, 2011</h2><p>The ViewModelBase class in Csla.Xaml is designed to manage a business object. It is only useful if you are using it to manage a business object, and you shouldn&#39;t bother with it for objects you don&#39;t need to manage.</p>
<p>There&#39;s nothing to manage with a NVL, so ViewModelBase offers little or no value.</p>
<p>There&#39;s absolutely something to manage with any editable object, especially an editable root object, and I almost always use a subclass of ViewModelBase to manage my editable objects.</p>
<p>If my root viewmodel derives from ViewModelBase, I&#39;ll make T be the type of the editable object, and I&#39;ll expose the NVL as a property.</p>
<p>But in reality, I tend to use the async data portal for WPF/SL/WP7 - in which case T is a <em>unit of work object</em>, and I&#39;ll expose <em>two</em> properties from the root viewmodel:</p>
<ol>
<li>A ViewModelBase subclass where T is the editable business object</li>
<li>The NVL collection</li>
</ol>
<p>The WPF/SL ebook and ProjectTracker sample demonstrates this exact thing.</p>
<p>The root viewmodel for the ProjectEdit view is ProjectGetter (managing a ProjectGetter unit of work object). </p>
<p>It exposes a ProjectEditViewModel property, and the ProjectEdit viewmodel manages a ProjectEdit editable root business object.</p>
<p>It also exposes a RoleList property, directly returning the RoleList NVL business object.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
