<html><header><title>LinqBindingList + sorting</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LinqBindingList + sorting</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6526.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky posted on Friday, February 27, 2009</h2>Hi,<br><br>I have a LabelList class derived from BLB. It holds a collection of Label objects, themselves derived from BB. Finally, I use the LabelList in the Item class, which is derived from BusinessBase as well.<br><br>In the Item class, I want to add a property that would return a filtered + sorted list of Label objects, so I go like this:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public List&lt;Label&gt; BoxLabels<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var l = from lbl in Labels //the Labels property is of type LabelList<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where lbl.PrintOn == "B"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderby lbl.LabelDescr descending<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select lbl;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return l.ToList();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>The goal is binding this List&lt;Label&gt; to a WinForms ListBox so that I display a sorted and filtered list of Labels.<br><br>The issue is that the "orderby" clause doesn't seem to apply, as it doesn't matter if I use descending or ascending. The result is always in the same order as they appear in the original LabelList.<br><br>If I do the following instead, then I get the proper result:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public List&lt;Label&gt; BoxLabels<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var l = from lbl in Labels<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where lbl.PrintOn == "B"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select lbl;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Label&gt; tmp = l.ToList();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp.Sort((x,y)=&gt; y.LabelDescr.CompareTo(x.LabelDescr));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return tmp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>So it would seem that LinqBindingList doesn't really support sorting. Or am I again completely off track ?<br><br>I'm only an egg. I must wait for fullness <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, February 27, 2009</h2><P>I have been working with Aaron Erickson to fix this issue. In some new code that he is testing, regular LINQ queries should sort and filter. Must not be checked in yet.</P>
<P>I am trying to get it to do the same with the MS Dynamic Query Library so you can pass String parameters at run time to Dynamic linq queries. Still working on it.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Saturday, February 28, 2009</h2>Thanks Joe,<br><br>Now I feel better knowing it was not in my code <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Oob replied on Friday, March 13, 2009</h2>No it is not your code. Does anyone know if this is fixed in 3.6.2?<br><br>If you add AsEnumerable() to your link query, it will not create a LinqBindingList and you will get a list back that is sorted. So to "fix" your code, the work around would be...<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var l = from lbl in Labels.AsEnumerable()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where lbl.PrintOn == "B"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select lbl;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Label&gt; tmp = l.ToList();<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, March 13, 2009</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Oob:</strong></div><div>Does anyone know if this is fixed in 3.6.2?<BR></div></BLOCKQUOTE></P><br /><P>It was fixed this week. Aaron is checking in changes. I made a few suggestions which I hope Rocky will incorporate. It is possible that it will make it into 3.6.2.</P><br /><P>The Csla.LinqBindingList can now sort and filter using standard LINQ as well as the Microsoft Dynamic Query Extensions for LINQ. So you can pass string parameters for things like sortColumn and sortDirection. You can also use string filters and multi-column sorting.</P><br /><P>If you define a variable like mSortedList As LinqBindingList(Of T) (where T is your BO type in your collection) then you can use LINQ or Dynamic Query to fetch the list. </P><br /><P>Aaron's code stores your original collection in an internal _list variable and then builds an index cross reference that satisifies your query criteria. So the LBL may *look* unsorted if you just examine its internal list. That is because it is. </P><br /><P>You can set the DataSource of a grid directly to the mSortedList.&#160;When databinding or an Enumerator (For Each loop) executes against the LBL it asks the default Item property (indexer in C#) for a BO and it looks it up in the cross reference list and hands you back the value that met your crtieria. It is pretty cool.</P><br /><P>If you do reflection against a LBL be sure to cast it to IList first so that it uses the same indexer to retrieve an index value correctly.</P><br /><P>Joe</P><br /><P>&#160;</P><br /><P>&#160;</P><br /><P>&#160;</P><br /><P>&#160;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Woggly replied on Thursday, April 02, 2009</h2><P>Now I am completely confused...</P>
<P>I am trying to sort a set of BOs too. With the fix from Oob my set gets sorted. But a LinqBindingList is no longer returned from the sorting. <BR>Now when I am editing one of the objects will the set get notified? I am not sure about this all. In the book it is said, that the LinqBindingList takes care of notifing the base set of changes, so the whole csla functions will work. But when I bind my Grid not to this LinqBindingList?</P>
<P>Is this issue fixed in 3.6.2? Did not upgrade yet...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, April 02, 2009</h2>When you run LINQ against an Editable Child Collection the query itself is some variation of IQueryable.<br /><br />You must cast the result of the query to LinqBindingList in order to treat it as one.<br /><br />Joe<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Woggly replied on Thursday, April 02, 2009</h2><P>I just don't get it <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /></P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (direction.ToString() == </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Descending"</FONT></FONT><FONT size=2>)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> sortedList = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>&gt;) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> p </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> set.AsEnumerable() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>orderby</FONT></FONT><FONT size=2> (p.Betrag) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>descending</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>select</FONT></FONT><FONT size=2> p;</FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>//set.OrderBy("Valuta"); </P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>._buchungGrid.ItemsSource = sortedList;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>else</P></FONT></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> sortedList = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>&gt;) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> p </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> set.AsEnumerable() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>orderby</FONT></FONT><FONT size=2> (p.Betrag) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>select</FONT></FONT><FONT size=2> p; </FONT></P>
<P><FONT size=2></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>._buchungGrid.ItemsSource = sortedList;</P>
<P>}</P>
<P>&nbsp;</P>
<P>But when casting to LinqBindingList I get an error:<BR>The Object of type "System.Linq.OrderedEnumerable`2[MeinGeld.DatabaseAccess.UIBuchung,System.Nullable`1[System.Decimal]]" could not be converted&nbsp;into type of&nbsp;"Csla.LinqBindingList`1[MeinGeld.DatabaseAccess.UIBuchung]".</P>
<P>What am I doing wrong?</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Luzius replied on Thursday, April 02, 2009</h2><P>Hi Woggly,</P>
<P>the LinqBindingList is a Csla class and the result of the Linq query will only be of type LinqBindingList if the original collection was derived from a Csla Collection class and not if it's a mere IEnumerable.</P>
<P>That's at least as far as I understand it.</P>
<P>Luzius</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Woggly replied on Friday, April 03, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Luzius:</strong></div><div>
<P>Hi Woggly,</P>
<P>the LinqBindingList is a Csla class and the result of the Linq query will only be of type LinqBindingList if the original collection was derived from a Csla Collection class and not if it's a mere IEnumerable.</P>
<P>That's at least as far as I understand it.</P>
<P>Luzius</P>
<P></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>Yes I know. But the problem is that the List will not get sorted when I remove .AsEnumerable()!<BR>And when I write .AsEnumerable it is no LinqBindingList. And as I understand then the linking to the original source is lost and changes will not be noticed (so is dirty and commands connected to issavable will not work).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Luzius replied on Friday, April 03, 2009</h2><P>I have the following Property in my BO:</P><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>readonly</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>PropertyInfo</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEditCollection</FONT></FONT><FONT size=2>&gt; urgenciesProperty = RegisterProperty&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEditCollection</FONT></FONT><FONT size=2>&gt;(c =&gt; c.Urgencies);</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>&gt; Urgencies<BR>{<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;get<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IOrderedQueryable</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>&gt; query =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> urgency </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> GetProperty(urgenciesProperty)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orderby</FONT></FONT><FONT size=2> urgency.StartDateParsableField.Date , (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2>) urgency.UrgencyType.Code </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>descending<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select</FONT></FONT><FONT size=2> urgency;<BR><BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>&gt;) query;<BR>&nbsp;&nbsp;&nbsp;}<BR>}</P>
<P></FONT></FONT><FONT size=2>UrgencyEditCollection is a direct decendant of BusinessListBase</FONT></P>
<P><FONT size=2>UrgencyEdit is a decendant of BusinessBase.</FONT></P>
<P><FONT size=2>The sorting works without problems.</FONT></P>
<P><FONT size=2>&nbsp;I have some unsolved problems with databinding it in Wpf. To resort, I currently have to call a Rebind on the CslaDataProvider it's not automatically done when a property changes. </FONT></P>
<P><FONT size=2>Hope this helps</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, April 03, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Luzius:</strong></div><div><P>I have the following Property in my BO:</P><FONT size=2><FONT color=#0000ff size=2><FONT color=#0000ff size=2><br /><P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>static</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>readonly</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>PropertyInfo</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEditCollection</FONT></FONT><FONT size=2>> urgenciesProperty = RegisterProperty<FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEditCollection</FONT></FONT><FONT size=2>>(c => c.Urgencies);</P></FONT><FONT size=2><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>> Urgencies<BR>{<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&#160;&#160;&#160;get<BR></FONT></FONT><FONT size=2>&#160;&#160;&#160;{<BR>&#160;&#160;&#160;&#160;&#160;&#160;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IOrderedQueryable</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>> query =<BR>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> urgency </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> GetProperty(urgenciesProperty)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;orderby</FONT></FONT><FONT size=2> urgency.StartDateParsableField.Date , (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>int</FONT></FONT><FONT size=2>) urgency.UrgencyType.Code </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>descending<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;select</FONT></FONT><FONT size=2> urgency;<BR><BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return</FONT></FONT><FONT size=2> (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UrgencyEdit</FONT></FONT><FONT size=2>>) query;<BR>&#160;&#160;&#160;}<BR>}</P><br /><P></FONT></FONT><FONT size=2>UrgencyEditCollection is a direct decendant of BusinessListBase</FONT></P><br /><P><FONT size=2>UrgencyEdit is a decendant of BusinessBase.</FONT></P><br /><P><FONT size=2>The sorting works without problems.</FONT></P><br /><P><FONT size=2>&#160;I have some unsolved problems with databinding it in Wpf. To resort, I currently have to call a Rebind on the CslaDataProvider it's not automatically done when a property changes. </FONT></P><br /><P><FONT size=2>Hope this helps</FONT></P></div></BLOCKQUOTE><br /><br />This code looks fine. So does your explanation of it.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, April 03, 2009</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Woggly:</strong></div><div><P>I just don't get it <img src="/emoticons/emotion-6.gif" alt="Sad [:(]" /></P><FONT size=2><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (direction.ToString() == </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Descending"</FONT></FONT><FONT size=2>)</P><br /><P>{</P><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> sortedList = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>>) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> p </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> set.AsEnumerable() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>orderby</FONT></FONT><FONT size=2> (p.Betrag) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>descending</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>select</FONT></FONT><FONT size=2> p;</FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>//set.OrderBy("Valuta"); </P></FONT></FONT><FONT size=2><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>._buchungGrid.ItemsSource = sortedList;</P><br /><P>}</P><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>else</P></FONT></FONT><FONT size=2><br /><P>{</P><br /><P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> sortedList = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>LinqBindingList</FONT></FONT><FONT size=2><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>>) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>from</FONT></FONT><FONT size=2> p </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>in</FONT></FONT><FONT size=2> set.AsEnumerable() </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>orderby</FONT></FONT><FONT size=2> (p.Betrag) </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>select</FONT></FONT><FONT size=2> p; </FONT></P><br /><P><FONT size=2></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>._buchungGrid.ItemsSource = sortedList;</P><br /><P>}</P><br /><P>&#160;</P><br /><P>But when casting to LinqBindingList I get an error:<BR>The Object of type "System.Linq.OrderedEnumerable`2[MeinGeld.DatabaseAccess.UIBuchung,System.Nullable`1[System.Decimal]]" could not be converted&#160;into type of&#160;"Csla.LinqBindingList`1[MeinGeld.DatabaseAccess.UIBuchung]".</P><br /><P>What am I doing wrong?</P></FONT></div></BLOCKQUOTE><br /><br />This code does not look fine at all.<br /><br />You write from p in set.AsEnumerable() ...<br />What kind of BO is "set"?<br /><br />Is it an Editable Child Collection?<br />Is it a ReadOnlyCollection?<br />Or something else?<br /><br />Joe<br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, April 03, 2009</h2>For a ReadOnlyCollection I use code like this:<br /><br />'At the top of the page:<br />Private mSortedList As System.Linq.IQueryable<br /><br />'in a method to set grid datasource:<br />  mSortedList = mROList.AsQueryable.OrderBy(mSortColumn &amp; " " &amp; mSortDirection)<br /><br />dg.DataSource = mSortedList.ToList<br /><br /><br />'In Item_DataBound:<br /> Dim item As ROList.Info = CType(mSortedList(mIndex), ROList.Info)<br /><br />The key idea is:<br />For Read Only Collections, you do NOT get back a LinqBindingList.<br /><br />HTH<br />Joe</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Woggly replied on Monday, April 06, 2009</h2><P>Hi Joe.</P>
<P>My set is a decendant of BusinessListBase.</P>
<P>But I think I solved my problem with the help of&nbsp;Luzius' posted code.<BR>Now I have got a property SortedList of type IOrderedEnumerable&nbsp;in my ViewModel to which the DataGrid is bound to. When performing a sort the SortedList gets updated and the list is sorted like I wanted. <BR>Now I only have to add the dynamic Linq and everything will be fine!</P>
<P>Thank you!</P>
<P>Edit:</P>
<P>I tried to get this working wih dynamic Linq but&nbsp;it seems that this is not working with my IOrderedEnumerable...</P>
<P>In my ViewModel I have:<BR><FONT color=#0000ff size=2><FONT color=#0000ff size=2></P>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IOrderedEnumerable</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>&gt; _sortedSet;<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>public</FONT></FONT><FONT size=2> </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IOrderedEnumerable</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>&gt; SortedSet<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>get</FONT></FONT><FONT size=2> { </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>return</FONT></FONT><FONT size=2> _sortedSet; }<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>set<BR>&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>._sortedSet = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>value</FONT></FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnPropertyChanged(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"SortedSet"</FONT></FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT size=2>}</P>
<P></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>The DataGrid is bound to this List. When a user clicks into the header of the Grid I am calling my custom Sorting Method:</FONT></FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>private</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>void</FONT></FONT><FONT size=2> PerformCustomSort(</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>DataGridColumn</FONT></FONT><FONT size=2> column)<BR>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2> direction = (column.SortDirection != </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2>.Ascending)&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2>.Ascending : </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2>.Descending;<BR>&nbsp;&nbsp;&nbsp;column.SortDirection = direction;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BuchungViewModel</FONT></FONT><FONT size=2> model = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>BuchungViewModel</FONT></FONT><FONT size=2>)</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>.DataContext;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchungSet</FONT></FONT><FONT size=2> set = model.DatabaseEntitySetModel; // DatabaseEntitySetModel = BusinessListBase descendant</FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (set != </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>if</FONT></FONT><FONT size=2> (direction.ToString() == </FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Descending"</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>var sortedList = from p in set.AsEnumerable() orderby (p.Betrag) descending select p;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT size=2>model.SortedSet = sortedList;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column.SortDirection = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2>.Descending;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT size=2>{</FONT><FONT color=#008000 size=2><FONT color=#008000 size=2><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT></FONT><FONT size=2></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>var</FONT></FONT><FONT size=2> sortedList = (</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IOrderedEnumerable</FONT></FONT><FONT size=2>&lt;</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>UIBuchung</FONT></FONT><FONT size=2>&gt;) set.OrderBy(</FONT><FONT color=#a31515 size=2><FONT color=#a31515 size=2>"Betrag"</FONT></FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>model.SortedSet = sortedList;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column.SortDirection = </FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>ListSortDirection</FONT></FONT><FONT size=2>.Ascending;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>}<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>}&nbsp;<BR>}</FONT></P>
<P><FONT size=2>I really don't know if this is the right way to do this! All I want to achieve is, that the Grid gets sorted when the user wants it. But When I am trying the easiest way like:<BR></FONT><FONT size=2>_grid.ItemsSource = from p in set orderby(p.Betrag) select p; my list is not getting sorted!<BR>And another problem with my implementation... When I am doing it the way described above I have a problem with the connection between sortedList and original list.<BR></FONT><FONT size=2>I am visualizing a read state in the grid. this is bound to a property IsRead in the BO from the set. When a user selects a row this property is set to true and I am saving the DatabaseEntitySetModel. But the Sorted List (of course??) gets not updated. i would have to do another sorting after saving. </FONT></P>
<P><FONT size=2>My question is. Which is the best way to achieve this? I see I am somehow stuck in my implementation. Would be great if you can give my some more tips!<BR>Thank you.</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
