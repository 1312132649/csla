<html><header><title>Sorting children lists in parent object???</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Sorting children lists in parent object???</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/774.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken posted on Monday, July 31, 2006</h2><P>I'm having trouble with sorting child collections on my web pages.</P>
<P>I have&nbsp;the following classes:</P>
<UL>
<LI>NameInfo , a read-only light-weight "single" record object.&nbsp; (ReadOnlyBase)</LI>
<LI>NameInfoList, a read-only collection of NameInfo. (ReadOnlyListBase)</LI>
<LI>Main, a read-only object with NameInfoList as one of the properties.&nbsp; (ReadOnlyBase)</LI></UL>
<P>I used NameInfoList as the data source for a GridView and implemented the sorting feature on it.&nbsp; Here's the C# code snippet where I return the sorted list:</P>
<P><FONT face="Courier New" size=2>private SortedBindingList&lt;The.Library.NameInfo&gt; GetNameInfoList()<BR>{<BR>&nbsp;&nbsp;object&nbsp;obj = Session[GetCurrentObjectCacheName()];<BR>&nbsp; if (&nbsp;&nbsp;&nbsp;obj == null<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; || !(obj is SortedBindingList&lt;The.Library.NameInfo&gt;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp; // Set parameter values.<BR></FONT><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;parentName&nbsp;= tbxSearch.Text + "%";</FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;NameInfoList list = NameInfoList.GetList(parentName);&nbsp;<BR></FONT><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;obj = new SortedBindingList&lt;NameInfo&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(NameInfoList.GetList(parentName));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp; HttpContext.Current.Session[GetCurrentObjectCacheName()] = obj;<BR><BR>&nbsp;}<BR>&nbsp;return ((SortedBindingList&lt;The.Library.NameInfo&gt;)obj);<BR>}</FONT><FONT face="Courier New" size=2><BR></FONT></P>
<P><FONT face="Courier New"><FONT face="Times New Roman">Works like a charm!</FONT></FONT></P>
<P><FONT face="Courier New"><FONT face="Times New Roman">Here's my problem.&nbsp; I have a "master object", one of whose properties is a NameInfoList.&nbsp; That NameInfoList is in a GridView on the same page with the master object.&nbsp; I want to enable sorting on the NameInfoList grid on this page also.&nbsp; To avoid lots of round-trips,&nbsp;the master object&nbsp;is responsible for populating&nbsp;all the data that's inside it.&nbsp; So, my cache is actually the master object , not a NameInfoList object.</FONT></FONT></P>
<P><FONT face="Courier New"><FONT face="Times New Roman">Here's the error I'm getting:</FONT></FONT></P>
<P><FONT face="Courier New" size=2>Unable to cast object of type 'The.Library.NameInfoList' to type 'Csla.SortedBindingList`1[The.Library.NameInfo]'. <BR>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </FONT></P>
<P><FONT face="Courier New" size=2>Exception Details: System.InvalidCastException: Unable to cast object of type 'The.Library.NameInfoList' to type 'Csla.SortedBindingList`1[The.Library.NameInfo]'.</FONT></P>
<P><FONT face="Courier New" size=2>Source Error: </FONT></P>
<P><FONT face="Courier New" size=2>Line 93:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Main obj = GetMain();<BR>&lt;-- Note: My NameInfoList in Main is called Names --&gt;<BR>Line 94:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object names = obj.Names;&nbsp; </FONT></P>
<P><FONT face="Courier New" size=2>Line 95:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ((SortedBindingList&lt;The.Library.NameInfo&gt;)names);<BR>Line 96:&nbsp;&nbsp;&nbsp;&nbsp; }<BR>Line 97:&nbsp;&nbsp;&nbsp;&nbsp; #endregion<BR>&nbsp;</FONT></P>
<P><FONT face="Courier New" size=2>Source File: c:\Inetpub\wwwroot\TheWeb\DataReports\Detail.aspx.cs&nbsp;&nbsp;&nbsp; Line: 95 </FONT></P>
<P><FONT face="Courier New" size=2>Stack Trace: </FONT></P>
<P><FONT face="Courier New"><BR><FONT size=2>[InvalidCastException: Unable to cast object of type 'The.Library.NameInfoList' to type 'Csla.SortedBindingList`1[The.Library.NameInfo]'.]<BR>&nbsp;&nbsp; DataReports_Detail.GetNames() in c:\Inetpub\wwwroot\TheWeb\DataReports\Detail.aspx.cs:95<BR>&nbsp;&nbsp; DataReports_Detail.NameDS_SelectObject(Object sender, SelectObjectArgs e) in c:\Inetpub\wwwroot\TheWeb\DataReports\Detail.aspx.cs:82<BR>&nbsp;&nbsp; Csla.Web.CslaDataSource.OnSelectObject(SelectObjectArgs e) in C:\MyProj\Csla\Web\CslaDataSource.cs:123<BR>&nbsp;&nbsp; Csla.Web.CslaDataSourceView.ExecuteSelect(DataSourceSelectArguments arguments) in C:\MyProj\Csla\Web\CslaDataSourceView.cs:60<BR>&nbsp;&nbsp; System.Web.UI.DataSourceView.Select(DataSourceSelectArguments arguments, DataSourceViewSelectCallback callback) +84<BR>&nbsp;&nbsp; System.Web.UI.WebControls.DataBoundControl.PerformSelect() +154<BR>&nbsp;&nbsp; System.Web.UI.WebControls.BaseDataBoundControl.DataBind() +99<BR>&nbsp;&nbsp; System.Web.UI.WebControls.GridView.DataBind() +23<BR>&nbsp;&nbsp; System.Web.UI.WebControls.BaseDataBoundControl.EnsureDataBound() +92<BR>&nbsp;&nbsp; System.Web.UI.WebControls.CompositeDataBoundControl.CreateChildControls() +100<BR>&nbsp;&nbsp; System.Web.UI.Control.EnsureChildControls() +134<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +109<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Control.PreRenderRecursiveInternal() +233<BR>&nbsp;&nbsp; System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +4437</FONT></FONT></P>
<P><FONT face="Courier New"><FONT face="Times New Roman">Here's the code returning the sorted binding list...</FONT>&nbsp;</FONT></P>
<P><FONT face="Courier New"><FONT size=2>private SortedBindingList&lt;The.Library.NameInfo&gt; GetNames()<BR>{<BR>&nbsp; UICMain obj = GetUICMain();<BR>&nbsp; Object names = obj.Names; //&nbsp;.Names is a NameInfoList class.<BR>&nbsp; return ((SortedBindingList&lt;UIC.Library.UICNameInfo&gt;)names);<BR>}<BR></FONT></FONT></P>
<P><FONT face="Courier New"><FONT size=2><FONT face="Times New Roman" size=3>Frankly, I'm confused. :)</FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Tuesday, August 01, 2006</h2>bump.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, August 03, 2006</h2>Sorry foks, but I'm still stumped on this one.&nbsp; Can anyone help out?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, August 04, 2006</h2>Well, ASP.NET is not my forte, but can you post the code to Main.Names?&nbsp; It looks like it is returning a NameInfoList instead of a SortedBindingList.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, August 04, 2006</h2>I think you need to change line 95 in the code posted to this:<br><br><font face="Courier New" size="2">return new SortedBindingList&lt;The.Library.NameInfo&gt;( names );<br><br>The problem is that will return a new sorted list; so the next page refresh would 'lose' the current sort... so you should cache the SortedBindingList and then read from the cache.<br><br>HTH<br>Andy<br></font><font face="Courier New" size="2"></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
