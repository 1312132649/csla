<html><header><title>Validation rules that require database checks</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Validation rules that require database checks</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1994.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate posted on Monday, December 18, 2006</h2><P>I have a situation where my application allows user administration of various entities that have unique fields, such as Name.&nbsp; This is a web app and I am making use of the CslaDataSource to work with the object.&nbsp; Because of this approach, each object is instantiated as a stand-alone object and not a part of a parent collection.</P>
<P>In reviewing all of the previous posts that have touched on this, including <A href="/forums/thread/4928.aspx">http://forums.lhotka.net/forums/thread/4928.aspx</A>&nbsp;and </P>
<P><A href="/forums/thread/7973.aspx">http://forums.lhotka.net/forums/thread/7973.aspx</A>, I've found that they all refer to checking if the parent collection contains an element sharing the value of the unique field.&nbsp; This is not possible here because we are in a multi-user environment and no parent collection is being used.&nbsp; Nonetheless, when a new customer is created, I need to ensure that the name is unique, for instance.</P>
<P>My initial thought is to execute a Command object when an attempt is made to save the object (either Insert or Update) that will perform the necessary logic to validate that the name is unique (there are some boundary issues in place, as in "unique within...", that are not emulated in our object model but that'll just over-complicate the discussion).&nbsp; If the Command object returns true, then we execute the Insert or Update as appropriate; otherwise, we return an error message to the user.</P>
<P>However, this now requires two round-trips to the database each time we want to save an object.&nbsp; Would it be better to simply&nbsp;perform the uniqueness check in our stored procedure and return an error code if the name is not unique?&nbsp; I hesitate to use error codes from sprocs because there's no direct correlation and you have to get into rules defining what an error code means, etc.</P>
<P>So, my question is how to perform a uniqueness test that MUST be performed on the database before an object can be inserted/updated?</P>
<P>Any suggestions?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, December 18, 2006</h2>Priate,<br><br>I'd just slap a unique constraint or index on the column and let that cause an error when you attempt to insert.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, December 18, 2006</h2>It is important that you realize you need to check that in the db too with a unique constraint or in the sp. Otherwise 2 users may add the same "Name" at the same time... Unlikely, but possible.<br>Considering that, you could use a name value list to check that in a rule, or you could have a "special rule" that only validates when you click save (you need to override save for that...).<br>Of course, you can always just check it in a regular rule and take the hit whenever the name is changed in the bo.<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>twistedstream replied on Monday, December 18, 2006</h2><P>I think in the case of the stateless web app, the Command object is less useful for this scenario.&nbsp; To me, a Command object comes in handy in a WinForms app when you want to provide the user with instant feedback the moment they enter data into the unique field.&nbsp; Unless you use Ajax (where you could fire off a Command object when the Textbox lost focus), I think the simplest approach would be to simply do that check by the database when the BO is committed.<o:p></o:p></P>
<P>Of course, the unfortunate thing here is that we're altering the design of the middle tier to accommodate the needs of the UI.&nbsp; Ideally the middle tier would be UI-agnostic, not having these types of constraints (i..e you would still implement the Command object).&nbsp; But if you're not having to service a WinForms UI, I would tend to keep it simple.&nbsp; You can always refactor a Command object back into the middle tier in the future if you need to.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, December 18, 2006</h2><P>I have a large Web app in production.</P>
<P>I use broken rules to check these kinds of things. That way the BO does not make the trip to the DataPortal until it is valid. Recognizing that 2 users could simultaneously add the same name means I still have the constraint in the DB as a backup. In my Broken Rules I call a CommandObject to give me the T/F response on uniqueness. This makes Validation a bit more expensive - but I think it is worth it.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
