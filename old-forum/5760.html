<html><header><title>Csla Authorization based on business property</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Csla Authorization based on business property</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5760.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius posted on Friday, November 07, 2008</h2><P>I'm just curious how others handle this sort of situation:</P>
<P>I have an authorization rule that depends on how one of the business properties&nbsp;get set. Should I just make this a custom business rule?&nbsp;And if so, should I make it throw a Security Exception, or just treat it as a Csla.Validation.ValidationException?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Friday, November 07, 2008</h2><P>I assume that by how the property gets set you mean the manner in which it is set and not the value it is set to.&nbsp; If you are looking to validate the value, then either use one of the CommonRules or create your own if that doesn't fit.&nbsp; If you are looking to validate the manner in which the property is set, then I'd use some sort of flag variable and create a custom rule method that evaluates the flag for whatever condition you are looking for and associate the method with the property so it is evaluated appropriately.</P>
<P>Perhaps you could explain the use case a bit more if this doesn't answer your questions.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>decius replied on Friday, November 07, 2008</h2><P>well the problem is that it's <EM>really</EM>&nbsp;supposed to be an authorization thing, but it depends on what the objects property is set to. basically it's like this:</P>
<P>if(myObject._someProperty == 0)</P>
<P>{</P>
<P>//The user is allowed to write to PropertyA</P>
<P>}</P>
<P>else</P>
<P>{</P>
<P>//The user is not allowed to write to PropertyA</P>
<P>}</P>
<P>&nbsp;</P>
<P>I just wasn't sure if most people treat that as a BusinessRule as opposed to an AuthorizationRule.&nbsp; From what I can tell, it seems you're saying that you'd treat it as a BuesinessRule?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Friday, November 07, 2008</h2><P>I would treat it as a validation business rule only if the user could do something to change the value of _SomeProperty.&nbsp;By that, I mean that your error message for property A&nbsp;can point to the explicit action that the&nbsp;user must take to make it possible to&nbsp;change the situation such that Property A is writable.&nbsp; </P>
<P>This sounds like you would like the textbox for entering A to be disabled for some values of _SomeProperty, or at least made read-only.&nbsp; I have not done this but it may be possible to change the property authorizations for property A whenever the value of _SomeProperty changes.&nbsp; Might be worth a look at the CSLA source code.</P>
<P>Jon Stonecash</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>dlambert replied on Friday, November 07, 2008</h2>Here's the scenario I've run into in the past.&nbsp; Imagine the Project Tracker app, except you want the Project Manager role to include the context of the object when doing authorization.&nbsp; So, given three projects (Pn) and three Project Managers (PMn), you might have a situation like this:<br><br>PM1 is the Project Manager for P1 and P2<br>PM2 is the Project Manager for P2<br>PM3 is the Project Manager for P3 and P1<br><br>You'd expect to evaluate CanWrite(P1, PM1) = True, and CanWrite(P1, PM2) = False, then, but you can't, because Authorization was all static.<br><br>Now, the last time I ran into this problem was way back in CSLA 2.0, and I haven't revisited this in CSLA 3.6, so things might be different now, but that was the issue back then.&nbsp; In a scenario like this, of course, an Exception would certainly be some form of Security Exception, because there's nothing the user can do at this point to change my mind about whether they can access this object.<br><br>I don't know that there's a solution here, but with any luck, maybe I've clarified the problem.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash replied on Friday, November 07, 2008</h2>My "rule of thumb" for this is that if the person entering data can change the situation so that they can get work done, it is a validation error.&nbsp; For example, if a particular number must be between 10 and 20 (inclusive), then I can output an error message that says "number has to be in the range 10 to 20".&nbsp; The user can then decide if it makes sense to enter a number between 10 and 20 or cancel the entire operation.&nbsp; <br><br>If, in your situation, the user can change their behavior and continue forward, then I think that it is a validation error.&nbsp; If the user cannot adjust their behavior to achieve success, it is an authorization error.&nbsp; <br><br>An example from my past: Each user is associated with a specific region.&nbsp; Each user is also either a reader or a creator.&nbsp; All users can look at the data for all regions.&nbsp; A creator user may create data within their own region, but may not create, update, or delete data in a different region.&nbsp; There are a few different ways to think about this.&nbsp; One, you could think of this as an authorization issue: the "create" button is enabled only if the user is a creator and the value entered in the region matches the region of the user.&nbsp; Two, you could think of this as a validation issue:&nbsp; assuming that the user is a creator, entering a value for the region other than the matching region value is a validation error.&nbsp; Three, you could simply fill in the region for the user from the user's region value and make the field read-only.&nbsp; If possible, I like answer #3: make it difficult to make mistakes.&nbsp; I like answer #1 less than #2 because #2 gives the user some information about what to do to fix the problem and #1 might not.<br><br>Just some thoughts.<br><br>Jon Stonecash<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
