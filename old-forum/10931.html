<html><header><title>Can Read/Write Property problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Can Read/Write Property problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10931.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal posted on Tuesday, November 29, 2011</h2><p>Hey everyone,</p>
<p>I&#39;ve been fighting issues in migration of older csla apps to the latest. So far i&#39;ve been able to work around (sometimes with some hacks) most of the issues related to the requirement of managed&nbsp; properties in some scenarios and the dropping of instance rules.</p>
<p>The only issue I can not work around is CanReadProperty and CanWriteProperty. Currently it&#39;s string overloads are not virtual, so you can&#39;t override them and if the property you&#39;re referring to is not a managed property they will throw an exception. I think this calls for more flexibility, considering there&#39;s lots of scenarios where a property will not necessarily need a data store of it&#39;s own, will have no business rules and thus doesn&#39;t require a PropertyInfo object.</p>
<p>The strongest argument for changing this method is in my view that consumers of the business library won&#39;t necessarily know which properties will have backing PropertyInfo objects and which won&#39;t. If somebody were to call CanReadProperty(&quot;IsDirty&quot;) instead of getting the expected &quot;true&quot;, you would get an exception for no reason. The problem is bigger when using readwrite authorization controls.</p>
<p>I think it would be a lot better if this could be changed to something more flexible, changing the string versions of CanReadProperty and CanWriteProperty to be overridable and not throwing an exception if there is no property info object, returning true by default. There&#39;s no reason to block execution if there&#39;s no explicit rule that makes a given property unavailable.</p>
<p>With those overridable versions you could make simple tests and check for simply:</p>
<p>if (!user.IsInRole(&quot;CanReadThisObjectsProperties&quot;)) { return false; }</p>
<p>That way you don&#39;t worry about specific properties and everything gets blocked. I&#39;ve got scenarios where the principal might change during the lifetime of the application. Because another user signs in objects that were available to the previous user for getting are now loaded in memory and perhaps even bound to an open form. This scenario would let me block the user from interacting with the object, but it&#39;s currently impossible to achieve.</p>
<p>&nbsp;</p>
<p>Cheers</p>
<p>Andres</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, November 30, 2011</h2><p>Hi Andres, </p>
<p>Considering that Windows Forms support may be removed for CSLA - I&#39;m not sure how much of these changes are going to make it into the CSLA code base. I do agree that these changes should have been in&nbsp;CSLA 4.x for better&nbsp;support for&nbsp; windows forms. </p>
<p>I am in the same process of migrating an application to CSLA 4 and have made these changes: </p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">1.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add ValidationRules (and BusinessRules extensions) to CSLA <span style="mso-spacerun:yes;">&nbsp;</span>to support &ldquo;old&rdquo; style validation rules.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">2.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Change CanReadProperty(string)/CanWriteProperty(string) to virtual in CSLA.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">3.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Create intermediate base classes (if you do not have them already).</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">4.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add overloads to intermediate base classes:</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 72pt;mso-list:l0 level2 lfo1;tab-stops:list 72.0pt;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">1.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add RegisterProperty overload to intermediate base classes that accepts string as first parameter.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 72pt;mso-list:l0 level2 lfo1;tab-stops:list 72.0pt;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">2.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add LoadProperty overload to intermediate base classes to support the old style LoadProperty. </span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 72pt;mso-list:l0 level2 lfo1;tab-stops:list 72.0pt;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">3.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add CanReadProperty/CanWriteProperty overloads to that return true if propertyName is not a registered property <br />ReadWriteAuthorization may else get an exception.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">5.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Change to use new style AuthorizationRules (overrides on CanReadProperty/CanWriteProperty will still work).</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">6.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">CommandObjects now make a copy (serialize) before calling Execute (ie all fields must be serializable).</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">7.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">CriteriaBase is now a generic base class and must have generic constraint.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">8.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">SingleCriteria should be removed &ndash; is considered obsolete in 4.x. </span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">9.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">All BO/CommandObjects/CriteriaBase objects should have managed properties only. </span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">10.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add Csla.Validation.BrokenRulesCollection to support BindingList based broken rules..</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">11.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Update Csla.Validation.BrokenRulesCollection.Merge method to accept Csla.Rules.BrokenRulesCollection as parameter.</span></span></p>
<p class="MsoListParagraph" style="text-indent:-18pt;margin:0cm 0cm 0pt 36pt;mso-list:l0 level1 lfo1;"><span lang="EN-US" style="mso-bidi-font-family:Arial;mso-bidi-theme-font:minor-latin;mso-ansi-language:EN-US;"><span style="mso-list:Ignore;"><span style="font-size:small;">12.</span><span style="font:7pt &#39;Times New Roman&#39;;">&nbsp; </span></span></span><span lang="EN-US" style="mso-ansi-language:EN-US;"><span style="font-size:small;">Add constructor overload to BrokenRule(string source, BrokenRule rule) for usage in Csla.Validation.BrokenRulesCollection</span></span></p>
<p>These steps is to make the application compile and run in CSLA 4 - then have a larger team of developers to get into rewriting the business rules.&nbsp; The changes above can (from my eperience) at most be done by 2 developers as it requires systematical changes to a lot af classes. We also created several ReSharper Structural Search and Replace patterns to migrate the code . </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, November 30, 2011</h2><p>Thanks Jonny, I am aware of those steps and I have already migrated most of the code. I have made some of those changes myself, but what I&#39;m suggesting is that the default implementation of canreadproperty and canwriteproperty be changed to be virtual and to not throw an exception if there&#39;s no managed property and return true in that case.</p>
<p>This is not really related to winforms. The same could happen in asp, mvc, wpf or any other platform... If you use a something else similar to the readwrite authorization control in windows forms, or if you&#39;re using reflection to get all properties and call CanReadProperty or if you explicitly call CanWriteProperty with a property name you shouldn&#39;t get an exception if there&#39;s no managed property for a real property. </p>
<p>&nbsp;</p>
<p>The fact that there&#39;s no managed property means that there can be no rule to say that you can&#39;t read or write to a given property, so that&#39;s why I&#39;m suggesting that the most logical behavior is for it to return true instead of failing. Don&#39;t you agree?</p>
<p>&nbsp;</p>
<p>Andr&eacute;s</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, November 30, 2011</h2><p>I absolutely agreee with you, Andr&eacute;s.&nbsp;</p>
<p>PropertyStatus and PropertyInfo (both in Csla.Xaml) &nbsp;use the CanReadProperty(string) and CanWriteProperty(string) and these methods should not throw exceptions if there is no corresponding registered PropertyInfo.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 30, 2011</h2><p>fwiw, the string overloads are planned for removal in the future.</p>
<p>The decision to firmly move toward a pure PropertyInfo based model was part of my CSLA 4 design, and the reason that some of the string-based functionality has limitations is because I view them as effectively obsolete. I didn&#39;t remove them, because I didn&#39;t want to break certain existing functionality as part of the version 4 release.</p>
<p>It is quite possible that 4.5 will be the point where those overloads go away entirely.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, November 30, 2011</h2><p>Does that mean that in the future the PropertyInfo objects will be exposed to consumers of the business object? Is there already an api for listing out the property info objects for a BO that I&#39;m not aware of? Or do we need to use reflection to get the property info objects associated to a property name?</p>
<p>To be honest, I&#39;m not so sure I understand this shift in direction. I really liked the property info concept when it was introduced because it has a lot of really good benefits. But I also find that it has limitations as well and originally they were not a problem because they weren&#39;t imposed, we could use the best of both worlds.</p>
<p>Every data binding stack out there relies on the property name string so in a way it would make sense to stick to that even though it&#39;s imperfect. I realize it&#39;s probably way too late to start a discussion on this matter, but I&#39;m just trying to &quot;get it&quot;. I&#39;m not sold on the 100% managed properties.</p>
<p>&nbsp;</p>
<p>Cheers!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, November 30, 2011</h2><p>I should probably be a bit more clear.</p>
<p>My plan is that all properties are described by PropertyInfo fields. Those fields should be public (now and in the future).</p>
<p>The old string-based API used to manually implemented property get/set code from CSLA 1.x and 2.x is what will entirely go away.</p>
<p>The string-based overloads of some methods required by the UI (necessary so the UI can retrieve rule information) will remain, but with the current implementation - so they&#39;ll translate the string name into the appropriate PropertyInfo object and then delegate to the real implementation. That&#39;s what happens now, and that isn&#39;t slated to change.</p>
<p>To put it another way, any remaining string-based methods will delegate to the real methods that are PropertyInfo based. We started this in 4.0, and I plan to continue down this road.</p>
<p>In 4.5 the existing metastate properties (like IsDirty) will become managed properties with PropertyInfo fields and standard event handling, etc. In other words, they&#39;ll become bindable properties. This may make Windows Forms binding perform worse, because I&#39;m not entirely sure we can avoid some duplicate PropertyChanged events from being raised as part of normal processing, and that&#39;ll result in more rebinding. But it will make XAML binding much simpler in some cases.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
