<html><header><title>Determining if an object has at least one save attempt</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Determining if an object has at least one save attempt</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1059.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fireworks posted on Tuesday, August 29, 2006</h2>Hi,<br><br>It's a bit more complicated than the title.&nbsp; I have a web page (Master/Detail) that has a 'Next' button (linkbutton).&nbsp; Think wizard.<br><br>If the user navigates to the page and doesn't fill out a detail record and save, they should be able to navigate away from the page when they click on 'Next'.&nbsp; If they partially fill in an object, and click 'Next', I want to try to save the object, and halt navigation if there are any brokenrules; to get them to correct or cancel out.<br>&nbsp;<br>Is there a way to determine if an object is new but has never had an attempted save?&nbsp; This would be my 'continue' condition.&nbsp; <br><br>I want to be able to check the object to see if it is new but no attempted saves, in which case I will allow navigation.&nbsp; If there has been an attempt to save it, I will try to save again, and show broken rules, if there is any.<br><br>It occured to me that maybe there was something in the edit levels (cloning?) that I could use.&nbsp; Like comparing the snapshots of the objects.&nbsp; I'm just guessing here as I don't really know how the edit levels work.&nbsp; <br><br>Any help would be greatly appreciated.&nbsp; Changing the CSLA framework code is open as an option.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 29, 2006</h2>This is the purpose behind IsDirty. If an object IsDirty, then it has been changed and not saved (because saving marks IsDirty as false).<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fireworks replied on Tuesday, August 29, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div>This is the purpose behind IsDirty. If an object IsDirty, then it has been changed and not saved (because saving marks IsDirty as false).<br></div></BLOCKQUOTE><br><br>True.&nbsp; But at least for me (the architecture guys have made some changes to the framework code), a 'new' object has IsDirty = true immediately, with just default values, and only changes to false after a successful save.<br><br>I need to tell the difference between an object that is new, but has default values, and one that is new but has had data changed.<br><br>Thanks for getting involved Rocky.<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Tuesday, August 29, 2006</h2>You could create your own IsDirty flag and change it by overriding OnPropertyChanged()...<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Tuesday, August 29, 2006</h2><P>Should this really be the business object's responsibility?&nbsp; If so, we don't have to persist <STRONG>all</STRONG> the properties of our business objects.&nbsp; </P>
<P>With that in mind, it seems most direct to simply have an integer property called something like SaveAttempts (initialized with a value of zero, of course) to keep track of the number of times the object's .Save method is called.&nbsp; You could increment it in your BO's Save method code before calling MyBase.Save, for example.&nbsp; Or you could make it the explicit responsibility of the UI (incrementing the value immediately before calling the Save method), if you feel that is a better division of responsibility.&nbsp; </P>
<P>Since a successful Save operation will return a New object, the count would be zero after a succesful Save, which it seems is exactly the behavior you want, right?</P>
<P>Keep in mind that the object won't be New any more once you have completed a successful Save.&nbsp; So your "continue condition" should probably not be concerned with the .IsNew property at all.&nbsp; It should just&nbsp;test .IsValid (which should be false if the Broken Rules collection isn't empty) and SaveAttempts&nbsp;= 0.&nbsp; </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fireworks replied on Tuesday, August 29, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Q Johnson:</strong></div><div>
<p>With that in mind, it seems most direct to simply have an integer property called something like SaveAttempts (initialized with a value of zero, of course) to keep track of the number of times the object's .Save method is called.&nbsp; You could increment it in your BO's Save method code before calling MyBase.Save, for example.&nbsp; Or you could make it the explicit responsibility of the UI (incrementing the value immediately before calling the Save method), if you feel that is a better division of responsibility.&nbsp; </p></div></BLOCKQUOTE><br><br>I had thought of that.&nbsp; I might just do that to get things off the ground, and let the architecture guys get wind of it later :)<br><br>I could just add a public method that calls MarkClean(), or do the same for IsDirty (suggested above).<br><br>I just wanted to make sure that I hadn't missed something.<br><br>Big thank you to everybody!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 29, 2006</h2>The behavior of IsDirty is true if IsNew is true is default CSLA behavior, and follows the rules I defined in the book for these properties. IsDirty means that one or more fields in the object are believed to not match values in the database - which is obviously the case for any new object. IsNew means that the primary identifying values/keys of the object don't have corresponding values in the database, which is also the case for any new object.<br><br>However, the desire to have a new object NOT be dirty is not unique to you. It has come up many times on the forum (the old one anyway), and as a result in 2.0 I changed MarkNew() to be Overridable/virtual specifically so you could change the behavior.<br><br>So what you may prefer to do is override MarkNew like this<br><br>&nbsp;&nbsp;&nbsp; protected override void MarkNew()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.MarkNew();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkClean();<br>&nbsp;&nbsp;&nbsp; }<br><br>This way your object is new, but not dirty.<br><br>Note that MarkNew() is not called when an object is created, so you'll also have to explicitly call it in your constructor.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
