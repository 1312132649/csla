<html><header><title>Design Question: two libraries or one?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Design Question: two libraries or one?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1335.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>longbridge posted on Tuesday, September 26, 2006</h2><P class=MsoNormal>Hi, I am developing a windows application using CSLA.NET2.0 and VS.Net2005. </P>
<P class=MsoNormal>&nbsp;</P>
<P class=MsoNormal>It has two versions. One version stores/retrieves the data from remote Data Portal based on MSSQL Server, the other only use the local file as&nbsp;its storage.&nbsp;&nbsp;The behaviors of business objects for these two versions are almost same. The differences only exist in the data access codes and criteria parts. So I am trying to unify them together into one library to make the high level data binding more convenient. I know I can use bunch of "if..else" to do it, but it is not a good design and will mess up the codes a lot. I also tried to use interfaces to abstract the behaviors of business object, but it seems the static factory functions can not be put into the interface directly. I am totally stucked there. Did anybody deal with similar problem before? Is&nbsp;there a good design pattern to sovle&nbsp;this? Thanks a lot.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Tuesday, September 26, 2006</h2>I think what you want to look at is a Data Access layer (maybe NHibernate?).&nbsp; One of the members who has used one or two data access layers will probably pipe in by tomorrow.&nbsp; In essence, you want your business objects to call a single method to do a CRUD operation, and the data access layer should determine which data source you are currently targeting and perform the operation as appropriate.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 26, 2006</h2>Or roll your own data access layer.<br><br>In that case, I'll look at an approach using data transfer objects (DTOs), with an interface-based API defining the DAL itself. So in a typical DataPortal_Fetch(...) you'd do something like this (for a Person class as an example):<br><br>Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)<br>&nbsp; Dim dal As IDal = DalFactory.GetDal()<br>&nbsp; Dim dto As PersonData = dal.GetPerson(criteria.Id)<br>&nbsp; With dto<br>&nbsp;&nbsp;&nbsp; _id = .Id<br>&nbsp;&nbsp;&nbsp; _name = .Name<br>&nbsp;&nbsp;&nbsp; _city = .City<br>&nbsp;&nbsp;&nbsp; ' ...<br>&nbsp; End With<br>End Sub<br><br>The DalFactory class would then be responsible for determining whether you should be using a local database or SQL Server (or whatever), and returning the appropriate type of IDal object.<br><br>Obviously there are variations on this theme, and I'm intentionally being overly simplistic here to illustrate the basic concept.<br><br>In the end, you'd probably have three assemblies:<br><ol><li>Business library</li><li>DTO library</li><li>DAL</li></ol>Both the business library and DAL reference the DTO library. And the business library references the DAL as well.<br><br>The DAL assembly can be implemented in a couple ways. Either way, that assembly has IDal defined, along with the DalFactory class.<br><br>The DAL assembly might include both implementations of IDal, probably in two different namespaces. The DalFactory simply chooses the correct one to use.<br><br>Or the DAL assembly might only include IDal and DalFactory. You may have other assemblies for each actual DAL implementation - in which case those assemblies would reference the DAL assembly, and the DalFactory class would use dynamic assembly loading (provider pattern) to load the correct one.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BBM replied on Tuesday, September 26, 2006</h2><P>Hi Rocky,</P>
<P>I have a similar problem, and your approach looks interesting.&nbsp; However, I'm having trouble connecting the dots.&nbsp; Could you expound some more on what the IDAL interface would look like and how a DTO works, or&nbsp;could you point me to&nbsp;some additional information?</P>
<P>Thanks.</P>
<P>BBM</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>longbridge replied on Wednesday, September 27, 2006</h2><P>Thanks. Rocky.&nbsp;</P>
<P>&nbsp;In your design, does the DTO class only contain the data members of corresponding Business Object? And&nbsp;Each Business Object should have its own&nbsp;corresponding DTO class. Do I understand this right? Thanks. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>longbridge replied on Wednesday, September 27, 2006</h2><P>Hi, malloc1024. Through the link your gave, I found Plugin pattern might fit.</P>
<P><A href="http://www.martinfowler.com/eaaCatalog/plugin.html">http://www.martinfowler.com/eaaCatalog/plugin.html</A></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, September 27, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>longbridge:</strong></div><div><p>Thanks. Rocky.&nbsp;</p>
<p>&nbsp;In your design, does the DTO class only contain the data members of corresponding Business Object? And&nbsp;Each Business Object should have its own&nbsp;corresponding DTO class. Do I understand this right? Thanks. </p></div></BLOCKQUOTE><br><br>As I noted in my post, there are many variations on this theme, and I was describing the "simplest" in order to keep the discussion at a conceptual level.<br><br>While you can have one DTO per business object, you can also think of the DAL methods as being stored procedures, with the DTOs being the data set returned from the procedure. In that case, you could construct your DAL as an abstract data model - and in that case you might reuse a DTO across business objects, much like you might reuse a stored procedure across business objects if you are using ADO.NET directly.<br><br>Of course doing so would directly impose a level of coupling between the multiple business objects and their common DAL method/DTO definition - and that can lead to code that is harder to maintain.<br><br>It is a trade-off between writing more code vs writing less code, and increasing maintainability vs increasing coupling.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Tuesday, September 26, 2006</h2>

<p class="MsoNormal">Another option besides using DTOâ€™s would be to use the Separated
Interface pattern to create your DAL.<span>&nbsp; </span><a href="http://www.martinfowler.com/eaaCatalog/separatedInterface.html">http://www.martinfowler.com/eaaCatalog/separatedInterface.html</a></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
