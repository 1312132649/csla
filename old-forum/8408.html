<html><header><title>EditableRoot.Save(true); does not set IsDirty to true.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditableRoot.Save(true); does not set IsDirty to true.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8408.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski posted on Tuesday, January 26, 2010</h2>Hello,<br /><br />I am creating a set of unit tests for PetShop and I have the following test that fails:<br /><br />category = category.Save(true);<br /><br />            Assert.IsFalse(category.IsNew);<br />            Assert.IsTrue(category.IsDirty); // Fails: Save docs say this should be the case..<br />            Assert.IsFalse(category.IsDeleted);<br /><br />According to the documentation .Save(true) should set IsNew to false and IsDirty to true.<br /><br />Thanks<br />-Blake Niemyjski</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, January 26, 2010</h2>I think you misunderstand the purpose;&nbsp; it sets IsNew to false and IsDirty to true, THEN does the normal save.&nbsp; This allows you to bypass fetching the object from the database to do the update, and is usually used in Asp.Net.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Tuesday, January 26, 2010</h2>Hello, <br /><br />Please reread my post that is exactly what I said above. The tests fail when I check for this behavior. <br /><br />Thanks <br />-Blake Niemyjski</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Tuesday, January 26, 2010</h2>Documentation says:<br /><br />This is done by first calling MarkOld() to set IsNew to false, and then calling MarkDirty() to set IsDirty to true.<br /><br /><br />Code says:<br /><br />public T Save(bool forceUpdate)<br />{<br />    if (forceUpdate &amp;&amp; IsNew)<br />    {<br />        MarkOld();<br />        MarkDirty(true);<br />    }<br />    return this.Save();<br />}<br /><br />The documentation is correct, what you are missing is that *after* what the doc says, the procedure also runs the regular Save(). just like Andy pointed out.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Tuesday, January 26, 2010</h2>I think the documentation on that method needs to be updated. It is not clear that is the behavior from reading the xml documentation. I agree that save can alter the IsDirty / IsNew. The documentation should read as follows: The Type will be marked as IsNew to false and IsDirty to true before Save Is called.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Tuesday, January 26, 2010</h2>The fact that you are calling the save method should be indication enough that the the object will be saved. The parameter naming also makes it pretty obvious that you are attempting to force the save to occur.<br /><br />Documentation can only get you so far.<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lukky replied on Tuesday, January 26, 2010</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Marjon:</strong></div><div>Documentation can only get you so far.</div></BLOCKQUOTE><br /><br />Uuugghhh.... sometimes it's the ONLY thing you have !<br /><br />Having had to work with the API of a german software, I can tell you that parameter naming can take you for a joy ride. And of course, no source available....<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 26, 2010</h2><P>The behavior has changed back and forth a couple times over the years.</P>
<P>And your description isn't really correct either. It isn't that the metastate changes before Save() - it changes before <EM>each individual call to DataPortal_XYZ and/or Child_XYZ</EM>.</P>
<P>For the longest time it occurred after the DP_XYZ calls, specifically to avoid this type of coding mistake on the part of the object developer. But that meant that your code inside the DP_XYZ methods couldn't really use the metastate, which is a very real problem.</P>
<P>So a while back (I don't remember the version anymore) I changed the data portal to set the metastate before calling the DP_XYZ methods. This means those methods can use the metastate, but it also means that the developer is now responsible for getting their DP_XYZ code correct.</P>
<P>That's probably for the best anyway - it really isn't ideal for a framework to cover up bugs like it used to do.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
