<html><header><title>LoadProperty bug - CSLA 4 beta 3 and RC0</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LoadProperty bug - CSLA 4 beta 3 and RC0</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9194.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Smith866 posted on Friday, July 09, 2010</h2><p>Hi,</p>
<p>I have a CSLA 4 project that encountered an issue as soon as I upgraded it to beta 3 or RC0.&nbsp; In my project I have a ReadOnlyBase object.&nbsp; In my DataPortal_Fetch method, I am calling LoadProperty(PropertyInfo, object) - the non-generic version.&nbsp; This call throws a NotSupportedException on line 288 of MethodCaller.cs.&nbsp; The Exception message says &quot;The property &#39;MyProperty&#39; on Type &#39;Business.MyBusinessObject&#39; does not have a public setter.&quot;&nbsp; This is of course true because this is a read-only object.</p>
<p>If I change my LoadProperty call to use the generic method instead, then I do not receive the exception.&nbsp; In fact, if I use that generic method instead, the CallPropertySetter(object,string,object) method in MethodCaller.cs (where the exception occurs)&nbsp;never even gets called.</p>
<p>I see in the change log that LoadProperty was modified to bring parity between the generic and non-generic method, but perhaps this is not the case?</p>
<p>Any help would be very much appreciated!</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mdbzntcd replied on Friday, July 09, 2010</h2><p>Just ran into a similar problem with one of my classes after upgrading to the RC.&nbsp; I was trying to load an int into a short property without casting first.&nbsp; After adding an explicit cast in the method call, the error went away.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, July 10, 2010</h2><p>This is because of a change in the RC release where the non-generic LoadProperty() now invokes the property setter, thus (indirectly) invoking the generic LoadProperty() to get the same behavior.</p>
<p>This change means you now need to have a setter (public in SL, non-public is fine in .NET) on your property. That setter should call LoadProperty().</p>
<p>I typically do this regardless - even my read-only properties have a private setter that calls LoadProperty().</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 15, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b></p>
<p>This is because of a change in the RC release where the non-generic LoadProperty() now invokes the property setter, thus (indirectly) invoking the generic LoadProperty() to get the same behavior.</p>
<p>This change means you now need to have a setter (public in SL, non-public is fine in .NET) on your property. That setter should call LoadProperty().</p>
<p>I typically do this regardless - even my read-only properties have a private setter that calls LoadProperty().</p>
<div style="clear:both;"></div>
<p></div></p>
<p>I am not happy with the change we made to the non-generic LoadProperty() - this change that requires properties to have a setter.</p>
<p>So I just checked in a change so the non-generic LoadProperty() now uses reflection to invoke the generic LoadProperty(). This means that no setter is required, and the non-generic implementation has the same behavior as the generic implementation (since it just invokes the generic implementation).</p>
<p>The only drawback to <i>this approach</i> is that reflection is involved, so there&#39;s a potential performance impact. But this may be the best overall solution, since it ensures the same behavior, doesn&#39;t force me to duplicate a bunch of complex code and doesn&#39;t force properties to have setters.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Thursday, July 22, 2010</h2><p>Where&#39;s the link from which to download the latest RC &nbsp;that incorporates this change (I guess it&#39;s RC1 4.0.0-100719)? The read-only LoadProperty thing is important.</p>
<p>&nbsp;</p>
<p>Cheers!</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 22, 2010</h2><p>Yes, the change should be in RC1 - <a href="http://www.lhotka.net/cslanet/download.aspx">http://www.lhotka.net/cslanet/download.aspx</a></p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Thursday, July 22, 2010</h2><p>Hmmm - that&#39;s the release I&#39;m using now. The bug still appears in Command objects inheriting from CommandBase that contain read-only objects.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Thursday, July 22, 2010</h2><p>I mean - read only properties.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 22, 2010</h2><p>Arg! Yeah, my bad. Probably doesn&#39;t work in ROB either <img src="http://forums.lhotka.net/emoticons/emotion-10.gif" alt="Embarrassed" /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 22, 2010</h2><p>OK, I fixed that issue (with a couple new unit testing bits). The fix is in svn, so if you pull the latest code you can have the fix now, otherwise it will be in RTM.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
