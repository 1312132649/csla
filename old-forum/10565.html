<html><header><title>Manual Transaction with a plugable DAL</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Manual Transaction with a plugable DAL</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10565.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>paul_rockerdale posted on Wednesday, July 27, 2011</h2><p>Hi</p>
<p>I&#39;m stuck with a SQL&nbsp;2000 DB but I&#39;m using CSLA4. Because the database is old I&#39;m going to have to use manual transactions right? Well I don&#39;t think transactionscope will work well a SQL 2000DB?</p>
<p>I&#39;ve read that I can use the TransactionManager object to help&nbsp;me&nbsp;reuse&nbsp;a&nbsp;connection&nbsp;and an existing transaction. What I&#39;m trying to figure out is how I&nbsp;can start a transaction in my dataportal class library class and pick this up in my DAL classes for parent and child dals. </p>
<p>Could I start transaction using the transaction manager&nbsp;inside my dal manager; were the dal manager is created in the dataportal method;&nbsp;and then use the&nbsp;Transaction manager using block&nbsp;in the&nbsp;DAL&#39;s CRUD methods?</p>
<p>Here&#39;s my dataportal method on my root object</p>
<p>[Transactional(TransactionalTypes.Manual)]<br />protected override void DataPortal_Update()<br />{<br />&nbsp;using (var dalManager = DataAccess.DalFactory.GetManager())<br />&nbsp;{<br />&nbsp;&nbsp;// **** MY METHOD IN THE DALMANAGER ****<br />&nbsp;&nbsp;dalManager.BeginTran</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dal = dalManager.GetProvider&lt;DataAccess.IPersonDal&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (BypassPropertyChecks)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dal.Update(Id, FirstName, LastName, TitleId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;FieldManager.UpdateChildren(this);</p>
<p>&nbsp;&nbsp;dalManager.commit<br />&nbsp;}<br />}</p>
<p>&nbsp;Here and dal method</p>
<p>public void Update(int id, string firstName, string lastName, int TitleId)<br />{<br />&nbsp;using (var ctx = TransactionManager&lt;SqlConnection, SqlTransaction&gt;.GetManager(&quot;LocalDb&quot;))<br />&nbsp;{<br />&nbsp;&nbsp;using (var cm = ctx.Connection.CreateCommand())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandType = System.Data.CommandType.Text;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.CommandText = &quot;UPDATE CslaPerson SET <a href="mailto:FirstName=@firstName,%20LastName=@lastName,%20TitleId=@TitleId">FirstName=@firstName, LastName=@lastName, TitleId=@TitleId</a> WHERE <a href="mailto:Id=@id">Id=@id</a>&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue(&quot;@id&quot;, id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue(&quot;@firstName&quot;, firstName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue(&quot;@lastName&quot;, lastName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue(&quot;@TitleId&quot;, TitleId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var rowsAffected = cm.ExecuteNonQuery();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rowsAffected == 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new DataNotFoundException(&quot;Person&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;}<br />}</p>
<p>&nbsp;</p>
<p>PS. I&#39;m using the EncapsulatedInvoke technique.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, July 27, 2011</h2><p>Yes, the DAL manager for your concrete DAL implementation can open the connection and start the transaction with the transaction manager. All other code using the transaction manager on that thread will get the same transaction.</p>
<p>You don&#39;t want your DP_XYZ code calling begin/commit/rollback though. That prevents composition of your business types.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Wednesday, July 27, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>RockfordLhotka<br></b>
<p>...</p>
<p>You don&#39;t want your DP_XYZ code calling begin/commit/rollback though. That prevents composition of your business types.</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>We used manual transaction management since we started.</p>
<p>I solved the composition issue&nbsp;by using a concept of a &quot;transaction context&quot; being managed at the thread level (only one context with an open transaction per thread at any one time).&nbsp; Typically, the &quot;server-side&quot; methods pass the context around explicitly as a parameter, but if you call a client-side method (e.g. &quot;Save&quot;), the DP_XYZ method will automatically enlist itself in the currently open transaction if there is one, otherwise it will begin a new one. </p>
<p>It has really worked out well -- we can compose our BO&#39;s arbitrarily without explicit regard to transaction boundaries.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, July 27, 2011</h2><p>Yes, Csla.Data includes a transaction manager type for this purpose.</p>
<p>But that type of detail belongs to the DAL, not the DP_XYZ methods.</p>
<p>One DAL might use ADO.NET transactions. Another might use TransactionScope or something. A mock DAL will probably have no transaction concept. The DP_XYZ methods should be neutral to what technology (if any) is used.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>paul_rockerdale replied on Thursday, July 28, 2011</h2><p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">I suppose were I&#39;m struggle is visualising the nesting of manual transactions. So this is how I see it.</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">I&#39;ve a&nbsp;Root object that contains a child list. I&#39;ve created two DAL classes; one class for the root and one for child. The update method in the root DAL wraps the update statement with ......&nbsp;</span><span style="font-family:Courier;color:black;font-size:9pt;mso-bidi-font-family:Arial;"> </span><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;">using</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;"> (</span><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;">var</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;"> ctx = </span><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:10pt;">ConnectionManager</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;">&lt;</span><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:10pt;">SqlCeConnection</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;">&gt;.GetManager(</span><span style="font-family:&#39;Courier New&#39;;color:#a31515;font-size:10pt;">&quot;LocalDb&quot;</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;">)).</span><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;"> In the child DAL I use a separate using statement. These two using statements; one in the root DAL; and one in the child DAL; don&#39;t appear to be nested. </span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">However, in the root DataPortal_XYZ method I create a DAL Manager and in its constructor I create a variable to hold a transaction manager object. I&#39;ve created a DAL manager in my dataportal root with a using statement..... </span><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;">using</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;"> (</span><span style="font-family:&#39;Courier New&#39;;color:blue;font-size:10pt;">var</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;"> dalManager = DataAccess.</span><span style="font-family:&#39;Courier New&#39;;color:#2b91af;font-size:10pt;">DalFactory</span><span style="font-family:&#39;Courier New&#39;;color:black;font-size:10pt;">.GetManager())..... </span><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:10pt;">So I&#39;m assuming&nbsp;whilst in this using block all calls to the DAL will be nested within&nbsp;one transaction (if all calls are on the same thread). So in my root DAL I can open a connection and set&nbsp;a transaction isolation level. But where would I commit the transaction? Or will it simply commit when the dataportal using statement for the DalManager completes, assuming no errors occur.</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 28, 2011</h2><p>You wouldn&#39;t use a ConnectionManager anymore - instead you&#39;d use a TransactionManager.</p>
<p>ADO.NET transaction objects have a Connection property, so you really only need to ensure that the transaction is set up when the DalManager is created - and everyone can use that transaction, and the connection to which it is associated.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>paul_rockerdale replied on Wednesday, August 03, 2011</h2><p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">Ok to recap.&nbsp;I create my Root DAL manager inside my parent DP_XYZ method&nbsp;by doing ....using (var dalManager = DataAccess.DalFactory.GetManager()). My&nbsp;Root DAL Manager constructor looks like the code below. The Root manager DAL controls the start of the transaction, were I will have control over what isolation level I want for the transaction. All OrderDal, OrderItemDal and OrderPersonItem&nbsp;can all use the same transaction by using the TransactionManager. Great....</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;">But now&nbsp;to the problem... The commit variable in the transaction manager can only be set to True when the refcount&nbsp;equals 1. So the commit has to be handled by the root DAL Manager. But where can I do the commit? I can&#39;t do the commit&nbsp;via the DP_XYZ as this will effect composition. There&#39;s not much point doing it via the OrderDal because the TransactionManager&nbsp;refcount will equal 2. So I thought about doing it in the dispose method of the root DAL Manager, but surely that can&#39;t be the correct place to call a Commit, can it?&nbsp;It feels like all avenues to commit the transaction have been close off... this has lead me to the conclusion that I must be doing something fundamentally wrong :-(&nbsp;</span></p>
<p><span style="font-family:&#39;Arial&#39;,&#39;sans-serif&#39;;color:black;font-size:9pt;"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DalManager()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnectionManager = ConnectionManager&lt;SqlConnection&gt;.GetManager(&quot;LocalDb&quot;);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if we in the root begin a transaction<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ConnectionManager.RefCount == 1)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnectionManager.Connection.BeginTransaction(Serializable); //TO&nbsp;DO&nbsp;ensure&nbsp;fetches don&#39;t use Serializable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TransactionManager = TransactionManager&lt;SqlConnection, SqlTransaction&gt;.GetManager(&quot;LocalDb&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void Dispose()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TransactionManager.Commit();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TransactionManager.Dispose();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TransactionManager = null;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnectionManager.Dispose();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnectionManager = null;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, August 03, 2011</h2><p>The TransactionManager type is designed primarily to be used within a series of nested using blocks. At the end of each using block, right before the using block is exited, Commit is called. That way, if any exception occurs within the using block, Commit isn&#39;t called, so the transaction is rolled back.</p>
<p>Because your DAL code isn&#39;t directly using the TransactionManager, you need to elevate that behavior to the object that the code is using: your DalManager.</p>
<p>In other words, your DalManager needs a Commit method, that just delegates to the TransactionManager. And in your DAL code, at the bottom of each DalManager using block you should call Commit - that will achieve the same result.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>paul_rockerdale replied on Wednesday, August 03, 2011</h2><p>Thanks for you help.</p>
<p>My mistake&nbsp;was my misinterpretion of &quot;You don&#39;t want your DP_XYZ code calling begin/commit/rollback though. That prevents composition of your business types.&quot; I took the first part to mean I can&#39;t do DALManager.commit; were the commit was going to delegated to whatever concreate implementation is required.</p>
<p>Now with that done I can start doing my T4 code gen of my CSLA classes.... exciting times <img src="http://forums.lhotka.net/emoticons/emotion-1.gif" alt="Smile" /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stiv replied on Wednesday, June 19, 2013</h2><p>Hello Paul,</p>
<p>Do you have an example of your implementation of the business objects root and child using the TransactionManager, i&acute;m trying to achieve the same solution.</p>
<p>Thanks in advance,</p>
<p>Stiv</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>karlcraft replied on Thursday, August 04, 2011</h2><p>Hi Rocky and Paul,</p>
<p>I too have been looking at the TransactionManager, my only concern is that I couldn&#39;t see a way to set the transaction Isolation level that the transaction manager will use. Ideally we want to use Serializable as the isolation level for our updates. </p>
<p>I noted in your Using CSLA 4 chapter 3 Data Access book (pg 44) that you state the following regarding the use of TransactionScope :- </p>
<p>The TransactionScope created by the data portal uses default values for all settings, including the isolation level and timeout value. This means the transaction is Required, has an isolation level of Serializable, and has a one minute timeout. If you need different values from the defaults you will need to use manual transactions and create your own TransactionScope object. </p>
<p>I guess my question is this, why does the TransactionScope use Serializable, but the Transaction Manager does not?</p>
<p>I have reflected on the code in the Transaction Manager Class and it doesn&#39;t set the isolation level, </p>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">private</span> <b><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c,%3e/.ctor(String,String)">TransactionManager</a></b>(</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.String" title="System.String

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">string</span></a><span style="font-family:Courier New;font-size:x-small;"> connectionString, </span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.String" title="System.String

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">string</span></a><span style="font-family:Courier New;font-size:x-small;"> label) </span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp; {</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_label:String" title="string Csla.Data.TransactionManager&lt;C,T&gt;._label;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_label</span></a><span style="font-family:Courier New;font-size:x-small;"> = label;</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_connectionString:String" title="string Csla.Data.TransactionManager&lt;C,T&gt;._connectionString;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_connectionString</span></a><span style="font-family:Courier New;font-size:x-small;"> = connectionString;</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_connection:%3c!0%3e" title="C Csla.Data.TransactionManager&lt;C,T&gt;._connection;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_connection</span></a><span style="font-family:Courier New;font-size:x-small;"> = (<span style="color:#1000a0;">default</span>(C) == <span style="color:maroon;">null</span>) ? </span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.Activator" title="System.Activator

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">Activator</span></a><span style="font-family:Courier New;font-size:x-small;">.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.Activator/CreateInstance%3c%3e():%3c!!0%3e" title="C System.Activator.CreateInstance&lt;C&gt;();

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">CreateInstance</span></a><span style="font-family:Courier New;font-size:x-small;">&lt;C&gt;() : <span style="color:#1000a0;">default</span>(C);</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_connection:%3c!0%3e" title="C Csla.Data.TransactionManager&lt;C,T&gt;._connection;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_connection</span></a><span style="font-family:Courier New;font-size:x-small;">.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Data:4.0.0.0:b77a5c561934e089/System.Data.IDbConnection/property:ConnectionString:String" title="string System.Data.IDbConnection.ConnectionString { ... }

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">ConnectionString</span></a><span style="font-family:Courier New;font-size:x-small;"> = connectionString;</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_connection:%3c!0%3e" title="C Csla.Data.TransactionManager&lt;C,T&gt;._connection;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_connection</span></a><span style="font-family:Courier New;font-size:x-small;">.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Data:4.0.0.0:b77a5c561934e089/System.Data.IDbConnection/Open()" title="void System.Data.IDbConnection.Open();

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">Open</span></a><span style="font-family:Courier New;font-size:x-small;">();</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_transaction:%3c!1%3e" title="T Csla.Data.TransactionManager&lt;C,T&gt;._transaction;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_transaction</span></a><span style="font-family:Courier New;font-size:x-small;"> = (T) <span style="color:#1000a0;">this</span>.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Csla:4.1.0.0:93be5fdc093e4c30/Csla.Data.TransactionManager%3c%3c!0%3e,%3c!1%3e%3e/_connection:%3c!0%3e" title="C Csla.Data.TransactionManager&lt;C,T&gt;._connection;

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">_connection</span></a><span style="font-family:Courier New;font-size:x-small;">.</span><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Data:4.0.0.0:b77a5c561934e089/System.Data.IDbConnection/BeginTransaction():System.Data.IDbTransaction" title="IDbTransaction System.Data.IDbConnection.BeginTransaction();

CTRL+Click to open in new tab."><span style="font-family:Courier New;font-size:x-small;">BeginTransaction</span></a><span style="font-family:Courier New;font-size:x-small;">();</span></pre>
<pre><span style="font-family:Courier New;font-size:x-small;">&nbsp;&nbsp; &nbsp;}</span></pre>
<p>
<p>&nbsp;</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 04, 2011</h2><p>That may be a documentation error. When I wrote that bit in the book, I based it on an MSDN article - in terms of the defaults for TransactionScope. Perhaps the article was out of date, or wrong?</p>
<p>What is the default isolation level?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>paul_rockerdale replied on Thursday, August 04, 2011</h2><p>msdn&nbsp;does say that the default isolation level for a transaction scope is serializable.</p>
<p>For Connection.BeginTransaction msdn says it just uses the default... Which for an&nbsp;sql 2000 database the default is read commited <a href="http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx">http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx</a>.</p>
<p>When I used the transaction manager the isolation level is set to readcommited in my database... i veiwed this in profiler.</p>
<p>I tried to be sneaky in my code by kicking of a transaction via the connection manager with the hope that the transaction manager will pick up the same connection and transaction&nbsp;when Transaction Manager comes into play. Well it didn&#39;t work... worth a try though!</p>
<p>I suppose all I really need is for the Transaction Manager to be serializable too. Can this be changed?</p>
<p>&nbsp; </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 04, 2011</h2><p>TransactionManager can&#39;t unilaterally change to a different isolation level. What should happen, is that TransactionManager should have a static property that allows you to supply a &quot;transaction provider&quot; so you create the transaction instead of TransactionManager creating the transaction. </p>
<p>I&#39;ll add this to the wish list.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Thursday, August 04, 2011</h2><p>How about the same for Transactional attribute based on Transaciton scope?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 04, 2011</h2><p><div style='padding-left: 50px;background-color:silver'><b>sergeyb<br></b>
<p>How about the same for Transactional attribute based on Transaciton scope?</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>Yes, that is a good idea as well.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
