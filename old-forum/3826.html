<html><header><title>Databinding issue</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Databinding issue</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3826.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea posted on Thursday, November 01, 2007</h2><P>I am using Winforms and CSLA 2.1.4. I have a textbox which extends the System.Windows.Forms.TextBox and adds some typical functionality when bound to a Csla object. One of them is to set the control as read only if the user cannot edit the property the control is bound to (using of course the CanWriteProperty() method). I noticed that when&nbsp;setting the focus&nbsp;inside the textbox (which currently is set to readonly) and tab out without of course making any changes, data binding tries to update my object. So a security exception is thrown but "absorbed" by databinding, thus locking the focus on the control! So the user is stuck in there and cannot even close the window.<BR>The only workaround I can think of is to change the setter of my property as follows:</P>
<P>From:<BR><FONT color=#0000ff size=2>set<BR></FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;CanWriteProperty(</FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>);<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2> == </FONT><FONT color=#0000ff size=2>null</FONT><FONT size=2>) </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2> = </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>.Empty;<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (_name != </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_nam1 = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PropertyHasChanged(</FONT><FONT color=#a31515 size=2>"Name"</FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;}<BR>}</P></FONT>
<P>To:<BR><FONT size=2><FONT color=#0000ff>set<BR></FONT>{<BR>&nbsp;&nbsp;&nbsp;<FONT color=#0000ff>if</FONT> (<FONT color=#0000ff>value</FONT> == <FONT color=#0000ff>null</FONT>) <FONT color=#0000ff>value</FONT> = <FONT color=#0000ff>string</FONT>.Empty;<BR><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;if</FONT> (_name != <FONT color=#0000ff>value</FONT>)<BR>&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CanWriteProperty(<FONT color=#a31515>"Name"</FONT>, <FONT color=#0000ff>true</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_name = <FONT color=#0000ff>value</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PropertyHasChanged(<FONT color=#a31515>"Name"</FONT>);<BR>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></P>
<P>But I don't really want to do this... Has anybody had any similar problems or can suggest a solution?<FONT size=2></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Thursday, November 01, 2007</h2>Some suggestions:<br>1. One would hope that you are using a BindingSource.&nbsp; (.net 2/3 databinding 101)<br>2. One would hope that for simple controls you have implemented the csla BindingSourceRefresh control. 3. most importantly for the behaviour you are suggesting:&nbsp; In your Databindings.Add statements set the DataSourceUpdateMode to .OnPropertyChanged rather than the default of&nbsp; .OnValidation. (If using the designer to set up your controls then locate and change the options there. but you might want to move the DataBindings.Add&nbsp; code into your form code rather than the designer to avoid loosing your custom settings - avoid the designer as much as possible)<br>
<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, November 01, 2007</h2><P>Thanks Jimbo</P>
<P>1. Yep I am using a&nbsp;BindingSource<BR>2. That's a no... I admit that I just now read about the BindingSourceRefresh and ReadWriteAuthorizer controls which makes me feel dumb. I will definately strip that enabling/disabling functionality from my controls and use ReadWriteAuthorizer.<BR>3. I did try change this but there was no difference. I have seen other forums suggesting this change but at the moment I have left the default .OnValidation. But surely this shouldn't make a difference?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Thursday, November 01, 2007</h2>Im not conversent with the ReadWriteAuthorizer control - must be new in 3.<br><br>However on point 3 there is a difference when you are using csla style property setters and post validadation rather than pre validation or validation events.&nbsp; This is where we have usually had problems with locking.&nbsp; Besides,&nbsp; the idea in the csla approach is to throw broken rules in combination with the error provider interface so users are not overly inhibited in moving around.  <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Thursday, November 01, 2007</h2>Correction ...<br>I am familiar with the ReadWriteAuthorizer control&nbsp; ... just havn't been able to implement it to its full potential.<br><br>Jimbo<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, November 01, 2007</h2><P>There are various overloads for CanWriteProperty.</P>
<P>Most throw an exception.</P>
<P>I never liked this idea. And apparently now Rocky doesn't either.</P>
<P>I have always suggested using the overload which returns a Boolean and then branching to either return the real value or a dummy value.&nbsp;</P>
<P>Rocky now offers the same suggestion as a best practice.</P>
<P>The dummy value should probably be "" for string fields and 0 for numeric fields.</P>
<P>For example:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If CanReadProperty("Title") Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mTitle<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return ""<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If&nbsp;</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, November 01, 2007</h2><P>That's true for reading. Returning a dummy value is as easy, or easier to debug than throwing an exception, and avoids some runtime issues that appear otherwise unavoidable.</P>
<P>For writing I still favor throwing an exception. Such an exception is a bug, and shouldn't happen at runtime (because you should have prevented the value from being altered by using ReadWriteAuthorizer or something similar).</P>
<P>The alternative with a write would be to simply and silently ignore the attempt to change the value - and that would allow hard-to-debug UI errors to exist. I think the exception is better in that case.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
