<html><header><title>CSLA Custom Membership Question</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA Custom Membership Question</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10359.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cslasoup posted on Tuesday, May 10, 2011</h2><p>Hi,</p>
<p>I&#39;m just learning CSLA and have a decent grasp on how to use it but I am having an issue with the custom membership portion. &nbsp;I am trying to implement a password recovery page and once the user inputs their user name, as per standard functionality, the PasswordRecovery control calls the GetUser(username, userIsOnline) overload in the custom membership provider.</p>
<p>Now, my understanding is that in this function, I am to implement whatever data access I have to retrieve the user&#39;s information, store it into a MembershipUser object, and return that so that it gets passed on to next part of the procedure. &nbsp;My problem is that I can&#39;t cast the user info (stored in a custom identity object which, in turn, is stored into a custom principal object; this is done per the VB 2008 book) to a MembershipUser object.</p>
<p>I&#39;ve looked far and wide for a solution to this and the closest thing I&#39;ve found is to have the custom identity inherit from CslaIdentity BUT I cannot see it when I try to subclass it. &nbsp;Also, per the book&#39;s example, the identity object is currently inheriting from <b>ReadOnlyBase(Of CustomIdentity) Implements IIdentity</b></p>
<p>I do my best to find things out on my own but have hit a brick wall on this issue. &nbsp;Any help will be greatly appreciated.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, May 10, 2011</h2><p>In the <em>Using CSLA 4: Data Portal Configuration</em> ebook I recommend and show how to subclass CslaIdentityBase&lt;T&gt; to create a custom identity object. The CSLA 4 CslaIdentityBase&lt;T&gt; class is a subclass of ROB, implements IIdentity, and also ICheckRoles so it automatically integrates with a CslaPrincipal subclass.</p>
<p>If you have no custom state in your identity type, creating this subclass is pretty trivial, because you just implement factory methods and DataPortal_Fetch (or a factory class with a Fetch method).</p>
<p>The CustomPrincipal class is a subclass of CslaPrincipal, and implements static methods named Login and Load. The Load method loads the identity based on username alone, and exists to support the stateless web server model. The only code in this subclass are these methods (and a static Logout method, because I like the symmetry that provides).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, May 10, 2011</h2><p>Also, the custom principal and identity in the upcoming refresh of ProjectTracker follows the model from the ebook. You can view the code here:</p>
<p><a href="http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Samples/NET/cs/ProjectTracker/">http://www.lhotka.net/cslacvs/viewvc.cgi/core/trunk/Samples/NET/cs/ProjectTracker/</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cslasoup replied on Wednesday, May 11, 2011</h2><p>[EDIT] Hi Rocky. &nbsp;Thanks for the reply. &nbsp;I should have mentioned that we are using the 3.5.3 version of the Csla.dll because a requirement by the customer is that we use VB. &nbsp;Does that change anything you mentioned?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, May 11, 2011</h2><p>Then you need to subclass ReadOnlyBase and implement IIdentity yourself. You also need to implement IsInRole in your principal, because the automatic hookup provided by ICheckRoles didn&#39;t exist at that time (I don&#39;t think anyway).</p>
<p>You might mention to your customer that they can continue to use VB against CSLA .NET with current versions. It is just that CSLA itself isn&#39;t in VB anymore, just like 99% of the .NET framework.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cslasoup replied on Wednesday, May 11, 2011</h2><p>Thanks again for the reply Rocky. &nbsp;Understood as far as using the current versions of CSLA.NET with VB. &nbsp;The principal&#39;s explanation for using this version of CSLA.NET was due to an issue with the CodeSmith templates. &nbsp;I&#39;ll have to follow up with him later today about this and make sure we absolutely can&#39;t use the latest .NET 3.5 version.</p>
<p>I&#39;ll update the post when I have an answer/solution to my problem.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cslasoup replied on Friday, May 13, 2011</h2><p>[UPDATE] I spoke with the principal and he informed me that 3.5.3 was only used because it had samples that could be used for training purposes to help ramp up other developers. &nbsp;It had nothing to do with generating code with CodeSmith.</p>
<p>Regarding the question, I updated the .dll to 3.8.3 and subclassed the custom Identity class with CslaIdentity. &nbsp;My problem still exists but it&#39;s not an issue with CSLA. &nbsp;After researching more I found that we should also probably roll up another custom class that subclasses MembershipUser, retrieve the data from the database, and store those values into the custom MembershipUser properties. &nbsp;I&#39;ve never had to use the ASP.NET membership API so I&#39;m still a little green with it. &nbsp;</p>
<p>My initial problem was getting a MembershipUser object out of the API and I was hoping that I could somehow do that automatically from the custom Identity or Principal classes but it looks like it has to be wired up separately.</p>
<p>Thanks for all your hard work Rocky!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, May 13, 2011</h2><p>If you are populating your custom identity from the Membership and Roles objects, you may consider buying <em>Using CSLA 4: Data Portal Configuration</em>, because I specifically walk through that entire scenario.</p>
<p>The ProjectTracker code in svn (in core/trunk) does this too.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
