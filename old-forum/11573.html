<html><header><title>Unit-tests on ViewModel with Asynchronous Method unable to correctly set Model-property (CSLA 4.3.12.0)</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Unit-tests on ViewModel with Asynchronous Method unable to correctly set Model-property (CSLA 4.3.12.0)</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11573.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kgulden posted on Tuesday, September 11, 2012</h2><p>I want to test methods on the viewmodel but the&nbsp;.Model property always raises the System.InvalidOperationException: &quot;The calling thread cannot access this object because a different thread owns it.&quot; in the asynchronously-QueryCompleted method of ViewModelBase&lt;T&gt;.&nbsp;</p>
<p>From ProjectTacker<br />-----------------</p>
<p>#1&nbsp; public class ProjectGetter : ViewModel&lt;ProjectTracker.Library.ProjectGetter&gt;<br />#2&nbsp; {<br />#3&nbsp;&nbsp;&nbsp; public ProjectGetter()<br />#4&nbsp;&nbsp;&nbsp; {<br />#5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BeginRefresh(callback =&gt; ProjectTracker.Library.ProjectGetter.CreateNewProject(callback));<br />#6&nbsp;&nbsp;&nbsp; }<br />#7&nbsp;&nbsp;&nbsp; ...<br />#8&nbsp;&nbsp;&nbsp; ...<br />#9&nbsp; }</p>
<p>From my UnitTest<br />-----------------</p>
<p>#1&nbsp; ProjectGetter vm = new ProjectGetter();<br />#2&nbsp; Assert.IsNotNull(vm);<br />#3&nbsp; Assert.IsNotNull(vm.Child[0]);<br />#4&nbsp; Assert.AreEqual(vm.Child[0].GetType(), typeof(ProjectGetter.ProjectEdit));</p>
<p><br />When I rewrite the ProjectTracker Line#5 and replace BeginRefresh with DoRefresh which is synchronous, the .Model property is properly populated.</p>
<p>I tried waiting on the PropertyChanged event of the ViewModel, but, alas, it is never raised.&nbsp; There does not seem to be a way to properly wait on some event/callback method when the asynchronous method completes. I am at a loss and any help anyone can provide would be much appreciated.</p>
<p>(I have properly used the UnitDriven test framework to test synch/asynch BO&#39;s with much success, however, these asynch-viewmodels have me stuck.)</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
