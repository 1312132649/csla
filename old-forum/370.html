<html><header><title>ClickOnce and the App.Config file</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ClickOnce and the App.Config file</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/370.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdubious posted on Wednesday, June 14, 2006</h2><P>Anyone have a solution for this:</P>
<P>My client has 4 different DB's and they use the same desktop application to connect to each.&nbsp; They also use ClickOnce deployment.&nbsp; To do this, since the app.config is sigend, they have to publish 4 different installation points.</P>
<P>CONFESSION: I have NOT yet bought the 2.0 Book.</P>
<P>Have we moved beyond the connection string / portal wiring in the app.config?&nbsp; Can a user change the PortalServer or the Connection String at runtime yet?&nbsp; I'm more interested in being able to change the PortalServer at runtime I guess.</P>
<P>Help?</P>
<P>Kevin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 14, 2006</h2>Kevin,<br>
<br>
I'll likely need similar functionality as well.&nbsp; At some point I'll
need a method to 'disconnect' my application, and have it start using a
local database instead of a remote one.&nbsp; <br>
<br>
I solved a similar problem though; I have different settings for
development, unit testing, user testing, and production.&nbsp; I ended up
creating my own ConfigurationManager class with its own AppSettings
property.<br>
<br>
The trick is that I define a section for each configuration
(&lt;production /&gt;, &lt;testing /&gt;, etc) and my configuratin
manager at a special setting to figure out which one to use... so my
config file looks something like this:<br>
<br>
&lt;configuration&gt;<br>
<br>
&nbsp;&nbsp;&nbsp; &lt;configSections&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;section name="localDev" type="System.Configuration.AppSettingsSectionHandler,System.Configuration"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;section name="production" type="System.Configuration.AppSettingsSectionHandler,System.Configuration/&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/configSections&gt;<br>
<br>
&nbsp;&nbsp;&nbsp; &lt;appSettings&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add key="environment" value="localDev" /&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/appSettings&gt;<br>
<br>
&nbsp;&nbsp;&nbsp; &lt;localDev&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add key="key" value="value" /&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/localDev&gt;<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; &lt;devel&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add key="key" value="value23" /&gt;<br>

&nbsp;&nbsp;&nbsp; &lt;/devel&gt;<br>
<br>
&lt;/configuration&gt;<br>
<br>
I actually have my own section handler which I wrote as well, to
support more sane configuration of the DAL.&nbsp; But that's not required.<br>
<br>
Maybe you could do something similar, except have your ConfigurationManager look at the environment and automatically determine which group of settings to use.<br><br>Or maybe I'm way off...<br>
<br>
HTH<br>
Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 14, 2006</h2>Oh, one more thing.&nbsp; If you do go this route, don't forget to remove the reference to System.Configuration in Csla and replace it with the reference to your assembly which contains your configuration manager.&nbsp; You'll also have to update any using / Imports statements... but this is only in a few places.<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdubious replied on Wednesday, June 14, 2006</h2><P>I was hoping to do something like this:</P>
<P>Add a Database class to my BO library with a Shared Property that returns the connection string. In ALL (ugly) of my Criteria ctor's, I'd set a property in my Criteria object to hold the connection string.&nbsp; Then, when the DataPortal (remote in my case) looks for the connection string, it would use the value in the Criteria object.</P>
<P>I need to use ClickOnce, which means I can't edit the app.config after deployment to point to another DataPortal URL. And, I need a way in the UI to specify which Database at the remote host to use.</P>
<P>I don't think ajj3085's solution works in my case.</P>
<P>Kevin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, June 14, 2006</h2>Nothing I've said means you have to change the config file once its signed.<br>
<br>
At any rate, how does your database BO figure out which connection
string to use?&nbsp; That's pretty important to finding a solution.<br>
<br>
You meantion that you haven't bought the 2.0 book, but are you using the 2.0 clsa framework?&nbsp; If so, is there any reason you can't use the ApplicationContext to send this information along with your dataportal call?&nbsp; That way you avoid having to put all that code in your Criteria classes.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdubious replied on Wednesday, June 14, 2006</h2><P>OK, I need to buy the book.&nbsp; I'm using the 2.0 in new apps, fumbling through the new features, really.</P>
<P>Maybe if I pose the question in terms of an example, ajj3085 or someone cold pose a solution:</P>
<P>Let's say you have a project tracker application that you host for multiple companies.&nbsp; You opt to NOT store each company in the same Database, you instead have a new Database for each one.&nbsp; You're using the remote dataportal.</P>
<P>You have a tech support staff, and they need the option of switching between diferent databases on the fly, from within the same installation. (Publishing a new ClickOnce installer, and forcing a new install, just to get&nbsp;the app&nbsp;to point to a new DataPortal, just so the new DataPortal can use a new Connection String is messy)&nbsp; You can't point the app.config to a new DataPortal URL on the fly (right??), but you can put multiple Connection Strings in the DataPortal's web.config file.</P>
<P>The question becomes, how do I best (from the front end) switch between the various Connection Strings in the web.config?&nbsp; </P>
<P>I hope ApplicationContext hlolds the answer, but I'll have to read up on it...</P>
<P>I went to Borders, and alas, No Book.</P>
<P>Kevin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, June 15, 2006</h2>Ok, now I see where you are trying to go.&nbsp; When a client runs your application, it should use a connection string to a certain db.&nbsp; Your tech support should be able to run the SAME application, but pick between the connection strings.<br><br>This is a tricky one, whether or not you use Csla at all.&nbsp; Right off the bat, if your client application sends some data over the wire to tell the server which database it should use, you open up a potential security hole.&nbsp; If your tech team can use the client to switch, so could a malitious end user.&nbsp; If you're not obfucsating your code, it would be trivial for anyone using something like Reflector to figure what data to send to modify someone else's DB.&nbsp; Even if you obfuscate, this is still a danger, as someone really commited to figuring it out would, eventually.&nbsp; <br><br>Sorry if you've already reached these conclusions, but I wanted to point them out just in case...<br><br>That said, certainly if your application on the client can decide which database to use, you can use ApplicationContext to just pass some kind of identifier to the dataportal.&nbsp;&nbsp; You would probably have some kind of login procedure.&nbsp; You could create a CommandBase subclass to actually perform a login.&nbsp; The command would have some fields so that you can send the user / password to the server, and some other fields which would be set when the command returns.&nbsp; One of those fields could be a list of Databases (likely these would be busienss objects) which the user is allowed to connect to.&nbsp; You can store the entire list in ApplicationContext for convience, and store the currently selected one there as well, which code in your DataPortal_XXX procedures would use to determine the connection string to use.<br><br>Here's code I use to create a session (using WindowsPrincipal).&nbsp; You could pass a user name / password instead of a WindowsIdentity (although you'd likely return a principal subclassed from PrincipalBase in Csla).<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region OpenSessionCommand class<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;A command which opens<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// a session (login) on the datastore.&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;remarks&gt;This class is embedded in my Session static class&lt;/remarks&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Serializable]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class OpenSessionCmd : CommandBase {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Fields<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private WindowsIdentity ident;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int dbUserId;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Properties<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;The database id of the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// user.&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;remarks&gt;This value is only valid<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// after the command has executed.&lt;/remarks&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int DbUserId {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return dbUserId; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private set { dbUserId = value; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Constructors<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;Initializes a new &lt;see cref="OpenSessionCmd"/&gt;.&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;param name="ident"&gt;The &lt;see cref="WindowsIdentity"/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// of the user for which to open the session.&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public OpenSessionCmd( WindowsIdentity ident ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.ident = ident;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Data Access<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;Performs the command.&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Transactional( TransactionalTypes.TransactionScope )]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void DataPortal_Execute() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataSearcher&lt;Data.Shared.Employee&gt; searcher;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Data.Shared.Employee&gt; employees;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SelectionCriteria crit;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectoryUser dUser;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int employeeId;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data.Shared.Employee e;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create this object to manage the connection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e = new Data.Shared.Employee();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Provider.BeginBatch();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit = new SelectionCriteria( "LoginName", Operator.Equals );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; crit.Values.Add( ident.Name );<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher = new DataSearcher&lt;Data.Shared.Employee&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; searcher.AddSelectionCriteria( crit );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; employees = searcher.Find();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( employees.Count == 1 ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; employeeId = employees[ 0 ].PersonId.Value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dUser = DirectoryUser.NewUser( ident );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dUser.CreateDBEntry();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; employeeId = dUser.PersonId;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DbUserId = employeeId;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finally {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Provider.EndBatch();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br><br>The SelectionCriteria, DirectorUser and Data.Shared.* classes are helper classes or part of my DAL.&nbsp; You could do whatever work you need to in the DataPortal_Execute method, which would be where you can load the list of DBs which the user may access.<br><br>My login procedure uses the command like this:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; openSessionCmd = DataPortal.Execute&lt;OpenSessionCmd&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new OpenSessionCmd( WindowsIdentity.GetCurrent() )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br><br>Once this executes successfully, I read out DbUserId and stuff it in the application context.<br><br>This won't do what you want it to, but you can use the same pattern here to acomplish what you need.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kdubious replied on Thursday, June 15, 2006</h2>Thanks a bunch!&nbsp; I bought the book, and will look at it and your example and see what I can do.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>odie replied on Thursday, June 15, 2006</h2><P>We have a similare situation where we have 3 Regions each with their own seperate database due to distance between locations. Additionally we have a development copy of the database for our own testing.</P>
<P>It may not be eligant but it works.</P>
<P>I have the following in my app.config file because until I get the connection string I can't get to a server.<BR><FONT color=#0000ff size=2>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>ConfigRegionCount</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>3</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;<BR>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>ConfigRegion1</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Calgary</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;<BR>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>ConfigRegion2</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Edmonton</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;<BR>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>ConfigRegion3</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Regina</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> /&gt;</FONT></P>
<P><FONT color=#0000ff><FONT color=#000000 size=2>On my login form the user selects the region they wish to log into. Additionally I have a check box option for development database, but I wont go into that here.</FONT></FONT></P>
<P><FONT color=#0000ff><FONT color=#000000 size=2>Then&nbsp;based on which region they select I know which encrypted connection string to get from the database which looks like this.</FONT></FONT></P><FONT color=#0000ff><FONT color=#0000ff>
<P><FONT size=2>&lt;</FONT></FONT><FONT size=2><FONT color=#800000>add</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>key</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>DB:Calgary</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>value</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>bbNSKIAS8yO7...=</FONT><FONT color=#000000>"</FONT></FONT><FONT size=2><FONT color=#0000ff> /&gt;<BR>&lt;</FONT><FONT color=#800000>add</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>key</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>DB:Edmonton</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>value</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>j2X70krzexwuHFjNX...=</FONT><FONT color=#000000>"</FONT></FONT><FONT size=2><FONT color=#0000ff> /&gt;<BR>&lt;</FONT><FONT color=#800000>add</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>key</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>DB:Regina</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>value</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>HFjNXLK5MeJ0GN3K..</FONT><FONT color=#000000>"</FONT></FONT><FONT size=2><FONT color=#0000ff> /&gt;<BR>&lt;</FONT><FONT color=#800000>add</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>key</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>DB:Development</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff> </FONT><FONT color=#ff0000>value</FONT><FONT color=#0000ff>=</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff>Qs7FXSVjM2k/uETt3cn5qnC6g...</FONT><FONT color=#000000>"</FONT><FONT color=#0000ff> /&gt;</FONT></FONT></P><FONT color=#0000ff>
<P><FONT color=#000000 size=2>This allows for any number of connection strings, if you have to add another you only have to add tow lines to your app.config file. Based on the region selected it knows what connection string to use. If the user wants to switch database they simply logoff which brings up the logon screen again and they select a different database. I store the users last logged on region to start with as the user is likely logging into the same database all the time. I don't have to worry about users logging into the wrong database as this is cared for by the security model we have implemented.</FONT></P>
<P><FONT color=#000000 size=2>Additionally the connections string is encrypted multiple times embedding both the data database connection string as well as the security database connection string together. But that another story.</FONT></P></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
