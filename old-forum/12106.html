<html><header><title>How to add an item to a business list</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to add an item to a business list</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12106.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>pearljam posted on Friday, August 09, 2013</h2><p>When I add an item to my list using Add(), I get an exception in BusinessListBase that the item is not a child. How do I make the item I create a child of the list? If I use AddNew everything works, the problem is that I need to pass some things to my business object when I create it so AddNew doesn&#39;t work for me.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, August 09, 2013</h2><p>If I remember correctly the AddNew method returns the new item as type object - so you can cast it to the actual type and set values.</p>
<p>Another option is to call MarkAsChild() method in the new items Contructor or DataPortal_Create or Child_Create - &nbsp;depending on how the new object is created.</p>
<p>IE: To make an item child you must call the MarkAsChild() method on the object.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>pecen replied on Sunday, August 18, 2013</h2><p>Hi,</p>
<p>As I understand it, referring to the DataPortal book from the book series&nbsp;&quot;Using CSLA 4&quot; by Rocky,&nbsp;there are 3 common techniques used&nbsp;to add a child object to a list:</p>
<p>1. Calling code creates the new child object, and adds it to the list by calling the collection&#39;s Add method.</p>
<p>2. Collection implements an AddItem() method that is responsible for creating the new child object and adding it to the list.</p>
<p>3. Calling code invokes the collection&#39;s AddNew() method, and that method creates the new child object and add it to the list (also used by data binding scenarios).</p>
<p>The advantage of technique number 1 and 2 is that you can pass parameter values to the new child object, and it can use those values as part of its initialization. But then you need to write code to support those scenarios.</p>
<p>The BusinessListBase and BusinessBindingListBase classes support technique number 3 by default. </p>
<p>By default, if the AddNew() method is called on an editable list, a new child object will be created and initialized through its Child_Create method, and then it is added to the collection</p>
<p>
<p><span style="font-size:x-small;">If you don&#39;t need to pass parameter values, but rather just need to initialize the child object, I would personally use the 3rd alternative, override the AddNewCore(), and add a Creator class. </span></p>
</p>
<p><span style="font-size:x-small;">An example of the 3rd alternative (also from the Data Access book) is the following where you do the override in the class that inherits from BusinessListBase:</span></p>
<p><span style="color:#0000ff;">protected override </span><span style="color:#33cccc;">SkillEdit </span>AddNewCore() <br />{ <br />&nbsp; <span style="color:#0000ff;">var </span>creator = <span style="color:#33cccc;">SkillEditCreator</span>.GetSkillEditCreator(); <br />&nbsp; <span style="color:#0000ff;">var</span> item = creator.Result; <br />&nbsp; Add(item); </p>
<p>&nbsp; <span style="color:#0000ff;">return</span> item; <br />}</p>
<p>Then you add a &quot;Creator&quot; class (likeSkillEditCreator below), and do all your initialization through that class, and the class then returns the initialized child object.</p>
<p>&nbsp; [<span style="color:#33cccc;">Serializable</span>]<br />&nbsp; <span style="color:#0000ff;">public class</span> SkillEditCreator : <span style="color:#33cccc;">ReadOnlyBase</span>&lt;<span style="color:#33cccc;">SkillEditCreator</span>&gt;<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">public static readonly</span> <span style="color:#33cccc;">PropertyInfo</span>&lt;<span style="color:#33cccc;">SkillEdit</span>&gt; ResultProperty =<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RegisterProperty&lt;<span style="color:#33cccc;">SkillEdit</span>&gt;(c =&gt; c.Result);<br />&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">public</span> <span style="color:#33cccc;">SkillEdit</span> Result<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">get</span> { <span style="color:#0000ff;">return</span> GetProperty(ResultProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">private</span> <span style="color:#0000ff;">set</span> { LoadProperty(ResultProperty, <span style="color:#0000ff;">value</span>); }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">public static</span> <span style="color:#33cccc;">SkillEditCreator</span> GetSkillEditCreator()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">return</span> <span style="color:#33cccc;">DataPortal</span>.Fetch&lt;<span style="color:#33cccc;">SkillEditCreator</span>&gt;();<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">private void </span>DataPortal_Fetch()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Result = <span style="color:#33cccc;">DataPortal</span>.CreateChild&lt;<span style="color:#33cccc;">SkillEdit</span>&gt;();<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
