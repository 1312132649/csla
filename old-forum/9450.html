<html><header><title>AddErrorResult not updating PropertyStatus Control</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>AddErrorResult not updating PropertyStatus Control</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9450.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Andreas posted on Monday, August 30, 2010</h2><p>Hi,</p>
<p>When I&#39;am calling&nbsp;BusinessRules.CheckRules() on&nbsp;my Business Object&nbsp;that&nbsp;causes a call&nbsp;on context.AddErroResult() in one of it&#39;s&nbsp;BusinessRules the PropertyStatus Control (attached to the invalid property) does not indicate this error (UpdateStatus() of PropertyStatus is not called). I was able to reproduce this behavior in the PropertStatus sample of csla401. Do I miss something?&nbsp;</p>
<p>&nbsp; public class Blah : BusinessBase<br />&nbsp; {<br />&nbsp;&nbsp;&nbsp; public static readonly PropertyInfo&lt;string&gt; DataProperty = RegisterProperty(typeof(Blah), new PropertyInfo&lt;string&gt;(&quot;Data&quot;));<br />&nbsp;&nbsp;&nbsp; public string Data<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(DataProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(DataProperty, value); }<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; protected override void AddBusinessRules()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new TestRule(DataProperty));<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; public bool Error;</p>
<p>&nbsp;&nbsp;&nbsp; public void CheckRules()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Error = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.BusinessRules.CheckRules();<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; public class TestRule : Csla.Rules.BusinessRule<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public TestRule(Csla.Core.IPropertyInfo primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;IPropertyInfo&gt; { PrimaryProperty };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute(Csla.Rules.RuleContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if((context.Target as Blah).Error == true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddErrorResult(primaryProperty, &quot;Error&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }</p>
<p>&nbsp;&nbsp; private void Button_Click(object sender, RoutedEventArgs e)<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp; _ex.CheckRules();<br />&nbsp;&nbsp; }</p>
<p><br />&nbsp;</p>
<p>Regards,<br />Andreas</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, August 30, 2010</h2><p>A couple things.</p>
<p>First, I strongly recommend using the RegisterProperty() overloads that use lambda expressions - the overload you are using often causes maintenance issues due to copy-paste errors over time.</p>
<p>Second, CheckRules() just checks the rules, it doesn&#39;t cause any PropertyChanged events to be raised. PropertyStatus (and data binding in general) refreshes the display based on PropertyChanged events. In your method, try calling OnUnknownPropertyChanged() after the CheckRules() call to force that event to be raised for all your properties - that will cause the UI to refresh.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
