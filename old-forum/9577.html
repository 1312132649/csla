<html><header><title>NullReference exception in CSLA 3.8.4 Silverlight when using PropertyStatus control and BXF</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>NullReference exception in CSLA 3.8.4 Silverlight when using PropertyStatus control and BXF</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9577.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Monday, September 27, 2010</h2><p>After adding a property status control to my View (which is bound to a ViewModel via a CollectionViewSource as per MVVM video series), I get a null reference exception (deep in the depths of CSLA) when I show the view from the presenter. If I remove the property status this does not happen.</p>
<p>Here&#39;s the property status declaration in the View:</p>
<pre style="font-family:consolas;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">csla</span><span style="color:blue;">:</span><span style="color:#a31515;">PropertyStatus</span><span style="color:red;">&nbsp;Grid.Row</span><span style="color:blue;">=</span><span style="color:blue;">&quot;0&quot;</span><span style="color:red;">&nbsp;Grid.Column</span><span style="color:blue;">=</span><span style="color:blue;">&quot;2&quot;</span><span style="color:red;">&nbsp;Property</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;">&nbsp;Model</span><span style="color:blue;">.Description</span><span style="color:blue;">}</span><span style="color:blue;">&quot;</span><span style="color:blue;">&nbsp;/&gt;</span><br /></pre>
<p>Here&#39;s the ShowView code from the presenter:</p>
<pre style="font-family:consolas;"><span style="color:#2b91af;">Shell</span>.Instance.ShowView(&nbsp;<span style="color:blue;">typeof</span>(&nbsp;Views.Site.<span style="color:#2b91af;">LocationGroup</span>&nbsp;).AssemblyQualifiedName,&nbsp;<span style="color:#a31515;">&quot;ViewModel&quot;</span>,&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">LocationGroupViewModel</span>(),&nbsp;<span style="color:#2b91af;">Regions</span>.MainContent&nbsp;);</pre>
<p>Here&#39;s the full exception stack:</p>
<p style="padding-left:30px;"><em>System.NullReferenceException was unhandled by user code<br />&nbsp; Message=Object reference not set to an instance of an object.<br />&nbsp; StackTrace:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Reflection.MethodCaller.GetPropertyValue(Object obj, PropertyInfo info)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Silverlight.PropertyStatus.GetRealSource(Object source, String bindingPath)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Silverlight.PropertyStatus.SetSource()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Silverlight.PropertyStatus.&lt;.cctor&gt;b__b(DependencyObject o, DependencyPropertyChangedEventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.RaisePropertyChangeNotifications(DependencyProperty dp, Object oldValue, Object newValue)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.UpdateEffectiveValue(DependencyProperty property, EffectiveValueEntry oldEntry, EffectiveValueEntry&amp; newEntry, ValueOperation operation)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.RefreshEx pres sion(DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Data.BindingExpression.SendDataToTarget()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Data.BindingExpression.SourcePropertyChanged(PropertyPathListener sender, PropertyPathChangedEventArgs args)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.PropertyPathListener.RaisePropertyPathStepChanged(PropertyPathStep source)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.PropertyAccessPathStep.RaisePropertyPathStepChanged(PropertyListener source)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyPropertyListener.SourcePropertyChanged(DependencyObject sender, DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Data.WeakDependencyPropertyChangedListener.SourcePropertyChanged(DependencyObject sender, DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DPChangedEventHandler.Invoke(DependencyObject sender, DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.OnPropertyChanged(DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.FrameworkElement.OnPropertyChanged(DependencyProperty dp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.RaisePropertyChangeNotifications(DependencyProperty dp, Object oldValue, Object newValue)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.UpdateEffectiveValue(DependencyProperty property, EffectiveValueEntry oldEntry, EffectiveValueEntry&amp; newEntry, ValueOperation operation)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.SetValueInternal(DependencyProperty dp, Object value, Boolean allowReadOnlySet)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.DependencyObject.SetValue(DependencyProperty dp, Object value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.Silverlight.ViewModelBase`1.set_Model(T value)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at XXXXXX.XXXX.XXX.Silverlight.UI.ViewModels.Site.LocationGroupViewModel.&lt;.ctor&gt;b__1(Object o2, DataPortalResult`1 e2)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortal`1.OnCreateCompleted(DataPortalResult`1 e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortal`1.proxy_CreateCompleted(Object sender, DataPortalResult`1 e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.OnCreateCompleted(DataPortalResult`1 e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Csla.DataPortalClient.WcfProxy`1.proxy_CreateCompleted(Object sender, CreateCompletedEventArgs e)<br />&nbsp; InnerException: </em></p>
<p>I&#39;ve done a bit of tracing and it appears to trigger as soon as the model is changed out by the BXF&#39;s InitializeBindingResource(IView view) method when it sets the:</p>
<p>I&#39;ve done a bit of tracing and it appears to trigger as soon as the model is changed out by the BXF&#39;s InitializeBindingResource(IView view) method when it sets the:</p>
<p>...<br />var viewsource = resource as System.Windows.Data.CollectionViewSource;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( viewsource != null )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // make sure model is a list (or wrapped in one)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var list = view.Model as System.Collections.IEnumerable;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( list == null )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = new List&lt;object&gt;() { view.Model };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewsource.Source = list;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />...</p>
<p><br />Not sure what the root cause is though, but it dissapears when I don&#39;t have the PropertyStatus control connected.</p>
<p>Regards,<br />Johann</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Monday, September 27, 2010</h2><p>I&#39;m not sure, but i think your binding is off.&nbsp; The propert status should inherit its datacontext from its container, and then your binding should just be {Binding Path=Description}.&nbsp; I&#39;m not sure that dot notation will work.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Monday, September 27, 2010</h2><p>Woa.. PEBCAC! (<em><strong>P</strong>roblem <strong>E</strong>xists <strong>B</strong>etween <strong>C</strong>hair and <strong>C</strong>omputer</em>) <img src="http://forums.lhotka.net/emoticons/emotion-10.gif" alt="Embarrassed" /></p>
<p>You hit the nail on the head. Since I switched to the MVVM pattern, the View now binds to a ViewModel and in the case of CSLA ViewModel, the ViewModel has a &quot;Model&quot; property that is a reference to the CSLA Business Object.</p>
<p>Often it&#39;s useful to add additional properties to the ViewModel that is practical to the View, but inappropriate for the business object &quot;Model&quot; (because it relates to the UI only), so generally the DataContext is set to the ViewModel and then binding is done to either the &quot;custom property on the ViewModel&quot;, or &quot;via the Model property to the business object&quot; (E.g. Model.Description).</p>
<p>The &quot;Property&quot; property of the PropertyStatus control as you pointed out should be pointing directly at the Property, which is relative to the DataContext of the PropertyStatus. This doesn&#39;t support the Model notation, and now it&#39;s more clear to me in that the &quot;DataContext&quot; is supposed to set to the Business Object and the &quot;Property&quot; to be set to the individual property on said Business Object.</p>
<p>Thanks Andy. <img src="http://forums.lhotka.net/emoticons/emotion-2.gif" alt="Big Smile" /></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
