<html><header><title>Save Returns New Object - version 2.1 change?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Save Returns New Object - version 2.1 change?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/535.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>msk posted on Tuesday, July 04, 2006</h2><P>In the current version of the framework BusinessBase.Save returns a new object.&nbsp; All controls must rebind because they are bound to the old object (prior to the save - and changes may have occurred during the save).&nbsp; Recently I was looking at the code behing the N-level undo functionality (state stacking)&nbsp;- it basically sucks the data out of an object and puts it back in later.&nbsp; I can't see why this wouldn't work within BusinessBase.Save.&nbsp; The Save method could use&nbsp;the 'undo&nbsp;code' to overwrite the objects state with the state of the new object returned from DataPortal.Update.&nbsp; </P>
<P>Currently UI code works like this: </P>
<P><FONT color=#008000>'Unbind...</FONT></P>
<P>obj = obj.Save()</P>
<P><FONT color=#008000>'Rebind...</FONT></P>
<P>The client code would be simplifed to: </P>
<P>obj.Save()</P>
<P>(OK that only differs by return type - but you get the idea)</P>
<P>They may be something I have missed, but I see no reason why this shouldn't be in the framework.&nbsp; The only downside is performance, but just like n-level undo, the choice to use it could be given to the business or UI developer.&nbsp; </P>
<P>Does saving the Clone to effect an atomic Save operation fall into the same category as this?</P>
<P>Martin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>karl replied on Wednesday, July 05, 2006</h2>What???? I've never heard anything so ridiculous. I'am sure that if what you say&nbsp;was possible, Rocky would have implemented it in version 2.0 of the framework!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Wednesday, July 05, 2006</h2>I'm not sure about the CSLA 2.0, but it has always worked this way in the 1.x versions. (at least in dataportal mode)</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msk replied on Thursday, July 06, 2006</h2><P>Jon, Not sure I made myself clear.&nbsp; I am saying that Save returning a new object is bad.&nbsp; You wouldn't expect to save a word document and then find out that the one you have doesn't work right and you have to open another, so why so&nbsp;with business objects?</P>
<P>Karl, You're an idiot but thanks for the reply, I thought no one was going to post there for a while.&nbsp; I can only assume that everyone agrees and Rocky is busy adding the functionality to the framework.&nbsp; Perhaps the reflections optimizations mentioned on another thread will lessen the performance overhead of such a change.&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>karl replied on Thursday, July 06, 2006</h2><P>Martin, I don't think your criticism&nbsp;of Rocky is justified. I am sure that Rocky has thought long and hard about the design of the framework. If Rocky has decided that </P>
<P><SPAN>&nbsp;</SPAN><SPAN>obj = obj.Save() <o:p></o:p></SPAN></P>
<P><SPAN>is the way that the framework should work, then I am with him. Are you suggesting that you are in some way superior to Rocky, I bet you are one of those people who spend all of their time criticising other people and not getting on with the real project work that desperately needs completing. <o:p></o:p></SPAN></P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msk replied on Thursday, July 06, 2006</h2><P>Karl, You have certainly livened up this thread with you're intelligent comments, Thankyou.&nbsp; It's OK though, I like Rocky too, you don't need to get upset.&nbsp; And yes I would much rather have a job '<SPAN>criticising</SPAN>' a framework than doing real work :)&nbsp; I was hoping to get some discussion of whether my thoughts on the change were a good idea.&nbsp; Having to re-bind to the new object is something that has occaisonally caught me out&nbsp; - on the rare occaision I do real work.&nbsp; If my change is workable it would mean less code in the UI to go wrong.&nbsp; I'm probably too lazy to do the work myself, plus somebody else would likely make a better job of it.&nbsp; That's why I suggested it here.&nbsp; If CslaContrib gets going I'll consider&nbsp;adding&nbsp;'SuperiorBusinessBase' to the project ;)</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Allann replied on Thursday, July 06, 2006</h2><P>Hi all,</P>
<P>The Save returning a new object is not the only reason for stopping binding.</P>
<P>Extract from Rocky's book, "<FONT face=Utopia-Regular size=1><FONT color=#0000ff size=3>if the data portal is configured to run locally in the client process. In that</FONT></P>
<P align=left><FONT color=#0000ff size=3>case, the object is </FONT></FONT><I><FONT face=Utopia-Italic><FONT color=#0000ff>not </FONT></I></FONT><FONT face=Utopia-Regular><FONT color=#0000ff>serialized to a server, but is rather updated in place on the client. It is possible</FONT></P>
<P align=left><FONT color=#0000ff>that the business object could raise </FONT></FONT><FONT color=#0000ff><FONT face=TheSansMonoCondensed-SemiLight>PropertyChanged </FONT><FONT face=Utopia-Regular>or </FONT><FONT face=TheSansMonoCondensed-SemiLight>ListChanged </FONT></FONT><FONT face=Utopia-Regular size=1><FONT color=#0000ff size=3>events while it is being updated,</FONT></P>
<P align=left><FONT color=#0000ff size=3>causing the UI to refresh during the data update process. Not only does that incur performance</FONT></P>
<P align=left><FONT size=3><FONT color=#0000ff>costs, but sometimes code in the UI might respond to those events in ways that cause bugs.</FONT>".</FONT></P>
<P align=left><FONT size=3>I suggest purchasing his book (you can get a beta pdf version from Apress) and see all the reasons for the design.&nbsp; I agree with the approach taken even though it may not be obvious initially.&nbsp; Think about what happens to an object that is sent via MSMQ (which is possible), it could take days for a response to come back.</FONT></P>
<P align=left><FONT size=3>Regards</FONT></P>
<P align=left><FONT size=3>Allan</FONT></P>
<P align=left><FONT size=3>P.S.&nbsp; Kark, questioning the way things are done is the best way to advance (see extreme programming articles) design and further improve ANY application.&nbsp; If Rocky had given us the PERFECT solution he wouldn't be working on v2.1.</FONT></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msk replied on Thursday, July 06, 2006</h2><P>Hi Allan, </P>
<P>OK I should have been more verbose in the example.&nbsp; I said "rebind" not "stop binding".&nbsp; I accept it is desireable to stop databinding events, but the key point I was trying to make is that Csla is design to allow (amongst other things) the production of object oriented location transparent applications.&nbsp; I believe the Save method is lacking in the object oriented area.&nbsp; Save returning a new object (in some circumstances) was introduced when Csla moved to .NET.&nbsp; Rocky describes the reason why on page 79: </P><FONT face=Utopia-Regular size=1>
<P align=left>Due to the way .NET passes objects by value, it may introduce a bit of a wrinkle into the overall</P>
<P align=left>process. When passing the object to be saved over to the server, .NET makes a copy of the object</P>
<P align=left>from the client onto the server, which is exactly what is desired. However, after the update is complete,</P>
<P align=left>the object must be returned to the client. When an object is returned from the server to the</P>
<P align=left>client, a new copy of the object is made on the client, which isn’t really the desired behavior.</P></FONT>
<P>The workaround is describe a little after that: </P><FONT face=Utopia-Regular size=1>
<P align=left>The UI has a reference to the business object and calls its </FONT><FONT face=TheSansMonoCondensed-SemiLight size=1>Save() </FONT><FONT face=Utopia-Regular size=1>method. This causes the business</P>
<P align=left>object to ask the data portal to save the object. The result is that a copy of the business object</P>
<P align=left>is made on the server, where it can save itself to the database. So far, this is pretty straightforward.</P></FONT><FONT face=ZapfDingbats color=#c1c1c1 size=3>
<P align=left></FONT>
<P align=left><FONT face=HelveticaNeue-Condensed size=1></P></FONT><FONT face=Utopia-Regular size=1>However, once this part is done, the updated business object is returned to the client, and the</P>
<P align=left>UI must update its references to use the </FONT><I><FONT face=Utopia-Italic size=1>newly updated </I></FONT><FONT face=Utopia-Regular size=1>object instead, as shown in Figure 2-19.</P>
<P align=left>This is fine, too—but it’s important to keep in mind that you can’t continue to use the old business</P>
<P align=left>object; you must update all object references to use the newly updated object.</P>
<P align=left><FONT size=3>I have no doubt that Rocky has considered a fix similar to the one I suggest, but chosen not to include it in the framework.&nbsp; Possible reasons are: </FONT></P>
<P align=left><FONT size=3>1) Performance overhead</FONT></P>
<P align=left><FONT size=3>2) Code complexity - books can only be so big</FONT></P>
<P align=left><FONT size=3>3) My suggestion is flawed</FONT></P>
<P align=left><FONT size=3>or </FONT><FONT size=3>4) The UI code workaround is a reasonable compromise</FONT></P>
<P align=left><FONT size=3>The book suggests the following sequence of events when a UI saves a business object: </FONT></P>
<P align=left></FONT><B><FONT face=HelveticaNeue-BoldCond size=1>1. </B></FONT><FONT face=Utopia-Regular size=1>Turn off events from the </FONT><FONT face=TheSansMonoCondensed-SemiLight size=1>BindingSource </FONT><FONT face=Utopia-Regular size=1>controls.</P></FONT><B><FONT face=HelveticaNeue-BoldCond size=1>
<P align=left>2. </B></FONT><FONT face=Utopia-Regular size=1>Clone the business object.</P></FONT><B><FONT face=HelveticaNeue-BoldCond size=1>
<P align=left>3. </B></FONT><FONT face=Utopia-Regular size=1>Save the </FONT><I><FONT face=Utopia-Italic size=1>clone </I></FONT><FONT face=Utopia-Regular size=1>of the business object.</P></FONT><B><FONT face=HelveticaNeue-BoldCond size=1>
<P align=left>4. </B></FONT><FONT face=Utopia-Regular size=1>Rebind the </FONT><FONT face=TheSansMonoCondensed-SemiLight size=1>BindingSource </FONT><FONT face=Utopia-Regular size=1>controls to the </FONT><I><FONT face=Utopia-Italic size=1>new </I></FONT><FONT face=Utopia-Regular size=1>object returned from </FONT><FONT face=TheSansMonoCondensed-SemiLight size=1>Save()</FONT><FONT face=Utopia-Regular size=1>, if necessary.</P></FONT><B><FONT face=HelveticaNeue-BoldCond size=1>
<P align=left>5. </B></FONT><FONT face=Utopia-Regular size=1>Turn on events from the </FONT><FONT face=TheSansMonoCondensed-SemiLight size=1>BindingSource </FONT><FONT face=Utopia-Regular size=1>controls.</FONT></P>
<P align=left><FONT face=Utopia-Regular size=1><FONT size=3>I am suggesting that steps 2, 3 and 4 are workarounds&nbsp;because of .NET serialization and the fact the call to DataPortal.Update is not an atomic operation (it&nbsp;may fail part way through and leave the object in a different state to before it was run).&nbsp; In my original post, I was trying to suggest that these UI workarounds could be avoided by modifying the BusinessBase.Save function.&nbsp; Steps 2, 3 and 4 would then consist of a single step: obj.Save().&nbsp; </FONT></FONT></P>
<P align=left><FONT face=Utopia-Regular size=1><FONT size=3>Currently if you're UI code fails to implement the steps as described in the book, it may not work correctly if reconfigured to run data access remotely and may not be able to retry after a failed call to the Save method.&nbsp; </FONT></FONT></P>
<P align=left>Allan, I not sure your statement about MSMQ is relevant.&nbsp; Agreed, you could implement an MSMQ transport for CSLA (and I am sure people have - the original CSLA book had an MSMQ implementation).&nbsp; If you wanted to convey server changes to the business object back to the client in such an implementation, then the Save method&nbsp;or rather the undlying call to&nbsp;DataPortal.Update&nbsp; would have to block until an MSMQ message conveys the object in it's new state back from the dataportal host.&nbsp; After all CSLA is about mobile objects not send one object one way and another will come back.&nbsp; <FONT face=Utopia-Regular size=1></P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Friday, July 07, 2006</h2>msk, your thoughts are not ridiculous.&nbsp; That kind of model&nbsp;has in fact been given serious consideration by veteran CSLA users and Rocky himself.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 07, 2006</h2><P>Yes, absolutely! Returning a new object graph is not ideal.</P>
<P>However, the solution is non-trivial. You are right that n-level undo contains the core of what is needed, but in the general case it is entirely insufficient. Remember that CSLA .NET is designed to enable the concept of mobile objects - and a key part of that is allowing arbitrarily complex object graphs to move across the network. </P>
<P>The code in UndoableBase is limited in that it only deals with CSLA-derived objects - all other objects are blindly serialized/deserialized using the BinaryFormatter. Which means that a CancelEdit can, and does, result in new instances of any non-CSLA-derived objects in your object graph. Not that this happens all that often, but it is a very real effect.</P>
<P>To make this <EM>really</EM> work, I'd need to write a complete replacement for the BinaryFormatter that did in-place deserialization. Which, btw, is not possible for arbitrary types, but would be possible for CSLA-derived types - much like n-level undo.</P>
<P>And I went down this road at one point - primarily in an effort to support the Compact Framework, since the CF doesn't have a BinaryFormatter equivalent. The result is a somewhat-working-but-mostly-useless XmlFormatter (<A href="http://www.lhotka.net/Articles.aspx?id=5446d9e2-4b08-4bd6-9c29-59b166912259">http://www.lhotka.net/Articles.aspx?id=5446d9e2-4b08-4bd6-9c29-59b166912259</A>).</P>
<P>It turns out that writing a <EM>serializer</EM> is pretty easy. Writing a <EM>deserializer</EM> is really, really, really, ..., really hard. This is because you get into some really nasty circular reference loops that must be resolved by scanning through objects and doing a "fix-up" process. I was not able to fully resolve some of those issues in my serializer, which is why it doesn't actually work. Very recently I was in Oslo at a conference and found the solution - which is that there's a method in the .NET framework that allows you to create instance of objects <EM>without running their constructors</EM>.</P>
<P>Using that technique, you can create object "instances" and then come back later and run a selected constructor - which is ultimately what the BinaryFormatter is doing to solve this issue.</P>
<P>Of course now WCF is coming, along with its own new serializer - the NetDataContractSerializer - that works like the BinaryFormatter overall. Which means that WCF doesn't fix the problem, but does complicate things, because it has new rules and attributes to control serialization.</P>
<P>And that makes me <EM>very</EM> glad I didn't go down the road of writing (and thus maintaining/supporting) my own serializer. It will be hard enough to alter CSLA .NET to fully enable the use of NetDataContractSerializer...</P>
<P>So, to make a long story short, the idea of doing in-place Save() is great. Actually solving the problem, while supporting arbitrary object graphs, is incredibly difficult. The only <EM>realistic</EM> solution would be to only support CSLA-derived objects in the entire object graph, and that is a restriction I've been unwilling to impose.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Friday, July 07, 2006</h2><P>I don't know that the solution is limited to serialization.&nbsp; But, I also admit that our "fix" for this issue is just as undesirable.&nbsp; I agree that it would be ideal if a "perfect" solution came along, but we are all bound by what is available and makes sense for us to implement.</P>
<P>Our work-around for what we termed the "object reset" problem (resetting all of the references after an insert or update) is far from perfect but is serving our purposes.&nbsp; Up to you if it helps you.</P>
<P>Our biggest concern with the issue stemmed from widely-used objects.&nbsp; If we were updating an object that was referenced by only one other object, a parent or binding control, etc.,&nbsp;that would not have been that big of a deal.&nbsp; But when you start dealing with complex object models with many inter-related objects, keeping track of who has what reference to which object so that we can re-reference them to the new object had us all sitting back in our chairs with our hands in our hair&nbsp; (isn't that the job of the runtime)?!?!?&nbsp; Anyway, I will spare you all the torture of trying to provide an example as I think it would only distract from the topic by being torn apart one way or another rather than focusing on the point of the posting.</P>
<P>The first step in working around this was to recognize WHY we needed the updated copy of the object anyway.&nbsp; Why is the Insert or Update operation returning anything?&nbsp; The nature of these operations is to persist changes made in our application to our data store, does it really require a two-way conversation?&nbsp; In many cases this is because the object's data has been manipulated somehow during the operation and we need to "restore" our in-memory copy so that it matches the data in our data store.&nbsp; Weeellll, if you can eliminate this aspect, then you eliminate the need to return an object.&nbsp; Using a GUID for your table's primary key, generated by your object when instantiated means that you aren't relying on SQL's @@IDENTITY value, for instance.&nbsp; And, not using timestamp columns eliminates the need to retrieve db created datetime values.&nbsp; </P>
<P>Again, these measures may or may not work for you and may not work in all cases.&nbsp; But it is a start.</P>
<P>To address the fact that we can't guarantee that we aren't going to have some value in returning data that needs to be "restored" in our object, we took a cue from how MS implemented some similar features in the web controls area.&nbsp; Specifically, the MergeWith(...) concept (see the Style object for an example).&nbsp; This method is expected to accept an object of the same type and merge its properties with the current object's.&nbsp; Applying this concept to our data access code, we have implemented a simple, protected, virtual MergeWith method in our objects that accepts the object returned from the data portal and passes it through the inheritance chain (through overrides) allowing any properties that have possibly been affected by the Insert or Update to update themselves from the returned object.&nbsp; the end result is that the original object is now current, reflects the data in the&nbsp;data store&nbsp;and all references to it still valid.&nbsp; In addition, by using the property's accessors to reset the value, the same events are raised for changes as if the value was changed during other operations, allowing the bound controls to update as desired.&nbsp; The down side is that we've added processing time "copying" property values from the returned object to the current object, especially if there&nbsp;are many to update.</P>
<P>Again, just a glimpse at how we've addressed the same concerns which I believe was the intent of the original post.&nbsp; Not saying anyone else is right or wrong, just conveying how we handled this.&nbsp; Hope it helps in some way.</P>
<P>&nbsp;</P>
<P>btw - I did read the book.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, July 07, 2006</h2>




<DIV align=left><SPAN class=984273619-07072006><FONT face=Arial color=#0000ff size=2>Nice info Pirate - thanks!</FONT></SPAN></DIV>
<DIV align=left><SPAN class=984273619-07072006><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=984273619-07072006><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ScottBessler replied on Tuesday, July 11, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div><p>there's a method in the .NET framework that allows you to create instance of objects <em>without running their constructors</em>.</p></div></BLOCKQUOTE><br><br>Can you elaborate on this?&nbsp;&nbsp;&nbsp; It sounds useful for some XML de/serialize stuff I was writing.<br><br>Thanks,<br>Scott<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vargasbo replied on Tuesday, July 11, 2006</h2>

<p class="MsoNormal">I was thinking about what everyone wrote and it seems like
the simple thing to do is, return the criteria you used to identify your
object. In most cases, you have three scenarios<br>
<br>
1) you uses a GUID<br>
2) Identity ID<br>
3) Composite Key</p>



<p class="MsoNormal">1) When you save the first case, all you really need to know
is that the object saved, so their not point to get data back from the
database, since it’s just a reflection of what you already have.</p>





<p class="MsoNormal">2) If you’re using an identity id, then just return the
value…<br>Something like obj.ID = <span>ExecuteNonQuery</span> (save
values)</p>



<p class="MsoNormal"><o:p>&nbsp;</o:p>3) Assuming you’re using your parent object, and then it’s
computing your next id for this child object and setting your parent object id.</p>





<p class="MsoNormal"><o:p>&nbsp;</o:p>Obj.2ID = <span>ExecuteNonQuery</span> (save values);</p><p class="MsoNormal">Obj.PID = _ParentID</p>



<p class="MsoNormal">Both of which would be part of criteria. I’m sure most senior
engineers have thought of this, but I thought I would throw that out there.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, July 11, 2006</h2><P>You are correct except that the statement:</P>
<P>obj.ID = ExecuteNonQuery(...)</P>
<P>is performed on the server.&nbsp; So, the returned ID value is present in the COPY of your object on the server.&nbsp; It is this COPY that is returned by the data portal in the ResultObject property of the DataPortalResult.&nbsp; When the data portal method that initiated all of this returns, it bring this COPY along with it.&nbsp; This discussion has to do with getting the information, such as the updated ID value you mentioned, from this copy&nbsp;into the original object on the client.</P>
<P>Obviously, in an example like this it is not too hard to simply copy the ID value from the returned object into the original.&nbsp; But if the returned value had more properties that needed to be updated this could be hairy.&nbsp; We've implemented this type of fix except that we delegate to a virtual MergeWith method to handle the copying.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vargasbo replied on Tuesday, July 11, 2006</h2>Ok, I'll agree if you have to update tons of properties copy would be painful, but if you're updating 25, I'm assuming you already have them in your object, since you just updated them to the database. All we have to do is place the timestamp to make sure concurrecy is maintained.<br><br>Then again, I've only been doing this for 10 years and haven't seen every type of framework out there, just my thoughts :-)<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, July 11, 2006</h2><P>As I've said before - the issue isn't that hard if you restrict the object graphs to only contain CSLA-derived objects. But if you allow for arbitrary objects the issue becomes very complex, because you lose a great deal of control.</P>
<P>And yet you might want an arbitrary object. Perhaps you need to use something interesting like a hashtable, or queue or stack? Or you want to use someone else's serializable object, so you simply reference it from a BusinessBase-derived object?</P>
<P>The point is that it is pretty easy to envision object graphs that aren't pure CSLA - and then you've got serious complexity.</P>
<P>For pure CSLA object graphs you could envision a simplified serializer that runs on the client, creating a "datagram" to send to the server for persistence. It would only send the changed data. Of course at this point you've abandoned mobile objects! You couldn't rehydrate the object graph on the server, because you wouldn't have all the data.</P>
<P>Conversely, this approach would allow for a "resultgram" containing only the data changed on the server. The client-side persistance engine would parse that data and do appropriate updates to the client-side object graph. Again, there's no concept of mobile objects here!</P>
<P>I guess what I'm saying is this: the data portal is designed to enable one concept - mobile objects. It is a powerful and useful concept in many cases.</P>
<P>You could easily envision <EM>another</EM> type of data portal, designed to enable client/server persistence by talking to a server-hosted set of data services. That is also a powerful and useful concept in many cases. But it IS NOT what the data portal is designed to do.</P>
<P>As I said in an earlier post, to make the mobile object concept work with in-place objects, would require an in-place deserialization process. There isn't one in .NET, and there's not one coming in WCF (thus for the forseeable future).</P>
<P>However, CSLA could totally work with a replacement "data portal" concept that didn't enable mobile objects. You could write such a thing as I just described - with datagram/resultgram semantics, and which would communicate with a set of data services (not business objects!) on the server. If I were to do such a thing, it would still have a single entry point, and a channel adapter and a message router - in other words, it would <EM>look</EM> much like the existing data portal. But rather than moving objects back and forth, it would move these datagrams.</P>
<P>This isn't something I have a great deal of interest in doing, so I wouldn't expect to see it coming in a near-future CSLA. Never say never, but it just isn't nearly as interesting to me as going the other direction and creating a true "object portal" that enables mobile objects in a far more flexible manner than the data portal does today. (not that I'm convinced most people need an object portal - just that it is what I find truly interesting and fun <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" />).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Igor replied on Sunday, July 09, 2006</h2><P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN>Hi everyone,<o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN>I’ve got an idea of how to handle replacing references in business objects instead of clients. I would try to use the classic Proxy pattern: when a client requests a reference to a BO, it is actually given a reference to a proxy object (the client is not aware that it has got just a proxy, because the proxy has a proper business-meaningful name). The proxy class contains a private instance of another (real) class (which definition is nested inside the proxy class). The outer (proxy) and inner (real) classes have the same interfaces, but different implementations: public members of the proxy just pass client calls through to the real object (which does the real work). In case of the Update call the private instance of the real class gets replaced inside the proxy, but the clients continue referencing the same proxy object.<o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN>The design works in simple (not comprehensive) tests. But I have not tested it with CSLA objects.<o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN>There is an obvious maintenance issue as the proxy and real objects are to have the same interface; personally, I am prepared to use some sort of code generation to mitigate the issue: depending on other elements of your design the resetting references might be a major pain. <SPAN>&nbsp;</SPAN><o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face="Times New Roman" size=3><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face=Arial color=navy size=2><SPAN>Any feedback will be appreciated.<o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face=Arial color=navy size=2><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face=Arial color=navy size=2><SPAN>Igor Leonov</SPAN></FONT><FONT face=Arial color=navy size=2><SPAN><o:p></o:p></SPAN></FONT></P>
<P class=MsoNormal><FONT face=Arial color=navy size=2><SPAN><o:p>&nbsp;</o:p></SPAN></FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msk replied on Tuesday, July 11, 2006</h2>Thanks guys, it's interesting to see how other people have handled this issue.&nbsp; I was still thinking about how to fix the symptom rather than tackling the root cause - serialization.&nbsp; Rocky, writing an in place deserializer is certainly the ideal solution.&nbsp;&nbsp;I once reverse engineered the vb5/6 propertybag to create a propertybag decoder as a debug tool for old CSLA so I can imagine how difficult that might be.&nbsp; I still have to remind myself from time to time that the DataPortal works with any serializable object.&nbsp; My initial and probably flawed suggestion was to put code in BusinessBase.Save.&nbsp; I still think there is a possibility that this will work.&nbsp; Admitedly it is not ideal, but I think it may be possible to write&nbsp;a reflection based object graph synchronizer.&nbsp; I may attempt it when I have some time free. </div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
