<html><header><title>NullReferenceException in Project Tracker Roles Screen</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>NullReferenceException in Project Tracker Roles Screen</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2474.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD posted on Sunday, March 04, 2007</h2><P><FONT face=Tahoma>Hello,</FONT></P>
<P><FONT face=Tahoma>Apologies if this has been discussed already - I can't find it anywhere so I'm posting it in case it has been missed.</FONT></P>
<P><FONT face=Tahoma>I have downloaded version 2.1.4 of CSLA and the associated Project Tracker.&nbsp; In some code I'm currently writing I am getting an error when working with a bound DataGridView so I tried to reproduce the error in Project Tracker - and I can.</FONT></P>
<P><FONT face=Tahoma>The steps are as follows :-</FONT></P>
<P><FONT face=Tahoma>1) Log into PTracker</FONT></P>
<P><FONT face=Tahoma>2) Open Edit Roles form and double click the name on one of the existing rows.</FONT></P>
<P><FONT face=Tahoma>3) Remove ALL the text from the Name column and click onto another row.&nbsp; The broken rules code fires correctly and the blank row is highlighted as a problem "Name Required". All good so far :)</FONT></P>
<P><FONT face=Tahoma>4) If I go back into the blank name column on the invalid record and enter some text, then hit backspace until all the text is gone from the cell again and then click onto another row then the code crashes out with the following :-</FONT></P>
<P><FONT face=Tahoma>======================================</FONT></P>
<P><FONT face=Tahoma size=1>System.NullReferenceException was unhandled<BR>&nbsp; Message="Object reference not set to an instance of an object."<BR>&nbsp; Source="System"<BR>&nbsp; StackTrace:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.ComponentModel.ReflectPropertyDescriptor.SetValue(Object component, Object value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.DataGridViewDataConnection.PushValue(Int32 boundColumnIndex, Int32 columnIndex, Int32 rowIndex, Object value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridViewCell.SetValue(Int32 rowIndex, Object value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.PushFormattedValue(DataGridViewCell&amp; dataGridViewCurrentCell, Object formattedValue, Exception&amp; exception)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.CommitEdit(DataGridViewCell&amp; dataGridViewCurrentCell, DataGridViewDataErrorContexts context, DataGridViewValidateCellInternal validateCell, Boolean fireCellLeave, Boolean fireCellEnter, Boolean fireRowLeave, Boolean fireRowEnter, Boolean fireLeave)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.CommitEdit(DataGridViewDataErrorContexts context, Boolean forCurrentCellChange, Boolean forCurrentRowChange)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.OnCellMouseDown(HitTestInfo hti, Boolean isShiftDown, Boolean isControlDown)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.OnCellMouseDown(DataGridViewCellMouseEventArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.OnMouseDown(MouseEventArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WmMouseDown(Message&amp; m, MouseButtons button, Int32 clicks)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.WndProc(Message&amp; m)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.DataGridView.WndProc(Message&amp; m)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG&amp; msg)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Windows.Forms.Application.Run(ApplicationContext context)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.OnRun()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.DoApplicationModel()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualBasic.ApplicationServices.WindowsFormsApplicationBase.Run(String[] commandLine)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at PTWin.My.MyApplication.Main(String[] Args) in 17d14f5c-a337-4978-8281-53493378c1071.vb:line 81<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain.nExecuteAssembly(Assembly assembly, String[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()<BR></FONT></P>
<P><FONT face=Tahoma>======================================</FONT></P>
<P><FONT face=Tahoma>It's got to be a data binding "funny" that I'm not understanding.&nbsp; If anybody out there can reproduce this error and let me know how they fixed it I would be very grateful.</FONT></P>
<P><FONT face=Tahoma>I was thinking of trapping the fact that the column in the DataGridView is null but then again I would have though the broken rules code should handle this fact rather than the data binding failing.</FONT></P>
<P><FONT face=Tahoma>I know there have been issues with data binding but not sure if this is a known one with an easy fix or not.</FONT></P>
<P><FONT face=Tahoma>Thanks</FONT></P>
<P><FONT face=Tahoma>ChrisD</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Sunday, March 04, 2007</h2><P>Ok, I've just noticed that starting at step 4 of my description above, it looks like it doesn't matter whether I leave the text I have typed into the blank row there or not. Clicking onto another row with text entered correctly also causes the same error.</P>
<P>It looks as if the data row in the grid has lost it's connection to the object it was bound too and we are seeing a Null Reference problem.</P>
<P>Can anyone reproduce my issue?</P>
<P>Cheers</P>
<P>ChrisD</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Tuesday, March 06, 2007</h2><P>Morning,</P>
<P>Anybody got an answer for me on this?&nbsp; </P>
<P>Any help that can be offered will be gratefully received and it'll make my 36th birthday even better :)</P>
<P>Thank guys</P>
<P>ChrisD</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Saturday, March 10, 2007</h2><P>Aaaah.... you could hear a pin drop; isn't silence wonderful LOL.</P>
<P>Jokes apart has anyone been able to reproduce and fix this one yet?</P>
<P>Cheers</P>
<P>ChrisD</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, March 10, 2007</h2><P>I think the issue is that an empty string is converted to a null/Nothing by the grid, so when you blank the column a Nothing ends up in your field. Then when you try to change it back, your set block throws because mName is Nothing.</P>
<P>I think (though I'm not 100% sure) that this must be an SP1 change in the grid, because I don't recall running into this in the past.</P>
<P>One solution is to use the C#-style coding approach even in VB:</P>
<P>Set(ByVal value As String)<BR>&nbsp; CanWriteProperty(True)<BR>&nbsp; If value Is Nothing Then value = ""<BR>&nbsp; If Not mName.Equals(value) Then<BR>&nbsp;&nbsp;&nbsp; mName = value<BR>&nbsp;&nbsp;&nbsp; PropertyHasChanged()<BR>&nbsp; End If<BR>End Set</P>
<P>Another solution is to use the&nbsp;&lt;&gt; operator:</P>
<P>Set(ByVal value As String)<BR>&nbsp; CanWriteProperty(True)<BR>&nbsp; If mName &lt;&gt; value Then<BR>&nbsp;&nbsp;&nbsp; mName = value<BR>&nbsp;&nbsp;&nbsp; PropertyHasChanged()<BR>&nbsp; End If<BR>End Set</P>
<P>Either solution avoids the issue, though the first solution is probably really the one you should use.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ChrisD replied on Saturday, March 10, 2007</h2><P>Thanks Rocky :)</P>
<P>I wondered if it was an SP1 related issue as I couldn't imagine you leaving that unresolved in PTracker.</P>
<P>Cheers</P>
<P>ChrisD</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
