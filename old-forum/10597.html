<html><header><title>Need security advice for retrieving one's own 'account' info</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Need security advice for retrieving one's own 'account' info</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10597.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ToddH posted on Saturday, August 06, 2011</h2><p>I have a created a class called SecurityUser that allows those in an Administrators group retrieve, edit, update, etc the object. It follows the normal CSLA guidelines and examples for checking security. I&#39;m OK with this object.</p>
<p>e.g. The following is the normal stuff you see...</p>
<p>public static SecurityUser GetSecurityUser(int id)<br />{<br />&nbsp; &nbsp; if (!AuthorizationRules.CanGetObject(typeof(SecurityUser)))<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; throw new SecurityException(&quot;some message here&quot;);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; return DataPortal.Fetch&lt;SecurityUser&gt;(new SingleCriteria&lt;SecurityUser, int&gt;(id));<br />}&nbsp;</p>
<p>However, I have also created another class (SecurityUserSelf) for people to update their <i>own</i> account. This is specifically for those that aren&#39;t in the Administrators group but need to update their own profile. A very standard scenario. I wouldn&#39;t think that we would allow this object to be added to any Roles.</p>
<p>How do you suggest implementing security? I was thinking about something like this:</p>
<p>public static SecurityUserSelf GetSecurityUserSelf(int id)<br />{<br />&nbsp; &nbsp; // Get ID of current user. I have added an ID property to my custom identity class.<br />&nbsp; &nbsp; int currentUserId = ((MyCustomIdentity)Csla.ApplicationContext.User.Identity).ID;<br /><br />&nbsp; &nbsp; if (id != currentUserId)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; throw new SecurityException(&quot;Only allowed to update yourself!&quot;);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; return DataPortal.Fetch etc....<br />}<br /><br />And then the normal Save routine would be ok as-is, because we know that only an existing user (created by some other Admin) could retrieve their own account info using this object. I chose to check the user in the GetSecurityUserSelf() method instead of the Save() method to prevent unauthorized people from randomly viewing/getting other&#39;s accounts. Also, there wouldn&#39;t be a NewSecurityUserSelf() method, because all accounts have to be added by an Admin using the first class mentioned.</p>
<p>Thoughts?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Saturday, August 06, 2011</h2><p>This seems fine to me. In CSLA 4 you can formalize the behavior into an AuthorizationRule, but in 3.8 your approach is a good one.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ToddH replied on Saturday, August 06, 2011</h2><p>Thanks Rocky!&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
