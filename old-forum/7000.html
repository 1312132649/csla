<html><header><title>Extending the CSLA BusinessBase for some more features?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Extending the CSLA BusinessBase for some more features?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7000.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>AKaplan posted on Monday, May 25, 2009</h2>I would like to extend csla businessbase to feature some options. I was wondering where I should place these features below.<br /><br />Imports System.Collections.Specialized<br />Imports System.Xml<br />Imports System.Text<br />Imports System.Globalization<br />Imports System.IO<br />Imports System.Runtime.Serialization<br />Imports System.Xml.Serialization<br />Imports System.Runtime.Serialization.Formatters.Binary<br />Imports System.Runtime.Serialization.Formatters.Soap<br /><br />Public Class Serializer<br /><br />    Public Shared ReadOnly CanBinarySerialize As Boolean<br /><br />    Public Shared Function ConvertToNameValueCollection(ByVal keys As String, ByVal values As String) As NameValueCollection<br />        Dim values2 As New NameValueCollection<br />        If (((keys IsNot Nothing) AndAlso (values IsNot Nothing)) AndAlso ((keys.Length > 0) AndAlso (values.Length > 0))) Then<br />            Dim separator As Char() = New Char() {":"c}<br />            Dim strArray As String() = keys.Split(separator)<br />            For i As Integer = 0 To (strArray.Length / 4) - 1<br />                Dim startIndex As Integer = Integer.Parse(strArray(((i * 4) + 2)), CultureInfo.InvariantCulture)<br />                Dim length As Integer = Integer.Parse(strArray(((i * 4) + 3)), CultureInfo.InvariantCulture)<br />                Dim str As String = strArray((i * 4))<br />                If (((strArray(((i * 4) + 1)) = "S") AndAlso (startIndex >= 0)) AndAlso (values.Length >= (startIndex + length))) Then<br />                    values2.Item(str) = values.Substring(startIndex, length)<br />                End If<br />            Next i<br />        End If<br />        Return values2<br />    End Function<br /><br />    Public Shared Sub ConvertFromNameValueCollection(ByVal nvc As NameValueCollection, ByRef keys As String, ByVal values As String, Optional ByVal allowEmptyStrings As Boolean = False)<br />        If ((nvc IsNot Nothing) AndAlso (nvc.Count <> 0)) Then<br />            Dim builder As New StringBuilder<br />            Dim builder2 As New StringBuilder<br />            Dim num As Integer = 0<br />            For Each str As String In nvc.AllKeys<br />                If (str.IndexOf(":"c) <> -1) Then<br />                    Throw New ArgumentException("ExtendedAttributes Key can not contain the character "":""")<br />                End If<br />                Dim text As String = nvc.Item(str)<br />                If ((allowEmptyStrings AndAlso ([text] IsNot Nothing)) OrElse Not TypeHelper.IsNullorEmpty([text])) Then<br />                    builder.AppendFormat("{0}:S:{1}:{2}:", str, num, [text].Length)<br />                    builder2.Append([text])<br />                    num = (num + [text].Length)<br />                End If<br />            Next<br />            keys = builder.ToString<br />            values = builder2.ToString<br />        End If<br />    End Sub<br /><br />    Public Shared Sub ConvertFromNameValueBinaryCollection(ByVal nvc As NameValueCollection, ByVal keys As String, ByVal values As String, ByVal binary As Byte(), Optional ByVal allowEmptyStrings As Boolean = False)<br />        If ((nvc IsNot Nothing) AndAlso (nvc.Count <> 0)) Then<br />            Dim builder As New StringBuilder<br />            Dim builder2 As New StringBuilder<br />            Dim builder3 As New StringBuilder<br />            Dim num As Integer = 0<br />            For Each str As String In nvc.AllKeys<br />                If (str.IndexOf(":"c) <> -1) Then<br />                    Throw New ArgumentException("ExtendedAttributes Key can not contain the character "":""")<br />                End If<br />                Dim text As String = nvc.Item(str)<br />                If ((allowEmptyStrings AndAlso ([text] IsNot Nothing)) OrElse Not TypeHelper.IsNullorEmpty([text])) Then<br />                    builder.AppendFormat("{0}:S:{1}:{2}:{3}", str, num, text.Length, text.Length)<br />                    builder2.Append(text)<br />                    builder3.Append(text)<br />                    num = (num + [text].Length)<br />                End If<br />            Next<br />            keys = builder.ToString<br />            values = builder2.ToString<br />            binary = ConvertObjectToBytes(builder3.ToString)<br />        End If<br />    End Sub<br /><br />    Public Shared Function ConvertSoapToObject(ByVal xml As String, ByVal objectType As Type) As Object<br />        Dim serializationStream As MemoryStream = Nothing<br />        Dim obj2 As Object = Nothing<br />        Try<br />            Dim formatter As IFormatter = New SoapFormatter<br />            serializationStream = New MemoryStream(Encoding.Default.GetBytes(xml))<br />            obj2 = formatter.Deserialize(serializationStream)<br />        Finally<br />            If (serializationStream IsNot Nothing) Then<br />                serializationStream.Close()<br />            End If<br />        End Try<br />        Return obj2<br />    End Function<br /><br />    Public Shared Function ConvertFileToObject(ByVal path As String, ByVal objecttype As Type) As Object<br />        Dim obj2 As Object = Nothing<br />        If ((path IsNot Nothing) AndAlso (path.Length > 0)) Then<br />            Using stream As New FileStream(path, FileMode.Open, FileAccess.Read)<br />                obj2 = New XmlSerializer(objecttype).Deserialize(stream)<br />                stream.Close()<br />            End Using<br />        End If<br />        Return obj2<br />    End Function<br /><br />    Public Shared Function ConvertObjectToBytes(ByVal objectToConvert As Object) As Byte()<br />        Dim buffer As Byte() = Nothing<br />        If Serializer.CanBinarySerialize Then<br />            Dim formatter As New BinaryFormatter<br />            Using stream As New MemoryStream<br />                formatter.Serialize(stream, objectToConvert)<br />                stream.Position = 0<br />                buffer = New Byte(stream.Length - 1) {}<br />                stream.Read(buffer, 0, buffer.Length)<br />                stream.Close()<br />            End Using<br />        End If<br />        Return buffer<br />    End Function<br /><br />    Public Shared Function ConvertByteToObject(ByVal byteArray As Byte()) As Object<br />        Dim obj2 As Object = Nothing<br />        If ((Serializer.CanBinarySerialize AndAlso (byteArray IsNot Nothing)) AndAlso (byteArray.Length > 0)) Then<br />            Dim formatter As New BinaryFormatter<br />            Using stream As New MemoryStream<br />                stream.Write(byteArray, 0, byteArray.Length)<br />                stream.Position = 0<br />                If (byteArray.Length > 4) Then<br />                    obj2 = formatter.Deserialize(stream)<br />                End If<br />                stream.Close()<br />            End Using<br />        End If<br />        Return obj2<br />    End Function<br /><br />    Public Shared Function ConvertXmlToObject(ByVal xml As String, ByVal ObjectType As Type) As Object<br />        Dim obj2 As Object = Nothing<br />        If Not TypeHelper.IsNullorEmpty(xml) Then<br />            Using reader As New StringReader(xml)<br />                obj2 = New XmlSerializer(ObjectType).Deserialize(reader)<br />                reader.Close()<br />            End Using<br />        End If<br />        Return obj2<br />    End Function<br /><br />    Public Shared Function ConvertXmlNodeToObject(ByVal node As XmlNode, ByVal ObjectType As Type) As Object<br />        Dim obj2 As Object = Nothing<br />        If (node IsNot Nothing) Then<br />            Using reader As New StringReader(node.OuterXml)<br />                obj2 = New XmlSerializer(ObjectType).Deserialize(reader)<br />                reader.Close()<br />            End Using<br />        End If<br />        Return obj2<br />    End Function<br /><br />    Public Shared Function ConvertObjectToSoapString(ByVal obj As Object) As String<br />        Dim serializationStream As New MemoryStream<br />        Dim formatter As IFormatter = New SoapFormatter<br />        Dim str As String = String.Empty<br />        Try<br />            formatter.Serialize(serializationStream, obj)<br />            Dim length As Integer = CInt(serializationStream.Length)<br />            Dim buffer As Byte() = New Byte(length - 1) {}<br />            serializationStream.Seek(0, SeekOrigin.Begin)<br />            serializationStream.Read(buffer, 0, length)<br />            Dim encoding As New UTF8Encoding<br />            str = encoding.GetString(buffer).Trim<br />        Finally<br />            If (serializationStream IsNot Nothing) Then<br />                serializationStream.Close()<br />            End If<br />        End Try<br />        Return str<br />    End Function<br /><br />    Public Shared Function ConvertByteToString(ByVal arr As Byte()) As String<br />        Return Convert.ToBase64String(arr)<br />    End Function<br />    Public Shared Function ConvertXmlToString(ByVal objectToConvert As Object) As Object<br />        Dim str As String = Nothing<br />        If (objectToConvert IsNot Nothing) Then<br />            Dim serializer As New XmlSerializer(objectToConvert.GetType)<br />            Using writer As New StringWriter(CultureInfo.InvariantCulture)<br />                serializer.Serialize(DirectCast(writer, TextWriter), objectToConvert)<br />                str = writer.ToString<br />                writer.Close()<br />            End Using<br />        End If<br />        Return str<br />    End Function<br /><br />    Public Shared Function LoadBinaryFile(ByVal path As String) As Object<br />        If Not File.Exists(path) Then<br />            Return Nothing<br />        End If<br />        Using stream As New FileStream(path, FileMode.Open, FileAccess.Read)<br />            Dim reader As New BinaryReader(stream)<br />            Dim buffer As Byte() = New Byte(stream.Length - 1) {}<br />            reader.Read(buffer, 0, CInt(stream.Length))<br />            Return Serializer.ConvertByteToObject(buffer)<br />        End Using<br />    End Function<br /><br />    Public Shared Function SaveAsBinary(ByVal objectToSave As Object, ByVal path As String) As Boolean<br />        If ((objectToSave IsNot Nothing) AndAlso Serializer.CanBinarySerialize) Then<br />            Dim buffer As Byte() = Serializer.ConvertObjectToBytes(objectToSave)<br />            If (buffer IsNot Nothing) Then<br />                Using stream As New FileStream(path, FileMode.OpenOrCreate, FileAccess.Write)<br />                    Using writer As New BinaryWriter(stream)<br />                        writer.Write(buffer)<br />                        Return True<br />                    End Using<br />                End Using<br />            End If<br />        End If<br />        Return False<br />    End Function<br /><br />    Public Shared Sub SaveAsXML(ByVal objectToConvert As Object, ByVal path As String)<br />        If (objectToConvert IsNot Nothing) Then<br />            Dim serializer As New XmlSerializer(objectToConvert.GetType)<br />            Using writer As New StreamWriter(path)<br />                serializer.Serialize(DirectCast(writer, TextWriter), objectToConvert)<br />                writer.Close()<br />            End Using<br />        End If<br />    End Sub<br /><br />    Public Shared Function XMLDecode(ByVal sTmp As String) As String<br />        Dim numArray As Integer() = New Integer() {38, 60, 62, 34, 61, 39}<br />        For i As Integer = 0 To numArray.Length - 1<br />            sTmp = sTmp.Replace(("&amp;#" &amp; numArray(i).ToString &amp; ";"), DirectCast(ChrW(numArray(i)), Char).ToString)<br />        Next i<br />        Return sTmp<br />    End Function<br /><br />    Public Shared Function XMLEncode(ByVal sTmp As String) As String<br />        Dim numArray As Integer() = New Integer() {38, 60, 62, 34, 61, 39}<br />        For i As Integer = 0 To numArray.Length - 1<br />            sTmp = sTmp.Replace(DirectCast(ChrW(numArray(i)), Char).ToString, ("&amp;#" &amp; numArray(i).ToString &amp; ";"))<br />        Next i<br />        Return sTmp<br />    End Function<br /><br />End Class<br /><br /> _<br />Public Class ExtendedAttributes<br /><br />    Private _extendedAttribute As NameValueCollection<br /><br />    Public ReadOnly Property ExtendedAttributeCount() As Integer<br />        Get<br />            Return _extendedAttribute.Count<br />        End Get<br />    End Property<br /><br />    Public Function GetExtendedAttribute(ByVal name As String) As String<br />        Dim str As String = _extendedAttribute.Item(name)<br />        If str Is Nothing Then<br />            Return String.Empty<br />        End If<br />        Return str<br />    End Function<br /><br />    Public Sub SetExtendedAttribute(ByVal name As String, ByVal value As String)<br />        If (name.IndexOf("PollItem") > -1) Then<br />            Debug.WriteLine(String.Concat(New String() {"Setting '", name, "' to '", value, "'"}))<br />        End If<br />        If ((value Is Nothing) OrElse (value = String.Empty)) Then<br />            _extendedAttribute.Remove(name)<br />        Else<br />            _extendedAttribute.Item(name) = value<br />        End If<br />    End Sub<br /><br />    Public Function GetSerializerData() As SerializerData<br />        Dim _data As New SerializerData<br />        Dim _keys As String = String.Empty<br />        Dim _values As String = String.Empty<br />        Serializer.ConvertFromNameValueCollection(_extendedAttribute, _keys, _values)<br />        _data.Keys = _keys<br />        _data.Values = _values<br />        Return _data<br />    End Function<br /><br />    Public Sub SetSerializerDate(ByVal data As SerializerData)<br />        If ((_extendedAttribute Is Nothing) OrElse (_extendedAttribute.Count = 0)) Then<br />            _extendedAttribute = Serializer.ConvertToNameValueCollection(data.Keys, data.Values)<br />        End If<br />        If (_extendedAttribute Is Nothing) Then<br />            _extendedAttribute = New NameValueCollection<br />        End If<br />    End Sub<br /><br />End Class<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, May 26, 2009</h2>One of the key recommendations has always been to create your own Generic Base class for each CSLA stereotype. Each of your classes inherits from its corresponding CSLA class. e.g. MyBusinessBase(Of T) inherits from BusinessBase(Of T).<br /><br />Then all of your BOs should inherit from your base classes. Then when you want to extend CSLA in some way you only need to add code to MyBusinessBase and all of your root BOs will now have the new behavior.<br /><br />Joe</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AKaplan replied on Tuesday, May 26, 2009</h2>oh yea... duhh...</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
