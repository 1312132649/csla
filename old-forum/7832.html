<html><header><title>Getting CSLALight to work over HTTPS</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Getting CSLALight to work over HTTPS</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7832.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds posted on Tuesday, October 20, 2009</h2>I've got a CSLALight-based app running fine, but some users now want to use SSL - i.e. run over HTTPS.<br /><br />I thought this would be easy but it turned out not to be. I got it to work in the end, so thought I'd post it here in case it helps somebody else (and I have a few lingering questions...)<br /><br />So, I want my app to configure itself dynamically based on whether it's HTTP or HTTPS at runtime. <br /><br />var pageUri = HtmlPage.Document.DocumentUri.ToString();<br />if (pageUri.ToLower().Contains("https"))<br />{<br />    var binding = new BasicHttpBinding(BasicHttpSecurityMode.Transport);<br />    binding.MaxBufferSize = int.MaxValue;<br />    binding.MaxReceivedMessageSize = int.MaxValue;<br />    binding.ReceiveTimeout = TimeSpan.FromMinutes(10);<br />    binding.SendTimeout = TimeSpan.FromMinutes(10);<br />    binding.OpenTimeout = TimeSpan.FromMinutes(10);<br /><br />    WcfProxy.DefaultBinding = binding;<br />}<br /><br /><br />So, I'm setting a new Binding on the WcfProxy which has the security mode set to Transport.<br /><br />Next, I had to modify my web.config's WCF configuration to add the following element into the binding:<br /><br />security mode="Transport"<br /><br /><br />Then, further on down, the binding configuration is referenced in the endpoint.<br /><br /><br />So, as I said, this works. However, I'd prefer not to have to make changes at install time to the web.config file. Is there a way I can have multiple WCF configurations that would take the correct security setting depending on whether HTTP or HTTPS was being used?<br /><br />Hopefully there's a WCF expert here who can help me with this.<br /><br />Cheers...<br /><br />Craig</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Tuesday, October 20, 2009</h2>Yep, you can certainly have two endpoints and two services (.svc files).  You would need to set a different default url on the proxy class as well instead of relying on .ClientConfig.<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br /><br />-----Original Message-----<br />From: cds [mailto:cslanet@lhotka.net] <br />Sent: Tuesday, October 20, 2009 7:18 PM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] Getting CSLALight to work over HTTPS<br /><br />I've got a CSLALight-based app running fine, but some users now want to use SSL - i.e. run over HTTPS.<br /><br />I thought this would be easy but it turned out not to be. I got it to work in the end, so thought I'd post it here in case it helps somebody else (and I have a few lingering questions...)<br /><br />So, I want my app to configure itself dynamically based on whether it's HTTP or HTTPS at runtime. <br /><br />var pageUri = HtmlPage.Document.DocumentUri.ToString();<br />if (pageUri.ToLower().Contains("https"))<br />{<br />    var binding = new BasicHttpBinding(BasicHttpSecurityMode.Transport);<br />    binding.MaxBufferSize = int.MaxValue;<br />    binding.MaxReceivedMessageSize = int.MaxValue;<br />    binding.ReceiveTimeout = TimeSpan.FromMinutes(10);<br />    binding.SendTimeout = TimeSpan.FromMinutes(10);<br />    binding.OpenTimeout = TimeSpan.FromMinutes(10);<br /><br />    WcfProxy.DefaultBinding = binding;<br />}<br /><br /><br />So, I'm setting a new Binding on the WcfProxy which has the security mode set to Transport.<br /><br />Next, I had to modify my web.config's WCF configuration to add the following:<br /><br /><br />	<br />		<br />		    <br />            --><br />            <br />		<br />	<br /><br /><br /><br />Then, further on down, the binding configuration is referenced in the endpoint: <br /><br /><br />	<br />		<br />			<br />				<br />			<br />		<br />		<br />	<br /><br /><br /><br />So, as I said, this works. However, I'd prefer not to have to make changes at install time to the web.config file. Is there a way I can have multiple WCF configurations that would take the correct security setting depending on whether HTTP or HTTPS was being used?<br /><br />Hopefully there's a WCF expert here who can help me with this.<br /><br />Cheers...<br /><br />Craig<br /><br /></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
