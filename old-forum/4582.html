<html><header><title>LINQ style and performance in ProjectTracker Lists</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LINQ style and performance in ProjectTracker Lists</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4582.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>phm posted on Saturday, March 29, 2008</h2><P>Although strictly speaking this is not a bug, IMHO the way the ProjectTrackers example fills the lists using LINQ is not optimal.</P>
<P>For example, in <FONT face="Courier New">RoleList.DataPortal_Fetch()</FONT> adding</P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.DataContext.Log = Console.Out;</FONT></P>
<P>at the beginning of the method shows (in the output window of the debugger) that the generated query is:</P>
<P><FONT face="Courier New">SELECT [t0].[Id], [t0].[Name], [t0].[LastChanged]<BR>FROM [dbo].[Roles] AS [t0]</FONT></P>
<P><FONT face="Times New Roman">This gets all columns from the database, including the unused </FONT><FONT face="Courier New">LastChanged</FONT><FONT face="Times New Roman">. Not a big deal in this particular situation, but could be worse for a table with many columns.</FONT></P>
<P>Moving the <FONT face="Courier New">new NameValuePair(role.Id, role.Name)</FONT><FONT face="Times New Roman"> into the query expression instead of the foreach loop:</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var data = from r in ctx.DataContext.Roles<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select new NameValuePair(r.Id, r.Name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = false;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var role in data)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.Add(role);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = true;</FONT></P>
<P><FONT face="Times New Roman">allows LINQ to only query the needed columns:</FONT></P>
<P><FONT face="Courier New">SELECT [t0].[Id] AS [key], [t0].[Name] AS [value]<BR>FROM [dbo].[Roles] AS [t0]</FONT></P>
<P>Adding an <FONT face="Courier New">AddRange(IEnumerable&lt;T&gt;)<FONT face="Times New Roman"> to </FONT>ExtendedBindingList&lt;T&gt;</FONT><FONT face="Times New Roman"> would then allow to write</FONT></P>
<P><FONT face="Times New Roman"><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.AddRange(data);</FONT></FONT></P>
<P><FONT face="Times New Roman">instead of the loop, or even</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.AddRange(from r in ctx.DataContext.Roles<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select new NameValuePair(r.Id, r.Name));</FONT></P>
<P>In more complex situations, where the query is created in several steps (such as in <FONT face="Courier New">ProjectList</FONT>), the <FONT face="Courier New">select new ...</FONT><FONT face="Times New Roman"> has to be done at the very end, by adding a last step to the query construction. You can for example substitute this for the <FONT face="Courier New">foreach</FONT> loop:</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.AddRange(from p in data<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select new ProjectInfo(p.Id, p.Name));</FONT></P>
<P>The original query (with optional filter)</P>
<P><FONT face="Courier New">SELECT [t0].[Id], [t0].[Name], [t0].[Started], [t0].[Ended], [t0].[Description], [t0].[LastChanged]<BR>FROM [dbo].[Projects] AS [t0]<BR>WHERE [t0].[Name] LIKE @p0<BR>-- @p0: Input VarChar (Size = 10; Prec = 0; Scale = 0) [%Business%]</FONT></P>
<P>then becomes</P>
<P><FONT face="Courier New">SELECT [t0].[Id] AS [id], [t0].[Name] AS [name]<BR>FROM [dbo].[Projects] AS [t0]<BR>WHERE [t0].[Name] LIKE @p0<BR>-- @p0: Input VarChar (Size = 10; Prec = 0; Scale = 0) [%Business%]</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, March 30, 2008</h2>Good suggestions, thanks! I'll put an AddRange() method into CSLA.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
