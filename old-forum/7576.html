<html><header><title>Autopostback=true for AJAX combo box breaks CSLA authentication</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Autopostback=true for AJAX combo box breaks CSLA authentication</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7576.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>joansk8s posted on Friday, September 04, 2009</h2>I'm new to CSLA and am using version 3.7 in a web application for our Intranet.&nbsp; I have a web form that includes an AJAX Combobox.&nbsp; The idea is that when a particular value is selected, it should make another control visible.&nbsp; To do this, I need to set Autopostback=True for the control.&nbsp; However, it breaks the CSLA authentication I have in place.&nbsp; The error I get is as follows:<br><br><i>Type is not resolved for member 'HD.Lib.Security.HDPrincipal,HD.Lib, 
Version=1.0.0.0, Culture=neutral, PublicKeyToken=null'<br><br></i>If I take the authentication code (below) out of my form, it works fine.&nbsp; Alternately, if I leave the authentication code in and take out the Autopostback=True, it works fine as well.&nbsp; Any insights?<br><br><font size="2">Dim oIdentity As Security.HDIdentity<br>Randomize()<br><br>'this assigns the BusinessPrincipal object to My.User.CurrentPrincipal<br>Dim s As String = User.Identity.Name.Substring(IIf(User.Identity.Name.IndexOf("\") &lt; 0, 0, User.Identity.Name.IndexOf("\") + 1))<br>Security.HDPrincipal.Login(s)<br>oIdentity = Security.HDIdentity.GetObject<br><br>If oIdentity.IsAuthenticated Then<br>&nbsp;&nbsp;&nbsp; Me.ltUserMessage.Text = "Welcome " &amp; Security.HDIdentity.GetObject.Name.ToString &amp; "!&lt;br /&gt;&lt;br /&gt;"<br>&nbsp;&nbsp;&nbsp; Me.ltError.Text = ""<br>&nbsp;&nbsp;&nbsp; </font><font size="2">Session("UserID") = Security.HDIdentity.GetObject.UserID</font><br><font size="2">&nbsp;&nbsp;&nbsp; sUserName = Security.HDIdentity.GetObject.Name.ToString<br>Else<br>&nbsp;&nbsp; Me.ltUserMessage.Text = ""<br>&nbsp;&nbsp; Me.ltError.Text = "Sorry, you do not have access to use this application.&nbsp; Access is Denied"<br>&nbsp;&nbsp; Exit Sub<br>End If</font><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 04, 2009</h2><P>Sometimes AJAX callbacks skip the normal ASP.NET page lifecycle - not setting up things like Session or principal objects.</P>
<P>Obviously this affects <EM>any</EM> authz model, not just the CSLA model - because CSLA is just using the normal .NET model :)</P>
<P>In many cases there's an attribute or something you can add to your AJAX service to specify that it does need things like Session and a valid principal, so the page lifecycle is invoked on the callback.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
