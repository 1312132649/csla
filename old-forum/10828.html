<html><header><title>ValidationRules vs PropertyHasChanged?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ValidationRules vs PropertyHasChanged?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10828.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 posted on Sunday, October 30, 2011</h2><p>We are using CSLA 3.8.x and want to build some validation rules that configure some default values whenever a property has changed. We are using validation rules as has been suggested on this forum, so to minimize the amount of code that goes into the setter methods in our properties.</p>
<p>However, this causes the problem that when we run the validation rules that these rules also fire and change values that we don&#39;t want changed. An example of this is on an invoice, whenver you select a product we set the default description, price, location, etc for that line. However, when loading the values from the database, we obviously want to check QuantityOnHand figures and other rules&nbsp;but don&#39;t want to reset any changes the user has made to the description, price, location, etc fields previously. </p>
<p>We have thought of&nbsp;some solutions are would like the communities opinon on what would be best practice:</p>
<ul>
<li>Just write all logic within the PropertyHasChanged method (not preferred, very messy)</li>
<li>Extended PropertyHasChanged method to rule a series of methods similar to validationrules, but obviously only is called when PropertyHasChanged fires not Validation.CheckRules. We would then need to have a AddPropertyRules method that would work like AddBusinessRules.</li>
<li>Extended the Validation.CheckRules to be able to pass in a beginning and ending&nbsp;priority and only run rules from between that range (inclusive). This would allow us to build the validation rules that are setting defaults only to be say at 0 and all others to be at say priority 10+ and then run ValidationRules.CheckRules(10,25) to run all rules between that range. We would need to be very diligent with our priorities.</li>
</ul>
<p>I&#39;m very intestered in what others have done within the framework, because this cannot be a unique situation.</p>
<p>Regards,</p>
<p>Marjon</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, October 30, 2011</h2><p>There are a couple general solutions I think you should consider.</p>
<p>First, rules can (and should) be smart. If a rule should only operate on the object when the object is in a certain state, then the rule should check for that state. You are describing a scenario where the object is in various states (loading data, interacting with user, saving data), and there&#39;s absolutely nothing wrong with making your rules smart enough to act (or not act) in each state.</p>
<p>Second, you can use explicit short circuiting to block higher priority rules from running. This isn&#39;t as neat as having smart rules, but it can solve some simpler scenarios. Create a rule that checks the object state, and in some state(s) it short circuits rules. Put this at Priority 1 (or something), and put all optional rules at Priority 2.</p>
<p>The rules system in 2.1-3.8 isn&#39;t as powerful as the CSLA 4 rules system, and some of the enhancements in CSLA 4 are designed to simplify your type of scenario. But even in CSLA 4, the idea of smart rules applies.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Sunday, October 30, 2011</h2><p>I&#39;m all for smart rules, and that was a solution that was suggested internally. Where we have a property that marks the object to be in a certain state, in which all rules would need to check for and if in that state then bypass the rule that changes / sets default values. We would then have to ensure that property was set before call CheckRules() and then resetting it afterwards we wanted this behaviour.</p>
<p>The second option will not work as the rules which load defaults are expected to run at priority zero and all other rules at priority 1+. Some of the priority 1 rules, expect that the other methods have been run and certain defaults loaded. We don&#39;t want every rule to have to check&nbsp;or load certain data when it can only be loaded once.</p>
<p>While I can see what you are saying about the state of the object, the most simplistic explanation of what I want to achieve is this. </p>
<p><strong>How can I get a specific function/rule to run ONLY when that property has changed and not as part of the standard ValdationRules.CheckRules() routine?</strong> <strong>Checking if the property itself is dirty doesn&#39;t suffice.</strong></p>
<p>It would be nice if this information was available in RuleArgs (i.e. was this called via CheckRules() or a PropertyHasChanged()). Not that I want to change the base CSLA classes, I prefer a much easier upgrade path in the future one day to CSLA4.</p>
<p>Thanks for your comments so far Rocky!</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, October 31, 2011</h2><p>i all,</p>
<p>You can achive this in CSLA 4.2.&nbsp; I believe there is no plan to make any further updates to the rule engine in 3.8.x. </p>
<p>For CSLA 4.2 property rules you can set:&nbsp;</p>
<pre style="font-family:Consolas;font-size:13px;color:black;background:none repeat scroll 0% 0% #fafafa;">CanRunAsAffectedProperty&nbsp;=&nbsp;<span style="color:blue;">false</span>; <span style="color:green;">// expensive rule - do not run as affected property or as inpout property is changed </span>
CanRunInCheckRules&nbsp;= <span style="color:blue;">false</span>;       <span style="color:green;">//&nbsp;change&nbsp;to&nbsp;true&nbsp;if&nbsp;rule can run&nbsp;in&nbsp;CheckRules&nbsp;</span>
CanRunOnServer&nbsp;= <span style="color:blue;">false</span>;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">      //&nbsp;Change&nbsp;to&nbsp;true&nbsp;if rule can run&nbsp;i&nbsp;DataAccess&nbsp;(logical&nbsp;server&nbsp;side&nbsp;of&nbsp;dataportal)<br /><br /></span><br />This will only allow the rule to run at PropertyHasChanged. <br /></pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
