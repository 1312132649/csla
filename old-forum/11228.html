<html><header><title>How to Create MEF Container in Server Side?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to Create MEF Container in Server Side?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11228.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon posted on Tuesday, March 13, 2012</h2><p>In my solution, use WCF communicate between client and server. &nbsp;and host in IIS.</p>
<p>my problem is how to create MEF Container in server side and import &nbsp;repository instance to ObjectFactory?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Tuesday, March 13, 2012</h2><p>Follow this link <a href="http://cslacontrib.codeplex.com/SourceControl/list/changesets">http://cslacontrib.codeplex.com/SourceControl/list/changesets</a>&nbsp; and download the latest source. </p>
<p>In the folder $\samples\MEFSamples\ObjectFactory you will find a sample application with ObjectFactory that use MEF. <br />And in the $\trunk\CslaContrib.MEF you will find baseclasses and an ObjectFactoryLoader that use MEF.</p>
<p>Basically:</p>
<ol>
<li>Create interfaces for your ObjectFactories in the business assembly or separate assembly.rom</li>
<li>Use the MEFFactoryLoader from CslaContrib.MEF (configured in servers web.config and maybe applications app.config)</li>
<li>Make sure the object factory assemblies make into the servers bin folder. </li>
<li>Make your &quot;root&quot; object factories export the actual interface and import child factory interfaces</li>
</ol></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon replied on Tuesday, March 13, 2012</h2><p>Thanks.</p>
<p>I will have to combine diffgrah„ÄÅcustomField&nbsp; MEF MefBusinessBase into one Bussinessbase</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, March 14, 2012</h2><p>When you use ObjectFactory you have no need for MefBusinessBase and the other Mef intermediate base classes. </p>
<p>MefFactoryLoader is the key component and the usage of interfaces for the &quot;root&quot; and &quot;child&quot; object factories.</p>
<p>They MefXYX base classes are only required for repository pattern and just my laziness to use the same business library with a minimum of changes for the 2 samples.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>simon replied on Wednesday, March 14, 2012</h2><p>According to what I understand, if need to sepreate BO and DataAccess,such as Fetch,Create, into two assembly, will use ObjectFactory. If I no sepeate them. How to Create Container?</p>
<p>for example in ProjectTracker, if i need to create MEF, should create static class&nbsp; and&nbsp; examine it in DALFactory</p>
<p>&nbsp;public static IDALManager GetManager()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>&nbsp;&nbsp; _container = Container.Current;<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (dalManager == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var dalTypeName = ConfigurationManager.AppSettings[&quot;DalManagerType&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!string.IsNullOrEmpty(dalTypeName))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // _dalType = Type.GetType(dalTypeName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>&nbsp; dalManager = ServiceLocator.Current.GetInstance&lt;IDALManager&gt;(dalTypeName);<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new NullReferenceException(&quot;DalManagerType&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (dalManager == null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new ArgumentException(string.Format(&quot;Type {0} could not be found&quot;, dalTypeName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return dalManager;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Wednesday, March 14, 2012</h2><p>Look at MefFactoryLoader. </p>
<p><strong>You want to use MEF to have a separate DAL layer for unit testing and another for production - right? </strong></p>
<p>That would typically require that you have the implementation in separate asseblies to be loaded into the container.</p>
<p>CSLA - when using ObjectFactory requires an ObjectFactoryLoader to return</p>
<ul>
<li>the type (so CSLA can check for RunLocal attribute on the method to call)</li>
<li>an instance of the actual factory for a given object. &nbsp;,</li>
</ul>
<p>The ObjectFactoryLoader gets the text string from ObjectFactoryAttribute - and the ObjectFactoryAttribute constructor that accepts <em>typeof(interface)</em> will actually use the fully qualified name of the interface. So this name is sent to the&nbsp;ObjectFactoryLoader to return an instance of the actual class that the DataPortal will call. </p>
<p>This is implemented in the MefFactoryLoader - that may be altered to use another container - my implementation just loads the available types from the bin folder - assuming that only the relevant assemblies is present at the given time. </p>
<p>So - anything that needs&nbsp;MEF&nbsp;container must be handled inside the implementation of ObjectFactoryLoader and must also &quot;build&quot; the imports of the actual class before it is returned to the data portal. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
