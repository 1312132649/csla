<html><header><title>Authorization Rules on List to create child object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Authorization Rules on List to create child object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11059.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>crackity_jones666 posted on Friday, January 13, 2012</h2><p>Hello...</p>
<p>How about this typical situation</p>
<p>&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">Child</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessBase</span>&lt;<span style="color:#2b91af;">Child</span>&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">ChildList</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessListBase</span>&lt;<span style="color:#2b91af;">ChildList</span>,&nbsp;<span style="color:#2b91af;">Child</span>&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">Parent</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessBase</span>&lt;<span style="color:#2b91af;">Parent</span>&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:#2b91af;">PropertyInfo</span>&lt;<span style="color:#2b91af;">ChildList</span>&gt;&nbsp;ChildProperty&nbsp;=<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegisterProperty&lt;<span style="color:#2b91af;">ChildList</span>&gt;(o&nbsp;=&gt;&nbsp;o.Children);<br /> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">ChildList</span>&nbsp;Children<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span>&nbsp;{&nbsp;<span style="color:blue;">return</span>&nbsp;GetProperty(ChildProperty);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span>&nbsp;{&nbsp;SetProperty(ChildProperty,&nbsp;<span style="color:blue;">value</span>);&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>As an example, I would like to create an authorization rule that forbids the addition of more than 1 child in the child list.</p>
<p>From what I know, I would not be&nbsp;able to add a CreateObject custom authorization rule on the Child class as I would not receive the target on the Execute method (quite normal, the instance would not&nbsp;be created yet).</p>
<p>I know that I could create a validation rule, but I want the action to be blocked right away.&nbsp; </p>
<p>In fact,&nbsp; my main objective is to bind an &quot;Add a child&quot;&nbsp;button availability on the CanAddNew property of the ViewModelBase, as this property is linked to the CreateObject authorization rule...</p>
<p><span style="color:blue;">if</span> (Csla.Rules.<span style="color:#2b91af;">BusinessRules</span>.HasPermission(Rules.<span style="color:#2baf9a;">AuthorizationActions</span>.CreateObject, itemType) &amp;&amp; !isObjectBusy) CanAddNew = <span style="color:blue;">true</span>;<span style="color:blue;">else</span> CanAddNew = <span style="color:blue;">false</span>; </p>
<p>One other option that I could have is to create a public method on the ChildList and override the CanExecute method.&nbsp; Unfortunatly, no CanExecute method exists on BusinessListBase.</p>
<p>Is there any hope for such a wish?</p>
<p>Thanks in advance!</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, January 13, 2012</h2><p>Hi,</p>
<p>Already in the wish list: <a title="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=945" href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=945">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=945</a> </p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>crackity_jones666 replied on Monday, January 16, 2012</h2><p>Thanks!</p>
<p>Any workaround suggested while waiting for this implementation?&nbsp;I tried with a CanWrite Autz rule on the parent class to fullfill my need for now, but the result may differ with the action I wan&#39;t to do (Add a new child vs. modify a child).</p>
<p>Thanks for your time...</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Monday, January 16, 2012</h2><p>For now - until this is supported by Authz rules in CSLA, I would recommend the following solution:</p>
<pre style="font-family:Consolas;background:#fafafa;color:black;font-size:13px;">&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">ChildList</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessListBase</span>&lt;<span style="color:#2b91af;">ChildList</span>,&nbsp;<span style="color:#2b91af;">Child</span>&gt;
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:#2b91af;">Child</span>&nbsp;AddNewCore()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(!CanAddChild())&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">SecurityException</span>(<span style="color:#a31515;">&quot;Cannot&nbsp;add&nbsp;child&nbsp;object&nbsp;to&nbsp;list.&quot;</span>);
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">base</span>.AddNewCore();
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">bool</span>&nbsp;CanAddChild()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">this</span>.Count&nbsp;==&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}</pre>
<pre style="font-family:Consolas;background:#fafafa;color:black;font-size:13px;">&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">ChildViewModel</span>&nbsp;:&nbsp;<span style="color:#2b91af;">ViewModel</span>&lt;<span style="color:#2b91af;">ChildList</span>&gt;
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;OnSetProperties()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">base</span>.OnSetProperties();<br /><br />      if (this.Model != null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   CanAddNew&nbsp;=&nbsp;CanAddNew&nbsp;&amp;&amp;&nbsp;<span style="color:blue;">this</span>.Model.CanAddChild();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}</pre></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>crackity_jones666 replied on Monday, January 16, 2012</h2><p>Thanks!</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
