<html><header><title>CslaDataProvider broke when updated to 3.6.3</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CslaDataProvider broke when updated to 3.6.3</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7186.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Turntwo posted on Saturday, June 27, 2009</h2>I have a bit of code where I create a CslaDataProvider in code behind.&nbsp; In this case the _init flag is set to true as soon as I instantiate the object, and doesn't seem to change to false when I set the values for the CslaDataProvider, so when I try to Refresh to get the data, nothing happens.&nbsp; This worked before the upgrade to 3.6.3 ( which makes sense since the _init flag was just introduced).&nbsp; <br><br>Code:<br>CslaDataProvider comboListProvider = new CslaDataProvider();<br>comboListProvider.ObjectType = uiProperty.ComboBoxList; // This is a NameValueList type<br>comboListProvider.FactoryMethod = "GetValueList";<br>comboListProvider.DataChanged += new EventHandler(provider_DataChanged);<br>comboListProvider.Refresh();<br><br>The provider works fine where I have defined it in XAML.&nbsp; <br><br>I've tried various things to get this to work, including calling InitialLoad(), using DeferRefresh, Refresh()ing and then changing Property values, etc.&nbsp; Nothing affected the _init value.&nbsp; <br>I've also tried setting the Properties when I instantiate the object using {} syntax.&nbsp; It doesn't help.&nbsp; <br><br>So far the only way I've gotten this to work is using reflection to call EndInit, which is an undesirable solution for obvious reasons.&nbsp; <br><br>This appears to be an introduced bug, but please let me know if I'm just not doing something right. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, June 28, 2009</h2><P>I am open to suggestions.</P>
<P>When used through XAML, BeginInit() and EndInit() are called, and those appear to be the only reliable way to know that the control is being initialized. And during initialization the XAML processing would otherwise trigger data retrieval when we don't want it to occur - which was the reason for adding the _init flag (to stop double-retrieval of data).</P>
<P>If you manually create an instance of the control and don't do what the WPF runtime does (calling those two methods) I'm not sure how the control can know the difference?</P>
<P>I suppose I could add a constructor overload that accepts a dummy parameter so you could call that other constructor and the control would know to set _init to true right away. But that's a magic cookie solution that would be a real hack/mess.</P>
<P>var dp = new CslaDataProvider(true); // true indicates we're skipping the init process</P>
<P>That seem really bad to me - so I'm open to suggestions for a better answer.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Turntwo replied on Monday, June 29, 2009</h2>If the methods were public, then I could just call them, and mimic the behavior of the XAML, but they are protected.&nbsp; <br><br>_init is initialized to true, but then also set to true in BeginInit.&nbsp; Could _init be initialized to false, and then when the CslaDataProvider is instantiated in code it will remain false, but when instantiated in the XAML it will run BeginInit to set it to true and EndInit to set it back to false?&nbsp; <br><br>I tried this, and it works, but I'm not sure if it breaks the reason for the _init flag in the first place.&nbsp; I wouldn't expect it to, since in the XAML case BeginInit and EndInit are called around the BeginQuery call, and so the data retrieval wouldn't be triggered.&nbsp; I'm not sure though, because I only get a single call to BeginQuery even in the XAML case - the _init flag is false (so it works, but not sure if I'm breaking something else).&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 29, 2009</h2><P>If I recall correctly, the double-call scenario occurs when there's an exception in the data access. Yes, I'm pretty sure that was the problem - an exception in data access would cause the data provider to be re-invoked, so the user would see two error dialogs as the form loaded.</P>
<P>Can you try your change with an exception generated in the DAL during create/fetch?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Turntwo replied on Monday, June 29, 2009</h2>I tested the change with an exception generated in Fetch for a CslaDataProvider created in XAML and through code-behind, in both cases I only received a single error message.&nbsp; I'm going to go ahead with the change in my environment.&nbsp; Thanks for the help.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 29, 2009</h2>Thanks for helping work through this. I'll add this as a change request to the task list.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
