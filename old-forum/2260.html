<html><header><title>EditableRootListBase problem on second update</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditableRootListBase problem on second update</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2260.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ivan posted on Thursday, February 01, 2007</h2><P>I have noticed posible problem whit EditableRootListBase (dynamic collection). I have EditableRootListBase with some items bind to grid on form. If I update some of those item they get updated in database immediatly. If I try to update them again nothing happens (only if using remote data portal).</P>
<P>Since I'm using CSLA for some thime I tried to see what is going on and notice that items in Dynamic colelction have EditableRootListBase collection&nbsp;as a parent before first update (and after insert) but during second update their parent is null and they don't get saved (updated). CSLA is 2.1.2.</P>
<P>I have pinpointed this&nbsp;problem to the&nbsp;foloving method in EditableRootListBase:</P>
<P><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>virtual</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>void</FONT><FONT size=2> SaveItem(</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> index)<BR></FONT><FONT size=2>{<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;bool</FONT><FONT size=2> raisingEvents = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.RaiseListChangedEvents;<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;this</FONT><FONT size=2>.RaiseListChangedEvents = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;_activelySaving = </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;T item = </FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>[index];<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;int</FONT><FONT size=2> editLevel = item.EditLevel;<BR><BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// commit all changes<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;for</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> tmp = 1; tmp &lt;= editLevel; tmp++)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.AcceptChanges();<BR><BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>try<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// do the save<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>[index] = (T)item.Save();<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>finally<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>{<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#008000 size=2>// restore edit level to previous level<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>for</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> tmp = 1; tmp &lt;= editLevel; tmp++)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.CopyState();<BR><BR>&nbsp;&nbsp;&nbsp;_activelySaving = </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.RaiseListChangedEvents = raisingEvents;<BR>&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>.OnListChanged(</FONT><FONT color=#0000ff size=2>new</FONT><FONT size=2> </FONT><FONT color=#2b91af size=2>ListChangedEventArgs</FONT><FONT size=2>(</FONT><FONT color=#2b91af size=2>ListChangedType</FONT><FONT size=2>.ItemChanged, index));<BR></FONT><FONT size=2>}</FONT></P>
<P><FONT size=2><FONT size=3>After </FONT><FONT size=2><FONT color=#0000ff>this</FONT>[index] = (T)item.Save() <FONT size=3>item looses parent becuse it isn't returned from remote dataportal and during folowing updates, because of chek for parent in BusinessBase.AcceptChangesComplete where it is null, nothing hapens. I have added <FONT color=#0000ff size=2>this</FONT><FONT size=2>[index].SetParent(</FONT><FONT color=#0000ff size=2>this</FONT><FONT size=2>); </FONT>after&nbsp;<FONT size=2><FONT color=#0000ff>this</FONT>[index] = (T)item.Save()&nbsp;</FONT> to set parent for updated item and everything seems to works OK. </FONT></FONT></FONT><FONT size=2></P></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
