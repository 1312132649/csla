<html><header><title>Mulitple record sets problem</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Mulitple record sets problem</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3859.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff posted on Wednesday, November 07, 2007</h2>Hi<br><br>I am having problems writing t-sql to return multiple records sets in a stored procedure so I can populate by BO with child objects. In the project tracker we have<br><br>ALTER PROCEDURE [dbo].[getProject]<br>&nbsp;&nbsp;&nbsp; (<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; @id uniqueidentifier<br>&nbsp;&nbsp;&nbsp; )<br>AS<br>&nbsp;&nbsp;&nbsp; SELECT Id,Name,Started,Ended,Description,LastChanged<br>&nbsp;&nbsp;&nbsp; FROM Projects <br>&nbsp;&nbsp;&nbsp; WHERE Id=@id<br><br>&nbsp;&nbsp;&nbsp; SELECT ResourceId,LastName,FirstName,Assigned,Role,Assignments.LastChanged AS LastChanged<br>&nbsp;&nbsp;&nbsp; FROM Resources,Assignments <br>&nbsp;&nbsp;&nbsp; WHERE ProjectId=@id AND ResourceId=Id<br>&nbsp;&nbsp;&nbsp; RETURN<br><br><br>I assume the last part &lt;ResourceId=Id&gt; the Id part is taken from the first SELECT statement.<br>I have tried to replicate this, different tables, but can't save the st. proc as it errors saying 'Invalid column name'&nbsp; Here is my sql snippet:<br><br>select JobID,jobtypeid,.........,........ &nbsp;&nbsp; FROM [dbo].[tblJobs] <br>WHERE<br>&nbsp;&nbsp;&nbsp; [JobID] = @ID <br><br>select jobid, jobdate,........... from tbljobdates where tbljobdates.jobid=jobtypeid<br><br>So I want the second record set to select records based on the value of the 'jobtypeid' returned form the first select statement.<br><br>Can anyone provide help directly on this and/or general t-sql regarding referencing fields/data from other areas in the t-sql (either direct help or internet site resource)<br><br>Many thanks<br>Richard<br><br><br><br><br><br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Wednesday, November 07, 2007</h2><font face="Arial"><font size="2">Richard,<br><br>The second SELECT statement is completely idependent of the first one, you have to determine the link between the two records. The two queries in the project tracker are looking at completly different things (one is projects and the other is the reources &amp; assignments; linked by the passed value of @ID).<br><br>To get what you want (i.e. second statement to be filtered by the value jobtypeid from your first query) you would need to something like this:<br><br><font face="Courier New">SELECT JobID, JobTypeId FROM tblJobs<br>WHERE JobId = @ID<br><br>SELECT JobId, JobDate FROM tblJobDates<br>JOIN tblJobs ON </font></font></font><font face="Courier New" size="2">tblJobDates.</font><font face="Arial"><font size="2"><font face="Courier New">JobTypeId</font></font></font><font face="Courier New" size="2"> = tblJobs.JobTypeId <br>AND </font><font face="Courier New"><font size="2">tblJobs.</font></font><font face="Courier New"><font size="2">JobId = @</font></font><font face="Arial"><font size="2"><font face="Courier New">ID</font></font></font><font face="Courier New"><font size="2"><br><br><font face="Arial">Or you could put the value of JobTypeId into a variable in the stored proc and then use this, check out some SQL reference material on how to do that, looks something like (of the top of my head):<br></font><br></font></font><font face="Arial"><font size="2"><font face="Courier New">SELECT JobID, @JobTypeId = JobTypeId FROM tblJobs<br>
WHERE JobId = @ID<br>
<br>
SELECT JobId, JobTypeId, JobDate FROM tblJobDates<br></font></font></font><font face="Courier New"><font size="2">WHERE </font></font><font face="Courier New" size="2">tblJobDates</font><font face="Courier New"><font size="2">.</font></font><font face="Arial"><font size="2"><font face="Courier New">JobTypeId</font></font></font><font face="Courier New"><font size="2"> = </font></font><font face="Courier New"><font size="2">@</font></font><font face="Arial"><font size="2"><font face="Courier New">JobTypeId </font></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>griff replied on Wednesday, November 07, 2007</h2>Marjon<br>thanks for the reply, it's late now.......so I'll pick this up tomorrow and get back<br>Richard<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
