<html><header><title>Databinding woes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Databinding woes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1730.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Thursday, November 09, 2006</h2>Hi,<br><br>I have a combobox.&nbsp; It allows a user to pick a selection from the list, or type in data.<br><br>The Value is bound to my business object, which exposes an integer property.&nbsp; I do some trickery in the event handlers so that if the user types something not in the list, the Id is set to int.MaxValue to 'trick' the BO into thinking is valid (the BO has a rule stating the int must be &gt; -1).<br><br>Everything works fine...except I can open the list, close it by clicking the down arrow again.&nbsp; Then, when I attempt to move off, my ErrorProvider blinks and says 'Cant convert System.DBNull to System.Int32'&nbsp; Now, I DO set the Null Value in the advanced options of the combobox's Databindings to -1.<br><br>Does anyone know why databinding is still trying to force DBNull into my int property, even though I told it the value to use?&nbsp; My TextChanged and SelectedIndexChanged events for the combo don't fire either.<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, November 09, 2006</h2>The NullValue is just the value that gets displayed in the control in case the user types an empty string or a null-value, the <u>DataSourceNullValue</u> is the one pushed to your BO .....<br><br>Is usually set the NullValue to something like '&lt;Select&gt;' to indicate nothing was selected yet.<br><br>The DataSourceNullValue is set to DBNull by default, so I guess that when you set it to Integer.MaxValue all should be fine.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, November 10, 2006</h2>Ok, where do I set the DataSourceNullValue?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Friday, November 10, 2006</h2>Hi Andy,<br><br>The following gives the idea:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim binding As New Binding("SelectedValue", someBindingSource, somePropertyInfo.Name, True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding.DataSourceUpdateMode = DataSourceUpdateMode.OnPropertyChanged<br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding.DataSourceNullValue = Guid.Empty<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding.NullValue = "&lt;Select&gt;"<br></b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim combo As New ComboBox<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; combo.DropDownStyle = ComboBoxStyle.DropDown<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; combo.DataBindings.Add(binding)<br><br>In addition you would set the DataSource of the combobox to some list that contains the values you want the user to choose from.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; combo.DataSource = someDataSource<br>
<br>Having the combobox setup like this will yield the following behavior:<br>- empty values will result in a Guid.Empty being pushed to your BO behind the databinding<br>- and the combobox will display the text '&lt;Select&gt;' to notify that a selection still needs to be made<br>- the DataSourceUpdateMode.OnPropertyChange is something I use sometimes to ensure that the values are pushed to the BO already upon Change, instead of only after the user leaves (and thereby validates) the comobobox.<br><br>Bayu<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, November 10, 2006</h2>Bayu,<br><br>Thanks for the tip.&nbsp; I'll check that out..&nbsp; Its odd that you can't set that via the designer somehow.<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Friday, November 10, 2006</h2>You're welcome. ;-)<br><br>I too only got to find this out because IntelliSense popped it up in the list. Much of the more advanced stuff is hidden from the Designer, just to make life 'easy' I guess ..... <img src="/emoticons/emotion-7.gif" alt="Tongue Tied [:S]" /><br><br>Hope it works.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, November 10, 2006</h2>Bayu,<br><br>I made the changes you suggested, and it looks like its working perfectly.&nbsp; <br><br>It is a shame its not in the designer, espcially since NullValue is, and I (incorrectly) thought NullValue was what I wanted to change... so it was misleading.<br><br>Thanks again!<br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
