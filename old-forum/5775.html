<html><header><title>BO listening to another BO's Saved event?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BO listening to another BO's Saved event?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5775.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, November 10, 2008</h2>Hi,<br><br>Does anyone see any problems with a BO listening to the Saved event from another BO?&nbsp; I'm talking about two root objects which are editable.<br><br>This is the scenario:<br>A part can be edited, but to adjust inventory another BO is needed.&nbsp; (Changes are recorded as new rows, which are summed back to the original record at the end of the month).&nbsp; To do this, the Part BO creates an instance of the adjuster BO which is edited in a second screen.&nbsp; When the adjuster is saved, the original part BO needs to update it's quantity property (which is read only for the user); how it does this I'm not concerned about at this point.<br><br>I'm specifically thinking about the Part BO being serialized when the adjuster is saved, or memory leaks because the event handler is listening to the "old" adjuster BO.<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, November 11, 2008</h2><P>I have a very similar use case and was unsure exactly how to handle it. </P>
<P>What I did was to actually make the Adjust BO an optional&nbsp;"child" object of the Part BO to handle the case where both are being edited at the same time. </P>
<P>When the Part BO saves itself, it looks to see if it has an Adjust BO. If so, it saves the Adjust BO and then changes its own&nbsp;quantity property. </P>
<P>An Adjust BO can be used by itself also, in which case the corresponding Part BO will pick up the quantity change the next time it is read from the database. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 11, 2008</h2>Thanks for the feedback.<br><br>My use case is a bit different; it's entirely possible that a user has permissions to be able to adjust the inventory but not ever edit the actual part itself.<br><br>I think I figured out how to do this.. by not doing it.&nbsp; <br><br>Instead, the two BOs are separated, and I added a RefershInventory method to the part BO.&nbsp; This can be called via a timer or after the Adjust Inventory window closes.&nbsp; I'm not sure it's the part BO's job to make sure it always has the correct value, but providing a way to refersh that value seems like an acceptable responsiblity.&nbsp; <br><br>This way I don't need to worry about event handlers and memory leaks, and the Refersh method I created to be thread safe.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Tuesday, November 11, 2008</h2><P>Interesting, because I have the same possible permissions limitation and hadn't stumbled over that yet. </P>
<P>I oversimplified my description above -- what the Part BO would do was actually refresh itself from the database, much like what you are doing. </P>
<P>As an aside, this general class of problem&nbsp;was, by far, the&nbsp;most difficult legacy&nbsp;use case we had to shoe-horn into the CSLA editing model. We also&nbsp;write&nbsp;out a transaction record of the inventory adjustment, and the user might even have selected a "reason code" or comment&nbsp;to go with the transaction. The adjustment might have also required adjustment to other records (e.g. decrement available quantity for a lot number, "burn" quantity when consignment inventory was involved, etc. </P>
<P>Since all of this had to occur in the same database transaction as the actually quantity adjustment, a switchable child Adjust&nbsp;BO seemed like one&nbsp;way to make it work. </P>
<P>The legacy application would (Gasp!!) actually hold the database transaction open while&nbsp;a confirmation prompt for the reason code, comment, etc.&nbsp;for the quantity change was sitting there in front of the user.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, November 11, 2008</h2>Wow, I'm really glad I posted this, because what you've done sounds very similar to what I'm doing, including writing a separate adjustment record to the database complete with reason!<br><br>That legacy application just sounded like a bad hack.. I bet they were happy to be rid of it.<br><br>I'll be sure to post more questions like these as they come up.. and hope you notice them!<br><br>Andy<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
