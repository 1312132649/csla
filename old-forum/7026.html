<html><header><title>Non-Generic Base class</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Non-Generic Base class</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7026.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jeff Carley posted on Monday, June 01, 2009</h2>I'm sure there have been plenty of posts about this, but I can't seem to find exactly what I'm looking for.  The situation is, I have a abstract base class that uses managed backing fields.  From that, I have several derived classes that use that same base class.  For example:<br /><br />Course --> ProjectBase<br /><br />Program --> ProjectBase<br /><br />The two derived classes (in this example, Course and Program) also use managed backing fields.  I need the ProjectBase base class to be non-generic so that I may reference it in any given situation.  For example.<br /><br />ProjectBase prj = null;<br />if(expession)<br />    prj = Course.NewCourse();<br />else<br />    prj = Program.NewProgram();<br /><br /><br />The problem I'm having is that on one instance expression may be true and a new Course class is instantiated.  No problem there.  But on the next iteration of this code, expression is false, and I'll need to instantiate a new Program class.  Thats where the problem happens.  I get an error saying that the type initializer failed for the class Program.  It won't let me Register the properties for Program because the base class ProjectBase has already been initialized.  The exact code I'm executing to get this error is simple:<br /><br />ProjectBase proj2 = Course.NewCourse();<br /><br />ProjectBase proj1 = Program.NewProgram();<br /><br />The error I get after executing the above code is:<br /><br />{"Can not register property ProgramID after containing type (ProjectBase) has been instantiated"}<br /><br />ProgramID is a field from the Program class.<br /><br />I've included the StackTrace as well if it is any help.<br /><br />   at Csla.Core.FieldManager.PropertyInfoManager.RegisterProperty[T](Type objectType, PropertyInfo`1 info)<br />   at Csla.BusinessBase`1.RegisterProperty[P](PropertyInfo`1 info)<br />   at MyProject.Entities.Program..cctor() in Program.cs:line 15<br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jeff Carley replied on Monday, June 01, 2009</h2>Update:  Overriding GetIdValue on ProjectBase causes the error.  Why does this happen?  But there is still something else going on.  I comment that code out, and I still get the error.<br /><br />More:  Here's how to duplicate the error.<br /><br />ProjectBase proj2 = OrgInfo.NewOrgInfo();    // works fine<br /><br />ProjectBase proj1 = Program.NewProgram();  // works fine<br /><br />proj2.Description = "Project description";  // comment this line out and the error goes away<br /><br />ProjectBase proj3 = Course.NewCourse();  // error</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jeff Carley replied on Monday, June 01, 2009</h2>Solution.<br /><br />Thought I'd share the solution.  I had to add the typeof(...) to each Register property for the concrete classes.  For example:<br /><br />public class Course : ProjectBase<br />{<br />        private static PropertyInfo CourseIdProperty = RegisterProperty(typeof(Course), new PropertyInfo("CourseId", "Course Id"));<br />        public Guid CourseId<br />        {<br />            get { return GetProperty(CourseIdProperty); }<br />        }<br /><br />}<br /><br />This fixed the issue.  Another approach I found was to make ProjectBase generic and add an IProject interface.  Then I could reference the IProject interface.  But this approach was much more advasive and then presented problems like not having the BusinessBase methods available to you.  Anyway, I've included a link to the post that finally got me going in the right direction.<br /><br />http://forums.lhotka.net/forums/thread/31674.aspx<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, June 02, 2009</h2>You may want to revisit the interface approach.  You can have an interface "inherit" another interface so you get most of the BB functionality. So if you did this, you might get what you want:<br /><br />public interface IProject : IEdtiableBusinessObject { // Other Csla interfaces, if needed<br />  // your definition here<br />}</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
