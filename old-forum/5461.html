<html><header><title>How to delete grandchild?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How to delete grandchild?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5461.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tchimev posted on Thursday, September 25, 2008</h2>I have design my business objects like this:<br>BLB parent<br>-------BB child<br>------------BB grandchild<br>------------BB grandchild<br><br>When I call BLB.Remove(index), my BB child is marked for deletion and on BLB.Save() it is deleted, but my grandchildren are not marked for deletion.<br>How shoud I mark my grandchild for deletion?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, September 25, 2008</h2><P>Looking at the PTracker sample app you can see a different approach. There you have:</P>
<P>BB (Project)<BR>------BLB (Resources)<BR>------------BB (Resource)</P>
<P>When a Project is marked for deletion, you are not deleting all the children. The idea (if I remember well) is that when you delete an "entity" from your database, it is better to put all the logic for marking all the related child records for deletion (or physically deleting them if you really want). There is no real need to mark the children (all Resource in Resouces) as deleted.</P>
<P>Saying that, if you really want to mark all your child objects as deleted I guess one way is to override Delete(). Not sure this will work in your scenario (since your root is a BLB) but the idea would be to mark all your child objects for deletion manually, the same way that in CSLA 3.0.x you have to override IsValid and IsDirty.</P>
<P>Hope this makes sense.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tchimev replied on Thursday, September 25, 2008</h2>If I understand right,<br>one way is to delete my grandchildren physically in the Child_DeleteSelf() method of my child object or<br>override my grandchild Delete() method, so I can mark it for deletion in the Child_DeleteSelf() method of my child object.<br><br>But if I do not want my child to physically delete his children and <br>I know it is a bad practice to call Delete() directly on the child object, are there other ways to delete grandchildren?<br><br>If someone else has something to add to this <span id="ctl00_ctl01_bcr_Threadview1___Threads_ctl00_Resourcelabel5">thread</span>, I'll be grateful.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, September 25, 2008</h2><P>Here is a sample region for my DataPortal_Delete code. It includes hooks for deleting children. (And anything else that needs to be deleted too. Like messages, misc linked records, etc.) There is some non-CSLA code here but I have shared most of it before. You should be able to get the whole idea from reading this code.</P>
<P>===================================================================</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overrides</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> DataPortal_DeleteSelf()<BR>&nbsp; DataPortal_Delete(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>New</FONT></FONT><FONT size=2> CriteriaCode(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>GetType</FONT></FONT><FONT size=2>(SomeBO), </FONT><FONT color=#ff00ff size=2><FONT color=#ff00ff size=2>"DataPortal_DeleteSelf"</FONT></FONT><FONT size=2>, mID))<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overrides</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> DataPortal_Delete(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Object</FONT></FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Dim</FONT></FONT><FONT size=2> user </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> MyUser<BR>&nbsp; user = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>DirectCast</FONT></FONT><FONT size=2>(Thread.CurrentPrincipal, MyUser)<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2><BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Dim</FONT></FONT><FONT size=2> crit </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> CriteriaCode = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>DirectCast</FONT></FONT><FONT size=2>(criteria, CriteriaCode)<BR>&nbsp;&nbsp;<FONT color=#0000ff>Dim</FONT><FONT size=2> strSQL </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>String</FONT></FONT></FONT><FONT size=2> = MyDAO.Delete(crit.Code)<BR>&nbsp;</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2> Dim</FONT></FONT><FONT size=2> tr </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> IDbTransaction = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Nothing</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp; Try<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>tr = </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.BeginTransaction()<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'Delete child objects before deleting the parent. <BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>DeleteChildren(tr, criteria)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'delete the parent<BR>&nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=2>DAL.ExecuteNonQuery(tr, CommandType.Text, strSQL)<BR>&nbsp;&nbsp;&nbsp; PostDeleteData(tr, user)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.EndTransaction(tr)<BR>&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Catch</FONT></FONT><FONT size=2> ex </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> Exception<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Me</FONT></FONT><FONT size=2>.RollbackTransaction(tr)<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Throw<BR>&nbsp; </FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Try<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> DeleteChildren(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> tr </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> IDbTransaction, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Object</FONT></FONT><FONT size=2>)<BR>&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'marker method that can be overridden in&nbsp;derived class<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Protected</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Overridable</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</FONT></FONT><FONT size=2> PostDeleteData(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> tr </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> IDbTransaction, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>ByVal</FONT></FONT><FONT size=2> user </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>As</FONT></FONT><FONT size=2> MyUser)<BR>&nbsp; </FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>'marker method that can be overridden in derived class<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>End</FONT></FONT><FONT size=2> </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>Sub</P></FONT></FONT>
<P>===================================================================</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
