<html><header><title>DTC only being used with remoting?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DTC only being used with remoting?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4032.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Thursday, December 13, 2007</h2>Hi,<br><br>I'm trying to track down an odd problem.&nbsp; I am trying to switch to remoting, and for the most part things are fine.&nbsp; I'm having problems during a save of a specific business object though.&nbsp; The object has Company and Department as strings.&nbsp; If the company does not exist in my CompanyList, it creates a new company, and asks the cached version of CompanyList to reload itself.<br><br>Doing so causes DTC to jump in for some reason on the server.&nbsp; Yet I can disable the DTC service on my workstation (Vista) and the save performs just fine.&nbsp; But for some reason while the remoted code is running on Win2k3 server hosted by IIS, DTC wants to start but since its disabled on the server as well, the whole transaction fails.<br><br>Any ideas why this would seem to happen?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 14, 2007</h2>No one has any ideas?&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 14, 2007</h2><P>I assume you are using the TransactionScope option on your dp_update method?</P>
<P>And in this scenario you are opening 2+ database connections within the context of the dp_update?</P>
<P>That <EM>would</EM> trigger the DTC, and should in both environments.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 14, 2007</h2>Yes, I'm using TransactionScope.&nbsp; I'm only opening one connection, as far as I can tell.&nbsp; I'm inclined to believe I'm not opening more than one, since DTC is disabled and not running in all configurations I test (both on the client and the server).<br><br>With DTC disabled on both cilent and server, the code runs fine in 2-tier mode, but enabling remoting the server starts complaining about DTC being disabled.<br><br>What's worse, is that I can run the application via ClickOnce on the server, by xcopying to the server and running causes an immediate crash.. something to do with partiallytrustedcallers.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 14, 2007</h2>Ok.&nbsp; I setup the Clickonce application to run without remoting, and this launched on the server.&nbsp; DTC is a disabled service on the server.&nbsp; The save works fine.. so it always works fine in 2-tier mode with DTC disabled, but not with 3-tier mode.<br><br>I'm at a loss on this one.. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 14, 2007</h2>I have no idea to be honest. Clearly there's something different in your data portal host process that is somehow triggering the DTC - which implies that there's a second resource manager getting involved in there somewhere. Or that your connection string is somehow different and that is triggering it?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, December 14, 2007</h2>I finally figured this out.&nbsp; My DP_I was closing the connection, but in the BO I had code in OnDataPortalCompleted which attempted to refresh the list.&nbsp; This would then open a second connection, causing the error.&nbsp;&nbsp; Also, since this code only executed if the ExecutionLocation was Server (and in 2-tier, it never is) it only showed up when I turned on remoting.&nbsp; I never thought to check OnDataPortalCompleted, because 1) I forgot about the code there and 2) I didn't think that would be covered under the transaction.<br><br>Changing the server code to just invalid the list (the refresh is for UI only, to update any combos which have a list of companies) fixes the issue.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
