<html><header><title>CSLA 1.3 Remoting Question...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 1.3 Remoting Question...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5458.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>craig posted on Wednesday, September 24, 2008</h2>I have spent the last several years on a team developing an application using CSLA.&nbsp; When we started, CSLA 1.3 was the latest (and .NET Framework 1.1) and we are still using these versions (it would be a major undertaking to upgrade to the latest versions at this point, though we intent to do it eventually).&nbsp; Early on, we did some tests using the remote data portal with good results, however, when I got a round to trying it again over the last couple of days, I am running into a remoting error.&nbsp; I thought it might make sense to ask if anyone has seen this one before.<br><br>I configure the remote data portal just as described in Rocky's book with no problems, and I am able to generate the wsdl results using a browser.&nbsp; However, when I try to access the DB from the client, I receive the following error...<br><br>1) Exception Information<br>*********************************************<br>Exception Type: System.Runtime.Serialization.SerializationException<br>Message: Because of security restrictions, the type CSLA.Server.DataPortalContext cannot be accessed.<br>TargetSite: System.Object GetSafeUninitializedObject(System.Type)<br>HelpLink: NULL<br>Source: mscorlib<br><br>StackTrace Information<br>*********************************************<br><br>Server stack trace: <br>&nbsp;&nbsp; at System.Runtime.Serialization.FormatterServices.GetSafeUninitializedObject(Type type)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectReader.ParseObject(ParseRecord pr)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectReader.Parse(ParseRecord pr)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.__BinaryParser.ReadObjectWithMapTyped(BinaryObjectWithMapTyped record)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.__BinaryParser.ReadObjectWithMapTyped(BinaryHeaderEnum binaryHeaderEnum)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.__BinaryParser.Run()<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize(HeaderHandler handler, __BinaryParser serParser, Boolean fCheck, IMethodCallMessage methodCallMessage)<br>&nbsp;&nbsp; at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream serializationStream, HeaderHandler handler, Boolean fCheck, IMethodCallMessage methodCallMessage)<br>&nbsp;&nbsp; at System.Runtime.Remoting.Channels.CoreChannel.DeserializeBinaryRequestMessage(String objectUri, Stream inputStream, Boolean bStrictBinding, TypeFilterLevel securityLevel)<br>&nbsp;&nbsp; at System.Runtime.Remoting.Channels.BinaryServerFormatterSink.ProcessMessage(IServerChannelSinkStack sinkStack, IMessage requestMsg, ITransportHeaders requestHeaders, Stream requestStream, IMessage&amp; responseMsg, ITransportHeaders&amp; responseHeaders, Stream&amp; responseStream)<br><br>Exception rethrown at [0]: <br>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)<br>&nbsp;&nbsp; at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)<br>&nbsp;&nbsp; at CSLA.Server.DataPortal.Fetch(Object Criteria, DataPortalContext context)<br>&nbsp;&nbsp; at CSLA.DataPortal.Fetch(Object Criteria)<br>&nbsp;&nbsp; at CSLA.Security.BusinessIdentity.LoadIdentity(String UserName, String Password)<br>&nbsp;&nbsp; at CSLA.Security.BusinessPrincipal..ctor(String Username, String Password)<br>&nbsp;&nbsp; at CSLA.Security.BusinessPrincipal.Login(String Username, String Password)<br><br>Both of the CSLA data portal assemblies are strongly named, but I notice that the CSLA.dll assemby is not strongly named.&nbsp; Could this be the problem?&nbsp; Can anyone think of anything else I might want to take a look at?<br><br>One other question...<br><br>Has anyone had good results using remoting over the internet?&nbsp; From what I am reading, this should not be a problem.<br><br>If anyone has seen this before and has any input, I would really appreciate it.&nbsp; Thanks!!<br><br>CSLA Rocks!!<br>Craig<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, September 25, 2008</h2><P>but I notice that the CSLA.dll assemby is not strongly named.&nbsp; Could this be the problem?</P>
<P>Yes it could.</P>
<P>In later versions Rocky supplies a .snk file so that people who forget to sign the assembly can at least get started. But you are supopsed to provide your own .snk file as one of the very furst steps, sign and build the Csla.dll and then just include it in yuor projects.</P>
<P>=============================================================</P>
<P>On another note the upgrade from 1.x to 2.x was very difficult. Much more so than I had hoped. We have a large web app and it took 5 developers 5 weeks just to be able to re-compile the app. We found small bugs for months afterwards too.</P>
<P>There are just so many changes (for the better) that need to be accounted for in an upgrade from 1 to 2. Business rules was the biggest issue. Total re-write using new rule methods. Sorting and filtering was another big issue. </P>
<P>The move from 2.x to 3.6 should be completely painless in comparison. I think all I have to fix are the types for AddDependantProperty and it will compile. Then I need to check for breaking changes - like the elimination of GetIdValue and maybe add back the overrides for Equals in my Base classes.</P>
<P>HTH</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>craig replied on Thursday, September 25, 2008</h2>Thanks for the input, Joe.<br><br>I strongly-named all of the CSLA files in the framework, and then replaced the old CSLA files in my solution with the new CSLA assemblies.&nbsp; After a few hours of wrestling with some dependency problems in my solution, I was finally able to compile with no errors.<br><br>I still get a security error when I attempt to conect to the remote data portal, but a slightly different one.&nbsp; Originally, I got the error:<br><br>"Because of security restrictions, the type CSLA.Server.DataPortalContext cannot be accessed."<br><br>Now, I get the error:<br><br>"Because of security restrictions, the type CSLA.Security.BusinessIdentity+Criteria cannot be accessed."<br><br>This leads me to believe that strongly naming the CSLA files was the right thing to do, but that it wasn't enough.&nbsp; Do I need to do this to every assembly in my application???&nbsp; It appears that this might be the case.<br><br>Also, thanks for the feedback on upgrading from version 1 to 2.&nbsp; I suspected that it would be a MAJOR undertaking with so much being different.&nbsp; If only I had started this app using verison 2 instead of version 1.&nbsp; Oh well....it is what it is!<br><br>Once again, thanks for taking the time to offer some input.&nbsp; Its really appreciated.<br><br>Craig<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, September 26, 2008</h2><P>I think strong naming the Csla.dll file is all you need to do. Your own files do not have to be.</P>
<P>Csla does require that it be run in a full trust environment. So if you are using IIS to host the Dataportal then it must be configured to run as full trust. Review your IIS settings for the dataportal and see if you can change something to make it full trust.</P>
<P>Note: this lack of full trust is the main reason Rocky has been putting so much effort into&nbsp;a Silverlight version of Csla. The Csla community will *really* benefit from that effort down the road when Silverlight takes off!</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>craig replied on Monday, September 29, 2008</h2>Thanks again for your input, Joe.&nbsp; I appreciate it.<br><br>After strongly naming all of the assemblies, I did a little research regarding how to set IIS to "Full Trust."&nbsp; It seems that this can be done by adding the following lines to the system.web section of the Web.Config file on the server:<br><br>&nbsp;&nbsp; &lt;securityPolicy&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;trustLevel name="Full" policyFile="internal"/&gt;;<br>&nbsp;&nbsp; &lt;/securityPolicy&gt;<br><br>However, this had lead to another error:<br><br>[ConfigurationException]: Security level already defined for 'Full'. (c:\inetpub\wwwroot\DataPortal\web.config line 119)<br><br>So, the saga continues.&nbsp; The real problem is that I know very little about Windows/IIS security.&nbsp; I am not sure what I am going to have to do to get our app running.<br><br>If I figure it out, I will post the solution!.<br><br>Thanks again,<br>Craig<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>craig replied on Tuesday, September 30, 2008</h2>We finally got our application to run.&nbsp; I thought I would post the solution we found so that others might benefit.<br><br>The changes we had to make:<br><br>1.&nbsp; Strongly name the CSLA assemblies.<br><br>2.&nbsp; Set IIS to Full Trust.&nbsp; In the Control Panel/Administrative Tools/Microsoft .NET Framework 1.1 Configuration tool, click on the "Runtime Security Policy" node and then click on "Adjust Zone Security."&nbsp; Set the Local Intranet zone security level to "Full Trust."<br><br>3.&nbsp; Set the type filter level to "Full" in the web.config file with the following code added to the &lt;application&gt; node:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;channels&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;channel ref="http"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serverProviders&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;provider ref="wsdl" /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;formatter ref="soap" typeFilterLevel="Full" /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;formatter ref="binary" typeFilterLevel="Full" /&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/serverProviders&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/channel&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/channels&gt;<br><br>After making these changes, our CSLA 1.3 application seems to work fine using the remote data portal.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
