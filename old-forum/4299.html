<html><header><title>Rules on a collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Rules on a collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4299.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Tuesday, February 05, 2008</h2>Hi,<br><br>I know this has been brought up before, and I have a problem with a bit different twist.<br><br>Basically, I have a document (a Free of Charge) which must ensure that its total ends up being 0.&nbsp; So I set up a rule on the root Free of Charge document.&nbsp; It listens for its LineItems child BusinessListBase to raise events and then fire the PropertyHasChanged event for the Total property, which the rule is bound.<br><br>The problem is during create; the LineItems needs to know the parent document it belongs to.&nbsp; The problem is that during the creation of the LineItems instance, the LineItems notifies the Document that it needs to check the Total property.&nbsp; Since Total on the document is actualy gotten from the LineItems, and the LineItems has not been constructed (and thus the instance field in Document is still null) I end up with a NullRefException.<br><br>Originally, I didn't have this and relied on just the PropertyChanged to bubble up to the document.&nbsp; The problem with that was that I turn off RaiseListChanged events on LineItems for peformance reasons during adding and removing items.<br><br>So.. what's the best way to handle this?&nbsp; I'm at a loss now..<br><br>Thanks<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stefan replied on Tuesday, February 05, 2008</h2>Couldn't you just hook the ListChangedListener right after the child list has been initialized?<br>This would mean you could not initialize the list at declaration time but would need the Initialize Sub or something similar...<br><br>Or you could create your own ListChangedEventArgs, providing a reference to the list...<br><br>Or you stick with your old solution and just call PropertyHasChanged("whatever") right after each addition/removal of an item...<br><br>Stefan<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, February 07, 2008</h2><P>The list knows which records have been changed.</P>
<P>Don't the rules get checked at save time?</P>
<P>If the list item has a property that is a link to its parent list and also has a rule loops thru the parent list checking the total for the document, wouldn't that do the trick?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, February 07, 2008</h2>Oh, of course, that would also mean you can't save every time a line item is changed, you can only save when a document is "done".</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, February 08, 2008</h2>I fixed this, but maybe not in the best way.&nbsp; If RaiseListChangedEvents is set to true when it was previously false, it immediately raises the list changed event.&nbsp; Works.. but I'm not 100% happy with it.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
