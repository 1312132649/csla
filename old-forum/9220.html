<html><header><title>CSLA 4.0 RC0 Breaking Issues.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4.0 RC0 Breaking Issues.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9220.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski posted on Friday, July 16, 2010</h2><p>Hello,</p>
<p>I recently tried upgrading our CodeSmith samples from CSLA 3.8.4 to CSLA 4.0 and ran into a bunch of unit tests that are no longer working and the code in question hasn&#39;t changed.</p>
<p>The first breaking issue is that LoadProperty throws an exception:</p>
<p>
<div class="output">6.&nbsp;Updating&nbsp;the&nbsp;non&nbsp;Identity&nbsp;Primary&nbsp;Key.<br />&nbsp;&nbsp;&nbsp;&nbsp;Getting&nbsp;lineItem&nbsp;&quot;359&quot;</div>
<div class="exception">Csla.DataPortalException&nbsp;:&nbsp;DataPortal.Fetch&nbsp;failed&nbsp;(Member&nbsp;not&nbsp;found&nbsp;on&nbsp;object&nbsp;(OriginalOrderId))<br />&nbsp;&nbsp;----&gt;&nbsp;Csla.Reflection.CallMethodException&nbsp;:&nbsp;DataPortal_Fetch&nbsp;method&nbsp;call&nbsp;failed<br />&nbsp;&nbsp;----&gt;&nbsp;System.InvalidOperationException&nbsp;:&nbsp;Member&nbsp;not&nbsp;found&nbsp;on&nbsp;object&nbsp;(OriginalOrderId)</div>
<div class="stacktrace">at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">GetCachedProperty</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Type</span></span></span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">propertyName</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallPropertySetter</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">property</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">value</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Core.BusinessBase</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">LoadProperty</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">IPropertyInfo</span></span></span>&nbsp;<span style="color:#000000;">propertyInfo</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">newValue</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">PetShop.Tests.ParameterizedSQL.LineItem</span></span>.<span><span style="color:#008b8b;">Map</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">SafeDataReader</span></span></span>&nbsp;<span style="color:#000000;">reader</span>) in <a>LineItem.DataAccess.cs:&nbsp;line&nbsp;458</a><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">PetShop.Tests.ParameterizedSQL.LineItem</span></span>.<span><span style="color:#008b8b;">DataPortal_Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">LineItemCriteria</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>) in <a>LineItem.DataAccess.cs:&nbsp;line&nbsp;57</a><br />at 
<span style="color:#008b8b;">lambda_method</span>(<span style="color:#00008b;">Closure</span>,&nbsp;<span style="color:#00008b;">Object</span>,&nbsp;<span style="color:#00008b;">Object</span>[])<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">DynamicMethodHandle</span></span></span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>[]&nbsp;<span style="color:#000000;">parameters</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">DynamicMethodHandle</span></span></span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>[]&nbsp;<span style="color:#000000;">parameters</span>)<br />at <span><span style="color:#00008b;">Csla.Server.SimpleDataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Type</span></span></span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">DataPortalContext</span></span></span>&nbsp;<span style="color:#000000;">context</span>)<br />at <span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Type</span></span></span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>)<br />at <span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>)<br />at <span><span style="color:#00008b;">PetShop.Tests.ParameterizedSQL.LineItem</span></span>.<span><span style="color:#008b8b;">GetByOrderId</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Int32</span></span></span>&nbsp;<span style="color:#000000;">orderId</span>) in 
<a>LineItem.Generated.cs:&nbsp;line&nbsp;158</a><br />at 
<span><span style="color:#00008b;">PetShop.Tests.ParameterizedSQL.LineItemTests</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">Step_06_UpdatePrimaryKey</span></span>() in <a>LineItemTests.cs:&nbsp;line&nbsp;256</a></div>
<div class="stacktrace"></div>
<div class="stacktrace">Upon looking into the error. I noticed that some core code was changed in trunk that doesn&#39;t allow for non public properties!!!!</div>
<div class="stacktrace"></div>
<div class="stacktrace">Steps to reproduce:</div>
<div class="stacktrace"></div>
<div class="stacktrace">LoadProperty(_itemIdProperty, 0);</div>
<div class="stacktrace"></div>
<div class="stacktrace"></div>
<div class="stacktrace"></div>
<div class="stacktrace">
<div class="stacktrace">&nbsp;private static readonly PropertyInfo&lt; System.Int32 &gt; _originalOrderIdProperty = RegisterProperty&lt; System.Int32 &gt;(p =&gt; p.OriginalOrderId, string.Empty);</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// Holds the original value for OrderId. This is used for non identity primary keys.</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;/summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;internal System.Int32 OriginalOrderId</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;{</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get { return GetProperty(_originalOrderIdProperty); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set{ SetProperty(_originalOrderIdProperty, value); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</div>
</div>
<div class="stacktrace"></div>
<div class="stacktrace">The second bug is that when you have an EditableRootList and your child is a switchable object. You get the following exception.</div>
<div class="stacktrace"></div>
<div class="stacktrace">
<div class="output">3.&nbsp;Selecting&nbsp;all&nbsp;categories&nbsp;by&nbsp;calling&nbsp;GetByCategoryId(&quot;WJEBQOILVU&quot;).</div>
<div class="exception">Csla.DataPortalException&nbsp;:&nbsp;DataPortal.Fetch&nbsp;failed&nbsp;(List&nbsp;item&nbsp;must&nbsp;be&nbsp;marked&nbsp;as&nbsp;a&nbsp;child&nbsp;object)<br />&nbsp;&nbsp;----&gt;&nbsp;Csla.Reflection.CallMethodException&nbsp;:&nbsp;Fetch&nbsp;method&nbsp;call&nbsp;failed<br />&nbsp;&nbsp;----&gt;&nbsp;System.InvalidOperationException&nbsp;:&nbsp;List&nbsp;item&nbsp;must&nbsp;be&nbsp;marked&nbsp;as&nbsp;a&nbsp;child&nbsp;object</div>
<div class="stacktrace">at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.BusinessListBase`2</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">InsertItem</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Int32</span></span></span>&nbsp;<span style="color:#000000;">index</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">C</span></span></span>&nbsp;<span style="color:#000000;">item</span>)<br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">PetShop.Tests.ObjF.StoredProcedures.DAL.CategoryListFactory</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">CategoryCriteria</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>) in <a>CategoryListFactory.DataAccess.cs:&nbsp;line&nbsp;85</a><br />at 
<span style="color:#008b8b;">lambda_method</span>(<span style="color:#00008b;">Closure</span>,&nbsp;<span style="color:#00008b;">Object</span>,&nbsp;<span style="color:#00008b;">Object</span>[])<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">DynamicMethodHandle</span></span></span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>[]&nbsp;<span style="color:#000000;">parameters</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">DynamicMethodHandle</span></span></span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>[]&nbsp;<span style="color:#000000;">parameters</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Server.FactoryDataPortal</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">InvokeMethod</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">factoryTypeName</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">methodName</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">e</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">DataPortalContext</span></span></span>&nbsp;<span style="color:#000000;">context</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Server.FactoryDataPortal</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Type</span></span></span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>,&nbsp;<span style="color:#00008b;"><span><span style="color:#00008b;">DataPortalContext</span></span></span>&nbsp;<span style="color:#000000;">context</span>)<br />at <span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Type</span></span></span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>)<br />at <span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">Object</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>)<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">PetShop.Tests.ObjF.StoredProcedures.CategoryList</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">GetByCategoryId</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">categoryId</span>) 
in <a>CategoryList.Generated.cs:&nbsp;line&nbsp;70</a><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">PetShop.Tests.ObjF.StoredProcedures.CategoryTests</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">Step_03_SelectAll</span></span>() in <a>CategoryTests.cs:&nbsp;line&nbsp;146</a></div>
</div>
</p>
<h3><b>Please note that these same scenarios and code in question is the exact same from CSLA 3.8.4 and CSLA 4.0 RC0 but RC0 throws an exception!!!</b></h3>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Friday, July 16, 2010</h2><p>1. The LoadProperty change has been redone post RC0 - please grab the current code from svn and see if this issue persists - but it should not, because the non-generic LoadProperty now uses reflection to invoke the generic LoadProperty, instead of invoking the property setter (which it did in RC0).</p>
<p>2 and 3. This is an intentional change to help people avoid bugs that may occur when they add a root object to a BLB collection. BLB is designed to work with child objects, so this change just ensures that only child objects can be added to a BLB.</p>
<p>In other words, your existing code/template probably has a bug where it is creating the &quot;child&quot; object not as a child, and is then adding it to a BLB.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Wednesday, July 28, 2010</h2><p>&nbsp;</p>
<p>Hello,</p>
<p>I just verified that this is still an issue with CSLA 4.0.0.</p>
<p>Here is the exception message I get:</p>
<p>&nbsp;</p>
<div class="exception">Test&nbsp;method&nbsp;TestProject1.UnitTest1.GetClient&nbsp;threw&nbsp;exception:&nbsp;<br />Csla.DataPortalException:&nbsp;DataPortal.Fetch&nbsp;failed&nbsp;(Member&nbsp;not&nbsp;found&nbsp;on&nbsp;object&nbsp;(OriginalOid))&nbsp;---&gt;&nbsp;Csla.Reflection.CallMethodException:&nbsp;DataPortal_Fetch&nbsp;method&nbsp;call&nbsp;failed&nbsp;---&gt;&nbsp;System.InvalidOperationException:&nbsp;Member&nbsp;not&nbsp;found&nbsp;on&nbsp;object&nbsp;(OriginalOid)</div>
<div class="stacktrace">at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">GetCachedProperty</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">propertyName</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;205</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallPropertySetter</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">property</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">value</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;278</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Core.BusinessBase</span></span>.<span><span style="color:#008b8b;">LoadProperty</span></span>(<span style="color:#00008b;">IPropertyInfo</span>&nbsp;<span style="color:#000000;">propertyInfo</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">newValue</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Core\BusinessBase.cs:&nbsp;line&nbsp;2460</span><br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">Map</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">SafeDataReader</span></span></span>&nbsp;<span style="color:#000000;">reader</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;248</a><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">DataPortal_Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">ClientCriteria</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;56</a><br />at 
<span style="color:#008b8b;">lambda_method</span>(<span style="color:#00008b;">Closure</span>,&nbsp;<span style="color:#00008b;">Object</span>,&nbsp;<span style="color:#00008b;">Object</span>[])<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">DynamicMethodHandle</span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;434</span><br />--- End 
of inner exception stack trace ---<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">GetCachedProperty</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">propertyName</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;205</span><br />at 
<span><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallPropertySetter</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">property</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">value</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;278</span><br />at 
<span><span style="color:#00008b;">Csla.Core.BusinessBase</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">LoadProperty</span></span>(<span style="color:#00008b;">IPropertyInfo</span>&nbsp;<span style="color:#000000;">propertyInfo</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">newValue</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Core\BusinessBase.cs:&nbsp;line&nbsp;2460</span><br />at <span><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">Map</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">SafeDataReader</span></span></span>&nbsp;<span style="color:#000000;">reader</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;248</a><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">DataPortal_Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">ClientCriteria</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;56</a><br />at 
<span style="color:#008b8b;">lambda_method</span>(<span style="color:#00008b;">Closure</span>,&nbsp;<span style="color:#00008b;">Object</span>,&nbsp;<span style="color:#00008b;">Object</span>[])<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">DynamicMethodHandle</span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;434</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">DynamicMethodHandle</span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;438</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">method</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;347</span><br />at 
<span><span style="color:#00008b;">Csla.Reflection.LateBoundObject</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">method</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\LateBoundObject.cs:&nbsp;line&nbsp;93</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Server.SimpleDataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">criteria</span>,&nbsp;<span style="color:#00008b;">DataPortalContext</span>&nbsp;<span style="color:#000000;">context</span>) in 
<span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Server\SimpleDataPortal.cs:&nbsp;line&nbsp;133</span><br />--- End 
of inner exception stack trace ---<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">GetCachedProperty</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">propertyName</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;205</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallPropertySetter</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">property</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">value</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;278</span><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Core.BusinessBase</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">LoadProperty</span></span>(<span style="color:#00008b;">IPropertyInfo</span>&nbsp;<span style="color:#000000;">propertyInfo</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">newValue</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Core\BusinessBase.cs:&nbsp;line&nbsp;2460</span><br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">Map</span></span>(<span style="color:#00008b;"><span class="normalLinkEmuLink"><span style="color:#00008b;">SafeDataReader</span></span></span>&nbsp;<span style="color:#000000;">reader</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;248</a><br />at 
<span class="normalLinkEmuLink"><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">DataPortal_Fetch</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">ClientCriteria</span></span></span>&nbsp;<span style="color:#000000;">criteria</span>) in <a>Client.DataAccess.cs:&nbsp;line&nbsp;56</a><br />at 
<span style="color:#008b8b;">lambda_method</span>(<span style="color:#00008b;">Closure</span>,&nbsp;<span style="color:#00008b;">Object</span>,&nbsp;<span style="color:#00008b;">Object</span>[])<br />at <span class="normalLinkEmuLink"><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">DynamicMethodHandle</span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;434</span><br />at 
<span><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">DynamicMethodHandle</span>&nbsp;<span style="color:#000000;">methodHandle</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;438</span><br />at 
<span><span style="color:#00008b;">Csla.Reflection.MethodCaller</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">obj</span>,&nbsp;<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">method</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\MethodCaller.cs:&nbsp;line&nbsp;347</span><br />at 
<span><span style="color:#00008b;">Csla.Reflection.LateBoundObject</span></span>.<span class="normalLinkEmuLink"><span style="color:#008b8b;">CallMethod</span></span>(<span style="color:#00008b;">String</span>&nbsp;<span style="color:#000000;">method</span>,&nbsp;<span style="color:#00008b;">Object</span>[]&nbsp;<span style="color:#000000;">parameters</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Reflection\LateBoundObject.cs:&nbsp;line&nbsp;93</span><br />at 
<span><span style="color:#00008b;">Csla.Server.SimpleDataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">criteria</span>,&nbsp;<span style="color:#00008b;">DataPortalContext</span>&nbsp;<span style="color:#000000;">context</span>) in 
<span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\Server\SimpleDataPortal.cs:&nbsp;line&nbsp;133</span><br />at 
<span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;">Type</span>&nbsp;<span style="color:#000000;">objectType</span>,&nbsp;<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">criteria</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\DataPortal.cs:&nbsp;line&nbsp;245</span><br />at <span><span style="color:#00008b;">Csla.DataPortal</span></span>.<span><span style="color:#008b8b;">Fetch</span></span>(<span style="color:#00008b;">Object</span>&nbsp;<span style="color:#000000;">criteria</span>) in <span style="color:#8b8b8b;">C:\Visual Studio 
Projects\csla\Source\Csla\DataPortal.cs:&nbsp;line&nbsp;170</span><br />at <span><span style="color:#00008b;">ClientTest.Business.Client</span></span>.<span><span style="color:#008b8b;">GetByOid</span></span>(<span style="color:#00008b;"><span><span style="color:#00008b;">String</span></span></span>&nbsp;<span style="color:#000000;">oid</span>) in <a>Client.Generated.cs:&nbsp;line&nbsp;353</a><br />at 
<span><span style="color:#00008b;">TestProject1.UnitTest1</span></span>.<span><span style="color:#008b8b;">GetClient</span></span>() in <a>UnitTest1.cs:&nbsp;line&nbsp;67</a></div>
<div class="stacktrace"></div>
<div class="stacktrace">This code throws an exception:</div>
<div class="stacktrace"></div>
<div class="stacktrace">
<div class="stacktrace">private static readonly PropertyInfo&lt; System.String &gt; _originalOidProperty = RegisterProperty&lt; System.String &gt;(p =&gt; p.OriginalOid, string.Empty);</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// Holds the original value for Oid. This is used for non identity primary keys.</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;/summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<b>internal </b>System.String OriginalOid</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;{</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get { return GetProperty(_originalOidProperty); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set{ SetProperty(_originalOidProperty, value); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</div>
</div>
<div class="stacktrace"></div>
<div class="stacktrace">This code works:</div>
<div class="stacktrace"></div>
<div class="stacktrace">
<div class="stacktrace">private static readonly PropertyInfo&lt; System.String &gt; _originalOidProperty = RegisterProperty&lt; System.String &gt;(p =&gt; p.OriginalOid, string.Empty);</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// Holds the original value for Oid. This is used for non identity primary keys.</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;/// &lt;/summary&gt;</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<b>public </b>System.String OriginalOid</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;{</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get { return GetProperty(_originalOidProperty); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set{ SetProperty(_originalOidProperty, value); }</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</div>
</div>
<div class="stacktrace"></div>
<div class="stacktrace">
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using(BypassPropertyChecks)</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LoadProperty(_oidProperty, reader[&quot;OID&quot;]);</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LoadProperty(_originalOidProperty, reader[&quot;OID&quot;]);</div>
<div class="stacktrace">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</div>
</div>
<p>&nbsp;</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Wednesday, July 28, 2010</h2><p>This issue is unrelated to the RC0 LoadProperty() change then, because that was undone in RC1 and RTM - the non-generic LoadProperty() is completely unlike the RC0 implementation.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Thursday, July 29, 2010</h2><p>
<p>Hello,</p>
<p>Yes, I think that this issue and the&nbsp;lambda&nbsp;issue (already logged) should be worked out before 4.0.1.</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 29, 2010</h2><p>I guess what I was trying to say in my previous post is that I don&#39;t know what this issue actually is. I don&#39;t have a unit test repro for it (?).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Thursday, July 29, 2010</h2><p>
<p>Hello,</p>
<p>I know the issue and the fix. I&#39;ll create a unit test for it and get the tests&nbsp;committed. There is some reflection code that only checks to see if it is a public property, it doesn&#39;t check to see if a property exists that is also internal or private..</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
<div></div>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Sunday, August 01, 2010</h2><p>
<p>Hello,</p>
<p>I added some more unit tests for this load property issue and couldn&#39;t reproduce. I&#39;ll take another look at the sample application.</p>
<p>Thanks</p>
<p>-Blake Niemyjski</p>
<div></div>
<div></div>
<p>&nbsp;</p>
<div></div>
<div class="ForumPostSignature"></div>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>akhil replied on Thursday, August 19, 2010</h2><p>hello,</p>
<p>&nbsp;</p>
<p>how can we over come with this issue..?</p>
<p>help me.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bniemyjski replied on Thursday, August 19, 2010</h2><p>Hello,</p>
<p>This has been fixed in 4.0 RTM. Please make sure your references are correct and that you download the latest version from the site.</p>
<p>Thanks<br />-Blake Niemyjski</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
