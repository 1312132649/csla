<html><header><title>MVC2 bypass login screen for New User - Create Password</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>MVC2 bypass login screen for New User - Create Password</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9576.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SDM10012 posted on Saturday, September 25, 2010</h2><p>My Use Case is to e-mail a url to new customer that will route them to a create password view in our CSLA&nbsp;3.8 ASP.NET MVC2 application</p>
<p>Since the ChangePassword action is in the Account Controller ... the URL that I send to the unauthenticated user takes them to a login screen ( because of the constructor in the Account Controller ).</p>
<p>The simple solution would be to take that create password function out of the AccountController ... but I&#39;m looking for a way to keep from having to do that.</p>
<p>To keep that function in the AccountController, It looks like I can re-route the action by adding a function in the constructor that will do special handling if the HTTP.Request is for the change password URL .... </p>
<p>Is there an MVC feature &nbsp;/ or any other options for bypassing the login screen for an unauthenticated user for an action in the Account Controller&nbsp; ??</p>
<p>Thanks,</p>
<p>Steve</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Saturday, September 25, 2010</h2><p>I&#39;m not sure why you&#39;re really doing anything in the constructor of your AccountController.&nbsp; Why don&#39;t you have the relevent logic in seperate action methods?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SDM10012 replied on Saturday, September 25, 2010</h2><p>is there an update to the 3.8 version of MVC PTracker solves this ... here is my version of the &quot;canonical&quot; PT MVC accountcontronller ...</p>
<p>=========</p>
<p>[HandleError]<br />public class AccountController : Controller<br />{<br />// This constructor is used by the MVC framework to instantiate the controller using<br />// the default forms authentication and membership providers.<br />public<br />&nbsp;AccountController(): this(null, nulL){}</p>
<p>// This constructor is not used by the MVC framework but is instead provided for ease</p>
<p>// of unit testing this type. See the comments at the end of this file for more</p>
<p>// information.</p>
<p>public AccountController(IFormsAuthentication formsAuth, IMembershipService service)</p>
<p>{FormsAuth = formsAuth ?? new FormsAuthenticationService();<br />MembershipService = service ?? new AccountMembershipService();<br />}<br />public IFormsAuthentication FormsAuth{get;private set;}<br />public IMembershipService FormsAuth{get;private set;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Saturday, September 25, 2010</h2><p>I guess I&#39;m a bit confused; I thought you said you were sending unauthenticated users to a logon page in the constructor.&nbsp; </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SDM10012 replied on Saturday, September 25, 2010</h2><p>Not quite ... in PTMVC any action in the Account Controller other than login requires an authenticated user</p>
<p>So ... it&#39;s a bit of a Hack ... but since this is the only case where a user without valid credentials can access a view managed by &nbsp;the Account Controller in my app&nbsp;.... I&#39;m looking for the URI in global.asax and performing a login for a default user.</p>
<p style="padding-left:90px;">if (HttpContext.Current.Request.AppRelativeCurrentExecutionFilePath == &quot;~/NewPassword&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="padding-left:90px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyApp.Library.Security.MyappPrincipal.Login(&quot;foo&quot;, &quot;bar&quot;);</p>
<p style="padding-left:90px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HttpContext.Current.Session[&quot;CslaPrincipal&quot;] =<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Csla.ApplicationContext.User;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</p>
<p>With an authenticated user in the session object the AccountController constructor routes to the change password form, bypassing the login screen ....</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Sunday, September 26, 2010</h2><p>Why not have another action method that doesn&#39;t require authorization, and just set the principal to the Unauthenticated princpal from Csla (or another one you make).</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
