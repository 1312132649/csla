<html><header><title>How do I get started using NetTcpBinding and Windows Forms / WPF?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How do I get started using NetTcpBinding and Windows Forms / WPF?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7216.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>robdal posted on Thursday, July 02, 2009</h2>Hi,<br />I've never developed a project using CSLA and I'm just getting started. Since my project will work on an intranet I'll be using nettcpbinding and the server will be a WPF application. I looked if I could find a sample to get started in that direction but everything I found has to do with the web. I just finished watching the full series of video tutorials on CSLA for Silverlight and bought the book, and I've been able to reproduce the simplest Silverlight samples. Nonetheless I  can't figure out how to get started in a different scenario.<br />Any hint will be greatly appreciated<br />Roberto Dalmonte</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 02, 2009</h2><P>If I were you, I'd use HTTP binding first, to get an understanding of CSLA .NET itself and how to build and use business objects.</P>
<P>Using NetTcpBinding is not a CSLA thing, it is a WCF thing, but it brings&nbsp;complexity all by itself.</P>
<P>You can't host TCP in IIS (or can you in IIS 7?), so you have to create your own custom Windows service and set it up to host WCF using the TCP binding. That's just a few lines of code to get a basic, non-reliable service running. But if you want any sort of reliability you'll need to at least add logging to the system event log, and very possibly create your own AppDomain to host the WCF service so you have the possibility of doing a restart if you detect a runaway condition.</P>
<P>Or you can use WAS (Windows Activation Service)&nbsp;if your server is Win2k8 - and that is probably a much smarter idea, since Microsoft already does a lot of this reliability work for you in that case.</P>
<P>Using the TCP binding on the client is pretty easy. Once you have your service running, just use the correct WCF configuration in the client config file so WCF knows to use the NetTcpBinding to talk to your service at the correct URL.</P>
<P>You should get <A href="http://www.amazon.com/Learning-WCF-Hands-Michele-Bustamante/dp/0596101627">Michelle's Learning WCF book</A>.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robdal replied on Thursday, July 02, 2009</h2>Thanks for answering.<br />In my project I'm using WCF (Miguel Castro way, as seen on DNRTV episode "Extreme WCF"). I LOVE IT. I LOVE IT. I LOVE IT.<br />I use 5 different assemblies:<br />1) the contract assembly<br /><br /> public interface IArchive<br />{<br />        [OperationContract]<br />        IEnumerable GetSpecificData(String query, Int32 id);<br />}<br /><br />2) the service assembly<br /> public class ArchiveService : IArchive<br />    {<br />     IEnumerable IArchive.GetSpecificData(String query, Int32 id)<br />        {<br />          //Actual implementation to get data<br />        }<br />    }<br />    <br /> 3) the server assembly that hosts the service<br /> public class Server<br /> {<br />   private void StartService()<br />        {<br />            String baseAddress = "net.tcp://localhost:8002/ArchiveEndpoint";<br />            NetTcpBinding binding = new NetTcpBinding(SecurityMode.None);<br />            XmlDictionaryReaderQuotas quota = new XmlDictionaryReaderQuotas();<br />            quota.MaxStringContentLength = 1000000;<br />            quota.MaxArrayLength = 2147483647;<br />            binding.MaxBufferSize = 2147483647;<br />            binding.MaxReceivedMessageSize = 2147483647;<br />            binding.ReaderQuotas = quota;<br />            binding.TransferMode = TransferMode.Streamed;<br />            ServiceHost serviceHost = new ServiceHost(typeof(ArchiveService));<br />            serviceHost.AddServiceEndpoint(typeof(IArchive), binding, baseAddress);<br />            serviceHost.Opened += new EventHandler(OnServiceHostOpened);<br />            serviceHost.Open();<br />        }<br />}<br /><br />4) the proxy assembly<br />public class CustomProxy<br />{<br />     internal IEnumerable GetSpecificData(String query, Int32 id)<br />        {<br />            IArchive proxy = new ChannelFactory(binding, ea).CreateChannel();<br />            using (proxy as IDisposable)<br />            {<br />                return proxy.GetSpecificData(query, id);<br />            }<br />        }<br />}<br /><br />5) The client assembly<br /><br />public class Client<br />{<br />   internal static IEnumerable GetSpecificData(string query, Int32 id)<br />        {<br />            CustomProxy proxy = new CustomProxy();<br />            return proxy.GetSpecificData(query, id);<br />        }<br />}<br /><br />My application it's a dental software that runs in a local netword inside the dental office, and I believe NetTcpBinding is faster than HttpBinding.<br />It's a couple of years I'm trying to use CSLA (I bought all your books in the last 5 years) but I fail systematically.<br /><br />Is there a way to combine WCF and NetTcpBinding and CSLA?<br />I'm afraid you answered me already.<br />can I bypass your DATAPORTAL (if I understand correctly) and use your business classes with validation, authorization and so on?<br />I would really love to use your CSLA, you made an incredible job.<br />Best regards<br />Roberto Dalmonte<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 02, 2009</h2><P>You absolutely can use the data portal with NetTcpBinding. Any synchronous WCF binding will work with the data portal. You already have the code you need - just set your service to use the pre-existing WcfHost interface/service types in Csla.Server.Hosts and you should be good to go.</P>
<P>Look in Chapter 15 of the <EM>Expert 2008 Business Objects</EM> book to get a deeper understanding of the data portal and how it integrates with WCF.</P>
<P>You can also use the data portal in local mode (client-only) and then in your DataPortal_XYZ methods or object factories you can call your custom services however you'd like. If you do this then you lose the n-tier features of CSLA .NET, but you keep all the client-side features like data binding, etc.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>robdal replied on Thursday, July 02, 2009</h2>Following your suggestion I created a service implementing the Csla.Server.Hosts.IWcfPortal interface<br /><br /><br /> public class CustomService : Csla.Server.Hosts.IWcfPortal<br /> {<br />        #region IWcfPortal Members<br /><br />        public WcfResponse Create(CreateRequest request)<br />        {<br />            DataPortal portal = new DataPortal();<br />            object result;<br />            try<br />            {<br />                result = portal.Create(request.ObjectType, request.Criteria, request.Context);<br />            }<br />            catch (Exception ex)<br />            {<br />                result = ex;<br />            }<br />            return new WcfResponse(result);<br />        }<br /><br />}<br /><br /><br />Then I need a host for the service:<br /> public partial class Window1 : Window<br />    {<br />        public Window1()<br />        {<br />            InitializeComponent();<br />            StartService();<br />        }<br /><br />        private void StartService()<br />        {<br />            String baseAddress = "net.tcp://localhost:8002/CustomServiceEndpoint";<br />            NetTcpBinding binding = new NetTcpBinding(SecurityMode.None);<br />            XmlDictionaryReaderQuotas quota = new XmlDictionaryReaderQuotas();<br />            quota.MaxStringContentLength = 1000000;<br />            quota.MaxArrayLength = 2147483647;<br />            binding.MaxBufferSize = 2147483647;<br />            binding.MaxReceivedMessageSize = 2147483647;<br />            binding.ReaderQuotas = quota;<br />            binding.TransferMode = TransferMode.Streamed;<br />            ServiceHost serviceHost = new ServiceHost(typeof(CustomService));<br />            serviceHost.AddServiceEndpoint(typeof(IWcfPortal), binding, baseAddress);<br />            serviceHost.Open();<br />            this.Title = "Service Started";<br />        }<br />    }<br />    <br />    a client proxy<br />    public class ClientProxy<br />    {<br />        private NetTcpBinding binding = new NetTcpBinding(SecurityMode.None);<br />        private XmlDictionaryReaderQuotas quota = new XmlDictionaryReaderQuotas();<br />        private EndpointAddress ea;<br /><br />        internal ClientProxy()<br />        {<br />            //String server = RunSettings.Instance.ProgramSettings.ServerName;<br />            string server = "localhost";<br />            ea = new EndpointAddress(String.Format("net.tcp://{0}:8002/CustomServiceEndpoint", server));<br />            quota.MaxStringContentLength = 1000000;<br />            quota.MaxArrayLength = 2147483647;<br />            binding.MaxReceivedMessageSize = 9000000;<br />            binding.MaxBufferSize = 2147483647;<br />            binding.ReaderQuotas = quota;<br />            binding.TransferMode = TransferMode.Streamed;<br />        }<br />        internal DataPortalResult Create(Type oType, object criteria, DataPortalContext context)<br />        {<br />            IDataPortalProxy proxy = new ChannelFactory(binding, ea).CreateChannel();<br />            using (proxy as IDisposable)<br />            {<br />                return proxy.Create(oType, criteria, context);<br />            }<br />        }<br />    }<br />    <br />    Finally I need a <br />    business.client assembly<br />    business.server assembly<br />    dataaccess assembly<br />    <br />    Can you confirm I'm on the right track, or otherwise give me some other hints?<br />    Thank you</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
