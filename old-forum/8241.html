<html><header><title>Child Collection lazy init and parent IsDirty property</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Child Collection lazy init and parent IsDirty property</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8241.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ErikJL posted on Wednesday, December 30, 2009</h2>Hi! I have a CSLA Busniness object (FuseLocation) with a child collection (FuseList). Since the child collection is not always necessary, and there will be times when there will be a large collection of the type of parent object, I want the child collection to lazy initialize (hydrate only when accessed the first time). This introduces a problem with the parent's IsDirty property; when the child collection is acccessed and hydrated for the first time, the parent's IsDirty property is set to true even though no data has changed. Realizing this was a core function of the framework for detecting a property change I tried to reset IsDirty to false using MarkClean() if IsDirty was false to begin with, but for I cannot figure out why it does not work. Here's the child collection propery code:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FuseList List <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Boolean wasDirty = this.IsDirty;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (this.fuseList == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.fuseList = FuseXList.GetChildList(this);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!wasDirty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.MarkClean(); <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.fuseList;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>IsDirty is the only&nbsp; thing I noticed, but i realize there may be more going on behind the scenes in the framework. How can I implement a lazy initialized child collection correctly?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 30, 2009</h2><P>Looks like you're using private backing fields.&nbsp; In that case, there's nothing in the code you posted that would make the parent dirty.&nbsp; </P>
<P>I suspect two possible things: 1)&nbsp; your GetChildList is changing a property on the parent, thus causing your problems.&nbsp; 2)&nbsp; The child objects in the list are coming back as dirty for some reason.&nbsp; You don't mention what Csla version you're using, but there was a time where you had to call MarkOld manually.&nbsp; Perhaps that's the case here?</P>
<P>HTH</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ErikJL replied on Wednesday, December 30, 2009</h2>Hi Andy,<br><br>&nbsp;You are correct! The child list (rather, each child object) is coming back dirty.&nbsp; I'm not sure what version CSLA we have as my partner was the one who put it in source control, and I don't see any versioning, but I do know we aren't using the latest version. Calling "MarkOld()" within each child object did the trick. Thank you for the help!<br><br>Erik<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, December 31, 2009</h2><P>Erik,</P>
<P>Glad you were able to get it working.&nbsp; Check the Csla AssemblyInfo.cs file.. unless your partner changed it, that should tell you what version you have.&nbsp; Its probably one of the older ones, because newer versions have ways where Csla will take care of the MarkOld call for you.</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ErikJL replied on Thursday, January 07, 2010</h2>Ahh, there it is - 2.1.4 is the version. Thanks again.<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
