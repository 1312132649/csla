<html><header><title>System.NotImplementedException: DataPortal_Fetch not implemented</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>System.NotImplementedException: DataPortal_Fetch not implemented</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7767.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs posted on Sunday, October 11, 2009</h2>Hello all.<br /><br />I am attempting to build my first SL application. Using partial classes to separate SL client functionality from server-side functionality.<br /><br />I'm trying to get SL login to work as per Rocky's examples. In my SL application, the partial identity class has the following:<br /><br />        Private Shared Sub desIdentityFetchComplete(ByVal sender As Object, ByVal e As DataPortalResult(Of desIdentity))<br />            Dim callback = DirectCast(e.UserState, EventHandler(Of DataPortalResult(Of desIdentity)))<br />            'Process results here - the object can now be manipulated before being passed back to the callback <br />            callback.Invoke(sender, e)<br />        End Sub<br /><br />        Public Shared Sub GetdesIdentity(ByVal entityid As String, ByVal username As String, ByVal password As String, ByVal callback As EventHandler(Of DataPortalResult(Of desIdentity)))<br />            'Asynchronous Get method.<br />            Dim dp = New DataPortal(Of desIdentity)<br />            AddHandler dp.FetchCompleted, AddressOf desIdentityFetchComplete<br />            dp.BeginFetch(New LoginCriteria(entityid, username, password), callback)<br />        End Sub<br /><br />When I run the SL application, I get the runtime error:<br /><br />An unhandled exception ('Unhandled Error in Silverlight Application Code: 4004<br />Category: ManagedRuntimeError<br />Message: System.NotImplementedException: DataPortal_Fetch not implemented<br /><br />All the service references appear valid in the solution. The DataPortal_Fetch routine is in the server-side partial class, and works fine when using non-asynchronous login via WPF. Only trying to login via Silverlight am I having problems.<br /><br />Any ideas why this may be happening?<br /><br />Thanks in advance!</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Sunday, October 11, 2009</h2>Are you missing private sub DataPortal_Fetch(criteria as LoginCirteria) in that class?<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: GregDobbs [mailto:cslanet@lhotka.net] <br />Sent: Sunday, October 11, 2009 5:47 PM<br />To: Sergey Barskiy<br />Subject: [CSLA .NET] System.NotImplementedException: DataPortal_Fetch not implemented<br /><br />Hello all.<br /><br />I am attempting to build my first SL application. Using partial classes to separate SL client functionality from server-side functionality.<br /><br />I'm trying to get SL login to work as per Rocky's examples. In my SL application, the partial identity class has the following:<br /><br />        Private Shared Sub desIdentityFetchComplete(ByVal sender As Object, ByVal e As DataPortalResult(Of desIdentity))<br />            Dim callback = DirectCast(e.UserState, EventHandler(Of DataPortalResult(Of desIdentity)))<br />            'Process results here - the object can now be manipulated before being passed back to the callback <br />            callback.Invoke(sender, e)<br />        End Sub<br /><br />        Public Shared Sub GetdesIdentity(ByVal entityid As String, ByVal username As String, ByVal password As String, ByVal callback As EventHandler(Of DataPortalResult(Of desIdentity)))<br />            'Asynchronous Get method.<br />            Dim dp = New DataPortal(Of desIdentity)<br />            AddHandler dp.FetchCompleted, AddressOf desIdentityFetchComplete<br />            dp.BeginFetch(New LoginCriteria(entityid, username, password), callback)<br />        End Sub<br /><br />When I run the SL application, I get the runtime error:<br /><br />An unhandled exception ('Unhandled Error in Silverlight Application Code: 4004<br />Category: ManagedRuntimeError<br />Message: System.NotImplementedException: DataPortal_Fetch not implemented<br /><br />All the service references appear valid in the solution. The DataPortal_Fetch routine is in the server-side partial class, and works fine when using non-asynchronous login via WPF. Only trying to login via Silverlight am I having problems.<br /><br />Any ideas why this may be happening?<br /><br />Thanks in advance!<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Monday, October 12, 2009</h2>Hello, Sergey.<br /><br />The DataPortal_fetch() private sub exists in the server-side partial class.<br /><br />e.g. <br />desIdentity.shared.vb  <br />desIdentity.vb  <br />Does this separation look correct?<br /><br />Thanks!<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Monday, October 12, 2009</h2>Oops - used some illegal characters that nuked my response. Try this again:<br /><br />The desIdentity.shared.vb partial class is available to the SL client (linked file). It contains the asynchronous methods (beginfetch, fetchcomplete) and all property declarations. <br /><br />The Dataportal_xxx methods, however, exists in the partial class desIdentity.vb, which is a server-only file.<br /><br />Is this separation correct?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>sergeyb replied on Monday, October 12, 2009</h2>Sounds correct to me.  Maybe the method signature for DP_Fetch is not correct?<br /><br />Sergey Barskiy<br />Principal Consultant<br />office: 678.405.0687 | mobile:&#160;404.388.1899<br /><br />Microsoft Worldwide Partner of the Year | Custom Development Solutions, Technical Innovation<br /><br />-----Original Message-----<br />From: GregDobbs [mailto:cslanet@lhotka.net] <br />Sent: Monday, October 12, 2009 2:04 PM<br />To: Sergey Barskiy<br />Subject: Re: [CSLA .NET] RE: System.NotImplementedException: DataPortal_Fetchnot implemented<br /><br />Oops - used some illegal characters that nuked my response. Try this again:<br /><br />The desIdentity.shared.vb partial class is available to the SL client (linked file). It contains the asynchronous methods (beginfetch, fetchcomplete) and all property declarations. <br /><br />The Dataportal_xxx methods, however, exists in the partial class desIdentity.vb, which is a server-only file.<br /><br />Is this separation correct?<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Monday, October 12, 2009</h2>Thanks, Sergey.<br /><br />Yes, the signatures are all correct. The same problem seems to be happening in all other BOs I am testing (not many yet, since I can't get past login).<br /><br />Could this be a configuration issue? Testing the code in a WPF client all works fine (no asynch usage there). It's only in the SL client where the problem arises in attempting to access the underlying DataPortal_fetch method when a BeginFetch is called - it's almost as if the Silverlight partial class can't find its other half on the server side.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Tuesday, October 13, 2009</h2>OK - here is the full code that's exhibiting the problem. I hope someone can figure this out - I am going crazy! I still get the DataPortal_Fetch not implemented error.<br /><br />Identity Server-side class:<br /><br />Imports System<br />Imports System.Security.Principal<br />Imports System.Collections.Generic<br />Imports System.Runtime.Serialization<br />Imports System.Data.SqlClient<br />Imports Csla<br />Imports Csla.Core<br />Imports Csla.Data<br />Imports Csla.Security<br />Imports Csla.Serialization<br />Imports Csla.Core.FieldManager<br />Namespace Security<br /><br />     _<br />    Public Class desIdentity<br />        Inherits ReadOnlyBase(Of desIdentity)<br />        Implements IIdentity<br /><br />        Private mRoles As New List(Of String)<br /><br />        Friend Function IsInRole(ByVal role As String) As Boolean<br />            Return mRoles.Contains(role)<br />        End Function<br /><br /><br />#Region " Factory Methods "<br /><br />        Friend Shared Function GetIdentity(ByVal entityid As String, ByVal username As String, ByVal password As String) As desIdentity<br />            Return DataPortal.Fetch(Of desIdentity)(New LoginCriteria(entityid, username, password))<br />        End Function<br /><br />#End Region<br /><br />#Region " Data Access "<br /><br />        Private Overloads Sub DataPortal_Fetch(ByVal criteria As LoginCriteria)<br />            Try<br />                Using cxmgr As Csla.Data.ConnectionManager(Of SqlConnection) = Csla.Data.ConnectionManager(Of SqlConnection).GetManager("clientNet", True)<br />                    Dim cn As SqlConnection = cxmgr.Connection<br />                    Using cm As SqlCommand = cn.CreateCommand()<br />                        cm.CommandText = "admin_CSLALogin"<br />                        cm.CommandType = CommandType.StoredProcedure<br />                        cm.Parameters.AddWithValue("@EntityID", criteria.EntityID)<br />                        cm.Parameters.AddWithValue("@UserName", criteria.UserName)<br />                        cm.Parameters.AddWithValue("@Password", criteria.Password)<br />                        Using dr As SafeDataReader = New SafeDataReader(cm.ExecuteReader())<br />                            If dr.Read() Then<br /><br />                                LoadProperty(IsAuthenticatedProperty, True)<br />                                LoadProperty(CSLAUserKeyProperty, dr.GetInt32("CSLAUserKey"))<br />                                LoadProperty(NameProperty, criteria.UserName)<br />                                LoadProperty(FirstNameProperty, dr.GetString("FirstName"))<br />                                LoadProperty(LastNameProperty, dr.GetString("LastName"))<br />                                LoadProperty(FullNameProperty, dr.GetString("FullName"))<br />                                LoadProperty(EntityNameProperty, dr.GetString("EntityName"))<br />                                LoadProperty(EntityNameProperty, dr.GetString("EntityName"))<br />                                LoadProperty(LoginTypeProperty, dr.GetString("LoginType"))<br />                                LoadProperty(ResultMessageProperty, "Loaded Identity for " &amp; criteria.UserName)<br /><br />                                If dr.NextResult Then<br />                                    While dr.Read<br />                                        mRoles.Add(dr.GetString(0))<br />                                    End While<br />                                End If<br /><br />                            Else<br />                                LoadProperty(IsAuthenticatedProperty, False)<br />                                LoadProperty(CSLAUserKeyProperty, 0)<br />                                LoadProperty(NameProperty, "")<br />                                LoadProperty(FirstNameProperty, "")<br />                                LoadProperty(LastNameProperty, "")<br />                                LoadProperty(FullNameProperty, "")<br />                                LoadProperty(EntityNameProperty, "")<br />                                LoadProperty(EntityNameProperty, "")<br />                                LoadProperty(LoginTypeProperty, "")<br />                                LoadProperty(ResultMessageProperty, "No data returned for " &amp; criteria.UserName)<br />                                mRoles.Clear()<br /><br />                            End If<br />                        End Using<br />                    End Using<br />                End Using<br />            Catch ex As Exception<br />                LoadProperty(IsAuthenticatedProperty, False)<br />                LoadProperty(CSLAUserKeyProperty, 0)<br />                LoadProperty(NameProperty, "")<br />                LoadProperty(FirstNameProperty, "")<br />                LoadProperty(LastNameProperty, "")<br />                LoadProperty(FullNameProperty, "")<br />                LoadProperty(EntityNameProperty, "")<br />                LoadProperty(EntityNameProperty, "")<br />                LoadProperty(LoginTypeProperty, "")<br />                LoadProperty(ResultMessageProperty, "Exception Occured for " &amp; criteria.UserName &amp; vbCrLf &amp; ex.ToString)<br />                mRoles.Clear()<br />            End Try<br /><br />        End Sub<br /><br />#End Region<br /><br />End Class<br /><br />End Namespace<br /><br /><br /><br />Identity Partial SL class:<br /><br />Imports System<br />Imports System.Security.Principal<br />Imports System.Collections.Generic<br />Imports System.Runtime.Serialization<br />Imports Csla<br />Imports Csla.Core<br />Imports Csla.Data<br />Imports Csla.Security<br />Imports Csla.Serialization<br />Imports Csla.Core.FieldManager<br />Namespace Security<br /><br />    Partial Public Class desIdentity<br />        Inherits ReadOnlyBase(Of desIdentity)<br />        Implements IIdentity<br /><br />#Region " Business Methods "<br /><br />        Protected Overrides Function GetIdValue() As Object<br />            Return GetProperty(NameProperty)<br />        End Function<br /><br /><br />#Region " IIdentity "<br /><br /><br />        Private Shared ClientKeyProperty As PropertyInfo(Of Integer) = RegisterProperty(New PropertyInfo(Of Integer)("ClientKey"))<br /><br />        Private Shared IsAuthenticatedProperty As PropertyInfo(Of Boolean) = RegisterProperty(New PropertyInfo(Of Boolean)("IsAuthenticated"))<br />        Private Shared AuthenticationTypeProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("AuthenticationType"))<br />        Private Shared CSLAUserKeyProperty As PropertyInfo(Of Integer) = RegisterProperty(New PropertyInfo(Of Integer)("CSLAUserKey"))<br />        Private Shared NameProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("Name"))<br />        Private Shared FirstNameProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("FirstName"))<br />        Private Shared LastNameProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("LastName"))<br />        Private Shared FullNameProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("FullName"))<br />        Private Shared EntityNameProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("EntityName"))<br />        Private Shared EntityKeyProperty As PropertyInfo(Of Integer) = RegisterProperty(New PropertyInfo(Of Integer)("EntityKey"))<br />        Private Shared LoginTypeProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("LoginType"))<br />        Private Shared ResultMessageProperty As PropertyInfo(Of String) = RegisterProperty(New PropertyInfo(Of String)("ResultMessage"))<br /><br /><br />        Public ReadOnly Property AuthenticationType() As String _<br />          Implements System.Security.Principal.IIdentity.AuthenticationType<br />            Get<br />                Return "Csla"<br />            End Get<br />        End Property<br /><br /><br />        Public ReadOnly Property IsAuthenticated() As Boolean _<br />          Implements System.Security.Principal.IIdentity.IsAuthenticated<br />            Get<br />                Return GetProperty(IsAuthenticatedProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property CSLAUserKey() As Integer   'Added 3/20/2008 - gpd<br />            Get<br />                Return GetProperty(CSLAUserKeyProperty)<br />            End Get<br />        End Property<br /><br /><br />        Public ReadOnly Property Name() As String _<br />          Implements System.Security.Principal.IIdentity.Name<br />            Get<br />                Return GetProperty(NameProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property FirstName() As String<br />            Get<br />                Return GetProperty(FirstNameProperty)<br />            End Get<br />        End Property<br /><br /><br />        Public ReadOnly Property LastName() As String<br />            Get<br />                Return GetProperty(LastNameProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property FullName() As String<br />            Get<br />                Return GetProperty(FullNameProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property EntityName() As String<br />            Get<br />                Return GetProperty(EntityNameProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property EntityKey() As Integer<br />            Get<br />                Return GetProperty(EntityKeyProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property LoginType() As String<br />            Get<br />                Return GetProperty(LoginTypeProperty)<br />            End Get<br />        End Property<br /><br />        Public ReadOnly Property ResultMessage() As String<br />            Get<br />                Return GetProperty(ResultMessageProperty)<br />            End Get<br />        End Property<br /><br />#End Region<br /><br />#End Region<br /><br />#Region "Asynchronous/Shared Factory Methods "<br /><br />        Public Sub New()<br />            ' require use of factory methods<br />            'When used, set Authenticated to false by default<br />            LoadProperty(IsAuthenticatedProperty, False)<br />            LoadProperty(CSLAUserKeyProperty, 0)<br />            LoadProperty(NameProperty, "")<br />            LoadProperty(FirstNameProperty, "")<br />            LoadProperty(LastNameProperty, "")<br />            LoadProperty(FullNameProperty, "")<br />            LoadProperty(EntityNameProperty, "")<br />            LoadProperty(EntityNameProperty, "")<br />            LoadProperty(LoginTypeProperty, "")<br />            LoadProperty(ResultMessageProperty, "Created new unauthenticated identity")<br />        End Sub<br /><br />        Private Shared Sub desIdentityFetchComplete(ByVal sender As Object, ByVal e As DataPortalResult(Of desIdentity))<br /><br />            Dim callback = DirectCast(e.UserState, EventHandler(Of DataPortalResult(Of desIdentity)))<br /><br />            'Process results here - the object can now be manipulated before being passed back to the callback <br />            'Callback to the UI that the identity has been established<br />            callback.Invoke(sender, e)<br />        End Sub<br /><br />        Public Shared Sub GetIdentityAsynch(ByVal entityid As String, ByVal username As String, ByVal password As String, ByVal callback As EventHandler(Of DataPortalResult(Of desIdentity)))<br />            'Asynchronous Get method.<br />            Dim dp = New DataPortal(Of desIdentity)<br />            AddHandler dp.FetchCompleted, AddressOf desIdentityFetchComplete<br />            dp.BeginFetch(New LoginCriteria(entityid, username, password), callback)<br />        End Sub<br /><br /><br />        Friend Shared Function UnauthenticatedIdentity() As desIdentity<br />            Return New desIdentity<br />        End Function<br /><br /><br />#End Region<br />    End Class<br /><br />End Namespace<br /><br /><br />Call to establish Authentication from XAML:<br /><br />Imports System<br />Imports System.Windows<br />Imports System.Windows.Controls<br />Imports System.Windows.Media<br />Imports System.Windows.Media.Animation<br />Imports System.Windows.Shapes<br />Imports Csla<br />Imports Csla.Security<br />Imports clientNet.Library<br />Imports clientNet.Library.Security<br /><br />Partial Public Class acLogin <br />	Inherits UserControl<br /><br />	Public Sub New()<br />		' Required to initialize variables<br />		InitializeComponent()<br />    End Sub<br /><br /><br />    Private Sub btnLogin_Click(ByVal Sender As Object, ByVal e As RoutedEventArgs)<br /><br />        Dim UserName As String = tbUserName.Text<br />        Dim Password As String = passboxPassword.Password<br /><br />        'asynch<br />        clientNet.Library.Security.desIdentity.GetIdentityAsynch("entityID", UserName, Password, AddressOf LoginComplete)<br /><br />    <br />    End Sub<br /><br />    Private Sub LoginComplete(ByVal sender As Object, ByVal e As DataPortalResult(Of desIdentity))<br /><br />        Dim identity As desIdentity<br />        identity = e.Object<br />        Csla.ApplicationContext.User = New desPrincipal(identity)<br /><br />        If Csla.ApplicationContext.User.Identity.IsAuthenticated Then<br />            Me.tblockLoginResult.Text = "Logged In: " &amp; Csla.ApplicationContext.User.Identity.Name &amp; identity.ResultMessage<br />        Else<br />            Me.tblockLoginResult.Text = "Not: " &amp; identity.ResultMessage<br />        End If<br /><br />    End Sub<br /><br /><br /><br />End Class<br /><br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>GregDobbs replied on Friday, October 16, 2009</h2>Hello, all.<br /><br />I've been working on this gnashing my  teeth for four days - no luck!<br /><br />For the following discussion I am working on an Identity object called desIdentity. This is a typical CSLA Identity object paired with a typical principal object - no surprises.<br /><br />Here's the situation:<br /><br />1) I have an application with both WPF and Silverlight clients.<br /><br />2) All BOs, including the Identity and Principal authorization objects, are split into partial classes. The partial classes all reside on the Server side of things, and the partial classes specific to SL are linked into the SL client. The SL partial classes contain asynchronous methods, e.g. calling BeginFetch and handling FetchComplete.<br /><br />3) From WPF, I can use EITHER the synchronous or asynchronous methods successfully. So, I know the Dataportal_Fetch works, both synchronously and asychronously. The BeginFetch procedure in the SL partial class when used by WPF works fine.<br /><br />4) However, trying to call the BeginFetch FROM SL results in an error: DataPortal_fetch not implemented.<br /><br />SO - I must surmise that there is something not correctly set up in my service references that is causing SL to not send the BeginFetch command properly down the wire to the server to call DataPortal_Fetch.<br /><br />I have attached all the various config files: I hope someone can see a glaring error here!!! It all looks OK to me. Note that there are BOTH WcfPortal AND WcfSLPortal ClientConfig files to support both UIs.</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
