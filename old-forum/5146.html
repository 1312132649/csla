<html><header><title>LLBLGEN Support</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LLBLGEN Support</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5146.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jayachandran posted on Thursday, July 24, 2008</h2><P>Hi Rocky,</P>
<P>I'm new to CSLA.NET framework. We are planning to change our application architecture to&nbsp;use CSLA now. but our existing application is using LLBLGEN as DAL component.&nbsp;Does CSLA Support LLBLGEN? </P>
<P>I have seen JCL Framework, which uses CSLA and LLBLGEN but it seems no support and latest updates are available&nbsp;now.</P>
<P>Please guide me how to extend the CSLA support for LLBLGEN?</P>
<P>Thanks,<BR>Jay</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Sunday, July 27, 2008</h2>Hi Jay,<br><br>we are going the same path of trying to use LLBLGen with CSLA.NET.<br><br>In our current implementation we code generates a template for a business object based on the LLBLGen entities. We then copy &amp; paste the code into our business classes :)<br><br>Then we use a mapping function to map the fields in the DataPortal Methods.<br><br>I attached the LLBLGen template for you as they might help you to get started.<br><br>Good luck,<br>Patrick<br><br>------------------<br>[Transactional(TransactionalTypes.TransactionScope)]<br>protected override void DataPortal_Insert()<br>{<br>&nbsp;&nbsp;&nbsp; Persist(true);<br>}<br><br>[Transactional(TransactionalTypes.TransactionScope)]<br>protected override void DataPortal_Update()<br>{<br>&nbsp;&nbsp;&nbsp; Persist(false);<br>}<br><br>protected void Persist(bool isNew)<br>{<br>&nbsp;&nbsp;&nbsp; var entity = new AssignmentEntity();<br>&nbsp;&nbsp;&nbsp; entity.IsNew = true;<br>&nbsp;&nbsp;&nbsp; MapBoToEntity(entity);<br><br>&nbsp;&nbsp;&nbsp; using (DataAccessAdapter da = new DataAccessAdapter())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; da.SaveEntity(entity, true, new PredicateExpression(AssignmentFields.LastChangeOn == mTimestamp));<br><br>&nbsp;&nbsp;&nbsp; MapEnityToBo(entity);<br>}<br><br>// ------------------&nbsp;&nbsp;&nbsp; CODE GENERATED BY LLBLGEN -------------<br><br>// Property: AssignmentId<br>public static CfxPropertyInfo&lt;System.Int32&gt; AssignmentIdProperty = RegisterProperty&lt;System.Int32&gt;(<br>&nbsp;&nbsp;&nbsp; new CfxPropertyInfo&lt;System.Int32&gt;("AssignmentId", "AssignmentId", Globals.GroupCategoryType.Internal));<br>public System.Int32 AssignmentId<br>{<br>&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;System.Int32&gt;(AssignmentIdProperty); }<br>&nbsp;&nbsp;&nbsp; set { SetProperty&lt;System.Int32&gt;(AssignmentIdProperty, value); }<br>}<br><br>// Property: ClassTypeId<br>public static CfxPropertyInfo&lt;System.String&gt; ClassTypeIdProperty = RegisterProperty&lt;System.String&gt;(<br>&nbsp;&nbsp;&nbsp; new CfxPropertyInfo&lt;System.String&gt;("ClassTypeId", "ClassTypeId", Globals.GroupCategoryType.Internal));<br>public System.String ClassTypeId<br>{<br>&nbsp;&nbsp;&nbsp; get { return GetProperty&lt;System.String&gt;(ClassTypeIdProperty); }<br>&nbsp;&nbsp;&nbsp; set { SetProperty&lt;System.String&gt;(ClassTypeIdProperty, value); }<br>}<br><br><br>#region Data Access - Map<br>protected virtual void MapBoToEntity(DAL.EntityClasses.AssignmentEntity entity)<br>{<br>&nbsp;&nbsp;&nbsp; entity.AssignmentId = ReadProperty&lt;System.Int32&gt;(AssignmentIdProperty);<br>&nbsp;&nbsp;&nbsp; entity.ClassTypeId = ReadProperty&lt;System.String&gt;(ClassTypeIdProperty);<br>}<br><br>protected virtual void MapEnityToBo(DAL.EntityClasses.AssignmentEntity entity)<br>{<br>&nbsp;&nbsp;&nbsp; LoadProperty&lt;System.Int32&gt;(AssignmentIdProperty, entity.AssignmentId);<br>&nbsp;&nbsp;&nbsp; LoadProperty&lt;System.String&gt;(ClassTypeIdProperty, entity.ClassTypeId);<br>}<br>#endregion<br><br>// ------------------&nbsp;&nbsp;&nbsp; CODE GENERATED BY LLBLGEN -------------<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jayachandran replied on Tuesday, July 29, 2008</h2><P>Thanks Patrick, We will generate the LLBLGEN&nbsp;code using your template and let you know.</P>
<P>Regards,<BR>Jay</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jayachandran replied on Monday, August 04, 2008</h2><P>Hi Patrick,</P>
<P>We have generated the LLBLGEN code using your template and when trying to compile it gives an error saying "The type or namespace name 'CfxPropertyInfo' could not be found". Where can&nbsp;this class be found? </P>
<P>Also LLBLGen generates Nullable columns in the database as&nbsp;.net nullable datatype. Does CSLA supports for nullable data type?</P>
<P>Please suggest us.</P>
<P>Thanks,<BR>Jay</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Wednesday, August 06, 2008</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Jayachandran:</strong></div><div>we have generated the LLBLGEN code using your template and when trying to compile it gives an error saying "The type or namespace name 'CfxPropertyInfo' could not be found". Where can&nbsp;this class be found? </div></BLOCKQUOTE><br>We just extended ProperyInfo. I thought I had taken it out of the template sorry about that. Just remove the Cfx from the template and you should be fine.<br><br>This:<br>public static <b>Cfx</b>PropertyInfo&lt;System.Int32&gt; AssignmentIdProperty = RegisterProperty&lt;System.Int32&gt;(<br>&nbsp;&nbsp;&nbsp; new <b>Cfx</b>PropertyInfo&lt;System.Int32&gt;("AssignmentId", "AssignmentId", <b>Globals.GroupCategoryType.Internal</b>));<br><br>should look like this:<br>public static PropertyInfo&lt;System.Int32&gt; AssignmentIdProperty = RegisterProperty&lt;System.Int32&gt;(<br>&nbsp;&nbsp;&nbsp; new PropertyInfo&lt;System.Int32&gt;("AssignmentId", "AssignmentId"));<br>
<p><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Jayachandran:</strong></div><div>Also LLBLGen generates Nullable columns in the database as&nbsp;.net nullable datatype. Does CSLA supports for nullable data type?</div></BLOCKQUOTE><br></p>Search for ShipVia on this page to see a way of using Nullable columns with CSLA.NET<br>http://forums.lhotka.net/forums/post/24092.aspx. It's easy to add it to the template.<br><br>All the best,<br>Patrick<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jayachandran replied on Thursday, August 07, 2008</h2><P>Excellent, Works well</P>
<P>Many thanks Patrick <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>Regards<BR>Jay</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Patrick replied on Saturday, August 09, 2008</h2>Here another bonbon&nbsp;<img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br><br>You can implement some basic business rules automatically: <br><br>// Implement your own business base class your business objects inherit from<br><br>[Serializable()]<br>public abstract class CfxBusinessBase&lt;T&gt; : global::Csla.BusinessBase&lt;T&gt; where T : CfxBusinessBase&lt;T&gt;<br>{<br>&nbsp;&nbsp;&nbsp; public global::Csla.Core.IPropertyInfo GetPropertyInfo(string propertyName)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; foreach (global::Csla.Core.IPropertyInfo ipropertyInfo in FieldManager.GetRegisteredProperties())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ipropertyInfo.Name == propertyName) return ipropertyInfo;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return null;<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>// Validation Rules inside your business object<br><br>protected override void AddBusinessRules()<br>{<br>&nbsp;&nbsp;&nbsp; var t = new DAL.FactoryClasses.ProjectEntityFactory();<br>&nbsp;&nbsp;&nbsp; foreach (EntityField2 llblGenField in t.CreateFields())<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (llblGenField.IsPrimaryKey) continue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CslaCore.IPropertyInfo cslaProp = GetPropertyInfo(llblGenField.Name);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (cslaProp == null) continue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (llblGenField.DataType == typeof(Boolean)) continue;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (llblGenField.MaxLength &gt; 0) ValidationRules.AddRule(CslaVal.CommonRules.StringMaxLength, new CslaVal.CommonRules.MaxLengthRuleArgs(cslaProp, llblGenField.MaxLength));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (!llblGenField.IsNullable) ValidationRules.AddRule(CslaVal.CommonRules.StringRequired, new CslaVal.RuleArgs(cslaProp));<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>Enjoy,<br>Patrick<br>&nbsp;<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fedge replied on Thursday, November 20, 2008</h2><P>Hi Patrick,</P>
<P>Thanks for your post.</P>
<P>I've been using llblgen for a while, and would like to look into putting CSLA on top of it.</P>
<P>How has your experiment gone since this last post?&nbsp; did it pan out well?</P>
<P>Just looking for some views on this before potentially re-inventing the wheel :)</P>
<P>Thanks </P>
<P>Matt</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Friday, November 21, 2008</h2><P>Hi Matt and Jay (and Patrick)</P>
<P>A couple of years ago I wrote a plug-in to LLBLGen Pro that would allo CSLA Business Object classes to be designed and code-generated (using the LLBLGen code generator) from inside LLBLGen. This had the advantage of being able to design your Business Object classes by mapping them to fields of LLBLGen entities - but didn't restrict you to doing only this. It used the LLBLGen project as the metadata source for populating lists, etc. in the plug-in UI. The big advantage was automatic codegen of the data access logic that connected the CSLA business objects to the LLBLGen entity classes. (But it also had hooks allowing you to customise, add pre-fetch paths, filter, etc.)</P>
<P>Anyway, that was a couple of years ago (and I changed jobs after that)&nbsp;and was back in CSLA 2.6 days. Patrick is interested in me updating this to use CSLA 3.6 and the latest version of LLBLGen.</P>
<P>I'm trying to assess what interest there would be for this in the community. </P>
<P>Leave me a comment if you're interested.</P>
<P>Cheers...</P>
<P>Craig</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fedge replied on Saturday, November 22, 2008</h2><P>Hi Craig,</P>
<P>Sounds great/intruiging!&nbsp; I am not up really to speed with CSLA at the moment apart from a brief look at the sample library/code and reading of the 2005 book, but llblgen is simply magic for round trip db/code/change db/code code gen.&nbsp; As llblgen now supports LINQ to llblgen, maybe this is in your plan for the future?</P>
<P>I&nbsp;would definetly be interested in hearing more :)</P>
<P>Thanks for your reply,</P>
<P>Matt</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Saturday, November 22, 2008</h2><P>Hi Matt,</P>
<P>You are wise to check first before going down a road with unknown issues.</P>
<P>I have used CSLA for years.&nbsp;&nbsp;Over a year ago I got an opportunity to apply lessons learned on a custom project.&nbsp; I generated DAL with LLBLGen.&nbsp; Sooo nice.&nbsp; But LLBLGen exposes everything as public and wide open which isn't cool.&nbsp; Not so nice.</P>
<P>"2 great tastes that taste great together"</P>
<P>My gut said that CSLA would lay nicely over the top of LLBLGen.&nbsp; I gave it a go.&nbsp; The LLBLGen&nbsp;DAL is managed privately by the CSLA business object.&nbsp; It works WONDERFULLY and the code has been running at a federal customer in a multithreaded environment for over a year.&nbsp; It has:</P>
<UL>
<LI>cool tracing and logging features of LLBLGen built in.&nbsp; By just flipping value in config you can see all SQL and values going in and out of DB!!&nbsp; Great for debugging.</LI>
<LI>awesomely flexible query and filter mechanisms of LLBLGEN&nbsp; Make writing different flavors of readonly collections mostly cut and paste</LI>
<LI>LLBLGen handles fetching deep object tree extremely efficiently and quickly</LI></UL>
<P>The trick was how to deal with child objects &amp; serialization in and out of the data portal.&nbsp; I solved this by&nbsp;always having the Root CSLA object rehydrate it's children after de-serialization.&nbsp; This was done by marking any child CSLA objects as &lt;nonserializable&gt; etc.&nbsp; The LLBLGen has the whole relationship tree and the Root CSLA object has the LLBLGen object.&nbsp; So you always have the ability to build or hydrate a&nbsp;child CSLA object structure.&nbsp; It turned out to be quite fast and easy.</P>
<P>So on serialization...only the root CSLA object which contains the LLBLGen object goes over the wire.&nbsp; Then on de-serialization the root CSLA object call a method HydrateChildObjects.</P>
<P>The only other trick was extending the LLBLGen data access class to expose the ability to get connections, transactions, etc from it for use in any custom queries in my CSLA object layer.</P>
<P>Whenever my db changes, I just regenerate my LLBLGen DAL and make appropriate change in my business objects.&nbsp; I even have had great success with it being used by very beginner developers because it is easy to see what is going on.</P>
<P>The other&nbsp;changes were just lessons learned from using&nbsp;CSLA.</P>
<UL>
<LI>Pattern for handling SQL Deadlocks</LI>
<LI>Pattern for handling refetch of objects after updates (which handles possible updates from triggers)</LI>
<LI>Pattern for preventing developers accidentally writing code against the DB on the public (client) side of the CSLA business object.&nbsp; Sometimes developers forget they need to write code to go through the data portal first before trying to get to DB ;-)</LI></UL>
<P>One problem I didn't ever fix was how to hide the DAL dll somehow so&nbsp;a rogue developer (outside party) couldn't just point at it and get unfettered access to the DB bypassing business logic.&nbsp; But for us this wasn't a risk.&nbsp; Just would be nice to figure out how to do that someday.</P>
<P>Also this was done circa CSLA 2.5 or so...so this pattern didn't include Rocky's new property syntax.</P>
<P>Maybe this will help you feel confident about moving forward...it worked and is working great for us.&nbsp; If you need help let me know.</P>
<P>Sean</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cds replied on Saturday, November 22, 2008</h2><P>Hi Sean</P>
<P>Your experience with CSLA over LLBLGen sounds extensive - probably more so than mine. I also found it to be very nice (and if you look back on this thread, I wrote a plug-in to LLBLGen to codegen the CSLA business object classes).</P>
<P>Did you use the self-servicing or the DataAccessAdapter model of LLBLGen?</P>
<P>Craig</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fedge replied on Saturday, November 22, 2008</h2><P>Hi Sean/Craig,</P>
<P>Sean, thanks for the great overview, this all&nbsp;sounds massively promising, and I think this is defintely the right road for me to take further.&nbsp; I need to do more reading and investigation into the CSLA framework before I can add much value to this discussion, I am especially interested in seeing how the csla silverlight variant fits together! </P>
<P>Sean, did you code up by hand code your CSLA objects?&nbsp; obviously your knowledge can be used for quality code generation :) which you may already by doing?</P>
<P>Craig, can you post any further notes on the your plug in, its architecture? whether it can be made avialable?</P>
<P>All very interesting, thanks guys,</P>
<P>Matt</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Monday, November 24, 2008</h2>I'll answer both questions here in this reply:<br><br><blockquote>Sean, did you code up by hand code your CSLA objects?&nbsp; obviously your
knowledge can be used for quality code generation :) which you may
already by doing?<br><br></blockquote>Good question.&nbsp; For years we have used CodeSmith to generate our CSLA objects...made our own templates and it was very easy.&nbsp; I did not update our templates yet to handle the version that lays on top of LLBLGen.&nbsp; But the amount of code in the CSLA objects is HUGELY reduced given generics.&nbsp; Good luck on your efforts Matt!&nbsp; Let me know if I can help you.<br><br><blockquote>Did you use the adapter or self servicing pattern?<br><br></blockquote>We used the adapter pattern for several reasons.&nbsp; The most important was the need to be able to support some customers with Oracle and others with SQLServer.&nbsp; I also found it a much easier way to deal with the CSLA layer needing to be in charge of traveling across the wire in a N tier scenario.&nbsp; In other words...the self servicing pattern might be wanting to hit the db and it isn't there.<br><br>Craig, how was your experience having LLBLGen write the CSLA classes for ya?<br><br>Sean<br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
