<html><header><title>(Bad) design habits</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>(Bad) design habits</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/270.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>burmajam posted on Monday, June 05, 2006</h2><P class=MsoNormal><SPAN>Hi all.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>First of all I want to say that my English is not good enough, but I’ll do my best to explain the problem. It is design problem. In the attachment is UML class diagram that I need to implement in CSLA 2.0.x for the following <SPAN>&nbsp;</SPAN>request:<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN>This is Merchandise and Service tracking program. I need Merchandise object with its quantity change list. Changes are tracked via Documents.<SPAN>&nbsp; </SPAN>There are few kind of Documents with their <SPAN>&nbsp;</SPAN>DocumentItems. DocumentItem contents can be merchandise or service. Documents are incoming or outgoing in aspect of merchandise quantity. If DocumentItemContents (GoF Adapter pattern) is MerchandiseChange it changes Merchandise quantity or price. If it is ServiceChange it just tracks down usage of Service. I need to review each merchandise change list and be able to navigate from each change list item to document that made that change. Because each type of document has the same behavior, some properties (like date, document number, …) and each document has collection of its own DocumentItems, I thought I should generalize Document and DocumentItem objects, put the most business logic in them and then inherit them for concrete types of documents and their concrete items (GoF Factory + Template Method patterns).<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>The biggest problem I have is implementation of inheritance in CSLA 2.0, their OR mapping and navigation from general class association to concrete object (i.e. DocumentItem.contents is declared as DocumentItemContents, but it is abstract and it is either MerchandiseChange or ServiceChange). I know how to implement this in Borlands ECO framework, but I’d like to do it in CSLA. I think there’s a lack of CSLA documentation based on inheritance. I know it’s not the best practice, but most of the patterns are based upon it.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I hope I was clear enough, I really did my best :) Are there some idea guidelines, diagram redefinitions, … please :)<o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, June 05, 2006</h2><P>Because CSLA .NET 2.0 makes such heavy use of generics, inheritance for the purpose of polymorphism is virtually impossible.</P>
<P>Instead, you can use interfaces to accomplish your goal. A bonus is that this approach typically makes your data access (ORM) easier to manage as well. This article</P>
<P><A href="http://www.lhotka.net/Articles.aspx?id=b8515cd9-7f8e-43df-9efd-cd958dfdc21a">http://www.lhotka.net/Articles.aspx?id=b8515cd9-7f8e-43df-9efd-cd958dfdc21a</A></P>
<P>should help describe how to use interfaces to get polymorphic child items in your collections, which should allow you to have various types of line items that all have some common interface elements.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, June 30, 2006</h2><FONT size=2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>RockfordLhotka:</strong></div><div> </FONT>
<P><FONT size=2>Because CSLA .NET 2.0 makes such heavy use of generics, inheritance for the purpose of polymorphism is virtually impossible.</FONT></P>
<P><FONT size=2></div></BLOCKQUOTE></FONT></P>
<P><FONT size=2>My&nbsp;lord,&nbsp;you aren't kidding!!!&nbsp; Everytime I think I&nbsp;solve one of the issues I bumped into another one. </FONT></P>
<P><FONT size=2>I have a question, one of which isn't related to the inheritance aspect. </FONT></P>
<P><FONT size=2>It seems that the&nbsp;interface needs to declare the&nbsp;Update/DeleteSelf/Insert/Fetch methods which aren't traditionally public in CSLA. As the collection loops through the IChild objects on an update, it needs to call IChild.Update() and IChild.Insert() as necessary. They seem to need to be in the interface in order for this to work.&nbsp; </FONT></P>
<P><FONT size=2>My class definition is as such:</FONT></P>
<P><FONT size=2><FONT color=#0000ff>public</FONT> <FONT color=#0000ff>sealed</FONT> <FONT color=#0000ff>class</FONT> <FONT color=#008080>ProfileMemberCollection</FONT>&lt;T&gt; : <FONT color=#008080>BusinessListBase</FONT>&lt;<FONT color=#008080>ProfileMemberCollection</FONT>&lt;T&gt;, T&gt; <FONT color=#0000ff>where</FONT> T : <FONT color=#008080>IProfileMember</FONT></FONT></P>
<P><FONT color=#008080><FONT color=#000000 size=2>I liked this approach as I am able to say that I want a member collection of only one specific ILineItem implementation type/non-polymorphic&nbsp;(or&nbsp;I can use T = ILineItem for all ILineItem implementation types). Note, I'm not sure if I have all the generic stuff correct just yet, but my question really isn't in relation to that. </FONT></FONT></P>
<P><FONT size=2>When I noticed the problem, I&nbsp;attempted to deal with the Update/DeleteSelf/Insert (Fetch is a slightly different animal) by tagging an internal interface on the class that "T" would also implement (IProfileMemberInternal). But the compiler didn't like me placing this internal interface implementation restriction on T, as the collection class is public. </FONT></P>
<P><FONT size=2>So, what I found worked for me was to cast the object to the internal interface for the purpose of doing the Update/DeleteSelf/Insert. It compiles - but should I be able to cast from one interface to another like that? </FONT></P>
<P><FONT size=2>((<FONT color=#008080>IProfileMemberInternal</FONT>)profileMember).DeleteSelf();</FONT></P>
<P><FONT size=2>For the fetch, that is a different animal - but I wanted to write about my experiences trying to get a polymorphic collection to work and to ask if you had any suggestions of an alternative to my internal interface. </FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
