<html><header><title>DataGridView Child not Saved on Form Close</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataGridView Child not Saved on Form Close</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4153.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon posted on Friday, January 11, 2008</h2><P>I have a DataGridView bound to a list (descended from EditableRootListBase) of parents (descended from BusinessBase). I have a second DataGridView bound to a list (descended from BusinessListBase) of children (descended from BusinessBase). Both grids allow adding, editing and deleting. I am using CSLA 3.0.3 with VS2005.</P>
<P>The grids behave normally except for the following. If I am in the middle of editing a parent row and close the form, all changes are saved. This is the behaviour I want. If I am in the middle of editing the child row and close the form, the current changes to the child are not saved. I can work around the difference in behaviour by casting the parent object as&nbsp;an IEditableObject and calling the EndEdit method in a form closing event handler.</P>
<P>As far as I can tell I have coded all business objects as suggested in the documentation and code samples.</P>
<P>Has anyone any ideas on what I might have done wrong?</P>
<P>Regards,</P>
<P>Patrick Davey (Alias FatPigeon).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, January 11, 2008</h2>In your UI code are you following the pattern shown in the 3.0 version of PTWin and described in <EM>Using CSLA .NET 3.0</EM>? It sounds like you are not properly unbinding the objects from the bindingsource controls before calling Save().</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Saturday, January 12, 2008</h2><DIV><FONT face=Arial size=2>There is no code in the form except for setting the DataSource of the parent grid in the form constructor. I am relying on the BindingSource to do all the work as discussed in <EM>Binding to an Object - page 115</EM>&nbsp;in <FONT size=3><EM>Using CSLA .NET 3.0</EM>?</FONT>. This seems to work fine for the parent&nbsp;grid&nbsp;all the time and fine for the child grid all the time except for when the form is closed while a child row is being edited.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>If unsaved changes exist in the current&nbsp;child&nbsp;collection and the child grid still has focus, these are not saved if the form is closed, where as unsaved changes in the current row of the parent grid are saved when the form is closed.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Any thoughts?</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Patrick</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, January 12, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>The binding is automatic. But if you look further in the data
binding chapter you&#8217;ll see that you can&#8217;t call Save() until you
have unbound the objects from the bindingsource controls. You must first unbind
the child, then the parent. And unbinding takes a bit of code, especially for
collections, because you must explicitly call CancelEdit() or EndEdit() on the
child.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> FatPigeon
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Saturday, January 12, 2008 5:15 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] DataGridView Child not Saved on Form Close<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<div>

<p class=MsoNormal><span>There
is no code in the form except for setting the DataSource of the parent grid in
the form constructor. I am relying on the BindingSource to do all the work as
discussed in <em><span>Binding to an
Object - page 115</span></em>&nbsp;in </span><em><span>Using
CSLA .NET 3.0</span></em><span>?</span><span>. This seems to work
fine for the parent&nbsp;grid&nbsp;all the time and fine for the child grid all
the time except for when the form is closed while a child row is being edited.</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>If
unsaved changes exist in the current&nbsp;child&nbsp;collection and the child
grid still has focus, these are not saved if the form is closed, where as
unsaved changes in the current row of the parent grid are saved when the form
is closed.</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>Any
thoughts?</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>Patrick</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Sunday, January 13, 2008</h2><DIV><FONT face=Arial size=2>Thanks very&nbsp;much&nbsp;for your help Rocky&nbsp;(even on a Weekend!)&nbsp;but there seems to be a bit of&nbsp;miss communication - I am not trying to call the save method.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I am relying on all the work you have put in to ensure that&nbsp;BusinessBase (from which the parent descends) implements&nbsp; IEditableRoot and that the IEditableRoot.EndEdit in BusinessBase&nbsp;ultimately calls ApplyEditChild on the EditableRootListBase (the ancestor for the parent's containing&nbsp;collection)&nbsp;which calls SaveItem() which calls Save on the parent - which is absolutely wonderful and works fine - most of the time: </FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>If I move from one parent to another in the parent's grid, all changes to the parent and children are saved, if I close the form while editing a parent all changes are saved, the only case where save is not called via the binding mechanism is when a child is being edited when the form is closed (and as I mentioned before there is a work-around for this). </FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>I guess I must make clear&nbsp;that I am using the term parent and child&nbsp;in the application sense eg the parent may be an employer&nbsp;and the child may be a employee.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Are you saying that I should not be relying on this mechanism? It would be a big shame if I can't.</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Regards,</FONT></DIV>
<DIV><FONT face=Arial size=2></FONT>&nbsp;</DIV>
<DIV><FONT face=Arial size=2>Patrick</FONT></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Sunday, January 13, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>I see, sorry&#8230;<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>I have never tried to figure out the UI code necessary to use ERLB
with child objects, so you are in uncharted territory.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>But you can extrapolate from PTWin the fact that you&#8217;d
need to unbind the child bindingsource before the root object could be saved.
You aren&#8217;t calling Save(), but ERLB is calling Save(), so Save() is being
called. The object (and its children) must be unbound before Save() can be
called.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>ERLB takes care of &#8220;unbinding&#8221; the object before
Save() is called. But it doesn&#8217;t know that there are child objects
involved, or child bindingsource objects. So you must detect that the root
object is about to be saved, unbind the child bindingsource, allow the Save()
call and then rebind the child bindingsource (probably to a new set of children
from the new root).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Your manual EndEdit() call is more or less what I&#8217;m
talking about, but it isn&#8217;t quite right. Where you do the EndEdit() call
you need to actually unbind the child collection. Otherwise what happens is
that your EndEdit() is immediately followed by an automatic BeginEdit(). Yes,
your changes are saved, but that one child object is actually still at an
elevated edit level, and there&#8217;ll almost certainly be some unpredictable
end results if the user leaves a row (at the root leve), then returns to that
row, because that row has one child already at edit level 1 or 2, which will be
pushed yet higher if it is edited &#8211; in the end you&#8217;ll get some odd
results.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>To avoid that, where you are calling EndEdit(), replace that
with a call to UnbindBindingSource() from PTWin, and then make sure to rebind
once the Save() call is complete.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> FatPigeon
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Sunday, January 13, 2008 1:08 PM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: DataGridView Child not Saved on Form Close<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<div>

<p class=MsoNormal><span>Thanks
very&nbsp;much&nbsp;for your help Rocky&nbsp;(even on a Weekend!)&nbsp;but
there seems to be a bit of&nbsp;miss communication - I am not trying to call
the save method.</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>I
am relying on all the work you have put in to ensure that&nbsp;BusinessBase
(from which the parent descends) implements&nbsp; IEditableRoot and that the
IEditableRoot.EndEdit in BusinessBase&nbsp;ultimately calls ApplyEditChild on
the EditableRootListBase (the ancestor for the parent's
containing&nbsp;collection)&nbsp;which calls SaveItem() which calls Save on the
parent - which is absolutely wonderful and works fine - most of the time: </span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>If
I move from one parent to another in the parent's grid, all changes to the
parent and children are saved, if I close the form while editing a parent all
changes are saved, the only case where save is not called via the binding
mechanism is when a child is being edited when the form is closed (and as I
mentioned before there is a work-around for this). </span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>I
guess I must make clear&nbsp;that I am using the term parent and child&nbsp;in
the application sense eg the parent may be an employer&nbsp;and the child may
be a employee.</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>Are
you saying that I should not be relying on this mechanism? It would be a big shame
if I can't.</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>Regards,</span><o:p></o:p></p>

</div>

<div>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

</div>

<div>

<p class=MsoNormal><span>Patrick</span><o:p></o:p></p>

</div>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Monday, January 14, 2008</h2><FONT face=Arial size=2>
<P>Uncharted territory eh - that sounds interesting. Well I have done some exploring and have found the following: </P>
<P>Allowing the binding source to keep control works find – all data is saved when ever I move form one parent row to another. I have investigated the edit level issue that may occur on the child object but there does not seem to be a problem – the edit level is never more than one. After all, the BusinessBase implementation of IEditableObject.BeginEdit is designed to ignore all calls if BindingEdit is true, and BindingEdit is set the first time round.</P>
<P>Remember that the only code on the form is a bit in the constructor to set the DataSource of the parent BindingSource.</P>
<P>I do not understand why you are suggesting I should do any unbinding when the binding source always has control. Also, it seems a bit risky to do unbinding when the BindingSource is in the middle of calling IEditableObject.EndEdit on the business object. I can see that this is not the case in PTWin so you do need to unbind.</P>
<P>The original problem I had, and still have, is that IEditableObject.EndEdit does not get called on the parent by the binding source when the form is closed if the current children have some changes and a child row still has focus. IEditableObject.EndEdit does get called on the child object but this is of no use as it’s containing collection is not an EditableRootListBase. If this is the way the binding source/ERLB works then that’s ok – I can work around it.</P>
<P>However, if you think this whole approach is unreliable then I must think again. But this would be a shame as everything seems to work so well and the development technique was so elegant. All the UI was done using the form designer – very little code. And the result is a UI that is very common in ‘Power User’ type applications. Also, I have always had the feeling that this approach is what the BindingSource is all about – it makes full use of it.</P>
<P>Regards,</P>
<P>Patrick</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Tuesday, January 22, 2008</h2><P class=MsoNormal><FONT size=2>I know I am in uncharted territory and you have lot on your plate at the moment but I just thought I would make a note of an issue I have come across just in case you have time to look at it.</FONT></P>
<P class=MsoNormal><o:p><FONT size=2>&nbsp;</FONT></o:p></P>
<P class=MsoNormal><FONT size=2>The issue concerns invoking a row undo with the Esc key when a datagridview is bound to an editable root list base. The undo works fine the first time a row is visited but does not seem to work on the second visit. This is only a problem with Csla 3.0.3. Using Csla 2.1.4 the undo works all the time.</FONT></P>
<P class=MsoNormal><FONT size=2></FONT>&nbsp;</P>
<P class=MsoNormal><FONT size=2>Regards,</FONT></P>
<P class=MsoNormal><FONT size=2></FONT>&nbsp;</P>
<P class=MsoNormal><FONT size=2>Patrick</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 22, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>This is true with a simple ERLB where each root has no child
objects?<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Or to put it another way, there&#8217;s a project in svn in the samples/trunk/ERLBTest
folder that I use for testing ERLB and data binding. I don&#8217;t have time to
look in the near future, but if you could confirm the issue exists in that test
app that&#8217;d be very helpful!<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>svn://svn.lhotka.net/csla/samples/trunk/ERLBTest<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> FatPigeon
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Tuesday, January 22, 2008 8:56 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: DataGridView Child not Saved on Form
Close<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span>I know I am in uncharted territory and you have lot on
your plate at the moment but I just thought I would make a note of an issue I
have come across just in case you have time to look at it.</span><o:p></o:p></p>

<p class=MsoNormal><span>&nbsp;</span><o:p></o:p></p>

<p class=MsoNormal><span>The issue concerns invoking a row undo with the Esc
key when a datagridview is bound to an editable root list base. The undo works
fine the first time a row is visited but does not seem to work on the second
visit. This is only a problem with Csla 3.0.3. Using Csla 2.1.4 the undo works
all the time.</span><o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal><span>Regards,</span><o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal><span>Patrick</span><o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Tuesday, January 22, 2008</h2><P class=MsoNormal><SPAN>Forgive my stupidity – I have navigated to <A href="http://www.lhotka.net/cslacvs/viewvc.cgi/samples/trunk/ERLBTest/">http://www.lhotka.net/cslacvs/viewvc.cgi/samples/trunk/ERLBTest/</A><o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Which is what I assume is the same as <o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal>svn://svn.lhotka.net/csla/samples/trunk/ERLBTest</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>but cannot work out how to download it.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Regards,</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Patrick<SPAN><o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, January 22, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>No problem :)<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>You need to use something like TortoiseSVN to access the
repository using the svn:// URI. That will allow you to do a checkout of the
code to your machine.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><a href="http://www.lhotka.net/cslanet/Repository.aspx">http://www.lhotka.net/cslanet/Repository.aspx</a><o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> FatPigeon
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Tuesday, January 22, 2008 11:31 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: RE: DataGridView Child not Saved on
Form Close<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Forgive
my stupidity â€“ I have navigated to <a href="http://www.lhotka.net/cslacvs/viewvc.cgi/samples/trunk/ERLBTest/">http://www.lhotka.net/cslacvs/viewvc.cgi/samples/trunk/ERLBTest/</a><o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Which
is what I assume is the same as <o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>svn://svn.lhotka.net/csla/samples/trunk/ERLBTest<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>but
cannot work out how to download it.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Regards,<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Patrick<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>FatPigeon replied on Wednesday, January 23, 2008</h2><P class=MsoNormal><SPAN>Thanks for the pointer Rocky; I think I have solved it.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>No your ERLBTest project does not exhibit the problem.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Your ERLBTest project had CslaAutoCloneOnUpdate set to True. As soon as I did this in my project the problem went away.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>I think this is because the ERLB creates a clone of the business object in the SaveItem method if this config item is not set to true. The BindingEdit flag on the business object is set to false after the call to AcceptChanges in BusinessBase.ApplyEdit i.e. after the clone has been created. So the BindingEdit flag is still true in the cloned object that is now in the collection. Next time the row is visited a snap shot is not taken during the call to IEditableObject.BeginEdit as BindingEdit is still true.<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Does this make sense? If so, is it easy to say why the ERLB takes this clone if CslaAutoCloneOnUpdate is not set?<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Regards,<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal><SPAN>Patrick<o:p></o:p></SPAN></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, January 23, 2008</h2>






 

 
  
 




<div class=Section1>

<p class=MsoNormal><span>ERLB (and Csla.Wpf.CslaDataProvider) clones the object because
the only safe way to save an object when using a local data portal is to save a
clone.<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>CslaAutoCloneOnUpdate tells the data portal to do that clone,
and the data portal can be smarter about it (because it knows whether the data
portal is local or remote).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>If you are using a local data portal and you don&#8217;t clone
the object before saving, then any exception that occurs during the save will
leave your object in an indeterminate state. In earlier versions of CSLA I didn&#8217;t
force the cloning for performance reasons &#8211; but the resulting behavior is
incorrect, and so I&#8217;m phasing in the requirement to do the cloning. In
CSLA 3.5 the auto-clone behavior is turned on by default (the reverse of 3.0
where it is off, but you can and should turn it on).<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span>Rocky<o:p></o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span><o:p>&nbsp;</o:p></span></p>

<div>

<p class=MsoNormal><b><span>From:</span></b><span> FatPigeon
[mailto:cslanet@lhotka.net] <br>
<b>Sent:</b> Wednesday, January 23, 2008 7:12 AM<br>
<b>To:</b> rocky@lhotka.net<br>
<b>Subject:</b> Re: [CSLA .NET] RE: RE: RE: RE: DataGridView Child not Saved on
Form Close<o:p></o:p></span></p>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Thanks
for the pointer Rocky; I think I have solved it.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>No
your ERLBTest project does not exhibit the problem.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Your
ERLBTest project had CslaAutoCloneOnUpdate set to True. As soon as I did this
in my project the problem went away.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>I
think this is because the ERLB creates a clone of the business object in the
SaveItem method if this config item is not set to true. The BindingEdit flag on
the business object is set to false after the call to AcceptChanges in
BusinessBase.ApplyEdit i.e. after the clone has been created. So the
BindingEdit flag is still true in the cloned object that is now in the
collection. Next time the row is visited a snap shot is not taken during the
call to IEditableObject.BeginEdit as BindingEdit is still true.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Does
this make sense? If so, is it easy to say why the ERLB takes this clone if
CslaAutoCloneOnUpdate is not set?<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Regards,<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Patrick<o:p></o:p></p>

<p class=MsoNormal><br>
<br>
<o:p></o:p></p>

</div>



</div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
