<html><header><title>Variable qty of Columns in Table and Object creation</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Variable qty of Columns in Table and Object creation</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2584.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel posted on Saturday, March 24, 2007</h2>Hi everybody,<br><br>I am a new in CSLA framework development.<br><br>In my current project users can add a custom field to any existing objects(for Labour it could be Room, for Project it could be some custom classification and so on...).<br><br>So, I never knew how many properties user can use or create.<br><br>What would be the right approach to create CSLA object ?<br><br>In ProjectTracker project the number of fields is permanent and it's not acceptable in my case.<br><br>Thanks,<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Saturday, March 24, 2007</h2>Hi!<br><br>The Golden Rule Of a DBA's Thumb: <br>- ALL dynamics should go in 'vertical' direction, that is: your records (rows), NEVER in your fields (columns).<br><br>Why?<br><br>Numerous reasons:<br>- enabling users to add/remove columns (e.g. using stored procs) makes that the structure of your DB is suddenly dynamic (!)<br>&nbsp;&nbsp;&nbsp; - how to work with backups/restores?<br>&nbsp;&nbsp;&nbsp; - how to work with replication/mirroring (if you might ever wish to do this)?<br>&nbsp;&nbsp;&nbsp; - how to work with fields, which come and go or change name at any time, in your SQL?<br>So, that's why. ;-)<br><br>The solution is to put these dynamic fields in a child-table, where each record (i.e. row, instead of column) denotes a user-defined property on your object. This child-table would have (fixed) columns for the name, value, datatype, etc.<br><br>The next challenge is with your databinding, since you want these rows in the child-table to appear as columns in your grid-control. This implies you will have to add columns to your grid manually and also you will have to load the values for these columns into your grid manually. Note that behind the scenes you can still use databinding, it's just that you have to route part of the data by yourself. Using the datatype column of your child-table you could then figure out what kind of column to render for this particular field (dropdown, checkbox, textbox, etc). Also it could happen that you have columns which do not apply to all of your objects that are displayed in the grid, in that case you would have to disable (gray-out) these cells.<br><br>I have had to use 'custom columns' in several places in my current app, so I can say from experience that it can be made to work. I found it very convenient to make use of reflection here and there, if you wish I could dig out some piece of code for you.<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Saturday, March 24, 2007</h2>Thanks Bayu,<br><br>That is what I wanted to hear from guru of this forum.<br><br>You are right that creation of a child-table with all columns info would be flexable to add/delete columns.<br>So, what happend with our original table where all data(and even for a new column) should be kept? <br>Some column has to be added anyway to original table to accept a new entries from users.....if you don't mind showing me some code to handle new columns using parent and child-table approach.<br>It would make it easy to clarify your approach.<br><br>Thanks a lot,<br>Pavel<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Sunday, March 25, 2007</h2>I read all related topics that I found on Rocky's forum.<br>I still have a question about stracture of object creation itself.<br>What to do if I cannot define property&nbsp; during a design-time?<br>How to define a validation rule for a run-time defined property?<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, March 26, 2007</h2>Well, if you can't define the property at design time, you'll need to do so at runtime using Reflection and compiler services.&nbsp; Likely, you'll need to have your code inherit from the class, add the appopriate properties, and define an overload for AddBusinessRules (which will also call the base implementation of the method, to get the rules that can be defined there).<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Saturday, May 05, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>Well, if you can't define the property at design time, you'll need to do so at runtime using Reflection and compiler services.&nbsp; Likely, you'll need to have your code inherit from the class, add the appopriate properties, and define an overload for AddBusinessRules (which will also call the base implementation of the method, to get the rules that can be defined there).<br><br></div></BLOCKQUOTE><br><br>So, how I see it....<br>I create my base class as a regular CSLA EmployeeBase class.<br>Lets assume that we Alter table with a new field with name NewField.<br>If&nbsp; user create an extra field in Employee table, I create a new Employee class(inherited from EmployeeBase) using CodeDom class to generate a new Public Property NewField().<br>I also have to overload AddBusinessRule to apply it to a new property name.<br>Is that right?<br>If so, could you give some ideas regarding DataPortal and database Prosedures or SQL queries to get data from Employee table.<br>Thanks a lot,<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Thursday, May 03, 2007</h2><a>Bayu</a>,<br>
<br>
It's nice implementation, but how you deal with Data types such as Boolean or Date?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Friday, May 04, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>Pavel:</strong></div><div><a>Bayu</a>,<br>
<br>
It's nice implementation, but how you deal with Data types such as Boolean or Date?</div></BLOCKQUOTE><br><br>Imo, the only way to store arbitrary values, i.e. of whichever datatype, in a uniform way is by using text-columns in your DB. The datatype is designated in an additional column, using a enumerated value or foreign key or you could use the fully qualified name of the .Net type. I use a NameValueList, so a foreign key to a small, two column table with all my supported datatypes.<br><br>Subsequently, .NET reflection is the way to go:<br>- you can load the value from the DB into a string<br>- based on the datatype-field you determine the desired destination Type<br>- for this type you can obtain the TypeConverter, which is the object that will do all the magic for you<br><br>The TypeConverter has CanConvertFrom and ConvertFrom members using which you can check and perform the conversion from a string to your destination type. Using the ConvertTo (and CanConvertTo) you can do the conversion the other way around back to a string that can be stored in your DB.<br><br>If you put this logic in a generic method which can convert strings to arbitrary destination types, it will look something like this:<br><br>Imports System.ComponentModel<br>Imports System.Reflection<br><br>Public Class ConverterDemo<br><br>&nbsp;&nbsp;&nbsp; Protected Overridable Function GetStrongTypedValue(Of TReturnType)(ByVal input As String) As TReturnType<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim result As TReturnType = Nothing<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not String.IsNullOrEmpty(input) Then<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim converter As TypeConverter = TypeDescriptor.GetConverter(GetType(TReturnType))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If converter.CanConvertFrom(GetType(String)) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = DirectCast(converter.ConvertFrom(input), TReturnType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return result<br><br>&nbsp;&nbsp;&nbsp; End Function<br><br>End Class<br><br><br><br>In order to get a date or boolean (or anything you support from a string you would call:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim tool As New ConverterDemo<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim oDate As DateTime = tool.GetStrongTypedValue(Of DateTime)(input)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim oBool As Boolean = tool.GetStrongTypedValue(Of Boolean)(input)<br><br><br><br>Good luck!<br>Bayu<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, May 04, 2007</h2><P><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Bayu:</strong></div><div>Imo, the only way to store arbitrary values, i.e. of whichever datatype, in a uniform way is by using text-columns in your DB.</div></BLOCKQUOTE></P>
<P>If you're using Sql Server 2000 or above (possibly 7), there's a sql_varient column that can hold any known sql type.&nbsp; Behind the scenes sql server stores the value as normal (ints get stored as ints, nvarchars as nvarchars, etc).&nbsp; That could be more effiecent than storing everything as string... especially if you need to store binary data in there.</P>
<P>HTH</P>
<P>Andy</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Friday, May 04, 2007</h2>Thanks a lot,<br><br>I am almost there to make a try with my project.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Pavel replied on Friday, May 04, 2007</h2>One more question regarding BO creation, since this forum is all about Business Objects...<br><br>Some of my object properties are hardcoded in&nbsp; my Employee class as usual.<br>Then for my dynamic fields I intend to create a collection of properties in the same class based on what is created in the database as a custom fields.<br><br>Is that a rigth approach? Or how you handle dynamic fields in your application?<br><br>The second,<br><br>I would like to show and edit the properties of employee in PropertyGrid control.<br>If you have any idea how more difficult it would be to use this control compare to GridView, please share your opinion about that too.<br>There is a PropertyGridEx control I found on CodeProject&nbsp; that looks quite able to do what I need.<br><br>Pavel<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
