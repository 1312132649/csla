<html><header><title>Undo with parent-child-grandchild object graph</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Undo with parent-child-grandchild object graph</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/4702.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea posted on Thursday, April 17, 2008</h2><P>Hi</P>
<P>I am a bit new to this... I have the following object graph:</P>
<P>Customer (Parent - BusinessBase)<BR>&nbsp;&nbsp;&nbsp;InvoiceList (Child - BusinessBaseList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoice (Child - BusinessBase)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLineList (Grandchild - BusinessBaseList)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InvoiceLine (Grandchild - BusinessBase)</P>
<P>Now on the UI I have 2 grids, 1 for all invoices and 1 for the invoice lines of the selected invoice. I have a plus button on top of both grids. When pressed, they bring up a dialog which allows them to edit either the new Invoice or InvoiceLine. But the dialog has an "OK" and a "Cancel" button. When "OK" then the Invoice/Invoice line is added, when "Cancel" then undo the addition of the Invoice/InvoiceLine.<BR>What I tried to do is the following (in the Invoice example):</P>
<P>_customer.BeginEdit();<BR>Invoice invoice = _customer.Invoices.AddNew();<BR>&lt;...&nbsp;Display invoice on dialog. Return "Cancel" from dialog&nbsp;...&gt;<BR>if (dialogResult == "Cancel")<BR>&nbsp;&nbsp;&nbsp;_customer.CancelEdit()<BR>else<BR>&nbsp;&nbsp;&nbsp;_customer.ApplyEdit();</P>
<P>This didnt work. No errors but _customer still contains the new Invoice in its list. I tried various variations of the same theme but am either gettign errors or nothing happens. I have the 3.0 ebook in front of me but when it comes to child hierarachy then Begin/Cancel edit is called on the parent then the individual child. Is my approach completlty wrong or did I miss something out?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>triplea replied on Thursday, April 17, 2008</h2><P>I saw this very recent post: <A HREF="/forums/thread/22867.aspx">http://forums.lhotka.net/forums/thread/22867.aspx</A></P>
<P>This seems to be the golden rule: <STRONG><EM>Never directly interact with a business object while it is data bound - only interact with the bindingsource.</EM></STRONG></P>
<P>Which is cool. But in the case above what should happen? Say we have the following bindingSources:<BR><BR>customerBindingSource (for parent Customer)<BR>invoicesBindingSource (which binds to customerBindingSource and datamember Invoices)<BR>invoiceLinesBindingSource (which binds to invoicesBindingSource and datamember Invoice)</P>
<P>Doing the following again produces no result (or error):</P>
<P>customerBindingSource.EndEdit();<BR>&lt;...&nbsp;get the Customer from customerBindingSource and add an Invoice to its list&nbsp;...&gt;<BR>customerBindingSource.CancelEdit();</P>
<P>I think my approach is a bit blind (trying different approaches without actually knowing the results) so might be going round in circles here...</P>
<P>Forgot to mention I am using CSLA 3.0.3</P>
<P>Any help would be greatly appreciated :-)</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
