<html><header><title>Issue with BusinessListBase during special circumstance.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Issue with BusinessListBase during special circumstance.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1496.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo posted on Monday, October 16, 2006</h2><P class=MsoNormal>I have a collection that contains objects that define a SortOrder property. The purpose of this SortOrder property is to let the users of the collection know what the position of the objects should when they are displayed on a list or report. </P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>For example, the object with SortOrder = 1 should be listed before the object with SortOrder = 2 etc.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>The user has the ability to delete any object from the collection but every time an object is deleted, all of the SortOrder values must be adjusted so that there are no gaps between them. </P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>For example if a child object with SortOrder number = 2 is deleted then the child object with SortOrder = 3 will be modified to have its SortOrder = 2, the child object with SortOrder = 4 will be modified to have its SortOrder = 3 etc.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>It should also be mentioned that the collection exposes a method that allows the user to change the sort order of the objects. This is basically accomplished by swapping two SortOrder values.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Ok, now let’s get to the problem. The BusinessListBase object exposes the Remove() and RemoveAt() inherited methods, as we all know these methods are there to allow you to delete collection objects. The problem with these methods is that they are public and are not virtual so there is no way to override them and add the necessary code on them to adjust the SortOrder values as these methods are being called. </P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>In order to get around this limitation, I am overriding the “void RemoveItem(int index)” method&nbsp;of the collection and adding all the necessary code to do the adjustment to the SortOrder values there.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>For the most part, everything works pretty well except that when the time comes to do a CancelEdit all hell breaks loose. This is because while the undoing is happening, any objects marked as new in the collection is removed and in turn the RemoveItem method that I overrode is being called and I get errors because as the undoing is going on the state ob the object is undetermined.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Personally, I think this is a bug in the CSLA because in my opinion, none of the collection virtual methods should be fired when a CancelEdit is happening. This is because all that we are doing is restoring the previous state.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Of course, we all know that you can’t just whish for the methods you override not to be called so how are we supposed to solve this issue?</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Well, I propose to seal all of these methods at the BusinessListBase so that they can’t be overridden:</P>
<P class=MsoNormal><SPAN></SPAN>&nbsp;</P>
<P class=MsoNormal><SPAN>protected</SPAN><SPAN> <SPAN>virtual</SPAN> <SPAN>void</SPAN> ClearItems();</SPAN></P>
<P class=MsoNormal><SPAN>protected</SPAN><SPAN> <SPAN>virtual</SPAN> <SPAN>void</SPAN> InsertItem(<SPAN>int</SPAN> index, T item);</SPAN></P>
<P class=MsoNormal><SPAN>protected</SPAN><SPAN> <SPAN>virtual</SPAN> <SPAN>void</SPAN> RemoveItem(<SPAN>int</SPAN> index);</SPAN></P>
<P class=MsoNormal><SPAN>protected</SPAN><SPAN> <SPAN>virtual</SPAN> <SPAN>void</SPAN> SetItem(<SPAN>int</SPAN> index, T item);</SPAN></P>
<P class=MsoNormal><SPAN></SPAN>&nbsp;</P>
<P class=MsoNormal>and create a new set of methods that can be overridden. After doing that , we should add code to the BusinessListBase class so that these methods are not called when a CancelEdit is being performed.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Does this make sense? Is this a real problem or am I going through an acid flashback?</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Thanks.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cash_pat replied on Monday, October 16, 2006</h2>&nbsp;&nbsp;&nbsp; <font color="#0000ff">Public Overloads Sub Remove(ByVal TranID As Guid)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Each Obj As Transaction In Me<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Obj.TransactionID = TranID Then<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim Pos As Integer = Me.IndexOf(Obj)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Remove(Obj)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For i As Integer = Pos To Me.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(i).SortOrder = i + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit For<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Protected Overrides Function AddNewCore() As Object<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim _child As Transaction = Transaction.NewChild<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _child.SortOrder = Me.Count + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; Add(_child)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return _child<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Function</font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Monday, October 16, 2006</h2><P class=MsoNormal><STRONG>cash_pat, </STRONG>I appreciate your response however, I wasn’t really looking for a workaround to do what I need to do since I already have a way to accomplish it.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>The primary purpose of my post was to expose what I consider to be a flaw on the CSLA. What I would like to hear is opinion from other people regarding if my thoughts are somewhat right or wrong and if the CSLA should account for the problem I describe above.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Monday, October 16, 2006</h2>Why are you sorting on some arbitrary numbers instead of values in the list?&nbsp; What I mean is why are you sorting by a manually maintained sort order instead of a string, date, etc. in the list?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rxelizondo replied on Monday, October 16, 2006</h2><P class=MsoNormal>The SortOrder property is what dictates the sorting of the collection objects in the UI, this values are there to allow the user to arrange the collection anyway he or she pleases and be able to persist the value so when they come back and see the same info the sorting of the collection object will remain the same.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>If you are asking why am I not using the physical order of the collection as my sorting criteria is because there is no way (at least I don’t know of none) to be able to swap object on a collection, furthermore, the CSLA will not remember the physical position of an object on the list when the transaction is undone and a child objects has to be restored on the original collection.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Brian, do you agree with me that the methods:</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>protected virtual void ClearItems();</P>
<P class=MsoNormal>protected virtual void InsertItem(int index, T item);</P>
<P class=MsoNormal>protected virtual void RemoveItem(int index);</P>
<P class=MsoNormal>protected virtual void SetItem(int index, T item);</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>should not be fired during cancel edit? Think about it, when you are undoing things you are asking the CSLA to restore the object to a previous state so these event are not applicable during that time because while restoring takes place the object is on an undetermined state and you should not be running your typical business logic during that time.</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P>
<P class=MsoNormal>Do you agree?</P>
<P class=MsoNormal><o:p>&nbsp;</o:p></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Monday, October 16, 2006</h2><P>From my Codesmith Templates I sometimes add these 2 methods if I have a field for LineNumber.</P>
<P>e.g. A list of invoice lines and each has a line number. I can Move an Item up or down the list by calling one of these methods.</P>
<P>===================================================================</P>
<P>&nbsp;'method to move a selected child up one position in the collection (requires swapping and re-numbering.)<BR>&nbsp;&nbsp;&nbsp; Public Function MoveUp(ByVal obj As &lt;%= ItemName %&gt;) As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Contains(obj) Then Throw New Exception("Item does not exist in the List")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim position As Integer = IndexOf(obj)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'do not move it up if it is already the first item<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If position &gt; 0 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'store a reference to the previous item<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim prevItem As &lt;%= ItemName %&gt; = Me.Item(position - 1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'avoid having the same object in both locations in our List<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position) = CType(New Object, &lt;%= ItemName %&gt;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'do the swap<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position - 1) = obj<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position) = prevItem<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'set the new positions in the objects<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prevItem.&lt;%= LineNoFieldName %&gt; = (position + 1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.&lt;%= LineNoFieldName %&gt; = (position)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return position - 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return position<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>===================================================================</P>
<P>&nbsp;&nbsp;&nbsp; 'method to move a selected child up one position in the collection (requires swapping and re-numbering.)<BR>&nbsp;&nbsp;&nbsp; Public Function MoveDown(ByVal obj As &lt;%= ItemName %&gt;) As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Contains(obj) Then Throw New Exception("Item does not exist in the List")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim position As Integer = Me.IndexOf(obj)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'do not move it down if it is already the last item<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If position &lt; (Count - 1) Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'store a reference to the next item<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim nextItem As &lt;%= ItemName %&gt; = Me.Item(position + 1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'avoid having the same object in both locations in our List<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position) = CType(New Object, &lt;%= ItemName %&gt;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'do the swap<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position + 1) = obj<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Item(position) = nextItem<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'set the new positions in the objects<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nextItem.&lt;%= LineNoFieldName %&gt; = (position + 1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.&lt;%= LineNoFieldName %&gt; = (position + 2)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return position + 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return position<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; End Function</P>
<P>===================================================================</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Michael replied on Wednesday, October 14, 2009</h2><font face="Verdana" size="2">Hi Joe and everyone else<br><br>I've implemented the the move up and down, but I've had to access the protecte<font color="#000000">d </font><font color="#000000" face="Courier New">Items</font> collection in BLB to get it to work properly as suggested here: <a HREF="/forums/thread/11842.aspx">http://forums.lhotka.net/forums/thread/11842.aspx</a>.<br><br>When the BLB is bound to binding source and I do the swap by indexing directly into the BLB via <font face="Courier New">this[]</font> I get EditLevelMismatchException on Save.<br><br>Is the Items solution acceptable? Are there any unwanted side effects with N-level undo etc?<br><br>Thanks for your help<br>Michael<br><br><br></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Tuesday, October 17, 2006</h2>My question was more along the line of whether or not there was some aspect of the data other than the SortOrder that you could base your sort on, but it seems like you have a use case for allowing users to set an arbitrary sort.&nbsp; Personally, I would go more towards something that Joe has shown as it would work with N-Level undo instead of fighting it.&nbsp; You will need to take a snapshot of the whole collection and not just a single item, because changing one item will shift the others.<br><br>I really think this is a case where you have a specific use case that requires you to add some functionality, but that modification should not be at the core of how BusinessListBase works.&nbsp; I do not agree that those methods should not be called as they are central to how n-level undo works on BusinessListBase.&nbsp; CancelEdit() calls the RemoveAt and Add methods on the base list.&nbsp; BindingList&lt;T&gt; then calls InsertItem, RemoveItem, etc. to give you an opportunity to modify the behaviour of the Insert, Remove, etc.<br><br>CancelEdit() should put your list back the way it was before the corresponding ApplyEdit().&nbsp; I think that all you really need is to know whether or not you are in a cancel and not adjust the SortOrder properties during a cancel.&nbsp; If your list has a parent object, the parent could set the property on the list as to when it is in a cancel process.&nbsp; Otherwise, you might have a small hack to make to BusinessListBase.UndoChanges to make it overrideable.&nbsp; You can then have it set and clear whether it is in a cancel.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Harrison replied on Tuesday, October 17, 2006</h2><P>I accomplished the same thing in a&nbsp;couple different projects.&nbsp; I created a property called "SeqNo" that is the&nbsp;same as your "SortOrder". Whenever "SeqNo" is changed in BaseObject, an event is raised to let the list know that something has changed.&nbsp; This allows doing things like&nbsp; <BR>&nbsp; <STRONG>list(1).SeqNo = 1 </STRONG>and the list resequences the items to move the specified object to the top of list.&nbsp;Not sure how this code would work in the canceledit situation.&nbsp;</P>
<P>Here's the basics</P>
<P>In the BusinessBase object.....</P>
<P><FONT face="Courier New" size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Event BeforeSeqNoChange(ByVal obj As BaseObject, ByRef NewSeqNo As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Public Overridable Property SeqNo() As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mSeqNo<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal Value As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mSeqNo &lt;&gt; Value Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent BeforeSeqNoChange(Me, Value)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mSeqNo = Value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Insert the Rule for the column here ..........<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'BrokenRules.Assert("", "Rule for SeqNo has been Broken.", "SeqNo", False)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MarkDirty()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Property</FONT></P>
<P>And in the BusinessBaseList object....</P>
<P><FONT face="Courier New" size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Private Sub HandleSeqNoChange(ByVal obj As BaseObject, ByRef NewSeqNo As Integer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mIgnoreSeqNoChanges Then Return<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim ix As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim existingSeqNo As Integer<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If NewSeqNo &lt; 1 Then NewSeqNo = 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If NewSeqNo &gt; list.Count Then NewSeqNo = List.Count<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' --- here we go<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mIgnoreSeqNoChanges = True&nbsp; ' don't call the event every time we make a change here...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; existingSeqNo = obj.SeqNo<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.SeqNo = -2&nbsp; ' so that we don't change it here....<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If NewSeqNo &gt; existingSeqNo Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For ix = existingSeqNo + 1 To NewSeqNo<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ItemBySeqNo(ix).SeqNo = ix - 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For ix = existingSeqNo - 1 To NewSeqNo Step -1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ItemBySeqNo(ix).SeqNo = ix + 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.SeqNo = NewSeqNo<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mIgnoreSeqNoChanges = False&nbsp; ' look for SeqNo changes again<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub<BR></FONT><FONT face="Courier New" size=1></FONT></P>
<P><FONT face="Courier New" size=1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' same sort of thing also done on fetch..<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT face="Courier New" size=1>Public Sub Add(ByVal obj As BaseObject)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not Contains(obj) Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List.Add(obj)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler obj.BeforeSeqNoChange, AddressOf HandleSeqNoChange<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Sub</FONT></P>
<P><FONT face="Courier New" size=1>&nbsp;</P></FONT>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
