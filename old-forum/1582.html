<html><header><title>Binding polymorphic collection in ASP.Net</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Binding polymorphic collection in ASP.Net</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1582.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Tuesday, October 24, 2006</h2><P>I would love to know if anyone else has accomplished this using a CSLA polymorphic collection.</P>
<P>I have a collection of say, IProfileRole. (of which I might have various types implementing IProfileRole).</P>
<P>ASP.Net responds to databinding to a GridView in ASP.Net: <STRONG>object does not match target type</STRONG></P>
<P>I have not found the appropriate solution, and I suspect some of you have. Would you please share if you have? </P>
<P>Thank you. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, October 24, 2006</h2><P>Just playing around with it a little bit more tonight, it seems like using a collection of polymorphic objects using inheritance&nbsp;with an ASP.Net Gridview but once I change it to be an interface it no longer works. </P>
<P>i.e. if I have car and truck as derived classes of auto and a collection of auto, I can bind this collection containing both types of autos to a GridView. But if car and truck implement IAuto and my collection is of IAuto, binding a collection with different types of IAutos fails. </P>
<P>Obviously since with CSLA interfaces are a popular way polymorphism is implemented and using inheritance for polymorphism not there with generics, the hands are tied a little. </P>
<P>So if anyone has successfully did binding to a grid with an interface collection using ASP.Net, please let me know how you accomplished it, I'd be very appreciative. </P>
<P>Thanks. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 25, 2006</h2>Does your interface also specify that it must implemnt IEditableBusinessObject or IReadOnlyObject?<br><br>For example:<br><br><font color="#0000ff">public interface</font> <font color="#008000">IMyInterface </font>: Csla.Core.<font color="#008000">IEditableBusinessObject </font>{<br><font color="#006400">// interface definition here</font><br>}<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, October 25, 2006</h2><P>Yep, that's not the problem - it's an ASP.Net GridView issue that I've found scattered posts about. One mentioning ITypedList but I'm not sure that's the trick (maybe I'm implementing it incorrectly as I tried that direction).</P>
<P>Thanks for the thought though. </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 25, 2006</h2>Well some more code from your application would be helpful then.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, October 25, 2006</h2><P><FONT face=Arial size=2>Here are the classes/interface:</FONT></P>
<P><FONT face=Arial size=2>IBase has two properties, Shared1 and Shared2. </FONT></P>
<P><FONT face=Arial size=2>ClassA and ClassB implement IBase and have one other property other than the two in IBase.</FONT></P>
<P><FONT face=Arial size=2>I used a simple BindingList&lt;T&gt;&nbsp;&amp; non-CSLA&nbsp;to keep things really simple - the same thing happens with CSLA objects &amp; collections. </FONT></P>
<P><FONT face=Arial size=2>Then, just creating a Web site with one page containing a GridView and a button, and placing this code in the button clicked:</FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#008080>MyCollection</FONT> test = <FONT color=#0000ff>new</FONT> <FONT color=#008080>MyCollection</FONT></FONT><FONT face=Arial>();</FONT></FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#008080>ClassA</FONT> a = <FONT color=#0000ff>new</FONT> <FONT color=#008080>ClassA</FONT></FONT><FONT face=Arial>();</FONT></FONT></P>
<P><FONT face=Arial size=2>a.Shared1 = 1;</FONT></P>
<P><FONT face=Arial size=2>a.Shared2 = 2;</FONT></P>
<P><FONT face=Arial size=2>a.ClassAvar = 3;</FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#008080>ClassB</FONT> b = <FONT color=#0000ff>new</FONT> <FONT color=#008080>ClassB</FONT></FONT><FONT face=Arial>();</FONT></FONT></P>
<P><FONT face=Arial size=2>b.Shared1 = 55;</FONT></P>
<P><FONT face=Arial size=2>b.Shared2 = 66;</FONT></P>
<P><FONT face=Arial size=2>b.ClassBvar = 77;</FONT></P>
<P><FONT face=Arial size=2>test.Add(a);</FONT></P>
<P><FONT face=Arial size=2>test.Add(b);</FONT></P>
<P><FONT size=2><FONT face=Arial>GridView1.DataSource = test;</FONT></FONT></P>
<P><FONT face=Arial><FONT size=2><FONT color=#000000>GridView1.DataBind();</FONT></FONT></FONT></P>
<P><FONT size=2><FONT face=Arial>It will fail, giving that error message from my first post. "Property accessor 'Shared2' on object 'ClassLibrary3.ClassB' threw the following exception:'Object does not match target type.'" &nbsp;This does not occur in a Windows grid - Windows databinding is more intelligent in this regard it seems. </FONT></FONT></P>
<P>The classes are shown below: </P><FONT face=Arial><FONT size=2><FONT color=#0000ff><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>interface</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>IBase</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared1 {</FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2>;</FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2>;}</P>
<P></FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared2 { </FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2>;</FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2>;}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ClassA</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>IBase</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _classAvar;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> ClassAvar</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2> { </FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _classAvar; }</P>
<P></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2> { _classAvar = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>; }</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _shared1;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared1</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _shared1;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P>_shared1 = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _shared2;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared2</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _shared2;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P>_shared2 = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>ClassB</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>IBase</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _classBvar;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> ClassBvar</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2> { </FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _classBvar; }</P>
<P></FONT><FONT color=#0000ff size=2>set</FONT><FONT size=2> { _classBvar = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>; }</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _shared1;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared1</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _shared1;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P>_shared1 = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> _shared2;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>int</FONT><FONT size=2> Shared2</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</P></FONT><FONT size=2>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _shared2;</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P>_shared2 = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P>}</P>
<P>}</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>class</FONT><FONT size=2> </FONT><FONT color=#008080 size=2>MyCollection</FONT><FONT size=2> : </FONT><FONT color=#008080 size=2>BindingList</FONT><FONT size=2>&lt;</FONT><FONT color=#008080 size=2>IBase</FONT><FONT size=2>&gt;</P>
<P>{</P>
<P>}</P></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, October 25, 2006</h2>The interface IBase doesn't inherit Csla.Core.IEditableBusinessObject.&nbsp;&nbsp; At least in the code you show it doesn't.&nbsp; Try making suer it does that, and have the collection inherit from BusinessListBase, I think you'll have more success that way (and I assume you want to use Csla, or you wouldn't be here).&nbsp; Also, make sure ClassA and B inherit BusinessBase (while still implementing your interface).<br><br>Those base classes provide a bunch of support for databinding, which none of your code supports (for example, none of your objects implement IPropertyChanged, which BusinessBase does).<br><br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, October 25, 2006</h2><P>Thanks Andy, though I have basically broken this down to a common denominator. I have definitely been utilizing CSLA and my first encounter with this had to do with a polymorphic businesslistbase. If one changes the collection to utilize polymorphism with inheritance rather than interfaces, it works. </P>
<P>My sample is basically the "lowest denominator" of code that I can have it exhibit this error.&nbsp;The bottom line appears to be that unless <EM>extra</EM> accomodations (beyond what IEditableObject and such may give one) made to support data binding with the GridView, collections of interfaces cannot be bound to an ASP.Net GridView if there are differing object types underlying the interface collection. </P>
<P>From what I've read it detects the property set from the first object in the collection, and then when it finds that the second object isn't the same type, it gives the error. You'll note the error hits with the ClassB instance. </P>
<P>If I find the solution I will certainly post it here! </P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
