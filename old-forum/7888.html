<html><header><title>wpf and databinding</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>wpf and databinding</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7888.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>fli1973 posted on Tuesday, October 27, 2009</h2>I have a wpf app with a bound combo box.<br />The combo box lists Manufacturers.<br />Ford<br />Chevy<br />GM<br /><br />I am trying to update the combo box when a new manufacturer is added to the database. I use a BusinessListBase object to populate my combo box. Here is the binding code.<br /><br />-------------data provider Begin-----------<br />                                 ObjectType="{x:Type QuickQuote:Manufacturers}"<br />                               FactoryMethod="GetManufacturers"<br />                               IsInitialLoadEnabled="True"<br />                               /><br /><br />---------------data provider end---------------<br /><br />-----------------combo box begin--------------<br />                             ItemsSource="{Binding Source={StaticResource ManufacturerDropDown}}" DisplayMemberPath="ManufacturerName" SelectedValuePath="Id"/><br /><br />----------------combo box end-----------------<br /><br />What am I doning Wrong here?<br /><br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 28, 2009</h2><P>Are you reloading the collection object to get the new data from the database? Or is that the collection you are directly editing? And if that is the collection you are editing, are you editing it by using the same data provider?</P>
<P>The data provider should notify the UI controls when the business object is changed or saved, but that only works if everything is bound to the same data provider.</P>
<P>The CslaDataProvider control has Refresh() and Rebind() methods. Refresh() reloads the data by invoking the factory method again. Rebind() just resets the UI bindings to get the UI to update its display.</P>
<P>It is possible that the ComboBox control doesn't automatically rebind when the data provider changes. I don't know one way or the other, but it that is possible - in which case calling Rebind() might solve the issue.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fli1973 replied on Wednesday, October 28, 2009</h2>Thank you for the response. I am not directly editing the collection. I have a different BO that handles adding a new manufacturer.<br /><br />----------------------------------------------------------<br /> BusinessLayer.Library.Admin.Manufacturer _man = BusinessLayer.Library.Admin.Manufacturer.NewManufacturer();<br />            _man.ManufacturerName = Txt_Manufacturer.Text;<br />            _man.City = Txt_City.Text;<br />            _man.State = Txt_State.Text;<br />            _man.Zip = Txt_Zip.Text;<br />            _man.Address = Txt_Address.Text;<br />            _man.Phone1 = Txt_Phone1.Text;<br />            _man.Phone2 = Txt_Phone2.Text;<br />            _man.Contact_First_Name = Txt_FirstName.Text;<br />            _man.Contact_Last_Name = Txt_LastName.Text;<br />            _man.Email = Txt_Email.Text;<br />            _man.Save();<br />            this.Close();<br />            MainWindow _main = new MainWindow();<br />            _main.ManufacturerDropDown();<br /><br />----------------------------------------------------------<br /><br />Immediately after adding the new manufacturer I call a method that refreshes my combo box.<br /><br /> public void ManufacturerDropDown()<br />        {<br /> Csla.Wpf.CslaDataProvider _dp = this.FindResource("ManufacturerDropDown") as Csla.Wpf.CslaDataProvider;<br />           _dp.Refresh();<br />           _dp.Rebind();<br />}<br /><br />The refresh does reload my data, but I cant get it to refresh my combo box.<br /><br />I am sure it is something simple that I have been overlooking.<br /><br />Thanks again for you help</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardb replied on Wednesday, October 28, 2009</h2><P>I use a NameValueListBase object for showing items in a combo rather than a BusinessListBase.&nbsp; Is there any other reason why you want BusinessListBase?</P>
<P>I'd typcially have separate Manufacturers and Manufacturer objects for maintaining those records.&nbsp; Then, when a manufacturer was added, updated or removed from the database I'd get it to InvalidateCache on the ManufacturerNVList so next time the updated list would be retrieved from the database.</P><FONT color=#0000ff size=1><FONT color=#0000ff size=1>
<P></FONT></FONT>
<P><FONT color=#0000ff size=1><FONT color=#0000ff size=1></P></FONT></FONT></P><FONT color=#0000ff size=1><FONT color=#0000ff size=1>
<P><FONT size=2>&lt;</FONT></FONT></FONT><FONT size=2><FONT color=#a31515><FONT color=#a31515>csla</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>:</FONT></FONT><FONT color=#a31515><FONT color=#a31515>CslaDataProvider</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> x</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>:</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>Key</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="SectorsList" </FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>ObjectType</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="{</FONT></FONT><FONT color=#a31515><FONT color=#a31515>x</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>:</FONT></FONT><FONT color=#a31515><FONT color=#a31515>Type</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> POSTracker</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>:</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>SectorsList</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>}"<BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>FactoryMethod</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>="GetList"<BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>IsAsynchronous</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="True" /&gt;</FONT></FONT></FONT></P>
<P><FONT color=#0000ff size=1><FONT color=#0000ff size=1><FONT color=#0000ff><FONT color=#0000ff><FONT size=2>&lt;</FONT></FONT></FONT><FONT size=2><FONT color=#a31515><FONT color=#a31515>ComboBox</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Grid.Row</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="0"</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Grid.Column</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="1" </FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>Name</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>="cboSector"<BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>ItemsSource</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="{</FONT></FONT><FONT color=#a31515><FONT color=#a31515>Binding</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Source</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>={</FONT></FONT><FONT color=#a31515><FONT color=#a31515>StaticResource</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> SectorsList</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>}}"</FONT></FONT> <BR><FONT color=#ff0000><FONT color=#ff0000>DisplayMemberPath</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>="Value"<BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>SelectedValuePath</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>="Key" <BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>SelectedValue</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="{</FONT></FONT><FONT color=#a31515><FONT color=#a31515>Binding</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Path</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>=SectorID}"<BR></FONT></FONT> <FONT color=#ff0000><FONT color=#ff0000>Width</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="150"</FONT></FONT> <FONT color=#ff0000><FONT color=#ff0000>IsEnabled</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="True"</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>/&gt;</P></FONT></FONT></FONT><FONT color=#a31515><FONT color=#a31515>
<P></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>&lt;</FONT></FONT><FONT color=#a31515><FONT color=#a31515>csla</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>:</FONT></FONT><FONT color=#a31515><FONT color=#a31515>PropertyStatus</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Property</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="{</FONT></FONT><FONT color=#a31515><FONT color=#a31515>Binding</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Path</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>=SectorID,</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Mode</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>=TwoWay}"</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> Grid.Row</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="0"</FONT></FONT><FONT color=#000000> </FONT><FONT color=#ff0000><FONT color=#ff0000>Grid.Column</FONT></FONT></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>="2"<BR></FONT></FONT><FONT color=#ff0000><FONT color=#ff0000>TargetControl</FONT></FONT><FONT color=#0000ff><FONT color=#0000ff>="{</FONT></FONT><FONT color=#a31515><FONT color=#a31515>Binding</FONT></FONT><FONT color=#ff0000><FONT color=#ff0000> ElementName</FONT></FONT><FONT color=#0000ff size=1><FONT color=#0000ff size=1>=cboSector}" /&gt;</P></FONT></FONT></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fli1973 replied on Wednesday, October 28, 2009</h2>Thank you for the response. I just setup a NameValueList instead of businessListBase with the same results. I cant get the combo box to display the new data. <br /><br />------------------------------<br />                                ObjectType="{x:Type QuickQuote:DD_Manufacturer}"<br />                               FactoryMethod="GetList"<br />                               IsInitialLoadEnabled="True"<br />                               /><br />        <br />-----------------------------------------------------<br /><br />----------------------------------------------------<br />                              ItemsSource="{Binding Source={StaticResource ManufacturerDropDown}}" DisplayMemberPath="Value" SelectedValuePath="Key" /><br />--------------------------------------------------------<br /><br />After adding a new Manufacturer I call this method<br /><br />----------------------------------------<br />  public void ManufacturerDropDown()<br />        {<br />     Csla.Wpf.CslaDataProvider _dp = this.FindResource("ManufacturerDropDown") as Csla.Wpf.CslaDataProvider;<br />           _dp.Refresh();<br />           _dp.Rebind();<br />}<br /><br />-------------------------------------------------<br /><br />Is this the correct way to invalidate the list?<br /><br />Thank you so much for the help.<br /></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 28, 2009</h2>Using the debugger, can you confirm that the list ends up with the new data?<br /><br />In other words, let's try to narrow down the problem - first making sure<br />that the list actually does have the updated data.<br /><br />That'll help identify whether the problem is a simple data access issue, or<br />something to do with XAML binding.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fli1973 replied on Wednesday, October 28, 2009</h2>I added a break point at my GetManufacturers Method and it is hit at load as well as at Refresh(). It does have the new data. It has been tough moving from winforms to WPF. Thanks again,</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, October 28, 2009</h2>Hmm, at this point I don't have any real answer. Clearly the issue is<br />something to do with data binding and the ComboBox not recognizing that it<br />needs to refresh its items...</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>fli1973 replied on Wednesday, October 28, 2009</h2>I appreciate you taking a look at this. I will post a solution if I can figure it out.<br /><br />Fernando</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>richardb replied on Thursday, October 29, 2009</h2><P>Maybe try clearing factory parameters and&nbsp; resetting the FactoryMethod list.</P>
<P>Here's some code (VB)&nbsp;I use to reset the values on a combo based upon the selection made in another combo.</P>
<P>&nbsp;</P><FONT size=1>
<P></FONT><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>Dim</FONT></FONT> dpSubType <FONT color=#0000ff><FONT color=#0000ff>As</FONT></FONT> Csla.Wpf.CslaDataProvider</FONT></P>
<P><FONT size=2>dpSubType = <FONT color=#0000ff><FONT color=#0000ff>TryCast</FONT></FONT>(<FONT color=#0000ff><FONT color=#0000ff>Me</FONT></FONT>.FindResource(<FONT color=#a31515><FONT color=#a31515>"QualificationSubTypeList"</FONT></FONT>), Csla.Wpf.CslaDataProvider)</FONT></P>
<P><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>Using</FONT></FONT> dpSubType.DeferRefresh</FONT></P>
<P><FONT size=2>dpSubType.FactoryParameters.Clear()</FONT></P>
<P><FONT size=2>dpSubType.FactoryMethod = <FONT color=#a31515><FONT color=#a31515>"GetList"</P></FONT></FONT></FONT>
<P><FONT size=2>dpSubType.FactoryParameters.Add(qualTypeID)</FONT></P>
<P><FONT size=2><FONT color=#0000ff><FONT color=#0000ff>End</FONT></FONT> <FONT color=#0000ff size=1><FONT color=#0000ff size=1>Using</P></FONT></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
