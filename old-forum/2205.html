<html><header><title>Let's put our heads together...</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Let's put our heads together...</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2205.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate posted on Wednesday, January 24, 2007</h2><P>I'm interested in getting ideas on how to implement a variation on the ProjectTracker Project-Resource-Assignment design to satisfy our current needs.</P>
<P>Just like ProjectTracker, we have a list of Assignments that belong to our Project object.&nbsp; Each Assignment defines the Resource and its Role.&nbsp; So far so good.&nbsp; Our web app displays the list of current Assignments when the parent Project is shown.&nbsp; The Add Assignment form has a drop-down list for Resources and another for Roles.&nbsp; Both are data-bound using a CslaDataSource.</P>
<P>Each Resource is really a user in the application and has a list of Roles that they belong to (they can only be assigned to these Roles).&nbsp; Because of this, we post the page back to the server&nbsp;and handle&nbsp;the Resource drop-down list's SelectedIndexChanged event to rebind the Roles drop-down list to the selected Resource's RoleList.</P>
<P>This is pretty straight-forward so far, but here's the catch: we are only allowed to assign a Resource once per Project and only one Resource can be in a given Role within the Project.</P>
<P>So this means is that we need to filter the Resources drop-down list to only include users that have not already been assigned to the project.&nbsp; In addition, we have to eliminate users that don't belong to an unassigned Role.&nbsp; Then, when we bind the Role drop-down list, we have to filter out any Roles that have already been assigned.</P>
<P>To further complicate matters, we have been told that we may need to restrict the number of times a particular user may be assigned to a project.&nbsp; For instance, they may restrict Account Managers to only 10 projects at any one time.</P>
<P>All of that said, I'm looking for a hearty brainstorming session from all discussing how we may approach some complex logic such as this.&nbsp; Thanks in advance to all who chime in.</P>
<P><img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /></P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Thursday, January 25, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>
<P>This is pretty straight-forward so far, but here's the catch: we are only allowed to assign a Resource once per Project and only one Resource can be in a given Role within the Project.</P>
<P>So this means is that we need to filter the Resources drop-down list to only include users that have not already been assigned to the project.&nbsp; </P>
<P></div></BLOCKQUOTE></P>
<P>Filtering&nbsp;a drop down list is a well understood concept here.&nbsp; So I assume you are looking for help with a strategy for populating the list.&nbsp; It would seem that you just need DataPortal_Fetch code that does a "missing items" type of query (i.e., something like SELECT Resources.ResourceID, Resources.Name FROM Resources LEFT JOIN ProjectResources on Resources.ResourceID = ProjectResources.ResourceID WHERE ProjectResources.Project = @ProjectID And ProjectResources.ResourceID Is NULL</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div></P>
<P>In addition, we have to eliminate users that don't belong to an unassigned Role.&nbsp; Then, when we bind the Role drop-down list, we have to filter out any Roles that have already been assigned.</P>
<P></div></BLOCKQUOTE></P>
<P>Same issue, isn't it?</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div></P>
<P>To further complicate matters, we have been told that we may need to restrict the number of times a particular user may be assigned to a project.&nbsp; For instance, they may restrict Account Managers to only 10 projects at any one time.</P>
<P></div></BLOCKQUOTE></P>
<P>Restricting the number could be an issue at selection time or assignment time.&nbsp;&nbsp;Do you need to limit your list of Resources (from which the selection is made) to those with less than ten assignments?&nbsp; Or would showing everybody in the list and trapping an assignment attempt that tries to make number eleven be acceptable?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, January 25, 2007</h2><P>Getting the initial list of Resources using the type of SQL statement you described will work fine; however, we need to update the drop-down list each time an assignment is created without retrieving the list from the db because the change is not persisted at that time.&nbsp; So, the user can add several assignments before the data is persisted back to the data store.</P>
<P>As for the last point, the requirements that have been conveyed thus far is that we should not display any resource that has already been max-ed out.&nbsp; We will still have to trap an assignment attempt when the data is persisted if it causes the resource to go past the limit because it is a multi-user app with delayed persistance.</P>
<P>My initial thoughts are to have a Resource BO and ResourceCollection that is populated using the same type of select statement you described.&nbsp; Then, in the event handler where we create the Assignment BO and add it to the Project BO, we would remove that Resource from the drop-down list explicitly (i.e. do not re-bind it).&nbsp; The opposite for any Assignment that is removed - we would add that Resource back into the list.</P>
<P>We would have a Role BO and RoleCollection BO that is created and populated each time the SelectedIndexChanged event fires for the Resource's drop-down list.&nbsp; We would have a similar select statement to pre-filter the result set from the db but would have to post-filter the list based on the current Assignments (since it's possible that some have not yet been persisted to the db).</P>
<P>Question is whether the removal/addition of the Resource upon assignment and filtering of the roles is something that should be done in the BO's or in the UI event handlers?&nbsp; I am leaning towards embedding the logic within the BO's.&nbsp; But this would require knowledge of each other in the BO.</P>
<P>For instance, when we add an assignment, we use the Project's AddAssignment(resourceID, roleID) method.&nbsp; We could, in theory, remove the resource from the list of resources used for the drop-down list but this would require us to have a reference to that collection available to the Project object.&nbsp; How?&nbsp; An UnassignedResources child collection?</P>
<P>We were going to have the RoleCollection as a root collection that accepts the Resource/User's id value as a parameter in the factory method / stored procedure so that the proper pre-filtering can be done in SQL.&nbsp; However, to allow the post-filtering to be done based on what roles have already been assigned, the RoleCollection would also need to have a reference to the Project.</P>
<P>See where the dilemma/confusion/complication comes in?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Thursday, January 25, 2007</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div>
<P>Getting the initial list of Resources using the type of SQL statement you described will work fine; however, we need to update the drop-down list each time an assignment is created without retrieving the list from the db because the change is not persisted at that time.&nbsp; So, the user can add several assignments before the data is persisted back to the data store.</P>
<P>...</P>
<P>My initial thoughts are to have a Resource BO and ResourceCollection that is populated using the same type of select statement you described.&nbsp; </P>
<P></div></BLOCKQUOTE></P>
<P>I think the names of objects are very important.&nbsp; The right name focuses our thinking on the right data and behavior to accomplish its purpose.&nbsp; </P>
<P>So, I do not think we are talking about Resource and ResourceCollection objects.&nbsp; We are talking about a ValidProjectResourceChoice and a ValidProjectResourceChoiceCollection.</P>
<P>Ok, those are horribly long names, but I think they accurately reflect what they represent based upon your discussion. :)</P>
<P>As such, they do not have a life of their own (like a Resource that would exist whether the project existed or not).&nbsp; In effect, they seem to be&nbsp;child objects within the Project.</P>
<P>If that is true, then it's perfectly appropriate for the Project (or Assignment?) object to add/remove items from the list.&nbsp; </P>
<P>That said, I suspect that, under the hood, ValidProjectResourceChoice and&nbsp; ValidProjectResourceChoiceCollection might really be project-specific filters on Resource and ResourceCollection.&nbsp;&nbsp; But it would still make sense to me that adding/subtracting a resource to a project would cause the project's valid list of resource choices to change.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>SonOfPirate:</strong></div><div></P>
<P>See where the dilemma/confusion/complication comes in?</P>
<P></div></BLOCKQUOTE></P>
<P>Sure do.&nbsp; I'm not claiming to be an OO expert, so take my advice with a grain of salt. :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Thursday, January 25, 2007</h2><P>David, I'm right there with you.&nbsp; Ironic that you made these points as this is exactly what I was wrestling with this afternoon.</P>
<P>Things are actually a bit more complicated for us in that there are multiple objects that have this behavior (and data).&nbsp; Our Customer BO's behave the same way, for instance.&nbsp; And, part of our requirements is that the resources assigned to the customer are inherited (in a non-OOP sense) by the project when created.&nbsp; (Logically a Project can't exist without a Customer and there is a one-to-many relationship between them).&nbsp; So, you are correct that a simple Resource object won't cut it - or maybe it will...</P>
<P>I was heading down the same thought path as you with regards to the collection of available or unassigned resources possibly being a child collection of these objects; afterall, it is within the context of the Customer or Project that these collections are defined.</P>
<P>So, now I am looking at having an editable child UnassignedResourceCollection of Resource objects for each BO as well as an editable child UnassignedRoleCollection (of Role objects).&nbsp; Since neither the resource nor the role have a direct relationship back to the Customer or Project BO, I don't think it is necessary to differentiate them (i.e. CustomerResource, ProjectResource, etc) - but that may change as I move forward.&nbsp; I also don't think that from the Resource's perspective it matters if it has been assigned or not.&nbsp; It either exists in the list of assignments or in the list of unassigned resources.</P>
<P>In the AddAssignment(resourceID, roleID) method in the parent BO(s), I can easily remove the assigned objects from each child collection.&nbsp; The UI can be re-bound and it sounds like all will be good.&nbsp; To complete the picture, I would have a RemoveAssignment(assignmentID) method that would remove the Assignment object from that child collection and add the resource and role back into the UnassignedResources and UnassignedRoles collections, respectively.</P>
<P>Sound like I'm on the right track?</P>
<P>Only logic I still have to work out is where the data for the Roles drop-down list is coming from.&nbsp; This is not bound to the UnassignedRoles collection directly.&nbsp; Instead it is the intersection of the selected Resource's roles and the UnassignedRoles collection.&nbsp; For example, if the selected Resource (user) is only assigned the "Account Manager" role but both the "Account Manager"&nbsp;and "Sales Manager" roles are unassigned, we would only want to display the "Account Manager" in the UI as this is the only one that&nbsp;resource can be assigned to.&nbsp; Any ideas on this part?</P>
<P>Oh yea, and I forgot that this works the other way too.&nbsp; When also don't want to show any resource that can't be assigned to any of the unassigned roles.&nbsp; So, if we assigned that resource above to the "Account Manager" role for the Project, any other resource that can only be an "Account Manager" should also be removed from the list.</P>
<P>I think I could handle this in the AddAssignment method by iterating through all of the resources in the collection and checking if they have any roles still included in the UnassignedRoles collection.&nbsp; BUT, adding them back in when an assignment is removed appears to be the challenge.</P>
<P>Time for more thought.</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
