<html><header><title>Anyone help to explain the Fetch method?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Anyone help to explain the Fetch method?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1429.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>yipchunyu posted on Tuesday, October 10, 2006</h2>I read the book but can't understand fully.&nbsp; How should I make use of the data fetch with criteria.<br>For example, followings are the codes inside part of the ProjectList object.&nbsp; How should I e.g<br>1. Add some parameters?<br>2. Multiple set of criteria e.g. search by Name and Author /&nbsp; Just search by ID<br><br>Any help is very much welcome. Thx in advance.<br><br><br>#Region " Data Access "<br><br>&nbsp; &lt;Serializable()&gt; _<br>Private Class Criteria<br>&nbsp;&nbsp;&nbsp; ' no criteria - retrieve all projects<br>&nbsp; End Class<br><br>&nbsp; &lt;Serializable()&gt; _<br>&nbsp; Private Class FilteredCriteria<br>&nbsp;&nbsp;&nbsp; Private mName As String<br>&nbsp;&nbsp;&nbsp; Public ReadOnly Property Name() As String<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; Public Sub New(ByVal name As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mName = name<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp; End Class<br><br>&nbsp; Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)<br><br>&nbsp;&nbsp;&nbsp; ' fetch with no filter<br>&nbsp;&nbsp;&nbsp; Fetch("")<br><br>&nbsp; End Sub<br><br>&nbsp; Private Overloads Sub DataPortal_Fetch(ByVal criteria As FilteredCriteria)<br><br>&nbsp;&nbsp;&nbsp; Fetch(criteria.Name)<br><br>&nbsp; End Sub<br><br>&nbsp; Private Sub Fetch(ByVal nameFilter As String)<br><br>&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = False<br>&nbsp;&nbsp;&nbsp; Using cn As New SqlConnection(Database.PTrackerConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With cm<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandType = CommandType.StoredProcedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandText = "getProjects"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New SafeDataReader(.ExecuteReader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; While dr.Read()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim info As New ProjectInfo(dr.GetGuid(0), dr.GetString(1))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' apply filter if necessary<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Len(nameFilter) = 0 OrElse info.Name.IndexOf(nameFilter) = 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.Add(info)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End While<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp; RaiseListChangedEvents = True<br><br>&nbsp; End Sub<br><br>#End Region</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, October 10, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>yipchunyu:</strong></div><div>I read the book but can't understand fully.&nbsp; How should I make use of the data fetch with criteria.<br>For example, followings are the codes inside part of the ProjectList object.&nbsp; How should I e.g<br>1. Add some parameters?<br>2. Multiple set of criteria e.g. search by Name and Author /&nbsp; Just search by ID<br><br></div></BLOCKQUOTE><br><br>The Criteria class defines your parameters. In ProjectList there are actually two different Criteria classes, because you can get the complete list (the Criteria with no fields) or you can get a filtered list (the Criteria with the name field for filtering).<br><br>If your object has different parameters, then you would create a Criteria class that contains those parameters.<br><br>Typically you will have one Criteria class for each different factory method, so you can clearly indicate which overload of DataPortal_Fetch() should be called by that factory method.<br><br>If you need <i>optional </i>parameters, then you need to make your Criteria class a little more complex. There are many ways to do this, but I prefer to keep a Boolean flag along with each criteria field, using that flag to indicate whether the field has been set. <br><br>(though you could probably use Nullable&lt;T&gt; to track whether each field was set - that'd be interesting to try)<br><br>This way, in your DataPortal_Fetch() method, you can easily determine which criteria fields were set, and so you can create your WHERE clause or call the right stored procedure or whatever.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, October 10, 2006</h2><P>In addition to what Rocky said, I would pass the filter to the SP or SQL Statement so that the Database returns a smaller rowset over the wire to the BO. Rather than retrieve the entire DB and then filter out those records I don't want. Rocky's sample app is just showing one way to do it - it isn't necessarily the best way to do it. &lt;g&gt;</P>
<P>Joe</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
