<html><header><title>DB Fault tolerance - thoughts / ideas?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DB Fault tolerance - thoughts / ideas?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10815.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>rosscj posted on Wednesday, October 26, 2011</h2><p>We&#39;re in a spot now where we are engineering software solutions to replace a lot of old Access97 + VB6 GUIs. (Finally). </p>
<p>MSSQL 2008 R2, VS2010, CSLA framework here now, and I almost have these guys convinced it&#39;s the way forward. Some discussions are coming up about &#39;What if the DB goes down&quot;. There are some old apps here that our production floor rely on to work, if it can&#39;t write data to the database, it&#39;s at a standstill.</p>
<p>For the critical apps out there, I&#39;m thinking a 2 physical-tier approach; UI and business layer on the process PC, database is in the IS datacenter. </p>
<p>Mind you, I&#39;m still sorting out the logic, I&#39;m coming from the old school vb6 business object days, so a lot of the CSLA stuff now is.... wow. Cool; hard on the head sometimes, but I&#39;m getting there. (CSLA ebooks bought &amp; read, VB2008 &amp; c# 2008 books read. I&#39;m absorbing all I can!)</p>
<p>Getting to my question - on this proposed 2 tier approach, I realize it&#39;s not the best, but I fail to see how else to do it. If the DB is down, it shouldn&#39;t stop the production process; should we be looking at some sort of MSMQ solution with CSLA? If the database transaction fails, put the transaction in a queue to be processed? What techniques have you guys utilized in the past to overcome the 0.0000001% chance the db will be offline, but your app has to keep chugging along; handling additional dal code? </p>
<p>On a positive note, I&#39;m sure I&#39;ll have lots of opportunity to hone my skills! We have 100s of apps to look at and re-write. (Hence my pushing to use CSLA as part of our coding best practices...)</p>
<p>&nbsp;</p>
<p>Thanks in advance,</p>
<p>Chris</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, October 26, 2011</h2><p>Hi, </p>
<p>Have you considered the Microsoft Sync Framework in order to make apps available offline?<br /><a href="http://msdn.microsoft.com/en-us/sync/bb736753">http://msdn.microsoft.com/en-us/sync/bb736753 </a></p>
<p>Into video<br /><a href="http://msdn.microsoft.com/en-us/sync/bb980926.aspx%20">http://msdn.microsoft.com/en-us/sync/bb980926.aspx </a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rosscj replied on Wednesday, October 26, 2011</h2><p>I&#39;ll definitely look into it. Thank you Jonny. :)</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tmg4340 replied on Wednesday, October 26, 2011</h2><p>As Jonny has already suggested, the Sync Framework may be a good idea for you.&nbsp; The only suggestion I would make there is that you&#39;re going to want to treat your application a little like Outlook: as far as your app knows, the *only* database for it is the local CE database.&nbsp; Let the Sync Framework do the work for you in getting that data to and from the &quot;real&quot; database.</p>
<p>Outside of that, you could also build out to a 3-tier system, where you have an app server that sits between your desktop and the database server.&nbsp; That makes your desktop app simpler (it only worries about talking to the app server), and is also supported out-of-the-box by CSLA.&nbsp; The potential advantage there is that you can concentrate your &quot;DB isn&#39;t there&quot; code in your app server.&nbsp; You still have to cache data locally for the app, which in the end may look quite a bit like what the Sync Framework does.&nbsp; But you can customize it for your particular situation if necesssary, and it&#39;s not all that bad - you likely are going to cache some data locally anyway.</p>
<p>Obviously that complicates your deployment a little, as well as your environment.&nbsp; But you can gain quite a bit in robustness and scalability.</p>
<p>HTH</p>
<p>- Scott</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rosscj replied on Wednesday, October 26, 2011</h2><p>Hi Scott;</p>
<p>I&#39;ve thought about that, but then the issue now 
becomes &#39;what if the app server goes down&quot;, or &quot;The forklift just ran 
over the CAT5 cable for this process PC&quot; situation. For our &#39;app must 
remain alive&quot; situation, the fewer points of failure, the better.</p>
<p>Mind
 you, I do totally get the 3-tier approach, and look forward to sinking 
my teeth into it. We&#39;ll get there, and CSLA will be there every step of 
the way, (I can smell multi-interface apps coming my way in the new 
year); but in this specific &#39;run at all costs&#39; situation... I&#39;m not
 so sure.</p>
<p>I like what I&#39;ve read about the Sync framework. Looks 
like it will fit the bill nicely... sorry I missed it earlier! Thanks 
for your input, I do appreciate it.</p>
<p>Chris</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Paul Czywczynski replied on Wednesday, October 26, 2011</h2><p>I would back up a few steps and look at your infrastructure before considering sync as your end-all solution.</p>
<p>Lets start with the SQL Server. A&nbsp;SQL Server can be clustered with multiple nodes. When properly set up you&#39;ll be able to recover &quot;mostly&quot; transparent to the still active SQL Server node when the primary goes down. A side bonus this will work with all your existing SQL Server based applications. If your worried about transactions then take a look at using a transaction coordinator with SQL Server clusters or using SQL Server&#39;s mirroring functions.</p>
<p>Next is the network. Loosing connectivity to the SQL Server that can be, again &quot;mostly&quot;, resolved using multiple network paths from the client to the SQL Server. Redundant NICs, firewalls, switches, cabling, etc... To set up a&nbsp;redundant&nbsp;network, figure on buying two of everything. Keep in mind plugging all the redundant equipment together doesn&#39;t make for a healthy network. Today&#39;s switches don&#39;t scale well if you haven&#39;t thought out your spanning tree structure.</p>
<p>I put emphasis on the word &quot;mostly&quot; because nothing is perfect. Generally off the shelf networking gear and SQL Server can recover to redundant hardware but they usually drop the active TCP connection. If your client can retry a dropped connection you&#39;ll be fine.&nbsp;</p>
<p>Personally I would rather invest in your server hardware and network. If you get it&nbsp;resilient&nbsp;then that would not only help your application but everything else that depends on those resources. I know its not cheap but it makes for happy users and IT people that can work on business problems instead of chasing fires.</p>
<p>In the end if you have all the redundancy in the world and you&#39;re still worried about downtime then the SQL Server Sync Framework is your last choice.&nbsp;We&#39;ve tried syncing in the past. It&#39;s easier today but still complex. It&#39;s super easy to fail-over, tremendously difficult to fail-back. Unless your application is designed for merging data from the start you&#39;re going to have a tough time. Save syncing for applications that are designed to be offline. It shouldn&#39;t be your redundancy solution.</p>
<p>-Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rosscj replied on Thursday, October 27, 2011</h2><p>Hi Paul;</p>
<p>Very good hardware suggestions. I&#39;ve followed these best practices in the past (14 year&#39;s of being the entire IT department, one man wrecking crew so to speak. Network design &amp; admin, DB analyst/design, email, app development, etc... you get the idea). A corporate merger meant the less senior people in various departments were let go. Fast forward 4 years (3.5 years of production line machine maintenance), here I am in a new role. </p>
<p>I have a lot of experience with the process PC&#39;s as it talks to production PLC hardware; (first line of defense as a shift troubleshooter). Strange to have the perspective of the previous designer, maintenance troubleshooting aspect, and now re-engineering perspective with today&#39;s technology rather than band-aid 1990&#39;s software &amp; mindset. It&#39;s not a bad thing, it&#39;s certainly helping me with design considerations.</p>
<p>Getting to my point here, the network design here isn&#39;t bad at all, perhaps my previous posts made it sound a lot worse than it actually is. Based on past experience, I can vouch for the network performing @ 99.99% uptime. Not so much with the shop floor hardware, but that&#39;s yet another tangent...er, design consideration, sorry! ;-) </p>
<p>My hands are pretty much tied with the server situation (in process of installing a failover SQL box), and the network part is, again out of my hands. Having said that, the infrastructure is pretty solid and sound. </p>
<p>It&#39;s that 0.01% &quot;2:30am-crap-has-hit-the-fan&quot; production floor situation I have to account for in this design; if nothing else, to show management that it&#39;s at least been a factor in the design stage. And, this design consideration is only for *maybe* half-dozen applications out of many that are going to be built in the next 5 years. Sync Framework here will be used sparingly, as a redundancy on the process PC side; definitely not plant wide with every app.</p>
<p>Anyway, that&#39;s the short version... thanks for the suggestions. It&#39;s all good!</p>
<p>Chris</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>ajj3085 replied on Sunday, October 30, 2011</h2><p>Is it possible to get another sql server and setup mirroring?&nbsp; Pretty much what its designed to do, and it will be seemless to your application.&nbsp; </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
