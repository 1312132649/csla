<html><header><title>Single page, Multiple Lists, Single Business Object</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Single page, Multiple Lists, Single Business Object</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2556.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms posted on Monday, March 19, 2007</h2>Hello to all,<br><br>I have searched the forums, FAQ and wiki and did find a discussion that touched all the issues that I have. One came close, http://forums.lhotka.net/forums/thread/10131.aspx , but did not really answer my problem.<br><br>Back ground - I am using CSLA 2.14, C# and ,NET in VS2005.<br><br>The GUI is to have seven grid views populated by different lists of the same editable root business object, an ICSR.&nbsp; The lists are not guaranteed to be mutually exclusive.&nbsp; The user will edit attributes on the ICSR (plan on Master-Detail) but will not add or remove them from the list. Changes will sent to the database after the presses a "Recompute" button<br><br>I have implemented a BO collection for entire list of all ICSRs.&nbsp; It appears to be functional. but not yet fully tested.<br><br>Each of the seven lists can be obtained from a single stored procedure by passing it a single parameter. Any changes to the conditions which drive the contents of the lists will be made in this stored procedure.<br><br>There are two issues, perhaps interrelated, as I see. First, is should I build a separate class for each of the lists or should I build a single object which would return separate lists based on parameters? The second issue is since there are seven lists on one page and the user may be changing ICSR attributes in differing manners for the same ICSR on different lists, is there an architecture/design which lends itself to comparing and resolving discrepancies?<br><br>I expect few changes to the business rules of the lists once the differing attributes resolution is handled. <br><br>Quick responses are appreciated. As always, there is a drive to complete sooner rather than more correctly. The old code-first design-later syndrome.<br><br>Regards,<br>Bill<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, March 20, 2007</h2>Hey Bill,<br><br>Based on the information you provided so far I would suggest to follow an MVC approach:<br><br>Model (M):<br>- 1 list containing ALL your ICSRs<br>- so the superset of all ICSRs that may be displayed in one or more of your grids<br><br>View (V):<br>- each grid is one particular view on your model<br>- the view is responsible for filtering out those ICSRs that are relevant for this particular grid<br>- note: this is different from filtering in your sproc, your sproc fetches everything, it's only in the UI that you start filtering<br><br>Controller (C):<br>- if you use data-binding to connect all your views to the same model (your single list of ICSRs) the different views will be synchronized automatically (!).<br>- this is why I strongly recommend this approach (especially as you indicate to be in a hurry ;-) ), this way databinding can solve the challenge of keeping everything in sync<br>- the Recompute button is the other part of your (conceptual) Controller, it will commit any changes to your model to the DB (not sure if you persist anything, you didn't mention it actually, but at least some computation-routine will be triggered here)<br><br>Good luck!<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, March 20, 2007</h2>Oh,<br><br>In addition to my previous post, an additional tip came to mind:<br><br>Check the FilteredBindingList that should available somewhere on this site (download page or Codeplex, dunno)<br>- I never used this since I use the highly capable grids from infragistics, but it may very well serve you<br>- you would then still have this 1 list of ICSRs as your model<br>- subsequently you would have 7 FilteredBindingLists, one for each grid. Each with their own set of filtering settings<br>- the BO (ICSRList) would be the datasource of all these filteredbindinglists, and each grid would have a filteredbindinglist as its datasource<br><br>I am pretty sure this could be made to work wonderfully.<br><br>;-)<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, March 20, 2007</h2><P>A better understanding of your use-cases may lend itself to a better answer, but based on what we know, I would agree that having a single BO that contains a "master" list, so-to-speak, with each of your grids bound to a view based on that BO using whatever filtering/sorting/grouping criteria you have would be the best and simplest way to go.&nbsp; This is, of course, assuming that the resultset returned from your sproc is also singular in nature - which I am not sure is the case.</P>
<P>I am concerned because of your indication that "each of the seven lists can be obtained from a single stored procedure by passing it a single parameter."&nbsp; Does this mean that this parameter is used to conditionally execute statements within the sproc?&nbsp; In other words, is this parameter a switch-case type argument that indicates which execution path to follow?&nbsp; If so, then I am going to recommend breaking this into seven separate sprocs with seven separate BO's as there would be seven use-cases to satisfy.&nbsp; If not, then I defer back to the original suggestion.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, March 20, 2007</h2>Bayu and SonOfPirate, thank you for your replies.<br><br>A quick description of the use case follows:&nbsp; The financial admin actor is deciding which attributes on specific ICSRs to set or unset. They will use the information displayed on the single page, the seven lists and other information to aid their decision.&nbsp; The seven lists are various process states for the ICSRs.&nbsp; The changed attributes of the ICSRS will be persisted. A complex 'rolling up' is then initiated, the new results displayed and the iterations continue until the fin admin is satisfied.<br><br>The single stored procedure parameter is, in effect, the name of the list to return.&nbsp; The filtering is somewhat complex and for performance reasons is best done on the database. The filtering is also based on information which is not contained within the ICSR business object.<br><br>Does this addition information affect your recommendations?<br><br>Your replies are truly appreciated.&nbsp; It is amazing how other peoples perspectives can bring clarity to one's own thoughts.<br><br>Regards,<br>Bill<br><br>BTW SonOfPirate, I attended University of Michigan from 68 to 70. Go Blue!<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, March 20, 2007</h2><P>Ah, then you were there for "THE Game", eh?&nbsp; Unfortunately I was there during some leaner years during the late 80's/early 90's.</P>
<P>Anyway, from what you describe I would definitely suggest the single collection BO, multiple views approach.&nbsp; If I understand you correctly, it sounds like you are simply breaking your master list into smaller lists based on state.&nbsp; This would be consistent with this approach where each view would correspond to a particular state.&nbsp; When the state of an element changes, you would only need to refresh the views based on the updated collection&nbsp;and your UI would update accordingly.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, March 20, 2007</h2>So to restate the recommendations (as I understand them):<br><br>Use master BO list of all ICSRs.&nbsp; Since the filtering is done on the database, I will need to use seven BO lists to display the seven ICSR state lists on the page. When the user changes the attributes of an ICSR on a given list, I change the applicable ICSR state list and the master list (all cached server side). When the user presses the recompute button, I save the master list to the database, initiate the 'Roll up" and redisplay the page for the next iteration.<br><br>Is my restatement correct?<br><br>Regards,<br>Bill<br><br>Wikipedia has a full discussion of the Michigan-Ohio State history. OH, how I hate Ohio State!<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, March 20, 2007</h2>The seven lists are NOT mutually exclusive.&nbsp; The same ICSR may appear on&nbsp; more&nbsp; than one list.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, March 20, 2007</h2>My comments in 13317 were made before I read 13316 (it was not there when I started writing the post, editorial overlap :) ) <br><br>The lists are based/filtered on conditions on other tables in the database.&nbsp; To move that logic into a filtering list BO would cause cause poor performance because the BO would have many database calls.&nbsp; While the user edits the ICSRs, the lists are static (no additions or removals). After the recompute, the contents of the list may vary due to ICSR attributes changing.<br><br>Regards,<br>Bill<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Tuesday, March 20, 2007</h2>An idea, I could get the DBA to give the ICSR a boolean attribute for each list.&nbsp; He could modify the stored procdure for generating the lists to update the attribute.&nbsp; The ICSR master list could then easily be filtered using the FilteredBindingList. I could then implement Bayu's suggestion.<br><br>Sound feasible?<br><br>Regards,<br>Bill<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, March 20, 2007</h2><P>I was on the same page with Bayu expecting that the stored procedure would return a single resultset and filtering would be done by the FilteredBindingLists based on the master list BO.&nbsp; I'm still not sure we have a clear picture of what you are doing in the db and this may be causing some of the discrepencies.</P>
<P>Are you returning a single resultset from the db or seven resultsets - each corresponding to one of the filtered lists you are displaying?&nbsp; From your description, it sounds like you are returing seven separate "lists" from the sproc.&nbsp; I guess this is where both Bayu and I are raising our eyebrows.</P>
<P>In&nbsp;your last post it sounds like you are thinking of combining these resultsets into a single resultset with an additional column that can be used to filter the master list into the seven "filtered" lists in your BO.&nbsp; If I am on the same page, then it sounds like this is a step in the right direction because I think the simplicity and synchronization benefits that you get going with the single BO with multiple views are significant.</P>
<P>HTH</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Wednesday, March 21, 2007</h2>Clever!<br><br>That way you leverage the DBs filtering capabilities AND the synchronization inherent to databinding without too much trouble. <br><br>I like it. ;-)<br><br>Let us know if it is any successfull!<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jimbo replied on Wednesday, March 21, 2007</h2>I thought that there is a protocol for the&nbsp; use of acronyms. When
they are introduced, it is important to spell out the long description
ICSR (? Blah). Then perhaps we can all relate better. Many discussions
can become too esoteric.<br>
<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Wednesday, March 21, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>Jimbo:</strong></div><div>I thought that there is a protocol for the&nbsp; use of acronyms. When
they are introduced, it is important to spell out the long description
ICSR (? Blah). Then perhaps we can all relate better. Many discussions
can become too esoteric.<br>
<br>
<br></div></BLOCKQUOTE><br><br>LOL :D<br><br>Actually, I too have absolutely no idea what it is. ;-) It didn't matter for the purpose of the discussion though. ;-)<br><br>Google tells me it can be any of this:<br>- Institute of Control and System Research <br>- International Conference on Software Reuse<br>- Indian Cultural and Rock Society<br>- Individual Case Safety Report<br><br>Bugs me ....&nbsp; most probably it's none of the above. ;-)<br><br>Bayu<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Wednesday, March 21, 2007</h2>Sorry Jimbo, <br><br>I did not spell out the meaning to ICSR mostly because, to me, it is just a business object to be manipulated.&nbsp; To tell the truth, when I asked the boss/client, he was not sure what it meant.&nbsp; It is the financial grouping of workorders and authorizations to proceed (ATP). The ICSR is used to allocate funding to a project. For purproses of the discussion , it can be treated as a generic editable root business object with attributes.<br><br>Regards,<br>Bill<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Wednesday, March 21, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>BillArms:</strong></div><div>Sorry Jimbo, <br><br>I did not spell out the meaning to ICSR mostly because, to me, it is just a business object to be manipulated.&nbsp; To tell the truth, when I asked the boss/client, he was not sure what it meant.&nbsp; It is the financial grouping of workorders and authorizations to proceed (ATP). The ICSR is used to allocate funding to a project. For purproses of the discussion , it can be treated as a generic editable root business object with attributes.<br><br>Regards,<br>Bill<br></div></BLOCKQUOTE><br><br><br>Whaahaaaaaaaaaaaaaaa LOL :D :D<br><br>We can be the most genius guru around, and still have no clue what we're doing.<br><br>Isn't it great that nevertheless we can still solve these issues!<br><br>Magic ......<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Wednesday, March 21, 2007</h2>I always liked the term "Universe of Discourse".&nbsp; I first saw it the Object Oriented Modeling and Design book by James Rumbaugh.&nbsp; We can not model the entire universe, so we limit the discussion to what we believe is relevant.&nbsp; Myoptic vision can be useful&nbsp; :)<br><br>Regards,<br>Bill<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>BillArms replied on Wednesday, March 21, 2007</h2>Back to the well for another dose of good information.<br><br>The isue now is the linking of the seven filtered lists, the gridviews, CslaDataSources and the MasterList.<br><br>I have modifed the ICSR object to contain booleans indicating specific list membership and propagated that change into the ICSR BO.&nbsp; <br><br>I created a filter provider.<br><br>public class IcsrListFilter<br>{<br>&nbsp; public static Boolean Filter(object item, object filter)<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; return (item.Equals(filter));<br>&nbsp; } // end Filter method<br>}<br><br>And I added the lists to my code behind page.<br><br>&nbsp; private WODB_Library.Finance.ICSRList MasterList = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; Over120DayList = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; BudgetOkList = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; ProDayList = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; Twixt100_108List = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; Twixt108_100List = null;<br>&nbsp; private FilteredBindingList&lt;ICSR&gt; ExcludeList = null;<br><br>&nbsp; protected void Page_Load(object sender, EventArgs e)<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; if (!IsPostBack)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.mvMain.ActiveViewIndex = 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itCurrent.Fetch();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AssignTotalValues();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AssignListValues();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isDirty = false;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (isDirty)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itCurrent.Fetch();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AssignTotalValues();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AssignListValues();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isDirty = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp; private void AssignListValues()<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; MasterList = GetICSRList();<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref Over120DayList, "Over120DayList", true);<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref BudgetOkList, "BudgetOkList", true);<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref ProDayList, "ProDayList", true);<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref Twixt100_108List, "Twixt100_108List", true);<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref Twixt108_100List, "Twixt108_100List", true);<br>&nbsp;&nbsp;&nbsp; SetFilteredList(ref ExcludeList, "ExcludeList", true);<br>&nbsp; }<br><br>&nbsp; private void SetFilteredList(ref FilteredBindingList&lt;ICSR&gt; list, <br>&nbsp;&nbsp;&nbsp; String property, Boolean filter)<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; list = new FilteredBindingList&lt;ICSR&gt;(MasterList);<br>&nbsp;&nbsp;&nbsp; list.FilterProvider = IcsrListFilter.Filter;<br>&nbsp;&nbsp;&nbsp; list.ApplyFilter(property, filter);<br>&nbsp; }<br>&nbsp; <br>&nbsp; <br>&nbsp; Now the questions are: How do I connect the FilteredLists to the gridiews? and What CslaDataSources do I make and how do they connect?<br>&nbsp; <br>&nbsp; Regards,<br>&nbsp; Bill<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kids_pro replied on Wednesday, March 21, 2007</h2>I woud set it like this:<br><br>gridView1.DataSource = Over120DayList;<br>gridView1.DataBind();<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, March 22, 2007</h2>Hey!<br><br>Your masterlist can be replaced by the CslaDataSource.<br><br>It's been a long time ago since I worked with ASP.Net, but I believe it raises a SelectObject event (or something akin) which allows you set the source for this CslaDataSource. That would then have to be your ICSRList BO.<br><br>Schematically it would have to look like this:<br>1 - BO --&gt; CslaDataSource (aka 'masterlist')<br>2 - 7 times CslaDataSource --&gt; FilteredBindingList<br>3 - 7 times FilteredBindingList --&gt; GridView<br><br>1 can be achieved by soime event like I mentioned, 2 is what you pretty much put there already and how to do 3 was mentioned by kids<br><br>Good luck! ;-)<br>Bayu<br><br><br>- <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, March 20, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>BillArms:</strong></div><div>So to restate the recommendations (as I understand them):<br><br>Use master BO list of all ICSRs.&nbsp; Since the filtering is done on the database, I will need to use seven BO lists to display the seven ICSR state lists on the page. When the user changes the attributes of an ICSR on a given list, I change the applicable ICSR state list and the master list (all cached server side). When the user presses the recompute button, I save the master list to the database, initiate the 'Roll up" and redisplay the page for the next iteration.<br><br>Is my restatement correct?<br><br>Regards,<br>Bill<br><br>Wikipedia has a full discussion of the Michigan-Ohio State history. OH, how I hate Ohio State!<br></div></BLOCKQUOTE><br><br>In my opinion you are mixing up two solutions, into something quite interesting though! ;-D<br><br>I meant this:<br>- one master list<br>&nbsp;&nbsp;&nbsp; - is loaded used just 1 sproc<br>&nbsp;&nbsp;&nbsp; - no filtering on DB<br><br>- 7 FilteredBindingLists<br>&nbsp;&nbsp;&nbsp; - each one sits between the materlist and one grid<br>&nbsp;&nbsp;&nbsp; - it is here that the filtering is done<br><br>The good:<br>- databinding will keep everything in sync (masterlist, filteredlists and your 7 grids) which is a HUGE pro imo<br>- upon recompution you need to commit just the masterlist to your DB<br><br>The bad:<br>- you say you prefer filtering in the DB, this part is lost in my proposal. How bad this is .... up to you to decide<br><br>If you take the 'usecase centric approach' you could consider the following:<br>- extend your BOs with any property that is necessary by the UI to appropriately apply the correct filters (this is what modeling after use cases is about, get BOs to support your UI)<br><br>Your restatement is basically the alternative that uses 7 sprocs and filtering in the DB. In your case the masterlist is going to involve a lot of overhead, as you will have to programmatically keep things in sync.<br><br>Mind that I have no clue what kind of filtering and what performance comparisons we are looking at. Just throwing a (theoretically valid) alternative in the box. ;-)<br><br>Regards,<br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Tuesday, March 20, 2007</h2>Hi,<br><br>I am getting confused, I thought you were saying that 1 ICSR might be displayed in more that one of your 7 grids. Am I correct?<br><br>My former suggestion was centered on the idea that you could leverage databinding to do all the synchronization for you. If however the 7 lists are distinct, in the sense that they have no overlapping records (e.g. an ICSR can only be in exactly 1 of 7 states), then things might be different. <br><br>In the latter case no synchronization would be necessary and perhaps different arguments should be favoured. On another note, your comment that 'some of the filtering is best done on the DB' sounds like you are modeling your UI-logic based on DB-constraints (i.e. data-centric), which is never a good idea.<br><br>Maybe you should bounce some more info around on this thread?<br><br>;-)<br><br>Bayu<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
