<html><header><title>LinqObservableCollection in Silverlight 4</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>LinqObservableCollection in Silverlight 4</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9467.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Smith866 posted on Thursday, September 02, 2010</h2><p>I am having a problem with the LinqObservableCollection in CSLA 4 and Silverlight 4.</p>
<p>I have the following scenario: &nbsp;I have a root object that contains a list of child objects. &nbsp;In some situations, I want a filtered list of those child objects. &nbsp;In order to achieve this, I added a property of type LinqObservableCollection&lt;Child&gt; to my root object. &nbsp;In the getter, I perform a linq query on the list to give me the records that I want. &nbsp;When I do the fetch, everything works fine. &nbsp;I see my filtered list.</p>
<p>The problem is when I add items to the underlying list. &nbsp;I add the items to the actual child list, not the LinqObservableCollection. &nbsp;When I call save from my root object, I get the following exception:</p>
<p>System.Runtime.Serialization.InvalidDataContractException occurred</p>
<p>
<p>&nbsp;&nbsp;Message=Type &#39;Csla.LinqObservableCollection`1[Business.RmAdmin]&#39; cannot be serialized. Consider marking it with the DataContractAttribute attribute, and marking all of its members you want serialized with the DataMemberAttribute attribute. Alternatively, you can ensure that the type is public and has a parameterless constructor - all public members of the type will then be serialized, and no attributes will be required.</p>
<p>&nbsp;&nbsp;StackTrace:</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContract.DataContractCriticalHelper.ThrowInvalidDataContractException(String message, Type type)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContract.DataContractCriticalHelper.CreateDataContract(Int32 id, RuntimeTypeHandle typeHandle, Type type)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContract.DataContractCriticalHelper.GetDataContractSkipValidation(Int32 id, RuntimeTypeHandle typeHandle, Type type)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContract.GetDataContractSkipValidation(Int32 id, RuntimeTypeHandle typeHandle, Type type)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContract.GetDataContract(RuntimeTypeHandle typeHandle, Type type, SerializationMode mode)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerContext.GetDataContract(RuntimeTypeHandle typeHandle, Type type)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiType(XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle objectTypeHandle, Type objectType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle, Type declaredType)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at WriteSerializationInfo.FieldDataToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at WriteKeyValueOfstringSerializationInfo.FieldDataOzoZvLrmToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at WriteArrayOfKeyValueOfstringSerializationInfo.FieldDataOzoZvLrmToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at WriteSerializationInfoToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at WriteArrayOfSerializationInfoToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract )</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at System.Runtime.Serialization.DataContractSerializer.WriteObject(XmlWriter writer, Object graph)</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; at Csla.Serialization.Mobile.MobileFormatter.Serialize(XmlWriter writer, Object graph)</p>
<p>&nbsp;&nbsp;InnerException:&nbsp;</p>
<div></div>
<div></div>
<div>Does anybody know why this is happening or what I might be doing wrong? &nbsp;</div>
</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, September 02, 2010</h2><p>Somehow your LinqObservableCollection is being referenced by a property/field in your object graph, and the serializer is trying to serialize that reference.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Smith866 replied on Friday, September 03, 2010</h2><p>I have my LinqObservableCollection defined as a PropertyInfo on my root object as shown below. &nbsp;Perhaps that is the problem?</p>
<p>&nbsp;</p>
<p>
<p>private static readonly PropertyInfo&lt;LinqObservableCollection&lt;RmAdmin&gt;&gt; _rmAdminsHistoryProperty = RegisterProperty&lt;LinqObservableCollection&lt;RmAdmin&gt;&gt;(p =&gt; p.RmAdminsHistory);</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;public LinqObservableCollection&lt;RmAdmin&gt; RmAdminsHistory</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!FieldManager.FieldExists(_rmAdminsHistoryProperty))</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LazyLoadRmAdmin((o, e) =&gt;</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var subset = &nbsp;RmAdmins.ToSyncList(from n in RmAdmins where n.AdminStopDate != null select n);</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LoadProperty(_rmAdminsHistoryProperty, subset );</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OnPropertyChanged(_rmAdminsHistoryProperty);</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return GetProperty(_rmAdminsHistoryProperty);</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, September 03, 2010</h2><p>Yes, that is absolutely a problem. Properties can only reference serializable types, and LOC is not serializable - it is a volatile view over the real collection intended for use by the UI or other code.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
