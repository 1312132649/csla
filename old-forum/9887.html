<html><header><title>CSLA 4: BusinessRules.CheckRules() - Is this not *always* called for DataPortal_Create?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4: BusinessRules.CheckRules() - Is this not *always* called for DataPortal_Create?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9887.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Sunday, December 19, 2010</h2><p>I read somewhere that CSLA 4 always checks the business rules when creating an object via the data portal.<br />(Ps: Are there any other places where this is also implicitly done?)</p>
<p>Strangely, I&#39;m not seeing this happen with an Editable Root object (haven&#39;t tested with others yet) with the following Factory and DP definitions:</p>
<p>Factory:</p>
<pre style="font-family:consolas;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:darkblue;">Staff</span>&nbsp;<span style="color:darkcyan;">New</span>()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:darkblue;">DataPortal</span>.<span style="color:darkcyan;">Create</span>&lt;<span style="color:darkblue;">Staff</span>&gt;(&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:darkblue;">Criteria</span>(&nbsp;&nbsp;)&nbsp;);<br />}</pre>
<p>DataPortal method:</p>
<pre style="font-family:consolas;">[<span style="color:darkblue;">Transactional</span>(&nbsp;<span style="color:darkblue;">TransactionalTypes</span>.<span style="color:purple;font-weight:700;">TransactionScope</span>&nbsp;)]<br />[<span style="color:darkblue;">RunLocal</span>]<br /><span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">DataPortal_Create</span>(<span style="color:darkblue;">Criteria</span>&nbsp;criteria)<br />{<br /><span style="color:blue;">    using</span>&nbsp;(&nbsp;<span style="color:purple;">BypassPropertyChecks</span>&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;{</pre>
<pre style="font-family:consolas;">        ...<br /><br />    }<br />}</pre>
<p>I need to implement the DP method as follows in order to get the rules checked:</p>
<pre style="font-family:consolas;">[<span style="color:darkblue;">Transactional</span>(&nbsp;<span style="color:darkblue;">TransactionalTypes</span>.<span style="color:purple;font-weight:700;">TransactionScope</span>&nbsp;)]<br />[<span style="color:darkblue;">RunLocal</span>]<br /><span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">DataPortal_Create</span>(<span style="color:darkblue;">Criteria</span>&nbsp;criteria)<br />{<br /><span style="color:blue;">    using</span>&nbsp;(&nbsp;<span style="color:purple;">BypassPropertyChecks</span>&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;{</pre>
<pre style="font-family:consolas;">        ...<br /><br />    }</pre>
<pre style="font-family:consolas;"><pre style="font-family:consolas;"><span style="color:purple;"><em>   <strong>BusinessRules</strong></em></span><strong><em>.<span style="color:darkcyan;">CheckRules</span>();</em><br /></strong></pre>
<br /><br />}</pre>
<p>Am I missing something?</p>
<p>&nbsp;</p>
<p>Thanks,<br />Jaans</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, December 19, 2010</h2><p>The only place all rules are implicitly run is in the default DataPortal_Create implementations.</p>
<p>Obviously rules for specific properties are implicitly run by SetProperty when you change the property. Otherwise you need to call CheckRules yourself.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Sunday, December 19, 2010</h2><p>btw, &quot;default DataPortal_Create&quot; means the implementation in the base class. So if your subclass doesn&#39;t call base.DataPortal_Create that code won&#39;t run.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Sunday, December 19, 2010</h2><p>Ah... that clears is up for me.</p>
<p>I wasn&#39;t sure where this CheckRules() was being invoked from, I had thought it was done in some &quot;special&quot; way to ensure it is called for any and all DataPortal_Create( ??? ) implementations, but as you explained it&#39;s from the base class such that it is only on base.DataPortal_Create().</p>
<p>So for the sake of verbosity and other readers, I would need to override the parameterless DataPortal_Create() method in my business object class and call base.DataPortal_Create(). </p>
<p>For other DataPortal_Create( ??? ) methods that do have parameters, there would be no overriding, but would still contain either a call to base.DataPortal_Create() or your own call to BusinessRules.CheckRules().</p>
<p>We generate our classes from a DSL based designer, and so always generate a &quot;Criteria&quot; class to wrap parameters in - so for us it would just make sense to continue generating&nbsp; a call to BusinessRules.CheckRules() to make our intentions clear as a call to the base.DataPortal_Create() doesn&#39;t make it clear that we are actually trying to invoke the CheckRules() method (albeit indirectly). </p>
<p>Thanks Rocky</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
