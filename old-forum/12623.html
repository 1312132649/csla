<html><header><title>Bug in Csla 4.5.501 - NRE if BusinessRule ctor blows up </title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Bug in Csla 4.5.501 - NRE if BusinessRule ctor blows up </h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12623.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 posted on Monday, May 12, 2014</h2><p>I think I found a bug in Csla 4.5.501.</p>
<p>You can recreate it by creating a simple editable business object and a business rule where the rule ctor throws an exception.&nbsp; </p>
<p>In my case, I was throwing an ArgumentException if one of the propertyInfo.Type != typeof(string) as the rule only works against string properties.</p>
<p>The end result was that Csla from the SimpleDataPortal was throwing a NullReferenceException which was not the exception actually thrown by the ctor prior to the call getting to my DP_F method..&nbsp; I&#39;m calling this a bug because it took me a few hours to figure out what was going on.&nbsp; I would have expected to see my ArgumentException somewhere, not a NRE from an anonymous&#39; classes MoveNext method. :-)</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, May 12, 2014</h2><p>For my coding preference I always use generic constraints like</p>
<p>PropertyInfo&lt;string&gt; propertyName &nbsp;</p>
<p>when a rule only works on one type (here string) and this way I can define the contract and not bother with type checking the arguments.&nbsp;</p>
<p>The challenge here is that rules is registrered in the to &lt;bo&gt; constructor on the first time you create the &lt;bo&gt; and CSLA will cleanup the &quot;already registered&quot; rules for the type in the internal Exception handler. Not sure where this is called so must check out in th code. But you would making more solid code if you use generic constraints on the parameters - when needed.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, May 12, 2014</h2><p>I believe any exception thrown in the ctor causes this, but I can verify that tomorrow.&nbsp; If this is the case the exact check I&#39;m doing is irrelevant.&nbsp; Mistakes in calling the ctor shouldn&#39;t cost a developer hours determining why they are getting a NFE from deep within Csla.&nbsp; I thought the purpose of having the interface was to make unit testing easier; its shown that way in the eBooks and explicitly pointed out that the rules take the interface.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
