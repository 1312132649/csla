<html><header><title>2.1 and shared rules.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>2.1 and shared rules.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1190.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 posted on Tuesday, September 12, 2006</h2><P><FONT face=Arial size=2>I have a rule here:</FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#0000ff>private</FONT> <FONT color=#0000ff>bool</FONT> IsValidEmailAddress(<FONT color=#0000ff>object</FONT> target, Csla.Validation.<FONT color=#008080>RuleArgs</FONT></FONT><FONT face=Arial> e)</FONT></FONT></P>
<P><FONT face=Arial size=2>{</FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;if</FONT> (!<FONT color=#008080>Regex</FONT>.IsMatch(_address, <FONT color=#800000>"\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*"</FONT></FONT><FONT face=Arial>))</FONT></FONT></P>
<P><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;{</FONT></P>
<P><FONT size=2><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.Description = </FONT><FONT face=Arial color=#008080>Resources</FONT><FONT face=Arial>.InvalidEmailFormat;</FONT></FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT> <FONT color=#0000ff>false</FONT></FONT><FONT face=Arial>;</FONT></FONT></P>
<P><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;}</FONT></P>
<P><FONT size=2><FONT face=Arial><FONT color=#0000ff>&nbsp;&nbsp;&nbsp;return</FONT> <FONT color=#0000ff>true</FONT></FONT><FONT face=Arial>;</FONT></FONT></P>
<P><FONT face=Arial size=2>}</FONT></P>
<P><FONT face=Arial size=2>Nothing too flashy. I've got to admit I'm not entirely sure I understand, after reading the release notes, whether I need to give additional attention to this rule when moving to 2.1. </FONT></P>
<P><FONT face=Arial size=2>It appears that everything immediately works fine after moving to 2.1, but I have seen notes discussing using <EM>static</EM> rule methods for type rules, and my rule is still an instance method.</FONT></P>
<P><FONT face=Arial size=2>I'm going to dig into some of the old posts but if someone is able to articulate the needed modifications when moving to 2.1, I'd appreciate it! </FONT></P>
<P><FONT face=Arial size=2></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 12, 2006</h2>Well, here's the thing to watch for.&nbsp; Are you adding that rule with AddRule, or AddInstanceRule?&nbsp; If you're still using the former, you'll have problems.&nbsp;&nbsp; The FIRST object will be the one checked, even if its the second object which had its email changed.<br><br>You can keep this as an instance method, but you'll need to change the AddRule to AddInstanceRule.&nbsp; Alternately (and what I'd recommend) is simply to make the rule method static.&nbsp; You can also use the Generic AddRule method so that you'll get your type instead of the generic object passed as target.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 12, 2006</h2><P>OK, I think I understand what you're saying. That's a tricky one. It's a good thing I'm in a process that has me visiting all of my classes anyways. </P>
<P>Taking what you said, let me throw out what I've changed it to - is this in the right spirit? </P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Method to add custom validation rules that are not generated. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void AddCustomRules()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Email address needs to be the appropriate format. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.AddRule&lt;EmailAddress&gt;(IsValidEmailAddress, "Address");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// Validation rule to test the format of the e-mail address. <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /// &lt;/summary&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static bool IsValidEmailAddress(EmailAddress target, Csla.Validation.RuleArgs e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!Regex.IsMatch(target._address, "<A>\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w</A>+)*"))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.Description = Resources.InvalidEmailFormat;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 12, 2006</h2>Looks fine to me.. although I'm not sure why the private method at add rules.&nbsp; Is there a reason you can't override AddBusinessRules (or AddInstanceBusinessRules)?<br><br>Otherwise, looks ok to me.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 12, 2006</h2><P>I'm using partial classes with the C# templates - so AddBusinessRules() is declared in the generated code, and then uses a delegate and that's where my method comes into play - adding business rules that aren't supported by the generated code from the templates&nbsp;at this point. </P>
<P>Thanks for the input! </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 12, 2006</h2>Makes prefect sense to me.<br><br>What do you generate your code from?&nbsp; Some kind of class diagram?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, September 12, 2006</h2><P>I generate it from the C# CodeSmith templates with some modifications. </P>
<P>I use the XML source option, which isn't the primary option, but it allows me to be a little bit more robust on what I can do with it, including such things as "property include files" to include "base class properties" for multiple concrete classes instead of duplicating them, provide means to add XML attributes for summary and remarks comments so my gen code is documented, etc.&nbsp; I just think the XML route is long term a little more powerful. </P>
<P>I had dreams of it generating the stored procedures for me too but I've set it aside for now. I did not take the CSLA Gen approach at the time because it seemed like the Codesmith C# templates were more widely adopted and also because I don't think there were C# 2.0 templates available for CSLA Gen at the time.&nbsp; </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, September 12, 2006</h2>Yes, your second method should work fine. The first method will, in the next release (beta) of 2.1, throw an exception at AddRule() - specifically to avoid the subtle bug you'd otherwise have introduced into your code.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 12, 2006</h2>Opps... I forgot you were going to add that feature. <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, September 12, 2006</h2>I haven't looked at CS yet, maybe I should. <br><br>I have a custom app that generates procs. The catch is they are VERY basic.. which for me is fine.&nbsp; I don't really want procs to be dependant on each other and wanted all the logic in the BOs.<br><br>Basically it uses Ado.net to get the table schema, then generates some Xml to represent it.&nbsp; It then runs the Xml through a few Xslts to generate the create proc script.&nbsp; Works very well.&nbsp; I spend 99% of my time now in the BO design and UI layers.&nbsp; The db is pretty simple since all I do is create my tables, then unlease my generator (which also creates classes in my DAL for the selected tables).<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
