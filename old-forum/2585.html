<html><header><title> Case-insentive datamapper</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1> Case-insentive datamapper</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2585.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>kobruleht posted on Sunday, March 25, 2007</h2><P>I use modified Rockford Lhotka excellent SetPropertyValue()<BR>from DataMapper class to load objects from database.<BR>My entity object property names are mixed case.<BR>DataReader returns lower-case only column names.<BR>So SetPropertyValue() cannot map columns to property names.</P>
<P>How to change this code so that it does not depend on the propertyName case ?</P>
<P>&lt;pre&gt;<BR>/// &lt;summary&gt;<BR>/// Sets an object's property with the specified value,<BR>/// coercing that value to the appropriate type if possible.<BR>/// &lt;/summary&gt;<BR>/// &lt;param name="target"&gt;Object containing the property to set.&lt;/param&gt;<BR>/// &lt;param name="propertyName"&gt;Name of the property to set.&lt;/param&gt;<BR>/// &lt;param name="value"&gt;Value to set into the property.&lt;/param&gt;<BR>public static void SetPropertyValue(<BR>&nbsp;&nbsp; object target, string propertyName, object value)<BR>&nbsp;{<BR>&nbsp;&nbsp; PropertyInfo propertyInfo =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target.GetType().GetProperty(propertyName);<BR>&nbsp;&nbsp; if (value == null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyInfo.SetValue(target, value, null);<BR>&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type pType =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Utilities.GetPropertyType(propertyInfo.PropertyType);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type vType =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Utilities.GetPropertyType(value.GetType());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pType.Equals(vType))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // types match, just copy value<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyInfo.SetValue(target, value, null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // types don't match, try to coerce<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pType.Equals(typeof(Guid)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyInfo.SetValue(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target, new Guid(value.ToString()), null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (pType.IsEnum &amp;&amp; vType.Equals(typeof(string)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyInfo.SetValue(target, Enum.Parse(pType, value.ToString()), null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if (pType.IsEnum &amp;&amp; vType.Equals(typeof(decimal)))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propertyInfo.SetValue(target, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enum.Parse(pType, value.ToString()), null);</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertyInfo.SetValue(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target, Convert.ChangeType(value, pType), null);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR>}<BR>&lt;/pre&gt;<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Monday, March 26, 2007</h2>Hi!<br><br>Make use of TypeDescriptor (available from System.ComponentModel namespace):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pDescriptors As PropertyDescriptorCollection = TypeDescriptor.GetProperties(objectType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pDescriptor As PropertyDescriptor = pDescriptors.Find(propertyName, True)<br><br>(It's VB code)<br><br>- the first line will give you a searchable (!) collection.<br>- the second line invokes Find on this collection where the second argument sets ignoreCase to True<br><br>You can then retrieve the name of the property in correct casing from the found descriptor:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pName As String = pDescriptor.Name<br><br>This name can then be fed to your call that returns the PropertyInfo object:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pInfo As PropertyInfo = target.GetType().GetProperty(pName)<br><br>And you should be good to go!<br><br>Bayu<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>kobruleht replied on Monday, March 26, 2007</h2><P>How about simply using:</P>
<P>&nbsp;&nbsp; PropertyInfo propertyInfo =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target.GetType().GetProperty(propertyName, System.Reflection.BindingFlags.Instance | <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Reflection.BindingFlags.IgnoreCase | System.Reflection.BindingFlags.Public)<BR></P>
<P>This is simpler than you approach.</P>
<P>Can Racky add this change to this method ?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Wednesday, March 28, 2007</h2>Ah,<br><br>Good one! Much cleaner than what I proposed.<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, March 28, 2007</h2>The only problem with that change is if you actually have two properties which differ by casing only.&nbsp; While I agree it shouldn't be done and is not CLS compliant, if someone where to do that, they'd have mysterious bugs in their code.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, March 29, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div>The only problem with that change is if you actually have two properties which differ by casing only.&nbsp; While I agree it shouldn't be done and is not CLS compliant, if someone where to do that, they'd have mysterious bugs in their code.<br></div></BLOCKQUOTE><br><br>Thankfully that is impossible in VB.<br><br>Really is an ugly remnant from C(++) and co imo.<br><br>;-)<br><br>Bayu<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, March 29, 2007</h2>Personally, I like the case sensitivity.&nbsp; I use this to seperate fields from properties..<br><br><font color="#0000ff">public string</font> MyString { <font color="#0000ff">get </font>{ <font color="#0000ff">return </font>myString; } <font color="#0000ff">set </font>{ myString = <font color="#0000ff">value</font>; }<br><font color="#0000ff">private string</font> myString; <br><br>I dislike using the _ or&nbsp; having to change the name of the field because a language is case insensitive.<br><br>Obviously, my opinion.&nbsp; <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Thursday, March 29, 2007</h2>I dó like using te 'm' or '_' prefix for private fields. For readability (you can quickly see private fields in your code), to avoid mistakes (I use VB ánd C#), but far most because you get a nice fast accessable list in IntelliSense when beginnen typing :-)<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Thursday, March 29, 2007</h2>Everybody has their own style.&nbsp; What is the 'm' supposed to mean though?&nbsp; We used to use s for string, i for integer, etc., but that was in the classic asp days.&nbsp; We used m for module level variables... but that doesn't make sense to me anymore because we don't have modules, we have classes, namespaces and assemblies.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Thursday, March 29, 2007</h2>I don't know for sure, but you see it in a lot of VB code. It could be something like member or something.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bayu replied on Thursday, March 29, 2007</h2><BLOCKQUOTE><div><img src="/Themes/alternate1/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div> What is the 'm' supposed to mean though? </div></BLOCKQUOTE><br><br>I think there can only be one correct answer to this ......... <br>It stands for MMMMMMMMMMMMMicrosoft of course!........ what'd ya think? ;-p<br><br>It's the 'M' of Making Money and for doing things Mightily diffferently, namely the MMMMicrosoft way!<br><br>;-)<br><br><br><br>No, I always thought it was for 'my', as in a a possessive noun that refers to the class. So it was supposed to be used for class-level (i.e. private) variables. You know, there were those days suddenly everything became 'mine' (as if it was Microsoft's before), think of the introduction of My Computer, My Documents, My Videos, My .. My, My .... (say this several times and you start to sound like those pelicans from Finding Nemo ;-) ).<br><br>Bayu<br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
