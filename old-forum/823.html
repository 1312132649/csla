<html><header><title>ASP.NET Custom Principal Reverts to Generic on Postbacks</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ASP.NET Custom Principal Reverts to Generic on Postbacks</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/823.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fiodhrid posted on Friday, August 04, 2006</h2><P>Hello, all</P>
<P>I have a problem that is very similar to "<FONT color=#800080> GenericPrincipal error when logged in" </FONT><FONT color=#000000>which was posted on 6 June 2006 - that application was Windows, mine is ASP.</FONT></P>
<P>In ASP.NET 1.1, I am setting the AppDomainPrincipalPolicy.UnauthenticatedPrincipal then&nbsp;setting the AppDomain.SetThreadPrincipal to my Custom Principal successfully. </P>
<P>Then i set the Thread.CurrentPrincipal to my Custom Principal successfully.</P>
<P>From there, any postback causes both the Thread.CurrentPrincipal and the AppDomain thread principal to revert to an empty&nbsp;GenericPrincipal!! Not too big a deal on a page post since I do some page initializations and can reset it there. But I find that even a DataGrid button column click is causing the reversion to an empty GenericPrincipal. </P>
<P>Can anyone please help me get a clue as to what is going on here? Why won't my AppDomain and Thread maintain my CustomPrincipal??</P>
<P>tnx</P>
<P>Fio</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, August 04, 2006</h2>This is explained in Chapter 10. You need to reset the principal on every page request in global.asax.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Fiodhrid replied on Saturday, August 05, 2006</h2><P>Got it. I haven't had a chance to try an implementation of&nbsp;this Global event in my application as yet, but I can see that this will solve my issue.</P>
<P>thanks so much.</P>
<P>Rocky, I can never thank you enough for all you've taught me thru your several iterations of "Expert Business Objects". Your books have become my bible - I never leave home without them.</P>
<P>THANKS!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ntimothys replied on Tuesday, October 22, 2013</h2><p>Overridding Principal in:<br />protected void Application_PostAuthenticateRequest(object sender, EventArgs e)<br /><br />Instead of <br />&nbsp;protected void Application_AuthenticateRequest(object sender, EventArgs e)<br /><br />In Global.asax.cs worked for me in an ASP web application</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
