<html><header><title>binding error message</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>binding error message</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2035.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Tian posted on Wednesday, December 27, 2006</h2><P><FONT size=1>Hi,&nbsp; All,</FONT></P>
<P><FONT size=1>I just converted my window application from .Net 1.1 to .Net 2.0 and I use Csla1.5.3 instead of old Csla1.4.x. ( I don't have time to rewrite business object to Csla2.1 now, just want my application can run under .net 2.0.) I modified my application and it compiles without errors and warnings.</FONT></P>
<P><FONT size=1>But I get runtime exception when I run it. the problem is to bind the object to grid.&nbsp; <BR></FONT><FONT size=1><FONT color=#ff0000>Me.grdAnswerResponse.DataSource =&nbsp; m_obj</FONT>&nbsp; </FONT></P>
<P><FONT size=1>the m_obj is collection of objects and its count is 0 at first time when the form is loaded. the error message is "<FONT>An exception of type 'System.InvalidOperationException' occurred in CSLA.Core.Bindablebase.dll but was not handled in user code. Additional information: Adding items not allowed</FONT>"&nbsp; I trace the code and find source code is at BindableCollectionBase under csla.core.bindablebase dll.</FONT></P><FONT color=#0000ff>
<P><FONT size=1>public</FONT></FONT><FONT size=1> <FONT color=#0000ff>event</FONT> ListChangedEventHandler ListChanged<BR>{<BR>&nbsp;&nbsp;&nbsp;add<BR>&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;<BR><FONT color=#0000ff>if</FONT> (<FONT color=#0000ff>value</FONT>.Method.IsPublic &amp;&amp; (<FONT color=#0000ff>value</FONT>.Method.DeclaringType.IsSerializable || <FONT color=#0000ff>value</FONT>.Method.IsStatic))<BR>&nbsp;_serializableHandlers = (ListChangedEventHandler)Delegate.Combine(_serializableHandlers, <FONT color=#0000ff>value</FONT>);<BR></FONT><FONT size=1><FONT color=#0000ff>else<BR></FONT><FONT color=#ff0000>_nonSerializableHandlers = (ListChangedEventHandler)Delegate.Combine(_nonSerializableHandlers, value);</FONT></FONT></P>
<P><FONT size=1>}remove{</FONT></P>
<P><FONT size=1><FONT color=#0000ff>if</FONT> (<FONT color=#0000ff>value</FONT>.Method.IsPublic &amp;&amp; (<FONT color=#0000ff>value</FONT>.Method.DeclaringType.IsSerializable || <FONT color=#0000ff>value</FONT>.Method.IsStatic))_serializableHandlers = (ListChangedEventHandler)Delegate.Remove(_serializableHandlers, <FONT color=#0000ff>value</FONT>);<BR></FONT><FONT size=1><FONT color=#0000ff>else<BR></FONT>_nonSerializableHandlers = (ListChangedEventHandler)Delegate.Remove(_nonSerializableHandlers, <FONT color=#0000ff>value</FONT>);<BR>&nbsp;&nbsp;&nbsp;}<BR>}</FONT></P>
<P><FONT size=1>The red color code will call&nbsp; the below method&nbsp; and throw the exception.&nbsp; I checked and know the code is almost same as Cals1.4.x. Why it won't have error message popup under my application .Net1.1 even it throws exception too under csla1.4.x? I didn't modify any code for this part but&nbsp;I get the error under Csla1.5.3</FONT></P><FONT color=#0000ff>
<P><FONT size=1>object</FONT></FONT><FONT size=1> IBindingList.AddNew() <BR>{ <BR>&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>if</FONT>(AllowNew)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>return</FONT> OnAddNew(); <BR>&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT size=1><FONT color=#0000ff>else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#ff0000> throw new InvalidOperationException(Strings.GetResourceString("AddItemException"));<BR></FONT>}</FONT></P>
<P><FONT size=1>The same code won't have any problem under csla.1.4.x. If the&nbsp;m_obj's count is not zero, it won't have the exception. How could I fix it and am I missing something? </FONT><FONT size=1>Thank you!</FONT></P>
<P><FONT size=1>Brian</FONT></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, December 27, 2006</h2>When your list is loading in your DP_F, are you setting IsReadOnly = false before trying to add items to your collection?&nbsp; Or is this not a readonly list?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Tian replied on Wednesday, December 27, 2006</h2><P>ajj3085,</P>
<P>No, it is not a readonly list, it inherits from <FONT size=2>BusinessCollectionBase(Cals.1.5.3)&nbsp; I only set AllowSort = true. I can not find the detail info for the difference between csla.1.4.x and csla.1.5.3.&nbsp; I thini it will help me if i can find it.</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>Thanks.</FONT></P>
<P><FONT size=2>Brain</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Wednesday, December 27, 2006</h2>Does your collection object have this line in it?<br><br>this.AllowNew = true;<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Tian replied on Wednesday, December 27, 2006</h2><P>No, I don't have this.AllowNew = true; I only set AllowSort = true.&nbsp; Why I need this line?&nbsp; BTW, when the m_obj is not empty, it&nbsp;is ok. </P>
<P>I checked&nbsp;my application under&nbsp;Csla1.4.x, it throws the exception too but there is not popup exception winodw under .Net1.1.&nbsp; but under .Net2.0, it follows the some codes&nbsp; and&nbsp;gives exception. </P>
<P>thanks for your help</P>
<P>Brian<BR></P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Thursday, December 28, 2006</h2>You need the line because the list implements IBindingList which has a property called AllowNew.&nbsp; This tells any outside object (such as a DataGrid) whether the list allows items to be added through the IBindingList.AddNew method.&nbsp; The default is false.&nbsp; If you look at your example that you posted, If AllowNew is false, it will throw an exception.&nbsp; So you have to add that line and override OnAddNew().&nbsp; If AllowNew defaulted to true, you would get an exception because OnAddNew is not implemented by default.&nbsp; VS2005 added in the new exception box and it is there whenever an exception is encountered.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Thursday, December 28, 2006</h2>Some grids have an issue when the collections are empty. They can't figure out what type will the child be, so they can't auto gen the columns.<br>As a workaround, these grids attempt to add a new item to the collection when it's empty, and then remove it.<br><br>Yeah, it sucks.<br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Tian replied on Thursday, December 28, 2006</h2><P><FONT size=2>Thanks all you guys' help.</FONT></P>
<P><FONT size=2>&nbsp;I use the Infragistic Grid control and find a similar&nbsp; problem. the link is at <A HREF="/forums/thread/1993.aspx">http://forums.lhotka.net/forums/thread/1993.aspx</A>&nbsp; </FONT></P>
<P><FONT size=2>Like Dawn suggestion "try not to bind the CSLA collection directly to the Infragistics Grid, using a BindSource Component instead. And set the BindSouce Componet's DataSouce to you CSLA collection." It works for me&nbsp;and not exception popups. but I get another problem that related to Infragistic, I may need to upgrade Infragistic. Now, I'm using Infragistic5.3.</FONT></P>
<P><FONT size=2>Thanks </FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>Brian</FONT></P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
