<html><header><title>CancelEdit() - Problem with childs</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CancelEdit() - Problem with childs</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/5634.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>ThomasHepp posted on Monday, October 20, 2008</h2><P><FONT face=Arial>Hi,</FONT></P>
<P><FONT face=Arial>I have a BusinessListBase with BOs. Each of them have a BusinessListBase too. My list is bound to a grid and changes are made in a seperate form.</FONT></P>
<P><FONT face=Arial><STRONG>My Problem:</STRONG> If I call CancelEdit on my BO it doesn't cancel the changes of my child collection. I've debugged the code and I found that in the method "Csla.Core.UndoableBase.UndoChanges(int parentEditLevel)":</FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>if</FONT></FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>typeof</FONT></FONT><FONT size=2>(Csla.Core.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IUndoableObject</FONT></FONT><FONT size=2>).IsAssignableFrom(field.FieldType))</P>
<P>{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;// this is a child object<BR></FONT></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;// see if the previous value was empty<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (state.Contains(GetFieldName(field)))<BR>&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// previous value was empty - restore to empty<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field.SetValue(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>, </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>);<BR>&nbsp;&nbsp;&nbsp;}<BR></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;else<BR></FONT></FONT><FONT size=2>&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;// make sure the variable has a value<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (value != </FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>null</FONT></FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;{<BR></FONT><FONT color=#008000 size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// this is a child object, cascade the call.<BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT></FONT><FONT size=2> (!_bindingEdit)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((Core.</FONT><FONT color=#2b91af size=2><FONT color=#2b91af size=2>IUndoableObject</FONT></FONT><FONT size=2>)value).UndoChanges(</FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>this</FONT></FONT><FONT size=2>.EditLevel);<BR>&nbsp;&nbsp;&nbsp;}<BR>}<BR></FONT></P>
<P><FONT face=Arial>If&nbsp;that code comes to my child collection "_bindigEdit" is true, altough I called CancelEdit() in my child form. </FONT></P>
<P><FONT face=Arial><STRONG>Now is my question:</STRONG> How can I cancel my modifications so, that the modifications on the childobject are canceld too?</FONT><FONT size=2></P></FONT>
<P><FONT face=Arial></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 20, 2008</h2><P>This is addressed in the <EM>Using CSLA .NET 3.0</EM> ebook. Windows Forms data binding is very picky about how the object behaves, and no variation is allowed.</P>
<P>The basic process is this:</P>
<OL>
<LI>BEFORE BINDING to the UI, manually call BeginEdit() on your root object</LI>
<LI>Bind your object to the UI, let the user do their work</LI>
<LI>If the user clicks Cancel, UNBIND FROM THE UI, then manually call CancelEdit() on your root object</LI>
<LI>If the user clicks Save, UNBIND FROM THE UI, then manually call ApplyEdit() on your root</LI></OL>
<P>The process of unbinding is a little tricky and must be done exactly as shown in PTWin 3.0.4 or higher, and as described in the ebook. In CSLA .NET 3.6 there's a new CslaActionExtender control (and associated component) to make this process simpler.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
