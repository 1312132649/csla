<html><header><title>EditLevelMismatch</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>EditLevelMismatch</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9584.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it posted on Tuesday, September 28, 2010</h2><p>Hi,</p>
<p>I&#39;m using CSLA.NET 3.8.4</p>
<p>I have quotation object having Items collection as child object. An Individual Item object is also having a collection of attachments as a child object. In UI I used a separate form to add attachments to each and every Item.</p>
<p>When I tried to save the root object quotation, an unhandled exception is thrown stating that &#39;EditLevelMismatch&#39; has occurred.</p>
<p>&nbsp;</p>
<p>My Attactment form is called from quotation form and the code looks like below.</p>
<p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void ubtnAttachments_Click(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (itemsUltraGrid.Selected.Rows.Count &lt;= 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(&quot;Please select the row to add attachments&quot;, &quot;Item not selected.&quot;,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBoxButtons.OK, MessageBoxIcon.Exclamation);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index = itemsUltraGrid.Selected.Rows[0].Index;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FormAttachments formAttachments = new FormAttachments(_quotation.Items[index].QuotationAttachments);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; formAttachments.ShowDialog(this);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itemsBindingSource.ResetBindings(true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; formAttachments.Dispose();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</b></p>
<p>&nbsp;</p>
<p>And my formAttachment code on OK button follows</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> private void ubtnOK_Click(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quotationAttachmentsBindingSource.RaiseListChangedEvents = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnbindBindingSource(quotationAttachmentsBindingSource, true, false);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.DialogResult = DialogResult.OK;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</b></p>
<p>Cancel button code as follows</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>private void ubtnCancel_Click(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quotationAttachmentsBindingSource.RaiseListChangedEvents = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnbindBindingSource(quotationAttachmentsBindingSource, false, false);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _attachments.CancelEdit();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.DialogResult = DialogResult.Cancel;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</b></p>
<p>When I click on save button on my quotation form the error was thrown as the stated above.</p>
<p>Regards</p>
<p>MSRS</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, September 28, 2010</h2><p>Version 3.8 doesn&#39;t support the idea of having more than one bindingsource (I assume we&#39;re talking Windows Forms here) bound to an object graph at the same time.</p>
<p>So if you open a child window to edit a child object, you must first completely unbind the object graph from the original form&#39;s bindingsource.</p>
<p>CSLA 4 addresses this, allowing multiple bindingsource objects to bind to the same graph - though even in that case you must <i>absolutely be sure</i> to properly unbind the child bindingsource when done. It is your responsibility to do the unbinding, because as long as an object is bound, its edit level is elevated - and even when you unbind, you need to force the edit level down one, because Windows Forms will leave it elevated.</p>
<p>This is just the way Windows Forms works, and it complicates things quite a lot. The <i>Using CSLA .NET 3.0</i> ebook discusses this in some detail.</p>
<p>But in the end, 3.8 doesn&#39;t support multiple bindingsource bindings against an object graph, and I suspect that&#39;s your issue.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it replied on Wednesday, September 29, 2010</h2><p>Thanks Rocky.</p>
<p>Even though I tried to use the quotation object without child form [by using infragistics WinGrid control for hierarchical data support]. still it&#39;s raising the same error. I&#39;ll go through the suggested book and will do some manual work and come back to you for any doubts.</p>
<p>Regards</p>
<p>MSRS</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>msrs_it replied on Friday, October 15, 2010</h2><p>Hi Rocky,</p>
<p>As you said previously, Multiple binding sources causing problem in WinForms. And the another thing was I tried with the Infragistics Netadvantage UltraWinGird Control which supports multi Band. It&#39;s is also not solved my problem due the Known Issue with that control. Recent version of using those controls solved my problem.</p>
<p>Thanks &amp; Regards</p>
<p>MSRS</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
