<html><header><title>Ignoring individual properties when determining whether an object is savable</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Ignoring individual properties when determining whether an object is savable</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9249.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>chris.stafford posted on Wednesday, July 21, 2010</h2><p>Hello, all.&nbsp; I am constructing business objects for a project at work, and I have run into a bit of a snag.&nbsp; I need to display an Employee&#39;s Name on a data grid, and the base object only contains the Id, which then joins to the Employee Table.&nbsp; That&#39;s easy to handle; I simply use the getter to load it.&nbsp; Like so:</p>
<p>&nbsp;<span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">public</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">static</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">PropertyInfo</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">&lt;</span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">String</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">&gt; EmployeeNameProperty = RegisterProperty&lt;</span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">String</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">&gt;(c =&gt; c.EmployeeName);</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">public</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> </span></span><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">String</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> EmployeeName</span></span></span></p>
</span></span></p>
<p>{</p>
<p>
<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="color:#0000ff;font-size:x-small;">get</span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:small;">{</span></p>
<p><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">#if</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> SILVERLIGHT</span></span></span></p>
</span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;"><span style="font-size:x-small;color:#2b91af;font-family:Consolas;">Employee</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">.GetEmployee((o,e) =&gt;</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p>{</p>
</span></span><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">if</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> (e.Object != </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">null</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">)</span></span></span></p>
</span></p>
<p>{</p>
<p>
<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p>SetProperty(EmployeeNameProperty, e.Object.LastName + </p>
</span></span><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#a31515;font-family:Consolas;"><span style="font-size:x-small;color:#a31515;font-family:Consolas;"><span style="font-size:x-small;color:#a31515;font-family:Consolas;">&quot;, &quot;</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> + e.Object.FirstName);}</span></span></span></p>
</span></p>
<p>},EmployeeId);</p>
<p><span style="font-family:Consolas;font-size:small;color:#0000ff;">#endif</span></p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">
<p><span style="color:#000000;font-family:Arial, Helvetica, sans-serif;font-size:12px;">}</span></p>
</span></span></span></span></p>
<p>
<span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">return</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> GetProperty(EmployeeNameProperty);}</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:small;"><span><span style="font-family:Consolas;"><span style="font-size:x-small;"><br /></span></span></span></span></p>
</span></span></p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">set</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> { SetProperty(EmployeeNameProperty, </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">value</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">); }</span></span></p>
<p>&nbsp;</p>
<p>This code works perfectly for retrieving the Employee&#39;s Name from the database.&nbsp; Unfortunately, though, when the property gets called on the result handler, the collection is marked as savable.</p>
<p>Is there any way to prevent this property from triggering the save?&nbsp; I&#39;ve tried the following options, with no luck:</p>
<p>1.&nbsp; Marking the property with [NonSerializable]</p>
<p>2.&nbsp; Wrapping the SetProperty method with using(BypassPropretyChecks)</p>
<p>Anything else I can try?</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Marjon1 replied on Wednesday, July 21, 2010</h2><p>Instead of using SetProperty, use LoadProperty which will not mark the field as dirty.</p>
<p>BypassPropertyChecks only removes the calls to check authorization rules and doesn&#39;t call any validation rules, it has no affect on the dirty state as you&#39;ve discovered. <br /><br />Marking the property as NonSerializable would just mean that it is not sent across to the server and back, essentially resetting it every time it was sent to the sever.</p>
<p>I don&#39;t know what your objects are actually being used for, but with the code that you have there if there are 1,000 records in the grid then you will be hitting the database 1,000 times (possibly creating that many connections as well). If possible to get the information at the time of fetching the list would be much more efficient.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, July 22, 2010</h2><p>Marjon is right on all counts. There are ways to avoid marking the collection savable, but the right way to do this is to left join the table containing the ID with the one containing the name and retrieve the collection in a single round-trip to the server. </p>
<p>We found out the hard way that round-trips for per row property retrieval will absolutely ruin performance.&nbsp; It&#39;s one thing in a test environment with low network and database response latency, but if your latency gets up to, say 200 ms total for example, you&#39;ll make the user wait 20 seconds to see just 100 rows, and minutes to see 1000. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>chris.stafford replied on Thursday, July 22, 2010</h2><p>How would I go about joining the objects so that they all load at once?&nbsp; I am still new to CSLA, so while I can handle single objects pretty well, associations of objects and collections are something I have no working knowledge of.</p>
<p>If it helps, here&#39;s the LINQ&nbsp;statement for my fetch selection:</p>
<p>&nbsp;</p>
<p><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
</span></span></span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p>retval = (</p>
</span></span><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">from</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> item </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">in</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> context.ProjectRosterEmployees</span></span></span></p>
</span></p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">join</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> projects </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">in</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> context.Projects</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">on</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> item.ProjectId</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">join</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> employees </span></span><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">in </span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">context.Employees</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">on</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> item.EmployeeId</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">equals</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> employees.Id</span></span></span></p>
</span></span></p>
<p><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">where</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> projects.Id == ProjectId</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">orderby </span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;">employees.LastName, employees.FirstName</span></span></span></p>
</span></span></p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">
<p><span style="font-family:Arial, Helvetica, sans-serif;font-size:12px;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;"><span style="font-size:x-small;color:#0000ff;font-family:Consolas;">select</span></span></span><span style="font-size:x-small;font-family:Consolas;"><span style="font-size:x-small;font-family:Consolas;"> item).ToList();</span></span></span></p>
</span></span></p>
<p>&nbsp;</p>
<p>As you can see, the join is already there.&nbsp; I wanted to make sure the Roster list came back ordered properly.&nbsp; I&#39;m less clear on how to make sure the Employee object is attached to the ProjectRosterEmployee object, though.&nbsp; Any help you guys can offer to help me improve the effeciency of this code&nbsp;would be very much appreciated.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, July 22, 2010</h2><p>If you haven&#39;t, you really should read <i>Expert 2008 Business Objects</i> chapters 1-5 and 17-18 - those chapters explain exactly what you are asking, and a lot more important material as well.</p>
<p>Another source of (more up to date) information is the <i>Core 3.8 video series</i>, which also covers the concepts you are asking about.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
