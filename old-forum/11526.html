<html><header><title>Server not setting client's current culture</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Server not setting client's current culture</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11526.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives posted on Friday, August 10, 2012</h2><p>Hi,</p>
<p>I&nbsp;have a CSLA 4.1 Silverlight application and noticed that CSLA doesn&#39;t seem to be flowing the client&#39;s CurrentCulture to the server&#39;s current thread.</p>
<p>I made a few changes to the Silverlight SimpleApp to test this out.&nbsp; In App.xaml.cs, I added the following to Application_Startup:</p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"><font face="Consolas" size="2"><font face="Consolas" size="2">
<p>System.Threading.</p>
</font></font></span><font face="Consolas" size="2">
<p>&nbsp;</p>
</font></span></p>
<p><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">Thread</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">.CurrentThread.CurrentCulture = </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">new</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> System.Globalization.</span></span><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;"><span style="font-family:Consolas;color:#2b91af;font-size:x-small;">CultureInfo</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">(</span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">&quot;en-GB&quot;</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">);</span></span></p>
<p>&nbsp;</p>
<p>In CustomEdit.DataPortal_Insert, I put a breakpoint near the beginning.&nbsp; After choosing to save a new item, the CurrentCulture is &quot;en-US&quot;, which is the setting on the server.&nbsp; I expected it to be &quot;en-GB&quot;.</p>
<p>Am I missing something, or is CSLA behaving correctly?&nbsp; My understanding is that CSLA is supposed to establish the client&#39;s CurrentCulture and CurrentUICulture on the server automatically.</p>
<p>In looking at the code, I notice that Csla.Server.Hosts.Silverlight.WcfPortal.Update uses an UpdateRequest object, which has properties for CurrentCulture and CurrentUICulture.&nbsp; From debugging, the server does seem to be getting the anticipated values for these properties (e.g. en-GB), but nothing in WcfPortal appears to reference these properties.&nbsp; So, WcfPortal calls SilverlightRequestProcessor.Update, which calls Csla.DataPortal.Update, which instantiates a DataPortalContext that references CurrentCulture on the executing thread, but that is en-US.</p>
<p>Thanks,</p>
<p>Tim</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Sunday, August 12, 2012</h2><p>Hi, </p>
<p>This seem like a bug. Will look into this for Csla 4.5.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Peran replied on Sunday, August 19, 2012</h2><p>Ah, I noticed this but thought the issue was probably due to something I had done. <span>&nbsp;I took a quick fix and set the culture in the web.config as work around, then proceeded to forget about it.&nbsp;</span></p>
<p>It&#39;s good to know it&#39;s a general issue and not just me!</p>
<p>&nbsp;</p>
<p>Peran</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Monday, August 20, 2012</h2><p>See <a href="http://www.lhotka.net/cslabugs/edit_bug.aspx?id=1084">http://www.lhotka.net/cslabugs/edit_bug.aspx?id=1084 </a></p>
<p>Fixed for CSLA 4.5</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>tiago replied on Monday, August 20, 2012</h2><p>deleted&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>trives replied on Monday, August 20, 2012</h2><p>Thanks&nbsp;JonnyBee! </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
