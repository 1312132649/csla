<html><header><title>OT? Why is my SafeDataReader empty?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>OT? Why is my SafeDataReader empty?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3443.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson posted on Tuesday, August 28, 2007</h2><P>My parent&nbsp;ERO is populating children in its DP_Fetch.&nbsp; Rather than building a sProc to generate multiple result sets, I'm running a sProc to populate Parent's properties, closing its SafeDataReader, and then using the same command object to populate <STRONG><EM>another</EM></STRONG> SafeDataReader(SDR).</P>
<P>The ERO's properties get populated normally.&nbsp; But the second SDR is alway empty.&nbsp; Yet when I stop the code both before and after the call to the sqlcommand object's Execute method, I can execute the sProc in Query Analyzer (using the same value for the parameter being supplied in my code) and it executes perfectly,&nbsp;generating a well-populated row of data.&nbsp; But it leaves the SDR empty in the ERO's fetch, so that when I pass the empty dr to the child object (not a collection), the child's Fetch event bombs when it tries to read the data that isn't there.&nbsp; It might as well bomb.&nbsp; There should ALWAYS be data present.&nbsp; The fact that a parameter value was available means that there <STRONG><EM>should</EM></STRONG> be child info.</P>
<P>Also please note, there is no run time error (e.g. no warning that there is already a datareader open or such)</P>
<P>FYI, the relevant code looks like the following (lots is missing of course):</P>
<P>with cmd<BR>&nbsp; .commandtext = "spGetWarrant"<BR>&nbsp; .parameters.add("@WarrantID", crit.WarrantID)<BR>&nbsp; dim dr as New SafeDataReader(.ExecuteReader)<BR>&nbsp; WarrantID = crit.WarrantID<BR>&nbsp; &lt;otherProps = dr.Get&lt;type&gt;(index)&gt;<BR>&nbsp; .... blah blah to populate properties<BR>&nbsp; dr.Close</P>
<P>&nbsp; .commandtext = "spGetEmployee"<BR>&nbsp; .parameters.clear<BR>&nbsp; .parameters.add("@WarrantID", crit.WarrantID)<BR>&nbsp; dim drEmp as New&nbsp;SafeDataReader(.ExecuteReader)</P>
<P>&nbsp; &lt;drEmp is empty&gt;<BR>end with</P>
<P>Why??? The Emp sProc&nbsp;is over 30&nbsp;lines of SQL code joining three tables, and I'd really prefer not to pack it into the sProc with all&nbsp;the other SQL just&nbsp;to use the .NextResultset technique with a single SafeDataReader if I don't have to.&nbsp; </P>
<P>Thanks for any help you can offer.</P>
<P>Q</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, August 28, 2007</h2><P>This may be an obvious suggestion but I've had this simple piece of code trip me up before...</P>
<P>Are you doing a dr.Read before trying to get data from the SafeDataReader? </P>
<P>Chris</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Q Johnson replied on Tuesday, August 28, 2007</h2><P>Yes, I guess&nbsp;it was obvious...&nbsp;and yes it <STRONG><EM>was</EM> </STRONG>my mistake.&nbsp; I'm an idiot, but a happy idiot !!!!&nbsp; Thanks.</P>
<P>I'm so used to only having to use the Read command once (because I'm so used to using only one data reader), that I just skipped this.&nbsp; </P>
<P>Thanks so much!&nbsp; Back to productive work on that project again.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, August 28, 2007</h2><P>This little bug has caused me problems and wasted time before, so I'm glad I could help.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
