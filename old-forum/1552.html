<html><header><title>ValidationRules - multiple conditions</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ValidationRules - multiple conditions</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/1552.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit posted on Friday, October 20, 2006</h2><P>Hi guys,</P>
<P>A simple one I hope. </P>
<P>I need to create a validation rule on my object that is dependent on the value of a number of columns in my object.</P>
<P>Here's what I have;</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> AddBusinessRules()</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> Validation.CommonRules.StringRequired, </FONT><FONT color=#800000 size=2>"SALESREP"</FONT><FONT size=2>)</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> QuantitySpecified, </FONT><FONT color=#800000 size=2>"ACCOUNTS"</FONT><FONT size=2>)</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> QuantitySpecified, </FONT><FONT color=#800000 size=2>"UNITS"</FONT><FONT size=2>)</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> QuantitySpecified, </FONT><FONT color=#800000 size=2>"UNITVALUE"</FONT><FONT size=2>)</P>
<P>ValidationRules.AddRule(</FONT><FONT color=#0000ff size=2>AddressOf</FONT><FONT size=2> QuantitySpecified, </FONT><FONT color=#800000 size=2>"ORDERVALUE"</FONT><FONT size=2>)</P>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</FONT><FONT size=2> QuantitySpecified( _</P>
<P></FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> target </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>, _</P>
<P></FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> e </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Validation.RuleArgs) </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> mACCOUNTS &lt; 1 </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> mUNITS &lt; 1 </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> mUNITVALUE &lt; 1 </FONT><FONT color=#0000ff size=2>AndAlso</FONT><FONT size=2> mORDERVALUE &lt; 1 </FONT><FONT color=#0000ff size=2>Then</P></FONT><FONT size=2>
<P>e.Description = </FONT><FONT color=#800000 size=2>"You must specify at least one 'quantity' criteria"</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>False</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If</P></FONT><FONT size=2>
<P>e.Description = </FONT><FONT color=#800000 size=2>""</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>True</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Function</P></FONT><FONT size=2>
<P>#</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Region</P></FONT>
<P>The problem here is that initially (all values are zero) the rules are broken, and even though I may say, change the ACCOUNTS value to 100, it doesn't remove the other broken rules.</P>
<P>Similar, if I only create a single rule on Accounts, it is only triggered when changing that value and no others.</P>
<P>My thinking is that I create another private property called 'mtotal' and write it each time any of the other values changes. But I wanted to see if there was another (proper) way of addressing this before I proceeded.</P>
<P>Any suggestions?</P>
<P>&nbsp;</P>
<P>Thanks,</P>
<P>gajit.</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, October 20, 2006</h2><P>Change AndAlso to OrElse and see what happens.</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, October 20, 2006</h2><P>On page 414 of the C# book it talks about solving dependant properties.</P>
<P>In your setter of each amount, you would:</P>
<P>ValidationRules.CheckRules("&lt;propertyx&gt;");</P>
<P>ValidationRules.CheckRules("&lt;propertyy&gt;");</P>
<P>etc. </P>
<P>That is, when an amount changes, it'll automatically check its rule, but you should also have it check the other properties as well. </P>
<P>That's one approach that could be applied to your problem. </P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Friday, October 20, 2006</h2>Tried this approach and it still doesn't appear to work...<br>The business object remains as per my original post, but now in my property SETs for each property, I have;<br><br>Public Property ACCOUNTS() As Integer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanReadProperty(True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return mACCOUNTS<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set(ByVal Value As Integer)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CanWriteProperty(True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If mACCOUNTS &lt;&gt; Value Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mACCOUNTS = Value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PropertyHasChanged()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules("ACCOUNTS")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules("UNITS")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules("UNITVALUE")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationRules.CheckRules("ORDERVALUE")<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Set<br><br>Am I still missing something?<br><br>Thanks,<br>gaj.<br><br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, October 20, 2006</h2>The CheckRules calls have to go before PropertyHasChanged().&nbsp; PropertyHasChanged() fires the PropertyChanged event for the property which signals to data binding and the ErrorProvider to do their stuff.&nbsp; If the valid state changes after that, it will not be picked up.&nbsp; Also, if you are going to use the reflection version of PropertyHasChanged, you need to mark your property with the NoInlining attribute.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Friday, October 20, 2006</h2>That did it Brian, thank you!<br><br>hmmm. "reflection"..&nbsp; i hate that word...&nbsp;&nbsp; <br>Can i ask what Noinlining does?<br><br>Thanks,<br>Gaj<br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Friday, October 20, 2006</h2><P>Inlining is a compiler trick to aid in performance - it would bring the code from CheckRules directly into your setter and run it in the context of your setter.</P>
<P>I'm curious myself to some degree - since the property names&nbsp;are being passed to checkrules, is this in fact needed? (Brian must know the answer to this one since he mentioned it!)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, October 20, 2006</h2>PropertyHasChanged() (with an empty parameter list) uses reflection to determine which property changed.&nbsp; If you build in release mode and the property gets inlined, it no longer is in that property and PropertyHasChanged would not pick it up properly.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Friday, October 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>Brian Criswell:</strong></div><div>PropertyHasChanged() (with an empty parameter list) uses reflection to determine which property changed.&nbsp; If you build in release mode and the property gets inlined, it no longer is in that property and PropertyHasChanged would not pick it up properly.<br></div></BLOCKQUOTE><br><br>So how is the NoInline implemented? As part of the Property definition? A keyword help search has proven fruitless...<br><br>Thanks,<br>gaj.<br><br>Reflection - no specific questions Brian - but thanks for offering. it has been a little while since I read the CSLA book, but although not totally confused, didn;t quite 'get it' .. and moved ahead taking a 'leap of faith' that it would work. I have yet to implement my csla project across tiers as of yet (other than client-database server) so not sure how much knowledge I will need ...<br><br><br><br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Friday, October 20, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>gajit:</strong></div><div><br>hmmm. "reflection"..&nbsp; i hate that word...<br></div></BLOCKQUOTE><br>Do you have any specific concerns about reflection?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, October 20, 2006</h2>You can avoind making all those calls in the property sets by adding dependant properties.<br>This is a new 2.1 feature. Basically, when you are adding business rules, you also call:<br>ValidationRules.AddDependantProperty("propertyA","propertyB")<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>gajit replied on Friday, October 20, 2006</h2>Thanks Andres, but I'm stuck on 2.0 at the moment, and don't have the resources right now to make the move... (plus I'm a little scared..:).. )<br><br>There are also other features of 2.1 - such as the varying degrees of rules validation that i would like to take advantage of...<br><br>gaj.<br><br><br><br><br><br><br><br><br><br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
