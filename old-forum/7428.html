<html><header><title>Using BusinessBase object as Child property</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Using BusinessBase object as Child property</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/7428.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Frances83 posted on Sunday, August 09, 2009</h2><font size="2"><font face="Verdana">Hi all,<br><br>I'm using CSLA for Silverlight v3.7.0.0.<br><br>My situation is the following. I have a class which looks like this:<br><br><font face="Courier New">namespace MyNameSpace<br>{<br>&nbsp;&nbsp;&nbsp; using System;<br><br>&nbsp;&nbsp;&nbsp; using Csla;<br>&nbsp;&nbsp;&nbsp; using Csla.Serialization;<br><br>&nbsp;&nbsp;&nbsp; [Serializable]<br>&nbsp;&nbsp;&nbsp; public class FormattedNumber : BusinessBase&lt;FormattedNumber&gt;<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; numberProperty = RegisterProperty&lt;string&gt;(c =&gt; c.Number, "Number", String.Empty);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;string&gt; numberFormatProperty = RegisterProperty&lt;string&gt;(c =&gt; c.NumberFormat, "NumberFormat", String.Empty);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FormattedNumber()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string NumberFormat<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return GetProperty(numberFormatProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(numberFormatProperty, value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Number<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return GetProperty(numberProperty);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetProperty(numberProperty, value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</font><br><br>And another class which uses the FormattedNumber like this:<br><br><font face="Courier New">namespace OtherNameSpace<br>{<br>&nbsp;&nbsp;&nbsp; using System;<br><br>&nbsp;&nbsp;&nbsp; using Csla;<br>&nbsp;&nbsp;&nbsp; using Csla.Serialization;<br><br>&nbsp;&nbsp;&nbsp; [Serializable]<br>&nbsp;&nbsp;&nbsp; public partial class MyNumberEdit : BusinessBase&lt;MyNumberEdit&gt;<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static PropertyInfo&lt;</font></font></font><font face="Courier New" size="2">FormattedNumber </font><font face="Courier New" size="2">&gt; </font><font face="Courier New" size="2">myNumber</font><font face="Courier New" size="2">NumberProperty = RegisterProperty(new PropertyInfo&lt;</font><font face="Courier New" size="2">FormattedNumber </font><font face="Courier New" size="2">&gt;("</font><font face="Courier New" size="2">MyNumber</font><font face="Courier New" size="2">"));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public FormattedNumber MyNumber<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!FieldManager.FieldExists(</font><font face="Courier New" size="2">myNumber</font><font face="Courier New" size="2">NumberProperty </font><font face="Courier New" size="2">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LoadProperty(</font><font face="Courier New" size="2">myNumber</font><font face="Courier New" size="2">NumberProperty </font><font face="Courier New" size="2">, new FormattedNumber());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return GetProperty(</font><font face="Courier New" size="2">myNumber</font><font face="Courier New" size="2">NumberProperty </font><font size="2"><font face="Verdana"><font face="Courier New">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; }<br>}</font><br><br>This code compiles and runs just fine, but when I load it into a dialog using the CslaDataProvider:<br><br><font face="Courier New">&lt;CSLA:CslaDataProvider x:Key="MyNumberData" ManageObjectLifetime="True" IsInitialLoadEnabled="True" Saved="CslaDataProvider_Saved" ObjectType="OtherNameSpace.MyNumberEdit, OtherNameSpace" /&gt;</font><br><br>The CanSave-property is set to True, even though nothing has been edited, and when the Save method is called I get this error:<br><br><i>Object not serializable (MyNameSpace.FormattedNumber)<br><br></i>Which is strange since the class does have the SerializableAttribute.<br><br>If anyone can help me with this issue I would be much obliged.<br><br>Cheers,<br>Frances<br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Monday, August 10, 2009</h2>Not sure about the error, but, for the FormattedNumber class, you could look at SmartDate as they look to be similar concepts. Also, is there a reason FormattedNumber inherits BusinessBase? It doesn't seem to be doing anything that would require use of BusinessBase.<br /><br />HTH</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Frances83 replied on Monday, August 10, 2009</h2><font face="Verdana"><font size="2">I cut down the code for demonstration's sake, but the FormattedNumber derives from BusinessBase since it also has Validation.<br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Tuesday, August 11, 2009</h2><P>I am not sure why you are getting a serialization exception, that seems odd.</P>
<P>But you will certainly run into metastate issues with IsDirty, etc, because you aren't marking the child object as a child.</P>
<P>You either need to use the child data portal to create the child object, or add a constructor to explicitly call MarkAsChild() - either way, something needs to indicate that it is a child object or the metastate management won't function as you expect.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Frances83 replied on Tuesday, August 11, 2009</h2><font size="2"><font face="Verdana">Fixed. It turned out I was linking against the wrong projects (FormattedNumber resides in a different assembly, which is split up into a Client and a Server project).<br><br>My new question is: when the parent object is validated, the validation rules on the child objects aren't called. How can I force that?<br><br>Thanks,<br>Frances<br></font></font></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xAvailx replied on Wednesday, August 12, 2009</h2>How are you determining the validation rules aren't being called? You won't see them in the parent's business rules collection. <br /><br />I've worked on a similar scenario in the past and don't' recall having to do anything special as long as it was a managed property. I think csla will look at the properties defined and based on its type/basetype will try to work its magic. <br /><br />If you don't get more responses I would recommend creating a new post with your new issue.<br /><br />HTH.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Frances83 replied on Wednesday, August 12, 2009</h2><font face="Verdana"><font size="1">I use breakpoints <img src="/emoticons/emotion-5.gif" alt="Wink [;)]" /><br><br>I'll put this in a new topic, thanks.<br></font></font></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
