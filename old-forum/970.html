<html><header><title>Editable root list vs. editable root collection</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Editable root list vs. editable root collection</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/970.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>voodoo45 posted on Monday, August 21, 2006</h2>&nbsp;&nbsp;&nbsp; I'm fairly new to CSLA in general and am helping to do some developement on a framework built off csla.&nbsp; My confussion lies with root objects vs. collections.&nbsp; In looking at the templates, it doesn't look like these two items will work together.&nbsp; The Editable root's GetEditableRoot factory method takes an id where as the collection wants to pass in a datareader object.&nbsp; Also, in the DataPortal_Update method of the collection object, it calls DeleteSelf, Insert, and Update all of which do not exist in the root object.&nbsp; The reason I ask is that this is the way things have been set for implementation and I'm having a bugger of a time figuring out how things will wire up.&nbsp; I noticed that the child collection is the same way.&nbsp; If the editable root object were changed to an editable child object everything would work fine from what i can tell.&nbsp; Is there no collection object that is meant to work directly with the EditableRoot object, or do I need to go through and make a bunch of changes to one of the collection objects to make this work?&nbsp; Thanks for the help.<br><br>V<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, August 21, 2006</h2>Version 2.1 (which is in a test phase) includes a new class: Csla.EditableRootListBase. This class allows you to create a collection of editable root objects.<br><br>The collection ONLY loads the objects. Any insert/update/delete operations are handled on a per-object basis, because those objects are all root objects. The collection itself can never be saved, because it is merely a container for top-level root objects.<br><br>You can easily accomplish a similar thing by creating a simple collection class that implements DataPortal_Fetch(). However, ERLB goes a bit further, by automatically triggering insert/update/delete operations as you interact with the objects in the list through data binding. In other words, if you bind the collection to a DataGridView control, the user can add a new object by going to the bottom of the grid to add a new row, editing that row and then arrowing off the row. That arrowing off triggers an IEditableObject.ApplyEdit, which triggers a call to ERLB which calls Save() on the child.<br><br>The same thing happens with an update - edit data in a row and when the user navigates off the row the resulting IEditableObject.ApplyEdit triggers an automatic call to Save().<br><br>Similarly, removing an item from the collection automatically causes ERLB to mark the object as deleted and to call Save() - causing the object to immediately delete itself.<br><br>ERLB may not be the answer for all scenarios. But it handles the grid scenario, which is the complex one. Most other scenarios are simpler, and can be accomplished with almost any collection type and very little coding on your part.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nicholas Trevatt replied on Saturday, January 06, 2007</h2>I would appreciate it if someone could clarify the correct way to populate an EditableRootListBase collection and it's contained editable root objects.&nbsp; <br><br>What I have done (and seems to be working ok) is  create an InvoiceList (EditableRootListBase) which populates it's child Invoice objects (EditableRoot) by passing the Invoice the datareader.&nbsp; But this how an Editable *Child* is populated hence my insecurity with the decision.&nbsp; Is this the correct way?<br><br>Thanks,<br>Nicholas<br><br>Here is my InvoiceList.DataPortal_Fetch() method code.<br><br>Private Overloads Sub DataPortal_Fetch(ByVal criteria As Criteria)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = False<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cn As New SqlConnection(Database.PrestoDBConnection)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cn.Open()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.LocalContext("cn") = cn<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using cm As SqlCommand = cn.CreateCommand<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; With cm<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandType = CommandType.Text<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .CommandText = "SELECT * FROM Invoices"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Using dr As New SafeDataReader(.ExecuteReader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dr.Read()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add(Invoice.GetInvoice(dr))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End With<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End Using<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If ApplicationContext.ExecutionLocation = ExecutionLocations.Client Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ApplicationContext.LocalContext.Remove("cn")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Me.RaiseListChangedEvents = True<br><br>&nbsp;&nbsp;&nbsp; End Sub<br><br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Saturday, January 06, 2007</h2>




<DIV align=left><SPAN class=792383616-06012007><FONT face=Arial color=#0000ff size=2>Nicholas, that looks right to me.</FONT></SPAN></DIV>
<DIV align=left><SPAN class=792383616-06012007><FONT face=Arial color=#0000ff size=2></FONT></SPAN>&nbsp;</DIV>
<DIV align=left><SPAN class=792383616-06012007><FONT face=Arial color=#0000ff size=2>Rocky</FONT></SPAN></DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Nicholas Trevatt replied on Saturday, January 06, 2007</h2>Great.&nbsp; Thanks for your prompt reply Rocky!<br><br>Nicholas<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>guyroch replied on Sunday, January 07, 2007</h2><P>Not so fast guys...</P>
<P>You should have a try...catch...finally block to reset Me.RaiseListChangedEvents = True and to call ApplicationContext.LocalContext.Remove("cn") in case an error gets thrown.&nbsp; </P>
<P><STRONG><FONT size=4><U>c#</U></FONT></STRONG></P>
<P>try<BR>{<BR>&nbsp;&nbsp; this.RaiseListChangedEvents = fasle;</P>
<P>&nbsp;&nbsp; // Create you connection here</P>
<P>&nbsp;&nbsp; // Add your connection to LocalContext here<BR>&nbsp;&nbsp; this.ApplicationContext.LocalContext("cn") = cn;</P>
<P>&nbsp;&nbsp; // Do some more stuff here</P>
<P>}<BR>catch<BR>{<BR>&nbsp;&nbsp; // Handle errors here if applicable<BR>}<BR>finally<BR>{<BR>&nbsp;&nbsp; this.RaiseListChangedEvents = true;<BR>&nbsp;&nbsp; this.ApplicationContext.LocalContext.Remove("cn");<BR>}</P>
<P><BR>This way your Me.RaiseListChangedEvents = True and to ApplicationContext.LocalContext.Remove("cn") will always get called.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, April 01, 2010</h2><p>I&#39;m spinning my wheels here, running into all kinds of quirky behavior with the ERLB.&nbsp; Unfortunately, I can&#39;t debug CSLA either to walk through to see what&#39;s going on due to some strange VS10 WCF behavior that I&#39;ve previously posted about, and am taking a break from for the time being.&nbsp;</p>
<p>So I have an ERLB.&nbsp; I have a SL ListBox bound to it.&nbsp; There is an &quot;Add&quot; button that pops up a popup form.&nbsp; What should the workflow look like?&nbsp; Let&#39;s exclude MVVM to avoid complication.</p>
<p>So for example:&nbsp; view (page, uc, etc.)&nbsp;instantiates a new editable root and invokes BeginEdit().&nbsp; Pass it to the popup form (via constructor, etc.).&nbsp; If user clicks &quot;OK&quot; button on popup, the underlying view adds the new editable root to the ERLB via Add().&nbsp; Then, what happens next?&nbsp; Does the view invoke ER.ApplyEdit()?&nbsp; Does the view invoke ERLB.Save()?&nbsp; This is where I&#39;m getting lost and why I suspect I&#39;m running into issues.</p>
<p>Also, in the case of an Edit scenario.&nbsp; The user selects a item in the ListBox, grabs the bound ER, the view invokes BeginEdit().&nbsp; User clicks &quot;OK&quot; button on popup, then ER.ApplyEdit() is invoked.&nbsp; OR user clicks &quot;Cancel&quot; button and ER.CancelEdit() is invoked.&nbsp; Is that all that needs to happen?&nbsp; Do I need to inform the ERLB of any of this?</p>
<p>I&#39;ve looked through the samples that came with the CSLA SL vids and have modeled my ERLB the same way, but I&#39;m not consuming it in the same fashion as the demos are, so running into issues there.&nbsp; Also, the book is unclear on consumption patterns of the ERLB.</p>
<p>Thanks!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 01, 2010</h2><p>If it hasn&#39;t been said before in this thread, ERLB is designed for one thing and one thing only: to support in-place datagrid editing where you want changes to a row to be saved as the user leaves that row. Any other use of the ERLB requires that you emulate data binding as expected by the ERLB.</p>
<p>Typically though, emulating data binding isn&#39;t too hard, since the ERLB expects very little. In fact, it just requires this:</p>
<ol>
<li>Before the user edits an object in the list, you must call BeginEdit() on that object</li>
<li>When the user is done editing an object in the list, you must call CancelEdit() or ApplyEdit() on that object</li>
<li>Only one object at a time may be in edit mode</li>
<li>To add a new item to the list, call AddNew() on the list - if the user edits this object, items 1-3 apply</li>
<li>To remove an item from the list, call Remove() or RemoveAt() on the list - the item should not be in edit mode when this is called (iirc)</li>
</ol>
<p>These are all things a datagrid control does automatically through data binding. If you aren&#39;t using a datagrid control, then you need to do these things.</p>
<p>You can do them in your code-behind or viewmodel, but you need to emulate the actions of a datagrid.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, April 01, 2010</h2><p>Great, the edit part works awesome!&nbsp; However, ERLB.AddNew() doesn&#39;t seem to return a type.&nbsp; I&#39;m using a VB.NET SL&nbsp;client, and its return type is Sub.&nbsp; This is strange, because if I dig far enough down the hierarchy, I see that AddNew() is defined on BindingList&lt;T&gt; as a method that returns type T.</p>
<p>What gives?&nbsp; If you have any immediate thoughts, please let me know.&nbsp; I&#39;ll keep digging on my end.&nbsp; It&#39;s pretty strange though...</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 01, 2010</h2><p>I just answered this, though maybe in a different thread.</p>
<p>AddNew() doesn&#39;t exist as a concept in ObservableCollection. It did and does exist in BindingList, and it is a useful concept. So we added it to our OC in CSLA - so all the CSLA collections have it.</p>
<p>But in SL server access is async. Often AddNewCore() needs to call DataPortal.Create() in .NET - but that&#39;s BeginCreate() in SL - so AddNewCore() must be async in SL.</p>
<p>(as an aside, this was how we spent much of 2007 - add one async feature for SL and find that you need to a others as a result - quite the cascade effect!!)</p>
<p>So AddNewCore() in SL is different from in .NET, because it must support async. It doesn&#39;t have to <em>actually be async</em>, but it needs to follow the async pattern in case you want to use the data portal.</p>
<p>This means AddNewCore() is half the equation, and OnAddedNew() is the other half - the part that is invoked when the add is done.</p>
<p>A typical SL add new looks like this:</p>
<p>protected override void AddNewCore()<br />{<br />&nbsp; var item = new Item();<br />&nbsp; Add(item);<br />&nbsp; OnAddedNew(item);<br />}</p>
<p>If that needs to be async, you just change it so the Add(item) and OnAddedNew(item) calls occur in the async callback - such as the CreateCompleted event handler from the data portal.</p>
<p>btw, this is covered in the <a href="http://www.store.lhotka.net/">CSLA .NET for Silverlight video series</a>, along with code examples.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>AaronH replied on Thursday, April 01, 2010</h2><p>Honestly, the videos are a bit difficult to find specific information due to no indexing.&nbsp; It&#39;s hard to keep track where something was covered, and I just don&#39;t have the time to sit there and watch an entire video <span style="text-decoration:underline;">again</span> to grab that one nugget of information unfortunately.&nbsp; Don&#39;t get me wrong, the videos are great, it&#39;s just difficult to remember where everything was covered (video number and exact minute)</p>
<p>In addition, the samples that come with the vids do not use the ERLBs like I&#39;m trying to use them.&nbsp; It&#39;s not creating the ERLB that is causing me the grief, it&#39;s manually manipulating the collection itself and the items contained within that is (due to lack of understanding how it works underneath the sheets, admittedely).</p>
<p>I know you said in a previous post that the ERLB is meant to be used with a datagrid, however, I need to quote you from chapter 5 in your latest book:</p>
<p><em>At times, applications need to retrieve a collection of child objects directly. To do this, you<br />need to create a root collection object. For instance, the application may have a WPF UI<br />consisting of a ListBox control that displays a collection of Contact objects. If the root object<br />is a collection of child Contact objects, the UI developer can simply bind the collection to the<br />ListBox (with an appropriate data template), and the user can edit all the objects in the list.</em></p>
<p>This is exactly the approach that I have decided to take (only with an Accordian), so it is important that I invoke methods explicitly against the ERLB.</p>
<p>Anyhow, thanks for all of your help.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, April 01, 2010</h2><p>I was just saying that the AddNewCore/OnAddedNew code is in the samples with the videos.</p>
<p>Your use of ERLB outside a datagrid is fine, but is not a mainstream scenario, so I wouldn&#39;t cover it in a book or video - unless it was an advanced tips and tricks book/video.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Tuesday, August 22, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>voodoo45:</strong></div><div>&nbsp;&nbsp;&nbsp; I'm fairly new to CSLA in general and am helping to do some developement on a framework built off csla.&nbsp; My confussion lies with root objects vs. collections.&nbsp; In looking at the templates, it doesn't look like these two items will work together.&nbsp; The Editable root's GetEditableRoot factory method takes an id where as the collection wants to pass in a datareader object.&nbsp; Also, in the DataPortal_Update method of the collection object, it calls DeleteSelf, Insert, and Update all of which do not exist in the root object.&nbsp; The reason I ask is that this is the way things have been set for implementation and I'm having a bugger of a time figuring out how things will wire up.&nbsp; I noticed that the child collection is the same way.&nbsp; If the editable root object were changed to an editable child object everything would work fine from what i can tell.&nbsp; Is there no collection object that is meant to work directly with the EditableRoot object, or do I need to go through and make a bunch of changes to one of the collection objects to make this work?&nbsp; Thanks for the help.<BR><BR>V<BR></div></BLOCKQUOTE></P>
<P>&nbsp;</P>
<P>FYI - the VB templates are not 100% complete (or correct).</P>
<P>I think the C# templates are maintained by Rick Supit and are in better shape.</P>
<P>You can also check out:</P>
<P><A href="http://www.onelittlevictory.com">http://www.onelittlevictory.com</A> for sample BOs and a basic discussion of each region.</P>
<P>&nbsp;</P>
<P>Joe</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
