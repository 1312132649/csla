<html><header><title>How can I clear broken rules?</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>How can I clear broken rules?</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3109.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 posted on Wednesday, June 27, 2007</h2><P>I&nbsp;have code like this:</P><FONT size=2>
<P>myBO = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(myOtherBO.Clone, MyType)</P>
<P></FONT><FONT color=#008000 size=2>'myBO still contains all the Broken Rules from myOtherBO which causes them to appear twice on screen. <BR></FONT><FONT color=#008000 size=2>'Need to clear it. <BR></FONT><FONT color=#008000 size=2>'JF 6/27/07 - this code does not work.<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> ruleCollection </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Validation.BrokenRulesCollection = myBO.BrokenRulesCollection<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> item </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Validation.BrokenRule = ValidationRules.GetBrokenRules.Item(index)<BR></FONT><FONT size=2><BR></FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> i </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = ruleCollection.Count - 1 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> 0 </FONT><FONT color=#0000ff size=2>Step</FONT><FONT size=2> -1<BR>&nbsp; item = ValidationRules.GetBrokenRules.Item(i)<BR>&nbsp; ValidationRules.GetBrokenRules.Remove(item)<BR></FONT><FONT color=#0000ff size=2>Next</P></FONT><FONT size=2>
<P></FONT><FONT color=#008000 size=2>'The code above ends up calling this in ReadOnlyBindingList:</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overrides</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> RemoveItem(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> index </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Not</FONT><FONT size=2> IsReadOnly </FONT><FONT color=#0000ff size=2>Then<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> oldValue </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Boolean</FONT><FONT size=2> = AllowRemove<BR>&nbsp; AllowRemove = </FONT><FONT color=#0000ff size=2>True<BR>&nbsp; </FONT><FONT color=#0000ff size=2>MyBase</FONT><FONT size=2>.RemoveItem(index)<BR>&nbsp; AllowRemove = oldValue<BR></FONT><FONT color=#0000ff size=2>Else<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Throw</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> NotSupportedException(</FONT><FONT color=#0000ff size=2>My</FONT><FONT size=2>.Resources.RemoveInvalidException)<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>The code fails because IsReadOnly is set to True and cannot be changed externally.</P>
<P>Even if it worked it would probably make a mess of things since this isn't how Rocky clears the broken rules after he calls CheckRules.</P>
<P>He uses an IRuleMethod and also modifies the counters.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Friend</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> Remove(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> rule </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> IRuleMethod)<BR></FONT><FONT color=#008000 size=2>' we loop through using a numeric counter because<BR></FONT><FONT color=#008000 size=2>' removing items in a foreach isn't reliable<BR></FONT><FONT size=2>IsReadOnly = </FONT><FONT color=#0000ff size=2>False<BR></FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> index </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = 0 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> Count - 1<BR></FONT><FONT color=#0000ff size=2>If</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(index).RuleName = rule.RuleName </FONT><FONT color=#0000ff size=2>Then<BR></FONT><FONT size=2>DecrementCount(</FONT><FONT color=#0000ff size=2>Me</FONT><FONT size=2>(index))<BR>RemoveAt(index)<BR></FONT><FONT color=#0000ff size=2>Exit</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>For<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>If<BR></FONT><FONT color=#0000ff size=2>Next<BR></FONT><FONT size=2>IsReadOnly = </FONT><FONT color=#0000ff size=2>True<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>On a side note -&nbsp; I normally loop backwards over a collection when removing items as this way you are not affected when the index changes on all the items above the one you just removed. Is that a non-issue in this code block for some reason?</P>
<P>Bottom line - I need a way to remove all the broken rules for the cloned BO. And I do not want ot modify Csla directly if I do not have to. </P>
<P>Any ideas?</P>
<P>Joe</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, June 27, 2007</h2><P>If the object is somehow valid (has no broken rules) after being cloned, you should be able to call CheckRules() to re-run the rules and all the broken rules will disappear from the list.</P>
<P>Otherwise the object <EM>is</EM> invalid, so it <EM>should</EM> have broken rules <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></P>
<P>Remember that you can override the cloning method, which should allow you to call CheckRules() on the clone before returning it as a result.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Thursday, June 28, 2007</h2><P>Rocky,</P>
<P>I have a real need to be able to remove a broken rule other than by re-running that rule.</P>
<P>&nbsp;</P>
<P>I have a BO that contains other BOs and can't be saved if any of them are invalid.</P>
<P>But in some cases if a child BO is invalid, I don't really care and want to save it anyway.</P>
<P>In order to do this I need the BO to be valid and the only way to do that is to remove the broken rules. If I pass in the rules collection to a method like this it fails because the rules collection is read only.</P><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Private</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> ClearBrokenRules(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> ruleCollection </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Validation.BrokenRulesCollection)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> i </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = ruleCollection.Count - 1 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> 0 </FONT><FONT color=#0000ff size=2>Step</FONT><FONT size=2> -1<BR>&nbsp;&nbsp;&nbsp; ruleCollection.RemoveAt(i)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Next<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>I want to avoid making framework changes. Is there anyway to do this? Or will there be some way in a future version? If so, how will it be done?</P>
<P>Thanks.</P>
<P>=======================================================</P>
<P>I went with this for now because I really need this functionality. Plus it is exactly how the normal method works only instead of using a ruleMethod as a parameter I use the broken rule itself. </P>
<P>&nbsp;&nbsp;&nbsp;'need a Public way to clear broken rules other than by calling CheckRules.<BR><BR>&nbsp;&nbsp;&nbsp; Public Overloads Sub Remove(ByVal rule As BrokenRule)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' we loop through using a numeric counter because removing items in a foreach isn't reliable<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = False<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For index As Integer = 0 To Count - 1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Me(index).RuleName = rule.RuleName Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DecrementCount(Me(index))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveAt(index)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit For<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsReadOnly = True</P>
<P>&nbsp;&nbsp;&nbsp; End Sub</P>Makes it easy to code a ClearBrokenRules method like this:<FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Shared</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> ClearBrokenRules(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> ruleCollection </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Validation.BrokenRulesCollection)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>For</FONT><FONT size=2> i </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Integer</FONT><FONT size=2> = ruleCollection.Count - 1 </FONT><FONT color=#0000ff size=2>To</FONT><FONT size=2> 0 </FONT><FONT color=#0000ff size=2>Step</FONT><FONT size=2> -1<BR>&nbsp;&nbsp;&nbsp; </FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> brokenRule </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Csla2.Validation.BrokenRule = ruleCollection.Item(i)<BR>&nbsp; &nbsp; ruleCollection.Remove(brokenRule)<BR>&nbsp; </FONT><FONT color=#0000ff size=2>Next<BR></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</P></FONT>
<P>&nbsp;</P>
<P>Joe</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, July 04, 2007</h2>Why not make the rules be warnings instead of errors?<br>Or if you want them to be errors, (this may sound silly, but esentially solves your problem) you could have a "SaveAnyWay" property, that you can set to true, so when you set it, you call ValidationRules.CheckRules().<br><br>All your rules should check the "SaveAnyWay" property like:<br><br>If target.SaveAnyWay Then<br>e.Severity=RuleSeverity.Warning<br>Else<br>e.Severity= RuleSeverity.Error<br>End If<br><br>Or even easier:<br>If target.SaveAnyWay Then<br>Return True<br>End If<br><br>Which makes the rule valid.<br><br>Again, this may sound silly, but it certainly gets the job done. This way, you can display those broken rules to the user, and before saving, you set SaveAnyWay to true for each BO.<br>If you want it to be even nicer, you should set those properties _after_ cloning the bo, so that the one still bound displays the error, and after performing the DataPortal_Insert / Update you set SaveAnyWay back to false, so that the returning object is in the same state as the original. Make sure you do that before calling MarkOld, of course.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>jbarrett replied on Thursday, June 06, 2013</h2><p>I have a list. In that list there is a Boolean field and only one row in the list can have that Boolean turned on. I thought I wanted to have a rule to validate. But the problem is, every row in the list shows an error (red &#39;x&#39;) even when one row has a valid value. How to I cross-validate other rows? I thought I should clear the broken rules upon each validate call, but since I can not clear out the broken rules, how do I do it? Or is there some other way to handle validation an entire list of data such that all rows are valid if any one row is valid?</p>
<p>&nbsp;</p>
<p>thanks,</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, June 06, 2013</h2><p>Hi,</p>
<p>Please make sure to start a new thread when you post a new question!!!&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
