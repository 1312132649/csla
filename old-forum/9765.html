<html><header><title>ApplicationContext.LocalContext is empty between calls from the Silverlight Client ot the DataPortal hosted in ASP.NET</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>ApplicationContext.LocalContext is empty between calls from the Silverlight Client ot the DataPortal hosted in ASP.NET</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9765.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans posted on Monday, November 15, 2010</h2><p>I&#39;ve just run into something unexpected. I&#39;m caching an expensive resource in the ApplicationContext.LocalContext.</p>
<p>I don&#39;t want to transfer this between server and client.</p>
<p>I have some server-side code that checks if the item is in the ApplicationContext.LocalContext and if not, makes the expense and places in the local context. I expected this item to remain in the LocalContext for subsequent calls to the Data Portal from the Silverlight client, but this is not the case.</p>
<p>Is my expectation of it wrong?</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Tuesday, November 16, 2010</h2><p>LocalConext exists for the length of a given user interaction.</p>
<p>On a smart client a user interaction is the entire length of the app&#39;s runtime.</p>
<p>But on a web server a user interaction is the entire length of each single, individual call. Typically measured in milliseconds.</p>
<p>LocalContext is not a replacement for Session, which is probably what you are actually looking for.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, November 16, 2010</h2><p>Thanks for that Rocky</p>
<p>I have it wrong then, and what your saying does make sense: Statelessness of Http, WCF Per-Call activation, etc. -&gt; all these things all mean &quot;we are going let go of those resources when we&#39;re done with that request and rebuild it from scratch for the next&quot;. The contrast is&nbsp;a data portal host like a windows service which will keep the resources for the life of the services.</p>
<p>I was hoping I could write data portal host agnostic code and not have to reference System.Web from within my BusinessLogic layer in order to get to the HttpContext. Just thinking about that, could I alternatively use some Global.asax HttpApplication events to save/restore the LocalContext to and from the HttpApplication.Application state? </p>
<p>That way I could extend the life of the LocalContext beyond the stateless call to the life of the application (ie. App Pool)?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, November 16, 2010</h2><p>OK, scratch the above.</p>
<p>I now reference the&nbsp;System.Web assembly in my BusinessLogic layer and have made my calls to access the local context go through a central point. Here I can check if we have an HttpContext and then use the Application State (Context.Application) instead of the Context.Items which seems to only live for the life ot the request anyway (will need to verify that still).</p>
<p>Thanks again.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, November 16, 2010</h2><p>Interesting.</p>
<p>HttpContext.Current.Items only lives for the life of the request. Ie. LocalContext is emptied out between service calls</p>
<p>HttpContext.Current.Application lives for the life of the application pool *</p>
<p style="padding-left:30px;">*&nbsp;In the typical Silverlight scenario where the ASP.NET application hosts a WCF service the HttpContext.Current is always null, unless you set the following in the &lt;system.serviceModel ... /&gt; section of your web.config file. </p>
<p><span style="color:blue;"><span style="color:#000000;"><font color="#000000">
<pre style="padding-left:30px;font-family:consolas;"><span style="color:blue;">&lt;</span><span style="color:#a31515;">serviceHostingEnvironment</span><span style="color:blue;">&nbsp;</span><span style="color:red;">aspNetCompatibilityEnabled</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">True</span>&quot;</pre>
</font></span>
<pre style="padding-left:30px;font-family:consolas;"><span style="color:#0000ff;"> /&gt;</span></pre>
<pre style="padding-left:30px;font-family:consolas;"></pre>
</span><span style="color:blue;"><span style="color:#000000;"><span style="text-decoration:underline;">This may or may not be suitable for your project.</span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Jaans replied on Tuesday, November 16, 2010</h2><p>Interesting MSDN article noting the differences of runnig WCF and ASP.NET side by side, or alternatively setting aspNetCompatibilityEnabled to true to run them together.</p>
<p>Also explains what to use instead of HttpContext when running side by side.</p>
<p>Good read for those so inclined.</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa702682.aspx">http://msdn.microsoft.com/en-us/library/aa702682.aspx</a></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>swegele replied on Thursday, November 18, 2010</h2><p>THANKS Jaans!! &nbsp;Great article with concise and thorough content.</p>
<p>Sean</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
