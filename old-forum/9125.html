<html><header><title>DataPortal.Update Issue since upgrading CSLA from v3.0.5 to v3.8.2</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataPortal.Update Issue since upgrading CSLA from v3.0.5 to v3.8.2</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9125.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>CommunicatorBaz posted on Thursday, June 24, 2010</h2><p>Hi there,</p>
<p>We&#39;ve recently upgraded the CSLA from v3.0.5 to v3.8.2, and we are experiencing a couple of intermittent exceptions on our live servers.&nbsp; The stack trace seems to point towards something within the CSLA, but we can&#39;t seem to figure it out.</p>
<p>We don&#39;t get this issue in our Dev or QA systems, and cannot debug the live system.&nbsp; Anyway, here is the stack trace.&nbsp; More than welcome for any comments as to the cause of it...</p>
<p>24/06/2010 07:05:01 - Service ID: 100 - &lt;Exception handlingInstanceId=&quot;b6062957-598c-4f76-9a87-ea830e77261f&quot;&gt;<br />&nbsp; &lt;Description&gt;An exception of type &#39;System.OutOfMemoryException&#39; occurred and was caught.&lt;/Description&gt;<br />&nbsp; &lt;DateTime&gt;2010-06-24 07:04:53Z&lt;/DateTime&gt;<br />&nbsp; &lt;ExceptionType&gt;System.OutOfMemoryException, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/ExceptionType&gt;<br />&nbsp; &lt;Message&gt;Exception of type &#39;System.OutOfMemoryException&#39; was thrown.&lt;/Message&gt;<br />&nbsp; &lt;Source&gt;mscorlib&lt;/Source&gt;<br />&nbsp; &lt;HelpLink /&gt;<br />&nbsp; &lt;Property name=&quot;Data&quot;&gt;System.Collections.ListDictionaryInternal&lt;/Property&gt;<br />&nbsp; &lt;Property name=&quot;TargetSite&quot;&gt;System.String GetStringForStringBuilder(System.String, Int32, Int32, Int32)&lt;/Property&gt;<br />&nbsp; &lt;StackTrace&gt;&nbsp;&nbsp; at System.String.GetStringForStringBuilder(String value, Int32 startIndex, Int32 length, Int32 capacity)<br />&nbsp;&nbsp; at System.Text.StringBuilder.GetNewString(String currentString, Int32 requiredLength)<br />&nbsp;&nbsp; at System.Text.StringBuilder.Append(String value)<br />&nbsp;&nbsp; at System.Diagnostics.StackTrace.ToString(TraceFormat traceFormat)<br />&nbsp;&nbsp; at System.Environment.GetStackTrace(Exception e, Boolean needFileInfo)<br />&nbsp;&nbsp; at System.Exception.get_StackTrace()<br />&nbsp;&nbsp; at Csla.DataPortalException.get_StackTrace()<br />&nbsp;&nbsp; at System.Exception.ToString()<br />&nbsp;&nbsp; at System.Text.StringBuilder.AppendFormat(IFormatProvider provider, String format, Object[] args)<br />&nbsp;&nbsp; at System.String.Format(IFormatProvider provider, String format, Object[] args)<br />&nbsp;&nbsp; at System.String.Format(String format, Object arg0, Object arg1)<br />&nbsp;&nbsp; at Csla.DataPortal.Update(Object obj)<br />&nbsp;&nbsp; at Csla.DataPortal.Update[T](T obj)<br />&nbsp;&nbsp; at Csla.BusinessBase`1.Save()<br />&nbsp;&nbsp; at Communicator.Framework.CCBase`1.Save()<br />&nbsp;&nbsp; at Communicator.Dispatching.Service.EmailDispatchPreparer.Prepare()&lt;/StackTrace&gt;<br />&lt;/Exception&gt;</p>
<p>Many thanks</p>
<p>Baz</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>CommunicatorBaz replied on Thursday, June 24, 2010</h2><p>Here is another exception, that starts within DataPortal.Update...</p>
<p>24/06/2010 07:04:10 - Service ID: 100 - &lt;Exception handlingInstanceId=&quot;72d4317f-1ccd-4a71-bb5b-b3b47b3d5a31&quot;&gt;<br />&nbsp; &lt;Description&gt;An exception of type &#39;Csla.DataPortalException&#39; occurred and was caught.&lt;/Description&gt;<br />&nbsp; &lt;DateTime&gt;2010-06-24 07:04:10Z&lt;/DateTime&gt;<br />&nbsp; &lt;ExceptionType&gt;Csla.DataPortalException, Csla, Version=3.8.2.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30&lt;/ExceptionType&gt;<br />&nbsp; &lt;Message&gt;DataPortal.Update failed ()&lt;/Message&gt;<br />&nbsp; &lt;Source&gt;Csla&lt;/Source&gt;<br />&nbsp; &lt;HelpLink /&gt;<br />&nbsp; &lt;Property name=&quot;BusinessObject&quot;&gt;&amp;lt;undefined value&amp;gt;&lt;/Property&gt;<br />&nbsp; &lt;Property name=&quot;BusinessException&quot;&gt;&amp;lt;undefined value&amp;gt;&lt;/Property&gt;<br />&nbsp; &lt;Property name=&quot;Data&quot;&gt;System.Collections.ListDictionaryInternal&lt;/Property&gt;<br />&nbsp; &lt;Property name=&quot;TargetSite&quot;&gt;System.Object Update(System.Object)&lt;/Property&gt;<br />&nbsp; &lt;StackTrace&gt;&nbsp;&nbsp; at System.Array.InternalCreate(Void* elementType, Int32 rank, Int32* pLengths, Int32* pLowerBounds)<br />&nbsp;&nbsp; at System.Array.CreateInstance(Type elementType, Int32 length)<br />&nbsp;&nbsp; at System.Reflection.CustomAttribute.GetCustomAttributes(Module decoratedModule, Int32 decoratedMetadataToken, Int32 pcaCount, RuntimeType attributeFilterType, Boolean mustBeInheritable, IList derivedAttributes)<br />&nbsp;&nbsp; at System.Reflection.CustomAttribute.GetCustomAttributes(RuntimeType type, RuntimeType caType, Boolean inherit)<br />&nbsp;&nbsp; at System.RuntimeType.GetCustomAttributes(Type attributeType, Boolean inherit)<br />&nbsp;&nbsp; at Csla.Server.ObjectFactoryAttribute.GetObjectFactoryAttribute(Type objectType)<br />&nbsp;&nbsp; at Csla.Server.DataPortal.Update(Object obj, DataPortalContext context)<br />&nbsp;&nbsp; at Csla.DataPortal.Update(Object obj)<br />&nbsp;&nbsp; at Csla.DataPortal.Update[T](T obj)<br />&nbsp;&nbsp; at Csla.BusinessBase`1.Save()<br />&nbsp;&nbsp; at Communicator.Framework.CCBase`1.Save()<br />&nbsp;&nbsp; at Communicator.Dispatching.Service.EmailDispatchPreparer.Prepare()&lt;/StackTrace&gt;<br />&nbsp; &lt;additionalInfo&gt;<br />....<br />&nbsp; &lt;/additionalInfo&gt;<br />&nbsp; &lt;InnerException&gt;<br />&nbsp;&nbsp;&nbsp; &lt;ExceptionType&gt;System.OutOfMemoryException, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/ExceptionType&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Message&gt;Exception of type &#39;System.OutOfMemoryException&#39; was thrown.&lt;/Message&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Source&gt;mscorlib&lt;/Source&gt;<br />&nbsp;&nbsp;&nbsp; &lt;HelpLink /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Property name=&quot;Data&quot;&gt;System.Collections.ListDictionaryInternal&lt;/Property&gt;<br />&nbsp;&nbsp;&nbsp; &lt;Property name=&quot;TargetSite&quot;&gt;System.Array InternalCreate(Void*, Int32, Int32*, Int32*)&lt;/Property&gt;<br />&nbsp;&nbsp;&nbsp; &lt;StackTrace&gt;&nbsp;&nbsp; at System.Array.InternalCreate(Void* elementType, Int32 rank, Int32* pLengths, Int32* pLowerBounds)<br />&nbsp;&nbsp; at System.Array.CreateInstance(Type elementType, Int32 length)<br />&nbsp;&nbsp; at System.Reflection.CustomAttribute.GetCustomAttributes(Module decoratedModule, Int32 decoratedMetadataToken, Int32 pcaCount, RuntimeType attributeFilterType, Boolean mustBeInheritable, IList derivedAttributes)<br />&nbsp;&nbsp; at System.Reflection.CustomAttribute.GetCustomAttributes(RuntimeType type, RuntimeType caType, Boolean inherit)<br />&nbsp;&nbsp; at System.RuntimeType.GetCustomAttributes(Type attributeType, Boolean inherit)<br />&nbsp;&nbsp; at Csla.Server.ObjectFactoryAttribute.GetObjectFactoryAttribute(Type objectType)<br />&nbsp;&nbsp; at Csla.Server.DataPortal.Update(Object obj, DataPortalContext context)&lt;/StackTrace&gt;<br />&nbsp; &lt;/InnerException&gt;<br />&lt;/Exception&gt;<br /></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 24, 2010</h2><p>It is difficult to say what is going on here. It looks like .NET is failing to initialize an array within its own code in the second case, and failing to allocate a string in the Exception.GetStackTrace() method in your first example.</p>
<p>Both seem to be failures to allocate memory.</p>
<p>Looking carefully at the info you provided, both appear to occur in .NET itself - in the reflection subsystem and the exception subsystem. And both are failing to initialize common .NET types (array and string).</p>
<p>So I suspect one of the following:</p>
<ol>
<li>bad memory on the machine</li>
<li>bad or corrupt .NET install</li>
</ol>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
