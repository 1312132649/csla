<html><header><title>Azure DataPortal problems</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Azure DataPortal problems</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12050.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem posted on Sunday, June 30, 2013</h2><p>I&#39;m trying to migrate a project to Azure. On Azure, my WCF DataPortal is now a Cloud Service and I&#39;ve also uploaded my ClickOnce application into blob storage.&nbsp; While I&#39;m ultimately trying to get it this to work in Azure, I&#39;m currently stuck at setting up the WCF DataPortal with a certificate locally.&nbsp; First, here&#39;s what I&#39;ve tried with Azure:</p>
<p>When I access my non-certificate using Azure-based data protal in a browser through <a href="http://mydataportal.cloudapp.net/DataPortal.svc">http://mydataportal.cloudapp.net/DataPortal.svc</a> it displays information correctly.</p>
<p>When I run my WinForm application, I can only access the data portal locally.&nbsp; When I run my WinForm app when it is looking for the DataPortal on Azure, I get a SecurityNegotiationException of &quot;The caller was not authenticated by the service.&quot;&nbsp;&nbsp; I think I&#39;m getting this error because I&#39;m trying to use this over multiple domains and that the resolution is to use a certificate.</p>
<p>Incidentally, I changed the CNAME records so that my DataPortal is <a href="http://dataportal.MyCompany.com">http://dataportal.MyCompany.com</a> and the data storage that houses my ClickOnce app is <a href="http://program.MyCompany.com">http://program.MyCompany.com</a> in the hopes that if those two where on the same domain it would work.&nbsp; It did not.</p>
<p>Before I get a certificate from Verisign, I&#39;ve generated myself, through Makecert, a certificate that I&#39;ve included on my machine and uploaded into Azure.&nbsp; After working with the configuration for my DataPortal for some time, I have it working again so that when I hit <a href="http://mydataportal.cloudapp.net/DataPortal.svc">http://mydataportal.cloudapp.net/DataPortal.svc</a>, it does not error.&nbsp; I assume it is running properly now under the certificate.</p>
<p>When I run my WinForm application, though, it throws an exception (both when targetting the local DataPortal and the Azure data portal): </p>
<p>&quot;Secure channel cannot be opened because security negotiation with the remote endpoint has failed. This may be due to absent or incorrectly specified EndpointIdentity in the EndpointAddress used to create the channel. Please verify the EndpointIdentity specified or implied by the EndpointAddress correctly identifies the remote endpoint.&quot;</p>
<p>Where I am stumped is what exactly do I need to put in my WinForms app.config file to handle my certificate using data portal. I&#39;ve tried so many different things I&#39;m not sure what I have left to try.</p>
<p>Here is a section from my Web.Config:</p>
<p><code>
<p>
<p>&nbsp;&lt;system.serviceModel&gt;<br />&nbsp;&nbsp;&nbsp; &lt;services&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;service<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;Csla.Server.Hosts.WcfPortal&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;returnFaults&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;wsHttpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;wsHttpBinding_IWcfPortal&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/service&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/services&gt;<br />&nbsp;&nbsp;&nbsp; &lt;bindings&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;binding name=&quot;wsHttpBinding_IWcfPortal&quot; maxReceivedMessageSize=&quot;2147483647&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;readerQuotas<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxBytesPerRead=&quot;2147483647&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxArrayLength=&quot;2147483647&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxStringContentLength=&quot;2147483647&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxNameTableCharCount=&quot;2147483647&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxDepth=&quot;2147483647&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;security mode=&quot;Message&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;message clientCredentialType=&quot;Certificate&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/security&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/binding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/bindings&gt;<br />&nbsp;&nbsp;&nbsp; &lt;behaviors&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceBehaviors&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;behavior name=&quot;returnFaults&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceDebug includeExceptionDetailInFaults=&quot;true&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceMetadata httpGetEnabled=&quot;true&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceCredentials&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceCertificate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findValue=&quot;localhost&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x509FindType=&quot;FindBySubjectName&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/serviceCredentials&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/behavior&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/serviceBehaviors&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/behaviors&gt;<br />&lt;/system.serviceModel&gt;<br />&nbsp;&nbsp; </p>
</p>
</code>
<p>My app.config in my WinForms app is this:</p>
<code>
<p>&lt;client&gt;<br />&nbsp;&nbsp;&nbsp; &lt;endpoint<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; address=&quot;<a href="http://localhost:49546/DataPortal.svc">http://localhost:49546/DataPortal.svc</a>&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;wsHttpBinding&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;WSHttpBinding_IWcfPortal&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;WSHttpBinding_IWcfPortal&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; behaviorConfiguration=&quot;CustomBehavior&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;identity&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;dns value=&quot;localhost&quot; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/identity&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/endpoint&gt;<br />&lt;/client&gt;</p>
</code>
<p>To summarize, where I am right now is that I have a WCF DataPortal that is using a certificate. My WinForms app is unable to use it; both locally and in Azure it fails.&nbsp; If I remove the certificate, everything works fine locally. I&#39;m implementing the certificate in hopes that when the DataPortal is running in Azure, my WinForm clients will be able to access it, but with the certicate I&#39;m not even able to access my data portal locally.&nbsp; I feel like I&#39;m only missing a setting in the WinForms app.config that will make this all work. The exception I&#39;m receiving seems to indicate I&#39;m failing to specify the endpoint identity properly.</p>
</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
