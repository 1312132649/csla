<html><header><title>Creating Root Object by Passing a Value</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Creating Root Object by Passing a Value</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/6296.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ian posted on Friday, January 30, 2009</h2><P>Greetings.</P>
<P>I have a Customer object that will contain a list of CustomerInfo objects.&nbsp; When the user wants to create a new contact for this customer, the UI will do something like:</P>
<P>Customer customer = ....<BR>CustomerContact contact = customer.AddContact();</P>
<P>The AddContact method in Customer is defined as:</P>
<P>&nbsp;&nbsp;&nbsp; public CustomerContact AddContact()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return CustomerContact.NewCustomerContact(_customerID);<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>And in CustomerContact we have:</P>
<P>internal static CustomerContact NewCustomerContact(int customerID)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Create&lt;CustomerContact&gt;(new SingleCriteria&lt;CustomerContact,int&gt;customerID));<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>The CustomerContact object is a BusinessBase object because I want it to load and save itself, but I need to pass in the customerID&nbsp;as it is only allowed to be created by an existing Customer object.&nbsp;<BR>Where I'm getting hung up is that I don't know how to get the customerID into the Contact object.&nbsp; Clearly I'm passing the value to the DataPortal.Create call above.&nbsp; However, the only DataPortal_Create method to override is:</P>
<P>&nbsp;&nbsp;&nbsp; protected override void DataPortal_Create()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // TODO: load default values<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // omit this override if you have no defaults to set<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.DataPortal_Create();<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>This is the method that the dataportal calls in the CustomerContact object, and it doesn't pass the customerID that I gave it.&nbsp; So how do I get the customerID value into it?</P>
<P>&nbsp;</P>
<P>Thanks in advance.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, January 30, 2009</h2><P>You are missing a key concept.</P>
<P>You do not always have to override a DataPortal method.</P>
<P>You can simply overload it.</P>
<P>So create a DP method with the signature that you require and use that instead. </P>
<P>In other words pass in a SingleCriteria (or some other criteira object that has your value(s)) and include tha in your signature. Then just pull the value out on the other side.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ian replied on Friday, January 30, 2009</h2><P>Yes and I'm sure I'm missing many more key concepts yet.&nbsp; I'm still at that spot in the learning curve where I can't distinguish between code that I should leave as-is for fear of breaking something, and code that I should change to suit my needs.</P>
<P>But for now I'm off and running again.&nbsp; Thanks again!</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ian replied on Friday, January 30, 2009</h2><P>Allow me to pick your brain again, if you will.&nbsp; I now have a new CustomerContact object created, then this object gets saved to the database.&nbsp; What I want to do, is update the readonly list of CustomerContactInfo objects inside the Customer object, <EM>without hitting the database again.</EM>&nbsp; All the information I need to update the read only list with either new contacts or updated contact info exists in the client computer's memory, so I feel it is a waste of network bandwidth to reload the list from the dataserver.</P>
<P>In the Customer object I have:</P>
<P><FONT color=#0000ff>public</FONT> <FONT color=#2b91af>CustomerContact</FONT> AddContact()</P>
<P>{</P>
<P><FONT color=#2b91af>CustomerContact</FONT> contact = <FONT color=#2b91af>CustomerContact</FONT>.NewContact(_customerID);</P>
<P>contact.Saved += <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>EventHandler</FONT>&lt;Csla.Core.<FONT color=#2b91af>SavedEventArgs</FONT>&gt;(contact_Saved);</P>
<P><FONT color=#0000ff>return</FONT> contact;</P>
<P>}</P>
<P><FONT color=#0000ff>void</FONT> contact_Saved(<FONT color=#0000ff>object</FONT> sender, Csla.Core.<FONT color=#2b91af>SavedEventArgs</FONT> e)</P>
<P>{</P>
<P><FONT color=#008000>// the first time a contact is saved, generate a new info object</P></FONT>
<P><FONT color=#008000>// and add it to the list of contacts</P></FONT>
<P><FONT color=#2b91af>CustomerContact</FONT> contact = sender <FONT color=#0000ff>as</FONT> <FONT color=#2b91af>CustomerContact</FONT>;</P>
<P><FONT color=#0000ff>if</FONT> (contact != <FONT color=#0000ff>null</FONT>)</P>
<P>{</P>
<P><FONT color=#008000>// remove the event handler so it doesn't get added again</P></FONT>
<P>contact.Saved -= <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>EventHandler</FONT>&lt;Csla.Core.<FONT color=#2b91af>SavedEventArgs</FONT>&gt;(contact_Saved);</P>
<P><FONT color=#008000>// create a new info object and add it to the list</P></FONT>
<P>Contacts.AddNewCustomerContactInfo(<FONT color=#2b91af>CustomerContactInfo</FONT>.CreateInfoObject(contact));</P>
<P>}</P>
<P>}</P><FONT size=1>
<P><FONT color=#000000 size=3>In the CustomerContactInfo class I have:</FONT></P>
<P><FONT size=3><FONT color=#0000ff>internal</FONT> <FONT color=#0000ff>static</FONT> <FONT color=#2b91af>CustomerContactInfo</FONT> CreateInfoObject(<FONT color=#2b91af>CustomerContact</FONT> contact)</FONT></P>
<P><FONT size=3>{</FONT></P>
<P><FONT color=#000000 size=3>// this just simply takes an editable CustomerContact object and creates&nbsp;CustomerContactInfo object from it</FONT></P>
<P><FONT size=3><FONT color=#2b91af>CustomerContactInfo</FONT> info = <FONT color=#0000ff>new</FONT> <FONT color=#2b91af>CustomerContactInfo</FONT>();</FONT></P>
<P><FONT size=3>info._contactID = contact.ContactID;</FONT></P>
<P><FONT size=3>info._contactName = contact.ContactName;</FONT></P>
<P><FONT size=3>info._officePhone = contact.OfficePhone;</FONT></P>
<P><FONT size=3>info._mobilePhone = contact.MobilePhone;</FONT></P>
<P><FONT size=3>info._email = contact.Email;</FONT></P>
<P><FONT size=3>info._active = contact.Active;</FONT></P>
<P><FONT size=3><FONT color=#0000ff>return</FONT> info;</FONT></P>
<P><FONT size=3>}</FONT></P>
<P><FONT size=3>And in the CustomerContactList class I have:</FONT></P>
<P><FONT size=3><FONT color=#0000ff>internal</FONT> <FONT color=#0000ff>void</FONT> AddNewCustomerContactInfo(<FONT color=#2b91af>CustomerContactInfo</FONT> info)</FONT></P>
<P><FONT size=3>{</FONT></P>
<P><FONT size=3>IsReadOnly = <FONT color=#0000ff>false</FONT>;</FONT></P>
<P><FONT size=3><FONT color=#0000ff>this</FONT>.Add(info);</FONT></P>
<P><FONT size=3>IsReadOnly = <FONT color=#0000ff>true</FONT>;</FONT></P>
<P><FONT size=3>}</FONT></P>
<P><FONT size=3>Everything works except for the Saved event.&nbsp; Because the event is hooked up to the <EM>old</EM> CustomerContact object, the ContactID field is still zero.&nbsp; So somehow I need to grab this ID from the new CustomerContact returned from the DataPortal so I can update the Info object accordingly.</FONT></P>
<P><FONT size=3>Am I even going about this the right way?&nbsp; I intend to do a lot of this type of stuff in my application.&nbsp; My "read only" Info objects are going to be read only as far as the user interface is concerned, but will regularly get updated by the business objects themselves after a save has taken place.&nbsp; I also get this sinking feeling that read only objects might not call PropertyChanged so the interface might not even know that data has changed.&nbsp; How do the experts do this type of thing?</FONT><FONT size=1></P></FONT></FONT><FONT size=1></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JoeFallon1 replied on Friday, January 30, 2009</h2><P>I do not do this but others may.</P>
<P>One key concept is that when a BO is sent through the Dataportal in 3.6 it is really a clone of the BO in your UI. So there are 2 BOs in play when you call .Save. Your code should always update the reference in the UI so it should be:</P>
<P>myBO = myBO.Save</P>
<P>The other idea is that event handlers have to be re-hooked up when a BO is deserialized (returns from the DataPortal). If you do not re-hook them upon deserialization, they do not run. There are threads in this forum that discuss it.</P>
<P>Joe</P>
<P>&nbsp;</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
