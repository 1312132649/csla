<html><header><title>Detailed Logging</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Detailed Logging</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11465.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>tbaldridge posted on Tuesday, July 10, 2012</h2><p>For performance tuning and general debugging I need detailed logging about every request made to the DataPortal from clients. Specifically I&#39;m looking for the following:</p>
<p>&nbsp;</p>
<p>1) The BO&#39;s class name and method&nbsp;</p>
<p>2) Fetch, Update, Create, Delete, Execute</p>
<p>3) Execution time of the call</p>
<p>4) Result (Success vs Failure)</p>
<p>5) The UserID (from the Principal object)</p>
<p>6) A Dictionary of string, string that contains the criteria being used.<br /><br /><br /><br />I cant&#39; find a place to insert this. DataPortal has some OnFetchCompleted events, but that doesn&#39;t give me the critieria or the execution time. Since the DataPortal calls DataPortal_Fetch methods directly on my BO&#39;s I can&#39;t put it in my abstract base BOs.&nbsp;<br /><br />About the only thing I can think of is to wrap the Silverlight WCF portal by sub classing it and extracting this information by hand from the requests/response.&nbsp;<br /><br />Is there a better way than this? It seems that this sort of thing should have been done by someone before, but I can&#39;t figure out how to do it without either modifying the WCFPortal or extending the existing one. It&#39;d be nice if there was a simple ILogging interface somewhere I could tap into....<br /></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>StefanCop replied on Tuesday, July 10, 2012</h2><p>Recently I had a similar issue and I decide to subclass WcfProtal and reimplement Fetch, Update, Create, Delete, Execute there.&nbsp; In the server App.config I had to include my implementation as the service endpoint.</p>
<p><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">&lt;</span></span></span><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;"><span style="color:#a31515;font-size:x-small;">service</span></span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"> </span></span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;">behaviorConfiguration</span></span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">=</span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;">&quot;</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">returnFaults</span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;">&quot;</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"> </span></span></span><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;"><span style="color:#ff0000;font-size:x-small;">name</span></span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">=</span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;">&quot;</span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">MyFramework.Server.WcfPortal</span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;">&quot;</span></span><span style="color:#0000ff;font-size:x-small;">&gt;</span></span></span></p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">public new</span></span></span><span style="font-size:x-small;"><span style="color:#000000;font-size:x-small;"> Csla.Server.Hosts.WcfChannel.</span></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">WcfResponse</span></span></span><span style="font-size:x-small;"><span style="color:#000000;font-size:x-small;"> Fetch(Csla.Server.Hosts.WcfChannel.</span></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">FetchRequest</span></span></span></span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;"><span style="color:#000000;"><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;"><span style="font-family:courier new,courier;"><span style="font-size:small;"> request)<br />{<br />&nbsp;&nbsp;&nbsp; ...&nbsp; <span style="font-size:x-small;"><span style="font-size:x-small;">request.ObjectType.Name, <span style="font-size:x-small;"><span style="font-size:x-small;">request.Context,&nbsp;<span style="font-size:x-small;"><span style="font-size:x-small;">request.Criteria </span></span></span></span></span></span><br />&nbsp;&nbsp;&nbsp; <span style="font-size:x-small;"><span style="font-size:x-small;">Csla.Server.Hosts.WcfChannel.</span></span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">WcfResponse</span></span></span><span style="font-size:x-small;"><span style="font-size:x-small;"> response = </span></span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">base</span></span></span></span></span></span></span></span><span style="font-size:small;"><span style="font-family:courier new,courier;">.Fetch(request);<br />&nbsp;&nbsp;&nbsp; ...<br />}</span></span></span></span></span></span></span></span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Tuesday, July 10, 2012</h2><p>Hi,</p>
<p>You can achive 1 to 5 by implementing: </p>
<ul>
<li>DataPortal_OnDataPortalInvoke</li>
<li>DataPortal_OnDataPortalInvokeComplete</li>
<li>DataPortal_OnDataPortalException</li>
</ul>
<p>in your base classes. You will not have access to the criteria object tho&#39;.</p>
<p>Another option is tapping into the WCF Pipeline as the Silverlight server portal is based on WCF and implement whatever logging you want just one - 1 place.</p>
<p>See Miguel Castro&#39;s presentation and samples download for tapping into WCF:<br /><a href="http://www.dotnetdude.com/Files/Downloads/Conferences/NDC_2012/WCFExtensibility.zip">http://www.dotnetdude.com/Files/Downloads/Conferences/NDC_2012/WCFExtensibility.zip</a></p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
