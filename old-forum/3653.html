<html><header><title>PropertyChanged - RemoveHandler - bug???</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>PropertyChanged - RemoveHandler - bug???</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/3653.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>RandyH posted on Friday, October 05, 2007</h2>I have class (MyEmployee) that inherits from businessbase. It has one property (Name). An instance of MyEmployee (_emp) is the datasource for a BindingSource (EmployeeBindingSource). EmployeeBindingSource is bound (Name) to a textbox.text property. In code, the first time I try to update _emp.Name the textbox is updated. The second time I try to update _emp.Name the textbox is not updated. <br>When I step through the first time , I noticed that in BindableBase.RaiseEvent&nbsp; mNonSerializableHandlers.Invoke(sender, e) was being called. This then triggered RemoveHandler to be called so that the PropertyChanged event was REMOVED. Subsequently, the second time I updated _emp.Name the PropertyChanged event never notified the BindingSource.<br><br>Any help here greatly appreciated! I have include the very simple code below (both employee and form):<br><br>Public Class Form2<br><br>&nbsp;&nbsp;&nbsp; Private _emp As MyEmployee<br><br>&nbsp;&nbsp;&nbsp; Private Sub Form2_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _emp = New MyEmployee<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _emp.Name = "Howdy Dudey"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; EmployeeBindingSource.DataSource = _emp<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Me.TextBox1.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.EmployeeBindingSource, "Name", True))<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _emp.Name = "John Doe"<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>&nbsp;&nbsp;&nbsp; Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _emp.Name = "Bubba Smith"<br>&nbsp;&nbsp;&nbsp; End Sub<br><br>End Class<br><br>&lt;Serializable()&gt; _<br>Public Class MyEmployee<br>&nbsp;&nbsp;&nbsp; Inherits Csla.BusinessBase(Of Employee)<br><br>&nbsp;&nbsp;&nbsp; Private _Name As String<br><br>&nbsp;&nbsp;&nbsp; Public Property Name() As String<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return _Name<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Set(ByVal value As String)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _Name = value<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PropertyHasChanged()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End Set<br>&nbsp;&nbsp;&nbsp; End Property<br><br>&nbsp;&nbsp;&nbsp; Protected Overrides Function GetIdValue() As Object<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Return Guid.NewGuid<br>&nbsp;&nbsp;&nbsp; End Function<br><br>End Class<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RandyH replied on Monday, October 08, 2007</h2>Also, if MyEmployee inherits from BindableBase everything works great. But, if I switch it back to BusinessBase the propertychange event only gets fired once because the RemoveHandler gets called.<br><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, October 08, 2007</h2><P>Have you tried using the drag-and-drop designer in VS to set up the data binding, and then comparing your manual code to what the designer creates?</P>
<P>I have high confidence that the binding support in CSLA works, I'm working on a couple apps that use it, and they work fine. But I always use the designer to do the binding, so I'm not entirely sure what the low-level code should look like.</P>
<P>My guess is that your data binding code in the UI is incorrect, but the designer will do it right, and so if you compare results perhaps you'll discover the issue in the UI code.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
