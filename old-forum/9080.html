<html><header><title>Problems with CSLA 4 Authorization, MSTest, and Authorization Rules Caching</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Problems with CSLA 4 Authorization, MSTest, and Authorization Rules Caching</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/9080.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonStonecash posted on Monday, June 14, 2010</h2><p>I have implemented a &quot;claims-based&quot; authorization approach using the CSLA 4 authorization objects.&nbsp; I am trying to unit test the various relationships at the object level between what is requested and what is authorized for object CRUD operations.&nbsp; In each test method, I am setting up the rule object such that it permits Read, Edit, Creae, or Delete, and then calling the one of the Class.CanGet, CanEdit, CanCreate, and CanDelete methods to see if&nbsp;I get the correct result.&nbsp; This results in 16 seperate tests in a single test class.&nbsp;</p>
<p>My problem is that the individual tests ([TestMethod]) work if run by themselves, using VS2010 MSTest.&nbsp; If I run the tests as a batch, some but not all of them fail.&nbsp; I have tracked down the cause of the&nbsp;problem to the fact that CSLA is caching the rules.&nbsp; The result is that while I am setting up new rules for each test method, CSLA is caching&nbsp;the first one that it sees and re-using it.&nbsp; </p>
<p>I am not sure of how I would get around this.&nbsp; Before I charge off in all directions, I thought that I would ask the forum for advice.&nbsp; I have other unit tests of the authorization rules to ensure that the rules work.&nbsp; These tests were to ensure that the wiring between the objects and the rules was working.&nbsp; I could reduce this to a single test but it would be nice to have these tests working as well.</p>
<p>Any thoughts?</p>
<p>Jon Stonecash</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Monday, June 14, 2010</h2><p>CSLA will clear the cache if the principal is different. I think it uses ReferenceEquals - so all you need to do is make sure there&#39;s a new principal object set at the top of each test method.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
