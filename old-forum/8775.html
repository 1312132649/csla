<html><header><title>Responding to Events in the UI</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Responding to Events in the UI</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/8775.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Cslah posted on Tuesday, April 06, 2010</h2><p>I poked around on the forums and couldn&#39;t find a related post, sorry if it&#39;s a repeat here.</p>
<p>I have an object that has a method &quot;Calculate()&quot; that is really long-running, on average a few minutes but I&#39;ve seen it take 10 minutes or so. It&#39;s OK to our end-users because it&#39;s doing A TON of stuff. It builds a collection of objects that the enduser can review and save if they need to. Since it has all of the regular dirty tracking stuff, it inherits from BusinessBase.</p>
<p>So that this object will run faster (on the server), we&#39;re wanting to wrap it with another object and run it within a CommandBase, DataPortal_Execute().&nbsp; This tremendously reduces the number of hops across the wire and is great. This works fine, no prob.</p>
<p>The only caveat here is that we have a progressbar on the UI that increments as things are calculated. I can&#39;t seem to get events to fire from within a remote IIS dataportal. Does anyone know if it&#39;s possible to get events back from the dataportal? We need 100 of them (0 to 100 percent). :-)</p>
<p>Currently using Csla 3.0.4 with a wcf dataportal, and will upgrade to a newer version/technology if needed.</p>
<p>Thanks!</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, April 07, 2010</h2><p>Well, the short answer is that you can&#39;t have&nbsp;events flow through the dataportal like that.</p>
<p>The long answer is, to get what you want, you&#39;d need to record progress somewhere (likely in the database), and have a seperate background task which periodically fires another command object who&#39;s task is simply to bring back the current percentage.</p>
<p>So you&#39;ll probably have two backgroundworkers (or threads), one which syncronously executes the command to get your records (and that thread will block for a while, so it needs to be in the background to keep you application from blocking the UI thread and causing a Not Responding scenario), and the other thread (probably triggered via a timer) that executes the &quot;what&#39;s my percent complet&quot; task, that then marshals back to the UI thread to update status.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, April 07, 2010</h2><p>You will also need to find a network technology that allows bi-directional (sometimes called dual) communication.</p>
<p>Normal WCF bindings, Remoting and asmx technologies only allow the client to call the server and have no provision for the server to send anything back except the one response to the client call.</p>
<p>There are some dual bindings for WCF, and you might explore using one of them. The data portal isn&#39;t set up to directly support a dual binding, but I don&#39;t think it will fail if you do use one.</p>
<p>Every dual binding works differently. So you&#39;ll have to read the docs for whatever dual binding you choose and figure out how it expects you to write your code for a callback.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Savij replied on Wednesday, April 07, 2010</h2><p>I know this is not a true eventing answer, but to me progress bars are mostly eye candy for users so they dont think an app is hung. Since this is usually the case you could &quot;cheat&quot; the process a little. I don&#39;t know if it&#39;s possible in your case, but normally when I have a method called calculate() I usually already know the number of items I have to process, if not you may be able to get that number (or estimate it). Then you can run your Calculate method async (there are many ways to implement this). Your calculate process could update a database table (or a file) and your client application could read that value and update the UI. It wont be exact, but I dont think that matters in most cases.</p>
<p>Another wacky way to handle this would be to setup a WCF listener on the client then launch your command to the server. In the execute method create a WCF connection back to the client (you would have to send some identifier so it knows which client to talk to). You could then update the UI from the server. Wach out for the return call, I think you will have to marshall the call back to the UI thread before updating, just look for invoke sample online.</p>
<p>I know the first way would work for sure, the second way is theory and I have not tried it. I am not totally sure what whill happen with WCF if you are already on a WCF call to the server, but it might work....</p>
<p>-Savij</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>rsbaker0 replied on Thursday, April 08, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>Savij<br></b>
<p>I know this is not a true eventing answer, but to me progress bars are mostly eye candy for users so they dont think an app is hung. Since this is usually the case you could &quot;cheat&quot; the process a little</p>
<p></div></p>
<p>Yes. The simplest approach when you can&#39;t report &quot;true&quot; progress is to use a &quot;marquee&quot; style progress control that cycles continuously until the task is done. It doesn&#39;t convey how much time is remaining, but at least the user will think something is happening. </p>
<p>On a related note, I have to suppress extreme eye-rolling at Microsoft&#39;s progress bar implementations that tell you how much time is remaining, only to progressively increase the estimated remaining time as you to where the whole thing was meaningless. </p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Friday, April 09, 2010</h2><p><div style='padding-left: 50px;background-color:silver'><b>rsbaker0<br></b>Yes. The simplest approach when you can&#39;t report &quot;true&quot; progress is to use a &quot;marquee&quot; style progress control that cycles continuously until the task is done. It doesn&#39;t convey how much time is remaining, but at least the user will think something is happening. </div></p>
<p>I know that&#39;s the MS line, but have users caught on that this can be meaningless as well?&nbsp; I know I realized in Win95 days that the animation thread and the file copy thread are 100% seperate, with really no relation to each other (so the animition will happily continue even though the file copy did in fact stall).</p>
<p>This is one of those tricks I&#39;d like to know if its holding up or not.</p>
<p><div style='padding-left: 50px;background-color:silver'><b>rsbaker0<br></b>On a related note, I have to suppress extreme eye-rolling at Microsoft&#39;s progress bar implementations that tell you how much time is remaining, only to progressively increase the estimated remaining time as you to where the whole thing was meaningless. </div></p>
<p>Indeed.&nbsp; Or that one progress bar, that, when it is at 100% resets again to start all over... and you have no idea how many times this will happen.</p>
<p>I know estimates and whatnot are tough, but surely there is some way to be more accurate sometimes??</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
