<html><header><title>CSLA 4.5.10 and Silverlight -- DataPortal_Create changes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 4.5.10 and Silverlight -- DataPortal_Create changes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11673.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>bchase posted on Friday, November 02, 2012</h2><p>I understand from other posts that CSLA&#39;s 4.5 released version employs the DataPortal_Create with Silverlight in a different fashion than the previous versions. &nbsp;We employ the pattern in which the Create call -- from Silverlight -- would call upon the server-side DataPortal_Create. &nbsp;After installing the 4.5.10 version, we found that the when the Create is initiated from the client (Silverlight), that the DataPortal_Create is not called -- at least not consistently. &nbsp;</p>
<p>In tracking the code, the DataPortal_Create method is found (from within DoCreateAsync) with the proper argument signature (Criteria type):</p>
<p>&nbsp;var method = Server.DataPortalMethodCache.GetCreateMethod(objectType, criteria);</p>
<p>But that method is never called. </p>
<p>What changes are required in CSLA 4.5 to properly continue to use this pattern?</p>
<p>Thanks in advance</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bchase replied on Friday, November 02, 2012</h2><p>I tracked the problem down.... This is something that the CSLA team may want to look into. &nbsp;If one makes a SILVERLIGHT method signature the same as the non-SILVERLIGHT method signature, the SILVERLIGHT method is never called but the non-SILVERLIGHT (server) side will now be called properly as in the versions prior to 4.5.10. &nbsp; It appears that the method cache might be constructed from the client-side methods (Silverlight) even though the server calls the proper method (non-Silverlight). &nbsp;Simply put, the method signature must be present in both versions:</p>
<p>
<p>#if !SILVERLIGHT</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; protected void DataPortal_Create(Criteria crit) </p>
<p>{ </p>
<p>// DO A LOT OF STUFF! </p>
<p>}</p>
<p>#else&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; protected void DataPortal_Creae(Criteria crit){} // DO NOTHING... Just have the method signature for SILVERLIGHT version available</p>
<p>#endif</p>
<p>&nbsp;</p>
</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Monday, November 05, 2012</h2><p>Ah this is exactly what I ran into as well.</p>
<p><a href="http://forums.lhotka.net/forums/t/11675.aspx">http://forums.lhotka.net/forums/t/11675.aspx</a></p>
<p>(The original poster may be experiencing a different problem - I just noticed this thread here).</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Killian35 replied on Tuesday, December 04, 2012</h2><p>I have the&nbsp;same problem in Silverlight. It turns out you don&#39;t need to create a DataPortal_Create(Criteria type) matching your server-side dataportal call. For me it works as long as I just override the default DataPortal_Create() method to remove the [RunLocal] attribute, even if my DataPortal_Create method has parameters. It indeed seems like Csla is defaulting to the default DataPortal_Create (and honoring the RunLocal)&nbsp;if there is no matching signature, instead of going to the server.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>bill.mybiz replied on Tuesday, December 04, 2012</h2><p>Thaaank you Killian35. All you have to do is override the DataPortal_Create() parameterless method to get rid of the RunLocal attribute. You are the gee-ing man. And since I have my own BusinessBase class subclassing the Csla BusinessBase class, I just had to override it once there and the RunLocal is gone for all of my business base descendants:</p>
<p><br />public abstract class BusinessBase&lt;C, CDto&gt; : Csla.BusinessBase&lt;C&gt;<br />&nbsp;&nbsp;&nbsp; where C : CslaBases.BusinessBase&lt;C, CDto&gt;<br />&nbsp;&nbsp;&nbsp; where CDto : class<br />&nbsp; {</p>
<p>.....</p>
<p>&nbsp;&nbsp;&nbsp; protected override void DataPortal_Create()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //THIS GETS RID OF THE DEFAULT RUNLOCAL ATTRIBUTE ON THE CSLA.BUSINESSBASE.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.DataPortal_Create();<br />&nbsp;&nbsp;&nbsp; }</p>
<p>...</p>
<p>}</p>
<p>This one had me scratching my groggy head. This has been a very interesting migration.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>RockfordLhotka replied on Thursday, December 06, 2012</h2><p>What has happened here is a &quot;feature not a bug&quot;.</p>
<p>In version 4.5 the data portal in Silverlight is now the same as the data portal always has been in .NET. There is now just one data portal implementation.</p>
<p>This does change the rules about how Silverlight interacts with the data portal a little bit, as you have all noted in this thread. These changes make the data portal work the same as it always has in .NET code, so all platforms are now consistent.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Killian35 replied on Thursday, December 06, 2012</h2><p>Hi Rocky,</p>
<p>For the most part, I agree that it&#39;s a feature, not a bug. However, in the case where I have a non-parameterless DP_Create method that only exists in the server-side code (excluded from client-side by preprocessor), Csla, of course, doesn&#39;t find the method matching the signature. It then seems to proceed to run the default parameterless DP_Create(with RunLocal), instead of then going to the server with the assumption the non-parameterless DP_Create exists there. And in my case, I use ObjectFactory extensively. So I&#39;d have no matching signatures for anything on the Silverlight side or probably&nbsp;any client side tier.</p>
<p>I would think this is how it would be expected to work with any n-tier system. If I had a web-server that did a DP_Create(with parameters) that didn&#39;t have a matching signature on the web-server it would&nbsp;still go&nbsp;to&nbsp;the app server (provided it was an&nbsp;n-tier setup) and succeed or fail there, not&nbsp;utilize the default DP_Create()&nbsp;on the web-server. Now if I called the DP.Create method with no parameters, then I&#39;d expect Csla to deal with the local DP_Create method as it currently does.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, December 06, 2012</h2><p>In your case I recommend overriding DataPortal_Create in your custom base class to remove the RunLocal attribute. That way you don&#39;t need to override it in every class, and you will have changed the default behavior to always do the create on the app server.</p>
<p>That is, btw, the reason for the default DP_Create being RunLocal - so the default do-no-work create operation doesn&#39;t round-trip to the server for no reason.</p>
<p>That particular part of the framework&#39;s behavior is very much intentional, and this issue isn&#39;t unique to SL. Rather, it is only now becoming visible on SL because SL works like .NET now.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Killian35 replied on Friday, December 07, 2012</h2><p>I agree that the DataPortal_Create method with no parameters should be left as is. My concern is when I&#39;m making a data portal call with a criteria. I was under the impression that if a DataPortal_Xxx method with a matching signature was not found then the call would fail ,or go to the server if remoting was set up, and try again there.</p>
<p>So I was expecting:</p>
<p>DataPortal.BeginCreate(mycriteria, callback);</p>
<p>to not be affected by:</p>
<p>[RunLocal]DataPortal_Create()</p>
<p>because it does not have a matching signature to my criteria and would either fail or go to the server if remoting was set up.</p>
<p>I noticed that I can add a parameterless [RunLocal]DataPortal_Fetch() to the client side and affect DataPortal.BeginFetch with parameters, the same as BeginCreate. Again, I was under the impression that only a DataPortal_Xxx method with a matching criteria signature would be checked for the RunLocal attribute. And if no matching method was found, then the call would fail or go to the server.</p>
<p>However, this is a very rare occurrence. 99% of the time, the empty create method is all that is needed. So overriding it is no big deal once you learn how things work.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Friday, December 07, 2012</h2><p>In that regard I think you are correct. If the data portal is somehow mapping Create(x) to DataPortal_Create() instead of DataPortal_Create(x) then that&#39;s incorrect.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
