<html><header><title>Hosting DataPortal in Windows Service</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Hosting DataPortal in Windows Service</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/135.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>stegerwald posted on Thursday, May 18, 2006</h2><P>Hi,</P>
<P>what is the easiest Way to host the data portal within a windows service? we dont have the option to use IIS.</P>
<P>How can I achieve this, how big is the implementation effort?</P>
<P>Thanks for any suggestions</P>
<P>Frank</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stegerwald replied on Monday, May 22, 2006</h2><P>any ideas anyone?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>probashi replied on Monday, May 22, 2006</h2><P>If IIS is not an option, how about using Enterprise Services (Host/Proxy) that comes with the CSLA framework! </P>
<P>You can have remoting host in a windows service application but looks like the ‘2005 C# Book’ does not recommend this [ref: page 604, Host Technology: "..I don’t recommend this course of action, because you would need to duplicate a large percentage of IIS to achieve comparable levels of manageability, security, runtime monitoring and so fourth…. "] </P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stegerwald replied on Monday, May 22, 2006</h2><P>Well, </P>
<P>thanks for the idea, but </P>
<P>I dont need the features that IIS or Enterprise Services is&nbsp;offering.</P>
<P>I need to install a Windows Service anyhow and so I want to host</P>
<P>the DataPortal there. I am running my application in a workgroup</P>
<P>where I dont need the security features and the management and monitoring</P>
<P>stuff cannot be managed by my customers.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, May 22, 2006</h2><P>I don't recommend writing your own host, nor do any reputable Remoting experts out there.</P>
<P>But if you must, you must. And it isn't hard to do. In its simplest form you just need to write one line of code to configure remoting from your app.config file and you are done.</P>
<P>I wrote some articles on how to do this a few years ago for the Adventures in VB.NET column on MSDN. Those articles have slowly been buried in the huge volume of stuff on msdn.microsoft.com, but if you google for "msdn lhotka remoting" you should find them.</P>
<P>Also, look at Ingo Rammer's remoting book.</P>
<P>Just be aware that a custom host can't handle the volume of either IIS or COM+ - the threading and memory management features of those hosts simply won't be available to you. Also, make sure (and I don't know how to do this) that you get the garbage collector running in server mode, not client mode, or you'll have sporadic perf issues and possible runaway memory consumption. It may be that this is automatic in .NET 2.0 - but it wasn't in 1.1...</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stegerwald replied on Thursday, June 01, 2006</h2><P>Hi,</P>
<P>i have problems implementing my custom remoting host.</P>
<P>It is a simple windows service that does the following:</P><FONT color=#008000 size=2>
<P>// Setup Remoting</P></FONT><FONT size=2>
<P></FONT><FONT color=#008080 size=2>String</FONT><FONT size=2> filename = </FONT><FONT color=#008080 size=2>AppDomain</FONT><FONT size=2>.CurrentDomain.SetupInformation.ConfigurationFile;</P>
<P></FONT><FONT color=#008080 size=2>RemotingConfiguration</FONT><FONT size=2>.Configure(filename, </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>);</FONT></P>
<P><FONT size=2></FONT>&nbsp;</P>
<P><FONT size=2>Based on the following Configuration file:</FONT></P><FONT size=2><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>system.runtime.remoting</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>application</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>channels</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>channel</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>http</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>serverProviders</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>provider</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>wsdl</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>formatter</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>soap</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>typeFilterLevel</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Full</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>formatter</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>ref</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>binary</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>typeFilterLevel</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Full</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>serverProviders</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>channel</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>channels</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>service</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>wellknown</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>mode</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>SingleCall</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>objectUri</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>RemotingPortal.rem</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>type</FONT><FONT color=#0000ff size=2>=</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>Csla.Server.Hosts.RemotingPortal, Csla</FONT><FONT size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>service</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>application</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>system.runtime.remoting</FONT><FONT color=#0000ff size=2>&gt;</FONT></P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P>
<P><FONT color=#0000ff size=2>the client uses the following configuration file:</FONT></P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>
<P>&lt;</FONT><FONT color=#800000 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CslaDataPortalProxy</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>Csla.DataPortalClient.RemotingProxy, Csla</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;</FONT><FONT color=#800000 size=2>add</FONT><FONT color=#0000ff size=2> </FONT><FONT color=#ff0000 size=2>key</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>CslaDataPortalUrl</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2> </P>
<P></FONT><FONT color=#ff0000 size=2>value</FONT><FONT color=#0000ff size=2>=</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>http://proentfstnb/RemotingHost/RemotingPortal.rem</FONT><FONT color=#000000 size=2>"</FONT><FONT color=#0000ff size=2>/&gt;</P>
<P>&lt;/</FONT><FONT color=#800000 size=2>appSettings</FONT><FONT color=#0000ff size=2>&gt;</FONT></P>
<P><FONT color=#0000ff size=2></FONT>&nbsp;</P>
<P><FONT color=#0000ff size=2>When I run the client, I get the following Error when trying to get a </FONT></P>
<P><FONT color=#0000ff size=2>BusinessObject via the data portal:</FONT></P>
<P><FONT color=#0000ff size=2>System.Runtime.Serialization.SerializationException</FONT></P>
<P><FONT color=#0000ff size=2>{"The input stream is not a valid binary format. The starting contents (in bytes) are: 53-79-73-74-65-6D-2E-52-75-6E-74-69-6D-65-2E-52-65 ..."</FONT></P>
<P><FONT color=#0000ff size=2>in DataPortalClient.RemotingProxy.Fetch()</FONT></P>
<P><FONT color=#0000ff size=2>It seems that the Call does not reach the server at all.</FONT></P>
<P><FONT color=#0000ff size=2>Any Ideas what I am missing there or what went wrong???</FONT></P>
<P><FONT color=#0000ff size=2>Thanks for any help</FONT></P>
<P><FONT color=#0000ff size=2>Frank</P></FONT></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, June 01, 2006</h2>You should probably provide an explicit port number on which the server will listen - for clarity if nothing else.<br><br>You should be able to ensure that the server can be reached at all by using your browser to navigate to the server url with "?wsdl" stuck on the end - so ending in ".../RemotingPortal.rem?wsdl" - the result should be a bunch of XML.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>stegerwald replied on Thursday, June 01, 2006</h2><P>thanks, that worked, the server is reachable.</P>
<P>And the problem disappered???</P>
<P>I dont know exactly what happended, but I suspect a version mismatch between the BO dll on the server and the client...</P>
<P>I recompiled the business dll and redistributed the dll and now the</P>
<P>error message is gone. </P>
<P>Thanks for the help</P>
<P>greetings</P>
<P>Frank</P>
<P>&nbsp;</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
