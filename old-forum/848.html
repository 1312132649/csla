<html><header><title>Generics and Rules : CSLA 2.1</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Generics and Rules : CSLA 2.1</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/848.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>cash_pat posted on Wednesday, August 09, 2006</h2>Hi, <br><br>I am new to to generics as i am from VB. can anyone post some examples as to how the new strongly typed rules can be implemented. Anything showing the syntax would suffice.<br><br>regards<br><br>cash pat<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, August 09, 2006</h2>Protected Overrides Sub AddSharedBusinessRules()<br>&nbsp;&nbsp;&nbsp; MyBase.AddSharedBusinessRules()<br>&nbsp;&nbsp;&nbsp; ValidationRules.AddSharedRule(Of <b>ObjectType</b>, <b>RuleArgs</b>)( _ <br>&nbsp; &nbsp;&nbsp;&nbsp; AddressOf RuleMethod, New RuleArgs("PropertyName")<br>End Sub<br><br><br>Private Shared Function RuleMethod( ByVal target as <b>ObjectType</b>, e As <b>RuleArgs</b>) As Boolean<br>&nbsp;&nbsp;&nbsp; If target.mPropertyName = 2 Then<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  e.Description = "Value cannot be 2"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  Return False<br>&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; Return True<br>End Function<br><br>I hope that does it!<br><br>Andrés</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cash_pat replied on Wednesday, August 09, 2006</h2>Another one plz. Couldn't understand that.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Wednesday, August 09, 2006</h2>That's pretty much the simplest example anyone could make, but let's talk about it a little bit to see if you get it...<br>The rule assumes that you have a property called "PropertyName" and that it exposes a private field called "mPropertyName". It also assumes that the class name for your bo is "ObjectType"<br>Generic methods take the types you want to specify before the argument.<br><br>So, basically what the generic method needs is to know the type of the object you're going to work with (that's the target of the rule) and the type of the argument (which must be at least RuleArgs or inherit from ruleargs).<br><br>The target is the object that is going to be validated, so ValidationRules (which is an object inside your bo) keeps a reference to the parent (your actual BO). <br>When you call ValidationRules.CheckRules("PropertyName"), it looks for rules that apply to that property and calls them, passing the two arguments: the target (the bo that is being validated) and the validation argument (the ruleargs).<br><br>Your rule uses the target to access the values of the bo being validated. Since the method is inside the class, it can access it's private fields. It returns true if the value is valid and, if it's not, it set's the broken rule description and returns false.<br><br>I hope that brings a little more light into the matter.<br><br>Andrés<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cash_pat replied on Wednesday, August 09, 2006</h2>Thanks Xal. Got it right this time. Hey Another small query.<br><br>Suppose I have BO. I want to apply authorization rules base on a particular property. How do i go about it. It used to work with CSLA 1.53. Any ideas??<br><br>regards<br><br>cash pat<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Thursday, August 10, 2006</h2>There was no directly support for authorization in CSLA 1.x, so whatever you were doing was something of your invention. And that may still work in 2.0 - I can't speak to that.<br><br>But in CSLA .NET 2.0 I did introduce the concept of property-level authorization. The internal implementation is discussed in Chapter 3, and you can look in Chapter 8 to see how it is used in the ProjectTracker sample app.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>cash_pat replied on Friday, August 11, 2006</h2>Let me explain the problem in detail.<br><br>I have a <b>BO </b>called Voucher. It has a property <i>VoucherTypeID.</i><br><br>Now this BO changes its behaviour according to the VoucherTypeID which can range from <b>Contra, Journal, Sales, Purchase </b>etc. Some Child <b>BO </b>collection may or may not be loaded depending on VoucherTypeID.&nbsp; <br><br>In 1.53 i used to conditionally load the child objects by checking the <i>VoucherTypeID </i>property. Even though the child variables were there in the Voucher <b>BO </b>their reppective fetch was not called. Even the update was conditional<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Courier New" size="2">If Not mChildren Is Nothing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mChildren.Update(tr, Me)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</font><br><br>Now, In 2.0 the problem is different. Users have access to different Vouchers depending on the <i>VoucherTypeID</i>. But the problem arises from the fact that <i>VoucherTyepID </i>is not known beforehand because in every Factory method there is a <b>CanReadObject(), CanGetObject</b> before the actual <b>Fetch</b>. So there is no way this authorization can be done.<br><br>&nbsp;&nbsp; <font face="Courier New" size="2">Select Case </font><font face="Courier New" size="2">VoucherTyepID </font><br><font face="Courier New" size="2"><br>&nbsp;&nbsp;&nbsp;&nbsp; Case VoucherTypesEnum.VoucherTypes.Contra<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If VerifyAccessLevel(ResourceType.Contra, mAccessType) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp;&nbsp; Case VoucherTypesEnum.VoucherTypes.CreditNote<br></font><font face="Courier New" size="2">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; If VerifyAccessLevel(ResourceType.</font><font face="Courier New" size="2">CreditNote</font><font face="Courier New" size="2">, mAccessType) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; End If</font><font face="Courier New" size="2"><br><br>&nbsp;&nbsp;&nbsp;&nbsp; Case VoucherTypesEnum.VoucherTypes.DebitNote<br></font><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If VerifyAccessLevel(ResourceType.</font><font face="Courier New" size="2">DebitNote</font><font face="Courier New" size="2">, mAccessType) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</font><font face="Courier New" size="2"><br><br>&nbsp;&nbsp;&nbsp;&nbsp; Case VoucherTypesEnum.VoucherTypes.Sales<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font face="Courier New" size="2">If VerifyAccessLevel(ResourceType</font><font face="Courier New" size="2">Sales</font><font face="Courier New" size="2">mAccessType) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</font><font face="Courier New" size="2"><br><br>&nbsp;&nbsp;&nbsp;&nbsp; Case VoucherTypesEnum.VoucherTypes.Journal<br><br></font><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If VerifyAccessLevel(ResourceType.Contra, mAccessType) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; End If<br><br>&nbsp;&nbsp;&nbsp; End Case<br></font><br>regards<br><br>cash pat<br><br>&nbsp;&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Friday, August 11, 2006</h2>You could just throw an exception inside the dataportal if you detect that the user doesn't have the rights to get that data.<br>You can also make a CarGetObject() that takes the ID as parameter and then you'd use a command object to find out if the user can or can't actually get the data.<br>In any case, the approach of blocking the user from getting to the data by throwing an exception is perfect, because that's the only way you have to restrict that from a bo standpoint. But also, you should find a way to restrict the user from ever seeing that "unaccesible" object in a list, so that ideally he'll never reach the exception. Or if he does see it, restrict the edit button based on criteria you get from the list.<br><br>I say that because I usually show a list of things to the user so that they can pick an item to edit. You could have a method in the read only object that indicates whether you can actually edit / remove that object or not, and enable / disable toolbars / buttons so that the user will be blocked even before they can actually communicate with the bo or the database.<br><br>Andrés<br><br>Andrés<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
