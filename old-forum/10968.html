<html><header><title>BO Async call returns before observable collection loads</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>BO Async call returns before observable collection loads</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/10968.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vlam posted on Friday, December 09, 2011</h2><p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">We are using silverlight 4. Csla 4.2 Bxf and MVVM design pattern</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">I am fairly new to csla and Silverlight, <span style="mso-spacerun:yes;">&nbsp;</span>and I am struggling to get my comboBox to bind correctly to my observable collection in my viewmodel.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">My viewmodel&rsquo;s constructor calls the beginRefresh method to create a new participant.</span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">ParticipantVM</span> : <span style="color:#2b91af;">ViewModel</span>&lt;<span style="color:#2b91af;">Participant</span>&gt;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">public</span> ParticipantVM()</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BeginRefresh(<span style="color:#a31515;">&quot;NewParticipant&rdquo;</span>);</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;">}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Within that viewmodel I also got an observable collection that loads all the countries from the database so that it can be bound to a new participant.</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">public</span><span style="font-family:Consolas;font-size:9.5pt;"> <span style="color:#2b91af;">ObservableCollection</span>&lt;<span style="color:#2b91af;">CountryListVM</span>&gt; CountryList</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">get</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">var</span> result = <span style="color:blue;">new</span> <span style="color:#2b91af;">ObservableCollection</span>&lt;<span style="color:#2b91af;">CountryListVM</span>&gt;();</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>result.Add(<span style="color:blue;">new</span> <span style="color:#2b91af;">CountryListVM</span>());</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;</span><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;">return</span> result;</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;"><span style="mso-spacerun:yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;"><b style="mso-bidi-font-weight:normal;"><span style="line-height:115%;font-size:14pt;">It seems like the fetch of the countries does not always complete before the overridden onrefreshed is called by the viewmodel and when that happens the countries are not bound to the country of residence property on the participant object</span></b><b style="mso-bidi-font-weight:normal;"><span style="line-height:115%;font-family:Consolas;font-size:14pt;"></span></b></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="line-height:115%;font-family:Consolas;font-size:9.5pt;">My Xaml for the combo box is the following:</span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&lt;</span><span style="font-family:Consolas;color:#a31515;font-size:9.5pt;">ComboBox</span><span style="font-family:Consolas;font-size:9.5pt;"> <span style="color:red;"><span style="mso-spacerun:yes;">&nbsp;</span>Grid.Column</span><span style="color:blue;">=&quot;1&quot;</span><span style="color:red;"> Grid.Row</span><span style="color:blue;">=&quot;10&quot;</span><span style="color:red;"> Name</span><span style="color:blue;">=&quot;cboCOR&quot;</span><span style="color:red;"> Margin</span><span style="color:blue;">=&quot;5&quot;</span><span style="color:red;"> ItemsSource</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;"> Source</span><span style="color:blue;">={</span><span style="color:#a31515;">StaticResource</span><span style="color:red;"> participantVMCountryListModelViewSource</span><span style="color:blue;">}}&quot;</span><span style="color:red;"> SelectedValuePath</span><span style="color:blue;">=&quot;Country_Name&quot;</span><span style="color:red;"> DisplayMemberPath</span><span style="color:blue;">=&quot;Country_Name&quot;</span><span style="color:red;"> SelectedValue</span><span style="color:blue;">=&quot;{</span><span style="color:#a31515;">Binding</span><span style="color:red;"> Path</span><span style="color:blue;">=Model.Country_of_Residence,</span><span style="color:red;"> Mode</span><span style="color:blue;">=TwoWay}&quot; /&gt;</span></span></p>
<p class="MsoNormal" style="line-height:normal;margin:0cm 0cm 0pt;mso-layout-grid-align:none;"><span style="font-family:Consolas;color:blue;font-size:9.5pt;">&nbsp;</span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-size:small;"><span style="font-family:Calibri;">Sometime it will load fine and the cansave property of the participantVM would be true when I select a country in the list but then other times the cansave will stay false even though I would select a value in the combo box as if combobox is not bound to the property of my viewModel at all.<span style="line-height:115%;font-family:Consolas;color:blue;font-size:9.5pt;"></span></span></span></p>
<p class="MsoNormal" style="margin:0cm 0cm 10pt;"><span style="font-family:Calibri;font-size:small;">&nbsp;</span></p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, December 09, 2011</h2><p>I&#39;d recommend to switch to a UOW approach to avoid these syncronization issues. </p>
<p>Read more here:<br /><a href="http://forums.lhotka.net/forums/p/10508/49156.aspx">http://forums.lhotka.net/forums/p/10508/49156.aspx</a>&nbsp;<br /><a href="http://forums.lhotka.net/forums/p/10030/47059.aspx">http://forums.lhotka.net/forums/p/10030/47059.aspx</a><br /><a href="http://forums.lhotka.net/forums/t/9863.aspx">http://forums.lhotka.net/forums/t/9863.aspx</a></p>
<p>Basically - create e ReadOnly object to fetche the root object and all other name/value lists (all of them) in one fetch from the server and then create/connect the viewmodels. All data will then be available when you create the view and viewmodels. </p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
