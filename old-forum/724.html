<html><header><title>Role/Group Management</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Role/Group Management</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/724.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gigatron posted on Tuesday, July 25, 2006</h2><P>Anyone have any suggestions on frameworks and/or patterns that can be used to manage user roles/groups?&nbsp; The examples using csla are very basic at best and only handle roles.&nbsp; I need something that is configurable and dynamic that can handle groups that can contain roles.&nbsp; I need to either build or find a framework to handle my needs.&nbsp; This needs to be intergrated with asp.net forms authentication.&nbsp; </P>
<P>I'm thinking I need to build a custom role/membership providers and a framework that can assign objects, properties and processes to roles, which can then be assigned groups.&nbsp; There must be some solutions aready built?&nbsp; This seems like something that would be common in large scale systems.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, July 25, 2006</h2><P>I agree.&nbsp; However, we ended building our own.&nbsp; A CSLA-style framework does support this well.&nbsp; all depends on how complex you want to get.&nbsp; Ours is pretty complex and rivals Windows/ActiveDirectory but integrates tightly with the object-level authorization scheme provided with CSLA (e.g. CanReadProperty, CanWriteProperty, etc.)</P>
<P>If you find something pre-built, post it here.&nbsp; I'd be very interested in seeing what others have done.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gigatron replied on Tuesday, July 25, 2006</h2><P>Yeah, this is what I was fearing, having to build a framework to handle group/role management.&nbsp; I'm thinking of having roles/groups that are assigned objects and what properties and processes of those objects&nbsp;are allowed/denied/etc.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ruckus77 replied on Tuesday, July 25, 2006</h2>I'd be very interested in seeing your complex system that is tightly coupled with CSLA. I am working on a similar solution myself.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gigatron replied on Tuesday, July 25, 2006</h2>I am really mystified why there is no framework available.&nbsp; It seems to me that&nbsp;Role/Group management is an important&nbsp;part of any system these days.&nbsp; This will cost me alot of time to build something.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, July 25, 2006</h2><P>The issue I found is that there are a number of working examples out there but they are usually simplistic at best (only user/role) or don't come anywhere near what we needed.</P>
<P>In a nutshell, we extended our framework to include an entire security model for our applications that includes User and Group classes.&nbsp; These are both data classes (as are supporting UserCollection, GroupCollection, etc.).&nbsp; We have a configurable switch that indicates how the application is to handle security:</P>
<UL>
<LI>Windows - single sign-on using the current user's credentials (for both authentication and authorization).&nbsp; This is mostly applicable to Windows and intranet apps.&nbsp; Group membership is based on the Windows account membership.</LI>
<LI>Custom - uses the information stored in the database to get the user's profile, for authentication and Group membership (for authorization).&nbsp; This is most typical in web apps.</LI>
<LI>Integrated - uses the current Windows identity to authenticate the user but goes to the database for Group membership.&nbsp; Basically, the username is matched up to the database to obtain Group info.&nbsp; We use this with intranet apps mainly.</LI></UL>
<P>Our SecurityManager class provides a gateway mechanism for most of the settings and functions such as getting the CurrentUser.</P>
<P>We have incorporated Account Lockout and Password Policies similar to Windows as well.&nbsp; Just to further complicate things.</P>
<P>Because we have the ability to enforce password history via the policies, we actaully have a Password object and PasswordCollection that handles all of the behaviors and logic associated with a password.</P>
<P>Both User and Group are derived from Actor which enables us to have both User objects and Group objects as members of a Group.</P>
<P>The Group object maintains a list of Roles associated with that Group.&nbsp; We debated allowing direct assignment of Roles to a User but opted to not implement that - at least not yet.&nbsp; The master list of roles that can be assigned to a Group is found in resource files embedded in the application.&nbsp; Because this is not something you want your users tampering with, this seemed like a good way to go.&nbsp; Plus, it gives us the ability to localize the role descriptions should we be dealing with a multi-lingual app.&nbsp; The SecurityManager class exposes a Roles property which is a RoleCollection.&nbsp; The SecurityManager uses config settings to load all of the "user-defined" resource files - in other words, it knows about the resource file embedded in our framework, so we use config 'hooks' to allow additional resource files containing application specific roles to be added to the list.&nbsp; Oh, the other benefit is that we can refer to the resource name in code when performing authorization checks and not have to worry about how we spelled the role or if a word was capitalized, etc.</P>
<P>Everything is flexible, scalable and inheritable for extensibility.&nbsp; For instance, our policies are designed to allow additional policies to be defined for the application seamlessly with the built-in ones.&nbsp; In fact, we can add additional settings to the built-in ones through the config file.</P>
<P>I know that sounds like a lot and it did take us quite a while to develop, but, we were able to (at least in my opinion) take the best of what's out there and come up with a stable yet robust and flexible model to include in our framework.&nbsp; So far it has worked great.</P>
<P>Outta time on this end, but I'd be more than happy to answer any specific questions that you might have.</P>
<P>Hope that helps.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gigatron replied on Tuesday, July 25, 2006</h2>How did you handle intergrtaion with CSLA?&nbsp; Do you have a front end for administrating what Roles can do?&nbsp; For instance, how do you assign a role read/create/updates to csla objects so no hard coding is involved?&nbsp; For example:&nbsp; You have Order object and 2 roles, one with read/create/update and one with read.&nbsp; How do you do handle this without any hard coding in your Order object?&nbsp; My systems needs to be dynamic, where the above scenario may change and we have a new role that has only update acces for instance.&nbsp; I don't want to have to make code changes and&nbsp;recompile.&nbsp; Recompiling is not an option for me and needs to be dynamic and manageable.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>SonOfPirate replied on Tuesday, July 25, 2006</h2><P>Let me answer the first question...well, first.&nbsp; The integration with CSLA comes from the fact that our security objects are dervied from the CSLA base classes and make use of the same features and functions provided therein.&nbsp; For instance, the ability to create new users is an authorization feature just like any other.</P>
<P>A word of correction from my previos post.&nbsp; I tend to misuse the terminology and it constantly gets me in trouble.&nbsp; I have been working on getting it straight but still instinctively fall back to the User-Group-Role nomenclature when in reality it is User-Group/Role-Right.&nbsp; This is the correct terminology in our model and may help to understand things better.&nbsp; Too many people interchange the term Group and the term Role that they essentially mean the same thing now - hell, even Microsoft does it...IsInRole(...)!&nbsp; Take a look at the WindowsIdentity and you'll see a Groups property!!!&nbsp; Even they switch 'em up.</P>
<P>Anyway, what we have is a User that hold membership in 'x' number of Groups each of which can also be thought of as a Role and contain a set of assigned Rights.&nbsp; An example of a&nbsp;Group, or Role, would be 'Order Entry Clerk' while a Right would be "Can add new orders".&nbsp; With me?</P>
<P>Now let me try to address the rest all together...</P>
<P>I agree with the need to be flexible and dynamic.&nbsp; Those were the tenets of our design as well and can be seen in the extensibility provided through config files, inheritance, etc.&nbsp; However, there is a compromise to this flexibility based on real-world implementation.&nbsp; That being where the rights are defined.</P>
<P>They have to be defined <EM>somewhere</EM>.&nbsp; In our case, all rights are defined in a resource file embedded in the project.&nbsp; So, we have a resource file embedded in our framework that contains a list of all rights for objects in our framework, such as creating a new user.&nbsp; When we create an application making use of our framework, we can (obviously this is optional) create a second resource file embedded into the application that will contain the rights for any new objects created for the application.&nbsp; These rights are then used in conjunction with the AuthorizationRules collection held by each business object.&nbsp; The concept we used is basically the same as Rocky's except that we've added the extra layer to the model, so the "role" that is used when establishing an AuthorizationRule is one of these values whereas the roles used in the book translate to Groups in our model.</P>
<P>So, for your example, our application would have a resource file with three&nbsp;string resources&nbsp;added:</P>
<UL>
<LI>ReadOrderRight&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Can read orders"</LI>
<LI>CreateOrderRight&nbsp;&nbsp;&nbsp; "Can create new orders"</LI>
<LI>UpdateOrderRight&nbsp;&nbsp;&nbsp;"Can modify orders"</LI></UL>
<P>You would have two Groups/Roles defined:</P>
<UL>
<LI>Order Entry Clerk</LI>
<LI>Stock Clerk</LI></UL>
<P>The first would have all three rights assigned while the second only the ReadOrderRight.</P>
<P>Then, your Order object would use these rights to authorize the user to perform the requested operation.&nbsp; For instance, in the CanAddOrders static method, you would check to see if the current user has the CreateOrderRight in its list.</P>
<P>FYI - the authorization task in our model is delegated to the SecurityManager object which has a static Authorize() method accepting the right to check against.&nbsp; So, CanAddOrders would look something like this:</P>
<P><CODE>public static System.Boolean CanAddOrders()<BR>{<BR>&nbsp;&nbsp;&nbsp; return SecurityManager.Authorize(CreateOrdersRight);<BR>}</CODE></P>
<P>So, even though you are coding the rights into the objects, assignment of the rights to users (via Groups/Roles) is dynamic and can be done via a user-interface (which we do have both Web and Windows controls for managing our security objects in our framework).</P>
<P>The only other way I can think of to do this that would remove the hard-coded rights from the object would be to use more of a traditional ACL-type approach where the Order object maintains a dynamic list of Users and/or Groups/Roles that are allowed various access rights.&nbsp; We did look into this and opted for the approach listed above.&nbsp; Our thoughts here were that all objects have a standard set of rights: Read, Create, Modify and Delete.&nbsp; When you add an entry into the ACL for an object you define which of these rights are being granted.&nbsp; Then, your Authorize routine can check the object's ACL for the current user and cross-check to see if the requested right has been granted.&nbsp; This is similar to how file security works in Windows.&nbsp; There are some built-in classes that can help with this in the System.Security.AccessControl namespace.</P>
<P>My hope is that we eventually combine these approaches because I like the idea of being able to set priviledges on an object-by-object basis when applicable as well as the more global approach we've already taken.</P>
<P>Hope that answers your questions.</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Gigatron replied on Wednesday, July 26, 2006</h2>Thanks for the detailed response&nbsp;SonOfPirate.&nbsp; Thats along the lines of what I will end up implementing, only difference is I will be using aspnet forms authentication.&nbsp; I plan on storing all my access information in tables though.&nbsp; This way I can have a front end for configuration.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>lefty replied on Tuesday, May 01, 2007</h2>I really like this approach and I think I'm going to try to implement something similar in my project, however I have a question.<br><br>What method do you use for linking the rights to the Group?<br><br>What I invision is a table with columns (GroupName, Right) and each row specifies a Group/Right combination.&nbsp; I'm also wondering if the Rights are saved in a resource file in the application, how do you represent them in the Database?&nbsp; An integer?&nbsp; Or maybe a string that is defined in the resource file?<br><br>Thanks,<br>Jeff<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skaue replied on Wednesday, May 02, 2007</h2>Now where can I download your code, SonOfPirate ;-)<br><br>(just kiddin)<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
