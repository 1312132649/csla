<html><header><title>DataBinding with CSLA and telerik radGrid control</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>DataBinding with CSLA and telerik radGrid control</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2426.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>mongo posted on Sunday, February 25, 2007</h2><P>I was looking at some threads both here and at Telerik that didn't quite resolve my scenario for hierarchical binding of Telerik's radGrid and CSLA.&nbsp; So I thought I'd drop my solution here for people to find it.&nbsp; I hope this helps - I also blogged about it<A href="http://codebetter.com/blogs/steve.hebert/archive/2007/02/25/Hiearchical-data-binding-with-CSLA-and-Telerik_2700_s-radGrid-control_2E00_.aspx"> here</A>.</P>
<P>I have two collections where the second&nbsp; set is&nbsp;a child collection&nbsp;&nbsp;to the first set.&nbsp; The code below is a minimal set of operations to detail how they are wired together.</P>
<P>First, I set up two distinct CslaDataSource controls - one for each collection.&nbsp; In reality, these are part of the same object hiearchy and I could do this with one control, but I feel it comes out a little cleaner with two.</P>
<P>The key points to&nbsp;follow are this:</P>
<OL>
<LI>Grid: Set the MasterTableView and DetailTable&nbsp;DataSourceIds&nbsp;to their respective CSLA data binding control (dbc). 
<LI>Grid: Set the MasterTableView's DateKeyNames property to reflect the unique identifier for the parent row. 
<LI>DBC Parent: Set up the DataSource_SelectObject to return the business object via the e.BusinessObject parameter. 
<LI>Grid: Map the ItemCommandEvent to grab parent key using the code snippet below. 
<LI>DBC Child: Set up the DataSource_SelectObject to return the appropriate child object according to the key obtained in step #4.</LI></OL>
<P>Below is the code snippet for the Grid_ItemCommand event mentioned in Step#4:</P>
<P>private Guid _activeParentId = Guid.Empty;&nbsp; //data type may vary for actual implementation.</P>
<P>protected void ..._ItemCommand(...)<BR>{<BR>&nbsp;&nbsp; if( e.CommandName == ExpandCollapseCommand )<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _activeParentId = (Guid) e.Item.OwnerTableView.DataKeyValues[e.Item.Index][parentIdName];<BR>}</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Sunday, February 25, 2007</h2>I used a somewhat similar approach, thanks for the contibution.<br><br>you managed to implement server side paging using radGrid and the 2.1.x CslaDataSource ? haven't had a look at it yet, but maybe you can share an imlementation ?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mongo replied on Friday, March 02, 2007</h2>Sorry for the late reply - I have.&nbsp; The implementation differs depending on the nature of your collection(s), but it's fairly straight forward.&nbsp; I will post in the next few days.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Friday, March 02, 2007</h2>I made a proof of concept this week to see if it works:<br><br>&nbsp;&nbsp;&nbsp; [Serializable()] <br>&nbsp;&nbsp;&nbsp; public class OrderList : OrderListBase&lt;OrderList, OrderListItem&gt;, Csla.Core.IReportTotalRowCount<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private int _totalRowCount;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  // ....<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  <br>&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp; public static OrderList GetPagedOrderList(Csla.Web.SelectObjectArgs args)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (!CanGetObject())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; throw new System.Security.SecurityException("User not authorized to view a OrderList");<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;OrderList&gt;(new PagedCriteria(args));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  // .....<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected class PagedCriteria : CriteriaBase<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private Csla.Web.SelectObjectArgs _args;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public Csla.Web.SelectObjectArgs Args<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return _args;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public PagedCriteria(Csla.Web.SelectObjectArgs args)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; : base(typeof(OrderList))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _args = args;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  // .....<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;  private void DataPortal_Fetch(PagedCriteria criteria)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; RaiseListChangedEvents = false;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IsReadOnly = false;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; using (SqlConnection cn = new SqlConnection(Database.Connection))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cn.Open();<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ExecuteFetch(cn, criteria);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }//using<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; IsReadOnly = true;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; RaiseListChangedEvents = true;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected void ExecuteFetch(SqlConnection cn, PagedCriteria criteria)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; using (SqlCommand cm = cn.CreateCommand())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; string sortExpression = "date_created ASC";<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandType = CommandType.Text;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (!string.IsNullOrEmpty(criteria.Args.SortBLOCKED EXPRESSION<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; sortExpression = criteria.Args.SortExpression;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandText = string.Format(@"<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; WITH Orders AS<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; (<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SELECT *, ROW_NUMBER() OVER (ORDER BY {0}) AS RowNumber <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FROM tblOrder<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; )<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SELECT *<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; FROM Orders<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; WHERE RowNumber BETWEEN @StartRow AND (@StartRow + (@PageSize - 1))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ORDER BY RowNumber ASC<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ", sortExpression);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (criteria.Args.StartRowIndex == 0)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@StartRow", 1);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@StartRow", criteria.Args.StartRowIndex);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.Parameters.AddWithValue("@PageSize", criteria.Args.MaximumRows);<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; using (SafeDataReader dr = new SafeDataReader(cm.ExecuteReader()))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; while (dr.Read())<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; this.Add(OrderListItem.GetOrderListItem(dr));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }//using<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; TotalRowCountCommand cmd;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cmd = DataPortal.Execute&lt;TotalRowCountCommand&gt;(new TotalRowCountCommand("tblOrder"));<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _totalRowCount = cmd.TotalRowCount;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #region IReportTotalRowCount Members<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public int TotalRowCount<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get { return _totalRowCount; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #endregion<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  // ....<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class TotalRowCountCommand : CommandBase<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private string _tableName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private string _whereClause;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; private int _totalRowCount;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public int TotalRowCount<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return _totalRowCount;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public TotalRowCountCommand(string tableName)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _tableName = tableName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public TotalRowCountCommand(string tableName, string whereClause)<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _tableName = tableName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _whereClause = whereClause;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; protected override void DataPortal_Execute()<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; using (SqlConnection cn = new SqlConnection(Database.Connection))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cn.Open();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; using (SqlCommand cm = cn.CreateCommand())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandText = @"SELECT COUNT(*) FROM " + _tableName;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (!string.IsNullOrEmpty(_whereClause))<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cm.CommandText += " WHERE " + _whereClause;<br><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; object result = cm.ExecuteScalar();<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; try<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _totalRowCount = Convert.ToInt32(result);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; catch<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _totalRowCount = 0;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br><br>Like this I can bind to the grid as usual. Paging AND Sorting works.<br><br>&nbsp;The only 'problem' is that the sortexpression contains property names and (obviously) not column names. In the case of this proof of concept, property names are equal to their respective column names. <br>What you really want is some kind of SortExpression parser which translates property names to column names. Also, when designing bussines objects which are constructed from more complex sql query's it gets harder to do the sorting in the database.<br><br>Ofcourse you can leave the sorting out and use a sortedbindinglist in the UI, as most types of sorting is an UI thing anyway.<br>&nbsp;&nbsp;&nbsp; <br><br>Any comments ?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RobKraft replied on Wednesday, March 07, 2007</h2><P>I think your example looks pretty good and I got a similar one working.&nbsp; I don't know why sorting would be more difficult with more complex queries; unless you have multiple tables using the same column names and you continue to use select *.</P>
<P>I'm using a stored procedure and I pass in the start, max, and sortby columns to it.&nbsp; You can see an example of that stored proc currently at <A href="http://robkraft.spaces.live.com">robkraft.spaces.live.com</A>.&nbsp; The stored proc I use is a little more complicated than your SQL example because it runs on SQL 2000 (as well as SQL 2005).</P>
<P>I prefer to do the sorting in the database to reduce the memory requirements on the web server.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Skafa replied on Thursday, March 08, 2007</h2>How about the mapping between property names and column names? <br><br>I think i am going to use some kind of xml mapping file, which maps the propertynames given by SortExpression to column names. Is that a workable aproach?<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RobKraft replied on Thursday, March 08, 2007</h2><P>I think there are a lot of workable approaches.&nbsp; In my app; we are doing a lot of code generation so we have a table in the database that maps the column name to the propertyname.&nbsp; In my stored procedure for paging, I simply do a lookup to that table to exchange the propertyname for the column name.</P>
<P>You could also use an XML document, or you could just hard-code the associations in the class.&nbsp; You could probably also build a arraylist in your class to contain both values as you populate your object from the result set.</P>
<P>Personally, I would lean toward this last approach.</P>
<P>Also, we haven't decided how to handle the number of records changing (if it does).&nbsp; We are considering doing the Count lookup just once to minimize that query, because 99% of the time the number of items in the result set will not change while our user is viewing it.&nbsp; We could also requery the count just when they sort by a different column.</P>
<P>However, I suppose the best thing to do is to always query the count.&nbsp; If the count changes, we may even want to let the user know that it changed.&nbsp; Have you given any thought to this issue?</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RobKraft replied on Wednesday, March 14, 2007</h2>Also, I would recommend that you POPULATE SortExpression with the column names (at least that is what we plan to do).&nbsp; The DataField will be the PropertyName and of course the HeaderText will be whatever we want to display.&nbsp; Of course you still have to map the properties to fieldnames to populate SortExpression.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>mongo replied on Sunday, April 15, 2007</h2><P>I posted the approach I've used here: <A href="/forums/thread/13802.aspx">http://forums.lhotka.net/forums/thread/13802.aspx</A></P>
<P>Keep in mind, this is an in-memory approach only.&nbsp; Rob's implementation discussion is far more useful for large datasets. The in-memory approach works for very small return sets or as a reference implementation.</P></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
