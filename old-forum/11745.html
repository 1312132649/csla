<html><header><title>Property Status Error Control</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Property Status Error Control</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/11745.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>srangaiah posted on Wednesday, December 12, 2012</h2><p>Hello,</p>
<p>I am using the [Required] attribute on Properties in my Edit Classes that are &quot;Mandatory&quot;.</p>
<p>&nbsp;<strong>public static readonly PropertyInfo&lt;string&gt; CompanyNameProperty = RegisterProperty&lt;string&gt;(c =&gt; c.CompanyName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Required]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Display(Name = &quot;Company Name&quot;)]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string CompanyName<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return GetProperty(CompanyNameProperty); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { SetProperty(CompanyNameProperty, value); }</strong></p>
<p><strong>
<p>In my WPF xaml View I usr the PropertyStatus Control</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><font face="Consolas" size="2" color="#a31515"><font face="Consolas" size="2" color="#a31515"><font face="Consolas" size="2" color="#a31515">
<p>&nbsp;</p>
</font></font></font></span><font face="Consolas" size="2" color="#a31515"><font face="Consolas" size="2" color="#a31515">
<p>&nbsp;</p>
</font></font></span><font face="Consolas" size="2" color="#a31515">
<p>&nbsp;</p>
</font></span></p>
<p>&nbsp;</p>
<p><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">&lt;</span></span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">csla</span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">:</span></span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">PropertyStatus</span></span></span><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"> Content</span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">Binding</span></span></span><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"> Path</span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">=BrokenRules}&quot;</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;">Property</span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">=&quot;{</span></span></span><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;"><span style="font-family:Consolas;color:#a31515;font-size:x-small;">Binding</span></span></span><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"><span style="font-family:Consolas;color:#ff0000;font-size:x-small;"> Path</span></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">=Model.Company.CompanyName}&quot;</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> </span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">/&gt;</span></span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</strong></p>
<p>When &nbsp;I load this view for the first time&nbsp;(To Create a new Company) the red Exclamation icon is displayed for all required fields. The Customer has opened a defect stating that the Error Icon should not display when the Form is diaplyed for the first time.</p>
<p>The User Experience should be as follows.</p>
<p>1. For all requied fields display a * (Black star) during first Load.<br />2. If the user focuses on the field and moves out, Show the Validation icon (Red Exclamation mark) if the entered value is incorrect.<br />3. If the user does not focus on the Field and clicks &quot;Save&quot;, show the Validation Icon (Red Excalation Mark).</p>
<p>What is teh best way to acheive this? Any help will be appreciated. Also can you point me to a sample code if it exists?</p>
<p>Thanks,</p>
<p>sran</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>JonnyBee replied on Friday, December 14, 2012</h2><p>Hi,</p>
<p>1. You can either hardcode this in your form or you need to create your own extension that searches each property in the BO and looks for [Required] attribute</p>
<p>2. You _could_ make sure to NOT call BusinessRules.CheckRules in DataPortal_Create (also called from base.DataPortal_Create).&nbsp; This way - your object will have no broken rules when it is new. When user edits fields the fields will automatically be revalidated - but not as a result of just tab&#39;ing or focusing on a control. If you always want to check rules in this conditions it requires more changes to your BO - property setter.</p>
<p>3. Make sure to call BusinessRules.CheckRules to force revalidation of object when user clicks Save.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>srangaiah replied on Friday, December 14, 2012</h2><p>Thanks Jonny.</p>
<p>1. &nbsp;I do not explicitly call BusinessRules.CheckRules in DataPortal_Create. How do I make sure to _not_ call this from base.DataPortal_Create<br />2. As a Workaround,&nbsp; I implemented a GatewayRule that accepts a Boolean Value &quot;<strong>IsFirstLoad</strong>&quot;. If this is set to False, I do not execute the InnerRule. I just add a Informational Message. This shows an Information Message next to the control on first Load. If the user changes the content of the control, It automatically changes to an error icon appropriately. When User Clicks Save, I validate the model from the view model by setting a property <strong>isFirstLoad=true.&nbsp; </strong>I have also created a dependency rule of all required Properties on the <strong>isFirstLoad</strong> property. <br />3. The above workaround is providing the User Experience, the client wants. I am just concerned that this may be a hack and there is a more elegant way of acheiving this. Is the above pattern ok?</p>
<p><strong>Followup Questions</strong></p>
<p>1. Is there a way to Override the Error Icons without having to change source code. It would be great to set the * instead of the standard Information Icon.<br />2. Is there a way to access the error message of an innerRule in a Gateway Rule. Since I could not find a way, I pass the error message of the inner rule as an input Parameter to the Gateway Rule. I am using this to add an Informational Message. </p>
<p>Please see my CompanyEdit and GatewayRule Snippets.</p>
<p><strong>GatewayRule&nbsp;</strong></p>
<p>public NewRequiredRule(IPropertyInfo primaryProperty, Csla.Rules.IBusinessRule innerRule,string errorMessage, bool isSavedOnce)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : base(primaryProperty)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputProperties = new List&lt;Csla.Core.IPropertyInfo&gt; { PrimaryProperty }; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InnerRule = innerRule;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IsSavedOnce = isSavedOnce;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ErrorMessage = errorMessage;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RuleUri.AddQueryParameter(&quot;rule&quot;, System.Uri.EscapeUriString(InnerRule.RuleName));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RuleUri.AddQueryParameter(&quot;isSavedOnce&quot;, isSavedOnce.ToString());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Execute(RuleContext context)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var target = (Csla.Core.ITrackStatus)context.Target;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var chainedContext = context.GetChainedContext(InnerRule);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (IsSavedOnce|| context.IsPropertyChangedContext)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InnerRule.Execute(chainedContext);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.AddInformationResult(ErrorMessage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p><strong>Viewmodel<br />___________</strong></p>
<p><strong></strong></p>
<p>protected override void AddBusinessRules()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base.AddBusinessRules();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(CompanyNameProperty, new Csla.Rules.CommonRules.Required(CompanyNameProperty, &quot;Company Name is Required&quot;), &quot;Company Name is Required&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(TaxRegistrationNumberProperty, new Csla.Rules.CommonRules.Required(TaxRegistrationNumberProperty, &quot;TRN is Required.&quot;),&quot;TRN is Required.&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(TaxRegistrationNumberProperty, new Csla.Rules.CommonRules.RegExMatch(TaxRegistrationNumberProperty, &quot;^[1-9]{9}$&quot;, &quot;TRN&nbsp; should be 9 Digits &quot;),&quot;TRN&nbsp; should be 9 Digits &quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(NISReferenceNumberProperty, new Csla.Rules.CommonRules.Required(NISReferenceNumberProperty, &quot;NIS is required.&quot;),&quot;NIS is required.&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(NISReferenceNumberProperty, new Csla.Rules.CommonRules.RegExMatch(NISReferenceNumberProperty, &quot;^[1-9]{7}$&quot;, &quot;NIS should be 7 Digits &quot;),&quot;NIS should be 7 Digits &quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(Address1Property, new Csla.Rules.CommonRules.Required(Address1Property, &quot;Street Address is Required&quot;),&quot;Street Address is Required&quot;,IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(CityProperty, new Csla.Rules.CommonRules.Required(CityProperty, &quot;City is Required&quot;), &quot;City is Required&quot;,IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(CountryIDProperty, new Csla.Rules.CommonRules.Required(CountryIDProperty, &quot;Country is required&quot;),&quot;Country is required&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(CountryIDProperty, new Csla.Rules.CommonRules.RegExMatch(CountryIDProperty, &quot;^[1-9]\\d*$&quot;, &quot;Please select a Valid Country&quot;),&quot;Please select a Valid Country&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(StateIDProperty, new Csla.Rules.CommonRules.Required(StateIDProperty, &quot;State is Required&quot;), &quot;State is Required&quot;,IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(StateIDProperty, new Csla.Rules.CommonRules.RegExMatch(StateIDProperty, &quot;^[1-9]\\d*$&quot;, &quot;Please select a Valid State&quot;),&quot;Please select a Valid State&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(IndustryIDProperty, new Csla.Rules.CommonRules.Required(IndustryIDProperty, &quot;Industry is Required&quot;),&quot;Industry is Required&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Common.NewRequiredRule(IndustryIDProperty, new Csla.Rules.CommonRules.RegExMatch(IndustryIDProperty, &quot;^[1-9]\\d*$&quot;, &quot;Please select a Valid Industry&quot;),&quot;Please select a Valid Industry&quot;, IsSavedOnce));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BusinessRules.AddRule(new Csla.Rules.CommonRules.Dependency(IsSavedOnceProperty, CompanyNameProperty,TaxRegistrationNumberProperty,NISReferenceNumberProperty,Address1Property,CityProperty,CountryIDProperty,StateIDProperty,IndustryIDProperty));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>Thanks,</p>
<p>&nbsp;</p>
<p><strong></strong></p>
<p><strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Friday, December 14, 2012</h2><p>You have missed on one important step: </p>
<p><b>Rule instances must be considered a singelton object - ie: CSLA 4.x does only supports type-rule (and not Instance rules) so one instance of the rule is registered for ALL instances of the class type and cannot store information such as IsSavedOnce which would be instance specific for your BO. AddBusinessRules method is only called ONCE per type of BO. </b></p>
<p>Assuming that IsSavedOnce is a property in your BO then you cannot send it as a parameter on the constructor - it must be read from context.Target (the actual BO to be validated) in the Execute method .</p>
<p>Unless you override DataPortal_Create the default DataPortal_Create in you BO&#39;s will call BusinessRules.CheckRules as this is considered best practice and the default behavior. </p>
<p>You can access the results of inner rules in your GatewayRule by inspecting the context.Results property - a list of RuleResult. This is only possible for Sync-rules. Async rules is responsible for calling context.Complete themselves after the async operation is completed.</p>
<p>And if you cast the inner rule to Csla.Rules.PropertyRule you can also access the GetMessage() method of the inner rule.</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>srangaiah replied on Saturday, December 15, 2012</h2><p>Thanks for calling out the Singleton! I did notice that I<strong>sSavedOnce</strong> was always False and now I know the reason! However, I want to keep&nbsp; the rule generic for all BusinessObjects and cannot access the iSavedOnce through the Actual BO. I do not want to create a parent class and define the property there and inherit all my BO&#39;s from that. That will be a lot of change. Reflection is also not an option. Extensions Methods are also not an option.</p>
<p>I noticed that&nbsp; <span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;"><strong>context.IsPropertyChangedContext</strong> is false on initial load and becomes true as soon as I bind it to UI and return to server. I did not change the content in the UI. What is the trigger for changing &nbsp;con<strong>text.IsPropertyChangedContext</strong> from false to true? Is it that the rule is triggered before the property is initialized (during DataPortal_Create) and the property will be set to true immediately after that (as soon as the rule is completed?). </span></span></span><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">Or is this set when UI binding happens?</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-size:x-small;">For my scenario decribed above, where I want Infomation Icons on first Load and after that I always want the Required Rule ro run, will the following work as expected?</span></span></span></p>
<p><span style="font-family:Consolas;"><span style="font-family:Consolas;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">if</span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;"> (context.IsPropertyChangedContext)<br />{<br />InnerRule.Execute(chainedContext);<br />}<br /></span></span><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;"><span style="font-family:Consolas;color:#0000ff;font-size:x-small;">else<br /></span></span></span><span style="font-family:Consolas;font-size:x-small;"><span style="font-family:Consolas;font-size:x-small;">{<br />context.AddInformationResult(ErrorMessage);<br />}</span></span></span></span></p>
<p><strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Saturday, December 15, 2012</h2><p>You should not test for any of the context.IsXYZ inside the rule Execute method - and NO - it would not work as you described here. </p>
<p>IsPropertyChangedContext means that the rule is triggered from a PropertyHasChanged event.<br />When you call BusinessRules.CheckRules to check all rules, no matter if it is in DataPortal_Create or just before Save, the IsPropertyChanged mode will be false. </p>
<p>The best solution is to create IsSavedOnce as a managed property and register the IPropertyInfo with the rule. You can then use the &lt;rule&gt;.ReadProperty in the Execute method to get the actual value. </p>
<p>So I&#39;d rather recommend a rule that inspects a &quot;flag&quot; in your BO and then changes the severity of any broken rule to information like this: </p>
<pre style="font-family:Consolas;font-size:13;color:black;background:white;">&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">ChangeToInformationWhenInitial</span>&nbsp;:&nbsp;<span style="color:#2b91af;">BusinessRule</span>
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;IsSavedOnceProperty&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">set</span>;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">IBusinessRule</span>&nbsp;InnerRule&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;ChangeToInformationWhenInitial(<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;primaryProperty,&nbsp;<span style="color:#2b91af;">IPropertyInfo</span>&nbsp;isSavedOnceProperty,&nbsp;<span style="color:#2b91af;">IBusinessRule</span>&nbsp;innerRule)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span style="color:blue;">base</span>(primaryProperty)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IsSavedOnceProperty&nbsp;=&nbsp;isSavedOnceProperty;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IPropertyInfo</span>&gt;&nbsp;{&nbsp;primaryProperty&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InnerRule&nbsp;=&nbsp;innerRule;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuleUri.AddQueryParameter(<span style="color:#a31515;">&quot;rule&quot;</span>,&nbsp;System.<span style="color:#2b91af;">Uri</span>.EscapeUriString(InnerRule.RuleName));
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(InnerRule.InputProperties&nbsp;!=&nbsp;<span style="color:blue;">null</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties.AddRange(InnerRule.InputProperties);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputProperties&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IPropertyInfo</span>&gt;(InputProperties.Distinct());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AffectedProperties.AddRange(innerRule.AffectedProperties);
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">protected</span>&nbsp;<span style="color:blue;">override</span>&nbsp;<span style="color:blue;">void</span>&nbsp;Execute(<span style="color:#2b91af;">RuleContext</span>&nbsp;context)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.ExecuteRule(InnerRule);
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;isSavedOnce&nbsp;=&nbsp;(<span style="color:blue;">bool</span>)&nbsp;ReadProperty(context.Target,&nbsp;IsSavedOnceProperty);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(!isSavedOnce)&nbsp;<span style="color:blue;">return</span>;
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;change&nbsp;priority&nbsp;for&nbsp;all&nbsp;broken&nbsp;rules&nbsp;to&nbsp;Information</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">foreach</span>&nbsp;(<span style="color:blue;">var</span>&nbsp;result&nbsp;<span style="color:blue;">in</span>&nbsp;context.Results)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.Severity&nbsp;=&nbsp;<span style="color:#2b91af;">RuleSeverity</span>.Information;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
</pre></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
