<html><header><title>Displaying error returned by server side business rules validation.</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Displaying error returned by server side business rules validation.</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/921.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>oshokodk posted on Wednesday, August 16, 2006</h2><FONT size=2>
<P>I am trying to </P>
<P>I am not using data portal feature of CSLA. Save process consists of write object into XML document, call web service method (not colas based), merge server response into object. Web service method can fail to save objects for variety of reasons (server side business rules validation, data integrity errors, etc.). If it fails, it return description of the problem. I want to integrate this status into string returned by </FONT><FONT face="Courier New" color=#008080 size=2>BusinessBase.IDataErrorInfo</FONT><FONT face="Courier New" size=2>.Error.</P>
<P>I see several methods, but I don't like any of them.</P>
<P>1. keep error description in data member of my class, override </FONT><FONT size=2>by </FONT><FONT face="Courier New" color=#008080 size=2>BusinessBase.IDataErrorInfo</FONT><FONT face="Courier New" size=2>.Error to return this error or redirect call to base class.</P>
<P>2. Add this error to broken rules list. </P>
<P>- BrokenRule class doesn't have public setters nor public constructor. Hack it and implement way of constructing broken rule without RuleMethod.</P>
<P>- Fake </FONT><FONT face="Courier New" color=#008080 size=2>RuleMethod argument of </FONT><FONT face="Courier New" size=2>BrokenRule constructor by creating this object on stack and then calling BrokenRule constructor.</P>
<P>- Be good citizen and implement proper business rule that check local data member of my class and fails if this member is not empty. I don't like since this rule will be checked all the time and will slow loading time of large collections.</P>
<P>Any suggestions?</P>
<P>Any changes in 2.1 that will help this situation?</P></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>vargasbo replied on Thursday, August 17, 2006</h2>It's really hard to say much to your question, since the data portal is the biggest part of the Csla. At this point I'm assuming your just using the Csla as a guide framework.<br><br>Hard to help out with out seeing some code.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brian Criswell replied on Thursday, August 17, 2006</h2>How many items are you referring to when you say a large collection, and what are your time constraints.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>oshokodk replied on Thursday, August 17, 2006</h2><P>Collections can be larger than 20k. I am looking forward to 2.1 per-class validation rules. In mean time I implemented custom rule that passes special property of the object as error description. This was the only way I could work around private and internal methods and classes of valiadtion rules area.</P>
<P>The only inconvinence that I need to add this rule and this rule stays in collection of business rules for lifetime of the object.</P>
<P>RULE:</P><FONT size=2>
<P>[System.Diagnostics.CodeAnalysis.</FONT><FONT color=#008080 size=2>SuppressMessage</FONT><FONT size=2>(</FONT><FONT color=#800000 size=2>"Microsoft.Design"</FONT><FONT size=2>, </FONT><FONT color=#800000 size=2>"CA1062:ValidateArgumentsOfPublicMethods"</FONT><FONT size=2>)]</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>static</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>bool</FONT><FONT size=2> ServerSideValidation(</FONT><FONT color=#0000ff size=2>object</FONT><FONT size=2> target, </FONT><FONT color=#008080 size=2>RuleArgs</FONT><FONT size=2> e)</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#0000ff size=2></FONT>string</FONT><FONT size=2> value = (</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>)</FONT><FONT color=#008080 size=2>Utilities</FONT><FONT size=2>.CallByName(target, e.PropertyName, </FONT><FONT color=#008080 size=2>CallType</FONT><FONT size=2>.Get);</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</FONT><FONT size=2> (!</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>.IsNullOrEmpty(value))</FONT></P>
<P><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.Description = value;</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>;</FONT></P>
<P><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>true</FONT><FONT size=2>;</P>
<P>}</P>
<P>USAGE:</P><FONT size=2>
<P>[</FONT><FONT color=#008080 size=2>Browsable</FONT><FONT size=2>(</FONT><FONT color=#0000ff size=2>false</FONT><FONT size=2>)]</P>
<P></FONT><FONT color=#0000ff size=2>const</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ServerSideValidationStatusName = </FONT><FONT color=#800000 size=2>"ServerSideValidationStatus"</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>public</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2> ServerSideValidationStatus</P>
<P>{</P>
<P></FONT><FONT color=#0000ff size=2>get</FONT><FONT size=2> { </FONT><FONT color=#0000ff size=2>return</FONT><FONT size=2> _ServerSideValidationStatus; }</P>
<P></FONT><FONT color=#0000ff size=2>set</P></FONT><FONT size=2>
<P>{</P>
<P>_ServerSideValidationStatus = </FONT><FONT color=#0000ff size=2>value</FONT><FONT size=2>;</P>
<P></FONT><FONT color=#0000ff size=2>if</FONT><FONT size=2> (</FONT><FONT color=#0000ff size=2>string</FONT><FONT size=2>.IsNullOrEmpty(_ServerSideValidationStatus))</P>
<P>{</FONT><FONT color=#008000 size=2>//remove broken rule</P></FONT><FONT size=2>
<P>ValidationRules.CheckRules(ServerSideValidationStatusName);</P>
<P>}</P>
<P></FONT><FONT color=#0000ff size=2>else</P></FONT><FONT size=2>
<P>{</FONT><FONT color=#008000 size=2>//add broken rule</P></FONT><FONT size=2>
<P>ValidationRules.AddRule(CorpTax.ETS.Common.BusinessEntities.Validation.</FONT><FONT color=#008080 size=2>CommonRules</FONT><FONT size=2>.ServerSideValidation, ServerSideValidationStatusName);</P>
<P>ValidationRules.CheckRules(ServerSideValidationStatusName);</P>
<P>}</P>
<P>}</P>
<P>}</P></FONT></FONT></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
