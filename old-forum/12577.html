<html><header><title>CSLA 3.0.6 to latest version 4.5.501</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>CSLA 3.0.6 to latest version 4.5.501</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12577.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs posted on Monday, April 07, 2014</h2><p>I am not sure if I posted this question before or somebody posted it, but somehow I cannot find the discussion.</p>
<p>We had lots of in-house applications that uses CSLA 3.0.6, .NET Framework 3.5/4, VS2010.&nbsp; Would it possible to upgrade all of those to the latest CSLA version (4.5.501), .NET Framework 4.5 and VS 2012?</p>
<p>One our concern are there lots of validation and business rules in any of the project.</p>
<p>Thanks.</p></div><div style='padding:0 15 3 15;background-color:lightgreen'><h2>skagen00 replied on Monday, April 07, 2014</h2><p>Do you have a lot of unit tests?</p>
<p>We upgraded through the new business rules approach and that was certainly the most involved component - though that area of our system had a lot of test coverage that gave us some comfort with the end result.&nbsp; I think it took about 2-3 weeks to get our application upgraded through the new business rules mechanism.</p>
<p>It&#39;s obviously possible to pretty much any CSLA app (ours started at 2.x) - it&#39;s just a matter of the amount of work involved.&nbsp; </p>
<p>What is the motivation for upgrading them? To leverage some of the newer technologies that become supportable via newer versions of CSLA, or to just &quot;stay current&quot;?&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Wednesday, April 09, 2014</h2><p>Thanks for the response skagen00, it&#39;s been months that we&#39;re thinking of upgrading and yes you&#39;re right with the amount of of work involved is not a joke.&nbsp; I would say for the reason of staying current and to leverage the newer technologies as you said, like migrating to .NET Framework 4.5 as our back-end resources upgraded too.</p>
<p>Well, we don&#39;t have unit tests for one of our main app yet.&nbsp; And that&#39;s what we are trying to achieve during conversion process.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Monday, April 07, 2014</h2><p>Hi,</p>
<p>Possible, yes - but it will require a substantial amount of work. There is a number of breaking changes and you really need to go through all the release starting from the next version of your current version and up.&nbsp;</p>
<p>One of the biggest issues is to alter your code to use PropertyInfo descriptors. CSLA 4.x require all properties that have rules attached to them to be defined with PropertyInfo&#39;s. But as mentioned before - there is a number of breaking changes. Once you get your code to that point you can use the Csla.Validation NuGet package to retain &quot;most&quot; of the Validation rules with the old syntax and focus on getting the application upgraded bit-by-bit.</p>
<p>You should however be able to move the application to VS 2012 and .NET 4.5 while keeping the reference to CSLA 3.0.6 with hardly any change in your code - if that would solve some of your issues.&nbsp;</p>
<p>There has been several threads on migration to never versions - just search for &quot;upgrade&quot; in the forum.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Wednesday, April 09, 2014</h2><p>Thanks JonnyBee, this is the kind of information that I am looking at.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Tuesday, July 15, 2014</h2><p>So it was a success when we moved several of our projects from 3.0.6 to 4.5.501.&nbsp; One of the minor issue that we are having right now is Exception messages are being returned to the end client, we haven&#39;t modified any code yet except with the conversion/deprecated one.&nbsp; I&#39;m not sure if any of you encountered this or it is a known thing.&nbsp; Please let me know if you need further information.&nbsp; Thank you in advance.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Wednesday, July 16, 2014</h2><p>Do you mean _exception messages are *not* being returned to the end client_?</p>
<p>Because I did encounter that, and it was a CSLA bug that should be fixed in 4.5.501 - (<a href="http://forums.lhotka.net/forums/p/12076/55936.aspx">http://forums.lhotka.net/forums/p/12076/55936.aspx</a>) </p>
<p>I don&#39;t have an answer but just wanted to mention that previous thread of where an exception was not getting back to the client before.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Wednesday, July 16, 2014</h2><p>Somehow, my question is related to that fix.&nbsp; I&#39;ll check on that.<br /><br />I found out the issue.&nbsp; We did modified the code, previously it will resume next if it encounters an exception.<br /><br />OLD Code with CSLA 3.0.6:<br />try <br />{<br />&nbsp;.....<br />} catch { }<br /><br />NEW Code with CSLA 4.5.501<br />try <br />{<br />&nbsp;.....<br />} catch (Exception ex) { <br />&nbsp;LogThisError(blahblahex.message);<br />}<br /><br />The old code will nothing, but the new code will return the CSLA formatted Exception.Message().&nbsp; I&#39;m not sure if this is the expected behavior or is there a way to supress this in general?&nbsp; My quick fix just to put back the &quot;catch {}&quot;.<br /><br />Thanks.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Monday, January 19, 2015</h2><p>Hey guys, I was able upgrade some of our projects to newer CSLA version (from 3.0.6).&nbsp; However, in one of the project I encountered the issue of &quot;List item must be marked as a child object&quot;.&nbsp; Here&#39;s the exception:<br /><br />Type : Csla.DataPortalException, Csla, Version=4.5.501.0, Culture=neutral, PublicKeyToken=93be5fdc093e4c30<br />Message : DataPortal.Fetch failed (List item must be marked as a child object)<br />Source : Csla<br />Help link :<br />ErrorInfo :<br />BusinessObject :<br />BusinessException : System.InvalidOperationException: List item must be marked as a child object<br />&nbsp; at Csla.BusinessListBase`2.InsertItem(Int32 index, C item)<br />&nbsp; at Csla.Core.ExtendedBindingList`1.AddRange(IEnumerable`1 range)<br />&nbsp; at myProj.BLL.myRequestList.DataPortal_Fetch(Criteria crit)<br />&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Boolean hasParameters, Object[] parameters)<br />Data : System.Collections.ListDictionaryInternal<br />TargetSite : System.Object Fetch(System.Type, System.Object)<br />HResult : -2146233088<br />Stack Trace :&nbsp;&nbsp;&nbsp; at Csla.BusinessListBase`2.InsertItem(Int32 index, C item)<br />&nbsp; at Csla.Core.ExtendedBindingList`1.AddRange(IEnumerable`1 range)<br />&nbsp; at myProj.BLL.myRequestList.DataPortal_Fetch(Criteria crit)<br />&nbsp; at lambda_method(Closure , Object , Object[] )<br />&nbsp; at Csla.Reflection.MethodCaller.CallMethod(Object obj, DynamicMethodHandle methodHandle, Boolean hasParameters, Object[] parameters)<br />&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)<br />&nbsp; at Microsoft.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccess(Task task)<br />&nbsp; at Csla.Server.SimpleDataPortal.&lt;Fetch&gt;d__7.MoveNext()<br />&nbsp; at Csla.DataPortal`1.Fetch(Type objectType, Object criteria)<br />&nbsp; at Csla.DataPortal`1.Fetch(Object criteria)<br />&nbsp; at Csla.DataPortal.Fetch[T](Object criteria)<br />&nbsp; at myProj.BLL.myRequestList.GetSendingRequestList(Int32 aMaxRows)<br /><br /><br /><br />And here&#39;s how my BLL looks like:<br /><br />namespace myProj.BLL<br />{<br />&nbsp;&nbsp;&nbsp; [Serializable()]<br />&nbsp;&nbsp;&nbsp; public class myRequestList : BusinessListBase&lt;myRequestList, myRequestInfo&gt;<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static myRequestList GetmyRequestList(int aMaxRows)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DataPortal.Fetch&lt;myRequestList&gt;(new Criteria(aMaxRows));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void DataPortal_Fetch(Criteria crit)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UtilitiesDataContext db = new myDBDataContext(ConfigurationManager.ConnectionStrings[Database.myDB].ToString());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var data = from Items in db.p_GetMyOrders(crit.MaxRows)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select new myRequestInfo(Items.myUID, Items.OrderID, Items.LocationID, Items.QName, Items.ReplaceRequired, Items.abbreviation, Items.ItemCount);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (data != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.AddRange(data);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.Dispose();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private class Criteria<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int mMaxRows;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int MaxRows { get { return mMaxRows; } }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Criteria(int aMaxRows)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mMaxRows = aMaxRows;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; }<br />}</p>
<p>&nbsp;</p>
<p>Any idea?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>skagen00 replied on Tuesday, January 20, 2015</h2><p>It has been a while but I believe we encountered this a couple places during our upgrade as well.&nbsp; Previously it wouldn&#39;t choke if you forgot to MarkAsChild() but upon upgrading we noticed that there were a few places where we were not successfully making sure the item was marked as a child before adding it to a CSLA list. </p>
<p>MarkAsChild() on the item before adding and I believe you will be OK. </p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Tuesday, January 20, 2015</h2><p>It works!&nbsp; Thanks @skagen00, all I need is add MarkAsClean() in myRequestInfo().&nbsp; This is one of the major issue that I encountered in upgrading.&nbsp; The other one is the &quot;Private backing field&quot;.</p>
<p>Thanks a lot.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, January 21, 2015</h2><p><div style='padding-left: 50px;background-color:silver'><b>Migs<br></b>
<p>It works!&nbsp; Thanks @skagen00, all I need is add MarkAsClean() in myRequestInfo().&nbsp; This is one of the major issue that I encountered in upgrading.&nbsp; The other one is the &quot;Private backing field&quot;.</p>
<p>Thanks a lot.</p>
<div style="CLEAR:both;"></div>
</div></p>
<p>You may want to consider using static factory methods to crud your child objects, as the data portal now offers .FetchChild and others which will do the MarkAsChild for you.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Migs replied on Thursday, January 22, 2015</h2><p>Thanks for the tip Andy that will be my next move once I fully tested the upgraded.&nbsp; Some of my projects that got upgraded was already using .FetchChild.</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
