<html><header><title>Local DataPortal works, but Remote DataPortal does not</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Local DataPortal works, but Remote DataPortal does not</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/12056.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem posted on Wednesday, July 03, 2013</h2><p>On my local development machine, I have a WinForms app that connects to the WCF based DataPortal and everything works fine.</p>
<p>When I publish the DataPortal to the server and change my connection in my WinForm app to use the remote data portal, it throws the following exceptions:</p>
<p>&quot;The caller was not authenicated by the service.&quot;</p>
<p>&quot;The request for the security token could not be satisifed because authenication failed.&quot;</p>
<p>When I browse to http:://www.mycompany.com/DataPortal.svc, I get the proper information and can display the WSDL information, too.</p>
<p>My web.config has this in it:</p>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp; &lt;system.serviceModel&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;services&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;service name=&quot;Csla.Server.Hosts.WcfPortal&quot; behaviorConfiguration=&quot;returnFaults&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;endpoint <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract=&quot;Csla.Server.Hosts.IWcfPortal&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; binding=&quot;wsHttpBinding&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingConfiguration=&quot;wsHttpBinding_IWcfPortal&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/service&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/services&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;bindings&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;binding name=&quot;wsHttpBinding_IWcfPortal&quot; maxReceivedMessageSize=&quot;2147483647&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;readerQuotas <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxBytesPerRead=&quot;2147483647&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxArrayLength=&quot;2147483647&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxStringContentLength=&quot;2147483647&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxNameTableCharCount=&quot;2147483647&quot; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxDepth=&quot;2147483647&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/binding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsHttpBinding&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/bindings&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;behaviors&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceBehaviors&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;behavior name=&quot;returnFaults&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceDebug includeExceptionDetailInFaults=&quot;true&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;serviceMetadata httpGetEnabled=&quot;true&quot;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/behavior&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/serviceBehaviors&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/behaviors&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/system.serviceModel&gt;</code></p>
<p>&nbsp;And my app.config contains the usual CSLA settings:</p>
<p><code>&lt;add key=&quot;CslaPropertyChangedMode&quot; value=&quot;Windows&quot;/&gt;<br />&lt;add key=&quot;CslaDataPortalProxy&quot; value=&quot;Csla.DataPortalClient.WcfProxy, Csla&quot;/&gt;<br />&lt;add key=&quot;CslaDataPortalUrl&quot; value=&quot;<a href="http://www.mycompany.com/DataPortal.svc&quot;/">http://www.mycompany.com/DataPortal.svc&quot;/</a>&gt;<br />&lt;add key=&quot;CslaAuthentication&quot; value=&quot;Csla&quot;/&gt;</code></p>
<p>&nbsp;Any guidance for how I can use my data portal once it&#39;s published to the server?</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>From the exception message there is a mismatch in authentication.&nbsp;</p>
<p>Is your server configured to use <b>Windows Authentication</b>?&nbsp;</p>
<p>If so try to activate <b>Anonymous Authentication</b> on your server and check if the portal works as expected.&nbsp;</p>
<p>If you want to use WIndows Authentication you must also configure WCF to use that authentication type on both server and client.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem replied on Wednesday, July 03, 2013</h2><p>I have just confirmed in IIS that the Authentication is has Anonymous Authentication enabled and all other forms are disabled.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Wednesday, July 03, 2013</h2><p>Do you have&nbsp;</p>
<p><span>&lt;add key=&quot;CslaAuthentication&quot; value=&quot;Csla&quot;/&gt;&nbsp;</span></p>
<p><span>in your web.config?&nbsp;</span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem replied on Wednesday, July 03, 2013</h2><p><div style='padding-left: 50px;background-color:silver'><b>JonnyBee<br></b>
<p>Do you have&nbsp;</p>
<p><span>&lt;add key=&quot;CslaAuthentication&quot; value=&quot;Csla&quot;/&gt;&nbsp;</span></p>
<p><span>in your web.config?&nbsp;</span></p>
<div style="CLEAR:both;"></div>
</div></p>
<p>Yes, I have that in there.&nbsp; It is in my web.config and also my app.config.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonnyBee replied on Thursday, July 04, 2013</h2><p>Well, then it&#39;s likely hardcore transport debugging to be done.</p>
<p>You should use FIDDLER or a network trace tool to inspect the communication and try to detect why/where there is mismatch in the authentication.&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem replied on Monday, July 08, 2013</h2><p>I should say at this point that I&#39;m trying to host in Azure.</p>
<p>This is what I&#39;ve done (among a million other things, but these are the most salient):</p>
<p>I&#39;ve created a plain WCF service and confirmed that I can host it in Azure.</p>
<p>Rocky has an AzureHost example project that is associated with the DataPortal book. It runs a Silverlight application and I&#39;ve confirmed that it runs in Azure.</p>
<p>Then, I added a Windows Form project to the AzureHost project and set the CslaDataPortalUrl element in the WinForm App.Config to the local AzureHost instance and it actually runs.</p>
<p>But, once I publish the data portal to Azure, change my CslaDataPortalUrl to the Azure address for the .svc file, I get the exception &quot;The request for security token could not be satisfied because authentication failed.&quot;</p>
<p>Azure defaults to anonymous authentication so I&#39;m not sure what else I need to be looking at. Is Azure really that different that IIS, even though they love to say it is not?</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem replied on Monday, July 15, 2013</h2><p>After trying ever machination I could find with getting an Azure WCF-based CSLA&nbsp;data portal to work with a WinForms application, I&#39;m finally to the point where I don&#39;t think it&#39;s possible.&nbsp; I&#39;m able to get a standard WCF service to work in Azure, but getting CSLA to work has been fruitless no matter how many settings I fiddle with in the config files.</p>
<p>The CSLA examples are for Silverlight programs and they work in Azure, and I&#39;ve even tried to take the AzureHost project and modify it to have a WinForms app access the library, but that has failed. In fact, I&#39;ve created a test GitHub project to make it easy for somebody to point out how to hook up WinForms to Azure:</p>
<p><a href="https://github.com/BradRem/AzureHostTest">https://github.com/BradRem/AzureHostTest</a></p>
<p>I also have a StackOverflow question with a nice bounty running and nobody has submitted a solution:</p>
<p><a href="http://stackoverflow.com/questions/17557700/how-do-i-configure-a-csla-wcf-dataportal-for-azure">http://stackoverflow.com/questions/17557700/how-do-i-configure-a-csla-wcf-dataportal-for-azure</a></p>
<p>I&#39;m beyond baffled.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Monday, July 15, 2013</h2><p>When you say &quot;in Azure&quot; do you mean in a web site or a cloud service?</p>
<p>I have numerous data portal end points running in cloud services (web role). I don&#39;t know that I&#39;ve tried hosting one in an azure web site, so there could be unforeseen issues there I suppose.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Brad Rem replied on Monday, July 15, 2013</h2><p>Azure, cloud services with a web role.&nbsp; You have a project called AzureHost that goes along with the DataPortal book. I essentially took that project, removed the Silverlight stuff and tried to make it work with WinForms app because I wasn&#39;t able to get my actual project working.&nbsp; I&#39;ve tried certifcates and different wsHttpSettings and practically everything under the sun, but keeping running into one exception after another.</p>
<p>I direct you to my StackOverflow question for my complete write up:</p>
<p><a href="http://stackoverflow.com/questions/17557700/how-do-i-configure-a-csla-wcf-dataportal-for-azure">http://stackoverflow.com/questions/17557700/how-do-i-configure-a-csla-wcf-dataportal-for-azure</a></p>
<p>And my bare-bones test project on GitHub to illustrate my struggles:</p>
<p><a href="https://github.com/BradRem/AzureHostTest">https://github.com/BradRem/AzureHostTest</a></p>
<p>I&#39;m feeling at the end of my rope.</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
